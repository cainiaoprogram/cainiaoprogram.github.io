<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>python解析xml遇到的问题分享(命名空间有关) - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="python解析xml遇到的问题分享(命名空间有关)" />
<meta property="og:description" content="背景
最近在工作中，要测试这样的一个需求：
要验证股票公司事件的数据入库规则，需要对开发的etl代码以及映射规则进行验证，然后数据源给的源文件格式是xml格式的，人工核对起来的话，考虑到有的字段还有枚举值映射关系或者一些简单的格式处理之类的，如果每次都人工去Ctrl &#43; F去xml文件里面搜索标签去校验对应数据的话，效率不是特别的高，也不利于后续开发代码调整后的快速验证，因此我考虑自己用python脚本去按照分析师的规则文档自己解析一下xml文件，然后用自己解析出来的结果跟开发解析出来的数据进行一下对比，在一定程度上，能够稍微提升一下工作的效率。
过程&amp;遇到的问题
既然是要解析xml文件，我的第一反应是百度搜索“python xml解析” 然后我选中了菜鸟教程中的一个文档进行查看：
https://www.runoob.com/python/python-xml.html
在页面中可以看到，包括一般百度到的文章介绍都是说有三种方式可以解析：
接下来用一个案例去演示一下解析xml文件：
测试案例的xml文件demo如下：
&lt;?xml version=&#34;1.0&#34;?&gt; &lt;corporate_actions xmlns=&#34;https://mp.weixin.qq.com/s/RGkBjpX5ipGHYNSOPaxktA&#34; &gt; &lt;Students CLASSID=&#34;1&#34; ID_REVISION=&#34;0000&#34; ID_EVENT=&#34;12345678&#34; xml:id=&#34;UCAEvent111212120000&#34;&gt; &lt;student name=&#34;小博&#34;&gt; &lt;classId&gt;1&lt;/classId&gt; &lt;year&gt;2011&lt;/year&gt; &lt;heigth&gt;173&lt;/heigth&gt; &lt;/student&gt; &lt;student name=&#34;张三&#34;&gt; &lt;classId&gt;2&lt;/classId&gt; &lt;year&gt;2011&lt;/year&gt; &lt;heigth&gt;175&lt;/heigth&gt; &lt;/student&gt; &lt;/Students&gt; &lt;/corporate_actions&gt; 接下来我们先写代码去获取Students这个标签的数据：
然后很神奇的发现，直接用root.find去查找元素的时候，居然为空，看了网上的代码都是这么写的呀，一度陷入迷茫中。
问题如何解决
经过不断的搜索，最终看到别的小伙伴也遇到过这种问题：
经过查找，发现在xml中，如果文件头中带有xmlns属性的话，表示这个是带有命名空间的，在解析的时候，要加上命名空间。
关于xml的命名空间，可以参考下面的文章：
https://www.w3school.com.cn/xml/xml_namespaces.asp
最终可以匹配到元素的代码如下：
import xml.etree.ElementTree as ET xml_path = f&#34;D:\\MyScripts\\PythonStudy\\QuotesApi\\ice.xml&#34; tree = ET.parse(xml_path) # 打开xml文档 root = tree.getroot() student1 = root.find(&#34;Students&#34;) student2 = root.find(&#34;{https://mp.weixin.qq.com/s/RGkBjpX5ipGHYNSOPaxktA}Students&#34;) print(student1) # 没加命名空间，匹配不到元素 print(student2) # 加了命名空间，匹配不到元素 思考" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/fea33c357f22639e947c60272163d63c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-11-09T12:00:02+08:00" />
<meta property="article:modified_time" content="2022-11-09T12:00:02+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">python解析xml遇到的问题分享(命名空间有关)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div id="js_content"> 
 <p><img src="https://images2.imgbox.com/4f/4c/FnYmD9wi_o.png" alt="024472d14a5e93045a93b07b8f3d4b29.png"></p> 
 <p>背景</p> 
 <p>最近在工作中，要测试这样的一个需求：</p> 
 <p>要验证股票公司事件的数据入库规则，需要对开发的etl代码以及映射规则进行验证，然后数据源给的源文件格式是xml格式的，人工核对起来的话，考虑到有的字段还有枚举值映射关系或者一些简单的格式处理之类的，如果每次都人工去Ctrl + F去xml文件里面搜索标签去校验对应数据的话，效率不是特别的高，也不利于后续开发代码调整后的快速验证，因此我考虑自己用python脚本去按照分析师的规则文档自己解析一下xml文件，然后用自己解析出来的结果跟开发解析出来的数据进行一下对比，在一定程度上，能够稍微提升一下工作的效率。<br></p> 
 <p><img src="https://images2.imgbox.com/13/47/dQo18ouc_o.png" alt="0010f3c344334646a11d82a940ba562d.png"></p> 
 <p>过程&amp;遇到的问题</p> 
 <p>既然是要解析xml文件，我的第一反应是百度搜索“python xml解析” </p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/0c/d8/s0ePShWF_o.png" alt="9c2ab17987ed9ded3017e205ff2a0f52.png"></p> 
 <p>然后我选中了菜鸟教程中的一个文档进行查看：</p> 
 <p>https://www.runoob.com/python/python-xml.html</p> 
 <p>在页面中可以看到，包括一般百度到的文章介绍都是说有三种方式可以解析：</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/4d/3c/f8YgwU8K_o.png" alt="38367f57216e814f07f2a9fdd67a6678.png"></p> 
 <p>接下来用一个案例去演示一下解析xml文件：<br></p> 
 <p>测试案例的xml文件demo如下：<br></p> 
 <pre class="has"><code class="language-xml">&lt;?xml version="1.0"?&gt;
&lt;corporate_actions
   xmlns="https://mp.weixin.qq.com/s/RGkBjpX5ipGHYNSOPaxktA" &gt;
   &lt;Students CLASSID="1" ID_REVISION="0000" ID_EVENT="12345678" xml:id="UCAEvent111212120000"&gt;
      &lt;student name="小博"&gt;
         &lt;classId&gt;1&lt;/classId&gt;
         &lt;year&gt;2011&lt;/year&gt;
         &lt;heigth&gt;173&lt;/heigth&gt;
      &lt;/student&gt;
      &lt;student name="张三"&gt;
         &lt;classId&gt;2&lt;/classId&gt;
         &lt;year&gt;2011&lt;/year&gt;
         &lt;heigth&gt;175&lt;/heigth&gt;
      &lt;/student&gt;
   &lt;/Students&gt;
&lt;/corporate_actions&gt;</code></pre> 
 <p>接下来我们先写代码去获取Students这个标签的数据：</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/0c/ea/9Hokk1i8_o.png" alt="ad032ccb87f64f1b7c66b80046aaa465.png"></p> 
 <p>然后很神奇的发现，直接用root.find去查找元素的时候，居然为空，看了网上的代码都是这么写的呀，一度陷入迷茫中。</p> 
 <p><img src="https://images2.imgbox.com/1e/ca/YpXq4z6X_o.png" alt="321fa4fd5bad1c83f1cdbcb4747b5281.png"></p> 
 <p>问题如何解决</p> 
 <p>经过不断的搜索，最终看到别的小伙伴也遇到过这种问题：</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/5b/6d/dcO6J7mc_o.png" alt="dd301ac90bcbdbf3312e079b1ee889af.png"></p> 
 <p>经过查找，发现在xml中，如果文件头中带有xmlns属性的话，表示这个是带有命名空间的，在解析的时候，要加上命名空间。</p> 
 <p>关于xml的命名空间，可以参考下面的文章：<br></p> 
 <p>https://www.w3school.com.cn/xml/xml_namespaces.asp</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/5c/4f/1xiTZIOu_o.png" alt="1bb58169584ba1b0db78cb9befe5f581.png"></p> 
 <p>最终可以匹配到元素的代码如下：<br></p> 
 <pre class="has"><code class="language-makefile">import xml.etree.ElementTree as ET


xml_path = f"D:\\MyScripts\\PythonStudy\\QuotesApi\\ice.xml"
tree = ET.parse(xml_path)  # 打开xml文档
root = tree.getroot()
student1 = root.find("Students")
student2 = root.find("{https://mp.weixin.qq.com/s/RGkBjpX5ipGHYNSOPaxktA}Students")


print(student1)  # 没加命名空间，匹配不到元素
print(student2)  # 加了命名空间，匹配不到元素</code></pre> 
 <p><img src="https://images2.imgbox.com/f8/00/9naY9qPA_o.png" alt="1eed1fb67e6a26a3711a9bd5358e32bc.png"></p> 
 <p>思考</p> 
 <p>1、像上面那样写的话，每次定位元素都要在前面加上这么一长串的命名空间的代码，感觉有点冗余，有没有什么好的方式可以只写一次,后面不用写呢?（当然，为了测试方便的话，可以把xml文件中的命名空间的内容去掉即可）</p> 
 <p>2、现在有现成的库可以直接把xml转dict,这样的话，在转换格式后可以借助jsonpath去提取文件中的数据，感觉比xml提取内容会方便一些。比如使用</p> 
 <p>xmltodict库。</p> 
 <p style="text-align:left;">学习/工作过程中有遇到问题的，可以加好友(<strong>xiaobotester</strong>)一起交流，需简单自我介绍下或者朋友圈对等开放。若一条都不满足，拒绝提供好友位，如需加测试讨论群，可以备注，融入圈子，一起成长。</p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/19245b6f39078ae16e2af3344e23b5b9/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">SLC、MLC、TLC与QLC的区别</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/788a83666ee10bf8f448496e4fbc2bce/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">FPN（特征金字塔结构）详解</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>