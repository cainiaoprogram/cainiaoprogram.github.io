<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>spring&#43;quartz动态添加、修改、删除任务(包括按照cron表达式执行和间隔时间执行) - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="spring&#43;quartz动态添加、修改、删除任务(包括按照cron表达式执行和间隔时间执行)" />
<meta property="og:description" content="功能要求 1.实现项目启动时在启动所有没有过期的任务
2.页面添加、修改、删除任务功能
3.页面功能包含设定任务的开始时间、结束时间、是否暂停功能(暂停功能的实现是直接删除任务,启用时在添加任务)
版本 spring 5.0.5 quartz 2.3.0
1.spring-quartz.xml &lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt; &lt;beans xmlns=&#34;http://www.springframework.org/schema/beans&#34; xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34; xmlns:context=&#34;http://www.springframework.org/schema/context&#34; xmlns:tx=&#34;http://www.springframework.org/schema/tx&#34; xmlns:task=&#34;http://www.springframework.org/schema/task&#34; xmlns:aop=&#34;http://www.springframework.org/schema/aop&#34; xsi:schemaLocation=&#34;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd http://www.springframework.org/schema/task http://www.springframework.org/schema/task/spring-task.xsd http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd&#34;&gt; &lt;!-- 这个类用来做需要完成的业务--&gt; &lt;!-- &lt;bean id=&#34;myJob&#34; class=&#34;com.foxconn.ipebg.dpis.risk.scheduler.MyJob&#34;&gt;&lt;/bean&gt; --&gt; &lt;!-- 定时任务 --&gt; &lt;!-- 定义调用对象和调用对象的方法，这个配置和普通的一样的,id是JobDetail的名字 --&gt; &lt;!-- &lt;bean id=&#34;jobtask&#34; class=&#34;org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean&#34;&gt; --&gt; &lt;!-- 调用的类 --&gt; &lt;!-- &lt;property name=&#34;targetObject&#34; ref=&#34;myJob&#34; /&gt; --&gt; &lt;!-- 调用类中的方法 --&gt; &lt;!-- &lt;property name=&#34;targetMethod&#34; value=&#34;doNothing&#34; /&gt; --&gt; &lt;!-- 是否并发 --&gt; &lt;!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/395684b99e68dd64c48fd51047ed40d5/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-10-16T11:42:22+08:00" />
<meta property="article:modified_time" content="2019-10-16T11:42:22+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">spring&#43;quartz动态添加、修改、删除任务(包括按照cron表达式执行和间隔时间执行)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>功能要求</h3> 
<p>1.实现项目启动时在启动所有没有过期的任务<br> 2.页面添加、修改、删除任务功能<br> 3.页面功能包含设定任务的开始时间、结束时间、是否暂停功能(暂停功能的实现是直接删除任务,启用时在添加任务)</p> 
<h3><a id="_4"></a>版本</h3> 
<p>spring 5.0.5 quartz 2.3.0</p> 
<h3><a id="1springquartzxml_6"></a>1.spring-quartz.xml</h3> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans<span class="token punctuation">"</span></span>
	   <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>
	   <span class="token attr-name"><span class="token namespace">xmlns:</span>context</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/context<span class="token punctuation">"</span></span>
	   <span class="token attr-name"><span class="token namespace">xmlns:</span>tx</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/tx<span class="token punctuation">"</span></span>
	   <span class="token attr-name"><span class="token namespace">xmlns:</span>task</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/task<span class="token punctuation">"</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>aop</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/aop<span class="token punctuation">"</span></span>
	   <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans
	    http://www.springframework.org/schema/beans/spring-beans.xsd
	    http://www.springframework.org/schema/context 
		http://www.springframework.org/schema/context/spring-context.xsd
		http://www.springframework.org/schema/tx
	    http://www.springframework.org/schema/tx/spring-tx.xsd
	    http://www.springframework.org/schema/task
	    http://www.springframework.org/schema/task/spring-task.xsd
        http://www.springframework.org/schema/aop
		http://www.springframework.org/schema/aop/spring-aop.xsd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
	 <span class="token comment">&lt;!-- 这个类用来做需要完成的业务--&gt;</span>
<span class="token comment">&lt;!--     &lt;bean id="myJob" class="com.foxconn.ipebg.dpis.risk.scheduler.MyJob"&gt;&lt;/bean&gt; --&gt;</span>

    <span class="token comment">&lt;!-- 定时任务 --&gt;</span>
    <span class="token comment">&lt;!-- 定义调用对象和调用对象的方法，这个配置和普通的一样的,id是JobDetail的名字  --&gt;</span>
<span class="token comment">&lt;!--     &lt;bean id="jobtask" class="org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean"&gt; --&gt;</span>
<span class="token comment">&lt;!--         调用的类  --&gt;</span>
<span class="token comment">&lt;!--         &lt;property name="targetObject" ref="myJob" /&gt; --&gt;</span>
<span class="token comment">&lt;!--         调用类中的方法  --&gt;</span>
<span class="token comment">&lt;!--         &lt;property name="targetMethod" value="doNothing" /&gt; --&gt;</span>
<span class="token comment">&lt;!--         是否并发  --&gt;</span>
<span class="token comment">&lt;!--         &lt;property name ="concurrent" value ="false"  /&gt; --&gt;</span>
<span class="token comment">&lt;!--     &lt;/bean&gt; --&gt;</span>

    <span class="token comment">&lt;!-- 定义触发时间 ，这边就不同了，这里必须将时间设置成无限长，因为我们要去读取数据库的时间来做为定时器的触发时间--&gt;</span>
<span class="token comment">&lt;!--     &lt;bean id="cronTrigger" class="org.springframework.scheduling.quartz.CronTriggerFactoryBean "&gt; --&gt;</span>
<span class="token comment">&lt;!--         &lt;property name="jobDetail" ref="jobtask" /&gt; --&gt;</span>
<span class="token comment">&lt;!--         cron表达式  --&gt;</span>
<span class="token comment">&lt;!--         &lt;property name="cronExpression" value="0/1 * * * * ?" /&gt; --&gt;</span>
<span class="token comment">&lt;!--     &lt;/bean&gt; --&gt;</span>

    <span class="token comment">&lt;!-- 总管理类 如果将lazy-init='false'那么容器启动就会执行调度程序  --&gt;</span>
<span class="token comment">&lt;!--     &lt;bean id="startQuertz" class="org.springframework.scheduling.quartz.SchedulerFactoryBean"&gt; --&gt;</span>
<span class="token comment">&lt;!--         &lt;property name="triggers"&gt; --&gt;</span>
<span class="token comment">&lt;!--             &lt;list&gt; --&gt;</span>
<span class="token comment">&lt;!--                 &lt;ref bean="cronTrigger" /&gt; --&gt;</span>
<span class="token comment">&lt;!--             &lt;/list&gt; --&gt;</span>
<span class="token comment">&lt;!--         &lt;/property&gt; --&gt;</span>
<span class="token comment">&lt;!--     &lt;/bean&gt; --&gt;</span>

    <span class="token comment">&lt;!--这个类是用来设置触发时间的， startJobs方法启动调度容器，然后按照上面触发器每隔1s执行所配置的myJob2.doSomething()方法 --&gt;</span>
<span class="token comment">&lt;!--     &lt;bean id="quartzManager" class="com.foxconn.ipebg.dpis.risk.scheduler.QuartzManager" lazy-init="false" init-method="" &gt; --&gt;</span>
<span class="token comment">&lt;!--         这个对象一定要注入，这样类才能进行管理，还有在类型要用get set方法，不然会报错。 --&gt;</span>
<span class="token comment">&lt;!--          &lt;property name="scheduler" ref="startQuertz" /&gt; --&gt;</span>
<span class="token comment">&lt;!--     &lt;/bean&gt; --&gt;</span>

<span class="token comment">&lt;!-- 定时任务的factorybean,配置其他config --&gt;</span>
<span class="token comment">&lt;!-- 解决 implements Job 接口类 无法注入bean的问题--&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>jobFactory<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.lx.dpis.risk.scheduler.JobFactory<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>schedulerFactoryBean<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>org.springframework.scheduling.quartz.SchedulerFactoryBean<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>jobFactory<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>jobFactory<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h3><a id="2_69"></a>2.项目启动后开启所有可以执行的任务</h3> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RiskOjectScheduler</span> <span class="token keyword">implements</span> <span class="token class-name">ApplicationListener</span><span class="token generics function"><span class="token punctuation">&lt;</span>ContextRefreshedEvent<span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>

	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> RiskCheckTaskDao rctDao<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> QuartzManager qm<span class="token punctuation">;</span>
	
	
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String DEFAULT_JOBGROUPNAME <span class="token operator">=</span> <span class="token string">"risk_jobGroupName"</span><span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String DEFAULT_TRIGGERGROUPNAME <span class="token operator">=</span> <span class="token string">"risk_triggerGroupName"</span><span class="token punctuation">;</span>

	<span class="token comment">// //@PostConstruct</span>
	<span class="token comment">// public void initJobs() {<!-- --></span>
	<span class="token comment">// try {<!-- --></span>
	<span class="token comment">// @SuppressWarnings("unchecked")</span>
	<span class="token comment">// List&lt;RiskCheckTask&gt; taskList = rctDao.findAll(null);</span>
	<span class="token comment">// for (RiskCheckTask rct : taskList) {<!-- --></span>
	<span class="token comment">// qm.addJob(rct.getRcTaskId(), DEFAULT_JOBGROUPNAME, DEFAULT_TRIGGERNAME,</span>
	<span class="token comment">// DEFAULT_TRIGGERGROUPNAME,</span>
	<span class="token comment">// MyJob.class, rct.getCornExp(), rct.getRcTaskId());</span>
	<span class="token comment">// }</span>
	<span class="token comment">// } catch (Exception e) {<!-- --></span>
	<span class="token comment">// e.printStackTrace();</span>
	<span class="token comment">// }</span>
	<span class="token comment">// }</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onApplicationEvent</span><span class="token punctuation">(</span>ContextRefreshedEvent event<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">getApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

			<span class="token comment">// root application context 没有parent，他就是老大.</span>
			<span class="token comment">// 需要执行的逻辑代码，当spring容器初始化完成后就会执行该方法。</span>
			List<span class="token generics function"><span class="token punctuation">&lt;</span>RiskCheckTask<span class="token punctuation">&gt;</span></span> taskList <span class="token operator">=</span> rctDao<span class="token punctuation">.</span><span class="token function">findByProperty</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{<!-- --></span> <span class="token string">"executeFlag"</span><span class="token punctuation">,</span><span class="token string">"status"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{<!-- --></span> <span class="token string">"1"</span><span class="token punctuation">,</span><span class="token string">"1"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>taskList <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> taskList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">for</span> <span class="token punctuation">(</span>RiskCheckTask rct <span class="token operator">:</span> taskList<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					Date beginTime <span class="token operator">=</span> null<span class="token punctuation">;</span>
					Date endTime <span class="token operator">=</span> null<span class="token punctuation">;</span>
					String taskId <span class="token operator">=</span> rct<span class="token punctuation">.</span><span class="token function">getRcTaskId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">int</span> checkStyle  <span class="token operator">=</span> Integer<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>rct<span class="token punctuation">.</span><span class="token function">getCheckCycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					String checkStyleMode  <span class="token operator">=</span> rct<span class="token punctuation">.</span><span class="token function">getCheckCycleMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">int</span> repeatHour <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
					<span class="token keyword">switch</span> <span class="token punctuation">(</span>checkStyleMode<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
						<span class="token keyword">case</span> <span class="token string">"HOUR"</span><span class="token operator">:</span> repeatHour <span class="token operator">=</span> checkStyle<span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
						<span class="token keyword">case</span> <span class="token string">"DAY"</span><span class="token operator">:</span>repeatHour <span class="token operator">=</span> checkStyle<span class="token operator">*</span><span class="token number">24</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
						<span class="token keyword">case</span> <span class="token string">"MONTH"</span><span class="token operator">:</span>repeatHour <span class="token operator">=</span> checkStyle<span class="token operator">*</span><span class="token number">30</span><span class="token operator">*</span><span class="token number">24</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
						<span class="token keyword">case</span> <span class="token string">"WEEK"</span><span class="token operator">:</span>repeatHour <span class="token operator">=</span> checkStyle<span class="token operator">*</span><span class="token number">7</span><span class="token operator">*</span><span class="token number">24</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
						beginTime <span class="token operator">=</span> DateTool<span class="token punctuation">.</span><span class="token function">stringToDateByFormat</span><span class="token punctuation">(</span>rct<span class="token punctuation">.</span><span class="token function">getTaskBeginTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"yyyy-MM-dd HH:mm:ss"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						endTime <span class="token operator">=</span> DateTool<span class="token punctuation">.</span><span class="token function">stringToDateByFormat</span><span class="token punctuation">(</span>rct<span class="token punctuation">.</span><span class="token function">getTaskEndTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"yyyy-MM-dd HH:mm:ss"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
						e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					<span class="token comment">//List&lt;RiskInfo&gt; riskInfoList = rctDao.getRiskTaskRel(taskId);</span>
					qm<span class="token punctuation">.</span><span class="token function">addJobByInterval</span><span class="token punctuation">(</span>rct<span class="token punctuation">.</span><span class="token function">getRcTaskId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> DEFAULT_JOBGROUPNAME<span class="token punctuation">,</span> rct<span class="token punctuation">.</span><span class="token function">getRcTaskId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> DEFAULT_TRIGGERGROUPNAME<span class="token punctuation">,</span>
							RiskJob<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> taskId<span class="token punctuation">,</span>repeatHour<span class="token punctuation">,</span>beginTime<span class="token punctuation">,</span>endTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="3cron_134"></a>3.任务管理类包括按照cron表达式和时间间隔的方法</h3> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QuartzManager</span> <span class="token punctuation">{<!-- --></span>

	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> Scheduler scheduler<span class="token punctuation">;</span>
	
	<span class="token comment">/**
	 * 获取定时器调度实例
	 * 
	 * @return 实例对象
	 */</span>
	<span class="token comment">/*public static QuartzManager getInstance() {
		if (null == instance) {
			synchronized (QuartzManager.class) {
				if (null == instance) {
					instance = new QuartzManager();
				}
			}
		}
		return instance;
	}*/</span>

	<span class="token comment">/**
	 * 功能： 添加一个定时任务
	 * 
	 * @param jobName
	 *            任务名
	 * @param jobGroupName
	 *            任务组名
	 * @param triggerName
	 *            触发器名
	 * @param triggerGroupName
	 *            触发器组名
	 * @param jobClass
	 *            任务的类类型 eg:TimedMassJob.class
	 * @param cron
	 *            时间设置 表达式，参考quartz说明文档
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addJob</span><span class="token punctuation">(</span>String jobName<span class="token punctuation">,</span> String jobGroupName<span class="token punctuation">,</span> String triggerName<span class="token punctuation">,</span> String triggerGroupName<span class="token punctuation">,</span>
			Class<span class="token operator">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Job</span><span class="token operator">&gt;</span> jobClass<span class="token punctuation">,</span> String cron<span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> objects<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		
		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">//cfb.set</span>
			<span class="token comment">// 任务名，任务组，任务执行类</span>
			JobDetail jobDetail <span class="token operator">=</span> JobBuilder<span class="token punctuation">.</span><span class="token function">newJob</span><span class="token punctuation">(</span>jobClass<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span>jobName<span class="token punctuation">,</span> jobGroupName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 触发器</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>objects <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> objects<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					jobDetail<span class="token punctuation">.</span><span class="token function">getJobDataMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"data"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> objects<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			TriggerBuilder<span class="token generics function"><span class="token punctuation">&lt;</span>Trigger<span class="token punctuation">&gt;</span></span> triggerBuilder <span class="token operator">=</span> TriggerBuilder<span class="token punctuation">.</span><span class="token function">newTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 触发器名,触发器组</span>
			triggerBuilder<span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span>triggerName<span class="token punctuation">,</span> triggerGroupName<span class="token punctuation">)</span><span class="token punctuation">;</span>
			triggerBuilder<span class="token punctuation">.</span><span class="token function">startNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 触发器时间设定</span>
			triggerBuilder<span class="token punctuation">.</span><span class="token function">withSchedule</span><span class="token punctuation">(</span>CronScheduleBuilder<span class="token punctuation">.</span><span class="token function">cronSchedule</span><span class="token punctuation">(</span>cron<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 创建Trigger对象</span>
			CronTrigger trigger <span class="token operator">=</span> <span class="token punctuation">(</span>CronTrigger<span class="token punctuation">)</span> triggerBuilder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 调度容器设置JobDetail和Trigger</span>
			scheduler<span class="token punctuation">.</span><span class="token function">scheduleJob</span><span class="token punctuation">(</span>jobDetail<span class="token punctuation">,</span> trigger<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">/**
	 * 以時間間隔的方式添加任務
	 * @param jobName
	 * @param jobGroupName
	 * @param triggerName
	 * @param triggerGroupName
	 * @param jobClass
	 * @param objects
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addJobByInterval</span><span class="token punctuation">(</span>String jobName<span class="token punctuation">,</span> String jobGroupName<span class="token punctuation">,</span> String triggerName<span class="token punctuation">,</span> String triggerGroupName<span class="token punctuation">,</span>
			Class<span class="token operator">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Job</span><span class="token operator">&gt;</span> jobClass<span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> objects<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		
		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 任务名，任务组，任务执行类</span>
			JobDetail jobDetail <span class="token operator">=</span> JobBuilder<span class="token punctuation">.</span><span class="token function">newJob</span><span class="token punctuation">(</span>jobClass<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span>jobName<span class="token punctuation">,</span> jobGroupName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 触发器</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>objects <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> objects<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					jobDetail<span class="token punctuation">.</span><span class="token function">getJobDataMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"data"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> objects<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			TriggerBuilder<span class="token generics function"><span class="token punctuation">&lt;</span>Trigger<span class="token punctuation">&gt;</span></span> triggerBuilder <span class="token operator">=</span> TriggerBuilder<span class="token punctuation">.</span><span class="token function">newTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 触发器名,触发器组</span>
			triggerBuilder<span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span>triggerName<span class="token punctuation">,</span> triggerGroupName<span class="token punctuation">)</span><span class="token punctuation">;</span>
			triggerBuilder<span class="token punctuation">.</span><span class="token function">startNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 触发器时间设定</span>
			triggerBuilder<span class="token punctuation">.</span><span class="token function">withSchedule</span><span class="token punctuation">(</span>SimpleScheduleBuilder<span class="token punctuation">.</span><span class="token function">repeatHourlyForever</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>objects<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">//triggerBuilder.withSchedule(SimpleScheduleBuilder.repeatSecondlyForever((int)objects[1]));</span>
			<span class="token comment">// 创建Trigger对象</span>
			SimpleTriggerImpl trigger <span class="token operator">=</span>  <span class="token punctuation">(</span>SimpleTriggerImpl<span class="token punctuation">)</span> triggerBuilder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			trigger<span class="token punctuation">.</span><span class="token function">setStartTime</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Date<span class="token punctuation">)</span>objects<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			trigger<span class="token punctuation">.</span><span class="token function">setEndTime</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Date<span class="token punctuation">)</span>objects<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 调度容器设置JobDetail和Trigger</span>
			scheduler<span class="token punctuation">.</span><span class="token function">scheduleJob</span><span class="token punctuation">(</span>jobDetail<span class="token punctuation">,</span> trigger<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * 功能：修改一个任务的触发时间
	 * 
	 * @param jobName
	 * @param jobGroupName
	 * @param triggerName
	 *            触发器名
	 * @param triggerGroupName
	 *            触发器组名
	 * @param cron
	 *            时间设置，参考quartz说明文档
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">modifyJobTimeByInterval</span><span class="token punctuation">(</span>String jobName<span class="token punctuation">,</span> String jobGroupName<span class="token punctuation">,</span> String triggerName<span class="token punctuation">,</span> String triggerGroupName<span class="token punctuation">,</span>Object<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> objects<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">int</span> repeatHour<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> objects<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
			Date beginTime <span class="token operator">=</span> <span class="token punctuation">(</span>Date<span class="token punctuation">)</span> objects<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>endTime<span class="token operator">=</span><span class="token punctuation">(</span>Date<span class="token punctuation">)</span> objects<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
			TriggerKey triggerKey <span class="token operator">=</span> TriggerKey<span class="token punctuation">.</span><span class="token function">triggerKey</span><span class="token punctuation">(</span>triggerName<span class="token punctuation">,</span> triggerGroupName<span class="token punctuation">)</span><span class="token punctuation">;</span>
			SimpleTriggerImpl trigger <span class="token operator">=</span> <span class="token punctuation">(</span>SimpleTriggerImpl<span class="token punctuation">)</span> scheduler<span class="token punctuation">.</span><span class="token function">getTrigger</span><span class="token punctuation">(</span>triggerKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>trigger <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">long</span> repeatMi <span class="token operator">=</span> repeatHour<span class="token operator">*</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">1000</span><span class="token punctuation">;</span>
			<span class="token comment">//long repeatMi = repeatHour*1000;</span>
			Date oldBeginTime  <span class="token operator">=</span> trigger<span class="token punctuation">.</span><span class="token function">getStartTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>trigger<span class="token punctuation">.</span><span class="token function">getStartTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			Date oldEndTime <span class="token operator">=</span> trigger<span class="token punctuation">.</span><span class="token function">getEndTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">long</span> oldRepeatHour <span class="token operator">=</span> trigger<span class="token punctuation">.</span><span class="token function">getRepeatInterval</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>repeatMi<span class="token operator">!=</span>oldRepeatHour<span class="token operator">||</span><span class="token operator">!</span><span class="token punctuation">(</span>beginTime<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>oldBeginTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">||</span><span class="token operator">!</span><span class="token punctuation">(</span>endTime<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>oldEndTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
				<span class="token comment">// 触发器</span>
				TriggerBuilder<span class="token generics function"><span class="token punctuation">&lt;</span>Trigger<span class="token punctuation">&gt;</span></span> triggerBuilder <span class="token operator">=</span> TriggerBuilder<span class="token punctuation">.</span><span class="token function">newTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token comment">// 触发器名,触发器组</span>
				triggerBuilder<span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span>triggerName<span class="token punctuation">,</span> triggerGroupName<span class="token punctuation">)</span><span class="token punctuation">;</span>
				triggerBuilder<span class="token punctuation">.</span><span class="token function">startNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token comment">// 触发器时间设定</span>
				<span class="token comment">//triggerBuilder.withSchedule(SimpleScheduleBuilder.repeatSecondlyForever((int)objects[1]));</span>
				triggerBuilder<span class="token punctuation">.</span><span class="token function">withSchedule</span><span class="token punctuation">(</span>SimpleScheduleBuilder<span class="token punctuation">.</span><span class="token function">repeatHourlyForever</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> objects<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token comment">// 创建Trigger对象</span>
				trigger <span class="token operator">=</span> <span class="token punctuation">(</span>SimpleTriggerImpl<span class="token punctuation">)</span> triggerBuilder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				trigger<span class="token punctuation">.</span><span class="token function">setStartTime</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Date<span class="token punctuation">)</span>objects<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				trigger<span class="token punctuation">.</span><span class="token function">setEndTime</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Date<span class="token punctuation">)</span>objects<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token comment">// 方式一 ：修改一个任务的触发时间</span>
				scheduler<span class="token punctuation">.</span><span class="token function">rescheduleJob</span><span class="token punctuation">(</span>triggerKey<span class="token punctuation">,</span> trigger<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">modifyJobTime</span><span class="token punctuation">(</span>String jobName<span class="token punctuation">,</span> String jobGroupName<span class="token punctuation">,</span> String triggerName<span class="token punctuation">,</span> String triggerGroupName<span class="token punctuation">,</span>String cron<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			TriggerKey triggerKey <span class="token operator">=</span> TriggerKey<span class="token punctuation">.</span><span class="token function">triggerKey</span><span class="token punctuation">(</span>triggerName<span class="token punctuation">,</span> triggerGroupName<span class="token punctuation">)</span><span class="token punctuation">;</span>
			CronTrigger trigger <span class="token operator">=</span> <span class="token punctuation">(</span>CronTrigger<span class="token punctuation">)</span> scheduler<span class="token punctuation">.</span><span class="token function">getTrigger</span><span class="token punctuation">(</span>triggerKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>trigger <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			String oldTime <span class="token operator">=</span> trigger<span class="token punctuation">.</span><span class="token function">getCronExpression</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>oldTime<span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>cron<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token comment">// 触发器</span>
				TriggerBuilder<span class="token generics function"><span class="token punctuation">&lt;</span>Trigger<span class="token punctuation">&gt;</span></span> triggerBuilder <span class="token operator">=</span> TriggerBuilder<span class="token punctuation">.</span><span class="token function">newTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token comment">// 触发器名,触发器组</span>
				triggerBuilder<span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span>triggerName<span class="token punctuation">,</span> triggerGroupName<span class="token punctuation">)</span><span class="token punctuation">;</span>
				triggerBuilder<span class="token punctuation">.</span><span class="token function">startNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token comment">// 触发器时间设定</span>
				triggerBuilder<span class="token punctuation">.</span><span class="token function">withSchedule</span><span class="token punctuation">(</span>CronScheduleBuilder<span class="token punctuation">.</span><span class="token function">cronSchedule</span><span class="token punctuation">(</span>cron<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token comment">// 创建Trigger对象</span>
				trigger <span class="token operator">=</span> <span class="token punctuation">(</span>CronTrigger<span class="token punctuation">)</span> triggerBuilder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token comment">// 方式一 ：修改一个任务的触发时间</span>
				scheduler<span class="token punctuation">.</span><span class="token function">rescheduleJob</span><span class="token punctuation">(</span>triggerKey<span class="token punctuation">,</span> trigger<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * 功能: 移除一个任务
	 * 
	 * @param jobName
	 * @param jobGroupName
	 * @param triggerName
	 * @param triggerGroupName
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">removeJob</span><span class="token punctuation">(</span>String jobName<span class="token punctuation">,</span> String jobGroupName<span class="token punctuation">,</span> String triggerName<span class="token punctuation">,</span> String triggerGroupName<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			TriggerKey triggerKey <span class="token operator">=</span> TriggerKey<span class="token punctuation">.</span><span class="token function">triggerKey</span><span class="token punctuation">(</span>triggerName<span class="token punctuation">,</span> triggerGroupName<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 停止触发器</span>
			scheduler<span class="token punctuation">.</span><span class="token function">pauseTrigger</span><span class="token punctuation">(</span>triggerKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 移除触发器</span>
			scheduler<span class="token punctuation">.</span><span class="token function">unscheduleJob</span><span class="token punctuation">(</span>triggerKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 删除任务</span>
			scheduler<span class="token punctuation">.</span><span class="token function">deleteJob</span><span class="token punctuation">(</span>JobKey<span class="token punctuation">.</span><span class="token function">jobKey</span><span class="token punctuation">(</span>jobName<span class="token punctuation">,</span> jobGroupName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">/**
	 * @Description:暂停一个任务
	 * @param jobName
	 * @param jobGroupName
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pauseJob</span><span class="token punctuation">(</span>String jobName<span class="token punctuation">,</span> String jobGroupName<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		JobKey jobKey <span class="token operator">=</span> JobKey<span class="token punctuation">.</span><span class="token function">jobKey</span><span class="token punctuation">(</span>jobName<span class="token punctuation">,</span> jobGroupName<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			scheduler<span class="token punctuation">.</span><span class="token function">pauseJob</span><span class="token punctuation">(</span>jobKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SchedulerException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">/**
	 * @Description:恢复一个任务
	 * @param jobName
	 * @param jobGroupName
	 * @date 2018年5月17日 上午9:56:09
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">resumeJob</span><span class="token punctuation">(</span>String jobName<span class="token punctuation">,</span> String jobGroupName<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		JobKey jobKey <span class="token operator">=</span> JobKey<span class="token punctuation">.</span><span class="token function">jobKey</span><span class="token punctuation">(</span>jobName<span class="token punctuation">,</span> jobGroupName<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			scheduler<span class="token punctuation">.</span><span class="token function">resumeJob</span><span class="token punctuation">(</span>jobKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SchedulerException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>




	<span class="token comment">/**
	 * 
	 * 功能：启动所有定时任务
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">startJobs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>scheduler<span class="token punctuation">.</span><span class="token function">isStarted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"定时器已启动。"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
				scheduler<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SchedulerException</span> e1<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			e1<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * 功能：关闭所有定时任务
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">shutdownJobs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>scheduler<span class="token punctuation">.</span><span class="token function">isShutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				scheduler<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SchedulerException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">public</span> <span class="token keyword">static</span> List<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> <span class="token function">getRecentTriggerTime</span><span class="token punctuation">(</span>String cron<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		List<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			CronTriggerImpl cronTriggerImpl <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CronTriggerImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			cronTriggerImpl<span class="token punctuation">.</span><span class="token function">setCronExpression</span><span class="token punctuation">(</span>cron<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 这个是重点，一行代码搞定</span>
			List<span class="token generics function"><span class="token punctuation">&lt;</span>Date<span class="token punctuation">&gt;</span></span> dates <span class="token operator">=</span> TriggerUtils<span class="token punctuation">.</span><span class="token function">computeFireTimes</span><span class="token punctuation">(</span>cronTriggerImpl<span class="token punctuation">,</span> null<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			SimpleDateFormat dateFormat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd HH:mm:ss"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span>Date date <span class="token operator">:</span> dates<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>dateFormat<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ParseException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> list<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="4Job_bean__sessionFactorydao_418"></a>4.在实现Job接口的类中 无法注入bean 比如sessionFactory或者查询数据库的dao</h3> 
<h4><a id="_AdaptableJobFactory_419"></a>第一种方法 继承AdaptableJobFactory</h4> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JobFactory</span> <span class="token keyword">extends</span> <span class="token class-name">AdaptableJobFactory</span><span class="token punctuation">{<!-- --></span>
	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> AutowireCapableBeanFactory capableBeanFactory<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">protected</span> Object <span class="token function">createJobInstance</span><span class="token punctuation">(</span>TriggerFiredBundle bundle<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{<!-- --></span>
		<span class="token comment">//调用父类的方法</span>
	    Object jobInstance <span class="token operator">=</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">createJobInstance</span><span class="token punctuation">(</span>bundle<span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token comment">//进行注入</span>
	    capableBeanFactory<span class="token punctuation">.</span><span class="token function">autowireBean</span><span class="token punctuation">(</span>jobInstance<span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token keyword">return</span> jobInstance<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="_springApplicationContext_436"></a>第二种方法 获取spring的ApplicationContext(又分为两种)</h4> 
<p>网上查询方法未测试</p> 
<h5><a id="_438"></a>①</h5> 
<p>1.applicationContext-quartz.xml</p> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="token doctype">&lt;!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN 2.0//EN" "http://www.springframework.org/dtd/spring-beans-2.0.dtd"&gt;</span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>quartzScheduler<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>org.springframework.scheduling.quartz.SchedulerFactoryBean<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>applicationContextSchedulerContextKey<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>applicationContextKey<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>configLocation<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>classpath:quartz.properties<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>2.对应的job任务获取ApplicationContext</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QuartzJobBean</span> <span class="token keyword">implements</span> <span class="token class-name">Job</span> <span class="token punctuation">{<!-- --></span>


	<span class="token comment">/* (non-Javadoc)
	 * @see org.quartz.Job#execute(org.quartz.JobExecutionContext)
	 */</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span>JobExecutionContext jobContext<span class="token punctuation">)</span> <span class="token keyword">throws</span> JobExecutionException <span class="token punctuation">{<!-- --></span>
		
		
		String jobId <span class="token operator">=</span> jobContext<span class="token punctuation">.</span><span class="token function">getJobDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		String serviceId <span class="token operator">=</span> jobContext<span class="token punctuation">.</span><span class="token function">getTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		

		ApplicationContext applicationContext<span class="token operator">=</span>null<span class="token punctuation">;</span>
		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			applicationContext<span class="token operator">=</span><span class="token function">getApplicationContext</span><span class="token punctuation">(</span>jobContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// TODO Auto-generated catch block</span>
			e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		WebServiceService webServiceService <span class="token operator">=</span> <span class="token punctuation">(</span>WebServiceService<span class="token punctuation">)</span> applicationContext<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"webServiceService"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		WebServicePOJO  webService <span class="token operator">=</span> webServiceService<span class="token punctuation">.</span><span class="token function">getWebService</span><span class="token punctuation">(</span>serviceId<span class="token punctuation">)</span><span class="token punctuation">;</span>
		ScheduleService<span class="token punctuation">.</span><span class="token function">schedule</span><span class="token punctuation">(</span>webService<span class="token punctuation">.</span><span class="token function">getNameSpace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> webService<span class="token punctuation">.</span><span class="token function">getServiceName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> webService<span class="token punctuation">.</span><span class="token function">getWsdlURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> webService<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String APPLICATION_CONTEXT_KEY <span class="token operator">=</span> <span class="token string">"applicationContextKey"</span><span class="token punctuation">;</span>
	<span class="token keyword">private</span> ApplicationContext <span class="token function">getApplicationContext</span><span class="token punctuation">(</span>JobExecutionContext context<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{<!-- --></span>
			ApplicationContext appCtx <span class="token operator">=</span> null<span class="token punctuation">;</span>
			appCtx <span class="token operator">=</span> <span class="token punctuation">(</span>ApplicationContext<span class="token punctuation">)</span> context<span class="token punctuation">.</span><span class="token function">getScheduler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>APPLICATION_CONTEXT_KEY<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>appCtx <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">JobExecutionException</span><span class="token punctuation">(</span><span class="token string">"No application context available in scheduler context for key \""</span> <span class="token operator">+</span> APPLICATION_CONTEXT_KEY <span class="token operator">+</span> <span class="token string">"\""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> appCtx<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>


<span class="token punctuation">}</span>
</code></pre> 
<p>详细查看<a href="https://www.tuicool.com/articles/jyuEbi" rel="nofollow">https://www.tuicool.com/articles/jyuEbi</a></p> 
<h5><a id="_494"></a>②</h5> 
<pre><code class="prism language-java"><span class="token comment">//在定时任务里面获取sessionFactory，然后OpenSession，执行完成后关闭：</span>
WebApplicationContext wac <span class="token operator">=</span> ContextLoader<span class="token punctuation">.</span><span class="token function">getCurrentWebApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
SessionFactory factory<span class="token operator">=</span>wac<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span>SessionFactory<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Session session<span class="token operator">=</span>factory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Query query <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span><span class="token string">"from User"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
List<span class="token generics function"><span class="token punctuation">&lt;</span>User<span class="token punctuation">&gt;</span></span> userlist<span class="token operator">=</span>query<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
session<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="5Job_504"></a>5.Job实现类(业务逻辑)</h4> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RiskJob</span> <span class="token keyword">implements</span> <span class="token class-name">Job</span> <span class="token punctuation">{<!-- --></span>
	
	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> SessionFactory sf<span class="token punctuation">;</span><span class="token comment">//此处使用@Autowired注入需要用到配置文件JobFactory类</span>
	
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String DEFAULT_JOBGROUPNAME <span class="token operator">=</span> <span class="token string">"risk_jobGroupName"</span><span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String DEFAULT_TRIGGERGROUPNAME <span class="token operator">=</span> <span class="token string">"risk_triggerGroupName"</span><span class="token punctuation">;</span>
	
	<span class="token comment">//Job实现类 此处需要使用openSession,使用getCurrentSession会报错Could not obtain transaction-synchronized Session for current thread</span>
	<span class="token comment">//原因是因为从定时任务调用时会启动一个新的线程，而Hibernate和Spring集成Session是绑定到thread上面的。</span>
	<span class="token keyword">public</span> Session <span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> sf<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token string">"rawtypes"</span><span class="token punctuation">,</span>  <span class="token string">"unchecked"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span>JobExecutionContext context<span class="token punctuation">)</span> <span class="token keyword">throws</span> JobExecutionException <span class="token punctuation">{<!-- --></span>
		System<span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"任務運行開始-------- start --------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		Session session <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			String taskId <span class="token operator">=</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span> context<span class="token punctuation">.</span><span class="token function">getJobDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getJobDataMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"data1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			Date scheduledFireTime <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getScheduledFireTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			Date nextFireTime <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getNextFireTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			StringBuffer sql <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span>
					<span class="token string">"SELECT rct.rc_task_id AS rcTaskId, rct.RC_TASK_NAME AS rcTaskName, rct.EXECUTOR_NO AS executorNo, rct.EXECUTOR AS executor, rct.cronExp, rct.TASK_BEGIN_TIME AS taskBeginTime, rct.TASK_END_TIME AS taskEndTime, rto.RISK_OBJECT_ID AS riskObjectId FROM dp_risk_check_task rct, dp_rc_task_obj_rel rto, dp_risk_object ro WHERE rct.RC_TASK_ID = rto.RC_TASK_ID AND rto.RISK_OBJECT_ID = ro.id AND ro.ISVALID='1' AND ro.STATUS='1' AND rct.STATUS = '1' AND rto.STATUS = '1' "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>taskId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				sql<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">" and rct.rc_task_id ='"</span> <span class="token operator">+</span> taskId <span class="token operator">+</span> <span class="token string">"'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			
			Query s <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">createSQLQuery</span><span class="token punctuation">(</span>sql<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			
			s<span class="token punctuation">.</span><span class="token function">setResultTransformer</span><span class="token punctuation">(</span>Transformers<span class="token punctuation">.</span><span class="token function">aliasToBean</span><span class="token punctuation">(</span>RiskInfo<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			List<span class="token generics function"><span class="token punctuation">&lt;</span>RiskInfo<span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>list<span class="token operator">!=</span>null<span class="token operator">&amp;&amp;</span>list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
				<span class="token keyword">for</span> <span class="token punctuation">(</span>RiskInfo ri <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					RiskCheckRecord rr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RiskCheckRecord</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					rr<span class="token punctuation">.</span><span class="token function">setRcRecordId</span><span class="token punctuation">(</span>UUIDUtil<span class="token punctuation">.</span><span class="token function">uuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					rr<span class="token punctuation">.</span><span class="token function">setRcTaskId</span><span class="token punctuation">(</span>ri<span class="token punctuation">.</span><span class="token function">getRcTaskId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					rr<span class="token punctuation">.</span><span class="token function">setRiskObjectId</span><span class="token punctuation">(</span>ri<span class="token punctuation">.</span><span class="token function">getRiskObjectId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					rr<span class="token punctuation">.</span><span class="token function">setExecutorNo</span><span class="token punctuation">(</span>ri<span class="token punctuation">.</span><span class="token function">getExecutorNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					rr<span class="token punctuation">.</span><span class="token function">setExecutor</span><span class="token punctuation">(</span>ri<span class="token punctuation">.</span><span class="token function">getExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					rr<span class="token punctuation">.</span><span class="token function">setBeginTime</span><span class="token punctuation">(</span>DateTool<span class="token punctuation">.</span><span class="token function">dateToString</span><span class="token punctuation">(</span>scheduledFireTime<span class="token punctuation">,</span> <span class="token string">"yyyy-MM-dd HH:mm:ss"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					rr<span class="token punctuation">.</span><span class="token function">setEndTime</span><span class="token punctuation">(</span>DateTool<span class="token punctuation">.</span><span class="token function">dateToString</span><span class="token punctuation">(</span>nextFireTime<span class="token punctuation">,</span> <span class="token string">"yyyy-MM-dd HH:mm:ss"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					rr<span class="token punctuation">.</span><span class="token function">setCheckStatus</span><span class="token punctuation">(</span><span class="token string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					rr<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					rr<span class="token punctuation">.</span><span class="token function">setCreatorNo</span><span class="token punctuation">(</span><span class="token string">"sys"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					rr<span class="token punctuation">.</span><span class="token function">setCreator</span><span class="token punctuation">(</span><span class="token string">"管理員"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					rr<span class="token punctuation">.</span><span class="token function">setCreateDate</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					session<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>rr<span class="token punctuation">)</span><span class="token punctuation">;</span>
					session<span class="token punctuation">.</span><span class="token function">beginTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			
			<span class="token comment">//String jobName = context.getJobDetail().getKey().getName();</span>
			<span class="token comment">//String jobGroup = context.getJobDetail().getKey().getGroup();</span>
			<span class="token comment">// String triggerName = context.getTrigger().getKey().getName();</span>
			<span class="token comment">// String triggerGroup = context.getTrigger().getKey().getGroup();</span>

			<span class="token comment">/*SimpleDateFormat dateFormat = new SimpleDateFormat("yyyy年MM月dd日 HH時mm分ss秒");
			System.out.println("任務Key:" + jobName + ".." + jobGroup + " 正在執行，執行時間: "
					+ dateFormat.format(Calendar.getInstance().getTime()));*/</span>

		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"捕獲異常==="</span> <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
			e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
			session<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		System<span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"任務運行結束-------- end --------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token punctuation">}</span>
	

<span class="token punctuation">}</span>

</code></pre> 
<h4><a id="6_582"></a>6.前台管理任务页面(新增,修改,删除任务)</h4> 
<h5><a id="_583"></a>添加任务</h5> 
<pre><code class="prism language-java"><span class="token comment">//添加任務</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">,</span> rct<span class="token punctuation">.</span><span class="token function">getExecuteFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
			qm<span class="token punctuation">.</span><span class="token function">addJobByInterval</span><span class="token punctuation">(</span>rcTaskId<span class="token punctuation">,</span> DEFAULT_JOBGROUPNAME<span class="token punctuation">,</span> rcTaskId<span class="token punctuation">,</span> DEFAULT_TRIGGERGROUPNAME<span class="token punctuation">,</span>
					RiskJob<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>rcTaskId<span class="token punctuation">,</span>repeatHour<span class="token punctuation">,</span>beginTime<span class="token punctuation">,</span>endTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="_591"></a>修改任务</h5> 
<pre><code class="prism language-java"><span class="token keyword">if</span><span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>exectueFlagBefore<span class="token punctuation">,</span> <span class="token string">"1"</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span>StringUtils<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>exectueFlagAfter<span class="token punctuation">,</span> <span class="token string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
			qm<span class="token punctuation">.</span><span class="token function">removeJob</span><span class="token punctuation">(</span>rct<span class="token punctuation">.</span><span class="token function">getRcTaskId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> DEFAULT_JOBGROUPNAME<span class="token punctuation">,</span> rct<span class="token punctuation">.</span><span class="token function">getRcTaskId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> DEFAULT_TRIGGERGROUPNAME<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>exectueFlagBefore<span class="token punctuation">,</span> <span class="token string">"0"</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span>StringUtils<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>exectueFlagAfter<span class="token punctuation">,</span> <span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
			qm<span class="token punctuation">.</span><span class="token function">addJobByInterval</span><span class="token punctuation">(</span>rct<span class="token punctuation">.</span><span class="token function">getRcTaskId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> DEFAULT_JOBGROUPNAME<span class="token punctuation">,</span> rct<span class="token punctuation">.</span><span class="token function">getRcTaskId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> DEFAULT_TRIGGERGROUPNAME<span class="token punctuation">,</span>
					RiskJob<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> rct<span class="token punctuation">.</span><span class="token function">getRcTaskId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>repeatHour<span class="token punctuation">,</span>beginTime<span class="token punctuation">,</span>endTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>exectueFlagBefore<span class="token punctuation">,</span> exectueFlagAfter<span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span>StringUtils<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>exectueFlagBefore<span class="token punctuation">,</span> <span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
			qm<span class="token punctuation">.</span><span class="token function">modifyJobTimeByInterval</span><span class="token punctuation">(</span>rct<span class="token punctuation">.</span><span class="token function">getRcTaskId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> DEFAULT_JOBGROUPNAME<span class="token punctuation">,</span> rct<span class="token punctuation">.</span><span class="token function">getRcTaskId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> DEFAULT_TRIGGERGROUPNAME<span class="token punctuation">,</span> rct<span class="token punctuation">.</span><span class="token function">getRcTaskId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>repeatHour<span class="token punctuation">,</span>beginTime<span class="token punctuation">,</span>endTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
</code></pre> 
<p>添加修改任务后每个任务都会调用<mark>Job实现类</mark>的<mark>execute</mark>方法</p> 
<p><strong>该教程实现本人项目的功能</strong></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b9c7bd7d973bd048d8f8b03712197711/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">高速PCB设计软件allegro中与网络有关的约束规则设置</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/48802d18f3576d8752c09cebd2b193a2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">SQL LeetCode刷题系列（九）——体育馆的人流量</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>