<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Docker容器 - 实现MySQL主从复制 &#43; 读写分离（Docker &#43; MySQL &#43; MyCat） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Docker容器 - 实现MySQL主从复制 &#43; 读写分离（Docker &#43; MySQL &#43; MyCat）" />
<meta property="og:description" content="目录
一、主从复制 新建主服务器容器实例3307
进入/mydata/mysql-master/conf新建my.cnf
修改完配置后重启master实例
进入mysql-master容器
master容器实例内创建数据同步用户
新建从服务器容器实例3308
进入/mydata/mysql-slave/conf新建my.cnf
修改完配置后重启slave实例
在主数据库中查看主从同步状态
进入mysql-slave容器
在从数据库中配置主从复制
在从数据库中查看主从同步状态
在从数据库中开启主从同步
再次查看从数据库状态
二、主从复制测试
主数据库
从数据库
三、读写分离
Docker安装MyCat
server.xml schema.xml sequence_conf.properties rule.xml
运行容器
容器中安装JDK
连接测试
使用Docker安装MySQL5.7的详细文章：Linux中使用Docker安装MySQL5.7（CentOS7）_不会调制解调的猫的博客-CSDN博客
一、主从复制 新建主服务器容器实例3307 这里就算没有拉取mysql5.7的镜像也可以直接运行，若发现没有镜像则会直接自动拉取。
这里的-v如果不懂，也可以查看之前的容器数据卷详解：Docker容器数据卷_不会调制解调的猫的博客-CSDN博客
docker run -p 3307:3306 --name mysql-master -v /mydata/mysql-master/log:/var/log/mysql -v /mydata/mysql-master/data:/var/lib/mysql -v /mydata/mysql-master/conf:/etc/mysql -e MYSQL_ROOT_PASSWORD=root -d mysql:5.7 ps查看一下，确认它起来了
docker ps 进入/mydata/mysql-master/conf新建my.cnf vim /mydata/mysql-master/conf/my.cnf 直接把以下内容全部复制粘贴进去，然后保存退出。 [mysqld] ## 设置server_id，同一局域网中需要唯一 server_id=101 ## 指定不需要同步的数据库名称 binlog-ignore-db=mysql ## 开启二进制日志功能 log-bin=mall-mysql-bin ## 设置二进制日志使用内存大小（事务） binlog_cache_size=1M ## 设置使用的二进制日志格式（mixed,statement,row） binlog_format=mixed ## 二进制日志过期清理时间。默认值为0，表示不自动清理。 expire_logs_days=7 ## 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断。 ## 如：1062错误是指一些主键重复，1032错误是因为主从数据库数据不一致 slave_skip_errors=1062 修改完配置后重启master实例 在宿主机上通过容器数据卷来修改配置，传导给docker内部，是需要重启的" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/423a4e8885fca91f91210e03a3d14f69/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-10-09T19:44:01+08:00" />
<meta property="article:modified_time" content="2022-10-09T19:44:01+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Docker容器 - 实现MySQL主从复制 &#43; 读写分离（Docker &#43; MySQL &#43; MyCat）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="%E4%B8%80%E3%80%81%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%C2%A0-toc" style="margin-left:0px;"><a href="#%E4%B8%80%E3%80%81%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%C2%A0" rel="nofollow">一、主从复制 </a></p> 
<p id="%E6%96%B0%E5%BB%BA%E4%B8%BB%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%B9%E5%99%A8%E5%AE%9E%E4%BE%8B3307-toc" style="margin-left:40px;"><a href="#%E6%96%B0%E5%BB%BA%E4%B8%BB%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%B9%E5%99%A8%E5%AE%9E%E4%BE%8B3307" rel="nofollow">新建主服务器容器实例3307</a></p> 
<p id="%E8%BF%9B%E5%85%A5%2Fmydata%2Fmysql-master%2Fconf%E6%96%B0%E5%BB%BAmy.cnf-toc" style="margin-left:40px;"><a href="#%E8%BF%9B%E5%85%A5%2Fmydata%2Fmysql-master%2Fconf%E6%96%B0%E5%BB%BAmy.cnf" rel="nofollow">进入/mydata/mysql-master/conf新建my.cnf</a></p> 
<p id="%E4%BF%AE%E6%94%B9%E5%AE%8C%E9%85%8D%E7%BD%AE%E5%90%8E%E9%87%8D%E5%90%AFmaster%E5%AE%9E%E4%BE%8B-toc" style="margin-left:40px;"><a href="#%E4%BF%AE%E6%94%B9%E5%AE%8C%E9%85%8D%E7%BD%AE%E5%90%8E%E9%87%8D%E5%90%AFmaster%E5%AE%9E%E4%BE%8B" rel="nofollow">修改完配置后重启master实例</a></p> 
<p id="%E8%BF%9B%E5%85%A5mysql-master%E5%AE%B9%E5%99%A8-toc" style="margin-left:40px;"><a href="#%E8%BF%9B%E5%85%A5mysql-master%E5%AE%B9%E5%99%A8" rel="nofollow">进入mysql-master容器</a></p> 
<p id="master%E5%AE%B9%E5%99%A8%E5%AE%9E%E4%BE%8B%E5%86%85%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5%E7%94%A8%E6%88%B7-toc" style="margin-left:40px;"><a href="#master%E5%AE%B9%E5%99%A8%E5%AE%9E%E4%BE%8B%E5%86%85%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5%E7%94%A8%E6%88%B7" rel="nofollow">master容器实例内创建数据同步用户</a></p> 
<p id="%E6%96%B0%E5%BB%BA%E4%BB%8E%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%B9%E5%99%A8%E5%AE%9E%E4%BE%8B3308-toc" style="margin-left:40px;"><a href="#%E6%96%B0%E5%BB%BA%E4%BB%8E%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%B9%E5%99%A8%E5%AE%9E%E4%BE%8B3308" rel="nofollow">新建从服务器容器实例3308</a></p> 
<p id="%E8%BF%9B%E5%85%A5%2Fmydata%2Fmysql-slave%2Fconf%E6%96%B0%E5%BB%BAmy.cnf-toc" style="margin-left:40px;"><a href="#%E8%BF%9B%E5%85%A5%2Fmydata%2Fmysql-slave%2Fconf%E6%96%B0%E5%BB%BAmy.cnf" rel="nofollow">进入/mydata/mysql-slave/conf新建my.cnf</a></p> 
<p id="%E4%BF%AE%E6%94%B9%E5%AE%8C%E9%85%8D%E7%BD%AE%E5%90%8E%E9%87%8D%E5%90%AFslave%E5%AE%9E%E4%BE%8B-toc" style="margin-left:40px;"><a href="#%E4%BF%AE%E6%94%B9%E5%AE%8C%E9%85%8D%E7%BD%AE%E5%90%8E%E9%87%8D%E5%90%AFslave%E5%AE%9E%E4%BE%8B" rel="nofollow">修改完配置后重启slave实例</a></p> 
<p id="%E5%9C%A8%E4%B8%BB%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E6%9F%A5%E7%9C%8B%E4%B8%BB%E4%BB%8E%E5%90%8C%E6%AD%A5%E7%8A%B6%E6%80%81-toc" style="margin-left:40px;"><a href="#%E5%9C%A8%E4%B8%BB%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E6%9F%A5%E7%9C%8B%E4%B8%BB%E4%BB%8E%E5%90%8C%E6%AD%A5%E7%8A%B6%E6%80%81" rel="nofollow">在主数据库中查看主从同步状态</a></p> 
<p id="%E8%BF%9B%E5%85%A5mysql-slave%E5%AE%B9%E5%99%A8-toc" style="margin-left:40px;"><a href="#%E8%BF%9B%E5%85%A5mysql-slave%E5%AE%B9%E5%99%A8" rel="nofollow">进入mysql-slave容器</a></p> 
<p id="%E5%9C%A8%E4%BB%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E9%85%8D%E7%BD%AE%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6-toc" style="margin-left:40px;"><a href="#%E5%9C%A8%E4%BB%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E9%85%8D%E7%BD%AE%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6" rel="nofollow">在从数据库中配置主从复制</a></p> 
<p id="%E5%9C%A8%E4%BB%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E6%9F%A5%E7%9C%8B%E4%B8%BB%E4%BB%8E%E5%90%8C%E6%AD%A5%E7%8A%B6%E6%80%81-toc" style="margin-left:40px;"><a href="#%E5%9C%A8%E4%BB%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E6%9F%A5%E7%9C%8B%E4%B8%BB%E4%BB%8E%E5%90%8C%E6%AD%A5%E7%8A%B6%E6%80%81" rel="nofollow">在从数据库中查看主从同步状态</a></p> 
<p id="%E5%9C%A8%E4%BB%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E5%BC%80%E5%90%AF%E4%B8%BB%E4%BB%8E%E5%90%8C%E6%AD%A5-toc" style="margin-left:40px;"><a href="#%E5%9C%A8%E4%BB%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E5%BC%80%E5%90%AF%E4%B8%BB%E4%BB%8E%E5%90%8C%E6%AD%A5" rel="nofollow">在从数据库中开启主从同步</a></p> 
<p id="%E5%86%8D%E6%AC%A1%E6%9F%A5%E7%9C%8B%E4%BB%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E7%8A%B6%E6%80%81-toc" style="margin-left:40px;"><a href="#%E5%86%8D%E6%AC%A1%E6%9F%A5%E7%9C%8B%E4%BB%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E7%8A%B6%E6%80%81" rel="nofollow">再次查看从数据库状态</a></p> 
<p id="%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E6%B5%8B%E8%AF%95-toc" style="margin-left:0px;"><a href="#%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E6%B5%8B%E8%AF%95" rel="nofollow">二、主从复制测试</a></p> 
<p id="%E4%B8%BB%E6%95%B0%E6%8D%AE%E5%BA%93-toc" style="margin-left:40px;"><a href="#%E4%B8%BB%E6%95%B0%E6%8D%AE%E5%BA%93" rel="nofollow">主数据库</a></p> 
<p id="%E4%BB%8E%E6%95%B0%E6%8D%AE%E5%BA%93-toc" style="margin-left:40px;"><a href="#%E4%BB%8E%E6%95%B0%E6%8D%AE%E5%BA%93" rel="nofollow">从数据库</a></p> 
<p id="%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB-toc" style="margin-left:0px;"><a href="#%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB" rel="nofollow">三、读写分离</a></p> 
<p id="Docker%E5%AE%89%E8%A3%85MyCat-toc" style="margin-left:40px;"><a href="#Docker%E5%AE%89%E8%A3%85MyCat" rel="nofollow">Docker安装MyCat</a></p> 
<p id="server.xml%C2%A0-toc" style="margin-left:40px;"><a href="#server.xml%C2%A0" rel="nofollow">server.xml </a></p> 
<p id="schema.xml%C2%A0-toc" style="margin-left:40px;"><a href="#schema.xml%C2%A0" rel="nofollow">schema.xml </a></p> 
<p id="sequence_conf.properties%C2%A0-toc" style="margin-left:40px;"><a href="#sequence_conf.properties%C2%A0" rel="nofollow">sequence_conf.properties </a></p> 
<p id="rule.xml-toc" style="margin-left:40px;"><a href="#rule.xml" rel="nofollow">rule.xml</a></p> 
<p id="%E8%BF%90%E8%A1%8C%E5%AE%B9%E5%99%A8-toc" style="margin-left:40px;"><a href="#%E8%BF%90%E8%A1%8C%E5%AE%B9%E5%99%A8" rel="nofollow">运行容器</a></p> 
<p id="%E5%AE%B9%E5%99%A8%E4%B8%AD%E5%AE%89%E8%A3%85JDK-toc" style="margin-left:40px;"><a href="#%E5%AE%B9%E5%99%A8%E4%B8%AD%E5%AE%89%E8%A3%85JDK" rel="nofollow">容器中安装JDK</a></p> 
<p id="%E8%BF%9E%E6%8E%A5%E6%B5%8B%E8%AF%95-toc" style="margin-left:40px;"><a href="#%E8%BF%9E%E6%8E%A5%E6%B5%8B%E8%AF%95" rel="nofollow">连接测试</a></p> 
<hr id="hr-toc"> 
<p></p> 
<p>使用Docker安装MySQL5.7的详细文章：<a href="https://blog.csdn.net/Trollz/article/details/125503717" title="Linux中使用Docker安装MySQL5.7（CentOS7）_不会调制解调的猫的博客-CSDN博客">Linux中使用Docker安装MySQL5.7（CentOS7）_不会调制解调的猫的博客-CSDN博客</a></p> 
<h2 id="%E4%B8%80%E3%80%81%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%C2%A0">一、主从复制 </h2> 
<h3 id="%E6%96%B0%E5%BB%BA%E4%B8%BB%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%B9%E5%99%A8%E5%AE%9E%E4%BE%8B3307">新建主服务器容器实例3307</h3> 
<p>这里就算没有拉取mysql5.7的镜像也可以直接运行，若发现没有镜像则会直接自动拉取。</p> 
<p>这里的-v如果不懂，也可以查看之前的容器数据卷详解：<a href="https://blog.csdn.net/Trollz/article/details/125871219?spm=1001.2014.3001.5502" title="Docker容器数据卷_不会调制解调的猫的博客-CSDN博客">Docker容器数据卷_不会调制解调的猫的博客-CSDN博客</a></p> 
<pre><code>docker run -p 3307:3306 --name mysql-master -v /mydata/mysql-master/log:/var/log/mysql -v /mydata/mysql-master/data:/var/lib/mysql -v /mydata/mysql-master/conf:/etc/mysql -e MYSQL_ROOT_PASSWORD=root -d mysql:5.7</code></pre> 
<p class="img-center"><img alt="" height="92" src="https://images2.imgbox.com/2f/f5/RzSS3XTH_o.png" width="1000"></p> 
<p> ps查看一下，确认它起来了</p> 
<pre><code>docker ps</code></pre> 
<p class="img-center"><img alt="" height="55" src="https://images2.imgbox.com/d7/1b/T8GY6DB1_o.png" width="1000"></p> 
<hr> 
<p></p> 
<h3 id="%E8%BF%9B%E5%85%A5%2Fmydata%2Fmysql-master%2Fconf%E6%96%B0%E5%BB%BAmy.cnf">进入/mydata/mysql-master/conf新建my.cnf</h3> 
<pre><code>vim /mydata/mysql-master/conf/my.cnf</code></pre> 
<p>直接把以下内容全部复制粘贴进去，然后保存退出。 </p> 
<pre><code>[mysqld]
## 设置server_id，同一局域网中需要唯一
server_id=101 
## 指定不需要同步的数据库名称
binlog-ignore-db=mysql  
## 开启二进制日志功能
log-bin=mall-mysql-bin  
## 设置二进制日志使用内存大小（事务）
binlog_cache_size=1M  
## 设置使用的二进制日志格式（mixed,statement,row）
binlog_format=mixed  
## 二进制日志过期清理时间。默认值为0，表示不自动清理。
expire_logs_days=7  
## 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断。
## 如：1062错误是指一些主键重复，1032错误是因为主从数据库数据不一致
slave_skip_errors=1062</code></pre> 
<hr> 
<p></p> 
<h3 id="%E4%BF%AE%E6%94%B9%E5%AE%8C%E9%85%8D%E7%BD%AE%E5%90%8E%E9%87%8D%E5%90%AFmaster%E5%AE%9E%E4%BE%8B">修改完配置后重启master实例</h3> 
<p>在宿主机上通过容器数据卷来修改配置，传导给docker内部，是需要重启的</p> 
<pre><code class="language-Delphi">docker restart mysql-master </code></pre> 
<p class="img-center"><img alt="" height="77" src="https://images2.imgbox.com/2c/fe/3TwSclLi_o.png" width="1000"></p> 
<p>再ps查看一下，要确认它已经up起来了</p> 
<pre><code>docker ps</code></pre> 
<p class="img-center"><img alt="" height="54" src="https://images2.imgbox.com/12/85/vLQ8QRBW_o.png" width="1000"></p> 
<hr> 
<p></p> 
<h3 id="%E8%BF%9B%E5%85%A5mysql-master%E5%AE%B9%E5%99%A8">进入mysql-master容器</h3> 
<pre><code>docker exec -it mysql-master /bin/bash</code></pre> 
<pre><code>mysql -uroot -proot</code></pre> 
<p class="img-center"><img alt="" height="331" src="https://images2.imgbox.com/f4/ff/6ttHKH1q_o.png" width="1000"></p> 
<p>容器进入成功，继续下一步</p> 
<hr> 
<p></p> 
<h3 id="master%E5%AE%B9%E5%99%A8%E5%AE%9E%E4%BE%8B%E5%86%85%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5%E7%94%A8%E6%88%B7">master容器实例内创建数据同步用户</h3> 
<p>安全加固，添加一个用户，然后授权</p> 
<pre><code>create user 'slave'@'%' identified by '123456';</code></pre> 
<pre><code>grant replication slave,replication client on *.* to 'slave'@'%';</code></pre> 
<p class="img-center"><img alt="" height="122" src="https://images2.imgbox.com/ef/b7/gCmcOKWz_o.png" width="1000"></p> 
<hr> 
<p></p> 
<h3 id="%E6%96%B0%E5%BB%BA%E4%BB%8E%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%B9%E5%99%A8%E5%AE%9E%E4%BE%8B3308">新建从服务器容器实例3308</h3> 
<pre><code>docker run -p 3308:3306 --name mysql-slave -v /mydata/mysql-slave/log:/var/log/mysql -v /mydata/mysql-slave/data:/var/lib/mysql -v /mydata/mysql-slave/conf:/etc/mysql -e MYSQL_ROOT_PASSWORD=root -d mysql:5.7</code></pre> 
<p>ps以确认其up </p> 
<p class="img-center"><img alt="" height="215" src="https://images2.imgbox.com/8f/86/aTfAmhwV_o.png" width="1000"></p> 
<hr> 
<p></p> 
<h3 id="%E8%BF%9B%E5%85%A5%2Fmydata%2Fmysql-slave%2Fconf%E6%96%B0%E5%BB%BAmy.cnf">进入/mydata/mysql-slave/conf新建my.cnf</h3> 
<pre><code>vim /mydata/mysql-slave/conf/my.cnf</code></pre> 
<p>直接粘贴然后保存退出</p> 
<pre><code>[mysqld]
## 设置server_id，同一局域网中需要唯一
server_id=102
## 指定不需要同步的数据库名称
binlog-ignore-db=mysql  
## 开启二进制日志功能，以备Slave作为其它数据库实例的Master时使用
log-bin=mall-mysql-slave1-bin  
## 设置二进制日志使用内存大小（事务）
binlog_cache_size=1M  
## 设置使用的二进制日志格式（mixed,statement,row）
binlog_format=mixed  
## 二进制日志过期清理时间。默认值为0，表示不自动清理。
expire_logs_days=7  
## 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断。
## 如：1062错误是指一些主键重复，1032错误是因为主从数据库数据不一致
slave_skip_errors=1062  
## relay_log配置中继日志
relay_log=mall-mysql-relay-bin  
## log_slave_updates表示slave将复制事件写进自己的二进制日志
log_slave_updates=1  
## slave设置为只读（具有super权限的用户除外）
read_only=1</code></pre> 
<hr> 
<p></p> 
<h3 id="%E4%BF%AE%E6%94%B9%E5%AE%8C%E9%85%8D%E7%BD%AE%E5%90%8E%E9%87%8D%E5%90%AFslave%E5%AE%9E%E4%BE%8B">修改完配置后重启slave实例</h3> 
<pre><code>docker restart mysql-slave</code></pre> 
<p class="img-center"><img alt="" height="168" src="https://images2.imgbox.com/9a/af/e7qs1EfF_o.png" width="1000"></p> 
<hr> 
<p></p> 
<h3 id="%E5%9C%A8%E4%B8%BB%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E6%9F%A5%E7%9C%8B%E4%B8%BB%E4%BB%8E%E5%90%8C%E6%AD%A5%E7%8A%B6%E6%80%81">在主数据库中查看主从同步状态</h3> 
<pre><code>show master status;</code></pre> 
<p class="img-center"><img alt="" height="162" src="https://images2.imgbox.com/ed/de/4tduuULv_o.png" width="1000"></p> 
<hr> 
<p></p> 
<h3 id="%E8%BF%9B%E5%85%A5mysql-slave%E5%AE%B9%E5%99%A8">进入mysql-slave容器</h3> 
<pre><code>docker exec -it mysql-slave /bin/bash
</code></pre> 
<pre><code>mysql -uroot -proot</code></pre> 
<p class="img-center"><img alt="" height="305" src="https://images2.imgbox.com/f0/3d/c9wrz7Be_o.png" width="1000"></p> 
<hr> 
<p></p> 
<h3 id="%E5%9C%A8%E4%BB%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E9%85%8D%E7%BD%AE%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6">在从数据库中配置主从复制</h3> 
<p>是在从数据库配置，不是主！</p> 
<blockquote> 
 <p>change master to master_host='宿主机ip', master_user='slave', master_password='123456', master_port=3307, master_log_file='mall-mysql-bin.000001', master_log_pos=617, master_connect_retry=30;</p> 
</blockquote> 
<pre><code>change master to master_host='192.168.150.30', master_user='slave', master_password='123456', master_port=3307, master_log_file='mall-mysql-bin.000001', master_log_pos=617, master_connect_retry=30;</code></pre> 
<p>参数说明：</p> 
<blockquote> 
 <p><span style="color:#000000;"><span style="background-color:#f3f4fa;">master_host：主数据库的IP地址；</span></span></p> 
 <p><span style="color:#000000;"><span style="background-color:#f3f4fa;">master_port：主数据库的运行端口；</span></span></p> 
 <p><span style="color:#000000;"><span style="background-color:#f3f4fa;">master_user：在主数据库创建的用于同步数据的用户账号；</span></span></p> 
 <p><span style="color:#000000;"><span style="background-color:#f3f4fa;">master_password：在主数据库创建的用于同步数据的用户密码；</span></span></p> 
 <p><span style="color:#000000;"><span style="background-color:#f3f4fa;">master_log_file：指定从数据库要复制数据的日志文件，通过查看主数据的状态，获取File参数；</span></span></p> 
 <p><span style="color:#000000;"><span style="background-color:#f3f4fa;">master_log_pos：指定从数据库从哪个位置开始复制数据，通过查看主数据的状态，获取Position参数；</span></span></p> 
 <p><span style="color:#000000;"><span style="background-color:#f3f4fa;">master_connect_retry：连接失败重试的时间间隔，单位为秒。</span></span></p> 
</blockquote> 
<p class="img-center"><img alt="" height="93" src="https://images2.imgbox.com/54/2c/8ffM6IWO_o.png" width="1000"></p> 
<hr> 
<p></p> 
<h3 id="%E5%9C%A8%E4%BB%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E6%9F%A5%E7%9C%8B%E4%B8%BB%E4%BB%8E%E5%90%8C%E6%AD%A5%E7%8A%B6%E6%80%81">在从数据库中查看主从同步状态</h3> 
<pre><code>show slave status \G</code></pre> 
<p>\G 是竖着来查看，有点类似于键值对</p> 
<p>这里的Slave_IO_Running和Slave_SQL_Running都还是NO，没有启动</p> 
<p class="img-center"><img alt="" height="546" src="https://images2.imgbox.com/bd/e3/6zUt6FuC_o.png" width="1000"></p> 
<hr> 
<p></p> 
<h3 id="%E5%9C%A8%E4%BB%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E5%BC%80%E5%90%AF%E4%B8%BB%E4%BB%8E%E5%90%8C%E6%AD%A5">在从数据库中开启主从同步</h3> 
<pre><code>start slave;
</code></pre> 
<p class="img-center"><img alt="" height="125" src="https://images2.imgbox.com/23/62/U6VcPZQe_o.png" width="1000"></p> 
<hr> 
<p></p> 
<h3 id="%E5%86%8D%E6%AC%A1%E6%9F%A5%E7%9C%8B%E4%BB%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E7%8A%B6%E6%80%81">再次查看从数据库状态</h3> 
<pre><code>show slave status \G</code></pre> 
<p class="img-center"><img alt="" height="495" src="https://images2.imgbox.com/64/c5/ozgloOrV_o.png" width="1000"></p> 
<p> 成功。</p> 
<hr> 
<p></p> 
<h2 id="%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E6%B5%8B%E8%AF%95">二、主从复制测试</h2> 
<h3 id="%E4%B8%BB%E6%95%B0%E6%8D%AE%E5%BA%93">主数据库</h3> 
<p>主数据库新建库，新建表，插入数据</p> 
<pre><code class="language-sql">create database dbtest1;
use dbtest1;
create table test1 (id int,name varchar(20));
insert into test1 values(1,'van');
select * from test1;
</code></pre> 
<p class="img-center"><img alt="" height="395" src="https://images2.imgbox.com/55/2b/YDWAGn9N_o.png" width="1000"></p> 
<hr> 
<p></p> 
<h3 id="%E4%BB%8E%E6%95%B0%E6%8D%AE%E5%BA%93">从数据库</h3> 
<p>从数据库进行查找</p> 
<pre><code class="language-sql">show databases;
use dbtest1;
select * from test1;</code></pre> 
<p class="img-center"><img alt="" height="631" src="https://images2.imgbox.com/80/b6/xxyKAcIr_o.png" width="1000"></p> 
<p> 测试成功！</p> 
<hr> 
<p></p> 
<p></p> 
<h2 id="%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB">三、读写分离</h2> 
<h3 id="Docker%E5%AE%89%E8%A3%85MyCat">Docker安装MyCat</h3> 
<p>拉取MyCat镜像：</p> 
<pre><code>docker pull longhronshens/mycat-docker</code></pre> 
<p>创建目录并配置文件：</p> 
<pre><code>mkdir -p /usr/local/mycat
</code></pre> 
<pre><code>cd /usr/local/mycat</code></pre> 
<hr> 
<p></p> 
<h3 id="server.xml%C2%A0">server.xml </h3> 
<pre><code class="language-XML">vim  /usr/local/mycat/server.xml
</code></pre> 
<p>将以下内容复制进去：</p> 
<pre><code class="language-XML">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!-- - - Licensed under the Apache License, Version 2.0 (the "License"); 
	- you may not use this file except in compliance with the License. - You 
	may obtain a copy of the License at - - http://www.apache.org/licenses/LICENSE-2.0 
	- - Unless required by applicable law or agreed to in writing, software - 
	distributed under the License is distributed on an "AS IS" BASIS, - WITHOUT 
	WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. - See the 
	License for the specific language governing permissions and - limitations 
	under the License. --&gt;
&lt;!DOCTYPE mycat:server SYSTEM "server.dtd"&gt;
&lt;mycat:server xmlns:mycat="http://io.mycat/"&gt;
	&lt;system&gt;
	&lt;property name="useSqlStat"&gt;0&lt;/property&gt;  &lt;!-- 1为开启实时统计、0为关闭 --&gt;
	&lt;property name="useGlobleTableCheck"&gt;0&lt;/property&gt;  &lt;!-- 1为开启全加班一致性检测、0为关闭 --&gt;
		&lt;property name="sequnceHandlerType"&gt;0&lt;/property&gt;
		&lt;property name="processorBufferPoolType"&gt;0&lt;/property&gt;
		&lt;!--默认是65535 64K 用于sql解析时最大文本长度 --&gt;
		&lt;!--&lt;property name="maxStringLiteralLength"&gt;65535&lt;/property&gt;--&gt;
		&lt;!--&lt;property name="sequnceHandlerType"&gt;0&lt;/property&gt;--&gt;
		&lt;!--&lt;property name="backSocketNoDelay"&gt;1&lt;/property&gt;--&gt;
		&lt;!--&lt;property name="frontSocketNoDelay"&gt;1&lt;/property&gt;--&gt;
		&lt;!--&lt;property name="processorExecutor"&gt;16&lt;/property&gt;--&gt;
		&lt;!--
			&lt;property name="serverPort"&gt;8066&lt;/property&gt; &lt;property name="managerPort"&gt;9066&lt;/property&gt; 
			&lt;property name="idleTimeout"&gt;300000&lt;/property&gt; &lt;property name="bindIp"&gt;0.0.0.0&lt;/property&gt; 
			&lt;property name="frontWriteQueueSize"&gt;4096&lt;/property&gt; &lt;property name="processors"&gt;32&lt;/property&gt; --&gt;
		&lt;!--分布式事务开关，0为不过滤分布式事务，1为过滤分布式事务（如果分布式事务内只涉及全局表，则不过滤），2为不过滤分布式事务,但是记录分布式事务日志--&gt;
		&lt;property name="handleDistributedTransactions"&gt;0&lt;/property&gt;
			&lt;!--
			off heap for merge/order/group/limit      1开启   0关闭
		--&gt;
		&lt;property name="useOffHeapForMerge"&gt;1&lt;/property&gt;
		&lt;!--
			单位为m
		--&gt;
		&lt;property name="memoryPageSize"&gt;1m&lt;/property&gt;
		&lt;!--
			单位为k
		--&gt;
		&lt;property name="spillsFileBufferSize"&gt;1k&lt;/property&gt;
		&lt;property name="useStreamOutput"&gt;0&lt;/property&gt;
		&lt;!--
			单位为m
		--&gt;
		&lt;property name="systemReserveMemorySize"&gt;384m&lt;/property&gt;
		&lt;!--是否采用zookeeper协调切换  --&gt;
		&lt;property name="useZKSwitch"&gt;true&lt;/property&gt;
	&lt;/system&gt;
	&lt;user name="root"&gt;
		&lt;property name="password"&gt;root&lt;/property&gt;
		&lt;property name="schemas"&gt;test&lt;/property&gt;
	&lt;/user&gt;
&lt;/mycat:server&gt;
</code></pre> 
<hr> 
<p></p> 
<h3 id="schema.xml%C2%A0">schema.xml </h3> 
<pre><code class="language-XML">vim  /usr/local/mycat/schema.xml
</code></pre> 
<p>继续复制：</p> 
<pre><code class="language-XML">&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE mycat:schema SYSTEM "schema.dtd"&gt;
&lt;mycat:schema xmlns:mycat="http://io.mycat/"&gt;
	&lt;schema name="test" checkSQLschema="false" sqlMaxLimit="100"&gt;
		&lt;table name="tb_user"   primaryKey="id"  autoIncrement="true"  dataNode="dn1,dn2,dn3,dn4" rule="userrule" /&gt;
		&lt;table name="tb_category" primaryKey="id" dataNode="dn1,dn2,dn3,dn4" rule="categoryrule" /&gt;
	&lt;/schema&gt;
	&lt;dataNode name="dn1" dataHost="localhost1" database="db1" /&gt;
	&lt;dataNode name="dn2" dataHost="localhost1" database="db2" /&gt;
	&lt;dataNode name="dn3" dataHost="localhost1" database="db3" /&gt;
	&lt;dataNode name="dn4" dataHost="localhost1" database="db4" /&gt;
	&lt;dataHost name="localhost1" maxCon="1000" minCon="10" balance="1"
			  writeType="0" dbType="mysql" dbDriver="native" switchType="1"  slaveThreshold="100"&gt;
		&lt;heartbeat&gt;select user()&lt;/heartbeat&gt;
		&lt;writeHost host="hostM1" url="192.168.21.55:3307" user="root"
				   password="root"&gt;
			&lt;readHost host="hostS2" url="192.168.21.55:3308" user="root" password="root" /&gt;
		&lt;/writeHost&gt;
	&lt;/dataHost&gt;
&lt;/mycat:schema&gt;

</code></pre> 
<hr> 
<p></p> 
<h3 id="sequence_conf.properties%C2%A0">sequence_conf.properties </h3> 
<pre><code class="language-XML">vim  /usr/local/mycat/sequence_conf.properties
</code></pre> 
<pre><code class="language-XML">TB_USER.HISIDS=
TB_USER.MINID=1
TB_USER.MAXID=20000
TB_USER.CURID=1
</code></pre> 
<hr> 
<p></p> 
<h3 id="rule.xml">rule.xml</h3> 
<pre><code class="language-XML">vim  /usr/local/mycat/rule.xml
</code></pre> 
<pre><code class="language-XML">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE mycat:rule SYSTEM "rule.dtd"&gt;
&lt;mycat:rule xmlns:mycat="http://io.mycat/"&gt;
	&lt;tableRule name="userrule"&gt;
		&lt;rule&gt;
			&lt;columns&gt;id&lt;/columns&gt;
			&lt;algorithm&gt;func1&lt;/algorithm&gt;
		&lt;/rule&gt;
	&lt;/tableRule&gt;
	&lt;tableRule name="categoryrule"&gt;
		&lt;rule&gt;
			&lt;columns&gt;id&lt;/columns&gt;
			&lt;algorithm&gt;jump-consistent-hash&lt;/algorithm&gt;
		&lt;/rule&gt;
	&lt;/tableRule&gt;

	&lt;function name="murmur"
		class="io.mycat.route.function.PartitionByMurmurHash"&gt;
		&lt;property name="seed"&gt;0&lt;/property&gt;&lt;!-- 默认是0 --&gt;
		&lt;property name="count"&gt;2&lt;/property&gt;&lt;!-- 要分片的数据库节点数量，必须指定，否则没法分片 --&gt;
		&lt;property name="virtualBucketTimes"&gt;160&lt;/property&gt;&lt;!-- 一个实际的数据库节点被映射为这么多虚拟节点，默认是160倍，也就是虚拟节点数是物理节点数的160倍 --&gt;
		&lt;!-- &lt;property name="weightMapFile"&gt;weightMapFile&lt;/property&gt; 节点的权重，没有指定权重的节点默认是1。以properties文件的格式填写，以从0开始到count-1的整数值也就是节点索引为key，以节点权重值为值。所有权重值必须是正整数，否则以1代替 --&gt;
		&lt;!-- &lt;property name="bucketMapPath"&gt;/etc/mycat/bucketMapPath&lt;/property&gt; 
			用于测试时观察各物理节点与虚拟节点的分布情况，如果指定了这个属性，会把虚拟节点的murmur hash值与物理节点的映射按行输出到这个文件，没有默认值，如果不指定，就不会输出任何东西 --&gt;
	&lt;/function&gt;

	&lt;function name="crc32slot"
			  class="io.mycat.route.function.PartitionByCRC32PreSlot"&gt;
		&lt;property name="count"&gt;2&lt;/property&gt;&lt;!-- 要分片的数据库节点数量，必须指定，否则没法分片 --&gt;
	&lt;/function&gt;
	&lt;function name="hash-int"
		class="io.mycat.route.function.PartitionByFileMap"&gt;
		&lt;property name="mapFile"&gt;partition-hash-int.txt&lt;/property&gt;
	&lt;/function&gt;
	&lt;function name="rang-long"
		class="io.mycat.route.function.AutoPartitionByLong"&gt;
		&lt;property name="mapFile"&gt;autopartition-long.txt&lt;/property&gt;
	&lt;/function&gt;
	&lt;function name="mod-long" class="io.mycat.route.function.PartitionByMod"&gt;
		&lt;!-- how many data nodes --&gt;
		&lt;property name="count"&gt;4&lt;/property&gt;
	&lt;/function&gt;

	&lt;function name="func1" class="io.mycat.route.function.PartitionByLong"&gt;
		&lt;property name="partitionCount"&gt;8&lt;/property&gt;
		&lt;property name="partitionLength"&gt;128&lt;/property&gt;
	&lt;/function&gt;
	&lt;function name="latestMonth"
		class="io.mycat.route.function.LatestMonthPartion"&gt;
		&lt;property name="splitOneDay"&gt;24&lt;/property&gt;
	&lt;/function&gt;
	&lt;function name="partbymonth"
		class="io.mycat.route.function.PartitionByMonth"&gt;
		&lt;property name="dateFormat"&gt;yyyy-MM-dd&lt;/property&gt;
		&lt;property name="sBeginDate"&gt;2015-01-01&lt;/property&gt;
	&lt;/function&gt;
	
	&lt;function name="rang-mod" class="io.mycat.route.function.PartitionByRangeMod"&gt;
        	&lt;property name="mapFile"&gt;partition-range-mod.txt&lt;/property&gt;
	&lt;/function&gt;
	
	&lt;function name="jump-consistent-hash" class="io.mycat.route.function.PartitionByJumpConsistentHash"&gt;
		&lt;property name="totalBuckets"&gt;4&lt;/property&gt;
	&lt;/function&gt;
&lt;/mycat:rule&gt;
</code></pre> 
<hr> 
<p></p> 
<h3 id="%E8%BF%90%E8%A1%8C%E5%AE%B9%E5%99%A8">运行容器</h3> 
<pre><code class="language-XML">docker run --name mycat -v /usr/local/mycat/schema.xml:/usr/local/mycat/conf/schema.xml -v /usr/local/mycat/rule.xml:/usr/local/mycat/conf/rule.xml -v /usr/local/mycat/server.xml:/usr/local/mycat/conf/server.xml -v /usr/local/mycat/sequence_conf.properties:/usr/local/mycat/conf/sequence_conf.properties --privileged=true -p 8066:8066 -p 9066:9066 -e MYSQL_ROOT_PASSWORD=root  -d longhronshens/mycat-docker 
</code></pre> 
<p></p> 
<h3 id="%E5%AE%B9%E5%99%A8%E4%B8%AD%E5%AE%89%E8%A3%85JDK">容器中安装JDK</h3> 
<p>将JDK的安装包传到容器内，格式为：</p> 
<pre><code class="language-sql">docker cp 宿主机内目录 容器ID:容器内目录</code></pre> 
<p>举个栗子：</p> 
<pre><code class="language-sql">docker cp /opt/software/jdk-8u201-linux-x64.rpm fe5162fd39ea:/</code></pre> 
<p>进入容器：</p> 
<pre><code class="language-sql">docker exec -it mycat bash</code></pre> 
<p> 解压安装：</p> 
<pre><code class="language-sql">rpm -ivh jdk-8u201-linux-x64.rpm</code></pre> 
<p class="img-center"><img alt="" height="240" src="https://images2.imgbox.com/e6/9b/UDy4pizZ_o.png" width="1000"></p> 
<p>使用yum安装vim： </p> 
<pre><code class="language-sql">yum install -y vim</code></pre> 
<p>修改配置文件：</p> 
<pre><code class="language-sql">vim /etc/profile.d/java.sh</code></pre> 
<p>将以下内容复制进去：</p> 
<pre><code class="language-sql">export JAVA_HOME=/usr/java/jdk1.8.0_201-amd64
export CLASSPATH=.:$JAVA_HOME/lib/tools.jar:$JAVA_HOME/lib/dt.jar
export PATH=$JAVA_HOME/bin:$PATH</code></pre> 
<p class="img-center"><img alt="" height="99" src="https://images2.imgbox.com/ba/80/1jnu5zbc_o.png" width="1000"></p> 
<p>保存退出后source一下：</p> 
<pre><code class="language-sql">source /etc/profile</code></pre> 
<p>Ctrl+D退出，然后重启容器：</p> 
<pre><code class="language-sql">docker restart mycat
</code></pre> 
<p class="img-center"><img alt="" height="48" src="https://images2.imgbox.com/e6/3a/MepTMdGB_o.png" width="1000"></p> 
<p></p> 
<h3 id="%E8%BF%9E%E6%8E%A5%E6%B5%8B%E8%AF%95">连接测试</h3> 
<p>进入MySQLMaster容器：</p> 
<pre><code class="language-XML">docker exec -it mysql-master bash
</code></pre> 
<pre><code class="language-sql">mysql -h192.168.150.30 -uroot -proot -P8066
</code></pre> 
<p>打开Navicat进行连接，注意端口号 ：</p> 
<p class="img-center"><img alt="" height="593" src="https://images2.imgbox.com/88/e0/cWGMpmHz_o.png" width="500"></p> 
<p>连接成功</p> 
<p class="img-center"><img alt="" height="254" src="https://images2.imgbox.com/b3/42/C65xgSAX_o.png" width="600"></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/349908d98c5dabc692024e6a7f1595a0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">css 去除a标签的下划线和颜色</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9177606a3c54c29440648a6e4ae1414f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">java AWT事件处理及常用事件</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>