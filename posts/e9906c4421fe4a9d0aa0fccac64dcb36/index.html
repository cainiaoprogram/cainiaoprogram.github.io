<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ESPFriends之ESP32模型部署训练历险记(一) - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ESPFriends之ESP32模型部署训练历险记(一)" />
<meta property="og:description" content="开发环境的部署搭建 超级小星星：时间过得可真快ESPFriends创客沙龙已经在武汉举办了两期，在这里有行业内的工程师、高校的学生以及极客，在这里我们交流分享自己的开发心得，提出遇到的“大坑”也可以得到小伙伴们的解决方案，希望活动可以越办越好，在这里我也记录一下自己的开发历程和学习心得与大家共勉。
内容源码地址：link
本期的主题是模型的训练与部署，AI这个东西确实很神奇，我们之所以感觉这东西很“虚”，是因为我们并没有将其落到实处，这里我们就开始本期的探索之旅吧！o(￣▽￣)ブ
软件配置 我的的测试训练环境：
电脑系统：
Win11 软件：
VScodeESP-IDF(V4.4.5)AnacondaPyCharmGit 参考资料：
TensorFlow Lite Micro for Espressif Chipsets（乐鑫官方例程）esp-whoesp-skainetTensorFlow Lite 为了避免下载到有病毒的资源，所有的链接都是出自官方网站或者国内源
编译并运行官方的第一个例程 俗话说的好写程序从hello_world开始，当然我们检验自己的开发环境搭建是否正确当然先编译一下啦，这里解释一下为什么没有使用最新版本的IDF，因为在使用ESP-WHO框架的话，需要使用官方建议的软件分支，不然谁知道会出现什么问题，我使用过5.1分支的去set-target，不出所料第一步就出现问题/(ㄒoㄒ)/~~，当然官方之后会更新的啦！
这里需要我们打开文件目录使用命令行的方式去编译项目工程，并烧录到ESP32-S3-EYE (感谢官方的开发板\^o^/)
当然对应的例程目录下面都有一个README文件，这里按照上面的说明操作即可：
# 设置芯片型号 idf.py set-target esp32s3 # 编译工程 idf.py build # 烧录并打开串口监视 # 在这里使用命令行的话win平台下会自动找到设备串口并烧录 idf.py flash monitor 表示设置芯片信号成功，后面就会很顺利了
编译成功
烧录成功
查看测试程序
程序成功跑起来啦o(/￣▽￣)ブ
命令是不是很简单，当然这只是成功的一小步，后面还有更多的未知等待着我们去探索
跑一遍Tensorflow lite官方的示例程序 link
这里按照官方文件夹中的README文件操作，安装了bazel，在其根目录下运行指令
bazel build tensorflow/lite/micro/examples/hello_world:evaluate 第一步都过不了，找了半天都没找到解决办法/(ㄒoㄒ)/~~，好像是因为软件源的问题，但是在linux下可以使用清华源设置，在win下目前还没有找到解决方法
这里不影响我们用它的代码做参考，接下来我们就要自己敲代码了o(*￣▽￣)ブ
导入依赖项
import tensorflow as tf import numpy as np import matplotlib.pyplot as plt import math # 生成从0到2派的数据，并将数据转换为np的float32的格式 x_values = np." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/e9906c4421fe4a9d0aa0fccac64dcb36/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-10T13:26:31+08:00" />
<meta property="article:modified_time" content="2023-08-10T13:26:31+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ESPFriends之ESP32模型部署训练历险记(一)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><img src="https://images2.imgbox.com/23/99/gr8T1KuR_o.png" alt="请添加图片描述"></p> 
<h2><a id="_1"></a>开发环境的部署搭建</h2> 
<blockquote> 
 <p>超级小星星：时间过得可真快ESPFriends创客沙龙已经在武汉举办了两期，在这里有行业内的工程师、高校的学生以及极客，在这里我们交流分享自己的开发心得，提出遇到的“大坑”也可以得到小伙伴们的解决方案，希望活动可以越办越好，在这里我也记录一下自己的开发历程和学习心得与大家共勉。</p> 
</blockquote> 
<p>内容源码地址：<a href="https://github.com/cannnnnnnnnnnn/ESPFriends">link</a></p> 
<p>本期的主题是模型的训练与部署，AI这个东西确实很神奇，我们之所以感觉这东西很“虚”，是因为我们并没有将其落到实处，这里我们就开始本期的探索之旅吧！o(<em>￣▽￣</em>)ブ</p> 
<h4><a id="_8"></a>软件配置</h4> 
<p>我的的测试训练环境：<br> 电脑系统：</p> 
<ul><li>Win11</li></ul> 
<p>软件：</p> 
<ul><li><a href="https://code.visualstudio.com/" rel="nofollow">VScode</a></li><li><a href="https://dl.espressif.cn/dl/esp-idf/?idf=4.4" rel="nofollow">ESP-IDF</a>(V4.4.5)</li><li><a href="https://mirrors.tuna.tsinghua.edu.cn/anaconda/archive/" rel="nofollow">Anaconda</a></li><li><a href="https://www.jetbrains.com/pycharm/download/?section=windows" rel="nofollow">PyCharm</a></li><li><a href="https://git-scm.com/" rel="nofollow">Git</a></li></ul> 
<p>参考资料：</p> 
<ul><li><a href="https://github.com/espressif/tflite-micro-esp-examples">TensorFlow Lite Micro for Espressif Chipsets</a>（乐鑫官方例程）</li><li><a href="https://github.com/espressif/esp-who">esp-who</a></li><li><a href="https://github.com/espressif/esp-skainet">esp-skainet</a></li><li><a href="https://tensorflow.google.cn/lite?hl=zh-cn" rel="nofollow">TensorFlow Lite</a></li></ul> 
<blockquote> 
 <p>为了避免下载到有病毒的资源，所有的链接都是出自官方网站或者国内源</p> 
</blockquote> 
<h4><a id="_28"></a>编译并运行官方的第一个例程</h4> 
<p>俗话说的好写程序从hello_world开始，当然我们检验自己的开发环境搭建是否正确当然先编译一下啦，这里解释一下为什么没有使用最新版本的IDF，因为在使用ESP-WHO框架的话，需要使用官方建议的软件分支，不然谁知道会出现什么问题，我使用过5.1分支的去set-target，不出所料第一步就出现问题/(ㄒoㄒ)/~~，当然官方之后会更新的啦！<img src="https://images2.imgbox.com/78/78/8H0NDX3D_o.png" alt="在这里插入图片描述"><br> 这里需要我们打开文件目录使用命令行的方式去编译项目工程，并烧录到ESP32-S3-EYE (感谢官方的开发板\^o^/)</p> 
<p>当然对应的例程目录下面都有一个README文件，这里按照上面的说明操作即可：</p> 
<pre><code class="prism language-shell"><span class="token comment"># 设置芯片型号</span>
idf.py set-target esp32s3
<span class="token comment"># 编译工程</span>
idf.py build
<span class="token comment"># 烧录并打开串口监视</span>
<span class="token comment"># 在这里使用命令行的话win平台下会自动找到设备串口并烧录</span>
idf.py flash monitor
</code></pre> 
<p>表示设置芯片信号成功，后面就会很顺利了<br> <img src="https://images2.imgbox.com/79/ba/alXkK4FC_o.png" alt="在这里插入图片描述"><br> 编译成功<br> <img src="https://images2.imgbox.com/f6/d3/JgUN76T6_o.png" alt="在这里插入图片描述"><br> 烧录成功<br> <img src="https://images2.imgbox.com/84/76/yQU7NMkf_o.png" alt="在这里插入图片描述"><br> 查看测试程序<br> <img src="https://images2.imgbox.com/8f/89/0jutn7yE_o.png" alt="在这里插入图片描述"><br> 程序成功跑起来啦o(/<em>￣▽￣</em>)ブ<br> 命令是不是很简单，当然这只是成功的一小步，后面还有更多的未知等待着我们去探索</p> 
<h4><a id="Tensorflow_lite_52"></a>跑一遍Tensorflow lite官方的示例程序</h4> 
<blockquote> 
 <p><a href="https://github.com/tensorflow/tflite-micro/tree/main/tensorflow/lite/micro/examples/hello_world">link</a></p> 
</blockquote> 
<p>这里按照官方文件夹中的README文件操作，安装了<a href="https://github.com/bazelbuild/bazel/releases">bazel</a>，在其根目录下运行指令</p> 
<pre><code class="prism language-shell">bazel build tensorflow/lite/micro/examples/hello_world:evaluate
</code></pre> 
<p>第一步都过不了，找了半天都没找到解决办法/(ㄒoㄒ)/~~，好像是因为软件源的问题，但是在linux下可以使用<a href="https://mirrors.tuna.tsinghua.edu.cn/help/bazel-apt/" rel="nofollow">清华源</a>设置，在win下目前还没有找到解决方法<br> <img src="https://images2.imgbox.com/2e/b8/Vl1r9RRS_o.png" alt="在这里插入图片描述"><br> 这里不影响我们用它的代码做参考，接下来我们就要自己敲代码了o(*<em>￣▽￣</em>)ブ</p> 
<p><img src="https://images2.imgbox.com/99/6f/aqToKVvX_o.png" alt="啦啦啦"></p> 
<blockquote> 
 <p>导入依赖项</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> math
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># 生成从0到2派的数据，并将数据转换为np的float32的格式</span>
x_values <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>uniform<span class="token punctuation">(</span>low<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> high<span class="token operator">=</span><span class="token number">2</span> <span class="token operator">*</span> math<span class="token punctuation">.</span>pi<span class="token punctuation">,</span>
                             size<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
<span class="token comment"># 将数据随机排列</span>
np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>shuffle<span class="token punctuation">(</span>x_values<span class="token punctuation">)</span>

<span class="token comment"># 得到数据y</span>
y_values <span class="token operator">=</span> np<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>x_values<span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># 显示绘制数据图形</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x_values<span class="token punctuation">,</span> y_values<span class="token punctuation">,</span><span class="token string">"b."</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/91/1f/rbHGPPK2_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python"><span class="token comment"># 添加随机噪声</span>
y_values <span class="token operator">+=</span> <span class="token number">0.1</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token operator">*</span>y_values<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>

<span class="token comment"># 绘制图形</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x_values<span class="token punctuation">,</span> y_values<span class="token punctuation">,</span> <span class="token string">"b."</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/fd/18/Qei4KJ6z_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python"><span class="token comment"># 拆分数据集，将数据集分为训练集(60%)、测试集(20%)和验证集(20%)</span>
TRAIN_SPLIT <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token number">0.6</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span>
TEST_SPLIT <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token number">0.2</span> <span class="token operator">*</span> <span class="token number">1000</span> <span class="token operator">+</span> TRAIN_SPLIT<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># 拆分数据集</span>
x_train<span class="token punctuation">,</span> x_validate<span class="token punctuation">,</span> x_test <span class="token operator">=</span> np<span class="token punctuation">.</span>split<span class="token punctuation">(</span>x_values<span class="token punctuation">,</span> <span class="token punctuation">[</span>TRAIN_SPLIT<span class="token punctuation">,</span> TEST_SPLIT<span class="token punctuation">]</span><span class="token punctuation">)</span>
y_train<span class="token punctuation">,</span> y_validate<span class="token punctuation">,</span> y_test <span class="token operator">=</span> np<span class="token punctuation">.</span>split<span class="token punctuation">(</span>y_values<span class="token punctuation">,</span> <span class="token punctuation">[</span>TRAIN_SPLIT<span class="token punctuation">,</span> TEST_SPLIT<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># 绘制图形</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x_train<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> <span class="token string">"b."</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"Train"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x_validate<span class="token punctuation">,</span> y_validate<span class="token punctuation">,</span> <span class="token string">"y."</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"Validate"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x_test<span class="token punctuation">,</span> y_test<span class="token punctuation">,</span> <span class="token string">"r."</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"Test"</span><span class="token punctuation">)</span>
<span class="token comment"># 图像加图例</span>
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/16/c7/3vmyLXV2_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python"><span class="token comment"># 创建模型网络</span>
model <span class="token operator">=</span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># First layer takes a scalar input and feeds it through 16 "neurons". The</span>
<span class="token comment"># neurons decide whether to activate based on the 'relu' activation function.</span>
model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'relu'</span><span class="token punctuation">,</span> input_shape<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># The new second and third layer will help the network learn more complex</span>
<span class="token comment"># representations</span>
model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'relu'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># Final layer is a single neuron, since we want to output a single value</span>
model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># Compile the model using the standard 'adam' optimizer and the mean squared</span>
<span class="token comment"># error or 'mse' loss function for regression.</span>
model<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span>optimizer<span class="token operator">=</span><span class="token string">'adam'</span><span class="token punctuation">,</span> loss<span class="token operator">=</span><span class="token string">'mse'</span><span class="token punctuation">,</span> metrics<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'mae'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 打印模型参数</span>
model<span class="token punctuation">.</span>summary<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/d4/33/UYYnZEIF_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python">model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>x_values<span class="token punctuation">,</span>
          y_values<span class="token punctuation">,</span>
          epochs<span class="token operator">=</span><span class="token number">400</span><span class="token punctuation">,</span>
          validation_split<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span>
          batch_size<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">,</span>
          verbose<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/5b/e1/FtbAIQXY_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/ed/f5/QMtN6k9W_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python"><span class="token comment"># 保存模型</span>
save_dir <span class="token operator">=</span> <span class="token string">'./modes/test'</span>
tf<span class="token punctuation">.</span>saved_model<span class="token punctuation">.</span>save<span class="token punctuation">(</span>model<span class="token punctuation">,</span> save_dir<span class="token punctuation">)</span>

<span class="token comment"># 模型转换</span>
converter <span class="token operator">=</span> tf<span class="token punctuation">.</span>lite<span class="token punctuation">.</span>TFLiteConverter<span class="token punctuation">.</span>from_saved_model<span class="token punctuation">(</span>save_dir<span class="token punctuation">)</span>
tflite_model <span class="token operator">=</span> converter<span class="token punctuation">.</span>convert<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 模型保存</span>
<span class="token keyword">import</span> pathlib

tflite_model_file <span class="token operator">=</span> pathlib<span class="token punctuation">.</span>Path<span class="token punctuation">(</span><span class="token string">'model.tflite'</span><span class="token punctuation">)</span>
tflite_model_file<span class="token punctuation">.</span>write_bytes<span class="token punctuation">(</span>tflite_model<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># 模型量化</span>
<span class="token keyword">def</span> <span class="token function">representative_dataset</span><span class="token punctuation">(</span>num_samples<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_samples<span class="token punctuation">)</span><span class="token punctuation">:</span>
      <span class="token keyword">yield</span> <span class="token punctuation">[</span>x_values<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

saved_model_dir <span class="token operator">=</span> <span class="token string">"./modes/test"</span>
converter <span class="token operator">=</span> tf<span class="token punctuation">.</span>lite<span class="token punctuation">.</span>TFLiteConverter<span class="token punctuation">.</span>from_saved_model<span class="token punctuation">(</span>saved_model_dir<span class="token punctuation">)</span>
converter<span class="token punctuation">.</span>optimizations <span class="token operator">=</span> <span class="token punctuation">[</span>tf<span class="token punctuation">.</span>lite<span class="token punctuation">.</span>Optimize<span class="token punctuation">.</span>DEFAULT<span class="token punctuation">]</span>
converter<span class="token punctuation">.</span>target_spec<span class="token punctuation">.</span>supported_ops <span class="token operator">=</span> <span class="token punctuation">[</span>tf<span class="token punctuation">.</span>lite<span class="token punctuation">.</span>OpsSet<span class="token punctuation">.</span>TFLITE_BUILTINS_INT8<span class="token punctuation">]</span>
converter<span class="token punctuation">.</span>inference_input_type <span class="token operator">=</span> tf<span class="token punctuation">.</span>int8
converter<span class="token punctuation">.</span>inference_output_type <span class="token operator">=</span> tf<span class="token punctuation">.</span>int8
converter<span class="token punctuation">.</span>representative_dataset <span class="token operator">=</span> representative_dataset
tflite_quant_model <span class="token operator">=</span> converter<span class="token punctuation">.</span>convert<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"sine_model_quantized.tflite"</span><span class="token punctuation">,</span><span class="token string">"wb"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>tflite_quant_model<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="_192"></a>模型转换</h4> 
<blockquote> 
 <p>目前我还没有从官方的脚本项目配置中找到对应的脚本转换文件，目前我是用虚拟机中的命令转换的方式，这样也很简单，一起来操作一下吧</p> 
</blockquote> 
<pre><code class="prism language-bash"><span class="token comment"># 安装工具</span>
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> xxd
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment"># 执行转换命令</span>
xxd <span class="token parameter variable">-i</span> Demo_model.tflite <span class="token operator">&gt;</span> Demo_model.h
</code></pre> 
<p>然后将文件内容复制进例程中的模型文件中<br> 对应目录在 <strong>examples/hello_world/main/model.cc</strong> <a href="https://github.com/espressif/tflite-micro-esp-examples/blob/master/examples/hello_world/main/model.cc">link</a></p> 
<blockquote> 
 <p>替换对应的模型文件然后重新编译烧录工程</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/4e/f9/1HsOjKGP_o.png" alt="在这里插入图片描述"><br> 在模型没有量化就将其转换，则会导致输出的数据全为零，这时候我们就需要改动源码中的输入变量类型，下面时我将没有量化的模型转换后修改源码输出的结果</p> 
<pre><code class="prism language-python">I <span class="token punctuation">(</span><span class="token number">224</span><span class="token punctuation">)</span> heap_init<span class="token punctuation">:</span> Initializing<span class="token punctuation">.</span> RAM available <span class="token keyword">for</span> dynamic allocation<span class="token punctuation">:</span>
I <span class="token punctuation">(</span><span class="token number">232</span><span class="token punctuation">)</span> heap_init<span class="token punctuation">:</span> At 3FC935D8 <span class="token builtin">len</span> <span class="token number">00056138</span> <span class="token punctuation">(</span><span class="token number">344</span> KiB<span class="token punctuation">)</span><span class="token punctuation">:</span> D<span class="token operator">/</span>IRAM
I <span class="token punctuation">(</span><span class="token number">238</span><span class="token punctuation">)</span> heap_init<span class="token punctuation">:</span> At 3FCE9710 <span class="token builtin">len</span> <span class="token number">00005724</span> <span class="token punctuation">(</span><span class="token number">21</span> KiB<span class="token punctuation">)</span><span class="token punctuation">:</span> STACK<span class="token operator">/</span>DIRAM
I <span class="token punctuation">(</span><span class="token number">245</span><span class="token punctuation">)</span> heap_init<span class="token punctuation">:</span> At 3FCF0000 <span class="token builtin">len</span> <span class="token number">00008000</span> <span class="token punctuation">(</span><span class="token number">32</span> KiB<span class="token punctuation">)</span><span class="token punctuation">:</span> DRAM
I <span class="token punctuation">(</span><span class="token number">251</span><span class="token punctuation">)</span> heap_init<span class="token punctuation">:</span> At 600FE000 <span class="token builtin">len</span> <span class="token number">00002000</span> <span class="token punctuation">(</span><span class="token number">8</span> KiB<span class="token punctuation">)</span><span class="token punctuation">:</span> RTCRAM
I <span class="token punctuation">(</span><span class="token number">258</span><span class="token punctuation">)</span> spi_flash<span class="token punctuation">:</span> detected chip<span class="token punctuation">:</span> gd
I <span class="token punctuation">(</span><span class="token number">262</span><span class="token punctuation">)</span> spi_flash<span class="token punctuation">:</span> flash io<span class="token punctuation">:</span> qio
W <span class="token punctuation">(</span><span class="token number">265</span><span class="token punctuation">)</span> spi_flash<span class="token punctuation">:</span> Detected size<span class="token punctuation">(</span>16384k<span class="token punctuation">)</span> larger than the size <span class="token keyword">in</span> the binary image header<span class="token punctuation">(</span>2048k<span class="token punctuation">)</span><span class="token punctuation">.</span> Using the size <span class="token keyword">in</span> the binary image header<span class="token punctuation">.</span>
I <span class="token punctuation">(</span><span class="token number">279</span><span class="token punctuation">)</span> sleep<span class="token punctuation">:</span> Configure to isolate <span class="token builtin">all</span> GPIO pins <span class="token keyword">in</span> sleep state
I <span class="token punctuation">(</span><span class="token number">285</span><span class="token punctuation">)</span> sleep<span class="token punctuation">:</span> Enable automatic switching of GPIO sleep configuration
I <span class="token punctuation">(</span><span class="token number">293</span><span class="token punctuation">)</span> cpu_start<span class="token punctuation">:</span> Starting scheduler on PRO CPU<span class="token punctuation">.</span>
I <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> cpu_start<span class="token punctuation">:</span> Starting scheduler on APP CPU<span class="token punctuation">.</span>
x_value<span class="token punctuation">:</span> <span class="token number">0.000000</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token number">0.128340</span>

x_value<span class="token punctuation">:</span> <span class="token number">0.314159</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token number">0.324291</span>

x_value<span class="token punctuation">:</span> <span class="token number">0.628319</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token number">0.551790</span>

x_value<span class="token punctuation">:</span> <span class="token number">0.942478</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token number">0.755303</span>

x_value<span class="token punctuation">:</span> <span class="token number">1.256637</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token number">0.845717</span>

x_value<span class="token punctuation">:</span> <span class="token number">1.570796</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token number">0.723688</span>

x_value<span class="token punctuation">:</span> <span class="token number">1.884956</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token number">0.601659</span>

x_value<span class="token punctuation">:</span> <span class="token number">2.199115</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token number">0.479630</span>

x_value<span class="token punctuation">:</span> <span class="token number">2.513274</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token number">0.357600</span>

x_value<span class="token punctuation">:</span> <span class="token number">2.827433</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token number">0.235571</span>

x_value<span class="token punctuation">:</span> <span class="token number">3.141593</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token number">0.113542</span>

x_value<span class="token punctuation">:</span> <span class="token number">3.455752</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">0.008487</span>

x_value<span class="token punctuation">:</span> <span class="token number">3.769912</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">0.130516</span>

x_value<span class="token punctuation">:</span> <span class="token number">4.084070</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">0.252545</span>

x_value<span class="token punctuation">:</span> <span class="token number">4.398230</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">0.374575</span>

x_value<span class="token punctuation">:</span> <span class="token number">4.712389</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">0.496604</span>

x_value<span class="token punctuation">:</span> <span class="token number">5.026548</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">0.618633</span>

x_value<span class="token punctuation">:</span> <span class="token number">5.340708</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">0.740662</span>

x_value<span class="token punctuation">:</span> <span class="token number">5.654867</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">0.862691</span>

x_value<span class="token punctuation">:</span> <span class="token number">5.969026</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">0.984720</span>

x_value<span class="token punctuation">:</span> <span class="token number">0.000000</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token number">0.128340</span>

x_value<span class="token punctuation">:</span> <span class="token number">0.314159</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token number">0.324291</span>

x_value<span class="token punctuation">:</span> <span class="token number">0.628319</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token number">0.551790</span>

x_value<span class="token punctuation">:</span> <span class="token number">0.942478</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token number">0.755303</span>

x_value<span class="token punctuation">:</span> <span class="token number">1.256637</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token number">0.845717</span>

x_value<span class="token punctuation">:</span> <span class="token number">1.570796</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token number">0.723688</span>

x_value<span class="token punctuation">:</span> <span class="token number">1.884956</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token number">0.601659</span>

x_value<span class="token punctuation">:</span> <span class="token number">2.199115</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token number">0.479630</span>

x_value<span class="token punctuation">:</span> <span class="token number">2.513274</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token number">0.357600</span>

x_value<span class="token punctuation">:</span> <span class="token number">2.827433</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token number">0.235571</span>

x_value<span class="token punctuation">:</span> <span class="token number">3.141593</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token number">0.113542</span>

x_value<span class="token punctuation">:</span> <span class="token number">3.455752</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">0.008487</span>

x_value<span class="token punctuation">:</span> <span class="token number">3.769912</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">0.130516</span>

x_value<span class="token punctuation">:</span> <span class="token number">4.084070</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">0.252545</span>

x_value<span class="token punctuation">:</span> <span class="token number">4.398230</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">0.374575</span>

x_value<span class="token punctuation">:</span> <span class="token number">4.712389</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">0.496604</span>

x_value<span class="token punctuation">:</span> <span class="token number">5.026548</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">0.618633</span>

x_value<span class="token punctuation">:</span> <span class="token number">5.340708</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">0.740662</span>

x_value<span class="token punctuation">:</span> <span class="token number">5.654867</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">0.862691</span>

x_value<span class="token punctuation">:</span> <span class="token number">5.969026</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">0.984720</span>

x_value<span class="token punctuation">:</span> <span class="token number">0.000000</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token number">0.128340</span>

x_value<span class="token punctuation">:</span> <span class="token number">0.314159</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token number">0.324291</span>

x_value<span class="token punctuation">:</span> <span class="token number">0.628319</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token number">0.551790</span>

x_value<span class="token punctuation">:</span> <span class="token number">0.942478</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token number">0.755303</span>

x_value<span class="token punctuation">:</span> <span class="token number">1.256637</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token number">0.845717</span>

x_value<span class="token punctuation">:</span> <span class="token number">1.570796</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token number">0.723688</span>

x_value<span class="token punctuation">:</span> <span class="token number">1.884956</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token number">0.601659</span>

x_value<span class="token punctuation">:</span> <span class="token number">2.199115</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token number">0.479630</span>

x_value<span class="token punctuation">:</span> <span class="token number">2.513274</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token number">0.357600</span>

x_value<span class="token punctuation">:</span> <span class="token number">2.827433</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token number">0.235571</span>

x_value<span class="token punctuation">:</span> <span class="token number">3.141593</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token number">0.113542</span>

x_value<span class="token punctuation">:</span> <span class="token number">3.455752</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">0.008487</span>

x_value<span class="token punctuation">:</span> <span class="token number">3.769912</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">0.130516</span>

x_value<span class="token punctuation">:</span> <span class="token number">4.084070</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">0.252545</span>

x_value<span class="token punctuation">:</span> <span class="token number">4.398230</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">0.374575</span>

x_value<span class="token punctuation">:</span> <span class="token number">4.712389</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">0.496604</span>

x_value<span class="token punctuation">:</span> <span class="token number">5.026548</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">0.618633</span>

x_value<span class="token punctuation">:</span> <span class="token number">5.340708</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">0.740662</span>

x_value<span class="token punctuation">:</span> <span class="token number">5.654867</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">0.862691</span>

x_value<span class="token punctuation">:</span> <span class="token number">5.969026</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">0.984720</span>

x_value<span class="token punctuation">:</span> <span class="token number">0.000000</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token number">0.128340</span>

x_value<span class="token punctuation">:</span> <span class="token number">0.314159</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token number">0.324291</span>

x_value<span class="token punctuation">:</span> <span class="token number">0.628319</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token number">0.551790</span>

x_value<span class="token punctuation">:</span> <span class="token number">0.942478</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token number">0.755303</span>

x_value<span class="token punctuation">:</span> <span class="token number">1.256637</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token number">0.845717</span>

x_value<span class="token punctuation">:</span> <span class="token number">1.570796</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token number">0.723688</span>

x_value<span class="token punctuation">:</span> <span class="token number">1.884956</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token number">0.601659</span>

x_value<span class="token punctuation">:</span> <span class="token number">2.199115</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token number">0.479630</span>

x_value<span class="token punctuation">:</span> <span class="token number">2.513274</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token number">0.357600</span>

x_value<span class="token punctuation">:</span> <span class="token number">2.827433</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token number">0.235571</span>

x_value<span class="token punctuation">:</span> <span class="token number">3.141593</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token number">0.113542</span>

x_value<span class="token punctuation">:</span> <span class="token number">3.455752</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">0.008487</span>

x_value<span class="token punctuation">:</span> <span class="token number">3.769912</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">0.130516</span>

x_value<span class="token punctuation">:</span> <span class="token number">4.084070</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">0.252545</span>

x_value<span class="token punctuation">:</span> <span class="token number">4.398230</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">0.374575</span>

x_value<span class="token punctuation">:</span> <span class="token number">4.712389</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">0.496604</span>

x_value<span class="token punctuation">:</span> <span class="token number">5.026548</span><span class="token punctuation">,</span> y_value<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">0.618633</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/04ac15e7ed27263f73cbfc73bd19b2b7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Redis7.0源码安装与部署</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9cbb27c4662fdfe1207444624b69768a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">YOLOv5可视化界面</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>