<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>12306架构设想（小白的） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="12306架构设想（小白的）" />
<meta property="og:description" content="架构综述 通过对12306业务系统的需求分析之后可以发现，架构设计主要要解决的问题有：数据库高并发读写、有效的容灾机制与系统高可用、数据的安全以及对虚拟化云计算的支持。
为解决上述问题，本架构以混合云为云端架构，采用读写分离的分布式架构设计数据库，使用hadoop与openstack统筹算力资源并组织、管理集群，同时利用双活容灾机制保障系统的高可用。具体架构如下图所示：
所用到的与产品主要包括三个层面：云端、分布式系统以及数据库。云端依靠阿里云与openstack进行混合云的部署。分布式系统主要依托hadoop与openstack作为系统支撑，Pivotal GemFire作为分布式内存对象缓存系统进行部署。数据库采用PostgreSQL作为数据库管理系统，Pivotal GemFire作为内存数据库，同时使用HybridDB为大数据计算提供支持。云产品及其关系如下图所示：
混合云架构设计 混合云是融合公有云和私有云，是近年来云计算的主要模式和发展方向。企业用户出于安全考虑，更愿意将数据存放在私有云中，但是同时又希望可以获得公有云的计算资源，所以可以将业务进行分流，同时使用私有云与共有云。
混合云架构以铁路总公司数据中心与铁科院数据中心为私用云，在保障数据安全的前提下，租用阿里云进行查询业务的分流。分流依靠CDN进行请求的分配，提供高质量的网络服务。
分布式数据库设计 数据库主要由主数据库与下属18个路局的分数据库组成，并采用读写分离机制，主数据库负责数据的写入，分数据库负责数据的读取。数据的写操作主要依赖PostgreSQL进行，而读操作主要依赖GemFire。设计简图如下图所示：
PostgreSQL是一个开源的对象-关系数据库服务器，配合的开源软件很多，很容易做读写分离、负载均衡、数据水平拆分等方案。它在支持大部分 SQL标准的同时有许多现代化的特性和方便快捷的数据结构，这些特性能够解决很多12306的问题如余票统计、单行锁冲突、并行计算等。
GemFire是一个高性能的分布式内存对象缓存系统(内存数据库)。把对象或数据缓存在内存中，减少对传统关系型数据库的读写次数(减少IO瓶颈)，从而使我们的应用支持更多的TPS，更多的并发用户数。GemFire能够在部分场景下对关系型数据库起到很好的补充，能够进行低延迟的余票查询。
数据中心架构设计 数据中心主要由数据库服务器，缓存服务器，web服务器以及业务集群组成，其中业务集群为数据中心的主要算力来源。架构设计图如下所示：
集群与数据中心的组织管理依靠在OpenStack云环境中部署Hadoop集群的方式（主要面向私有云），既最大限度提高了服务器的资源利用率，又大大降低了大数据处理的准入门槛。
Openstack是云操作系统，是将物理机虚拟化的云服务平台，包含各种管理组件及API。它的核心是虚拟化，主要负责云架构系统层的组织与管理。
Hadoop则是“云计算”中分布式计算核心，侧重hdfs云存储与mapreduce云数据分析。它的核心是算力分配，将廉价的计群算力和存储集中。
对于12306系统而言高性能的保障主要由GemFire实现。
GemFire是一个位于应用集群和后端数据源之间的高性能、分布式的操作数据(operational data)管理基础架构。它提供了低延迟、高吞吐量的数据共享和事件分发。GemFire充分利用网络中的内存和磁盘资源，形成一个实时的数据网格，基于内存的海量数据实时处理平台。
它有许多实用的特性：多种网络拓扑、高并发的内存数据结构，避免锁争夺、可选的ACID、序列化和智能缓冲保证消息快速分发、同步或异步写磁盘、冗余内存拷贝。这些特性能够为整个12306系统提供：超低延迟和超高吞吐量、动态的线性扩展能力、持续高可用性、MapReduce并行处理、数据感知路由。
在实际中12306主要面临海量的用户访问带来的高并发问题、余票查询的延迟带来的高流量问题，以及读写分离带来的数据同步问题。
对于高并发问题，GemFire是基于内存的架构，有天然的IO优势，而且本身是分布式数据库，能够分散访问请求，降低负荷。同时很容易实现动态的分布式架构，可以动态添加服务节点。
对于高流量问题，GemFire提供类Map-Reduce的操作以进行并行处理，并将耗时计算单元提前处理，生成查询缓存，即到即用，同时在余票数据变化时动态更新查询缓存。
数据同步则依赖于Gemfire良好的事件处理架构，同时配合Postgresql的异构系统消息服务。具体流程如下图所示：
容灾与高可用设计 容灾主要依赖铁路总公司数据中心与铁科院数据中心实现双活容灾。两个主备数据中心都同时承担用户的业务，此时，主备两个数据中心互为备份，并且进行实时备份。在业务的分配上，铁路总公司数据中心承担较多的业务，保证了当其中一边发生故障时，不至于造成业务无法处理的情况。架构设计图如下所示。
双活的实现依赖openstack的虚拟化系统管理，同时可以配合HybridDB与PostgreSQL，以及GemFire实现仲裁、自动fallover，fallback以及数据同步。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/7a6f0f1162e0a2942878513d2451d1b4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-04-25T16:08:44+08:00" />
<meta property="article:modified_time" content="2019-04-25T16:08:44+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">12306架构设想（小白的）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <ol><li><a name="_Toc6941166"> 架构综述</a></li></ol> 
<p style="margin-left:0cm;">通过对12306业务系统的需求分析之后可以发现，架构设计主要要解决的问题有：数据库高并发读写、有效的容灾机制与系统高可用、数据的安全以及对虚拟化云计算的支持。</p> 
<p style="margin-left:0cm;">为解决上述问题，本架构以混合云为云端架构，采用读写分离的分布式架构设计数据库，使用hadoop与openstack统筹算力资源并组织、管理集群，同时利用双活容灾机制保障系统的高可用。具体架构如下图所示：</p> 
<p style="margin-left:0cm;"><img alt="" class="has" src="https://images2.imgbox.com/b2/8b/dTTy0NYQ_o.png"></p> 
<p style="margin-left:0cm;">所用到的与产品主要包括三个层面：云端、分布式系统以及数据库。云端依靠阿里云与openstack进行混合云的部署。分布式系统主要依托hadoop与openstack作为系统支撑，Pivotal GemFire作为分布式内存对象缓存系统进行部署。数据库采用PostgreSQL作为数据库管理系统，Pivotal GemFire作为内存数据库，同时使用HybridDB为大数据计算提供支持。云产品及其关系如下图所示：</p> 
<p style="margin-left:0cm;"><img alt="" class="has" src="https://images2.imgbox.com/38/5c/KkYff9F9_o.png"></p> 
<ol><li><a name="_Toc6941167">混合云架构设计</a></li></ol> 
<p style="margin-left:0cm;">混合云是融合公有云和私有云，是近年来云计算的主要模式和发展方向。企业用户出于安全考虑，更愿意将数据存放在私有云中，但是同时又希望可以获得公有云的计算资源，所以可以将业务进行分流，同时使用私有云与共有云。</p> 
<p style="margin-left:0cm;">混合云架构以铁路总公司数据中心与铁科院数据中心为私用云，在保障数据安全的前提下，租用阿里云进行查询业务的分流。分流依靠CDN进行请求的分配，提供高质量的网络服务。</p> 
<p style="margin-left:0cm;"><img alt="" class="has" src="https://images2.imgbox.com/12/83/H3PHsJKJ_o.png"></p> 
<ol><li><a name="_Toc6941168"> 分布式数据库设计</a></li></ol> 
<p style="margin-left:0cm;">数据库主要由主数据库与下属18个路局的<a name="_Hlk6937575">分数据库</a>组成，并采用读写分离机制，主数据库负责数据的写入，分数据库负责数据的读取。数据的写操作主要依赖PostgreSQL进行，而读操作主要依赖GemFire。设计简图如下图所示：</p> 
<p style="margin-left:0cm;"><img alt="" class="has" src="https://images2.imgbox.com/a6/a9/ofbDTFlj_o.png"></p> 
<p style="margin-left:0cm;">PostgreSQL是一个开源的对象-关系数据库服务器，配合的开源软件很多，很容易做读写分离、负载均衡、数据水平拆分等方案。它在支持大部分 SQL标准的同时有许多现代化的特性和方便快捷的数据结构，这些特性能够解决很多12306的问题如余票统计、单行锁冲突、并行计算等。</p> 
<p style="margin-left:0cm;">GemFire是一个高性能的分布式内存对象缓存系统(内存数据库)。把对象或数据缓存在内存中，减少对传统关系型数据库的读写次数(减少IO瓶颈)，从而使我们的应用支持更多的TPS，更多的并发用户数。GemFire能够在部分场景下对关系型数据库起到很好的补充，能够进行低延迟的余票查询。</p> 
<ol><li><a name="_Toc6941169"> 数据中心架构设计</a></li></ol> 
<p style="margin-left:0cm;">数据中心主要由数据库服务器，缓存服务器，web服务器以及业务集群组成，其中业务集群为数据中心的主要算力来源。架构设计图如下所示：</p> 
<p style="margin-left:0cm;"><img alt="" class="has" src="https://images2.imgbox.com/39/ba/zobjelUe_o.png"></p> 
<p style="margin-left:0cm;">集群与数据中心的组织管理依靠在OpenStack云环境中部署Hadoop集群的方式（主要面向私有云），既最大限度提高了服务器的资源利用率，又大大降低了大数据处理的准入门槛。</p> 
<p style="margin-left:0cm;">Openstack是云操作系统，是将物理机虚拟化的云服务平台，包含各种管理组件及API。它的核心是虚拟化，主要负责云架构系统层的组织与管理。</p> 
<p style="margin-left:0cm;">Hadoop则是“云计算”中分布式计算核心，侧重hdfs云存储与mapreduce云数据分析。它的核心是算力分配，将廉价的计群算力和存储集中。</p> 
<p style="margin-left:0cm;">对于12306系统而言高性能的保障主要由GemFire实现。</p> 
<p style="margin-left:0cm;">GemFire是一个位于应用集群和后端数据源之间的高性能、分布式的操作数据(operational data)管理基础架构。它提供了低延迟、高吞吐量的数据共享和事件分发。GemFire充分利用网络中的内存和磁盘资源，形成一个实时的数据网格，基于内存的海量数据实时处理平台。</p> 
<p style="margin-left:0cm;">它有许多实用的特性：多种网络拓扑、高并发的内存数据结构，避免锁争夺、可选的ACID、序列化和智能缓冲保证消息快速分发、同步或异步写磁盘、冗余内存拷贝。这些特性能够为整个12306系统提供：超低延迟和超高吞吐量、动态的线性扩展能力、持续高可用性、MapReduce并行处理、数据感知路由。</p> 
<p style="margin-left:0cm;">在实际中12306主要面临海量的用户访问带来的高并发问题、余票查询的延迟带来的高流量问题，以及读写分离带来的数据同步问题。</p> 
<p style="margin-left:0cm;">对于高并发问题，GemFire是基于内存的架构，有天然的IO优势，而且本身是分布式数据库，能够分散访问请求，降低负荷。同时很容易实现动态的分布式架构，可以动态添加服务节点。</p> 
<p style="margin-left:0cm;">对于高流量问题，GemFire提供类Map-Reduce的操作以进行并行处理，并将耗时计算单元提前处理，生成查询缓存，即到即用，同时在余票数据变化时动态更新查询缓存。</p> 
<p style="margin-left:0cm;">数据同步则依赖于Gemfire良好的事件处理架构，同时配合Postgresql的异构系统消息服务。具体流程如下图所示：</p> 
<p style="margin-left:0cm;"><img alt="" class="has" src="https://images2.imgbox.com/60/5b/xlKZWPTz_o.png"></p> 
<ol><li><a name="_Toc6941170"> 容灾与高可用设计</a></li></ol> 
<p style="margin-left:0cm;">容灾主要依赖<a name="_Hlk6940261">铁路总公司数据中心</a>与铁科院数据中心实现双活容灾。两个主备数据中心都同时承担用户的业务，此时，主备两个数据中心互为备份，并且进行实时备份。在业务的分配上，铁路总公司数据中心承担较多的业务，保证了当其中一边发生故障时，不至于造成业务无法处理的情况。架构设计图如下所示。</p> 
<p style="margin-left:0cm;"><img alt="" class="has" src="https://images2.imgbox.com/f2/f0/ysHDOMbc_o.png"></p> 
<p style="margin-left:0cm;">双活的实现依赖openstack的虚拟化系统管理，同时可以配合HybridDB与PostgreSQL，以及GemFire实现仲裁、自动fallover，fallback以及数据同步。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e64dde7c802e1373e915b1cf19086664/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">程序员的十个层次，你属于哪一层？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4789b8481ee4c34bd2a5671c765351bd/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">投机者怎么在市场中使用底部放量进行程序化交易</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>