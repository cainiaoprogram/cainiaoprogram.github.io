<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android Bluetooth OPP的理解与使用之六 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Android Bluetooth OPP的理解与使用之六" />
<meta property="og:description" content="问题点14：如何查看已收到的OPP 文件；
在Android Bluetooth 菜单中，可以看到“Received files”标签；
点击后如图所示：
通过log确认其执行的是BluetoothOppTransferHistory；
确认其是通过广播“com.android.bluetooth.action.TransferHistory”形式拉起来；
对应的是ACTION_OPEN_FILES，在类BluetoothFilesPreferenceController中,其属于packages\apps\Settings\src\com\android\settings\bluetooth，不在Bluetooth.apk中；
问题点15：BluetoothShare.CONTENT_URI中具体存储的内容和
BluetoothOppReceiveFileInfo的generateFileInfo得到的全路径文档的关系是什么；
BluetoothOppObexServerSession的mFileInfo关联了两者；
其在BluetoothOppObexServerSession 的“addShare”中被保存；
而在BluetoothOppObexServerSession 的“onPut”中进行操作写入动作；
Note：实际log显示方法onPut可以长时间运行，这段时间可以通过方法receiveFile完成文件从BluetoothShare.CONTENT_URI输出到全路径名称上；
问题点16: BluetoothOppService中的方法 start在哪被执行的；
---BluetoothOppService 继承于ProfileService，其方法start 和stop是重写了
ProfileService中的实现，通过BluetoothOppService的其方法start 和stop被调用体现在ProfileService的方法doStart和doStop中；
而ProfileService的方法doStart和doStop则被onStartCommand调用；
问题点17：Android Bluetooth中Obex response command定义位置；
在framework层的obex文件夹ResponseCodes.java中；
问题点18：Android Bluetooth OBex定义的最大MAX packet size是；
ObexHelper.MAX_PACKET_SIZE_INT
问题点19：Android Bluetooth OPP的拒绝文件接收请求；
请留意Log “mimeType is null or in unacceptable list, reject the transfer”，在方法onPut中；
Attention：Android Bluetooth OPP 并不是所有文件类型都会接收(存在限制)， 当接收到的文件类型不符时，将拒绝接收；允许接收的具体文件类型定义在
ACCEPTABLE_SHARE_INBOUND_TYPES；" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/12021ccd34efb100dce2df39008561c3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-07-22T07:04:55+08:00" />
<meta property="article:modified_time" content="2022-07-22T07:04:55+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android Bluetooth OPP的理解与使用之六</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="margin-left:0;text-align:justify;"><strong><span style="background-color:#ffff00;"><span style="color:#00b050;">问题点</span></span></strong><strong><span style="background-color:#ffff00;"><span style="color:#00b050;">14</span></span></strong><strong><span style="background-color:#ffff00;"><span style="color:#00b050;">：</span></span></strong><strong><span style="color:#00b050;">如何查看已收到的</span></strong><strong><span style="color:#00b050;">OPP </span></strong><strong><span style="color:#00b050;">文件；</span></strong></p> 
<p style="margin-left:0;text-align:justify;"><span style="color:#0070c0;">在</span><span style="color:#0070c0;">Android Bluetooth </span><span style="color:#0070c0;">菜单中，可以看到“</span><span style="color:#0070c0;">Received files</span><span style="color:#0070c0;">”标签；</span></p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="285" src="https://images2.imgbox.com/5c/33/j3dvyLeM_o.png" width="296"></p> 
<p> <span style="color:#0070c0;">点击后如图所示：</span></p> 
<p><img alt="" height="223" src="https://images2.imgbox.com/eb/4c/WI0XA6XS_o.png" width="254"></p> 
<p><span style="color:#0070c0;">通过</span><span style="color:#0070c0;">log</span><span style="color:#0070c0;">确认其执行的是</span><span style="color:#0070c0;">BluetoothOppTransferHistory</span><span style="color:#0070c0;">；</span></p> 
<p> <img alt="" height="469" src="https://images2.imgbox.com/e9/4f/7kD8lS07_o.png" width="1021"></p> 
<p> <span style="color:#0070c0;">确认其是通过广播“com.android.bluetooth.action.TransferHistory</span><span style="color:#0070c0;">”形式拉起来；</span></p> 
<p style="margin-left:0;text-align:justify;"><span style="color:#0070c0;">对应的是</span><span style="color:#0070c0;">ACTION_OPEN_FILES</span><span style="color:#0070c0;">，在</span><span style="color:#7030a0;">类</span><span style="color:#ff0000;">BluetoothFilesPreferenceController</span><span style="color:#0070c0;">中</span><span style="color:#0070c0;">,</span><span style="color:#0070c0;">其属于</span><span style="color:#0070c0;">packages\apps\</span><span style="color:#ff0000;">Settings</span><span style="color:#0070c0;">\src\com\android\settings\bluetooth</span><span style="color:#0070c0;">，</span><span style="color:#ff0000;">不在</span><span style="color:#ff0000;">Bluetooth.apk</span><span style="color:#ff0000;">中</span><span style="color:#7030a0;">；</span></p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;"><strong><span style="background-color:#ffff00;"><span style="color:#00b050;">问题点</span></span></strong><strong><span style="background-color:#ffff00;"><span style="color:#00b050;">15</span></span></strong><strong><span style="background-color:#ffff00;"><span style="color:#00b050;">：</span></span></strong><strong><span style="color:#00b050;">BluetoothShare.CONTENT_URI</span></strong><strong><span style="color:#00b050;">中具体存储的内容和</span></strong></p> 
<p style="margin-left:0;text-align:justify;"><strong><span style="color:#00b050;">BluetoothOpp</span></strong><strong><span style="color:#ff0000;">Receive</span></strong><strong><span style="color:#00b050;">FileInfo</span></strong><strong><span style="color:#00b050;">的</span></strong><strong><span style="color:#00b050;">generateFileInfo</span></strong><strong><span style="color:#00b050;">得到的全路径文档的关系是什么；</span></strong></p> 
<p style="margin-left:0;text-align:justify;"><span style="color:#0070c0;">BluetoothOppObexServerSession</span><span style="color:#0070c0;">的</span><span style="color:#ff0000;">mFileInfo</span><span style="color:#0070c0;">关联了两者；</span></p> 
<p style="margin-left:0;text-align:justify;"><span style="color:#0070c0;">其在</span><span style="color:#0070c0;">BluetoothOppObexServerSession </span><span style="color:#0070c0;">的“</span><span style="color:#0070c0;">addShare</span><span style="color:#0070c0;">”中被保存；</span></p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="139" src="https://images2.imgbox.com/c1/54/0FUVegMq_o.png" width="511"></p> 
<p> <span style="color:#0070c0;">而在BluetoothOppObexServerSession </span><span style="color:#0070c0;">的“</span><span style="color:#0070c0;">onPut</span><span style="color:#0070c0;">”中进行操作写入动作；</span></p> 
<p style="margin-left:0;text-align:justify;"><span style="color:#ff0000;">Note</span><span style="color:#ff0000;">：实际</span><span style="color:#ff0000;">log</span><span style="color:#ff0000;">显示方法</span><span style="color:#ff0000;">onPut</span><span style="color:#ff0000;">可以长时间运行，</span>这段时间可以通过方法receiveFile完成文件从BluetoothShare.CONTENT_URI输出到全路径名称上；</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;"><strong><span style="background-color:#ffff00;"><span style="color:#00b050;">问题点</span></span></strong><strong><span style="background-color:#ffff00;"><span style="color:#00b050;">16:</span></span></strong><strong><span style="color:#00b050;"> BluetoothOppService</span></strong><strong><span style="color:#00b050;">中的方法</span></strong><strong><span style="color:#00b050;"> start</span></strong><strong><span style="color:#00b050;">在哪被执行的；</span></strong></p> 
<p style="margin-left:0;text-align:justify;"><span style="color:#0d0016;">---BluetoothOppService 继承于ProfileService，其方法start 和stop是重写了</span></p> 
<p style="margin-left:0;text-align:justify;"><span style="color:#0d0016;">ProfileService中的实现，通过BluetoothOppService的其方法start 和stop被调用体现在ProfileService的方法doStart和doStop中；</span></p> 
<p style="margin-left:0;text-align:justify;"><span style="color:#0d0016;">而ProfileService的方法doStart和doStop则被onStartCommand调用；</span></p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;"><strong><span style="background-color:#ffff00;"><span style="color:#00b050;">问题点</span></span></strong><strong><span style="background-color:#ffff00;"><span style="color:#00b050;">17</span></span></strong><strong><span style="background-color:#ffff00;"><span style="color:#00b050;">：</span></span></strong><strong><span style="color:#00b050;">Android Bluetooth</span></strong><strong><span style="color:#00b050;">中</span></strong><strong><span style="color:#00b050;">Obex response command</span></strong><strong><span style="color:#00b050;">定义位置；</span></strong></p> 
<p style="margin-left:0;text-align:justify;"><span style="color:#0070c0;">在</span><span style="color:#0070c0;">framework</span><span style="color:#0070c0;">层的</span><span style="color:#0070c0;">obex</span><span style="color:#0070c0;">文件夹</span><span style="color:#0070c0;">ResponseCodes.java</span><span style="color:#0070c0;">中；</span></p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;"><strong><span style="background-color:#ffff00;"><span style="color:#00b050;">问题点</span></span></strong><strong><span style="background-color:#ffff00;"><span style="color:#00b050;">18</span></span></strong><strong><span style="background-color:#ffff00;"><span style="color:#00b050;">：</span></span><span style="color:#00b050;">Android Bluetooth OBex</span></strong><strong><span style="color:#00b050;">定义的最大</span></strong><strong><span style="color:#00b050;">MAX packet size</span></strong><strong><span style="color:#00b050;">是；</span></strong></p> 
<p style="margin-left:0;text-align:justify;"><span style="color:#0070c0;">ObexHelper.MAX_PACKET_SIZE_INT</span></p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;"><strong><span style="background-color:#ffff00;"><span style="color:#00b050;">问题点</span></span></strong><strong><span style="background-color:#ffff00;"><span style="color:#00b050;">19：</span></span><span style="color:#00b050;">Android Bluetooth OPP的拒绝文件接收请求；</span></strong></p> 
<p style="margin-left:0;text-align:justify;"><span style="color:#0070c0;">请留意</span><span style="color:#0070c0;">Log </span><span style="color:#0070c0;">“</span>mimeType is null or in unacceptable list, reject the transfer<span style="color:#0070c0;">”，在方法</span><span style="color:#0070c0;">onPut</span><span style="color:#0070c0;">中；</span></p> 
<p style="margin-left:0;text-align:justify;"><strong><span style="color:#ff0000;">Attention</span></strong><strong><span style="color:#ff0000;">：</span></strong><span style="color:#ff0000;">Android Bluetooth OPP </span><span style="color:#ff0000;">并不是所有文件类型都会接收</span><span style="color:#ff0000;">(</span><span style="color:#ff0000;">存在限制</span><span style="color:#ff0000;">)</span><span style="color:#ff0000;">，</span> <span style="color:#ff0000;">当接收到的文件类型不符时，将拒绝接收</span>；允许接收的具体文件类型定义在</p> 
<p style="margin-left:0;text-align:justify;"><span style="color:#7030a0;">ACCEPTABLE_SHARE_INBOUND_TYPES</span>；</p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="544" src="https://images2.imgbox.com/41/45/P7t0MEcO_o.png" width="907"></p> 
<p></p> 
<p style="margin-left:0;text-align:justify;"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/55d1dfc399114868908eea9c9a895723/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Android Bluetooth OPP的理解与使用之一</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/77cb5592dadeb95303b729f1d2046223/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">lotus 导出区块高度 最小快照</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>