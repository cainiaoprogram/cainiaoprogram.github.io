<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>js保存文件流 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="js保存文件流" />
<meta property="og:description" content="HTML5可以下载的，不需要后端，纯前端支持。HTML5的一个例子：
var content = &#34;file content!&#34;; var data = new Blob([content],{type:&#34;text/plain;charset=UTF-8&#34;}); var downloadUrl = window.URL.createObjectURL(data); var anchor = document.createElement(&#34;a&#34;); anchor.href = downloadUrl; anchor.download = &#34;文件名.txt&#34;; anchor.click(); window.URL.revokeObjectURL(data); //文件下载 var blob = new Blob([要保存的文件流], { type: &#39;application/octet-stream&#39; }), fileName = &#39;filename&#39; &#43; path.substring(path.lastIndexOf(&#34;.&#34;), path.length); filename，摘取了常用的部分，其实还有其他一些mimetypes = array( &#39;doc&#39; =&gt; &#39;application/msword&#39;, &#39;bin&#39; =&gt; &#39;application/octet-stream&#39;, &#39;exe&#39; =&gt; &#39;application/octet-stream&#39;, &#39;so&#39; =&gt; &#39;application/octet-stream&#39;, &#39;dll&#39; =&gt; &#39;application/octet-stream&#39;, &#39;pdf&#39; =&gt; &#39;application/pdf&#39;, &#39;ai&#39; =&gt; &#39;application/postscript&#39;, &#39;xls&#39; =&gt; &#39;application/vnd." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/343c5aa4e0949348ff8ca55b03ffc38f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-05-10T19:10:52+08:00" />
<meta property="article:modified_time" content="2018-05-10T19:10:52+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">js保存文件流</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><span style="color:rgb(51,51,51);font-family:Helvetica, Tahoma, Arial, sans-serif;font-size:14px;background-color:rgb(255,255,255);">HTML5可以下载的，不需要后端，纯前端支持。HTML5的一个例子：</span><br></p> 
<pre><code class="language-html">var content = "file content!";
var data = new Blob([content],{type:"text/plain;charset=UTF-8"});
var downloadUrl = window.URL.createObjectURL(data);
var anchor = document.createElement("a");
anchor.href = downloadUrl;
anchor.download = "文件名.txt";
anchor.click();
window.URL.revokeObjectURL(data); </code></pre> 
<p><br></p> 
<pre><code class="language-html">                            //文件下载
                            var blob = new Blob([要保存的文件流], { type: 'application/octet-stream' }),
                                fileName = 'filename' + path.substring(path.lastIndexOf("."), path.length);
                            filename，摘取了常用的部分，其实还有其他一些mimetypes = array(
                                'doc'        =&gt; 'application/msword',
                                'bin'        =&gt; 'application/octet-stream',
                                'exe'        =&gt; 'application/octet-stream',
                                'so'        =&gt; 'application/octet-stream',
                                'dll'        =&gt; 'application/octet-stream',
                                'pdf'        =&gt; 'application/pdf',
                                'ai'        =&gt; 'application/postscript',
                                'xls'        =&gt; 'application/vnd.ms-excel',
                                'ppt'        =&gt; 'application/vnd.ms-powerpoint',
                                'dir'        =&gt; 'application/x-director',
                                'js'        =&gt; 'application/x-javascript',
                                'swf'        =&gt; 'application/x-shockwave-flash',
                                'xhtml'        =&gt; 'application/xhtml+xml',
                                'xht'        =&gt; 'application/xhtml+xml',
                                'zip'        =&gt; 'application/zip',
                                'mid'        =&gt; 'audio/midi',
                                'midi'        =&gt; 'audio/midi',
                                'mp3'        =&gt; 'audio/mpeg',
                                'rm'        =&gt; 'audio/x-pn-realaudio',
                                'rpm'        =&gt; 'audio/x-pn-realaudio-plugin',
                                'wav'        =&gt; 'audio/x-wav',
                                'bmp'        =&gt; 'image/bmp',
                                'gif'        =&gt; 'image/gif',
                                'jpeg'        =&gt; 'image/jpeg',
                                'jpg'        =&gt; 'image/jpeg',
                                'png'        =&gt; 'image/png',
                                'css'        =&gt; 'text/css',
                                'html'        =&gt; 'text/html',
                                'htm'        =&gt; 'text/html',
                                'txt'        =&gt; 'text/plain',
                                'xsl'        =&gt; 'text/xml',
                                'xml'        =&gt; 'text/xml',
                                'mpeg'        =&gt; 'video/mpeg',
                                'mpg'        =&gt; 'video/mpeg',
                                'avi'        =&gt; 'video/x-msvideo',
                                'movie'        =&gt; 'video/x-sgi-movie',
                            );
                            downFile(blob, fileName);</code></pre> 
<pre><code class="language-html">  //js下载文件流
    function downFile(blob, fileName) {
        if (window.navigator.msSaveOrOpenBlob) {
            navigator.msSaveBlob(blob, fileName);
        } else {
            var link = document.createElement('a');
            link.href = window.URL.createObjectURL(blob);
            link.download = fileName;
            link.click();
            window.URL.revokeObjectURL(link.href);
        }
    }
</code></pre> 
<pre><code class="language-html"></code></pre> 
<p></p> 
<p><code class="language-html"><span style="color:rgb(51,51,51);font-family:Helvetica, Tahoma, Arial, sans-serif;font-size:14px;background-color:rgb(255,255,255);">因为只是简单html页面，没有后台代码。想通过jquery的函数将返回的json数据内的一个二进制数组保存为文件。</span></code></p> 
<p><code class="language-html"><span style="color:rgb(51,51,51);font-family:Helvetica, Tahoma, Arial, sans-serif;font-size:14px;background-color:rgb(255,255,255);"></span></code></p> 
<p><code class="language-html"><span style="color:rgb(51,51,51);font-family:Helvetica, Tahoma, Arial, sans-serif;font-size:14px;background-color:rgb(255,255,255);"><span style="color:rgb(51,51,51);font-family:Helvetica, Tahoma, Arial, sans-serif;font-size:14px;background-color:rgb(255,255,255);">HTML5可以下载的，不需要后端，纯前端支持。HTML5的一个例子：</span></span></code></p> 
<pre class="html"><code class="language-html">var content = "file content!";
var data = new Blob([content],{type:"text/plain;charset=UTF-8"});
var downloadUrl = window.URL.createObjectURL(data);
var anchor = document.createElement("a");
anchor.href = downloadUrl;
anchor.download = "文件名.txt";
anchor.click();
window.URL.revokeObjectURL(data); </code></pre> 
<p><br></p> 
<p><span style="color:rgb(51,51,51);font-family:Helvetica, Tahoma, Arial, sans-serif;font-size:14px;background-color:rgb(255,255,255);">通过json获得的二进制，应该不是实际意义上的二进制吧？</span><br style="color:rgb(51,51,51);font-family:Helvetica, Tahoma, Arial, sans-serif;font-size:14px;background-color:rgb(255,255,255);"><span style="color:rgb(51,51,51);font-family:Helvetica, Tahoma, Arial, sans-serif;font-size:14px;background-color:rgb(255,255,255);">json中的数组不是TypedArray，需要转化一下。</span><br></p> 
<pre><code class="language-html">var binaryData = [0,0,1,1,1,0,0,0,1,1]; //普通数组
//要保存的数据是10个二进制位，但是一个字节是8位，so，需要16位,2个字节
var binLen = binaryData.length;
var byteLen = Math.ceil(binLen/8);
var buffer = new ArrayBuffer(byteLen ); // 开辟两个字节的缓冲区
var byteData = new Uint8Array(buffer);
for(var i=0; i&lt;byteLen ; i++) { //开始转化为8进制
  byteData[i] = 0;
  for(var j=i*8,k=7; k&gt;=0&amp;&amp;j&lt;binLen; j++,k--) {
    byteData[i] |= binaryData[j] &lt;&lt; k;  
    //用按位或运算，将8个二进制一组地组合到byteData中
  }
}
var data = new Blob([buffer],{type:"application/octet-stream"});
var downloadUrl = window.URL.createObjectURL(data);
var anchor = document.createElement("a");
anchor.href = downloadUrl;
anchor.download = "二进制测试.bin";
anchor.click();
window.URL.revokeObjectURL(data);</code></pre> 
<span style="color:rgb(51,51,51);font-family:Helvetica, Tahoma, Arial, sans-serif;font-size:14px;background-color:rgb(255,255,255);">Blob+ArrayBuffer+URL.createObjectURL+anchor.click，一系列特性，完成了无需后端的文件下载。</span> 
<br style="color:rgb(51,51,51);font-family:Helvetica, Tahoma, Arial, sans-serif;font-size:14px;background-color:rgb(255,255,255);"> 
<br style="color:rgb(51,51,51);font-family:Helvetica, Tahoma, Arial, sans-serif;font-size:14px;background-color:rgb(255,255,255);"> 
<span style="color:rgb(51,51,51);font-family:Helvetica, Tahoma, Arial, sans-serif;font-size:14px;background-color:rgb(255,255,255);">附一张测试下载的结果图</span> 
<br style="color:rgb(51,51,51);font-family:Helvetica, Tahoma, Arial, sans-serif;font-size:14px;background-color:rgb(255,255,255);"> 
<img src="https://images2.imgbox.com/44/98/BiCKwEmM_o.png" alt="" class="image_border" style="border:1px solid rgb(204,204,204);vertical-align:middle;max-width:750px;margin-top:10px;margin-bottom:0px;padding:1px;color:rgb(51,51,51);font-family:Helvetica, Tahoma, Arial, sans-serif;font-size:14px;background-color:rgb(255,255,255);"> 
<br> 
<p><br></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7eb96075d818f2e49821e6fba5400d5f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">node  的path模块中 path.resolve()和path.join()的区别</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e1b95dc6664e7791b2b5675f90543aee/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Linux下搭建FTP服务器教程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>