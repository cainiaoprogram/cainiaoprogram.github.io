<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【SpringData&amp;JPA从入门到精通】03-SpringData-Repository 子接口 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【SpringData&amp;JPA从入门到精通】03-SpringData-Repository 子接口" />
<meta property="og:description" content="笔记来源：尚硅谷SpringData教程(springdata经典，spring data快速上手)
文章目录 Repository 子接口1、Repository 子接口2、CrudRepository 接口3、PagingAndSortingRepository 接口4、JpaRepository 接口5、JpaSpecificationExecutor 接口6、自定义 Repository 方法总结 Repository 子接口 1、Repository 子接口 在之前 01-Repository 中我们介绍过 Repository 的几个子接口，现在重新回顾下这几个子接口的知识
CrudRepository：继承于 Repository，实现了一组 CRUD 相关的方法PagingAndSortingRepository：继承于 CrudRepository，实现了一组分页排序相关的方法JpaRepository：继承于 PagingAndSortingRepository，实现了一组 JPA 规范相关的方法 Repository (org.springframework.data.repository) ----CrudRepository (org.springframework.data.repository) --------PagingAndSortingRepository (org.springframework.data.repository) ------------JpaRepository (org.springframework.data.jpa.repository) 另外，还介绍了
自定义的 XxxRepository：需要继承 JpaRepository，这样的 XxxRepository 接口就具备了通用的数据访问控制层的能力JpaSpecificationExecutor：不属于 Repository 体系，实现一组 JPA Criteria 查询相关的方法 2、CrudRepository 接口 CrudRepository 方法一览
CrudRepository 源码解析
@NoRepositoryBean public interface CrudRepository&lt;T, ID extends Serializable&gt; extends Repository&lt;T, ID&gt; { // 保存实体 &lt;S extends T&gt; S save(S entity); // 保存实体集 &lt;S extends T&gt; Iterable&lt;S&gt; save(Iterable&lt;S&gt; entities); // 通过 id 查找实体 T findOne(ID id); // 判断指定 id 的实体是否存在 boolean exists(ID id); // 返回该类型的所有实例 Iterable&lt;T&gt; findAll(); // 返回指定 ID 类型的所有实例 Iterable&lt;T&gt; findAll(Iterable&lt;ID&gt; ids); // 返回可用实体数 long count(); // 删除指定 ID 的实体 void delete(ID id); // 删除实体 void delete(T entity); // 删除实体集 void delete(Iterable&lt;?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/f9da4ad68a58b7818879f831e4051507/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-05-28T19:45:33+08:00" />
<meta property="article:modified_time" content="2022-05-28T19:45:33+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【SpringData&amp;JPA从入门到精通】03-SpringData-Repository 子接口</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>笔记来源：<a href="https://www.bilibili.com/video/BV1hW411g7jy" rel="nofollow">尚硅谷SpringData教程(springdata经典，spring data快速上手)</a></p> 
</blockquote> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#Repository__3" rel="nofollow">Repository 子接口</a></li><li><ul><li><a href="#1Repository__5" rel="nofollow">1、Repository 子接口</a></li><li><a href="#2CrudRepository__27" rel="nofollow">2、CrudRepository 接口</a></li><li><a href="#3PagingAndSortingRepository__125" rel="nofollow">3、PagingAndSortingRepository 接口</a></li><li><a href="#4JpaRepository__254" rel="nofollow">4、JpaRepository 接口</a></li><li><a href="#5JpaSpecificationExecutor__387" rel="nofollow">5、JpaSpecificationExecutor 接口</a></li><li><a href="#6_Repository__534" rel="nofollow">6、自定义 Repository 方法</a></li><li><a href="#_619" rel="nofollow">总结</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="Repository__3"></a>Repository 子接口</h2> 
<h3><a id="1Repository__5"></a>1、Repository 子接口</h3> 
<p>在之前 <em>01-Repository</em> 中我们介绍过 Repository 的几个子接口，现在重新回顾下这几个子接口的知识</p> 
<ul><li><code>CrudRepository</code>：继承于 Repository，实现了一组 CRUD 相关的方法</li><li><code>PagingAndSortingRepository</code>：继承于 CrudRepository，实现了一组分页排序相关的方法</li><li><code>JpaRepository</code>：继承于 PagingAndSortingRepository，实现了一组 JPA 规范相关的方法</li></ul> 
<pre><code class="prism language-java"><span class="token class-name">Repository</span> <span class="token punctuation">(</span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>repository<span class="token punctuation">)</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token class-name">CrudRepository</span> <span class="token punctuation">(</span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>repository<span class="token punctuation">)</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token class-name">PagingAndSortingRepository</span> <span class="token punctuation">(</span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>repository<span class="token punctuation">)</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token class-name">JpaRepository</span> <span class="token punctuation">(</span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>repository<span class="token punctuation">)</span>
</code></pre> 
<p>另外，还介绍了</p> 
<ul><li><code>自定义的 XxxRepository</code>：需要继承 JpaRepository，这样的 <code>XxxRepository</code> 接口就具备了通用的数据访问控制层的能力</li><li><code>JpaSpecificationExecutor</code>：不属于 Repository 体系，实现一组 JPA Criteria 查询相关的方法</li></ul> 
<h3><a id="2CrudRepository__27"></a>2、CrudRepository 接口</h3> 
<p><code>CrudRepository</code> 方法一览</p> 
<p><img src="https://images2.imgbox.com/13/c9/4f6pZqz6_o.png" alt="image-20220526223923967"></p> 
<p><code>CrudRepository</code> 源码解析</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@NoRepositoryBean</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">CrudRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> ID <span class="token keyword">extends</span> <span class="token class-name">Serializable</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">Repository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> ID<span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 保存实体</span>
	<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">S</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">S</span> entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 保存实体集</span>
	<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> entities<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 通过 id 查找实体</span>
	<span class="token class-name">T</span> <span class="token function">findOne</span><span class="token punctuation">(</span><span class="token class-name">ID</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 判断指定 id 的实体是否存在</span>
	<span class="token keyword">boolean</span> <span class="token function">exists</span><span class="token punctuation">(</span><span class="token class-name">ID</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 返回该类型的所有实例</span>
	<span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 返回指定 ID 类型的所有实例</span>
	<span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span>ID<span class="token punctuation">&gt;</span></span> ids<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 返回可用实体数</span>
	<span class="token keyword">long</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 删除指定 ID 的实体</span>
	<span class="token keyword">void</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">ID</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 删除实体</span>
	<span class="token keyword">void</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">T</span> entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 删除实体集</span>
	<span class="token keyword">void</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> entities<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 删除所有实体</span>
	<span class="token keyword">void</span> <span class="token function">deleteAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>测试方法</strong></p> 
<p>PersonCrudRepository 类</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PersonCrudRepository</span> <span class="token keyword">extends</span> <span class="token class-name">CrudRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
</code></pre> 
<p>PersonService 类</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PersonService</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">PersonCrudRepository</span> personCrudRepository<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Transactional</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">savePersons</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> personList<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        personCrudRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>personList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>Test 类</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSavePersons</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> personList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Person</span> person<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token char">'a'</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token char">'z'</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        person<span class="token punctuation">.</span><span class="token function">setAddressId</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        person<span class="token punctuation">.</span><span class="token function">setBirthDay</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        person<span class="token punctuation">.</span><span class="token function">setLastName</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> i <span class="token operator">+</span> <span class="token string">""</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        person<span class="token punctuation">.</span><span class="token function">setEmail</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> i <span class="token operator">+</span> <span class="token string">""</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> i <span class="token operator">+</span> <span class="token string">"@qq.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        personList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    service<span class="token punctuation">.</span><span class="token function">savePersons</span><span class="token punctuation">(</span>personList<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>日志信息</p> 
<pre><code class="prism language-sql">Hibernate: 
    <span class="token keyword">insert</span> 
    <span class="token keyword">into</span>
        jpa_persons
        <span class="token punctuation">(</span>add_id<span class="token punctuation">,</span> address_id<span class="token punctuation">,</span> birth_day<span class="token punctuation">,</span> email<span class="token punctuation">,</span> last_name<span class="token punctuation">)</span> 
    <span class="token keyword">values</span>
        <span class="token punctuation">(</span>?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">)</span>
<span class="token comment"># ...</span>
</code></pre> 
<p>数据表 <code>JPA_PERSONS</code> 数据</p> 
<p><img src="https://images2.imgbox.com/d4/11/NgcsQcBx_o.png" alt="image-20220526223725209"></p> 
<h3><a id="3PagingAndSortingRepository__125"></a>3、PagingAndSortingRepository 接口</h3> 
<p><code>PagingAndSortingRepository</code> 方法一览</p> 
<p><img src="https://images2.imgbox.com/9e/f8/TP1THUdj_o.png" alt="image-20220526225751913"></p> 
<p><code>PagingAndSortingRepository</code> 源码解析</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@NoRepositoryBean</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PagingAndSortingRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> ID <span class="token keyword">extends</span> <span class="token class-name">Serializable</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">CrudRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> ID<span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 返回按给定选项排序的所有实体</span>
	<span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token class-name">Sort</span> sort<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 返回一个满足分页限制的分页对象</span>
	<span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token class-name">Pageable</span> pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>测试方法</strong></p> 
<p>PersonPagingAndSortingRepository 类</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PersonPagingAndSortingRepository</span> <span class="token keyword">extends</span> <span class="token class-name">PagingAndSortingRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
</code></pre> 
<p>Test 类</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPagingAndSorting</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> pageNo <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 从 0 开始</span>
    <span class="token keyword">int</span> pageSize <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token class-name">Sort</span> sort <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sort</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Sort<span class="token punctuation">.</span>Order</span><span class="token punctuation">(</span><span class="token class-name">Sort<span class="token punctuation">.</span>Direction</span><span class="token punctuation">.</span>ASC<span class="token punctuation">,</span> <span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Sort<span class="token punctuation">.</span>Order</span><span class="token punctuation">(</span><span class="token class-name">Sort<span class="token punctuation">.</span>Direction</span><span class="token punctuation">.</span>DESC<span class="token punctuation">,</span> <span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Pageable</span> pageable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PageRequest</span><span class="token punctuation">(</span>pageNo<span class="token punctuation">,</span> pageSize<span class="token punctuation">,</span> sort<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> page <span class="token operator">=</span> repository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span>pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 格式化输出</span>
    <span class="token class-name">PrintPersonUtil</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>为了更直观且美观地显示 Person 信息，这里我封装了一个输出 Person 信息的类</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PrintPersonUtil</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> page<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">printPageInfo</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printPersonInfo</span><span class="token punctuation">(</span>page<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">printPageInfo</span><span class="token punctuation">(</span><span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> page<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"总计："</span> <span class="token operator">+</span> page<span class="token punctuation">.</span><span class="token function">getTotalElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"条"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"总页数："</span> <span class="token operator">+</span> page<span class="token punctuation">.</span><span class="token function">getTotalPages</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"页"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"当前页：第"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>page<span class="token punctuation">.</span><span class="token function">getNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"页"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"当前页容量："</span> <span class="token operator">+</span> page<span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"条"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"当前页实际数："</span> <span class="token operator">+</span> page<span class="token punctuation">.</span><span class="token function">getNumberOfElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"条"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"当前页内容："</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">printPersonInfo</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> personList<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">AsciiTable</span> at <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AsciiTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        at<span class="token punctuation">.</span><span class="token function">addRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        at<span class="token punctuation">.</span><span class="token function">addRow</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span>ID<span class="token punctuation">,</span> <span class="token class-name">Person</span><span class="token punctuation">.</span>ADDRESSID<span class="token punctuation">,</span> <span class="token class-name">Person</span><span class="token punctuation">.</span>LASTNAME<span class="token punctuation">,</span> <span class="token class-name">Person</span><span class="token punctuation">.</span>EMAIL<span class="token punctuation">)</span><span class="token punctuation">;</span>
        at<span class="token punctuation">.</span><span class="token function">addRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Person</span> person <span class="token operator">:</span> personList<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            at<span class="token punctuation">.</span><span class="token function">addRow</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> person<span class="token punctuation">.</span><span class="token function">getAddressId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> person<span class="token punctuation">.</span><span class="token function">getLastName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> person<span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            at<span class="token punctuation">.</span><span class="token function">addRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>at<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>此类引入了一个如下依赖</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>de.vandermeer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>asciitable<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.3.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>日志信息</p> 
<pre><code class="prism language-sql">Hibernate: 
    <span class="token keyword">select</span>
        <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> col_0_0_ 
    <span class="token keyword">from</span>
        jpa_persons person0_
Hibernate: 
    <span class="token keyword">select</span>
        person0_<span class="token punctuation">.</span>id <span class="token keyword">as</span> id1_1_<span class="token punctuation">,</span>
        person0_<span class="token punctuation">.</span>add_id <span class="token keyword">as</span> add_id6_1_<span class="token punctuation">,</span>
        person0_<span class="token punctuation">.</span>address_id <span class="token keyword">as</span> address_2_1_<span class="token punctuation">,</span>
        person0_<span class="token punctuation">.</span>birth_day <span class="token keyword">as</span> birth_da3_1_<span class="token punctuation">,</span>
        person0_<span class="token punctuation">.</span>email <span class="token keyword">as</span> email4_1_<span class="token punctuation">,</span>
        person0_<span class="token punctuation">.</span>last_name <span class="token keyword">as</span> last_nam5_1_ 
    <span class="token keyword">from</span>
        jpa_persons person0_ 
    <span class="token keyword">order</span> <span class="token keyword">by</span>
        person0_<span class="token punctuation">.</span>id <span class="token keyword">asc</span><span class="token punctuation">,</span>
        person0_<span class="token punctuation">.</span>id <span class="token keyword">desc</span> <span class="token keyword">limit</span> ?<span class="token punctuation">,</span>
        ?
总计：<span class="token number">25</span>条
总页数：<span class="token number">3</span>页
当前页：第<span class="token number">3</span>页
当前页容量：<span class="token number">10</span>条
当前页实际数：<span class="token number">5</span>条
当前页内容：
┌───────────────────┬───────────────────┬───────────────────┬──────────────────┐
│id                 │addressId          │lastName           │email             │
├───────────────────┼───────────────────┼───────────────────┼──────────────────┤
│<span class="token number">223</span>                │<span class="token number">110</span>                │nn                 │nn<span class="token variable">@qq.com</span>         │
├───────────────────┼───────────────────┼───────────────────┼──────────────────┤
│<span class="token number">224</span>                │<span class="token number">120</span>                │xx                 │xx<span class="token variable">@qq.com</span>         │
├───────────────────┼───────────────────┼───────────────────┼──────────────────┤
│<span class="token number">225</span>                │<span class="token number">117</span>                │uu                 │uu<span class="token variable">@qq.com</span>         │
├───────────────────┼───────────────────┼───────────────────┼──────────────────┤
│<span class="token number">316</span>                │<span class="token number">116</span>                │tt                 │tt<span class="token variable">@qq.com</span>         │
├───────────────────┼───────────────────┼───────────────────┼──────────────────┤
│<span class="token number">322</span>                │<span class="token number">107</span>                │kk                 │kk<span class="token variable">@qq.com</span>         │
└───────────────────┴───────────────────┴───────────────────┴──────────────────┘
</code></pre> 
<h3><a id="4JpaRepository__254"></a>4、JpaRepository 接口</h3> 
<p><code>JpaRepository</code> 方法一览</p> 
<p><img src="https://images2.imgbox.com/d4/cf/cuEGU2Sb_o.png" alt="image-20220527202201285"></p> 
<p><code>JpaRepository</code> 源码解析</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@NoRepositoryBean</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> ID <span class="token keyword">extends</span> <span class="token class-name">Serializable</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">PagingAndSortingRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> ID<span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>
	<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token class-name">Sort</span> sort<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span>ID<span class="token punctuation">&gt;</span></span> ids<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> entities<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 刷新对数据库的所有挂起更改</span>
	<span class="token keyword">void</span> <span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 保存实体并立即刷新更改</span>
	<span class="token class-name">T</span> <span class="token function">saveAndFlush</span><span class="token punctuation">(</span><span class="token class-name">T</span> entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 批量删除给定的实体</span>
	<span class="token keyword">void</span> <span class="token function">deleteInBatch</span><span class="token punctuation">(</span><span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> entities<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 删除批量调用中的所有实体</span>
	<span class="token keyword">void</span> <span class="token function">deleteAllInBatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>测试方法 1</strong></p> 
<p>PersonRepository 类</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PersonJpaRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
</code></pre> 
<p>PersonService 类</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PersonService</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">PersonJpaRepository</span> personJpaRepository<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Transactional</span>
    <span class="token keyword">public</span> <span class="token class-name">Person</span> <span class="token function">saveAndFlushPerson</span><span class="token punctuation">(</span><span class="token class-name">Person</span> person<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> personJpaRepository<span class="token punctuation">.</span><span class="token function">saveAndFlush</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>Test 类</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSaveAndFlush</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">Person</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    person<span class="token punctuation">.</span><span class="token function">setLastName</span><span class="token punctuation">(</span><span class="token string">"xy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    person<span class="token punctuation">.</span><span class="token function">setEmail</span><span class="token punctuation">(</span><span class="token string">"xy@qq.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    person<span class="token punctuation">.</span><span class="token function">setBirthDay</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    service<span class="token punctuation">.</span><span class="token function">saveAndFlushPerson</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>日志信息</p> 
<pre><code class="prism language-sql">Hibernate: 
    <span class="token keyword">insert</span> 
    <span class="token keyword">into</span>
        jpa_persons
        <span class="token punctuation">(</span>add_id<span class="token punctuation">,</span> address_id<span class="token punctuation">,</span> birth_day<span class="token punctuation">,</span> email<span class="token punctuation">,</span> last_name<span class="token punctuation">)</span> 
    <span class="token keyword">values</span>
        <span class="token punctuation">(</span>?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">)</span>
</code></pre> 
<p>数据表 <code>JPA_PERSONS</code> 数据</p> 
<p><img src="https://images2.imgbox.com/42/c7/9WYjRZU5_o.png" alt="image-20220527202743847"></p> 
<p><strong>测试方法 2</strong></p> 
<p>Test 类</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSaveAndFlush</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">Person</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    person<span class="token punctuation">.</span><span class="token function">setLastName</span><span class="token punctuation">(</span><span class="token string">"xyyy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    person<span class="token punctuation">.</span><span class="token function">setEmail</span><span class="token punctuation">(</span><span class="token string">"xyyy@qq.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    person<span class="token punctuation">.</span><span class="token function">setBirthDay</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    person<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">324</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Person</span> person2 <span class="token operator">=</span> service<span class="token punctuation">.</span><span class="token function">saveAndFlushPerson</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"person == person2: "</span> <span class="token operator">+</span> <span class="token punctuation">(</span>person <span class="token operator">==</span> person2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>日志信息</p> 
<pre><code class="prism language-sql">Hibernate: 
    <span class="token keyword">select</span>
        person0_<span class="token punctuation">.</span>id <span class="token keyword">as</span> id1_1_0_<span class="token punctuation">,</span>
        person0_<span class="token punctuation">.</span>add_id <span class="token keyword">as</span> add_id6_1_0_<span class="token punctuation">,</span>
        person0_<span class="token punctuation">.</span>address_id <span class="token keyword">as</span> address_2_1_0_<span class="token punctuation">,</span>
        person0_<span class="token punctuation">.</span>birth_day <span class="token keyword">as</span> birth_da3_1_0_<span class="token punctuation">,</span>
        person0_<span class="token punctuation">.</span>email <span class="token keyword">as</span> email4_1_0_<span class="token punctuation">,</span>
        person0_<span class="token punctuation">.</span>last_name <span class="token keyword">as</span> last_nam5_1_0_ 
    <span class="token keyword">from</span>
        jpa_persons person0_ 
    <span class="token keyword">where</span>
        person0_<span class="token punctuation">.</span>id<span class="token operator">=</span>?
Hibernate: 
    <span class="token keyword">update</span>
        jpa_persons 
    <span class="token keyword">set</span>
        add_id<span class="token operator">=</span>?<span class="token punctuation">,</span>
        address_id<span class="token operator">=</span>?<span class="token punctuation">,</span>
        birth_day<span class="token operator">=</span>?<span class="token punctuation">,</span>
        email<span class="token operator">=</span>?<span class="token punctuation">,</span>
        last_name<span class="token operator">=</span>? 
    <span class="token keyword">where</span>
        id<span class="token operator">=</span>?
person <span class="token operator">=</span><span class="token operator">=</span> person2: <span class="token boolean">false</span> 
</code></pre> 
<p>数据表 <code>JPA_PERSONS</code> 数据</p> 
<p><img src="https://images2.imgbox.com/93/d2/D2IKhn9U_o.png" alt="image-20220527202932667"></p> 
<blockquote> 
 <p><strong>小结</strong>：<code>JpaRepository</code> 接口中 <code>saveAndFlush</code> 方法相当于 JPA API 中 EntityManager 对象中的 merge 方法</p> 
</blockquote> 
<h3><a id="5JpaSpecificationExecutor__387"></a>5、JpaSpecificationExecutor 接口</h3> 
<p>不属于 Repository 体系，实现一组 JPA Criteria 查询相关的方法</p> 
<p><code>JpaSpecificationExecutor</code> 方法一览</p> 
<p><img src="https://images2.imgbox.com/bb/85/NCQNnmsr_o.png" alt="image-20220527203906391"></p> 
<p><code>JpaSpecificationExecutor</code> 源码解析</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">JpaSpecificationExecutor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 返回满足匹配条件的单个实体</span>
	<span class="token class-name">T</span> <span class="token function">findOne</span><span class="token punctuation">(</span><span class="token class-name">Specification</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> spec<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 返回满足匹配条件的所有实体</span>
	<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token class-name">Specification</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> spec<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 返回满足匹配条件的Page对象</span>
	<span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token class-name">Specification</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> spec<span class="token punctuation">,</span> <span class="token class-name">Pageable</span> pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 返回满足匹配条件和排序的实体集</span>
	<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token class-name">Specification</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> spec<span class="token punctuation">,</span> <span class="token class-name">Sort</span> sort<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 返回满足匹配条件的实例数</span>
	<span class="token keyword">long</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token class-name">Specification</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> spec<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>其中 <code>Specification</code>：封装 JPA Criteria 查询条件。通常使用匿名内部类的方式来创建该接口的对象</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Specification</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 根据给定的 Criteria 创建一个 WHERE 子句，返回一个 Predicate 作为查询条件 </span>
	<span class="token class-name">Predicate</span> <span class="token function">toPredicate</span><span class="token punctuation">(</span><span class="token class-name">Root</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> root<span class="token punctuation">,</span> <span class="token class-name">CriteriaQuery</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> query<span class="token punctuation">,</span> <span class="token class-name">CriteriaBuilder</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>测试方法</strong></p> 
<blockquote> 
 <p><strong>目标</strong>：实现带查询条件的分页，id &gt; ? 的条件</p> 
 <p>调用 JpaSpecificationExecutor 的 <code>Page&lt;T&gt; findAll(Specification&lt;T&gt; spec, Pageable pageable);</code> 方法</p> 
 <p><code>Specification</code>：封装了 JPA Criteria 的查询条件</p> 
 <p><code>Pageable</code>：封装了请求分页的信息，例如 pageNo，pageSize，Sort</p> 
</blockquote> 
<p>PersonJpaSpecificationExecutor 类</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PersonJpaSpecificationExecutor</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">JpaSpecificationExecutor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p><strong>踩坑</strong>：这里注意不能只继承 <code>JpaSpecificationExecutor</code> 接口，还要至少实现 Repository 接口或其子接口才行</p> 
</blockquote> 
<p>Test 类</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testJpaSpecificationExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// specification：通常使用其匿名内部类</span>
    <span class="token class-name">Specification</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> specification <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Specification</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">/**
         * @param *root：代表查询到的类
         * @param query：可以从中获取 Root 对象，即告知 JPA Criteria 要查询哪一个实体类。
         *             还可以来添加查询条件，还可以结合 EntityManager 对象得到最终查询的 TypedQuery 对象。
         * @param *cb：CriteriaBuilder 对象。用于创建 Criteria 相关对象的工厂，从中获取 Predicate 对象
         * @return *Predicate类型，代表一个查询条件
         */</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">Predicate</span> <span class="token function">toPredicate</span><span class="token punctuation">(</span><span class="token class-name">Root</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> root<span class="token punctuation">,</span> <span class="token class-name">CriteriaQuery</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> query<span class="token punctuation">,</span> <span class="token class-name">CriteriaBuilder</span> cb<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">Path</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> path <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Predicate</span> predicate <span class="token operator">=</span> cb<span class="token punctuation">.</span><span class="token function">gt</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token number">210</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> predicate<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// pageable</span>
    <span class="token class-name">Sort</span> sort <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sort</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Sort<span class="token punctuation">.</span>Order</span><span class="token punctuation">(</span><span class="token class-name">Sort<span class="token punctuation">.</span>Direction</span><span class="token punctuation">.</span>ASC<span class="token punctuation">,</span> <span class="token class-name">Person</span><span class="token punctuation">.</span>ADDRESSID<span class="token punctuation">)</span><span class="token punctuation">,</span>
                         <span class="token keyword">new</span> <span class="token class-name">Sort<span class="token punctuation">.</span>Order</span><span class="token punctuation">(</span><span class="token class-name">Sort<span class="token punctuation">.</span>Direction</span><span class="token punctuation">.</span>ASC<span class="token punctuation">,</span> <span class="token class-name">Person</span><span class="token punctuation">.</span>ID<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Pageable</span> pageable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PageRequest</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> sort<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// page</span>
    <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> page <span class="token operator">=</span> executor<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span>specification<span class="token punctuation">,</span> pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 格式化输出</span>
    <span class="token class-name">PrintPersonUtil</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>其中 root 就是 <em>导航树</em> 的 <em>根</em>（即查询到的类），由此可以 <em>导航</em> 到其 <em>分支</em>（即类的属性）</p> 
<p><img src="https://images2.imgbox.com/0f/1a/B8Zjo8AY_o.png" alt="image-20220527221753652"></p> 
<p>日志信息</p> 
<pre><code class="prism language-sql">Hibernate: 
    <span class="token keyword">select</span>
        <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> col_0_0_ 
    <span class="token keyword">from</span>
        jpa_persons person0_ 
    <span class="token keyword">where</span>
        person0_<span class="token punctuation">.</span>id<span class="token operator">&gt;</span><span class="token number">210</span>
Hibernate: 
    <span class="token keyword">select</span>
        person0_<span class="token punctuation">.</span>id <span class="token keyword">as</span> id1_1_<span class="token punctuation">,</span>
        person0_<span class="token punctuation">.</span>add_id <span class="token keyword">as</span> add_id6_1_<span class="token punctuation">,</span>
        person0_<span class="token punctuation">.</span>address_id <span class="token keyword">as</span> address_2_1_<span class="token punctuation">,</span>
        person0_<span class="token punctuation">.</span>birth_day <span class="token keyword">as</span> birth_da3_1_<span class="token punctuation">,</span>
        person0_<span class="token punctuation">.</span>email <span class="token keyword">as</span> email4_1_<span class="token punctuation">,</span>
        person0_<span class="token punctuation">.</span>last_name <span class="token keyword">as</span> last_nam5_1_ 
    <span class="token keyword">from</span>
        jpa_persons person0_ 
    <span class="token keyword">where</span>
        person0_<span class="token punctuation">.</span>id<span class="token operator">&gt;</span><span class="token number">210</span> 
    <span class="token keyword">order</span> <span class="token keyword">by</span>
        person0_<span class="token punctuation">.</span>address_id <span class="token keyword">asc</span><span class="token punctuation">,</span>
        person0_<span class="token punctuation">.</span>id <span class="token keyword">asc</span> <span class="token keyword">limit</span> ?<span class="token punctuation">,</span>
        ?
总计：<span class="token number">15</span>条
总页数：<span class="token number">3</span>页
当前页：第<span class="token number">3</span>页
当前页容量：<span class="token number">5</span>条
当前页实际数：<span class="token number">5</span>条
当前页内容：
┌───────────────────┬───────────────────┬───────────────────┬──────────────────┐
│id                 │addressId          │lastName           │email             │
├───────────────────┼───────────────────┼───────────────────┼──────────────────┤
│<span class="token number">222</span>                │<span class="token number">112</span>                │pp                 │pp<span class="token variable">@qq.com</span>         │
├───────────────────┼───────────────────┼───────────────────┼──────────────────┤
│<span class="token number">221</span>                │<span class="token number">114</span>                │rr                 │rr<span class="token variable">@qq.com</span>         │
├───────────────────┼───────────────────┼───────────────────┼──────────────────┤
│<span class="token number">316</span>                │<span class="token number">116</span>                │tt                 │tt<span class="token variable">@qq.com</span>         │
├───────────────────┼───────────────────┼───────────────────┼──────────────────┤
│<span class="token number">225</span>                │<span class="token number">117</span>                │uu                 │uu<span class="token variable">@qq.com</span>         │
├───────────────────┼───────────────────┼───────────────────┼──────────────────┤
│<span class="token number">224</span>                │<span class="token number">120</span>                │xx                 │xx<span class="token variable">@qq.com</span>         │
└───────────────────┴───────────────────┴───────────────────┴──────────────────┘
</code></pre> 
<blockquote> 
 <p><strong>踩坑</strong>：本来打算对匿名内部类使用 lambda 表达式进行简化，但执行时报错了，才知道 lambda 表达式是有前提条件的，即：接口必须是<mark>函数式接口</mark></p> 
 <p><em>函数式接口</em> 需要满足两个条件：</p> 
 <ul><li>使用 <code>@FunctionalInterface</code> 注解修饰</li><li>接口中有且仅有一个抽象方法</li></ul> 
 <p>而 <code>Specification</code> 虽然有且仅有一个抽象方法，但并没有使用 <code>@FunctionalInterface</code> 注解修饰，所以不能进行 lambda 简化行为</p> 
</blockquote> 
<h3><a id="6_Repository__534"></a>6、自定义 Repository 方法</h3> 
<ul><li>为某个 Repository 添加自定义方法</li><li>为所有 Repository 添加自定义方法（用的不多，略）</li></ul> 
<p>为某个 Repository 添加自定义方法</p> 
<p><strong>步骤</strong>：</p> 
<ul><li>1）定义一个接口：声明要添加的，并自实现的方法</li><li>2）提供该接口的实现类：类名需在要声明的 Repository 后添加 Impl，并实现方法</li><li>3）声明 Repository 接口，并继承 1）声明的接口</li><li>4）使用</li></ul> 
<p><strong>注意</strong>：默认情况下，Spring Data 会在 <code>base-package</code> 中查找“接口名Impl”作为实现类，也可以通过 <code>repository-impl-postfix</code> 声明后缀</p> 
<p><img src="https://images2.imgbox.com/1e/1d/cxTSYaw1_o.png" alt="image-20220527231650504"></p> 
<p><strong>测试方法</strong></p> 
<p>PersonCustomDao 类</p> 
<pre><code class="prism language-java"><span class="token keyword">interface</span> <span class="token class-name">PersonCustomDao</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token class-name">Person</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>PersonCustomDaoImpl 类</p> 
<pre><code class="prism language-java"><span class="token keyword">class</span> <span class="token class-name">PersonCustomDaoImpl</span> <span class="token keyword">implements</span> <span class="token class-name">PersonCustomDao</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@PersistenceContext</span>
    <span class="token keyword">private</span> <span class="token class-name">EntityManager</span> entityManager<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Person</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> entityManager<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>PersonCustomRepository 类</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PersonCustomRepository</span>
    <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">JpaSpecificationExecutor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">PersonCustomDao</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p><strong>注意</strong>：这里除了实现自定义接口 PersonCustomDao 之外，<code>JpaRepository</code> 接口也是必不可少的（前面 <em>踩坑</em> 提到过）</p> 
 <p>那为什么又要实现 <code>JpaSpecificationExecutor</code> 呢？其实这个并不是必须的，但是自定义接口目的是在基本的 CRUD、分页等行为仍不满足要求时进行弥补。另外，同时继承 <code>JpaRepository</code> 和 <code>JpaSpecificationExecutor</code> 也是很常用的写法，使该接口具备通用的数据访问和操作能力</p> 
</blockquote> 
<p>Test 类</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testCustomRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">Person</span> person <span class="token operator">=</span> repository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token number">221</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>日志信息</p> 
<pre><code class="prism language-sql">Hibernate: 
    <span class="token keyword">select</span>
        person0_<span class="token punctuation">.</span>id <span class="token keyword">as</span> id1_1_<span class="token punctuation">,</span>
        person0_<span class="token punctuation">.</span>add_id <span class="token keyword">as</span> add_id6_1_<span class="token punctuation">,</span>
        person0_<span class="token punctuation">.</span>address_id <span class="token keyword">as</span> address_2_1_<span class="token punctuation">,</span>
        person0_<span class="token punctuation">.</span>birth_day <span class="token keyword">as</span> birth_da3_1_<span class="token punctuation">,</span>
        person0_<span class="token punctuation">.</span>email <span class="token keyword">as</span> email4_1_<span class="token punctuation">,</span>
        person0_<span class="token punctuation">.</span>last_name <span class="token keyword">as</span> last_nam5_1_ 
    <span class="token keyword">from</span>
        jpa_persons person0_ 
    <span class="token keyword">where</span>
        person0_<span class="token punctuation">.</span>id<span class="token operator">=</span>?
Person{id<span class="token operator">=</span><span class="token number">221</span><span class="token punctuation">,</span> addressId<span class="token operator">=</span><span class="token number">114</span><span class="token punctuation">,</span> lastName<span class="token operator">=</span><span class="token string">'rr'</span><span class="token punctuation">,</span> email<span class="token operator">=</span><span class="token string">'rr@qq.com'</span><span class="token punctuation">,</span> birthDay<span class="token operator">=</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">26</span> <span class="token number">22</span>:<span class="token number">34</span>:<span class="token number">33.0</span>}
</code></pre> 
<h3><a id="_619"></a>总结</h3> 
<p>本节主要掌握 Repository 的几个子接口</p> 
<ul><li><code>CrudRepository</code>：增删改查方法</li><li><code>PagingAndSortingRepository</code>：分页查询方法</li><li><code>JpaRepository</code>：JPA 规范方法</li></ul> 
<p>另外，还有两个比较特殊的接口</p> 
<ul><li><code>JpaSpecificationExecutor</code>：带查询的分页</li><li>自定义的 Repository：自实现接口方法</li></ul> 
<p>附上导图，仅供参考</p> 
<p><img src="https://images2.imgbox.com/18/41/1ntCfhqu_o.png" alt="03-Repository 子接口"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/af1bb5207cb52d3afea9110b2d639167/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Java类的构成（成员、域、方法等）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a646a32d34c13c812916fefd68237a73/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">决策引擎系统 &amp;&amp; 实时指标计算 &amp;&amp; 风险态势感知系统 &amp;&amp; 风险数据名单体系 &amp;&amp; 欺诈情报体系</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>