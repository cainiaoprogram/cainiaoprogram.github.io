<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Jetson nano部署YOLOv8 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Jetson nano部署YOLOv8" />
<meta property="og:description" content="目录 前言一、YOLOv8模型训练1. 项目的克隆和必要的环境依赖1.1 项目的克隆1.2 项目代码结构整体介绍1.3 环境安装 2. 数据集和预训练权重的准备2.1 数据集2.2 预训练权重准备 3. 训练模型3.1 修改数据配置文件3.2 修改模型配置文件3.3 训练模型3.4 推理测试 二、YOLOv8模型部署1. 源码下载2. 环境配置2.1 trtexec环境变量设置 3. ONNX导出3.1 静态batch导出3.1.1 Transpose节点的添加3.1.2 Resize节点解析的问题 3.2 动态batch导出3.2.1 exporter.py修改3.2.2 Transpose节点添加3.2.3 Resize节点解析的问题 4. 运行4.1 engine生成4.2 源码修改4.3 编译运行4.4 拓展-摄像头检测4.5 拓展-trtexec参数 结语下载链接参考 前言 开始YOLOv8的模型部署，目的是为大家推荐一个全新的tensorrt仓库https://github.com/shouxieai/infer，大家可以查看我之前的Jetson嵌入式系列模型部署教程，很多细节这里就不再赘述了。考虑到nano的算力，这里采用yolov8n.pt模型，本文主要分享yolov8模型训练和jetson nano部署yolov8两方面的内容。若有问题欢迎各位看官批评指正!!!😄
一、YOLOv8模型训练 先来欣赏下YOLOv8的网络结构😅
yolov8的代码风格和yolov5相差较大，训练流程也稍有差异。博主主要参考魔鬼面具的YOLOv8最强操作.
1. 项目的克隆和必要的环境依赖 1.1 项目的克隆 yolov8的代码是开源的可直接从github官网上下载，源码下载地址是https://github.com/ultralytics/ultralytics，由于yolov8刚发布不久一个固定版本都没有，故只能采用主分支进行模型的训练和部署工作(PS:由于代码更新频繁，可能大家会遇到不同的bug)。Linux下代码克隆指令如下
git clone https://github.com/ultralytics/ultralytics.git 也可手动点击下载，点击右上角的Code按键，将代码下载下来。至此整个项目就已经准备好了。也可以点击here[pwd:yolo]下载博主准备好的代码(注意代码下载于2023/3/14日，若有改动请参考最新)
1.2 项目代码结构整体介绍 将下载后的yolov8的代码解压，其代码目录如下图
只需要关注ultralytics这个文件夹的内容即可，下面对这个文件夹的整体目录做一个介绍
|-assets：存放测试图片|-datasets：存放一些超参数的配置文件以及配置训练集和验证集路径的coco.yaml文件，如果需要修改自己的数据集，那么需要修改其中的yaml文件|-hub：pytorch扩展模型|-models：存放不同模型的yaml文件，包括v3、v5和v8|-nn：存放yolov8整体网络模型搭建的py文件|-tracker：存放yolov8目标跟踪的py文件|-yolo：存放yolov8模型预测、训练、导出的py文件 cfg：存放yolov8的配置文件，包括训练时的参数指定如epoch、batch等以及超参数设置，所有的相关配置都可通过这个文件设置(重点关注cfg/default.yaml文件)data：存放数据加载的py文件engine：存放模型导出的py文件utils：存放工具类函数，包括loss、metrics、plots函数等v8：存放yolov8分类、检测、分割等不同任务的预测、训练以及验证的py文件(重点关注) 1.3 环境安装 关于深度学习的环境安装可参考炮哥的利用Anaconda安装pytorch和paddle深度学习环境&#43;pycharm安装—免额外安装CUDA和cudnn(适合小白的保姆级教学)，这里不再赘述。如果之前配置过yolov5的环境，yolov8可直接使用。
2. 数据集和预训练权重的准备 2.1 数据集 这里采用的数据集是口罩识别，来源于B站UP主HamlinZheng的口罩识别数据集，这里给出下载链接Baidu Drive[password:yolo]，博主将原数据集整合了下，方便后续的训练，解压后整个数据集目录结构如下
VOCdevkit └─VOC2007 ├─Annotations └─JPEGImages 其中JPEGImages中存放的图像文件，Annotations存放的是对应的XML标签文件。关于标签的制作可参考B站UP主霹雳吧啦Wz的PASCAL VOC2012数据集讲解与制作自己的数据集，由于labelimg标注的是VOC格式标签的XML文件，需要转化为YOLO格式标签的txt文件，关于转换的代码可参考炮哥的目标检测—数据集格式转化及训练集和验证集划分，下面给出VOC格式转YOLO格式的代码：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/1e32b081712e140f9539d0cf2633f600/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-11T22:04:17+08:00" />
<meta property="article:modified_time" content="2023-07-11T22:04:17+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Jetson nano部署YOLOv8</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><ul><li><a href="#_2" rel="nofollow">前言</a></li><li><a href="#YOLOv8_6" rel="nofollow">一、YOLOv8模型训练</a></li><li><ul><li><a href="#1__15" rel="nofollow">1. 项目的克隆和必要的环境依赖</a></li><li><ul><li><a href="#11__17" rel="nofollow">1.1 项目的克隆</a></li><li><a href="#12__29" rel="nofollow">1.2 项目代码结构整体介绍</a></li><li><a href="#13__49" rel="nofollow">1.3 环境安装</a></li></ul> 
    </li><li><a href="#2__53" rel="nofollow">2. 数据集和预训练权重的准备</a></li><li><ul><li><a href="#21__55" rel="nofollow">2.1 数据集</a></li><li><a href="#22__250" rel="nofollow">2.2 预训练权重准备</a></li></ul> 
    </li><li><a href="#3__255" rel="nofollow">3. 训练模型</a></li><li><ul><li><a href="#31__261" rel="nofollow">3.1 修改数据配置文件</a></li><li><a href="#32__276" rel="nofollow">3.2 修改模型配置文件</a></li><li><a href="#33__288" rel="nofollow">3.3 训练模型</a></li><li><a href="#34__297" rel="nofollow">3.4 推理测试</a></li></ul> 
   </li></ul> 
   </li><li><a href="#YOLOv8_313" rel="nofollow">二、YOLOv8模型部署</a></li><li><ul><li><a href="#1__317" rel="nofollow">1. 源码下载</a></li><li><a href="#2__327" rel="nofollow">2. 环境配置</a></li><li><ul><li><a href="#21_trtexec_336" rel="nofollow">2.1 trtexec环境变量设置</a></li></ul> 
    </li><li><a href="#3_ONNX_358" rel="nofollow">3. ONNX导出</a></li><li><ul><li><a href="#31_batch_377" rel="nofollow">3.1 静态batch导出</a></li><li><ul><li><a href="#311_Transpose_379" rel="nofollow">3.1.1 Transpose节点的添加</a></li><li><a href="#312_Resize_457" rel="nofollow">3.1.2 Resize节点解析的问题</a></li></ul> 
     </li><li><a href="#32_batch_545" rel="nofollow">3.2 动态batch导出</a></li><li><ul><li><a href="#321_exporterpy_547" rel="nofollow">3.2.1 exporter.py修改</a></li><li><a href="#322_Transpose_588" rel="nofollow">3.2.2 Transpose节点添加</a></li><li><a href="#323_Resize_592" rel="nofollow">3.2.3 Resize节点解析的问题</a></li></ul> 
    </li></ul> 
    </li><li><a href="#4__657" rel="nofollow">4. 运行</a></li><li><ul><li><a href="#41_engine_659" rel="nofollow">4.1 engine生成</a></li><li><a href="#42__685" rel="nofollow">4.2 源码修改</a></li><li><a href="#43__713" rel="nofollow">4.3 编译运行</a></li><li><a href="#44__825" rel="nofollow">4.4 拓展-摄像头检测</a></li><li><a href="#45_trtexec_887" rel="nofollow">4.5 拓展-trtexec参数</a></li></ul> 
   </li></ul> 
   </li><li><a href="#_916" rel="nofollow">结语</a></li><li><a href="#_920" rel="nofollow">下载链接</a></li><li><a href="#_929" rel="nofollow">参考</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="_2"></a>前言</h3> 
<blockquote> 
 <p>开始YOLOv8的模型部署，目的是为大家推荐一个全新的tensorrt仓库<a href="https://github.com/shouxieai/infer">https://github.com/shouxieai/infer</a>，大家可以查看我之前的<a href="https://blog.csdn.net/qq_40672115/category_11970990.html?spm=1001.2014.3001.5482">Jetson嵌入式系列模型部署教程</a>，很多细节这里就不再赘述了。考虑到nano的算力，这里采用yolov8n.pt模型，本文主要分享yolov8模型训练和jetson nano部署yolov8两方面的内容。若有问题欢迎各位看官批评指正!!!😄</p> 
</blockquote> 
<h3><a id="YOLOv8_6"></a>一、YOLOv8模型训练</h3> 
<p>先来欣赏下YOLOv8的网络结构😅</p> 
<p><img src="https://images2.imgbox.com/b9/0a/JB7vHxgX_o.png" alt="在这里插入图片描述"></p> 
<p>yolov8的代码风格和yolov5相差较大，训练流程也稍有差异。博主主要参考魔鬼面具的<a href="https://blog.csdn.net/qq_37706472/article/details/128679699?spm=1001.2014.3001.5502">YOLOv8最强操作.</a></p> 
<h4><a id="1__15"></a>1. 项目的克隆和必要的环境依赖</h4> 
<h5><a id="11__17"></a>1.1 项目的克隆</h5> 
<p>yolov8的代码是开源的可直接从github官网上下载，源码下载地址是<a href="https://github.com/ultralytics/ultralytics">https://github.com/ultralytics/ultralytics</a>，由于yolov8刚发布不久一个固定版本都没有，故只能采用<strong>主分支进行模型的训练和部署工作</strong>(PS:由于代码更新频繁，可能大家会遇到不同的bug)。Linux下代码克隆指令如下</p> 
<pre><code class="prism language-shell"><span class="token function">git</span> clone https://github.com/ultralytics/ultralytics.git
</code></pre> 
<p>也可手动点击下载，点击右上角的<code>Code</code>按键，将代码下载下来。至此整个项目就已经准备好了。也可以点击<a href="https://pan.baidu.com/s/1c50iU7PLwhJfAsCDYs9bvw" rel="nofollow">here[pwd:yolo]</a>下载博主准备好的代码(<strong>注意代码下载于2023/3/14日，若有改动请参考最新</strong>)</p> 
<p><img src="https://images2.imgbox.com/94/36/Npm3mAmk_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="12__29"></a>1.2 项目代码结构整体介绍</h5> 
<p>将下载后的yolov8的代码解压，其代码目录如下图</p> 
<p><img src="https://images2.imgbox.com/da/47/IFofOGrK_o.png" alt="在这里插入图片描述"><br> 只需要关注ultralytics这个文件夹的内容即可，下面对这个文件夹的整体目录做一个介绍</p> 
<ul><li><strong>|-assets</strong>：存放测试图片</li><li><strong>|-datasets</strong>：存放一些超参数的配置文件以及配置训练集和验证集路径的coco.yaml文件，如果需要修改自己的数据集，那么需要修改其中的yaml文件</li><li><strong>|-hub</strong>：pytorch扩展模型</li><li><strong>|-models</strong>：存放不同模型的yaml文件，包括v3、v5和v8</li><li><strong>|-nn</strong>：存放yolov8整体网络模型搭建的py文件</li><li><strong>|-tracker</strong>：存放yolov8目标跟踪的py文件</li><li><strong>|-yolo</strong>：存放yolov8模型预测、训练、导出的py文件 
  <ul><li><strong>cfg</strong>：存放yolov8的配置文件，包括训练时的参数指定如epoch、batch等以及超参数设置，所有的相关配置都可通过这个文件设置(<strong>重点关注cfg/default.yaml文件</strong>)</li><li><strong>data</strong>：存放数据加载的py文件</li><li><strong>engine</strong>：存放模型导出的py文件</li><li><strong>utils</strong>：存放工具类函数，包括loss、metrics、plots函数等</li><li><strong>v8</strong>：存放yolov8分类、检测、分割等不同任务的预测、训练以及验证的py文件(<strong>重点关注</strong>)</li></ul> </li></ul> 
<h5><a id="13__49"></a>1.3 环境安装</h5> 
<p>关于深度学习的环境安装可参考炮哥的<a href="https://blog.csdn.net/didiaopao/article/details/119787139?spm=1001.2014.3001.5501">利用Anaconda安装pytorch和paddle深度学习环境+pycharm安装—免额外安装CUDA和cudnn(适合小白的保姆级教学)</a>，这里不再赘述。如果之前配置过yolov5的环境，yolov8可直接使用。</p> 
<h4><a id="2__53"></a>2. 数据集和预训练权重的准备</h4> 
<h5><a id="21__55"></a>2.1 数据集</h5> 
<p>这里采用的数据集是口罩识别，来源于<a href="https://space.bilibili.com/73270408" rel="nofollow">B站UP主HamlinZheng</a>的<a href="https://www.bilibili.com/video/BV1i7411376y?spm_id_from=333.337.search-card.all.click&amp;vd_source=2306b3f342c070c8a11931c94eafa8e3" rel="nofollow">口罩识别数据集</a>，这里给出下载链接<a href="https://pan.baidu.com/s/1oeBugM-bqRN6QFnVgXi5HQ" rel="nofollow">Baidu Drive[password:yolo]</a>，博主将原数据集整合了下，方便后续的训练，解压后整个数据集目录结构如下</p> 
<pre><code class="prism language-shell">VOCdevkit
   └─VOC2007
       ├─Annotations
       └─JPEGImages
</code></pre> 
<p>其中JPEGImages中存放的图像文件，Annotations存放的是对应的XML标签文件。关于标签的制作可参考<a href="https://space.bilibili.com/18161609?spm_id_from=333.337.0.0" rel="nofollow">B站UP主霹雳吧啦Wz</a>的<a href="https://www.bilibili.com/video/BV1kV411k7D8?vd_source=2306b3f342c070c8a11931c94eafa8e3" rel="nofollow">PASCAL VOC2012数据集讲解与制作自己的数据集</a>，<strong>由于labelimg标注的是VOC格式标签的XML文件，需要转化为YOLO格式标签的txt文件</strong>，关于转换的代码可参考炮哥的<a href="https://blog.csdn.net/didiaopao/article/details/120022845?spm=1001.2014.3001.5502">目标检测—数据集格式转化及训练集和验证集划分</a>，下面给出VOC格式转YOLO格式的代码：</p> 
<pre><code class="prism language-python"><span class="token comment"># voc2yolo.py</span>
<span class="token keyword">import</span> xml<span class="token punctuation">.</span>etree<span class="token punctuation">.</span>ElementTree <span class="token keyword">as</span> ET
<span class="token keyword">import</span> pickle
<span class="token keyword">import</span> os
<span class="token keyword">from</span> os <span class="token keyword">import</span> listdir<span class="token punctuation">,</span> getcwd
<span class="token keyword">from</span> os<span class="token punctuation">.</span>path <span class="token keyword">import</span> join
<span class="token keyword">import</span> random
<span class="token keyword">from</span> shutil <span class="token keyword">import</span> copyfile

<span class="token comment"># 1. 修改为自制数据集需检测的类别数</span>
classes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"have_mask"</span><span class="token punctuation">,</span> <span class="token string">"no_mask"</span><span class="token punctuation">]</span>

<span class="token comment"># 2. 训练集和验证集的比例</span>
TRAIN_RATIO <span class="token operator">=</span> <span class="token number">80</span>


<span class="token keyword">def</span> <span class="token function">clear_hidden_files</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">:</span>
    dir_list <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>path<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> dir_list<span class="token punctuation">:</span>
        abspath <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>
        <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isfile<span class="token punctuation">(</span>abspath<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> i<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">"._"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>abspath<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            clear_hidden_files<span class="token punctuation">(</span>abspath<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">convert</span><span class="token punctuation">(</span>size<span class="token punctuation">,</span> box<span class="token punctuation">)</span><span class="token punctuation">:</span>
    dw <span class="token operator">=</span> <span class="token number">1.</span> <span class="token operator">/</span> size<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    dh <span class="token operator">=</span> <span class="token number">1.</span> <span class="token operator">/</span> size<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    x <span class="token operator">=</span> <span class="token punctuation">(</span>box<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> box<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2.0</span>
    y <span class="token operator">=</span> <span class="token punctuation">(</span>box<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> box<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2.0</span>
    w <span class="token operator">=</span> box<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> box<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    h <span class="token operator">=</span> box<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">-</span> box<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
    x <span class="token operator">=</span> x <span class="token operator">*</span> dw
    w <span class="token operator">=</span> w <span class="token operator">*</span> dw
    y <span class="token operator">=</span> y <span class="token operator">*</span> dh
    h <span class="token operator">=</span> h <span class="token operator">*</span> dh
    <span class="token keyword">return</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">convert_annotation</span><span class="token punctuation">(</span>image_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
    in_file <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'VOCdevkit/VOC2007/Annotations/%s.xml'</span> <span class="token operator">%</span> image_id<span class="token punctuation">)</span>
    out_file <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'VOCdevkit/VOC2007/YOLOLabels/%s.txt'</span> <span class="token operator">%</span> image_id<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>
    tree <span class="token operator">=</span> ET<span class="token punctuation">.</span>parse<span class="token punctuation">(</span>in_file<span class="token punctuation">)</span>
    root <span class="token operator">=</span> tree<span class="token punctuation">.</span>getroot<span class="token punctuation">(</span><span class="token punctuation">)</span>
    size <span class="token operator">=</span> root<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'size'</span><span class="token punctuation">)</span>
    w <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>size<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'width'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    h <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>size<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'height'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span>

    <span class="token keyword">for</span> obj <span class="token keyword">in</span> root<span class="token punctuation">.</span><span class="token builtin">iter</span><span class="token punctuation">(</span><span class="token string">'object'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        difficult <span class="token operator">=</span> obj<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'difficult'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text
        cls <span class="token operator">=</span> obj<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text
        <span class="token keyword">if</span> cls <span class="token keyword">not</span> <span class="token keyword">in</span> classes <span class="token keyword">or</span> <span class="token builtin">int</span><span class="token punctuation">(</span>difficult<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
            <span class="token keyword">continue</span>
        cls_id <span class="token operator">=</span> classes<span class="token punctuation">.</span>index<span class="token punctuation">(</span>cls<span class="token punctuation">)</span>
        xmlbox <span class="token operator">=</span> obj<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'bndbox'</span><span class="token punctuation">)</span>
        b <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>xmlbox<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'xmin'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">(</span>xmlbox<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'xmax'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">(</span>xmlbox<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'ymin'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">,</span>
             <span class="token builtin">float</span><span class="token punctuation">(</span>xmlbox<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'ymax'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span>
        bb <span class="token operator">=</span> convert<span class="token punctuation">(</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span>
        out_file<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>cls_id<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> <span class="token string">" "</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token keyword">for</span> a <span class="token keyword">in</span> bb<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'\n'</span><span class="token punctuation">)</span>
    in_file<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    out_file<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>


wd <span class="token operator">=</span> os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span>
wd <span class="token operator">=</span> os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span>
data_base_dir <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>wd<span class="token punctuation">,</span> <span class="token string">"VOCdevkit/"</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isdir<span class="token punctuation">(</span>data_base_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>data_base_dir<span class="token punctuation">)</span>
work_sapce_dir <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>data_base_dir<span class="token punctuation">,</span> <span class="token string">"VOC2007/"</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isdir<span class="token punctuation">(</span>work_sapce_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>work_sapce_dir<span class="token punctuation">)</span>
annotation_dir <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>work_sapce_dir<span class="token punctuation">,</span> <span class="token string">"Annotations/"</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isdir<span class="token punctuation">(</span>annotation_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>annotation_dir<span class="token punctuation">)</span>
clear_hidden_files<span class="token punctuation">(</span>annotation_dir<span class="token punctuation">)</span>
image_dir <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>work_sapce_dir<span class="token punctuation">,</span> <span class="token string">"JPEGImages/"</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isdir<span class="token punctuation">(</span>image_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>image_dir<span class="token punctuation">)</span>
clear_hidden_files<span class="token punctuation">(</span>image_dir<span class="token punctuation">)</span>
yolo_labels_dir <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>work_sapce_dir<span class="token punctuation">,</span> <span class="token string">"YOLOLabels/"</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isdir<span class="token punctuation">(</span>yolo_labels_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>yolo_labels_dir<span class="token punctuation">)</span>
clear_hidden_files<span class="token punctuation">(</span>yolo_labels_dir<span class="token punctuation">)</span>
yolov5_images_dir <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>data_base_dir<span class="token punctuation">,</span> <span class="token string">"images/"</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isdir<span class="token punctuation">(</span>yolov5_images_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>yolov5_images_dir<span class="token punctuation">)</span>
clear_hidden_files<span class="token punctuation">(</span>yolov5_images_dir<span class="token punctuation">)</span>
yolov5_labels_dir <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>data_base_dir<span class="token punctuation">,</span> <span class="token string">"labels/"</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isdir<span class="token punctuation">(</span>yolov5_labels_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>yolov5_labels_dir<span class="token punctuation">)</span>
clear_hidden_files<span class="token punctuation">(</span>yolov5_labels_dir<span class="token punctuation">)</span>
yolov5_images_train_dir <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>yolov5_images_dir<span class="token punctuation">,</span> <span class="token string">"train/"</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isdir<span class="token punctuation">(</span>yolov5_images_train_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>yolov5_images_train_dir<span class="token punctuation">)</span>
clear_hidden_files<span class="token punctuation">(</span>yolov5_images_train_dir<span class="token punctuation">)</span>
yolov5_images_test_dir <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>yolov5_images_dir<span class="token punctuation">,</span> <span class="token string">"val/"</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isdir<span class="token punctuation">(</span>yolov5_images_test_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>yolov5_images_test_dir<span class="token punctuation">)</span>
clear_hidden_files<span class="token punctuation">(</span>yolov5_images_test_dir<span class="token punctuation">)</span>
yolov5_labels_train_dir <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>yolov5_labels_dir<span class="token punctuation">,</span> <span class="token string">"train/"</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isdir<span class="token punctuation">(</span>yolov5_labels_train_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>yolov5_labels_train_dir<span class="token punctuation">)</span>
clear_hidden_files<span class="token punctuation">(</span>yolov5_labels_train_dir<span class="token punctuation">)</span>
yolov5_labels_test_dir <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>yolov5_labels_dir<span class="token punctuation">,</span> <span class="token string">"val/"</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isdir<span class="token punctuation">(</span>yolov5_labels_test_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>yolov5_labels_test_dir<span class="token punctuation">)</span>
clear_hidden_files<span class="token punctuation">(</span>yolov5_labels_test_dir<span class="token punctuation">)</span>

train_file <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>wd<span class="token punctuation">,</span> <span class="token string">"yolov5_train.txt"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>
test_file <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>wd<span class="token punctuation">,</span> <span class="token string">"yolov5_val.txt"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>
train_file<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
test_file<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
train_file <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>wd<span class="token punctuation">,</span> <span class="token string">"yolov5_train.txt"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">)</span>
test_file <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>wd<span class="token punctuation">,</span> <span class="token string">"yolov5_val.txt"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">)</span>
list_imgs <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>image_dir<span class="token punctuation">)</span>  <span class="token comment"># list image files</span>
prob <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Probability: %d"</span> <span class="token operator">%</span> prob<span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>list_imgs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>image_dir<span class="token punctuation">,</span> list_imgs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isfile<span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        image_path <span class="token operator">=</span> image_dir <span class="token operator">+</span> list_imgs<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        voc_path <span class="token operator">=</span> list_imgs<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        <span class="token punctuation">(</span>nameWithoutExtention<span class="token punctuation">,</span> extention<span class="token punctuation">)</span> <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>splitext<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>basename<span class="token punctuation">(</span>image_path<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">(</span>voc_nameWithoutExtention<span class="token punctuation">,</span> voc_extention<span class="token punctuation">)</span> <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>splitext<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>basename<span class="token punctuation">(</span>voc_path<span class="token punctuation">)</span><span class="token punctuation">)</span>
        annotation_name <span class="token operator">=</span> nameWithoutExtention <span class="token operator">+</span> <span class="token string">'.xml'</span>
        annotation_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>annotation_dir<span class="token punctuation">,</span> annotation_name<span class="token punctuation">)</span>
        label_name <span class="token operator">=</span> nameWithoutExtention <span class="token operator">+</span> <span class="token string">'.txt'</span>
        label_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>yolo_labels_dir<span class="token punctuation">,</span> label_name<span class="token punctuation">)</span>
    prob <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Probability: %d"</span> <span class="token operator">%</span> prob<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>prob <span class="token operator">&lt;</span> TRAIN_RATIO<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># train dataset</span>
        <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>annotation_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
            train_file<span class="token punctuation">.</span>write<span class="token punctuation">(</span>image_path <span class="token operator">+</span> <span class="token string">'\n'</span><span class="token punctuation">)</span>
            convert_annotation<span class="token punctuation">(</span>nameWithoutExtention<span class="token punctuation">)</span>  <span class="token comment"># convert label</span>
            copyfile<span class="token punctuation">(</span>image_path<span class="token punctuation">,</span> yolov5_images_train_dir <span class="token operator">+</span> voc_path<span class="token punctuation">)</span>
            copyfile<span class="token punctuation">(</span>label_path<span class="token punctuation">,</span> yolov5_labels_train_dir <span class="token operator">+</span> label_name<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>  <span class="token comment"># test dataset</span>
        <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>annotation_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
            test_file<span class="token punctuation">.</span>write<span class="token punctuation">(</span>image_path <span class="token operator">+</span> <span class="token string">'\n'</span><span class="token punctuation">)</span>
            convert_annotation<span class="token punctuation">(</span>nameWithoutExtention<span class="token punctuation">)</span>  <span class="token comment"># convert label</span>
            copyfile<span class="token punctuation">(</span>image_path<span class="token punctuation">,</span> yolov5_images_test_dir <span class="token operator">+</span> voc_path<span class="token punctuation">)</span>
            copyfile<span class="token punctuation">(</span>label_path<span class="token punctuation">,</span> yolov5_labels_test_dir <span class="token operator">+</span> label_name<span class="token punctuation">)</span>
train_file<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
test_file<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>代码总共需要修改两处</p> 
<ul><li><strong>第11行，修改要检测的类别名称</strong></li><li><strong>第14行，修改训练集和验证集的划分比例</strong></li></ul> 
<p>整个目录结构如下，注意<code>voc2yolo.py</code>与<code>VOCdevkit</code>处于<strong>同一级目录</strong></p> 
<pre><code class="prism language-shell">VOCdevkit
   └─VOC2007
       ├─Annotations
       └─JPEGImages
voc2yolo.py
</code></pre> 
<p><strong>注</strong>：目录结构一定要与博主的一致，因为程序已经将对应目录写死。</p> 
<p>运行<code>voc2yolo.py</code>代码之后得到如下结果<br> <img src="https://images2.imgbox.com/b3/2b/Bya0ep2B_o.png" alt="在这里插入图片描述"><br> 可以看到目录下有一些新的文件生成，首先VOCdevkit文件夹下分别生成了images和labels文件夹，分别存放着图像和对应的<strong>yolo格式的标签文件</strong>，每个文件夹下分别包含train和val两个子文件夹，代表各自对应的训练集和验证集。VOC2007文件夹下生成了YOLOLabels文件夹，存放着对应yolo格式的标签文件。然后还生成了<code>yolov5_train.txt</code>以及<code>yolov5_val.txt</code>两个txt文件，存放着训练集和验证集图片的完整路径。<strong>yolov8的训练只需要VOCdevkit目录下的images和labels两个文件夹，其它均不需要</strong>，故最终的目录结构如下</p> 
<pre><code class="prism language-shell">VOCdevkit
    ├─images
    │  ├─train
    │  └─val
    └─labels
        ├─train
        └─val
</code></pre> 
<p>至此，数据集的准备工作完毕。</p> 
<h5><a id="22__250"></a>2.2 预训练权重准备</h5> 
<p>yolov8预训练权重可以通过<a href="https://github.com/ultralytics/ultralytics">here</a>找到下图的Models，然后点击不同大小的权重即可下载，博主也提供下载好的几个预训练权重<a href="https://pan.baidu.com/s/1zvqKaalugR-zKhugDikfDA" rel="nofollow">Baidu Drive[pwd:yolo]</a>，<strong>注意这是yolov8没固定版本的预训练权重，若后续有版本更新，记得替换</strong>。本次训练自己的数据集使用的预训练权重为<code>yolov8n.pt</code></p> 
<p><img src="https://images2.imgbox.com/7d/8e/vP7hx8zt_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="3__255"></a>3. 训练模型</h4> 
<p>将准备好的数据集文件夹即VOCdevkit复制到yolov8项目环境中的<code>ultralytics-main/ultralytics/datasets</code>文件夹下，将准备好的预训练权重<code>yolov8n.pt</code>复制到yolov8项目环境中的<code>ultralytics-main/ultralytics/yolo/v8/detect</code>文件夹下。训练目标检测模型主要修改模型配置文件<code>ultralytics-main/ultralytics/yolo/cfg/default.yaml</code>以及数据配置文件<code>ultralytics-main/ultralytics/datasets/coco128.yaml</code>，项目结构如下所示</p> 
<p><img src="https://images2.imgbox.com/2e/13/njcVPlsN_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="31__261"></a>3.1 修改数据配置文件</h5> 
<p>修改ultralytics/datasets目录下相应的yaml文件，找到该目录下的<code>coco128.yaml</code>文件，主要修改如下：</p> 
<ul><li> <p><strong>1.修改第11行的数据集的路径</strong></p> </li><li> <p><strong>2.修改第12行的train的路径</strong></p> </li><li> <p><strong>3.修改第13行的val路径</strong></p> </li><li> <p><strong>4.修改第17行的需要检测的类别名称</strong></p> </li><li> <p><strong>5.注释最后一行，取消coco数据集的下载</strong></p> </li></ul> 
<p><img src="https://images2.imgbox.com/bc/70/nTa2qpmA_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="32__276"></a>3.2 修改模型配置文件</h5> 
<p>修改ultralytics/yolo/cfg目录下对应的yaml文件，找到该目录下的<code>default.yaml</code>文件，主要修改如下：</p> 
<ul><li> <p><strong>1.修改第8行的模型文件，指定yolov8n.pt</strong></p> </li><li> <p><strong>2.修改第9行的数据文件路径，即3.1节的coco128.yaml</strong></p> </li></ul> 
<p><img src="https://images2.imgbox.com/0c/13/HlbYbnkR_o.png" alt="在这里插入图片描述"></p> 
<p>还有其它参数博主并未修改，如<strong>epoches</strong>训练轮数、<strong>batch</strong>批处理量等等，<strong>大家一定要根据自己的实际情况(如显卡算力等)指定不同的参数</strong>，如果你之前训练过yolov5，那我相信这对你来说应该是小case😄</p> 
<h5><a id="33__288"></a>3.3 训练模型</h5> 
<p>按照上面的步骤完成修改后可以找到yolo/v8/detect/train.py文件，点击运行即可开始训练。</p> 
<p>博主训练的模型为yolov8n.pt且使用的是单个GPU进行训练，显卡为RTX3060，操作系统为Windows10，pytorch版本为1.12.1，训练时长大概1.6个小时。</p> 
<p><img src="https://images2.imgbox.com/5e/b8/o9YlIQFl_o.png" alt="在这里插入图片描述"><br> 训练完成后的模型权重保存在runs/detect/train/weights文件夹下，后续使用<code>best.pt</code>进行后续模型部署工作即可，这里提供博主训练好的权重文件下载链接<a href="https://pan.baidu.com/s/193prud3xw-SmG8ercjZlug" rel="nofollow">Baidu Driver[pwd:yolo]</a></p> 
<h5><a id="34__297"></a>3.4 推理测试</h5> 
<p>利用项目中的<code>yolo/v8/detect/predict.py</code>文件进行测试，将需要推理的图片放入ultralytics/assets文件夹下，将刚训练的口罩识别权重文件放入yolo/v8/detect文件夹下，最后在predict.py文件第86行指定刚训练的模型权重文件best.pt如下所示，点击运行predict.py即可执行测试</p> 
<pre><code class="prism language-python">model <span class="token operator">=</span> <span class="token string">'best.pt'</span>   <span class="token comment"># predict.py第86行修改</span>
</code></pre> 
<p>推理完成后会在detect/runs文件夹下生成一个detect/train目录，推理的结果保存在此目录下，推理结果如下所示</p> 
<p><img src="https://images2.imgbox.com/18/06/eg9jn8gg_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/4c/d3/cnSHnXqk_o.jpg" alt="在这里插入图片描述"></p> 
<p>至此，yolov8模型训练已经完毕，下面开始jetson nano上的部署工作。</p> 
<h3><a id="YOLOv8_313"></a>二、YOLOv8模型部署</h3> 
<blockquote> 
 <p>Jetson nano上yolov8模型部署流程和yolov5、yolov7相差较大，主要换了一个部署框架，大家对jetson模型部署感兴趣的可以参考我之前发的<a href="https://blog.csdn.net/qq_40672115/category_11970990.html?spm=1001.2014.3001.5482">Jetson嵌入式系列模型部署</a>文章，这次带大家了解下一个全新的tensorrt封装，部署使用到的Github仓库是<a href="https://github.com/shouxieai/infer">infer</a>。该仓库通过<code>trtexec</code>工具完成模型的构建工作。对模型部署有疑问的可以参考<a href="https://blog.csdn.net/qq_40672115/article/details/126386680?spm=1001.2014.3001.5502">Jetson嵌入式系列模型部署-1</a>，想了解通过<code>TensorRT</code>的<code>Layer API</code>一层层完成模型的搭建工作可参考<a href="https://blog.csdn.net/qq_40672115/article/details/126368779?spm=1001.2014.3001.5502">Jetson嵌入式系列模型部署-2</a>，想了解通过<code>TensorRT</code>的<code>ONNX parser</code>解析ONNX文件来完成模型的搭建工作可参考<a href="https://blog.csdn.net/qq_40672115/article/details/126369675?spm=1001.2014.3001.5502">Jetson嵌入式模型部署-3</a>、<a href="https://blog.csdn.net/qq_40672115/article/details/126668443?spm=1001.2014.3001.5502">Jetson nano部署YOLOv7</a>。本文主要针对<a href="https://github.com/shouxieai/infer">infer</a>项目中的yolov8完成嵌入式模型部署，本文参考自<a href="https://github.com/shouxieai/infer">infer的README.md</a>，具体操作流程作者描述非常详细，这里再简单过一遍，本次训练的模型使用yolov8n，类别数为2，为口罩识别😷。</p> 
</blockquote> 
<h4><a id="1__317"></a>1. 源码下载</h4> 
<p>infer的代码可以直接从github官网上下载，源码下载地址是<a href="https://github.com/shouxieai/infer">https://github.com/shouxieai/infer</a>，由于infer部署框架刚发布不久一个固定的版本都没有，故只能采用<strong>主分支进行yolov8的部署工作</strong>(PS:由于代码更新频繁，可能大家会遇到不同的bug)。Linux下代码克隆指令如下</p> 
<pre><code class="prism language-shell">$ <span class="token function">git</span> clone https://github.com/shouxieai/infer.git
</code></pre> 
<p>也可手动点击下载，点击右上角的<code>Code</code>按键，将代码下载下来。至此整个项目就已经准备好了。也可以点击<a href="https://pan.baidu.com/s/1T47jZ1AswHnaX32GOkqR_Q" rel="nofollow">here[pwd:yolo]</a>下载博主准备好的源代码(<strong>注意代码下载于2023/3/15日，若有改动请参考最新</strong>)</p> 
<h4><a id="2__327"></a>2. 环境配置</h4> 
<blockquote> 
 <p>需要使用的软件环境有<code>TensorRT、CUDA、CUDNN、OpenCV</code>。所有软件环境在JetPack镜像中已经安装完成，只需要添加下<code>trtexec</code>工具的环境变量即可。博主使用的jetpack版本为JetPack4.6.1(PS:关于jetson nano刷机就不再赘述了，需要各位看官自行配置好相关环境😄，外网访问较慢，这里提供Jetson nano的<a href="https://pan.baidu.com/s/1RW8Z-EQK--NtPgIe6mmKIQ?_at_=1660636990470#list/path=%2F" rel="nofollow">JetPack镜像下载链接Baidu Drive[password:nano]【更新完毕!!!】</a>几个(<strong>PS:提供4.6和4.6.1两个版本，注意4GB和2GB的区别，不要刷错了</strong>)，关于Jetson Nano 2GB和4GB的区别可参考链接<a href="https://zhuanlan.zhihu.com/p/339225116" rel="nofollow">Jetson NANO是什么？如何选？</a>。(吐槽下这玩意上传忒慢了，超级会员不顶用呀，终于上传完了，折磨!!!)</p> 
</blockquote> 
<p>博主的Jetpack对应的软件环境如下</p> 
<p><img src="https://images2.imgbox.com/7f/6b/60v158Md_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="21_trtexec_336"></a>2.1 trtexec环境变量设置</h5> 
<p>trtexec环境变量的添加主要参考<a href="https://blog.csdn.net/Max_ZhangJF/article/details/120966773">这里</a>，主要包含以下几步</p> 
<p><strong>1</strong>.打开bashrc文件</p> 
<pre><code class="prism language-shell"><span class="token function">vim</span> ~/.bashrc
</code></pre> 
<p><strong>2</strong>.按i进入输入模式，在最后一行添加如下语句</p> 
<pre><code class="prism language-shell"><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span>/usr/src/tensorrt/bin:<span class="token environment constant">$PATH</span>
</code></pre> 
<p><strong>3</strong>.按下esc，输入:wq!保存退出即可，最后刷新下环境变量</p> 
<pre><code class="prism language-shell"><span class="token builtin class-name">source</span> ~/.bashrc
</code></pre> 
<h4><a id="3_ONNX_358"></a>3. ONNX导出</h4> 
<ul><li>训练的模型使用yolov8n.pt，torch版本1.12.1，onnx版本1.13.1</li><li>参考自<a href="https://www.bilibili.com/video/BV15Y41167B5/?spm_id_from=333.999.0.0&amp;vd_source=2306b3f342c070c8a11931c94eafa8e3" rel="nofollow">YoloV8的动态静态batch如何理解和使用</a></li></ul> 
<p>关于静态batch和动态batch有以下几点说明，更多细节请查看<a href="https://www.bilibili.com/video/BV15Y41167B5/?spm_id_from=333.999.0.0&amp;vd_source=2306b3f342c070c8a11931c94eafa8e3" rel="nofollow">视频</a></p> 
<p><strong>静态batch</strong></p> 
<ul><li>导出的onnx指定所有维度均为明确的数字，是静态shape模型</li><li>在推理的时候，它永远都是同样的batch推理，即使你目前只有一个图推理，它也需要n个batch的耗时</li><li>适用于大部分场景，整个代码逻辑非常简单</li></ul> 
<p><strong>动态batch</strong></p> 
<ul><li>导出的时候指定特定维度为dynamic，也就是不确定状态</li><li>模型推理时才决定所需推理的batch大小，耗时最优，但onnx复杂度提高了</li><li>适用于如server有大量不均匀的请求时的场景</li></ul> 
<h5><a id="31_batch_377"></a>3.1 静态batch导出</h5> 
<h6><a id="311_Transpose_379"></a>3.1.1 Transpose节点的添加</h6> 
<p>将训练好的口罩识别权重<code>best.pt</code>放在ultralytics-main主目录下，新建导出文件<strong>export.py</strong>，内容如下，执行完成后将会在当前目录生成导出的<code>best.onnx</code>模型</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> ultralytics <span class="token keyword">import</span> YOLO

model <span class="token operator">=</span> YOLO<span class="token punctuation">(</span><span class="token string">"best.pt"</span><span class="token punctuation">)</span>

success <span class="token operator">=</span> model<span class="token punctuation">.</span>export<span class="token punctuation">(</span><span class="token builtin">format</span><span class="token operator">=</span><span class="token string">"onnx"</span><span class="token punctuation">,</span> batch<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre> 
<p>模型需要完成修改才能正确被<strong>infer</strong>框架使用，正常模型导出的输出为[1,6,8400]，其中1代表batch，6分别代表cx,cy,w,h,以及have_mask、no_mask两个类别分数，8400代表框的个数。首先<strong>infer</strong>框架的输出只支持[1,8400,6]这种形式的输出，因此我们需要在原始onnx的输出之前添加一个<strong>Transpose</strong>节点，<strong>infer</strong>仓库workspace/v8trans.py就是帮我们做这么一件事情，v8trans.py具体内容如下：</p> 
<pre><code class="prism language-python"><span class="token comment"># v8trans.py</span>
<span class="token keyword">import</span> onnx
<span class="token keyword">import</span> onnx<span class="token punctuation">.</span>helper <span class="token keyword">as</span> helper
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> os

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Usage:\n python v8trans.py yolov8n.onnx"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token number">1</span>

    <span class="token builtin">file</span> <span class="token operator">=</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Not exist path: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">file</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token number">1</span>

    prefix<span class="token punctuation">,</span> suffix <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>splitext<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span>
    dst <span class="token operator">=</span> prefix <span class="token operator">+</span> <span class="token string">".transd"</span> <span class="token operator">+</span> suffix

    model <span class="token operator">=</span> onnx<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span>
    node  <span class="token operator">=</span> model<span class="token punctuation">.</span>graph<span class="token punctuation">.</span>node<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>

    old_output <span class="token operator">=</span> node<span class="token punctuation">.</span>output<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    node<span class="token punctuation">.</span>output<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"pre_transpose"</span>

    <span class="token keyword">for</span> specout <span class="token keyword">in</span> model<span class="token punctuation">.</span>graph<span class="token punctuation">.</span>output<span class="token punctuation">:</span>
        <span class="token keyword">if</span> specout<span class="token punctuation">.</span>name <span class="token operator">==</span> old_output<span class="token punctuation">:</span>
            shape0 <span class="token operator">=</span> specout<span class="token punctuation">.</span><span class="token builtin">type</span><span class="token punctuation">.</span>tensor_type<span class="token punctuation">.</span>shape<span class="token punctuation">.</span>dim<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            shape1 <span class="token operator">=</span> specout<span class="token punctuation">.</span><span class="token builtin">type</span><span class="token punctuation">.</span>tensor_type<span class="token punctuation">.</span>shape<span class="token punctuation">.</span>dim<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
            shape2 <span class="token operator">=</span> specout<span class="token punctuation">.</span><span class="token builtin">type</span><span class="token punctuation">.</span>tensor_type<span class="token punctuation">.</span>shape<span class="token punctuation">.</span>dim<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
            new_out <span class="token operator">=</span> helper<span class="token punctuation">.</span>make_tensor_value_info<span class="token punctuation">(</span>
                specout<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
                specout<span class="token punctuation">.</span><span class="token builtin">type</span><span class="token punctuation">.</span>tensor_type<span class="token punctuation">.</span>elem_type<span class="token punctuation">,</span>
                <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span>
            <span class="token punctuation">)</span>
            new_out<span class="token punctuation">.</span><span class="token builtin">type</span><span class="token punctuation">.</span>tensor_type<span class="token punctuation">.</span>shape<span class="token punctuation">.</span>dim<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>CopyFrom<span class="token punctuation">(</span>shape0<span class="token punctuation">)</span>
            new_out<span class="token punctuation">.</span><span class="token builtin">type</span><span class="token punctuation">.</span>tensor_type<span class="token punctuation">.</span>shape<span class="token punctuation">.</span>dim<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>CopyFrom<span class="token punctuation">(</span>shape1<span class="token punctuation">)</span>
            new_out<span class="token punctuation">.</span><span class="token builtin">type</span><span class="token punctuation">.</span>tensor_type<span class="token punctuation">.</span>shape<span class="token punctuation">.</span>dim<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>CopyFrom<span class="token punctuation">(</span>shape2<span class="token punctuation">)</span>
            specout<span class="token punctuation">.</span>CopyFrom<span class="token punctuation">(</span>new_out<span class="token punctuation">)</span>

    model<span class="token punctuation">.</span>graph<span class="token punctuation">.</span>node<span class="token punctuation">.</span>append<span class="token punctuation">(</span>
        helper<span class="token punctuation">.</span>make_node<span class="token punctuation">(</span><span class="token string">"Transpose"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"pre_transpose"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>old_output<span class="token punctuation">]</span><span class="token punctuation">,</span> perm<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Model save to </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>dst<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    onnx<span class="token punctuation">.</span>save<span class="token punctuation">(</span>model<span class="token punctuation">,</span> dst<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>在命令行终端输入如下指令即可添加Transpose节点，执行完成之后在当前目录下生成<code>best.transd.onnx</code>模型，该模型添加了Transpose节点。</p> 
<pre><code class="prism language-shell">python v8trans.py best.onnx
</code></pre> 
<p>下图对比了原始的best.onnx和best.transd.onnx之间的区别，从图中可以看出转换后的onnx模型在输出之前多了一个Transpose节点，且输出的1，2维度进行了交换，符合<strong>infer</strong>框架。</p> 
<p><img src="https://images2.imgbox.com/2c/2f/XrrE2Tqy_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="312_Resize_457"></a>3.1.2 Resize节点解析的问题</h6> 
<p>先剧透下，当使用<strong>trtexec</strong>工具构建engine时会出现错误，我们一并解决，到时候可直接生成engine，错误信息如下图所示，大概意思就是说Resize_120这个节点的scales没有初始化(应该是这样理解的吧🤔)</p> 
<p><img src="https://images2.imgbox.com/b9/26/6lKSPeQM_o.png" alt="在这里插入图片描述"></p> 
<p>我们先通过<a href="https://netron.app/" rel="nofollow">Netron</a>工具打开<code>best.transd.onnx</code>模型查看下Resize_120这个节点的相关信息，在找找其它的Resize节点对比看看，如下图所示，左边是Resize_103节点的相关信息，右边是Resize_120节点的相关信息，可以看到其对应的Scales确实存在区别，Resize_120节点Scales没有initializer，没有明确的值。</p> 
<p><img src="https://images2.imgbox.com/61/33/5L1hqa1n_o.png" alt="在这里插入图片描述"></p> 
<p>下面来看解决方案，提供两种</p> 
<p><strong>解决方案1-onnxsim(推荐)</strong></p> 
<p>onnxoptimizer、onnxsim被誉为onnx的优化利器，其中onnxsim可以优化常量，onnxoptimizer可以对节点进行压缩，参考自<a href="https://www.codetd.com/article/14303045" rel="nofollow">onnxoptimizer、onnxsim使用记录</a>。新建一个<code>v8onnxsim.py</code>文件，用于优化onnx文件，具体内容如下：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> onnx
<span class="token keyword">from</span> onnxsim <span class="token keyword">import</span> simplify

onnx_model <span class="token operator">=</span> onnx<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">"best.transd.onnx"</span><span class="token punctuation">)</span>
model_simp<span class="token punctuation">,</span> check <span class="token operator">=</span> simplify<span class="token punctuation">(</span>onnx_model<span class="token punctuation">)</span>
<span class="token keyword">assert</span> check<span class="token punctuation">,</span> <span class="token string">"Simplified ONNX model could not be Validated"</span>
onnx<span class="token punctuation">.</span>save<span class="token punctuation">(</span>model_simp<span class="token punctuation">,</span> <span class="token string">"best.trand.sim.onnx"</span><span class="token punctuation">)</span>
</code></pre> 
<p>运行后会在当前文件夹生成一个<code>best.transd.sim.onnx</code>模型，现在可以查看对应的Resize_120节点发生了改变</p> 
<p><img src="https://images2.imgbox.com/ec/18/tKGDeP2D_o.png" alt="在这里插入图片描述"></p> 
<p><strong>解决方案2-自己动手</strong></p> 
<p>俗话说自己动手丰衣足食，看了onnxsim优化的结果，突然有种自己动手操作的欲望(PS:大家看个热闹即可😙)。主要步骤如下：</p> 
<ul><li>1.加载ONNX模型</li><li>2.遍历模型的所有节点，找到要操作的Resize_120</li><li>3.修改其输入从onnx::Resize_432变成onnx::Resize_431</li><li>4.删除Identit_2节点</li><li>5.保存模型</li></ul> 
<p>在当前目录下新建<code>v8Resize.py</code>文件，其内容如下：</p> 
<pre><code class="prism language-python">
<span class="token keyword">import</span> onnx
<span class="token keyword">import</span> onnx<span class="token punctuation">.</span>helper <span class="token keyword">as</span> helper
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> os

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token comment"># 1.加载ONNX模型文件</span>
    model <span class="token operator">=</span> onnx<span class="token punctuation">.</span>load<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span>
    resize_node <span class="token operator">=</span> <span class="token boolean">None</span>

    <span class="token comment"># 2.遍历模型的所有节点，查找resize节点</span>
    <span class="token comment"># Resize_103 Resize_120</span>
    <span class="token keyword">for</span> node <span class="token keyword">in</span> model<span class="token punctuation">.</span>graph<span class="token punctuation">.</span>node<span class="token punctuation">:</span>
        <span class="token keyword">if</span> node<span class="token punctuation">.</span>op_type <span class="token operator">==</span> <span class="token string">"Resize"</span> <span class="token keyword">and</span> node<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">"Resize_120"</span><span class="token punctuation">:</span>
            resize_node <span class="token operator">=</span> node
            <span class="token keyword">break</span>

    <span class="token keyword">if</span> resize_node <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"Resize node not found in the model."</span><span class="token punctuation">)</span>

    <span class="token comment"># 3.修改输入</span>
    resize_node<span class="token punctuation">.</span><span class="token builtin">input</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"onnx::Resize_431"</span>

    <span class="token comment"># 4.删除Identity_2节点</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>graph<span class="token punctuation">.</span>node<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> model<span class="token punctuation">.</span>graph<span class="token punctuation">.</span>node<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">"Identity_2"</span><span class="token punctuation">:</span>
            <span class="token keyword">del</span> model<span class="token punctuation">.</span>graph<span class="token punctuation">.</span>node<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
            <span class="token keyword">break</span>

    <span class="token comment"># 5.保存新模型</span>
    onnx<span class="token punctuation">.</span>save<span class="token punctuation">(</span>model<span class="token punctuation">,</span> <span class="token string">"best.transd.my.onnx"</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"new model save done."</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    file_path <span class="token operator">=</span> <span class="token string">"./best.transd.onnx"</span>
    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span>main<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>运行该文件后会在当前目录下生成<code>best.transd.my.onnx</code>模型，现在可以查看对应的Resize_120节点发生了改变<br> <img src="https://images2.imgbox.com/59/e9/aR4wPJgN_o.png" alt="在这里插入图片描述"></p> 
<p>至此，静态batch模型导出告一段落，后续通过<code>trtexec</code>工具可正常生成engine文件了，主要解决两个方面的问题，一是输出必须加一个Transpose转换，二是解决Resize节点无法解析问题。</p> 
<h5><a id="32_batch_545"></a>3.2 动态batch导出</h5> 
<h6><a id="321_exporterpy_547"></a>3.2.1 exporter.py修改</h6> 
<p>动态batch的导出需要修改<strong>ultralytics/yolo/engine/exporter.py</strong>文件第303行的内容，确保导出的batch指定为动态，其它维度不指定，修改的内容如下：</p> 
<pre><code class="prism language-python"><span class="token comment"># -----exporter.py第303行-----</span>
<span class="token comment"># dynamic = self.args.dynamic</span>
<span class="token comment"># if dynamic:</span>
<span class="token comment">#     dynamic = {'images': {0: 'batch', 2: 'height', 3: 'width'}}  # shape(1,3,640,640)</span>
<span class="token comment">#     if isinstance(self.model, SegmentationModel):</span>
<span class="token comment">#         dynamic['output0'] = {0: 'batch', 1: 'anchors'}  # shape(1,25200,85)</span>
<span class="token comment">#         dynamic['output1'] = {0: 'batch', 2: 'mask_height', 3: 'mask_width'}  # shape(1,32,160,160)</span>
<span class="token comment">#     elif isinstance(self.model, DetectionModel):</span>
<span class="token comment">#         dynamic['output0'] = {0: 'batch', 1: 'anchors'}  # shape(1,25200,85)</span>

<span class="token comment"># -----修改为如下代码-----</span>
dynamic <span class="token operator">=</span> self<span class="token punctuation">.</span>args<span class="token punctuation">.</span>dynamic
dynamic <span class="token operator">=</span> <span class="token boolean">True</span>
<span class="token keyword">if</span> dynamic<span class="token punctuation">:</span>
    dynamic <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'images'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">:</span> <span class="token string">'batch'</span><span class="token punctuation">}</span><span class="token punctuation">}</span>  <span class="token comment"># shape(1,3,640,640)</span>
    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>model<span class="token punctuation">,</span> SegmentationModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
        dynamic<span class="token punctuation">[</span><span class="token string">'output0'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">:</span> <span class="token string">'batch'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span> <span class="token string">'anchors'</span><span class="token punctuation">}</span>  <span class="token comment"># shape(1,25200,85)</span>
        dynamic<span class="token punctuation">[</span><span class="token string">'output1'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">:</span> <span class="token string">'batch'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">:</span> <span class="token string">'mask_height'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">:</span> <span class="token string">'mask_width'</span><span class="token punctuation">}</span>  <span class="token comment"># shape(1,32,160,160)</span>
    <span class="token keyword">elif</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>model<span class="token punctuation">,</span> DetectionModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
        dynamic<span class="token punctuation">[</span><span class="token string">'output0'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">:</span> <span class="token string">'batch'</span><span class="token punctuation">}</span>  <span class="token comment"># shape(1,25200,85)</span>
</code></pre> 
<p>然后将训练好的口罩识别权重<code>best.pt</code>放在ultralytics-main目录下，新建导出文件<strong>export.py</strong>，内容如下，执行完成后将会在当前目录下生成导出的<code>best.onnx</code>模型</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> ultralytics <span class="token keyword">import</span> YOLO

model <span class="token operator">=</span> YOLO<span class="token punctuation">(</span><span class="token string">"best.pt"</span><span class="token punctuation">)</span>

success <span class="token operator">=</span> model<span class="token punctuation">.</span>export<span class="token punctuation">(</span><span class="token builtin">format</span><span class="token operator">=</span><span class="token string">'onnx'</span><span class="token punctuation">,</span> batch<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre> 
<p>导出的onnx模型如下：</p> 
<p><img src="https://images2.imgbox.com/5e/08/EiktwIjM_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="322_Transpose_588"></a>3.2.2 Transpose节点添加</h6> 
<p>由于<strong>infer</strong>框架只支持[1,8400,6]这种形式的输出，因此我们需要在原始onnx之前添加一个<strong>Transpose</strong>节点，<strong>infer</strong>仓库workspace/v8trans.py就是帮我们做这么一件事情，v8trans.py具体内容可参考3.1.1小节，这里不再赘述。</p> 
<h6><a id="323_Resize_592"></a>3.2.3 Resize节点解析的问题</h6> 
<p>同样的当使用<strong>trtexec</strong>工具构建engine时，会出现Resize节点解析错误</p> 
<p><img src="https://images2.imgbox.com/da/cf/yqDrpNDT_o.png" alt="在这里插入图片描述"></p> 
<p>废话少说，直接上解决方案</p> 
<p><strong>解决方案1-onnxsim</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> onnx
<span class="token keyword">from</span> onnxsim <span class="token keyword">import</span> simplify

onnx_model <span class="token operator">=</span> onnx<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">"best.onnx"</span><span class="token punctuation">)</span>
model_simp<span class="token punctuation">,</span> check <span class="token operator">=</span> simplify<span class="token punctuation">(</span>onnx_model<span class="token punctuation">)</span>
<span class="token keyword">assert</span> check<span class="token punctuation">,</span> <span class="token string">"Simplified ONNX model could not be Validated"</span>
onnx<span class="token punctuation">.</span>save<span class="token punctuation">(</span>model_simp<span class="token punctuation">,</span> <span class="token string">"best.sim.onnx"</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>解决方案2-自己动手</strong></p> 
<pre><code class="prism language-python">
<span class="token keyword">import</span> onnx
<span class="token keyword">import</span> onnx<span class="token punctuation">.</span>helper <span class="token keyword">as</span> helper
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> os

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token comment"># 1.加载ONNX模型文件</span>
    model <span class="token operator">=</span> onnx<span class="token punctuation">.</span>load<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span>
    resize_node <span class="token operator">=</span> <span class="token boolean">None</span>

    <span class="token comment"># 2.遍历模型的所有节点，查找resize节点</span>
    <span class="token comment"># Resize_106 Resize_123</span>
    <span class="token keyword">for</span> node <span class="token keyword">in</span> model<span class="token punctuation">.</span>graph<span class="token punctuation">.</span>node<span class="token punctuation">:</span>
        <span class="token keyword">if</span> node<span class="token punctuation">.</span>op_type <span class="token operator">==</span> <span class="token string">"Resize"</span> <span class="token keyword">and</span> node<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">"Resize_123"</span><span class="token punctuation">:</span>
            resize_node <span class="token operator">=</span> node
            <span class="token keyword">break</span>

    <span class="token keyword">if</span> resize_node <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"Resize node not found in the model."</span><span class="token punctuation">)</span>

    <span class="token comment"># 3.修改输入</span>
    resize_node<span class="token punctuation">.</span><span class="token builtin">input</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"onnx::Resize_437"</span>

    <span class="token comment"># 4.删除Identity_5节点</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>graph<span class="token punctuation">.</span>node<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> model<span class="token punctuation">.</span>graph<span class="token punctuation">.</span>node<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">"Identity_5"</span><span class="token punctuation">:</span>
            <span class="token keyword">del</span> model<span class="token punctuation">.</span>graph<span class="token punctuation">.</span>node<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
            <span class="token keyword">break</span>

    <span class="token comment"># 5.保存新模型</span>
    onnx<span class="token punctuation">.</span>save<span class="token punctuation">(</span>model<span class="token punctuation">,</span> <span class="token string">"best.my.onnx"</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"new model save done."</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    file_path <span class="token operator">=</span> <span class="token string">"./best.onnx"</span>
    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span>main<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>至此，模型导出已经完毕，后续通过导出的模型完成在jetson nano上的部署工作，导出的模型文件可点击<a href="https://pan.baidu.com/s/193prud3xw-SmG8ercjZlug" rel="nofollow">here[pwd:yolo]</a>下载</p> 
<h4><a id="4__657"></a>4. 运行</h4> 
<h5><a id="41_engine_659"></a>4.1 engine生成</h5> 
<p>与tensorRT_Pro模型构建方式不同，infer框架直接通过trtexec工具生成engine，<strong>infer</strong>框架拥有一个全新的tensorrt封装，可轻易继承各类任务，相比于tensorRT_Pro优点如下：</p> 
<ul><li>轻易实现各类任务的生产者和消费者模型，并进行高性能推理</li><li>没有复杂的封装，彻底解开耦合!</li><li>参考自<a href="https://www.bilibili.com/video/BV1F24y1h7LW/?spm_id_from=333.999.0.0&amp;vd_source=2306b3f342c070c8a11931c94eafa8e3" rel="nofollow">如何高效使用TensorRT</a></li></ul> 
<p>将第3节导出的ONNX模型放入到infer/workspace文件夹下，然后在jetson nano终端执行如下指令(<strong>以导出的静态batch模型为例</strong>)</p> 
<pre><code class="prism language-css">trtexec --onnx=workspace/best.transd.sim.onnx --saveEngine=workspace/best.transd.sim.engine
</code></pre> 
<p>图解如下所示(PS:模型构架需要一段时间，请耐心等待)</p> 
<p><img src="https://images2.imgbox.com/71/25/Vj1yByeh_o.png" alt="在这里插入图片描述"></p> 
<p>模型构建完成后如下图所示，engine拿到手后就可以开干了👨‍🏭</p> 
<p><img src="https://images2.imgbox.com/0e/5c/sq5ospIZ_o.png" alt="在这里插入图片描述"><br> <strong>注</strong>：<strong>导出动态batch模型执行的指令与静态batch不同</strong>！！！，具体可参考infer/workspace/build.sh文件中的内容，指令如下：</p> 
<pre><code class="prism language-css">trtexec --onnx=best.transd.sim.onnx --minShapes=<span class="token property">images</span><span class="token punctuation">:</span>1x3x640x640 --maxShapes=<span class="token property">images</span><span class="token punctuation">:</span>16x3x640x640 --optShapes=<span class="token property">images</span><span class="token punctuation">:</span>1x3x640x640 --saveEngine=best.transd.sim.engine
</code></pre> 
<h5><a id="42__685"></a>4.2 源码修改</h5> 
<blockquote> 
 <p>yolo模型的推理代码主要在<code>src/main.cpp</code>文件中，需要推理的图片放在<code>workspace/inference</code>文件夹中，源码修改较简单主要有以下几点：</p> 
</blockquote> 
<ul><li> <p><strong>1.main.cpp 134，135行注释，只进行单张图片的推理</strong></p> </li><li> <p><strong>2.main.cpp 104行 修改加载的模型为best.transd.sim.engine且类型为V8</strong></p> </li><li> <p><strong>3.main.cpp 10行 新增mylabels数组，添加自训练模型的类别名称</strong></p> </li><li> <p><strong>4.mian.cpp 115行 cocolabels修改为mylabels</strong></p> </li></ul> 
<p>具体修改如下</p> 
<pre><code class="prism language-cpp"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// perf();					//修改1 134 135行注释</span>
  <span class="token comment">// batch_inference();			</span>
  <span class="token function">single_inference</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">auto</span> yolo <span class="token operator">=</span> yolo<span class="token double-colon punctuation">::</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">"best.transd.sim.engine"</span><span class="token punctuation">,</span> yolo<span class="token double-colon punctuation">::</span>Type<span class="token double-colon punctuation">::</span>V8<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//  修改2</span>

<span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>mylabels<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"have_mask"</span><span class="token punctuation">,</span> <span class="token string">"no_mask"</span><span class="token punctuation">}</span><span class="token punctuation">;</span>	<span class="token comment">// 修改3 新增mylabels数组</span>

<span class="token keyword">auto</span> name <span class="token operator">=</span> mylabels<span class="token punctuation">[</span>obj<span class="token punctuation">.</span>class_label<span class="token punctuation">]</span>		<span class="token comment">// 修改4 cocolabels修改为mylabels</span>
</code></pre> 
<h5><a id="43__713"></a>4.3 编译运行</h5> 
<p>编译用到的Makefile文件需要修改，修改后的Makefile文件如下，详细的Makefile文件的分析可查看<a href="https://blog.csdn.net/qq_40672115/article/details/129795117?spm=1001.2014.3001.5502">Mkaefile实战</a></p> 
<pre><code class="prism language-cpp">cc        <span class="token operator">:</span><span class="token operator">=</span> g<span class="token operator">++</span>
nvcc      <span class="token operator">=</span> <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>cuda<span class="token operator">-</span><span class="token number">10.2</span><span class="token operator">/</span>bin<span class="token operator">/</span>nvcc

cpp_srcs  <span class="token operator">:</span><span class="token operator">=</span> $<span class="token punctuation">(</span>shell find src <span class="token operator">-</span>name <span class="token string">"*.cpp"</span><span class="token punctuation">)</span>
cpp_objs  <span class="token operator">:</span><span class="token operator">=</span> $<span class="token punctuation">(</span>cpp_srcs<span class="token operator">:</span><span class="token punctuation">.</span>cpp<span class="token operator">=</span><span class="token punctuation">.</span>cpp<span class="token punctuation">.</span>o<span class="token punctuation">)</span>
cpp_objs  <span class="token operator">:</span><span class="token operator">=</span> $<span class="token punctuation">(</span>cpp_objs<span class="token operator">:</span>src<span class="token operator">/</span><span class="token operator">%=</span>objs<span class="token operator">/</span><span class="token operator">%</span><span class="token punctuation">)</span>
cpp_mk	  <span class="token operator">:</span><span class="token operator">=</span> $<span class="token punctuation">(</span>cpp_objs<span class="token operator">:</span><span class="token punctuation">.</span>cpp<span class="token punctuation">.</span>o<span class="token operator">=</span><span class="token punctuation">.</span>cpp<span class="token punctuation">.</span>mk<span class="token punctuation">)</span>

cu_srcs	  <span class="token operator">:</span><span class="token operator">=</span> $<span class="token punctuation">(</span>shell find src <span class="token operator">-</span>name <span class="token string">"*.cu"</span><span class="token punctuation">)</span>
cu_objs   <span class="token operator">:</span><span class="token operator">=</span> $<span class="token punctuation">(</span>cu_srcs<span class="token operator">:</span><span class="token punctuation">.</span>cu<span class="token operator">=</span><span class="token punctuation">.</span>cu<span class="token punctuation">.</span>o<span class="token punctuation">)</span>
cu_objs	  <span class="token operator">:</span><span class="token operator">=</span> $<span class="token punctuation">(</span>cu_objs<span class="token operator">:</span>src<span class="token operator">/</span><span class="token operator">%=</span>objs<span class="token operator">/</span><span class="token operator">%</span><span class="token punctuation">)</span>
cu_mk	  <span class="token operator">:</span><span class="token operator">=</span> $<span class="token punctuation">(</span>cu_objs<span class="token operator">:</span><span class="token punctuation">.</span>cu<span class="token punctuation">.</span>o<span class="token operator">=</span><span class="token punctuation">.</span>cu<span class="token punctuation">.</span>mk<span class="token punctuation">)</span>

include_paths <span class="token operator">:</span><span class="token operator">=</span> src        \
			<span class="token operator">/</span>usr<span class="token operator">/</span>include<span class="token operator">/</span>opencv4 \
			<span class="token operator">/</span>usr<span class="token operator">/</span>include<span class="token operator">/</span>aarch64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu \
			<span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>cuda<span class="token operator">-</span><span class="token number">10.2</span><span class="token operator">/</span>include

library_paths <span class="token operator">:</span><span class="token operator">=</span> <span class="token operator">/</span>usr<span class="token operator">/</span>lib<span class="token operator">/</span>aarch64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu \
			<span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>cuda<span class="token operator">-</span><span class="token number">10.2</span><span class="token operator">/</span>lib64

link_librarys <span class="token operator">:</span><span class="token operator">=</span> opencv_core opencv_highgui opencv_imgproc opencv_videoio opencv_imgcodecs \
			nvinfer nvinfer_plugin nvonnxparser \
			cuda cublas cudart cudnn \
			stdc<span class="token operator">++</span> dl

empty		  <span class="token operator">:</span><span class="token operator">=</span>
export_path   <span class="token operator">:</span><span class="token operator">=</span> $<span class="token punctuation">(</span>subst $<span class="token punctuation">(</span>empty<span class="token punctuation">)</span> $<span class="token punctuation">(</span>empty<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">,</span>$<span class="token punctuation">(</span>library_paths<span class="token punctuation">)</span><span class="token punctuation">)</span>

run_paths     <span class="token operator">:</span><span class="token operator">=</span> $<span class="token punctuation">(</span>foreach item<span class="token punctuation">,</span>$<span class="token punctuation">(</span>library_paths<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">-</span>Wl<span class="token punctuation">,</span><span class="token operator">-</span>rpath<span class="token operator">=</span>$<span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span>
include_paths <span class="token operator">:</span><span class="token operator">=</span> $<span class="token punctuation">(</span>foreach item<span class="token punctuation">,</span>$<span class="token punctuation">(</span>include_paths<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">-</span>I$<span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span>
library_paths <span class="token operator">:</span><span class="token operator">=</span> $<span class="token punctuation">(</span>foreach item<span class="token punctuation">,</span>$<span class="token punctuation">(</span>library_paths<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">-</span>L$<span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span>
link_librarys <span class="token operator">:</span><span class="token operator">=</span> $<span class="token punctuation">(</span>foreach item<span class="token punctuation">,</span>$<span class="token punctuation">(</span>link_librarys<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">-</span>l$<span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span>

cpp_compile_flags <span class="token operator">:</span><span class="token operator">=</span> <span class="token operator">-</span>std<span class="token operator">=</span>c<span class="token operator">++</span><span class="token number">11</span> <span class="token operator">-</span>fPIC <span class="token operator">-</span>w <span class="token operator">-</span>g <span class="token operator">-</span>pthread <span class="token operator">-</span>fopenmp <span class="token operator">-</span>O0
cu_compile_flags  <span class="token operator">:</span><span class="token operator">=</span> <span class="token operator">-</span>std<span class="token operator">=</span>c<span class="token operator">++</span><span class="token number">11</span> <span class="token operator">-</span>g <span class="token operator">-</span>w <span class="token operator">-</span>O0 <span class="token operator">-</span>Xcompiler <span class="token string">"$(cpp_compile_flags)"</span>
link_flags        <span class="token operator">:</span><span class="token operator">=</span> <span class="token operator">-</span>pthread <span class="token operator">-</span>fopenmp <span class="token operator">-</span>Wl<span class="token punctuation">,</span><span class="token operator">-</span>rpath<span class="token operator">=</span><span class="token char">'$$ORIGIN'</span>

cpp_compile_flags <span class="token operator">+=</span> $<span class="token punctuation">(</span>include_paths<span class="token punctuation">)</span>
cu_compile_flags  <span class="token operator">+=</span> $<span class="token punctuation">(</span>include_paths<span class="token punctuation">)</span>
link_flags        <span class="token operator">+=</span> $<span class="token punctuation">(</span>library_paths<span class="token punctuation">)</span> $<span class="token punctuation">(</span>link_librarys<span class="token punctuation">)</span> $<span class="token punctuation">(</span>run_paths<span class="token punctuation">)</span>

<span class="token function">ifneq</span> <span class="token punctuation">(</span>$<span class="token punctuation">(</span>MAKECMDGOALS<span class="token punctuation">)</span><span class="token punctuation">,</span> clean<span class="token punctuation">)</span>
<span class="token operator">-</span>include $<span class="token punctuation">(</span>cpp_mk<span class="token punctuation">)</span> $<span class="token punctuation">(</span>cu_mk<span class="token punctuation">)</span>
endif

pro	   <span class="token operator">:</span><span class="token operator">=</span> workspace<span class="token operator">/</span>pro
expath <span class="token operator">:</span><span class="token operator">=</span> library_path<span class="token punctuation">.</span>txt

library_path<span class="token punctuation">.</span>txt <span class="token operator">:</span> 
	@echo LD_LIBRARY_PATH<span class="token operator">=</span>$<span class="token punctuation">(</span>export_path<span class="token punctuation">)</span><span class="token operator">:</span><span class="token string">"$$"</span>LD_LIBRARY_PATH <span class="token operator">&gt;</span> $@

workspace<span class="token operator">/</span>pro <span class="token operator">:</span> $<span class="token punctuation">(</span>cpp_objs<span class="token punctuation">)</span> $<span class="token punctuation">(</span>cu_objs<span class="token punctuation">)</span>
		@echo Link $@
		@mkdir <span class="token operator">-</span>p $<span class="token punctuation">(</span>dir $@<span class="token punctuation">)</span>
		@$<span class="token punctuation">(</span>cc<span class="token punctuation">)</span> $<span class="token operator">^</span> <span class="token operator">-</span>o $@ $<span class="token punctuation">(</span>link_flags<span class="token punctuation">)</span>

objs<span class="token operator">/</span><span class="token operator">%</span><span class="token punctuation">.</span>cpp<span class="token punctuation">.</span>o <span class="token operator">:</span> src<span class="token operator">/</span><span class="token operator">%</span><span class="token punctuation">.</span>cpp
	@echo Compile CXX $<span class="token operator">&lt;</span>
	@mkdir <span class="token operator">-</span>p $<span class="token punctuation">(</span>dir $@<span class="token punctuation">)</span>
	@$<span class="token punctuation">(</span>cc<span class="token punctuation">)</span> <span class="token operator">-</span>c $<span class="token operator">&lt;</span> <span class="token operator">-</span>o $@ $<span class="token punctuation">(</span>cpp_compile_flags<span class="token punctuation">)</span>

objs<span class="token operator">/</span><span class="token operator">%</span><span class="token punctuation">.</span>cu<span class="token punctuation">.</span>o <span class="token operator">:</span> src<span class="token operator">/</span><span class="token operator">%</span><span class="token punctuation">.</span>cu
	@echo Compile CUDA $<span class="token operator">&lt;</span>
	@mkdir <span class="token operator">-</span>p $<span class="token punctuation">(</span>dir $@<span class="token punctuation">)</span>
	@$<span class="token punctuation">(</span>nvcc<span class="token punctuation">)</span> <span class="token operator">-</span>c $<span class="token operator">&lt;</span> <span class="token operator">-</span>o $@ $<span class="token punctuation">(</span>cu_compile_flags<span class="token punctuation">)</span>

objs<span class="token operator">/</span><span class="token operator">%</span><span class="token punctuation">.</span>cpp<span class="token punctuation">.</span>mk <span class="token operator">:</span> src<span class="token operator">/</span><span class="token operator">%</span><span class="token punctuation">.</span>cpp
	@echo Compile depends CXX $<span class="token operator">&lt;</span>
	@mkdir <span class="token operator">-</span>p $<span class="token punctuation">(</span>dir $@<span class="token punctuation">)</span>
	@$<span class="token punctuation">(</span>cc<span class="token punctuation">)</span> <span class="token operator">-</span>M $<span class="token operator">&lt;</span> <span class="token operator">-</span>MF $@ <span class="token operator">-</span>MT $<span class="token punctuation">(</span>@<span class="token operator">:</span><span class="token punctuation">.</span>cpp<span class="token punctuation">.</span>mk<span class="token operator">=</span><span class="token punctuation">.</span>cpp<span class="token punctuation">.</span>o<span class="token punctuation">)</span> $<span class="token punctuation">(</span>cpp_compile_flags<span class="token punctuation">)</span>
	
objs<span class="token operator">/</span><span class="token operator">%</span><span class="token punctuation">.</span>cu<span class="token punctuation">.</span>mk <span class="token operator">:</span> src<span class="token operator">/</span><span class="token operator">%</span><span class="token punctuation">.</span>cu
	@echo Compile depends CUDA $<span class="token operator">&lt;</span>
	@mkdir <span class="token operator">-</span>p $<span class="token punctuation">(</span>dir $@<span class="token punctuation">)</span>
	@$<span class="token punctuation">(</span>nvcc<span class="token punctuation">)</span> <span class="token operator">-</span>M $<span class="token operator">&lt;</span> <span class="token operator">-</span>MF $@ <span class="token operator">-</span>MT $<span class="token punctuation">(</span>@<span class="token operator">:</span><span class="token punctuation">.</span>cu<span class="token punctuation">.</span>mk<span class="token operator">=</span><span class="token punctuation">.</span>cu<span class="token punctuation">.</span>o<span class="token punctuation">)</span> $<span class="token punctuation">(</span>cu_compile_flags<span class="token punctuation">)</span>

run   <span class="token operator">:</span> workspace<span class="token operator">/</span>pro
		  @cd workspace <span class="token operator">&amp;&amp;</span> <span class="token punctuation">.</span><span class="token operator">/</span>pro

clean <span class="token operator">:</span>
	@rm <span class="token operator">-</span>rf objs workspace<span class="token operator">/</span>pro
	@rm <span class="token operator">-</span>rf library_path<span class="token punctuation">.</span>txt
	@rm <span class="token operator">-</span>rf workspace<span class="token operator">/</span>Result<span class="token punctuation">.</span>jpg

# 导出符号，使得运行时能够链接上
<span class="token keyword">export</span> LD_LIBRARY_PATH<span class="token operator">:</span><span class="token operator">=</span>$<span class="token punctuation">(</span>export_path<span class="token punctuation">)</span><span class="token operator">:</span>$<span class="token punctuation">(</span>LD_LIBRARY_PATH<span class="token punctuation">)</span>
</code></pre> 
<p>OK!源码也修改好了，Makefile文件也搞定了，可以编译运行了，直接在终端执行如下指令即可</p> 
<pre><code class="prism language-shell"><span class="token function">make</span> run
</code></pre> 
<p>图解如下所示：</p> 
<p><img src="https://images2.imgbox.com/ea/60/4daD1ZrY_o.png" alt="在这里插入图片描述"></p> 
<p>编译运行后的将在worksapce下生成Result.jpg为推理后的图片，如下所示，可以看到效果还是比较OK的。</p> 
<p><img src="https://images2.imgbox.com/4b/b5/fno5ZYII_o.jpg" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/57/5b/8JNW4rM9_o.jpg" alt="在这里插入图片描述"></p> 
<h5><a id="44__825"></a>4.4 拓展-摄像头检测</h5> 
<blockquote> 
 <p>简单写了一个摄像头检测的demo，主要修改以下几点：</p> 
</blockquote> 
<ul><li> <p><strong>1.main.cpp 新增yolo_video_demo()函数，具体内容参考下面</strong></p> </li><li> <p><strong>2.main.cpp 新增调用yolo_video_demo()函数代码，具体内容参考下面</strong></p> </li></ul> 
<pre><code class="prism language-cpp"><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">yolo_video_demo</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> engine_file<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>		<span class="token comment">// 修改1 新增函数</span>
  <span class="token keyword">auto</span> yolo <span class="token operator">=</span> yolo<span class="token double-colon punctuation">::</span><span class="token function">load</span><span class="token punctuation">(</span>engine_file<span class="token punctuation">,</span> yolo<span class="token double-colon punctuation">::</span>Type<span class="token double-colon punctuation">::</span>V8<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>yolo <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>  <span class="token keyword">return</span><span class="token punctuation">;</span>
  
  <span class="token comment">// auto remote_show = create_zmq_remote_show();</span>

  cv<span class="token double-colon punctuation">::</span>Mat frame<span class="token punctuation">;</span>
  cv<span class="token double-colon punctuation">::</span>VideoCapture <span class="token function">cap</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cap<span class="token punctuation">.</span><span class="token function">isOpened</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Engine is nullptr"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    cap<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>frame<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">auto</span> objs <span class="token operator">=</span> yolo<span class="token operator">-&gt;</span><span class="token function">forward</span><span class="token punctuation">(</span><span class="token function">cvimg</span><span class="token punctuation">(</span>frame<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> <span class="token operator">&amp;</span>obj <span class="token operator">:</span> objs<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">uint8_t</span> b<span class="token punctuation">,</span> g<span class="token punctuation">,</span> r<span class="token punctuation">;</span>
      <span class="token function">tie</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> g<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token operator">=</span> yolo<span class="token double-colon punctuation">::</span><span class="token function">random_color</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>class_label<span class="token punctuation">)</span><span class="token punctuation">;</span>
      cv<span class="token double-colon punctuation">::</span><span class="token function">rectangle</span><span class="token punctuation">(</span>frame<span class="token punctuation">,</span> cv<span class="token double-colon punctuation">::</span><span class="token function">Point</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>left<span class="token punctuation">,</span> obj<span class="token punctuation">.</span>top<span class="token punctuation">)</span><span class="token punctuation">,</span> cv<span class="token double-colon punctuation">::</span><span class="token function">Point</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>right<span class="token punctuation">,</span> obj<span class="token punctuation">.</span>bottom<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    cv<span class="token double-colon punctuation">::</span><span class="token function">Scalar</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> g<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token keyword">auto</span> name <span class="token operator">=</span> mylabels<span class="token punctuation">[</span>obj<span class="token punctuation">.</span>class_label<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">auto</span> caption <span class="token operator">=</span> cv<span class="token double-colon punctuation">::</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%s %.2f"</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> obj<span class="token punctuation">.</span>confidence<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> width <span class="token operator">=</span> cv<span class="token double-colon punctuation">::</span><span class="token function">getTextSize</span><span class="token punctuation">(</span>caption<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">.</span>width <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">;</span>
      cv<span class="token double-colon punctuation">::</span><span class="token function">rectangle</span><span class="token punctuation">(</span>frame<span class="token punctuation">,</span> cv<span class="token double-colon punctuation">::</span><span class="token function">Point</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>left <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">,</span> obj<span class="token punctuation">.</span>top <span class="token operator">-</span> <span class="token number">33</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    cv<span class="token double-colon punctuation">::</span><span class="token function">Point</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>left <span class="token operator">+</span> width<span class="token punctuation">,</span> obj<span class="token punctuation">.</span>top<span class="token punctuation">)</span><span class="token punctuation">,</span> cv<span class="token double-colon punctuation">::</span><span class="token function">Scalar</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> g<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      cv<span class="token double-colon punctuation">::</span><span class="token function">putText</span><span class="token punctuation">(</span>frame<span class="token punctuation">,</span> caption<span class="token punctuation">,</span> cv<span class="token double-colon punctuation">::</span><span class="token function">Point</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>left<span class="token punctuation">,</span> obj<span class="token punctuation">.</span>top <span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> cv<span class="token double-colon punctuation">::</span><span class="token class-name">Scalar</span><span class="token double-colon punctuation">::</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
      <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"frame"</span><span class="token punctuation">,</span> frame<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// remote_show-&gt;post(frame);</span>
      <span class="token keyword">int</span> key <span class="token operator">=</span> cv<span class="token double-colon punctuation">::</span><span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token number">27</span><span class="token punctuation">)</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  cap<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  cv<span class="token double-colon punctuation">::</span><span class="token function">destroyAllWindows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>	<span class="token comment">// 修改2 调用该函数</span>
  <span class="token comment">// perf();</span>
  <span class="token comment">// batch_inference();</span>
  <span class="token comment">// single_inference();</span>
  <span class="token function">yolo_video_demo</span><span class="token punctuation">(</span><span class="token string">"best.transd.sim.engine"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>修改完成后执行make run即可看到对应的画面显示了</p> 
<h5><a id="45_trtexec_887"></a>4.5 拓展-trtexec参数</h5> 
<p><strong>trtexec</strong>是NVIDIA TensorRT SDK中的一个实用工具，它允许用户从命令行轻松运行和测试TensorRT引擎。trtexec命令行工具可以使用以下参数：</p> 
<pre><code class="prism language-css"><span class="token selector">./trtexec [-h] [--uff model.uff [model.uff ...]] [--onnx model.onnx] [--model=model.plan] [--deploy=&lt;deploy.prototxt&gt;] [--output=&lt;output_name&gt;] [--batch=N] [--device=N] [--workspace=N] [--fp16] [--int8] [--calib=&lt;dir&gt;] [--useDLA=N] [--allowGPUFallback] [--iterations=N] [--avgRuns=N] [--verbose] [--nshapes=N] [--optShapes=NxN ... NxN] [--minShapes=NxN ... NxN] [--maxShapes=NxN ... NxN] [--shapeInput=</span><span class="token punctuation">{<!-- --></span>0<span class="token punctuation">,</span>1<span class="token punctuation">,</span>2<span class="token punctuation">,</span>...<span class="token punctuation">}</span>] [--tacticSources] [--loadEngine=&lt;filename&gt;] [--saveEngine=&lt;filename&gt;] [--plugins=&lt;XML file&gt;] [--dumpOutput=&lt;filename&gt;] [--excludePlugin=&lt;name&gt;] [--start=&lt;tag&gt;] [--streams=N] [--batchTile] [--engine=&lt;filename&gt;] [--uffInput=input_name<span class="token punctuation">,</span>input_shape] [--uffNHWC] [--uffNCHW] [--uffHW=&lt;value&gt;] [--workspaceSize=&lt;size&gt;] [--buildOnly] [--engineFormat=&lt;format&gt;] [--refit] [--saveRefinedEngine=&lt;filename&gt;] [--calibrator=&lt;classname&gt;] [--detach] [--check] [--fp16Char] [--int8Calib=&lt;dir&gt;] [--int8IO] [--disableTensorCores] [--useSpinWait] [--shapes=&lt;shape&gt;] [--maxBatch=&lt;size&gt;]
</code></pre> 
<p>其中一些重要的参数如下：</p> 
<ul><li><code>--uff</code>：指定输入为UFF模型，后面跟上模型文件的路径。</li><li><code>--onnx</code>：指定输入为ONNX模型，后面跟上模型文件的路径。</li><li><code>--model</code>：指定输入为序列化的引擎文件，后面跟上文件路径。</li><li><code>--deploy</code>：指定输入为Caffe deploy文件的路径。</li><li><code>--output</code>：指定输出Tensor名称。</li><li><code>--batch</code>：指定执行推理时每个batch的大小，默认为1。</li><li><code>--device</code>：指定执行推理的设备编号，默认为0。</li><li><code>--workspace</code>：指定GPU内存的最大使用量，默认为1GB。</li><li><code>--fp16</code>：启用FP16精度，可提高推理性能和减少内存使用。</li><li><code>--int8</code>：启用INT8精度，可进一步提高推理性能和减少内存使用。</li><li><code>--calib</code>：指定INT8校准数据集的路径。</li><li><code>--useDLA</code>：指定使用哪个DLA，以及在DLA上运行哪些层。</li><li><code>--allowGPUFallback</code>：如果使用DLA，当某些层无法在DLA上运行时，是否允许将其回退到GPU。</li><li><code>--iterations</code>：指定测试迭代次数。</li><li><code>--avgRuns</code>：指定平均运行次数。</li><li><code>--verbose</code>：打印更详细的输出信息。</li><li><code>--loadEngine</code>：指定加载的TensorRT引擎文件，后面跟上文件路径</li><li><code>--saveEngine</code>：指定生成的TensorRT引擎文件，后面跟上文件路径</li></ul> 
<h3><a id="_916"></a>结语</h3> 
<blockquote> 
 <p>本篇博客介绍了关于yolov8模型训练的流程，以及在jetson nano嵌入式上的部署工作，并安利了一个全新的推理部署框架infer。博主在这里只做了最基础的演示，如果有更多的需求需要各位看官自己去挖掘啦😄。感谢各位看到最后，创作不易，读后有收获的看官请帮忙点个👍⭐️。</p> 
</blockquote> 
<h3><a id="_920"></a>下载链接</h3> 
<ul><li><a href="https://pan.baidu.com/s/1c50iU7PLwhJfAsCDYs9bvw" rel="nofollow">yolov8源码[pwd:yolo]</a></li><li><a href="https://pan.baidu.com/s/1oeBugM-bqRN6QFnVgXi5HQ" rel="nofollow">口罩识别数据集[password:yolo]</a></li><li><a href="https://pan.baidu.com/s/1u8SaxfJLXnHZoyAmHqculw" rel="nofollow">yolov8预训练权重[pwd:yolo]</a></li><li><a href="https://pan.baidu.com/s/193prud3xw-SmG8ercjZlug" rel="nofollow">yolov8口罩识别权重[pwd:yolo]</a></li><li><a href="https://pan.baidu.com/s/1T47jZ1AswHnaX32GOkqR_Q" rel="nofollow">infer源码[pwd:yolo]</a></li><li><a href="https://pan.baidu.com/s/1RW8Z-EQK--NtPgIe6mmKIQ?_at_=1660636990470#list/path=%2F" rel="nofollow">JetPack镜像[password:nano]</a></li></ul> 
<h3><a id="_929"></a>参考</h3> 
<ul><li> <p><a href="https://github.com/shouxieai/infer">infer</a></p> </li><li> <p><a href="https://blog.csdn.net/qq_40672115/category_11970990.html?spm=1001.2014.3001.5482">Jetson嵌入式系列模型部署教程</a></p> </li><li> <p><a href="https://blog.csdn.net/qq_37706472/article/details/128679699?spm=1001.2014.3001.5502">YOLOv8最强操作.</a></p> </li><li> <p><a href="https://github.com/ultralytics/ultralytics">yolov8</a></p> </li><li> <p><a href="https://blog.csdn.net/didiaopao/article/details/119787139?spm=1001.2014.3001.5501">利用Anaconda安装pytorch和paddle深度学习环境+pycharm安装—免额外安装CUDA和cudnn(适合小白的保姆级教学)</a></p> </li><li> <p><a href="https://www.bilibili.com/video/BV1i7411376y?spm_id_from=333.337.search-card.all.click&amp;vd_source=2306b3f342c070c8a11931c94eafa8e3" rel="nofollow">口罩佩戴识别Demo</a></p> </li><li> <p><a href="https://www.bilibili.com/video/BV1kV411k7D8?vd_source=2306b3f342c070c8a11931c94eafa8e3" rel="nofollow">PASCAL VOC2012数据集讲解与制作自己的数据集</a></p> </li><li> <p><a href="https://blog.csdn.net/didiaopao/article/details/120022845?spm=1001.2014.3001.5502">目标检测—数据集格式转化及训练集和验证集划分</a></p> </li><li> <p><a href="https://zhuanlan.zhihu.com/p/339225116" rel="nofollow">Jetson NANO是什么？如何选？</a></p> </li><li> <p><a href="https://blog.csdn.net/Max_ZhangJF/article/details/120966773">trtexec添加环境变量</a></p> </li><li> <p><a href="https://www.bilibili.com/video/BV15Y41167B5/?spm_id_from=333.999.0.0&amp;vd_source=2306b3f342c070c8a11931c94eafa8e3" rel="nofollow">YoloV8的动态静态batch如何理解和使用</a></p> </li><li> <p><a href="https://www.codetd.com/article/14303045" rel="nofollow">onnxoptimizer、onnxsim使用记录</a></p> </li><li> <p><a href="https://www.bilibili.com/video/BV1F24y1h7LW/?spm_id_from=333.999.0.0&amp;vd_source=2306b3f342c070c8a11931c94eafa8e3" rel="nofollow">如何高效使用TensorRT</a></p> </li><li> <p><a href="https://www.bilibili.com/video/BV1i7411376y?spm_id_from=333.337.search-card.all.click&amp;vd_source=2306b3f342c070c8a11931c94eafa8e3" rel="nofollow">口罩佩戴识别Demo</a></p> </li><li> <p><a href="https://www.bilibili.com/video/BV1kV411k7D8?vd_source=2306b3f342c070c8a11931c94eafa8e3" rel="nofollow">PASCAL VOC2012数据集讲解与制作自己的数据集</a></p> </li><li> <p><a href="https://blog.csdn.net/didiaopao/article/details/120022845?spm=1001.2014.3001.5502">目标检测—数据集格式转化及训练集和验证集划分</a></p> </li><li> <p><a href="https://zhuanlan.zhihu.com/p/339225116" rel="nofollow">Jetson NANO是什么？如何选？</a></p> </li><li> <p><a href="https://blog.csdn.net/Max_ZhangJF/article/details/120966773">trtexec添加环境变量</a></p> </li><li> <p><a href="https://www.bilibili.com/video/BV15Y41167B5/?spm_id_from=333.999.0.0&amp;vd_source=2306b3f342c070c8a11931c94eafa8e3" rel="nofollow">YoloV8的动态静态batch如何理解和使用</a></p> </li><li> <p><a href="https://www.codetd.com/article/14303045" rel="nofollow">onnxoptimizer、onnxsim使用记录</a></p> </li><li> <p><a href="https://www.bilibili.com/video/BV1F24y1h7LW/?spm_id_from=333.999.0.0&amp;vd_source=2306b3f342c070c8a11931c94eafa8e3" rel="nofollow">如何高效使用TensorRT</a></p> </li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8ac544ff1a373e498ddb53889e7ef630/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">HW自学：蓝队初级到中级</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d6d896b79f2a84ea39d30a38ce4910c0/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">masm32 链接问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>