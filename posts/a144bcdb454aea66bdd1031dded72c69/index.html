<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>[è½¬]Jetson nanoéƒ¨ç½²YOLOv8-CSDNåšå®¢ - èœé¸Ÿç¨‹åºå‘˜åšå®¢</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="[è½¬]Jetson nanoéƒ¨ç½²YOLOv8-CSDNåšå®¢" />
<meta property="og:description" content="ç›®å½• å‰è¨€ä¸€ã€YOLOv8æ¨¡å‹è®­ç»ƒ 1. é¡¹ç›®çš„å…‹éš†å’Œå¿…è¦çš„ç¯å¢ƒä¾èµ– 1.1 é¡¹ç›®çš„å…‹éš†1.2 é¡¹ç›®ä»£ç ç»“æ„æ•´ä½“ä»‹ç»1.3 ç¯å¢ƒå®‰è£…2. æ•°æ®é›†å’Œé¢„è®­ç»ƒæƒé‡çš„å‡†å¤‡ 2.1 æ•°æ®é›†2.2 é¢„è®­ç»ƒæƒé‡å‡†å¤‡3. è®­ç»ƒæ¨¡å‹ 3.1 ä¿®æ”¹æ•°æ®é…ç½®æ–‡ä»¶3.2 ä¿®æ”¹æ¨¡å‹é…ç½®æ–‡ä»¶3.3 è®­ç»ƒæ¨¡å‹3.4 æ¨ç†æµ‹è¯•äºŒã€YOLOv8æ¨¡å‹éƒ¨ç½² 1. æºç ä¸‹è½½2. ç¯å¢ƒé…ç½® 2.1 trtexecç¯å¢ƒå˜é‡è®¾ç½®3. ONNXå¯¼å‡º 3.1 é™æ€batchå¯¼å‡º 3.1.1 TransposeèŠ‚ç‚¹çš„æ·»åŠ 3.1.2 ResizeèŠ‚ç‚¹è§£æçš„é—®é¢˜3.2 åŠ¨æ€batchå¯¼å‡º 3.2.1 exporter.pyä¿®æ”¹3.2.2 TransposeèŠ‚ç‚¹æ·»åŠ 3.2.3 ResizeèŠ‚ç‚¹è§£æçš„é—®é¢˜4. è¿è¡Œ 4.1 engineç”Ÿæˆ4.2 æºç ä¿®æ”¹4.3 ç¼–è¯‘è¿è¡Œ4.4 æ‹“å±•-æ‘„åƒå¤´æ£€æµ‹4.5 æ‹“å±•-trtexecå‚æ•°ç»“è¯­ä¸‹è½½é“¾æ¥å‚è€ƒ å‰è¨€ å¼€å§‹YOLOv8çš„æ¨¡å‹éƒ¨ç½²ï¼Œç›®çš„æ˜¯ä¸ºå¤§å®¶æ¨èä¸€ä¸ªå…¨æ–°çš„tensorrtä»“åº“https://github.com/shouxieai/inferï¼Œå¤§å®¶å¯ä»¥æŸ¥çœ‹æˆ‘ä¹‹å‰çš„JetsonåµŒå…¥å¼ç³»åˆ—æ¨¡å‹éƒ¨ç½²æ•™ç¨‹ï¼Œå¾ˆå¤šç»†èŠ‚è¿™é‡Œå°±ä¸å†èµ˜è¿°äº†ã€‚è€ƒè™‘åˆ°nanoçš„ç®—åŠ›ï¼Œè¿™é‡Œé‡‡ç”¨yolov8n.ptæ¨¡å‹ï¼Œæœ¬æ–‡ä¸»è¦åˆ†äº«yolov8æ¨¡å‹è®­ç»ƒå’Œjetson nanoéƒ¨ç½²yolov8ä¸¤æ–¹é¢çš„å†…å®¹ã€‚è‹¥æœ‰é—®é¢˜æ¬¢è¿å„ä½çœ‹å®˜æ‰¹è¯„æŒ‡æ­£!!!ğŸ˜„
ä¸€ã€YOLOv8æ¨¡å‹è®­ç»ƒ å…ˆæ¥æ¬£èµä¸‹YOLOv8çš„ç½‘ç»œç»“æ„ğŸ˜…
yolov8çš„ä»£ç é£æ ¼å’Œyolov5ç›¸å·®è¾ƒå¤§ï¼Œè®­ç»ƒæµç¨‹ä¹Ÿç¨æœ‰å·®å¼‚ã€‚åšä¸»ä¸»è¦å‚è€ƒé­”é¬¼é¢å…·çš„YOLOv8æœ€å¼ºæ“ä½œ.
1. é¡¹ç›®çš„å…‹éš†å’Œå¿…è¦çš„ç¯å¢ƒä¾èµ– 1.1 é¡¹ç›®çš„å…‹éš† yolov8çš„ä»£ç æ˜¯å¼€æºçš„å¯ç›´æ¥ä»githubå®˜ç½‘ä¸Šä¸‹è½½ï¼Œæºç ä¸‹è½½åœ°å€æ˜¯https://github.com/ultralytics/ultralyticsï¼Œç”±äºyolov8åˆšå‘å¸ƒä¸ä¹…ä¸€ä¸ªå›ºå®šç‰ˆæœ¬éƒ½æ²¡æœ‰ï¼Œæ•…åªèƒ½é‡‡ç”¨ä¸»åˆ†æ”¯è¿›è¡Œæ¨¡å‹çš„è®­ç»ƒå’Œéƒ¨ç½²å·¥ä½œ(PS:ç”±äºä»£ç æ›´æ–°é¢‘ç¹ï¼Œå¯èƒ½å¤§å®¶ä¼šé‡åˆ°ä¸åŒçš„bug)ã€‚Linuxä¸‹ä»£ç å…‹éš†æŒ‡ä»¤å¦‚ä¸‹
git clone https://github.com/ultralytics/ultralytics.git ä¹Ÿå¯æ‰‹åŠ¨ç‚¹å‡»ä¸‹è½½ï¼Œç‚¹å‡»å³ä¸Šè§’çš„CodeæŒ‰é”®ï¼Œå°†ä»£ç ä¸‹è½½ä¸‹æ¥ã€‚è‡³æ­¤æ•´ä¸ªé¡¹ç›®å°±å·²ç»å‡†å¤‡å¥½äº†ã€‚ä¹Ÿå¯ä»¥ç‚¹å‡»here[pwd:yolo]ä¸‹è½½åšä¸»å‡†å¤‡å¥½çš„ä»£ç (æ³¨æ„ä»£ç ä¸‹è½½äº2023/3/14æ—¥ï¼Œè‹¥æœ‰æ”¹åŠ¨è¯·å‚è€ƒæœ€æ–°)
1.2 é¡¹ç›®ä»£ç ç»“æ„æ•´ä½“ä»‹ç» å°†ä¸‹è½½åçš„yolov8çš„ä»£ç è§£å‹ï¼Œå…¶ä»£ç ç›®å½•å¦‚ä¸‹å›¾
åªéœ€è¦å…³æ³¨ultralyticsè¿™ä¸ªæ–‡ä»¶å¤¹çš„å†…å®¹å³å¯ï¼Œä¸‹é¢å¯¹è¿™ä¸ªæ–‡ä»¶å¤¹çš„æ•´ä½“ç›®å½•åšä¸€ä¸ªä»‹ç»
|-assetsï¼šå­˜æ”¾æµ‹è¯•å›¾ç‰‡|-datasetsï¼šå­˜æ”¾ä¸€äº›è¶…å‚æ•°çš„é…ç½®æ–‡ä»¶ä»¥åŠé…ç½®è®­ç»ƒé›†å’ŒéªŒè¯é›†è·¯å¾„çš„coco.yamlæ–‡ä»¶ï¼Œå¦‚æœéœ€è¦ä¿®æ”¹è‡ªå·±çš„æ•°æ®é›†ï¼Œé‚£ä¹ˆéœ€è¦ä¿®æ”¹å…¶ä¸­çš„yamlæ–‡ä»¶|-hubï¼špytorchæ‰©å±•æ¨¡å‹|-modelsï¼šå­˜æ”¾ä¸åŒæ¨¡å‹çš„yamlæ–‡ä»¶ï¼ŒåŒ…æ‹¬v3ã€v5å’Œv8|-nnï¼šå­˜æ”¾yolov8æ•´ä½“ç½‘ç»œæ¨¡å‹æ­å»ºçš„pyæ–‡ä»¶|-trackerï¼šå­˜æ”¾yolov8ç›®æ ‡è·Ÿè¸ªçš„pyæ–‡ä»¶|-yoloï¼šå­˜æ”¾yolov8æ¨¡å‹é¢„æµ‹ã€è®­ç»ƒã€å¯¼å‡ºçš„pyæ–‡ä»¶ cfgï¼šå­˜æ”¾yolov8çš„é…ç½®æ–‡ä»¶ï¼ŒåŒ…æ‹¬è®­ç»ƒæ—¶çš„å‚æ•°æŒ‡å®šå¦‚epochã€batchç­‰ä»¥åŠè¶…å‚æ•°è®¾ç½®ï¼Œæ‰€æœ‰çš„ç›¸å…³é…ç½®éƒ½å¯é€šè¿‡è¿™ä¸ªæ–‡ä»¶è®¾ç½®(é‡ç‚¹å…³æ³¨cfg/default.yamlæ–‡ä»¶)dataï¼šå­˜æ”¾æ•°æ®åŠ è½½çš„pyæ–‡ä»¶engineï¼šå­˜æ”¾æ¨¡å‹å¯¼å‡ºçš„pyæ–‡ä»¶utilsï¼šå­˜æ”¾å·¥å…·ç±»å‡½æ•°ï¼ŒåŒ…æ‹¬lossã€metricsã€plotså‡½æ•°ç­‰v8ï¼šå­˜æ”¾yolov8åˆ†ç±»ã€æ£€æµ‹ã€åˆ†å‰²ç­‰ä¸åŒä»»åŠ¡çš„é¢„æµ‹ã€è®­ç»ƒä»¥åŠéªŒè¯çš„pyæ–‡ä»¶(é‡ç‚¹å…³æ³¨) 1.3 ç¯å¢ƒå®‰è£… å…³äºæ·±åº¦å­¦ä¹ çš„ç¯å¢ƒå®‰è£…å¯å‚è€ƒç‚®å“¥çš„åˆ©ç”¨Anacondaå®‰è£…pytorchå’Œpaddleæ·±åº¦å­¦ä¹ ç¯å¢ƒ&#43;pycharmå®‰è£…â€”å…é¢å¤–å®‰è£…CUDAå’Œcudnn(é€‚åˆå°ç™½çš„ä¿å§†çº§æ•™å­¦)ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚å¦‚æœä¹‹å‰é…ç½®è¿‡yolov5çš„ç¯å¢ƒï¼Œyolov8å¯ç›´æ¥ä½¿ç”¨ã€‚
2. æ•°æ®é›†å’Œé¢„è®­ç»ƒæƒé‡çš„å‡†å¤‡ 2.1 æ•°æ®é›† è¿™é‡Œé‡‡ç”¨çš„æ•°æ®é›†æ˜¯å£ç½©è¯†åˆ«ï¼Œæ¥æºäºBç«™UPä¸»HamlinZhengçš„å£ç½©è¯†åˆ«æ•°æ®é›†ï¼Œè¿™é‡Œç»™å‡ºä¸‹è½½é“¾æ¥Baidu Drive[password:yolo]ï¼Œåšä¸»å°†åŸæ•°æ®é›†æ•´åˆäº†ä¸‹ï¼Œæ–¹ä¾¿åç»­çš„è®­ç»ƒï¼Œè§£å‹åæ•´ä¸ªæ•°æ®é›†ç›®å½•ç»“æ„å¦‚ä¸‹" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/a144bcdb454aea66bdd1031dded72c69/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-04T11:36:46+08:00" />
<meta property="article:modified_time" content="2024-01-04T11:36:46+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="èœé¸Ÿç¨‹åºå‘˜åšå®¢" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">èœé¸Ÿç¨‹åºå‘˜åšå®¢</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">[è½¬]Jetson nanoéƒ¨ç½²YOLOv8-CSDNåšå®¢</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p></p> 
<p></p> 
<p></p> 
<div class="toc"> 
 <h5><a name="t0"></a>ç›®å½•</h5> 
 <ul><li> 
   <ul><li><a href="#_2" rel="nofollow">å‰è¨€</a></li><li><a href="#YOLOv8_6" rel="nofollow">ä¸€ã€YOLOv8æ¨¡å‹è®­ç»ƒ</a></li><li> 
     <ul><li><a href="#1__15" rel="nofollow">1. é¡¹ç›®çš„å…‹éš†å’Œå¿…è¦çš„ç¯å¢ƒä¾èµ–</a></li><li> 
       <ul><li><a href="#11__17" rel="nofollow">1.1 é¡¹ç›®çš„å…‹éš†</a></li><li><a href="#12__29" rel="nofollow">1.2 é¡¹ç›®ä»£ç ç»“æ„æ•´ä½“ä»‹ç»</a></li><li><a href="#13__49" rel="nofollow">1.3 ç¯å¢ƒå®‰è£…</a></li></ul></li><li><a href="#2__53" rel="nofollow">2. æ•°æ®é›†å’Œé¢„è®­ç»ƒæƒé‡çš„å‡†å¤‡</a></li><li> 
       <ul><li><a href="#21__55" rel="nofollow">2.1 æ•°æ®é›†</a></li><li><a href="#22__250" rel="nofollow">2.2 é¢„è®­ç»ƒæƒé‡å‡†å¤‡</a></li></ul></li><li><a href="#3__255" rel="nofollow">3. è®­ç»ƒæ¨¡å‹</a></li><li> 
       <ul><li><a href="#31__261" rel="nofollow">3.1 ä¿®æ”¹æ•°æ®é…ç½®æ–‡ä»¶</a></li><li><a href="#32__276" rel="nofollow">3.2 ä¿®æ”¹æ¨¡å‹é…ç½®æ–‡ä»¶</a></li><li><a href="#33__288" rel="nofollow">3.3 è®­ç»ƒæ¨¡å‹</a></li><li><a href="#34__297" rel="nofollow">3.4 æ¨ç†æµ‹è¯•</a></li></ul></li></ul></li><li><a href="#YOLOv8_313" rel="nofollow">äºŒã€YOLOv8æ¨¡å‹éƒ¨ç½²</a></li><li> 
     <ul><li><a href="#1__317" rel="nofollow">1. æºç ä¸‹è½½</a></li><li><a href="#2__327" rel="nofollow">2. ç¯å¢ƒé…ç½®</a></li><li> 
       <ul><li><a href="#21_trtexec_336" rel="nofollow">2.1 trtexecç¯å¢ƒå˜é‡è®¾ç½®</a></li></ul></li><li><a href="#3_ONNX_358" rel="nofollow">3. ONNXå¯¼å‡º</a></li><li> 
       <ul><li><a href="#31_batch_377" rel="nofollow">3.1 é™æ€batchå¯¼å‡º</a></li><li> 
         <ul><li><a href="#311_Transpose_379" rel="nofollow">3.1.1 TransposeèŠ‚ç‚¹çš„æ·»åŠ </a></li><li><a href="#312_Resize_457" rel="nofollow">3.1.2 ResizeèŠ‚ç‚¹è§£æçš„é—®é¢˜</a></li></ul></li><li><a href="#32_batch_545" rel="nofollow">3.2 åŠ¨æ€batchå¯¼å‡º</a></li><li> 
         <ul><li><a href="#321_exporterpy_547" rel="nofollow">3.2.1 exporter.pyä¿®æ”¹</a></li><li><a href="#322_Transpose_588" rel="nofollow">3.2.2 TransposeèŠ‚ç‚¹æ·»åŠ </a></li><li><a href="#323_Resize_592" rel="nofollow">3.2.3 ResizeèŠ‚ç‚¹è§£æçš„é—®é¢˜</a></li></ul></li></ul></li><li><a href="#4__657" rel="nofollow">4. è¿è¡Œ</a></li><li> 
       <ul><li><a href="#41_engine_659" rel="nofollow">4.1 engineç”Ÿæˆ</a></li><li><a href="#42__685" rel="nofollow">4.2 æºç ä¿®æ”¹</a></li><li><a href="#43__713" rel="nofollow">4.3 ç¼–è¯‘è¿è¡Œ</a></li><li><a href="#44__825" rel="nofollow">4.4 æ‹“å±•-æ‘„åƒå¤´æ£€æµ‹</a></li><li><a href="#45_trtexec_887" rel="nofollow">4.5 æ‹“å±•-trtexecå‚æ•°</a></li></ul></li></ul></li><li><a href="#_916" rel="nofollow">ç»“è¯­</a></li><li><a href="#_920" rel="nofollow">ä¸‹è½½é“¾æ¥</a></li><li><a href="#_929" rel="nofollow">å‚è€ƒ</a></li></ul></li></ul> 
</div> 
<p></p> 
<p></p> 
<p></p> 
<h4><a name="t1"></a><a id="_2"></a>å‰è¨€</h4> 
<p></p> 
<blockquote> 
 <p>å¼€å§‹YOLOv8çš„<a class="hl hl-1" href="https://so.csdn.net/so/search?q=%E6%A8%A1%E5%9E%8B%E9%83%A8%E7%BD%B2&amp;spm=1001.2101.3001.7020">æ¨¡å‹éƒ¨ç½²</a>ï¼Œç›®çš„æ˜¯ä¸ºå¤§å®¶æ¨èä¸€ä¸ªå…¨æ–°çš„tensorrtä»“åº“<a href="https://github.com/shouxieai/infer">https://github.com/shouxieai/infer</a>ï¼Œå¤§å®¶å¯ä»¥æŸ¥çœ‹æˆ‘ä¹‹å‰çš„<a href="https://blog.csdn.net/qq_40672115/category_11970990.html?spm=1001.2014.3001.5482">JetsonåµŒå…¥å¼ç³»åˆ—æ¨¡å‹éƒ¨ç½²æ•™ç¨‹</a>ï¼Œå¾ˆå¤šç»†èŠ‚è¿™é‡Œå°±ä¸å†èµ˜è¿°äº†ã€‚è€ƒè™‘åˆ°nanoçš„ç®—åŠ›ï¼Œè¿™é‡Œé‡‡ç”¨yolov8n.ptæ¨¡å‹ï¼Œæœ¬æ–‡ä¸»è¦åˆ†äº«yolov8æ¨¡å‹è®­ç»ƒå’Œ<a class="hl hl-1" href="https://so.csdn.net/so/search?q=jetson&amp;spm=1001.2101.3001.7020">jetson</a> nanoéƒ¨ç½²yolov8ä¸¤æ–¹é¢çš„å†…å®¹ã€‚è‹¥æœ‰é—®é¢˜æ¬¢è¿å„ä½çœ‹å®˜æ‰¹è¯„æŒ‡æ­£!!!ğŸ˜„</p> 
</blockquote> 
<p></p> 
<h4><a name="t2"></a><a id="YOLOv8_6"></a>ä¸€ã€YOLOv8æ¨¡å‹è®­ç»ƒ</h4> 
<p></p> 
<p>å…ˆæ¥æ¬£èµä¸‹YOLOv8çš„ç½‘ç»œç»“æ„ğŸ˜…</p> 
<p></p> 
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://images2.imgbox.com/37/b0/cce18MCk_o.png"></p> 
<p></p> 
<p>yolov8çš„ä»£ç é£æ ¼å’Œyolov5ç›¸å·®è¾ƒå¤§ï¼Œè®­ç»ƒæµç¨‹ä¹Ÿç¨æœ‰å·®å¼‚ã€‚åšä¸»ä¸»è¦å‚è€ƒé­”é¬¼é¢å…·çš„<a href="https://blog.csdn.net/qq_37706472/article/details/128679699?spm=1001.2014.3001.5502">YOLOv8æœ€å¼ºæ“ä½œ.</a></p> 
<p></p> 
<h5><a name="t3"></a><a id="1__15"></a>1. é¡¹ç›®çš„å…‹éš†å’Œå¿…è¦çš„ç¯å¢ƒä¾èµ–</h5> 
<p></p> 
<h6><a id="11__17"></a>1.1 é¡¹ç›®çš„å…‹éš†</h6> 
<p></p> 
<p>yolov8çš„ä»£ç æ˜¯å¼€æºçš„å¯ç›´æ¥ä»githubå®˜ç½‘ä¸Šä¸‹è½½ï¼Œæºç ä¸‹è½½åœ°å€æ˜¯<a href="https://github.com/ultralytics/ultralytics">https://github.com/ultralytics/ultralytics</a>ï¼Œç”±äºyolov8åˆšå‘å¸ƒä¸ä¹…ä¸€ä¸ªå›ºå®šç‰ˆæœ¬éƒ½æ²¡æœ‰ï¼Œæ•…åªèƒ½é‡‡ç”¨<strong>ä¸»åˆ†æ”¯è¿›è¡Œæ¨¡å‹çš„è®­ç»ƒå’Œéƒ¨ç½²å·¥ä½œ</strong>(PS:ç”±äºä»£ç æ›´æ–°é¢‘ç¹ï¼Œå¯èƒ½å¤§å®¶ä¼šé‡åˆ°ä¸åŒçš„bug)ã€‚Linuxä¸‹ä»£ç å…‹éš†æŒ‡ä»¤å¦‚ä¸‹</p> 
<p></p> 
<pre><code class="hljs">git clone https://github.com/ultralytics/ultralytics.git
</code></pre> 
<p></p> 
<p>ä¹Ÿå¯æ‰‹åŠ¨ç‚¹å‡»ä¸‹è½½ï¼Œç‚¹å‡»å³ä¸Šè§’çš„<code>Code</code>æŒ‰é”®ï¼Œå°†ä»£ç ä¸‹è½½ä¸‹æ¥ã€‚è‡³æ­¤æ•´ä¸ªé¡¹ç›®å°±å·²ç»å‡†å¤‡å¥½äº†ã€‚ä¹Ÿå¯ä»¥ç‚¹å‡»<a href="https://pan.baidu.com/s/1c50iU7PLwhJfAsCDYs9bvw" rel="nofollow">here[pwd:yolo]</a>ä¸‹è½½åšä¸»å‡†å¤‡å¥½çš„ä»£ç (<strong>æ³¨æ„ä»£ç ä¸‹è½½äº2023/3/14æ—¥ï¼Œè‹¥æœ‰æ”¹åŠ¨è¯·å‚è€ƒæœ€æ–°</strong>)</p> 
<p></p> 
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://images2.imgbox.com/4b/11/wlFGk4PR_o.png"></p> 
<p></p> 
<h6><a id="12__29"></a>1.2 é¡¹ç›®ä»£ç ç»“æ„æ•´ä½“ä»‹ç»</h6> 
<p></p> 
<p>å°†ä¸‹è½½åçš„yolov8çš„ä»£ç è§£å‹ï¼Œå…¶ä»£ç ç›®å½•å¦‚ä¸‹å›¾</p> 
<p></p> 
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://images2.imgbox.com/d9/c5/czMws6RN_o.png"><br> åªéœ€è¦å…³æ³¨ultralyticsè¿™ä¸ªæ–‡ä»¶å¤¹çš„å†…å®¹å³å¯ï¼Œä¸‹é¢å¯¹è¿™ä¸ªæ–‡ä»¶å¤¹çš„æ•´ä½“ç›®å½•åšä¸€ä¸ªä»‹ç»</p> 
<p></p> 
<ul><li><strong>|-assets</strong>ï¼šå­˜æ”¾æµ‹è¯•å›¾ç‰‡</li><li><strong>|-datasets</strong>ï¼šå­˜æ”¾ä¸€äº›è¶…å‚æ•°çš„é…ç½®æ–‡ä»¶ä»¥åŠé…ç½®è®­ç»ƒé›†å’ŒéªŒè¯é›†è·¯å¾„çš„coco.yamlæ–‡ä»¶ï¼Œå¦‚æœéœ€è¦ä¿®æ”¹è‡ªå·±çš„æ•°æ®é›†ï¼Œé‚£ä¹ˆéœ€è¦ä¿®æ”¹å…¶ä¸­çš„yamlæ–‡ä»¶</li><li><strong>|-hub</strong>ï¼špytorchæ‰©å±•æ¨¡å‹</li><li><strong>|-models</strong>ï¼šå­˜æ”¾ä¸åŒæ¨¡å‹çš„yamlæ–‡ä»¶ï¼ŒåŒ…æ‹¬v3ã€v5å’Œv8</li><li><strong>|-nn</strong>ï¼šå­˜æ”¾yolov8æ•´ä½“ç½‘ç»œæ¨¡å‹æ­å»ºçš„pyæ–‡ä»¶</li><li><strong>|-tracker</strong>ï¼šå­˜æ”¾yolov8ç›®æ ‡è·Ÿè¸ªçš„pyæ–‡ä»¶</li><li><strong>|-yolo</strong>ï¼šå­˜æ”¾yolov8æ¨¡å‹é¢„æµ‹ã€è®­ç»ƒã€å¯¼å‡ºçš„pyæ–‡ä»¶ 
  <ul><li><strong>cfg</strong>ï¼šå­˜æ”¾yolov8çš„é…ç½®æ–‡ä»¶ï¼ŒåŒ…æ‹¬è®­ç»ƒæ—¶çš„å‚æ•°æŒ‡å®šå¦‚epochã€batchç­‰ä»¥åŠè¶…å‚æ•°è®¾ç½®ï¼Œæ‰€æœ‰çš„ç›¸å…³é…ç½®éƒ½å¯é€šè¿‡è¿™ä¸ªæ–‡ä»¶è®¾ç½®(<strong>é‡ç‚¹å…³æ³¨cfg/default.yamlæ–‡ä»¶</strong>)</li><li><strong>data</strong>ï¼šå­˜æ”¾æ•°æ®åŠ è½½çš„pyæ–‡ä»¶</li><li><strong>engine</strong>ï¼šå­˜æ”¾æ¨¡å‹å¯¼å‡ºçš„pyæ–‡ä»¶</li><li><strong>utils</strong>ï¼šå­˜æ”¾å·¥å…·ç±»å‡½æ•°ï¼ŒåŒ…æ‹¬lossã€metricsã€plotså‡½æ•°ç­‰</li><li><strong>v8</strong>ï¼šå­˜æ”¾yolov8åˆ†ç±»ã€æ£€æµ‹ã€åˆ†å‰²ç­‰ä¸åŒä»»åŠ¡çš„é¢„æµ‹ã€è®­ç»ƒä»¥åŠéªŒè¯çš„pyæ–‡ä»¶(<strong>é‡ç‚¹å…³æ³¨</strong>)</li></ul></li></ul> 
<p></p> 
<h6><a id="13__49"></a>1.3 ç¯å¢ƒå®‰è£…</h6> 
<p></p> 
<p>å…³äºæ·±åº¦å­¦ä¹ çš„ç¯å¢ƒå®‰è£…å¯å‚è€ƒç‚®å“¥çš„<a href="https://blog.csdn.net/didiaopao/article/details/119787139?spm=1001.2014.3001.5501">åˆ©ç”¨Anacondaå®‰è£…pytorchå’Œpaddleæ·±åº¦å­¦ä¹ ç¯å¢ƒ+pycharmå®‰è£…â€”å…é¢å¤–å®‰è£…CUDAå’Œcudnn(é€‚åˆå°ç™½çš„ä¿å§†çº§æ•™å­¦)</a>ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚å¦‚æœä¹‹å‰é…ç½®è¿‡yolov5çš„ç¯å¢ƒï¼Œyolov8å¯ç›´æ¥ä½¿ç”¨ã€‚</p> 
<p></p> 
<h5><a name="t4"></a><a id="2__53"></a>2. æ•°æ®é›†å’Œé¢„è®­ç»ƒæƒé‡çš„å‡†å¤‡</h5> 
<p></p> 
<h6><a id="21__55"></a>2.1 æ•°æ®é›†</h6> 
<p></p> 
<p>è¿™é‡Œé‡‡ç”¨çš„æ•°æ®é›†æ˜¯å£ç½©è¯†åˆ«ï¼Œæ¥æºäº<a href="https://space.bilibili.com/73270408" rel="nofollow">Bç«™UPä¸»HamlinZheng</a>çš„<a href="https://www.bilibili.com/video/BV1i7411376y?spm_id_from=333.337.search-card.all.click&amp;vd_source=2306b3f342c070c8a11931c94eafa8e3" rel="nofollow">å£ç½©è¯†åˆ«æ•°æ®é›†</a>ï¼Œè¿™é‡Œç»™å‡ºä¸‹è½½é“¾æ¥<a href="https://pan.baidu.com/s/1oeBugM-bqRN6QFnVgXi5HQ" rel="nofollow">Baidu Drive[password:yolo]</a>ï¼Œåšä¸»å°†åŸæ•°æ®é›†æ•´åˆäº†ä¸‹ï¼Œæ–¹ä¾¿åç»­çš„è®­ç»ƒï¼Œè§£å‹åæ•´ä¸ªæ•°æ®é›†ç›®å½•ç»“æ„å¦‚ä¸‹</p> 
<p></p> 
<pre><code class="hljs">VOCdevkit
   â””â”€VOC2007
       â”œâ”€Annotations
       â””â”€JPEGImages
</code></pre> 
<p></p> 
<p>å…¶ä¸­JPEGImagesä¸­å­˜æ”¾çš„å›¾åƒæ–‡ä»¶ï¼ŒAnnotationså­˜æ”¾çš„æ˜¯å¯¹åº”çš„XMLæ ‡ç­¾æ–‡ä»¶ã€‚å…³äºæ ‡ç­¾çš„åˆ¶ä½œå¯å‚è€ƒ<a href="https://space.bilibili.com/18161609?spm_id_from=333.337.0.0" rel="nofollow">Bç«™UPä¸»éœ¹é›³å§å•¦Wz</a>çš„<a href="https://www.bilibili.com/video/BV1kV411k7D8?vd_source=2306b3f342c070c8a11931c94eafa8e3" rel="nofollow">PASCAL VOC2012æ•°æ®é›†è®²è§£ä¸åˆ¶ä½œè‡ªå·±çš„æ•°æ®é›†</a>ï¼Œ<strong>ç”±äºlabelimgæ ‡æ³¨çš„æ˜¯VOCæ ¼å¼æ ‡ç­¾çš„XMLæ–‡ä»¶ï¼Œéœ€è¦è½¬åŒ–ä¸ºYOLOæ ¼å¼æ ‡ç­¾çš„txtæ–‡ä»¶</strong>ï¼Œå…³äºè½¬æ¢çš„ä»£ç å¯å‚è€ƒç‚®å“¥çš„<a href="https://blog.csdn.net/didiaopao/article/details/120022845?spm=1001.2014.3001.5502">ç›®æ ‡æ£€æµ‹â€”æ•°æ®é›†æ ¼å¼è½¬åŒ–åŠè®­ç»ƒé›†å’ŒéªŒè¯é›†åˆ’åˆ†</a>ï¼Œä¸‹é¢ç»™å‡ºVOCæ ¼å¼è½¬YOLOæ ¼å¼çš„ä»£ç ï¼š</p> 
<p></p> 
<pre><code class="hljs"># voc2yolo.py
import xml.etree.ElementTree as ET
import pickle
import os
from os import listdir, getcwd
from os.path import join
import random
from shutil import copyfile

# 1. ä¿®æ”¹ä¸ºè‡ªåˆ¶æ•°æ®é›†éœ€æ£€æµ‹çš„ç±»åˆ«æ•°
classes = ["have_mask", "no_mask"]

# 2. è®­ç»ƒé›†å’ŒéªŒè¯é›†çš„æ¯”ä¾‹
TRAIN_RATIO = 80


def clear_hidden_files(path):
    dir_list = os.listdir(path)
    for i in dir_list:
        abspath = os.path.join(os.path.abspath(path), i)
        if os.path.isfile(abspath):
            if i.startswith("._"):
                os.remove(abspath)
        else:
            clear_hidden_files(abspath)


def convert(size, box):
    dw = 1. / size[0]
    dh = 1. / size[1]
    x = (box[0] + box[1]) / 2.0
    y = (box[2] + box[3]) / 2.0
    w = box[1] - box[0]
    h = box[3] - box[2]
    x = x * dw
    w = w * dw
    y = y * dh
    h = h * dh
    return (x, y, w, h)


def convert_annotation(image_id):
    in_file = open('VOCdevkit/VOC2007/Annotations/%s.xml' % image_id)
    out_file = open('VOCdevkit/VOC2007/YOLOLabels/%s.txt' % image_id, 'w')
    tree = ET.parse(in_file)
    root = tree.getroot()
    size = root.find('size')
    w = int(size.find('width').text)
    h = int(size.find('height').text)

    for obj in root.iter('object'):
        difficult = obj.find('difficult').text
        cls = obj.find('name').text
        if cls not in classes or int(difficult) == 1:
            continue
        cls_id = classes.index(cls)
        xmlbox = obj.find('bndbox')
        b = (float(xmlbox.find('xmin').text), float(xmlbox.find('xmax').text), float(xmlbox.find('ymin').text),
             float(xmlbox.find('ymax').text))
        bb = convert((w, h), b)
        out_file.write(str(cls_id) + " " + " ".join([str(a) for a in bb]) + '\n')
    in_file.close()
    out_file.close()


wd = os.getcwd()
wd = os.getcwd()
data_base_dir = os.path.join(wd, "VOCdevkit/")
if not os.path.isdir(data_base_dir):
    os.mkdir(data_base_dir)
work_sapce_dir = os.path.join(data_base_dir, "VOC2007/")
if not os.path.isdir(work_sapce_dir):
    os.mkdir(work_sapce_dir)
annotation_dir = os.path.join(work_sapce_dir, "Annotations/")
if not os.path.isdir(annotation_dir):
    os.mkdir(annotation_dir)
clear_hidden_files(annotation_dir)
image_dir = os.path.join(work_sapce_dir, "JPEGImages/")
if not os.path.isdir(image_dir):
    os.mkdir(image_dir)
clear_hidden_files(image_dir)
yolo_labels_dir = os.path.join(work_sapce_dir, "YOLOLabels/")
if not os.path.isdir(yolo_labels_dir):
    os.mkdir(yolo_labels_dir)
clear_hidden_files(yolo_labels_dir)
yolov5_images_dir = os.path.join(data_base_dir, "images/")
if not os.path.isdir(yolov5_images_dir):
    os.mkdir(yolov5_images_dir)
clear_hidden_files(yolov5_images_dir)
yolov5_labels_dir = os.path.join(data_base_dir, "labels/")
if not os.path.isdir(yolov5_labels_dir):
    os.mkdir(yolov5_labels_dir)
clear_hidden_files(yolov5_labels_dir)
yolov5_images_train_dir = os.path.join(yolov5_images_dir, "train/")
if not os.path.isdir(yolov5_images_train_dir):
    os.mkdir(yolov5_images_train_dir)
clear_hidden_files(yolov5_images_train_dir)
yolov5_images_test_dir = os.path.join(yolov5_images_dir, "val/")
if not os.path.isdir(yolov5_images_test_dir):
    os.mkdir(yolov5_images_test_dir)
clear_hidden_files(yolov5_images_test_dir)
yolov5_labels_train_dir = os.path.join(yolov5_labels_dir, "train/")
if not os.path.isdir(yolov5_labels_train_dir):
    os.mkdir(yolov5_labels_train_dir)
clear_hidden_files(yolov5_labels_train_dir)
yolov5_labels_test_dir = os.path.join(yolov5_labels_dir, "val/")
if not os.path.isdir(yolov5_labels_test_dir):
    os.mkdir(yolov5_labels_test_dir)
clear_hidden_files(yolov5_labels_test_dir)

train_file = open(os.path.join(wd, "yolov5_train.txt"), 'w')
test_file = open(os.path.join(wd, "yolov5_val.txt"), 'w')
train_file.close()
test_file.close()
train_file = open(os.path.join(wd, "yolov5_train.txt"), 'a')
test_file = open(os.path.join(wd, "yolov5_val.txt"), 'a')
list_imgs = os.listdir(image_dir)  # list image files
prob = random.randint(1, 100)
print("Probability: %d" % prob)
for i in range(0, len(list_imgs)):
    path = os.path.join(image_dir, list_imgs[i])
    if os.path.isfile(path):
        image_path = image_dir + list_imgs[i]
        voc_path = list_imgs[i]
        (nameWithoutExtention, extention) = os.path.splitext(os.path.basename(image_path))
        (voc_nameWithoutExtention, voc_extention) = os.path.splitext(os.path.basename(voc_path))
        annotation_name = nameWithoutExtention + '.xml'
        annotation_path = os.path.join(annotation_dir, annotation_name)
        label_name = nameWithoutExtention + '.txt'
        label_path = os.path.join(yolo_labels_dir, label_name)
    prob = random.randint(1, 100)
    print("Probability: %d" % prob)
    if (prob &lt; TRAIN_RATIO):  # train dataset
        if os.path.exists(annotation_path):
            train_file.write(image_path + '\n')
            convert_annotation(nameWithoutExtention)  # convert label
            copyfile(image_path, yolov5_images_train_dir + voc_path)
            copyfile(label_path, yolov5_labels_train_dir + label_name)
    else:  # test dataset
        if os.path.exists(annotation_path):
            test_file.write(image_path + '\n')
            convert_annotation(nameWithoutExtention)  # convert label
            copyfile(image_path, yolov5_images_test_dir + voc_path)
            copyfile(label_path, yolov5_labels_test_dir + label_name)
train_file.close()
test_file.close()
</code></pre> 
<p></p> 
<p>ä»£ç æ€»å…±éœ€è¦ä¿®æ”¹ä¸¤å¤„</p> 
<p></p> 
<ul><li><strong>ç¬¬11è¡Œï¼Œä¿®æ”¹è¦æ£€æµ‹çš„ç±»åˆ«åç§°</strong></li><li><strong>ç¬¬14è¡Œï¼Œä¿®æ”¹è®­ç»ƒé›†å’ŒéªŒè¯é›†çš„åˆ’åˆ†æ¯”ä¾‹</strong></li></ul> 
<p></p> 
<p>æ•´ä¸ªç›®å½•ç»“æ„å¦‚ä¸‹ï¼Œæ³¨æ„<code>voc2yolo.py</code>ä¸<code>VOCdevkit</code>å¤„äº<strong>åŒä¸€çº§ç›®å½•</strong></p> 
<p></p> 
<pre><code class="hljs">VOCdevkit
   â””â”€VOC2007
       â”œâ”€Annotations
       â””â”€JPEGImages
voc2yolo.py
</code></pre> 
<p></p> 
<p><strong>æ³¨</strong>ï¼šç›®å½•ç»“æ„ä¸€å®šè¦ä¸åšä¸»çš„ä¸€è‡´ï¼Œå› ä¸ºç¨‹åºå·²ç»å°†å¯¹åº”ç›®å½•å†™æ­»ã€‚</p> 
<p></p> 
<p>è¿è¡Œ<code>voc2yolo.py</code>ä»£ç ä¹‹åå¾—åˆ°å¦‚ä¸‹ç»“æœ<br><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://images2.imgbox.com/de/1c/cV5SA26U_o.png"><br> å¯ä»¥çœ‹åˆ°ç›®å½•ä¸‹æœ‰ä¸€äº›æ–°çš„æ–‡ä»¶ç”Ÿæˆï¼Œé¦–å…ˆVOCdevkitæ–‡ä»¶å¤¹ä¸‹åˆ†åˆ«ç”Ÿæˆäº†imageså’Œlabelsæ–‡ä»¶å¤¹ï¼Œåˆ†åˆ«å­˜æ”¾ç€å›¾åƒå’Œå¯¹åº”çš„<strong>yoloæ ¼å¼çš„æ ‡ç­¾æ–‡ä»¶</strong>ï¼Œæ¯ä¸ªæ–‡ä»¶å¤¹ä¸‹åˆ†åˆ«åŒ…å«trainå’Œvalä¸¤ä¸ªå­æ–‡ä»¶å¤¹ï¼Œä»£è¡¨å„è‡ªå¯¹åº”çš„è®­ç»ƒé›†å’ŒéªŒè¯é›†ã€‚VOC2007æ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆäº†YOLOLabelsæ–‡ä»¶å¤¹ï¼Œå­˜æ”¾ç€å¯¹åº”yoloæ ¼å¼çš„æ ‡ç­¾æ–‡ä»¶ã€‚ç„¶åè¿˜ç”Ÿæˆäº†<code>yolov5_train.txt</code>ä»¥åŠ<code>yolov5_val.txt</code>ä¸¤ä¸ªtxtæ–‡ä»¶ï¼Œå­˜æ”¾ç€è®­ç»ƒé›†å’ŒéªŒè¯é›†å›¾ç‰‡çš„å®Œæ•´è·¯å¾„ã€‚<strong>yolov8çš„è®­ç»ƒåªéœ€è¦VOCdevkitç›®å½•ä¸‹çš„imageså’Œlabelsä¸¤ä¸ªæ–‡ä»¶å¤¹ï¼Œå…¶å®ƒå‡ä¸éœ€è¦</strong>ï¼Œæ•…æœ€ç»ˆçš„ç›®å½•ç»“æ„å¦‚ä¸‹</p> 
<p></p> 
<pre><code class="hljs">VOCdevkit
    â”œâ”€images
    â”‚  â”œâ”€train
    â”‚  â””â”€val
    â””â”€labels
        â”œâ”€train
        â””â”€val
</code></pre> 
<p></p> 
<p>è‡³æ­¤ï¼Œæ•°æ®é›†çš„å‡†å¤‡å·¥ä½œå®Œæ¯•ã€‚</p> 
<p></p> 
<h6><a id="22__250"></a>2.2 é¢„è®­ç»ƒæƒé‡å‡†å¤‡</h6> 
<p></p> 
<p>yolov8é¢„è®­ç»ƒæƒé‡å¯ä»¥é€šè¿‡<a href="https://github.com/ultralytics/ultralytics">here</a>æ‰¾åˆ°ä¸‹å›¾çš„Modelsï¼Œç„¶åç‚¹å‡»ä¸åŒå¤§å°çš„æƒé‡å³å¯ä¸‹è½½ï¼Œåšä¸»ä¹Ÿæä¾›ä¸‹è½½å¥½çš„å‡ ä¸ªé¢„è®­ç»ƒæƒé‡<a href="https://pan.baidu.com/s/1zvqKaalugR-zKhugDikfDA" rel="nofollow">Baidu Drive[pwd:yolo]</a>ï¼Œ<strong>æ³¨æ„è¿™æ˜¯yolov8æ²¡å›ºå®šç‰ˆæœ¬çš„é¢„è®­ç»ƒæƒé‡ï¼Œè‹¥åç»­æœ‰ç‰ˆæœ¬æ›´æ–°ï¼Œè®°å¾—æ›¿æ¢</strong>ã€‚æœ¬æ¬¡è®­ç»ƒè‡ªå·±çš„æ•°æ®é›†ä½¿ç”¨çš„é¢„è®­ç»ƒæƒé‡ä¸º<code>yolov8n.pt</code></p> 
<p></p> 
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://images2.imgbox.com/4d/10/I3Wgqf8g_o.png"></p> 
<p></p> 
<h5><a name="t5"></a><a id="3__255"></a>3. è®­ç»ƒæ¨¡å‹</h5> 
<p></p> 
<p>å°†å‡†å¤‡å¥½çš„æ•°æ®é›†æ–‡ä»¶å¤¹å³VOCdevkitå¤åˆ¶åˆ°yolov8é¡¹ç›®ç¯å¢ƒä¸­çš„<code>ultralytics-main/ultralytics/datasets</code>æ–‡ä»¶å¤¹ä¸‹ï¼Œå°†å‡†å¤‡å¥½çš„é¢„è®­ç»ƒæƒé‡<code>yolov8n.pt</code>å¤åˆ¶åˆ°yolov8é¡¹ç›®ç¯å¢ƒä¸­çš„<code>ultralytics-main/ultralytics/yolo/v8/detect</code>æ–‡ä»¶å¤¹ä¸‹ã€‚è®­ç»ƒç›®æ ‡æ£€æµ‹æ¨¡å‹ä¸»è¦ä¿®æ”¹æ¨¡å‹é…ç½®æ–‡ä»¶<code>ultralytics-main/ultralytics/yolo/cfg/default.yaml</code>ä»¥åŠæ•°æ®é…ç½®æ–‡ä»¶<code>ultralytics-main/ultralytics/datasets/coco128.yaml</code>ï¼Œé¡¹ç›®ç»“æ„å¦‚ä¸‹æ‰€ç¤º</p> 
<p></p> 
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://images2.imgbox.com/d7/4a/PuFMb6J2_o.png"></p> 
<p></p> 
<h6><a id="31__261"></a>3.1 ä¿®æ”¹æ•°æ®é…ç½®æ–‡ä»¶</h6> 
<p></p> 
<p>ä¿®æ”¹ultralytics/datasetsç›®å½•ä¸‹ç›¸åº”çš„yamlæ–‡ä»¶ï¼Œæ‰¾åˆ°è¯¥ç›®å½•ä¸‹çš„<code>coco128.yaml</code>æ–‡ä»¶ï¼Œä¸»è¦ä¿®æ”¹å¦‚ä¸‹ï¼š</p> 
<p></p> 
<ul><li> <p><strong>1.ä¿®æ”¹ç¬¬11è¡Œçš„æ•°æ®é›†çš„è·¯å¾„</strong></p> </li><li> <p><strong>2.ä¿®æ”¹ç¬¬12è¡Œçš„trainçš„è·¯å¾„</strong></p> </li><li> <p><strong>3.ä¿®æ”¹ç¬¬13è¡Œçš„valè·¯å¾„</strong></p> </li><li> <p><strong>4.ä¿®æ”¹ç¬¬17è¡Œçš„éœ€è¦æ£€æµ‹çš„ç±»åˆ«åç§°</strong></p> </li><li> <p><strong>5.æ³¨é‡Šæœ€åä¸€è¡Œï¼Œå–æ¶ˆcocoæ•°æ®é›†çš„ä¸‹è½½</strong></p> </li></ul> 
<p></p> 
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://images2.imgbox.com/30/19/f4zlOi5Z_o.png"></p> 
<p></p> 
<h6><a id="32__276"></a>3.2 ä¿®æ”¹æ¨¡å‹é…ç½®æ–‡ä»¶</h6> 
<p></p> 
<p>ä¿®æ”¹ultralytics/yolo/cfgç›®å½•ä¸‹å¯¹åº”çš„yamlæ–‡ä»¶ï¼Œæ‰¾åˆ°è¯¥ç›®å½•ä¸‹çš„<code>default.yaml</code>æ–‡ä»¶ï¼Œä¸»è¦ä¿®æ”¹å¦‚ä¸‹ï¼š</p> 
<p></p> 
<ul><li> <p><strong>1.ä¿®æ”¹ç¬¬8è¡Œçš„æ¨¡å‹æ–‡ä»¶ï¼ŒæŒ‡å®šyolov8n.pt</strong></p> </li><li> <p><strong>2.ä¿®æ”¹ç¬¬9è¡Œçš„æ•°æ®æ–‡ä»¶è·¯å¾„ï¼Œå³3.1èŠ‚çš„coco128.yaml</strong></p> </li></ul> 
<p></p> 
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://images2.imgbox.com/03/dd/E6eWx6zT_o.png"></p> 
<p></p> 
<p>è¿˜æœ‰å…¶å®ƒå‚æ•°åšä¸»å¹¶æœªä¿®æ”¹ï¼Œå¦‚<strong>epoches</strong>è®­ç»ƒè½®æ•°ã€<strong>batch</strong>æ‰¹å¤„ç†é‡ç­‰ç­‰ï¼Œ<strong>å¤§å®¶ä¸€å®šè¦æ ¹æ®è‡ªå·±çš„å®é™…æƒ…å†µ(å¦‚æ˜¾å¡ç®—åŠ›ç­‰)æŒ‡å®šä¸åŒçš„å‚æ•°</strong>ï¼Œå¦‚æœä½ ä¹‹å‰è®­ç»ƒè¿‡yolov5ï¼Œé‚£æˆ‘ç›¸ä¿¡è¿™å¯¹ä½ æ¥è¯´åº”è¯¥æ˜¯å°caseğŸ˜„</p> 
<p></p> 
<h6><a id="33__288"></a>3.3 è®­ç»ƒæ¨¡å‹</h6> 
<p></p> 
<p>æŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤å®Œæˆä¿®æ”¹åå¯ä»¥æ‰¾åˆ°yolo/v8/detect/train.pyæ–‡ä»¶ï¼Œç‚¹å‡»è¿è¡Œå³å¯å¼€å§‹è®­ç»ƒã€‚</p> 
<p></p> 
<p>åšä¸»è®­ç»ƒçš„æ¨¡å‹ä¸ºyolov8n.ptä¸”ä½¿ç”¨çš„æ˜¯å•ä¸ªGPUè¿›è¡Œè®­ç»ƒï¼Œæ˜¾å¡ä¸ºRTX3060ï¼Œæ“ä½œç³»ç»Ÿä¸ºWindows10ï¼Œpytorchç‰ˆæœ¬ä¸º1.12.1ï¼Œè®­ç»ƒæ—¶é•¿å¤§æ¦‚1.6ä¸ªå°æ—¶ã€‚</p> 
<p></p> 
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://images2.imgbox.com/6f/0f/CosZ01LV_o.png"><br> è®­ç»ƒå®Œæˆåçš„æ¨¡å‹æƒé‡ä¿å­˜åœ¨runs/detect/train/weightsæ–‡ä»¶å¤¹ä¸‹ï¼Œåç»­ä½¿ç”¨<code>best.pt</code>è¿›è¡Œåç»­æ¨¡å‹éƒ¨ç½²å·¥ä½œå³å¯ï¼Œè¿™é‡Œæä¾›åšä¸»è®­ç»ƒå¥½çš„æƒé‡æ–‡ä»¶ä¸‹è½½é“¾æ¥<a href="https://pan.baidu.com/s/193prud3xw-SmG8ercjZlug" rel="nofollow">Baidu Driver[pwd:yolo]</a></p> 
<p></p> 
<h6><a id="34__297"></a>3.4 æ¨ç†æµ‹è¯•</h6> 
<p></p> 
<p>åˆ©ç”¨é¡¹ç›®ä¸­çš„<code>yolo/v8/detect/predict.py</code>æ–‡ä»¶è¿›è¡Œæµ‹è¯•ï¼Œå°†éœ€è¦æ¨ç†çš„å›¾ç‰‡æ”¾å…¥ultralytics/assetsæ–‡ä»¶å¤¹ä¸‹ï¼Œå°†åˆšè®­ç»ƒçš„å£ç½©è¯†åˆ«æƒé‡æ–‡ä»¶æ”¾å…¥yolo/v8/detectæ–‡ä»¶å¤¹ä¸‹ï¼Œæœ€ååœ¨predict.pyæ–‡ä»¶ç¬¬86è¡ŒæŒ‡å®šåˆšè®­ç»ƒçš„æ¨¡å‹æƒé‡æ–‡ä»¶best.ptå¦‚ä¸‹æ‰€ç¤ºï¼Œç‚¹å‡»è¿è¡Œpredict.pyå³å¯æ‰§è¡Œæµ‹è¯•</p> 
<p></p> 
<pre><code class="hljs">model = 'best.pt'   # predict.pyç¬¬86è¡Œä¿®æ”¹
</code></pre> 
<p></p> 
<p>æ¨ç†å®Œæˆåä¼šåœ¨detect/runsæ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆä¸€ä¸ªdetect/trainç›®å½•ï¼Œæ¨ç†çš„ç»“æœä¿å­˜åœ¨æ­¤ç›®å½•ä¸‹ï¼Œæ¨ç†ç»“æœå¦‚ä¸‹æ‰€ç¤º</p> 
<p></p> 
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://images2.imgbox.com/b0/0d/U9yAFi0E_o.png"><br><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://images2.imgbox.com/bc/94/LTVQvlbb_o.jpg"></p> 
<p></p> 
<p>è‡³æ­¤ï¼Œyolov8æ¨¡å‹è®­ç»ƒå·²ç»å®Œæ¯•ï¼Œä¸‹é¢å¼€å§‹jetson nanoä¸Šçš„éƒ¨ç½²å·¥ä½œã€‚</p> 
<p></p> 
<h4><a name="t6"></a><a id="YOLOv8_313"></a>äºŒã€YOLOv8æ¨¡å‹éƒ¨ç½²</h4> 
<p></p> 
<blockquote> 
 <p>Jetson nanoä¸Šyolov8æ¨¡å‹éƒ¨ç½²æµç¨‹å’Œyolov5ã€yolov7ç›¸å·®è¾ƒå¤§ï¼Œä¸»è¦æ¢äº†ä¸€ä¸ªéƒ¨ç½²æ¡†æ¶ï¼Œå¤§å®¶å¯¹jetsonæ¨¡å‹éƒ¨ç½²æ„Ÿå…´è¶£çš„å¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰å‘çš„<a href="https://blog.csdn.net/qq_40672115/category_11970990.html?spm=1001.2014.3001.5482">JetsonåµŒå…¥å¼ç³»åˆ—æ¨¡å‹éƒ¨ç½²</a>æ–‡ç« ï¼Œè¿™æ¬¡å¸¦å¤§å®¶äº†è§£ä¸‹ä¸€ä¸ªå…¨æ–°çš„<a class="hl hl-1" href="https://so.csdn.net/so/search?q=tensorrt&amp;spm=1001.2101.3001.7020">tensorrt</a>å°è£…ï¼Œéƒ¨ç½²ä½¿ç”¨åˆ°çš„Githubä»“åº“æ˜¯<a href="https://github.com/shouxieai/infer">infer</a>ã€‚è¯¥ä»“åº“é€šè¿‡<code>trtexec</code>å·¥å…·å®Œæˆæ¨¡å‹çš„æ„å»ºå·¥ä½œã€‚å¯¹æ¨¡å‹éƒ¨ç½²æœ‰ç–‘é—®çš„å¯ä»¥å‚è€ƒ<a href="https://blog.csdn.net/qq_40672115/article/details/126386680?spm=1001.2014.3001.5502">JetsonåµŒå…¥å¼ç³»åˆ—æ¨¡å‹éƒ¨ç½²-1</a>ï¼Œæƒ³äº†è§£é€šè¿‡<code>TensorRT</code>çš„<code>Layer API</code>ä¸€å±‚å±‚å®Œæˆæ¨¡å‹çš„æ­å»ºå·¥ä½œå¯å‚è€ƒ<a href="https://blog.csdn.net/qq_40672115/article/details/126368779?spm=1001.2014.3001.5502">JetsonåµŒå…¥å¼ç³»åˆ—æ¨¡å‹éƒ¨ç½²-2</a>ï¼Œæƒ³äº†è§£é€šè¿‡<code>TensorRT</code>çš„<code>ONNX parser</code>è§£æONNXæ–‡ä»¶æ¥å®Œæˆæ¨¡å‹çš„æ­å»ºå·¥ä½œå¯å‚è€ƒ<a href="https://blog.csdn.net/qq_40672115/article/details/126369675?spm=1001.2014.3001.5502">JetsonåµŒå…¥å¼æ¨¡å‹éƒ¨ç½²-3</a>ã€<a href="https://blog.csdn.net/qq_40672115/article/details/126668443?spm=1001.2014.3001.5502">Jetson nanoéƒ¨ç½²YOLOv7</a>ã€‚æœ¬æ–‡ä¸»è¦é’ˆå¯¹<a href="https://github.com/shouxieai/infer">infer</a>é¡¹ç›®ä¸­çš„yolov8å®ŒæˆåµŒå…¥å¼æ¨¡å‹éƒ¨ç½²ï¼Œæœ¬æ–‡å‚è€ƒè‡ª<a href="https://github.com/shouxieai/infer">inferçš„README.md</a>ï¼Œå…·ä½“æ“ä½œæµç¨‹ä½œè€…æè¿°éå¸¸è¯¦ç»†ï¼Œè¿™é‡Œå†ç®€å•è¿‡ä¸€éï¼Œæœ¬æ¬¡è®­ç»ƒçš„æ¨¡å‹ä½¿ç”¨yolov8nï¼Œç±»åˆ«æ•°ä¸º2ï¼Œä¸ºå£ç½©è¯†åˆ«ğŸ˜·ã€‚</p> 
</blockquote> 
<p></p> 
<h5><a name="t7"></a><a id="1__317"></a>1. æºç ä¸‹è½½</h5> 
<p></p> 
<p>inferçš„ä»£ç å¯ä»¥ç›´æ¥ä»githubå®˜ç½‘ä¸Šä¸‹è½½ï¼Œæºç ä¸‹è½½åœ°å€æ˜¯<a href="https://github.com/shouxieai/infer">https://github.com/shouxieai/infer</a>ï¼Œç”±äºinferéƒ¨ç½²æ¡†æ¶åˆšå‘å¸ƒä¸ä¹…ä¸€ä¸ªå›ºå®šçš„ç‰ˆæœ¬éƒ½æ²¡æœ‰ï¼Œæ•…åªèƒ½é‡‡ç”¨<strong>ä¸»åˆ†æ”¯è¿›è¡Œyolov8çš„éƒ¨ç½²å·¥ä½œ</strong>(PS:ç”±äºä»£ç æ›´æ–°é¢‘ç¹ï¼Œå¯èƒ½å¤§å®¶ä¼šé‡åˆ°ä¸åŒçš„bug)ã€‚Linuxä¸‹ä»£ç å…‹éš†æŒ‡ä»¤å¦‚ä¸‹</p> 
<p></p> 
<pre><code class="hljs">$ git clone https://github.com/shouxieai/infer.git
</code></pre> 
<p></p> 
<p>ä¹Ÿå¯æ‰‹åŠ¨ç‚¹å‡»ä¸‹è½½ï¼Œç‚¹å‡»å³ä¸Šè§’çš„<code>Code</code>æŒ‰é”®ï¼Œå°†ä»£ç ä¸‹è½½ä¸‹æ¥ã€‚è‡³æ­¤æ•´ä¸ªé¡¹ç›®å°±å·²ç»å‡†å¤‡å¥½äº†ã€‚ä¹Ÿå¯ä»¥ç‚¹å‡»<a href="https://pan.baidu.com/s/1T47jZ1AswHnaX32GOkqR_Q" rel="nofollow">here[pwd:yolo]</a>ä¸‹è½½åšä¸»å‡†å¤‡å¥½çš„æºä»£ç (<strong>æ³¨æ„ä»£ç ä¸‹è½½äº2023/3/15æ—¥ï¼Œè‹¥æœ‰æ”¹åŠ¨è¯·å‚è€ƒæœ€æ–°</strong>)</p> 
<p></p> 
<h5><a name="t8"></a><a id="2__327"></a>2. ç¯å¢ƒé…ç½®</h5> 
<p></p> 
<blockquote> 
 <p>éœ€è¦ä½¿ç”¨çš„è½¯ä»¶ç¯å¢ƒæœ‰<code>TensorRTã€CUDAã€CUDNNã€OpenCV</code>ã€‚æ‰€æœ‰è½¯ä»¶ç¯å¢ƒåœ¨JetPacké•œåƒä¸­å·²ç»å®‰è£…å®Œæˆï¼Œåªéœ€è¦æ·»åŠ ä¸‹<code>trtexec</code>å·¥å…·çš„ç¯å¢ƒå˜é‡å³å¯ã€‚åšä¸»ä½¿ç”¨çš„jetpackç‰ˆæœ¬ä¸ºJetPack4.6.1(PS:å…³äºjetson nanoåˆ·æœºå°±ä¸å†èµ˜è¿°äº†ï¼Œéœ€è¦å„ä½çœ‹å®˜è‡ªè¡Œé…ç½®å¥½ç›¸å…³ç¯å¢ƒğŸ˜„ï¼Œå¤–ç½‘è®¿é—®è¾ƒæ…¢ï¼Œè¿™é‡Œæä¾›Jetson nanoçš„<a href="https://pan.baidu.com/s/1RW8Z-EQK--NtPgIe6mmKIQ?_at_=1660636990470#list/path=%2F" rel="nofollow">JetPacké•œåƒä¸‹è½½é“¾æ¥Baidu Drive[password:nano]ã€æ›´æ–°å®Œæ¯•!!!ã€‘</a>å‡ ä¸ª(<strong>PS:æä¾›4.6å’Œ4.6.1ä¸¤ä¸ªç‰ˆæœ¬ï¼Œæ³¨æ„4GBå’Œ2GBçš„åŒºåˆ«ï¼Œä¸è¦åˆ·é”™äº†</strong>)ï¼Œå…³äºJetson Nano 2GBå’Œ4GBçš„åŒºåˆ«å¯å‚è€ƒé“¾æ¥<a href="https://zhuanlan.zhihu.com/p/339225116" rel="nofollow">Jetson NANOæ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•é€‰ï¼Ÿ</a>ã€‚(åæ§½ä¸‹è¿™ç©æ„ä¸Šä¼ å¿’æ…¢äº†ï¼Œè¶…çº§ä¼šå‘˜ä¸é¡¶ç”¨å‘€ï¼Œç»ˆäºä¸Šä¼ å®Œäº†ï¼ŒæŠ˜ç£¨!!!)</p> 
</blockquote> 
<p></p> 
<p>åšä¸»çš„Jetpackå¯¹åº”çš„è½¯ä»¶ç¯å¢ƒå¦‚ä¸‹</p> 
<p></p> 
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://images2.imgbox.com/e4/9b/GqbRLwCf_o.png"></p> 
<p></p> 
<h6><a id="21_trtexec_336"></a>2.1 trtexecç¯å¢ƒå˜é‡è®¾ç½®</h6> 
<p></p> 
<p>trtexecç¯å¢ƒå˜é‡çš„æ·»åŠ ä¸»è¦å‚è€ƒ<a href="https://blog.csdn.net/Max_ZhangJF/article/details/120966773">è¿™é‡Œ</a>ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹å‡ æ­¥</p> 
<p></p> 
<p><strong>1</strong>.æ‰“å¼€bashrcæ–‡ä»¶</p> 
<p></p> 
<pre><code class="hljs">vim ~/.bashrc
</code></pre> 
<p></p> 
<p><strong>2</strong>.æŒ‰iè¿›å…¥è¾“å…¥æ¨¡å¼ï¼Œåœ¨æœ€åä¸€è¡Œæ·»åŠ å¦‚ä¸‹è¯­å¥</p> 
<p></p> 
<pre><code class="hljs">export PATH=/usr/src/tensorrt/bin:$PATH
</code></pre> 
<p></p> 
<p><strong>3</strong>.æŒ‰ä¸‹escï¼Œè¾“å…¥:wq!ä¿å­˜é€€å‡ºå³å¯ï¼Œæœ€ååˆ·æ–°ä¸‹ç¯å¢ƒå˜é‡</p> 
<p></p> 
<pre><code class="hljs">source ~/.bashrc
</code></pre> 
<p></p> 
<h5><a name="t9"></a><a id="3_ONNX_358"></a>3. ONNXå¯¼å‡º</h5> 
<p></p> 
<ul><li>è®­ç»ƒçš„æ¨¡å‹ä½¿ç”¨yolov8n.ptï¼Œtorchç‰ˆæœ¬1.12.1ï¼Œonnxç‰ˆæœ¬1.13.1</li><li>å‚è€ƒè‡ª<a href="https://www.bilibili.com/video/BV15Y41167B5/?spm_id_from=333.999.0.0&amp;vd_source=2306b3f342c070c8a11931c94eafa8e3" rel="nofollow">YoloV8çš„åŠ¨æ€é™æ€batchå¦‚ä½•ç†è§£å’Œä½¿ç”¨</a></li></ul> 
<p></p> 
<p>å…³äºé™æ€batchå’ŒåŠ¨æ€batchæœ‰ä»¥ä¸‹å‡ ç‚¹è¯´æ˜ï¼Œæ›´å¤šç»†èŠ‚è¯·æŸ¥çœ‹<a href="https://www.bilibili.com/video/BV15Y41167B5/?spm_id_from=333.999.0.0&amp;vd_source=2306b3f342c070c8a11931c94eafa8e3" rel="nofollow">è§†é¢‘</a></p> 
<p></p> 
<p><strong>é™æ€batch</strong></p> 
<p></p> 
<ul><li>å¯¼å‡ºçš„onnxæŒ‡å®šæ‰€æœ‰ç»´åº¦å‡ä¸ºæ˜ç¡®çš„æ•°å­—ï¼Œæ˜¯é™æ€shapeæ¨¡å‹</li><li>åœ¨æ¨ç†çš„æ—¶å€™ï¼Œå®ƒæ°¸è¿œéƒ½æ˜¯åŒæ ·çš„batchæ¨ç†ï¼Œå³ä½¿ä½ ç›®å‰åªæœ‰ä¸€ä¸ªå›¾æ¨ç†ï¼Œå®ƒä¹Ÿéœ€è¦nä¸ªbatchçš„è€—æ—¶</li><li>é€‚ç”¨äºå¤§éƒ¨åˆ†åœºæ™¯ï¼Œæ•´ä¸ªä»£ç é€»è¾‘éå¸¸ç®€å•</li></ul> 
<p></p> 
<p><strong>åŠ¨æ€batch</strong></p> 
<p></p> 
<ul><li>å¯¼å‡ºçš„æ—¶å€™æŒ‡å®šç‰¹å®šç»´åº¦ä¸ºdynamicï¼Œä¹Ÿå°±æ˜¯ä¸ç¡®å®šçŠ¶æ€</li><li>æ¨¡å‹æ¨ç†æ—¶æ‰å†³å®šæ‰€éœ€æ¨ç†çš„batchå¤§å°ï¼Œè€—æ—¶æœ€ä¼˜ï¼Œä½†onnxå¤æ‚åº¦æé«˜äº†</li><li>é€‚ç”¨äºå¦‚serveræœ‰å¤§é‡ä¸å‡åŒ€çš„è¯·æ±‚æ—¶çš„åœºæ™¯</li></ul> 
<p></p> 
<h6><a id="31_batch_377"></a>3.1 é™æ€batchå¯¼å‡º</h6> 
<p></p> 
<h6><a id="311_Transpose_379"></a>3.1.1 TransposeèŠ‚ç‚¹çš„æ·»åŠ </h6> 
<p></p> 
<p>å°†è®­ç»ƒå¥½çš„å£ç½©è¯†åˆ«æƒé‡<code>best.pt</code>æ”¾åœ¨ultralytics-mainä¸»ç›®å½•ä¸‹ï¼Œæ–°å»ºå¯¼å‡ºæ–‡ä»¶<strong>export.py</strong>ï¼Œå†…å®¹å¦‚ä¸‹ï¼Œæ‰§è¡Œå®Œæˆåå°†ä¼šåœ¨å½“å‰ç›®å½•ç”Ÿæˆå¯¼å‡ºçš„<code>best.onnx</code>æ¨¡å‹</p> 
<p></p> 
<pre><code class="hljs">from ultralytics import YOLO

model = YOLO("best.pt")

success = model.export(format="onnx", batch=1)
</code></pre> 
<p></p> 
<p>æ¨¡å‹éœ€è¦å®Œæˆä¿®æ”¹æ‰èƒ½æ­£ç¡®è¢«<strong>infer</strong>æ¡†æ¶ä½¿ç”¨ï¼Œæ­£å¸¸æ¨¡å‹å¯¼å‡ºçš„è¾“å‡ºä¸º[1,6,8400]ï¼Œå…¶ä¸­1ä»£è¡¨batchï¼Œ6åˆ†åˆ«ä»£è¡¨cx,cy,w,h,ä»¥åŠhave_maskã€no_maskä¸¤ä¸ªç±»åˆ«åˆ†æ•°ï¼Œ8400ä»£è¡¨æ¡†çš„ä¸ªæ•°ã€‚é¦–å…ˆ<strong>infer</strong>æ¡†æ¶çš„è¾“å‡ºåªæ”¯æŒ[1,8400,6]è¿™ç§å½¢å¼çš„è¾“å‡ºï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åœ¨åŸå§‹onnxçš„è¾“å‡ºä¹‹å‰æ·»åŠ ä¸€ä¸ª<strong>Transpose</strong>èŠ‚ç‚¹ï¼Œ<strong>infer</strong>ä»“åº“workspace/v8trans.pyå°±æ˜¯å¸®æˆ‘ä»¬åšè¿™ä¹ˆä¸€ä»¶äº‹æƒ…ï¼Œv8trans.pyå…·ä½“å†…å®¹å¦‚ä¸‹ï¼š</p> 
<p></p> 
<pre><code class="hljs"># v8trans.py
import onnx
import onnx.helper as helper
import sys
import os

def main():

    if len(sys.argv) &lt; 2:
        print("Usage:\n python v8trans.py yolov8n.onnx")
        return 1

    file = sys.argv[1]
    if not os.path.exists(file):
        print(f"Not exist path: {file}")
        return 1

    prefix, suffix = os.path.splitext(file)
    dst = prefix + ".transd" + suffix

    model = onnx.load(file)
    node  = model.graph.node[-1]

    old_output = node.output[0]
    node.output[0] = "pre_transpose"

    for specout in model.graph.output:
        if specout.name == old_output:
            shape0 = specout.type.tensor_type.shape.dim[0]
            shape1 = specout.type.tensor_type.shape.dim[1]
            shape2 = specout.type.tensor_type.shape.dim[2]
            new_out = helper.make_tensor_value_info(
                specout.name,
                specout.type.tensor_type.elem_type,
                [0, 0, 0]
            )
            new_out.type.tensor_type.shape.dim[0].CopyFrom(shape0)
            new_out.type.tensor_type.shape.dim[2].CopyFrom(shape1)
            new_out.type.tensor_type.shape.dim[1].CopyFrom(shape2)
            specout.CopyFrom(new_out)

    model.graph.node.append(
        helper.make_node("Transpose", ["pre_transpose"], [old_output], perm=[0, 2, 1])
    )

    print(f"Model save to {dst}")
    onnx.save(model, dst)
    return 0

if __name__ == "__main__":
    sys.exit(main())
</code></pre> 
<p></p> 
<p>åœ¨å‘½ä»¤è¡Œç»ˆç«¯è¾“å…¥å¦‚ä¸‹æŒ‡ä»¤å³å¯æ·»åŠ TransposeèŠ‚ç‚¹ï¼Œæ‰§è¡Œå®Œæˆä¹‹ååœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆ<code>best.transd.onnx</code>æ¨¡å‹ï¼Œè¯¥æ¨¡å‹æ·»åŠ äº†TransposeèŠ‚ç‚¹ã€‚</p> 
<p></p> 
<pre><code class="hljs">python v8trans.py best.onnx
</code></pre> 
<p></p> 
<p>ä¸‹å›¾å¯¹æ¯”äº†åŸå§‹çš„best.onnxå’Œbest.transd.onnxä¹‹é—´çš„åŒºåˆ«ï¼Œä»å›¾ä¸­å¯ä»¥çœ‹å‡ºè½¬æ¢åçš„onnxæ¨¡å‹åœ¨è¾“å‡ºä¹‹å‰å¤šäº†ä¸€ä¸ªTransposeèŠ‚ç‚¹ï¼Œä¸”è¾“å‡ºçš„1ï¼Œ2ç»´åº¦è¿›è¡Œäº†äº¤æ¢ï¼Œç¬¦åˆ<strong>infer</strong>æ¡†æ¶ã€‚</p> 
<p></p> 
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://images2.imgbox.com/2f/b6/Q85WK2Z4_o.png"></p> 
<p></p> 
<h6><a id="312_Resize_457"></a>3.1.2 ResizeèŠ‚ç‚¹è§£æçš„é—®é¢˜</h6> 
<p></p> 
<p>å…ˆå‰§é€ä¸‹ï¼Œå½“ä½¿ç”¨<strong>trtexec</strong>å·¥å…·æ„å»ºengineæ—¶ä¼šå‡ºç°é”™è¯¯ï¼Œæˆ‘ä»¬ä¸€å¹¶è§£å†³ï¼Œåˆ°æ—¶å€™å¯ç›´æ¥ç”Ÿæˆengineï¼Œé”™è¯¯ä¿¡æ¯å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¤§æ¦‚æ„æ€å°±æ˜¯è¯´Resize_120è¿™ä¸ªèŠ‚ç‚¹çš„scalesæ²¡æœ‰åˆå§‹åŒ–(åº”è¯¥æ˜¯è¿™æ ·ç†è§£çš„å§ğŸ¤”)</p> 
<p></p> 
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://images2.imgbox.com/7a/91/dGcLEyTW_o.png"></p> 
<p></p> 
<p>æˆ‘ä»¬å…ˆé€šè¿‡<a href="https://netron.app/" rel="nofollow">Netron</a>å·¥å…·æ‰“å¼€<code>best.transd.onnx</code>æ¨¡å‹æŸ¥çœ‹ä¸‹Resize_120è¿™ä¸ªèŠ‚ç‚¹çš„ç›¸å…³ä¿¡æ¯ï¼Œåœ¨æ‰¾æ‰¾å…¶å®ƒçš„ResizeèŠ‚ç‚¹å¯¹æ¯”çœ‹çœ‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå·¦è¾¹æ˜¯Resize_103èŠ‚ç‚¹çš„ç›¸å…³ä¿¡æ¯ï¼Œå³è¾¹æ˜¯Resize_120èŠ‚ç‚¹çš„ç›¸å…³ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°å…¶å¯¹åº”çš„Scalesç¡®å®å­˜åœ¨åŒºåˆ«ï¼ŒResize_120èŠ‚ç‚¹Scalesæ²¡æœ‰initializerï¼Œæ²¡æœ‰æ˜ç¡®çš„å€¼ã€‚</p> 
<p></p> 
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://images2.imgbox.com/db/ee/lbq2LsOj_o.png"></p> 
<p></p> 
<p>ä¸‹é¢æ¥çœ‹è§£å†³æ–¹æ¡ˆï¼Œæä¾›ä¸¤ç§</p> 
<p></p> 
<p><strong>è§£å†³æ–¹æ¡ˆ1-onnxsim(æ¨è)</strong></p> 
<p></p> 
<p>onnxoptimizerã€onnxsimè¢«èª‰ä¸ºonnxçš„ä¼˜åŒ–åˆ©å™¨ï¼Œå…¶ä¸­onnxsimå¯ä»¥ä¼˜åŒ–å¸¸é‡ï¼Œonnxoptimizerå¯ä»¥å¯¹èŠ‚ç‚¹è¿›è¡Œå‹ç¼©ï¼Œå‚è€ƒè‡ª<a href="https://www.codetd.com/article/14303045" rel="nofollow">onnxoptimizerã€onnxsimä½¿ç”¨è®°å½•</a>ã€‚æ–°å»ºä¸€ä¸ª<code>v8onnxsim.py</code>æ–‡ä»¶ï¼Œç”¨äºä¼˜åŒ–onnxæ–‡ä»¶ï¼Œå…·ä½“å†…å®¹å¦‚ä¸‹ï¼š</p> 
<p></p> 
<pre><code class="hljs">import onnx
from onnxsim import simplify

onnx_model = onnx.load("best.transd.onnx")
model_simp, check = simplify(onnx_model)
assert check, "Simplified ONNX model could not be Validated"
onnx.save(model_simp, "best.trand.sim.onnx")
</code></pre> 
<p></p> 
<p>è¿è¡Œåä¼šåœ¨å½“å‰æ–‡ä»¶å¤¹ç”Ÿæˆä¸€ä¸ª<code>best.transd.sim.onnx</code>æ¨¡å‹ï¼Œç°åœ¨å¯ä»¥æŸ¥çœ‹å¯¹åº”çš„Resize_120èŠ‚ç‚¹å‘ç”Ÿäº†æ”¹å˜</p> 
<p></p> 
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://images2.imgbox.com/da/e3/rqPWWlqc_o.png"></p> 
<p></p> 
<p><strong>è§£å†³æ–¹æ¡ˆ2-è‡ªå·±åŠ¨æ‰‹</strong></p> 
<p></p> 
<p>ä¿—è¯è¯´è‡ªå·±åŠ¨æ‰‹ä¸°è¡£è¶³é£Ÿï¼Œçœ‹äº†onnxsimä¼˜åŒ–çš„ç»“æœï¼Œçªç„¶æœ‰ç§è‡ªå·±åŠ¨æ‰‹æ“ä½œçš„æ¬²æœ›(PS:å¤§å®¶çœ‹ä¸ªçƒ­é—¹å³å¯ğŸ˜™)ã€‚ä¸»è¦æ­¥éª¤å¦‚ä¸‹ï¼š</p> 
<p></p> 
<ul><li>1.åŠ è½½ONNXæ¨¡å‹</li><li>2.éå†æ¨¡å‹çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œæ‰¾åˆ°è¦æ“ä½œçš„Resize_120</li><li>3.ä¿®æ”¹å…¶è¾“å…¥ä»onnx::Resize_432å˜æˆonnx::Resize_431</li><li>4.åˆ é™¤Identit_2èŠ‚ç‚¹</li><li>5.ä¿å­˜æ¨¡å‹</li></ul> 
<p></p> 
<p>åœ¨å½“å‰ç›®å½•ä¸‹æ–°å»º<code>v8Resize.py</code>æ–‡ä»¶ï¼Œå…¶å†…å®¹å¦‚ä¸‹ï¼š</p> 
<p></p> 
<pre><code class="hljs">
import onnx
import onnx.helper as helper
import sys
import os

def main(file_path):

    # 1.åŠ è½½ONNXæ¨¡å‹æ–‡ä»¶
    model = onnx.load(file_path)
    resize_node = None

    # 2.éå†æ¨¡å‹çš„æ‰€æœ‰èŠ‚ç‚¹ï¼ŒæŸ¥æ‰¾resizeèŠ‚ç‚¹
    # Resize_103 Resize_120
    for node in model.graph.node:
        if node.op_type == "Resize" and node.name == "Resize_120":
            resize_node = node
            break

    if resize_node is None:
        raise ValueError("Resize node not found in the model.")

    # 3.ä¿®æ”¹è¾“å…¥
    resize_node.input[2] = "onnx::Resize_431"

    # 4.åˆ é™¤Identity_2èŠ‚ç‚¹
    for i in range(len(model.graph.node)):
        if model.graph.node[i].name == "Identity_2":
            del model.graph.node[i]
            break

    # 5.ä¿å­˜æ–°æ¨¡å‹
    onnx.save(model, "best.transd.my.onnx")
    print("new model save done.")

if __name__ == "__main__":
    file_path = "./best.transd.onnx"
    sys.exit(main(file_path))
</code></pre> 
<p></p> 
<p>è¿è¡Œè¯¥æ–‡ä»¶åä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆ<code>best.transd.my.onnx</code>æ¨¡å‹ï¼Œç°åœ¨å¯ä»¥æŸ¥çœ‹å¯¹åº”çš„Resize_120èŠ‚ç‚¹å‘ç”Ÿäº†æ”¹å˜<br><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://images2.imgbox.com/9c/cb/wJK8vT5D_o.png"></p> 
<p></p> 
<p>è‡³æ­¤ï¼Œé™æ€batchæ¨¡å‹å¯¼å‡ºå‘Šä¸€æ®µè½ï¼Œåç»­é€šè¿‡<code>trtexec</code>å·¥å…·å¯æ­£å¸¸ç”Ÿæˆengineæ–‡ä»¶äº†ï¼Œä¸»è¦è§£å†³ä¸¤ä¸ªæ–¹é¢çš„é—®é¢˜ï¼Œä¸€æ˜¯è¾“å‡ºå¿…é¡»åŠ ä¸€ä¸ªTransposeè½¬æ¢ï¼ŒäºŒæ˜¯è§£å†³ResizeèŠ‚ç‚¹æ— æ³•è§£æé—®é¢˜ã€‚</p> 
<p></p> 
<h6><a id="32_batch_545"></a>3.2 åŠ¨æ€batchå¯¼å‡º</h6> 
<p></p> 
<h6><a id="321_exporterpy_547"></a>3.2.1 exporter.pyä¿®æ”¹</h6> 
<p></p> 
<p>åŠ¨æ€batchçš„å¯¼å‡ºéœ€è¦ä¿®æ”¹<strong>ultralytics/yolo/engine/exporter.py</strong>æ–‡ä»¶ç¬¬303è¡Œçš„å†…å®¹ï¼Œç¡®ä¿å¯¼å‡ºçš„batchæŒ‡å®šä¸ºåŠ¨æ€ï¼Œå…¶å®ƒç»´åº¦ä¸æŒ‡å®šï¼Œä¿®æ”¹çš„å†…å®¹å¦‚ä¸‹ï¼š</p> 
<p></p> 
<pre><code class="hljs"># -----exporter.pyç¬¬303è¡Œ-----
# dynamic = self.args.dynamic
# if dynamic:
#     dynamic = {'images': {0: 'batch', 2: 'height', 3: 'width'}}  # shape(1,3,640,640)
#     if isinstance(self.model, SegmentationModel):
#         dynamic['output0'] = {0: 'batch', 1: 'anchors'}  # shape(1,25200,85)
#         dynamic['output1'] = {0: 'batch', 2: 'mask_height', 3: 'mask_width'}  # shape(1,32,160,160)
#     elif isinstance(self.model, DetectionModel):
#         dynamic['output0'] = {0: 'batch', 1: 'anchors'}  # shape(1,25200,85)

# -----ä¿®æ”¹ä¸ºå¦‚ä¸‹ä»£ç -----
dynamic = self.args.dynamic
dynamic = True
if dynamic:
    dynamic = {'images': {0: 'batch'}}  # shape(1,3,640,640)
    if isinstance(self.model, SegmentationModel):
        dynamic['output0'] = {0: 'batch', 1: 'anchors'}  # shape(1,25200,85)
        dynamic['output1'] = {0: 'batch', 2: 'mask_height', 3: 'mask_width'}  # shape(1,32,160,160)
    elif isinstance(self.model, DetectionModel):
        dynamic['output0'] = {0: 'batch'}  # shape(1,25200,85)
</code></pre> 
<p></p> 
<p>ç„¶åå°†è®­ç»ƒå¥½çš„å£ç½©è¯†åˆ«æƒé‡<code>best.pt</code>æ”¾åœ¨ultralytics-mainç›®å½•ä¸‹ï¼Œæ–°å»ºå¯¼å‡ºæ–‡ä»¶<strong>export.py</strong>ï¼Œå†…å®¹å¦‚ä¸‹ï¼Œæ‰§è¡Œå®Œæˆåå°†ä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆå¯¼å‡ºçš„<code>best.onnx</code>æ¨¡å‹</p> 
<p></p> 
<pre><code class="hljs">from ultralytics import YOLO

model = YOLO("best.pt")

success = model.export(format='onnx', batch=1)
</code></pre> 
<p></p> 
<p>å¯¼å‡ºçš„onnxæ¨¡å‹å¦‚ä¸‹ï¼š</p> 
<p></p> 
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://images2.imgbox.com/54/5b/7HEeCE5F_o.png"></p> 
<p></p> 
<h6><a id="322_Transpose_588"></a>3.2.2 TransposeèŠ‚ç‚¹æ·»åŠ </h6> 
<p></p> 
<p>ç”±äº<strong>infer</strong>æ¡†æ¶åªæ”¯æŒ[1,8400,6]è¿™ç§å½¢å¼çš„è¾“å‡ºï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åœ¨åŸå§‹onnxä¹‹å‰æ·»åŠ ä¸€ä¸ª<strong>Transpose</strong>èŠ‚ç‚¹ï¼Œ<strong>infer</strong>ä»“åº“workspace/v8trans.pyå°±æ˜¯å¸®æˆ‘ä»¬åšè¿™ä¹ˆä¸€ä»¶äº‹æƒ…ï¼Œv8trans.pyå…·ä½“å†…å®¹å¯å‚è€ƒ3.1.1å°èŠ‚ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚</p> 
<p></p> 
<h6><a id="323_Resize_592"></a>3.2.3 ResizeèŠ‚ç‚¹è§£æçš„é—®é¢˜</h6> 
<p></p> 
<p>åŒæ ·çš„å½“ä½¿ç”¨<strong>trtexec</strong>å·¥å…·æ„å»ºengineæ—¶ï¼Œä¼šå‡ºç°ResizeèŠ‚ç‚¹è§£æé”™è¯¯</p> 
<p></p> 
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://images2.imgbox.com/de/f9/HiwZzmJq_o.png"></p> 
<p></p> 
<p>åºŸè¯å°‘è¯´ï¼Œç›´æ¥ä¸Šè§£å†³æ–¹æ¡ˆ</p> 
<p></p> 
<p><strong>è§£å†³æ–¹æ¡ˆ1-onnxsim</strong></p> 
<p></p> 
<pre><code class="hljs">import onnx
from onnxsim import simplify

onnx_model = onnx.load("best.onnx")
model_simp, check = simplify(onnx_model)
assert check, "Simplified ONNX model could not be Validated"
onnx.save(model_simp, "best.sim.onnx")
</code></pre> 
<p></p> 
<p><strong>è§£å†³æ–¹æ¡ˆ2-è‡ªå·±åŠ¨æ‰‹</strong></p> 
<p></p> 
<pre><code class="hljs">
import onnx
import onnx.helper as helper
import sys
import os

def main(file_path):

    # 1.åŠ è½½ONNXæ¨¡å‹æ–‡ä»¶
    model = onnx.load(file_path)
    resize_node = None

    # 2.éå†æ¨¡å‹çš„æ‰€æœ‰èŠ‚ç‚¹ï¼ŒæŸ¥æ‰¾resizeèŠ‚ç‚¹
    # Resize_106 Resize_123
    for node in model.graph.node:
        if node.op_type == "Resize" and node.name == "Resize_123":
            resize_node = node
            break

    if resize_node is None:
        raise ValueError("Resize node not found in the model.")

    # 3.ä¿®æ”¹è¾“å…¥
    resize_node.input[2] = "onnx::Resize_437"

    # 4.åˆ é™¤Identity_5èŠ‚ç‚¹
    for i in range(len(model.graph.node)):
        if model.graph.node[i].name == "Identity_5":
            del model.graph.node[i]
            break

    # 5.ä¿å­˜æ–°æ¨¡å‹
    onnx.save(model, "best.my.onnx")
    print("new model save done.")

if __name__ == "__main__":
    file_path = "./best.onnx"
    sys.exit(main(file_path))
</code></pre> 
<p></p> 
<p>è‡³æ­¤ï¼Œæ¨¡å‹å¯¼å‡ºå·²ç»å®Œæ¯•ï¼Œåç»­é€šè¿‡å¯¼å‡ºçš„æ¨¡å‹å®Œæˆåœ¨jetson nanoä¸Šçš„éƒ¨ç½²å·¥ä½œï¼Œå¯¼å‡ºçš„æ¨¡å‹æ–‡ä»¶å¯ç‚¹å‡»<a href="https://pan.baidu.com/s/193prud3xw-SmG8ercjZlug" rel="nofollow">here[pwd:yolo]</a>ä¸‹è½½</p> 
<p></p> 
<h5><a name="t10"></a><a id="4__657"></a>4. è¿è¡Œ</h5> 
<p></p> 
<h6><a id="41_engine_659"></a>4.1 engineç”Ÿæˆ</h6> 
<p></p> 
<p>ä¸tensorRT_Proæ¨¡å‹æ„å»ºæ–¹å¼ä¸åŒï¼Œinferæ¡†æ¶ç›´æ¥é€šè¿‡trtexecå·¥å…·ç”Ÿæˆengineï¼Œ<strong>infer</strong>æ¡†æ¶æ‹¥æœ‰ä¸€ä¸ªå…¨æ–°çš„tensorrtå°è£…ï¼Œå¯è½»æ˜“ç»§æ‰¿å„ç±»ä»»åŠ¡ï¼Œç›¸æ¯”äºtensorRT_Proä¼˜ç‚¹å¦‚ä¸‹ï¼š</p> 
<p></p> 
<ul><li>è½»æ˜“å®ç°å„ç±»ä»»åŠ¡çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å‹ï¼Œå¹¶è¿›è¡Œé«˜æ€§èƒ½æ¨ç†</li><li>æ²¡æœ‰å¤æ‚çš„å°è£…ï¼Œå½»åº•è§£å¼€è€¦åˆ!</li><li>å‚è€ƒè‡ª<a href="https://www.bilibili.com/video/BV1F24y1h7LW/?spm_id_from=333.999.0.0&amp;vd_source=2306b3f342c070c8a11931c94eafa8e3" rel="nofollow">å¦‚ä½•é«˜æ•ˆä½¿ç”¨TensorRT</a></li></ul> 
<p></p> 
<p>å°†ç¬¬3èŠ‚å¯¼å‡ºçš„ONNXæ¨¡å‹æ”¾å…¥åˆ°infer/workspaceæ–‡ä»¶å¤¹ä¸‹ï¼Œç„¶ååœ¨jetson nanoç»ˆç«¯æ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤(<strong>ä»¥å¯¼å‡ºçš„é™æ€batchæ¨¡å‹ä¸ºä¾‹</strong>)</p> 
<p></p> 
<pre><code class="hljs">trtexec --onnx=workspace/best.transd.sim.onnx --saveEngine=workspace/best.transd.sim.engine
</code></pre> 
<p></p> 
<p>å›¾è§£å¦‚ä¸‹æ‰€ç¤º(PS:æ¨¡å‹æ„æ¶éœ€è¦ä¸€æ®µæ—¶é—´ï¼Œè¯·è€å¿ƒç­‰å¾…)</p> 
<p></p> 
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://images2.imgbox.com/25/d8/rcmzGMAa_o.png"></p> 
<p></p> 
<p>æ¨¡å‹æ„å»ºå®Œæˆåå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œengineæ‹¿åˆ°æ‰‹åå°±å¯ä»¥å¼€å¹²äº†ğŸ‘¨â€ğŸ­</p> 
<p></p> 
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://images2.imgbox.com/65/82/uEj8h0KO_o.png"><br><strong>æ³¨</strong>ï¼š<strong>å¯¼å‡ºåŠ¨æ€batchæ¨¡å‹æ‰§è¡Œçš„æŒ‡ä»¤ä¸é™æ€batchä¸åŒ</strong>ï¼ï¼ï¼ï¼Œå…·ä½“å¯å‚è€ƒinfer/workspace/build.shæ–‡ä»¶ä¸­çš„å†…å®¹ï¼ŒæŒ‡ä»¤å¦‚ä¸‹ï¼š</p> 
<p></p> 
<pre><code class="hljs">trtexec --onnx=best.transd.sim.onnx --minShapes=images:1x3x640x640 --maxShapes=images:16x3x640x640 --optShapes=images:1x3x640x640 --saveEngine=best.transd.sim.engine
</code></pre> 
<p></p> 
<h6><a id="42__685"></a>4.2 æºç ä¿®æ”¹</h6> 
<p></p> 
<blockquote> 
 <p>yoloæ¨¡å‹çš„æ¨ç†ä»£ç ä¸»è¦åœ¨<code>src/main.cpp</code>æ–‡ä»¶ä¸­ï¼Œéœ€è¦æ¨ç†çš„å›¾ç‰‡æ”¾åœ¨<code>workspace/inference</code>æ–‡ä»¶å¤¹ä¸­ï¼Œæºç ä¿®æ”¹è¾ƒç®€å•ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š</p> 
</blockquote> 
<p></p> 
<ul><li> <p><strong>1.main.cpp 134ï¼Œ135è¡Œæ³¨é‡Šï¼Œåªè¿›è¡Œå•å¼ å›¾ç‰‡çš„æ¨ç†</strong></p> </li><li> <p><strong>2.main.cpp 104è¡Œ ä¿®æ”¹åŠ è½½çš„æ¨¡å‹ä¸ºbest.transd.sim.engineä¸”ç±»å‹ä¸ºV8</strong></p> </li><li> <p><strong>3.main.cpp 10è¡Œ æ–°å¢mylabelsæ•°ç»„ï¼Œæ·»åŠ è‡ªè®­ç»ƒæ¨¡å‹çš„ç±»åˆ«åç§°</strong></p> </li><li> <p><strong>4.mian.cpp 115è¡Œ cocolabelsä¿®æ”¹ä¸ºmylabels</strong></p> </li></ul> 
<p></p> 
<p>å…·ä½“ä¿®æ”¹å¦‚ä¸‹</p> 
<p></p> 
<pre><code class="hljs">int main() {
  // perf();					//ä¿®æ”¹1 134 135è¡Œæ³¨é‡Š
  // batch_inference();			
  single_inference();
  return 0;
}

auto yolo = yolo::load("best.transd.sim.engine", yolo::Type::V8);	//  ä¿®æ”¹2

static const char *mylabels[] = {"have_mask", "no_mask"};	// ä¿®æ”¹3 æ–°å¢mylabelsæ•°ç»„

auto name = mylabels[obj.class_label]		// ä¿®æ”¹4 cocolabelsä¿®æ”¹ä¸ºmylabels
</code></pre> 
<p></p> 
<h6><a id="43__713"></a>4.3 ç¼–è¯‘è¿è¡Œ</h6> 
<p></p> 
<p>ç¼–è¯‘ç”¨åˆ°çš„Makefileæ–‡ä»¶éœ€è¦ä¿®æ”¹ï¼Œä¿®æ”¹åçš„Makefileæ–‡ä»¶å¦‚ä¸‹ï¼Œè¯¦ç»†çš„Makefileæ–‡ä»¶çš„åˆ†æå¯æŸ¥çœ‹<a href="https://blog.csdn.net/qq_40672115/article/details/129795117?spm=1001.2014.3001.5502">Mkaefileå®æˆ˜</a></p> 
<p></p> 
<pre><code class="hljs">cc        := g++
nvcc      = /usr/local/cuda-10.2/bin/nvcc

cpp_srcs  := $(shell find src -name "*.cpp")
cpp_objs  := $(cpp_srcs:.cpp=.cpp.o)
cpp_objs  := $(cpp_objs:src/%=objs/%)
cpp_mk	  := $(cpp_objs:.cpp.o=.cpp.mk)

cu_srcs	  := $(shell find src -name "*.cu")
cu_objs   := $(cu_srcs:.cu=.cu.o)
cu_objs	  := $(cu_objs:src/%=objs/%)
cu_mk	  := $(cu_objs:.cu.o=.cu.mk)

include_paths := src        \
			/usr/include/opencv4 \
			/usr/include/aarch64-linux-gnu \
			/usr/local/cuda-10.2/include

library_paths := /usr/lib/aarch64-linux-gnu \
			/usr/local/cuda-10.2/lib64

link_librarys := opencv_core opencv_highgui opencv_imgproc opencv_videoio opencv_imgcodecs \
			nvinfer nvinfer_plugin nvonnxparser \
			cuda cublas cudart cudnn \
			stdc++ dl

empty		  :=
export_path   := $(subst $(empty) $(empty),:,$(library_paths))

run_paths     := $(foreach item,$(library_paths),-Wl,-rpath=$(item))
include_paths := $(foreach item,$(include_paths),-I$(item))
library_paths := $(foreach item,$(library_paths),-L$(item))
link_librarys := $(foreach item,$(link_librarys),-l$(item))

cpp_compile_flags := -std=c++11 -fPIC -w -g -pthread -fopenmp -O0
cu_compile_flags  := -std=c++11 -g -w -O0 -Xcompiler "$(cpp_compile_flags)"
link_flags        := -pthread -fopenmp -Wl,-rpath='$ORIGIN'

cpp_compile_flags += $(include_paths)
cu_compile_flags  += $(include_paths)
link_flags        += $(library_paths) $(link_librarys) $(run_paths)

ifneq ($(MAKECMDGOALS), clean)
-include $(cpp_mk) $(cu_mk)
endif

pro	   := workspace/pro
expath := library_path.txt

library_path.txt : 
	@echo LD_LIBRARY_PATH=$(export_path):"$"LD_LIBRARY_PATH &gt; $@

workspace/pro : $(cpp_objs) $(cu_objs)
		@echo Link $@
		@mkdir -p $(dir $@)
		@$(cc) $^ -o $@ $(link_flags)

objs/%.cpp.o : src/%.cpp
	@echo Compile CXX </code></pre> 
<pre class="prettyprint set-code-show"><code class="hljs"><code class="prism language-cpp has-numbering">cc <span class="operator token">:</span><span class="operator token">=</span> g<span class="operator token">++</span>nvcc <span class="operator token">=</span> <span class="operator token">/</span>usr<span class="operator token">/</span>local<span class="operator token">/</span>cuda<span class="operator token">-</span><span class="number token">10.2</span><span class="operator token">/</span>bin<span class="operator token">/</span>nvcccpp_srcs <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>shell find src <span class="operator token">-</span>name <span class="string token">"*.cpp"</span><span class="punctuation token">)</span>cpp_objs <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>cpp_srcs<span class="operator token">:</span><span class="punctuation token">.</span>cpp<span class="operator token">=</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>o<span class="punctuation token">)</span>cpp_objs <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>cpp_objs<span class="operator token">:</span>src<span class="operator token">/</span><span class="operator token">%=</span>objs<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">)</span>cpp_mk <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>cpp_objs<span class="operator token">:</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>o<span class="operator token">=</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>mk<span class="punctuation token">)</span>cu_srcs <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>shell find src <span class="operator token">-</span>name <span class="string token">"*.cu"</span><span class="punctuation token">)</span>cu_objs <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>cu_srcs<span class="operator token">:</span><span class="punctuation token">.</span>cu<span class="operator token">=</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>o<span class="punctuation token">)</span>cu_objs <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>cu_objs<span class="operator token">:</span>src<span class="operator token">/</span><span class="operator token">%=</span>objs<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">)</span>cu_mk <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>cu_objs<span class="operator token">:</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>o<span class="operator token">=</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>mk<span class="punctuation token">)</span>include_paths <span class="operator token">:</span><span class="operator token">=</span> src \ <span class="operator token">/</span>usr<span class="operator token">/</span>include<span class="operator token">/</span>opencv4 \ <span class="operator token">/</span>usr<span class="operator token">/</span>include<span class="operator token">/</span>aarch64<span class="operator token">-</span>linux<span class="operator token">-</span>gnu \ <span class="operator token">/</span>usr<span class="operator token">/</span>local<span class="operator token">/</span>cuda<span class="operator token">-</span><span class="number token">10.2</span><span class="operator token">/</span>includelibrary_paths <span class="operator token">:</span><span class="operator token">=</span> <span class="operator token">/</span>usr<span class="operator token">/</span>lib<span class="operator token">/</span>aarch64<span class="operator token">-</span>linux<span class="operator token">-</span>gnu \ <span class="operator token">/</span>usr<span class="operator token">/</span>local<span class="operator token">/</span>cuda<span class="operator token">-</span><span class="number token">10.2</span><span class="operator token">/</span>lib64link_librarys <span class="operator token">:</span><span class="operator token">=</span> opencv_core opencv_highgui opencv_imgproc opencv_videoio opencv_imgcodecs \ nvinfer nvinfer_plugin nvonnxparser \ cuda cublas cudart cudnn \ stdc<span class="operator token">++</span> dlempty <span class="operator token">:</span><span class="operator token">=</span>export_path <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>subst $<span class="punctuation token">(</span>empty<span class="punctuation token">)</span> $<span class="punctuation token">(</span>empty<span class="punctuation token">)</span><span class="punctuation token">,</span><span class="operator token">:</span><span class="punctuation token">,</span>$<span class="punctuation token">(</span>library_paths<span class="punctuation token">)</span><span class="punctuation token">)</span>run_paths <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>foreach item<span class="punctuation token">,</span>$<span class="punctuation token">(</span>library_paths<span class="punctuation token">)</span><span class="punctuation token">,</span><span class="operator token">-</span>Wl<span class="punctuation token">,</span><span class="operator token">-</span>rpath<span class="operator token">=</span>$<span class="punctuation token">(</span>item<span class="punctuation token">)</span><span class="punctuation token">)</span>include_paths <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>foreach item<span class="punctuation token">,</span>$<span class="punctuation token">(</span>include_paths<span class="punctuation token">)</span><span class="punctuation token">,</span><span class="operator token">-</span>I$<span class="punctuation token">(</span>item<span class="punctuation token">)</span><span class="punctuation token">)</span>library_paths <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>foreach item<span class="punctuation token">,</span>$<span class="punctuation token">(</span>library_paths<span class="punctuation token">)</span><span class="punctuation token">,</span><span class="operator token">-</span>L$<span class="punctuation token">(</span>item<span class="punctuation token">)</span><span class="punctuation token">)</span>link_librarys <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>foreach item<span class="punctuation token">,</span>$<span class="punctuation token">(</span>link_librarys<span class="punctuation token">)</span><span class="punctuation token">,</span><span class="operator token">-</span>l$<span class="punctuation token">(</span>item<span class="punctuation token">)</span><span class="punctuation token">)</span>cpp_compile_flags <span class="operator token">:</span><span class="operator token">=</span> <span class="operator token">-</span>std<span class="operator token">=</span>c<span class="operator token">++</span><span class="number token">11</span> <span class="operator token">-</span>fPIC <span class="operator token">-</span>w <span class="operator token">-</span>g <span class="operator token">-</span>pthread <span class="operator token">-</span>fopenmp <span class="operator token">-</span>O0cu_compile_flags <span class="operator token">:</span><span class="operator token">=</span> <span class="operator token">-</span>std<span class="operator token">=</span>c<span class="operator token">++</span><span class="number token">11</span> <span class="operator token">-</span>g <span class="operator token">-</span>w <span class="operator token">-</span>O0 <span class="operator token">-</span>Xcompiler <span class="string token">"$(cpp_compile_flags)"</span>link_flags <span class="operator token">:</span><span class="operator token">=</span> <span class="operator token">-</span>pthread <span class="operator token">-</span>fopenmp <span class="operator token">-</span>Wl<span class="punctuation token">,</span><span class="operator token">-</span>rpath<span class="operator token">=</span><span class="char token">'$$ORIGIN'</span>cpp_compile_flags <span class="operator token">+=</span> $<span class="punctuation token">(</span>include_paths<span class="punctuation token">)</span>cu_compile_flags <span class="operator token">+=</span> $<span class="punctuation token">(</span>include_paths<span class="punctuation token">)</span>link_flags <span class="operator token">+=</span> $<span class="punctuation token">(</span>library_paths<span class="punctuation token">)</span> $<span class="punctuation token">(</span>link_librarys<span class="punctuation token">)</span> $<span class="punctuation token">(</span>run_paths<span class="punctuation token">)</span><span class="function token">ifneq</span> <span class="punctuation token">(</span>$<span class="punctuation token">(</span>MAKECMDGOALS<span class="punctuation token">)</span><span class="punctuation token">,</span> clean<span class="punctuation token">)</span><span class="operator token">-</span>include $<span class="punctuation token">(</span>cpp_mk<span class="punctuation token">)</span> $<span class="punctuation token">(</span>cu_mk<span class="punctuation token">)</span>endifpro <span class="operator token">:</span><span class="operator token">=</span> workspace<span class="operator token">/</span>proexpath <span class="operator token">:</span><span class="operator token">=</span> library_path<span class="punctuation token">.</span>txtlibrary_path<span class="punctuation token">.</span>txt <span class="operator token">:</span> @echo LD_LIBRARY_PATH<span class="operator token">=</span>$<span class="punctuation token">(</span>export_path<span class="punctuation token">)</span><span class="operator token">:</span><span class="string token">"$$"</span>LD_LIBRARY_PATH <span class="operator token">&gt;</span> $@workspace<span class="operator token">/</span>pro <span class="operator token">:</span> $<span class="punctuation token">(</span>cpp_objs<span class="punctuation token">)</span> $<span class="punctuation token">(</span>cu_objs<span class="punctuation token">)</span> @echo Link $@ @mkdir <span class="operator token">-</span>p $<span class="punctuation token">(</span>dir $@<span class="punctuation token">)</span> @$<span class="punctuation token">(</span>cc<span class="punctuation token">)</span> $<span class="operator token">^</span> <span class="operator token">-</span>o $@ $<span class="punctuation token">(</span>link_flags<span class="punctuation token">)</span>objs<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>o <span class="operator token">:</span> src<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cpp @echo Compile CXX $<span class="operator token">&lt;</span> @mkdir <span class="operator token">-</span>p $<span class="punctuation token">(</span>dir $@<span class="punctuation token">)</span> @$<span class="punctuation token">(</span>cc<span class="punctuation token">)</span> <span class="operator token">-</span>c $<span class="operator token">&lt;</span> <span class="operator token">-</span>o $@ $<span class="punctuation token">(</span>cpp_compile_flags<span class="punctuation token">)</span>objs<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>o <span class="operator token">:</span> src<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cu @echo Compile CUDA $<span class="operator token">&lt;</span> @mkdir <span class="operator token">-</span>p $<span class="punctuation token">(</span>dir $@<span class="punctuation token">)</span> @$<span class="punctuation token">(</span>nvcc<span class="punctuation token">)</span> <span class="operator token">-</span>c $<span class="operator token">&lt;</span> <span class="operator token">-</span>o $@ $<span class="punctuation token">(</span>cu_compile_flags<span class="punctuation token">)</span>objs<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>mk <span class="operator token">:</span> src<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cpp @echo Compile depends CXX $<span class="operator token">&lt;</span> @mkdir <span class="operator token">-</span>p $<span class="punctuation token">(</span>dir $@<span class="punctuation token">)</span> @$<span class="punctuation token">(</span>cc<span class="punctuation token">)</span> <span class="operator token">-</span>M $<span class="operator token">&lt;</span> <span class="operator token">-</span>MF $@ <span class="operator token">-</span>MT $<span class="punctuation token">(</span>@<span class="operator token">:</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>mk<span class="operator token">=</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>o<span class="punctuation token">)</span> $<span class="punctuation token">(</span>cpp_compile_flags<span class="punctuation token">)</span> objs<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>mk <span class="operator token">:</span> src<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cu @echo Compile depends CUDA $<span class="operator token">&lt;</span> @mkdir <span class="operator token">-</span>p $<span class="punctuation token">(</span>dir $@<span class="punctuation token">)</span> @$<span class="punctuation token">(</span>nvcc<span class="punctuation token">)</span> <span class="operator token">-</span>M $<span class="operator token">&lt;</span> <span class="operator token">-</span>MF $@ <span class="operator token">-</span>MT $<span class="punctuation token">(</span>@<span class="operator token">:</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>mk<span class="operator token">=</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>o<span class="punctuation token">)</span> $<span class="punctuation token">(</span>cu_compile_flags<span class="punctuation token">)</span>run <span class="operator token">:</span> workspace<span class="operator token">/</span>pro @cd workspace <span class="operator token">&amp;&amp;</span> <span class="punctuation token">.</span><span class="operator token">/</span>proclean <span class="operator token">:</span> @rm <span class="operator token">-</span>rf objs workspace<span class="operator token">/</span>pro @rm <span class="operator token">-</span>rf library_path<span class="punctuation token">.</span>txt @rm <span class="operator token">-</span>rf workspace<span class="operator token">/</span>Result<span class="punctuation token">.</span>jpg# å¯¼å‡ºç¬¦å·ï¼Œä½¿å¾—è¿è¡Œæ—¶èƒ½å¤Ÿé“¾æ¥ä¸Š<span class="keyword token">export</span> LD_LIBRARY_PATH<span class="operator token">:</span><span class="operator token">=</span>$<span class="punctuation token">(</span>export_path<span class="punctuation token">)</span><span class="operator token">:</span>$<span class="punctuation token">(</span>LD_LIBRARY_PATH<span class="punctuation token">)</span></code></code></pre> 
<div class="hljs-button {2}"></div> 
<p><code class="hljs">lt; @mkdir -p $(dir $@) @$(cc) -c </code></p> 
<pre class="prettyprint set-code-show"><code class="hljs"><code class="prism language-cpp has-numbering">cc        <span class="operator token">:</span><span class="operator token">=</span> g<span class="operator token">++</span>nvcc      <span class="operator token">=</span> <span class="operator token">/</span>usr<span class="operator token">/</span>local<span class="operator token">/</span>cuda<span class="operator token">-</span><span class="number token">10.2</span><span class="operator token">/</span>bin<span class="operator token">/</span>nvcccpp_srcs  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>shell find src <span class="operator token">-</span>name <span class="string token">"*.cpp"</span><span class="punctuation token">)</span>cpp_objs  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>cpp_srcs<span class="operator token">:</span><span class="punctuation token">.</span>cpp<span class="operator token">=</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>o<span class="punctuation token">)</span>cpp_objs  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>cpp_objs<span class="operator token">:</span>src<span class="operator token">/</span><span class="operator token">%=</span>objs<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">)</span>cpp_mk	  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>cpp_objs<span class="operator token">:</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>o<span class="operator token">=</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>mk<span class="punctuation token">)</span>cu_srcs	  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>shell find src <span class="operator token">-</span>name <span class="string token">"*.cu"</span><span class="punctuation token">)</span>cu_objs   <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>cu_srcs<span class="operator token">:</span><span class="punctuation token">.</span>cu<span class="operator token">=</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>o<span class="punctuation token">)</span>cu_objs	  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>cu_objs<span class="operator token">:</span>src<span class="operator token">/</span><span class="operator token">%=</span>objs<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">)</span>cu_mk	  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>cu_objs<span class="operator token">:</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>o<span class="operator token">=</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>mk<span class="punctuation token">)</span>include_paths <span class="operator token">:</span><span class="operator token">=</span> src        \			<span class="operator token">/</span>usr<span class="operator token">/</span>include<span class="operator token">/</span>opencv4 \			<span class="operator token">/</span>usr<span class="operator token">/</span>include<span class="operator token">/</span>aarch64<span class="operator token">-</span>linux<span class="operator token">-</span>gnu \			<span class="operator token">/</span>usr<span class="operator token">/</span>local<span class="operator token">/</span>cuda<span class="operator token">-</span><span class="number token">10.2</span><span class="operator token">/</span>includelibrary_paths <span class="operator token">:</span><span class="operator token">=</span> <span class="operator token">/</span>usr<span class="operator token">/</span>lib<span class="operator token">/</span>aarch64<span class="operator token">-</span>linux<span class="operator token">-</span>gnu \			<span class="operator token">/</span>usr<span class="operator token">/</span>local<span class="operator token">/</span>cuda<span class="operator token">-</span><span class="number token">10.2</span><span class="operator token">/</span>lib64link_librarys <span class="operator token">:</span><span class="operator token">=</span> opencv_core opencv_highgui opencv_imgproc opencv_videoio opencv_imgcodecs \			nvinfer nvinfer_plugin nvonnxparser \			cuda cublas cudart cudnn \			stdc<span class="operator token">++</span> dlempty		  <span class="operator token">:</span><span class="operator token">=</span>export_path   <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>subst $<span class="punctuation token">(</span>empty<span class="punctuation token">)</span> $<span class="punctuation token">(</span>empty<span class="punctuation token">)</span><span class="punctuation token">,</span><span class="operator token">:</span><span class="punctuation token">,</span>$<span class="punctuation token">(</span>library_paths<span class="punctuation token">)</span><span class="punctuation token">)</span>run_paths     <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>foreach item<span class="punctuation token">,</span>$<span class="punctuation token">(</span>library_paths<span class="punctuation token">)</span><span class="punctuation token">,</span><span class="operator token">-</span>Wl<span class="punctuation token">,</span><span class="operator token">-</span>rpath<span class="operator token">=</span>$<span class="punctuation token">(</span>item<span class="punctuation token">)</span><span class="punctuation token">)</span>include_paths <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>foreach item<span class="punctuation token">,</span>$<span class="punctuation token">(</span>include_paths<span class="punctuation token">)</span><span class="punctuation token">,</span><span class="operator token">-</span>I$<span class="punctuation token">(</span>item<span class="punctuation token">)</span><span class="punctuation token">)</span>library_paths <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>foreach item<span class="punctuation token">,</span>$<span class="punctuation token">(</span>library_paths<span class="punctuation token">)</span><span class="punctuation token">,</span><span class="operator token">-</span>L$<span class="punctuation token">(</span>item<span class="punctuation token">)</span><span class="punctuation token">)</span>link_librarys <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>foreach item<span class="punctuation token">,</span>$<span class="punctuation token">(</span>link_librarys<span class="punctuation token">)</span><span class="punctuation token">,</span><span class="operator token">-</span>l$<span class="punctuation token">(</span>item<span class="punctuation token">)</span><span class="punctuation token">)</span>cpp_compile_flags <span class="operator token">:</span><span class="operator token">=</span> <span class="operator token">-</span>std<span class="operator token">=</span>c<span class="operator token">++</span><span class="number token">11</span> <span class="operator token">-</span>fPIC <span class="operator token">-</span>w <span class="operator token">-</span>g <span class="operator token">-</span>pthread <span class="operator token">-</span>fopenmp <span class="operator token">-</span>O0cu_compile_flags  <span class="operator token">:</span><span class="operator token">=</span> <span class="operator token">-</span>std<span class="operator token">=</span>c<span class="operator token">++</span><span class="number token">11</span> <span class="operator token">-</span>g <span class="operator token">-</span>w <span class="operator token">-</span>O0 <span class="operator token">-</span>Xcompiler <span class="string token">"$(cpp_compile_flags)"</span>link_flags        <span class="operator token">:</span><span class="operator token">=</span> <span class="operator token">-</span>pthread <span class="operator token">-</span>fopenmp <span class="operator token">-</span>Wl<span class="punctuation token">,</span><span class="operator token">-</span>rpath<span class="operator token">=</span><span class="char token">'$$ORIGIN'</span>cpp_compile_flags <span class="operator token">+=</span> $<span class="punctuation token">(</span>include_paths<span class="punctuation token">)</span>cu_compile_flags  <span class="operator token">+=</span> $<span class="punctuation token">(</span>include_paths<span class="punctuation token">)</span>link_flags        <span class="operator token">+=</span> $<span class="punctuation token">(</span>library_paths<span class="punctuation token">)</span> $<span class="punctuation token">(</span>link_librarys<span class="punctuation token">)</span> $<span class="punctuation token">(</span>run_paths<span class="punctuation token">)</span><span class="function token">ifneq</span> <span class="punctuation token">(</span>$<span class="punctuation token">(</span>MAKECMDGOALS<span class="punctuation token">)</span><span class="punctuation token">,</span> clean<span class="punctuation token">)</span><span class="operator token">-</span>include $<span class="punctuation token">(</span>cpp_mk<span class="punctuation token">)</span> $<span class="punctuation token">(</span>cu_mk<span class="punctuation token">)</span>endifpro	   <span class="operator token">:</span><span class="operator token">=</span> workspace<span class="operator token">/</span>proexpath <span class="operator token">:</span><span class="operator token">=</span> library_path<span class="punctuation token">.</span>txtlibrary_path<span class="punctuation token">.</span>txt <span class="operator token">:</span> 	@echo LD_LIBRARY_PATH<span class="operator token">=</span>$<span class="punctuation token">(</span>export_path<span class="punctuation token">)</span><span class="operator token">:</span><span class="string token">"$$"</span>LD_LIBRARY_PATH <span class="operator token">&gt;</span> $@workspace<span class="operator token">/</span>pro <span class="operator token">:</span> $<span class="punctuation token">(</span>cpp_objs<span class="punctuation token">)</span> $<span class="punctuation token">(</span>cu_objs<span class="punctuation token">)</span>		@echo Link $@		@mkdir <span class="operator token">-</span>p $<span class="punctuation token">(</span>dir $@<span class="punctuation token">)</span>		@$<span class="punctuation token">(</span>cc<span class="punctuation token">)</span> $<span class="operator token">^</span> <span class="operator token">-</span>o $@ $<span class="punctuation token">(</span>link_flags<span class="punctuation token">)</span>objs<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>o <span class="operator token">:</span> src<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cpp	@echo Compile CXX $<span class="operator token">&lt;</span>	@mkdir <span class="operator token">-</span>p $<span class="punctuation token">(</span>dir $@<span class="punctuation token">)</span>	@$<span class="punctuation token">(</span>cc<span class="punctuation token">)</span> <span class="operator token">-</span>c $<span class="operator token">&lt;</span> <span class="operator token">-</span>o $@ $<span class="punctuation token">(</span>cpp_compile_flags<span class="punctuation token">)</span>objs<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>o <span class="operator token">:</span> src<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cu	@echo Compile CUDA $<span class="operator token">&lt;</span>	@mkdir <span class="operator token">-</span>p $<span class="punctuation token">(</span>dir $@<span class="punctuation token">)</span>	@$<span class="punctuation token">(</span>nvcc<span class="punctuation token">)</span> <span class="operator token">-</span>c $<span class="operator token">&lt;</span> <span class="operator token">-</span>o $@ $<span class="punctuation token">(</span>cu_compile_flags<span class="punctuation token">)</span>objs<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>mk <span class="operator token">:</span> src<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cpp	@echo Compile depends CXX $<span class="operator token">&lt;</span>	@mkdir <span class="operator token">-</span>p $<span class="punctuation token">(</span>dir $@<span class="punctuation token">)</span>	@$<span class="punctuation token">(</span>cc<span class="punctuation token">)</span> <span class="operator token">-</span>M $<span class="operator token">&lt;</span> <span class="operator token">-</span>MF $@ <span class="operator token">-</span>MT $<span class="punctuation token">(</span>@<span class="operator token">:</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>mk<span class="operator token">=</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>o<span class="punctuation token">)</span> $<span class="punctuation token">(</span>cpp_compile_flags<span class="punctuation token">)</span>	objs<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>mk <span class="operator token">:</span> src<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cu	@echo Compile depends CUDA $<span class="operator token">&lt;</span>	@mkdir <span class="operator token">-</span>p $<span class="punctuation token">(</span>dir $@<span class="punctuation token">)</span>	@$<span class="punctuation token">(</span>nvcc<span class="punctuation token">)</span> <span class="operator token">-</span>M $<span class="operator token">&lt;</span> <span class="operator token">-</span>MF $@ <span class="operator token">-</span>MT $<span class="punctuation token">(</span>@<span class="operator token">:</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>mk<span class="operator token">=</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>o<span class="punctuation token">)</span> $<span class="punctuation token">(</span>cu_compile_flags<span class="punctuation token">)</span>run   <span class="operator token">:</span> workspace<span class="operator token">/</span>pro		  @cd workspace <span class="operator token">&amp;&amp;</span> <span class="punctuation token">.</span><span class="operator token">/</span>proclean <span class="operator token">:</span>	@rm <span class="operator token">-</span>rf objs workspace<span class="operator token">/</span>pro	@rm <span class="operator token">-</span>rf library_path<span class="punctuation token">.</span>txt	@rm <span class="operator token">-</span>rf workspace<span class="operator token">/</span>Result<span class="punctuation token">.</span>jpg# å¯¼å‡ºç¬¦å·ï¼Œä½¿å¾—è¿è¡Œæ—¶èƒ½å¤Ÿé“¾æ¥ä¸Š<span class="keyword token">export</span> LD_LIBRARY_PATH<span class="operator token">:</span><span class="operator token">=</span>$<span class="punctuation token">(</span>export_path<span class="punctuation token">)</span><span class="operator token">:</span>$<span class="punctuation token">(</span>LD_LIBRARY_PATH<span class="punctuation token">)</span></code></code></pre> 
<div class="hljs-button {2}"></div> 
<p><code class="hljs">lt; -o $@ $(cpp_compile_flags) objs/%.cu.o : src/%.cu @echo Compile CUDA </code></p> 
<pre class="prettyprint set-code-show"><code class="hljs"><code class="prism language-cpp has-numbering">cc        <span class="operator token">:</span><span class="operator token">=</span> g<span class="operator token">++</span>nvcc      <span class="operator token">=</span> <span class="operator token">/</span>usr<span class="operator token">/</span>local<span class="operator token">/</span>cuda<span class="operator token">-</span><span class="number token">10.2</span><span class="operator token">/</span>bin<span class="operator token">/</span>nvcccpp_srcs  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>shell find src <span class="operator token">-</span>name <span class="string token">"*.cpp"</span><span class="punctuation token">)</span>cpp_objs  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>cpp_srcs<span class="operator token">:</span><span class="punctuation token">.</span>cpp<span class="operator token">=</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>o<span class="punctuation token">)</span>cpp_objs  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>cpp_objs<span class="operator token">:</span>src<span class="operator token">/</span><span class="operator token">%=</span>objs<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">)</span>cpp_mk	  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>cpp_objs<span class="operator token">:</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>o<span class="operator token">=</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>mk<span class="punctuation token">)</span>cu_srcs	  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>shell find src <span class="operator token">-</span>name <span class="string token">"*.cu"</span><span class="punctuation token">)</span>cu_objs   <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>cu_srcs<span class="operator token">:</span><span class="punctuation token">.</span>cu<span class="operator token">=</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>o<span class="punctuation token">)</span>cu_objs	  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>cu_objs<span class="operator token">:</span>src<span class="operator token">/</span><span class="operator token">%=</span>objs<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">)</span>cu_mk	  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>cu_objs<span class="operator token">:</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>o<span class="operator token">=</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>mk<span class="punctuation token">)</span>include_paths <span class="operator token">:</span><span class="operator token">=</span> src        \			<span class="operator token">/</span>usr<span class="operator token">/</span>include<span class="operator token">/</span>opencv4 \			<span class="operator token">/</span>usr<span class="operator token">/</span>include<span class="operator token">/</span>aarch64<span class="operator token">-</span>linux<span class="operator token">-</span>gnu \			<span class="operator token">/</span>usr<span class="operator token">/</span>local<span class="operator token">/</span>cuda<span class="operator token">-</span><span class="number token">10.2</span><span class="operator token">/</span>includelibrary_paths <span class="operator token">:</span><span class="operator token">=</span> <span class="operator token">/</span>usr<span class="operator token">/</span>lib<span class="operator token">/</span>aarch64<span class="operator token">-</span>linux<span class="operator token">-</span>gnu \			<span class="operator token">/</span>usr<span class="operator token">/</span>local<span class="operator token">/</span>cuda<span class="operator token">-</span><span class="number token">10.2</span><span class="operator token">/</span>lib64link_librarys <span class="operator token">:</span><span class="operator token">=</span> opencv_core opencv_highgui opencv_imgproc opencv_videoio opencv_imgcodecs \			nvinfer nvinfer_plugin nvonnxparser \			cuda cublas cudart cudnn \			stdc<span class="operator token">++</span> dlempty		  <span class="operator token">:</span><span class="operator token">=</span>export_path   <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>subst $<span class="punctuation token">(</span>empty<span class="punctuation token">)</span> $<span class="punctuation token">(</span>empty<span class="punctuation token">)</span><span class="punctuation token">,</span><span class="operator token">:</span><span class="punctuation token">,</span>$<span class="punctuation token">(</span>library_paths<span class="punctuation token">)</span><span class="punctuation token">)</span>run_paths     <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>foreach item<span class="punctuation token">,</span>$<span class="punctuation token">(</span>library_paths<span class="punctuation token">)</span><span class="punctuation token">,</span><span class="operator token">-</span>Wl<span class="punctuation token">,</span><span class="operator token">-</span>rpath<span class="operator token">=</span>$<span class="punctuation token">(</span>item<span class="punctuation token">)</span><span class="punctuation token">)</span>include_paths <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>foreach item<span class="punctuation token">,</span>$<span class="punctuation token">(</span>include_paths<span class="punctuation token">)</span><span class="punctuation token">,</span><span class="operator token">-</span>I$<span class="punctuation token">(</span>item<span class="punctuation token">)</span><span class="punctuation token">)</span>library_paths <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>foreach item<span class="punctuation token">,</span>$<span class="punctuation token">(</span>library_paths<span class="punctuation token">)</span><span class="punctuation token">,</span><span class="operator token">-</span>L$<span class="punctuation token">(</span>item<span class="punctuation token">)</span><span class="punctuation token">)</span>link_librarys <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>foreach item<span class="punctuation token">,</span>$<span class="punctuation token">(</span>link_librarys<span class="punctuation token">)</span><span class="punctuation token">,</span><span class="operator token">-</span>l$<span class="punctuation token">(</span>item<span class="punctuation token">)</span><span class="punctuation token">)</span>cpp_compile_flags <span class="operator token">:</span><span class="operator token">=</span> <span class="operator token">-</span>std<span class="operator token">=</span>c<span class="operator token">++</span><span class="number token">11</span> <span class="operator token">-</span>fPIC <span class="operator token">-</span>w <span class="operator token">-</span>g <span class="operator token">-</span>pthread <span class="operator token">-</span>fopenmp <span class="operator token">-</span>O0cu_compile_flags  <span class="operator token">:</span><span class="operator token">=</span> <span class="operator token">-</span>std<span class="operator token">=</span>c<span class="operator token">++</span><span class="number token">11</span> <span class="operator token">-</span>g <span class="operator token">-</span>w <span class="operator token">-</span>O0 <span class="operator token">-</span>Xcompiler <span class="string token">"$(cpp_compile_flags)"</span>link_flags        <span class="operator token">:</span><span class="operator token">=</span> <span class="operator token">-</span>pthread <span class="operator token">-</span>fopenmp <span class="operator token">-</span>Wl<span class="punctuation token">,</span><span class="operator token">-</span>rpath<span class="operator token">=</span><span class="char token">'$$ORIGIN'</span>cpp_compile_flags <span class="operator token">+=</span> $<span class="punctuation token">(</span>include_paths<span class="punctuation token">)</span>cu_compile_flags  <span class="operator token">+=</span> $<span class="punctuation token">(</span>include_paths<span class="punctuation token">)</span>link_flags        <span class="operator token">+=</span> $<span class="punctuation token">(</span>library_paths<span class="punctuation token">)</span> $<span class="punctuation token">(</span>link_librarys<span class="punctuation token">)</span> $<span class="punctuation token">(</span>run_paths<span class="punctuation token">)</span><span class="function token">ifneq</span> <span class="punctuation token">(</span>$<span class="punctuation token">(</span>MAKECMDGOALS<span class="punctuation token">)</span><span class="punctuation token">,</span> clean<span class="punctuation token">)</span><span class="operator token">-</span>include $<span class="punctuation token">(</span>cpp_mk<span class="punctuation token">)</span> $<span class="punctuation token">(</span>cu_mk<span class="punctuation token">)</span>endifpro	   <span class="operator token">:</span><span class="operator token">=</span> workspace<span class="operator token">/</span>proexpath <span class="operator token">:</span><span class="operator token">=</span> library_path<span class="punctuation token">.</span>txtlibrary_path<span class="punctuation token">.</span>txt <span class="operator token">:</span> 	@echo LD_LIBRARY_PATH<span class="operator token">=</span>$<span class="punctuation token">(</span>export_path<span class="punctuation token">)</span><span class="operator token">:</span><span class="string token">"$$"</span>LD_LIBRARY_PATH <span class="operator token">&gt;</span> $@workspace<span class="operator token">/</span>pro <span class="operator token">:</span> $<span class="punctuation token">(</span>cpp_objs<span class="punctuation token">)</span> $<span class="punctuation token">(</span>cu_objs<span class="punctuation token">)</span>		@echo Link $@		@mkdir <span class="operator token">-</span>p $<span class="punctuation token">(</span>dir $@<span class="punctuation token">)</span>		@$<span class="punctuation token">(</span>cc<span class="punctuation token">)</span> $<span class="operator token">^</span> <span class="operator token">-</span>o $@ $<span class="punctuation token">(</span>link_flags<span class="punctuation token">)</span>objs<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>o <span class="operator token">:</span> src<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cpp	@echo Compile CXX $<span class="operator token">&lt;</span>	@mkdir <span class="operator token">-</span>p $<span class="punctuation token">(</span>dir $@<span class="punctuation token">)</span>	@$<span class="punctuation token">(</span>cc<span class="punctuation token">)</span> <span class="operator token">-</span>c $<span class="operator token">&lt;</span> <span class="operator token">-</span>o $@ $<span class="punctuation token">(</span>cpp_compile_flags<span class="punctuation token">)</span>objs<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>o <span class="operator token">:</span> src<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cu	@echo Compile CUDA $<span class="operator token">&lt;</span>	@mkdir <span class="operator token">-</span>p $<span class="punctuation token">(</span>dir $@<span class="punctuation token">)</span>	@$<span class="punctuation token">(</span>nvcc<span class="punctuation token">)</span> <span class="operator token">-</span>c $<span class="operator token">&lt;</span> <span class="operator token">-</span>o $@ $<span class="punctuation token">(</span>cu_compile_flags<span class="punctuation token">)</span>objs<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>mk <span class="operator token">:</span> src<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cpp	@echo Compile depends CXX $<span class="operator token">&lt;</span>	@mkdir <span class="operator token">-</span>p $<span class="punctuation token">(</span>dir $@<span class="punctuation token">)</span>	@$<span class="punctuation token">(</span>cc<span class="punctuation token">)</span> <span class="operator token">-</span>M $<span class="operator token">&lt;</span> <span class="operator token">-</span>MF $@ <span class="operator token">-</span>MT $<span class="punctuation token">(</span>@<span class="operator token">:</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>mk<span class="operator token">=</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>o<span class="punctuation token">)</span> $<span class="punctuation token">(</span>cpp_compile_flags<span class="punctuation token">)</span>	objs<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>mk <span class="operator token">:</span> src<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cu	@echo Compile depends CUDA $<span class="operator token">&lt;</span>	@mkdir <span class="operator token">-</span>p $<span class="punctuation token">(</span>dir $@<span class="punctuation token">)</span>	@$<span class="punctuation token">(</span>nvcc<span class="punctuation token">)</span> <span class="operator token">-</span>M $<span class="operator token">&lt;</span> <span class="operator token">-</span>MF $@ <span class="operator token">-</span>MT $<span class="punctuation token">(</span>@<span class="operator token">:</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>mk<span class="operator token">=</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>o<span class="punctuation token">)</span> $<span class="punctuation token">(</span>cu_compile_flags<span class="punctuation token">)</span>run   <span class="operator token">:</span> workspace<span class="operator token">/</span>pro		  @cd workspace <span class="operator token">&amp;&amp;</span> <span class="punctuation token">.</span><span class="operator token">/</span>proclean <span class="operator token">:</span>	@rm <span class="operator token">-</span>rf objs workspace<span class="operator token">/</span>pro	@rm <span class="operator token">-</span>rf library_path<span class="punctuation token">.</span>txt	@rm <span class="operator token">-</span>rf workspace<span class="operator token">/</span>Result<span class="punctuation token">.</span>jpg# å¯¼å‡ºç¬¦å·ï¼Œä½¿å¾—è¿è¡Œæ—¶èƒ½å¤Ÿé“¾æ¥ä¸Š<span class="keyword token">export</span> LD_LIBRARY_PATH<span class="operator token">:</span><span class="operator token">=</span>$<span class="punctuation token">(</span>export_path<span class="punctuation token">)</span><span class="operator token">:</span>$<span class="punctuation token">(</span>LD_LIBRARY_PATH<span class="punctuation token">)</span></code></code></pre> 
<div class="hljs-button {2}"></div> 
<p><code class="hljs">lt; @mkdir -p $(dir $@) @$(nvcc) -c </code></p> 
<pre class="prettyprint set-code-show"><code class="hljs"><code class="prism language-cpp has-numbering">cc        <span class="operator token">:</span><span class="operator token">=</span> g<span class="operator token">++</span>nvcc      <span class="operator token">=</span> <span class="operator token">/</span>usr<span class="operator token">/</span>local<span class="operator token">/</span>cuda<span class="operator token">-</span><span class="number token">10.2</span><span class="operator token">/</span>bin<span class="operator token">/</span>nvcccpp_srcs  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>shell find src <span class="operator token">-</span>name <span class="string token">"*.cpp"</span><span class="punctuation token">)</span>cpp_objs  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>cpp_srcs<span class="operator token">:</span><span class="punctuation token">.</span>cpp<span class="operator token">=</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>o<span class="punctuation token">)</span>cpp_objs  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>cpp_objs<span class="operator token">:</span>src<span class="operator token">/</span><span class="operator token">%=</span>objs<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">)</span>cpp_mk	  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>cpp_objs<span class="operator token">:</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>o<span class="operator token">=</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>mk<span class="punctuation token">)</span>cu_srcs	  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>shell find src <span class="operator token">-</span>name <span class="string token">"*.cu"</span><span class="punctuation token">)</span>cu_objs   <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>cu_srcs<span class="operator token">:</span><span class="punctuation token">.</span>cu<span class="operator token">=</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>o<span class="punctuation token">)</span>cu_objs	  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>cu_objs<span class="operator token">:</span>src<span class="operator token">/</span><span class="operator token">%=</span>objs<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">)</span>cu_mk	  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>cu_objs<span class="operator token">:</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>o<span class="operator token">=</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>mk<span class="punctuation token">)</span>include_paths <span class="operator token">:</span><span class="operator token">=</span> src        \			<span class="operator token">/</span>usr<span class="operator token">/</span>include<span class="operator token">/</span>opencv4 \			<span class="operator token">/</span>usr<span class="operator token">/</span>include<span class="operator token">/</span>aarch64<span class="operator token">-</span>linux<span class="operator token">-</span>gnu \			<span class="operator token">/</span>usr<span class="operator token">/</span>local<span class="operator token">/</span>cuda<span class="operator token">-</span><span class="number token">10.2</span><span class="operator token">/</span>includelibrary_paths <span class="operator token">:</span><span class="operator token">=</span> <span class="operator token">/</span>usr<span class="operator token">/</span>lib<span class="operator token">/</span>aarch64<span class="operator token">-</span>linux<span class="operator token">-</span>gnu \			<span class="operator token">/</span>usr<span class="operator token">/</span>local<span class="operator token">/</span>cuda<span class="operator token">-</span><span class="number token">10.2</span><span class="operator token">/</span>lib64link_librarys <span class="operator token">:</span><span class="operator token">=</span> opencv_core opencv_highgui opencv_imgproc opencv_videoio opencv_imgcodecs \			nvinfer nvinfer_plugin nvonnxparser \			cuda cublas cudart cudnn \			stdc<span class="operator token">++</span> dlempty		  <span class="operator token">:</span><span class="operator token">=</span>export_path   <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>subst $<span class="punctuation token">(</span>empty<span class="punctuation token">)</span> $<span class="punctuation token">(</span>empty<span class="punctuation token">)</span><span class="punctuation token">,</span><span class="operator token">:</span><span class="punctuation token">,</span>$<span class="punctuation token">(</span>library_paths<span class="punctuation token">)</span><span class="punctuation token">)</span>run_paths     <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>foreach item<span class="punctuation token">,</span>$<span class="punctuation token">(</span>library_paths<span class="punctuation token">)</span><span class="punctuation token">,</span><span class="operator token">-</span>Wl<span class="punctuation token">,</span><span class="operator token">-</span>rpath<span class="operator token">=</span>$<span class="punctuation token">(</span>item<span class="punctuation token">)</span><span class="punctuation token">)</span>include_paths <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>foreach item<span class="punctuation token">,</span>$<span class="punctuation token">(</span>include_paths<span class="punctuation token">)</span><span class="punctuation token">,</span><span class="operator token">-</span>I$<span class="punctuation token">(</span>item<span class="punctuation token">)</span><span class="punctuation token">)</span>library_paths <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>foreach item<span class="punctuation token">,</span>$<span class="punctuation token">(</span>library_paths<span class="punctuation token">)</span><span class="punctuation token">,</span><span class="operator token">-</span>L$<span class="punctuation token">(</span>item<span class="punctuation token">)</span><span class="punctuation token">)</span>link_librarys <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>foreach item<span class="punctuation token">,</span>$<span class="punctuation token">(</span>link_librarys<span class="punctuation token">)</span><span class="punctuation token">,</span><span class="operator token">-</span>l$<span class="punctuation token">(</span>item<span class="punctuation token">)</span><span class="punctuation token">)</span>cpp_compile_flags <span class="operator token">:</span><span class="operator token">=</span> <span class="operator token">-</span>std<span class="operator token">=</span>c<span class="operator token">++</span><span class="number token">11</span> <span class="operator token">-</span>fPIC <span class="operator token">-</span>w <span class="operator token">-</span>g <span class="operator token">-</span>pthread <span class="operator token">-</span>fopenmp <span class="operator token">-</span>O0cu_compile_flags  <span class="operator token">:</span><span class="operator token">=</span> <span class="operator token">-</span>std<span class="operator token">=</span>c<span class="operator token">++</span><span class="number token">11</span> <span class="operator token">-</span>g <span class="operator token">-</span>w <span class="operator token">-</span>O0 <span class="operator token">-</span>Xcompiler <span class="string token">"$(cpp_compile_flags)"</span>link_flags        <span class="operator token">:</span><span class="operator token">=</span> <span class="operator token">-</span>pthread <span class="operator token">-</span>fopenmp <span class="operator token">-</span>Wl<span class="punctuation token">,</span><span class="operator token">-</span>rpath<span class="operator token">=</span><span class="char token">'$$ORIGIN'</span>cpp_compile_flags <span class="operator token">+=</span> $<span class="punctuation token">(</span>include_paths<span class="punctuation token">)</span>cu_compile_flags  <span class="operator token">+=</span> $<span class="punctuation token">(</span>include_paths<span class="punctuation token">)</span>link_flags        <span class="operator token">+=</span> $<span class="punctuation token">(</span>library_paths<span class="punctuation token">)</span> $<span class="punctuation token">(</span>link_librarys<span class="punctuation token">)</span> $<span class="punctuation token">(</span>run_paths<span class="punctuation token">)</span><span class="function token">ifneq</span> <span class="punctuation token">(</span>$<span class="punctuation token">(</span>MAKECMDGOALS<span class="punctuation token">)</span><span class="punctuation token">,</span> clean<span class="punctuation token">)</span><span class="operator token">-</span>include $<span class="punctuation token">(</span>cpp_mk<span class="punctuation token">)</span> $<span class="punctuation token">(</span>cu_mk<span class="punctuation token">)</span>endifpro	   <span class="operator token">:</span><span class="operator token">=</span> workspace<span class="operator token">/</span>proexpath <span class="operator token">:</span><span class="operator token">=</span> library_path<span class="punctuation token">.</span>txtlibrary_path<span class="punctuation token">.</span>txt <span class="operator token">:</span> 	@echo LD_LIBRARY_PATH<span class="operator token">=</span>$<span class="punctuation token">(</span>export_path<span class="punctuation token">)</span><span class="operator token">:</span><span class="string token">"$$"</span>LD_LIBRARY_PATH <span class="operator token">&gt;</span> $@workspace<span class="operator token">/</span>pro <span class="operator token">:</span> $<span class="punctuation token">(</span>cpp_objs<span class="punctuation token">)</span> $<span class="punctuation token">(</span>cu_objs<span class="punctuation token">)</span>		@echo Link $@		@mkdir <span class="operator token">-</span>p $<span class="punctuation token">(</span>dir $@<span class="punctuation token">)</span>		@$<span class="punctuation token">(</span>cc<span class="punctuation token">)</span> $<span class="operator token">^</span> <span class="operator token">-</span>o $@ $<span class="punctuation token">(</span>link_flags<span class="punctuation token">)</span>objs<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>o <span class="operator token">:</span> src<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cpp	@echo Compile CXX $<span class="operator token">&lt;</span>	@mkdir <span class="operator token">-</span>p $<span class="punctuation token">(</span>dir $@<span class="punctuation token">)</span>	@$<span class="punctuation token">(</span>cc<span class="punctuation token">)</span> <span class="operator token">-</span>c $<span class="operator token">&lt;</span> <span class="operator token">-</span>o $@ $<span class="punctuation token">(</span>cpp_compile_flags<span class="punctuation token">)</span>objs<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>o <span class="operator token">:</span> src<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cu	@echo Compile CUDA $<span class="operator token">&lt;</span>	@mkdir <span class="operator token">-</span>p $<span class="punctuation token">(</span>dir $@<span class="punctuation token">)</span>	@$<span class="punctuation token">(</span>nvcc<span class="punctuation token">)</span> <span class="operator token">-</span>c $<span class="operator token">&lt;</span> <span class="operator token">-</span>o $@ $<span class="punctuation token">(</span>cu_compile_flags<span class="punctuation token">)</span>objs<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>mk <span class="operator token">:</span> src<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cpp	@echo Compile depends CXX $<span class="operator token">&lt;</span>	@mkdir <span class="operator token">-</span>p $<span class="punctuation token">(</span>dir $@<span class="punctuation token">)</span>	@$<span class="punctuation token">(</span>cc<span class="punctuation token">)</span> <span class="operator token">-</span>M $<span class="operator token">&lt;</span> <span class="operator token">-</span>MF $@ <span class="operator token">-</span>MT $<span class="punctuation token">(</span>@<span class="operator token">:</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>mk<span class="operator token">=</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>o<span class="punctuation token">)</span> $<span class="punctuation token">(</span>cpp_compile_flags<span class="punctuation token">)</span>	objs<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>mk <span class="operator token">:</span> src<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cu	@echo Compile depends CUDA $<span class="operator token">&lt;</span>	@mkdir <span class="operator token">-</span>p $<span class="punctuation token">(</span>dir $@<span class="punctuation token">)</span>	@$<span class="punctuation token">(</span>nvcc<span class="punctuation token">)</span> <span class="operator token">-</span>M $<span class="operator token">&lt;</span> <span class="operator token">-</span>MF $@ <span class="operator token">-</span>MT $<span class="punctuation token">(</span>@<span class="operator token">:</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>mk<span class="operator token">=</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>o<span class="punctuation token">)</span> $<span class="punctuation token">(</span>cu_compile_flags<span class="punctuation token">)</span>run   <span class="operator token">:</span> workspace<span class="operator token">/</span>pro		  @cd workspace <span class="operator token">&amp;&amp;</span> <span class="punctuation token">.</span><span class="operator token">/</span>proclean <span class="operator token">:</span>	@rm <span class="operator token">-</span>rf objs workspace<span class="operator token">/</span>pro	@rm <span class="operator token">-</span>rf library_path<span class="punctuation token">.</span>txt	@rm <span class="operator token">-</span>rf workspace<span class="operator token">/</span>Result<span class="punctuation token">.</span>jpg# å¯¼å‡ºç¬¦å·ï¼Œä½¿å¾—è¿è¡Œæ—¶èƒ½å¤Ÿé“¾æ¥ä¸Š<span class="keyword token">export</span> LD_LIBRARY_PATH<span class="operator token">:</span><span class="operator token">=</span>$<span class="punctuation token">(</span>export_path<span class="punctuation token">)</span><span class="operator token">:</span>$<span class="punctuation token">(</span>LD_LIBRARY_PATH<span class="punctuation token">)</span></code></code></pre> 
<div class="hljs-button {2}"></div> 
<p><code class="hljs">lt; -o $@ $(cu_compile_flags) objs/%.cpp.mk : src/%.cpp @echo Compile depends CXX </code></p> 
<pre class="prettyprint set-code-show"><code class="hljs"><code class="prism language-cpp has-numbering">cc        <span class="operator token">:</span><span class="operator token">=</span> g<span class="operator token">++</span>nvcc      <span class="operator token">=</span> <span class="operator token">/</span>usr<span class="operator token">/</span>local<span class="operator token">/</span>cuda<span class="operator token">-</span><span class="number token">10.2</span><span class="operator token">/</span>bin<span class="operator token">/</span>nvcccpp_srcs  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>shell find src <span class="operator token">-</span>name <span class="string token">"*.cpp"</span><span class="punctuation token">)</span>cpp_objs  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>cpp_srcs<span class="operator token">:</span><span class="punctuation token">.</span>cpp<span class="operator token">=</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>o<span class="punctuation token">)</span>cpp_objs  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>cpp_objs<span class="operator token">:</span>src<span class="operator token">/</span><span class="operator token">%=</span>objs<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">)</span>cpp_mk	  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>cpp_objs<span class="operator token">:</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>o<span class="operator token">=</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>mk<span class="punctuation token">)</span>cu_srcs	  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>shell find src <span class="operator token">-</span>name <span class="string token">"*.cu"</span><span class="punctuation token">)</span>cu_objs   <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>cu_srcs<span class="operator token">:</span><span class="punctuation token">.</span>cu<span class="operator token">=</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>o<span class="punctuation token">)</span>cu_objs	  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>cu_objs<span class="operator token">:</span>src<span class="operator token">/</span><span class="operator token">%=</span>objs<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">)</span>cu_mk	  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>cu_objs<span class="operator token">:</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>o<span class="operator token">=</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>mk<span class="punctuation token">)</span>include_paths <span class="operator token">:</span><span class="operator token">=</span> src        \			<span class="operator token">/</span>usr<span class="operator token">/</span>include<span class="operator token">/</span>opencv4 \			<span class="operator token">/</span>usr<span class="operator token">/</span>include<span class="operator token">/</span>aarch64<span class="operator token">-</span>linux<span class="operator token">-</span>gnu \			<span class="operator token">/</span>usr<span class="operator token">/</span>local<span class="operator token">/</span>cuda<span class="operator token">-</span><span class="number token">10.2</span><span class="operator token">/</span>includelibrary_paths <span class="operator token">:</span><span class="operator token">=</span> <span class="operator token">/</span>usr<span class="operator token">/</span>lib<span class="operator token">/</span>aarch64<span class="operator token">-</span>linux<span class="operator token">-</span>gnu \			<span class="operator token">/</span>usr<span class="operator token">/</span>local<span class="operator token">/</span>cuda<span class="operator token">-</span><span class="number token">10.2</span><span class="operator token">/</span>lib64link_librarys <span class="operator token">:</span><span class="operator token">=</span> opencv_core opencv_highgui opencv_imgproc opencv_videoio opencv_imgcodecs \			nvinfer nvinfer_plugin nvonnxparser \			cuda cublas cudart cudnn \			stdc<span class="operator token">++</span> dlempty		  <span class="operator token">:</span><span class="operator token">=</span>export_path   <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>subst $<span class="punctuation token">(</span>empty<span class="punctuation token">)</span> $<span class="punctuation token">(</span>empty<span class="punctuation token">)</span><span class="punctuation token">,</span><span class="operator token">:</span><span class="punctuation token">,</span>$<span class="punctuation token">(</span>library_paths<span class="punctuation token">)</span><span class="punctuation token">)</span>run_paths     <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>foreach item<span class="punctuation token">,</span>$<span class="punctuation token">(</span>library_paths<span class="punctuation token">)</span><span class="punctuation token">,</span><span class="operator token">-</span>Wl<span class="punctuation token">,</span><span class="operator token">-</span>rpath<span class="operator token">=</span>$<span class="punctuation token">(</span>item<span class="punctuation token">)</span><span class="punctuation token">)</span>include_paths <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>foreach item<span class="punctuation token">,</span>$<span class="punctuation token">(</span>include_paths<span class="punctuation token">)</span><span class="punctuation token">,</span><span class="operator token">-</span>I$<span class="punctuation token">(</span>item<span class="punctuation token">)</span><span class="punctuation token">)</span>library_paths <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>foreach item<span class="punctuation token">,</span>$<span class="punctuation token">(</span>library_paths<span class="punctuation token">)</span><span class="punctuation token">,</span><span class="operator token">-</span>L$<span class="punctuation token">(</span>item<span class="punctuation token">)</span><span class="punctuation token">)</span>link_librarys <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>foreach item<span class="punctuation token">,</span>$<span class="punctuation token">(</span>link_librarys<span class="punctuation token">)</span><span class="punctuation token">,</span><span class="operator token">-</span>l$<span class="punctuation token">(</span>item<span class="punctuation token">)</span><span class="punctuation token">)</span>cpp_compile_flags <span class="operator token">:</span><span class="operator token">=</span> <span class="operator token">-</span>std<span class="operator token">=</span>c<span class="operator token">++</span><span class="number token">11</span> <span class="operator token">-</span>fPIC <span class="operator token">-</span>w <span class="operator token">-</span>g <span class="operator token">-</span>pthread <span class="operator token">-</span>fopenmp <span class="operator token">-</span>O0cu_compile_flags  <span class="operator token">:</span><span class="operator token">=</span> <span class="operator token">-</span>std<span class="operator token">=</span>c<span class="operator token">++</span><span class="number token">11</span> <span class="operator token">-</span>g <span class="operator token">-</span>w <span class="operator token">-</span>O0 <span class="operator token">-</span>Xcompiler <span class="string token">"$(cpp_compile_flags)"</span>link_flags        <span class="operator token">:</span><span class="operator token">=</span> <span class="operator token">-</span>pthread <span class="operator token">-</span>fopenmp <span class="operator token">-</span>Wl<span class="punctuation token">,</span><span class="operator token">-</span>rpath<span class="operator token">=</span><span class="char token">'$$ORIGIN'</span>cpp_compile_flags <span class="operator token">+=</span> $<span class="punctuation token">(</span>include_paths<span class="punctuation token">)</span>cu_compile_flags  <span class="operator token">+=</span> $<span class="punctuation token">(</span>include_paths<span class="punctuation token">)</span>link_flags        <span class="operator token">+=</span> $<span class="punctuation token">(</span>library_paths<span class="punctuation token">)</span> $<span class="punctuation token">(</span>link_librarys<span class="punctuation token">)</span> $<span class="punctuation token">(</span>run_paths<span class="punctuation token">)</span><span class="function token">ifneq</span> <span class="punctuation token">(</span>$<span class="punctuation token">(</span>MAKECMDGOALS<span class="punctuation token">)</span><span class="punctuation token">,</span> clean<span class="punctuation token">)</span><span class="operator token">-</span>include $<span class="punctuation token">(</span>cpp_mk<span class="punctuation token">)</span> $<span class="punctuation token">(</span>cu_mk<span class="punctuation token">)</span>endifpro	   <span class="operator token">:</span><span class="operator token">=</span> workspace<span class="operator token">/</span>proexpath <span class="operator token">:</span><span class="operator token">=</span> library_path<span class="punctuation token">.</span>txtlibrary_path<span class="punctuation token">.</span>txt <span class="operator token">:</span> 	@echo LD_LIBRARY_PATH<span class="operator token">=</span>$<span class="punctuation token">(</span>export_path<span class="punctuation token">)</span><span class="operator token">:</span><span class="string token">"$$"</span>LD_LIBRARY_PATH <span class="operator token">&gt;</span> $@workspace<span class="operator token">/</span>pro <span class="operator token">:</span> $<span class="punctuation token">(</span>cpp_objs<span class="punctuation token">)</span> $<span class="punctuation token">(</span>cu_objs<span class="punctuation token">)</span>		@echo Link $@		@mkdir <span class="operator token">-</span>p $<span class="punctuation token">(</span>dir $@<span class="punctuation token">)</span>		@$<span class="punctuation token">(</span>cc<span class="punctuation token">)</span> $<span class="operator token">^</span> <span class="operator token">-</span>o $@ $<span class="punctuation token">(</span>link_flags<span class="punctuation token">)</span>objs<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>o <span class="operator token">:</span> src<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cpp	@echo Compile CXX $<span class="operator token">&lt;</span>	@mkdir <span class="operator token">-</span>p $<span class="punctuation token">(</span>dir $@<span class="punctuation token">)</span>	@$<span class="punctuation token">(</span>cc<span class="punctuation token">)</span> <span class="operator token">-</span>c $<span class="operator token">&lt;</span> <span class="operator token">-</span>o $@ $<span class="punctuation token">(</span>cpp_compile_flags<span class="punctuation token">)</span>objs<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>o <span class="operator token">:</span> src<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cu	@echo Compile CUDA $<span class="operator token">&lt;</span>	@mkdir <span class="operator token">-</span>p $<span class="punctuation token">(</span>dir $@<span class="punctuation token">)</span>	@$<span class="punctuation token">(</span>nvcc<span class="punctuation token">)</span> <span class="operator token">-</span>c $<span class="operator token">&lt;</span> <span class="operator token">-</span>o $@ $<span class="punctuation token">(</span>cu_compile_flags<span class="punctuation token">)</span>objs<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>mk <span class="operator token">:</span> src<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cpp	@echo Compile depends CXX $<span class="operator token">&lt;</span>	@mkdir <span class="operator token">-</span>p $<span class="punctuation token">(</span>dir $@<span class="punctuation token">)</span>	@$<span class="punctuation token">(</span>cc<span class="punctuation token">)</span> <span class="operator token">-</span>M $<span class="operator token">&lt;</span> <span class="operator token">-</span>MF $@ <span class="operator token">-</span>MT $<span class="punctuation token">(</span>@<span class="operator token">:</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>mk<span class="operator token">=</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>o<span class="punctuation token">)</span> $<span class="punctuation token">(</span>cpp_compile_flags<span class="punctuation token">)</span>	objs<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>mk <span class="operator token">:</span> src<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cu	@echo Compile depends CUDA $<span class="operator token">&lt;</span>	@mkdir <span class="operator token">-</span>p $<span class="punctuation token">(</span>dir $@<span class="punctuation token">)</span>	@$<span class="punctuation token">(</span>nvcc<span class="punctuation token">)</span> <span class="operator token">-</span>M $<span class="operator token">&lt;</span> <span class="operator token">-</span>MF $@ <span class="operator token">-</span>MT $<span class="punctuation token">(</span>@<span class="operator token">:</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>mk<span class="operator token">=</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>o<span class="punctuation token">)</span> $<span class="punctuation token">(</span>cu_compile_flags<span class="punctuation token">)</span>run   <span class="operator token">:</span> workspace<span class="operator token">/</span>pro		  @cd workspace <span class="operator token">&amp;&amp;</span> <span class="punctuation token">.</span><span class="operator token">/</span>proclean <span class="operator token">:</span>	@rm <span class="operator token">-</span>rf objs workspace<span class="operator token">/</span>pro	@rm <span class="operator token">-</span>rf library_path<span class="punctuation token">.</span>txt	@rm <span class="operator token">-</span>rf workspace<span class="operator token">/</span>Result<span class="punctuation token">.</span>jpg# å¯¼å‡ºç¬¦å·ï¼Œä½¿å¾—è¿è¡Œæ—¶èƒ½å¤Ÿé“¾æ¥ä¸Š<span class="keyword token">export</span> LD_LIBRARY_PATH<span class="operator token">:</span><span class="operator token">=</span>$<span class="punctuation token">(</span>export_path<span class="punctuation token">)</span><span class="operator token">:</span>$<span class="punctuation token">(</span>LD_LIBRARY_PATH<span class="punctuation token">)</span></code></code></pre> 
<div class="hljs-button {2}"></div> 
<p><code class="hljs">lt; @mkdir -p $(dir $@) @$(cc) -M </code></p> 
<pre class="prettyprint set-code-show"><code class="hljs"><code class="prism language-cpp has-numbering">cc        <span class="operator token">:</span><span class="operator token">=</span> g<span class="operator token">++</span>nvcc      <span class="operator token">=</span> <span class="operator token">/</span>usr<span class="operator token">/</span>local<span class="operator token">/</span>cuda<span class="operator token">-</span><span class="number token">10.2</span><span class="operator token">/</span>bin<span class="operator token">/</span>nvcccpp_srcs  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>shell find src <span class="operator token">-</span>name <span class="string token">"*.cpp"</span><span class="punctuation token">)</span>cpp_objs  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>cpp_srcs<span class="operator token">:</span><span class="punctuation token">.</span>cpp<span class="operator token">=</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>o<span class="punctuation token">)</span>cpp_objs  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>cpp_objs<span class="operator token">:</span>src<span class="operator token">/</span><span class="operator token">%=</span>objs<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">)</span>cpp_mk	  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>cpp_objs<span class="operator token">:</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>o<span class="operator token">=</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>mk<span class="punctuation token">)</span>cu_srcs	  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>shell find src <span class="operator token">-</span>name <span class="string token">"*.cu"</span><span class="punctuation token">)</span>cu_objs   <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>cu_srcs<span class="operator token">:</span><span class="punctuation token">.</span>cu<span class="operator token">=</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>o<span class="punctuation token">)</span>cu_objs	  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>cu_objs<span class="operator token">:</span>src<span class="operator token">/</span><span class="operator token">%=</span>objs<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">)</span>cu_mk	  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>cu_objs<span class="operator token">:</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>o<span class="operator token">=</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>mk<span class="punctuation token">)</span>include_paths <span class="operator token">:</span><span class="operator token">=</span> src        \			<span class="operator token">/</span>usr<span class="operator token">/</span>include<span class="operator token">/</span>opencv4 \			<span class="operator token">/</span>usr<span class="operator token">/</span>include<span class="operator token">/</span>aarch64<span class="operator token">-</span>linux<span class="operator token">-</span>gnu \			<span class="operator token">/</span>usr<span class="operator token">/</span>local<span class="operator token">/</span>cuda<span class="operator token">-</span><span class="number token">10.2</span><span class="operator token">/</span>includelibrary_paths <span class="operator token">:</span><span class="operator token">=</span> <span class="operator token">/</span>usr<span class="operator token">/</span>lib<span class="operator token">/</span>aarch64<span class="operator token">-</span>linux<span class="operator token">-</span>gnu \			<span class="operator token">/</span>usr<span class="operator token">/</span>local<span class="operator token">/</span>cuda<span class="operator token">-</span><span class="number token">10.2</span><span class="operator token">/</span>lib64link_librarys <span class="operator token">:</span><span class="operator token">=</span> opencv_core opencv_highgui opencv_imgproc opencv_videoio opencv_imgcodecs \			nvinfer nvinfer_plugin nvonnxparser \			cuda cublas cudart cudnn \			stdc<span class="operator token">++</span> dlempty		  <span class="operator token">:</span><span class="operator token">=</span>export_path   <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>subst $<span class="punctuation token">(</span>empty<span class="punctuation token">)</span> $<span class="punctuation token">(</span>empty<span class="punctuation token">)</span><span class="punctuation token">,</span><span class="operator token">:</span><span class="punctuation token">,</span>$<span class="punctuation token">(</span>library_paths<span class="punctuation token">)</span><span class="punctuation token">)</span>run_paths     <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>foreach item<span class="punctuation token">,</span>$<span class="punctuation token">(</span>library_paths<span class="punctuation token">)</span><span class="punctuation token">,</span><span class="operator token">-</span>Wl<span class="punctuation token">,</span><span class="operator token">-</span>rpath<span class="operator token">=</span>$<span class="punctuation token">(</span>item<span class="punctuation token">)</span><span class="punctuation token">)</span>include_paths <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>foreach item<span class="punctuation token">,</span>$<span class="punctuation token">(</span>include_paths<span class="punctuation token">)</span><span class="punctuation token">,</span><span class="operator token">-</span>I$<span class="punctuation token">(</span>item<span class="punctuation token">)</span><span class="punctuation token">)</span>library_paths <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>foreach item<span class="punctuation token">,</span>$<span class="punctuation token">(</span>library_paths<span class="punctuation token">)</span><span class="punctuation token">,</span><span class="operator token">-</span>L$<span class="punctuation token">(</span>item<span class="punctuation token">)</span><span class="punctuation token">)</span>link_librarys <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>foreach item<span class="punctuation token">,</span>$<span class="punctuation token">(</span>link_librarys<span class="punctuation token">)</span><span class="punctuation token">,</span><span class="operator token">-</span>l$<span class="punctuation token">(</span>item<span class="punctuation token">)</span><span class="punctuation token">)</span>cpp_compile_flags <span class="operator token">:</span><span class="operator token">=</span> <span class="operator token">-</span>std<span class="operator token">=</span>c<span class="operator token">++</span><span class="number token">11</span> <span class="operator token">-</span>fPIC <span class="operator token">-</span>w <span class="operator token">-</span>g <span class="operator token">-</span>pthread <span class="operator token">-</span>fopenmp <span class="operator token">-</span>O0cu_compile_flags  <span class="operator token">:</span><span class="operator token">=</span> <span class="operator token">-</span>std<span class="operator token">=</span>c<span class="operator token">++</span><span class="number token">11</span> <span class="operator token">-</span>g <span class="operator token">-</span>w <span class="operator token">-</span>O0 <span class="operator token">-</span>Xcompiler <span class="string token">"$(cpp_compile_flags)"</span>link_flags        <span class="operator token">:</span><span class="operator token">=</span> <span class="operator token">-</span>pthread <span class="operator token">-</span>fopenmp <span class="operator token">-</span>Wl<span class="punctuation token">,</span><span class="operator token">-</span>rpath<span class="operator token">=</span><span class="char token">'$$ORIGIN'</span>cpp_compile_flags <span class="operator token">+=</span> $<span class="punctuation token">(</span>include_paths<span class="punctuation token">)</span>cu_compile_flags  <span class="operator token">+=</span> $<span class="punctuation token">(</span>include_paths<span class="punctuation token">)</span>link_flags        <span class="operator token">+=</span> $<span class="punctuation token">(</span>library_paths<span class="punctuation token">)</span> $<span class="punctuation token">(</span>link_librarys<span class="punctuation token">)</span> $<span class="punctuation token">(</span>run_paths<span class="punctuation token">)</span><span class="function token">ifneq</span> <span class="punctuation token">(</span>$<span class="punctuation token">(</span>MAKECMDGOALS<span class="punctuation token">)</span><span class="punctuation token">,</span> clean<span class="punctuation token">)</span><span class="operator token">-</span>include $<span class="punctuation token">(</span>cpp_mk<span class="punctuation token">)</span> $<span class="punctuation token">(</span>cu_mk<span class="punctuation token">)</span>endifpro	   <span class="operator token">:</span><span class="operator token">=</span> workspace<span class="operator token">/</span>proexpath <span class="operator token">:</span><span class="operator token">=</span> library_path<span class="punctuation token">.</span>txtlibrary_path<span class="punctuation token">.</span>txt <span class="operator token">:</span> 	@echo LD_LIBRARY_PATH<span class="operator token">=</span>$<span class="punctuation token">(</span>export_path<span class="punctuation token">)</span><span class="operator token">:</span><span class="string token">"$$"</span>LD_LIBRARY_PATH <span class="operator token">&gt;</span> $@workspace<span class="operator token">/</span>pro <span class="operator token">:</span> $<span class="punctuation token">(</span>cpp_objs<span class="punctuation token">)</span> $<span class="punctuation token">(</span>cu_objs<span class="punctuation token">)</span>		@echo Link $@		@mkdir <span class="operator token">-</span>p $<span class="punctuation token">(</span>dir $@<span class="punctuation token">)</span>		@$<span class="punctuation token">(</span>cc<span class="punctuation token">)</span> $<span class="operator token">^</span> <span class="operator token">-</span>o $@ $<span class="punctuation token">(</span>link_flags<span class="punctuation token">)</span>objs<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>o <span class="operator token">:</span> src<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cpp	@echo Compile CXX $<span class="operator token">&lt;</span>	@mkdir <span class="operator token">-</span>p $<span class="punctuation token">(</span>dir $@<span class="punctuation token">)</span>	@$<span class="punctuation token">(</span>cc<span class="punctuation token">)</span> <span class="operator token">-</span>c $<span class="operator token">&lt;</span> <span class="operator token">-</span>o $@ $<span class="punctuation token">(</span>cpp_compile_flags<span class="punctuation token">)</span>objs<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>o <span class="operator token">:</span> src<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cu	@echo Compile CUDA $<span class="operator token">&lt;</span>	@mkdir <span class="operator token">-</span>p $<span class="punctuation token">(</span>dir $@<span class="punctuation token">)</span>	@$<span class="punctuation token">(</span>nvcc<span class="punctuation token">)</span> <span class="operator token">-</span>c $<span class="operator token">&lt;</span> <span class="operator token">-</span>o $@ $<span class="punctuation token">(</span>cu_compile_flags<span class="punctuation token">)</span>objs<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>mk <span class="operator token">:</span> src<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cpp	@echo Compile depends CXX $<span class="operator token">&lt;</span>	@mkdir <span class="operator token">-</span>p $<span class="punctuation token">(</span>dir $@<span class="punctuation token">)</span>	@$<span class="punctuation token">(</span>cc<span class="punctuation token">)</span> <span class="operator token">-</span>M $<span class="operator token">&lt;</span> <span class="operator token">-</span>MF $@ <span class="operator token">-</span>MT $<span class="punctuation token">(</span>@<span class="operator token">:</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>mk<span class="operator token">=</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>o<span class="punctuation token">)</span> $<span class="punctuation token">(</span>cpp_compile_flags<span class="punctuation token">)</span>	objs<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>mk <span class="operator token">:</span> src<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cu	@echo Compile depends CUDA $<span class="operator token">&lt;</span>	@mkdir <span class="operator token">-</span>p $<span class="punctuation token">(</span>dir $@<span class="punctuation token">)</span>	@$<span class="punctuation token">(</span>nvcc<span class="punctuation token">)</span> <span class="operator token">-</span>M $<span class="operator token">&lt;</span> <span class="operator token">-</span>MF $@ <span class="operator token">-</span>MT $<span class="punctuation token">(</span>@<span class="operator token">:</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>mk<span class="operator token">=</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>o<span class="punctuation token">)</span> $<span class="punctuation token">(</span>cu_compile_flags<span class="punctuation token">)</span>run   <span class="operator token">:</span> workspace<span class="operator token">/</span>pro		  @cd workspace <span class="operator token">&amp;&amp;</span> <span class="punctuation token">.</span><span class="operator token">/</span>proclean <span class="operator token">:</span>	@rm <span class="operator token">-</span>rf objs workspace<span class="operator token">/</span>pro	@rm <span class="operator token">-</span>rf library_path<span class="punctuation token">.</span>txt	@rm <span class="operator token">-</span>rf workspace<span class="operator token">/</span>Result<span class="punctuation token">.</span>jpg# å¯¼å‡ºç¬¦å·ï¼Œä½¿å¾—è¿è¡Œæ—¶èƒ½å¤Ÿé“¾æ¥ä¸Š<span class="keyword token">export</span> LD_LIBRARY_PATH<span class="operator token">:</span><span class="operator token">=</span>$<span class="punctuation token">(</span>export_path<span class="punctuation token">)</span><span class="operator token">:</span>$<span class="punctuation token">(</span>LD_LIBRARY_PATH<span class="punctuation token">)</span></code></code></pre> 
<div class="hljs-button {2}"></div> 
<p><code class="hljs">lt; -MF $@ -MT $(@:.cpp.mk=.cpp.o) $(cpp_compile_flags) objs/%.cu.mk : src/%.cu @echo Compile depends CUDA </code></p> 
<pre class="prettyprint set-code-show"><code class="hljs"><code class="prism language-cpp has-numbering">cc        <span class="operator token">:</span><span class="operator token">=</span> g<span class="operator token">++</span>nvcc      <span class="operator token">=</span> <span class="operator token">/</span>usr<span class="operator token">/</span>local<span class="operator token">/</span>cuda<span class="operator token">-</span><span class="number token">10.2</span><span class="operator token">/</span>bin<span class="operator token">/</span>nvcccpp_srcs  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>shell find src <span class="operator token">-</span>name <span class="string token">"*.cpp"</span><span class="punctuation token">)</span>cpp_objs  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>cpp_srcs<span class="operator token">:</span><span class="punctuation token">.</span>cpp<span class="operator token">=</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>o<span class="punctuation token">)</span>cpp_objs  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>cpp_objs<span class="operator token">:</span>src<span class="operator token">/</span><span class="operator token">%=</span>objs<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">)</span>cpp_mk	  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>cpp_objs<span class="operator token">:</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>o<span class="operator token">=</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>mk<span class="punctuation token">)</span>cu_srcs	  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>shell find src <span class="operator token">-</span>name <span class="string token">"*.cu"</span><span class="punctuation token">)</span>cu_objs   <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>cu_srcs<span class="operator token">:</span><span class="punctuation token">.</span>cu<span class="operator token">=</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>o<span class="punctuation token">)</span>cu_objs	  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>cu_objs<span class="operator token">:</span>src<span class="operator token">/</span><span class="operator token">%=</span>objs<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">)</span>cu_mk	  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>cu_objs<span class="operator token">:</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>o<span class="operator token">=</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>mk<span class="punctuation token">)</span>include_paths <span class="operator token">:</span><span class="operator token">=</span> src        \			<span class="operator token">/</span>usr<span class="operator token">/</span>include<span class="operator token">/</span>opencv4 \			<span class="operator token">/</span>usr<span class="operator token">/</span>include<span class="operator token">/</span>aarch64<span class="operator token">-</span>linux<span class="operator token">-</span>gnu \			<span class="operator token">/</span>usr<span class="operator token">/</span>local<span class="operator token">/</span>cuda<span class="operator token">-</span><span class="number token">10.2</span><span class="operator token">/</span>includelibrary_paths <span class="operator token">:</span><span class="operator token">=</span> <span class="operator token">/</span>usr<span class="operator token">/</span>lib<span class="operator token">/</span>aarch64<span class="operator token">-</span>linux<span class="operator token">-</span>gnu \			<span class="operator token">/</span>usr<span class="operator token">/</span>local<span class="operator token">/</span>cuda<span class="operator token">-</span><span class="number token">10.2</span><span class="operator token">/</span>lib64link_librarys <span class="operator token">:</span><span class="operator token">=</span> opencv_core opencv_highgui opencv_imgproc opencv_videoio opencv_imgcodecs \			nvinfer nvinfer_plugin nvonnxparser \			cuda cublas cudart cudnn \			stdc<span class="operator token">++</span> dlempty		  <span class="operator token">:</span><span class="operator token">=</span>export_path   <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>subst $<span class="punctuation token">(</span>empty<span class="punctuation token">)</span> $<span class="punctuation token">(</span>empty<span class="punctuation token">)</span><span class="punctuation token">,</span><span class="operator token">:</span><span class="punctuation token">,</span>$<span class="punctuation token">(</span>library_paths<span class="punctuation token">)</span><span class="punctuation token">)</span>run_paths     <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>foreach item<span class="punctuation token">,</span>$<span class="punctuation token">(</span>library_paths<span class="punctuation token">)</span><span class="punctuation token">,</span><span class="operator token">-</span>Wl<span class="punctuation token">,</span><span class="operator token">-</span>rpath<span class="operator token">=</span>$<span class="punctuation token">(</span>item<span class="punctuation token">)</span><span class="punctuation token">)</span>include_paths <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>foreach item<span class="punctuation token">,</span>$<span class="punctuation token">(</span>include_paths<span class="punctuation token">)</span><span class="punctuation token">,</span><span class="operator token">-</span>I$<span class="punctuation token">(</span>item<span class="punctuation token">)</span><span class="punctuation token">)</span>library_paths <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>foreach item<span class="punctuation token">,</span>$<span class="punctuation token">(</span>library_paths<span class="punctuation token">)</span><span class="punctuation token">,</span><span class="operator token">-</span>L$<span class="punctuation token">(</span>item<span class="punctuation token">)</span><span class="punctuation token">)</span>link_librarys <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>foreach item<span class="punctuation token">,</span>$<span class="punctuation token">(</span>link_librarys<span class="punctuation token">)</span><span class="punctuation token">,</span><span class="operator token">-</span>l$<span class="punctuation token">(</span>item<span class="punctuation token">)</span><span class="punctuation token">)</span>cpp_compile_flags <span class="operator token">:</span><span class="operator token">=</span> <span class="operator token">-</span>std<span class="operator token">=</span>c<span class="operator token">++</span><span class="number token">11</span> <span class="operator token">-</span>fPIC <span class="operator token">-</span>w <span class="operator token">-</span>g <span class="operator token">-</span>pthread <span class="operator token">-</span>fopenmp <span class="operator token">-</span>O0cu_compile_flags  <span class="operator token">:</span><span class="operator token">=</span> <span class="operator token">-</span>std<span class="operator token">=</span>c<span class="operator token">++</span><span class="number token">11</span> <span class="operator token">-</span>g <span class="operator token">-</span>w <span class="operator token">-</span>O0 <span class="operator token">-</span>Xcompiler <span class="string token">"$(cpp_compile_flags)"</span>link_flags        <span class="operator token">:</span><span class="operator token">=</span> <span class="operator token">-</span>pthread <span class="operator token">-</span>fopenmp <span class="operator token">-</span>Wl<span class="punctuation token">,</span><span class="operator token">-</span>rpath<span class="operator token">=</span><span class="char token">'$$ORIGIN'</span>cpp_compile_flags <span class="operator token">+=</span> $<span class="punctuation token">(</span>include_paths<span class="punctuation token">)</span>cu_compile_flags  <span class="operator token">+=</span> $<span class="punctuation token">(</span>include_paths<span class="punctuation token">)</span>link_flags        <span class="operator token">+=</span> $<span class="punctuation token">(</span>library_paths<span class="punctuation token">)</span> $<span class="punctuation token">(</span>link_librarys<span class="punctuation token">)</span> $<span class="punctuation token">(</span>run_paths<span class="punctuation token">)</span><span class="function token">ifneq</span> <span class="punctuation token">(</span>$<span class="punctuation token">(</span>MAKECMDGOALS<span class="punctuation token">)</span><span class="punctuation token">,</span> clean<span class="punctuation token">)</span><span class="operator token">-</span>include $<span class="punctuation token">(</span>cpp_mk<span class="punctuation token">)</span> $<span class="punctuation token">(</span>cu_mk<span class="punctuation token">)</span>endifpro	   <span class="operator token">:</span><span class="operator token">=</span> workspace<span class="operator token">/</span>proexpath <span class="operator token">:</span><span class="operator token">=</span> library_path<span class="punctuation token">.</span>txtlibrary_path<span class="punctuation token">.</span>txt <span class="operator token">:</span> 	@echo LD_LIBRARY_PATH<span class="operator token">=</span>$<span class="punctuation token">(</span>export_path<span class="punctuation token">)</span><span class="operator token">:</span><span class="string token">"$$"</span>LD_LIBRARY_PATH <span class="operator token">&gt;</span> $@workspace<span class="operator token">/</span>pro <span class="operator token">:</span> $<span class="punctuation token">(</span>cpp_objs<span class="punctuation token">)</span> $<span class="punctuation token">(</span>cu_objs<span class="punctuation token">)</span>		@echo Link $@		@mkdir <span class="operator token">-</span>p $<span class="punctuation token">(</span>dir $@<span class="punctuation token">)</span>		@$<span class="punctuation token">(</span>cc<span class="punctuation token">)</span> $<span class="operator token">^</span> <span class="operator token">-</span>o $@ $<span class="punctuation token">(</span>link_flags<span class="punctuation token">)</span>objs<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>o <span class="operator token">:</span> src<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cpp	@echo Compile CXX $<span class="operator token">&lt;</span>	@mkdir <span class="operator token">-</span>p $<span class="punctuation token">(</span>dir $@<span class="punctuation token">)</span>	@$<span class="punctuation token">(</span>cc<span class="punctuation token">)</span> <span class="operator token">-</span>c $<span class="operator token">&lt;</span> <span class="operator token">-</span>o $@ $<span class="punctuation token">(</span>cpp_compile_flags<span class="punctuation token">)</span>objs<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>o <span class="operator token">:</span> src<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cu	@echo Compile CUDA $<span class="operator token">&lt;</span>	@mkdir <span class="operator token">-</span>p $<span class="punctuation token">(</span>dir $@<span class="punctuation token">)</span>	@$<span class="punctuation token">(</span>nvcc<span class="punctuation token">)</span> <span class="operator token">-</span>c $<span class="operator token">&lt;</span> <span class="operator token">-</span>o $@ $<span class="punctuation token">(</span>cu_compile_flags<span class="punctuation token">)</span>objs<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>mk <span class="operator token">:</span> src<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cpp	@echo Compile depends CXX $<span class="operator token">&lt;</span>	@mkdir <span class="operator token">-</span>p $<span class="punctuation token">(</span>dir $@<span class="punctuation token">)</span>	@$<span class="punctuation token">(</span>cc<span class="punctuation token">)</span> <span class="operator token">-</span>M $<span class="operator token">&lt;</span> <span class="operator token">-</span>MF $@ <span class="operator token">-</span>MT $<span class="punctuation token">(</span>@<span class="operator token">:</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>mk<span class="operator token">=</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>o<span class="punctuation token">)</span> $<span class="punctuation token">(</span>cpp_compile_flags<span class="punctuation token">)</span>	objs<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>mk <span class="operator token">:</span> src<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cu	@echo Compile depends CUDA $<span class="operator token">&lt;</span>	@mkdir <span class="operator token">-</span>p $<span class="punctuation token">(</span>dir $@<span class="punctuation token">)</span>	@$<span class="punctuation token">(</span>nvcc<span class="punctuation token">)</span> <span class="operator token">-</span>M $<span class="operator token">&lt;</span> <span class="operator token">-</span>MF $@ <span class="operator token">-</span>MT $<span class="punctuation token">(</span>@<span class="operator token">:</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>mk<span class="operator token">=</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>o<span class="punctuation token">)</span> $<span class="punctuation token">(</span>cu_compile_flags<span class="punctuation token">)</span>run   <span class="operator token">:</span> workspace<span class="operator token">/</span>pro		  @cd workspace <span class="operator token">&amp;&amp;</span> <span class="punctuation token">.</span><span class="operator token">/</span>proclean <span class="operator token">:</span>	@rm <span class="operator token">-</span>rf objs workspace<span class="operator token">/</span>pro	@rm <span class="operator token">-</span>rf library_path<span class="punctuation token">.</span>txt	@rm <span class="operator token">-</span>rf workspace<span class="operator token">/</span>Result<span class="punctuation token">.</span>jpg# å¯¼å‡ºç¬¦å·ï¼Œä½¿å¾—è¿è¡Œæ—¶èƒ½å¤Ÿé“¾æ¥ä¸Š<span class="keyword token">export</span> LD_LIBRARY_PATH<span class="operator token">:</span><span class="operator token">=</span>$<span class="punctuation token">(</span>export_path<span class="punctuation token">)</span><span class="operator token">:</span>$<span class="punctuation token">(</span>LD_LIBRARY_PATH<span class="punctuation token">)</span></code></code></pre> 
<div class="hljs-button {2}"></div> 
<p><code class="hljs">lt; @mkdir -p $(dir $@) @$(nvcc) -M </code></p> 
<pre class="prettyprint set-code-show"><code class="hljs"><code class="prism language-cpp has-numbering">cc        <span class="operator token">:</span><span class="operator token">=</span> g<span class="operator token">++</span>nvcc      <span class="operator token">=</span> <span class="operator token">/</span>usr<span class="operator token">/</span>local<span class="operator token">/</span>cuda<span class="operator token">-</span><span class="number token">10.2</span><span class="operator token">/</span>bin<span class="operator token">/</span>nvcccpp_srcs  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>shell find src <span class="operator token">-</span>name <span class="string token">"*.cpp"</span><span class="punctuation token">)</span>cpp_objs  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>cpp_srcs<span class="operator token">:</span><span class="punctuation token">.</span>cpp<span class="operator token">=</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>o<span class="punctuation token">)</span>cpp_objs  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>cpp_objs<span class="operator token">:</span>src<span class="operator token">/</span><span class="operator token">%=</span>objs<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">)</span>cpp_mk	  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>cpp_objs<span class="operator token">:</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>o<span class="operator token">=</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>mk<span class="punctuation token">)</span>cu_srcs	  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>shell find src <span class="operator token">-</span>name <span class="string token">"*.cu"</span><span class="punctuation token">)</span>cu_objs   <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>cu_srcs<span class="operator token">:</span><span class="punctuation token">.</span>cu<span class="operator token">=</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>o<span class="punctuation token">)</span>cu_objs	  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>cu_objs<span class="operator token">:</span>src<span class="operator token">/</span><span class="operator token">%=</span>objs<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">)</span>cu_mk	  <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>cu_objs<span class="operator token">:</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>o<span class="operator token">=</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>mk<span class="punctuation token">)</span>include_paths <span class="operator token">:</span><span class="operator token">=</span> src        \			<span class="operator token">/</span>usr<span class="operator token">/</span>include<span class="operator token">/</span>opencv4 \			<span class="operator token">/</span>usr<span class="operator token">/</span>include<span class="operator token">/</span>aarch64<span class="operator token">-</span>linux<span class="operator token">-</span>gnu \			<span class="operator token">/</span>usr<span class="operator token">/</span>local<span class="operator token">/</span>cuda<span class="operator token">-</span><span class="number token">10.2</span><span class="operator token">/</span>includelibrary_paths <span class="operator token">:</span><span class="operator token">=</span> <span class="operator token">/</span>usr<span class="operator token">/</span>lib<span class="operator token">/</span>aarch64<span class="operator token">-</span>linux<span class="operator token">-</span>gnu \			<span class="operator token">/</span>usr<span class="operator token">/</span>local<span class="operator token">/</span>cuda<span class="operator token">-</span><span class="number token">10.2</span><span class="operator token">/</span>lib64link_librarys <span class="operator token">:</span><span class="operator token">=</span> opencv_core opencv_highgui opencv_imgproc opencv_videoio opencv_imgcodecs \			nvinfer nvinfer_plugin nvonnxparser \			cuda cublas cudart cudnn \			stdc<span class="operator token">++</span> dlempty		  <span class="operator token">:</span><span class="operator token">=</span>export_path   <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>subst $<span class="punctuation token">(</span>empty<span class="punctuation token">)</span> $<span class="punctuation token">(</span>empty<span class="punctuation token">)</span><span class="punctuation token">,</span><span class="operator token">:</span><span class="punctuation token">,</span>$<span class="punctuation token">(</span>library_paths<span class="punctuation token">)</span><span class="punctuation token">)</span>run_paths     <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>foreach item<span class="punctuation token">,</span>$<span class="punctuation token">(</span>library_paths<span class="punctuation token">)</span><span class="punctuation token">,</span><span class="operator token">-</span>Wl<span class="punctuation token">,</span><span class="operator token">-</span>rpath<span class="operator token">=</span>$<span class="punctuation token">(</span>item<span class="punctuation token">)</span><span class="punctuation token">)</span>include_paths <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>foreach item<span class="punctuation token">,</span>$<span class="punctuation token">(</span>include_paths<span class="punctuation token">)</span><span class="punctuation token">,</span><span class="operator token">-</span>I$<span class="punctuation token">(</span>item<span class="punctuation token">)</span><span class="punctuation token">)</span>library_paths <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>foreach item<span class="punctuation token">,</span>$<span class="punctuation token">(</span>library_paths<span class="punctuation token">)</span><span class="punctuation token">,</span><span class="operator token">-</span>L$<span class="punctuation token">(</span>item<span class="punctuation token">)</span><span class="punctuation token">)</span>link_librarys <span class="operator token">:</span><span class="operator token">=</span> $<span class="punctuation token">(</span>foreach item<span class="punctuation token">,</span>$<span class="punctuation token">(</span>link_librarys<span class="punctuation token">)</span><span class="punctuation token">,</span><span class="operator token">-</span>l$<span class="punctuation token">(</span>item<span class="punctuation token">)</span><span class="punctuation token">)</span>cpp_compile_flags <span class="operator token">:</span><span class="operator token">=</span> <span class="operator token">-</span>std<span class="operator token">=</span>c<span class="operator token">++</span><span class="number token">11</span> <span class="operator token">-</span>fPIC <span class="operator token">-</span>w <span class="operator token">-</span>g <span class="operator token">-</span>pthread <span class="operator token">-</span>fopenmp <span class="operator token">-</span>O0cu_compile_flags  <span class="operator token">:</span><span class="operator token">=</span> <span class="operator token">-</span>std<span class="operator token">=</span>c<span class="operator token">++</span><span class="number token">11</span> <span class="operator token">-</span>g <span class="operator token">-</span>w <span class="operator token">-</span>O0 <span class="operator token">-</span>Xcompiler <span class="string token">"$(cpp_compile_flags)"</span>link_flags        <span class="operator token">:</span><span class="operator token">=</span> <span class="operator token">-</span>pthread <span class="operator token">-</span>fopenmp <span class="operator token">-</span>Wl<span class="punctuation token">,</span><span class="operator token">-</span>rpath<span class="operator token">=</span><span class="char token">'$$ORIGIN'</span>cpp_compile_flags <span class="operator token">+=</span> $<span class="punctuation token">(</span>include_paths<span class="punctuation token">)</span>cu_compile_flags  <span class="operator token">+=</span> $<span class="punctuation token">(</span>include_paths<span class="punctuation token">)</span>link_flags        <span class="operator token">+=</span> $<span class="punctuation token">(</span>library_paths<span class="punctuation token">)</span> $<span class="punctuation token">(</span>link_librarys<span class="punctuation token">)</span> $<span class="punctuation token">(</span>run_paths<span class="punctuation token">)</span><span class="function token">ifneq</span> <span class="punctuation token">(</span>$<span class="punctuation token">(</span>MAKECMDGOALS<span class="punctuation token">)</span><span class="punctuation token">,</span> clean<span class="punctuation token">)</span><span class="operator token">-</span>include $<span class="punctuation token">(</span>cpp_mk<span class="punctuation token">)</span> $<span class="punctuation token">(</span>cu_mk<span class="punctuation token">)</span>endifpro	   <span class="operator token">:</span><span class="operator token">=</span> workspace<span class="operator token">/</span>proexpath <span class="operator token">:</span><span class="operator token">=</span> library_path<span class="punctuation token">.</span>txtlibrary_path<span class="punctuation token">.</span>txt <span class="operator token">:</span> 	@echo LD_LIBRARY_PATH<span class="operator token">=</span>$<span class="punctuation token">(</span>export_path<span class="punctuation token">)</span><span class="operator token">:</span><span class="string token">"$$"</span>LD_LIBRARY_PATH <span class="operator token">&gt;</span> $@workspace<span class="operator token">/</span>pro <span class="operator token">:</span> $<span class="punctuation token">(</span>cpp_objs<span class="punctuation token">)</span> $<span class="punctuation token">(</span>cu_objs<span class="punctuation token">)</span>		@echo Link $@		@mkdir <span class="operator token">-</span>p $<span class="punctuation token">(</span>dir $@<span class="punctuation token">)</span>		@$<span class="punctuation token">(</span>cc<span class="punctuation token">)</span> $<span class="operator token">^</span> <span class="operator token">-</span>o $@ $<span class="punctuation token">(</span>link_flags<span class="punctuation token">)</span>objs<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>o <span class="operator token">:</span> src<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cpp	@echo Compile CXX $<span class="operator token">&lt;</span>	@mkdir <span class="operator token">-</span>p $<span class="punctuation token">(</span>dir $@<span class="punctuation token">)</span>	@$<span class="punctuation token">(</span>cc<span class="punctuation token">)</span> <span class="operator token">-</span>c $<span class="operator token">&lt;</span> <span class="operator token">-</span>o $@ $<span class="punctuation token">(</span>cpp_compile_flags<span class="punctuation token">)</span>objs<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>o <span class="operator token">:</span> src<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cu	@echo Compile CUDA $<span class="operator token">&lt;</span>	@mkdir <span class="operator token">-</span>p $<span class="punctuation token">(</span>dir $@<span class="punctuation token">)</span>	@$<span class="punctuation token">(</span>nvcc<span class="punctuation token">)</span> <span class="operator token">-</span>c $<span class="operator token">&lt;</span> <span class="operator token">-</span>o $@ $<span class="punctuation token">(</span>cu_compile_flags<span class="punctuation token">)</span>objs<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>mk <span class="operator token">:</span> src<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cpp	@echo Compile depends CXX $<span class="operator token">&lt;</span>	@mkdir <span class="operator token">-</span>p $<span class="punctuation token">(</span>dir $@<span class="punctuation token">)</span>	@$<span class="punctuation token">(</span>cc<span class="punctuation token">)</span> <span class="operator token">-</span>M $<span class="operator token">&lt;</span> <span class="operator token">-</span>MF $@ <span class="operator token">-</span>MT $<span class="punctuation token">(</span>@<span class="operator token">:</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>mk<span class="operator token">=</span><span class="punctuation token">.</span>cpp<span class="punctuation token">.</span>o<span class="punctuation token">)</span> $<span class="punctuation token">(</span>cpp_compile_flags<span class="punctuation token">)</span>	objs<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>mk <span class="operator token">:</span> src<span class="operator token">/</span><span class="operator token">%</span><span class="punctuation token">.</span>cu	@echo Compile depends CUDA $<span class="operator token">&lt;</span>	@mkdir <span class="operator token">-</span>p $<span class="punctuation token">(</span>dir $@<span class="punctuation token">)</span>	@$<span class="punctuation token">(</span>nvcc<span class="punctuation token">)</span> <span class="operator token">-</span>M $<span class="operator token">&lt;</span> <span class="operator token">-</span>MF $@ <span class="operator token">-</span>MT $<span class="punctuation token">(</span>@<span class="operator token">:</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>mk<span class="operator token">=</span><span class="punctuation token">.</span>cu<span class="punctuation token">.</span>o<span class="punctuation token">)</span> $<span class="punctuation token">(</span>cu_compile_flags<span class="punctuation token">)</span>run   <span class="operator token">:</span> workspace<span class="operator token">/</span>pro		  @cd workspace <span class="operator token">&amp;&amp;</span> <span class="punctuation token">.</span><span class="operator token">/</span>proclean <span class="operator token">:</span>	@rm <span class="operator token">-</span>rf objs workspace<span class="operator token">/</span>pro	@rm <span class="operator token">-</span>rf library_path<span class="punctuation token">.</span>txt	@rm <span class="operator token">-</span>rf workspace<span class="operator token">/</span>Result<span class="punctuation token">.</span>jpg# å¯¼å‡ºç¬¦å·ï¼Œä½¿å¾—è¿è¡Œæ—¶èƒ½å¤Ÿé“¾æ¥ä¸Š<span class="keyword token">export</span> LD_LIBRARY_PATH<span class="operator token">:</span><span class="operator token">=</span>$<span class="punctuation token">(</span>export_path<span class="punctuation token">)</span><span class="operator token">:</span>$<span class="punctuation token">(</span>LD_LIBRARY_PATH<span class="punctuation token">)</span></code></code></pre> 
<div class="hljs-button {2}"></div> 
<p><code class="hljs">lt; -MF $@ -MT $(@:.cu.mk=.cu.o) $(cu_compile_flags) run : workspace/pro @cd workspace &amp;&amp; ./pro clean : @rm -rf objs workspace/pro @rm -rf library_path.txt @rm -rf workspace/Result.jpg # å¯¼å‡ºç¬¦å·ï¼Œä½¿å¾—è¿è¡Œæ—¶èƒ½å¤Ÿé“¾æ¥ä¸Š export LD_LIBRARY_PATH:=$(export_path):$(LD_LIBRARY_PATH) </code></p> 
<p>OK!æºç ä¹Ÿä¿®æ”¹å¥½äº†ï¼ŒMakefileæ–‡ä»¶ä¹Ÿæå®šäº†ï¼Œå¯ä»¥ç¼–è¯‘è¿è¡Œäº†ï¼Œç›´æ¥åœ¨ç»ˆç«¯æ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤å³å¯</p> 
<p></p> 
<pre><code class="hljs">make run
</code></pre> 
<p></p> 
<p>å›¾è§£å¦‚ä¸‹æ‰€ç¤ºï¼š</p> 
<p></p> 
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://images2.imgbox.com/b7/49/XNjLFEx0_o.png"></p> 
<p></p> 
<p>ç¼–è¯‘è¿è¡Œåçš„å°†åœ¨worksapceä¸‹ç”ŸæˆResult.jpgä¸ºæ¨ç†åçš„å›¾ç‰‡ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œå¯ä»¥çœ‹åˆ°æ•ˆæœè¿˜æ˜¯æ¯”è¾ƒOKçš„ã€‚</p> 
<p></p> 
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://images2.imgbox.com/45/4e/aDJCDoFc_o.jpg"></p> 
<p></p> 
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://images2.imgbox.com/b0/c0/g93l4pF7_o.jpg"></p> 
<p></p> 
<h6><a id="44__825"></a>4.4 æ‹“å±•-æ‘„åƒå¤´æ£€æµ‹</h6> 
<p></p> 
<blockquote> 
 <p>ç®€å•å†™äº†ä¸€ä¸ªæ‘„åƒå¤´æ£€æµ‹çš„demoï¼Œä¸»è¦ä¿®æ”¹ä»¥ä¸‹å‡ ç‚¹ï¼š</p> 
</blockquote> 
<p></p> 
<ul><li> <p><strong>1.main.cpp æ–°å¢yolo_video_demo()å‡½æ•°ï¼Œå…·ä½“å†…å®¹å‚è€ƒä¸‹é¢</strong></p> </li><li> <p><strong>2.main.cpp æ–°å¢è°ƒç”¨yolo_video_demo()å‡½æ•°ä»£ç ï¼Œå…·ä½“å†…å®¹å‚è€ƒä¸‹é¢</strong></p> </li></ul> 
<p></p> 
<pre><code class="hljs">static void yolo_video_demo(const string&amp; engine_file){		// ä¿®æ”¹1 æ–°å¢å‡½æ•°
  auto yolo = yolo::load(engine_file, yolo::Type::V8);
  if (yolo == nullptr)  return;
  
  // auto remote_show = create_zmq_remote_show();

  cv::Mat frame;
  cv::VideoCapture cap(0);
  if (!cap.isOpened()){
    printf("Engine is nullptr");
    return;
  }

  while(true){
    cap.read(frame);
    auto objs = yolo-&gt;forward(cvimg(frame));
    
    for(auto &amp;obj : objs) {
      uint8_t b, g, r;
      tie(b, g, r) = yolo::random_color(obj.class_label);
      cv::rectangle(frame, cv::Point(obj.left, obj.top), cv::Point(obj.right, obj.bottom),
                    cv::Scalar(b, g, r), 5);
      
      auto name = mylabels[obj.class_label];
      auto caption = cv::format("%s %.2f", name, obj.confidence);
      int width = cv::getTextSize(caption, 0, 1, 2, nullptr).width + 10;
      cv::rectangle(frame, cv::Point(obj.left - 3, obj.top - 33),
                    cv::Point(obj.left + width, obj.top), cv::Scalar(b, g, r), -1);
      cv::putText(frame, caption, cv::Point(obj.left, obj.top - 5), 0, 1, cv::Scalar::all(0), 2, 16);
    }
      imshow("frame", frame);
      // remote_show-&gt;post(frame);
      int key = cv::waitKey(1);
      if (key == 27)
          break;
  }

  cap.release();
  cv::destroyAllWindows();
  return;
}

int main() {	// ä¿®æ”¹2 è°ƒç”¨è¯¥å‡½æ•°
  // perf();
  // batch_inference();
  // single_inference();
  yolo_video_demo("best.transd.sim.engine");
  return 0;
}
</code></pre> 
<p></p> 
<p>ä¿®æ”¹å®Œæˆåæ‰§è¡Œmake runå³å¯çœ‹åˆ°å¯¹åº”çš„ç”»é¢æ˜¾ç¤ºäº†</p> 
<p></p> 
<h6><a id="45_trtexec_887"></a>4.5 æ‹“å±•-trtexecå‚æ•°</h6> 
<p></p> 
<p><strong>trtexec</strong>æ˜¯NVIDIA TensorRT SDKä¸­çš„ä¸€ä¸ªå®ç”¨å·¥å…·ï¼Œå®ƒå…è®¸ç”¨æˆ·ä»å‘½ä»¤è¡Œè½»æ¾è¿è¡Œå’Œæµ‹è¯•TensorRTå¼•æ“ã€‚trtexecå‘½ä»¤è¡Œå·¥å…·å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‚æ•°ï¼š</p> 
<p></p> 
<pre><code class="hljs">./trtexec [-h] [--uff model.uff [model.uff ...]] [--onnx model.onnx] [--model=model.plan] [--deploy=&lt;deploy.prototxt&gt;] [--output=&lt;output_name&gt;] [--batch=N] [--device=N] [--workspace=N] [--fp16] [--int8] [--calib=&lt;dir&gt;] [--useDLA=N] [--allowGPUFallback] [--iterations=N] [--avgRuns=N] [--verbose] [--nshapes=N] [--optShapes=NxN ... NxN] [--minShapes=NxN ... NxN] [--maxShapes=NxN ... NxN] [--shapeInput={0,1,2,...}] [--tacticSources] [--loadEngine=&lt;filename&gt;] [--saveEngine=&lt;filename&gt;] [--plugins=&lt;XML file&gt;] [--dumpOutput=&lt;filename&gt;] [--excludePlugin=&lt;name&gt;] [--start=&lt;tag&gt;] [--streams=N] [--batchTile] [--engine=&lt;filename&gt;] [--uffInput=input_name,input_shape] [--uffNHWC] [--uffNCHW] [--uffHW=&lt;value&gt;] [--workspaceSize=&lt;size&gt;] [--buildOnly] [--engineFormat=&lt;format&gt;] [--refit] [--saveRefinedEngine=&lt;filename&gt;] [--calibrator=&lt;classname&gt;] [--detach] [--check] [--fp16Char] [--int8Calib=&lt;dir&gt;] [--int8IO] [--disableTensorCores] [--useSpinWait] [--shapes=&lt;shape&gt;] [--maxBatch=&lt;size&gt;]
</code></pre> 
<p></p> 
<p>å…¶ä¸­ä¸€äº›é‡è¦çš„å‚æ•°å¦‚ä¸‹ï¼š</p> 
<p></p> 
<ul><li><code>--uff</code>ï¼šæŒ‡å®šè¾“å…¥ä¸ºUFFæ¨¡å‹ï¼Œåé¢è·Ÿä¸Šæ¨¡å‹æ–‡ä»¶çš„è·¯å¾„ã€‚</li><li><code>--onnx</code>ï¼šæŒ‡å®šè¾“å…¥ä¸ºONNXæ¨¡å‹ï¼Œåé¢è·Ÿä¸Šæ¨¡å‹æ–‡ä»¶çš„è·¯å¾„ã€‚</li><li><code>--model</code>ï¼šæŒ‡å®šè¾“å…¥ä¸ºåºåˆ—åŒ–çš„å¼•æ“æ–‡ä»¶ï¼Œåé¢è·Ÿä¸Šæ–‡ä»¶è·¯å¾„ã€‚</li><li><code>--deploy</code>ï¼šæŒ‡å®šè¾“å…¥ä¸ºCaffe deployæ–‡ä»¶çš„è·¯å¾„ã€‚</li><li><code>--output</code>ï¼šæŒ‡å®šè¾“å‡ºTensoråç§°ã€‚</li><li><code>--batch</code>ï¼šæŒ‡å®šæ‰§è¡Œæ¨ç†æ—¶æ¯ä¸ªbatchçš„å¤§å°ï¼Œé»˜è®¤ä¸º1ã€‚</li><li><code>--device</code>ï¼šæŒ‡å®šæ‰§è¡Œæ¨ç†çš„è®¾å¤‡ç¼–å·ï¼Œé»˜è®¤ä¸º0ã€‚</li><li><code>--workspace</code>ï¼šæŒ‡å®šGPUå†…å­˜çš„æœ€å¤§ä½¿ç”¨é‡ï¼Œé»˜è®¤ä¸º1GBã€‚</li><li><code>--fp16</code>ï¼šå¯ç”¨FP16ç²¾åº¦ï¼Œå¯æé«˜æ¨ç†æ€§èƒ½å’Œå‡å°‘å†…å­˜ä½¿ç”¨ã€‚</li><li><code>--int8</code>ï¼šå¯ç”¨INT8ç²¾åº¦ï¼Œå¯è¿›ä¸€æ­¥æé«˜æ¨ç†æ€§èƒ½å’Œå‡å°‘å†…å­˜ä½¿ç”¨ã€‚</li><li><code>--calib</code>ï¼šæŒ‡å®šINT8æ ¡å‡†æ•°æ®é›†çš„è·¯å¾„ã€‚</li><li><code>--useDLA</code>ï¼šæŒ‡å®šä½¿ç”¨å“ªä¸ªDLAï¼Œä»¥åŠåœ¨DLAä¸Šè¿è¡Œå“ªäº›å±‚ã€‚</li><li><code>--allowGPUFallback</code>ï¼šå¦‚æœä½¿ç”¨DLAï¼Œå½“æŸäº›å±‚æ— æ³•åœ¨DLAä¸Šè¿è¡Œæ—¶ï¼Œæ˜¯å¦å…è®¸å°†å…¶å›é€€åˆ°GPUã€‚</li><li><code>--iterations</code>ï¼šæŒ‡å®šæµ‹è¯•è¿­ä»£æ¬¡æ•°ã€‚</li><li><code>--avgRuns</code>ï¼šæŒ‡å®šå¹³å‡è¿è¡Œæ¬¡æ•°ã€‚</li><li><code>--verbose</code>ï¼šæ‰“å°æ›´è¯¦ç»†çš„è¾“å‡ºä¿¡æ¯ã€‚</li><li><code>--loadEngine</code>ï¼šæŒ‡å®šåŠ è½½çš„TensorRTå¼•æ“æ–‡ä»¶ï¼Œåé¢è·Ÿä¸Šæ–‡ä»¶è·¯å¾„</li><li><code>--saveEngine</code>ï¼šæŒ‡å®šç”Ÿæˆçš„TensorRTå¼•æ“æ–‡ä»¶ï¼Œåé¢è·Ÿä¸Šæ–‡ä»¶è·¯å¾„</li></ul> 
<p></p> 
<h4><a name="t11"></a><a id="_916"></a>ç»“è¯­</h4> 
<p></p> 
<blockquote> 
 <p>æœ¬ç¯‡åšå®¢ä»‹ç»äº†å…³äºyolov8æ¨¡å‹è®­ç»ƒçš„æµç¨‹ï¼Œä»¥åŠåœ¨jetson nanoåµŒå…¥å¼ä¸Šçš„éƒ¨ç½²å·¥ä½œï¼Œå¹¶å®‰åˆ©äº†ä¸€ä¸ªå…¨æ–°çš„æ¨ç†éƒ¨ç½²æ¡†æ¶inferã€‚åšä¸»åœ¨è¿™é‡Œåªåšäº†æœ€åŸºç¡€çš„æ¼”ç¤ºï¼Œå¦‚æœæœ‰æ›´å¤šçš„éœ€æ±‚éœ€è¦å„ä½çœ‹å®˜è‡ªå·±å»æŒ–æ˜å•¦ğŸ˜„ã€‚æ„Ÿè°¢å„ä½çœ‹åˆ°æœ€åï¼Œåˆ›ä½œä¸æ˜“ï¼Œè¯»åæœ‰æ”¶è·çš„çœ‹å®˜è¯·å¸®å¿™ç‚¹ä¸ªğŸ‘â­ï¸ã€‚</p> 
</blockquote> 
<p></p> 
<h4><a name="t12"></a><a id="_920"></a>ä¸‹è½½é“¾æ¥</h4> 
<p></p> 
<ul><li><a href="https://pan.baidu.com/s/1c50iU7PLwhJfAsCDYs9bvw" rel="nofollow">yolov8æºç [pwd:yolo]</a></li><li><a href="https://pan.baidu.com/s/1oeBugM-bqRN6QFnVgXi5HQ" rel="nofollow">å£ç½©è¯†åˆ«æ•°æ®é›†[password:yolo]</a></li><li><a href="https://pan.baidu.com/s/1u8SaxfJLXnHZoyAmHqculw" rel="nofollow">yolov8é¢„è®­ç»ƒæƒé‡[pwd:yolo]</a></li><li><a href="https://pan.baidu.com/s/193prud3xw-SmG8ercjZlug" rel="nofollow">yolov8å£ç½©è¯†åˆ«æƒé‡[pwd:yolo]</a></li><li><a href="https://pan.baidu.com/s/1T47jZ1AswHnaX32GOkqR_Q" rel="nofollow">inferæºç [pwd:yolo]</a></li><li><a href="https://pan.baidu.com/s/1RW8Z-EQK--NtPgIe6mmKIQ?_at_=1660636990470#list/path=%2F" rel="nofollow">JetPacké•œåƒ[password:nano]</a></li></ul> 
<p></p> 
<h4><a name="t13"></a><a id="_929"></a>å‚è€ƒ</h4> 
<p></p> 
<ul><li> <p><a href="https://github.com/shouxieai/infer">infer</a></p> </li><li> <p><a href="https://blog.csdn.net/qq_40672115/category_11970990.html?spm=1001.2014.3001.5482">JetsonåµŒå…¥å¼ç³»åˆ—æ¨¡å‹éƒ¨ç½²æ•™ç¨‹</a></p> </li><li> <p><a href="https://blog.csdn.net/qq_37706472/article/details/128679699?spm=1001.2014.3001.5502">YOLOv8æœ€å¼ºæ“ä½œ.</a></p> </li><li> <p><a href="https://github.com/ultralytics/ultralytics">yolov8</a></p> </li><li> <p><a href="https://blog.csdn.net/didiaopao/article/details/119787139?spm=1001.2014.3001.5501">åˆ©ç”¨Anacondaå®‰è£…pytorchå’Œpaddleæ·±åº¦å­¦ä¹ ç¯å¢ƒ+pycharmå®‰è£…â€”å…é¢å¤–å®‰è£…CUDAå’Œcudnn(é€‚åˆå°ç™½çš„ä¿å§†çº§æ•™å­¦)</a></p> </li><li> <p><a href="https://www.bilibili.com/video/BV1i7411376y?spm_id_from=333.337.search-card.all.click&amp;vd_source=2306b3f342c070c8a11931c94eafa8e3" rel="nofollow">å£ç½©ä½©æˆ´è¯†åˆ«Demo</a></p> </li><li> <p><a href="https://www.bilibili.com/video/BV1kV411k7D8?vd_source=2306b3f342c070c8a11931c94eafa8e3" rel="nofollow">PASCAL VOC2012æ•°æ®é›†è®²è§£ä¸åˆ¶ä½œè‡ªå·±çš„æ•°æ®é›†</a></p> </li><li> <p><a href="https://blog.csdn.net/didiaopao/article/details/120022845?spm=1001.2014.3001.5502">ç›®æ ‡æ£€æµ‹â€”æ•°æ®é›†æ ¼å¼è½¬åŒ–åŠè®­ç»ƒé›†å’ŒéªŒè¯é›†åˆ’åˆ†</a></p> </li><li> <p><a href="https://zhuanlan.zhihu.com/p/339225116" rel="nofollow">Jetson NANOæ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•é€‰ï¼Ÿ</a></p> </li><li> <p><a href="https://blog.csdn.net/Max_ZhangJF/article/details/120966773">trtexecæ·»åŠ ç¯å¢ƒå˜é‡</a></p> </li><li> <p><a href="https://www.bilibili.com/video/BV15Y41167B5/?spm_id_from=333.999.0.0&amp;vd_source=2306b3f342c070c8a11931c94eafa8e3" rel="nofollow">YoloV8çš„åŠ¨æ€é™æ€batchå¦‚ä½•ç†è§£å’Œä½¿ç”¨</a></p> </li><li> <p><a href="https://www.codetd.com/article/14303045" rel="nofollow">onnxoptimizerã€onnxsimä½¿ç”¨è®°å½•</a></p> </li><li> <p><a href="https://www.bilibili.com/video/BV1F24y1h7LW/?spm_id_from=333.999.0.0&amp;vd_source=2306b3f342c070c8a11931c94eafa8e3" rel="nofollow">å¦‚ä½•é«˜æ•ˆä½¿ç”¨TensorRT</a></p> </li><li> <p><a href="https://www.bilibili.com/video/BV1i7411376y?spm_id_from=333.337.search-card.all.click&amp;vd_source=2306b3f342c070c8a11931c94eafa8e3" rel="nofollow">å£ç½©ä½©æˆ´è¯†åˆ«Demo</a></p> </li><li> <p><a href="https://www.bilibili.com/video/BV1kV411k7D8?vd_source=2306b3f342c070c8a11931c94eafa8e3" rel="nofollow">PASCAL VOC2012æ•°æ®é›†è®²è§£ä¸åˆ¶ä½œè‡ªå·±çš„æ•°æ®é›†</a></p> </li><li> <p><a href="https://blog.csdn.net/didiaopao/article/details/120022845?spm=1001.2014.3001.5502">ç›®æ ‡æ£€æµ‹â€”æ•°æ®é›†æ ¼å¼è½¬åŒ–åŠè®­ç»ƒé›†å’ŒéªŒè¯é›†åˆ’åˆ†</a></p> </li><li> <p><a href="https://zhuanlan.zhihu.com/p/339225116" rel="nofollow">Jetson NANOæ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•é€‰ï¼Ÿ</a></p> </li><li> <p><a href="https://blog.csdn.net/Max_ZhangJF/article/details/120966773">trtexecæ·»åŠ ç¯å¢ƒå˜é‡</a></p> </li><li> <p><a href="https://www.bilibili.com/video/BV15Y41167B5/?spm_id_from=333.999.0.0&amp;vd_source=2306b3f342c070c8a11931c94eafa8e3" rel="nofollow">YoloV8çš„åŠ¨æ€é™æ€batchå¦‚ä½•ç†è§£å’Œä½¿ç”¨</a></p> </li><li> <p><a href="https://www.codetd.com/article/14303045" rel="nofollow">onnxoptimizerã€onnxsimä½¿ç”¨è®°å½•</a></p> </li><li> <p><a href="https://www.bilibili.com/video/BV1F24y1h7LW/?spm_id_from=333.999.0.0&amp;vd_source=2306b3f342c070c8a11931c94eafa8e3" rel="nofollow">å¦‚ä½•é«˜æ•ˆä½¿ç”¨TensorRT</a></p> </li></ul> 
<p><br> ---------------------<br> ä½œè€…ï¼šçˆ±å¬æ­Œçš„å‘¨ç«¥é‹<br> æ¥æºï¼šCSDN<br> åŸæ–‡ï¼šhttps://blog.csdn.net/qq_40672115/article/details/129640372<br> ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºä½œè€…åŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·é™„ä¸Šåšæ–‡é“¾æ¥ï¼<br> å†…å®¹è§£æByï¼š<a href="https://greasyfork.org/zh-CN/scripts/381053-csdn-cnblog%E5%8D%9A%E5%AE%A2%E6%96%87%E7%AB%A0%E4%B8%80%E9%94%AE%E8%BD%AC%E8%BD%BD%E6%8F%92%E4%BB%B6" rel="nofollow">CSDN,CNBLOGåšå®¢æ–‡ç« ä¸€é”®è½¬è½½æ’ä»¶</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c79f8222d7d284cf22d8bfa418aaded9/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">RA4803SA (é«˜ç¨³å®šå®æ—¶æ—¶é’Ÿæ¨¡å—)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fac595f641b7348381602c110531be95/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">åŸºäºæ·±åº¦å­¦ä¹ çš„åœè½¦ä½å…³é”®ç‚¹æ£€æµ‹ç³»ç»Ÿï¼ˆä»£ç &#43;åŸç†ï¼‰</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 èœé¸Ÿç¨‹åºå‘˜åšå®¢.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>