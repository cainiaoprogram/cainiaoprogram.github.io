<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>华为ENSP之MPLS V Hub&amp;Spoke架构 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="华为ENSP之MPLS V Hub&amp;Spoke架构" />
<meta property="og:description" content="实验目的
MPLS VPN 的Hub&amp;Spoke架构
实验过程
AS345内底层OSPF互通，使能MPLS LDP，35.45间建立MP-IBGP邻居13.24建立EBGP邻居.R5建立实例56子接口建立EBGP邻居，观察R1R2流量走向 1.
R5配置配置举例
int g0/0/0
ip ad 192.168.56.5 24
int g0/0/2
ip ad 192.168.45.5 24
os en 1 ar 0
mpls
mpls ldp
int g0/0/1
ip ad 192.168.35.5 24
os en 1 ar 0
mpls
mpls ldp
int l0
ip ad 5.5.5.5 32
os en 1 ar 0
ospf 1 r 5.5.5.5
ar 0
OSPF底层互通
MPLS LSP
IBGP邻居
sy
bgp 345
rou 5.5.5.5" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/ef8d9ee8983319abebc14c10d64872b1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-09-28T20:52:01+08:00" />
<meta property="article:modified_time" content="2022-09-28T20:52:01+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">华为ENSP之MPLS V Hub&amp;Spoke架构</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="493" src="https://images2.imgbox.com/33/2f/bHz9HEhR_o.png" width="954"></p> 
<p style="margin-left:.0001pt;text-align:justify;">实验目的</p> 
<p style="margin-left:.0001pt;text-align:justify;">         MPLS VPN 的Hub&amp;Spoke架构</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">实验过程</p> 
<ol><li style="text-align:justify;">AS345内底层OSPF互通，使能MPLS LDP，35.45间建立MP-IBGP邻居</li><li style="text-align:justify;">13.24建立EBGP邻居.R5建立实例</li><li style="text-align:justify;">56子接口建立EBGP邻居，观察R1R2流量走向</li></ol> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">1.</p> 
<p style="margin-left:.0001pt;text-align:justify;">R5配置配置举例</p> 
<p style="margin-left:.0001pt;text-align:justify;">int g0/0/0</p> 
<p style="margin-left:.0001pt;text-align:justify;">ip ad 192.168.56.5 24</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">int g0/0/2</p> 
<p style="margin-left:.0001pt;text-align:justify;">ip ad 192.168.45.5 24</p> 
<p style="margin-left:.0001pt;text-align:justify;">os en 1 ar 0</p> 
<p style="margin-left:.0001pt;text-align:justify;">mpls</p> 
<p style="margin-left:.0001pt;text-align:justify;">mpls ldp</p> 
<p style="margin-left:.0001pt;text-align:justify;">int g0/0/1</p> 
<p style="margin-left:.0001pt;text-align:justify;">ip ad 192.168.35.5 24</p> 
<p style="margin-left:.0001pt;text-align:justify;">os en 1 ar 0</p> 
<p style="margin-left:.0001pt;text-align:justify;">mpls</p> 
<p style="margin-left:.0001pt;text-align:justify;">mpls ldp</p> 
<p style="margin-left:.0001pt;text-align:justify;">int l0</p> 
<p style="margin-left:.0001pt;text-align:justify;">ip ad 5.5.5.5 32</p> 
<p style="margin-left:.0001pt;text-align:justify;">os en 1 ar 0</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">ospf 1 r 5.5.5.5</p> 
<p style="margin-left:.0001pt;text-align:justify;">ar 0</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">OSPF底层互通</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="318" src="https://images2.imgbox.com/15/76/PygQ7t2E_o.png" width="820"></p> 
<p style="margin-left:.0001pt;text-align:justify;">MPLS LSP</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="234" src="https://images2.imgbox.com/46/1d/EPdroVdX_o.png" width="816"></p> 
<p style="margin-left:.0001pt;text-align:justify;">IBGP邻居</p> 
<p style="margin-left:.0001pt;text-align:justify;">sy</p> 
<p style="margin-left:.0001pt;text-align:justify;">bgp 345</p> 
<p style="margin-left:.0001pt;text-align:justify;">rou 5.5.5.5</p> 
<p style="margin-left:.0001pt;text-align:justify;">pe 3.3.3.3 as 345</p> 
<p style="margin-left:.0001pt;text-align:justify;">pe 3.3.3.3 connect-interface l0</p> 
<p style="margin-left:.0001pt;text-align:justify;">pe 4.4.4.4 as 345</p> 
<p style="margin-left:.0001pt;text-align:justify;">pe 4.4.4.4 connect-interface l0</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="295" src="https://images2.imgbox.com/e0/bf/hBXB8gbF_o.png" width="826"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">MP-IBGP邻居</p> 
<p style="margin-left:.0001pt;text-align:justify;">sy</p> 
<p style="margin-left:.0001pt;text-align:justify;">bgp 345</p> 
<p style="margin-left:.0001pt;text-align:justify;">ipv4-family vpnv4</p> 
<p style="margin-left:.0001pt;text-align:justify;">peer 3.3.3.3 enable</p> 
<p style="margin-left:.0001pt;text-align:justify;">peer 4.4.4.4 enable</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="287" src="https://images2.imgbox.com/c2/80/SKru3MVH_o.png" width="815"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">2.</p> 
<p style="margin-left:.0001pt;text-align:justify;">R3</p> 
<p style="margin-left:.0001pt;text-align:justify;">sy</p> 
<p style="margin-left:.0001pt;text-align:justify;">bgp 345</p> 
<p style="margin-left:.0001pt;text-align:justify;">ipv4-family vpn-instance 1</p> 
<p style="margin-left:.0001pt;text-align:justify;">peer 192.168.13.1 as-number 100</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="365" src="https://images2.imgbox.com/98/29/ohtVZHVv_o.png" width="827"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">R4</p> 
<p style="margin-left:.0001pt;text-align:justify;">sy</p> 
<p style="margin-left:.0001pt;text-align:justify;">bgp 345</p> 
<p style="margin-left:.0001pt;text-align:justify;">ipv4-family vpn-instance 2</p> 
<p style="margin-left:.0001pt;text-align:justify;">peer 192.168.24.2 as-number 200</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="352" src="https://images2.imgbox.com/1b/c3/3okqJcJv_o.png" width="820"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">R5</p> 
<p style="margin-left:.0001pt;text-align:justify;">sy</p> 
<p style="margin-left:.0001pt;text-align:justify;">ip vpn-instance in</p> 
<p style="margin-left:.0001pt;text-align:justify;">route-distinguisher 600:6</p> 
<p style="margin-left:.0001pt;text-align:justify;">vpn-target 1:3 2:4 import-extcommunity</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">ip vpn-instance out</p> 
<p style="margin-left:.0001pt;text-align:justify;">route-distinguisher 600:5</p> 
<p style="margin-left:.0001pt;text-align:justify;">vpn-target 3:1 4:2 export-extcommunity</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:left;">interface GigabitEthernet0/0/0.10</p> 
<p style="margin-left:.0001pt;text-align:left;"> dot1q termination vid 10</p> 
<p style="margin-left:.0001pt;text-align:left;"> ip binding vpn-instance in</p> 
<p style="margin-left:.0001pt;text-align:left;"> ip address 10.10.56.5 255.255.255.0</p> 
<p style="margin-left:.0001pt;text-align:left;"> arp broadcast enable</p> 
<p style="margin-left:.0001pt;text-align:left;">#</p> 
<p style="margin-left:.0001pt;text-align:left;">interface GigabitEthernet0/0/0.20</p> 
<p style="margin-left:.0001pt;text-align:left;"> dot1q termination vid 20</p> 
<p style="margin-left:.0001pt;text-align:left;"> ip binding vpn-instance out</p> 
<p style="margin-left:.0001pt;text-align:left;"> ip address 20.20.56.5 255.255.255.0</p> 
<p style="margin-left:.0001pt;text-align:left;"> arp broadcast enable</p> 
<p style="margin-left:.0001pt;text-align:left;"><img alt="" height="329" src="https://images2.imgbox.com/83/7f/20EKzp8X_o.png" width="816"></p> 
<p style="margin-left:.0001pt;text-align:left;">此时OUT方向没有路由</p> 
<p style="margin-left:.0001pt;text-align:left;"><img alt="" height="55" src="https://images2.imgbox.com/02/3c/7fDYutJT_o.png" width="822"></p> 
<p style="margin-left:.0001pt;text-align:left;"></p> 
<p style="margin-left:.0001pt;text-align:left;"></p> 
<p style="margin-left:.0001pt;text-align:left;">3.R5R6子接口建立EBGP邻居</p> 
<p style="margin-left:.0001pt;text-align:left;">R5</p> 
<p style="margin-left:.0001pt;text-align:left;">ipv4-family vpn-instance in</p> 
<p style="margin-left:.0001pt;text-align:left;">  peer 10.10.56.6 as-number 600</p> 
<p style="margin-left:.0001pt;text-align:left;"> #</p> 
<p style="margin-left:.0001pt;text-align:left;"> ipv4-family vpn-instance out</p> 
<p style="margin-left:.0001pt;text-align:left;">  peer 20.20.56.6 as-number 600</p> 
<p style="margin-left:.0001pt;text-align:left;"></p> 
<p style="margin-left:.0001pt;text-align:left;">R6</p> 
<p style="margin-left:.0001pt;text-align:left;">bgp 600</p> 
<p style="margin-left:.0001pt;text-align:left;"> peer 10.10.56.5 as-number 345</p> 
<p style="margin-left:.0001pt;text-align:left;"> peer 20.20.56.5 as-number 345</p> 
<p style="margin-left:.0001pt;text-align:left;"><img alt="" height="397" src="https://images2.imgbox.com/fc/2d/XTMfZsX2_o.png" width="826"></p> 
<p style="margin-left:.0001pt;text-align:left;">此时R5出方向依旧没有路由，在R6上查看路由属性发现AS号相同，放环机制丢弃了路由</p> 
<p style="margin-left:.0001pt;text-align:left;"><img alt="" height="338" src="https://images2.imgbox.com/e2/57/x291czTp_o.png" width="829"></p> 
<p style="margin-left:.0001pt;text-align:left;">在R5实例OUT上开启AS号忽略即可</p> 
<p style="margin-left:.0001pt;text-align:left;">[R5-bgp-out]peer 20.20.56.6 allow-as-loop</p> 
<p style="margin-left:.0001pt;text-align:left;"><img alt="" height="478" src="https://images2.imgbox.com/9a/fc/0DqMFPE9_o.png" width="820"></p> 
<p style="margin-left:.0001pt;text-align:left;">此时就从R6上学到了R1，R2路由。</p> 
<p style="margin-left:.0001pt;text-align:left;"><img alt="" height="351" src="https://images2.imgbox.com/7a/06/vB2yodVA_o.png" width="836"></p> 
<p style="margin-left:.0001pt;text-align:left;">流量走向符合设计</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/62d3644deb946b57fe85d7a873583a69/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【快速幂】a的n次幂的算法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4f424cf0238119959a23c4e1fb985cc5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">ubuntu20.04版本安装教程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>