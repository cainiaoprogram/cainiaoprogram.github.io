<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Django 使用login函数登陆和注销 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Django 使用login函数登陆和注销" />
<meta property="og:description" content="一、登陆 1、写一个简单的登陆页面，如下
&lt;!DOCTYPE html&gt; &lt;html lang=&#34;en&#34;&gt; &lt;head&gt; &lt;meta charset=&#34;UTF-8&#34;&gt; &lt;title&gt;登录&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;form action=&#34;&#34; method=&#34;POST&#34;&gt; &lt;input type=&#34;hidden&#34; name=&#34;csrfmiddlewaretoken&#34; value=&#34;{{ csrf_token }}&#34;&gt; &lt;table&gt; &lt;tbody&gt; &lt;tr&gt; &lt;td&gt;用户名：&lt;/td&gt; &lt;td&gt;&lt;input type=&#34;text&#34; name=&#34;username&#34;&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;密码：&lt;/td&gt; &lt;td&gt;&lt;input type=&#34;password&#34; name=&#34;password&#34;&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt; &lt;label for=&#34;&#34;&gt; &lt;input type=&#34;checkbox&#34; name=&#34;remember&#34; value=&#34;1&#34;&gt;记住我 &lt;/label&gt; &lt;/td&gt; &lt;td&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;&lt;/td&gt; &lt;td&gt;&lt;input type=&#34;submit&#34; value=&#34;登录&#34;&gt;&lt;/td&gt; &lt;/tr&gt; &lt;/tbody&gt; &lt;/table&gt; &lt;/form&gt; &lt;/body&gt; &lt;/html&gt; 2、定义一个登陆的视图函数
from django.contrib.auth import login,logout from django.contrib.auth.decorators import login_required,permission_required # 切记：这里一定不要定义login视图函数,可以其他的名字 def my_login(request): #如果是GET请求则直接返回页面 if request." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/3a84608c99fae61396910cd2577ebd26/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-02-27T17:26:47+08:00" />
<meta property="article:modified_time" content="2020-02-27T17:26:47+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Django 使用login函数登陆和注销</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>一、登陆</h3> 
<p>1、写一个简单的登陆页面，如下</p> 
<pre><code class="prism language-html"><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>登录<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>POST<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hidden<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>csrfmiddlewaretoken<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{<!-- -->{ csrf_token }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tbody</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>用户名：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>密码：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>remember<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>记住我
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>登录<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tbody</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p><img src="https://images2.imgbox.com/5e/f0/Y113iGv5_o.png" alt="在这里插入图片描述"><br> 2、定义一个登陆的视图函数</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth <span class="token keyword">import</span> login<span class="token punctuation">,</span>logout
<span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>decorators <span class="token keyword">import</span> login_required<span class="token punctuation">,</span>permission_required
<span class="token comment"># 切记：这里一定不要定义login视图函数,可以其他的名字</span>
<span class="token keyword">def</span> <span class="token function">my_login</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#如果是GET请求则直接返回页面</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'GET'</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">'login.html'</span><span class="token punctuation">)</span>
    <span class="token comment">#如果是POST请求则获取用户名、密码等</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        username <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span>
        password <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span>
        remember <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'remember'</span><span class="token punctuation">)</span>
        <span class="token comment">#使用Django自带的authenticat()函数判断是否有该用户</span>
        user <span class="token operator">=</span> authenticate<span class="token punctuation">(</span>username<span class="token operator">=</span>username<span class="token punctuation">,</span>password<span class="token operator">=</span>password<span class="token punctuation">)</span>
        <span class="token comment">#如果存在该用户并且状态是激活的</span>
        <span class="token keyword">if</span> user <span class="token operator">and</span> user<span class="token punctuation">.</span>is_active<span class="token punctuation">:</span>
            <span class="token comment">#使用Django的login()函数进行登陆</span>
            login<span class="token punctuation">(</span>request<span class="token punctuation">,</span>user<span class="token punctuation">)</span>
            <span class="token comment">#如果记住登陆，则使用全局的过期时间，默认为2周</span>
            <span class="token keyword">if</span> remember<span class="token punctuation">:</span>
                <span class="token comment"># 设置为None，则表示使用全局的过期时间</span>
                request<span class="token punctuation">.</span>session<span class="token punctuation">.</span>set_expiry<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token comment">#否则设为0，关掉浏览器就注销登陆状态了</span>
                request<span class="token punctuation">.</span>session<span class="token punctuation">.</span>set_expiry<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token comment">#获取next页面（原本要访问的页面，因为没登陆所以转到login页面了），如果有的话则重定向到该页面</span>
            next_url <span class="token operator">=</span> request<span class="token punctuation">.</span>GET<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'next'</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> next_url<span class="token punctuation">:</span>
                <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>next_url<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">'登录成功'</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">'用户名或密码错误！'</span><span class="token punctuation">)</span>
</code></pre> 
<p>3、添加路由</p> 
<pre><code class="prism language-python">path<span class="token punctuation">(</span><span class="token string">'login/'</span><span class="token punctuation">,</span>views<span class="token punctuation">.</span>my_login<span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'login'</span><span class="token punctuation">)</span>
</code></pre> 
<p>4、输入账号密码登陆<br> <img src="https://images2.imgbox.com/6d/4b/6KZNZZbu_o.png" alt="在这里插入图片描述"><br> 5、登陆成功<br> <img src="https://images2.imgbox.com/c1/c2/u6Ux5mms_o.png" alt="在这里插入图片描述"><br> 查看cookies，有一个sessionid，这里的过期时间为N/A，因为没选择记住<br> <img src="https://images2.imgbox.com/51/44/N0A5al8B_o.png" alt="在这里插入图片描述"><br> 如果选择记住，即remember为True，使用默认的全局过期时间，为2周<br> <img src="https://images2.imgbox.com/d2/be/PEs92ChR_o.png" alt="在这里插入图片描述"><br> 6、一个异常<br> 如果之前有对user表做修改或外键的话，可能会遇到django.contrib.auth.models.User.extension.RelatedObjectDoesNotExist这样的异常，我遇到的情况是因为使用了外键，但是原本user表中已经创建了没有外键关联的用户，但写了一个接受保存模型的信号处理方法，会监听原本User模型的操作，这样导致如果用User模型中没有外键关联的用户登录的话，报不存在错误DestNotExist。所以如果不打算使用默认的User模型的话，一开始就需要修改好，不要创建了用户再去修改，会产生一些异常。<br> 这里我在UserExtension模型监听User模型的方法中捕捉这个异常然后pass了</p> 
<pre><code class="prism language-python">@receiver<span class="token punctuation">(</span>post_save<span class="token punctuation">,</span>sender<span class="token operator">=</span>User<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">handler_user_extension</span><span class="token punctuation">(</span>sender<span class="token punctuation">,</span>instance<span class="token punctuation">,</span>created<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> created<span class="token punctuation">:</span>
        UserExtension<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>user<span class="token operator">=</span>instance<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            instance<span class="token punctuation">.</span>extension<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> User<span class="token punctuation">.</span>extension<span class="token punctuation">.</span>RelatedObjectDoesNotExist<span class="token punctuation">:</span>
            <span class="token keyword">pass</span>
</code></pre> 
<p>7、函数功能介绍</p> 
<p>login()函数根据用户信息，生成sessionid，这个sessionid是必须保存在数据库当中的，因为需要在用户登陆后，查询session，取出用户基本信息（session_data）</p> 
<ul><li>session_key:服务器返回给用户的sessionid</li><li>session_data:一段加密的文字，把用户的信息生成一段经过加密的字符串。</li><li>expire_date:session过期时间<br> <img src="https://images2.imgbox.com/ac/11/jC93P4y4_o.png" alt="在这里插入图片描述"></li></ul> 
<p>那么是如何把seesionid转换成user的？<br> 是因为在setting.py中有个配置，如下图：在INSTALLED_APPS中有一个’django.contrib.sessions’APP，这个APP是会对每次request和response请求做拦截，拦截到浏览器过来的request的时候，就会在里面找到sessionid，找到sessionid之后，通过查询数据库，找到session_data，对数据进行解密，便可以直接把user取出来。<br> 如果注释掉’django.contrib.sessions’，自动登录就会失效。<br> <img src="https://images2.imgbox.com/9b/52/tVblTcfA_o.png" alt="在这里插入图片描述"></p> 
<ul><li>服务器第一次响应浏览器请求时，会生成一个sessionid，返回给浏览器；</li><li>浏览器再次请求时，会带上cookie中的sessionid，服务器通过查询seesionid，在数据库中查询是哪个用户，取出信息，返回给浏览器；</li><li>Django就通过cookie和session机制完成了自动登录。</li></ul> 
<h3><a id="_124"></a>二、注销</h3> 
<p>logout函数只有一个参数，就是request。没有返回值，而且即使当前用户没有登陆也不会抛出任何异常。</p> 
<p>1、定义一个注销登陆的视图函数</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth <span class="token keyword">import</span> logout
<span class="token keyword">def</span> <span class="token function">my_logout</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    logout<span class="token punctuation">(</span>request<span class="token punctuation">)</span>
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">'成功退出登录！'</span><span class="token punctuation">)</span>
</code></pre> 
<p>2、访问注销的视图函数，此时cookies已经清除<br> <img src="https://images2.imgbox.com/58/3f/x1LoGjSJ_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_137"></a>三、登录限制</h3> 
<p>1、有时候，某个视图函数是需要经过登录后才能访问的。那么我们可以通过django.contrib.auth.decorators.login_required装饰器来实现。示例代码如下：</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>decorators <span class="token keyword">import</span> login_required

<span class="token comment"># 在验证失败后，会跳转到/login/这个url页面</span>
@login_required<span class="token punctuation">(</span>login_url<span class="token operator">=</span><span class="token string">'/login/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">profile</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">'只有登陆后访问'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">path<span class="token punctuation">(</span><span class="token string">'profile/'</span><span class="token punctuation">,</span>views<span class="token punctuation">.</span>profile<span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'profile'</span><span class="token punctuation">)</span>
</code></pre> 
<p>2、然后访问这个视图函数http://127.0.0.1:8000/profile/<br> <img src="https://images2.imgbox.com/6a/98/QoCI0AwY_o.png" alt="在这里插入图片描述"><br> 3、输入账号密码后则可以访问到next页面<br> <img src="https://images2.imgbox.com/be/8e/9pCe3F5F_o.png" alt="在这里插入图片描述"></p> 
<p>4、login_required()装饰器函数做了以下事情：</p> 
<p>如果当前用户没有登陆，跳转到settings.LOGIN_URL,并传递当前的绝对路径到URL请求参数中，例如：/accounts/login/?next=/polls/3/<br> 如果当前用户已经登陆了，执行view方法。在view中的方法可以认为当前用户已经登陆了。</p> 
<p>login_required方法接受两个参数：</p> 
<ul><li>redirect_field_name:默认值是next。用来定义登陆成功之后的跳回之前访问界面的url。</li><li>login_url:默认值是settings.LOGIN_URL。用来指定登陆界面的url。如果不传入改参数，就需要确保settings.LOGIN_URL的值是正确设置的。默认是/accounts/login</li></ul> 
<h3><a id="_167"></a>四、总结</h3> 
<p>大概就写这些吧，关于cookies和session可以看前面写的一篇博客<br> https://blog.csdn.net/qq_41475058/article/details/103992833<br> 如果没用django的login函数进行登陆验证的话，感觉不是很方便，还得自己写认证方法和装饰器，而且session还涉及到加密解密，所以上面这篇里的登陆验证方法主要就是了解一下登陆验证的一个原理，还是使用django的login比较方便。</p> 
<p>关于User模型的可以看上一篇博客<br> https://blog.csdn.net/qq_41475058/article/details/104480987</p> 
<p>参考：https://www.cnblogs.com/wangwei916797941/p/7398962.html<br> https://www.jianshu.com/p/70f19cae1d38</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/bb0f08246501b15189f22a98ba00892b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">quartz使用（二）任务的删除，停止，暂停，启动</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/df51f1c43013aceba30966d020230f6a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">IDEA 快速生成 get/set 方法体</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>