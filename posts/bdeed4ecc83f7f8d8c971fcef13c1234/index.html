<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【51单片机】花式流水灯 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【51单片机】花式流水灯" />
<meta property="og:description" content="目录
任务要求：
1、按键 1、2、3、4 按下，使 8 个 LED 实现下面对应的模式 1、 2、 3、4，上电默认每种模式流水灯的流转时间间隔为 500ms。
1）模式1：按照L1、L2……L8的顺序，从左到右循环点亮。
2）模式2：按照L8、L7……L1的顺序，从右刀座循环点亮。
3）模式3：从两边向中间点亮( (L1,L8)-&gt;(L2,L7)-&gt;(L3,L6)-&gt;(L4,L5) )
4）模式4：从中间向两边点亮( (L4,L5)-&gt;(L3,L6)-&gt;(L2,L7)-&gt;(L1,L8) )
2、按键5按下流水灯的流转时间间隔增加100ms，超过1200ms从400ms开始，用定时器控制时间
3、代码简洁，注释简单易懂。
实现思路：
按键部分
定时器部分
LED处理部分
函数部分
程序源码
任务要求： 1、按键 1、2、3、4 按下，使 8 个 LED 实现下面对应的模式 1、 2、 3、4，上电默认每种模式流水灯的流转时间间隔为 500ms。 1）模式1：按照L1、L2……L8的顺序，从左到右循环点亮。 2）模式2：按照L8、L7……L1的顺序，从右刀座循环点亮。 3）模式3：从两边向中间点亮( (L1,L8)-&gt;(L2,L7)-&gt;(L3,L6)-&gt;(L4,L5) ) 4）模式4：从中间向两边点亮( (L4,L5)-&gt;(L3,L6)-&gt;(L2,L7)-&gt;(L1,L8) ) 2、按键5按下流水灯的流转时间间隔增加100ms，超过1200ms从400ms开始，用定时器控制时间 3、代码简洁，注释简单易懂。 实现思路： 程序大体框架如下图：
还没学过Visio画图，第一次尝试，轻喷~
按键部分 我们先把按键放在定时器里刷新，识别到几号按键按下，就对应LED灯按照第几个模式点亮，按键1按下就是模式1，按键2按下就是模式2……模式1234转换可以用一个全局变量实现，我代码中本变量名称为Light_Mode
主函数要循环判断Light_Mode变量的数值，所以写一个无参数无返回值的LED处理的函数，先根据按键返回值，给Light_Mode变量赋相应的状态值，再根据这个状态值，实现四种不同模式的点灯。
定时器&#43;中断 定时时间10ms，因为51单片机定时时间上限大约是70ms，按键消抖的部分大概是10ms，所以按键在定时器中以10ms时间扫描一次它的状态，每10ms扫描一次它的状态，就会滤除硬件抖动的部分，LED要求的500ms定时，可以在这个10ms基础上累加计数，就是每10ms计数变量自加1，计数变量==50的时候，就是500ms了
要求2 要改变LED闪烁时间间隔 ，那就再定义一个全局变量 unsigned int SpaceT = 500;
名称SpaceT，初值500ms
按键5 按一下SpaceT变量自加100，超过1200，给SpaceT赋值400" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/bdeed4ecc83f7f8d8c971fcef13c1234/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-11-11T16:59:34+08:00" />
<meta property="article:modified_time" content="2022-11-11T16:59:34+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【51单片机】花式流水灯</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p></p> 
<p id="main-toc"><strong>目录</strong></p> 
<p id="%E4%BB%BB%E5%8A%A1%E8%A6%81%E6%B1%82%EF%BC%9A-toc" style="margin-left:0px;"><a href="#%E4%BB%BB%E5%8A%A1%E8%A6%81%E6%B1%82%EF%BC%9A" rel="nofollow">任务要求：</a></p> 
<p id="1%E3%80%81%E6%8C%89%E9%94%AE%201%E3%80%812%E3%80%813%E3%80%814%20%E6%8C%89%E4%B8%8B%EF%BC%8C%E4%BD%BF%208%20%E4%B8%AA%20LED%20%E5%AE%9E%E7%8E%B0%E4%B8%8B%E9%9D%A2%E5%AF%B9%E5%BA%94%E7%9A%84%E6%A8%A1%E5%BC%8F%201%E3%80%81%202%E3%80%81%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%203%E3%80%814%EF%BC%8C%E4%B8%8A%E7%94%B5%E9%BB%98%E8%AE%A4%E6%AF%8F%E7%A7%8D%E6%A8%A1%E5%BC%8F%E6%B5%81%E6%B0%B4%E7%81%AF%E7%9A%84%E6%B5%81%E8%BD%AC%E6%97%B6%E9%97%B4%E9%97%B4%E9%9A%94%E4%B8%BA%20500ms%E3%80%82-toc" style="margin-left:40px;"><a href="#1%E3%80%81%E6%8C%89%E9%94%AE%201%E3%80%812%E3%80%813%E3%80%814%20%E6%8C%89%E4%B8%8B%EF%BC%8C%E4%BD%BF%208%20%E4%B8%AA%20LED%20%E5%AE%9E%E7%8E%B0%E4%B8%8B%E9%9D%A2%E5%AF%B9%E5%BA%94%E7%9A%84%E6%A8%A1%E5%BC%8F%201%E3%80%81%202%E3%80%81%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%203%E3%80%814%EF%BC%8C%E4%B8%8A%E7%94%B5%E9%BB%98%E8%AE%A4%E6%AF%8F%E7%A7%8D%E6%A8%A1%E5%BC%8F%E6%B5%81%E6%B0%B4%E7%81%AF%E7%9A%84%E6%B5%81%E8%BD%AC%E6%97%B6%E9%97%B4%E9%97%B4%E9%9A%94%E4%B8%BA%20500ms%E3%80%82" rel="nofollow">1、按键 1、2、3、4 按下，使 8 个 LED 实现下面对应的模式 1、 2、        3、4，上电默认每种模式流水灯的流转时间间隔为 500ms。</a></p> 
<p id="1%EF%BC%89%E6%A8%A1%E5%BC%8F1%EF%BC%9A%E6%8C%89%E7%85%A7L1%E3%80%81L2%E2%80%A6%E2%80%A6L8%E7%9A%84%E9%A1%BA%E5%BA%8F%EF%BC%8C%E4%BB%8E%E5%B7%A6%E5%88%B0%E5%8F%B3%E5%BE%AA%E7%8E%AF%E7%82%B9%E4%BA%AE%E3%80%82-toc" style="margin-left:80px;"><a href="#1%EF%BC%89%E6%A8%A1%E5%BC%8F1%EF%BC%9A%E6%8C%89%E7%85%A7L1%E3%80%81L2%E2%80%A6%E2%80%A6L8%E7%9A%84%E9%A1%BA%E5%BA%8F%EF%BC%8C%E4%BB%8E%E5%B7%A6%E5%88%B0%E5%8F%B3%E5%BE%AA%E7%8E%AF%E7%82%B9%E4%BA%AE%E3%80%82" rel="nofollow">1）模式1：按照L1、L2……L8的顺序，从左到右循环点亮。</a></p> 
<p id="2%EF%BC%89%E6%A8%A1%E5%BC%8F2%EF%BC%9A%E6%8C%89%E7%85%A7L8%E3%80%81L7%E2%80%A6%E2%80%A6L1%E7%9A%84%E9%A1%BA%E5%BA%8F%EF%BC%8C%E4%BB%8E%E5%8F%B3%E5%88%80%E5%BA%A7%E5%BE%AA%E7%8E%AF%E7%82%B9%E4%BA%AE%E3%80%82-toc" style="margin-left:80px;"><a href="#2%EF%BC%89%E6%A8%A1%E5%BC%8F2%EF%BC%9A%E6%8C%89%E7%85%A7L8%E3%80%81L7%E2%80%A6%E2%80%A6L1%E7%9A%84%E9%A1%BA%E5%BA%8F%EF%BC%8C%E4%BB%8E%E5%8F%B3%E5%88%80%E5%BA%A7%E5%BE%AA%E7%8E%AF%E7%82%B9%E4%BA%AE%E3%80%82" rel="nofollow">2）模式2：按照L8、L7……L1的顺序，从右刀座循环点亮。</a></p> 
<p id="3%EF%BC%89%E6%A8%A1%E5%BC%8F3%EF%BC%9A%E4%BB%8E%E4%B8%A4%E8%BE%B9%E5%90%91%E4%B8%AD%E9%97%B4%E7%82%B9%E4%BA%AE(%C2%A0%C2%A0(L1%2CL8)-%3E(L2%2CL7)-%3E(L3%2CL6)-%3E(L4%2CL5)%C2%A0%20)-toc" style="margin-left:80px;"><a href="#3%EF%BC%89%E6%A8%A1%E5%BC%8F3%EF%BC%9A%E4%BB%8E%E4%B8%A4%E8%BE%B9%E5%90%91%E4%B8%AD%E9%97%B4%E7%82%B9%E4%BA%AE%28%C2%A0%C2%A0%28L1%2CL8%29-%3E%28L2%2CL7%29-%3E%28L3%2CL6%29-%3E%28L4%2CL5%29%C2%A0%20%29" rel="nofollow">3）模式3：从两边向中间点亮(  (L1,L8)-&gt;(L2,L7)-&gt;(L3,L6)-&gt;(L4,L5)  )</a></p> 
<p id="4%EF%BC%89%E6%A8%A1%E5%BC%8F4%EF%BC%9A%E4%BB%8E%E4%B8%AD%E9%97%B4%E5%90%91%E4%B8%A4%E8%BE%B9%E7%82%B9%E4%BA%AE(%C2%A0%C2%A0(L4%2CL5)-%3E(L3%2CL6)-%3E(L2%2CL7)-%3E(L1%2CL8)%20%C2%A0)-toc" style="margin-left:80px;"><a href="#4%EF%BC%89%E6%A8%A1%E5%BC%8F4%EF%BC%9A%E4%BB%8E%E4%B8%AD%E9%97%B4%E5%90%91%E4%B8%A4%E8%BE%B9%E7%82%B9%E4%BA%AE%28%C2%A0%C2%A0%28L4%2CL5%29-%3E%28L3%2CL6%29-%3E%28L2%2CL7%29-%3E%28L1%2CL8%29%20%C2%A0%29" rel="nofollow">4）模式4：从中间向两边点亮(  (L4,L5)-&gt;(L3,L6)-&gt;(L2,L7)-&gt;(L1,L8)  )</a></p> 
<p id="2%E3%80%81%E6%8C%89%E9%94%AE5%E6%8C%89%E4%B8%8B%E6%B5%81%E6%B0%B4%E7%81%AF%E7%9A%84%E6%B5%81%E8%BD%AC%E6%97%B6%E9%97%B4%E9%97%B4%E9%9A%94%E5%A2%9E%E5%8A%A0100ms%EF%BC%8C%E8%B6%85%E8%BF%871200ms%E4%BB%8E400ms%E5%BC%80%E5%A7%8B%EF%BC%8C%E7%94%A8%E5%AE%9A%E6%97%B6%E5%99%A8%E6%8E%A7%E5%88%B6%E6%97%B6%E9%97%B4-toc" style="margin-left:40px;"><a href="#2%E3%80%81%E6%8C%89%E9%94%AE5%E6%8C%89%E4%B8%8B%E6%B5%81%E6%B0%B4%E7%81%AF%E7%9A%84%E6%B5%81%E8%BD%AC%E6%97%B6%E9%97%B4%E9%97%B4%E9%9A%94%E5%A2%9E%E5%8A%A0100ms%EF%BC%8C%E8%B6%85%E8%BF%871200ms%E4%BB%8E400ms%E5%BC%80%E5%A7%8B%EF%BC%8C%E7%94%A8%E5%AE%9A%E6%97%B6%E5%99%A8%E6%8E%A7%E5%88%B6%E6%97%B6%E9%97%B4" rel="nofollow">2、按键5按下流水灯的流转时间间隔增加100ms，超过1200ms从400ms开始，用定时器控制时间</a></p> 
<p id="3%E3%80%81%E4%BB%A3%E7%A0%81%E7%AE%80%E6%B4%81%EF%BC%8C%E6%B3%A8%E9%87%8A%E7%AE%80%E5%8D%95%E6%98%93%E6%87%82%E3%80%82-toc" style="margin-left:40px;"><a href="#3%E3%80%81%E4%BB%A3%E7%A0%81%E7%AE%80%E6%B4%81%EF%BC%8C%E6%B3%A8%E9%87%8A%E7%AE%80%E5%8D%95%E6%98%93%E6%87%82%E3%80%82" rel="nofollow">3、代码简洁，注释简单易懂。</a></p> 
<p id="%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF%EF%BC%9A-toc" style="margin-left:0px;"><a href="#%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF%EF%BC%9A" rel="nofollow">实现思路：</a></p> 
<p id="%E6%8C%89%E9%94%AE%E9%83%A8%E5%88%86-toc" style="margin-left:40px;"><a href="#%E6%8C%89%E9%94%AE%E9%83%A8%E5%88%86" rel="nofollow">按键部分</a></p> 
<p id="%E5%AE%9A%E6%97%B6%E5%99%A8%E9%83%A8%E5%88%86-toc" style="margin-left:40px;"><a href="#%E5%AE%9A%E6%97%B6%E5%99%A8%E9%83%A8%E5%88%86" rel="nofollow">定时器部分</a></p> 
<p id="LED%E5%A4%84%E7%90%86%E9%83%A8%E5%88%86-toc" style="margin-left:40px;"><a href="#LED%E5%A4%84%E7%90%86%E9%83%A8%E5%88%86" rel="nofollow">LED处理部分</a></p> 
<p id="%E5%87%BD%E6%95%B0%E9%83%A8%E5%88%86-toc" style="margin-left:0px;"><a href="#%E5%87%BD%E6%95%B0%E9%83%A8%E5%88%86" rel="nofollow">函数部分</a></p> 
<p id="%E7%A8%8B%E5%BA%8F%E6%BA%90%E7%A0%81-toc" style="margin-left:0px;"><a href="#%E7%A8%8B%E5%BA%8F%E6%BA%90%E7%A0%81" rel="nofollow">程序源码</a></p> 
<hr id="hr-toc"> 
<p></p> 
<p></p> 
<h2 id="%E4%BB%BB%E5%8A%A1%E8%A6%81%E6%B1%82%EF%BC%9A">任务要求：</h2> 
<p></p> 
<h3 id="1%E3%80%81%E6%8C%89%E9%94%AE%201%E3%80%812%E3%80%813%E3%80%814%20%E6%8C%89%E4%B8%8B%EF%BC%8C%E4%BD%BF%208%20%E4%B8%AA%20LED%20%E5%AE%9E%E7%8E%B0%E4%B8%8B%E9%9D%A2%E5%AF%B9%E5%BA%94%E7%9A%84%E6%A8%A1%E5%BC%8F%201%E3%80%81%202%E3%80%81%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%203%E3%80%814%EF%BC%8C%E4%B8%8A%E7%94%B5%E9%BB%98%E8%AE%A4%E6%AF%8F%E7%A7%8D%E6%A8%A1%E5%BC%8F%E6%B5%81%E6%B0%B4%E7%81%AF%E7%9A%84%E6%B5%81%E8%BD%AC%E6%97%B6%E9%97%B4%E9%97%B4%E9%9A%94%E4%B8%BA%20500ms%E3%80%82"><span style="color:#000000;">1、按键 1、2、3、4 按下，使 8 个 LED 实现下面对应的模式 1、 2、        3、4，上电默认每种模式流水灯的流转时间间隔为 500ms。 </span></h3> 
<div></div> 
<h4 id="1%EF%BC%89%E6%A8%A1%E5%BC%8F1%EF%BC%9A%E6%8C%89%E7%85%A7L1%E3%80%81L2%E2%80%A6%E2%80%A6L8%E7%9A%84%E9%A1%BA%E5%BA%8F%EF%BC%8C%E4%BB%8E%E5%B7%A6%E5%88%B0%E5%8F%B3%E5%BE%AA%E7%8E%AF%E7%82%B9%E4%BA%AE%E3%80%82">1）模式1：按照L1、L2……L8的顺序，从左到右循环点亮。</h4> 
<h4 id="2%EF%BC%89%E6%A8%A1%E5%BC%8F2%EF%BC%9A%E6%8C%89%E7%85%A7L8%E3%80%81L7%E2%80%A6%E2%80%A6L1%E7%9A%84%E9%A1%BA%E5%BA%8F%EF%BC%8C%E4%BB%8E%E5%8F%B3%E5%88%80%E5%BA%A7%E5%BE%AA%E7%8E%AF%E7%82%B9%E4%BA%AE%E3%80%82">2）模式2：按照L8、L7……L1的顺序，从右刀座循环点亮。</h4> 
<h4 id="3%EF%BC%89%E6%A8%A1%E5%BC%8F3%EF%BC%9A%E4%BB%8E%E4%B8%A4%E8%BE%B9%E5%90%91%E4%B8%AD%E9%97%B4%E7%82%B9%E4%BA%AE(%C2%A0%C2%A0(L1%2CL8)-%3E(L2%2CL7)-%3E(L3%2CL6)-%3E(L4%2CL5)%C2%A0%20)">3）模式3：从两边向中间点亮(  (L1,L8)-&gt;(L2,L7)-&gt;(L3,L6)-&gt;(L4,L5)  )</h4> 
<h4 id="4%EF%BC%89%E6%A8%A1%E5%BC%8F4%EF%BC%9A%E4%BB%8E%E4%B8%AD%E9%97%B4%E5%90%91%E4%B8%A4%E8%BE%B9%E7%82%B9%E4%BA%AE(%C2%A0%C2%A0(L4%2CL5)-%3E(L3%2CL6)-%3E(L2%2CL7)-%3E(L1%2CL8)%20%C2%A0)">4）模式4：从中间向两边点亮(  (L4,L5)-&gt;(L3,L6)-&gt;(L2,L7)-&gt;(L1,L8)  )</h4> 
<p></p> 
<h3 id="2%E3%80%81%E6%8C%89%E9%94%AE5%E6%8C%89%E4%B8%8B%E6%B5%81%E6%B0%B4%E7%81%AF%E7%9A%84%E6%B5%81%E8%BD%AC%E6%97%B6%E9%97%B4%E9%97%B4%E9%9A%94%E5%A2%9E%E5%8A%A0100ms%EF%BC%8C%E8%B6%85%E8%BF%871200ms%E4%BB%8E400ms%E5%BC%80%E5%A7%8B%EF%BC%8C%E7%94%A8%E5%AE%9A%E6%97%B6%E5%99%A8%E6%8E%A7%E5%88%B6%E6%97%B6%E9%97%B4">2、按键5按下流水灯的流转时间间隔增加100ms，超过1200ms从400ms开始，用定时器控制时间</h3> 
<p></p> 
<h3 id="3%E3%80%81%E4%BB%A3%E7%A0%81%E7%AE%80%E6%B4%81%EF%BC%8C%E6%B3%A8%E9%87%8A%E7%AE%80%E5%8D%95%E6%98%93%E6%87%82%E3%80%82"><span style="color:#0d0016;">3、代码简洁，注释简单易懂。</span></h3> 
<p></p> 
<h2 id="%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF%EF%BC%9A">实现思路：</h2> 
<p>程序大体框架如下图：</p> 
<p><img alt="" height="652" src="https://images2.imgbox.com/11/e2/mLKsLGXa_o.png" width="1040"></p> 
<p></p> 
<p> 还没学过Visio画图，第一次尝试，轻喷~</p> 
<h3 id="%E6%8C%89%E9%94%AE%E9%83%A8%E5%88%86">按键部分</h3> 
<blockquote> 
 <p>我们先把按键放在<span style="color:#fe2c24;">定时器</span>里刷新，识别到几号按键按下，就对应LED灯按照第几个模式点亮，按键1按下就是模式1，按键2按下就是模式2……模式1234转换可以用一个全局变量实现，我代码中本变量名称为<span style="color:#ff9900;">Light_Mode</span></p> 
</blockquote> 
<p><img alt="" height="514" src="https://images2.imgbox.com/b8/36/gfaWtwFV_o.png" width="760"></p> 
<blockquote> 
 <p> 主函数要循环判断<span style="color:#ff9900;">Light_Mode</span>变量的数值，所以写一个无参数无返回值的LED处理的函数，先根据按键返回值，给Light_Mode变量赋相应的状态值，再根据这个状态值，实现四种不同模式的点灯。</p> 
</blockquote> 
<h3 id="%E5%AE%9A%E6%97%B6%E5%99%A8%E9%83%A8%E5%88%86">定时器+中断</h3> 
<p><span style="color:#fe2c24;"><strong>定时时间10ms</strong></span>，因为51单片机定时时间上限大约是70ms，按键消抖的部分大概是10ms，所以按键在定时器中以10ms时间扫描一次它的状态，每10ms扫描一次它的状态，就会滤除硬件抖动的部分，LED要求的500ms定时，可以在这个10ms基础上累加计数，就是每10ms计数变量自加1，计数变量==50的时候，就是500ms了</p> 
<p>要求2 要改变LED闪烁时间间隔 ，那就再定义一个全局变量 unsigned int  SpaceT = 500;<br> 名称SpaceT，初值500ms<br> 按键5 按一下SpaceT变量自加100，超过1200，给SpaceT赋值400</p> 
<blockquote> 
 <p>定时器0初始化代码</p> 
</blockquote> 
<pre><code>void Timer0_Init(void)		//1毫秒@11.0592MHz
{
	TMOD &amp;= 0xF0;		//设置定时器模式
	TMOD |= 0x01;		//设置定时器模式
	TL0 = 0x66;		//设置定时初值
	TH0 = 0xFC;		//设置定时初值
	TF0 = 0;		//清除TF0标志
	TR0 = 1;		//定时器0开始计时
	ET0=1;
	EA=1;
	PT0=0;	
}</code></pre> 
<blockquote> 
 <p>定时器0的中断</p> 
</blockquote> 
<pre><code>void Timer0_Routine() interrupt 1  //定时器0的中断函数
{
	static unsigned char Button; //按键扫描时间变量 10ms
	static unsigned int T0Count;

	TL0 = 0x66;		//设置定时初值
	TH0 = 0xFC;		//设置定时初值
	Button++;
	T0Count++;

	if(T0Count &gt;= SpaceT){
		i++;
		T0Count = 0;	//软件复位
	}

	if(Button &gt;= 10){
		MatrixKey_Loop();
		Button = 0;
	}

}</code></pre> 
<h3 id="LED%E5%A4%84%E7%90%86%E9%83%A8%E5%88%86">LED处理</h3> 
<p><img alt="" height="499" src="https://images2.imgbox.com/61/08/i9qj4PiL_o.png" width="440"></p> 
<p></p> 
<p>上图是普中科技的51开发板 原理图上说明P2端口对应了8个发光二极管，从P20~P27</p> 
<p>如果想点亮LED1（图示D1），就写P2_0 = 0; </p> 
<p><img alt="" height="432" src="https://images2.imgbox.com/19/4e/1PdqLju3_o.png" width="795"></p> 
<p></p> 
<p>或者对P2整个端口赋值，P2 = 0xFE； 十六进制的0xFE转化二进制后为1111 1110，只有第一个LED点亮。</p> 
<p>如果想先点亮第二个LED，那就P2 = 0xFD；        0xFD代表1111 1101，只有第二个灯点亮</p> 
<p>如果想实现流水灯的效果，那就给P2端口依次赋值如下八个数<br> 1111 1110</p> 
<p>1111 1101</p> 
<p>1111 1011</p> 
<p>1111 0111</p> 
<p>1110 1111</p> 
<p>1101 1111</p> 
<p>1011 1111</p> 
<p>0111 1111</p> 
<p>不难发现，只有0向前<span style="color:#fe2c24;">移位</span>，一次移动移位，由此可以想到位运算中的移位运算符</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/a1/47/NYkB9VF4_o.jpg" width="1200"></p> 
<p> 参考书 C primer plus</p> 
<p></p> 
<p>书上指出，左移运算符，<span style="color:#fe2c24;">高位舍弃，低位补0</span>（补0的那些位LED就会亮起），所以不符合我们的要求</p> 
<p>由于高位舍弃，低位补0，如果我们找到和上面八个数相反的数，再给它取反，就得到了想要的效果</p> 
<p></p> 
<p></p> 
<p></p> 
<p>留点空余时间思考一下</p> 
<p></p> 
<p>……</p> 
<p></p> 
<p></p> 
<p>我们可以对0x01 （0000 0001）移位，左移</p> 
<p>左移1次 0000 0010 (高位舍弃，低位补0)， 取反 1111 1101</p> 
<p>左移2次 0000 0100                                       取反 1111 1011</p> 
<p>……</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/58/47/PBlJlJvg_o.jpg" width="1200"></p> 
<blockquote> 
 <p>变量 i 也要定义为全局变量，因为 i 要在中断函数里改变</p> 
</blockquote> 
<pre><code>for(i=0;i&lt;8;)	//i变量在定时器里加加，控制闪烁时间间隔
{
	P2 = ~(0x01&lt;&lt;i);
}</code></pre> 
<blockquote> 
 <p>模式2流水</p> 
</blockquote> 
<pre><code>for(i=0;i&lt;8;)	//i变量在定时器里加加，控制闪烁时间间隔
{
	P2 = ~(0x80&gt;&gt;i);

}</code></pre> 
<blockquote> 
 <p>模式3</p> 
</blockquote> 
<pre><code>for(i=0;i&lt;4;)
{
	P2 = ~((0x01&lt;&lt;i) | (0x80&gt;&gt;i));//两边向中间 亮灯
}</code></pre> 
<blockquote> 
 <p>模式4</p> 
</blockquote> 
<pre><code>for(i=0;i&lt;4;)
{
	P2 = ~((0x10&lt;&lt;i) | (0x08&gt;&gt;i));
}</code></pre> 
<h2></h2> 
<h2 id="%E5%87%BD%E6%95%B0%E9%83%A8%E5%88%86"></h2> 
<h2 id="%E7%A8%8B%E5%BA%8F%E6%BA%90%E7%A0%81">程序源码</h2> 
<p><img alt="" height="252" src="https://images2.imgbox.com/96/83/l93c5JOT_o.png" width="247"></p> 
<p>本题要求简单，所以我就建了两个模块化的代码</p> 
<blockquote> 
 <p>Timer0.c</p> 
</blockquote> 
<pre><code>#include &lt;REGX52.H&gt;
#include "Timer0.h"


//定时器0初始化模板  1毫秒@11.0592MHz
void Timer0_Init(void)		//1毫秒@11.0592MHz
{
	TMOD &amp;= 0xF0;		//设置定时器模式
	TMOD |= 0x01;		//设置定时器模式
	TL0 = 0x66;		//设置定时初值
	TH0 = 0xFC;		//设置定时初值
	TF0 = 0;		//清除TF0标志
	TR0 = 1;		//定时器0开始计时
	ET0=1;
	EA=1;
	PT0=0;	
}</code></pre> 
<blockquote> 
 <p>Timer0.h</p> 
</blockquote> 
<pre><code>#ifndef __TIMER0_H__
#define __TIMER0_H__

void Timer0_Init(void);		//1毫秒@11.0592MHz

#endif</code></pre> 
<blockquote> 
 <p>MatrixKeyT.c</p> 
</blockquote> 
<p> 矩阵按键模块化的代码在之前的文章有发过，需要的童鞋们可以去翻阅一下</p> 
<pre><code>#include &lt;REGX52.H&gt;
#include "MatrixKeyT.h"

unsigned char Key_KeyNumber;


/**
  *@brief   名称：矩阵键盘扫描，获取按键键码
  *@param   参数：无  （放在主函数while里 赋值给一个 代表键码的变量）
  *@retval返回值：KeyNumber 0代表无按键按下，1~16代表键码
  */
unsigned char Key(void)
{
	unsigned char Temp = 0;
	Temp = Key_KeyNumber;	//赋值给暂存变量
	Key_KeyNumber = 0;		//清零
	return Temp;			//返回暂存变量
}


/**
*@brief   名称：矩阵键盘读取按键键码, 内部函数(不需要外部调用的)
  *@param   参数：无
  *@retval返回值：KeyNumber 0代表无按键按下，1~16代表键码
  */
unsigned char MatrixKey_GetState()
{
	unsigned char KeyNumber=0;
	
	P1=0xFF;
	 P1_3=0;
	if(P1_7==0 &amp;&amp; P1_3==0){KeyNumber=1;}
	if(P1_6==0 &amp;&amp; P1_3==0){KeyNumber=5;}
	if(P1_5==0 &amp;&amp; P1_3==0){KeyNumber=9;}
	if(P1_4==0 &amp;&amp; P1_3==0){KeyNumber=13;}
	
	P1=0xFF;
	P1_2=0;
	if(P1_7==0 &amp;&amp; P1_2==0){KeyNumber=2;}
	if(P1_6==0 &amp;&amp; P1_2==0){KeyNumber=6;}
	if(P1_5==0 &amp;&amp; P1_2==0){KeyNumber=10;}
	if(P1_4==0 &amp;&amp; P1_2==0){KeyNumber=14;}
	
	P1=0xFF;
	P1_1=0;
	if(P1_7==0 &amp;&amp; P1_1==0){KeyNumber=3;}
	if(P1_6==0 &amp;&amp; P1_1==0){KeyNumber=7;}
	if(P1_5==0 &amp;&amp; P1_1==0){KeyNumber=11;}
	if(P1_4==0 &amp;&amp; P1_1==0){KeyNumber=15;}
	
	P1=0xFF;
	P1_0=0;
	if(P1_7==0 &amp;&amp; P1_0==0){KeyNumber=4;}
	if(P1_6==0 &amp;&amp; P1_0==0){KeyNumber=8;}
	if(P1_5==0 &amp;&amp; P1_0==0){KeyNumber=12;}
	if(P1_4==0 &amp;&amp; P1_0==0){KeyNumber=16;}
	
	return KeyNumber;
}


void MatrixKey_Loop(void)
{
	static unsigned char NowState,LastState;
	LastState = NowState;				//按键状态更新
	NowState  = MatrixKey_GetState();		//获取当前按键状态
	if(LastState == 1 &amp;&amp; NowState == 0) {Key_KeyNumber=1;}
	if(LastState == 2 &amp;&amp; NowState == 0) {Key_KeyNumber=2;}
	if(LastState == 3 &amp;&amp; NowState == 0) {Key_KeyNumber=3;}
	if(LastState == 4 &amp;&amp; NowState == 0) {Key_KeyNumber=4;}
	if(LastState == 5 &amp;&amp; NowState == 0) {Key_KeyNumber=5;}
	if(LastState == 6 &amp;&amp; NowState == 0) {Key_KeyNumber=6;}
	if(LastState == 7 &amp;&amp; NowState == 0) {Key_KeyNumber=7;}
	if(LastState == 8 &amp;&amp; NowState == 0) {Key_KeyNumber=8;}
	if(LastState == 9 &amp;&amp; NowState == 0) {Key_KeyNumber=9;}
	if(LastState ==10 &amp;&amp; NowState == 0) {Key_KeyNumber=10;}
	if(LastState ==11 &amp;&amp; NowState == 0) {Key_KeyNumber=11;}
	if(LastState ==12 &amp;&amp; NowState == 0) {Key_KeyNumber=12;}
	if(LastState ==13 &amp;&amp; NowState == 0) {Key_KeyNumber=13;}
	if(LastState ==14 &amp;&amp; NowState == 0) {Key_KeyNumber=14;}
	if(LastState ==15 &amp;&amp; NowState == 0) {Key_KeyNumber=15;}
	if(LastState ==16 &amp;&amp; NowState == 0) {Key_KeyNumber=16;}
}

</code></pre> 
<p></p> 
<blockquote> 
 <p>MatrixKeyT.h</p> 
</blockquote> 
<pre><code>#ifndef __MATRIXKEYT_H__
#define __MATRIXKEYT_H__

unsigned char Key(void);
void MatrixKey_Loop(void);
	
#endif</code></pre> 
<blockquote> 
 <p>main.c</p> 
</blockquote> 
<pre><code>#include &lt;REGX52.H&gt;
#include "Timer0.h"
#include "MatrixKeyT.h"

unsigned char i;//循环变量
unsigned char KeyNumer;
unsigned int  SpaceT = 500;//初值400ms
unsigned char Light_Mode;

void LED_Func();

void main()
{	
	Timer0_Init();

	while(1)
	{
		KeyNumer = Key();
		LED_Func();
	
	}
}

void LED_Func()
{
	if	   (KeyNumer == 1) Light_Mode=1;
	else if(KeyNumer == 2) Light_Mode=2;
	else if(KeyNumer == 3) Light_Mode=3;
	else if(KeyNumer == 4) Light_Mode=4;
	else if(KeyNumer == 5)
	{
		SpaceT += 100;
	}
	if(SpaceT&gt;1200)
		SpaceT = 400;
	
	if(Light_Mode == 1)
	{
		for(i=0;i&lt;8;)	//i变量在定时器里加加，控制闪烁时间间隔
		{
			P2 = ~(0x01&lt;&lt;i);
//				if(Light_Mode != 1)	//for循环，按键键码数值改变，但是模式没及时改变，此处有个bug
//					break;	//要小写
		}
	}
	
	else if(Light_Mode == 2)
	{
		for(i=0;i&lt;8;)	//i变量在定时器里加加，控制闪烁时间间隔
		{
			P2 = ~(0x80&gt;&gt;i);
//				if(Light_Mode != 2)
//					break;
		}
	}
	
	else if(Light_Mode == 3)
	{
		for(i=0;i&lt;4;)
		{
			P2 = ~((0x01&lt;&lt;i) | (0x80&gt;&gt;i));//两边向中间 亮灯
		}
	}
	
	else if(Light_Mode == 4)
	{
		for(i=0;i&lt;4;)
		{
			P2 = ~((0x10&lt;&lt;i) | (0x08&gt;&gt;i));
		}
	}
}

void Timer0_Routine() interrupt 1  //定时器0的中断函数
{
	static unsigned char Button; //按键扫描时间变量 10ms
	static unsigned int T0Count;

	TL0 = 0x66;		//设置定时初值
	TH0 = 0xFC;		//设置定时初值
	Button++;
	T0Count++;

	if(T0Count &gt;= SpaceT){
		i++;
		T0Count = 0;	//软件复位
	}

	if(Button &gt;= 10){
		MatrixKey_Loop();
		Button = 0;
	}

}
</code></pre> 
<p>LED流水实现部分有个BUG：因为我写的是for循环，虽然这时候按下按键，变量Light_Mode已经被重新赋值了，所以不能立刻跳出循环，执行下一个流水灯效果。之前有测试过跳出那个for循环，但是没有实现过，有兴趣的小伙伴可以尝试修改一下bug。</p> 
<p>不过有一个解决方案，把每一个流水灯状态否存放在数组里，依次实现，这样就避免使用for循环~</p> 
<blockquote> 
 <p>补充一个模式1流水灯的方法</p> 
</blockquote> 
<pre><code class="hljs">/*   void forward(void)函数说明
第一次给P1端口赋值 0xfe = 1111 1110
延时200ms
1111 1110&lt;&lt;1    1111 1100     最后一个跟着亮了，给最后一位清零，即灭，“或”0x01，变成1111 1101 ，下次赋值本数
第二次赋值后，延时200ms
1111 1101&lt;&lt;1    1111 1010    也要把最后一位清零，|0x01，变成1111 1011……	
*/

void forward(void)
{
	unsigned char TempOut = 0xfe,j;
	for (j=0;j&lt;8;j++)
	{
		P1 = TempOut;
		Delay_ms(200);
		TempOut = (TempOut &lt;&lt; 1) | 0x01;
		
	}
}</code></pre> 
<p></p> 
<p>小生文采拙劣，多多包涵！</p> 
<p>欢迎大家讨论！</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/29cf154414b87af553e6d4dbb35f3fe1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">常用sql集锦(级联添加更新)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a239fd9b334eeacff9003006e676dcfa/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">mybatis查询一对多数据</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>