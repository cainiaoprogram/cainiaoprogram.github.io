<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Content-Type的类型详解/前后端对于不同Content-type数据类型的处理 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Content-Type的类型详解/前后端对于不同Content-type数据类型的处理" />
<meta property="og:description" content="Content-Type的类型详解 引言 在前端开发中，我们经常需要与后端进行数据交互。然而，在发送网络请求时，很多开发者可能会遇到一个共同的问题：如何正确地设置请求头中的Content-Type以及后端如何处理接收到的数据。与数据类型相关的请求/响应头主要是两个：Accept和Content-Type，其中Content-Type在请求头和响应头中都存在。我们从请求头的角度来介绍各个数据类型。
本博客将深入解析Content-Type的含义，介绍它们的分类和原因，并从前端和后端两个角度分别说明如何使用和处理。
Content-Type介绍 Content-Type作用 Content-Type头部是在客户端向服务器发送请求时，指定请求体的媒体类型。服务器据此判断请求体的格式，从而正确解析数据。
Content-Type 分类 Content-Type的分类是基于MIME类型的，MIME类型通常由两部分组成，一部分是媒体类型（media type），另一部分是子类型（subtype），用斜杠分隔。例如，text/html表示数据的大类是文本，子类是HTML。
MIME 类型有很多种，不同的应用场景可能会使用不同的 MIME 类型。
一般来说，常见的 MIME 类型有以下几类：
text：表示纯文本或者文本格式的数据，如 text/plain, text/html, text/css, text/xml 等。
image：表示图像或者图形格式的数据，如 image/jpeg, image/png, image/gif, image/svg&#43;xml 等。
audio：表示音频或者声音格式的数据，如 audio/mpeg, audio/wav, audio/ogg 等。
video：表示视频或者动画格式的数据，如 video/mp4, video/webm, video/ogg 等。
application：表示其他类型的数据，通常是二进制格式或者特定应用程序的格式，如 application/pdf, application/zip, application/json, application/javascript 等。
multipart：表示多个部分组成的数据，每个部分可以有自己的 MIME 类型，如 multipart/form-data, multipart/mixed 等。
message：表示电子邮件或者其他消息格式的数据，如 message/rfc822, message/http 等。
几种经典的Content-type的介绍 application/x-www-form-urlencoded 这是一种用于发送表单数据的类型，它会将数据以键值对的形式编码，例如name=Tom&amp;age=18。键和值都会进行URL编码，以避免特殊字符的影响。
这种类型的优点是可以发送任何类型的字符，但缺点是不能发送二进制数据，如文件上传，而且URL编码会增加数据的长度，可能会超过服务器的限制。
表单发送 这是默认的表单编码类型，它会将表单中的数据经过URL编码后，用&amp;符号分隔，发送到服务器。
例如，如果表单中有两个字段，fname=张，lname=san，html内容为：
&lt;form action=&#34;http://localhost:3000/test&#34; method=&#34;post&#34; enctype=&#34;application/x-www-form-urlencoded&#34; &gt; First name: &lt;input type=&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/a3e8bf2adea094dcdcd10efc40fa8ef1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-21T15:16:42+08:00" />
<meta property="article:modified_time" content="2023-11-21T15:16:42+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Content-Type的类型详解/前后端对于不同Content-type数据类型的处理</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="ContentType_0"></a>Content-Type的类型详解</h2> 
<h3><a id="_2"></a>引言</h3> 
<p>在前端开发中，我们经常需要与后端进行数据交互。然而，在发送网络请求时，很多开发者可能会遇到一个共同的问题：如何正确地设置请求头中的<strong>Content-Type</strong>以及后端如何处理接收到的数据。与数据类型相关的请求/响应头主要是两个：Accept和Content-Type，其中Content-Type在请求头和响应头中都存在。我们从请求头的角度来介绍各个数据类型。</p> 
<p>本博客将深入解析Content-Type的含义，介绍它们的分类和原因，并从前端和后端两个角度分别说明如何使用和处理。</p> 
<h3><a id="ContentType_8"></a>Content-Type介绍</h3> 
<h4><a id="ContentType_10"></a>Content-Type作用</h4> 
<p>Content-Type头部是在客户端向服务器发送请求时，指定请求体的媒体类型。服务器据此判断请求体的格式，从而正确解析数据。</p> 
<h4><a id="ContentType__14"></a>Content-Type 分类</h4> 
<p>Content-Type的分类是基于<strong>MIME类型</strong>的，MIME类型通常由两部分组成，一部分是媒体类型（media type），另一部分是子类型（subtype），用斜杠分隔。例如，<code>text/html</code>表示数据的大类是文本，子类是HTML。</p> 
<p>MIME 类型有很多种，不同的应用场景可能会使用不同的 MIME 类型。</p> 
<p>一般来说，常见的 MIME 类型有以下几类：</p> 
<ul><li> <p>text：表示纯文本或者文本格式的数据，如 text/plain, text/html, text/css, text/xml 等。</p> </li><li> <p>image：表示图像或者图形格式的数据，如 image/jpeg, image/png, image/gif, image/svg+xml 等。</p> </li><li> <p>audio：表示音频或者声音格式的数据，如 audio/mpeg, audio/wav, audio/ogg 等。</p> </li><li> <p>video：表示视频或者动画格式的数据，如 video/mp4, video/webm, video/ogg 等。</p> </li><li> <p>application：表示其他类型的数据，通常是二进制格式或者特定应用程序的格式，如 application/pdf, application/zip, application/json, application/javascript 等。</p> </li><li> <p>multipart：表示多个部分组成的数据，每个部分可以有自己的 MIME 类型，如 multipart/form-data, multipart/mixed 等。</p> </li><li> <p>message：表示电子邮件或者其他消息格式的数据，如 message/rfc822, message/http 等。</p> </li></ul> 
<h3><a id="Contenttype_36"></a>几种经典的Content-type的介绍</h3> 
<h4><a id="applicationxwwwformurlencoded_38"></a>application/x-www-form-urlencoded</h4> 
<p>这是一种用于发送表单数据的类型，它会将数据以键值对的形式编码，例如<code>name=Tom&amp;age=18</code>。键和值都会进行URL编码，以避免特殊字符的影响。</p> 
<p>这种类型的优点是可以发送任何类型的字符，但缺点是不能发送二进制数据，如文件上传，而且URL编码会增加数据的长度，可能会超过服务器的限制。</p> 
<h5><a id="_44"></a>表单发送</h5> 
<p>这是默认的表单编码类型，它会将表单中的数据经过URL编码后，用&amp;符号分隔，发送到服务器。</p> 
<p>例如，如果表单中有两个字段，fname=张，lname=san，html内容为：</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span>
	<span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://localhost:3000/test<span class="token punctuation">"</span></span>
	<span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span>
	<span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>application/x-www-form-urlencoded<span class="token punctuation">"</span></span>
<span class="token punctuation">&gt;</span></span>
	First name: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fname<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/&gt;</span></span>
	Last name: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>lname<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Submit<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>那么发送的数据就是：</p> 
<pre><code class="prism language-js">fname<span class="token operator">=</span><span class="token operator">%</span><span class="token constant">E5</span><span class="token operator">%</span><span class="token constant">BC</span><span class="token operator">%</span><span class="token constant">A0</span><span class="token operator">&amp;</span>lname<span class="token operator">=</span>san
</code></pre> 
<h5><a id="fetch_68"></a>fetch发送</h5> 
<blockquote> 
 <p>总的来说这种方式使用fetch比较少：</p> 
 <ul><li><a href="https://stackoverflow.com/questions/35325370/how-do-i-post-a-x-www-form-urlencoded-request-using-fetch" rel="nofollow">javascript - How do I POST a x-www-form-urlencoded request using Fetch? - Stack Overflow</a></li><li><a href="https://www.ruanyifeng.com/blog/2020/12/fetch-tutorial.html" rel="nofollow">Fetch API 教程 - 阮一峰的网络日志 (ruanyifeng.com)</a></li></ul> 
</blockquote> 
<p>我们在请求体中传入<strong>编码后的字符串</strong>(在<code>body</code>字段中添加形如<code>name=Tom&amp;age=18</code>的数据即可)，具体来说有这几种方式。</p> 
<h6><a id="_77"></a>直接手写</h6> 
<p>这种方式其实不好，因为可能会对某些字符忽略了<strong>url编码</strong></p> 
<pre><code class="prism language-js"><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://example.com/api'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/x-www-form-urlencoded'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token string">'name=Tom&amp;age=18'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h6><a id="_93"></a>手动拼接</h6> 
<p>手动拼接之前为合法字符串，首先进行url的编码才行</p> 
<pre><code class="prism language-js"><span class="token keyword">var</span> details <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">'userName'</span><span class="token operator">:</span> <span class="token string">'test@gmail.com'</span><span class="token punctuation">,</span>
    <span class="token string-property property">'password'</span><span class="token operator">:</span> <span class="token string">'Password!'</span><span class="token punctuation">,</span>
    <span class="token string-property property">'grant_type'</span><span class="token operator">:</span> <span class="token string">'password'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> formBody <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> property <span class="token keyword">in</span> details<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">var</span> encodedKey <span class="token operator">=</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>property<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> encodedValue <span class="token operator">=</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>details<span class="token punctuation">[</span>property<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  formBody<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>encodedKey <span class="token operator">+</span> <span class="token string">"="</span> <span class="token operator">+</span> encodedValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
formBody <span class="token operator">=</span> formBody<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">"&amp;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://example.com/login'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/x-www-form-urlencoded;charset=UTF-8'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">body</span><span class="token operator">:</span> formBody
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h6><a id="URLSearchParams_121"></a>使用<code>URLSearchParams</code>统一的处理</h6> 
<pre><code class="prism language-js"><span class="token keyword">const</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token string">"test@gmail.com"</span><span class="token punctuation">,</span>
    <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token string">"Password"</span><span class="token punctuation">,</span>
    <span class="token literal-property property">grant_type</span><span class="token operator">:</span> <span class="token string">"password"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 发送Fetch请求</span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"https://example.com/api/login1"</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">"POST"</span><span class="token punctuation">,</span>
    <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"Content-Type"</span><span class="token operator">:</span> <span class="token string">"application/x-www-form-urlencoded"</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">body</span><span class="token operator">:</span> formData<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"Error:"</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<h5><a id="_142"></a>后端处理</h5> 
<pre><code class="prism language-js">
<span class="token comment">// 后端使用express接收application/x-www-form-urlencoded类型的数据</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 使用body-parser中间件的urlencoded方法来解析请求体</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">extended</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/api'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// req.body是一个对象，其中每个键值对对应一个表单字段和值</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {name: 'Tom', age: '18'}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="applicationjson_160"></a>application/json</h4> 
<p>这是一种用于发送JSON数据的类型，它会将数据以JSON字符串的形式编码，例如<code>{"name":"Tom","age":18}</code>。</p> 
<p>使用起来其实和<code>www-form-urlencoded</code>类似，感觉更加的方便一些。</p> 
<h5><a id="fetch_166"></a>fetch发送</h5> 
<p>使用<code>JSON.stringify</code>转一下即可</p> 
<pre><code class="prism language-js"><span class="token comment">// 前端使用fetch发送application/json类型的数据</span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://example.com/api'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Tom'</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h5><a id="_183"></a>后端处理</h5> 
<pre><code class="prism language-js"><span class="token comment">// 后端使用express接收application/json类型的数据</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 使用epress自带的中间件的json方法来解析请求体</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/api'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// req.body是一个对象，其中每个键值对对应一个JSON字段和值</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {name: 'Tom', age: 18}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="multipartformdata_200"></a>multipart/form-data</h4> 
<p>这是一种用于上传文件的类型，它会将数据以多部分的形式编码，每个部分都有一个边界和一个内容类型。这种类型用于需要发送<strong>二进制数据</strong>的情况，如<strong>文件上传</strong>。</p> 
<p>这种类型的优点是可以发送任何类型的数据，包括<strong>二进制数据</strong>，但缺点是数据的格式比较复杂，需要额外的分隔符和描述信息，可能会增加数据的开销。</p> 
<h5><a id="_206"></a>表单上传</h5> 
<p>它会将表单中的数据分成多个部分，每个部分都有一个分隔符和一个描述信息，发送到服务器。</p> 
<p>例如表单代码为：</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span>
	<span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://localhost:3000/files<span class="token punctuation">"</span></span>
	<span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span>
	<span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>multipart/form-data<span class="token punctuation">"</span></span>
<span class="token punctuation">&gt;</span></span>
	姓名：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/&gt;</span></span>
	请选择要上传的文件：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>上传<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>表单格式如下：</p> 
<p><img src="https://images2.imgbox.com/2e/0e/0np50nrh_o.png" alt="image-20231109163221475"></p> 
<p>上传的数据为：</p> 
<p><img src="https://images2.imgbox.com/6b/9b/3hiL18UX_o.png" alt="image-20231109163249606"></p> 
<p>上述数据是一个多部分表单数据格式的字符串，它由以下几个部分组成：</p> 
<ul><li> <p><code>------WebKitFormBoundarylSNPeJJRkGsWkuKA</code>，这是一个分隔符，用于区分不同的表单数据部分，它是由浏览器自动生成的，每个浏览器可能有不同的分隔符。</p> </li><li> <pre><code>Content-Disposition: form-data; name="name"
</code></pre> <p>，这是一个表单数据部分的头部，用于描述这个部分的信息，它有以下几个部分：</p> 
  <ul><li><code>Content-Disposition</code>，这是一个 HTTP 头部字段，用于指定这个部分的处理方式，它的值是 <code>form-data</code>，表示这是一个表单数据部分。</li><li><code>name</code>，这是一个参数，用于指定这个部分的名称，它的值是 <code>name</code>，表示这是用户输入的姓名。</li></ul> </li><li> <p><code>张三</code>，这是一个表单数据部分的内容，用于存储这个部分的数据，它的值是 <code>张三</code>，表示用户输入的姓名是张三。</p> </li><li> <pre><code>Content-Disposition: form-data; name="file"; filename="EDG.jpg"
</code></pre> <p>，这是另一个表单数据部分的头部，用于描述这个部分的信息，它有以下几个部分：</p> 
  <ul><li><code>Content-Disposition</code>，这是一个 HTTP 头部字段，用于指定这个部分的处理方式，它的值是 <code>form-data</code>，表示这是一个表单数据部分。</li><li><code>name</code>，这是一个参数，用于指定这个部分的名称，它的值是 <code>file</code>，表示这是用户选择的文件。</li><li><code>filename</code>，这是另一个参数，用于指定这个部分的文件名，它的值是 <code>EDG.jpg</code>，表示用户选择的文件名是 EDG.jpg。</li></ul> </li><li> <p><code>Content-Type: image/jpeg</code>，这是另一个 HTTP 头部字段，用于指定这个部分的内容类型，它的值是 <code>image/jpeg</code>，表示这是一个 JPEG 格式的图像文件。</p> </li><li> <p><code>------WebKitFormBoundarylSNPeJJRkGsWkuKA--</code>，这是一个结束符，用于标记多部分表单数据的结束，它是由分隔符加上两个连字符组成的。</p> </li></ul> 
<h5><a id="fetch_262"></a>fetch发送</h5> 
<p>使用<code>FromData</code>的实例来转化为该类型，如果是文件，直接将对应的二进制作为键即可。不需要在请求头中设置<code>Content-Type</code>，浏览器会自动添加。</p> 
<pre><code class="prism language-js"><span class="token comment">// 前端使用fetch发送multipart/form-data类型的数据</span>
<span class="token keyword">const</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'Tom'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">,</span> input<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// input是一个文件输入框</span>

<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://example.com/api'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">body</span><span class="token operator">:</span> formData
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="_281"></a>后端处理</h4> 
<p>对于multipart/form-data类型，可以使用<code>multer</code>中间件，它会将请求体中的文件数据解析为一个对象，存放在req.file或req.files属性中，而其他的文本数据则存放在req.body属性中。例如：</p> 
<pre><code class="prism language-js"><span class="token comment">// 后端使用express接收multipart/form-data类型的数据</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> multer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'multer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 使用multer模块来解析请求体</span>
<span class="token keyword">const</span> upload <span class="token operator">=</span> <span class="token function">multer</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">dest</span><span class="token operator">:</span> <span class="token string">'uploads/'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/api'</span><span class="token punctuation">,</span> upload<span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// req.body是一个对象，其中每个键值对对应一个表单字段和值</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {name: 'Tom', age: '18'}</span>
  <span class="token comment">// req.files是一个数组，其中每个元素是一个文件对象</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>files<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [{fieldname: 'file', originalname: 'test.jpg', ...}]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>multer会自动存储到后端目录中的<code>uploads/</code>中，并且以二进制的文件格式存储。</p> 
<p>打印的<code>req.file</code>内容如下：</p> 
<pre><code class="prism language-js"><span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">fieldname</span><span class="token operator">:</span> <span class="token string">'file'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">originalname</span><span class="token operator">:</span> <span class="token string">'9dd38fb5ly1h6728s4qegj22yo1o0af3.jpg'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">encoding</span><span class="token operator">:</span> <span class="token string">'7bit'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">mimetype</span><span class="token operator">:</span> <span class="token string">'image/jpeg'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">destination</span><span class="token operator">:</span> <span class="token string">'uploads/'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'616f17e7a4206b72df293fdd918fd064'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'uploads\\616f17e7a4206b72df293fdd918fd064'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">1420173</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/35/b1/LmTbs2AW_o.png" alt="上传后的文件"></p> 
<p>我们可以看到文件是二进制格式的，至于如何处理为源文件类型，可以参考下面的资料：</p> 
<ul><li><a href="https://blog.csdn.net/weixin_45773503/article/details/116461916">【精选】nodejs之multer模块学习（实现图片上传）_前端formdata() 上传图片,nodejs express 只能用multer处理?-CSDN博客</a></li></ul> 
<p>除此之外，还有一些关于multer的资料如下：</p> 
<ul><li><a href="https://blog.csdn.net/Charissa2017/article/details/105207422">nodeJs中间件Multer详解_使用express实现本地文件/图片上传到服务器指定目录_multer.array-CSDN博客</a></li><li><a href="https://github.com/expressjs/multer/blob/master/doc/README-zh-cn.md">multer/doc/README-zh-cn.md at master · expressjs/multer · GitHub</a></li><li><a href="https://www.npmjs.com/package/multer" rel="nofollow">multer - npm (npmjs.com)</a></li></ul> 
<h3><a id="express_334"></a>使用express响应数据的格式</h3> 
<p>Express中，res.send()、res.json()、res.end()都是用来向客户端发送HTTP响应的方法，但是它们有一些区别。</p> 
<ul><li>res.send()可以发送任何类型的数据，包括字符串、对象、数组、布尔值或Buffer。它会根据数据的类型<strong>自动设置响应头的Content-Type</strong>，比如发送JSON对象时，会设置为application/json。它还会自动结束响应，所以不需要再调用res.end()。</li><li>res.json()和res.send()类似，但是它只能发送JSON对象或数组。它会将数据转换为JSON字符串，并设置响应头的Content-Type为application/json。它也会自动结束响应，所以不需要再调用res.end()。</li><li>res.end()只能发送字符串或Buffer类型的数据，它不会设置响应头的Content-Type，也不会转换数据的格式。它只是用来快速结束没有任何数据的响应，或者在使用res.write()多次发送数据后，结束响应。它不能和res.send()或res.json()同时使用，否则会报错。</li></ul> 
<h4><a id="_342"></a>字符串类型</h4> 
<p>如果您想发送字符串类型的数据，您可以使用res.send()、res.end()或res.render()方法。</p> 
<ul><li>res.send()方法会自动设置响应头的Content-Type为text/html，除非您手动更改。它还会自动结束响应，所以不需要再调用res.end()。这个方法适合发送简单的文本内容，比如一些提示信息或者HTML代码。</li><li>res.end()方法不会设置响应头的Content-Type，也不会转换数据的格式。它只是用来快速结束没有任何数据的响应，或者在使用res.write()多次发送数据后，结束响应。这个方法适合发送一些原始的字符串数据，比如二进制数据的十六进制表示。</li><li>res.render()方法会使用模板引擎来渲染一个视图，并将生成的HTML字符串发送给客户端。它会自动设置响应头的Content-Type为text/html，除非您手动更改。它也会自动结束响应，所以不需要再调用res.end()。这个方法适合发送一些动态的HTML内容，比如根据用户的请求或者数据库的数据来生成的网页。</li><li>前端接收字符串类型的数据时，可以使用response.text()方法来解析数据为字符串，或者使用response.html()方法来解析数据为HTML文档。</li></ul> 
<pre><code class="prism language-javascript"><span class="token comment">// 后端使用res.send()发送一个字符串</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/send'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">'Hello world'</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 自动设置响应头的Content-Type为text/html</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 前端使用fetch接收数据，并打印在控制台</span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/send'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 解析数据为字符串</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 打印Hello world</span>

<span class="token comment">// 后端使用res.end()发送一个字符串</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">let</span> str <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'Hello world'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将字符串转换为十六进制表示</span>
  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 不设置响应头的Content-Type</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 前端使用fetch接收数据，并打印在控制台</span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/end'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 解析数据为字符串</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 打印48656c6c6f20776f726c64</span>

<span class="token comment">// 后端使用res.render()发送一个字符串</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/render'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">let</span> name <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>name <span class="token operator">||</span> <span class="token string">'Bing'</span><span class="token punctuation">;</span> <span class="token comment">// 获取请求参数中的name，如果没有就默认为Bing</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token literal-property property">name</span><span class="token operator">:</span> name<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使用模板引擎渲染index视图，并传入name变量</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 前端使用fetch接收数据，并在网页中显示</span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/render?name=Bob'</span><span class="token punctuation">)</span> <span class="token comment">// 请求参数中传入name=Bob</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 解析数据为HTML文档</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将网页的内容替换为渲染后的HTML</span>
</code></pre> 
<h4><a id="_386"></a>对象或者数组</h4> 
<p>如果您想发送对象或数组类型的数据，您可以使用<code>res.send()</code>或<code>res.json()</code>方法。</p> 
<ul><li>res.send()方法会自动将对象或数组转换为JSON字符串，并设置响应头的Content-Type为application/json，除非您手动更改。它还会自动结束响应，所以不需要再调用res.end()。这个方法适合发送一些简单的JSON数据，比如一些配置信息或者状态码。</li><li>res.json()方法和res.send()类似，但是它只能发送JSON对象或数组。它会将数据转换为JSON字符串，并设置响应头的Content-Type为application/json。它也会自动结束响应，所以不需要再调用res.end()。这个方法适合发送一些复杂的JSON数据，比如一些数据库的查询结果或者API的返回值。</li><li>前端接收对象或数组类型的数据时，可以使用response.json()方法来解析数据为JSON对象，或者使用response.arrayBuffer()方法来解析数据为ArrayBuffer对象。</li></ul> 
<pre><code class="prism language-javascript"><span class="token comment">// 后端使用res.send()发送一个对象</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/send'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Bing'</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 自动设置响应头的Content-Type为application/json</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 前端使用fetch接收数据，并打印在控制台</span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/send'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 解析数据为JSON对象</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 打印{name: 'Bing', age: 10}</span>

<span class="token comment">// 后端使用res.json()发送一个数组</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/json'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 自动设置响应头的Content-Type为application/json</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 前端使用fetch接收数据，并打印在控制台</span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/json'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 解析数据为JSON对象</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 打印[1, 2, 3]</span>
</code></pre> 
<h4><a id="_418"></a>布尔类型</h4> 
<p>如果您想发送布尔值类型的数据，您可以使用res.send()或res.json()方法。</p> 
<ul><li>res.send()方法会自动将布尔值转换为字符串，并设置响应头的Content-Type为text/html，除非您手动更改。它还会自动结束响应，所以不需要再调用res.end()。这个方法适合发送一些简单的布尔值，比如一些判断结果或者开关状态。</li><li>res.json()方法会自动将布尔值转换为JSON字符串，并设置响应头的Content-Type为application/json。它也会自动结束响应，所以不需要再调用res.end()。这个方法适合发送一些复杂的布尔值，比如一些逻辑运算的结果或者条件判断的结果。</li><li>前端接收布尔值类型的数据时，可以使用response.text()方法来解析数据为字符串，或者使用response.json()方法来解析数据为JSON对象。</li></ul> 
<pre><code class="prism language-javascript"><span class="token comment">// 后端使用res.send()发送一个布尔值</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/send'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">let</span> bool <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>bool<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 自动设置响应头的Content-Type为text/html</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 前端使用fetch接收数据，并打印在控制台</span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/send'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 解析数据为字符串</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 打印true</span>

<span class="token comment">// 后端使用res.json()发送一个布尔值</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/json'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">let</span> bool <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>bool<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 自动设置响应头的Content-Type为application/json</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 前端使用fetch接收数据，并打印在控制台</span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/json'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 解析数据为JSON对象</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 打印false</span>
</code></pre> 
<h4><a id="buffer_450"></a>buffer类型</h4> 
<p>如果您想发送Buffer类型的数据，您可以使用res.send()或res.end()方法。</p> 
<ul><li>res.send()方法会自动将Buffer转换为二进制数据，并设置响应头的Content-Type为application/octet-stream，除非您手动更改。它还会自动结束响应，所以不需要再调用res.end()。这个方法适合发送一些二进制数据，比如一些图片或者音频文件。</li><li>res.end()方法不会设置响应头的Content-Type，也不会转换数据的格式。它只是用来快速结束没有任何数据的响应，或者在使用res.write()多次发送数据后，结束响应。这个方法适合发送一些原始的Buffer数据，比如一些加密或者压缩的数据。</li><li>前端接收Buffer类型的数据时，可以使用response.arrayBuffer()方法来解析数据为ArrayBuffer对象，或者使用response.blob()方法来解析数据为Blob对象。</li></ul> 
<pre><code class="prism language-javascript"><span class="token comment">// 后端使用res.send()发送一个Buffer</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/send'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">let</span> buf <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'Hello world'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建一个Buffer对象</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 自动设置响应头的Content-Type为application/octet-stream</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 前端使用fetch接收数据，并打印在控制台</span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/send'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">arrayBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 解析数据为ArrayBuffer对象</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 打印ArrayBuffer(11) [72, 101, 108, 108, 111, 32, 119, 111, 114, 108, 100]</span>

<span class="token comment">// 后端使用res.end()发送一个Buffer</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">let</span> buf <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'Hello world'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建一个Buffer对象</span>
  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 不设置响应头的Content-Type</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 前端使用fetch接收数据，并打印在控制台</span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/end'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">arrayBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 解析数据为ArrayBuffer对象</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 打印ArrayBuffer(11) [72, 101, 108, 108, 111, 32, 119, 111, 114, 108, 100]</span>
</code></pre> 
<h3><a id="fetch_482"></a>使用fetch来解析后端数据</h3> 
<p>当后端响应数据之后，我们使用fetch来获取数据，fetch提供了很多的方法来处理不同类型的数据，就像<code>express</code>中使用中间件来将<code>request</code>中的数据进行转化。</p> 
<p>假设后端使用Express的res.send()方法发送了一个对象，如下：</p> 
<pre><code class="prism language-javascript"><span class="token comment">// 后端代码</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/send'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Bing'</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 自动设置响应头的Content-Type为application/json</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>那么前端使用fetch方法接收数据时，会得到一个Response对象，如下：</p> 
<pre><code class="prism language-javascript"><span class="token comment">// 前端代码</span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/send'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 打印Response对象</span>
    <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 解析数据为JSON对象</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 打印{name: 'Bing', age: 10}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>Response对象的结构大致如下：</p> 
<pre><code class="prism language-javascript"><span class="token comment">// Response对象的结构</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">body</span><span class="token operator">:</span> ReadableStream<span class="token punctuation">,</span> <span class="token comment">// 响应的主体数据的流</span>
  <span class="token literal-property property">bodyUsed</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 响应的主体数据是否已经被使用</span>
  <span class="token literal-property property">headers</span><span class="token operator">:</span> Headers<span class="token punctuation">,</span> <span class="token comment">// 响应的头部信息的对象</span>
  <span class="token literal-property property">ok</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 响应的状态码是否在200-299之间</span>
  <span class="token literal-property property">redirected</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 响应是否经过重定向</span>
  <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token comment">// 响应的状态码</span>
  <span class="token literal-property property">statusText</span><span class="token operator">:</span> <span class="token string">"OK"</span><span class="token punctuation">,</span> <span class="token comment">// 响应的状态文本</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"basic"</span><span class="token punctuation">,</span> <span class="token comment">// 响应的类型，可能是basic, cors, error, opaque, opaqueredirect等</span>
  <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"http://localhost:3000/send"</span><span class="token punctuation">,</span> <span class="token comment">// 响应的URL</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Bing'</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">}</span> <span class="token comment">// 响应的主体数据，需要使用相应的方法来解析</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>前端获取到数据的方法有以下几种，以下方法的返回值都是<strong>Promise</strong>对象，并且Promise的值为将response对象的data进行转换后的结果：</p> 
<ul><li>response.json()：将响应的主体数据解析为JSON对象，适用于响应头的Content-Type为application/json的情况。</li><li>response.text()：将响应的主体数据解析为字符串，适用于响应头的Content-Type为text/html或者其他文本类型的情况。</li><li>response.blob()：将响应的主体数据解析为Blob对象，适用于响应头的Content-Type为image/png或者其他二进制类型的情况。</li><li>response.arrayBuffer()：将响应的主体数据解析为ArrayBuffer对象，适用于响应头的Content-Type为application/octet-stream或者其他二进制类型的情况。</li><li>response.formData()：将响应的主体数据解析为FormData对象，适用于响应头的Content-Type为multipart/form-data的情况。</li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/31ec176731334cfaf91d7ed1bd205eef/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Sentinel-2 哨兵二号数据（Level-1C）下载及预处理教程</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e5ee58a183cf5dddfea0b4c002e6ef75/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">太累了，是时候让AI数字人来帮我干活了（走，上教程）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>