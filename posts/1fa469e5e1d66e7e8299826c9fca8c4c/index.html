<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>烟雾和火灾检测从零开始使用YOLOv5&#43;PyQt5&#43;OpenCV实现（支持图片、视频、摄像头实时检测） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="烟雾和火灾检测从零开始使用YOLOv5&#43;PyQt5&#43;OpenCV实现（支持图片、视频、摄像头实时检测）" />
<meta property="og:description" content="文章目录 烟雾和火灾检测从零开始使用YOLOv5&#43;PyQt5&#43;OpenCV实现1. 数据集的制作1.1 数据集采集1.2 使用labelme对图片进行标注 2. YOLOv52.1YOLO算法简单介绍2.2 YOLOv5获取与调试2.2.1 下载yolov5代码2.2.2 安装yolov5训练所需的第三方库：2.2.3 下载预训练的权重文件2.2.4 配置自己的yaml文件2.2.5 开始训练2.2.5 编写detection方法用于后续检测的调用 3. Pyqt53.1介绍3.2 window平台安装 4. OpenCV安装 5. 界面布局6. 图片、视频、摄像头实时三个模块整合完整代码7 使用7.1. 注意在使用时需要先选择权重7.2.图片、视频、摄像头实时检测 烟雾和火灾检测从零开始使用YOLOv5&#43;PyQt5&#43;OpenCV实现 全流程教程，从数据采集到模型使用到最终展示。若有任何疑问和建议欢迎评论区讨论。
先放上最终实现效果
图片检测效果
视频检测效果
针对住宅、加油站、公路、森林等火灾高发场景，可以自动检测监控区域内的烟雾和火灾，帮助相关人员及时应对，最大程度降低人员伤亡及财物损失，模型效果如图所示。
1. 数据集的制作 已有一份数据且形成了对应的数据集。下载链接为数据集。数据集中包含了5000张已经标注好的数据。该项目采用目标检测的标注方式，提供了VOC数据集格式。
示例图片
数据集图片格式是VOC数据格式，VOC数据是每个图像文件对应一个同名的xml文件，xml文件内包含对应图片的基本信息，比如文件名、来源、图像尺寸以及图像中包含的物体区域信息和类别信息等。
xml文件中包含以下字段：
filename，表示图像名称。
size，表示图像尺寸。包括：图像宽度、图像高度、图像深度。
&lt;size&gt; &lt;width&gt;500&lt;/width&gt; &lt;height&gt;375&lt;/height&gt; &lt;depth&gt;3&lt;/depth&gt; &lt;/size&gt; 最终数据集文件组织结构为：
├── dataset ├── annotations │ ├── fire_000001.xml │ ├── fire_000002.xml │ ├── fire_000003.xml │ | ... ├── images │ ├── fire_000001.jpg │ ├── fire_000003.jpg │ ├── fire_000003." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/1fa469e5e1d66e7e8299826c9fca8c4c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-05T12:08:47+08:00" />
<meta property="article:modified_time" content="2023-05-05T12:08:47+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">烟雾和火灾检测从零开始使用YOLOv5&#43;PyQt5&#43;OpenCV实现（支持图片、视频、摄像头实时检测）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#YOLOv5PyQt5OpenCV_2" rel="nofollow">烟雾和火灾检测从零开始使用YOLOv5+PyQt5+OpenCV实现</a></li><li><ul><li><a href="#1__14" rel="nofollow">1. 数据集的制作</a></li><li><ul><li><a href="#11__58" rel="nofollow">1.1 数据集采集</a></li><li><a href="#12_labelme_60" rel="nofollow">1.2 使用labelme对图片进行标注</a></li></ul> 
   </li><li><a href="#2_YOLOv5_71" rel="nofollow">2. YOLOv5</a></li><li><ul><li><a href="#21YOLO_72" rel="nofollow">2.1YOLO算法简单介绍</a></li><li><a href="#22__YOLOv5_121" rel="nofollow">2.2 YOLOv5获取与调试</a></li><li><ul><li><a href="#221_yolov5_122" rel="nofollow">2.2.1 下载yolov5代码</a></li><li><a href="#222_yolov5_131" rel="nofollow">2.2.2 安装yolov5训练所需的第三方库：</a></li><li><a href="#223__153" rel="nofollow">2.2.3 下载预训练的权重文件</a></li><li><a href="#224_yaml_161" rel="nofollow">2.2.4 配置自己的yaml文件</a></li><li><a href="#225__227" rel="nofollow">2.2.5 开始训练</a></li><li><a href="#225_detection_240" rel="nofollow">2.2.5 编写detection方法用于后续检测的调用</a></li></ul> 
   </li></ul> 
   </li><li><a href="#3_Pyqt5_344" rel="nofollow">3. Pyqt5</a></li><li><ul><li><a href="#31_346" rel="nofollow">3.1介绍</a></li><li><a href="#32_window_352" rel="nofollow">3.2 window平台安装</a></li></ul> 
   </li><li><a href="#4_OpenCV_384" rel="nofollow">4. OpenCV</a></li><li><ul><li><a href="#_388" rel="nofollow">安装</a></li></ul> 
   </li><li><a href="#5__393" rel="nofollow">5. 界面布局</a></li><li><a href="#6__601" rel="nofollow">6. 图片、视频、摄像头实时三个模块整合完整代码</a></li><li><a href="#7__1129" rel="nofollow">7 使用</a></li><li><a href="#71__1130" rel="nofollow">7.1. 注意在使用时需要先选择权重</a></li><li><ul><li><a href="#72_1133" rel="nofollow">7.2.图片、视频、摄像头实时检测</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="YOLOv5PyQt5OpenCV_2"></a>烟雾和火灾检测从零开始使用YOLOv5+PyQt5+OpenCV实现</h2> 
<p><strong>全流程</strong>教程，从数据采集到模型使用到最终展示。若有任何疑问和建议欢迎评论区讨论。</p> 
<p>先放上最终实现效果</p> 
<p>图片检测效果<br> <img src="https://images2.imgbox.com/fe/3b/BAoHx1pU_o.gif" alt="在这里插入图片描述"><br> 视频检测效果<br> <img src="https://images2.imgbox.com/4e/fc/s9A6TyHM_o.gif" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/fc/dd/MGaXrJwn_o.png" alt="在这里插入图片描述"><br> 针对住宅、加油站、公路、森林等火灾高发场景，可以自动检测监控区域内的烟雾和火灾，帮助相关人员及时应对，最大程度降低人员伤亡及财物损失，模型效果如图所示。</p> 
<h3><a id="1__14"></a>1. 数据集的制作</h3> 
<p>已有一份数据且形成了对应的数据集。下载链接为<a href="https://aistudio.baidu.com/aistudio/datasetdetail/107770/0" rel="nofollow">数据集</a>。数据集中包含了5000张已经标注好的数据。该项目采用目标检测的标注方式，提供了VOC数据集格式。</p> 
<p>示例图片<br> <img src="https://images2.imgbox.com/79/07/70w2xIAw_o.png" alt="在这里插入图片描述"></p> 
<p>数据集图片格式是VOC数据格式，VOC数据是每个图像文件对应一个同名的xml文件，xml文件内包含对应图片的基本信息，比如文件名、来源、图像尺寸以及图像中包含的物体区域信息和类别信息等。</p> 
<p>xml文件中包含以下字段：</p> 
<p>filename，表示图像名称。</p> 
<p>size，表示图像尺寸。包括：图像宽度、图像高度、图像深度。</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>size</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>width</span><span class="token punctuation">&gt;</span></span>500<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>width</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>height</span><span class="token punctuation">&gt;</span></span>375<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>height</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>depth</span><span class="token punctuation">&gt;</span></span>3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>depth</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>size</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>最终数据集文件组织结构为：</p> 
<pre><code class="prism language-shell">
 ├── dataset
	├── annotations
  │   ├── fire_000001.xml
  │   ├── fire_000002.xml
  │   ├── fire_000003.xml
  │   <span class="token operator">|</span>   <span class="token punctuation">..</span>.
  ├── images
  │   ├── fire_000001.jpg
  │   ├── fire_000003.jpg
  │   ├── fire_000003.jpg
  │   <span class="token operator">|</span>   <span class="token punctuation">..</span>.
  ├── label_list.txt
  ├── train.txt
  └── valid.txt
</code></pre> 
<p>自己制作数据集可以参考如下步骤：</p> 
<h4><a id="11__58"></a>1.1 数据集采集</h4> 
<p>可以通过爬虫爬取一些图片。</p> 
<h4><a id="12_labelme_60"></a>1.2 使用labelme对图片进行标注</h4> 
<p>labelme是图形图像注释工具，它是用Python编写的，并将Qt用于其图形界面。说直白点，它是有界面的， 像软件一样，可以交互，但是它又是由命令行启动的，比软件的使用稍微麻烦点。其界面如下图：</p> 
<p><img src="https://images2.imgbox.com/07/fa/gf37XUzk_o.png" alt="在这里插入图片描述"><br> github链接: <a href="https://github.com/wkentaro/labelme">labelme</a> https://github.com/wkentaro/labelme<br> 它的功能很多，包括：</p> 
<ul><li>对图像进行多边形，矩形，圆形，多段线，线段，点形式的标注（可用于目标检-测，图像分割等任务）。</li><li>对图像进行进行 flag形式的标注（可用于图像分类 和 清理 任务）。</li><li>视频标注 - 生成 VOC 格式的数据集（for semantic / instancesegmentation）</li><li>生成 COCO 格式的数据集（for instance segmentation）</li></ul> 
<h3><a id="2_YOLOv5_71"></a>2. YOLOv5</h3> 
<h4><a id="21YOLO_72"></a>2.1YOLO算法简单介绍</h4> 
<p>YOLO框架（You Only Look Once）与RCNN系列算法不一样，是以不同的方式处理对象检测。它将整个图像放在一个实例中，并预测这些框的边界框坐标和及所属类别概率。使用YOLO算法最大优的点是速度极快，每秒可处理45帧，也能够理解一般的对象表示。</p> 
<p>在本节中，将介绍YOLO用于检测给定图像中的对象的处理步骤。</p> 
<p>首先，输入图像：<br> <img src="https://images2.imgbox.com/33/7d/Pl5JxOlq_o.png" alt="在这里插入图片描述"></p> 
<p>然后，YOLO将输入图像划分为网格形式（例如3 X 3）：<br> <img src="https://images2.imgbox.com/a0/91/MLIuGg84_o.png" alt="在这里插入图片描述"></p> 
<p>最后，对每个网格应用图像分类和定位处理，获得预测对象的边界框及其对应的类概率。<br> 整个过程是不是很清晰，下面逐一详细介绍。首先需要将标记数据传递给模型以进行训练。假设已将图像划分为大小为3 X 3的网格，且总共只有3个类别，分别是行人（c1）、汽车（c2）和摩托车（c3）。因此，对于每个单元格，标签y将是一个八维向量：</p> 
<p><img src="https://images2.imgbox.com/29/b9/hpwpG6P7_o.png" alt="在这里插入图片描述"></p> 
<p>其中：<br> pc定义对象是否存在于网格中（存在的概率）；<br> bx、by、bh、bw指定边界框；<br> c1、c2、c3代表类别。如果检测对象是汽车，则c2位置处的值将为1，c1和c3处的值将为0；<br> 假设从上面的例子中选择第一个网格：</p> 
<p><img src="https://images2.imgbox.com/7f/05/LakO2jsZ_o.png" alt="在这里插入图片描述"></p> 
<p>由于此网格中没有对象，因此pc将为零，此网格的y标签将为：<br> <img src="https://images2.imgbox.com/ec/aa/NLVE9Ltn_o.png" alt="在这里插入图片描述"></p> 
<p>？意味着其它值是什么并不重要，因为网格中没有对象。下面举例另一个有车的网格（c2=1）：<br> <img src="https://images2.imgbox.com/b4/98/SYR7G7iW_o.png" alt="在这里插入图片描述"></p> 
<p>在为此网格编写y标签之前，首先要了解YOLO如何确定网格中是否存在实际对象。大图中有两个物体（两辆车），因此YOLO将取这两个物体的中心点，物体将被分配到包含这些物体中心的网格中。中心点左侧网格的y标签会是这样的：<br> <img src="https://images2.imgbox.com/9b/55/FTuk61hX_o.png" alt="在这里插入图片描述"></p> 
<p>由于此网格中存在对象，因此pc将等于1，bx、by、bh、bw将相对于正在处理的特定网格单元计算。由于检测出的对象是汽车，所以c2=1，c1和c3均为0。对于9个网格中的每一个单元格，都具有八维输出向量。最终的输出形状为3X3X8。<br> 使用上面的例子（输入图像：100X100X3，输出：3X3X8），模型将按如下方式进行训练：<br> <img src="https://images2.imgbox.com/38/74/OJ6zBCiH_o.png" alt="在这里插入图片描述"></p> 
<p>使用经典的CNN网络构建模型，并进行模型训练。在测试阶段，将图像传递给模型，经过一次前向传播就得到输出y。为了简单起见，使用3X3网格解释这一点，但通常在实际场景中会采用更大的网格（比如19X19）。</p> 
<p>即使一个对象跨越多个网格，它也只会被分配到其中点所在的单个网格。可以通过增加更多网格来减少多个对象出现在同一网格单元中的几率。</p> 
<h4><a id="22__YOLOv5_121"></a>2.2 YOLOv5获取与调试</h4> 
<h5><a id="221_yolov5_122"></a>2.2.1 下载yolov5代码</h5> 
<p>如果你有git，则使用git clone</p> 
<pre><code class="prism language-shell"><span class="token function">git</span> clone https://github.com/ultralytics/yolov5  <span class="token comment"># clone </span>
</code></pre> 
<p>如果你没有git，你可以使用Dwonload ZIP下载代码项目。<br> yolov5代码地址：<a href="https://github.com/ultralytics/yolov5">yolov5</a><br> 注意：yolov5的代码是最新的v8.0版本<br> 可以通过这个链接下载6.0版本https://github.com/ultralytics/yolov5/tree/v6.0</p> 
<h5><a id="222_yolov5_131"></a>2.2.2 安装yolov5训练所需的第三方库：</h5> 
<ol><li>检查是否正确安装好anaconda。<br> windows+r打开cmd，输入 conda -V。若出现版本号，则安装成功。<br> <img src="https://images2.imgbox.com/b2/ec/lL76oIO2_o.png" alt="在这里插入图片描述"></li><li>检查是否正确安装好pytorch</li></ol> 
<pre><code class="prism language-shell"><span class="token function">import</span> torch
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token builtin class-name">:</span>
     print<span class="token punctuation">(</span>torch.zeros<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">))</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/d2/15/VeovlGmP_o.png" alt="在这里插入图片描述"></p> 
<ol start="4"><li>进入yolov5文件夹目录安装第三方库<br> cd [path_to_yolov5]<br> 如下图所示<br> <img src="https://images2.imgbox.com/6a/ad/Tl64d7E9_o.png" alt="在这里插入图片描述"><br> 安装第三方库</li></ol> 
<pre><code class="prism language-shell">pip <span class="token function">install</span> -r requirement.txt 
</code></pre> 
<p>如下图所示，等待安装完成<br> <img src="https://images2.imgbox.com/25/f2/QIbky9PM_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="223__153"></a>2.2.3 下载预训练的权重文件</h5> 
<p>我们需要下载其预训练的权重文件然后再此基础上进行调整训练，这样在数据集数量较小时也能取得不错的检测准确率。</p> 
<p>供选择的有yolov5s,yolov5m,yolov5l,yolov5x。模型的大小逐渐增大，训练时间更长，准确率提高。<br> <img src="https://images2.imgbox.com/da/c6/VWWb2ZFc_o.png" alt="在这里插入图片描述"></p> 
<p>这里我们以yolov5s为例训练。下载地址为<a href="https://github.com/ultralytics/yolov5/releases/download/v6.0/yolov5s.pt">yolov5s.pt</a><br> 所有权重下载地址可在https://github.com/ultralytics/yolov5/releases/tag/v6.0界面找到</p> 
<h5><a id="224_yaml_161"></a>2.2.4 配置自己的yaml文件</h5> 
<p>配置models/yolov5s_my.yaml 可以<strong>直接复制</strong>yolov5s.yaml文件，然后在<strong>nc即类别出进行修改</strong>，对于本文检测数量为2，表示起火和烟雾。其中anchors参数表示锚框的大小，可以通过对数据集进行knn聚类得到，这里<strong>直接使用默认</strong>即对COCO数据集进行聚类的结果。</p> 
<pre><code class="prism language-yaml"><span class="token comment"># YOLOv5 🚀 by Ultralytics, GPL-3.0 license</span>

<span class="token comment"># Parameters</span>
<span class="token key atrule">nc</span><span class="token punctuation">:</span> <span class="token number">2</span> <span class="token comment"># number of classes</span>
<span class="token key atrule">depth_multiple</span><span class="token punctuation">:</span> <span class="token number">0.33</span>  <span class="token comment"># model depth multiple</span>
<span class="token key atrule">width_multiple</span><span class="token punctuation">:</span> <span class="token number">0.50</span>  <span class="token comment"># layer channel multiple</span>
<span class="token key atrule">anchors</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span><span class="token number">23</span><span class="token punctuation">]</span>  <span class="token comment"># P3/8</span>
  <span class="token punctuation">-</span> <span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">,</span><span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">,</span><span class="token number">119</span><span class="token punctuation">]</span>  <span class="token comment"># P4/16</span>
  <span class="token punctuation">-</span> <span class="token punctuation">[</span><span class="token number">116</span><span class="token punctuation">,</span><span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">156</span><span class="token punctuation">,</span><span class="token number">198</span><span class="token punctuation">,</span> <span class="token number">373</span><span class="token punctuation">,</span><span class="token number">326</span><span class="token punctuation">]</span>  <span class="token comment"># P5/32</span>

<span class="token comment"># YOLOv5 v6.0 backbone</span>
<span class="token key atrule">backbone</span><span class="token punctuation">:</span>
  <span class="token comment"># [from, number, module, args]</span>
  <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Conv<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># 0-P1/2</span>
   <span class="token punctuation">[</span><span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Conv<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># 1-P2/4</span>
   <span class="token punctuation">[</span><span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> C3<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token punctuation">[</span><span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Conv<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># 3-P3/8</span>
   <span class="token punctuation">[</span><span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> C3<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token punctuation">[</span><span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Conv<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># 5-P4/16</span>
   <span class="token punctuation">[</span><span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> C3<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">512</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token punctuation">[</span><span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Conv<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># 7-P5/32</span>
   <span class="token punctuation">[</span><span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> C3<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token punctuation">[</span><span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> SPPF<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># 9</span>
  <span class="token punctuation">]</span>

<span class="token comment"># YOLOv5 v6.0 head</span>
<span class="token key atrule">head</span><span class="token punctuation">:</span>
  <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Conv<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token punctuation">[</span><span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> nn.Upsample<span class="token punctuation">,</span> <span class="token punctuation">[</span>None<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'nearest'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Concat<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># cat backbone P4</span>
   <span class="token punctuation">[</span><span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> C3<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token boolean important">False</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># 13</span>

   <span class="token punctuation">[</span><span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Conv<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token punctuation">[</span><span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> nn.Upsample<span class="token punctuation">,</span> <span class="token punctuation">[</span>None<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'nearest'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Concat<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># cat backbone P3</span>
   <span class="token punctuation">[</span><span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> C3<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token boolean important">False</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># 17 (P3/8-small)</span>

   <span class="token punctuation">[</span><span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Conv<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Concat<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># cat head P4</span>
   <span class="token punctuation">[</span><span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> C3<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token boolean important">False</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># 20 (P4/16-medium)</span>

   <span class="token punctuation">[</span><span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Conv<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Concat<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># cat head P5</span>
   <span class="token punctuation">[</span><span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> C3<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">,</span> <span class="token boolean important">False</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># 23 (P5/32-large)</span>

   <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Detect<span class="token punctuation">,</span> <span class="token punctuation">[</span>nc<span class="token punctuation">,</span> anchors<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># Detect(P3, P4, P5)</span>
  <span class="token punctuation">]</span>

</code></pre> 
<p><img src="https://images2.imgbox.com/f0/c6/AA7Ju5Yv_o.png" alt="在这里插入图片描述"></p> 
<p>配置my.yaml 。这里train指定训练数据集所在位置，val测试数据集所在位置，nc类别数，names类别的名称(注意顺序）</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">train</span><span class="token punctuation">:</span> D<span class="token punctuation">:</span>\\BaiduNetdiskDownload\\train
<span class="token key atrule">val</span><span class="token punctuation">:</span> D<span class="token punctuation">:</span>\\BaiduNetdiskDownload\\val
<span class="token key atrule">nc</span><span class="token punctuation">:</span> <span class="token number">2</span>
<span class="token key atrule">names</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'fire'</span><span class="token punctuation">,</span><span class="token string">'smoke'</span><span class="token punctuation">]</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/42/a7/GEz7ESRL_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="225__227"></a>2.2.5 开始训练</h5> 
<pre><code class="prism language-shell">python3 train.py --img <span class="token number">640</span> --batch <span class="token number">8</span> --epochs <span class="token number">50</span> --data my.yaml --cfg yolov5s_my.yaml --weights <span class="token string">"yolov5s.pt"</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/a8/46/Q26Tm3bP_o.png" alt="在这里插入图片描述"><br> 如果出现显卡空间不足的情况可以改小–bath参数<br> <img src="https://images2.imgbox.com/53/c9/CooxWIcL_o.png" alt="在这里插入图片描述"></p> 
<p>会在/runs/train/exp/weights/best.pt下生成最终的权重文件。<br> <img src="https://images2.imgbox.com/84/81/Y8Dr6B6U_o.png" alt="在这里插入图片描述"><br> <strong>将此文件复制到yolov5目录</strong>下后续使用<br> <img src="https://images2.imgbox.com/f5/89/a4i49eIt_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="225_detection_240"></a>2.2.5 编写detection方法用于后续检测的调用</h5> 
<p>后续进行图片或者视频检测时，只需要传入YOLOv5模型和图片,便会返回检测后图片</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> os
<span class="token keyword">import</span> sys
<span class="token keyword">from</span> pathlib <span class="token keyword">import</span> Path

<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> torch


FILE <span class="token operator">=</span> Path<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">.</span>resolve<span class="token punctuation">(</span><span class="token punctuation">)</span>
ROOT <span class="token operator">=</span> FILE<span class="token punctuation">.</span>parents<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  <span class="token comment"># YOLOv5 root directory</span>
<span class="token keyword">if</span> <span class="token builtin">str</span><span class="token punctuation">(</span>ROOT<span class="token punctuation">)</span> <span class="token keyword">not</span> <span class="token keyword">in</span> sys<span class="token punctuation">.</span>path<span class="token punctuation">:</span>
    sys<span class="token punctuation">.</span>path<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>ROOT<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># add ROOT to PATH</span>
ROOT <span class="token operator">=</span> Path<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>relpath<span class="token punctuation">(</span>ROOT<span class="token punctuation">,</span> Path<span class="token punctuation">.</span>cwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># relative</span>

<span class="token keyword">from</span> models<span class="token punctuation">.</span>experimental <span class="token keyword">import</span> attempt_load
<span class="token keyword">from</span> utils<span class="token punctuation">.</span>general <span class="token keyword">import</span> apply_classifier<span class="token punctuation">,</span> check_img_size<span class="token punctuation">,</span> check_imshow<span class="token punctuation">,</span> check_requirements<span class="token punctuation">,</span> check_suffix<span class="token punctuation">,</span> colorstr<span class="token punctuation">,</span> \
    increment_path<span class="token punctuation">,</span> non_max_suppression<span class="token punctuation">,</span> print_args<span class="token punctuation">,</span> save_one_box<span class="token punctuation">,</span> scale_coords<span class="token punctuation">,</span> strip_optimizer<span class="token punctuation">,</span> xyxy2xywh<span class="token punctuation">,</span> LOGGER
<span class="token keyword">from</span> utils<span class="token punctuation">.</span>plots <span class="token keyword">import</span> Annotator<span class="token punctuation">,</span> colors
<span class="token keyword">from</span> utils<span class="token punctuation">.</span>torch_utils <span class="token keyword">import</span> load_classifier<span class="token punctuation">,</span> select_device<span class="token punctuation">,</span> time_sync
<span class="token keyword">from</span> utils<span class="token punctuation">.</span>augmentations <span class="token keyword">import</span> Albumentations<span class="token punctuation">,</span> augment_hsv<span class="token punctuation">,</span> copy_paste<span class="token punctuation">,</span> letterbox<span class="token punctuation">,</span> mixup<span class="token punctuation">,</span> random_perspective

<span class="token decorator annotation punctuation">@torch<span class="token punctuation">.</span>no_grad</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">detection</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span>input_img<span class="token punctuation">)</span><span class="token punctuation">:</span>
    imgsz <span class="token operator">=</span> <span class="token number">640</span>  <span class="token comment"># inference size (pixels)</span>
    conf_thres <span class="token operator">=</span> <span class="token number">0.25</span>   <span class="token comment"># confidence threshold</span>
    iou_thres <span class="token operator">=</span> <span class="token number">0.45</span>   <span class="token comment"># NMS IOU threshold</span>
    max_det <span class="token operator">=</span> <span class="token number">1000</span>  <span class="token comment"># maximum detections per image</span>
    device <span class="token operator">=</span> <span class="token string">'0'</span>  <span class="token comment"># cuda device, i.e. 0 or 0,1,2,3 or cpu</span>
    view_img <span class="token operator">=</span> <span class="token boolean">False</span>   <span class="token comment"># show results</span>
    save_txt <span class="token operator">=</span> <span class="token boolean">False</span>  <span class="token comment"># save results to *.txt</span>
    save_conf <span class="token operator">=</span> <span class="token boolean">False</span>    <span class="token comment"># save confidences in --save-txt labels</span>
    save_crop <span class="token operator">=</span> <span class="token boolean">False</span>   <span class="token comment"># save cropped prediction boxes</span>
    nosave <span class="token operator">=</span> <span class="token boolean">False</span>  <span class="token comment"># do not save images/videos</span>
    classes <span class="token operator">=</span> <span class="token boolean">None</span>   <span class="token comment"># filter by class: --class 0, or --class 0 2 3</span>
    agnostic_nms <span class="token operator">=</span> <span class="token boolean">False</span>   <span class="token comment"># class-agnostic NMS</span>
    augment <span class="token operator">=</span> <span class="token boolean">False</span>   <span class="token comment"># augmented inference</span>
    project <span class="token operator">=</span> ROOT <span class="token operator">/</span> <span class="token string">'runs/detect'</span><span class="token punctuation">,</span>  <span class="token comment"># save results to project/name</span>
    name <span class="token operator">=</span> <span class="token string">'exp'</span>   <span class="token comment"># save results to project/name</span>
    exist_ok <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">,</span>  <span class="token comment"># existing project/name ok, do not increment</span>
    line_thickness <span class="token operator">=</span> <span class="token number">3</span>   <span class="token comment"># bounding box thickness (pixels)</span>
    hide_labels <span class="token operator">=</span> <span class="token boolean">False</span>   <span class="token comment"># hide labels</span>
    hide_conf <span class="token operator">=</span> <span class="token boolean">False</span>   <span class="token comment"># hide confidences</span>
    half <span class="token operator">=</span> <span class="token boolean">False</span>  <span class="token comment"># use FP16 half-precision inference</span>
    <span class="token comment"># Directories</span>
    <span class="token comment"># Initialize</span>
    device <span class="token operator">=</span> select_device<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
    weights <span class="token operator">=</span> <span class="token string">'best.pt'</span>
    <span class="token comment"># # Load model</span>
    w <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>weights<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>weights<span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">)</span> <span class="token keyword">else</span> weights<span class="token punctuation">)</span>
    classify<span class="token punctuation">,</span> suffix<span class="token punctuation">,</span> suffixes <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">,</span> Path<span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">.</span>suffix<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'.pt'</span><span class="token punctuation">,</span> <span class="token string">'.onnx'</span><span class="token punctuation">,</span> <span class="token string">'.tflite'</span><span class="token punctuation">,</span> <span class="token string">'.pb'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">]</span>
    check_suffix<span class="token punctuation">(</span>w<span class="token punctuation">,</span> suffixes<span class="token punctuation">)</span>  <span class="token comment"># check weights have acceptable suffix</span>
    pt<span class="token punctuation">,</span> onnx<span class="token punctuation">,</span> tflite<span class="token punctuation">,</span> pb<span class="token punctuation">,</span> saved_model <span class="token operator">=</span> <span class="token punctuation">(</span>suffix <span class="token operator">==</span> x <span class="token keyword">for</span> x <span class="token keyword">in</span> suffixes<span class="token punctuation">)</span>  <span class="token comment"># backend booleans</span>
    stride <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>stride<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    names <span class="token operator">=</span> model<span class="token punctuation">.</span>module<span class="token punctuation">.</span>names <span class="token keyword">if</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> <span class="token string">'module'</span><span class="token punctuation">)</span> <span class="token keyword">else</span> model<span class="token punctuation">.</span>names  <span class="token comment"># get class names</span>
    imgsz <span class="token operator">=</span> check_img_size<span class="token punctuation">(</span>imgsz<span class="token punctuation">,</span> s<span class="token operator">=</span>stride<span class="token punctuation">)</span>  <span class="token comment"># check image size</span>
    img0 <span class="token operator">=</span> input_img  <span class="token comment"># BGR</span>
    im0s<span class="token operator">=</span>img0
    <span class="token comment"># Padded resize</span>
    img <span class="token operator">=</span> letterbox<span class="token punctuation">(</span>img0<span class="token punctuation">,</span> imgsz<span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> auto<span class="token operator">=</span>pt<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

    <span class="token comment"># Convert</span>
    img <span class="token operator">=</span> img<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>  <span class="token comment"># HWC to CHW, BGR to RGB</span>
    img <span class="token operator">=</span> np<span class="token punctuation">.</span>ascontiguousarray<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
    bs <span class="token operator">=</span> <span class="token number">1</span>  <span class="token comment"># batch_size</span>

    dt<span class="token punctuation">,</span> seen <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span>
    t1 <span class="token operator">=</span> time_sync<span class="token punctuation">(</span><span class="token punctuation">)</span>
    img <span class="token operator">=</span> torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
    img <span class="token operator">=</span> img<span class="token punctuation">.</span><span class="token builtin">float</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># uint8 to fp16/32</span>
    img <span class="token operator">/=</span> <span class="token number">255.0</span>  <span class="token comment"># 0 - 255 to 0.0 - 1.0</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">:</span>
        img <span class="token operator">=</span> img<span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">]</span>  <span class="token comment"># expand for batch dim</span>
    t2 <span class="token operator">=</span> time_sync<span class="token punctuation">(</span><span class="token punctuation">)</span>
    dt<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+=</span> t2 <span class="token operator">-</span> t1
    <span class="token comment"># Inference</span>
    <span class="token keyword">if</span> pt<span class="token punctuation">:</span>
        pred <span class="token operator">=</span> model<span class="token punctuation">(</span>img<span class="token punctuation">,</span> augment<span class="token operator">=</span>augment<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    t3 <span class="token operator">=</span> time_sync<span class="token punctuation">(</span><span class="token punctuation">)</span>
    dt<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+=</span> t3 <span class="token operator">-</span> t2

    <span class="token comment"># NMS</span>
    pred <span class="token operator">=</span> non_max_suppression<span class="token punctuation">(</span>pred<span class="token punctuation">,</span> conf_thres<span class="token punctuation">,</span> iou_thres<span class="token punctuation">,</span> classes<span class="token punctuation">,</span> agnostic_nms<span class="token punctuation">,</span> max_det<span class="token operator">=</span>max_det<span class="token punctuation">)</span>
    dt<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+=</span> time_sync<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> t3
    <span class="token comment"># Process predictions</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> det <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>pred<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># per image</span>
        seen <span class="token operator">+=</span> <span class="token number">1</span>
        im0<span class="token operator">=</span>im0s<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
        annotator <span class="token operator">=</span> Annotator<span class="token punctuation">(</span>im0<span class="token punctuation">,</span> line_width<span class="token operator">=</span>line_thickness<span class="token punctuation">,</span> example<span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">(</span>names<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>det<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># Rescale boxes from img_size to im0 size</span>
            det<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> scale_coords<span class="token punctuation">(</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> det<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> im0<span class="token punctuation">.</span>shape<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">round</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment"># Write results</span>
            <span class="token keyword">for</span> <span class="token operator">*</span>xyxy<span class="token punctuation">,</span> conf<span class="token punctuation">,</span> cls <span class="token keyword">in</span> <span class="token builtin">reversed</span><span class="token punctuation">(</span>det<span class="token punctuation">)</span><span class="token punctuation">:</span>
                  <span class="token comment"># Add bbox to image</span>
                c <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>cls<span class="token punctuation">)</span>  <span class="token comment"># integer class</span>
                label <span class="token operator">=</span> <span class="token boolean">None</span> <span class="token keyword">if</span> hide_labels <span class="token keyword">else</span> <span class="token punctuation">(</span>names<span class="token punctuation">[</span>c<span class="token punctuation">]</span> <span class="token keyword">if</span> hide_conf <span class="token keyword">else</span> <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>names<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>conf<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
                annotator<span class="token punctuation">.</span>box_label<span class="token punctuation">(</span>xyxy<span class="token punctuation">,</span> label<span class="token punctuation">,</span> color<span class="token operator">=</span>colors<span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># Stream results</span>
        im0 <span class="token operator">=</span> annotator<span class="token punctuation">.</span>result<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> im0
</code></pre> 
<h3><a id="3_Pyqt5_344"></a>3. Pyqt5</h3> 
<p>我们通过pyqt来制作展示的界面</p> 
<h4><a id="31_346"></a>3.1介绍</h4> 
<p>PyQt5 是 Digia的一套 Qt5 应用框架与 python 的结合，同时支持 python2.x和 python3.x。</p> 
<p>这里使用的是Python 3.x。Qt库由 Riverbank Computing开发，是最强大的GUI库之一 。</p> 
<p>PyQt5 是由一系列 Python 模块组成。超过 620 个类，6000 函数和方法。能在诸如 Unix、Windows 和Mac OS 等主流操作系统上运行。PyQt5 有两种证书，GPL和 商业证书。</p> 
<h4><a id="32_window_352"></a>3.2 window平台安装</h4> 
<p>PyQt5 有两种安装方式，一种是从官网下载源码安装，另外一种是使用 pip 安装。</p> 
<p>这里我推荐大家使用pip 安装。因为它会自动根据你的Python 版本来选择合适的 PyQt5 版本，如果是手动下载源码安装，难免会选择出错。建议使用比较稳妥的安装方式。</p> 
<pre><code class="prism language-shell">pip3 <span class="token function">install</span> PyQt5 
</code></pre> 
<p>另外，如果你的网络访问外网不是很好的话建议使用豆瓣的镜像下载，不然会很很慢或者直接安装失败。</p> 
<pre><code class="prism language-shell">pip <span class="token function">install</span> PyQt5 -i https://pypi.douban.com/simple
</code></pre> 
<p>执行以下代码：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> sys
<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtWidgets <span class="token keyword">import</span> QWidget<span class="token punctuation">,</span> QApplication

app <span class="token operator">=</span> QApplication<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span>
widget <span class="token operator">=</span> QWidget<span class="token punctuation">(</span><span class="token punctuation">)</span>
widget<span class="token punctuation">.</span>resize<span class="token punctuation">(</span><span class="token number">640</span><span class="token punctuation">,</span> <span class="token number">480</span><span class="token punctuation">)</span>
widget<span class="token punctuation">.</span>setWindowTitle<span class="token punctuation">(</span><span class="token string">"Hello, PyQt5!"</span><span class="token punctuation">)</span>
widget<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span>app<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>如果没有报错，弹出了一个标题为"Hello, PyQt5!"的窗口，则说明安装成功。<br> <img src="https://images2.imgbox.com/9e/26/kOyhUUXP_o.png" alt="在这里插入图片描述"><br> 若pip安装pyqt5报错 error: Microsoft Visual C++ 14.0 or greater is required. Get it with “Microsoft C++ Build Tools”: https://visualstudio.microsoft.com/visual-cpp-build-tools/</p> 
<pre><code class="prism language-shell">error: Microsoft Visual C++ <span class="token number">14.0</span> or greater is required. Get it with <span class="token string">"Microsoft C++ Build Tools"</span><span class="token builtin class-name">:</span> https://visualstudio.microsoft.com/visual-cpp-build-tools/
</code></pre> 
<p>可参考我另外一篇文章 <a href="https://blog.csdn.net/qq_37553692/article/details/128996821">已解决（pip安装pyqt5报错） error: Microsoft Visual C++ 14.0 or greater is required. Get it with “Microsoft</a><br> 对于运行项目做到此即可，若对pyqt感兴趣如图形界面开发工具Qt Designer等可以参考文章https://zhuanlan.zhihu.com/p/162866700</p> 
<h3><a id="4_OpenCV_384"></a>4. OpenCV</h3> 
<p>OpenCV(开源的计算机视觉库)是基于BSD协议,因此它可免费用于学术和商业用途。其提供C++,C,Python和Java接口,支持Windows,Linux,Mac OS,iOS和Android。</p> 
<p>我们使用OpenCV来处理图片和视频，以便于将图片转为Yolov5模型需要的输入。</p> 
<h4><a id="_388"></a>安装</h4> 
<p>首先我们得先安装另一个第三方库numpy，这是opencv的依赖库，没有它无法进行python-opencv开发。<br> 安装numpy：pip install numpy<br> 安装opencv-python： pip install opencv-python</p> 
<h3><a id="5__393"></a>5. 界面布局</h3> 
<p>使用pyqt设计我们界面的布局,新建<strong>布局代码mainwindow_ui .py</strong>。pyqt原始提供的组件并不美观，为了美化组件可以使用qt_material。其安装和使用都比较简单。<br> 安装</p> 
<pre><code class="prism language-shell">pip <span class="token function">install</span> qt_material
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>

<span class="token comment"># Form implementation generated from reading ui file 'mainwindow_ui.ui'</span>
<span class="token comment">#</span>
<span class="token comment"># Created by: PyQt5 UI code generator 5.15.7</span>
<span class="token comment">#</span>
<span class="token comment"># WARNING: Any manual changes made to this file will be lost when pyuic5 is</span>
<span class="token comment"># run again.  Do not edit this file unless you know what you are doing.</span>


<span class="token keyword">from</span> PyQt5 <span class="token keyword">import</span> QtCore<span class="token punctuation">,</span> QtGui<span class="token punctuation">,</span> QtWidgets


<span class="token keyword">class</span> <span class="token class-name">Ui_MainWindow</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">setupUi</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> MainWindow<span class="token punctuation">)</span><span class="token punctuation">:</span>
        MainWindow<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"目标检测"</span><span class="token punctuation">)</span>
        MainWindow<span class="token punctuation">.</span>resize<span class="token punctuation">(</span><span class="token number">1367</span><span class="token punctuation">,</span> <span class="token number">850</span><span class="token punctuation">)</span>
        font <span class="token operator">=</span> QtGui<span class="token punctuation">.</span>QFont<span class="token punctuation">(</span><span class="token punctuation">)</span>
        font<span class="token punctuation">.</span>setFamily<span class="token punctuation">(</span><span class="token string">"Adobe 宋体 Std L"</span><span class="token punctuation">)</span>
        MainWindow<span class="token punctuation">.</span>setFont<span class="token punctuation">(</span>font<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>centralwidget <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QWidget<span class="token punctuation">(</span>MainWindow<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>centralwidget<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"centralwidget"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>groupBox <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QGroupBox<span class="token punctuation">(</span>self<span class="token punctuation">.</span>centralwidget<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>groupBox<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">141</span><span class="token punctuation">,</span> <span class="token number">771</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        font <span class="token operator">=</span> QtGui<span class="token punctuation">.</span>QFont<span class="token punctuation">(</span><span class="token punctuation">)</span>
        font<span class="token punctuation">.</span>setFamily<span class="token punctuation">(</span><span class="token string">"Adobe 黑体 Std R"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>groupBox<span class="token punctuation">.</span>setFont<span class="token punctuation">(</span>font<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>groupBox<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"groupBox"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>btn_loadweight <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QPushButton<span class="token punctuation">(</span>self<span class="token punctuation">.</span>groupBox<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>btn_loadweight<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>btn_loadweight<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"btn_loadweight"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>btn_loadimg <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QPushButton<span class="token punctuation">(</span>self<span class="token punctuation">.</span>groupBox<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>btn_loadimg<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>btn_loadimg<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"btn_loadimg"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>btn_loadvideo <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QPushButton<span class="token punctuation">(</span>self<span class="token punctuation">.</span>groupBox<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>btn_loadvideo<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>btn_loadvideo<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"btn_loadvideo"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>btn_opencamera <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QPushButton<span class="token punctuation">(</span>self<span class="token punctuation">.</span>groupBox<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>btn_opencamera<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">140</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>btn_opencamera<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"btn_opencamera"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>btn_stop <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QPushButton<span class="token punctuation">(</span>self<span class="token punctuation">.</span>groupBox<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>btn_stop<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>btn_stop<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"btn_going"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>btn_over <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QPushButton<span class="token punctuation">(</span>self<span class="token punctuation">.</span>groupBox<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>btn_over<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">540</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>btn_over<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"btn_stop"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>fps_label <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QLabel<span class="token punctuation">(</span>self<span class="token punctuation">.</span>groupBox<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>fps_label<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">630</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>fps_label<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"fps_label"</span><span class="token punctuation">)</span>
        font<span class="token punctuation">.</span>setPointSize<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span>
        <span class="token comment"># font.setFamily("Adobe Devanagari")</span>
        self<span class="token punctuation">.</span>fps_label<span class="token punctuation">.</span>setFont<span class="token punctuation">(</span>font<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>btn_takephoto <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QPushButton<span class="token punctuation">(</span>self<span class="token punctuation">.</span>groupBox<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>btn_takephoto<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">380</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>btn_takephoto<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"btn_takephoto"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>btn_clear <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QPushButton<span class="token punctuation">(</span>self<span class="token punctuation">.</span>groupBox<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>btn_clear<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">460</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>btn_clear<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"btn_clear"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>btn_labelimg <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QPushButton<span class="token punctuation">(</span>self<span class="token punctuation">.</span>groupBox<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>btn_labelimg<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">420</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>btn_labelimg<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"btn_labelimg"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>btn_closecamera <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QPushButton<span class="token punctuation">(</span>self<span class="token punctuation">.</span>groupBox<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>btn_closecamera<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">220</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>btn_closecamera<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"btn_closecamera"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>layoutWidget <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QWidget<span class="token punctuation">(</span>self<span class="token punctuation">.</span>groupBox<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>layoutWidget<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>layoutWidget<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"layoutWidget"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>horizontalLayout_2 <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QHBoxLayout<span class="token punctuation">(</span>self<span class="token punctuation">.</span>layoutWidget<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>horizontalLayout_2<span class="token punctuation">.</span>setContentsMargins<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>horizontalLayout_2<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"horizontalLayout_2"</span><span class="token punctuation">)</span>
        <span class="token comment"># self.label_2 = QtWidgets.QLabel(self.layoutWidget)</span>
        <span class="token comment"># self.label_2.setObjectName("label_2")</span>
        <span class="token comment"># self.horizontalLayout_2.addWidget(self.label_2)</span>
        <span class="token comment"># self.confSpinBox = QtWidgets.QDoubleSpinBox(self.layoutWidget)</span>
        <span class="token comment"># self.confSpinBox.setObjectName("confSpinBox")</span>
        <span class="token comment"># self.horizontalLayout_2.addWidget(self.confSpinBox)</span>
        self<span class="token punctuation">.</span>layoutWidget_2 <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QWidget<span class="token punctuation">(</span>self<span class="token punctuation">.</span>groupBox<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>layoutWidget_2<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">340</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>layoutWidget_2<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"layoutWidget_2"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>horizontalLayout_3 <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QHBoxLayout<span class="token punctuation">(</span>self<span class="token punctuation">.</span>layoutWidget_2<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>horizontalLayout_3<span class="token punctuation">.</span>setContentsMargins<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>horizontalLayout_3<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"horizontalLayout_3"</span><span class="token punctuation">)</span>
        <span class="token comment"># self.label_3 = QtWidgets.QLabel(self.layoutWidget_2)</span>
        <span class="token comment"># self.label_3.setObjectName("label_3")</span>
        <span class="token comment"># self.horizontalLayout_3.addWidget(self.label_3)</span>
        <span class="token comment"># self.latencySpinBox = QtWidgets.QDoubleSpinBox(self.layoutWidget_2)</span>
        <span class="token comment"># self.latencySpinBox.setObjectName("latencySpinBox")</span>
        <span class="token comment"># self.horizontalLayout_3.addWidget(self.latencySpinBox)</span>
        self<span class="token punctuation">.</span>layoutWidget1 <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QWidget<span class="token punctuation">(</span>self<span class="token punctuation">.</span>groupBox<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>layoutWidget1<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">260</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>layoutWidget1<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"layoutWidget1"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>horizontalLayout <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QHBoxLayout<span class="token punctuation">(</span>self<span class="token punctuation">.</span>layoutWidget1<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>horizontalLayout<span class="token punctuation">.</span>setContentsMargins<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>horizontalLayout<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"horizontalLayout"</span><span class="token punctuation">)</span>
        <span class="token comment"># self.label = QtWidgets.QLabel(self.layoutWidget1)</span>
        <span class="token comment"># self.label.setObjectName("label")</span>
        <span class="token comment"># self.horizontalLayout.addWidget(self.label)</span>
        <span class="token comment"># self.iouSpinBox = QtWidgets.QDoubleSpinBox(self.layoutWidget1)</span>
        <span class="token comment"># self.iouSpinBox.setObjectName("iouSpinBox")</span>
        <span class="token comment"># self.horizontalLayout.addWidget(self.iouSpinBox)</span>
        self<span class="token punctuation">.</span>btn_camera_detect <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QPushButton<span class="token punctuation">(</span>self<span class="token punctuation">.</span>groupBox<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>btn_camera_detect<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>btn_camera_detect<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"btn_camera_detect"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>groupBox_2 <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QGroupBox<span class="token punctuation">(</span>self<span class="token punctuation">.</span>centralwidget<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>groupBox_2<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">170</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">1181</span><span class="token punctuation">,</span> <span class="token number">591</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>groupBox_2<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"groupBox_2"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label_origin <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QLabel<span class="token punctuation">(</span>self<span class="token punctuation">.</span>groupBox_2<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label_origin<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">571</span><span class="token punctuation">,</span> <span class="token number">551</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        font <span class="token operator">=</span> QtGui<span class="token punctuation">.</span>QFont<span class="token punctuation">(</span><span class="token punctuation">)</span>
        font<span class="token punctuation">.</span>setPointSize<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label_origin<span class="token punctuation">.</span>setFont<span class="token punctuation">(</span>font<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label_origin<span class="token punctuation">.</span>setStyleSheet<span class="token punctuation">(</span><span class="token string">"background-color: rgb(85, 170, 255);"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label_origin<span class="token punctuation">.</span>setAlignment<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>Qt<span class="token punctuation">.</span>AlignCenter<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label_origin<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"label_origin"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label_detect <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QLabel<span class="token punctuation">(</span>self<span class="token punctuation">.</span>groupBox_2<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label_detect<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">600</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">571</span><span class="token punctuation">,</span> <span class="token number">551</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        font <span class="token operator">=</span> QtGui<span class="token punctuation">.</span>QFont<span class="token punctuation">(</span><span class="token punctuation">)</span>
        font<span class="token punctuation">.</span>setPointSize<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label_detect<span class="token punctuation">.</span>setFont<span class="token punctuation">(</span>font<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label_detect<span class="token punctuation">.</span>setStyleSheet<span class="token punctuation">(</span><span class="token string">"background-color: rgb(170, 255, 127);"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label_detect<span class="token punctuation">.</span>setAlignment<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>Qt<span class="token punctuation">.</span>AlignCenter<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label_detect<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"label_detect"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label_mian_titlle <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QLabel<span class="token punctuation">(</span>self<span class="token punctuation">.</span>centralwidget<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label_mian_titlle<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">530</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">281</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        font <span class="token operator">=</span> QtGui<span class="token punctuation">.</span>QFont<span class="token punctuation">(</span><span class="token punctuation">)</span>
        font<span class="token punctuation">.</span>setFamily<span class="token punctuation">(</span><span class="token string">"Adobe Devanagari"</span><span class="token punctuation">)</span>
        font<span class="token punctuation">.</span>setPointSize<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label_mian_titlle<span class="token punctuation">.</span>setFont<span class="token punctuation">(</span>font<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label_mian_titlle<span class="token punctuation">.</span>setLayoutDirection<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>Qt<span class="token punctuation">.</span>LeftToRight<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label_mian_titlle<span class="token punctuation">.</span>setAlignment<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>Qt<span class="token punctuation">.</span>AlignCenter<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label_mian_titlle<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"label_mian_titlle"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>lcdNumber <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QLCDNumber<span class="token punctuation">(</span>self<span class="token punctuation">.</span>centralwidget<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>lcdNumber<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">1050</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">301</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        font <span class="token operator">=</span> QtGui<span class="token punctuation">.</span>QFont<span class="token punctuation">(</span><span class="token punctuation">)</span>
        font<span class="token punctuation">.</span>setFamily<span class="token punctuation">(</span><span class="token string">"Adobe 黑体 Std R"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>lcdNumber<span class="token punctuation">.</span>setFont<span class="token punctuation">(</span>font<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>lcdNumber<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"lcdNumber"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>lcdNumber<span class="token punctuation">.</span>setDigitCount<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>groupBox_3 <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QGroupBox<span class="token punctuation">(</span>self<span class="token punctuation">.</span>centralwidget<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>groupBox_3<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">170</span><span class="token punctuation">,</span> <span class="token number">650</span><span class="token punctuation">,</span> <span class="token number">581</span><span class="token punctuation">,</span> <span class="token number">171</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>groupBox_3<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"groupBox_3"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>textBrowser_print <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QTextBrowser<span class="token punctuation">(</span>self<span class="token punctuation">.</span>groupBox_3<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>textBrowser_print<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">561</span><span class="token punctuation">,</span> <span class="token number">141</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>textBrowser_print<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"textBrowser_print"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>groupBox_4 <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QGroupBox<span class="token punctuation">(</span>self<span class="token punctuation">.</span>centralwidget<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>groupBox_4<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">770</span><span class="token punctuation">,</span> <span class="token number">650</span><span class="token punctuation">,</span> <span class="token number">581</span><span class="token punctuation">,</span> <span class="token number">171</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>groupBox_4<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"groupBox_4"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>textBrowser_detect <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QTextBrowser<span class="token punctuation">(</span>self<span class="token punctuation">.</span>groupBox_4<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>textBrowser_detect<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">561</span><span class="token punctuation">,</span> <span class="token number">141</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>textBrowser_detect<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"textBrowser_detect"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label_author <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QLabel<span class="token punctuation">(</span>self<span class="token punctuation">.</span>centralwidget<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label_author<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        font <span class="token operator">=</span> QtGui<span class="token punctuation">.</span>QFont<span class="token punctuation">(</span><span class="token punctuation">)</span>
        font<span class="token punctuation">.</span>setFamily<span class="token punctuation">(</span><span class="token string">"Adobe 黑体 Std R"</span><span class="token punctuation">)</span>
        font<span class="token punctuation">.</span>setPointSize<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label_author<span class="token punctuation">.</span>setFont<span class="token punctuation">(</span>font<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label_author<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"label_author"</span><span class="token punctuation">)</span>
        MainWindow<span class="token punctuation">.</span>setCentralWidget<span class="token punctuation">(</span>self<span class="token punctuation">.</span>centralwidget<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>menubar <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QMenuBar<span class="token punctuation">(</span>MainWindow<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>menubar<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1367</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>menubar<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"menubar"</span><span class="token punctuation">)</span>
        MainWindow<span class="token punctuation">.</span>setMenuBar<span class="token punctuation">(</span>self<span class="token punctuation">.</span>menubar<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>statusbar <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QStatusBar<span class="token punctuation">(</span>MainWindow<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>statusbar<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"statusbar"</span><span class="token punctuation">)</span>
        MainWindow<span class="token punctuation">.</span>setStatusBar<span class="token punctuation">(</span>self<span class="token punctuation">.</span>statusbar<span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>retranslateUi<span class="token punctuation">(</span>MainWindow<span class="token punctuation">)</span>
        QtCore<span class="token punctuation">.</span>QMetaObject<span class="token punctuation">.</span>connectSlotsByName<span class="token punctuation">(</span>MainWindow<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">retranslateUi</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> MainWindow<span class="token punctuation">)</span><span class="token punctuation">:</span>
        _translate <span class="token operator">=</span> QtCore<span class="token punctuation">.</span>QCoreApplication<span class="token punctuation">.</span>translate
        MainWindow<span class="token punctuation">.</span>setWindowTitle<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"MainWindow"</span><span class="token punctuation">,</span> <span class="token string">"MainWindow"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>groupBox<span class="token punctuation">.</span>setTitle<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"MainWindow"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>btn_loadweight<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"MainWindow"</span><span class="token punctuation">,</span> <span class="token string">"加载Weights"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>btn_loadimg<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"MainWindow"</span><span class="token punctuation">,</span> <span class="token string">"图片检测"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>btn_loadvideo<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"MainWindow"</span><span class="token punctuation">,</span> <span class="token string">"视频检测"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>btn_opencamera<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"MainWindow"</span><span class="token punctuation">,</span> <span class="token string">"打开摄像头"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>btn_over<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"MainWindow"</span><span class="token punctuation">,</span> <span class="token string">"结束"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>fps_label<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"MainWindow"</span><span class="token punctuation">,</span> <span class="token string">"帧率"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>btn_stop<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"MainWindow"</span><span class="token punctuation">,</span> <span class="token string">"暂停"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>btn_takephoto<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"MainWindow"</span><span class="token punctuation">,</span> <span class="token string">"拍照"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>btn_clear<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"MainWindow"</span><span class="token punctuation">,</span> <span class="token string">"清除输出"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>btn_labelimg<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"MainWindow"</span><span class="token punctuation">,</span> <span class="token string">"标注工具"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>btn_closecamera<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"MainWindow"</span><span class="token punctuation">,</span> <span class="token string">"关闭摄像头"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># self.label_2.setText(_translate("MainWindow", "conf："))</span>
        <span class="token comment"># self.label_3.setText(_translate("MainWindow", "latency："))</span>
        <span class="token comment"># self.label.setText(_translate("MainWindow", "IoU："))</span>
        self<span class="token punctuation">.</span>btn_camera_detect<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"MainWindow"</span><span class="token punctuation">,</span> <span class="token string">"摄像头检测"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>groupBox_2<span class="token punctuation">.</span>setTitle<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"MainWindow"</span><span class="token punctuation">,</span> <span class="token string">"显示区域"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label_origin<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"MainWindow"</span><span class="token punctuation">,</span> <span class="token string">"原图区域"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label_detect<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"MainWindow"</span><span class="token punctuation">,</span> <span class="token string">"检测区域"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label_mian_titlle<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"MainWindow"</span><span class="token punctuation">,</span> <span class="token string">"YoLo检测界面"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>groupBox_3<span class="token punctuation">.</span>setTitle<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"MainWindow"</span><span class="token punctuation">,</span> <span class="token string">"打印输出"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>groupBox_4<span class="token punctuation">.</span>setTitle<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"MainWindow"</span><span class="token punctuation">,</span> <span class="token string">"检测输出"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label_author<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"MainWindow"</span><span class="token punctuation">,</span> <span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="6__601"></a>6. 图片、视频、摄像头实时三个模块整合完整代码</h3> 
<p><strong>注意</strong>这个代码要放在yolov5项目代码中一起使用以及上一节的布局代码mainwindow_ui.py。yolov5代码的获取和配置在第2节YOLOV5有描述。yolov5代码获取链接<a href="https://github.com/ultralytics/yolov5/tree/v6.0">yolo</a>。单独运行这个是不行的。</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> argparse
<span class="token keyword">import</span> datetime
<span class="token keyword">import</span> os
<span class="token keyword">import</span> random
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> time

<span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> torch
<span class="token keyword">from</span> PyQt5 <span class="token keyword">import</span> QtWidgets<span class="token punctuation">,</span> QtGui<span class="token punctuation">,</span> QtCore
<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtCore <span class="token keyword">import</span> QTimer<span class="token punctuation">,</span> QDateTime<span class="token punctuation">,</span> QDate<span class="token punctuation">,</span> QTime<span class="token punctuation">,</span> QThread<span class="token punctuation">,</span> pyqtSignal
<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtGui <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtWidgets <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> torch<span class="token punctuation">.</span>backends <span class="token keyword">import</span> cudnn

<span class="token keyword">from</span> models<span class="token punctuation">.</span>experimental <span class="token keyword">import</span> attempt_load
<span class="token keyword">from</span>  mainwindow_ui <span class="token keyword">import</span> Ui_MainWindow
<span class="token comment"># from utils.datasets import letterbox</span>
<span class="token keyword">from</span> utils<span class="token punctuation">.</span>general <span class="token keyword">import</span> check_img_size<span class="token punctuation">,</span> non_max_suppression<span class="token punctuation">,</span> scale_coords
<span class="token comment"># from utils.plots import plot_one_box2</span>

<span class="token keyword">def</span> <span class="token function">letterbox</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> new_shape<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">640</span><span class="token punctuation">,</span> <span class="token number">640</span><span class="token punctuation">)</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">114</span><span class="token punctuation">,</span> <span class="token number">114</span><span class="token punctuation">,</span> <span class="token number">114</span><span class="token punctuation">)</span><span class="token punctuation">,</span> auto<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> scaleFill<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> scaleup<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Resize and pad image while meeting stride-multiple constraints</span>
    shape <span class="token operator">=</span> img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>  <span class="token comment"># current shape [height, width]</span>
    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>new_shape<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        new_shape <span class="token operator">=</span> <span class="token punctuation">(</span>new_shape<span class="token punctuation">,</span> new_shape<span class="token punctuation">)</span>

    <span class="token comment"># Scale ratio (new / old)</span>
    r <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>new_shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">/</span> shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> new_shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">/</span> shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> scaleup<span class="token punctuation">:</span>  <span class="token comment"># only scale down, do not scale up (for better test mAP)</span>
        r <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span>

    <span class="token comment"># Compute padding</span>
    ratio <span class="token operator">=</span> r<span class="token punctuation">,</span> r  <span class="token comment"># width, height ratios</span>
    new_unpad <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">round</span><span class="token punctuation">(</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> r<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">round</span><span class="token punctuation">(</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> r<span class="token punctuation">)</span><span class="token punctuation">)</span>
    dw<span class="token punctuation">,</span> dh <span class="token operator">=</span> new_shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> new_unpad<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> new_shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> new_unpad<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>  <span class="token comment"># wh padding</span>
    <span class="token keyword">if</span> auto<span class="token punctuation">:</span>  <span class="token comment"># minimum rectangle</span>
        dw<span class="token punctuation">,</span> dh <span class="token operator">=</span> np<span class="token punctuation">.</span>mod<span class="token punctuation">(</span>dw<span class="token punctuation">,</span> stride<span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>mod<span class="token punctuation">(</span>dh<span class="token punctuation">,</span> stride<span class="token punctuation">)</span>  <span class="token comment"># wh padding</span>
    <span class="token keyword">elif</span> scaleFill<span class="token punctuation">:</span>  <span class="token comment"># stretch</span>
        dw<span class="token punctuation">,</span> dh <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span>
        new_unpad <span class="token operator">=</span> <span class="token punctuation">(</span>new_shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> new_shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        ratio <span class="token operator">=</span> new_shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">/</span> shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> new_shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">/</span> shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  <span class="token comment"># width, height ratios</span>

    dw <span class="token operator">/=</span> <span class="token number">2</span>  <span class="token comment"># divide padding into 2 sides</span>
    dh <span class="token operator">/=</span> <span class="token number">2</span>

    <span class="token keyword">if</span> shape<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">!=</span> new_unpad<span class="token punctuation">:</span>  <span class="token comment"># resize</span>
        img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>img<span class="token punctuation">,</span> new_unpad<span class="token punctuation">,</span> interpolation<span class="token operator">=</span>cv2<span class="token punctuation">.</span>INTER_LINEAR<span class="token punctuation">)</span>
    top<span class="token punctuation">,</span> bottom <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">round</span><span class="token punctuation">(</span>dh <span class="token operator">-</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">round</span><span class="token punctuation">(</span>dh <span class="token operator">+</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    left<span class="token punctuation">,</span> right <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">round</span><span class="token punctuation">(</span>dw <span class="token operator">-</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">round</span><span class="token punctuation">(</span>dw <span class="token operator">+</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>copyMakeBorder<span class="token punctuation">(</span>img<span class="token punctuation">,</span> top<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>BORDER_CONSTANT<span class="token punctuation">,</span> value<span class="token operator">=</span>color<span class="token punctuation">)</span>  <span class="token comment"># add border</span>
    <span class="token keyword">return</span> img<span class="token punctuation">,</span> ratio<span class="token punctuation">,</span> <span class="token punctuation">(</span>dw<span class="token punctuation">,</span> dh<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">plot_one_box2</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> img<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> line_thickness<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Plots one bounding box on image img</span>
    tl <span class="token operator">=</span> line_thickness <span class="token keyword">or</span> <span class="token builtin">round</span><span class="token punctuation">(</span><span class="token number">0.002</span> <span class="token operator">*</span> <span class="token punctuation">(</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>  <span class="token comment"># line/font thickness</span>
    color <span class="token operator">=</span> color <span class="token keyword">or</span> <span class="token punctuation">[</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    c1<span class="token punctuation">,</span> c2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    cv2<span class="token punctuation">.</span>rectangle<span class="token punctuation">(</span>img<span class="token punctuation">,</span> c1<span class="token punctuation">,</span> c2<span class="token punctuation">,</span> color<span class="token punctuation">,</span> thickness<span class="token operator">=</span>tl<span class="token punctuation">,</span> lineType<span class="token operator">=</span>cv2<span class="token punctuation">.</span>LINE_AA<span class="token punctuation">)</span>
    <span class="token keyword">if</span> label<span class="token punctuation">:</span>
        tf <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>tl <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># font thickness</span>
        t_size <span class="token operator">=</span> cv2<span class="token punctuation">.</span>getTextSize<span class="token punctuation">(</span>label<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> fontScale<span class="token operator">=</span>tl <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">,</span> thickness<span class="token operator">=</span>tf<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        c2 <span class="token operator">=</span> c1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> t_size<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> c1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> t_size<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">3</span>
        cv2<span class="token punctuation">.</span>rectangle<span class="token punctuation">(</span>img<span class="token punctuation">,</span> c1<span class="token punctuation">,</span> c2<span class="token punctuation">,</span> color<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>LINE_AA<span class="token punctuation">)</span>  <span class="token comment"># filled</span>
        cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>img<span class="token punctuation">,</span> label<span class="token punctuation">,</span> <span class="token punctuation">(</span>c1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> c1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> tl <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">225</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">]</span><span class="token punctuation">,</span> thickness<span class="token operator">=</span>tf<span class="token punctuation">,</span> lineType<span class="token operator">=</span>cv2<span class="token punctuation">.</span>LINE_AA<span class="token punctuation">)</span>
    single_info <span class="token operator">=</span> <span class="token string">"Position: (%d, %d), (%d, %d), Obj and Confidence: %s"</span><span class="token operator">%</span><span class="token punctuation">(</span>c1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> c1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> c2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> c2<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> label<span class="token punctuation">)</span>
    <span class="token keyword">return</span> single_info
<span class="token keyword">class</span> <span class="token class-name">UI_Logic_Window</span><span class="token punctuation">(</span>QtWidgets<span class="token punctuation">.</span>QMainWindow<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> parent<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>UI_Logic_Window<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>parent<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>initUI<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 初始化界面</span>
    <span class="token keyword">def</span> <span class="token function">initUI</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>setWindowIcon<span class="token punctuation">(</span>QIcon<span class="token punctuation">(</span><span class="token string">"./icon/yolo.png"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># 创建一个窗口对象</span>
        self<span class="token punctuation">.</span>ui <span class="token operator">=</span> Ui_MainWindow<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>setupUi<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>timer_video <span class="token operator">=</span> QtCore<span class="token punctuation">.</span>QTimer<span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token comment"># 创建定时器</span>
        self<span class="token punctuation">.</span>timer_photo <span class="token operator">=</span> QtCore<span class="token punctuation">.</span>QTimer<span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token comment"># 创建定时器</span>
        self<span class="token punctuation">.</span>output_folder <span class="token operator">=</span> <span class="token string">'output/'</span>
        self<span class="token punctuation">.</span>cap <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>vid_writer <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>camera_detect <span class="token operator">=</span> <span class="token boolean">False</span>
        self<span class="token punctuation">.</span>num_stop <span class="token operator">=</span> <span class="token number">1</span>  <span class="token comment"># 暂停与播放辅助信号，note：通过奇偶来控制暂停与播放</span>
        self<span class="token punctuation">.</span>openfile_name_model <span class="token operator">=</span> <span class="token boolean">None</span>        <span class="token comment"># 权重初始文件名</span>
        self<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">0</span>
        self<span class="token punctuation">.</span>start_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment"># 打开线程</span>
        self<span class="token punctuation">.</span>stop_going <span class="token operator">=</span> <span class="token number">0</span>



        <span class="token comment"># 刷新lcd时间</span>
        self<span class="token punctuation">.</span>lcd_time <span class="token operator">=</span> QTimer<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>lcd_time<span class="token punctuation">.</span>setInterval<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>lcd_time<span class="token punctuation">.</span>timeout<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>refresh<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>lcd_time<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>textBrowser_print<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"特别说明：如需启动检测，请先加载weights文件！！！"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>init_slots<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 刷新时间</span>
    <span class="token keyword">def</span> <span class="token function">refresh</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        now_time <span class="token operator">=</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">"%Y-%m-%d %H:%M:%S"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>lcdNumber<span class="token punctuation">.</span>display<span class="token punctuation">(</span>now_time<span class="token punctuation">)</span>

    <span class="token comment"># 初始化槽函数</span>
    <span class="token keyword">def</span> <span class="token function">init_slots</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>btn_loadweight<span class="token punctuation">.</span>clicked<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>load_model<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>btn_loadimg<span class="token punctuation">.</span>clicked<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>button_image_open<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>btn_loadvideo<span class="token punctuation">.</span>clicked<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>button_video_open<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>btn_opencamera<span class="token punctuation">.</span>clicked<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>button_camera_open<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>btn_camera_detect<span class="token punctuation">.</span>clicked<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>button_camera_detect<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>btn_stop<span class="token punctuation">.</span>clicked<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>button_stop<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>btn_over<span class="token punctuation">.</span>clicked<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>button_over<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>btn_closecamera<span class="token punctuation">.</span>clicked<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>button_closecamera<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>btn_clear<span class="token punctuation">.</span>clicked<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>button_clear<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>btn_takephoto<span class="token punctuation">.</span>clicked<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>button_takephoto<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>btn_labelimg<span class="token punctuation">.</span>clicked<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>button_labelimg<span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>timer_video<span class="token punctuation">.</span>timeout<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>show_video_frame<span class="token punctuation">)</span>  <span class="token comment"># 定时器超时，将槽绑定至show_video_frame</span>
        self<span class="token punctuation">.</span>timer_photo<span class="token punctuation">.</span>timeout<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>show_image<span class="token punctuation">)</span>  <span class="token comment"># 定时器超时，将槽绑定至show_video_frame</span>


    <span class="token comment"># 加载模型</span>
    <span class="token keyword">def</span> <span class="token function">load_model</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>openfile_name_model<span class="token punctuation">,</span> _ <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QFileDialog<span class="token punctuation">.</span>getOpenFileName<span class="token punctuation">(</span>self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>btn_loadweight<span class="token punctuation">,</span> <span class="token string">'选择weights文件'</span><span class="token punctuation">,</span>
                                                                  <span class="token string">'weights/'</span><span class="token punctuation">,</span> <span class="token string">"*.pt;;*.pth"</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>openfile_name_model<span class="token punctuation">:</span>
            QtWidgets<span class="token punctuation">.</span>QMessageBox<span class="token punctuation">.</span>warning<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">u"Warning"</span><span class="token punctuation">,</span> <span class="token string">u"打开权重失败"</span><span class="token punctuation">,</span> buttons<span class="token operator">=</span>QtWidgets<span class="token punctuation">.</span>QMessageBox<span class="token punctuation">.</span>Ok<span class="token punctuation">,</span>
                                          defaultButton<span class="token operator">=</span>QtWidgets<span class="token punctuation">.</span>QMessageBox<span class="token punctuation">.</span>Ok<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>textBrowser_print<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"打开权重失败"</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>textBrowser_print<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"加载weights文件地址为："</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>openfile_name_model<span class="token punctuation">)</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>model_init<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#初始化权重</span>

    <span class="token comment"># 初始化权重</span>
    <span class="token keyword">def</span> <span class="token function">model_init</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 模型相关参数配置</span>
        parser <span class="token operator">=</span> argparse<span class="token punctuation">.</span>ArgumentParser<span class="token punctuation">(</span><span class="token punctuation">)</span>
        parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--weights'</span><span class="token punctuation">,</span> nargs<span class="token operator">=</span><span class="token string">'+'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">'weights/yolov5s6.pt'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'model.pt path(s)'</span><span class="token punctuation">)</span>
        parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--source'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">'data/images'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'source'</span><span class="token punctuation">)</span>  <span class="token comment"># file/folder, 0 for webcam</span>
        parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--img-size'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">640</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'inference size (pixels)'</span><span class="token punctuation">)</span>
        parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--conf-thres'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">float</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">0.25</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'object confidence threshold'</span><span class="token punctuation">)</span>
        parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--iou-thres'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">float</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">0.45</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'IOU threshold for NMS'</span><span class="token punctuation">)</span>
        parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--device'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">'cuda'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'cuda device, i.e. 0 or 0,1,2,3 or cpu'</span><span class="token punctuation">)</span>
        parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--view-img'</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'store_true'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'display results'</span><span class="token punctuation">)</span>
        parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--save-txt'</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'store_true'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'save results to *.txt'</span><span class="token punctuation">)</span>
        parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--save-conf'</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'store_true'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'save confidences in --save-txt labels'</span><span class="token punctuation">)</span>
        parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--nosave'</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'store_true'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'do not save images/videos'</span><span class="token punctuation">)</span>
        parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--classes'</span><span class="token punctuation">,</span> nargs<span class="token operator">=</span><span class="token string">'+'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'filter by class: --class 0, or --class 0 2 3'</span><span class="token punctuation">)</span>
        parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--agnostic-nms'</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'store_true'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'class-agnostic NMS'</span><span class="token punctuation">)</span>
        parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--augment'</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'store_true'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'augmented inference'</span><span class="token punctuation">)</span>
        parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--update'</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'store_true'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'update all models'</span><span class="token punctuation">)</span>
        parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--project'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">'runs/detect'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'save results to project/name'</span><span class="token punctuation">)</span>
        parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--name'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">'exp'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'save results to project/name'</span><span class="token punctuation">)</span>
        parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--exist-ok'</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'store_true'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'existing project/name ok, do not increment'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>opt <span class="token operator">=</span> parser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>opt<span class="token punctuation">)</span>
        <span class="token comment"># 默认使用opt中的设置（权重等）来对模型进行初始化</span>
        source<span class="token punctuation">,</span> weights<span class="token punctuation">,</span> view_img<span class="token punctuation">,</span> save_txt<span class="token punctuation">,</span> imgsz <span class="token operator">=</span> self<span class="token punctuation">.</span>opt<span class="token punctuation">.</span>source<span class="token punctuation">,</span> self<span class="token punctuation">.</span>opt<span class="token punctuation">.</span>weights<span class="token punctuation">,</span> self<span class="token punctuation">.</span>opt<span class="token punctuation">.</span>view_img<span class="token punctuation">,</span> self<span class="token punctuation">.</span>opt<span class="token punctuation">.</span>save_txt<span class="token punctuation">,</span> self<span class="token punctuation">.</span>opt<span class="token punctuation">.</span>img_size
        <span class="token comment"># 改变权重文件</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>openfile_name_model<span class="token punctuation">:</span>
            weights <span class="token operator">=</span> self<span class="token punctuation">.</span>openfile_name_model
            <span class="token keyword">print</span><span class="token punctuation">(</span>weights<span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>device <span class="token operator">=</span> torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string">"cuda"</span> <span class="token keyword">if</span> torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>is_available<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token string">"cpu"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>half <span class="token operator">=</span> self<span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">!=</span> <span class="token string">'cpu'</span>  <span class="token comment"># half precision only supported on CUDA</span>

        cudnn<span class="token punctuation">.</span>benchmark <span class="token operator">=</span> <span class="token boolean">True</span>

        <span class="token comment"># Load model</span>
        self<span class="token punctuation">.</span>model <span class="token operator">=</span> attempt_load<span class="token punctuation">(</span>weights<span class="token punctuation">,</span> map_location<span class="token operator">=</span>self<span class="token punctuation">.</span>device<span class="token punctuation">)</span>  <span class="token comment"># load FP32 model</span>
        stride <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>stride<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># model stride</span>
        self<span class="token punctuation">.</span>imgsz <span class="token operator">=</span> check_img_size<span class="token punctuation">(</span>imgsz<span class="token punctuation">,</span> s<span class="token operator">=</span>stride<span class="token punctuation">)</span>  <span class="token comment"># check img_size</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>half<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>half<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># to FP16</span>

        <span class="token comment">#  Second-stage classifier</span>

        <span class="token comment"># Get names and colors</span>
        self<span class="token punctuation">.</span>names <span class="token operator">=</span> self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>module<span class="token punctuation">.</span>names <span class="token keyword">if</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>model<span class="token punctuation">,</span> <span class="token string">'module'</span><span class="token punctuation">)</span> <span class="token keyword">else</span> self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>names
        self<span class="token punctuation">.</span>colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> self<span class="token punctuation">.</span>names<span class="token punctuation">]</span>
        <span class="token comment"># 设置提示框</span>
        QtWidgets<span class="token punctuation">.</span>QMessageBox<span class="token punctuation">.</span>information<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">u"Notice"</span><span class="token punctuation">,</span> <span class="token string">u"模型加载完成"</span><span class="token punctuation">,</span> buttons<span class="token operator">=</span>QtWidgets<span class="token punctuation">.</span>QMessageBox<span class="token punctuation">.</span>Ok<span class="token punctuation">,</span>
                                          defaultButton<span class="token operator">=</span>QtWidgets<span class="token punctuation">.</span>QMessageBox<span class="token punctuation">.</span>Ok<span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>textBrowser_print<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"模型加载完成"</span><span class="token punctuation">)</span>

    <span class="token comment"># 打开图片</span>
    <span class="token keyword">def</span> <span class="token function">button_image_open</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># 打印信息显示在界面</span>
            name_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                img_name<span class="token punctuation">,</span> _ <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QFileDialog<span class="token punctuation">.</span>getOpenFileName<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">"打开图片"</span><span class="token punctuation">,</span> <span class="token string">"data/images"</span><span class="token punctuation">,</span> <span class="token string">"*.jpg;;*.png;;All Files(*)"</span><span class="token punctuation">)</span>
            <span class="token keyword">except</span> OSError <span class="token keyword">as</span> reason<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'文件打开出错啦！核对路径是否正确'</span><span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>textBrowser_print<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"文件打开出错啦！核对路径是否正确"</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token comment"># 判断图片是否为空</span>
                <span class="token keyword">if</span> <span class="token keyword">not</span> img_name<span class="token punctuation">:</span>
                    QtWidgets<span class="token punctuation">.</span>QMessageBox<span class="token punctuation">.</span>warning<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">u"Warning"</span><span class="token punctuation">,</span> <span class="token string">u"打开图片失败"</span><span class="token punctuation">,</span> buttons<span class="token operator">=</span>QtWidgets<span class="token punctuation">.</span>QMessageBox<span class="token punctuation">.</span>Ok<span class="token punctuation">,</span>
                                                  defaultButton<span class="token operator">=</span>QtWidgets<span class="token punctuation">.</span>QMessageBox<span class="token punctuation">.</span>Ok<span class="token punctuation">)</span>
                    self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>textBrowser_print<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"打开图片失败"</span><span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>textBrowser_print<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"打开图片成功"</span><span class="token punctuation">)</span>
                    img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>img_name<span class="token punctuation">)</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"img_name:"</span><span class="token punctuation">,</span> img_name<span class="token punctuation">)</span>
                    self<span class="token punctuation">.</span>origin <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2BGRA<span class="token punctuation">)</span>
                    self<span class="token punctuation">.</span>origin <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>self<span class="token punctuation">.</span>origin<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">640</span><span class="token punctuation">,</span> <span class="token number">480</span><span class="token punctuation">)</span><span class="token punctuation">,</span> interpolation<span class="token operator">=</span>cv2<span class="token punctuation">.</span>INTER_AREA<span class="token punctuation">)</span>
                    self<span class="token punctuation">.</span>QtImg_origin <span class="token operator">=</span> QtGui<span class="token punctuation">.</span>QImage<span class="token punctuation">(</span>self<span class="token punctuation">.</span>origin<span class="token punctuation">.</span>data<span class="token punctuation">,</span> self<span class="token punctuation">.</span>origin<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>origin<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                              QtGui<span class="token punctuation">.</span>QImage<span class="token punctuation">.</span>Format_RGB32<span class="token punctuation">)</span>
                    self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>label_origin<span class="token punctuation">.</span>setPixmap<span class="token punctuation">(</span>QtGui<span class="token punctuation">.</span>QPixmap<span class="token punctuation">.</span>fromImage<span class="token punctuation">(</span>self<span class="token punctuation">.</span>QtImg_origin<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>label_origin<span class="token punctuation">.</span>setScaledContents<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token comment"># 设置图像自适应界面大小</span>

                    info_show <span class="token operator">=</span> self<span class="token punctuation">.</span>detect<span class="token punctuation">(</span>name_list<span class="token punctuation">,</span> img<span class="token punctuation">)</span>
                    <span class="token comment"># print(info_show)</span>
                    <span class="token comment"># 获取当前系统时间，作为img文件名</span>
                    now <span class="token operator">=</span> time<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">"%Y-%m-%d-%H-%M-%S"</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span>localtime<span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    file_extension <span class="token operator">=</span> img_name<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
                    new_filename <span class="token operator">=</span> now <span class="token operator">+</span> <span class="token string">'.'</span> <span class="token operator">+</span> file_extension  <span class="token comment"># 获得文件后缀名</span>
                    file_path <span class="token operator">=</span> self<span class="token punctuation">.</span>output_folder <span class="token operator">+</span> <span class="token string">'img_output/'</span> <span class="token operator">+</span> new_filename
                    cv2<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> img<span class="token punctuation">)</span>
                    <span class="token comment"># 检测信息显示在界面</span>
                    self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>textBrowser_detect<span class="token punctuation">.</span>append<span class="token punctuation">(</span>info_show<span class="token punctuation">)</span>

                    <span class="token comment"># 检测结果显示在界面</span>
                    self<span class="token punctuation">.</span>result <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2BGRA<span class="token punctuation">)</span>
                    self<span class="token punctuation">.</span>result <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>self<span class="token punctuation">.</span>result<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">640</span><span class="token punctuation">,</span> <span class="token number">480</span><span class="token punctuation">)</span><span class="token punctuation">,</span> interpolation<span class="token operator">=</span>cv2<span class="token punctuation">.</span>INTER_AREA<span class="token punctuation">)</span>
                    self<span class="token punctuation">.</span>QtImg <span class="token operator">=</span> QtGui<span class="token punctuation">.</span>QImage<span class="token punctuation">(</span>self<span class="token punctuation">.</span>result<span class="token punctuation">.</span>data<span class="token punctuation">,</span> self<span class="token punctuation">.</span>result<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>result<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                              QtGui<span class="token punctuation">.</span>QImage<span class="token punctuation">.</span>Format_RGB32<span class="token punctuation">)</span>
                    self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>label_detect<span class="token punctuation">.</span>setPixmap<span class="token punctuation">(</span>QtGui<span class="token punctuation">.</span>QPixmap<span class="token punctuation">.</span>fromImage<span class="token punctuation">(</span>self<span class="token punctuation">.</span>QtImg<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>label_detect<span class="token punctuation">.</span>setScaledContents<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token comment"># 设置图像自适应界面大小</span>

    <span class="token comment"># 目标检测</span>
    <span class="token keyword">def</span> <span class="token function">detect</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name_list<span class="token punctuation">,</span> img<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">'''
           :param name_list: 文件名列表
           :param img: 待检测图片
           :return: info_show:检测输出的文字信息
        '''</span>
        showimg <span class="token operator">=</span> img
        <span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            img <span class="token operator">=</span> letterbox<span class="token punctuation">(</span>img<span class="token punctuation">,</span> new_shape<span class="token operator">=</span>self<span class="token punctuation">.</span>opt<span class="token punctuation">.</span>img_size<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            <span class="token comment"># Convert</span>
            img <span class="token operator">=</span> img<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># BGR to RGB, to 3x416x416</span>
            img <span class="token operator">=</span> np<span class="token punctuation">.</span>ascontiguousarray<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
            img <span class="token operator">=</span> torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>self<span class="token punctuation">.</span>device<span class="token punctuation">)</span>
            img <span class="token operator">=</span> img<span class="token punctuation">.</span>half<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> self<span class="token punctuation">.</span>half <span class="token keyword">else</span> img<span class="token punctuation">.</span><span class="token builtin">float</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># uint8 to fp16/32</span>
            img <span class="token operator">/=</span> <span class="token number">255.0</span>  <span class="token comment"># 0 - 255 to 0.0 - 1.0</span>
            <span class="token keyword">if</span> img<span class="token punctuation">.</span>ndimension<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">:</span>
                img <span class="token operator">=</span> img<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token comment"># Inference</span>
            pred <span class="token operator">=</span> self<span class="token punctuation">.</span>model<span class="token punctuation">(</span>img<span class="token punctuation">,</span> augment<span class="token operator">=</span>self<span class="token punctuation">.</span>opt<span class="token punctuation">.</span>augment<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            <span class="token comment"># Apply NMS</span>
            pred <span class="token operator">=</span> non_max_suppression<span class="token punctuation">(</span>pred<span class="token punctuation">,</span> self<span class="token punctuation">.</span>opt<span class="token punctuation">.</span>conf_thres<span class="token punctuation">,</span> self<span class="token punctuation">.</span>opt<span class="token punctuation">.</span>iou_thres<span class="token punctuation">,</span> classes<span class="token operator">=</span>self<span class="token punctuation">.</span>opt<span class="token punctuation">.</span>classes<span class="token punctuation">,</span>
                                       agnostic<span class="token operator">=</span>self<span class="token punctuation">.</span>opt<span class="token punctuation">.</span>agnostic_nms<span class="token punctuation">)</span>
            info_show <span class="token operator">=</span> <span class="token string">""</span>
            <span class="token comment"># Process detections</span>
            <span class="token keyword">for</span> i<span class="token punctuation">,</span> det <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>pred<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> det <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span> <span class="token keyword">and</span> <span class="token builtin">len</span><span class="token punctuation">(</span>det<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token comment"># Rescale boxes from img_size to im0 size</span>
                    det<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> scale_coords<span class="token punctuation">(</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> det<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> showimg<span class="token punctuation">.</span>shape<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">round</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token keyword">for</span> <span class="token operator">*</span>xyxy<span class="token punctuation">,</span> conf<span class="token punctuation">,</span> cls <span class="token keyword">in</span> <span class="token builtin">reversed</span><span class="token punctuation">(</span>det<span class="token punctuation">)</span><span class="token punctuation">:</span>
                        label <span class="token operator">=</span> <span class="token string">'%s %.2f'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>names<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>cls<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> conf<span class="token punctuation">)</span>
                        name_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">.</span>names<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>cls<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                        single_info <span class="token operator">=</span> plot_one_box2<span class="token punctuation">(</span>xyxy<span class="token punctuation">,</span> showimg<span class="token punctuation">,</span> label<span class="token operator">=</span>label<span class="token punctuation">,</span> color<span class="token operator">=</span>self<span class="token punctuation">.</span>colors<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>cls<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                                    line_thickness<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
                        info_show <span class="token operator">=</span> info_show <span class="token operator">+</span> single_info <span class="token operator">+</span> <span class="token string">"\n"</span>
        <span class="token keyword">return</span> info_show


    <span class="token comment"># 打开视频并检测</span>
    <span class="token keyword">def</span> <span class="token function">button_video_open</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        video_name<span class="token punctuation">,</span> _ <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QFileDialog<span class="token punctuation">.</span>getOpenFileName<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">"打开视频"</span><span class="token punctuation">,</span> <span class="token string">"data/video/"</span><span class="token punctuation">,</span> <span class="token string">"*.mp4;;*.avi;;All Files(*)"</span><span class="token punctuation">)</span>
        flag <span class="token operator">=</span> self<span class="token punctuation">.</span>cap<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>video_name<span class="token punctuation">)</span>

        <span class="token comment"># 判断摄像头是否打开</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> flag<span class="token punctuation">:</span>
            QtWidgets<span class="token punctuation">.</span>QMessageBox<span class="token punctuation">.</span>warning<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">u"Warning"</span><span class="token punctuation">,</span> <span class="token string">u"打开视频失败"</span><span class="token punctuation">,</span> buttons<span class="token operator">=</span>QtWidgets<span class="token punctuation">.</span>QMessageBox<span class="token punctuation">.</span>Ok<span class="token punctuation">,</span>defaultButton<span class="token operator">=</span>QtWidgets<span class="token punctuation">.</span>QMessageBox<span class="token punctuation">.</span>Ok<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment"># -------------------------写入视频----------------------------------#</span>
            self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>textBrowser_print<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"打开视频检测"</span><span class="token punctuation">)</span>
            fps<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h<span class="token punctuation">,</span> save_path <span class="token operator">=</span> self<span class="token punctuation">.</span>set_video_name_and_path<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>vid_writer <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoWriter<span class="token punctuation">(</span>save_path<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>VideoWriter_fourcc<span class="token punctuation">(</span><span class="token operator">*</span><span class="token string">'mp4v'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fps<span class="token punctuation">,</span> <span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">)</span>

            self<span class="token punctuation">.</span>timer_video<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span>  <span class="token comment"># 以30ms为间隔，启动或重启定时器</span>
            <span class="token comment"># 进行视频识别时，关闭其他按键点击功能</span>
            self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>btn_loadvideo<span class="token punctuation">.</span>setDisabled<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>btn_loadimg<span class="token punctuation">.</span>setDisabled<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>btn_opencamera<span class="token punctuation">.</span>setDisabled<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">set_video_name_and_path</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 获取当前系统时间，作为img和video的文件名</span>
        now <span class="token operator">=</span> time<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">"%Y-%m-%d-%H-%M-%S"</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span>localtime<span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># if vid_cap:  # video</span>
        fps <span class="token operator">=</span> self<span class="token punctuation">.</span>cap<span class="token punctuation">.</span>get<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>CAP_PROP_FPS<span class="token punctuation">)</span>
        w <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>cap<span class="token punctuation">.</span>get<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>CAP_PROP_FRAME_WIDTH<span class="token punctuation">)</span><span class="token punctuation">)</span>
        h <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>cap<span class="token punctuation">.</span>get<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>CAP_PROP_FRAME_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># 视频检测结果存储位置</span>
        save_path <span class="token operator">=</span> self<span class="token punctuation">.</span>output_folder <span class="token operator">+</span> <span class="token string">'video_output/'</span> <span class="token operator">+</span> now <span class="token operator">+</span> <span class="token string">'.mp4'</span>
        <span class="token keyword">return</span> fps<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h<span class="token punctuation">,</span> save_path

    <span class="token comment"># 定义视频帧显示操作</span>
    <span class="token keyword">def</span> <span class="token function">show_video_frame</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        name_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        flag<span class="token punctuation">,</span> img <span class="token operator">=</span> self<span class="token punctuation">.</span>cap<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># 显示视频数据的帧数</span>
        self<span class="token punctuation">.</span>count <span class="token operator">+=</span> <span class="token number">1</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>count <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">0</span>
            fps <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token number">30</span> <span class="token operator">/</span> <span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> self<span class="token punctuation">.</span>start_time<span class="token punctuation">)</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>fps_label<span class="token punctuation">.</span>setText<span class="token punctuation">(</span><span class="token string">'fps:'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>fps<span class="token punctuation">)</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>start_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> img <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token comment"># 原始数据的显示</span>
            self<span class="token punctuation">.</span>origin <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2BGRA<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>origin <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>self<span class="token punctuation">.</span>origin<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">640</span><span class="token punctuation">,</span> <span class="token number">480</span><span class="token punctuation">)</span><span class="token punctuation">,</span> interpolation<span class="token operator">=</span>cv2<span class="token punctuation">.</span>INTER_AREA<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>QtImg_origin <span class="token operator">=</span> QtGui<span class="token punctuation">.</span>QImage<span class="token punctuation">(</span>self<span class="token punctuation">.</span>origin<span class="token punctuation">.</span>data<span class="token punctuation">,</span> self<span class="token punctuation">.</span>origin<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>origin<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                             QtGui<span class="token punctuation">.</span>QImage<span class="token punctuation">.</span>Format_RGB32<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>label_origin<span class="token punctuation">.</span>setPixmap<span class="token punctuation">(</span>QtGui<span class="token punctuation">.</span>QPixmap<span class="token punctuation">.</span>fromImage<span class="token punctuation">(</span>self<span class="token punctuation">.</span>QtImg_origin<span class="token punctuation">)</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>label_origin<span class="token punctuation">.</span>setScaledContents<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token comment"># 设置图像自适应界面大小</span>

            <span class="token comment"># 检测数据的显示</span>
            info_show <span class="token operator">=</span> self<span class="token punctuation">.</span>detect<span class="token punctuation">(</span>name_list<span class="token punctuation">,</span> img<span class="token punctuation">)</span>  <span class="token comment"># 检测结果写入到原始img上</span>
            self<span class="token punctuation">.</span>vid_writer<span class="token punctuation">.</span>write<span class="token punctuation">(</span>img<span class="token punctuation">)</span>  <span class="token comment"># 检测结果写入视频</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>info_show<span class="token punctuation">)</span>
            <span class="token comment"># 检测信息显示在界面</span>
            self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>textBrowser_detect<span class="token punctuation">.</span>append<span class="token punctuation">(</span>info_show<span class="token punctuation">)</span>
            show <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">640</span><span class="token punctuation">,</span> <span class="token number">480</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 直接将原始img上的检测结果进行显示</span>
            self<span class="token punctuation">.</span>result <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>show<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span>
            showImage <span class="token operator">=</span> QtGui<span class="token punctuation">.</span>QImage<span class="token punctuation">(</span>self<span class="token punctuation">.</span>result<span class="token punctuation">.</span>data<span class="token punctuation">,</span> self<span class="token punctuation">.</span>result<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>result<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                     QtGui<span class="token punctuation">.</span>QImage<span class="token punctuation">.</span>Format_RGB888<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>label_detect<span class="token punctuation">.</span>setPixmap<span class="token punctuation">(</span>QtGui<span class="token punctuation">.</span>QPixmap<span class="token punctuation">.</span>fromImage<span class="token punctuation">(</span>showImage<span class="token punctuation">)</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>label_detect<span class="token punctuation">.</span>setScaledContents<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token comment"># 设置图像自适应界面大小</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>timer_video<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment"># 读写结束，释放资源</span>
            self<span class="token punctuation">.</span>cap<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 释放video_capture资源</span>
            self<span class="token punctuation">.</span>vid_writer<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 释放video_writer资源</span>
            self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>label<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment"># 视频帧显示期间，禁用其他检测按键功能</span>
            self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>btn_loadvideo<span class="token punctuation">.</span>setDisabled<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>btn_loadimg<span class="token punctuation">.</span>setDisabled<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>btn_opencamera<span class="token punctuation">.</span>setDisabled<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>

    <span class="token triple-quoted-string string">'''显示图片'''</span>
    <span class="token keyword">def</span> <span class="token function">show_image</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        flag<span class="token punctuation">,</span> self<span class="token punctuation">.</span>image <span class="token operator">=</span> self<span class="token punctuation">.</span>cap<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 从视频流中读取图片</span>
        image_show <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>self<span class="token punctuation">.</span>image<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">620</span><span class="token punctuation">,</span> <span class="token number">420</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 把读到的帧的大小重新设置为显示的窗口大小</span>
        width<span class="token punctuation">,</span> height <span class="token operator">=</span> image_show<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>  <span class="token comment"># 行:宽，列:高</span>
        image_show <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>image_show<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span>  <span class="token comment"># opencv读的通道是BGR,要转成RGB</span>
        image_show <span class="token operator">=</span> cv2<span class="token punctuation">.</span>flip<span class="token punctuation">(</span>image_show<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 水平翻转，因为摄像头拍的是镜像的。</span>
        <span class="token comment"># 把读取到的视频数据变成QImage形式(图片数据、高、宽、RGB颜色空间，三个通道各有2**8=256种颜色)</span>
        self<span class="token punctuation">.</span>photo<span class="token operator">=</span> QtGui<span class="token punctuation">.</span>QImage<span class="token punctuation">(</span>image_show<span class="token punctuation">.</span>data<span class="token punctuation">,</span> height<span class="token punctuation">,</span> width<span class="token punctuation">,</span> QImage<span class="token punctuation">.</span>Format_RGB888<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>label_origin<span class="token punctuation">.</span>setPixmap<span class="token punctuation">(</span>QPixmap<span class="token punctuation">.</span>fromImage<span class="token punctuation">(</span>self<span class="token punctuation">.</span>photo<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 往显示视频的Label里显示QImage</span>
        self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>label_origin<span class="token punctuation">.</span>setScaledContents<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token comment"># 图片自适应</span>

    <span class="token comment"># 使用摄像头检测</span>
    <span class="token keyword">def</span> <span class="token function">button_camera_open</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>camera_detect <span class="token operator">=</span> <span class="token boolean">True</span>
        self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>textBrowser_print<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"打开摄像头"</span><span class="token punctuation">)</span>
        <span class="token comment"># 设置使用的摄像头序号，系统自带为0</span>
        camera_num <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token comment"># 打开摄像头</span>
        self<span class="token punctuation">.</span>cap <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span>camera_num<span class="token punctuation">)</span>
        <span class="token comment"># 判断摄像头是否处于打开状态</span>
        bool_open <span class="token operator">=</span> self<span class="token punctuation">.</span>cap<span class="token punctuation">.</span>isOpened<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> bool_open<span class="token punctuation">:</span>
            QtWidgets<span class="token punctuation">.</span>QMessageBox<span class="token punctuation">.</span>warning<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">u"Warning"</span><span class="token punctuation">,</span> <span class="token string">u"打开摄像头失败"</span><span class="token punctuation">,</span> buttons<span class="token operator">=</span>QtWidgets<span class="token punctuation">.</span>QMessageBox<span class="token punctuation">.</span>Ok<span class="token punctuation">,</span>
                                          defaultButton<span class="token operator">=</span>QtWidgets<span class="token punctuation">.</span>QMessageBox<span class="token punctuation">.</span>Ok<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            QtWidgets<span class="token punctuation">.</span>QMessageBox<span class="token punctuation">.</span>information<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">u"Warning"</span><span class="token punctuation">,</span> <span class="token string">u"打开摄像头成功"</span><span class="token punctuation">,</span> buttons<span class="token operator">=</span>QtWidgets<span class="token punctuation">.</span>QMessageBox<span class="token punctuation">.</span>Ok<span class="token punctuation">,</span>
                                          defaultButton<span class="token operator">=</span>QtWidgets<span class="token punctuation">.</span>QMessageBox<span class="token punctuation">.</span>Ok<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>btn_loadvideo<span class="token punctuation">.</span>setDisabled<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>btn_loadimg<span class="token punctuation">.</span>setDisabled<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>

    <span class="token comment"># 启动摄像头检测</span>
    <span class="token keyword">def</span> <span class="token function">button_camera_detect</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>textBrowser_print<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"启动摄像头检测"</span><span class="token punctuation">)</span>
        fps<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h<span class="token punctuation">,</span> save_path <span class="token operator">=</span> self<span class="token punctuation">.</span>set_video_name_and_path<span class="token punctuation">(</span><span class="token punctuation">)</span>
        fps <span class="token operator">=</span> <span class="token number">5</span>  <span class="token comment"># 控制摄像头检测下的fps，Note：保存的视频，播放速度有点快，我只是粗暴的调整了FPS</span>
        self<span class="token punctuation">.</span>vid_writer <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoWriter<span class="token punctuation">(</span>save_path<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>VideoWriter_fourcc<span class="token punctuation">(</span><span class="token operator">*</span><span class="token string">'mp4v'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fps<span class="token punctuation">,</span> <span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>timer_video<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>btn_loadvideo<span class="token punctuation">.</span>setDisabled<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>btn_loadimg<span class="token punctuation">.</span>setDisabled<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>btn_opencamera<span class="token punctuation">.</span>setDisabled<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>


    <span class="token comment"># 视频暂停按钮</span>
    <span class="token keyword">def</span> <span class="token function">button_stop</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>

        self<span class="token punctuation">.</span>timer_video<span class="token punctuation">.</span>blockSignals<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>
        <span class="token comment"># 暂停检测</span>
        <span class="token comment"># 若QTimer已经触发，且激活</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>timer_video<span class="token punctuation">.</span>isActive<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">True</span> <span class="token keyword">and</span> self<span class="token punctuation">.</span>num_stop <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>btn_stop<span class="token punctuation">.</span>setText<span class="token punctuation">(</span><span class="token string">'继续'</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>textBrowser_print<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"视频暂停播放"</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>num_stop <span class="token operator">=</span> self<span class="token punctuation">.</span>num_stop <span class="token operator">+</span> <span class="token number">1</span>  <span class="token comment"># 调整标记信号为偶数</span>
            self<span class="token punctuation">.</span>timer_video<span class="token punctuation">.</span>blockSignals<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
            <span class="token comment"># 继续检测</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>num_stop <span class="token operator">=</span> self<span class="token punctuation">.</span>num_stop <span class="token operator">+</span> <span class="token number">1</span>
            self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>btn_stop<span class="token punctuation">.</span>setText<span class="token punctuation">(</span><span class="token string">'暂停'</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>textBrowser_print<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"视频继续播放"</span><span class="token punctuation">)</span>

    <span class="token comment"># 停止视频播放</span>
    <span class="token keyword">def</span> <span class="token function">button_over</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>textBrowser_print<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"视频结束播放"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>cap<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 释放video_capture资源</span>
        self<span class="token punctuation">.</span>timer_video<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 停止读取</span>
        self<span class="token punctuation">.</span>timer_photo<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 停止读取</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>vid_writer <span class="token operator">!=</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>vid_writer<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 释放video_writer资源</span>

        self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>label_origin<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 清空label画布</span>
        self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>label_detect<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 清空label画布</span>
        <span class="token comment"># 启动其他检测按键功能</span>
        self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>btn_loadvideo<span class="token punctuation">.</span>setDisabled<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>btn_loadimg<span class="token punctuation">.</span>setDisabled<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>btn_opencamera<span class="token punctuation">.</span>setDisabled<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>

        <span class="token comment"># 结束检测时，查看暂停功能是否复位，将暂停功能恢复至初始状态</span>
        <span class="token comment"># Note:点击暂停之后，num_stop为偶数状态</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>num_stop <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Reset stop/begin!"</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>btn_stop<span class="token punctuation">.</span>setText<span class="token punctuation">(</span><span class="token string">u'暂停'</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>num_stop <span class="token operator">=</span> self<span class="token punctuation">.</span>num_stop <span class="token operator">+</span> <span class="token number">1</span>
            self<span class="token punctuation">.</span>timer_video<span class="token punctuation">.</span>blockSignals<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>

    <span class="token comment"># 关闭摄像头</span>
    <span class="token keyword">def</span> <span class="token function">button_closecamera</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>textBrowser_print<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"关闭摄像头"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>fps_label<span class="token punctuation">.</span>setText<span class="token punctuation">(</span><span class="token string">"帧率"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>timer_video<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 停止读取</span>
        self<span class="token punctuation">.</span>timer_photo<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 停止读取</span>
        self<span class="token punctuation">.</span>cap<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 释放摄像头</span>
        self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>label_origin<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 清空label画布</span>
        self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>label_detect<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 清空label画布</span>
        self<span class="token punctuation">.</span>cap <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>CAP_DSHOW<span class="token punctuation">)</span>  <span class="token comment"># 摄像头</span>

        self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>btn_loadvideo<span class="token punctuation">.</span>setDisabled<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>btn_loadimg<span class="token punctuation">.</span>setDisabled<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>btn_opencamera<span class="token punctuation">.</span>setDisabled<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>

    <span class="token comment"># 拍照</span>
    <span class="token keyword">def</span> <span class="token function">button_takephoto</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>textBrowser_print<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"启动拍照"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>timer_photo<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>show_image<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>cap<span class="token punctuation">.</span>isOpened<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            FName <span class="token operator">=</span> <span class="token string">"data/images"</span> <span class="token operator">+</span> <span class="token string-interpolation"><span class="token string">fr"/img</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>time<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%Y%m%d%H%M%S'</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span>localtime<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>FName<span class="token punctuation">)</span>
            <span class="token comment"># 原始数据的显示</span>
            flag<span class="token punctuation">,</span> self<span class="token punctuation">.</span>image <span class="token operator">=</span> self<span class="token punctuation">.</span>cap<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 从视频流中读取图片</span>
            image_show <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>self<span class="token punctuation">.</span>image<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">640</span><span class="token punctuation">,</span> <span class="token number">480</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 把读到的帧的大小重新设置为显示的窗口大小</span>
            image_show <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>image_show<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span>  <span class="token comment"># opencv读的通道是BGR,要转成RGB</span>
            image_show <span class="token operator">=</span> cv2<span class="token punctuation">.</span>flip<span class="token punctuation">(</span>image_show<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 水平翻转，因为摄像头拍的是镜像的。</span>
            <span class="token comment"># 把读取到的视频数据变成QImage形式(图片数据、高、宽、RGB颜色空间，三个通道各有2**8=256种颜色)</span>
            self<span class="token punctuation">.</span>showImage <span class="token operator">=</span> QtGui<span class="token punctuation">.</span>QImage<span class="token punctuation">(</span>image_show<span class="token punctuation">.</span>data<span class="token punctuation">,</span> image_show<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> image_show<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> QImage<span class="token punctuation">.</span>Format_RGB888<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>label_detect<span class="token punctuation">.</span>setPixmap<span class="token punctuation">(</span>QtGui<span class="token punctuation">.</span>QPixmap<span class="token punctuation">.</span>fromImage<span class="token punctuation">(</span>self<span class="token punctuation">.</span>photo<span class="token punctuation">)</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>label_detect<span class="token punctuation">.</span>setScaledContents<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token comment"># 设置图像自适应界面大小</span>
            self<span class="token punctuation">.</span>showImage<span class="token punctuation">.</span>save<span class="token punctuation">(</span>FName <span class="token operator">+</span> <span class="token string">".jpg"</span><span class="token punctuation">,</span> <span class="token string">"JPG"</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            QMessageBox<span class="token punctuation">.</span>critical<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">'错误'</span><span class="token punctuation">,</span> <span class="token string">'摄像头未打开！'</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">None</span>

    <span class="token comment"># 调用lablelimg批注工具</span>
    <span class="token keyword">def</span> <span class="token function">button_labelimg</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>textBrowser_print<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"启动标注工具"</span><span class="token punctuation">)</span>
        os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">"labelimg"</span><span class="token punctuation">)</span>

    <span class="token comment"># 清除显示区域</span>
    <span class="token keyword">def</span> <span class="token function">button_clear</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>textBrowser_print<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"清除显示区域"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>textBrowser_print<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>textBrowser_detect<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>


    <span class="token comment"># 窗口居中</span>
    <span class="token keyword">def</span> <span class="token function">center</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        qr <span class="token operator">=</span> self<span class="token punctuation">.</span>frameGeometry<span class="token punctuation">(</span><span class="token punctuation">)</span>
        cp <span class="token operator">=</span> QDesktopWidget<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>availableGeometry<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>center<span class="token punctuation">(</span><span class="token punctuation">)</span>
        qr<span class="token punctuation">.</span>moveCenter<span class="token punctuation">(</span>cp<span class="token punctuation">)</span>
        <span class="token comment"># 设置窗口大小</span>
        self<span class="token punctuation">.</span>move<span class="token punctuation">(</span>qr<span class="token punctuation">.</span>topLeft<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># 关闭事件</span>
    <span class="token keyword">def</span> <span class="token function">closeEvent</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> event<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        reply <span class="token operator">=</span> QMessageBox<span class="token punctuation">.</span>question<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">'Message'</span><span class="token punctuation">,</span>
                                     <span class="token string">"Are you sure to quit?"</span><span class="token punctuation">,</span>
                                     QMessageBox<span class="token punctuation">.</span>Yes <span class="token operator">|</span> QMessageBox<span class="token punctuation">.</span>No<span class="token punctuation">,</span> QMessageBox<span class="token punctuation">.</span>No<span class="token punctuation">)</span>

        <span class="token keyword">if</span> reply <span class="token operator">==</span> QMessageBox<span class="token punctuation">.</span>Yes<span class="token punctuation">:</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>cap<span class="token punctuation">.</span>isOpened<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>cap<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>timer_video<span class="token punctuation">.</span>isActive<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>timer_video<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>timer_photo<span class="token punctuation">.</span>isActive<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>timer_photo<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
            event<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            event<span class="token punctuation">.</span>ignore<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">from</span> qt_material <span class="token keyword">import</span> apply_stylesheet
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token comment"># QtCore.QCoreApplication.setAttribute(QtCore.Qt.AA_EnableHighDpiScaling)  # 自适应分辨率</span>
    app <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QApplication<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span>
    current_ui <span class="token operator">=</span> UI_Logic_Window<span class="token punctuation">(</span><span class="token punctuation">)</span>
    current_ui<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
    extra <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment"># Font</span>
        <span class="token string">'font_family'</span><span class="token punctuation">:</span> <span class="token string">'Adobe 华文仿宋 Std L'</span><span class="token punctuation">,</span>
        <span class="token string">'font_size'</span><span class="token punctuation">:</span> <span class="token number">14</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    apply_stylesheet<span class="token punctuation">(</span>app<span class="token punctuation">,</span> theme<span class="token operator">=</span><span class="token string">'light_blue.xml'</span><span class="token punctuation">,</span>extra<span class="token operator">=</span>extra<span class="token punctuation">)</span>
    <span class="token comment"># apply_stylesheet(app, theme='dark_teal.xml')</span>
    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span>app<span class="token punctuation">.</span>exec_<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="7__1129"></a>7 使用</h3> 
<h3><a id="71__1130"></a>7.1. 注意在使用时需要先选择权重</h3> 
<p>需要先选择权重<br> <img src="https://images2.imgbox.com/23/6a/9URH87h5_o.gif" alt="在这里插入图片描述"></p> 
<h4><a id="72_1133"></a>7.2.图片、视频、摄像头实时检测</h4> 
<p>图片检测效果图</p> 
<p>图片检测效果<br> <img src="https://images2.imgbox.com/ea/1f/sgg22v3N_o.gif" alt="在这里插入图片描述"><br> 视频检测效果<br> <img src="https://images2.imgbox.com/9a/6c/fDTOZGo9_o.gif" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8684021d1234f6ed13f4e298c8c8632f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">基于插值算法和Gardner定时误差检测的OOK信号定时同步的FPGA实现</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/abaf6b432c58b36967000647dae5879f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">PMP-上班摸鱼整理的知识点</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>