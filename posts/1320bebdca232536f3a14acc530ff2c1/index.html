<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>由于达到了总登录时间限制，远程回话被结束。这个限制是服务器管理员或网络策略设置的。 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="由于达到了总登录时间限制，远程回话被结束。这个限制是服务器管理员或网络策略设置的。" />
<meta property="og:description" content="远程桌面连接会话超时或者被限制改组策略也没用的时候就这么解决
今天管理一台服务器，远程连接时帐号密码都输入完后，点连接后弹出一个 “终端服务器超出最大允许连接”。上网查了一下归结一下出现这 种情况的原因和解决办法。
原因:用 远程桌面链接登录到终端服务器时经常会遇到“终端服务器超出最大允许链接数”诸如此类错误导致无法正常登录终端服务器，引起该问题的原因在于终端服务的缺 省链接数为2个链接，并且当登录远程桌面后如果不是采用注销方式退出，而是直接关闭远程桌面窗口，那么实际上会话并没有释放掉，而是继续保留在服务器端， 这样就会占用总的链接数，当这个数量达到最大允许值时就会出现上面的提示。
如何避免？
一、用注销来退出远程桌面而不是直接关闭窗口
二、限制已断开链接的会话存在时间
1、从终端服务配置中修改
运行－Tscc.msc(终端服务配置)－连接－双击RDP-Tcp或右击－属性－会话－选中第一个的替代用户设置(O)－结束已断开的会话［将默认值“从不”改为一个适当的时间，比如30分钟］
2、从组策略修改
开始－运行－gpedit.msc－计算机配置－管理模板－windows组件－终端服务－会话
右边窗口选择 为断开的会话设置时间限制 －选择已启用，选择一个时间
三、增加最多链接数 1、 从终端服务配置中修改：运行－Tscc.msc(终端服务配置)－连接－双击RDP-Tcp或右击－属性，选择“网卡”选项卡－修改“最大连接数”改成你 所需的值，当然这个值不也能太大，否则会占用较多的系统资源。不过这里修改的值好像不起作用，设置成无限制时照样还是会出现本文所说的情况。 2、组策略级别要高于终端服务配置，当启用组策略后终端服务配置中的相应选项会变成灰色不可修改
运行－gpedit.msc－计算机配置－管理模板－Windows组件－终端服务双击右边的”限制连接数量“－选择”已启用“－填入允许的最大连接数
四、改变远程终端模式
打开“控制面板”，双击“添加删除程序”，单击“添加删除Windows组件”,“组件”，在Windows组件向导对话框中选中“终端服务” , “下一步”,“应用服务器”,“下一步”，然后按照提示即可改变终端服务的模式。 Windows 2000终端服务有2种运行模式: 远程管理模式和应用程序服务器模式。远程管理模式允许系统管理员远程管理服务器，而且只允许2个终端会话同时登录终端服务器。应用程序服务器模式允许用户 运行一个以上应用程序，允许多个用户从终端登录访问服务器。但是，应用终端服务的用户必须有终端服务授权，即必须在90天之内在这个域或工作组中设置终端 服务授权服务器，否则用户需删除应用程序，然后再重新安装。
五、修改本地安全策略
控制面板&gt;&gt;管理工具&gt;&gt;本地安全策略&gt;&gt;本地策略&gt;&gt;安全选项&gt;&gt;
1、先找到&gt;&gt;Microsoft网络服务器:在挂起会话之前所需的空闲时间默认为:15分钟,改为自己所需要的时间(就是登陆后无动作空闲超过多少时间后自动断开)
2、然后找到&gt;&gt;网络安全:在超过登录时间后强制注销。默认为:已禁用,一定要改为:已启用
如果已经发生解决办法： 1、首先你可以telnet到此主机上(不管你用哪种方法)，当然如果能直接操作机器更好，不过直接操作就不必用命令行了，那当然是知道机器超级管理员的密码的情况下，可以使用OpenTelnet来打开远程服务器的Telnet端口。
2、Telnet上去后,先看登陆的用户： 输入命令：query user 系统返回： C:&gt;query user
USERNAME?SESSIONNAME?ID?STATE?IDLE TIME?LOGON TIME
k12update?console?1?运行中?2007-3-14 14:57 此时可以看出的可能都不一样，根据具体情况而定。 ID 0 的用户是本地登陆的,ID 1 和 ID 12是3389登陆的用户,前者在运行中，后者已经断开了,但是断开了仍然占用系统资源和通道，我们要把它踢掉。如下进行操作即可。 输入命令：logoff 1 3、如果服务器关闭了telnet功能（这是默认的），还可以通过SqlServer的xp_cmdshell扩展存储过程，使用格式：master.dbo.xp_cmdshell &#39;
命令内容&#39;，其余可参考第二步。此方式要求有访问xp_cmdshell的权限
上面的解决办法基本没有用 后来我用 服务器终端服务器超出最大允许连接数时，以前考虑用冷启动服务器，但这样必须跑一趟机房，最近发现最好的办法就是在“运行”命令行里输入：mstsc /console /v:你的服务器IP:远程端口，测试有效。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/1320bebdca232536f3a14acc530ff2c1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2014-11-19T15:31:52+08:00" />
<meta property="article:modified_time" content="2014-11-19T15:31:52+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">由于达到了总登录时间限制，远程回话被结束。这个限制是服务器管理员或网络策略设置的。</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><span class="tcnt"><span style="font-size:32px">远程桌面连接会话超时或者被限制改组策略也没用的时候就这么解决</span></span></p> 
<p>今天管理一台服务器，远程连接时帐号密码都输入完后，点连接后弹出一个 “终端服务器超出最大允许连接”。上网查了一下归结一下出现这 种情况的原因和解决办法。</p> 
<p>原因:用 远程桌面链接登录到终端服务器时经常会遇到“终端服务器超出最大允许链接数”诸如此类错误导致无法正常登录终端服务器，引起该问题的原因在于终端服务的缺 省链接数为2个链接，并且当登录远程桌面后如果不是采用注销方式退出，而是直接关闭远程桌面窗口，那么实际上会话并没有释放掉，而是继续保留在服务器端， 这样就会占用总的链接数，当这个数量达到最大允许值时就会出现上面的提示。</p> 
<p>如何避免？</p> 
<p>一、用注销来退出远程桌面而不是直接关闭窗口</p> 
<p>二、限制已断开链接的会话存在时间</p> 
<p>1、从终端服务配置中修改</p> 
<p>运行－Tscc.msc(终端服务配置)－连接－双击RDP-Tcp或右击－属性－会话－选中第一个的替代用户设置(O)－结束已断开的会话［将默认值“从不”改为一个适当的时间，比如30分钟］</p> 
<p>2、从组策略修改</p> 
<p>开始－运行－gpedit.msc－计算机配置－管理模板－windows组件－终端服务－会话</p> 
<p>右边窗口选择 为断开的会话设置时间限制 －选择已启用，选择一个时间</p> 
<p>三、增加最多链接数 </p> 
<p>1、 从终端服务配置中修改：运行－Tscc.msc(终端服务配置)－连接－双击RDP-Tcp或右击－属性，选择“网卡”选项卡－修改“最大连接数”改成你 所需的值，当然这个值不也能太大，否则会占用较多的系统资源。不过这里修改的值好像不起作用，设置成无限制时照样还是会出现本文所说的情况。 </p> 
<p>2、组策略级别要高于终端服务配置，当启用组策略后终端服务配置中的相应选项会变成灰色不可修改</p> 
<p>运行－gpedit.msc－计算机配置－管理模板－Windows组件－终端服务双击右边的”限制连接数量“－选择”已启用“－填入允许的最大连接数</p> 
<p>四、改变远程终端模式</p> 
<p>打开“控制面板”，双击“添加删除程序”，单击“添加删除Windows组件”,“组件”，在Windows组件向导对话框中选中“终端服务” , “下一步”,“应用服务器”,“下一步”，然后按照提示即可改变终端服务的模式。 </p> 
<p>Windows 2000终端服务有2种运行模式: 远程管理模式和应用程序服务器模式。远程管理模式允许系统管理员远程管理服务器，而且只允许2个终端会话同时登录终端服务器。应用程序服务器模式允许用户 运行一个以上应用程序，允许多个用户从终端登录访问服务器。但是，应用终端服务的用户必须有终端服务授权，即必须在90天之内在这个域或工作组中设置终端 服务授权服务器，否则用户需删除应用程序，然后再重新安装。</p> 
<p>五、修改本地安全策略</p> 
<p>控制面板&gt;&gt;管理工具&gt;&gt;本地安全策略&gt;&gt;本地策略&gt;&gt;安全选项&gt;&gt;</p> 
<p>1、先找到&gt;&gt;Microsoft网络服务器:在挂起会话之前所需的空闲时间默认为:15分钟,改为自己所需要的时间(就是登陆后无动作空闲超过多少时间后自动断开)</p> 
<p>2、然后找到&gt;&gt;网络安全:在超过登录时间后强制注销。默认为:已禁用,一定要改为:已启用</p> 
<p>如果已经发生解决办法： </p> 
<p>1、首先你可以telnet到此主机上(不管你用哪种方法)，当然如果能直接操作机器更好，不过直接操作就不必用命令行了，那当然是知道机器超级管理员的密码的情况下，可以使用OpenTelnet来打开远程服务器的Telnet端口。</p> 
<p>2、Telnet上去后,先看登陆的用户： </p> 
<p>输入命令：query user </p> 
<p>系统返回： </p> 
<p>C:&gt;query user</p> 
<p>USERNAME?SESSIONNAME?ID?STATE?IDLE TIME?LOGON TIME</p> 
<p>k12update?console?1?运行中?2007-3-14 14:57 </p> 
<p>此时可以看出的可能都不一样，根据具体情况而定。 </p> 
<p>ID 0 的用户是本地登陆的,ID 1 和 ID 12是3389登陆的用户,前者在运行中，后者已经断开了,但是断开了仍然占用系统资源和通道，我们要把它踢掉。如下进行操作即可。 </p> 
<p>输入命令：logoff 1 </p> 
<p>3、如果服务器关闭了telnet功能（这是默认的），还可以通过SqlServer的xp_cmdshell扩展存储过程，使用格式：master.dbo.xp_cmdshell '</p> 
<p>命令内容'，其余可参考第二步。此方式要求有访问xp_cmdshell的权限</p> 
<p>上面的解决办法基本没有用 后来我用 服务器终端服务器超出最大允许连接数时，以前考虑用冷启动服务器，但这样必须跑一趟机房，最近发现最好的办法就是在“运行”命令行里输入：mstsc /console /v:你的服务器IP:远程端口，测试有效。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2b53129d51099c1cc617876b61941a77/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">jSP页面中给变量赋值方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/663a02317a7404d067381032ac9b3be3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">IOS webView播放视频时进入页面自动播放的问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>