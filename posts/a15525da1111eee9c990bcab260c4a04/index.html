<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>基于服务器部署的OCR在线识别应用 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="基于服务器部署的OCR在线识别应用" />
<meta property="og:description" content="一、前言 前段时间，接了一个OCR在线识别的外包程序，在实现过程中遇到了很多麻烦，也走过很多弯路。在网络查阅了许多相关资料后，发现关于这一块知识详细而完整的文章不多，故写下此文，既是对前段时间的总结，也为今后有同样困扰的朋友提供一些帮助。
几经比较，本文最终决定使用百度的开源OCR框架作为基础，实现服务器部署以及端口调用。PaddleOCR是百度开源的OCR识别框架，采用Paddlehub可快速一键部署。PaddleOCR 的 github 地址：https://github.com/PaddlePaddle/PaddleOCR
二、准备 1、自备服务器，如果没有服务器使用ubuntu作为模拟服务器也行，本文使用的是阿里云服务器
2、在服务器内安装Python环境，建议直接安装Anaconda，可以省去很多时间
3、安装百度的PaddlePaddle，这是个所有百度框架的老大哥，只要你想使用百度的框架产品，这个是必备的
4、安装百度的PaddleHub，这是PaddlePaddle的头号小老弟，安装这个后才能一键部署PaddleOCR
5、安装第三方库shapely、pyclipper，这是运行PaddleOCR的依赖库，没有他们PaddleOCR运行不了
6、安装百度的PaddleOCR框架，有基于移动端的识别框架，也有基于服务端的识别框架，本文使用服务端框架
三、详细步骤 1、配置Python环境 对于初始的服务器来说，其内置的Python版本一般为2.7，已经不再适用当前环境所需的要求，所以需要重新安装新版本的Python环境。为了方便，我直接使用了Anaconda，它把Python和一些常用的库有集合起来了，不需要后续再一个个下载安装。下面进行第一步，下载Anaconda安装包。建议使用使用清华的镜像下载，速度会快很多，清华园镜像地址
将镜像下载进自己的服务器内，我新建了一个Downloads目录专门来存放下载下来的文件
把Anaconda的安装包下载下列后，只需要执行一个bash命令即可： bash Anaconda3-2020.02-Linux-x86_64.sh。然后就是根据提示，要么回车要么输入 yes 。由于笔者写文的时候，环境已经配置好了，没有保留Anaconda的安装截图，如果中途没有报错，一般就是安装成功了。要验证也非常简单，只需要输入：anaconda -V 和 conda -V ，有显示相对应的版本号就算成功了，如下图。
因为有用到图像处理，所以还需要安装一个openCV，安装步骤也非常简单，一句命令即可
pip install opencv-python 2、安装PaddlePaddle PaddlePaddle是百度旗下的一个人工智能开发框架，功能类似于tensorflow和PyTorch等等。对于PaddlePaddle的安装和使用，百度有给出非常简单而清楚的使用教程，教程链接：https://www.paddlepaddle.org.cn/install/quick#show_info ，这里给出了各个系统各个环境对应的安装教程，笔者也是根据这份教程进行简易安装的。
需要确认您的 Ubuntu 14.04/16.04/18.04 是 64 位操作系统*确认您需要安装 PaddlePaddle 的 Python 是您预期的位置，因为您计算机可能有多个 Python which python3 （根据您的环境您可能需要替换本说明中所有命令行中的 python3 为 python ，或者替换为具体的 Python 路径）
同时检查 Python 3 的版本，确认是 3.5.1&#43;/3.6/3.7： python3 --version 确认 Python 有对应的 pip，检查 Python 对应的 pip 的版本，确认是 9." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/a15525da1111eee9c990bcab260c4a04/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-09-20T16:59:39+08:00" />
<meta property="article:modified_time" content="2020-09-20T16:59:39+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">基于服务器部署的OCR在线识别应用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_1"></a>一、前言</h3> 
<blockquote> 
 <p>前段时间，接了一个OCR在线识别的外包程序，在实现过程中遇到了很多麻烦，也走过很多弯路。在网络查阅了许多相关资料后，发现关于这一块知识详细而完整的文章不多，故写下此文，既是对前段时间的总结，也为今后有同样困扰的朋友提供一些帮助。</p> 
 <p>几经比较，本文最终决定使用<strong>百度的开源OCR框架</strong>作为基础，实现服务器部署以及端口调用。PaddleOCR是百度开源的OCR识别框架，采用Paddlehub可快速一键部署。PaddleOCR 的 github 地址：https://github.com/PaddlePaddle/PaddleOCR</p> 
</blockquote> 
<p><br></p> 
<h3><a id="_9"></a>二、准备</h3> 
<p>1、自备服务器，如果没有服务器使用ubuntu作为模拟服务器也行，本文使用的是阿里云服务器</p> 
<p>2、在服务器内安装Python环境，建议直接安装Anaconda，可以省去很多时间</p> 
<p>3、安装百度的PaddlePaddle，这是个所有百度框架的老大哥，只要你想使用百度的框架产品，这个是必备的</p> 
<p>4、安装百度的PaddleHub，这是PaddlePaddle的头号小老弟，安装这个后才能一键部署PaddleOCR</p> 
<p>5、安装第三方库<em>shapely、pyclipper</em>，这是运行PaddleOCR的依赖库，没有他们PaddleOCR运行不了</p> 
<p>6、安装百度的PaddleOCR框架，有基于移动端的识别框架，也有基于服务端的识别框架，本文使用服务端框架</p> 
<p><br></p> 
<h3><a id="_25"></a>三、详细步骤</h3> 
<h5><a id="1Python_26"></a>1、配置Python环境</h5> 
<p>       对于初始的服务器来说，其内置的Python版本一般为2.7，已经不再适用当前环境所需的要求，所以需要重新安装新版本的Python环境。为了方便，我直接使用了Anaconda，它把Python和一些常用的库有集合起来了，不需要后续再一个个下载安装。下面进行第一步，下载Anaconda安装包。建议使用使用清华的镜像下载，速度会快很多，<a href="https://mirrors.tuna.tsinghua.edu.cn/help/anaconda/" rel="nofollow">清华园镜像地址</a></p> 
<p><img src="https://images2.imgbox.com/aa/e6/chKm0Os4_o.png" alt="在这里插入图片描述"></p> 
<p>将镜像下载进自己的服务器内，我新建了一个Downloads目录专门来存放下载下来的文件</p> 
<p><img src="https://images2.imgbox.com/a2/42/at5AnugC_o.png" alt="在这里插入图片描述"></p> 
<p>把Anaconda的安装包下载下列后，只需要执行一个bash命令即可： <strong>bash Anaconda3-2020.02-Linux-x86_64.sh</strong>。<strong>然后就是根据提示，要么回车要么输入 yes</strong> 。由于笔者写文的时候，环境已经配置好了，没有保留Anaconda的安装截图，如果中途没有报错，一般就是安装成功了。要验证也非常简单，只需要输入：<strong>anaconda -V</strong> 和 <strong>conda -V</strong> ，有显示相对应的版本号就算成功了，如下图。</p> 
<p><img src="https://images2.imgbox.com/ac/42/G8ZbBlh7_o.png" alt="在这里插入图片描述"></p> 
<p>因为有用到图像处理，所以还需要安装一个openCV，安装步骤也非常简单，一句命令即可</p> 
<pre><code class="prism language-shell">pip <span class="token function">install</span> opencv-python
</code></pre> 
<p><br></p> 
<h5><a id="2PaddlePaddle_56"></a>2、安装PaddlePaddle</h5> 
<p>       PaddlePaddle是百度旗下的一个人工智能开发框架，功能类似于tensorflow和PyTorch等等。对于PaddlePaddle的安装和使用，百度有给出非常简单而清楚的使用教程，教程链接：https://www.paddlepaddle.org.cn/install/quick#show_info ，这里给出了各个系统各个环境对应的安装教程，笔者也是根据这份教程进行简易安装的。</p> 
<p><img src="https://images2.imgbox.com/a1/67/H9jkpupg_o.png" alt="在这里插入图片描述"></p> 
<ul><li>需要确认您的 Ubuntu 14.04/16.04/18.04 是 64 位操作系统*</li><li>确认您需要安装 PaddlePaddle 的 Python 是您预期的位置，<em>因为您计算机可能有多个 Python</em></li></ul> 
<pre><code>which python3
</code></pre> 
<p>（根据您的环境您可能需要替换本说明中所有命令行中的 <code>python3</code> 为 <code>python</code> ，或者替换为具体的 Python 路径）</p> 
<ul><li>同时检查 Python 3 的版本，确认是 3.5.1+/3.6/3.7：</li></ul> 
<pre><code>python3 --version
</code></pre> 
<ul><li>确认 Python 有对应的 pip，检查 Python 对应的 pip 的版本，确认是 9.0.1+：</li></ul> 
<pre><code>python3 -m ensurepip
python3 -m pip --version
</code></pre> 
<ul><li>确认 Python 和 pip 是 64 bit，并且处理器架构是x86_64架构，目前PaddlePaddle不支持arm64架构<br> 下面的两个命令分别输出的是 “64bit” 和 “x86_64” 即可：</li></ul> 
<pre><code>python3 -c "import platform;print(platform.architecture()[0]);print(platform.machine())"
</code></pre> 
<ul><li>执行以下命令安装（推荐使用百度源）：</li></ul> 
<pre><code>python3 -m pip install paddlepaddle -i https://mirror.baidu.com/pypi/simple
</code></pre> 
<p>或</p> 
<pre><code>python3 -m pip install paddlepaddle -i https://pypi.tuna.tsinghua.edu.cn/simple
</code></pre> 
<p>验证信息</p> 
<p>使用 <code>python3</code> 进入python解释器，输入<code>import paddle.fluid</code> ，再输入 <code>paddle.fluid.install_check.run_check()</code>。<br> 如果出现 <code>Your Paddle Fluid is installed successfully!</code>，说明您已成功安装。</p> 
<p><strong>如果顺利的话，大概几分钟就可以安装成功了，安装教程非常简单。</strong></p> 
<p><br></p> 
<h5><a id="3PaddleHub_114"></a>3、安装PaddleHub</h5> 
<p>       paddlehub安装就极其简单了，一句命令就行：pip install paddlehub，如果担心自己安装的版本不是最新版，也可以使用paddlehub的更新命令：<strong>pip install paddlehub --upgrade -i https://pypi.tuna.tsinghua.edu.cn/simple</strong><br> <br></p> 
<h5><a id="4shapelypyclipper_119"></a>4、安装第三方库<em>shapely、pyclipper</em></h5> 
<p>       理论上来说，在没有意外的情况下，使用下面两句话就可以安装成功了。安装后检验的方式也非常简单，使用 <code>python</code> 进入python解释器，尝试导入两个库，没有报错就说明安装成功了！</p> 
<pre><code class="prism language-shell">pip <span class="token function">install</span> shapely -i https://pypi.tuna.tsinghua.edu.cn/simple 
pip <span class="token function">install</span> pyclipper -i https://pypi.tuna.tsinghua.edu.cn/simple 
</code></pre> 
<p><img src="https://images2.imgbox.com/25/e6/JWuqQ67O_o.png" alt="在这里插入图片描述"></p> 
<p>这里插个题外话，笔者最开始使用paddlehub是在自己的windows系统上，<strong>在windows上安装shapely，不能直接使用上面这句命令</strong>，<strong>对于在windows上安装shapely需要先去相应的网站下载其whl文件，再进行pip安装才行</strong>，笔者最开始被这个问题困扰许久，所以有用windows系统安装shapely的朋友，可以直接百度windows下安装shapely的教程。windows所需要的whl文件下载地址如下：https://www.lfd.uci.edu/~gohlke/pythonlibs/#shapely</p> 
<p><br></p> 
<h5><a id="5PaddleOCR_135"></a>5、安装PaddleOCR</h5> 
<p>       前面的东西都搞定后，当然就是我们的主角登场啦！<strong>如果前面的东西都安装没有问题后，那么安装PaddleOCR就变的十分简单了，前面有提到，PaddleOCR是PaddlePaddle的小老弟，那么PaddleOCR也可以算是Paddlehub的小老弟，有了Paddlehub，安装相应的OCR框架就是一句命令的事情。</strong></p> 
<p>       在安装之前有一个小科普，PaddleHub现已开源OCR文字识别的预训练模型主要有两种：<strong>移动端的超轻量模型、服务器端的精度更高模型</strong>，从名字也可以大致知道，前者适用于安卓端，后者适用于服务端；前者速度高，后者精度高。对于这两个模型的安装和使用，百度也给了非常非常详细的教程。</p> 
<p>​ <strong>移动端的超轻量模型</strong>：仅有8.6M，<a href="https://www.paddlepaddle.org.cn/hubdetail?name=chinese_text_detection_db_mobile&amp;en_category=TextRecognition" rel="nofollow">chinese_ocr_db_crnn_mobile</a>。</p> 
<p>​ <strong>服务器端的精度更高模型</strong>：识别精度更高，<a href="https://www.paddlepaddle.org.cn/hubdetail?name=chinese_ocr_db_crnn_server&amp;en_category=TextRecognition" rel="nofollow">chinese_ocr_db_crnn_server</a>。</p> 
<p>​ 所接的外包程序有明确的精度需求，所以选择了服务端的OCR预训练模型，下面给出安装服务端的安装命令：</p> 
<pre><code class="prism language-shell">hub <span class="token function">install</span> chinese_ocr_db_crnn_server<span class="token operator">==</span>1.0.3
</code></pre> 
<p><br></p> 
<h5><a id="6PaddleOCR_153"></a>6、发布PaddleOCR</h5> 
<p>​ 官网给出的发布命令如下：</p> 
<pre><code class="prism language-shell">hub serving start -m chinese_ocr_db_crnn_server
</code></pre> 
<p><strong>根据官网给出的发布命令，虽然可以发布成功，但是存在一个很大的问题：我们必须一直开启着这个窗口，并且不能继续执行下一条命令。这对我们来说，执行和调用就非常不方便了，所以考虑将这个进程放入后台，放入后台的命令如下：</strong></p> 
<pre><code class="prism language-shell"><span class="token function">nohup</span> hub serving start -m chinese_ocr_db_crnn_server <span class="token operator">&amp;</span>
</code></pre> 
<p><strong>nohup：加在一个命令的最前面，表示不挂断的运行命令；&amp;：加载一个命令的最后面，表示这个命令放在后台执行</strong></p> 
<p><br></p> 
<h3><a id="_173"></a>四、调用</h3> 
<h5><a id="1Python_175"></a>1、Python的调用</h5> 
<pre><code class="prism language-python"><span class="token keyword">import</span> requests
<span class="token keyword">import</span> json
<span class="token keyword">import</span> cv2
<span class="token keyword">import</span> base64

<span class="token keyword">def</span> <span class="token function">cv2_to_base64</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">:</span>
    data <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imencode<span class="token punctuation">(</span><span class="token string">'.jpg'</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>data<span class="token punctuation">.</span>tostring<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span>

<span class="token comment"># 发送HTTP请求</span>
data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'images'</span><span class="token punctuation">:</span><span class="token punctuation">[</span>cv2_to_base64<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">"图片地址"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"Content-type"</span><span class="token punctuation">:</span> <span class="token string">"application/json"</span><span class="token punctuation">}</span>
url <span class="token operator">=</span> <span class="token string">"http://xxx(服务器ip):8866/predict/chinese_ocr_db_crnn_server"</span>
r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">,</span> data<span class="token operator">=</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 打印预测结果</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">"results"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p>这是官方教程给出的Python调用模板，非常简单优雅的代码。但是由于笔者要开始一个在线扫一扫应用，所以使用安卓语言进行调用，于是在这个代码的基础上进行语言转换。</p> 
<h5><a id="2Java_203"></a>2、Java的调用</h5> 
<pre><code class="prism language-java"><span class="token keyword">package</span> test<span class="token punctuation">;</span>

<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>FileInputStream<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>IOException<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>InputStream<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span>Charset<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>text<span class="token punctuation">.</span>ParseException<span class="token punctuation">;</span>

<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>logging<span class="token punctuation">.</span>Log<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>logging<span class="token punctuation">.</span>LogFactory<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>HttpResponse<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>HttpStatus<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>client<span class="token punctuation">.</span>HttpClient<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>client<span class="token punctuation">.</span>methods<span class="token punctuation">.</span>HttpPost<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>entity<span class="token punctuation">.</span>StringEntity<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>client<span class="token punctuation">.</span>DefaultHttpClient<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>util<span class="token punctuation">.</span>EntityUtils<span class="token punctuation">;</span>

<span class="token keyword">import</span> com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>JSONArray<span class="token punctuation">;</span>
<span class="token keyword">import</span> com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>JSONObject<span class="token punctuation">;</span>

<span class="token keyword">import</span> sun<span class="token punctuation">.</span>misc<span class="token punctuation">.</span>BASE64Encoder<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InvoiceOcr</span> <span class="token punctuation">{<!-- --></span>
	    <span class="token comment">//接口地址</span>
		<span class="token keyword">private</span> <span class="token keyword">static</span> String apiURL <span class="token operator">=</span> <span class="token string">"http://xxxx:8866/predict/chinese_ocr_db_crnn_server"</span><span class="token punctuation">;</span>
		<span class="token comment">//private Log logger = LogFactory.getLog(this.getClass());</span>
		<span class="token keyword">private</span> HttpClient httpClient <span class="token operator">=</span> null<span class="token punctuation">;</span>
		<span class="token keyword">private</span> HttpPost method <span class="token operator">=</span> null<span class="token punctuation">;</span>
		<span class="token keyword">private</span> <span class="token keyword">long</span> startTime <span class="token operator">=</span> <span class="token number">0</span>L<span class="token punctuation">;</span>
		<span class="token keyword">private</span> <span class="token keyword">long</span> endTime <span class="token operator">=</span> <span class="token number">0</span>L<span class="token punctuation">;</span>
		<span class="token keyword">private</span> <span class="token keyword">int</span> status <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	 
		<span class="token comment">/**
		 * 接口地址
		 * 
		 * @param url
		 */</span>
		<span class="token keyword">public</span> <span class="token function">InvoiceOcr</span><span class="token punctuation">(</span>String url<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	 
			<span class="token keyword">if</span> <span class="token punctuation">(</span>url <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>apiURL <span class="token operator">=</span> url<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>apiURL <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				httpClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultHttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				method <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpPost</span><span class="token punctuation">(</span>apiURL<span class="token punctuation">)</span><span class="token punctuation">;</span>
	 
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	 
		<span class="token comment">/**
		 * 调用 API
		 * 
		 * @param parameters
		 * @return
		 */</span>
		<span class="token keyword">public</span> String <span class="token function">post</span><span class="token punctuation">(</span>String parameters<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			String body <span class="token operator">=</span> null<span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>method <span class="token operator">!=</span> null <span class="token operator">&amp;</span> parameters <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token string">""</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>parameters<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
	 
					<span class="token comment">// 建立一个NameValuePair数组，用于存储欲传送的参数</span>
					method<span class="token punctuation">.</span><span class="token function">addHeader</span><span class="token punctuation">(</span><span class="token string">"Content-type"</span><span class="token punctuation">,</span><span class="token string">"application/json"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					method<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Accept"</span><span class="token punctuation">,</span> <span class="token string">"application/json"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					method<span class="token punctuation">.</span><span class="token function">setEntity</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringEntity</span><span class="token punctuation">(</span>parameters<span class="token punctuation">,</span> Charset<span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					startTime <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	 
					HttpResponse response <span class="token operator">=</span> httpClient<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span>
					
					endTime <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">int</span> statusCode <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getStatusLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getStatusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					
					<span class="token comment">//logger.info("statusCode:" + statusCode);</span>
					<span class="token comment">//logger.info("调用API 花费时间(单位：毫秒)：" + (endTime - startTime));</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>statusCode <span class="token operator">!=</span> HttpStatus<span class="token punctuation">.</span>SC_OK<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
						<span class="token comment">//logger.error("Method failed:" + response.getStatusLine());</span>
						status <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					body <span class="token operator">=</span> EntityUtils<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">getEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					<span class="token comment">// 网络错误</span>
					status <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
					System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
					<span class="token comment">//logger.info("调用接口状态：" + status);</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> body<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	 
		<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> ParseException <span class="token punctuation">{<!-- --></span>
			InvoiceOcr ac <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InvoiceOcr</span><span class="token punctuation">(</span>apiURL<span class="token punctuation">)</span><span class="token punctuation">;</span>
			JSONArray arry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSONArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			JSONObject j <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSONObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			arry<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">imageToBase64</span><span class="token punctuation">(</span><span class="token string">"E:\\DESK_LIVE\\20200907\\first\\image2.png"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			j<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"images"</span><span class="token punctuation">,</span>arry<span class="token punctuation">)</span><span class="token punctuation">;</span>
	        String result <span class="token operator">=</span> ac<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>j<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		
		<span class="token keyword">public</span> <span class="token keyword">static</span> String <span class="token function">imageToBase64</span><span class="token punctuation">(</span>String path<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data <span class="token operator">=</span> null<span class="token punctuation">;</span>
		        <span class="token comment">// 读取图片字节数组</span>
		        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
		            InputStream in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
		            data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span>in<span class="token punctuation">.</span><span class="token function">available</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		            in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
		            in<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		        <span class="token punctuation">}</span>
		        <span class="token comment">// 对字节数组Base64编码</span>
		        BASE64Encoder encoder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BASE64Encoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		        <span class="token keyword">return</span> encoder<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 返回Base64编码过的字节数组字符串</span>
		    <span class="token punctuation">}</span>
		<span class="token comment">/**
		 * 0.成功 1.执行方法失败 2.协议错误 3.网络错误
		 * 
		 * @return the status
		 */</span>
		<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> status<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	 
		<span class="token comment">/**
		 * @param status
		 *            the status to set
		 */</span>
		<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token keyword">int</span> status<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> status<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	 
		<span class="token comment">/**
		 * @return the startTime
		 */</span>
		<span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getStartTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> startTime<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	 
		<span class="token comment">/**
		 * @return the endTime
		 */</span>
		<span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getEndTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> endTime<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p><strong>现在知道为什么说python代码很优雅了吧！以上代码还需要五个配套的架包，架包名称如下：commons-codec-1.9.jar、commons-logging-1.2.jar、fastjson-1.2.67.jar、httpclient-4.5.jar、httpcore-4.4.1.jar，并且将其关联到相应的lib目录下。</strong></p> 
<p><br></p> 
<h3><a id="_362"></a>五、结果展示</h3> 
<p><img src="https://images2.imgbox.com/f4/8b/UoPrRAsb_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/f0/10/MkxZSoaa_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/1a/54/JcX4vHw3_o.png" alt="在这里插入图片描述"></p> 
<p><strong>可以看到图片越来越模糊，但是识别的精确度依旧很高，满足用户需求，模型效率表现良好！</strong></p> 
<p>自此，本次小结就到此结束了，可以看到整个过程并不困难，复现起来也十分简单，所以如果你觉得有意思，不如动手试试看，做一个自己的在线OCR识别应用程序。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f1fd84660c46c9fae1d66318e9d308da/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">2020年清华伯克利（TBSI）预推免面经</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/691850fcadcad4b7e0d6209ab8dc9bae/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">论文阅读笔记-DEEP COMPRESSION</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>