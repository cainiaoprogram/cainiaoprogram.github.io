<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>yocto（六）——搭建yocto环境 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="yocto（六）——搭建yocto环境" />
<meta property="og:description" content="yocto环境没了，重新构建一下。说来惭愧，先写了后面的文章，才来补环境搭建~~~
文章参考官方手册：https://docs.yoctoproject.org/brief-yoctoprojectqs/index.html
准备环境 我的系统是ubuntu20.04，执行以下命令安装依赖包。
sudo apt install gawk wget git diffstat unzip texinfo gcc build-essential chrpath socat cpio python3 python3-pip python3-pexpect xz-utils debianutils iputils-ping python3-git python3-jinja2 libegl1-mesa libsdl1.2-dev pylint3 xterm python3-subunit mesa-common-dev zstd liblz4-tool 其他发行版环境依赖可查看这个网址。
提醒：后续所有操作均不需要root权限！！！后续所有操作均不需要root权限！！！后续所有操作均不需要root权限！！！
选择yocto版本 1.下载需要使用Git，配置方法网上有太多教程了，自行百度一下。
2.找个空闲的目录下载yocto。
mkdir yocto cd yocto git clone git://git.yoctoproject.org/poky 3.选择一个长期支持的版本，点击这个网站查看。
上图可以看到后续稳定支持的版本所有三个，我们选择一个新的，即kirkstone版本。
注意：新版本的yocto语法有些改动，比如操作符分割不再使用下划线_了，而是使用:符号，在编写yocto配方时候需要特别注意！！！
cd poky git branch -a #查看所有分支 git checkout -t origin/kirkstone -b my-kirkstone #选择kirstone分支 后续如果需要更新yocto的话执行：
git pull 构建yocto $ cd poky $ source oe-init-build-env You had no conf/local." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/ec9ad072cbc5cebf5f52a985188c5002/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-08-01T10:14:53+08:00" />
<meta property="article:modified_time" content="2022-08-01T10:14:53+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">yocto（六）——搭建yocto环境</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>yocto环境没了，重新构建一下。说来惭愧，先写了后面的文章，才来补环境搭建~~~</p> 
<p>文章参考官方手册：https://docs.yoctoproject.org/brief-yoctoprojectqs/index.html</p> 
<h2><a id="_4"></a>准备环境</h2> 
<p>我的系统是ubuntu20.04，执行以下命令安装依赖包。</p> 
<pre><code class="prism language-shell"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> <span class="token function">gawk</span> <span class="token function">wget</span> <span class="token function">git</span> diffstat <span class="token function">unzip</span> texinfo gcc build-essential chrpath socat cpio python3 python3-pip python3-pexpect xz-utils debianutils iputils-ping python3-git python3-jinja2 libegl1-mesa libsdl1.2-dev pylint3 xterm python3-subunit mesa-common-dev zstd liblz4-tool
</code></pre> 
<p>其他发行版环境依赖可查看这个<a href="https://docs.yoctoproject.org/ref-manual/system-requirements.html#required-packages-for-the-build-host" rel="nofollow">网址</a>。</p> 
<p>提醒：后续所有操作均不需要root权限！！！后续所有操作均不需要root权限！！！后续所有操作均不需要root权限！！！</p> 
<h2><a id="yocto_16"></a>选择yocto版本</h2> 
<p>1.下载需要使用Git，配置方法网上有太多教程了，自行百度一下。</p> 
<p>2.找个空闲的目录下载yocto。</p> 
<pre><code class="prism language-shell"><span class="token function">mkdir</span> yocto
<span class="token builtin class-name">cd</span> yocto
<span class="token function">git</span> clone git://git.yoctoproject.org/poky
</code></pre> 
<p>3.选择一个长期支持的版本，点击这个<a href="https://wiki.yoctoproject.org/wiki/Releases" rel="nofollow">网站</a>查看。</p> 
<p><img src="https://images2.imgbox.com/d5/a9/RerjHEhf_o.jpg" alt="在这里插入图片描述"></p> 
<p>上图可以看到后续稳定支持的版本所有三个，我们选择一个新的，即kirkstone版本。<br> 注意：新版本的yocto语法有些改动，比如操作符分割不再使用下划线<code>_</code>了，而是使用<code>:</code>符号，在编写yocto配方时候需要特别注意！！！</p> 
<pre><code class="prism language-shell"><span class="token builtin class-name">cd</span> poky
<span class="token function">git</span> branch -a <span class="token comment">#查看所有分支</span>
<span class="token function">git</span> checkout -t origin/kirkstone -b my-kirkstone <span class="token comment">#选择kirstone分支</span>
</code></pre> 
<p>后续如果需要更新yocto的话执行：</p> 
<pre><code class="prism language-shell"><span class="token function">git</span> pull
</code></pre> 
<h2><a id="yocto_48"></a>构建yocto</h2> 
<pre><code class="prism language-shell">$ <span class="token builtin class-name">cd</span> poky
$ <span class="token builtin class-name">source</span> oe-init-build-env

You had no conf/local.conf file. This configuration <span class="token function">file</span> has therefore been
created <span class="token keyword">for</span> you with some default values. You may wish to edit it to, <span class="token keyword">for</span>
example, <span class="token keyword">select</span> a different MACHINE <span class="token punctuation">(</span>target hardware<span class="token punctuation">)</span>. See conf/local.conf
<span class="token keyword">for</span> <span class="token function">more</span> information as common configuration options are commented.

You had no conf/bblayers.conf file. This configuration <span class="token function">file</span> has therefore been
created <span class="token keyword">for</span> you with some default values. To <span class="token function">add</span> additional metadata layers
into your configuration please <span class="token function">add</span> entries to conf/bblayers.conf.

The Yocto Project has extensive documentation about OE including a reference
manual <span class="token function">which</span> can be found at:
    https://docs.yoctoproject.org

For <span class="token function">more</span> information about OpenEmbedded see the website:
    https://www.openembedded.org/


<span class="token comment">### Shell environment set up for builds. ###</span>

You can now run <span class="token string">'bitbake &lt;target&gt;'</span>

Common targets are:
    core-image-minimal
    core-image-full-cmdline
    core-image-sato
    core-image-weston
    meta-toolchain
    meta-ide-support

You can also run generated qemu images with a <span class="token builtin class-name">command</span> like <span class="token string">'runqemu qemux86'</span>

Other commonly useful commands are:
 - <span class="token string">'devtool'</span> and <span class="token string">'recipetool'</span> handle common recipe tasks
 - <span class="token string">'bitbake-layers'</span> handles common layer tasks
 - <span class="token string">'oe-pkgdata-util'</span> handles common target package tasks

</code></pre> 
<p><code>source oe-init-build-env</code>命令将设置环境变量，这意味着每次打开新的终端都需要执行它。由于没有设置<code>MACHINE</code>，默认为<code>qemux86</code>。</p> 
<p>开始构建吧。</p> 
<pre><code class="prism language-shell">bitbake core-image-sato
</code></pre> 
<p>第一次编译时间取决于编译设备和网络，一般需要2小时左右，后续再次编译就会很快了。</p> 
<h3><a id="_102"></a>依赖出错</h3> 
<p>编译刚开始可能会提示依赖包未安装，安装相应依赖即可。还有可能提示依赖版本不对，这样就需要移除之前的依赖包，再安装新版本依赖。</p> 
<h3><a id="_106"></a>下载出错</h3> 
<p>第一次构建需要非常长的时间，因为我们前面下载的yocto工程只是一些配置文件（配方文件），没有源码包的，所以第一次构建时要去下载源码包，这也意味着可能下载失败。</p> 
<p>下载失败可能存在一下情况：</p> 
<p>1）你当前的网络无法访问对应的URL。</p> 
<p>2）代理有问题。</p> 
<p>3）对应的URL就是失效了。</p> 
<p>4）当前ubuntu软件源有问题，尽量使用学校的源，比如清华源。</p> 
<p>解决方法可以参考我的这篇<a href="https://blog.csdn.net/zz2633105/article/details/122292671?spm=1001.2014.3001.5502">文章</a>，代理的问题还可查看这篇<a href="https://wiki.yoctoproject.org/wiki/Working_Behind_a_Network_Proxy" rel="nofollow">文章</a>。</p> 
<h3><a id="_122"></a>注意</h3> 
<p>安装过程中如果想要强制停止，尽量只按一下 <code>Ctrl + c</code> ，之后yocto会结束后续的任务，但会把当前编译的任务完成。如果多次按<code>Ctrl + c</code>将会强制停止yocto，这样容易导致下次无法编译，但一般只需去build目录下删除*.sock和*.lcok文件即可，如下：</p> 
<pre><code class="prism language-shell">$ <span class="token function">ls</span> build/
bitbake-cookerdaemon.log  bitbake.lock  bitbake.sock  cache  conf  downloads  hashserve.sock  sstate-cache  tmp
</code></pre> 
<h2><a id="_131"></a>运行</h2> 
<p>编译完成后如下所示：</p> 
<pre><code class="prism language-shell">runqemu qemux86-64
</code></pre> 
<p>然后会看到一个弹窗，如下图所示：<br> <img src="https://images2.imgbox.com/98/31/gJ3drevo_o.jpg" alt="在这里插入图片描述"></p> 
<p>启动完成之后，就进入了yocto编译出来的系统了，不过。。。有点卡~~~</p> 
<h2><a id="_144"></a>常见问题</h2> 
<p>有个中文网址（参考使用，非yocto官方），里面汇总了各类常见问题，详情查阅<a href="https://wiki.phytec.com/pages/viewpage.action?pageId=69500932" rel="nofollow">网址</a>。<br> 当然，官方也有一个网站，但是这个网站是英文的，点击<a href="https://docs.yoctoproject.org/ref-manual/faq.html" rel="nofollow">网站</a>。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0cd06a2ff6a9804e01e24358618a8a84/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">CRMEB全开源Java版微信小程序商城，附源码</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/92f989edcf955887ae9861415750659d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">思科RSTP组网实验（快速生成树协议）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>