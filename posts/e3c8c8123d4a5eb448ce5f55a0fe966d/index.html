<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>将华为云/阿里云 RDS相关监控指标集成到Zabbix/Grafana中 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="将华为云/阿里云 RDS相关监控指标集成到Zabbix/Grafana中" />
<meta property="og:description" content="一.需求分析 1.监控需求：将云厂商的RDS数据库监控指标集成到自己公司的监控系统中 2.集成方法：调用厂商提供的API接口 3.华为云/阿里云RDS的监控指标异同 ##注意： 调用接口有如下两种认证方式，您可以选择其中一种进行认证鉴权。 Token认证：通过Token认证通用请求。 AK/SK认证：通过AK（Access Key ID）/SK（Secret Access Key）加密调用请求。推荐使用AK/SK认证，其安全性比Token认证要高。【文章采用该方式演示】 二.华为云RDS监控 1.支持的监控指标：https://support.huaweicloud.com/usermanual-rds/rds_06_0001.html mysql的dim.0=rds_cluster_id postgres 的 dim.0=postgresql_cluster_id 2.支持监控的服务列表：https://support.huaweicloud.com/api-ces/ces_03_0059.html 3.下载使用Python SDK: https://obs.cn-north-1.myhuaweicloud.com/apig-sdk/APIGW-python-sdk.zip 4.监控说明 urlhttps://support.huaweicloud.com/api-ces/ces_03_0033.html .5整理可参考性的指标： rds001_cpu_util CPU使用率 rds002_mem_util 内存使用率 rds003_iops IOPS,单位时间内系统处理的I/O请求数量（平均值）。 rds006_conn_count 数据库总连接数 rds007_conn_active_count 当前活跃连接数 rds008_qps QPS,该指标用于统计SQL语句查询次数，含存储过程，以次/秒为单位。 rds009_tps TPS,该指标用于统计事务执行次数，含提交的和回退的，以次/秒为单位。 rds039_disk_util 磁盘利用率 rds072_conn_usage 连接数使用率 rds074_slow_queries 慢日志个数统计 6.简单编写python代码main部分 # coding=utf-8 import requests import time import sys from apig_sdk import signer if __name__ == &#39;__main__&#39;: sig = signer.Signer() # Set the **AK/SK** to sign and authenticate the request." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/e3c8c8123d4a5eb448ce5f55a0fe966d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-01-04T15:07:28+08:00" />
<meta property="article:modified_time" content="2021-01-04T15:07:28+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">将华为云/阿里云 RDS相关监控指标集成到Zabbix/Grafana中</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night-eighties">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>一.需求分析</h3> 
<pre><code>1.监控需求：将云厂商的RDS数据库监控指标集成到自己公司的监控系统中
2.集成方法：调用厂商提供的API接口
3.华为云/阿里云RDS的监控指标异同

##注意：
调用接口有如下两种认证方式，您可以选择其中一种进行认证鉴权。
Token认证：通过Token认证通用请求。
AK/SK认证：通过AK（Access Key ID）/SK（Secret Access Key）加密调用请求。推荐使用AK/SK认证，其安全性比Token认证要高。【文章采用该方式演示】
</code></pre> 
<h3><a id="RDS_13"></a>二.华为云RDS监控</h3> 
<pre><code>1.支持的监控指标：https://support.huaweicloud.com/usermanual-rds/rds_06_0001.html
	mysql的dim.0=rds_cluster_id     postgres 的  dim.0=postgresql_cluster_id

2.支持监控的服务列表：https://support.huaweicloud.com/api-ces/ces_03_0059.html

3.下载使用Python SDK: https://obs.cn-north-1.myhuaweicloud.com/apig-sdk/APIGW-python-sdk.zip

4.监控说明 urlhttps://support.huaweicloud.com/api-ces/ces_03_0033.html

.5整理可参考性的指标： 
	rds001_cpu_util           CPU使用率
    rds002_mem_util           内存使用率
    rds003_iops               IOPS,单位时间内系统处理的I/O请求数量（平均值）。
    rds006_conn_count         数据库总连接数
    rds007_conn_active_count  当前活跃连接数
    rds008_qps                QPS,该指标用于统计SQL语句查询次数，含存储过程，以次/秒为单位。
    rds009_tps                TPS,该指标用于统计事务执行次数，含提交的和回退的，以次/秒为单位。
    rds039_disk_util          磁盘利用率
    rds072_conn_usage         连接数使用率
    rds074_slow_queries       慢日志个数统计


6.简单编写python代码main部分
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># coding=utf-8</span>
<span class="token keyword">import</span> requests
<span class="token keyword">import</span> time
<span class="token keyword">import</span> sys
<span class="token keyword">from</span> apig_sdk <span class="token keyword">import</span> signer

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    sig <span class="token operator">=</span> signer<span class="token punctuation">.</span>Signer<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># Set the **AK/SK** to sign and authenticate the request.</span>
    sig<span class="token punctuation">.</span>Key <span class="token operator">=</span> <span class="token string">"https://blog.csdn.net/meijinmeng"</span>
    sig<span class="token punctuation">.</span>Secret <span class="token operator">=</span> <span class="token string">"https://blog.csdn.net/meijinmeng"</span>
    project_id<span class="token operator">=</span><span class="token string">"xxxxxxxx"</span> <span class="token comment">##通过控制台获得数据库示例的ID</span>

	<span class="token comment">#set nam_space /metric_name</span>
    name_space<span class="token operator">=</span><span class="token string">"SYS.RDS"</span>
    metic_name<span class="token operator">=</span><span class="token string">"rds001_cpu_util  "</span>
    rds_cluster_id<span class="token operator">=</span><span class="token string">"xxxxxxxxxxx"</span> <span class="token comment">#通过控制台获得</span>
   
    <span class="token comment">#get  first 获取当前时间的20分钟之前的时间，time.time()获取当前时间。</span>
    first <span class="token operator">=</span> time<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">"%Y-%m-%d %H:%M:%S"</span><span class="token punctuation">,</span>time<span class="token punctuation">.</span>localtime<span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token number">1200</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    ts_first <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>mktime<span class="token punctuation">(</span>time<span class="token punctuation">.</span>strptime<span class="token punctuation">(</span>first<span class="token punctuation">,</span> <span class="token string">"%Y-%m-%d %H:%M:%S"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">1000</span>
    ts_last <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">1000</span>






    r <span class="token operator">=</span> signer<span class="token punctuation">.</span>HttpRequest<span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">,</span> <span class="token string">"https://ces.cn-east-2.myhuaweicloud.com/V1.0/%s/metric-data?namespace=SYS.RDS&amp;metric_name=%s&amp;dim.0=rds_cluster_id,xxxxxxxxxxx&amp;from=%s&amp;to=%s&amp;period=1200&amp;filter=average"</span><span class="token operator">%</span><span class="token punctuation">(</span>project_id<span class="token punctuation">,</span>metic_name<span class="token punctuation">,</span>ts_first<span class="token punctuation">,</span>ts_last<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">#r = signer.HttpRequest("GET", "https://rds.cn-east-2.myhuaweicloud.com/v3/826025ab494546f9bafbca01a811a9ef/datastores/mysql")</span>
    r<span class="token punctuation">.</span>headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"content-type"</span><span class="token punctuation">:</span> <span class="token string">"application/json"</span><span class="token punctuation">}</span>
    r<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">""</span>
    sig<span class="token punctuation">.</span>Sign<span class="token punctuation">(</span>r<span class="token punctuation">)</span>

    <span class="token comment">#print(r.headers["X-Sdk-Date"])</span>
    <span class="token comment">#print(r.headers["Authorization"])</span>
    resp <span class="token operator">=</span> requests<span class="token punctuation">.</span>request<span class="token punctuation">(</span>r<span class="token punctuation">.</span>method<span class="token punctuation">,</span> r<span class="token punctuation">.</span>scheme <span class="token operator">+</span> <span class="token string">"://"</span> <span class="token operator">+</span> r<span class="token punctuation">.</span>host <span class="token operator">+</span> r<span class="token punctuation">.</span>uri<span class="token punctuation">,</span> headers<span class="token operator">=</span>r<span class="token punctuation">.</span>headers<span class="token punctuation">,</span> data<span class="token operator">=</span>r<span class="token punctuation">.</span>body<span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


    data<span class="token operator">=</span>resp<span class="token punctuation">.</span>content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'{"datapoints":['</span><span class="token punctuation">)</span>
    data2<span class="token operator">=</span>data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">']'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    last_data<span class="token operator">=</span>data2<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"},"</span><span class="token punctuation">)</span>

    <span class="token comment">#print(last_data,type(last_data))</span>
    data_dic<span class="token operator">=</span><span class="token builtin">eval</span><span class="token punctuation">(</span>last_data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data_dic<span class="token punctuation">,</span><span class="token builtin">type</span><span class="token punctuation">(</span>data_dic<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data_dic<span class="token punctuation">[</span><span class="token string">'average'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"%s 当前值为:%s %s"</span><span class="token operator">%</span><span class="token punctuation">(</span>metic_name<span class="token punctuation">,</span>data_dic<span class="token punctuation">[</span><span class="token string">'average'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>data_dic<span class="token punctuation">[</span><span class="token string">'unit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

	<span class="token comment">#输出结果：</span>
	<span class="token triple-quoted-string string">'''
	 {"datapoints":[{"average":4.6,"timestamp":1609741200000,"unit":"%"},{"average":4.8,"timestamp":1609742400000,"unit":"%"}],"metric_name":"rds001_cpu_util"}
{'average': 4.8, 'timestamp': 1609742400000, 'unit': '%'} &lt;class 'dict'&gt;

4.8
rds001_cpu_util 当前值为:4.8 %
'''</span>


</code></pre> 
<p>7.将sdk代码集成到zabbix/Grafana<br> 将metic_name=sys.argv[1] 作为一个变量传入<br> <img src="https://images2.imgbox.com/20/c5/wD3Jx38i_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="RDS_111"></a>三.阿里云RDS监控</h3> 
<pre><code>1.功能：zabbix通过阿里云api 自动发现、监控阿里云RDS-Mysql数据库  
2.注意事项：
  脚本会收集RDS别名，
  不要默认别名
  不要使用中文别名（zabbix不识别）
  切记aliyun-python-sdk-core==2.3.5，新版本的sdk有bug

3.环境要求：python = 2.7
模块安装/usr/bin/env pip2.7 install aliyun-python-sdk-core==2.3.5 aliyun-python-sdk-rds==2.1.4 datetime

4.使用方法：

    从阿里云控制台获取 AccessKey ,并修改脚本中的 ID 与 Secret
    修改区域 RegionId
    将两个脚本放置于以下目录
    /etc/zabbix/script  &amp;&amp; chmod +x /etc/zabbix/script/*

    修改zabbix-agentd.conf，添加以下内容
  #rds
  UserParameter=rds.discovery,/usr/bin/env python2.7 /etc/zabbix/script/discovery_rds.py
  UserParameter=check.rds[*],/usr/bin/env python2.7 /etc/zabbix/script/check_rds.py $1 $2 $3
 重启zabbix-agent
 zabbix控制台导入模板，并关联主机


5.代码部分：
</code></pre> 
<p>#check_rds.py</p> 
<pre><code class="prism language-python"><span class="token comment">#coding=utf-8</span>
<span class="token keyword">from</span> aliyunsdkcore <span class="token keyword">import</span> client
<span class="token keyword">from</span> aliyunsdkrds<span class="token punctuation">.</span>request<span class="token punctuation">.</span>v20140815 <span class="token keyword">import</span> DescribeResourceUsageRequest<span class="token punctuation">,</span>DescribeDBInstancePerformanceRequest
<span class="token keyword">import</span> json<span class="token punctuation">,</span>sys<span class="token punctuation">,</span>datetime

ID <span class="token operator">=</span> <span class="token string">'ID'</span>
Secret <span class="token operator">=</span> <span class="token string">'Secret'</span>
RegionId <span class="token operator">=</span> <span class="token string">'cn-shenzhen'</span>

clt <span class="token operator">=</span> client<span class="token punctuation">.</span>AcsClient<span class="token punctuation">(</span>ID<span class="token punctuation">,</span>Secret<span class="token punctuation">,</span>RegionId<span class="token punctuation">)</span>

Type <span class="token operator">=</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
DBInstanceId <span class="token operator">=</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
Key <span class="token operator">=</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>

<span class="token comment"># 阿里云返回的数据为UTC时间，因此要转换为东八区时间。其他时区同理。</span>
UTC_End <span class="token operator">=</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>today<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> datetime<span class="token punctuation">.</span>timedelta<span class="token punctuation">(</span>hours<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">)</span>
UTC_Start <span class="token operator">=</span> UTC_End <span class="token operator">-</span> datetime<span class="token punctuation">.</span>timedelta<span class="token punctuation">(</span>minutes<span class="token operator">=</span><span class="token number">25</span><span class="token punctuation">)</span>

StartTime <span class="token operator">=</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span>UTC_Start<span class="token punctuation">,</span> <span class="token string">'%Y-%m-%dT%H:%MZ'</span><span class="token punctuation">)</span>
EndTime <span class="token operator">=</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span>UTC_End<span class="token punctuation">,</span> <span class="token string">'%Y-%m-%dT%H:%MZ'</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">GetResourceUsage</span><span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">,</span>Key<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ResourceUsage <span class="token operator">=</span> DescribeResourceUsageRequest<span class="token punctuation">.</span>DescribeResourceUsageRequest<span class="token punctuation">(</span><span class="token punctuation">)</span>
    ResourceUsage<span class="token punctuation">.</span>set_accept_format<span class="token punctuation">(</span><span class="token string">'json'</span><span class="token punctuation">)</span>
    ResourceUsage<span class="token punctuation">.</span>set_DBInstanceId<span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">)</span>
    ResourceUsageInfo <span class="token operator">=</span> clt<span class="token punctuation">.</span>do_action_with_exception<span class="token punctuation">(</span>ResourceUsage<span class="token punctuation">)</span>
    <span class="token comment">#print ResourceUsageInfo</span>
    Info <span class="token operator">=</span> <span class="token punctuation">(</span>json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>ResourceUsageInfo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span>Key<span class="token punctuation">]</span>
    <span class="token keyword">print</span> Info

<span class="token keyword">def</span> <span class="token function">GetPerformance</span><span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">,</span>MasterKey<span class="token punctuation">,</span>IndexNum<span class="token punctuation">,</span>StartTime<span class="token punctuation">,</span>EndTime<span class="token punctuation">)</span><span class="token punctuation">:</span>
    Performance <span class="token operator">=</span> DescribeDBInstancePerformanceRequest<span class="token punctuation">.</span>DescribeDBInstancePerformanceRequest<span class="token punctuation">(</span><span class="token punctuation">)</span>
    Performance<span class="token punctuation">.</span>set_accept_format<span class="token punctuation">(</span><span class="token string">'json'</span><span class="token punctuation">)</span>
    Performance<span class="token punctuation">.</span>set_DBInstanceId<span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">)</span>
    Performance<span class="token punctuation">.</span>set_Key<span class="token punctuation">(</span>MasterKey<span class="token punctuation">)</span>
    Performance<span class="token punctuation">.</span>set_StartTime<span class="token punctuation">(</span>StartTime<span class="token punctuation">)</span>
    Performance<span class="token punctuation">.</span>set_EndTime<span class="token punctuation">(</span>EndTime<span class="token punctuation">)</span>
    PerformanceInfo <span class="token operator">=</span> clt<span class="token punctuation">.</span>do_action_with_exception<span class="token punctuation">(</span>Performance<span class="token punctuation">)</span>
    <span class="token comment">#print PerformanceInfo</span>
    Info <span class="token operator">=</span> <span class="token punctuation">(</span>json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>PerformanceInfo<span class="token punctuation">)</span><span class="token punctuation">)</span>
    Value <span class="token operator">=</span> Info<span class="token punctuation">[</span><span class="token string">'PerformanceKeys'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'PerformanceKey'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'Values'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'PerformanceValue'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'Value'</span><span class="token punctuation">]</span>
    <span class="token keyword">print</span> <span class="token builtin">str</span><span class="token punctuation">(</span>Value<span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'&amp;'</span><span class="token punctuation">)</span><span class="token punctuation">[</span>IndexNum<span class="token punctuation">]</span>


<span class="token keyword">if</span> <span class="token punctuation">(</span>Type <span class="token operator">==</span> <span class="token string">"Disk"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    GetResourceUsage<span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">,</span> Key<span class="token punctuation">)</span>

<span class="token keyword">elif</span> <span class="token punctuation">(</span>Type <span class="token operator">==</span> <span class="token string">"Performance"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token comment">#平均每秒钟的输入流量</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Key <span class="token operator">==</span> <span class="token string">"MySQL_NetworkTraffic_In"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        IndexNum <span class="token operator">=</span> <span class="token number">0</span>
        MasterKey <span class="token operator">=</span> <span class="token string">"MySQL_NetworkTraffic"</span>
        GetPerformance<span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">,</span>MasterKey<span class="token punctuation">,</span>IndexNum<span class="token punctuation">,</span>StartTime<span class="token punctuation">,</span>EndTime<span class="token punctuation">)</span>

    <span class="token comment">#平均每秒钟的输出流量</span>
    <span class="token keyword">elif</span> <span class="token punctuation">(</span>Key <span class="token operator">==</span> <span class="token string">"MySQL_NetworkTraffic_Out"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        IndexNum <span class="token operator">=</span> <span class="token number">1</span>
        MasterKey <span class="token operator">=</span> <span class="token string">"MySQL_NetworkTraffic"</span>
        GetPerformance<span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">,</span>MasterKey<span class="token punctuation">,</span>IndexNum<span class="token punctuation">,</span>StartTime<span class="token punctuation">,</span>EndTime<span class="token punctuation">)</span>

    <span class="token comment">#每秒SQL语句执行次数</span>
    <span class="token keyword">elif</span> <span class="token punctuation">(</span>Key <span class="token operator">==</span> <span class="token string">"MySQL_QPS"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        IndexNum <span class="token operator">=</span> <span class="token number">0</span>
        MasterKey <span class="token operator">=</span> <span class="token string">"MySQL_QPSTPS"</span>
        GetPerformance<span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">,</span>MasterKey<span class="token punctuation">,</span>IndexNum<span class="token punctuation">,</span>StartTime<span class="token punctuation">,</span>EndTime<span class="token punctuation">)</span>

    <span class="token comment">#平均每秒事务数</span>
    <span class="token keyword">elif</span> <span class="token punctuation">(</span>Key <span class="token operator">==</span> <span class="token string">"MySQL_TPS"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        IndexNum <span class="token operator">=</span> <span class="token number">1</span>
        MasterKey <span class="token operator">=</span> <span class="token string">"MySQL_QPSTPS"</span>
        GetPerformance<span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">,</span>MasterKey<span class="token punctuation">,</span>IndexNum<span class="token punctuation">,</span>StartTime<span class="token punctuation">,</span>EndTime<span class="token punctuation">)</span>

    <span class="token comment">#当前活跃连接数</span>
    <span class="token keyword">elif</span> <span class="token punctuation">(</span>Key <span class="token operator">==</span> <span class="token string">"MySQL_Sessions_Active"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        MasterKey <span class="token operator">=</span> <span class="token string">"MySQL_Sessions"</span>
        IndexNum <span class="token operator">=</span> <span class="token number">0</span>
        GetPerformance<span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">,</span> MasterKey<span class="token punctuation">,</span> IndexNum<span class="token punctuation">,</span> StartTime<span class="token punctuation">,</span> EndTime<span class="token punctuation">)</span>

    <span class="token comment">#当前总连接数</span>
    <span class="token keyword">elif</span> <span class="token punctuation">(</span>Key <span class="token operator">==</span> <span class="token string">"MySQL_Sessions_Totle"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        MasterKey <span class="token operator">=</span> <span class="token string">"MySQL_Sessions"</span>
        IndexNum <span class="token operator">=</span> <span class="token number">1</span>
        GetPerformance<span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">,</span> MasterKey<span class="token punctuation">,</span> IndexNum<span class="token punctuation">,</span> StartTime<span class="token punctuation">,</span> EndTime<span class="token punctuation">)</span>

    <span class="token comment">#InnoDB缓冲池的读命中率</span>
    <span class="token keyword">elif</span> <span class="token punctuation">(</span>Key <span class="token operator">==</span> <span class="token string">"ibuf_read_hit"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        MasterKey <span class="token operator">=</span> <span class="token string">"MySQL_InnoDBBufferRatio"</span>
        IndexNum <span class="token operator">=</span> <span class="token number">0</span>
        GetPerformance<span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">,</span> MasterKey<span class="token punctuation">,</span> IndexNum<span class="token punctuation">,</span> StartTime<span class="token punctuation">,</span> EndTime<span class="token punctuation">)</span>

    <span class="token comment">#InnoDB缓冲池的利用率</span>
    <span class="token keyword">elif</span> <span class="token punctuation">(</span>Key <span class="token operator">==</span> <span class="token string">"ibuf_use_ratio"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        MasterKey <span class="token operator">=</span> <span class="token string">"MySQL_InnoDBBufferRatio"</span>
        IndexNum <span class="token operator">=</span> <span class="token number">1</span>
        GetPerformance<span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">,</span> MasterKey<span class="token punctuation">,</span> IndexNum<span class="token punctuation">,</span> StartTime<span class="token punctuation">,</span> EndTime<span class="token punctuation">)</span>

    <span class="token comment">#InnoDB缓冲池脏块的百分率</span>
    <span class="token keyword">elif</span> <span class="token punctuation">(</span>Key <span class="token operator">==</span> <span class="token string">"ibuf_dirty_ratio"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        MasterKey <span class="token operator">=</span> <span class="token string">"MySQL_InnoDBBufferRatio"</span>
        IndexNum <span class="token operator">=</span> <span class="token number">2</span>
        GetPerformance<span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">,</span> MasterKey<span class="token punctuation">,</span> IndexNum<span class="token punctuation">,</span> StartTime<span class="token punctuation">,</span> EndTime<span class="token punctuation">)</span>

    <span class="token comment">#InnoDB平均每秒钟读取的数据量</span>
    <span class="token keyword">elif</span> <span class="token punctuation">(</span>Key <span class="token operator">==</span> <span class="token string">"inno_data_read"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        MasterKey <span class="token operator">=</span> <span class="token string">"MySQL_InnoDBDataReadWriten"</span>
        IndexNum <span class="token operator">=</span> <span class="token number">0</span>
        GetPerformance<span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">,</span> MasterKey<span class="token punctuation">,</span> IndexNum<span class="token punctuation">,</span> StartTime<span class="token punctuation">,</span> EndTime<span class="token punctuation">)</span>

    <span class="token comment">#InnoDB平均每秒钟写入的数据量</span>
    <span class="token keyword">elif</span> <span class="token punctuation">(</span>Key <span class="token operator">==</span> <span class="token string">"inno_data_written"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        MasterKey <span class="token operator">=</span> <span class="token string">"MySQL_InnoDBDataReadWriten"</span>
        IndexNum <span class="token operator">=</span> <span class="token number">1</span>
        GetPerformance<span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">,</span> MasterKey<span class="token punctuation">,</span> IndexNum<span class="token punctuation">,</span> StartTime<span class="token punctuation">,</span> EndTime<span class="token punctuation">)</span>

    <span class="token comment">#平均每秒向InnoDB缓冲池的读次数</span>
    <span class="token keyword">elif</span> <span class="token punctuation">(</span>Key <span class="token operator">==</span> <span class="token string">"ibuf_request_r"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        MasterKey <span class="token operator">=</span> <span class="token string">"MySQL_InnoDBLogRequests"</span>
        IndexNum <span class="token operator">=</span> <span class="token number">0</span>
        GetPerformance<span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">,</span> MasterKey<span class="token punctuation">,</span> IndexNum<span class="token punctuation">,</span> StartTime<span class="token punctuation">,</span> EndTime<span class="token punctuation">)</span>

    <span class="token comment">#平均每秒向InnoDB缓冲池的写次数</span>
    <span class="token keyword">elif</span> <span class="token punctuation">(</span>Key <span class="token operator">==</span> <span class="token string">"ibuf_request_w"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        MasterKey <span class="token operator">=</span> <span class="token string">"MySQL_InnoDBLogRequests"</span>
        IndexNum <span class="token operator">=</span> <span class="token number">1</span>
        GetPerformance<span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">,</span> MasterKey<span class="token punctuation">,</span> IndexNum<span class="token punctuation">,</span> StartTime<span class="token punctuation">,</span> EndTime<span class="token punctuation">)</span>

    <span class="token comment">#平均每秒日志写请求数</span>
    <span class="token keyword">elif</span> <span class="token punctuation">(</span>Key <span class="token operator">==</span> <span class="token string">"Innodb_log_write_requests"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        MasterKey <span class="token operator">=</span> <span class="token string">"MySQL_InnoDBLogWrites"</span>
        IndexNum <span class="token operator">=</span> <span class="token number">0</span>
        GetPerformance<span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">,</span> MasterKey<span class="token punctuation">,</span> IndexNum<span class="token punctuation">,</span> StartTime<span class="token punctuation">,</span> EndTime<span class="token punctuation">)</span>

    <span class="token comment">#平均每秒向日志文件的物理写次数</span>
    <span class="token keyword">elif</span> <span class="token punctuation">(</span>Key <span class="token operator">==</span> <span class="token string">"Innodb_log_writes"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        MasterKey <span class="token operator">=</span> <span class="token string">"MySQL_InnoDBLogWrites"</span>
        IndexNum <span class="token operator">=</span> <span class="token number">1</span>
        GetPerformance<span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">,</span> MasterKey<span class="token punctuation">,</span> IndexNum<span class="token punctuation">,</span> StartTime<span class="token punctuation">,</span> EndTime<span class="token punctuation">)</span>

    <span class="token comment">#平均每秒向日志文件完成的fsync()写数量</span>
    <span class="token keyword">elif</span> <span class="token punctuation">(</span>Key <span class="token operator">==</span> <span class="token string">"Innodb_os_log_fsyncs"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        MasterKey <span class="token operator">=</span> <span class="token string">"MySQL_InnoDBLogWrites"</span>
        IndexNum <span class="token operator">=</span> <span class="token number">2</span>
        GetPerformance<span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">,</span> MasterKey<span class="token punctuation">,</span> IndexNum<span class="token punctuation">,</span> StartTime<span class="token punctuation">,</span> EndTime<span class="token punctuation">)</span>

    <span class="token comment">#MySQL执行语句时在硬盘上自动创建的临时表的数量</span>
    <span class="token keyword">elif</span> <span class="token punctuation">(</span>Key <span class="token operator">==</span> <span class="token string">"tb_tmp_disk"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        MasterKey <span class="token operator">=</span> <span class="token string">"MySQL_TempDiskTableCreates"</span>
        IndexNum <span class="token operator">=</span> <span class="token number">0</span>
        GetPerformance<span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">,</span> MasterKey<span class="token punctuation">,</span> IndexNum<span class="token punctuation">,</span> StartTime<span class="token punctuation">,</span> EndTime<span class="token punctuation">)</span>

    <span class="token comment">#MyISAM平均每秒Key Buffer利用率</span>
    <span class="token keyword">elif</span> <span class="token punctuation">(</span>Key <span class="token operator">==</span> <span class="token string">"Key_usage_ratio"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        MasterKey <span class="token operator">=</span> <span class="token string">"MySQL_MyISAMKeyBufferRatio"</span>
        IndexNum <span class="token operator">=</span> <span class="token number">0</span>
        GetPerformance<span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">,</span> MasterKey<span class="token punctuation">,</span> IndexNum<span class="token punctuation">,</span> StartTime<span class="token punctuation">,</span> EndTime<span class="token punctuation">)</span>

    <span class="token comment">#MyISAM平均每秒Key Buffer读命中率</span>
    <span class="token keyword">elif</span> <span class="token punctuation">(</span>Key <span class="token operator">==</span> <span class="token string">"Key_read_hit_ratio"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        MasterKey <span class="token operator">=</span> <span class="token string">"MySQL_MyISAMKeyBufferRatio"</span>
        IndexNum <span class="token operator">=</span> <span class="token number">1</span>
        GetPerformance<span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">,</span> MasterKey<span class="token punctuation">,</span> IndexNum<span class="token punctuation">,</span> StartTime<span class="token punctuation">,</span> EndTime<span class="token punctuation">)</span>

    <span class="token comment">#MyISAM平均每秒Key Buffer写命中率</span>
    <span class="token keyword">elif</span> <span class="token punctuation">(</span>Key <span class="token operator">==</span> <span class="token string">"Key_write_hit_ratio"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        MasterKey <span class="token operator">=</span> <span class="token string">"MySQL_MyISAMKeyBufferRatio"</span>
        IndexNum <span class="token operator">=</span> <span class="token number">2</span>
        GetPerformance<span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">,</span> MasterKey<span class="token punctuation">,</span> IndexNum<span class="token punctuation">,</span> StartTime<span class="token punctuation">,</span> EndTime<span class="token punctuation">)</span>

    <span class="token comment">#MyISAM平均每秒钟从缓冲池中的读取次数</span>
    <span class="token keyword">elif</span> <span class="token punctuation">(</span>Key <span class="token operator">==</span> <span class="token string">"myisam_keyr_r"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        MasterKey <span class="token operator">=</span> <span class="token string">"MySQL_MyISAMKeyReadWrites"</span>
        IndexNum <span class="token operator">=</span> <span class="token number">0</span>
        GetPerformance<span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">,</span> MasterKey<span class="token punctuation">,</span> IndexNum<span class="token punctuation">,</span> StartTime<span class="token punctuation">,</span> EndTime<span class="token punctuation">)</span>

    <span class="token comment">#MyISAM平均每秒钟从缓冲池中的写入次数</span>
    <span class="token keyword">elif</span> <span class="token punctuation">(</span>Key <span class="token operator">==</span> <span class="token string">"myisam_keyr_w"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        MasterKey <span class="token operator">=</span> <span class="token string">"MySQL_MyISAMKeyReadWrites"</span>
        IndexNum <span class="token operator">=</span> <span class="token number">1</span>
        GetPerformance<span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">,</span> MasterKey<span class="token punctuation">,</span> IndexNum<span class="token punctuation">,</span> StartTime<span class="token punctuation">,</span> EndTime<span class="token punctuation">)</span>

    <span class="token comment">#MyISAM平均每秒钟从硬盘上读取的次数</span>
    <span class="token keyword">elif</span> <span class="token punctuation">(</span>Key <span class="token operator">==</span> <span class="token string">"myisam_keyr"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        MasterKey <span class="token operator">=</span> <span class="token string">"MySQL_MyISAMKeyReadWrites"</span>
        IndexNum <span class="token operator">=</span> <span class="token number">2</span>
        GetPerformance<span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">,</span> MasterKey<span class="token punctuation">,</span> IndexNum<span class="token punctuation">,</span> StartTime<span class="token punctuation">,</span> EndTime<span class="token punctuation">)</span>

    <span class="token comment">#MyISAM平均每秒钟从硬盘上写入的次数</span>
    <span class="token keyword">elif</span> <span class="token punctuation">(</span>Key <span class="token operator">==</span> <span class="token string">"myisam_keyw"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        MasterKey <span class="token operator">=</span> <span class="token string">"MySQL_MyISAMKeyReadWrites"</span>
        IndexNum <span class="token operator">=</span> <span class="token number">3</span>
        GetPerformance<span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">,</span> MasterKey<span class="token punctuation">,</span> IndexNum<span class="token punctuation">,</span> StartTime<span class="token punctuation">,</span> EndTime<span class="token punctuation">)</span>

    <span class="token comment">#平均每秒Delete语句执行次数</span>
    <span class="token keyword">elif</span> <span class="token punctuation">(</span>Key <span class="token operator">==</span> <span class="token string">"com_delete"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        MasterKey <span class="token operator">=</span> <span class="token string">"MySQL_COMDML"</span>
        IndexNum <span class="token operator">=</span> <span class="token number">0</span>
        GetPerformance<span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">,</span> MasterKey<span class="token punctuation">,</span> IndexNum<span class="token punctuation">,</span> StartTime<span class="token punctuation">,</span> EndTime<span class="token punctuation">)</span>

    <span class="token comment">#平均每秒Insert语句执行次数</span>
    <span class="token keyword">elif</span> <span class="token punctuation">(</span>Key <span class="token operator">==</span> <span class="token string">"com_insert"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        MasterKey <span class="token operator">=</span> <span class="token string">"MySQL_COMDML"</span>
        IndexNum <span class="token operator">=</span> <span class="token number">1</span>
        GetPerformance<span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">,</span> MasterKey<span class="token punctuation">,</span> IndexNum<span class="token punctuation">,</span> StartTime<span class="token punctuation">,</span> EndTime<span class="token punctuation">)</span>

    <span class="token comment">#平均每秒Insert_Select语句执行次数</span>
    <span class="token keyword">elif</span> <span class="token punctuation">(</span>Key <span class="token operator">==</span> <span class="token string">"com_insert_select"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        MasterKey <span class="token operator">=</span> <span class="token string">"MySQL_COMDML"</span>
        IndexNum <span class="token operator">=</span> <span class="token number">2</span>
        GetPerformance<span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">,</span> MasterKey<span class="token punctuation">,</span> IndexNum<span class="token punctuation">,</span> StartTime<span class="token punctuation">,</span> EndTime<span class="token punctuation">)</span>

    <span class="token comment">#平均每秒Replace语句执行次数</span>
    <span class="token keyword">elif</span> <span class="token punctuation">(</span>Key <span class="token operator">==</span> <span class="token string">"com_replace"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        MasterKey <span class="token operator">=</span> <span class="token string">"MySQL_COMDML"</span>
        IndexNum <span class="token operator">=</span> <span class="token number">3</span>
        GetPerformance<span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">,</span> MasterKey<span class="token punctuation">,</span> IndexNum<span class="token punctuation">,</span> StartTime<span class="token punctuation">,</span> EndTime<span class="token punctuation">)</span>

    <span class="token comment">#平均每秒Replace_Select语句执行次数</span>
    <span class="token keyword">elif</span> <span class="token punctuation">(</span>Key <span class="token operator">==</span> <span class="token string">"com_replace_select"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        MasterKey <span class="token operator">=</span> <span class="token string">"MySQL_COMDML"</span>
        IndexNum <span class="token operator">=</span> <span class="token number">4</span>
        GetPerformance<span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">,</span> MasterKey<span class="token punctuation">,</span> IndexNum<span class="token punctuation">,</span> StartTime<span class="token punctuation">,</span> EndTime<span class="token punctuation">)</span>

    <span class="token comment">#平均每秒Select语句执行次数</span>
    <span class="token keyword">elif</span> <span class="token punctuation">(</span>Key <span class="token operator">==</span> <span class="token string">"com_select"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        MasterKey <span class="token operator">=</span> <span class="token string">"MySQL_COMDML"</span>
        IndexNum <span class="token operator">=</span> <span class="token number">5</span>
        GetPerformance<span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">,</span> MasterKey<span class="token punctuation">,</span> IndexNum<span class="token punctuation">,</span> StartTime<span class="token punctuation">,</span> EndTime<span class="token punctuation">)</span>

    <span class="token comment">#平均每秒Update语句执行次数</span>
    <span class="token keyword">elif</span> <span class="token punctuation">(</span>Key <span class="token operator">==</span> <span class="token string">"com_update"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        MasterKey <span class="token operator">=</span> <span class="token string">"MySQL_COMDML"</span>
        IndexNum <span class="token operator">=</span> <span class="token number">6</span>
        GetPerformance<span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">,</span> MasterKey<span class="token punctuation">,</span> IndexNum<span class="token punctuation">,</span> StartTime<span class="token punctuation">,</span> EndTime<span class="token punctuation">)</span>

    <span class="token comment">#平均每秒从InnoDB表读取的行数</span>
    <span class="token keyword">elif</span> <span class="token punctuation">(</span>Key <span class="token operator">==</span> <span class="token string">"inno_row_readed"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        MasterKey <span class="token operator">=</span> <span class="token string">"MySQL_RowDML"</span>
        IndexNum <span class="token operator">=</span> <span class="token number">0</span>
        GetPerformance<span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">,</span> MasterKey<span class="token punctuation">,</span> IndexNum<span class="token punctuation">,</span> StartTime<span class="token punctuation">,</span> EndTime<span class="token punctuation">)</span>

    <span class="token comment">#平均每秒从InnoDB表更新的行数</span>
    <span class="token keyword">elif</span> <span class="token punctuation">(</span>Key <span class="token operator">==</span> <span class="token string">"inno_row_update"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        MasterKey <span class="token operator">=</span> <span class="token string">"MySQL_RowDML"</span>
        IndexNum <span class="token operator">=</span> <span class="token number">1</span>
        GetPerformance<span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">,</span> MasterKey<span class="token punctuation">,</span> IndexNum<span class="token punctuation">,</span> StartTime<span class="token punctuation">,</span> EndTime<span class="token punctuation">)</span>

    <span class="token comment">#平均每秒从InnoDB表删除的行数</span>
    <span class="token keyword">elif</span> <span class="token punctuation">(</span>Key <span class="token operator">==</span> <span class="token string">"inno_row_delete"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        MasterKey <span class="token operator">=</span> <span class="token string">"MySQL_RowDML"</span>
        IndexNum <span class="token operator">=</span> <span class="token number">2</span>
        GetPerformance<span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">,</span> MasterKey<span class="token punctuation">,</span> IndexNum<span class="token punctuation">,</span> StartTime<span class="token punctuation">,</span> EndTime<span class="token punctuation">)</span>

    <span class="token comment">#平均每秒从InnoDB表插入的行数</span>
    <span class="token keyword">elif</span> <span class="token punctuation">(</span>Key <span class="token operator">==</span> <span class="token string">"inno_row_insert"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        MasterKey <span class="token operator">=</span> <span class="token string">"MySQL_RowDML"</span>
        IndexNum <span class="token operator">=</span> <span class="token number">3</span>
        GetPerformance<span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">,</span> MasterKey<span class="token punctuation">,</span> IndexNum<span class="token punctuation">,</span> StartTime<span class="token punctuation">,</span> EndTime<span class="token punctuation">)</span>

    <span class="token comment">#平均每秒向日志文件的物理写次数</span>
    <span class="token keyword">elif</span> <span class="token punctuation">(</span>Key <span class="token operator">==</span> <span class="token string">"Inno_log_writes"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        MasterKey <span class="token operator">=</span> <span class="token string">"MySQL_RowDML"</span>
        IndexNum <span class="token operator">=</span> <span class="token number">4</span>
        GetPerformance<span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">,</span> MasterKey<span class="token punctuation">,</span> IndexNum<span class="token punctuation">,</span> StartTime<span class="token punctuation">,</span> EndTime<span class="token punctuation">)</span>

    <span class="token comment">#MySQL实例CPU使用率(占操作系统总数)</span>
    <span class="token keyword">elif</span> <span class="token punctuation">(</span>Key <span class="token operator">==</span> <span class="token string">"cpuusage"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        MasterKey <span class="token operator">=</span> <span class="token string">"MySQL_MemCpuUsage"</span>
        IndexNum <span class="token operator">=</span> <span class="token number">0</span>
        GetPerformance<span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">,</span> MasterKey<span class="token punctuation">,</span> IndexNum<span class="token punctuation">,</span> StartTime<span class="token punctuation">,</span> EndTime<span class="token punctuation">)</span>

    <span class="token comment">#MySQL实例内存使用率(占操作系统总数)</span>
    <span class="token keyword">elif</span> <span class="token punctuation">(</span>Key <span class="token operator">==</span> <span class="token string">"memusage"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        MasterKey <span class="token operator">=</span> <span class="token string">"MySQL_MemCpuUsage"</span>
        IndexNum <span class="token operator">=</span> <span class="token number">1</span>
        GetPerformance<span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">,</span> MasterKey<span class="token punctuation">,</span> IndexNum<span class="token punctuation">,</span> StartTime<span class="token punctuation">,</span> EndTime<span class="token punctuation">)</span>

    <span class="token comment">#MySQL实例的IOPS（每秒IO请求次数）</span>
    <span class="token keyword">elif</span> <span class="token punctuation">(</span>Key <span class="token operator">==</span> <span class="token string">"io"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        MasterKey <span class="token operator">=</span> <span class="token string">"MySQL_IOPS"</span>
        IndexNum <span class="token operator">=</span> <span class="token number">0</span>
        GetPerformance<span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">,</span> MasterKey<span class="token punctuation">,</span> IndexNum<span class="token punctuation">,</span> StartTime<span class="token punctuation">,</span> EndTime<span class="token punctuation">)</span>

    <span class="token comment">#ins_size实例总空间使用量</span>
    <span class="token keyword">elif</span> <span class="token punctuation">(</span>Key <span class="token operator">==</span> <span class="token string">"ins_size"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        MasterKey <span class="token operator">=</span> <span class="token string">"MySQL_DetailedSpaceUsage"</span>
        IndexNum <span class="token operator">=</span> <span class="token number">0</span>
        GetPerformance<span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">,</span> MasterKey<span class="token punctuation">,</span> IndexNum<span class="token punctuation">,</span> StartTime<span class="token punctuation">,</span> EndTime<span class="token punctuation">)</span>

    <span class="token comment">#data_size数据空间</span>
    <span class="token keyword">elif</span> <span class="token punctuation">(</span>Key <span class="token operator">==</span> <span class="token string">"data_size"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        MasterKey <span class="token operator">=</span> <span class="token string">"MySQL_DetailedSpaceUsage"</span>
        IndexNum <span class="token operator">=</span> <span class="token number">1</span>
        GetPerformance<span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">,</span> MasterKey<span class="token punctuation">,</span> IndexNum<span class="token punctuation">,</span> StartTime<span class="token punctuation">,</span> EndTime<span class="token punctuation">)</span>

    <span class="token comment">#log_size日志空间</span>
    <span class="token keyword">elif</span> <span class="token punctuation">(</span>Key <span class="token operator">==</span> <span class="token string">"log_size"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        MasterKey <span class="token operator">=</span> <span class="token string">"MySQL_DetailedSpaceUsage"</span>
        IndexNum <span class="token operator">=</span> <span class="token number">2</span>
        GetPerformance<span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">,</span> MasterKey<span class="token punctuation">,</span> IndexNum<span class="token punctuation">,</span> StartTime<span class="token punctuation">,</span> EndTime<span class="token punctuation">)</span>

    <span class="token comment">#tmp_size临时空间</span>
    <span class="token keyword">elif</span> <span class="token punctuation">(</span>Key <span class="token operator">==</span> <span class="token string">"tmp_size"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        MasterKey <span class="token operator">=</span> <span class="token string">"MySQL_DetailedSpaceUsage"</span>
        IndexNum <span class="token operator">=</span> <span class="token number">3</span>
        GetPerformance<span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">,</span> MasterKey<span class="token punctuation">,</span> IndexNum<span class="token punctuation">,</span> StartTime<span class="token punctuation">,</span> EndTime<span class="token punctuation">)</span>

    <span class="token comment">#other_size系统空间</span>
    <span class="token keyword">elif</span> <span class="token punctuation">(</span>Key <span class="token operator">==</span> <span class="token string">"other_size"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        MasterKey <span class="token operator">=</span> <span class="token string">"MySQL_DetailedSpaceUsage"</span>
        IndexNum <span class="token operator">=</span> <span class="token number">4</span>
        GetPerformance<span class="token punctuation">(</span>DBInstanceId<span class="token punctuation">,</span> MasterKey<span class="token punctuation">,</span> IndexNum<span class="token punctuation">,</span> StartTime<span class="token punctuation">,</span> EndTime<span class="token punctuation">)</span>
</code></pre> 
<p>#discovery_rds.py</p> 
<pre><code class="prism language-python"><span class="token comment">#coding=UTF-8</span>
<span class="token keyword">from</span> aliyunsdkcore <span class="token keyword">import</span> client
<span class="token keyword">from</span> aliyunsdkrds<span class="token punctuation">.</span>request<span class="token punctuation">.</span>v20140815 <span class="token keyword">import</span> DescribeDBInstancesRequest
<span class="token keyword">import</span> json

ID <span class="token operator">=</span> <span class="token string">'ID'</span>
Secret <span class="token operator">=</span> <span class="token string">'Secret'</span>
RegionId <span class="token operator">=</span> <span class="token string">'cn-shenzhen'</span>

clt <span class="token operator">=</span> client<span class="token punctuation">.</span>AcsClient<span class="token punctuation">(</span>ID<span class="token punctuation">,</span>Secret<span class="token punctuation">,</span>RegionId<span class="token punctuation">)</span>

DBInstanceIdList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
DBInstanceIdDict <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
ZabbixDataDict <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
<span class="token keyword">def</span> <span class="token function">GetRdsList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    RdsRequest <span class="token operator">=</span> DescribeDBInstancesRequest<span class="token punctuation">.</span>DescribeDBInstancesRequest<span class="token punctuation">(</span><span class="token punctuation">)</span>
    RdsRequest<span class="token punctuation">.</span>set_accept_format<span class="token punctuation">(</span><span class="token string">'json'</span><span class="token punctuation">)</span>
    <span class="token comment">#RdsInfo = clt.do_action(RdsRequest)</span>
    RdsInfo <span class="token operator">=</span> clt<span class="token punctuation">.</span>do_action_with_exception<span class="token punctuation">(</span>RdsRequest<span class="token punctuation">)</span>
    <span class="token keyword">for</span> RdsInfoJson <span class="token keyword">in</span> <span class="token punctuation">(</span>json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>RdsInfo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'Items'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'DBInstance'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        DBInstanceIdDict <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            DBInstanceIdDict<span class="token punctuation">[</span><span class="token string">"{#DBINSTANCEID}"</span><span class="token punctuation">]</span> <span class="token operator">=</span> RdsInfoJson<span class="token punctuation">[</span><span class="token string">'DBInstanceId'</span><span class="token punctuation">]</span>
            DBInstanceIdDict<span class="token punctuation">[</span><span class="token string">"{#DBINSTANCEDESCRIPTION}"</span><span class="token punctuation">]</span> <span class="token operator">=</span> RdsInfoJson<span class="token punctuation">[</span><span class="token string">'DBInstanceDescription'</span><span class="token punctuation">]</span>
            DBInstanceIdList<span class="token punctuation">.</span>append<span class="token punctuation">(</span>DBInstanceIdDict<span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception<span class="token punctuation">,</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span> Exception<span class="token punctuation">,</span> <span class="token string">":"</span><span class="token punctuation">,</span> e
            <span class="token keyword">print</span> <span class="token string">"Please check the RDS alias !Alias must not be the same as DBInstanceId！！！"</span>
            


GetRdsList<span class="token punctuation">(</span><span class="token punctuation">)</span>
ZabbixDataDict<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span> <span class="token operator">=</span> DBInstanceIdList
<span class="token keyword">print</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>ZabbixDataDict<span class="token punctuation">)</span>
</code></pre> 
<p>鸣谢：https://github.com/XWJR-Ops/zabbix-RDS-monitor 给的阿里云代码灵感，以后用阿里云备用。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/511fb085f69c7a7bda152c69a10cfb76/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">ap模式和sta模式共存_WLAN、蓝牙、ZigBee和Thread在2.4GHz频段共存</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/50b552951814f2441171471a7912c522/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">微信原版提示音_微信消息提示音可以修改了！！赶快get起来~</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>