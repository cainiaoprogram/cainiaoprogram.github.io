<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>python 连接 neo4j - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="python 连接 neo4j" />
<meta property="og:description" content="导入并连接： from py2neo import * graph = Graph(&#34;http://127.0.0.1:7474&#34;,auth=(&#34;账号&#34;,&#34;密码&#34;)) 新建节点与关系： # 头实体 head = Node(&#34;head_label&#34;, name=&#39;head_name&#39;) # 尾实体 tail = Node(&#34;tail_label&#34;, name=&#39;tail_name&#39;) # 关系 relation = Relationship(head, &#34;relation_name&#34;, tail) # 创建关系（连带创建节点） graph.create(relation) 创建时合并相同节点： node_list = list(matcher.match(&#34;node_label&#34;,name=&#39;node_name&#39;)) if len(node_list) &gt; 0: node = node_list[0] else: node = Node(&#34;node_label&#34;,name=&#39;node_name&#39;) graph.create(node) 查询节点与关系： data_list = list(graph.match(r_type=&#34;relation_name&#34;) # 返回关系三元组 matcher = NodeMatcher(graph) # 用于查询节点 node_list = list(matcher.match(&#34;node_label&#34;,name=&#39;node_name&#39;)) # 返回节点 r_matcher = RelationshipMatcher(g) # 用于查询关系 relation_list = list(r_matcher." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/6f8e53ef65312313f8f0e0b86ee27a8e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-09-21T10:27:06+08:00" />
<meta property="article:modified_time" content="2022-09-21T10:27:06+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">python 连接 neo4j</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <ol><li>导入并连接：</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">from</span> py2neo <span class="token keyword">import</span> <span class="token operator">*</span>
graph <span class="token operator">=</span> Graph<span class="token punctuation">(</span><span class="token string">"http://127.0.0.1:7474"</span><span class="token punctuation">,</span>auth<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">"账号"</span><span class="token punctuation">,</span><span class="token string">"密码"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<ol start="2"><li>新建节点与关系：</li></ol> 
<pre><code class="prism language-python"><span class="token comment"># 头实体</span>
head <span class="token operator">=</span> Node<span class="token punctuation">(</span><span class="token string">"head_label"</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'head_name'</span><span class="token punctuation">)</span>
<span class="token comment"># 尾实体</span>
tail <span class="token operator">=</span> Node<span class="token punctuation">(</span><span class="token string">"tail_label"</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'tail_name'</span><span class="token punctuation">)</span>
<span class="token comment"># 关系</span>
relation <span class="token operator">=</span> Relationship<span class="token punctuation">(</span>head<span class="token punctuation">,</span> <span class="token string">"relation_name"</span><span class="token punctuation">,</span> tail<span class="token punctuation">)</span>
<span class="token comment"># 创建关系（连带创建节点）</span>
graph<span class="token punctuation">.</span>create<span class="token punctuation">(</span>relation<span class="token punctuation">)</span>
</code></pre> 
<ol start="3"><li>创建时合并相同节点：</li></ol> 
<pre><code class="prism language-python">node_list <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>matcher<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span><span class="token string">"node_label"</span><span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'node_name'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>node_list<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
    node <span class="token operator">=</span> node_list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    node <span class="token operator">=</span> Node<span class="token punctuation">(</span><span class="token string">"node_label"</span><span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'node_name'</span><span class="token punctuation">)</span>
graph<span class="token punctuation">.</span>create<span class="token punctuation">(</span>node<span class="token punctuation">)</span>
</code></pre> 
<ol start="4"><li>查询节点与关系：</li></ol> 
<pre><code class="prism language-python">data_list <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>graph<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span>r_type<span class="token operator">=</span><span class="token string">"relation_name"</span><span class="token punctuation">)</span> <span class="token comment"># 返回关系三元组</span>

matcher <span class="token operator">=</span> NodeMatcher<span class="token punctuation">(</span>graph<span class="token punctuation">)</span> <span class="token comment"># 用于查询节点</span>
node_list <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>matcher<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span><span class="token string">"node_label"</span><span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'node_name'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 返回节点</span>
r_matcher <span class="token operator">=</span> RelationshipMatcher<span class="token punctuation">(</span>g<span class="token punctuation">)</span> <span class="token comment"># 用于查询关系</span>
relation_list <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>r_matcher<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span>nodes<span class="token operator">=</span><span class="token punctuation">[</span>fugui<span class="token punctuation">,</span> youqian<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 返回关系三元组</span>
                  					<span class="token comment"># 这里的 node 参数也可以是none,表示任意节点。注意前后顺序</span>
                					<span class="token comment"># 也可用 rtype</span>
node <span class="token operator">=</span> matcher<span class="token punctuation">[</span>node_id<span class="token punctuation">]</span> <span class="token comment"># 根据 id 查询节点</span>
node <span class="token operator">=</span> graph<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span>node_id<span class="token punctuation">]</span>
                
graph<span class="token punctuation">.</span>nodes <span class="token comment"># 所有节点</span>
graph<span class="token punctuation">.</span>relationships <span class="token comment"># 所有关系</span>
graph<span class="token punctuation">.</span>nodes<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span><span class="token string">"node_label"</span><span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'node_name'</span><span class="token punctuation">)</span> <span class="token comment"># 查询指定节点</span>
</code></pre> 
<ol start="5"><li>追加属性与删除属性：</li></ol> 
<pre><code class="prism language-python"><span class="token comment"># 以下同样适用于 relation</span>
node_list <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>matcher<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span><span class="token string">"node_label"</span><span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'node_name'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># setdefault() 如果此节点具有属性 'age'，则返回其值。如果没有，添加 'age' 属性和对应的属性值 '30'</span>
node<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">,</span>default<span class="token operator">=</span><span class="token string">'30'</span><span class="token punctuation">)</span>
node_list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'home'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'jiangxi'</span> <span class="token comment"># 新增属性 'home' 和对应的属性值 'jiangxi'</span>
node_list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>remove_label<span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">)</span> <span class="token comment"># 删除属性</span>
graph<span class="token punctuation">.</span>push<span class="token punctuation">(</span>node_list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 提交更改</span>

<span class="token comment"># 属性批量更新</span>
atrributes <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Amy'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">:</span> <span class="token number">23</span> <span class="token punctuation">}</span> 
node<span class="token punctuation">.</span>update<span class="token punctuation">(</span>atrributes<span class="token punctuation">)</span> 
</code></pre> 
<ol start="6"><li>事务与批处理：</li></ol> 
<pre><code class="prism language-python">tx <span class="token operator">=</span> graph<span class="token punctuation">.</span>begin<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 创建事务</span>
relation_list <span class="token operator">=</span> Subgraph<span class="token punctuation">(</span>relationship<span class="token operator">=</span><span class="token punctuation">[</span>relation_1<span class="token punctuation">,</span>relation_2<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
tx<span class="token punctuation">.</span>create<span class="token punctuation">(</span>relation_list<span class="token punctuation">)</span>
graph<span class="token punctuation">.</span>commit<span class="token punctuation">(</span>tx<span class="token punctuation">)</span> <span class="token comment"># 提交事务</span>
</code></pre> 
<ol start="7"><li>删除节点和关系：</li></ol> 
<pre><code class="prism language-python">graph<span class="token punctuation">.</span>delete_all<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 删除所有节点和关系</span>
graph<span class="token punctuation">.</span>delete<span class="token punctuation">(</span>node<span class="token punctuation">)</span> <span class="token comment"># 删除指定节点</span>
graph<span class="token punctuation">.</span>delete<span class="token punctuation">(</span>relation<span class="token punctuation">)</span> <span class="token comment"># 删除指定关系及节点</span>
graph<span class="token punctuation">.</span>separate<span class="token punctuation">(</span>relation<span class="token punctuation">)</span> <span class="token comment"># 仅删除关系</span>
</code></pre> 
<ol start="8"><li>其余操作：</li></ol> 
<pre><code class="prism language-python"><span class="token comment"># 以下同样适用于 relation</span>
node<span class="token punctuation">.</span>idendity <span class="token comment"># 节点 id</span>
node<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token comment"># 获取 key 对应的属性值</span>
node<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value <span class="token comment"># 设置 key 键对应的 value，如果 value 是 None 就移除这个属性</span>
<span class="token keyword">del</span> node<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token comment"># 删除某个属性</span>
<span class="token builtin">len</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span> <span class="token comment"># 返回 node 里面属性的个数</span>
labels <span class="token operator">=</span> node<span class="token punctuation">.</span>labels <span class="token comment"># 返回所以和这个节点有关的属性</span>
node<span class="token punctuation">.</span>labels<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>labelname<span class="token punctuation">)</span> <span class="token comment"># 删除某个属性</span>
<span class="token builtin">dict</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span> <span class="token comment"># 将 node 的所有属性以 字典 的形式返回</span>


graph<span class="token punctuation">.</span>schema<span class="token punctuation">.</span>node_labels <span class="token comment"># 查询所有节点标签，</span>
						 <span class="token comment"># 返回值为 frozenset({'company', 'skill', 'item', 'employee'})</span>
graph<span class="token punctuation">.</span>schema<span class="token punctuation">.</span>relationship_types <span class="token comment"># 查询所有关系名称，</span>
						 <span class="token comment"># 返回值为 frozenset({'item_of', 'skill_of', 'work_in'})</span>
    
node_list<span class="token punctuation">.</span>to_data_frame<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 返回 dataframe 格式，也可直接 pd.dataframe(node_list)</span>
node_list<span class="token punctuation">.</span>data<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 返回字典格式</span>
node_list<span class="token punctuation">.</span>to_ndarray<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 返回 numpy 数据</span>
</code></pre> 
<ol start="9"><li>使用 <code>cyper(CQL)</code> 语句：</li></ol> 
<pre><code class="prism language-python">graph<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">'MATCH (p:Person) return p'</span><span class="token punctuation">)</span>
graph<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">'MATCH (n) DETACH DELETE n'</span><span class="token punctuation">)</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/13ee0c7fb8bf01c175f8560de1123cfa/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">sdc中跨时钟域(CDC)路径的约束方式</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9baa7e786078cb0fb00f16698b624c99/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">JAVA设计模式--单例模式</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>