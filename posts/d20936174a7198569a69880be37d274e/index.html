<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>实现PC端微信扫码native支付功能 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="实现PC端微信扫码native支付功能" />
<meta property="og:description" content="目录
实现PC端微信扫码
简介
实现步骤
示例代码
Native支付
简介
应用场景
【客户端】生成支付二维码
常见问题 Vue中qrcode的使用方法
1.下载
2.引入（在所需要的页面中引入）
3.生成二维码
实现PC端微信扫码 在本文中，我们将讨论如何在PC端实现微信扫码native支付功能，并提供代码案例和qrcode的使用方法
简介 微信扫码native支付是一种方便快捷的支付方式，用户只需使用微信扫描二维码即可完成支付操作。对于开发者来说，实现微信扫码native支付可以为PC端应用添加更多支付选择，提高用户体验。
实现步骤 以下是实现微信扫码native支付的步骤：
1. 获取商户号
首先，您需要拥有一个微信支付商户号。如果没有，请注册一个商户账号并申请商户号。
2. 生成支付二维码
在PC端应用中，您可以使用qrcode库生成支付二维码。这个库可以帮助您生成包含支付信息的二维码。
3. 监听支付结果
用户扫描二维码完成支付后，您需要监听支付结果。为了实现跳转到支付结果页面等功能，您可以使用回调函数或事件监听器。
4.处理支付回调
您可以在接收到支付回调后执行相应的后续处理，例如更新订单状态或通知用户支付结果。
示例代码 下面是整理后的示例代码：
const openDialog = async () =&gt; { let result = await reqQrcode(route.query.orderId as string); await generatePaymentQRCode(result.data.codeUrl); dialogVisible.value = true; let timer = setInterval(async () =&gt; { let result = await reqQueryPayState(route.query.orderId as string); if (result.data) { dialogVisible." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/d20936174a7198569a69880be37d274e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-27T10:23:36+08:00" />
<meta property="article:modified_time" content="2023-10-27T10:23:36+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">实现PC端微信扫码native支付功能</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="%E5%AE%9E%E7%8E%B0PC%E7%AB%AF%E5%BE%AE%E4%BF%A1%E6%89%AB%E7%A0%81-toc" style="margin-left:0px;"><a href="#%E5%AE%9E%E7%8E%B0PC%E7%AB%AF%E5%BE%AE%E4%BF%A1%E6%89%AB%E7%A0%81" rel="nofollow">实现PC端微信扫码</a></p> 
<p id="%E7%AE%80%E4%BB%8B-toc" style="margin-left:40px;"><a href="#%E7%AE%80%E4%BB%8B" rel="nofollow">简介</a></p> 
<p id="%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4-toc" style="margin-left:40px;"><a href="#%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4" rel="nofollow">实现步骤</a></p> 
<p id="%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81-toc" style="margin-left:40px;"><a href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81" rel="nofollow">示例代码</a></p> 
<p id="Native%E6%94%AF%E4%BB%98-toc" style="margin-left:0px;"><a href="#Native%E6%94%AF%E4%BB%98" rel="nofollow">Native支付</a></p> 
<p id="简介-toc" style="margin-left:40px;"><a href="#%E7%AE%80%E4%BB%8B" rel="nofollow">简介</a></p> 
<p id="应用场景-toc" style="margin-left:40px;"><a href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF" rel="nofollow">应用场景</a></p> 
<p id="_3-2-2-【客户端】生成支付二维码-toc" style="margin-left:40px;"><a href="#_3-2-2-%E3%80%90%E5%AE%A2%E6%88%B7%E7%AB%AF%E3%80%91%E7%94%9F%E6%88%90%E6%94%AF%E4%BB%98%E4%BA%8C%E7%BB%B4%E7%A0%81" rel="nofollow">【客户端】生成支付二维码</a></p> 
<p id="_4-常见问题-toc" style="margin-left:40px;"><a href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%C2%A0" rel="nofollow">常见问题 </a></p> 
<p id="Native%E6%94%AF%E4%BB%98%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-toc" style="margin-left:0px;"><a href="#Native%E6%94%AF%E4%BB%98%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86" rel="nofollow">Vue中qrcode的使用方法</a></p> 
<p id="1.%E4%B8%8B%E8%BD%BD-toc" style="margin-left:40px;"><a href="#1.%E4%B8%8B%E8%BD%BD" rel="nofollow">1.下载</a></p> 
<p id="2.%E5%BC%95%E5%85%A5%EF%BC%88%E5%9C%A8%E6%89%80%E9%9C%80%E8%A6%81%E7%9A%84%E9%A1%B5%E9%9D%A2%E4%B8%AD%E5%BC%95%E5%85%A5%EF%BC%89-toc" style="margin-left:40px;"><a href="#2.%E5%BC%95%E5%85%A5%EF%BC%88%E5%9C%A8%E6%89%80%E9%9C%80%E8%A6%81%E7%9A%84%E9%A1%B5%E9%9D%A2%E4%B8%AD%E5%BC%95%E5%85%A5%EF%BC%89" rel="nofollow">2.引入（在所需要的页面中引入）</a></p> 
<p id="3.%E7%94%9F%E6%88%90%E4%BA%8C%E7%BB%B4%E7%A0%81-toc" style="margin-left:40px;"><a href="#3.%E7%94%9F%E6%88%90%E4%BA%8C%E7%BB%B4%E7%A0%81" rel="nofollow">3.生成二维码</a></p> 
<p id="%E5%BC%80%E9%80%9A%E4%BD%BF%E7%94%A8%E5%BE%AE%E4%BF%A1%20native%20%E6%94%AF%E4%BB%98%E6%B5%81%E7%A8%8B-toc" style="margin-left:0px;"></p> 
<hr id="hr-toc"> 
<p></p> 
<h2 id="%E5%AE%9E%E7%8E%B0PC%E7%AB%AF%E5%BE%AE%E4%BF%A1%E6%89%AB%E7%A0%81">实现PC端微信扫码</h2> 
<p>在本文中，我们将讨论如何在PC端实现微信扫码native支付功能，并提供代码案例和qrcode的使用方法</p> 
<h3 id="%E7%AE%80%E4%BB%8B">简介</h3> 
<p>微信扫码native支付是一种方便快捷的支付方式，用户只需使用微信扫描二维码即可完成支付操作。对于开发者来说，实现微信扫码native支付可以为PC端应用添加更多支付选择，提高用户体验。</p> 
<h3 id="%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4">实现步骤</h3> 
<p>以下是实现微信扫码native支付的步骤：</p> 
<p id="1.%20%E8%8E%B7%E5%8F%96%E5%95%86%E6%88%B7%E5%8F%B7"><strong>1. 获取商户号</strong></p> 
<p>首先，您需要拥有一个微信支付商户号。如果没有，请注册一个商户账号并申请商户号。</p> 
<p id="2.%20%E7%94%9F%E6%88%90%E6%94%AF%E4%BB%98%E4%BA%8C%E7%BB%B4%E7%A0%81"><strong>2. 生成支付二维码</strong></p> 
<p>在PC端应用中，您可以使用qrcode库生成支付二维码。这个库可以帮助您生成包含支付信息的二维码。</p> 
<p id="3.%20%E7%9B%91%E5%90%AC%E6%94%AF%E4%BB%98%E7%BB%93%E6%9E%9C"><strong>3. 监听支付结果</strong></p> 
<p>用户扫描二维码完成支付后，您需要监听支付结果。为了实现跳转到支付结果页面等功能，您可以使用回调函数或事件监听器。</p> 
<p id="4.%20%E5%8F%91%E8%B5%B7%E6%94%AF%E4%BB%98%E8%AF%B7%E6%B1%82"><strong>4.处理支付回调</strong></p> 
<p>您可以在接收到支付回调后执行相应的后续处理，例如更新订单状态或通知用户支付结果。</p> 
<h3 id="%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81">示例代码</h3> 
<p>下面是整理后的示例代码：</p> 
<pre><code>const openDialog = async () =&gt; {
  let result = await reqQrcode(route.query.orderId as string);
  
  await generatePaymentQRCode(result.data.codeUrl);

  dialogVisible.value = true;

  let timer = setInterval(async () =&gt; {
      let result = await reqQueryPayState(route.query.orderId as string);
      if (result.data) {
          dialogVisible.value = false;
          ElMessage({
              type: "success",
              message: "支付成功",
          });
          clearInterval(timer);
          getOrderInfo();
      }
  }, 2000);

};


</code></pre> 
<h3 id="%E7%BB%93%E8%AE%BA"></h3> 
<h2 id="Native%E6%94%AF%E4%BB%98">Native支付</h2> 
<p><a class="has-card" href="https://pay.weixin.qq.com/docs/partner/products/partner-native-payment/introduction.html" rel="nofollow" title="产品介绍 - Native支付 | 微信支付服务商文档中心"><span class="link-card-box"><span class="link-title">产品介绍 - Native支付 | 微信支付服务商文档中心</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/53/5e/3TIhDRkb_o.png" alt="icon-default.png?t=N7T8">https://pay.weixin.qq.com/docs/partner/products/partner-native-payment/introduction.html</span></span></a></p> 
<p><img alt="" height="808" src="https://images2.imgbox.com/53/79/5i2QpAqz_o.png" width="757"></p> 
<ol><li>商户后台系统根据用户选购的商品生成订单。</li><li>用户确认支付后调用微信支付【<a href="https://pay.weixin.qq.com/docs/partner/apis/partner-native-payment/partner-jsons/partner-native-prepay.html" rel="nofollow" title="Native下单API">Native下单API</a>】生成预支付交易。</li><li>微信支付系统收到请求后生成预支付交易单，并返回交易会话的二维码链接code_url。</li><li>商户后台系统根据返回的code_url生成二维码。</li><li>用户打开微信“扫一扫”扫描二维码，微信客户端将扫码内容发送到微信支付系统。</li><li>微信支付系统收到客户端请求，验证链接有效性后发起用户支付，要求用户授权。</li><li>用户在微信客户端输入密码，确认支付后，微信客户端提交授权。</li><li>微信支付系统根据用户授权完成支付交易。</li><li>微信支付系统完成支付交易后给微信客户端返回交易结果，并将交易结果通过短信、微信消息提示用户。微信客户端展示支付交易结果页面。</li><li>微信支付系统通过发送异步消息通知商户后台系统支付结果。商户后台系统需回复接收情况，通知微信后台系统不再发送该单的支付通知。</li><li>未收到支付通知的情况，商户后台系统调用【<a href="https://pay.weixin.qq.com/docs/partner/apis/partner-native-payment/partner-query-by-wx-trade-no.html" rel="nofollow" title="查询订单API">查询订单API</a>】。</li><li>商户确认订单已支付后给用户发货。</li></ol> 
<h3 id="简介">简介</h3> 
<p>Native支付是指商户系统按微信支付协议生成支付二维码，用户再用微信“扫一扫”完成支付的模式。</p> 
<h3 id="应用场景">应用场景</h3> 
<p>Native支付适用于PC网站、实体店单品或订单、媒体广告支付等场景</p> 
<p>用户扫描商户展示在各种场景的二维码进行支付，具体操作流程如下：</p> 
<p><strong>步骤一</strong> 商户根据微信支付的规则，为不同商品生成不同的二维码（如图3.1），展示在各种场景，用于用户扫描购买。</p> 
<p><strong>步骤二</strong> 商户根据微信支付的规则，为不同商品生成不同的二维码（如图3.1），展示在各种场景，用于用户扫描购买。</p> 
<p><img alt="" height="611" src="https://images2.imgbox.com/65/6b/SetDJ0IC_o.png" width="1139"></p> 
<p><strong>步骤三</strong> 用户确认支付，输入支付密码（如图3.4）。</p> 
<p><strong>步骤四</strong> 支付完成后会提示用户支付成功（如图3.5），商户后台得到支付成功的通知，然后进行发货处理。</p> 
<p><img alt="" height="520" src="https://images2.imgbox.com/b2/a7/XZNWsuwW_o.png" width="1006"></p> 
<h3 id="_3-2-2-【客户端】生成支付二维码">【客户端】生成支付二维码</h3> 
<p><strong>步骤说明：</strong> 通过Native下单API成功获取**支付二维码链接（code_url）**后，需要在前端（PC网页或POS机具）生成二维码供用户扫描支付。</p> 
<p> 注意</p> 
<blockquote> 
 <p>code_url对应链接格式：<code>weixin：//weixin://pay.weixin.qq.com/bizpayurl/up?pr=NwY5Mz9&amp;groupid=00</code>。请商户调用第三方库将code_url生成二维码图片。该模式链接较短，生成的二维码打印到结账小票上的识别率较高。</p> 
 <p>例如，<code>weixin：//weixin://pay.weixin.qq.com/bizpayurl/up?pr=NwY5Mz9&amp;groupid=00</code> 生成二维码见下图。</p> 
 <p><img alt="" height="304" src="https://images2.imgbox.com/a9/cc/h7FCnnAl_o.png" width="490"></p> 
 <p></p> 
 <h3 id="_4-常见问题"></h3> 
</blockquote> 
<h3 id="%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%C2%A0">常见问题 </h3> 
<p id="q-微信native支付生成的二维码有有效期吗"><a href="https://pay.weixin.qq.com/docs/partner/products/partner-native-payment/development.html#q-%E5%BE%AE%E4%BF%A1native%E6%94%AF%E4%BB%98%E7%94%9F%E6%88%90%E7%9A%84%E4%BA%8C%E7%BB%B4%E7%A0%81%E6%9C%89%E6%9C%89%E6%95%88%E6%9C%9F%E5%90%97" rel="nofollow" title="#">#</a>Q：<strong>微信native支付生成的二维码有有效期吗?</strong></p> 
<p>A：一个二维码的有效期是根据Native下单接口返回的code_url决定，code_url的有效期是2小时。</p> 
<p id="q-native支付扫码后提示-支付失败-该商户暂不支持通过长按识别二维码完成支付"><a href="https://pay.weixin.qq.com/docs/partner/products/partner-native-payment/development.html#q-native%E6%94%AF%E4%BB%98%E6%89%AB%E7%A0%81%E5%90%8E%E6%8F%90%E7%A4%BA-%E6%94%AF%E4%BB%98%E5%A4%B1%E8%B4%A5-%E8%AF%A5%E5%95%86%E6%88%B7%E6%9A%82%E4%B8%8D%E6%94%AF%E6%8C%81%E9%80%9A%E8%BF%87%E9%95%BF%E6%8C%89%E8%AF%86%E5%88%AB%E4%BA%8C%E7%BB%B4%E7%A0%81%E5%AE%8C%E6%88%90%E6%94%AF%E4%BB%98" rel="nofollow" title="#">#</a>Q：<strong>native支付扫码后提示：支付失败，该商户暂不支持通过长按识别二维码完成支付</strong></p> 
<p>A：微信支付已经不支持通过长按识别二维码的方式或通过相册识别二维码的方式完成支付。</p> 
<p></p> 
<h2 id="Native%E6%94%AF%E4%BB%98%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86">Vue中qrcode的使用方法<br>  </h2> 
<h3 id="1.%E4%B8%8B%E8%BD%BD"><strong>1.下载</strong></h3> 
<pre><code>npm install qrcode --save-dev</code></pre> 
<h3 id="2.%E5%BC%95%E5%85%A5%EF%BC%88%E5%9C%A8%E6%89%80%E9%9C%80%E8%A6%81%E7%9A%84%E9%A1%B5%E9%9D%A2%E4%B8%AD%E5%BC%95%E5%85%A5%EF%BC%89"><strong>2.引入（在所需要的页面中引入）</strong></h3> 
<pre><code>​import QRCode from “qrcode”; //引入生成二维码插件
</code></pre> 
<h3 id="3.%E7%94%9F%E6%88%90%E4%BA%8C%E7%BB%B4%E7%A0%81"><strong>3.生成二维码</strong></h3> 
<pre><code>&lt;template&gt;
  &lt;div&gt;
    &lt;canvas id="QRCode_header" style="width: 280px; height: 280px"&gt;&lt;/canvas&gt;
 
  &lt;/div&gt;
&lt;/template&gt;
 
&lt;script&gt;
import QRCode from "qrcode"; //引入生成二维码插件
export default {
  props: [""],
  data() {
    return {
      qrUrl: location.href,
    };
  },
  watch: {},
  mounted() {
    this.getQRCode();
  },
  created() {},
  methods: {
    getQRCode() {  
    //生成的二维码为URL地址js
    this.qrUrl= "https://www.baidu.com/";
      let opts = {
        errorCorrectionLevel: "H", //容错级别
        type: "image/png", //生成的二维码类型
        quality: 0.3, //二维码质量
        margin: 0, //二维码留白边距
        width: 280, //宽
        height: 280, //高
        text: "https://www.baidu.com/", //二维码内容
        color: {
          dark: "#333333", //前景色
          light: "#fff", //背景色
        },
      };
      
      let msg = document.getElementById("QRCode_header");
      // 将获取到的数据（val）画到msg（canvas）上
      QRCode.toCanvas(msg, this.qrUrl, opts, function (error) {
        if (error) {
          console.log("二维码加载失败", error);
          this.$message.error("二维码加载失败");
        }
      });
    },
  },
};
&lt;/script&gt;
 
&lt;style&gt;
 
&lt;/style&gt;</code></pre> 
<pre></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/44520bfba99cb009472e602bbee5e91b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">网络安全的基本概念——自学网安（黑客）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f39629232ce0b0ab5b1e0fc0b2f36d8c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Flink CDC 2.0 主要是借鉴 DBLog 算法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>