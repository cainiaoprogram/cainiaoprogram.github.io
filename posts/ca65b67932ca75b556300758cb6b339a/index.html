<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SpringBoot 如何结合 Liquibase 实现数据库的变更管理? - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="SpringBoot 如何结合 Liquibase 实现数据库的变更管理?" />
<meta property="og:description" content="Spring Boot 和 Liquibase 结合使用，可以简化数据库变更管理的流程，同时也保证了数据的一致性和可追踪性。本文将深入讲解如何在 Spring Boot 应用中集成 Liquibase，并实现数据库变更管理。
注：本文中使用的示例代码基于 Spring Boot 2.5.0 和 Liquibase 4.3.5 版本。
1. Liquibase 简介 Liquibase 是一个开源的数据库变更管理工具，支持多种数据库（如 MySQL、Oracle、SQL Server 等），可以通过 XML、YAML 或 SQL 格式定义数据库变更脚本。Liquibase 可以自动执行这些脚本，并记录每次变更的信息，以便后续进行回滚或比较数据库状态等操作。
2. 准备工作 2.1 创建 Spring Boot 项目 首先我们需要创建一个新的 Spring Boot 项目，可以使用 Spring Initializr 进行快速初始化，也可以手动创建。这里使用 Spring Initializr。
打开 start.spring.io/ 页面，选择以下选项：
Project：Maven ProjectLanguage：JavaSpring Boot：2.5.0Packaging：JarJava：11 在 Dependencies 选项卡中搜索并添加以下依赖：
Spring WebSpring Data JPAH2 DatabaseLiquibase 完成后点击 Generate 按钮下载项目压缩包并解压到本地。
2.2 配置 Maven 在项目根目录下的 pom.xml 文件中添加 Liquibase 的 Maven 插件：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/ca65b67932ca75b556300758cb6b339a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-10T13:10:35+08:00" />
<meta property="article:modified_time" content="2023-05-10T13:10:35+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SpringBoot 如何结合 Liquibase 实现数据库的变更管理?</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p class="img-center"><img alt="" src="https://images2.imgbox.com/7f/48/hn3oONVB_o.png"></p> 
<p>Spring Boot 和 Liquibase 结合使用，可以简化数据库变更管理的流程，同时也保证了数据的一致性和可追踪性。本文将深入讲解如何在 Spring Boot 应用中集成 Liquibase，并实现数据库变更管理。</p> 
<p><strong>注：本文中使用的示例代码基于 Spring Boot 2.5.0 和 Liquibase 4.3.5 版本。</strong></p> 
<h3>1. Liquibase 简介</h3> 
<p>Liquibase 是一个开源的数据库变更管理工具，支持多种数据库（如 MySQL、Oracle、SQL Server 等），可以通过 XML、YAML 或 SQL 格式定义数据库变更脚本。Liquibase 可以自动执行这些脚本，并记录每次变更的信息，以便后续进行回滚或比较数据库状态等操作。</p> 
<h3>2. 准备工作</h3> 
<h4>2.1 创建 Spring Boot 项目</h4> 
<p>首先我们需要创建一个新的 Spring Boot 项目，可以使用 Spring Initializr 进行快速初始化，也可以手动创建。这里使用 Spring Initializr。</p> 
<p>打开 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fstart.spring.io%2F" rel="nofollow" title="start.spring.io/">start.spring.io/</a> 页面，选择以下选项：</p> 
<ul><li>Project：Maven Project</li><li>Language：Java</li><li>Spring Boot：2.5.0</li><li>Packaging：Jar</li><li>Java：11</li></ul> 
<p>在 Dependencies 选项卡中搜索并添加以下依赖：</p> 
<ul><li>Spring Web</li><li>Spring Data JPA</li><li>H2 Database</li><li>Liquibase</li></ul> 
<p>完成后点击 Generate 按钮下载项目压缩包并解压到本地。</p> 
<h4>2.2 配置 Maven</h4> 
<p>在项目根目录下的 <code>pom.xml</code> 文件中添加 Liquibase 的 Maven 插件：</p> 
<pre><code>&lt;plugins&gt;
  &lt;plugin&gt;
    &lt;groupId&gt;org.liquibase&lt;/groupId&gt;
    &lt;artifactId&gt;liquibase-maven-plugin&lt;/artifactId&gt;
    &lt;version&gt;4.3.5&lt;/version&gt;
    &lt;configuration&gt;
      &lt;propertyFile&gt;src/main/resources/liquibase.properties&lt;/propertyFile&gt;
    &lt;/configuration&gt;
    &lt;dependencies&gt;
      &lt;dependency&gt;
        &lt;groupId&gt;com.microsoft.sqlserver&lt;/groupId&gt;
        &lt;artifactId&gt;mssql-jdbc&lt;/artifactId&gt;
        &lt;version&gt;8.4.1.jre11&lt;/version&gt;
      &lt;/dependency&gt;
    &lt;/dependencies&gt;
  &lt;/plugin&gt;
&lt;/plugins&gt;
复制代码</code></pre> 
<p>Liquibase 的 Maven 插件提供了一些用于管理数据库变更的命令，如生成变更脚本、执行变更脚本等。此外，我们还需要在 Maven 中添加 <code>mssql-jdbc</code> 依赖，以支持操作 SQL Server 数据库。</p> 
<h4>2.3 配置 Liquibase</h4> 
<p>在项目的 <code>src/main/resources</code> 目录下创建一个名为 <code>liquibase.properties</code> 的文件，用于配置 Liquibase 运行时的参数，具体配置如下：</p> 
<pre><code>changeLogFile=src/main/resources/db/changelog/db.changelog-master.xml
driver=com.microsoft.sqlserver.jdbc.SQLServerDriver
url=jdbc:sqlserver://localhost:1433;databaseName=my_database
username=sa
password=123456
复制代码</code></pre> 
<p>其中：</p> 
<ul><li><code>changeLogFile</code>：指定 Liquibase 执行的变更日志文件</li><li><code>driver</code>：指定数据库驱动类型</li><li><code>url</code>：指定要连接的数据库 URL</li><li><code>username</code>：指定连接数据库时使用的用户名</li><li><code>password</code>：指定连接数据库时使用的密码</li></ul> 
<p>请根据实际情况修改相应参数。</p> 
<h3>3. 编写变更脚本</h3> 
<p>在 <code>src/main/resources/db/changelog</code> 目录下创建一个名为 <code>db.changelog-master.xml</code> 的文件，用于指定其他变更日志文件的位置。Liquibase 会在启动时自动查找并执行这些日志文件中定义的变更。</p> 
<pre><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                    http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.3.xsd"&gt;
  &lt;include file="001-initial-schema.xml"/&gt;
&lt;/databaseChangeLog&gt;
复制代码</code></pre> 
<p>接下来我们需要编写变更脚本来定义具体的操作。</p> 
<p>创建一个名为 <code>001-initial-schema.xml</code> 的文件，用于定义初始化数据库 schema 的操作。该文件位于 <code>src/main/resources/db/changelog</code> 目录下。代码如下：</p> 
<pre><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                    http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.3.xsd"&gt;
  &lt;changeSet id="001" author="binjie09"&gt;
    &lt;createTable tableName="person"&gt;
      &lt;column name="id" type="bigint" autoIncrement="true"&gt;
        &lt;constraints primaryKey="true" nullable="false"/&gt;
      &lt;/column&gt;
      &lt;column name="name" type="varchar(255)"&gt;
        &lt;constraints nullable="false"/&gt;
      &lt;/column&gt;
      &lt;column name="age" type="integer"/&gt;
    &lt;/createTable&gt;
  &lt;/changeSet&gt;
&lt;/databaseChangeLog&gt;
复制代码</code></pre> 
<p>该脚本定义了一个名为 <code>person</code> 的表，包含三个字段：<code>id</code>、<code>name</code>、<code>age</code>。其中，<code>id</code> 为主键，并设置为自增字段。</p> 
<h3>4. Spring Boot 集成 Liquibase</h3> 
<p>接下来，我们需要在 Spring Boot 应用中集成 Liquibase。在 <code>src/main/java</code> 目录下创建一个名为 <code>com.example.demo</code> 的包，然后创建一个名为 <code>DemoApplication.java</code> 的文件作为启动类。代码如下：</p> 
<pre><code>@SpringBootApplication
public class DemoApplication {

  public static void main(String[] args) {
    SpringApplication.run(DemoApplication.class, args);
  }

}
复制代码</code></pre> 
<h4>4.1 配置 Liquibase 属性</h4> 
<p>在 <code>src/main/resources/application.properties</code> 文件中添加以下配置：</p> 
<pre><code>liquibase.change-log=classpath:/db/changelog-master.xml
复制代码</code></pre> 
<p>该配置指定了 Liquibase 执行的变更日志文件，与 <code>liquibase.properties</code> 中的 <code>changeLogFile</code> 属性相对应。</p> 
<h4>4.2 运行时自动执行脚本</h4> 
<p>由于我们已经在项目中添加了 Liquibase 的 Maven 插件，我们可以使用 Maven 命令来执行 Liquibase 操作。但这种方式需要手动执行，不够便捷。</p> 
<p>现在我们希望 Spring Boot 在启动时自动检查并执行脚本，而无需手动运行命令。为此，我们需要在启动类中添加相关配置。</p> 
<p>修改 <code>DemoApplication.java</code> 文件，添加 <code>LiquibaseConfig</code> 类：</p> 
<pre><code>@Configuration
public class LiquibaseConfig {

  @Bean
  public SpringLiquibase liquibase(DataSource dataSource) {
    SpringLiquibase liquibase = new SpringLiquibase();
    liquibase.setDataSource(dataSource);
    liquibase.setChangeLog("classpath:/db/changelog-master.xml");
    return liquibase;
  }

}
复制代码</code></pre> 
<p>该类使用 <code>SpringLiquibase</code> 类来配置自动执行 Liquibase 操作。</p> 
<h4>4.3 测试</h4> 
<p>至此，我们已经完成了 Spring Boot 和 Liquibase 的集成。现在我们可以启动应用并运行一些测试代码，以验证集成是否成功。</p> 
<p>首先，在 <code>src/test/java</code> 目录下创建一个名为 <code>com.example.demo</code> 的包。然后创建一个名为 <code>DemoApplicationTests.java</code> 的文件，用于编写测试代码。</p> 
<pre><code>@SpringBootTest
class DemoApplicationTests {

  @Autowired
  private JdbcTemplate jdbcTemplate;

  @Test
  void testCreateTable() {
    List&lt;Map&lt;String, Object&gt;&gt; result = jdbcTemplate.queryForList("SELECT * FROM person");
    Assert.assertEquals(0, result.size());
  }

}
复制代码</code></pre> 
<p>该测试代码使用了 <code>JdbcTemplate</code> 来查询 <code>person</code> 表中的数据。由于我们尚未添加任何数据，所以期望结果应该为空。</p> 
<p>运行测试代码，如果没有报错并输出了预期结果，则说明集成成功。现在我们可以继续编写其他的变更脚本，并使用 Liquibase 来自动管理数据库变更了。</p> 
<h3>5. 总结</h3> 
<p>本文详细介绍了 Spring Boot 和 Liquibase 的集成方式，并给出了相应的示例代码以便读者参考。当然，这只是基础用法的演示，实际项目中可能会遇到更复杂的需求，例如多数据源、多租户等。希望本文能为读者提供一些启示，为使用 Liquibase 管理数据库变更提供帮助。</p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d1556f6b789fe90ba69924481bb07a2a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">pom非常好用的写法，统一管理springboot有关依赖的版本</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/cd98ed7f8b1492282bd29a594855d88d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">万字详细解析Dubbo</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>