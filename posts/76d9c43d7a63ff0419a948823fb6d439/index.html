<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>java ssh 上传_java ssh 上传文件至服务器 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="java ssh 上传_java ssh 上传文件至服务器" />
<meta property="og:description" content="java ssh 上传文件至服务器
@(JAVA)[上传文件至服务器]
private File upload; // 得到上传的文件
private String uploadContentType; // 得到文件的类型
private String uploadFileName; // 得到文件的名称
//省略get,set方法
private static final String LUN_WEN_ZHUAN_ZHU = &#34;lun_wen_zhuan_zhu&#34;;
private static final String FILE_SEPARATOR = File.separator;
private static final String BASE_ATTACH_DIR = &#34;attached&#34;;
public void jQueryFileUpload() throws Exception {
String dirName = this.request.getParameter(&#34;dir&#34;);
final String maxSizeStr = this.request.getParameter(&#34;maxSize&#34;);
final String customFileName = this.request.getParameter(&#34;customFileName&#34;);
final int maxSize = StringUtils.isNotEmpty(maxSizeStr) ? Integer.valueOf(maxSizeStr) : 500 * 1024 * 1024;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/76d9c43d7a63ff0419a948823fb6d439/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-02-12T14:54:46+08:00" />
<meta property="article:modified_time" content="2021-02-12T14:54:46+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">java ssh 上传_java ssh 上传文件至服务器</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="font-size:16px;"> 
 <p>java ssh 上传文件至服务器</p> 
 <p>@(JAVA)[上传文件至服务器]</p> 
 <p>private File upload; // 得到上传的文件</p> 
 <p>private String uploadContentType; // 得到文件的类型</p> 
 <p>private String uploadFileName; // 得到文件的名称</p> 
 <p>//省略get,set方法</p> 
 <p>private static final String LUN_WEN_ZHUAN_ZHU = "lun_wen_zhuan_zhu";</p> 
 <p>private static final String FILE_SEPARATOR = File.separator;</p> 
 <p>private static final String BASE_ATTACH_DIR = "attached";</p> 
 <p>public void jQueryFileUpload() throws Exception {<!-- --></p> 
 <p>String dirName = this.request.getParameter("dir");</p> 
 <p>final String maxSizeStr = this.request.getParameter("maxSize");</p> 
 <p>final String customFileName = this.request.getParameter("customFileName");</p> 
 <p>final int maxSize = StringUtils.isNotEmpty(maxSizeStr) ? Integer.valueOf(maxSizeStr) : 500 * 1024 * 1024;</p> 
 <p>dirName = StringUtils.isEmpty(dirName) ? LUN_WEN_ZHUAN_ZHU : dirName;</p> 
 <p>String userInfo = "上传者未登录";</p> 
 <p>final UserSession us = UserThreadLocal.getUserSession();</p> 
 <p>// 不允许使用..移动到上一级目录</p> 
 <p>if (dirName.indexOf("..") &gt;= 0) {<!-- --></p> 
 <p>return;</p> 
 <p>}</p> 
 <p>this.response.setCharacterEncoding("UTF-8"); // 防止中文乱码</p> 
 <p>this.response.setContentType("text/html; charset=UTF-8");</p> 
 <p>final List results = Lists.newArrayList();</p> 
 <p>boolean pass = false;</p> 
 <p>FileInputStream fs = null;</p> 
 <p>InputStreamReader isr = null;</p> 
 <p>BufferedReader br = null;</p> 
 <p>String text = null;</p> 
 <p>// 为了照顾kindeditor</p> 
 <p>final File file = this.upload;</p> 
 <p>final String fName = this.uploadFileName;</p> 
 <p>try {<!-- --></p> 
 <p>fs = new FileInputStream(file);</p> 
 <p>isr = new InputStreamReader(fs);</p> 
 <p>br = new BufferedReader(isr);</p> 
 <p>while (true) {<!-- --></p> 
 <p>text = br.readLine();</p> 
 <p>if (StringUtils.isNotBlank(text)) {<!-- --></p> 
 <p>break;</p> 
 <p>}</p> 
 <p>}</p> 
 <p>// 读取文件有数据的第一行,判断若为jsp,html文件禁止上传</p> 
 <p>if (text.contains("</p> 
 <p>|| text.endsWith("%&gt;")) {<!-- --></p> 
 <p>if (us != null) {<!-- --></p> 
 <p>userInfo = "id:" + us.getUserId() + "登录名:" + us.getUserName() + "身份:" + us.getRoles();</p> 
 <p>}</p> 
 <p>LOGGER.info("有人上传非法文件!!!------" + userInfo + "文件名:" + fName + "已拦截要上传的路径:" + dirName + "/" + fName);</p> 
 <p>pass = false;</p> 
 <p>} else {<!-- --></p> 
 <p>pass = true;</p> 
 <p>}</p> 
 <p>} catch (final IOException e) {<!-- --></p> 
 <p>e.printStackTrace();</p> 
 <p>pass = false;</p> 
 <p>} finally {<!-- --></p> 
 <p>br.close();</p> 
 <p>isr.close();</p> 
 <p>fs.close();</p> 
 <p>}</p> 
 <p>if (!pass) {<!-- --></p> 
 <p>return;</p> 
 <p>}</p> 
 <p>final String originFileName = this.uploadFileName;</p> 
 <p>// 检查扩展名</p> 
 <p>final String fileExt = originFileName.substring(originFileName.lastIndexOf(".") + 1).toLowerCase();</p> 
 <p>final String fileName = StringUtils.isNotEmpty(customFileName) ? customFileName + "." + fileExt</p> 
 <p>: this.uploadFileName;</p> 
 <p>if (us != null) {<!-- --></p> 
 <p>userInfo = "id:" + us.getUserId() + "登录名:" + us.getUserName() + "身份:" + us.getRoles();</p> 
 <p>}</p> 
 <p>LOGGER.info(userInfo + "--------&gt;上传的文件的文件名为：" + fileName);</p> 
 <p>// 检查文件大小</p> 
 <p>if (file.length() &gt; maxSize * 1000 * 1000) {<!-- --></p> 
 <p>// 删除无用文件</p> 
 <p>FileUtils.deleteQuietly(file);</p> 
 <p>LOGGER.error("--------&gt;上传文件大小超过限制,当前允许的最大文件大小为：" + maxSize + "MB");</p> 
 <p>final JqueryUploadData jud = new JqueryUploadData();</p> 
 <p>jud.setError(1);</p> 
 <p>jud.setMessage("上传文件大小超过限制, ,当前允许的最大文件大小为：" + maxSize + "MB");</p> 
 <p>jud.setName(fileName);</p> 
 <p>jud.setSize(file.length());</p> 
 <p>results.add(jud);</p> 
 <p>}</p> 
 <p>final String dateDir = new SimpleDateFormat("yyyyMMdd").format(new Date());</p> 
 <p>// 文件保存跟目录路径</p> 
 <p>final PathSupport ps = this.generateSavePath(false, dirName, dateDir);</p> 
 <p>// 构造目标文件名</p> 
 <p>final String dstFileName = new Date().getTime() + "_" + fileName;</p> 
 <p>final String dstFilePath = ps.getRealPath() + dstFileName;</p> 
 <p>FileUtils.copyFile(file, new File(dstFilePath));</p> 
 <p>LOGGER.info("保存上传附件：" + dstFilePath + "成功!");</p> 
 <p>final JqueryUploadData jud = new JqueryUploadData();</p> 
 <p>jud.setName(fileName);</p> 
 <p>jud.setSize(file.length());</p> 
 <p>jud.setDeleteType("DELETE");</p> 
 <p>jud.setDeleteUrl("../common/kindeditor!jQueryRemove.action?jQuerydownloadName="</p> 
 <p>+ URLEncoder.encode(ps.getRelativePath() + dstFileName, "UTF-8"));</p> 
 <p>jud.setAttachment(ps.getRelativePath() + dstFileName);</p> 
 <p>// for kindeditor</p> 
 <p>jud.setError(0);</p> 
 <p>jud.setMessage("上传成功");</p> 
 <p>jud.setUrl(ps.getRelativePath() + dstFileName);</p> 
 <p>jud.setFilename(fileName);</p> 
 <p>results.add(jud);</p> 
 <p>sendResponseMsg(new Gson().toJson(results));</p> 
 <p>}</p> 
 <p>private class JqueryUploadData {<!-- --></p> 
 <p>private String name;</p> 
 <p>private long size;</p> 
 <p>private String thumbnailUrl;</p> 
 <p>private String deleteUrl;</p> 
 <p>private String deleteType;</p> 
 <p>private String type;</p> 
 <p>private String attachment;</p> 
 <p>private String url;</p> 
 <p>private Integer error;</p> 
 <p>private String message;</p> 
 <p>private String filename;</p> 
 <p>public String getName() {<!-- --></p> 
 <p>return this.name;</p> 
 <p>}</p> 
 <p>public void setName(final String name) {<!-- --></p> 
 <p>this.name = name;</p> 
 <p>}</p> 
 <p>public long getSize() {<!-- --></p> 
 <p>return this.size;</p> 
 <p>}</p> 
 <p>public void setSize(final long size) {<!-- --></p> 
 <p>this.size = size;</p> 
 <p>}</p> 
 <p>public String getUrl() {<!-- --></p> 
 <p>return this.url;</p> 
 <p>}</p> 
 <p>public void setUrl(final String url) {<!-- --></p> 
 <p>this.url = url;</p> 
 <p>}</p> 
 <p>public String getThumbnailUrl() {<!-- --></p> 
 <p>return this.thumbnailUrl;</p> 
 <p>}</p> 
 <p>public void setThumbnailUrl(final String thumbnailUrl) {<!-- --></p> 
 <p>this.thumbnailUrl = thumbnailUrl;</p> 
 <p>}</p> 
 <p>public String getDeleteUrl() {<!-- --></p> 
 <p>return this.deleteUrl;</p> 
 <p>}</p> 
 <p>public void setDeleteUrl(final String deleteUrl) {<!-- --></p> 
 <p>this.deleteUrl = deleteUrl;</p> 
 <p>}</p> 
 <p>public String getDeleteType() {<!-- --></p> 
 <p>return this.deleteType;</p> 
 <p>}</p> 
 <p>public void setDeleteType(final String deleteType) {<!-- --></p> 
 <p>this.deleteType = deleteType;</p> 
 <p>}</p> 
 <p>public String getType() {<!-- --></p> 
 <p>return this.type;</p> 
 <p>}</p> 
 <p>public void setType(final String type) {<!-- --></p> 
 <p>this.type = type;</p> 
 <p>}</p> 
 <p>public String getAttachment() {<!-- --></p> 
 <p>return this.attachment;</p> 
 <p>}</p> 
 <p>public void setAttachment(final String attachment) {<!-- --></p> 
 <p>this.attachment = attachment;</p> 
 <p>}</p> 
 <p>public Integer getError() {<!-- --></p> 
 <p>return this.error;</p> 
 <p>}</p> 
 <p>public void setError(final Integer error) {<!-- --></p> 
 <p>this.error = error;</p> 
 <p>}</p> 
 <p>public String getMessage() {<!-- --></p> 
 <p>return this.message;</p> 
 <p>}</p> 
 <p>public void setMessage(final String message) {<!-- --></p> 
 <p>this.message = message;</p> 
 <p>}</p> 
 <p>public String getFilename() {<!-- --></p> 
 <p>return this.filename;</p> 
 <p>}</p> 
 <p>public void setFilename(final String filename) {<!-- --></p> 
 <p>this.filename = filename;</p> 
 <p>}</p> 
 <p>}</p> 
 <p>private class PathSupport {<!-- --></p> 
 <p>private String realPath;</p> 
 <p>private String relativePath;</p> 
 <p>private String url;</p> 
 <p>public String getRealPath() {<!-- --></p> 
 <p>return this.realPath;</p> 
 <p>}</p> 
 <p>public void setRealPath(final String realPath) {<!-- --></p> 
 <p>this.realPath = realPath;</p> 
 <p>}</p> 
 <p>public void setRelativePath(final String relativePath) {<!-- --></p> 
 <p>this.relativePath = relativePath;</p> 
 <p>}</p> 
 <p>public String getRelativePath() {<!-- --></p> 
 <p>return relativePath;</p> 
 <p>}</p> 
 <p>public String getUrl() {<!-- --></p> 
 <p>return this.url;</p> 
 <p>}</p> 
 <p>public void setUrl(final String url) {<!-- --></p> 
 <p>this.url = url;</p> 
 <p>}</p> 
 <p>@Override</p> 
 <p>public String toString() {<!-- --></p> 
 <p>return "PathSupport [realPath=" + this.realPath + ", relativePath=" + this.relativePath + ", url="</p> 
 <p>+ this.url + "]";</p> 
 <p>}</p> 
 <p>}</p> 
 <p>private PathSupport generateSavePath(final boolean isAccessory, final String dirName, final String dateDir) {<!-- --></p> 
 <p>String realPath = "";</p> 
 <p>String relativePath = "";</p> 
 <p>String filePathUrl = this.request.getScheme() + "://" + this.request.getServerName() + ":"</p> 
 <p>+ this.request.getServerPort() + this.request.getContextPath() + "/";</p> 
 <p>if (isAccessory == true) {<!-- --></p> 
 <p>realPath = ServletActionContext.getServletContext().getRealPath("/DownloadCenter/");</p> 
 <p>relativePath += FILE_SEPARATOR + "DownloadCenter" + FILE_SEPARATOR;</p> 
 <p>filePathUrl += "/DownloadCenter/";</p> 
 <p>} else {<!-- --></p> 
 <p>realPath = ServletActionContext.getServletContext().getRealPath(BASE_ATTACH_DIR);</p> 
 <p>realPath += FILE_SEPARATOR + dirName + FILE_SEPARATOR;</p> 
 <p>relativePath += BASE_ATTACH_DIR + FILE_SEPARATOR + dirName + FILE_SEPARATOR;</p> 
 <p>filePathUrl += BASE_ATTACH_DIR + "/" + dirName + "/";</p> 
 <p>final File saveDirFile = new File(realPath);</p> 
 <p>if (!saveDirFile.exists()) {<!-- --></p> 
 <p>saveDirFile.mkdirs();</p> 
 <p>}</p> 
 <p>// 构造日期目录</p> 
 <p>if (StringUtils.isNotEmpty(dateDir)) {<!-- --></p> 
 <p>realPath += dateDir + FILE_SEPARATOR;</p> 
 <p>relativePath += dateDir + FILE_SEPARATOR;</p> 
 <p>filePathUrl += dateDir + "/";</p> 
 <p>final File dirFile = new File(realPath);</p> 
 <p>if (!dirFile.exists()) {<!-- --></p> 
 <p>dirFile.mkdirs();</p> 
 <p>}</p> 
 <p>}</p> 
 <p>}</p> 
 <p>final PathSupport ps = new PathSupport();</p> 
 <p>ps.setRealPath(realPath);</p> 
 <p>ps.setRelativePath(relativePath);</p> 
 <p>ps.setUrl(filePathUrl);</p> 
 <p>return ps;</p> 
 <p>}</p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/26c8b8a60a51ebab7434d5a17638b92a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">java class.forname_java 中的class.forName()是什么意思</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/44f67cac468c53161144d3ba8e95e6cd/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">java kafka 消费_java实现Kafka的消费者示例</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>