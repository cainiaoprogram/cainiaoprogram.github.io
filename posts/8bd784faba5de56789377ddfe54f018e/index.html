<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android12 HttpCanary系统证书安装 Magisk模块movecert - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Android12 HttpCanary系统证书安装 Magisk模块movecert" />
<meta property="og:description" content="手机：pixel 6
系统：Android 12
HttpCanary高级版 想要无限制使用高级功能的可以参照我的这篇文章实战 逆向最新黄鸟抓包软件
HttpCanary证书的安装 之前我一直使用的Android 8，证书可以直接通过HttpCanary安装，但Android 12系统好像不可以了，提示信息如下：
分析了以下安卓的源码，在com.android.certinstaller.CredentialHelper类下的hasOnlyVpnAndAppsTrustAnchors方法是限制的证书安装的关键方法，源码如下：
如果这个证书用于应用和VPN则返回true，因此只要hook它让其永远返回false就绕过了CA证书安装的限制，我根据此原理写了一个名叫BypassCertLimit的Xposed模块，链接在文末。
我手机安装的是LSPosed，其使用步骤如下：
首先激活该模块
然后点击该模块进入目标软件的选择，点击右上方的三个点，再点击隐藏
取消系统应用的选择
然后搜索cert，找到证书安装程序并选择
最后强制停止HttpCanary让该模块生效，之后就能正常安装CA证书了，如图：
至此证书已经安装在了用户凭据中了，但安卓7.0以后，安卓不信任用户安装的证书，所以抓https时无法解码请求，对于第三方应用，需要将证书添加为系统证书
那么如何添加呢？其核心步骤就是把证书移动到/system/etc/security/cacerts/路径下，这就需要重新挂载/system为可读可写，可是android 12不允许挂载该目录的，root用户也不可以，解决方案见下文。
把用户凭据移动至系统凭据 该解决方法采用了Magisk模块，我安装的Magisk版本为v25.1，这个版本已经不支持在线安装模块了，因此我使用了FoxMagiskModuleManager进行了替代，链接：https://github.com/Fox2Code/FoxMagiskModuleManager
移动证书的模块是movecert，链接：https://github.com/Magisk-Modules-Repo/movecert，下载zip包后移动到/sdcard/Download路径下，使用FoxMagiskModuleManager从本地进行安装，这个模块不能直接通过Magisk进行安装，我已经试过了，安装之后重启，用户证书就全部移动到系统证书里了
安装包：
BypassCertLimit
FoxMmm-0.5.4.apk
movecert-1.9" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/8bd784faba5de56789377ddfe54f018e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-09-13T14:49:01+08:00" />
<meta property="article:modified_time" content="2022-09-13T14:49:01+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android12 HttpCanary系统证书安装 Magisk模块movecert</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>手机：pixel 6<br> 系统：Android 12</p> 
<h3><a id="HttpCanary_3"></a>HttpCanary高级版</h3> 
<p>想要无限制使用高级功能的可以参照我的这篇文章<a href="http://t.csdn.cn/kP0td" rel="nofollow">实战 逆向最新黄鸟抓包软件</a></p> 
<h3><a id="HttpCanary_6"></a>HttpCanary证书的安装</h3> 
<p>之前我一直使用的Android 8，证书可以直接通过HttpCanary安装，但Android 12系统好像不可以了，提示信息如下：</p> 
<p><img src="https://images2.imgbox.com/51/6a/wwvnc1Z7_o.png" alt="在这里插入图片描述"></p> 
<p>分析了以下安卓的源码，在com.android.certinstaller.CredentialHelper类下的hasOnlyVpnAndAppsTrustAnchors方法是限制的证书安装的关键方法，源码如下：</p> 
<p><img src="https://images2.imgbox.com/f2/2c/5B8Culvb_o.png" alt="在这里插入图片描述"><br> 如果这个证书用于应用和VPN则返回true，因此只要hook它让其永远返回false就绕过了CA证书安装的限制，我根据此原理写了一个名叫BypassCertLimit的Xposed模块，<strong>链接在文末</strong>。</p> 
<p>我手机安装的是LSPosed，其使用步骤如下：</p> 
<p>首先激活该模块<br> <img src="https://images2.imgbox.com/f3/74/lNUBt3Em_o.png" alt="在这里插入图片描述"><br> 然后点击该模块进入目标软件的选择，点击右上方的三个点，再点击隐藏</p> 
<p><img src="https://images2.imgbox.com/a6/2d/Vu7i2HHx_o.png" alt="在这里插入图片描述"><br> 取消系统应用的选择<br> <img src="https://images2.imgbox.com/3b/7b/JOPR36PK_o.png" alt="在这里插入图片描述"><br> 然后搜索cert，找到证书安装程序并选择<br> <img src="https://images2.imgbox.com/fd/51/yyOmH0kf_o.png" alt="在这里插入图片描述"><br> 最后强制停止HttpCanary让该模块生效，之后就能正常安装CA证书了，如图：<br> <img src="https://images2.imgbox.com/b6/3b/1ncGYEw8_o.png" alt="在这里插入图片描述"></p> 
<p>至此证书已经安装在了用户凭据中了，但安卓7.0以后，安卓不信任用户安装的证书，所以抓https时无法解码请求，对于第三方应用，需要将证书添加为系统证书</p> 
<p>那么如何添加呢？其核心步骤就是把证书移动到/system/etc/security/cacerts/路径下，这就需要重新挂载/system为可读可写，可是android 12不允许挂载该目录的，root用户也不可以，解决方案见下文。</p> 
<h3><a id="_36"></a>把用户凭据移动至系统凭据</h3> 
<p>该解决方法采用了Magisk模块，我安装的Magisk版本为v25.1，这个版本已经不支持在线安装模块了，因此我使用了FoxMagiskModuleManager进行了替代，链接：https://github.com/Fox2Code/FoxMagiskModuleManager</p> 
<p>移动证书的模块是movecert，链接：https://github.com/Magisk-Modules-Repo/movecert，下载zip包后移动到/sdcard/Download路径下，使用FoxMagiskModuleManager从本地进行安装，这个模块不能直接通过Magisk进行安装，我已经试过了，安装之后重启，用户证书就全部移动到系统证书里了</p> 
<p><img src="https://images2.imgbox.com/e9/25/CQCBUsvp_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<p>安装包：<br> <a href="https://pan.baidu.com/s/19tMZPW-EvLU104YDO2P_Xg?pwd=r5n4" rel="nofollow">BypassCertLimit</a><br> <a href="https://pan.baidu.com/s/1yL5DfnbJYxY0S9fv90_tKw?pwd=qspi" rel="nofollow">FoxMmm-0.5.4.apk</a><br> <a href="https://pan.baidu.com/s/1zmuz2Mc4lNnGnjH8Es7ztA?pwd=is5f" rel="nofollow">movecert-1.9</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/310915f87009e1f77ab7164bad40899b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">NEON快速入门</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/38e9f36a2b735d476b585994421d1bd9/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">vscode单步调试不进入库代码</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>