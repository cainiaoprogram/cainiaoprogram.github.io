<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>hive2.0.1执行存储过程 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="hive2.0.1执行存储过程" />
<meta property="og:description" content="1、编写过程sql
基于上篇文章的test_db库，vi test.sql，新增：
use test_db; begin insert into t_test2(id,name) values(2,&#39;你好&#39;); insert into t_test2(id,name) values(3,&#39;你好&#39;); insert into t_test2(id,name) values(4,&#39;你好&#39;); delete from t_test2 where id=1; select * from t_test2; end; 2、执行sql
hplsql -f test.sql，报错： java.sql.SQLException: Could not open client transport with JDBC Uri: jdbc:hive2://localhost:10000: java.net.ConnectException: Connection refused (Connection refused) ... Caused by: java.net.ConnectException: Connection refused (Connection refused) 3、解决方案
在hive的conf下新建 hplsql-site.xml 并添加以下内容，即
vi /data/server/apache-hive-2.0.1-bin/conf/hplsql-site.xml &lt;configuration&gt; &lt;property&gt; &lt;name&gt;hplsql.conn.default&lt;/name&gt; &lt;value&gt;hive2conn&lt;/value&gt; &lt;description&gt;The default connection profile&lt;/description&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;hplsql." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/870145d29239260999b28da5a5ca7acd/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-06-21T11:57:36+08:00" />
<meta property="article:modified_time" content="2021-06-21T11:57:36+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">hive2.0.1执行存储过程</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>1、编写过程sql<br> 基于上篇文章的test_db库，vi test.sql，新增：</p> 
<pre><code class="language-sql">use test_db;
begin
insert into t_test2(id,name) values(2,'你好');
insert into t_test2(id,name) values(3,'你好');
insert into t_test2(id,name) values(4,'你好');
delete from t_test2 where id=1;
select * from t_test2;
end;</code></pre> 
<p>2、执行sql</p> 
<pre><code class="language-bash">hplsql -f test.sql，报错：
java.sql.SQLException: Could not open client transport with JDBC Uri: jdbc:hive2://localhost:10000: java.net.ConnectException: Connection refused (Connection refused)
...
Caused by: java.net.ConnectException: Connection refused (Connection refused)</code></pre> 
<p>3、解决方案<br> 在hive的conf下新建 hplsql-site.xml 并添加以下内容，即</p> 
<pre><code class="language-bash">vi /data/server/apache-hive-2.0.1-bin/conf/hplsql-site.xml</code></pre> 
<pre><code class="language-XML">&lt;configuration&gt;
&lt;property&gt;
  &lt;name&gt;hplsql.conn.default&lt;/name&gt;
  &lt;value&gt;hive2conn&lt;/value&gt;
  &lt;description&gt;The default connection profile&lt;/description&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hplsql.conn.hive2conn&lt;/name&gt;
  &lt;!--设置hive节点的主机名,配置用户名密码(用户名建议写root，密码随意写)--&gt;
 &lt;value&gt;org.apache.hive.jdbc.HiveDriver;jdbc:hive2://node1:10000;root;123456&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hplsql.conn.init.hiveconn2&lt;/name&gt;
  &lt;value&gt;
     set mapred.job.queue.name=dev;
     set hive.execution.engine=mr;
     use default;
  &lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hplsql.conn.convert.hive2conn&lt;/name&gt;
  &lt;value&gt;true&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hplsql.conn.mysqlconn&lt;/name&gt;
  &lt;!--数据库连接格式 com.mysql.jdbc.Driver;jdbc:mysql://hive的数据库IP:hive的数据库端口/hive库名;数据库用户名;数据库密码--&gt;
  &lt;value&gt;com.mysql.jdbc.Driver;jdbc:mysql://192.168.1.166:3306/hive;root;123456&lt;/value&gt;
  &lt;description&gt;MySQL connection&lt;/description&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hplsql.dual.table&lt;/name&gt;
  &lt;value&gt;default.dual&lt;/value&gt;
  &lt;description&gt;Single row, single column table for internal operations&lt;/description&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hplsql.insert.values&lt;/name&gt;
  &lt;value&gt;default.dual&lt;/value&gt;
  &lt;description&gt;Single row, single column table for internal operations&lt;/description&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hplsql.insert.values&lt;/name&gt;
  &lt;value&gt;native&lt;/value&gt;
  &lt;description&gt;How to execute INSERT VALUES statement: native (default) and select&lt;/description&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hplsql.onerror&lt;/name&gt;
  &lt;value&gt;exception&lt;/value&gt;
  &lt;description&gt;Error handling behavior: exception (default), seterror and stop&lt;/description&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hplsql.temp.tables&lt;/name&gt;
  &lt;value&gt;native&lt;/value&gt;
  &lt;description&gt;Temporary tables: native (default) and managed&lt;/description&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hplsql.temp.tables.schema&lt;/name&gt;
  &lt;value&gt;&lt;/value&gt;
  &lt;description&gt;Schema for managed temporary tables&lt;/description&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hplsql.temp.tables.location&lt;/name&gt;
  &lt;value&gt;/tmp/plhql&lt;/value&gt;
  &lt;description&gt;LOcation for managed temporary tables in HDFS&lt;/description&gt;
&lt;/property&gt;
&lt;/configuration&gt;</code></pre> 
<p>4、重新执行sql</p> 
<pre><code class="language-bash">[root@node1 ~]# hplsql -f test.sql
which: no hbase in (/usr/lib64/qt-3.3/bin:/data/server/apache-hive-2.0.1-bin/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/usr/java/jdk1.8.0_172-amd64/bin:/data/server/hadoop-2.6.0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/usr/java/jdk1.8.0_172-amd64/bin:/data/server/hadoop-2.6.0/Sbin:/root/bin)
SLF4J: Class path contains multiple SLF4J bindings.
SLF4J: Found binding in [jar:file:/data/server/apache-hive-2.0.1-bin/lib/log4j-slf4j-impl-2.4.1.jar!/org/slf4j/impl/StaticLoggerBinder.class]
SLF4J: Found binding in [jar:file:/data/server/hadoop-2.6.0/share/hadoop/common/lib/slf4j-log4j12-1.7.5.jar!/org/slf4j/impl/StaticLoggerBinder.class]
SLF4J: See http://www.slf4j.org/codes.html#multiple_bindings for an explanation.
SLF4J: Actual binding is of type [org.apache.logging.slf4j.Log4jLoggerFactory]
Open connection: jdbc:hive2://node1:10000 (238 ms)
Starting SQL statement
SQL statement executed successfully (238 ms)
Starting SQL statement
SQL statement executed successfully (238 ms)
Starting SQL statement
SQL statement executed successfully (238 ms)
Starting SQL statement
SQL statement executed successfully (238 ms)
Starting SQL statement
SQL statement executed successfully (238 ms)
Starting query
Query executed successfully (216 ms)
2    你好
4    你好
3    你好</code></pre> 
<p>以上，成功！</p> 
<p>参考资料：</p> 
<p><a href="http://lxw1234.com/archives/2015/09/490.htm" rel="nofollow">http://lxw1234.com/archives/2015/09/490.htm</a></p> 
<p><a href="https://blog.csdn.net/smile0198/article/details/52343997">https://blog.csdn.net/smile0198/article/details/52343997</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1c560ee33bea6fd602b6a5713c6e6842/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">计算机网络 运输层笔记</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0360e5b2a888212f3de62021da4d8757/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">用 JavaScript 实现手势库 — 封装手势库【前端组件化】</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>