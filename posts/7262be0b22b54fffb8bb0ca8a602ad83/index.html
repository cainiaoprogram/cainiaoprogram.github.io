<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>一小时掌握：使用ScrapySharp和C#打造新闻下载器 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="一小时掌握：使用ScrapySharp和C#打造新闻下载器" />
<meta property="og:description" content="引言 爬虫技术是指通过编程的方式，自动从互联网上获取和处理数据的技术。爬虫技术有很多应用场景，比如搜索引擎、数据分析、舆情监测、电商比价等。爬虫技术也是一门有趣的技术，可以让你发现网络上的各种有价值的信息。
本文将介绍如何使用ScrapySharp和C#语言，打造一个简单的新闻下载器，可以从指定的新闻网站上抓取新闻标题、摘要、正文、作者、发布时间等信息，并保存到本地文件中。本文的目的是让你在一小时内掌握ScrapySharp和C#的基本用法，以及爬虫技术的基本原理和技巧。
ScrapySharp和C#的介绍 ScrapySharp是一个基于.NET的爬虫框架，它提供了一系列的类和方法，可以方便地实现爬虫的功能，比如发送请求、解析响应、提取数据、保存数据等。ScrapySharp的核心类是ScrapingBrowser，它模拟了一个浏览器的行为，可以执行JavaScript、处理Cookie、设置代理等。ScrapySharp还支持CSS选择器和XPath语法，可以灵活地定位网页中的元素。
C#是一种面向对象的编程语言，它是.NET平台的主要语言，可以运行在Windows、Linux、Mac等操作系统上。C#语言简洁、强大、高效，拥有丰富的类库和工具，可以开发各种类型的应用程序，包括桌面应用、网站、移动应用、游戏等。C#还支持多线程编程，可以充分利用CPU的资源，提高程序的性能。
新闻下载器的设计 本文的新闻下载器的设计思路如下：
首先，定义一个News类，用来存储新闻的各种属性，比如标题、摘要、正文、作者、发布时间等。然后，定义一个NewsDownloader类，用来实现新闻下载器的主要逻辑，包括以下几个方法： 构造方法，用来初始化ScrapingBrowser对象，设置代理、超时、用户代理等参数。GetNewsUrls方法，用来从指定的新闻网站的首页上，获取所有新闻的链接，并返回一个字符串列表。GetNewsContent方法，用来从指定的新闻链接上，获取新闻的内容，并返回一个News对象。SaveNews方法，用来将一个News对象保存到本地文件中，文件名为新闻的标题，文件格式为txt。DownloadNews方法，用来下载所有新闻，并保存到本地文件夹中，文件夹名为新闻网站的域名。 最后，定义一个Program类，用来作为程序的入口，创建一个NewsDownloader对象，并调用其DownloadNews方法，传入要爬取的新闻网站的地址。 新闻下载器的代码 本文的新闻下载器的代码如下：
using System; using System.Collections.Generic; using System.IO; using System.Linq; using System.Net; using System.Text; using System.Threading.Tasks; using HtmlAgilityPack; using ScrapySharp.Extensions; using ScrapySharp.Network; namespace NewsDownloader { // 定义一个News类，用来存储新闻的各种属性 public class News { public string Title { get; set; } // 标题 public string Summary { get; set; } // 摘要 public string Content { get; set; } // 正文 public string Author { get; set; } // 作者 public string Time { get; set; } // 发布时间 } // 定义一个NewsDownloader类，用来实现新闻下载器的主要逻辑 public class NewsDownloader { private ScrapingBrowser browser; // 定义一个ScrapingBrowser对象，用来模拟浏览器的行为 //亿牛云 设置爬虫代理加强版 private string proxyDomain = &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/7262be0b22b54fffb8bb0ca8a602ad83/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-11T14:29:46+08:00" />
<meta property="article:modified_time" content="2024-01-11T14:29:46+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">一小时掌握：使用ScrapySharp和C#打造新闻下载器</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="httpsimgblogcsdnimgcnimg_convert4fec8b03a9fa1fdd6ba3e688a7171fa8png_0"></a><img src="https://images2.imgbox.com/1a/e5/2xuklbxZ_o.png" alt="亿牛云"></h2> 
<h3><a id="_2"></a>引言</h3> 
<p>爬虫技术是指通过编程的方式，自动从互联网上获取和处理数据的技术。爬虫技术有很多应用场景，比如搜索引擎、数据分析、舆情监测、电商比价等。爬虫技术也是一门有趣的技术，可以让你发现网络上的各种有价值的信息。</p> 
<p>本文将介绍如何使用ScrapySharp和C#语言，打造一个简单的新闻下载器，可以从指定的新闻网站上抓取新闻标题、摘要、正文、作者、发布时间等信息，并保存到本地文件中。本文的目的是让你在一小时内掌握ScrapySharp和C#的基本用法，以及爬虫技术的基本原理和技巧。</p> 
<h4><a id="ScrapySharpC_8"></a>ScrapySharp和C#的介绍</h4> 
<p>ScrapySharp是一个基于.NET的爬虫框架，它提供了一系列的类和方法，可以方便地实现爬虫的功能，比如发送请求、解析响应、提取数据、保存数据等。ScrapySharp的核心类是ScrapingBrowser，它模拟了一个浏览器的行为，可以执行JavaScript、处理Cookie、设置代理等。ScrapySharp还支持CSS选择器和XPath语法，可以灵活地定位网页中的元素。</p> 
<p>C#是一种面向对象的编程语言，它是.NET平台的主要语言，可以运行在Windows、Linux、Mac等操作系统上。C#语言简洁、强大、高效，拥有丰富的类库和工具，可以开发各种类型的应用程序，包括桌面应用、网站、移动应用、游戏等。C#还支持多线程编程，可以充分利用CPU的资源，提高程序的性能。</p> 
<h4><a id="_14"></a>新闻下载器的设计</h4> 
<p>本文的新闻下载器的设计思路如下：</p> 
<ul><li>首先，定义一个News类，用来存储新闻的各种属性，比如标题、摘要、正文、作者、发布时间等。</li><li>然后，定义一个NewsDownloader类，用来实现新闻下载器的主要逻辑，包括以下几个方法： 
  <ul><li>构造方法，用来初始化ScrapingBrowser对象，设置代理、超时、用户代理等参数。</li><li>GetNewsUrls方法，用来从指定的新闻网站的首页上，获取所有新闻的链接，并返回一个字符串列表。</li><li>GetNewsContent方法，用来从指定的新闻链接上，获取新闻的内容，并返回一个News对象。</li><li>SaveNews方法，用来将一个News对象保存到本地文件中，文件名为新闻的标题，文件格式为txt。</li><li>DownloadNews方法，用来下载所有新闻，并保存到本地文件夹中，文件夹名为新闻网站的域名。</li></ul> </li><li>最后，定义一个Program类，用来作为程序的入口，创建一个NewsDownloader对象，并调用其DownloadNews方法，传入要爬取的新闻网站的地址。</li></ul> 
<h4><a id="_27"></a>新闻下载器的代码</h4> 
<p>本文的新闻下载器的代码如下：</p> 
<pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>IO</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Linq</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Net</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Text</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">HtmlAgilityPack</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">ScrapySharp<span class="token punctuation">.</span>Extensions</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">ScrapySharp<span class="token punctuation">.</span>Network</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">NewsDownloader</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 定义一个News类，用来存储新闻的各种属性</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">News</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Title <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// 标题</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Summary <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// 摘要</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Content <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// 正文</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Author <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// 作者</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Time <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// 发布时间</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 定义一个NewsDownloader类，用来实现新闻下载器的主要逻辑</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NewsDownloader</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">private</span> <span class="token class-name">ScrapingBrowser</span> browser<span class="token punctuation">;</span> <span class="token comment">// 定义一个ScrapingBrowser对象，用来模拟浏览器的行为</span>
        <span class="token comment">//亿牛云 设置爬虫代理加强版</span>
        <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">string</span></span> proxyDomain <span class="token operator">=</span> <span class="token string">"http://www.16yun.cn"</span><span class="token punctuation">;</span> <span class="token comment">// 定义代理的域名</span>
        <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">int</span></span> proxyPort <span class="token operator">=</span> <span class="token number">9010</span><span class="token punctuation">;</span> <span class="token comment">// 定义代理的端口</span>
        <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">string</span></span> proxyUser <span class="token operator">=</span> <span class="token string">"16YUN"</span><span class="token punctuation">;</span> <span class="token comment">// 定义代理的用户名</span>
        <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">string</span></span> proxyPass <span class="token operator">=</span> <span class="token string">"16IP"</span><span class="token punctuation">;</span> <span class="token comment">// 定义代理的密码</span>

        <span class="token comment">// 构造方法，用来初始化ScrapingBrowser对象，设置代理、超时、用户代理等参数</span>
        <span class="token keyword">public</span> <span class="token function">NewsDownloader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            browser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ScrapingBrowser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            browser<span class="token punctuation">.</span>Timeout <span class="token operator">=</span> TimeSpan<span class="token punctuation">.</span><span class="token function">FromSeconds</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置超时时间为10秒</span>
            browser<span class="token punctuation">.</span>UserAgent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">FakeUserAgent</span><span class="token punctuation">(</span><span class="token string">"Chrome"</span><span class="token punctuation">,</span> <span class="token number">88.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置用户代理为Chrome 88.0</span>
            browser<span class="token punctuation">.</span>UseDefaultCookiesParser <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// 禁用默认的Cookie解析器</span>
            browser<span class="token punctuation">.</span>Proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">WebProxy</span><span class="token punctuation">(</span>proxyDomain<span class="token punctuation">,</span> proxyPort<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置代理</span>
            browser<span class="token punctuation">.</span>Proxy<span class="token punctuation">.</span>Credentials <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">NetworkCredential</span><span class="token punctuation">(</span>proxyUser<span class="token punctuation">,</span> proxyPass<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置代理的凭证</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// GetNewsUrls方法，用来从指定的新闻网站的首页上，获取所有新闻的链接，并返回一个字符串列表</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> <span class="token function">GetNewsUrls</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> url<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> newsUrls <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 定义一个字符串列表，用来存储新闻的链接</span>
            <span class="token keyword">try</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">WebPage</span> homePage <span class="token operator">=</span> browser<span class="token punctuation">.</span><span class="token function">NavigateToPage</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Uri</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使用ScrapingBrowser对象访问新闻网站的首页，并获取WebPage对象</span>
                <span class="token class-name">HtmlNode</span> homeNode <span class="token operator">=</span> homePage<span class="token punctuation">.</span>Html<span class="token punctuation">;</span> <span class="token comment">// 从WebPage对象中获取HtmlNode对象，表示网页的HTML文档</span>
                <span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>HtmlNode<span class="token punctuation">&gt;</span></span> newsNodes <span class="token operator">=</span> homeNode<span class="token punctuation">.</span><span class="token function">CssSelect</span><span class="token punctuation">(</span><span class="token string">"a[href*='/news/']"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使用CSS选择器，从HtmlNode对象中获取所有包含'/news/'的a标签的HtmlNode对象，表示新闻的链接</span>
                <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">HtmlNode</span> newsNode <span class="token keyword">in</span> newsNodes<span class="token punctuation">)</span> <span class="token comment">// 遍历所有新闻的链接</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token class-name"><span class="token keyword">string</span></span> newsUrl <span class="token operator">=</span> newsNode<span class="token punctuation">.</span><span class="token function">GetAttributeValue</span><span class="token punctuation">(</span><span class="token string">"href"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 从HtmlNode对象中获取href属性的值，表示新闻的链接</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>newsUrl <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>newsUrls<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>newsUrl<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 如果新闻的链接不为空，且不在字符串列表中</span>
                    <span class="token punctuation">{<!-- --></span>
                        newsUrls<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>newsUrl<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将新闻的链接添加到字符串列表中</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token comment">// 捕获异常</span>
            <span class="token punctuation">{<!-- --></span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"GetNewsUrls error: "</span> <span class="token operator">+</span> ex<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 在控制台输出异常信息</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> newsUrls<span class="token punctuation">;</span> <span class="token comment">// 返回字符串列表</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// GetNewsContent方法，用来从指定的新闻链接上，获取新闻的内容，并返回一个News对象</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">News</span> <span class="token function">GetNewsContent</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> url<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">News</span> news <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">News</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 定义一个News对象，用来存储新闻的内容</span>
            <span class="token keyword">try</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">WebPage</span> newsPage <span class="token operator">=</span> browser<span class="token punctuation">.</span><span class="token function">NavigateToPage</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Uri</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使用ScrapingBrowser对象访问新闻的链接，并获取WebPage对象</span>
                <span class="token class-name">HtmlNode</span> newsNode <span class="token operator">=</span> newsPage<span class="token punctuation">.</span>Html<span class="token punctuation">;</span> <span class="token comment">// 从WebPage对象中获取HtmlNode对象，表示网页的HTML文档</span>
                <span class="token class-name">HtmlNode</span> titleNode <span class="token operator">=</span> newsNode<span class="token punctuation">.</span><span class="token function">CssSelect</span><span class="token punctuation">(</span><span class="token string">"h1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">FirstOrDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使用CSS选择器，从HtmlNode对象中获取第一个h1标签的HtmlNode对象，表示新闻的标题</span>
                <span class="token class-name">HtmlNode</span> summaryNode <span class="token operator">=</span> newsNode<span class="token punctuation">.</span><span class="token function">CssSelect</span><span class="token punctuation">(</span><span class="token string">"p.summary"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">FirstOrDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使用CSS选择器，从HtmlNode对象中获取第一个p标签，且class属性为summary的HtmlNode对象，表示新闻的摘要</span>
                <span class="token class-name">HtmlNode</span> contentNode <span class="token operator">=</span> newsNode<span class="token punctuation">.</span><span class="token function">CssSelect</span><span class="token punctuation">(</span><span class="token string">"div.article-content"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">FirstOrDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使用CSS选择器，从HtmlNode对象中获取第一个div标签，且class属性为article-content的HtmlNode对象，表示新闻的正文</span>
                <span class="token class-name">HtmlNode</span> authorNode <span class="token operator">=</span> newsNode<span class="token punctuation">.</span><span class="token function">CssSelect</span><span class="token punctuation">(</span><span class="token string">"span.author"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">FirstOrDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使用CSS选择器，从HtmlNode对象中获取第一个span标签，且class属性为author的HtmlNode对象，表示新闻的作者</span>
                <span class="token class-name">HtmlNode</span> timeNode <span class="token operator">=</span> newsNode<span class="token punctuation">.</span><span class="token function">CssSelect</span><span class="token punctuation">(</span><span class="token string">"span.time"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">FirstOrDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使用CSS选择器，从HtmlNode对象中获取第一个span标签，且class属性为time的HtmlNode对象，表示新闻的发布时间</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>titleNode <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token comment">// 如果标题节点不为空</span>
                <span class="token punctuation">{<!-- --></span>
                    news<span class="token punctuation">.</span>Title <span class="token operator">=</span> titleNode<span class="token punctuation">.</span>InnerText<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 从HtmlNode对象中获取文本内容，并去除两端的空白字符，赋值给News对象的Title属性</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>summaryNode <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token comment">// 如果摘要节点不为空</span>
                <span class="token punctuation">{<!-- --></span>
                    news<span class="token punctuation">.</span>Summary <span class="token operator">=</span> summaryNode<span class="token punctuation">.</span>InnerText<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 从HtmlNode对象中获取文本内容，并去除两端的空白字符，赋值给News对象的Summary属性</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>contentNode <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token comment">// 如果正文节点不为空</span>
                <span class="token punctuation">{<!-- --></span>
                    news<span class="token punctuation">.</span>Content <span class="token operator">=</span> contentNode<span class="token punctuation">.</span>InnerText<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 从HtmlNode对象中获取文本内容，并去除两端的空白字符，赋值给News对象的Content属性</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>authorNode <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token comment">// 如果作者节点不为空</span>
                <span class="token punctuation">{<!-- --></span>
                    news<span class="token punctuation">.</span>Author <span class="token operator">=</span> authorNode<span class="token punctuation">.</span>InnerText<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 从HtmlNode对象中获取文本内容，并去除两端的空白字符，赋值给News对象的Author属性</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>timeNode <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token comment">// 如果时间节点不为空</span>
                <span class="token punctuation">{<!-- --></span>
                    news<span class="token punctuation">.</span>Time <span class="token operator">=</span> timeNode<span class="token punctuation">.</span>InnerText<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 从HtmlNode对象中获取文本内容，并去除两端的空白字符，赋值给News对象的Time属性</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token comment">// 捕获异常</span>
            <span class="token punctuation">{<!-- --></span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"GetNewsContent error: "</span> <span class="token operator">+</span> ex<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 在控制台输出异常信息</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> news<span class="token punctuation">;</span> <span class="token comment">// 返回News对象</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// SaveNews方法，用来将一个News对象保存到本地文件中，文件名为新闻的标题，文件格式为txt</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SaveNews</span><span class="token punctuation">(</span><span class="token class-name">News</span> news<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> folder<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">try</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token class-name"><span class="token keyword">string</span></span> fileName <span class="token operator">=</span> news<span class="token punctuation">.</span>Title <span class="token operator">+</span> <span class="token string">".txt"</span><span class="token punctuation">;</span> <span class="token comment">// 定义文件名为新闻的标题加上.txt后缀</span>
                <span class="token class-name"><span class="token keyword">string</span></span> filePath <span class="token operator">=</span> Path<span class="token punctuation">.</span><span class="token function">Combine</span><span class="token punctuation">(</span>folder<span class="token punctuation">,</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 定义文件路径为文件夹和文件名的组合</span>
                <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">StreamWriter</span> writer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StreamWriter</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 使用StreamWriter对象，以UTF-8编码，覆盖模式，打开或创建文件</span>
                <span class="token punctuation">{<!-- --></span>
                    writer<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"标题："</span> <span class="token operator">+</span> news<span class="token punctuation">.</span>Title<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 写入新闻的标题</span>
                    writer<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"摘要："</span> <span class="token operator">+</span> news<span class="token punctuation">.</span>Summary<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 写入新闻的摘要</span>
                    writer<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"正文："</span> <span class="token operator">+</span> news<span class="token punctuation">.</span>Content<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 写入新闻的正文</span>
                    writer<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"作者："</span> <span class="token operator">+</span> news<span class="token punctuation">.</span>Author<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 写入新闻的作者</span>
                    writer<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"时间："</span> <span class="token operator">+</span> news<span class="token punctuation">.</span>Time<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 写入新闻的时间</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token comment">// 捕获异常</span>
            <span class="token punctuation">{<!-- --></span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"SaveNews error: "</span> <span class="token operator">+</span> ex<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 在控制台输出异常信息</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// DownloadNews方法，用来下载所有新闻，并保存到本地文件夹中，文件夹名为新闻网站的域名</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">DownloadNews</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> url<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">try</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">Uri</span> uri <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Uri</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 定义一个Uri对象，表示新闻网站的地址</span>
                <span class="token class-name"><span class="token keyword">string</span></span> folder <span class="token operator">=</span> uri<span class="token punctuation">.</span>Host<span class="token punctuation">;</span> <span class="token comment">// 定义文件夹名为Uri对象的Host属性，表示新闻网站的域名</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Directory<span class="token punctuation">.</span><span class="token function">Exists</span><span class="token punctuation">(</span>folder<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 如果文件夹不存在</span>
                <span class="token punctuation">{<!-- --></span>
                    Directory<span class="token punctuation">.</span><span class="token function">CreateDirectory</span><span class="token punctuation">(</span>folder<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建文件夹</span>
                <span class="token punctuation">}</span>
                <span class="token class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> newsUrls <span class="token operator">=</span> <span class="token function">GetNewsUrls</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用GetNewsUrls方法，获取所有新闻的链接</span>
                Parallel<span class="token punctuation">.</span><span class="token function">ForEach</span><span class="token punctuation">(</span>newsUrls<span class="token punctuation">,</span> newsUrl <span class="token operator">=&gt;</span> <span class="token comment">// 使用Parallel类的ForEach方法，对所有新闻的链接进行并行处理，提高采集效率</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token class-name">News</span> news <span class="token operator">=</span> <span class="token function">GetNewsContent</span><span class="token punctuation">(</span>newsUrl<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用GetNewsContent方法，获取新闻的内容</span>
                    <span class="token function">SaveNews</span><span class="token punctuation">(</span>news<span class="token punctuation">,</span> folder<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用SaveNews方法，将新闻保存到本地文件中</span>
                    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Downloaded: "</span> <span class="token operator">+</span> news<span class="token punctuation">.</span>Title<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 在控制台输出下载成功的新闻的标题</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Download completed!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 在控制台输出下载完成的提示</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token comment">// 捕获异常</span>
            <span class="token punctuation">{<!-- --></span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"DownloadNews error: "</span> <span class="token operator">+</span> ex<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 在控制台输出异常信息</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 定义一个Program类，用来作为程序的入口</span>
    <span class="token keyword">class</span> <span class="token class-name">Program</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">NewsDownloader</span> downloader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">NewsDownloader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建一个NewsDownloader对象</span>
            downloader<span class="token punctuation">.</span><span class="token function">DownloadNews</span><span class="token punctuation">(</span><span class="token string">"https://www.bbc.com/news"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用其DownloadNews方法，传入要爬取的新闻网站的地址</span>
            Console<span class="token punctuation">.</span><span class="token function">ReadKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 等待用户按键</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_204"></a>结论</h3> 
<p>本文介绍了如何使用ScrapySharp和C#语言，打造一个简单的新闻下载器，可以从指定的新闻网站上抓取新闻标题、摘要、正文、作者、发布时间等信息，并保存到本地文件中。本文的目的是让你在一小时内掌握ScrapySharp和C#的基本用法，以及爬虫技术的基本原理和技巧。</p> 
<p>本文的技术文章和代码仅供参考，你可以根据自己的需求和兴趣，修改或扩展它们，实现更多的功能，比如添加异常处理、日志记录、数据清洗、数据分析等。希望本文能对你的学习和开发有所帮助。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b285067311720d55bf939f6e0e6f4669/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">数据结构实验5：二叉树的应用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9303985074e567c6fda56ed46456b044/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">关于LINUX操作系统异常宕机重启的分析思路</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>