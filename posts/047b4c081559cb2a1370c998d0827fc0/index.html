<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>STM32CubeMX学习笔记（10）——SPI接口使用(读写SPI Flash W25Q64) - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="STM32CubeMX学习笔记（10）——SPI接口使用(读写SPI Flash W25Q64)" />
<meta property="og:description" content="一、SPI简介 SPI（Serial Peripheral Interface） 协议是由摩托罗拉公司提出的通讯协议，即串行外围设备接口，是一种高速全双工的通信总线。它被广泛地使用在 ADC、LCD 等设备与 MCU 间，要求通讯速率较高的场合。
芯片的管脚上只占用四根线。
MISO： 主器件数据输入，从器件数据输出。
MOSI：主器件数据输出，从器件数据输入。
SCK： 时钟信号，由主设备控制发出。
NSS（CS）： 从设备选择信号，由主设备控制。当NSS为低电平则选中从器件。
二、引脚分布 STM32 芯片有多个 SPI 外设，它们的 SPI 通讯信号引出到不同的 GPIO 引脚上，使用时必须配置到这些指定的引脚。其中 SPI1 是 APB2 上的设备，最高通信速率达 36Mbtis/s，SPI2、SPI3 是 APB1 上的设备，最高通信速率为 18Mbits/s。除了通讯速率，在其它功能上没有差异。其中 SPI3 用到了下载接口的引脚，这几个引脚默认功能是下载，第二功能才是 IO 口，如果想使用 SPI3 接口，则程序上必须先禁用掉这几个 IO 口的下载功能。一般在资源不是十分紧张的情况下，这几个 IO 口是专门用于下载和调试程序，不会复用为 SPI3。
三、FLASH芯片 开发板中的 FLASH 芯片型号：W25Q64。W25Q 系列为台湾华邦公司推出的是一种使用 SPI 通讯协议的 NOR FLASH 存储器。芯片型号后两位表示芯片容量，例如 W25Q64 的 64 就是指 64Mbit 也就是 8M 的容量。它的 CS/CLK/DIO/DO 引脚分别连接到了 STM32 对应的 SPI 引脚 NSS/SCK/MOSI/MISO 上，其中 STM32 的 NSS 引脚虽然是其片上 SPI 外设的硬件引脚，但实际上后面的程序只是把它当成一个普通的 GPIO，使用软件的方式控制 NSS 信号，所以在 SPI 的硬件设计中，NSS 可以随便选择普通的 GPIO，不必纠结于选择硬件 NSS 信号。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/047b4c081559cb2a1370c998d0827fc0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-09T23:49:25+08:00" />
<meta property="article:modified_time" content="2023-08-09T23:49:25+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">STM32CubeMX学习笔记（10）——SPI接口使用(读写SPI Flash W25Q64)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="SPI_0"></a>一、SPI简介</h2> 
<blockquote> 
 <p><strong>SPI（Serial Peripheral Interface）</strong> 协议是由摩托罗拉公司提出的通讯协议，即串行外围设备接口，是一种高速全双工的通信总线。它被广泛地使用在 ADC、LCD 等设备与 MCU 间，要求通讯速率较高的场合。</p> 
 <p>芯片的管脚上只占用四根线。<br> MISO： 主器件数据输入，从器件数据输出。<br> MOSI：主器件数据输出，从器件数据输入。<br> SCK： 时钟信号，由主设备控制发出。<br> NSS（CS）： 从设备选择信号，由主设备控制。当NSS为低电平则选中从器件。</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/6f/4a/ofyQnJIF_o.png" alt=""></p> 
<h2><a id="_11"></a>二、引脚分布</h2> 
<p><img src="https://images2.imgbox.com/b4/56/6ZnCcaAi_o.png" alt=""></p> 
<p>STM32 芯片有多个 SPI 外设，它们的 SPI 通讯信号引出到不同的 GPIO 引脚上，使用时必须配置到这些指定的引脚。其中 SPI1 是 APB2 上的设备，最高通信速率达 <strong>36Mbtis/s</strong>，SPI2、SPI3 是 APB1 上的设备，最高通信速率为 <strong>18Mbits/s</strong>。除了通讯速率，在其它功能上没有差异。<code>其中 SPI3 用到了下载接口的引脚，这几个引脚默认功能是下载，第二功能才是 IO 口，如果想使用 SPI3 接口，则程序上必须先禁用掉这几个 IO 口的下载功能。一般在资源不是十分紧张的情况下，这几个 IO 口是专门用于下载和调试程序，不会复用为 SPI3。</code></p> 
<h2><a id="FLASH_16"></a>三、FLASH芯片</h2> 
<p>开发板中的 FLASH 芯片型号：<strong>W25Q64</strong>。W25Q 系列为台湾华邦公司推出的是一种使用 SPI 通讯协议的 NOR FLASH 存储器。芯片型号后两位表示芯片容量，例如 W25Q64 的 64 就是指 64Mbit 也就是 8M 的容量。它的 CS/CLK/DIO/DO 引脚分别连接到了 STM32 对应的 SPI 引脚 NSS/SCK/MOSI/MISO 上，其中 STM32 的 NSS 引脚虽然是其片上 SPI 外设的硬件引脚，但实际上后面的程序只是把它当成一个普通的 GPIO，使用软件的方式控制 NSS 信号，所以在 SPI 的硬件设计中，NSS 可以随便选择普通的 GPIO，不必纠结于选择硬件 NSS 信号。</p> 
<p>FLASH 芯片中还有 WP 和 HOLD 引脚。WP 引脚可控制写保护功能，当该引脚为低电平时，禁止写入数据。我们直接接电源，不使用写保护功能。HOLD 引脚可用于暂停通讯，该引脚为低电平时，通讯暂停，数据输出引脚输出高阻抗状态，时钟和数据输入引脚无效。我们直接接电源，不使用通讯暂停功能。<br> <img src="https://images2.imgbox.com/6d/80/Dq36QEwa_o.png" alt=""><br> 通过控制 STM32 利用 SPI 总线向 FLASH 芯片发送指令，FLASH 芯片收到后就会执行相应的操作。<br> <img src="https://images2.imgbox.com/1d/79/hLMveOwc_o.png" alt=""><br> <img src="https://images2.imgbox.com/bc/d7/u7FZhGld_o.png" alt=""></p> 
<p>主机首先通过 MOSI 线向 FLASH 芯片发送第一个字节数据为“9F h”，当 FLASH 芯片收到该数据后，它会解读成主机向它发送了“JEDEC 指令”，然后它就作出该命令的响应：通过 MISO 线把它的厂商 ID(M7-M0)及芯片类型(ID15-0)发送给主机，主机接收到指令响应后可进行校验。常见的应用是主机端通过读取设备 ID 来测试硬件是否连接正常，或用于识别设备。</p> 
<p>对于 FLASH 芯片的其它指令，都是类似的，只是有的指令包含多个字节，或者响应包含更多的数据。</p> 
<p>实际上，编写设备驱动都是有一定的规律可循的。首先我们要确定设备使用的是什么通讯协议。如上一章的 EEPROM 使用的是 I2C，本章的 FLASH 使用的是 SPI。那么我们就先根据它的通讯协议，选择好 STM32 的硬件模块，并进行相应的 I2C 或 SPI 模块初始化。接着，我们要了解目标设备的相关指令，因为不同的设备，都会有相应的不同的指令。如 EEPROM 中会把第一个数据解释为内部存储矩阵的地址(实质就是指令)。而 FLASH 则定义了更多的指令，有写指令，读指令，读 ID 指令等等。最后，我们根据这些指令的格式要求，使用通讯协议向设备发送指令，达到控制设备的目标。</p> 
<h2><a id="_31"></a>四、新建工程</h2> 
<p><strong>1. 打开 STM32CubeMX 软件，点击“新建工程”</strong><br> <img src="https://images2.imgbox.com/36/2e/syvR93OD_o.png" alt=""></p> 
<p><strong>2. 选择 MCU 和封装</strong><br> <img src="https://images2.imgbox.com/ff/3e/NBsy8KEF_o.png" alt=""></p> 
<p><strong>3. 配置时钟</strong><br> RCC 设置，选择 HSE(外部高速时钟) 为 Crystal/Ceramic Resonator(晶振/陶瓷谐振器)<br> <img src="https://images2.imgbox.com/49/bc/WWpw6xrc_o.png" alt=""><br> 选择 Clock Configuration，配置系统时钟 SYSCLK 为 72MHz<br> 修改 HCLK 的值为 72 后，输入回车，软件会自动修改所有配置<br> <img src="https://images2.imgbox.com/99/4f/0NVaToOa_o.png" alt=""></p> 
<p><strong>4. 配置调试模式</strong><br> <strong>非常重要的一步，否则会造成第一次烧录程序后续无法识别调试器</strong><br> SYS 设置，选择 Debug 为 Serial Wire<br> <img src="https://images2.imgbox.com/db/77/zlV0SaKb_o.png" alt=""></p> 
<h2><a id="SPI1_51"></a>五、SPI1</h2> 
<h3><a id="51__52"></a>5.1 参数配置</h3> 
<p>在 <code>Connectivity</code> 中选择 <code>SPI1</code> 设置，并选择 <code>Full-Duplex Master</code> 全双工主模式，<code>不开启 NSS</code> 即不使用硬件片选信号</p> 
<p><img src="https://images2.imgbox.com/07/40/hXJTaCcY_o.png" alt=""></p> 
<blockquote> 
 <p>原理图中虽然将 CS 片选接到了硬件 SPI1 的 NSS 引脚，因为硬件 NSS 使用比较麻烦，所以后面直接把 PA4 配置为普通 GPIO，手动控制片选信号。</p> 
</blockquote> 
<p>在右边图中找到 SPI1 NSS 对应引脚，选择 <code>GPIO_Output</code>。<strong><code>纠正：野火STM32F103指南者开发板SPI1 NSS须配置为PC0</code></strong></p> 
<p><img src="https://images2.imgbox.com/99/6c/TUJvIXmt_o.png" alt=""></p> 
<p>修改输出高电平 <code>High</code>，标签为 <code>W25Q64_CHIP_SELECT</code>。<br> <img src="https://images2.imgbox.com/1d/ef/CyhfGPvV_o.png" alt=""></p> 
<p>SPI 为默认设置不作修改。只需注意一下，<code>Prescaler</code> 分频系数最低为 <code>4</code>，波特率 (Baud Rate) 为 <code>18.0 MBits/s</code>。这里被限制了，SPI1 最高通信速率可达 36Mbtis/s。<br> <img src="https://images2.imgbox.com/0e/97/Zne1w6zw_o.png" alt=""></p> 
<ul><li><strong>Clock Polarity(CPOL)</strong>：SPI 通讯设备处于空闲状态时，SCK 信号线的电平信号(即 SPI 通讯开始前、 NSS 线为高电平时 SCK 的状态)。CPOL=0 时， SCK 在空闲状态时为低电平，CPOL=1 时，则相反。</li><li><strong>Clock Phase(CPHA)</strong>：指数据的采样的时刻，当 CPHA=0 时，MOSI 或 MISO 数据线上的信号将会在 SCK 时钟线的“奇数边沿”被采样。当 CPHA=1 时，数据线在 SCK 的“偶数边沿”采样。<br> <img src="https://images2.imgbox.com/86/c7/D6eIDIL5_o.png" alt=""><br> 根据 FLASH 芯片的说明，它支持 SPI <code>模式0</code> 及 <code>模式 3</code>，支持双线全双工，使用 MSB 先行模式，数据帧长度为 8 位。<br> <img src="https://images2.imgbox.com/91/b2/3qoaREp5_o.png" alt=""><br> 所以这里配置 CPOL 为 <code>Low</code>，CPHA 为 <code>1 Edge</code> 即 SPI <code>模式0</code>。<br> <img src="https://images2.imgbox.com/40/c0/mOjbnhiT_o.png" alt=""></li></ul> 
<h3><a id="52__76"></a>5.2 生成代码</h3> 
<p>输入项目名和项目路径<br> <img src="https://images2.imgbox.com/20/e3/IIHH22hX_o.png" alt=""><br> 选择应用的 IDE 开发环境 MDK-ARM V5<br> <img src="https://images2.imgbox.com/ef/4d/7T9HsHjL_o.png" alt=""><br> 每个外设生成独立的 <code>’.c/.h’</code> 文件<br> 不勾：所有初始化代码都生成在 main.c<br> 勾选：初始化代码生成在对应的外设文件。 如 GPIO 初始化代码生成在 gpio.c 中。<br> <img src="https://images2.imgbox.com/90/60/wotqWlzC_o.png" alt=""><br> 点击 GENERATE CODE 生成代码<br> <img src="https://images2.imgbox.com/8e/d1/UgOsrJWf_o.png" alt=""></p> 
<h3><a id="53_SPI_FlashW25Q64_88"></a>5.3 封装SPI Flash(W25Q64)的命令和底层函数</h3> 
<ul><li>向 SPI Flash 发送数据的函数</li></ul> 
<pre><code class="prism language-cpp"><span class="token comment">/**
 * @brief    SPI发送指定长度的数据
 * @param    buf  —— 发送数据缓冲区首地址
 * @param    size —— 要发送数据的字节数
 * @retval   成功返回HAL_OK
 */</span>
<span class="token keyword">static</span> HAL_StatusTypeDef <span class="token function">SPI_Transmit</span><span class="token punctuation">(</span><span class="token keyword">uint8_t</span><span class="token operator">*</span> send_buf<span class="token punctuation">,</span> <span class="token keyword">uint16_t</span> size<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token function">HAL_SPI_Transmit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hspi1<span class="token punctuation">,</span> send_buf<span class="token punctuation">,</span> size<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>从 SPI Flash 接收数据的函数</li></ul> 
<pre><code class="prism language-cpp"><span class="token comment">/**
 * @brief   SPI接收指定长度的数据
 * @param   buf  —— 接收数据缓冲区首地址
 * @param   size —— 要接收数据的字节数
 * @retval  成功返回HAL_OK
 */</span>
<span class="token keyword">static</span> HAL_StatusTypeDef <span class="token function">SPI_Receive</span><span class="token punctuation">(</span><span class="token keyword">uint8_t</span><span class="token operator">*</span> recv_buf<span class="token punctuation">,</span> <span class="token keyword">uint16_t</span> size<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
   <span class="token keyword">return</span> <span class="token function">HAL_SPI_Receive</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hspi1<span class="token punctuation">,</span> recv_buf<span class="token punctuation">,</span> size<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>发送数据的同时读取数据的函数</li></ul> 
<pre><code class="prism language-cpp"><span class="token comment">/**
 * @brief   SPI在发送数据的同时接收指定长度的数据
 * @param   send_buf  —— 接收数据缓冲区首地址
 * @param   recv_buf  —— 接收数据缓冲区首地址
 * @param   size —— 要发送/接收数据的字节数
 * @retval  成功返回HAL_OK
 */</span>
<span class="token keyword">static</span> HAL_StatusTypeDef <span class="token function">SPI_TransmitReceive</span><span class="token punctuation">(</span><span class="token keyword">uint8_t</span><span class="token operator">*</span> send_buf<span class="token punctuation">,</span> <span class="token keyword">uint8_t</span><span class="token operator">*</span> recv_buf<span class="token punctuation">,</span> <span class="token keyword">uint16_t</span> size<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
   <span class="token keyword">return</span> <span class="token function">HAL_SPI_TransmitReceive</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hspi1<span class="token punctuation">,</span> send_buf<span class="token punctuation">,</span> recv_buf<span class="token punctuation">,</span> size<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="54_W25Q64_129"></a>5.4 编写W25Q64的驱动程序</h3> 
<h4><a id="541__Manufacture_ID__Device_ID_130"></a>5.4.1 读取 Manufacture ID 和 Device ID</h4> 
<p>读取 Flash 内部这两个 ID 有两个作用：</p> 
<ul><li>检测 SPI Flash 是否存在</li><li>可以根据 ID 判断 Flash 具体型号<br> <img src="https://images2.imgbox.com/52/49/f1POJpng_o.png" alt=""></li></ul> 
<pre><code class="prism language-cpp"><span class="token comment">/**
 * @brief   读取Flash内部的ID
 * @param   none
 * @retval  成功返回device_id
 */</span>
<span class="token keyword">uint16_t</span> <span class="token function">W25QXX_ReadID</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">uint8_t</span> recv_buf<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token comment">//recv_buf[0]存放Manufacture ID, recv_buf[1]存放Device ID</span>
    <span class="token keyword">uint16_t</span> device_id <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">uint8_t</span> send_data<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>ManufactDeviceID_CMD<span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">}</span><span class="token punctuation">;</span>   <span class="token comment">//待发送数据，命令+地址</span>
    
    <span class="token comment">/* 使能片选 */</span>
    <span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>W25Q64_CHIP_SELECT_GPIO_Port<span class="token punctuation">,</span> W25Q64_CHIP_SELECT_Pin<span class="token punctuation">,</span> GPIO_PIN_RESET<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">/* 发送并读取数据 */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>HAL_OK <span class="token operator">==</span> <span class="token function">SPI_Transmit</span><span class="token punctuation">(</span>send_data<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>HAL_OK <span class="token operator">==</span> <span class="token function">SPI_Receive</span><span class="token punctuation">(</span>recv_buf<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
        <span class="token punctuation">{<!-- --></span>
            device_id <span class="token operator">=</span> <span class="token punctuation">(</span>recv_buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">|</span> recv_buf<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">/* 取消片选 */</span>
    <span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>W25Q64_CHIP_SELECT_GPIO_Port<span class="token punctuation">,</span> W25Q64_CHIP_SELECT_Pin<span class="token punctuation">,</span> GPIO_PIN_SET<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> device_id<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="542_Flash_165"></a>5.4.2 读取状态寄存器数据并判断Flash是否忙碌</h4> 
<p>SPI Flash 的所有操作都是靠发送命令完成的，但是 Flash 接收到命令后，需要一段时间去执行该操作，这段时间内 Flash 处于“忙”状态，MCU 发送的命令无效，不能执行，在 Flash 内部有 2-3 个状态寄存器，指示出 Flash 当前的状态，有趣的一点是：</p> 
<p>当 Flash 内部在执行命令时，不能再执行 MCU 发来的命令，但是 <strong>MCU 可以一直读取状态寄存器，这下就很好办了，MCU可以一直读取，然后判断 Flash 是否忙完。</strong><br> <img src="https://images2.imgbox.com/90/e4/5GyQuHR1_o.png" alt=""><br> <img src="https://images2.imgbox.com/f5/1a/PdJciqee_o.png" alt=""></p> 
<pre><code class="prism language-cpp"><span class="token comment">/**
 * @brief     读取W25QXX的状态寄存器，W25Q64一共有2个状态寄存器
 * @param     reg  —— 状态寄存器编号(1~2)
 * @retval    状态寄存器的值
 */</span>
<span class="token keyword">static</span> <span class="token keyword">uint8_t</span> <span class="token function">W25QXX_ReadSR</span><span class="token punctuation">(</span><span class="token keyword">uint8_t</span> reg<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">uint8_t</span> result <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 
    <span class="token keyword">uint8_t</span> send_buf<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">switch</span><span class="token punctuation">(</span>reg<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
            send_buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> READ_STATU_REGISTER_1<span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>
            send_buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> READ_STATU_REGISTER_2<span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            send_buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> READ_STATU_REGISTER_1<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
     <span class="token comment">/* 使能片选 */</span>
    <span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>W25Q64_CHIP_SELECT_GPIO_Port<span class="token punctuation">,</span> W25Q64_CHIP_SELECT_Pin<span class="token punctuation">,</span> GPIO_PIN_RESET<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span>HAL_OK <span class="token operator">==</span> <span class="token function">SPI_Transmit</span><span class="token punctuation">(</span>send_buf<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>HAL_OK <span class="token operator">==</span> <span class="token function">SPI_Receive</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>result<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
        <span class="token punctuation">{<!-- --></span>
            <span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>W25Q64_CHIP_SELECT_GPIO_Port<span class="token punctuation">,</span> W25Q64_CHIP_SELECT_Pin<span class="token punctuation">,</span> GPIO_PIN_SET<span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token keyword">return</span> result<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">/* 取消片选 */</span>
    <span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>W25Q64_CHIP_SELECT_GPIO_Port<span class="token punctuation">,</span> W25Q64_CHIP_SELECT_Pin<span class="token punctuation">,</span> GPIO_PIN_SET<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>然后编写<strong>阻塞判断</strong> Flash 是否忙碌的函数：</p> 
<pre><code class="prism language-cpp"><span class="token comment">/**
 * @brief	阻塞等待Flash处于空闲状态
 * @param   none
 * @retval  none
 */</span>
<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">W25QXX_Wait_Busy</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">W25QXX_ReadSR</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x01</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0x01</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 等待BUSY位清空</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="543__223"></a>5.4.3 读取数据</h4> 
<p>SPI Flash 读取数据可以任意地址（地址长度32bit）读任意长度数据（最大 65535 Byte），没有任何限制。<br> <img src="https://images2.imgbox.com/dd/13/vOnfuF1z_o.png" alt=""></p> 
<pre><code class="prism language-cpp"><span class="token comment">/**
 * @brief   读取SPI FLASH数据
 * @param   buffer      —— 数据存储区
 * @param   start_addr  —— 开始读取的地址(最大32bit)
 * @param   nbytes      —— 要读取的字节数(最大65535)
 * @retval  成功返回0，失败返回-1
 */</span>
<span class="token keyword">int</span> <span class="token function">W25QXX_Read</span><span class="token punctuation">(</span><span class="token keyword">uint8_t</span><span class="token operator">*</span> buffer<span class="token punctuation">,</span> <span class="token keyword">uint32_t</span> start_addr<span class="token punctuation">,</span> <span class="token keyword">uint16_t</span> nbytes<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">uint8_t</span> cmd <span class="token operator">=</span> READ_DATA_CMD<span class="token punctuation">;</span>
    
    start_addr <span class="token operator">=</span> start_addr <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span>
    
	<span class="token function">W25QXX_Wait_Busy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
     <span class="token comment">/* 使能片选 */</span>
    <span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>W25Q64_CHIP_SELECT_GPIO_Port<span class="token punctuation">,</span> W25Q64_CHIP_SELECT_Pin<span class="token punctuation">,</span> GPIO_PIN_RESET<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">SPI_Transmit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>cmd<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span>HAL_OK <span class="token operator">==</span> <span class="token function">SPI_Transmit</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">uint8_t</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>start_addr<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>HAL_OK <span class="token operator">==</span> <span class="token function">SPI_Receive</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> nbytes<span class="token punctuation">)</span><span class="token punctuation">)</span> 
        <span class="token punctuation">{<!-- --></span>
            <span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>W25Q64_CHIP_SELECT_GPIO_Port<span class="token punctuation">,</span> W25Q64_CHIP_SELECT_Pin<span class="token punctuation">,</span> GPIO_PIN_SET<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>W25Q64_CHIP_SELECT_GPIO_Port<span class="token punctuation">,</span> W25Q64_CHIP_SELECT_Pin<span class="token punctuation">,</span> GPIO_PIN_SET<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="544__260"></a>5.4.4 写使能/禁止</h4> 
<p>Flash 芯片默认禁止写数据，所以<strong>在向 Flash 写数据之前，必须发送命令开启写使能。</strong><br> <img src="https://images2.imgbox.com/06/e0/IE30IJTk_o.png" alt=""><br> <img src="https://images2.imgbox.com/07/37/RQYbaoi5_o.png" alt=""></p> 
<pre><code class="prism language-cpp"><span class="token comment">/**
 * @brief    W25QXX写使能,将S1寄存器的WEL置位
 * @param    none
 * @retval
 */</span>
<span class="token keyword">void</span> <span class="token function">W25QXX_Write_Enable</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">uint8_t</span> cmd<span class="token operator">=</span> WRITE_ENABLE_CMD<span class="token punctuation">;</span>
    
    <span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>W25Q64_CHIP_SELECT_GPIO_Port<span class="token punctuation">,</span> W25Q64_CHIP_SELECT_Pin<span class="token punctuation">,</span> GPIO_PIN_RESET<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">SPI_Transmit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>cmd<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>W25Q64_CHIP_SELECT_GPIO_Port<span class="token punctuation">,</span> W25Q64_CHIP_SELECT_Pin<span class="token punctuation">,</span> GPIO_PIN_SET<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">W25QXX_Wait_Busy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token comment">/**
 * @brief    W25QXX写禁止,将WEL清零
 * @param    none
 * @retval    none
 */</span>
<span class="token keyword">void</span> <span class="token function">W25QXX_Write_Disable</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">uint8_t</span> cmd <span class="token operator">=</span> WRITE_DISABLE_CMD<span class="token punctuation">;</span>

    <span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>W25Q64_CHIP_SELECT_GPIO_Port<span class="token punctuation">,</span> W25Q64_CHIP_SELECT_Pin<span class="token punctuation">,</span> GPIO_PIN_RESET<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">SPI_Transmit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>cmd<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>W25Q64_CHIP_SELECT_GPIO_Port<span class="token punctuation">,</span> W25Q64_CHIP_SELECT_Pin<span class="token punctuation">,</span> GPIO_PIN_SET<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">W25QXX_Wait_Busy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="545__302"></a>5.4.5 擦除扇区</h4> 
<p>SPI Flash有个特性：</p> 
<p><strong>数据位可以由1变为0，但是不能由0变为1。</strong></p> 
<p>所以在向 Flash 写数据之前，必须要先进行擦除操作，并且 Flash <strong>最小只能擦除一个扇区</strong>，擦除之后该扇区所有的数据变为 <code>0xFF</code>（即全为1）。<br> <img src="https://images2.imgbox.com/b1/d3/0oI91b2N_o.png" alt=""></p> 
<pre><code class="prism language-cpp"><span class="token comment">/**
 * @brief    W25QXX擦除一个扇区
 * @param   sector_addr    —— 扇区地址 根据实际容量设置
 * @retval  none
 * @note    阻塞操作
 */</span>
<span class="token keyword">void</span> <span class="token function">W25QXX_Erase_Sector</span><span class="token punctuation">(</span><span class="token keyword">uint32_t</span> sector_addr<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">uint8_t</span> cmd <span class="token operator">=</span> SECTOR_ERASE_CMD<span class="token punctuation">;</span>
    
    sector_addr <span class="token operator">*=</span> <span class="token number">4096</span><span class="token punctuation">;</span>    <span class="token comment">//每个块有16个扇区，每个扇区的大小是4KB，需要换算为实际地址</span>
    sector_addr <span class="token operator">&lt;&lt;=</span> <span class="token number">8</span><span class="token punctuation">;</span>
    
    <span class="token function">W25QXX_Write_Enable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//擦除操作即写入0xFF，需要开启写使能</span>
    <span class="token function">W25QXX_Wait_Busy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//等待写使能完成</span>
   
     <span class="token comment">/* 使能片选 */</span>
    <span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>W25Q64_CHIP_SELECT_GPIO_Port<span class="token punctuation">,</span> W25Q64_CHIP_SELECT_Pin<span class="token punctuation">,</span> GPIO_PIN_RESET<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">SPI_Transmit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>cmd<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">SPI_Transmit</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">uint8_t</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>sector_addr<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>W25Q64_CHIP_SELECT_GPIO_Port<span class="token punctuation">,</span> W25Q64_CHIP_SELECT_Pin<span class="token punctuation">,</span> GPIO_PIN_SET<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">W25QXX_Wait_Busy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">//等待扇区擦除完成</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="546__338"></a>5.4.6 页写入操作</h4> 
<p>向 Flash 芯片写数据的时候，因为 Flash 内部的构造，可以按页写入。<br> <img src="https://images2.imgbox.com/f3/4a/n00M2nd0_o.png" alt=""><br> <img src="https://images2.imgbox.com/e5/fe/QQScWu3Q_o.png" alt=""></p> 
<pre><code class="prism language-cpp"><span class="token comment">/**
 * @brief    页写入操作
 * @param    dat —— 要写入的数据缓冲区首地址
 * @param    WriteAddr —— 要写入的地址
 * @param   byte_to_write —— 要写入的字节数（0-256）
 * @retval    none
 */</span>
<span class="token keyword">void</span> <span class="token function">W25QXX_Page_Program</span><span class="token punctuation">(</span><span class="token keyword">uint8_t</span><span class="token operator">*</span> dat<span class="token punctuation">,</span> <span class="token keyword">uint32_t</span> WriteAddr<span class="token punctuation">,</span> <span class="token keyword">uint16_t</span> nbytes<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">uint8_t</span> cmd <span class="token operator">=</span> PAGE_PROGRAM_CMD<span class="token punctuation">;</span>
    
    WriteAddr <span class="token operator">&lt;&lt;=</span> <span class="token number">8</span><span class="token punctuation">;</span>
    
    <span class="token function">W25QXX_Write_Enable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">/* 使能片选 */</span>
    <span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>W25Q64_CHIP_SELECT_GPIO_Port<span class="token punctuation">,</span> W25Q64_CHIP_SELECT_Pin<span class="token punctuation">,</span> GPIO_PIN_RESET<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">SPI_Transmit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>cmd<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">SPI_Transmit</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">uint8_t</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>WriteAddr<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">SPI_Transmit</span><span class="token punctuation">(</span>dat<span class="token punctuation">,</span> nbytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>W25Q64_CHIP_SELECT_GPIO_Port<span class="token punctuation">,</span> W25Q64_CHIP_SELECT_Pin<span class="token punctuation">,</span> GPIO_PIN_SET<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">W25QXX_Wait_Busy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="55__372"></a>5.5 添加宏定义和全局变量</h3> 
<pre><code class="prism language-cpp"><span class="token comment">/* Private define ------------------------------------------------------------*/</span>
<span class="token comment">/* USER CODE BEGIN PD */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">ManufactDeviceID_CMD</span>	<span class="token expression"><span class="token number">0x90</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">READ_STATU_REGISTER_1</span>   <span class="token expression"><span class="token number">0x05</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">READ_STATU_REGISTER_2</span>   <span class="token expression"><span class="token number">0x35</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">READ_DATA_CMD</span>	        <span class="token expression"><span class="token number">0x03</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">WRITE_ENABLE_CMD</span>	    <span class="token expression"><span class="token number">0x06</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">WRITE_DISABLE_CMD</span>	    <span class="token expression"><span class="token number">0x04</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SECTOR_ERASE_CMD</span>	    <span class="token expression"><span class="token number">0x20</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CHIP_ERASE_CMD</span>	        <span class="token expression"><span class="token number">0xc7</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">PAGE_PROGRAM_CMD</span>        <span class="token expression"><span class="token number">0x02</span></span></span>
<span class="token comment">/* USER CODE END PD */</span>

<span class="token comment">/* Private user code ---------------------------------------------------------*/</span>
SPI_HandleTypeDef hspi1<span class="token punctuation">;</span>

UART_HandleTypeDef huart1<span class="token punctuation">;</span>

<span class="token comment">/* USER CODE BEGIN PV */</span>
<span class="token keyword">uint16_t</span> device_id<span class="token punctuation">;</span>
<span class="token keyword">uint8_t</span> read_buf<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">uint8_t</span> write_buf<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> i<span class="token punctuation">;</span>
<span class="token comment">/* USER CODE END PV */</span>
</code></pre> 
<h3><a id="56__399"></a>5.6 添加测试函数</h3> 
<pre><code class="prism language-cpp"><span class="token comment">/**
  * @brief  The application entry point.
  * @retval int
  */</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token comment">/* USER CODE BEGIN 1 */</span>

  <span class="token comment">/* USER CODE END 1 */</span>

  <span class="token comment">/* MCU Configuration--------------------------------------------------------*/</span>

  <span class="token comment">/* Reset of all peripherals, Initializes the Flash interface and the Systick. */</span>
  <span class="token function">HAL_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* USER CODE BEGIN Init */</span>

  <span class="token comment">/* USER CODE END Init */</span>

  <span class="token comment">/* Configure the system clock */</span>
  <span class="token function">SystemClock_Config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* USER CODE BEGIN SysInit */</span>

  <span class="token comment">/* USER CODE END SysInit */</span>

  <span class="token comment">/* Initialize all configured peripherals */</span>
  <span class="token function">MX_GPIO_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">MX_USART1_UART_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">MX_SPI1_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">/* USER CODE BEGIN 2 */</span>
  device_id <span class="token operator">=</span> <span class="token function">W25QXX_ReadID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"W25Q64 Device ID is 0x%04x\r\n"</span><span class="token punctuation">,</span> device_id<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* 为了验证，首先读取要写入地址处的数据 */</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-------- read data before write -----------\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">W25QXX_Read</span><span class="token punctuation">(</span>read_buf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
  <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{<!-- --></span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[0x%08x]:0x%02x\r\n"</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">(</span>read_buf<span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
    
  <span class="token comment">/* 擦除该扇区 */</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-------- erase sector 0 -----------\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">W25QXX_Erase_Sector</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* 再次读数据 */</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-------- read data after erase -----------\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">W25QXX_Read</span><span class="token punctuation">(</span>read_buf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{<!-- --></span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[0x%08x]:0x%02x\r\n"</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">(</span>read_buf<span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
    
  <span class="token comment">/* 写数据 */</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-------- write data -----------\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{<!-- --></span>
    write_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">W25QXX_Page_Program</span><span class="token punctuation">(</span>write_buf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
  <span class="token comment">/* 再次读数据 */</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-------- read data after write -----------\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">W25QXX_Read</span><span class="token punctuation">(</span>read_buf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{<!-- --></span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[0x%08x]:0x%02x\r\n"</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">(</span>read_buf<span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">/* USER CODE END 2 */</span>

  <span class="token comment">/* Infinite loop */</span>
  <span class="token comment">/* USER CODE BEGIN WHILE */</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">{<!-- --></span>
    <span class="token comment">/* USER CODE END WHILE */</span>

    <span class="token comment">/* USER CODE BEGIN 3 */</span>
  <span class="token punctuation">}</span>
  <span class="token comment">/* USER CODE END 3 */</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="57__484"></a>5.7 查看打印</h3> 
<p>串口打印功能查看 <a href="https://blog.csdn.net/qq_36347513/article/details/112654724">STM32CubeMX学习笔记（6）——USART串口使用</a><br> <img src="https://images2.imgbox.com/a6/32/Br5CkZZc_o.png" alt=""></p> 
<h3><a id="58_HAL_488"></a>5.8 HAL库与标准库代码比较</h3> 
<p>STM32CubeMX 使用 HAL 库生成的代码：</p> 
<pre><code class="prism language-cpp"><span class="token comment">/**
  * @brief GPIO Initialization Function
  * @param None
  * @retval None
  */</span>
<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">MX_GPIO_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
  GPIO_InitTypeDef GPIO_InitStruct <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">/* GPIO Ports Clock Enable */</span>
  <span class="token function">__HAL_RCC_GPIOC_CLK_ENABLE</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/*Configure GPIO pin Output Level */</span>
  <span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>W25Q64_CHIP_SELECT_GPIO_Port<span class="token punctuation">,</span> W25Q64_CHIP_SELECT_Pin<span class="token punctuation">,</span> GPIO_PIN_SET<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/*Configure GPIO pin : W25Q64_CHIP_SELECT_Pin */</span>
  GPIO_InitStruct<span class="token punctuation">.</span>Pin <span class="token operator">=</span> W25Q64_CHIP_SELECT_Pin<span class="token punctuation">;</span>
  GPIO_InitStruct<span class="token punctuation">.</span>Mode <span class="token operator">=</span> GPIO_MODE_OUTPUT_PP<span class="token punctuation">;</span>
  GPIO_InitStruct<span class="token punctuation">.</span>Pull <span class="token operator">=</span> GPIO_NOPULL<span class="token punctuation">;</span>
  GPIO_InitStruct<span class="token punctuation">.</span>Speed <span class="token operator">=</span> GPIO_SPEED_FREQ_LOW<span class="token punctuation">;</span>
  <span class="token function">HAL_GPIO_Init</span><span class="token punctuation">(</span>W25Q64_CHIP_SELECT_GPIO_Port<span class="token punctuation">,</span> <span class="token operator">&amp;</span>GPIO_InitStruct<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief SPI1 Initialization Function
  * @param None
  * @retval None
  */</span>
<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">MX_SPI1_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token comment">/* USER CODE BEGIN SPI1_Init 0 */</span>

  <span class="token comment">/* USER CODE END SPI1_Init 0 */</span>

  <span class="token comment">/* USER CODE BEGIN SPI1_Init 1 */</span>

  <span class="token comment">/* USER CODE END SPI1_Init 1 */</span>
  <span class="token comment">/* SPI1 parameter configuration*/</span>
  hspi1<span class="token punctuation">.</span>Instance <span class="token operator">=</span> SPI1<span class="token punctuation">;</span>
  hspi1<span class="token punctuation">.</span>Init<span class="token punctuation">.</span>Mode <span class="token operator">=</span> SPI_MODE_MASTER<span class="token punctuation">;</span>
  hspi1<span class="token punctuation">.</span>Init<span class="token punctuation">.</span>Direction <span class="token operator">=</span> SPI_DIRECTION_2LINES<span class="token punctuation">;</span>
  hspi1<span class="token punctuation">.</span>Init<span class="token punctuation">.</span>DataSize <span class="token operator">=</span> SPI_DATASIZE_8BIT<span class="token punctuation">;</span>
  hspi1<span class="token punctuation">.</span>Init<span class="token punctuation">.</span>CLKPolarity <span class="token operator">=</span> SPI_POLARITY_LOW<span class="token punctuation">;</span>
  hspi1<span class="token punctuation">.</span>Init<span class="token punctuation">.</span>CLKPhase <span class="token operator">=</span> SPI_PHASE_1EDGE<span class="token punctuation">;</span>
  hspi1<span class="token punctuation">.</span>Init<span class="token punctuation">.</span>NSS <span class="token operator">=</span> SPI_NSS_SOFT<span class="token punctuation">;</span>
  hspi1<span class="token punctuation">.</span>Init<span class="token punctuation">.</span>BaudRatePrescaler <span class="token operator">=</span> SPI_BAUDRATEPRESCALER_4<span class="token punctuation">;</span>
  hspi1<span class="token punctuation">.</span>Init<span class="token punctuation">.</span>FirstBit <span class="token operator">=</span> SPI_FIRSTBIT_MSB<span class="token punctuation">;</span>
  hspi1<span class="token punctuation">.</span>Init<span class="token punctuation">.</span>TIMode <span class="token operator">=</span> SPI_TIMODE_DISABLE<span class="token punctuation">;</span>
  hspi1<span class="token punctuation">.</span>Init<span class="token punctuation">.</span>CRCCalculation <span class="token operator">=</span> SPI_CRCCALCULATION_DISABLE<span class="token punctuation">;</span>
  hspi1<span class="token punctuation">.</span>Init<span class="token punctuation">.</span>CRCPolynomial <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">HAL_SPI_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hspi1<span class="token punctuation">)</span> <span class="token operator">!=</span> HAL_OK<span class="token punctuation">)</span>
  <span class="token punctuation">{<!-- --></span>
    <span class="token function">Error_Handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">/* USER CODE BEGIN SPI1_Init 2 */</span>

  <span class="token comment">/* USER CODE END SPI1_Init 2 */</span>
<span class="token punctuation">}</span>

HAL_StatusTypeDef <span class="token function">HAL_SPI_Transmit</span><span class="token punctuation">(</span>SPI_HandleTypeDef <span class="token operator">*</span>hspi<span class="token punctuation">,</span> <span class="token keyword">uint8_t</span> <span class="token operator">*</span>pData<span class="token punctuation">,</span> <span class="token keyword">uint16_t</span> Size<span class="token punctuation">,</span> <span class="token keyword">uint32_t</span> Timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
HAL_StatusTypeDef <span class="token function">HAL_SPI_Receive</span><span class="token punctuation">(</span>SPI_HandleTypeDef <span class="token operator">*</span>hspi<span class="token punctuation">,</span> <span class="token keyword">uint8_t</span> <span class="token operator">*</span>pData<span class="token punctuation">,</span> <span class="token keyword">uint16_t</span> Size<span class="token punctuation">,</span> <span class="token keyword">uint32_t</span> Timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
HAL_StatusTypeDef <span class="token function">HAL_SPI_TransmitReceive</span><span class="token punctuation">(</span>SPI_HandleTypeDef <span class="token operator">*</span>hspi<span class="token punctuation">,</span> <span class="token keyword">uint8_t</span> <span class="token operator">*</span>pTxData<span class="token punctuation">,</span> <span class="token keyword">uint8_t</span> <span class="token operator">*</span>pRxData<span class="token punctuation">,</span> <span class="token keyword">uint16_t</span> Size<span class="token punctuation">,</span>
                                          <span class="token keyword">uint32_t</span> Timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>使用 STM32 标准库的代码：</p> 
<pre><code class="prism language-cpp"><span class="token comment">/**
  * @brief  SPI_FLASH初始化
  * @param  无
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">SPI_FLASH_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
  SPI_InitTypeDef  SPI_InitStructure<span class="token punctuation">;</span>
  GPIO_InitTypeDef GPIO_InitStructure<span class="token punctuation">;</span>
	
  <span class="token comment">/* 使能SPI时钟 */</span>
  <span class="token function">FLASH_SPI_APBxClock_FUN</span> <span class="token punctuation">(</span> FLASH_SPI_CLK<span class="token punctuation">,</span> ENABLE <span class="token punctuation">)</span><span class="token punctuation">;</span>
	
  <span class="token comment">/* 使能SPI引脚相关的时钟 */</span>
  <span class="token function">FLASH_SPI_CS_APBxClock_FUN</span> <span class="token punctuation">(</span>FLASH_SPI_CS_CLK<span class="token operator">|</span>FLASH_SPI_SCK_CLK<span class="token operator">|</span>
							FLASH_SPI_MISO_PIN<span class="token operator">|</span>FLASH_SPI_MOSI_PIN<span class="token punctuation">,</span> ENABLE <span class="token punctuation">)</span><span class="token punctuation">;</span>
	
  <span class="token comment">/* 配置SPI的 CS引脚，普通IO即可 */</span>
  GPIO_InitStructure<span class="token punctuation">.</span>GPIO_Pin <span class="token operator">=</span> FLASH_SPI_CS_PIN<span class="token punctuation">;</span>
  GPIO_InitStructure<span class="token punctuation">.</span>GPIO_Speed <span class="token operator">=</span> GPIO_Speed_50MHz<span class="token punctuation">;</span>
  GPIO_InitStructure<span class="token punctuation">.</span>GPIO_Mode <span class="token operator">=</span> GPIO_Mode_Out_PP<span class="token punctuation">;</span>
  <span class="token function">GPIO_Init</span><span class="token punctuation">(</span>FLASH_SPI_CS_PORT<span class="token punctuation">,</span> <span class="token operator">&amp;</span>GPIO_InitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
  <span class="token comment">/* 配置SPI的 SCK引脚*/</span>
  GPIO_InitStructure<span class="token punctuation">.</span>GPIO_Pin <span class="token operator">=</span> FLASH_SPI_SCK_PIN<span class="token punctuation">;</span>
  GPIO_InitStructure<span class="token punctuation">.</span>GPIO_Mode <span class="token operator">=</span> GPIO_Mode_AF_PP<span class="token punctuation">;</span>
  <span class="token function">GPIO_Init</span><span class="token punctuation">(</span>FLASH_SPI_SCK_PORT<span class="token punctuation">,</span> <span class="token operator">&amp;</span>GPIO_InitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* 配置SPI的 MISO引脚*/</span>
  GPIO_InitStructure<span class="token punctuation">.</span>GPIO_Pin <span class="token operator">=</span> FLASH_SPI_MISO_PIN<span class="token punctuation">;</span>
  <span class="token function">GPIO_Init</span><span class="token punctuation">(</span>FLASH_SPI_MISO_PORT<span class="token punctuation">,</span> <span class="token operator">&amp;</span>GPIO_InitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* 配置SPI的 MOSI引脚*/</span>
  GPIO_InitStructure<span class="token punctuation">.</span>GPIO_Pin <span class="token operator">=</span> FLASH_SPI_MOSI_PIN<span class="token punctuation">;</span>
  <span class="token function">GPIO_Init</span><span class="token punctuation">(</span>FLASH_SPI_MOSI_PORT<span class="token punctuation">,</span> <span class="token operator">&amp;</span>GPIO_InitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* 停止信号 FLASH: CS引脚高电平*/</span>
  <span class="token function">SPI_FLASH_CS_HIGH</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* SPI 模式配置 */</span>
  <span class="token comment">// FLASH芯片 支持SPI模式0及模式3，据此设置CPOL CPHA</span>
  SPI_InitStructure<span class="token punctuation">.</span>SPI_Direction <span class="token operator">=</span> SPI_Direction_2Lines_FullDuplex<span class="token punctuation">;</span>
  SPI_InitStructure<span class="token punctuation">.</span>SPI_Mode <span class="token operator">=</span> SPI_Mode_Master<span class="token punctuation">;</span>
  SPI_InitStructure<span class="token punctuation">.</span>SPI_DataSize <span class="token operator">=</span> SPI_DataSize_8b<span class="token punctuation">;</span>
  SPI_InitStructure<span class="token punctuation">.</span>SPI_CPOL <span class="token operator">=</span> SPI_CPOL_High<span class="token punctuation">;</span>
  SPI_InitStructure<span class="token punctuation">.</span>SPI_CPHA <span class="token operator">=</span> SPI_CPHA_2Edge<span class="token punctuation">;</span>
  SPI_InitStructure<span class="token punctuation">.</span>SPI_NSS <span class="token operator">=</span> SPI_NSS_Soft<span class="token punctuation">;</span>
  SPI_InitStructure<span class="token punctuation">.</span>SPI_BaudRatePrescaler <span class="token operator">=</span> SPI_BaudRatePrescaler_4<span class="token punctuation">;</span>
  SPI_InitStructure<span class="token punctuation">.</span>SPI_FirstBit <span class="token operator">=</span> SPI_FirstBit_MSB<span class="token punctuation">;</span>
  SPI_InitStructure<span class="token punctuation">.</span>SPI_CRCPolynomial <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>
  <span class="token function">SPI_Init</span><span class="token punctuation">(</span>FLASH_SPIx <span class="token punctuation">,</span> <span class="token operator">&amp;</span>SPI_InitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* 使能 SPI  */</span>
  <span class="token function">SPI_Cmd</span><span class="token punctuation">(</span>FLASH_SPIx <span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">SPI_Cmd</span><span class="token punctuation">(</span>SPI_TypeDef<span class="token operator">*</span> SPIx<span class="token punctuation">,</span> FunctionalState NewState<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">SPI_I2S_SendData</span><span class="token punctuation">(</span>SPI_TypeDef<span class="token operator">*</span> SPIx<span class="token punctuation">,</span> <span class="token keyword">uint16_t</span> Data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">uint16_t</span> <span class="token function">SPI_I2S_ReceiveData</span><span class="token punctuation">(</span>SPI_TypeDef<span class="token operator">*</span> SPIx<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h2><a id="_618"></a>六、注意事项</h2> 
<p><strong>用户代码要加在 <code>USER CODE BEGIN N</code> 和 <code>USER CODE END N</code> 之间，否则下次使用 STM32CubeMX 重新生成代码后，会被删除。</strong><br> <img src="https://images2.imgbox.com/37/43/LgG23Vei_o.png" alt=""></p> 
<hr> 
<p>• 由 <a href="https://blog.csdn.net/qq_36347513">Leung</a> 写于 2021 年 1 月 27 日</p> 
<p>• 参考：<a href="https://www.waveshare.net/study/article-649-1.html" rel="nofollow">STM32CubeMX系列教程10:串行外设接口SPI(一)</a><br> 　　　　<a href="https://www.waveshare.net/study/article-650-1.html" rel="nofollow">STM32CubeMX系列教程11:串行外设接口SPI(二)</a><br> 　　　　<a href="https://mculover666.blog.csdn.net/article/details/107589175" rel="nofollow">STM32CubeMX | 30-使用硬件SPI读写FLASH（W25Q64）</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7eb0293d7474bc72cc9d678250a9917e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">HCIA中的DHCP</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2ab8ae15cf2460834787382c995660f8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">centos7安装phpipam1.4</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>