<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>开源大数据集群部署（三）集群mysql数据库部署 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="开源大数据集群部署（三）集群mysql数据库部署" />
<meta property="og:description" content="开源大数据集群部署（一）集群实施规划
开源大数据集群部署（二）集群基础环境实施准备
作者：櫰木
本文将介绍mysql部署，其中在hd1.dtstack.com主机root权限下安装配置
1 解压文件 解压名为mysql-8.0.31-linux-glibc2.12-x86_64.tar.xz的压缩包，其内容解压到/opt/目录下。然后通过符号链接将目录/opt/mysql-8.0.31-linux-glibc2.12-x86_64/链接到/opt/mysql。
tar -xvJf mysql-8.0.31-linux-glibc2.12-x86_64.tar.xz -C /opt/ ln -s /opt/mysql-8.0.31-linux-glibc2.12-x86_64/ /opt/mysql 2 配置文件 mysql配置文件/etc/my.cnf包含了一系列参数和设置，用于配置MySQL服务器的行为和性能，具体配置内容如下：
[client] port = 3306 socket = /data/mysql8/data/mysql.sock [mysql] prompt = &#34;\u@mysql \R:\m:\s [\d]&gt;&#34; port = 3306 socket = /data/mysql8/data/mysql.sock [mysqld] # 用户 user = mysql # # 端口 port = 3306 # # 安装目录 basedir = /opt/mysql # # 数据目录 datadir = /data/mysql57/data # # sock 文件目录 socket = /data/mysql57/data/mysql.sock # # 临时文件目录 tmpdir = /data/mysql57/tmp # # 错误日志目录 log-error = /data/mysql57/logs/error." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/a7991696078b3e6dee429f389c0de446/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-09T16:28:19+08:00" />
<meta property="article:modified_time" content="2024-01-09T16:28:19+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">开源大数据集群部署（三）集群mysql数据库部署</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><a href="https://blog.csdn.net/weixin_43756308/article/details/135359883">开源大数据集群部署（一）集群实施规划</a><br> <a href="https://blog.csdn.net/weixin_43756308/article/details/135451012">开源大数据集群部署（二）集群基础环境实施准备</a></p> 
<p><em>作者：櫰木</em><br> 本文将介绍mysql部署，其中在hd1.dtstack.com主机root权限下安装配置</p> 
<h4><a id="1__6"></a>1 解压文件</h4> 
<p>解压名为mysql-8.0.31-linux-glibc2.12-x86_64.tar.xz的压缩包，其内容解压到/opt/目录下。然后通过符号链接将目录/opt/mysql-8.0.31-linux-glibc2.12-x86_64/链接到/opt/mysql。</p> 
<pre><code class="prism language-powershell">tar <span class="token operator">-</span>xvJf mysql-8<span class="token punctuation">.</span>0<span class="token punctuation">.</span>31-linux-glibc2<span class="token punctuation">.</span>12-x86_64<span class="token punctuation">.</span>tar<span class="token punctuation">.</span>xz <span class="token operator">-</span>C <span class="token operator">/</span>opt/
ln <span class="token operator">-</span>s <span class="token operator">/</span>opt/mysql-8<span class="token punctuation">.</span>0<span class="token punctuation">.</span>31-linux-glibc2<span class="token punctuation">.</span>12-x86_64/ <span class="token operator">/</span>opt/mysql
</code></pre> 
<h4><a id="2__12"></a>2 配置文件</h4> 
<p>mysql配置文件/etc/my.cnf包含了一系列参数和设置，用于配置MySQL服务器的行为和性能，具体配置内容如下：</p> 
<pre><code class="prism language-powershell"><span class="token namespace">[client]</span>
port = 3306
socket = <span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">/</span>mysql8/<span class="token keyword">data</span><span class="token operator">/</span>mysql<span class="token punctuation">.</span>sock
 
<span class="token namespace">[mysql]</span>
prompt = <span class="token string">"\u@mysql \R:\m:\s [\d]&gt;"</span>
port = 3306
 
socket = <span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">/</span>mysql8/<span class="token keyword">data</span><span class="token operator">/</span>mysql<span class="token punctuation">.</span>sock

<span class="token namespace">[mysqld]</span>
<span class="token comment"># 用户</span>
user = mysql
<span class="token comment"># # 端口</span>
port = 3306
<span class="token comment"># # 安装目录</span>
basedir = <span class="token operator">/</span>opt/mysql
<span class="token comment"># # 数据目录</span>
datadir = <span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">/</span>mysql57/<span class="token keyword">data</span>
<span class="token comment"># # sock 文件目录</span>
socket = <span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">/</span>mysql57/<span class="token keyword">data</span><span class="token operator">/</span>mysql<span class="token punctuation">.</span>sock
<span class="token comment"># # 临时文件目录</span>
tmpdir = <span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">/</span>mysql57/tmp
<span class="token comment"># # 错误日志目录</span>
log-error = <span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">/</span>mysql57/logs/error<span class="token punctuation">.</span>log
<span class="token comment"># # Server id</span>
server-id = 1
<span class="token comment"># # 二进制日志</span>
log-bin = <span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">/</span>mysql8/logs/mysql-bin
<span class="token comment"># # binlog 清理机制</span>
expire_logs_days = 10
<span class="token comment"># # 日志格式 推荐为 row</span>
binlog_format = ROW
<span class="token comment"># # 双一参数</span>
<span class="token comment"># sync_binlog = 1</span>
<span class="token comment"># # binlog 缓存 如果有大事务 可以提升 binlog 写入效率</span>
<span class="token comment"># binlog_cache_size = 4M</span>
<span class="token comment"># # binlog 使用最大内存</span>
max_binlog_cache_size = 4G
<span class="token comment"># # 单 binlog 文件大小</span>
max_binlog_size = 500M
<span class="token comment"># # 中继日志目录</span>
relay_log = <span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">/</span>mysql57/logs/mysql-relay
<span class="token comment"># # GTID</span>
<span class="token comment"># gtid_mode = on</span>
<span class="token comment"># # 强制GTID的一致性</span>
<span class="token comment"># enforce_gtid_consistency = 1</span>
<span class="token comment"># # 隔离级别</span>
transaction_isolation = <span class="token function">READ-COMMITTED</span>
<span class="token comment"># # innodb 最大缓存区 操作系统内存的 70%-80% 最佳</span>
<span class="token comment"># innodb_buffer_pool_size = 2048M</span>
<span class="token comment"># # 独立的缓冲池实例，建议每个实例大小至少为 1 G 参考 buffer pool 大小设置</span>
<span class="token comment"># innodb_buffer_pool_instances = 2</span>
<span class="token comment"># # 默认为关闭OFF。如果开启该参数，启动MySQL服务时，MySQL将本地热数据加载到InnoDB缓冲池中</span>
<span class="token comment"># innodb_buffer_pool_load_at_startup = 1</span>
<span class="token comment"># # 默认为关闭OFF。如果开启该参数，停止MySQL服务时，InnoDB将InnoDB缓冲池中的热数据保存到本地硬盘</span>
<span class="token comment"># innodb_buffer_pool_dump_at_shutdown = 1</span>
<span class="token comment"># # 共享表空间大小</span>
<span class="token comment"># innodb_data_file_path = ibdata1:500M:autoextend</span>
<span class="token comment"># # 临时表空间</span>
<span class="token comment"># innodb_temp_data_file_path = ibtmp1:200M:autoextend</span>
<span class="token comment"># # redo 刷写机制 双一参数之一</span>
<span class="token comment"># innodb_flush_log_at_trx_commit = 1</span>
<span class="token comment"># # redo buffer size</span>
<span class="token comment"># innodb_log_buffer_size = 32M</span>
<span class="token comment"># # redo 文件大小</span>
<span class="token comment"># innodb_log_file_size = 128MB</span>
<span class="token comment"># # redo 日志组数 默认为 2</span>
<span class="token comment"># innodb_log_files_in_group = 2</span>
<span class="token comment"># # 排序缓存大小</span>
<span class="token comment"># innodb_sort_buffer_size = 1048576</span>
<span class="token comment"># # doublewrite 两次写机制</span>
<span class="token comment"># innodb_doublewrite = 1</span>
<span class="token comment"># # 开启慢日志组</span>
<span class="token comment"># slow_query_log = 1</span>
<span class="token comment"># # 慢日志目录</span>
<span class="token comment"># slow_query_log_file = /data/mysql57/logs/slow.log</span>
<span class="token comment"># # 查询大于多少秒会记录到慢日志中</span>
<span class="token comment"># long_query_time = 5</span>
<span class="token comment"># # 是否记录未使用索引的 SQL</span>
<span class="token comment"># log_queries_not_using_indexes = 0</span>
<span class="token comment"># # MySQL 允许的最大连接</span>
max_connections = 1000
lower-case-table-names = 1
<span class="token comment">#跳过ssl</span>
skip_ssl
<span class="token comment"># # 单个用户限制的最大连接数，默认是不限制</span>
<span class="token comment"># max_user_connections = 64</span>
<span class="token comment"># #最大连接错误数，防止密码暴力破解</span>
<span class="token comment"># max_connect_errors = 10000</span>
<span class="token comment"># # PID 文件</span>
pid-file = mysql<span class="token punctuation">.</span>pid
<span class="token comment"># # Server 编码</span>
character-<span class="token function">set-server</span> = utf8mb4
<span class="token comment"># # Server 比较规则</span>
<span class="token comment"># collation_server = utf8mb4_general_ci</span>
<span class="token comment"># # 禁用DNS主机名查找</span>
<span class="token comment"># skip_name_resolve = 1</span>
<span class="token comment"># # 打开文件最大数量</span>
open_files_limit = 65535
<span class="token comment"># # 自动提交</span>
autocommit = 1
<span class="token comment"># # timestamp 列如果没有显式定义为 null</span>
<span class="token comment"># explicit_defaults_for_timestamp = 1</span>
</code></pre> 
<p>说明：server-id= 1服务的唯一编号，master为1</p> 
<h4><a id="3__121"></a>3 创建对应数据和日志目录</h4> 
<p>为MySQL创建数据目录、日志目录和临时目录，并设置这些目录的所有者为mysql用户和mysql用户组</p> 
<pre><code class="prism language-powershell">mkdir <span class="token operator">-</span>p <span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">/</span>mysql8/<span class="token keyword">data</span><span class="token operator">/</span>
mkdir <span class="token operator">-</span>p <span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">/</span>mysql8/logs/
mkdir <span class="token operator">-</span>p <span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">/</span>mysql8/tmp
chown mysql:mysql <span class="token operator">-</span>R <span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">/</span>mysql8
</code></pre> 
<h4><a id="4_mysql_129"></a>4 初始化mysql数据</h4> 
<p>执行MySQL服务器的初始化过程，生成初始的系统表和数据文件，从而能够启动MySQL服务器并开始使用它。</p> 
<pre><code class="prism language-powershell">cd <span class="token operator">/</span>opt/mysql
bin/mysqld <span class="token operator">--</span>initialize <span class="token operator">--</span>user=mysql <span class="token operator">--</span>basedir=<span class="token operator">/</span>opt/mysql <span class="token operator">--</span>datadir=<span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">/</span>mysql8/<span class="token keyword">data</span><span class="token operator">/</span> <span class="token operator">--</span>lower-case-table-names=1
</code></pre> 
<h4><a id="5_mysqlmysql_135"></a>5 启动服务和检查服务（mysql权限启动mysql数据库）</h4> 
<p>服务配置文件（mysqld.service）：</p> 
<pre><code class="prism language-powershell">vi <span class="token operator">/</span>etc/systemd/system/mysqld<span class="token punctuation">.</span>service
<span class="token namespace">[Unit]</span>
Description=MySQL Server 8<span class="token punctuation">.</span>0<span class="token punctuation">.</span>31
Documentation=man:mysqld<span class="token punctuation">(</span>8<span class="token punctuation">)</span>
Documentation=http:<span class="token operator">/</span><span class="token operator">/</span>dev<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>com/doc/refman/en/<span class="token keyword">using</span><span class="token operator">-</span>systemd<span class="token punctuation">.</span>html
After=network<span class="token punctuation">.</span>target
After=syslog<span class="token punctuation">.</span>target
 
<span class="token namespace">[Install]</span>
WantedBy=multi-user<span class="token punctuation">.</span>target
<span class="token namespace">[Service]</span>
User=mysql
<span class="token function">Group</span>=mysql
ExecStart=<span class="token operator">/</span>opt/mysql/bin/mysqld_safe <span class="token operator">--</span>defaults-file=<span class="token operator">/</span>etc/my<span class="token punctuation">.</span>cnf
LimitNOFILE = 5000
</code></pre> 
<p>启动MySQL服务：</p> 
<pre><code class="prism language-powershell">systemctl <span class="token function">start</span> mysqld
</code></pre> 
<p><img src="https://images2.imgbox.com/1c/c2/rysSS0Id_o.png" alt="在这里插入图片描述"><br> 状态为running表示mysql服务已经起来<br> 修改默认密码：</p> 
<pre><code class="prism language-powershell">ALTER USER <span class="token string">'root'</span>@<span class="token string">'localhost'</span> IDENTIFIED WITH mysql_native_password BY <span class="token string">'123456'</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="6__164"></a>6 创建用户</h4> 
<pre><code class="prism language-powershell">mysql&gt; CREATE USER <span class="token string">'test'</span>@<span class="token string">'%'</span> IDENTIFIED BY <span class="token string">'123456'</span><span class="token punctuation">;</span>
mysql&gt; flush privileges<span class="token punctuation">;</span>
<span class="token namespace">[mysql@hd3.dtstack.com ~]</span>$ systemctl stop  mysqld
<span class="token namespace">[mysql@hd3.dtstack.com ~]</span>$ systemctl <span class="token function">start</span> mysqld
</code></pre> 
<p>更多技术信息请查看云掣官网<a href="https://yunche.pro/?t=yrgw" rel="nofollow">https://yunche.pro/?t=yrgw</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/42965909f9db8ded26da4220ffabc0db/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Python中的科学计算和数学建模</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2248c91bcf704e6808afa3e8faabc63c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Redis服务器配置文件的常用配置</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>