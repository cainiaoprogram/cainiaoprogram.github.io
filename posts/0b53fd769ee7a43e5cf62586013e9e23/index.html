<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Struts2 表单提交 POJO - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Struts2 表单提交 POJO" />
<meta property="og:description" content="在Struts2.0里面有一个非常牛*的功能就是支持更高级的POJO访问，这句话是什么意思呢？下面来通过例子实际操作一把就能体会到这个功能的强大与好使了。 要实现的功能：如果用户输入用户名xiaozu，密码111111，则显示welcome，xiaozhu!否则提示用户名或密码错误。 下面是我们所需的文件： 登陆页面login.jsp： &lt;%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=utf-8&#34;%&gt; &lt;%@ taglib prefix=&#34;s&#34; uri=&#34;/struts-tags&#34; %&gt; &lt;!DOCTYPE html PUBLIC &#34;-//W 3C //DTD HTML 4.01 Transitional//EN&#34; &#34;http://www.w3.org/TR/html4/loose.dtd&#34;&gt; &lt;html&gt; &lt;head&gt; &lt;title&gt;登陆页面&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;s:form action=&#34;/test/loginAction.action&#34; method=&#34;post&#34;&gt; &lt;s:textfield name=&#34;userName&#34; label=&#34;用户名&#34;/&gt; &lt;s:password name=&#34;password&#34; label=&#34;密码&#34;/&gt; &lt;s:submit/&gt; &lt;/s:form&gt; &lt;/body&gt; &lt;/html&gt; 请求处理LoginAction.java： package tutorial; import com.opensymphony.xwork2.ActionSupport; public class LoginAction extends ActionSupport { private String msg=&#34;显示默认消息&#34;; private String userName; private String password; public String getPassword() { return password; } public void setPassword(String password) { this." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/0b53fd769ee7a43e5cf62586013e9e23/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2009-03-05T16:22:26+08:00" />
<meta property="article:modified_time" content="2009-03-05T16:22:26+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Struts2 表单提交 POJO</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    在Struts2.0里面有一个非常牛*的功能就是支持更高级的POJO访问，这句话是什么意思呢？下面来通过例子实际操作一把就能体会到这个功能的强大与好使了。 
<br> 
<br>要实现的功能：如果用户输入用户名xiaozu，密码111111，则显示welcome，xiaozhu!否则提示用户名或密码错误。 
<br> 
<br>下面是我们所需的文件： 
<br> 
<br> 
<br>登陆页面login.jsp： 
<br> 
<pre><code class="language-java"><br>&lt;%@ page language="java" contentType="text/html; charset=utf-8"%&gt; <br>&lt;%@ taglib prefix="s" uri="/struts-tags" %&gt; <br>&lt;!DOCTYPE html PUBLIC "-//W 3C //DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt; <br>&lt;html&gt; <br>&lt;head&gt; <br>&lt;title&gt;登陆页面&lt;/title&gt; <br>&lt;/head&gt; <br>&lt;body&gt; <br>&lt;s:form action="/test/loginAction.action" method="post"&gt; <br>    &lt;s:textfield name="userName" label="用户名"/&gt; <br>    &lt;s:password name="password" label="密码"/&gt; <br>    &lt;s:submit/&gt; <br>&lt;/s:form&gt; <br>&lt;/body&gt; <br>&lt;/html&gt; <br></code></pre> 
<br> 
<br> 
<br>请求处理LoginAction.java： 
<br> 
<br> 
<pre><code class="language-java"><br>package tutorial; <br><br>import com.opensymphony.xwork2.ActionSupport; <br><br>public class LoginAction extends ActionSupport { <br><br>    private String msg="显示默认消息"; <br>    private String userName; <br>    private String password; <br><br>    public String getPassword() { <br>       return password; <br>    } <br><br>    public void setPassword(String password) { <br>       this.password = password; <br>    } <br><br><br>    public String getUserName() { <br>       return userName; <br>    } <br><br><br>    public void setUserName(String userName) { <br>       this.userName = userName; <br>    } <br><br>    public String getMsg() { <br>       return msg; <br>    } <br><br>    public String execute(){ <br>    if ("xiaozhu".equals(userName)&amp;&amp;"111111".equals(password)) { <br>        msg="welcome,"+userName; <br>       } else { <br>            msg="用户名或密码错误"; <br>       } <br>    return this.SUCCESS; <br>    } <br>} <br></code></pre> 
<br> 
<br>响应页面HelloWorld.jsp： 
<br> 
<pre><code class="language-java"><br>&lt;%@ page language="java" contentType="text/html; charset=utf-8"%&gt; <br>&lt;%@ taglib prefix="s" uri="/struts-tags" %&gt; <br>&lt;!DOCTYPE html PUBLIC "-//W 3C //DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt; <br>&lt;html&gt; <br>    &lt;head&gt; <br>        &lt;title&gt;Hello&lt;/title&gt; <br>    &lt;/head&gt; <br>    &lt;body&gt; <br>        &lt;h3&gt;&lt;s:property value="msg"/&gt;&lt;/h3&gt; <br>    &lt;/body&gt; <br>&lt;/html&gt; <br></code></pre> 
<br> 
<br>如上所示，对于login.jsp表单中的每个值域我们都会在相应的action中声明一个对应的属性并产生相应的get和set方法，如果这个表单中的值很多(例如注册用户信息的表单)，就会导致action十分庞大和容易混乱，并且也不利于我们的软件分层，违背了OO的原则，下面看一下改进后的方案。 
<br> 
<br> 
<br>登陆页面login.jsp： 
<br> 
<br> 
<pre><code class="language-java"><br>&lt;%@ page language="java" contentType="text/html; charset=utf-8"%&gt; <br>&lt;%@ taglib prefix="s" uri="/struts-tags" %&gt; <br>&lt;!DOCTYPE html PUBLIC "-//W 3C //DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt; <br>&lt;html&gt; <br>&lt;head&gt; <br>&lt;title&gt;Insert title here&lt;/title&gt; <br>&lt;/head&gt; <br>&lt;body&gt; <br>&lt;s:form action="/test/loginAction.action" method="post"&gt; <br>    &lt;s:textfield name="user.userName" label="用户名"/&gt; <br>    &lt;s:password name="user.password" label="密码"/&gt; <br>    &lt;s:submit/&gt; <br>&lt;/s:form&gt; <br>&lt;/body&gt; <br>&lt;/html&gt; <br></code></pre> 
<br> 
<br>新增实体类User.java： 
<br> 
<br> 
<pre><code class="language-java"><br>package tutorial; <br><br>public class User { <br>    private String userName; <br>    private String password; <br><br>    public String getPassword() { <br>       return password; <br>    } <br><br>    public void setPassword(String password) { <br>       this.password = password; <br>    } <br><br>    public String getUserName() { <br>       return userName; <br>    } <br><br>    public void setUserName(String userName) { <br>       this.userName = userName; <br>    } <br>} <br></code></pre> 
<br> 
<br>请求处理LoginAction.java： 
<br> 
<pre><code class="language-java"><br>package tutorial; <br><br>import com.opensymphony.xwork2.ActionSupport; <br><br>public class LoginAction extends ActionSupport { <br><br>    private String msg="显示默认消息"; <br>    private User user; <br><br>    public User getUser() { <br>       return user; <br>    } <br><br>    public void setUser(User user) { <br>       this.user = user; <br>    } <br><br>    public String getMsg() { <br>       return msg; <br>    } <br><br>    public String execute(){ <br>if("xiaozhu".equals(user.getUserName())&amp;&amp;"111111".equals(user.getPassword())) <br>        msg="welcome,"+user.getUserName(); <br>    else <br>        msg="用户名或密码错误"; <br>    return this.SUCCESS;// <br>    } <br>} <br></code></pre> 
<br> 
<br>响应页面HelloWorld.jsp： 
<br> 
<pre><code class="language-java"><br>&lt;%@ page language="java" contentType="text/html; charset=utf-8"%&gt; <br>&lt;%@ taglib prefix="s" uri="/struts-tags" %&gt; <br>&lt;!DOCTYPE html PUBLIC "-//W 3C //DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt; <br>&lt;html&gt; <br>    &lt;head&gt; <br>        &lt;title&gt;Hello&lt;/title&gt; <br>    &lt;/head&gt; <br>    &lt;body&gt; <br>        &lt;h3&gt;&lt;s:property value="msg"/&gt;&lt;/h3&gt; <br>    &lt;/body&gt; <br>&lt;/html&gt; <br></code></pre> 
<br> 
<br>前后两种处理方式有何不同呢？后者新建了一个User实体类，用于封装从表单中接收的数据，而在action中就不用设置相应的属性和方法了，并且这样做能够让我们的软件层次感更加明显，系统结构也更加清晰。以User为例，描述一下采用这种方式的关键步骤： 
<br> 
<br>1． 在action中定义一个User类型的对象：User user； 
<br>2． 表单中各个控件的name属性要采取如下命名规则：对象名.属性名，注意对象名必须与action中定义的一样，属性名也必须和该对象的属性一一对应。如上例中的user.userName和user.password。 
<br> 
<br> 
<br> :o [b]注意[/b]: 
<br> 
<pre><code class="language-java"><br> public User getUser() { <br>       return user; <br>    } <br></code></pre> 
<br>Action中的这个get方法必须，否则会出现丢值的现象；set方法就更不用说了，必须的。 
<br> 
<br> 
<br>上述原理解释： 
<br> 
<br>1. 前面讲的自定义类型转换器是基于 OGNL 的 DefaultTypeConverter 类并实现 convertValue() 方法，两个转换方向的逻辑都写在这一个方法中。而 Struts 2 为我们提供了一个 DefaultTypeConverter 的抽象子类 StrutsTypeConverter 来继承，并实现其中两个抽象方法 convertFromString() 和 convertToString()，这要简单易懂。对比 Struts 1 的转换器是要实现 org.apache.commons.beanutils.Converter 接口，以及它的 convert() 方法的。 
<br> 
<br>2. 注意，上面的 convertFromString() 的第二个参数是一个字符串数组，所以可为请求的数组(如请求串为 ?u=1&amp;u=2&amp;u=3)定义转换器，Action 中相应的属性就应为数组或 List，这一方法的返回值也该为相应的类型(数组或List，要通过第三个参数 toClass 来判断是返回数组还是 List 了)。 
<br> 
<br>3. 字符串(如 "user,pass") 转换成 Action 中的复合属性(如 User user) 前面是自定了类型转换器。除此之外，还可以 Struts 2 内置的 OGNL 表达式，更简单的转换，不用写转换器。例如，你的 Action 有属性 User user，只要在 jsp 页面的输入框命名为 user.name 和 user.pass 即可： 
<br> &lt;input type="text" name="user.name"/&gt; 或用标签：&lt;s:textfield name="user.name" label="用户名"/&gt; 
<br> &lt;input type="text" name="user.pass"/&gt; 或用标签：&lt;s:textfield name="user.pass" label="密　码"/&gt; 
<br> 提交后，Struts 2 即会帮你构造 User 对象(user = new User())，并赋上属性值(user.setName()，user.setPass())，最后 user 对象赋给 Action (xxxAction.setUser(user))。所以要明白有三个必备的东西： 
<br> 1) User 要用一个默认构造方法 2) User 要有对应 name 和 pass 的设置方法 setName() 和 setPass() 3) Action 要有 user 属性的设置方法 setUser()，getUser() 也是要的，至于功用后面能看到。 
<br>其实在 Struts 1 中也有这种用法，不过那是在 BeanUtils 中实现的。 
<br> 
<br>4. 如果 Action 中的属性是 Map&lt;String, User&gt; users; 那么与此对应的表单写法就是：(用标签来写) 
<br> &lt;s:textfield name="users['one'].name" label="第一个用户名"/&gt; 
<br> &lt;s:textfield name="users['one'].name" label="第一个密码"/&gt; 
<br> &lt;s:textfield name="users['two'].name" label="第二个用户名"/&gt; 
<br> &lt;s:textfield name="users['two'].name" label="第二个密码"/&gt; 
<br> 应该不难想像，这个表单提交后，users 中存储的是什么吧! 
<br> 如果是对于 Action 中的 List 属性，List&lt;User&gt; users; 那么与此对应的表单写法就是： 
<br> &lt;s:textfield name="users[0].name" label="第一个用户名"/&gt; 
<br> &lt;s:textfield name="users[0].name" label="第一个密码"/&gt; 
<br> &lt;s:textfield name="users[1].name" label="第二个用户名"/&gt; 
<br> &lt;s:textfield name="users[1].name" label="第二个密码"/&gt; 
<br> 
<br>5. 归纳前面3、4、5 几点，Struts2 的 Action 在设置每一个属性时都会 get 一下相应的元素 getUser() 或 getUsers()。 
<br> 对于 3，在设置 user.name 和 user.pass 之前都会 getUser() 来获取 user 属性，如果 user 为 null 就构造 User 对象，然后设置相应的值。假如声明的时候就已构造好 User 对象，如有其他属性如 age=18，并不会被覆盖。 
<br> 对于 4 和 5，也是在设置每一个属性前都会调用 getUsers() 判断声明的 Map 或 List 是否为 null，是则构造对应的 HashMap 或 ArrayList() 对象；接着根据 Key 或下标去获取相应位置的元素，如果不存在或为 null 则构造之，然后设置相应属性值。由此可见，若某元素的某个属性未重设值则保留原值，若原来Map或List 已有多个元素，也只会改变到 Key 或索引所对应元素的某个属性。对于 List 有可能出现跳空的情况，如页面只有索引不从 0 开始 
<br> &lt;s:textfield name="users[1].name" label="第二个用户名"/&gt; 
<br> &lt;s:textfield name="users[1].name" label="第二个密码"/&gt; 
<br>提交后就会发现，List 属性 users 的第一个元素为 null 了。同时如果尝试一下，你就会发现这里的 List 不能替代为数组 User[] users。 
<br> 这种样法，可在 Struts 1 中实现，但要略施些小节，见我的另一篇日志：提交多行数据到Struts的ActionForm的List属性中 ，行为表现完全一致，只是换到 Struts 2 中一切都不用自己操心。 
<br> 
<br>6. 看第四点，Action 之所以知道该构造什么类型的元素完全是由泛型告诉它的。如果不用泛型(比如用的是 JDK1.4)，Action 中仅仅声明的是 Map users; 或 List users; Action 该如何处理呢？它也不知道，只能够帮你构造出无类型的 HashMap 和 ArrayList()，填充不了元素。这就必须在局部类型转换的配置文件中来指定集合元素的类型。例如 Action 为 LoginAction，就要在 LoginAction-conversion.properties 中声明了，格式如下： 
<br> 
<br> #Element_xxx=复合类型，基中 Element 是固定的，xxx 为属性名 
<br> #下面表示为 List 属性 users 的元素为 com.unmi.vo.User 类型 
<br> Element_users=com.unmi.vo.User 
<br> 
<br> 对于 Map，须分别指定 Key 的类型和 Value 的类型 
<br> #Key_xxx=复合类型，基中 Key 是固定的，xxx 为 map 属性名，下面写成 String 都不行的 
<br> Key_users=java.lang.String 
<br> 指定 Map 的 Value 的类型与指定 List 元素类型是一样的 
<br> Element_users=com.unmi.vo.User 
<br> 
<br>难怪 Struts 2 要与 1.5 以上 JDK 使用，泛型比配置来得方便。如果硬要用 1.4 JDK，就只有配置类型了，会多很多 conversion 文件的。在 提交多行数据到Struts的ActionForm的List属性中 中类型的确定由 AutoArrayList() 的构造参数完成。 
<br> 
<br>7. Set 是无序集合，所以无法像 List 那样用数字下标来访问，幸好 Struts 2 可为其指定索引属性。例如，LoginAction 声明为 Set users; (这里好像用泛型只能省得了 Element_users 说明，KeyProperty_users 少不了)。则需在 LoginAction-conversion.properties 中写下： 
<br> #指定 Set 的元素类型 
<br> Element_users=com.unmi.vo.User 
<br> 
<br> #KeyProperty_集合属性名=集合元素的索引属性名，这里为 User 的 name 属性 
<br> KeyProperty_users=name 
<br> 
<br>此时提交页面这么写，最好提交前能根据输入的用户名自动修动输入框的 name。 
<br> 用户名: &lt;input name="users('scott').name"/&gt; 
<br> 密　码: &lt;input name="users('scott').pass"/&gt; 
<br>显示的时候页面可用标签 
<br> 用户名: &lt;s:property value="users('scott').name"/&gt; 
<br> 密　码: &lt;s:property value="users('scott').pass"/&gt; 
<br>注意前面，访问 Set 元素是用的圆括号，而不同于 Map、List、数组是用中括号。我想一般也犯不着非要用 Set 而不用 List，Struts 2 中用 Set 比在 Struts 1 中似乎还麻烦。 
<br> 
<br>8. Struts 2 内建了一批转换器：boolean、char、int、long、float、double 和它们的包装类型；Date，日期格式使用请求所在 Locale 的 SHORT 格式；数组，默认元素为字符串，其他类型则要转换每一个元素?(好像是一次性转换完成的)；集合，默认元素为字符串 XWorkList(String.class, Object[])，其他如 List&lt;Integer&gt; ids，类型为 XWorkList(Integer.class, Object[])，XWorkList 继承自 ArrayList。 
<br> 
<br>9. 类型转换出错由 Struts 来帮你处理，在默认拦截器栈中提供了 conversionError 拦截器，不用你写一点代码逻辑。conversionError 在出错时将错误封装成 fieldError，并放在 ActionContext 中。你所要做的就是遵循它的规则，1) 你的 Action 要继承自 ActionSupport，2)在 struts.xml 中声明名为 "input" 的 result，出错时会在 input 逻辑视图显示信息。3)尽量用标签来写输入域(如&lt;s:textfield name="number" label="数量"/&gt;)，这样转换出错后，就会像校验失败一样把错误信息显示在每个输入框上面(视模板而定)，否则要手工用 &lt;s:fielderror/&gt; 输出在某处。 
<br>默认时输出错误信息为(比如是属性 number，输入的是字符串时)：Invalid field value for field "number".你可以改变默认显示，在全局国际化资源文件中加上 xwork.default.invalid.fieldvalue={0}字段类型转换失败!。在某些时候，可能还需要对特定字段指定特别的提示信息，那么在名为 ActionName.properties 的局部资源文件中加上 invalid.fieldvalue.属性名=提示信息 (如 invalid.fieldvalue.number=数量格式错误) 
<br> 
<br>10. 最后是集合属性转换错误时的显示，对于页面中的同名输入框，有多个出错误，如果手工用 &lt;s:fieldError/&gt; 只会显示一条错误，但要是输入页是用标签(如&lt;s:textfield name="number" label="数量"/&gt;)，仍会在每一个出错的输入框上都提示。至此类型转换的内容也就完结了。 
<br> 
<br> 
<br>11. struts2中 
<br>[b] 
<br>&lt;input type="user.name" value="jack"&gt; 
<br>&lt;input type="user.name" value="lucy"&gt; 
<br>action中取得name的值是"jack,lucy". 
<br>注意：此处name是字符串类型，不是数组类型 
<br>[/b]
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/dd12bc17ec008d674838532bab57c92f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">软件命名规范（版本号）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e8af00d1efebe3e9f2eccbb179e2f789/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Struts 2详细工作流程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>