<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Sqlite之删除超过50条的数据 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Sqlite之删除超过50条的数据" />
<meta property="og:description" content="在应用中，总要对用户的一些操作进行记录，比如播放历史记录，搜索历史记录等，方便用户再次使用。但是这些记录又不能无限的存储，只需要记录最新的50条或者100条就可以了，所以要求应用每插入一条新数据之后，对超过50条的数据进行清理。
本文以搜索历史记录为例，主要介绍sqlite中limit ，offset关键字的使用，最后给出此复合语句的写法。
建表 搜索历史记录只需要记录搜索关键词和搜索时间即可。所以我们需要这样的一张表：
表中只有两个字段（keyword , time）:其中keyword是唯一的，不允许重复；时间默认为写入数据库的默认时间，我们可是使用sqlite数据的datetime(‘now’)函数
好了，给出搜索历史记录（search_history）建表语句：
[sql] view plain copy CREATE TABLE [search_history] ([keyword] CHAR UNIQUE,[time] TIMESTAMP NOT NULL ON CONFLICT REPLACE DEFAULT (datetime(‘now’))) Sqlite之limit ，offset关键词 limit 语法有两种写法s
1. 一个参数 ： limit x
其中x是一个整数，表示返回x条目记录。 2.两个参数： limit x , y 其中x , y 都是整数，表示跳过x 条记录，返回 y 条记录，即 LIMIT &lt;skip&gt;, &lt;count&gt;
此外limit 还与offset关键词结合，语法是： limit x offset y 表示跳过 y 条记录，返回 x 条记录 ，即 LIMIT &lt;count&gt; OFFSET &lt;skip&gt;
乍一看 limit x , y 和limit x offset y 的语义很接近，千万不要搞混了。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/45087c841c33aa45c3be8686384cd205/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-07-28T17:08:28+08:00" />
<meta property="article:modified_time" content="2017-07-28T17:08:28+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Sqlite之删除超过50条的数据</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; border:0px; vertical-align:baseline; line-height:20px"> <span style="font-size:13px">  </span><span style="font-size:18px"> 在应用中，总要对用户的一些操作进行记录，比如播放历史记录，搜索历史记录等，方便用户再次使用。但是这些记录又不能无限的存储，只需要记录最新的50条或者100条就可以了，所以要求应用每插入一条新数据之后，对超过50条的数据进行清理。</span></p> 
<p style="padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; border:0px; vertical-align:baseline; line-height:20px"> <span style="font-size:18px">    本文以搜索历史记录为例，主要介绍sqlite中limit ，offset关键字的使用，最后给出此复合语句的写法。</span></p> 
<h3 style="padding:0px 0px 10px; margin:0px; border:0px; vertical-align:baseline; font-weight:normal; clear:both; font-size:28px; line-height:36px"> <a target="_blank" name="t0"></a><span style="padding:0px; margin:0px; border:0px; vertical-align:baseline; background-color:transparent"><strong>建表</strong></span></h3> 
<p style="padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; border:0px; vertical-align:baseline; line-height:20px"> <span style="font-size:13px">    </span><span style="font-size:18px">搜索历史记录只需要记录搜索关键词和搜索时间即可。所以我们需要这样的一张表：</span></p> 
<p align="center" style="padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; border:0px; vertical-align:baseline; line-height:20px"> <span style="font-size:18px"><img src="https://images2.imgbox.com/79/03/0O5SUEHj_o.png" alt="" style="padding:0px; margin:0px; border:0px; vertical-align:baseline; background-color:transparent"></span></p> 
<p style="padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; border:0px; vertical-align:baseline; line-height:20px"> <span style="font-size:18px">    表中只有两个字段（keyword , time）:其中keyword是唯一的，不允许重复；时间默认为写入<a target="_blank" href="http://lib.csdn.net/base/mysql" rel="nofollow noopener noreferrer" class="replace_word" title="MySQL知识库" style="color:#df3434; font-weight:bold">数据库</a>的默认时间，我们可是使用sqlite数据的datetime(‘now’)函数</span></p> 
<p style="padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; border:0px; vertical-align:baseline; line-height:20px"> <span style="font-size:18px">    好了，给出搜索历史记录（search_history）建表语句：</span></p> 
<p style="padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; border:0px; vertical-align:baseline; font-size:13px; line-height:20px"> </p> 
<div class="dp-highlighter bg_sql"> 
 <div class="bar"> 
  <div class="tools"> 
   <strong>[sql]</strong> 
   <a target="_blank" href="http://blog.csdn.net/wangyuetingtao/article/details/8446474#" class="ViewSource" title="view plain" rel="noopener noreferrer"> view plain</a> 
    <a target="_blank" href="http://blog.csdn.net/wangyuetingtao/article/details/8446474#" class="CopyToClipboard" title="copy" rel="noopener noreferrer"> copy</a> 
     
  </div> 
 </div> 
 <ol start="1" class="dp-sql"><li class="alt"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> [search_history] ([keyword] <span class="keyword">CHAR</span> <span class="keyword">UNIQUE</span>,[<span class="keyword">time</span>] <span class="keyword">TIMESTAMP</span> <span class="op">NOT</span> <span class="op">NULL</span> <span class="keyword">ON</span> CONFLICT <span class="func">REPLACE</span> <span class="keyword">DEFAULT</span> (datetime(‘now’)))  </li></ol> 
</div> 
<br> 
<br> 
<h3 style="padding:0px 0px 10px; margin:0px; border:0px; vertical-align:baseline; font-weight:normal; clear:both; font-size:28px; line-height:36px"> <a target="_blank" name="t1"></a><span style="padding:0px; margin:0px; border:0px; vertical-align:baseline; background-color:transparent">Sqlite之limit ，offset关键词</span></h3> 
<p style="padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; border:0px; vertical-align:baseline; line-height:20px"> <span style="font-size:18px">  limit 语法有两种写法s</span></p> 
<blockquote style="margin:0 0 0 40px; border:none; padding:0px"> 
 <p style="padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; border:0px; vertical-align:baseline; line-height:20px"> <span style="font-size:18px">  1. 一个参数 ： limit x</span></p> 
 <p style="padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; border:0px; vertical-align:baseline; line-height:20px"> <span style="font-size:18px">     其中x是一个整数，表示返回x条目记录。 </span></p> 
 <p style="padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; border:0px; vertical-align:baseline; line-height:20px"> <span style="font-size:18px">  2.两个参数： limit x , y  </span></p> 
 <p style="padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; border:0px; vertical-align:baseline; line-height:20px"> <span style="font-size:18px">     其中x , y 都是整数，表示跳过x 条记录，返回 y 条记录，即 <span style="padding:0px; margin:0px; border:0px; vertical-align:baseline; background-color:transparent">LIMIT &lt;skip&gt;, &lt;count&gt;</span></span></p> 
</blockquote> 
<p style="padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; border:0px; vertical-align:baseline; line-height:20px"> <span style="font-size:18px">    此外limit 还与offset关键词结合，语法是： limit x offset y </span></p> 
<p style="padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; border:0px; vertical-align:baseline; line-height:20px"> <span style="font-size:18px">    表示跳过 y 条记录，返回 x 条记录 ，即 <span style="padding:0px; margin:0px; border:0px; vertical-align:baseline; background-color:transparent">LIMIT &lt;count&gt; OFFSET &lt;skip&gt;</span></span></p> 
<p style="padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; border:0px; vertical-align:baseline; line-height:20px"> <span style="font-size:18px">    乍一看 limit x , y 和limit x offset y  的语义很接近，千万不要搞混了。</span></p> 
<h3 style="padding:0px 0px 10px; margin:0px; border:0px; vertical-align:baseline; font-weight:normal; clear:both; font-size:28px; line-height:36px"> <a target="_blank" name="t2"></a><span style="padding:0px; margin:0px; border:0px; vertical-align:baseline; background-color:transparent"><strong>复合SQL语句演练</strong></span>：</h3> 
<p style="padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; border:0px; vertical-align:baseline; line-height:20px"> <span style="font-size:13px">  </span><span style="font-size:18px">  由于我们的表中只有上图所示4条数据，为了演示方便，我们将最大数量定位2，超过2条以上的数据将被删除。</span></p> 
<p style="padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; border:0px; vertical-align:baseline; line-height:20px"> <span style="font-size:18px">    在这里我们选用offset关键词，一步步获得超过2以后的记录。</span></p> 
<p style="padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; border:0px; vertical-align:baseline; line-height:20px"> <span style="font-size:18px">    1：首先计算keyword的数量，确保数据库中的条目大于最大值2 ，这是重要的条件之一。条件不成立，不进行删除操作。</span></p> 
<span style="font-size:18px"></span> 
<div class="dp-highlighter bg_sql"> 
 <div class="bar"> 
  <div class="tools"> 
   <strong>[sql]</strong> 
   <a target="_blank" href="http://blog.csdn.net/wangyuetingtao/article/details/8446474#" class="ViewSource" title="view plain" rel="noopener noreferrer"> view plain</a> 
    <a target="_blank" href="http://blog.csdn.net/wangyuetingtao/article/details/8446474#" class="CopyToClipboard" title="copy" rel="noopener noreferrer"> copy</a> 
     
  </div> 
 </div> 
 <ol start="1" class="dp-sql"><li class="alt"><span class="keyword">select</span> * <span class="keyword">from</span> search_history <span class="keyword">where</span> (<span class="keyword">select</span> <span class="func">count</span>(keyword) <span class="keyword">from</span> search_history) &gt;2  </li></ol> 
</div> 
<br> 
<br> 
<p style="padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; border:0px; vertical-align:baseline; line-height:20px"> <span style="font-size:18px">    因为4&gt;2 ,所以返回全部数据结果：</span></p> 
<p style="padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; border:0px; vertical-align:baseline; font-size:13px; line-height:20px"> <img src="https://images2.imgbox.com/39/66/he22be51_o.png" alt="" style="padding:0px; margin:0px auto; border:0px; vertical-align:baseline; background-color:transparent; display:block; float:none"></p> 
<p style="padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; border:0px; vertical-align:baseline; line-height:20px"> <span style="font-size:18px">  2：接下来，我们将按照时间(time字段)降序排列数据，筛选所有的关键词</span></p> 
<div class="dp-highlighter bg_sql"> 
 <div class="bar"> 
  <div class="tools"> 
   <strong>[sql]</strong> 
   <a target="_blank" href="http://blog.csdn.net/wangyuetingtao/article/details/8446474#" class="ViewSource" title="view plain" rel="noopener noreferrer"> view plain</a> 
    <a target="_blank" href="http://blog.csdn.net/wangyuetingtao/article/details/8446474#" class="CopyToClipboard" title="copy" rel="noopener noreferrer"> copy</a> 
     
  </div> 
 </div> 
 <ol start="1" class="dp-sql"><li class="alt"><span class="keyword">select</span> keyword <span class="keyword">from</span> search_history <span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">time</span> <span class="keyword">desc</span>  </li></ol> 
</div> 
<br> 
<p><br> </p> 
<p style="padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; border:0px; vertical-align:baseline; line-height:20px"> <span style="font-size:13px">     </span><span style="font-size:18px">返回结果：</span></p> 
<p style="padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; border:0px; vertical-align:baseline; line-height:20px"> <img src="https://images2.imgbox.com/9e/97/mnSLYDl9_o.png" alt="" style="padding:0px; margin:0px auto; border:0px; vertical-align:baseline; background-color:transparent; display:block; float:none"></p> 
<p style="padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; border:0px; vertical-align:baseline; line-height:20px"> <span style="font-size:18px">    3.  扩展第2步 ， 在按照时间(time字段)降序，获得超过最大值2以上的所有关键词。也就是在第2步的基础，加入limit关键词</span></p> 
<p style="padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; border:0px; vertical-align:baseline; font-size:13px; line-height:20px"> </p> 
<div class="dp-highlighter bg_sql"> 
 <div class="bar"> 
  <div class="tools"> 
   <strong>[sql]</strong> 
   <a target="_blank" href="http://blog.csdn.net/wangyuetingtao/article/details/8446474#" class="ViewSource" title="view plain" rel="noopener noreferrer"> view plain</a> 
    <a target="_blank" href="http://blog.csdn.net/wangyuetingtao/article/details/8446474#" class="CopyToClipboard" title="copy" rel="noopener noreferrer"> copy</a> 
     
  </div> 
 </div> 
 <ol start="1" class="dp-sql"><li class="alt"><span class="keyword">select</span> keyword <span class="keyword">from</span> search_history <span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">time</span> <span class="keyword">desc</span> limit (<span class="keyword">select</span> <span class="func">count</span>(keyword) <span class="keyword">from</span> search_history) offset 2  </li></ol> 
</div> 
<br> 
<br> 
<p style="padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; border:0px; vertical-align:baseline; line-height:20px"> <span style="font-size:13px">  </span><span style="font-size:18px"> 返回结果：</span></p> 
<p style="padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; border:0px; vertical-align:baseline; line-height:20px"> <img src="https://images2.imgbox.com/e9/9e/WdutyLWj_o.png" alt="" style="padding:0px; margin:0px auto; border:0px; vertical-align:baseline; background-color:transparent; display:block; float:none"></p> 
<p style="padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; border:0px; vertical-align:baseline; line-height:20px"> <span style="font-size:18px">    现在我们已经将超过最大值2以上的时间较早的搜索关键词查询出来了，大功即将搞成。接下下将这些数据删除即可，当然不要忘了加入我们第1步的条件。</span></p> 
<p style="padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; border:0px; vertical-align:baseline; line-height:20px"> <span style="font-size:18px">    4. 结合第一步的条件，最终复合sql语句就是：</span></p> 
<p style="padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; border:0px; vertical-align:baseline; font-size:13px; line-height:20px">   </p> 
<div class="dp-highlighter bg_sql"> 
 <div class="bar"> 
  <div class="tools"> 
   <strong>[sql]</strong> 
   <a target="_blank" href="http://blog.csdn.net/wangyuetingtao/article/details/8446474#" class="ViewSource" title="view plain" rel="noopener noreferrer"> view plain</a> 
    <a target="_blank" href="http://blog.csdn.net/wangyuetingtao/article/details/8446474#" class="CopyToClipboard" title="copy" rel="noopener noreferrer"> copy</a> 
     
  </div> 
 </div> 
 <ol start="1" class="dp-sql"><li class="alt"><span class="keyword">delete</span> <span class="keyword">from</span> search_history <span class="keyword">where</span> (<span class="keyword">select</span> <span class="func">count</span>(keyword) <span class="keyword">from</span> search_history   </li><li>)&gt; 2 <span class="op">and</span> keyword <span class="op">in</span> (<span class="keyword">select</span> keyword <span class="keyword">from</span> search_history <span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">time</span> <span class="keyword">desc</span> limit (<span class="keyword">select</span> <span class="func">count</span>(keyword) <span class="keyword">from</span> search_history) offset 2 )  </li></ol> 
</div> 
<br> 
<p style="padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; border:0px; vertical-align:baseline; line-height:20px"> <span style="font-size:13px">  </span><span style="font-size:18px">执行之后，可以看到超过最大值2的数据，也就是第3步中的数据都被删除了。重新查询之后的结果如下：</span></p> 
<p style="padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; border:0px; vertical-align:baseline; line-height:20px"> <img src="https://images2.imgbox.com/09/ce/GehjDeTk_o.png" alt="" style="padding:0px; margin:0px auto; border:0px; vertical-align:baseline; background-color:transparent; display:block; float:none"></p> 
<p style="padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; border:0px; vertical-align:baseline; line-height:20px"> <span style="font-size:18px">  说明执行结果是正确的。</span></p> 
<p style="padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; border:0px; vertical-align:baseline; line-height:20px"> <span style="font-size:18px">  最后将最大值2改为50就可以了：</span></p> 
<p style="padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; border:0px; vertical-align:baseline; line-height:20px"> <span style="font-size:18px">  最终语句如下：</span></p> 
<p style="padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; border:0px; vertical-align:baseline; line-height:20px"> <span style="font-size:18px">  </span></p> 
<div class="dp-highlighter bg_sql"> 
 <div class="bar"> 
  <div class="tools"> 
   <strong>[sql]</strong> 
   <a target="_blank" href="http://blog.csdn.net/wangyuetingtao/article/details/8446474#" class="ViewSource" title="view plain" rel="noopener noreferrer"> view plain</a> 
    <a target="_blank" href="http://blog.csdn.net/wangyuetingtao/article/details/8446474#" class="CopyToClipboard" title="copy" rel="noopener noreferrer"> copy</a> 
     
  </div> 
 </div> 
 <ol start="1" class="dp-sql"><li class="alt"><span class="keyword">delete</span> <span class="keyword">from</span> search_history <span class="keyword">where</span> (<span class="keyword">select</span> <span class="func">count</span>(keyword) <span class="keyword">from</span> search_history   </li><li>)&gt; 50 <span class="op">and</span> keyword <span class="op">in</span> (<span class="keyword">select</span> keyword <span class="keyword">from</span> search_history <span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">time</span> <span class="keyword">desc</span> limit (<span class="keyword">select</span> <span class="func">count</span>(keyword) <span class="keyword">from</span> search_history) offset 50 )  <br> </li></ol> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5ce259ac4e83d34ca53414a287359c71/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">BugFree的安装</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/468434a541c14c4da8060812aecd390b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">JetBrain系列ide更换主题的方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>