<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>python控制obs实现无缝切换场景！obs-websocket-py - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="python控制obs实现无缝切换场景！obs-websocket-py" />
<meta property="og:description" content="前言
最近一直在研究孪生数字人wav2lip。目前成果可直接输入高清嘴型，2070显卡1分钟音频2.6分钟输出。在直播逻辑上可以做到1比1.3这样，所以现在开始研究直播。在逻辑上涉及到了无缝切换，看到csdn上有一篇文章还要vip解锁。。。那自己研究吧！在这里我们以我现在的逻辑来实现一下无缝切换！
举一个例子
来梳理一下我的逻辑，通过obs推场景1中的一个视频，循环播放一个不说话闭嘴的视频。当生成好说话的视频后控制obs修改场景2的来源视频路径然后自动切换场景2进行播放，然后监听场景2视频播放完毕自动切回场景1不说话的视频~！
来吧！说干就干！
obs-api文档：https://github.com/obsproject/obs-websocket/blob/master/docs/generated/protocol.md#getmediainputstatus
不要问我为什么，因为百度出来的相关现成轮子太少了！最好看文档来选择和实现自己的业务，很简单的！
一、创建obs-ws服务端
二、创建两个场景和每个场景各添加一个视频来源
SceneName场景添加一个MediaSourceNameA来源，添加视频A
SceneName1场景添加一个MediaSourceNameB来源，添加视频A【当数字人视频生成好通过py替换掉这个路径的】
SceneName场景的MediaSourceNameA的视频A设置循环播放。
目的是默认播放推流SceneName场景MediaSourceNameA的视频A，也就是不说话时的视频。
三、python控制obs无缝切换场景
安装依赖
pip install obs-websocket-py 连接obs
# 连接OBS ws = obsws(&#39;192.168.31.73&#39;, 4455, &#39;YqShGFfdYaGxG7DG&#39;) ws.connect() 这里地址来自这里
工具-》obs-websocket 设置 点击显示连接信息，可以看到ip和密码。
当数字人视频生成好后执行下面代码！
# 修改MediaSourceNameB来源的视频路径 ws.call(requests.SetInputSettings(inputName=&#34;MediaSourceNameB&#34;, inputSettings={ &#34;local_file&#34;: os.path.abspath(video_path) })) # 激活SceneName1场景播放视频 ws.call(requests.SetCurrentProgramScene(sceneName=&#39;SceneName1&#39;)) 可以监听MediaSourceNameB场景的视频是否播放完毕，当播放完毕切换回SceneName场景的循环播放视频。
while True: time.sleep(0.1) # 监听MediaSourceNameB视频播放状态 status = ws.call(requests.GetMediaInputStatus(inputName=&#34;MediaSourceNameB&#34;)).datain print(status) # 播放完毕则切换回激活循环播放的SceneName场景视频 if status[&#39;mediaState&#39;] == &#39;OBS_MEDIA_STATE_ENDED&#39;: ws.call(requests.SetCurrentProgramScene(sceneName=&#39;SceneName&#39;)) break 关闭websocket连接
# 断开连接 ws.disconnect() 四、实现自定义逻辑
什么？一头雾水？？？不难，我教你ya！
打开文档
https://github.com/obsproject/obs-websocket/blob/master/docs/generated/protocol.md#getmediainputstatus
比如查询视频播放状态" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/0fd1f71eaff8d05c25c741d0757321a9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-16T17:22:23+08:00" />
<meta property="article:modified_time" content="2023-08-16T17:22:23+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">python控制obs实现无缝切换场景！obs-websocket-py</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><strong>前言</strong></p> 
<p><strong>最近一直在研究孪生数字人wav2lip。目前成果可直接输入高清嘴型，2070显卡1分钟音频2.6分钟输出。在直播逻辑上可以做到1比1.3这样，所以现在开始研究直播。在逻辑上涉及到了无缝切换，看到csdn上有一篇文章还要vip解锁。。。那自己研究吧！在这里我们以我现在的逻辑来实现一下无缝切换！</strong></p> 
<p><strong>举一个例子</strong></p> 
<p><strong>来梳理一下我的逻辑，通过obs推场景1中的一个视频，循环播放一个不说话闭嘴的视频。当生成好说话的视频后</strong><strong>控制obs</strong><strong>修改场景2的来源视频路径然后自动切换场景2进行播放，然后监听场景2视频播放完毕自动切回场景1不说话的视频~！</strong></p> 
<p><strong>来吧！说干就干！</strong></p> 
<p><strong>obs-api文档：</strong><a href="https://github.com/obsproject/obs-websocket/blob/master/docs/generated/protocol.md#getmediainputstatus" title="https://github.com/obsproject/obs-websocket/blob/master/docs/generated/protocol.md#getmediainputstatus">https://github.com/obsproject/obs-websocket/blob/master/docs/generated/protocol.md#getmediainputstatus</a></p> 
<p> 不要问我为什么，因为百度出来的相关现成轮子太少了！最好看文档来选择和实现自己的业务，很简单的！</p> 
<p><strong>一、创建obs-ws服务端</strong></p> 
<p><img alt="" height="864" src="https://images2.imgbox.com/7b/fa/kp5YoOhN_o.png" width="1200"></p> 
<p><strong> 二、创建两个场景和每个场景各添加一个视频来源</strong></p> 
<p><img alt="" height="1032" src="https://images2.imgbox.com/be/90/AZBfV5Eh_o.png" width="1200"></p> 
<p> SceneName场景添加一个MediaSourceNameA来源，添加视频A</p> 
<p> SceneName1场景添加一个MediaSourceNameB来源，添加视频A【当数字人视频生成好通过py替换掉这个路径的】</p> 
<p>SceneName场景的MediaSourceNameA的视频A设置循环播放。</p> 
<p><img alt="" height="1040" src="https://images2.imgbox.com/52/22/KtKaDN2u_o.png" width="1200"> </p> 
<p> 目的是默认播放推流SceneName场景MediaSourceNameA的视频A，也就是不说话时的视频。</p> 
<p><strong>三、python控制obs无缝切换场景</strong></p> 
<p>安装依赖</p> 
<pre><code class="language-python">pip install obs-websocket-py</code></pre> 
<p> 连接obs</p> 
<pre><code class="language-python"># 连接OBS
ws = obsws('192.168.31.73', 4455, 'YqShGFfdYaGxG7DG')
ws.connect()</code></pre> 
<p>这里地址来自这里</p> 
<p><img alt="" height="768" src="https://images2.imgbox.com/16/35/timrM1kW_o.png" width="1095"></p> 
<p>工具-》obs-websocket 设置 </p> 
<p><img alt="" height="664" src="https://images2.imgbox.com/28/22/Xx50jSd9_o.png" width="691"> 点击显示连接信息，可以看到ip和密码。</p> 
<p> 当数字人视频生成好后执行下面代码！</p> 
<pre><code class="language-python">        # 修改MediaSourceNameB来源的视频路径
        ws.call(requests.SetInputSettings(inputName="MediaSourceNameB", inputSettings={
            "local_file": os.path.abspath(video_path)
        }))
        # 激活SceneName1场景播放视频
        ws.call(requests.SetCurrentProgramScene(sceneName='SceneName1'))</code></pre> 
<p> 可以监听MediaSourceNameB场景的视频是否播放完毕，当播放完毕切换回SceneName场景的循环播放视频。</p> 
<pre><code class="language-python">        while True:
            time.sleep(0.1)
            # 监听MediaSourceNameB视频播放状态
            status = ws.call(requests.GetMediaInputStatus(inputName="MediaSourceNameB")).datain
            print(status)
            # 播放完毕则切换回激活循环播放的SceneName场景视频
            if status['mediaState'] == 'OBS_MEDIA_STATE_ENDED':
                ws.call(requests.SetCurrentProgramScene(sceneName='SceneName'))
                break</code></pre> 
<p> </p> 
<p>关闭websocket连接</p> 
<pre><code class="language-python"># 断开连接
ws.disconnect()</code></pre> 
<p><strong>四、实现自定义逻辑</strong></p> 
<p><strong>什么？一头雾水？？？不难，我教你ya！</strong></p> 
<p><strong>打开文档</strong></p> 
<p><a href="https://github.com/obsproject/obs-websocket/blob/master/docs/generated/protocol.md#getmediainputstatus" title="https://github.com/obsproject/obs-websocket/blob/master/docs/generated/protocol.md#getmediainputstatus">https://github.com/obsproject/obs-websocket/blob/master/docs/generated/protocol.md#getmediainputstatus</a></p> 
<p>比如查询视频播放状态</p> 
<pre><code class="language-python">ws.call(requests.GetMediaInputStatus(inputName="MediaSourceNameB")).datain</code></pre> 
<p> 搜索GetMediaInputStatus，你可以在文档里看到名称一样的，同时他有使用介绍。不会英文就翻译一下！</p> 
<p>会告诉你它是干什么的，传什么参数，会得到什么响应！</p> 
<p>也就是说这个文档里你想用哪个方法那就如下：</p> 
<p>requests.XXX</p> 
<p>对于传参名，文档里有！在方法里对应写就行！</p> 
<p>requests.XXX(XXX=???,XXX=???)</p> 
<p>必须由ws.call()包裹</p> 
<p>默认返回对象，.datain就是返回数据了！</p> 
<p></p> 
<p><img alt="" height="987" src="https://images2.imgbox.com/8d/17/kcWDV3mZ_o.png" width="1200"> </p> 
<p><img alt="" height="917" src="https://images2.imgbox.com/5e/14/UkqE6gtY_o.png" width="1184"> </p> 
<p><span style="color:#fe2c24;"><strong> 注意！</strong></span></p> 
<p><span style="color:#fe2c24;"><strong>对于修改的方法会让传对象，文档里没有详细说对象里的参数名和格式，这个比较坑！不过它对应有个查询的方法，根据查询得出结果的内容格式去写就行啦！ </strong></span></p> 
<p><strong>好了！整体就是这些啦，根据我的方法自己去摸索一下就行了！对于怎么推流这个是obs基础，自行百度下就行了！！！</strong></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b1ebbbc931af321c7c34d0cf8f549f2e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">jmeter上一个线程组变量如何在下一个线程组中使用？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/81f9829c250fcf8ce0e9379f90578124/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">什么是SpringMVC以及和 SpringBoot 的关系</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>