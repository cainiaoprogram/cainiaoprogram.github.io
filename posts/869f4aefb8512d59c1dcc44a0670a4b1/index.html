<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>分组序列@GroupSequenceProvider、@GroupSequence控制数据校验顺序，解决多字段联合逻辑校验问题【享学Spring MVC】 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="分组序列@GroupSequenceProvider、@GroupSequence控制数据校验顺序，解决多字段联合逻辑校验问题【享学Spring MVC】" />
<meta property="og:description" content="每篇一句 不要像祥林嫂一样，天天抱怨着生活，日日思考着辞职。得罪点说一句：“沦落”到要跟这样的人共事工作，难道自己身上就没有原因？
前言 本以为洋洋洒洒的把Java/Spring数据（绑定）校验这块说了这么多，基本已经算完结了。但今天中午一位热心小伙伴在使用Bean Validation做数据校验时上遇到了一个稍显特殊的case，由于此校验场景也比较常见，因此便有了本文对数据校验补充。
关于Java/Spring中的数据校验，我有理由坚信你肯定遇到过这样的场景需求：在对JavaBean进行校验时，b属性的校验逻辑是依赖于a属性的值的；换个具象的例子说：当且仅当属性a的值=xxx时，属性b的校验逻辑才生效。这也就是我们常说的多字段联合校验逻辑~
因为这个校验的case比较常见，因此促使了我记录本文的动力，因为它会变得有意义和有价值。当然对此问题有的小伙伴说可以自己用if else来处理呀，也不是很麻烦。本文的目的还是希望对数据校验一以贯之的做到更清爽、更优雅、更好扩展而努力。
需要有一点坚持：既然用了Bean Validation去简化校验，那就（最好）不要用得四不像，遇到问题就解决问题~
热心网友问题描述 为了更真实的还原问题场景，我贴上聊天截图如下：
待校验的请求JavaBean如下：
校需求描述简述如下：
这位网友描述的真实生产场景问题，这也是本文讲解的内容所在。
虽然这是在Spring MVC条件的下使用的数据校验，但按照我的习惯为了更方便的说明问题，我会把此部分功能单摘出来，说清楚了方案和原理，再去实施解决问题本身（文末）~
方案和原理 对于单字段的校验、级联属性校验等，通过阅读我的系列文章，我有理由相信小伙伴们都能驾轻就熟了的。本文给出一个最简单的例子简单&#34;复习&#34;一下：
@Getter @Setter @ToString public class Person { @NotNull private String name; @NotNull @Range(min = 10, max = 40) private Integer age; @NotNull @Size(min = 3, max = 5) private List&lt;String&gt; hobbies; // 级联校验 @Valid @NotNull private Child child; } 测试：
public static void main(String[] args) { Person person = new Person(); person." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/869f4aefb8512d59c1dcc44a0670a4b1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-08-20T21:25:55+08:00" />
<meta property="article:modified_time" content="2019-08-20T21:25:55+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">分组序列@GroupSequenceProvider、@GroupSequence控制数据校验顺序，解决多字段联合逻辑校验问题【享学Spring MVC】</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h5><a id="_0"></a>每篇一句</h5> 
<blockquote> 
 <p>不要像祥林嫂一样，天天抱怨着生活，日日思考着辞职。得罪点说一句：“沦落”到要跟这样的人共事工作，难道自己身上就没有原因？</p> 
</blockquote> 
<h5><a id="_2"></a>前言</h5> 
<p>本以为洋洋洒洒的把<code>Java/Spring</code>数据（绑定）校验这块说了这么多，基本已经算完结了。但今天中午一位热心小伙伴在使用<code>Bean Validation</code>做数据校验时上遇到了一个稍显特殊的case，由于此校验场景也比较常见，因此便有了本文对数据校验补充。</p> 
<p>关于<code>Java/Spring</code>中的数据校验，我有理由坚信你肯定遇到过这样的场景需求：在对<code>JavaBean</code>进行校验时，<strong>b属性的校验逻辑是依赖于a属性的值的</strong>；换个具象的例子说：当且仅当属性a的值=xxx时，属性b的校验逻辑才生效。这也就是我们常说的多字段联合校验逻辑~<br> 因为这个校验的case比较常见，因此促使了我记录本文的动力，因为它会变得有意义和有价值。当然对此问题有的小伙伴说可以自己用<code>if else</code>来处理呀，也不是很麻烦。本文的目的还是希望对数据校验一以贯之的做到更清爽、更优雅、更好扩展而努力。</p> 
<blockquote> 
 <p>需要有一点坚持：既然用了<code>Bean Validation</code>去简化校验，那就（最好）不要用得四不像，遇到问题就解决问题~</p> 
</blockquote> 
<h3><a id="_8"></a>热心网友问题描述</h3> 
<p>为了更真实的还原问题场景，我贴上聊天截图如下：<br> <img src="https://images2.imgbox.com/1b/94/N4Av9qvx_o.png" alt="在这里插入图片描述"><br> 待校验的请求JavaBean如下：<br> <img src="https://images2.imgbox.com/9f/5a/K124DKdb_o.png" alt="在这里插入图片描述"><br> 校需求描述简述如下：<br> <img src="https://images2.imgbox.com/aa/e4/JJP6qQnt_o.png" alt="在这里插入图片描述"><br> 这位网友描述的真实生产场景问题，这也是本文讲解的内容所在。<br> 虽然这是在<code>Spring MVC</code>条件的下使用的数据校验，但按照我的习惯为了<strong>更方便</strong>的说明问题，我会把此部分功能单摘出来，说清楚了方案和原理，再去实施解决问题本身（文末）~</p> 
<h3><a id="_17"></a>方案和原理</h3> 
<p>对于单字段的校验、级联属性校验等，通过阅读我的系列文章，我有理由相信小伙伴们都能<code>驾轻就熟</code>了的。本文给出一个最简单的例子简单"复习"一下：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Getter</span>
<span class="token annotation punctuation">@Setter</span>
<span class="token annotation punctuation">@ToString</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@NotNull</span>
    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@NotNull</span>
    <span class="token annotation punctuation">@Range</span><span class="token punctuation">(</span>min <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span> max <span class="token operator">=</span> <span class="token number">40</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> Integer age<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@NotNull</span>
    <span class="token annotation punctuation">@Size</span><span class="token punctuation">(</span>min <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> max <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> List<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> hobbies<span class="token punctuation">;</span>

    <span class="token comment">// 级联校验</span>
    <span class="token annotation punctuation">@Valid</span>
    <span class="token annotation punctuation">@NotNull</span>
    <span class="token keyword">private</span> Child child<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>测试：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>  <span class="token punctuation">{<!-- --></span>
    Person person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    person<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"fsx"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    person<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	person<span class="token punctuation">.</span><span class="token function">setHobbies</span><span class="token punctuation">(</span>Arrays<span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">"足球"</span><span class="token punctuation">,</span><span class="token string">"篮球"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    person<span class="token punctuation">.</span><span class="token function">setChild</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Set<span class="token operator">&lt;</span>ConstraintViolation<span class="token generics function"><span class="token punctuation">&lt;</span>Person<span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span> result <span class="token operator">=</span> Validation<span class="token punctuation">.</span><span class="token function">buildDefaultValidatorFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValidator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 对结果进行遍历输出</span>
    result<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>v <span class="token operator">-</span><span class="token operator">&gt;</span> v<span class="token punctuation">.</span><span class="token function">getPropertyPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> v<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">": "</span> <span class="token operator">+</span> v<span class="token punctuation">.</span><span class="token function">getInvalidValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>运行，打印输出：</p> 
<pre><code class="prism language-java">child<span class="token punctuation">.</span>name 不能为null<span class="token operator">:</span> null
age 需要在<span class="token number">10</span>和<span class="token number">40</span>之间<span class="token operator">:</span> <span class="token number">5</span>
hobbies 个数必须在<span class="token number">3</span>和<span class="token number">5</span>之间<span class="token operator">:</span> <span class="token punctuation">[</span>足球<span class="token punctuation">,</span>篮球<span class="token punctuation">]</span>
</code></pre> 
<p><strong>结果符合预期，（级联）校验生效。</strong></p> 
<blockquote> 
 <p>通过使用<code>@Valid</code>可以实现递归验证，因此可以标注在<code>List</code>上，对它里面的每个对象都执行校验</p> 
</blockquote> 
<hr> 
<p><strong>问题来了，针对上例，现在我有如下需求：</strong></p> 
<ol><li>若20 &lt;= age &lt; 30，那么<code>hobbies</code>的<code>size</code>需介于1和2之间</li><li>若30 &lt;= age &lt; 40，那么<code>hobbies</code>的<code>size</code>需介于3和5之间</li><li>age其余值，<code>hobbies</code>无校验逻辑</li></ol> 
<h5><a id="_72"></a>实现方案</h5> 
<p><code>Hibernate Validator</code>提供了<strong>非标准</strong>的<code>@GroupSequenceProvider</code>注解。本功能提供根据当前对象实例的状态，<strong>动态来决定</strong>加载那些校验组进入默认校验组。</p> 
<p>为了实现上面的需求达到目的，我们需要借助<code>Hibernate Validation</code>提供给我们的<code>DefaultGroupSequenceProvider</code>接口来处理。</p> 
<pre><code class="prism language-java"><span class="token comment">// 该接口定义了：动态Group序列的协定</span>
<span class="token comment">// 要想它生效，需要在T上标注@GroupSequenceProvider注解并且指定此类为处理类</span>
<span class="token comment">// 如果`Default`组对T进行验证，则实际验证的实例将传递给此类以确定默认组序列（这句话特别重要  下面用例子解释）</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">DefaultGroupSequenceProvider</span><span class="token generics function"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 合格方法是给T返回默认的组（多个）。因为默认的组是Default嘛~~~通过它可以自定指定</span>
	<span class="token comment">// 入参T object允许在验证值状态的函数中动态组合默认组序列。（非常强大）</span>
	<span class="token comment">// object是待校验的Bean。它可以为null哦~（Validator#validateValue的时候可以为null）</span>

	<span class="token comment">// 返回值表示默认组序列的List。它的效果同@GroupSequence定义组序列，尤其是列表List必须包含类型T</span>
	List<span class="token operator">&lt;</span>Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">&gt;&gt;</span> <span class="token function">getValidationGroups</span><span class="token punctuation">(</span>T object<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>注意：</p> 
<ol><li>此接口Hibernate并没有提供实现</li><li>若你实现请必须提供一个空的构造函数以及保证是线程安全的</li></ol> 
<p><strong>按步骤解决多字段组合验证的逻辑：</strong><br> 1、自己实现<code>DefaultGroupSequenceProvider</code>接口（处理Person这个Bean）</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PersonGroupSequenceProvider</span> <span class="token keyword">implements</span> <span class="token class-name">DefaultGroupSequenceProvider</span><span class="token generics function"><span class="token punctuation">&lt;</span>Person<span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> List<span class="token operator">&lt;</span>Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">&gt;&gt;</span> <span class="token function">getValidationGroups</span><span class="token punctuation">(</span>Person bean<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        List<span class="token operator">&lt;</span>Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">&gt;&gt;</span> defaultGroupSequence <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        defaultGroupSequence<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>Person<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这一步不能省,否则Default分组都不会执行了，会抛错的</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>bean <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 这块判空请务必要做</span>
            Integer age <span class="token operator">=</span> bean<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            System<span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"年龄为："</span> <span class="token operator">+</span> age <span class="token operator">+</span> <span class="token string">"，执行对应校验逻辑"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>age <span class="token operator">&gt;=</span> <span class="token number">20</span> <span class="token operator">&amp;&amp;</span> age <span class="token operator">&lt;</span> <span class="token number">30</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                defaultGroupSequence<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>Person<span class="token punctuation">.</span>WhenAge20And30Group<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>age <span class="token operator">&gt;=</span> <span class="token number">30</span> <span class="token operator">&amp;&amp;</span> age <span class="token operator">&lt;</span> <span class="token number">40</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                defaultGroupSequence<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>Person<span class="token punctuation">.</span>WhenAge30And40Group<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> defaultGroupSequence<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>2、在待校验的javaBean里使用<code>@GroupSequenceProvider</code>注解指定处理器。并且定义好对应的校验逻辑（包括分组）</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@GroupSequenceProvider</span><span class="token punctuation">(</span>PersonGroupSequenceProvider<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Getter</span>
<span class="token annotation punctuation">@Setter</span>
<span class="token annotation punctuation">@ToString</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@NotNull</span>
    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@NotNull</span>
    <span class="token annotation punctuation">@Range</span><span class="token punctuation">(</span>min <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span> max <span class="token operator">=</span> <span class="token number">40</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> Integer age<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@NotNull</span><span class="token punctuation">(</span>groups <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>WhenAge20And30Group<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> WhenAge30And40Group<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Size</span><span class="token punctuation">(</span>min <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> max <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> groups <span class="token operator">=</span> WhenAge20And30Group<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Size</span><span class="token punctuation">(</span>min <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> max <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span> groups <span class="token operator">=</span> WhenAge30And40Group<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> List<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> hobbies<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 定义专属的业务逻辑分组
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">WhenAge20And30Group</span> <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">WhenAge30And40Group</span> <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>测试用例同上，做出简单修改：<code>person.setAge(25)</code>，运行打印输出：</p> 
<pre><code class="prism language-java">年龄为：<span class="token number">25</span>，执行对应校验逻辑
年龄为：<span class="token number">25</span>，执行对应校验逻辑
</code></pre> 
<p>没有校验失败的消息（就是好消息），符合预期。<br> 再修改为<code>person.setAge(35)</code>，再次运行打印如下：</p> 
<pre><code class="prism language-java">年龄为：<span class="token number">35</span>，执行对应校验逻辑
年龄为：<span class="token number">35</span>，执行对应校验逻辑
hobbies 个数必须在<span class="token number">3</span>和<span class="token number">5</span>之间<span class="token operator">:</span> <span class="token punctuation">[</span>足球<span class="token punctuation">,</span> 篮球<span class="token punctuation">]</span>
</code></pre> 
<p><strong>校验成功，结果符合预期。</strong><br> 从此案例可以看到，通过<code>@GroupSequenceProvider</code>我完全实现了多字段组合校验的逻辑，并且代码也非常的优雅、可扩展，希望此示例对你有所帮助。</p> 
<blockquote> 
 <p>本利中的provider处理器是Person专用的，当然你可以使用<strong>Object+反射</strong>让它变得更为通用，但本着职责单一原则，我并不建议这么去做。</p> 
</blockquote> 
<h6><a id="JSRGroupSequence_160"></a>使用JSR提供的<code>@GroupSequence</code>注解控制校验顺序</h6> 
<p>上面的实现方式是最佳实践，使用起来不难，灵活度也非常高。但是我们<strong>必须要明白</strong>它是<code>Hibernate Validation</code>提供的能力，而不费<code>JSR</code>标准提供的。<br> <code>@GroupSequence</code>它是<code>JSR</code>标准提供的注解（只是没有provider强大而已，但也有很适合它的使用场景）</p> 
<pre><code class="prism language-java"><span class="token comment">// Defines group sequence.  定义组序列（序列：顺序执行的）</span>
<span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> TYPE <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span>RUNTIME<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token keyword">public</span> @<span class="token keyword">interface</span> <span class="token class-name">GroupSequence</span> <span class="token punctuation">{<!-- --></span>
	Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>顾名思义，它表示<code>Group组序列</code>。<strong>默认情况下，不同组别的约束验证是无序的</strong><br> 在某些情况下，约束验证的<strong>顺序</strong>是非常的重要的，比如如下两个场景：</p> 
<ol><li>第二个<strong>组</strong>的约束验证依赖于第一个约束执行完成的结果（必须第一个约束正确了，第二个约束执行才有意义）</li><li>某个Group组的校验非常耗时，并且会消耗比较大的CPU/内存。那么我们的做法应该是把这种校验<strong>放到最后</strong>，所以对顺序提出了要求</li></ol> 
<p><strong>一个组可以定义为其他组的序列</strong>，使用它进行验证的时候必须符合该序列规定的顺序。<code>在使用组序列验证的时候</code>，<strong>如果序列前边的组验证失败</strong>，则后面的组将不再给予验证。</p> 
<p>给个栗子：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@NotEmpty</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"firstname may be empty"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> String firstname<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@NotEmpty</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"middlename may be empty"</span><span class="token punctuation">,</span> groups <span class="token operator">=</span> Default<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> String middlename<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@NotEmpty</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"lastname may be empty"</span><span class="token punctuation">,</span> groups <span class="token operator">=</span> GroupA<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> String lastname<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@NotEmpty</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"country may be empty"</span><span class="token punctuation">,</span> groups <span class="token operator">=</span> GroupB<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> String country<span class="token punctuation">;</span>


    <span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">GroupA</span> <span class="token punctuation">{<!-- --></span>
	<span class="token punctuation">}</span>
	<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">GroupB</span> <span class="token punctuation">{<!-- --></span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 组序列</span>
	<span class="token annotation punctuation">@GroupSequence</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>Default<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> GroupA<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> GroupB<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Group</span> <span class="token punctuation">{<!-- --></span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>测试：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>  <span class="token punctuation">{<!-- --></span>
    User user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 此处指定了校验组是：User.Group.class</span>
    Set<span class="token operator">&lt;</span>ConstraintViolation<span class="token generics function"><span class="token punctuation">&lt;</span>User<span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span> result <span class="token operator">=</span> Validation<span class="token punctuation">.</span><span class="token function">buildDefaultValidatorFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValidator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> User<span class="token punctuation">.</span>Group<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 对结果进行遍历输出</span>
    result<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>v <span class="token operator">-</span><span class="token operator">&gt;</span> v<span class="token punctuation">.</span><span class="token function">getPropertyPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> v<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">": "</span> <span class="token operator">+</span> v<span class="token punctuation">.</span><span class="token function">getInvalidValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>运行，控制台打印：</p> 
<pre><code class="prism language-java">middlename middlename may be empty<span class="token operator">:</span> null
firstname firstname may be empty<span class="token operator">:</span> null
</code></pre> 
<p>现象：只有<code>Default</code>这个Group的校验了，序列上其它组并没有执行校验。更改如下：</p> 
<pre><code class="prism language-java">        User user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setFirstname</span><span class="token punctuation">(</span><span class="token string">"f"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setMiddlename</span><span class="token punctuation">(</span><span class="token string">"s"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>运行，控制台打印：</p> 
<pre><code class="prism language-java">lastname lastname may be empty<span class="token operator">:</span> null
</code></pre> 
<p>现象：<code>Default</code>组都校验通过后，执行了GroupA组的校验。但GroupA组校验木有通过，GroupB组的校验也就不执行了~<br> <strong><code>@GroupSequence</code>提供的组序列顺序执行以及<code>短路</code>能力，在很多场景下是非常非常好用的。</strong></p> 
<p>针对本例的多字段组合逻辑校验，若想借助<code>@GroupSequence</code>来完成，相对来说还是比较困难的。但是也并不是不能做，此处我提供参考思路：</p> 
<ol><li>多字段之间的逻辑、“通信”通过类级别的自定义校验注解来实现（至于为何必须是类级别的，不用解释吧~）</li><li><code>@GroupSequence</code>用来控制组执行顺序（让类级别的自定义注解先执行）</li><li>增加Bean级别的第三属性来辅助校验~</li></ol> 
<p>当然喽，在实际应用中不可能使用它来解决如题的问题，所以我此处就不费篇幅了。我个人建议有兴趣者可以自己动手试试，有助于加深你对数据校验这块的理解。</p> 
<hr> 
<p><a href="https://blog.csdn.net/f641385712/article/details/97042906">这篇文章</a>里有说过：数据校验注解是可以标注在Field属性、方法、构造器以及<code>Class</code>类级别上的。那么关于它们的校验顺序，我们是可控的，并不是网上有些文章所说的无法抉择~</p> 
<blockquote> 
 <p>说明：顺序只能控制在分组级别，无法控制在约束注解级别。因为一个类内的约束（同一分组内），它的顺序是<code>Set&lt;MetaConstraint&lt;?&gt;&gt; metaConstraints</code>来保证的，所以可以认为同一分组内的校验器是木有执行的先后顺序的（不管是类、属性、方法、构造器…）</p> 
</blockquote> 
<p><strong>所以网上有说：校验顺序是先校验字段属性，在进行类级别校验不实，请注意辨别。</strong></p> 
<hr> 
<h5><a id="_248"></a>原理解析</h5> 
<p>本文中，我借助<code>@GroupSequenceProvider</code>来解决了平时开发中多字段组合逻辑校验的痛点问题，总的来说还是使用简单，并且代码也够模块化，易于维护的。<br> <strong>但对于上例的结果输出，你可能和我一样至少有如下疑问：</strong></p> 
<ol><li>为何必须有这一句：<code>defaultGroupSequence.add(Person.class)</code></li><li>为何<code>if (bean != null)</code>必须判空</li><li>为何<code>年龄为：35，执行对应校验逻辑</code>被输出了两次（在判空里面还出现了两次哦~），但校验的失败信息却只有符合预期的一次</li></ol> 
<p><strong>带着问题，我从<code>validate</code>校验的执行流程上开始分析：</strong><br> 1、入口：<code>ValidatorImpl.validate(T object, Class&lt;?&gt;... groups)</code></p> 
<pre><code class="prism language-java">ValidatorImpl：
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token generics function"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> Set<span class="token operator">&lt;</span>ConstraintViolation<span class="token generics function"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span> <span class="token function">validate</span><span class="token punctuation">(</span>T object<span class="token punctuation">,</span> Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> groups<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		Class<span class="token generics function"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> rootBeanClass <span class="token operator">=</span> <span class="token punctuation">(</span>Class<span class="token generics function"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> object<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 获取BeanMetaData，类上的各种信息：包括类上的Group序列、针对此类的默认分组List们等等</span>
		BeanMetaData<span class="token generics function"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> rootBeanMetaData <span class="token operator">=</span> beanMetaDataManager<span class="token punctuation">.</span><span class="token function">getBeanMetaData</span><span class="token punctuation">(</span> rootBeanClass <span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	<span class="token punctuation">}</span>
</code></pre> 
<p>2、<code>beanMetaDataManager.getBeanMetaData(rootBeanClass)</code>得到待校验Bean的元信息</p> 
<blockquote> 
 <p>请注意，此处只传入了Class，并没有传入Object。这是为啥要加<code>!= null</code>判空的核心原因（后面你可以看到传入的是null）。</p> 
</blockquote> 
<pre><code class="prism language-java">BeanMetaDataManager<span class="token operator">:</span>
	<span class="token keyword">public</span> <span class="token generics function"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> BeanMetaData<span class="token generics function"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> <span class="token function">getBeanMetaData</span><span class="token punctuation">(</span>Class<span class="token generics function"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> beanClass<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
		<span class="token comment">// 会调用AnnotationMetaDataProvider来解析约束注解元数据信息（当然还有基于xml/Programmatic的，本文略） </span>
		<span class="token comment">// 注意：它会递归处理父类、父接口等拿到所有类的元数据</span>

		<span class="token comment">// BeanMetaDataImpl.build()方法，会new BeanMetaDataImpl(...) 这个构造函数里面做了N多事</span>
		<span class="token comment">// 其中就有和我本例有关的defaultGroupSequenceProvider</span>
		beanMetaData <span class="token operator">=</span> <span class="token function">createBeanMetaData</span><span class="token punctuation">(</span> beanClass <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre> 
<p>3、<code>new BeanMetaDataImpl( ... )</code>构建出此Class的元数据信息（本例为<code>Person.class</code>）</p> 
<pre><code class="prism language-java">BeanMetaDataImpl：
	<span class="token keyword">public</span> <span class="token function">BeanMetaDataImpl</span><span class="token punctuation">(</span>Class<span class="token generics function"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> beanClass<span class="token punctuation">,</span>
							List<span class="token operator">&lt;</span>Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">&gt;&gt;</span> defaultGroupSequence<span class="token punctuation">,</span> <span class="token comment">// 如果没有配置，此时候defaultGroupSequence一般都为null</span>
							DefaultGroupSequenceProvider<span class="token operator">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> T<span class="token operator">&gt;</span> defaultGroupSequenceProvider<span class="token punctuation">,</span> <span class="token comment">// 我们自定义的处理此Bean的provider</span>
							Set<span class="token generics function"><span class="token punctuation">&lt;</span>ConstraintMetaData<span class="token punctuation">&gt;</span></span> constraintMetaDataSet<span class="token punctuation">,</span> <span class="token comment">// 包含父类的所有属性、构造器、方法等等。在此处会分类：按照属性、方法等分类处理</span>
							ValidationOrderGenerator validationOrderGenerator<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token comment">//对constraintMetaDataSet进行分类</span>
		<span class="token comment">// 这个方法就是筛选出了：所有的约束注解（比如6个约束注解，此处长度就是6  当然包括了字段、方法等上的各种。。。）</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>directMetaConstraints <span class="token operator">=</span> <span class="token function">getDirectConstraints</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// 因为我们Person类有defaultGroupSequenceProvider，所以此处返回true</span>
		<span class="token comment">// 除了定义在类上外，还可以定义全局的：给本类List&lt;Class&lt;?&gt;&gt; defaultGroupSequence此字段赋值</span>
		<span class="token keyword">boolean</span> defaultGroupSequenceIsRedefined <span class="token operator">=</span> <span class="token function">defaultGroupSequenceIsRedefined</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token comment">// 这是为何我们要判空的核心：看看它传的啥：null。所以不判空的就NPE了。这是第一次调用defaultGroupSequenceProvider.getValidationGroups()方法</span>
		List<span class="token operator">&lt;</span>Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">&gt;&gt;</span> resolvedDefaultGroupSequence <span class="token operator">=</span> <span class="token function">getDefaultGroupSequence</span><span class="token punctuation">(</span> null <span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token comment">// 上面拿到resolvedDefaultGroupSequence 分组信息后，会放到所有的校验器里去（包括属性、方法、构造器、类等等）</span>
		<span class="token comment">// so，默认组序列还是灰常重要的（注意：默认组可以有多个哦~~~）</span>
	<span class="token punctuation">}</span>


	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> List<span class="token operator">&lt;</span>Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">&gt;&gt;</span> <span class="token function">getDefaultGroupSequence</span><span class="token punctuation">(</span>T beanState<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasDefaultGroupSequenceProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// so，getValidationGroups方法里请记得判空~</span>
			List<span class="token operator">&lt;</span>Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">&gt;&gt;</span> providerDefaultGroupSequence <span class="token operator">=</span> defaultGroupSequenceProvider<span class="token punctuation">.</span><span class="token function">getValidationGroups</span><span class="token punctuation">(</span> beanState <span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 最重要的是这个方法：getValidDefaultGroupSequence对默认值进行分析~~~</span>
			<span class="token keyword">return</span> <span class="token function">getValidDefaultGroupSequence</span><span class="token punctuation">(</span> beanClass<span class="token punctuation">,</span> providerDefaultGroupSequence <span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> defaultGroupSequence<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token keyword">static</span> List<span class="token operator">&lt;</span>Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">&gt;&gt;</span> <span class="token function">getValidDefaultGroupSequence</span><span class="token punctuation">(</span>Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">&gt;</span> beanClass<span class="token punctuation">,</span> List<span class="token operator">&lt;</span>Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">&gt;&gt;</span> groupSequence<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		List<span class="token operator">&lt;</span>Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">&gt;&gt;</span> validDefaultGroupSequence <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">boolean</span> groupSequenceContainsDefault <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// 标志位：如果解析不到Default这个组  就抛出异常</span>

		<span class="token comment">// 重要</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>groupSequence <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span> Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">&gt;</span> group <span class="token operator">:</span> groupSequence <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token comment">// 这就是为何我们要`defaultGroupSequence.add(Person.class)`这一句的原因所在~~~ 因为需要Default生效~~~</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span> group<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span> beanClass<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					validDefaultGroupSequence<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span> Default<span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
					groupSequenceContainsDefault <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span> 
				<span class="token comment">// 意思是：你要添加Default组，用本类的Class即可，而不能显示的添加Default.class哦~</span>
				<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span> group<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span> Default<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> 
					<span class="token keyword">throw</span> LOG<span class="token punctuation">.</span><span class="token function">getNoDefaultGroupInGroupSequenceException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 正常添加进默认组</span>
					validDefaultGroupSequence<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span> group <span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// 若找不到Default组，就抛出异常了~</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span>groupSequenceContainsDefault <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">throw</span> LOG<span class="token punctuation">.</span><span class="token function">getBeanClassMustBePartOfRedefinedDefaultGroupSequenceException</span><span class="token punctuation">(</span> beanClass <span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> validDefaultGroupSequence<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre> 
<p>到这一步，还仅仅在初始化<code>BeanMetaData</code>阶段，就执行了一次（首次）<code>defaultGroupSequenceProvider.getValidationGroups(null)</code>，所以判空是很有必要的。并且把本class add进默认组也是必须的（否则报错）~<br> 到这里<code>BeanMetaData&lt;T&gt; rootBeanMetaData</code>创建完成，继续<code>validate()</code>的逻辑~</p> 
<p>4、<code>determineGroupValidationOrder(groups)</code>从调用者指定的分组里确定组序列（组的执行顺序）</p> 
<pre><code class="prism language-java">ValidatorImpl：
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token generics function"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> Set<span class="token operator">&lt;</span>ConstraintViolation<span class="token generics function"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span> <span class="token function">validate</span><span class="token punctuation">(</span>T object<span class="token punctuation">,</span> Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> groups<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
		BeanMetaData<span class="token generics function"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> rootBeanMetaData <span class="token operator">=</span> beanMetaDataManager<span class="token punctuation">.</span><span class="token function">getBeanMetaData</span><span class="token punctuation">(</span> rootBeanClass <span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
		<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token comment">// 准备好ValidationContext(持有rootBeanMetaData和object实例)</span>
		
		<span class="token comment">// groups是调用者传进来的分组数组（对应Spring MVC中指定的Group信息~）</span>
		ValidationOrder validationOrder <span class="token operator">=</span> <span class="token function">determineGroupValidationOrder</span><span class="token punctuation">(</span>groups<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token comment">// 准备好ValueContext(持有rootBeanMetaData和object实例)</span>

		<span class="token comment">// 此时还是Bean级别的，开始对此bean执行校验</span>
		<span class="token keyword">return</span> <span class="token function">validateInContext</span><span class="token punctuation">(</span> validationContext<span class="token punctuation">,</span> valueContext<span class="token punctuation">,</span> validationOrder <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">private</span> ValidationOrder <span class="token function">determineGroupValidationOrder</span><span class="token punctuation">(</span>Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token punctuation">]</span> groups<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		Collection<span class="token operator">&lt;</span>Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">&gt;&gt;</span> resultGroups<span class="token punctuation">;</span>
		<span class="token comment">// if no groups is specified use the default</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span> groups<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			resultGroups <span class="token operator">=</span> DEFAULT_GROUPS<span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
			resultGroups <span class="token operator">=</span> Arrays<span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span> groups <span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// getValidationOrder()主要逻辑描述。此时候resultGroups 至少也是个[Default.class]</span>
		<span class="token comment">// 1、如果仅仅只是一个Default.class，那就直接return</span>
		<span class="token comment">// 2、遍历所有的groups。（指定的Group必须必须是接口）</span>
		<span class="token comment">// 3、若遍历出来的group标注有`@GroupSequence`注解，特殊处理此序列（把序列里的分组们添加进来）</span>
		<span class="token comment">// 4、普通的Group，那就new Group( clazz )添加进`validationOrder`里。并且递归插入（因为可能存在父接口的情况）</span>
		<span class="token keyword">return</span> validationOrderGenerator<span class="token punctuation">.</span><span class="token function">getValidationOrder</span><span class="token punctuation">(</span> resultGroups <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre> 
<p>到这<code>ValidationOrder</code>（实际为<code>DefaultValidationOrder</code>）保存着调用者调用<code>validate()</code>方法时传入的<code>Groups</code>们。分组序列<code>@GroupSequence</code>在此时会被解析。<br> 到了<code>validateInContext( ... )</code>就开始拿着这些Groups分组、元信息开始对此Bean进行校验了~</p> 
<p>5、<code>validateInContext( ... )</code>在上下文（校验上下文、值上下文、<strong>指定的分组里</strong>）对此Bean进行校验</p> 
<pre><code class="prism language-java">ValidatorImpl：
	<span class="token keyword">private</span> <span class="token generics function"><span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> U<span class="token punctuation">&gt;</span></span> Set<span class="token operator">&lt;</span>ConstraintViolation<span class="token generics function"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span> <span class="token function">validateInContext</span><span class="token punctuation">(</span>ValidationContext<span class="token generics function"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> validationContext<span class="token punctuation">,</span> ValueContext<span class="token generics function"><span class="token punctuation">&lt;</span>U<span class="token punctuation">,</span> Object<span class="token punctuation">&gt;</span></span> valueContext<span class="token punctuation">,</span> ValidationOrder validationOrder<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span> valueContext<span class="token punctuation">.</span><span class="token function">getCurrentBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> null <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 兼容整个Bean为null值</span>
			<span class="token keyword">return</span> Collections<span class="token punctuation">.</span><span class="token function">emptySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// 如果该Bean头上标注了（需要defaultGroupSequence处理），那就特殊处理一下</span>
		<span class="token comment">// 本例中我们的Person肯定为true，可以进来的</span>
		BeanMetaData<span class="token generics function"><span class="token punctuation">&lt;</span>U<span class="token punctuation">&gt;</span></span> beanMetaData <span class="token operator">=</span> valueContext<span class="token punctuation">.</span><span class="token function">getCurrentBeanMetaData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span> beanMetaData<span class="token punctuation">.</span><span class="token function">defaultGroupSequenceIsRedefined</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

			<span class="token comment">// 注意此处又调用了beanMetaData.getDefaultGroupSequence()这个方法，这算是二次调用了</span>
			<span class="token comment">// 此处传入的Object哟~这就解释了为何在判空里面的 `年龄为：xxx`被打印了两次的原因</span>
			<span class="token comment">// assertDefaultGroupSequenceIsExpandable方法是个空方法（默认情况下），可忽略</span>
			validationOrder<span class="token punctuation">.</span><span class="token function">assertDefaultGroupSequenceIsExpandable</span><span class="token punctuation">(</span> beanMetaData<span class="token punctuation">.</span><span class="token function">getDefaultGroupSequence</span><span class="token punctuation">(</span> valueContext<span class="token punctuation">.</span><span class="token function">getCurrentBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// ==============下面对于执行顺序，就很重要了===============</span>
		<span class="token comment">// validationOrder装着的是调用者指定的分组（解析分组序列来保证顺序~~~）</span>
		<span class="token comment">// 需要特别注意：光靠指定分组，是无序的（不能保证校验顺序的） 所以若指定多个分组需要小心求证</span>
		Iterator<span class="token generics function"><span class="token punctuation">&lt;</span>Group<span class="token punctuation">&gt;</span></span> groupIterator <span class="token operator">=</span> validationOrder<span class="token punctuation">.</span><span class="token function">getGroupIterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 按照调用者指定的分组（顺序），一个一个的执行分组校验。</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span> groupIterator<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			Group group <span class="token operator">=</span> groupIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			valueContext<span class="token punctuation">.</span><span class="token function">setCurrentGroup</span><span class="token punctuation">(</span>group<span class="token punctuation">.</span><span class="token function">getDefiningClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置当前正在执行的分组</span>

			<span class="token comment">// 这个步骤就稍显复杂了，也是核心的逻辑之一。大致过程如下：</span>
			<span class="token comment">// 1、拿到该Bean的BeanMetaData</span>
			<span class="token comment">// 2、若defaultGroupSequenceIsRedefined()=true  本例Person标注了provder注解，所以有指定的分组序列的</span>
			<span class="token comment">// 3、根据分组序列的顺序，挨个执行分组们（对所有的约束MetaConstraint都顺序执行分组们）</span>
			<span class="token comment">// 4、最终完成所有的MetaConstraint的校验，进而完成此部分所有的字段、方法等的校验</span>
			<span class="token function">validateConstraintsForCurrentGroup</span><span class="token punctuation">(</span> validationContext<span class="token punctuation">,</span> valueContext <span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">shouldFailFast</span><span class="token punctuation">(</span> validationContext <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">return</span> validationContext<span class="token punctuation">.</span><span class="token function">getFailingConstraints</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		
		<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token comment">// 和上面一样的代码，校验validateCascadedConstraints</span>
		
		<span class="token comment">// 继续遍历序列：和@GroupSequence相关了</span>
		Iterator<span class="token generics function"><span class="token punctuation">&lt;</span>Sequence<span class="token punctuation">&gt;</span></span> sequenceIterator <span class="token operator">=</span> validationOrder<span class="token punctuation">.</span><span class="token function">getSequenceIterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

		<span class="token comment">// 校验上下文的错误消息：它会把本校验下，所有的验证器上下文ConstraintValidatorContext都放一起的</span>
		<span class="token comment">// 注意：所有的校验注解之间的上下文ConstraintValidatorContext是完全独立的，无法互相访问通信</span>
		<span class="token keyword">return</span> validationContext<span class="token punctuation">.</span><span class="token function">getFailingConstraints</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre> 
<p>that is all. 到这一步整个校验就完成了，若不快速失败，默认会拿到<strong>所有</strong>校验失败的消息。</p> 
<hr> 
<p>真正执行<code>isValid</code>的方法在这里：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">ConstraintTree</span><span class="token operator">&lt;</span>A <span class="token keyword">extends</span> <span class="token class-name">Annotation</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	<span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token generics function"><span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> V<span class="token punctuation">&gt;</span></span> Set<span class="token operator">&lt;</span>ConstraintViolation<span class="token generics function"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span> <span class="token function">validateSingleConstraint</span><span class="token punctuation">(</span>
			ValidationContext<span class="token generics function"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> executionContext<span class="token punctuation">,</span> <span class="token comment">// 它能知道所属类</span>
			ValueContext<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token punctuation">,</span> <span class="token operator">?</span><span class="token operator">&gt;</span> valueContext<span class="token punctuation">,</span>
			ConstraintValidatorContextImpl constraintValidatorContext<span class="token punctuation">,</span>
			ConstraintValidator<span class="token generics function"><span class="token punctuation">&lt;</span>A<span class="token punctuation">,</span> V<span class="token punctuation">&gt;</span></span> validator<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			
		<span class="token keyword">boolean</span> isValid<span class="token punctuation">;</span>
		<span class="token comment">// 解析出value值</span>
		V validatedValue <span class="token operator">=</span> <span class="token punctuation">(</span>V<span class="token punctuation">)</span> valueContext<span class="token punctuation">.</span><span class="token function">getCurrentValidatedValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
		<span class="token comment">// 把value值交给校验器的isValid方法去校验~~~</span>
		isValid <span class="token operator">=</span> validator<span class="token punctuation">.</span><span class="token function">isValid</span><span class="token punctuation">(</span>validatedValue<span class="token punctuation">,</span>constraintValidatorContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isValid<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 校验没通过就使用constraintValidatorContext校验上下文来生成错误消息</span>
			<span class="token comment">// 使用上下文是因为：毕竟错误消息可不止一个啊~~~</span>
			<span class="token comment">// 当然此处借助了executionContext的方法~~~内部其实调用的是constraintValidatorContext.getConstraintViolationCreationContexts()这个方法而已</span>
			<span class="token keyword">return</span> executionContext<span class="token punctuation">.</span><span class="token function">createConstraintViolations</span><span class="token punctuation">(</span>valueContext<span class="token punctuation">,</span> constraintValidatorContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>至于上下文<code>ConstraintValidatorContext</code>怎么来的，是new出来的：<code>new ConstraintValidatorContextImpl( ... )</code>，<strong>每个字段的一个校验注解对应一个上下文</strong>（一个属性上可以标注多个约束注解哦~），所以此上下文是有很强的<strong>隔离性</strong>的。</p> 
<blockquote> 
 <p><code>ValidationContext&lt;T&gt; validationContext</code>和<code>ValueContext&lt;?, Object&gt; valueContext</code>它哥俩是类级别的，直到<code>ValidatorImpl.validateMetaConstraints</code>方法开始一个一个约束器的校验~</p> 
</blockquote> 
<blockquote> 
 <p>自定义注解中只把<code>ConstraintValidatorContext</code>上下文给调用者使用，而并没有给<code>validationContext</code>和<code>valueContext</code>，我<strong>个人觉得</strong>这个设计是不够灵活的，无法方便的实现<code>dependOn</code>的效果~</p> 
</blockquote> 
<p><code>ConstraintValidatorContext</code>一般它能用于在代码里个性化错误消息<code>ConstraintViolation</code>。可以这么来做：</p> 
<pre><code class="prism language-java">        context<span class="token punctuation">.</span><span class="token function">disableDefaultConstraintViolation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 禁用注解上默认的模版消息</span>
        <span class="token comment">// context.getDefaultConstraintMessageTemplate(); // 未插值的消息模版</span>
        <span class="token comment">//context.buildConstraintViolationWithTemplate("这是我的错误消息模版")</span>
        <span class="token comment">//        .addParameterNode()</span>
        <span class="token comment">//        .addPropertyNode()</span>
        <span class="token comment">//        .addContainerElementNode()</span>
        <span class="token comment">//        .addConstraintViolation();</span>
</code></pre> 
<p>若你想要更多的功能，可使用子接口<code>HibernateConstraintValidatorContext</code>提供的方法。参见这里：<a href="https://blog.csdn.net/f641385712/article/details/96764829">【小家Java】深入了解数据校验（Bean Validation）：基础类打点（ValidationProvider、ConstraintDescriptor、ConstraintValidator）</a></p> 
<hr> 
<h3><a id="_479"></a>解决网友的问题</h3> 
<p>我把这部分看似是本文最重要的引线放到最后，是因为我觉得我的描述已经解决这一类问题，而不是只解决了这一个问题。</p> 
<p>回到文首截图中热心网友反应的问题，只要你阅读了本文，我十分坚信你已经有办法去使用<code>Bean Validation</code>优雅的解决了。如果各位没有意见，此处我就略了~</p> 
<h3><a id="_483"></a>总结</h3> 
<p>本文讲述了使用<code>@GroupSequenceProvider</code>来解决多字段联合逻辑校验的这一类问题，这也许是曾经很多人的开发痛点，希望本文能帮你一扫之前的障碍，全面拥抱<code>Bean Validation</code>吧~<br> 本文我也传达了一个观点：相信流行的开源东西的优秀，不是非常极端的case，深入使用它能解决你绝大部分的问题的。</p> 
<h5><a id="_486"></a>相关阅读</h5> 
<p><a href="https://blog.csdn.net/f641385712/article/details/97621783">@Validated和@Valid的区别？教你使用它完成Controller参数校验（含级联属性校验）以及原理分析【享学Spring】</a><br> <a href="https://blog.csdn.net/f641385712/article/details/97968775">Bean Validation完结篇：你必须关注的边边角角（约束级联、自定义约束、自定义校验器、国际化失败消息…）【享学Spring】</a><br> <a href="https://blog.csdn.net/f641385712/article/details/96638596">深入了解数据校验：Java Bean Validation 2.0（JSR303、JSR349、JSR380）Hibernate-Validation 6.x使用案例【享学Java】</a></p> 
<hr> 
<h2><a id="A_492"></a>关注A哥</h2> 
<table><thead><tr><th>Author</th><th><a href="https://www.yourbatman.cn/about" rel="nofollow">A哥(YourBatman)</a></th></tr></thead><tbody><tr><td>个人站点</td><td><a href="https://www.yourbatman.cn" rel="nofollow">www.yourbatman.cn</a></td></tr><tr><td>E-mail</td><td>yourbatman@qq.com</td></tr><tr><td><strong>微 信</strong></td><td><a href="https://www.yourbatman.cn/images/wechat.png" rel="nofollow">fsx641385712</a></td></tr><tr><td><strong><code>活跃平台</code></strong></td><td><a href="https://www.yourbatman.cn" rel="nofollow"><img src="https://images2.imgbox.com/05/0d/x1Y9QC1s_o.png" alt=""></a> <a href="https://fangshixiang.blog.csdn.net/" rel="nofollow"><img src="https://images2.imgbox.com/2a/bd/JxlZBkOS_o.png" alt=""></a><a href="https://yourbatman.cnblogs.com" rel="nofollow"><img src="https://images2.imgbox.com/c8/b4/QatMNJSh_o.png" alt=""></a><a href="https://juejin.im/user/5b44d178f265da0fa1220efe/posts" rel="nofollow"><img src="https://images2.imgbox.com/cb/16/mV6MuzJg_o.png" alt=""></a><a href="https://www.zhihu.com/people/fangshixiang/posts" rel="nofollow"><img src="https://images2.imgbox.com/1d/6c/T0P3XZhv_o.png" alt=""></a><a href="https://www.jianshu.com/u/8740f1fdd684" rel="nofollow"><img src="https://images2.imgbox.com/03/c8/4eh7F2y2_o.png" alt=""></a><a href="https://segmentfault.com/u/yourbatman/articles" rel="nofollow"><img src="https://images2.imgbox.com/ac/1d/zif9rLhQ_o.png" alt=""></a><a href="https://github.com/yourbatman"><img src="https://images2.imgbox.com/e7/42/HYjnImbS_o.png" alt=""></a></td></tr><tr><td><strong>公众号</strong></td><td><a href="https://www.yourbatman.cn/images/wechat_channel.jpg" rel="nofollow">BAT的乌托邦（ID：BAT-utopia）</a></td></tr><tr><td>知识星球</td><td><a href="https://t.zsxq.com/nQBi66I" rel="nofollow">BAT的乌托邦</a></td></tr><tr><td>每日文章推荐</td><td><a href="https://github.com/yourbatman/reading/issues">每日文章推荐</a></td></tr></tbody></table> 
<p><img src="https://images2.imgbox.com/a5/ad/e44d2Ymd_o.gif" alt="BAT的乌托邦"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2ca05ff1124f2442425548c3b6696112/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">java代码实现向有kerberos认证的kafka中发送数据</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ec3f707712f78a1638a0fc2f7f158051/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Django-Migration admin.0001_initial is applied before its dependency accounts.0001_initial on....</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>