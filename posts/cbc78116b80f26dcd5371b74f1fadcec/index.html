<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>lotus挖矿常用命令 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="lotus挖矿常用命令" />
<meta property="og:description" content="lotus 常用命令 lotus启动停止lotus导出链数据快照压缩链数据以减少磁盘占用修改矿工地址（owner、worker、control）从矿工账户转FIL到owner地址管理钱包安全重启miner daemon封装承诺扇区（pledge sectors）自定义存储位置订单备份和恢复Lotus Miner连接其他lotus daemonlotus在国内运行注意常用命令 Filecoin is a peer-to-peer network that stores files on the internet, with built-in economic incentives to ensure files are stored reliably over time. lotus启动停止 # 首次启动，从快照导入链数据 lotus daemon --import-snapshot &lt;filename&gt; # 普通启动 lotus daemon # 停止 lotus daemon stop # 导入快照不启动 lotus daemon --import-snapshot --halt-after-import &lt;filename&gt; lotus导出链数据快照 lotus chain export --recent-stateroots=900 --skip-old-msgs snapshot.car 压缩链数据以减少磁盘占用 # 共三步 # step1 lotus daemon stop	#停止lotus节点 # step2 rm $LOTUS_PATH/datastore/char/*	# 删除链数据 # step3 lotus daemon --import-snapshot &lt;filename&gt;	# 从新的快照同步链 修改矿工地址（owner、worker、control） # 查看矿工关联的地址信息 lotus-miner actor control list # 修改owner地址 lotus-miner actor set-owner --really-do-it &lt;address&gt; # 修改control地址 lotus-miner actor control set --really-do-it &lt;address1 address2 ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/cbc78116b80f26dcd5371b74f1fadcec/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-12-14T23:47:46+08:00" />
<meta property="article:modified_time" content="2020-12-14T23:47:46+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">lotus挖矿常用命令</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>lotus 常用命令</h4> 
 <ul><li><ul><li><a href="#lotus_2" rel="nofollow">lotus启动停止</a></li><li><a href="#lotus_13" rel="nofollow">lotus导出链数据快照</a></li><li><a href="#_17" rel="nofollow">压缩链数据以减少磁盘占用</a></li><li><a href="#ownerworkercontrol_27" rel="nofollow">修改矿工地址（owner、worker、control）</a></li><li><a href="#FILowner_39" rel="nofollow">从矿工账户转FIL到owner地址</a></li><li><a href="#_43" rel="nofollow">管理钱包</a></li><li><a href="#miner_daemon_64" rel="nofollow">安全重启miner daemon</a></li><li><a href="#pledge_sectors_85" rel="nofollow">封装承诺扇区（pledge sectors）</a></li><li><a href="#_94" rel="nofollow">自定义存储位置</a></li><li><a href="#_102" rel="nofollow">订单</a></li><li><a href="#Lotus_Miner_111" rel="nofollow">备份和恢复Lotus Miner</a></li><li><a href="#lotus_daemon_131" rel="nofollow">连接其他lotus daemon</a></li><li><a href="#lotus_138" rel="nofollow">lotus在国内运行注意</a></li><li><a href="#_146" rel="nofollow">常用命令</a></li></ul> 
 </li></ul> 
</div> 
<br> 
<font color="0x005500" size="1">Filecoin is a peer-to-peer network that stores files on the internet, with built-in economic incentives to ensure files are stored reliably over time.</font> 
<p></p> 
<h3><a id="lotus_2"></a>lotus启动停止</h3> 
<pre><code class="prism language-shell"><span class="token comment"># 首次启动，从快照导入链数据</span>
lotus daemon --import-snapshot <span class="token operator">&lt;</span>filename<span class="token operator">&gt;</span>
<span class="token comment"># 普通启动</span>
lotus daemon
<span class="token comment"># 停止</span>
lotus daemon stop
<span class="token comment"># 导入快照不启动</span>
lotus daemon --import-snapshot --halt-after-import <span class="token operator">&lt;</span>filename<span class="token operator">&gt;</span>
</code></pre> 
<h3><a id="lotus_13"></a>lotus导出链数据快照</h3> 
<pre><code class="prism language-shell">lotus chain <span class="token function">export</span> --recent-stateroots<span class="token operator">=</span>900 --skip-old-msgs snapshot.car
</code></pre> 
<h3><a id="_17"></a>压缩链数据以减少磁盘占用</h3> 
<pre><code class="prism language-shell"><span class="token comment"># 共三步</span>
<span class="token comment"># step1</span>
lotus daemon stop	<span class="token comment">#停止lotus节点</span>
<span class="token comment"># step2</span>
<span class="token function">rm</span> <span class="token variable">$LOTUS_PATH</span>/datastore/char/*	<span class="token comment"># 删除链数据</span>
<span class="token comment"># step3</span>
lotus daemon --import-snapshot <span class="token operator">&lt;</span>filename<span class="token operator">&gt;</span>	<span class="token comment"># 从新的快照同步链</span>
</code></pre> 
<h3><a id="ownerworkercontrol_27"></a>修改矿工地址（owner、worker、control）</h3> 
<pre><code class="prism language-shell"><span class="token comment"># 查看矿工关联的地址信息</span>
lotus-miner actor control list
<span class="token comment"># 修改owner地址</span>
lotus-miner actor set-owner --really-do-it <span class="token operator">&lt;</span>address<span class="token operator">&gt;</span>
<span class="token comment"># 修改control地址</span>
lotus-miner actor control <span class="token keyword">set</span> --really-do-it <span class="token operator">&lt;</span>address1 address2 <span class="token punctuation">..</span>.<span class="token operator">&gt;</span>
<span class="token comment"># 修改worker地址</span>
lotus-miner actor propose-change-worker <span class="token operator">&lt;</span>address<span class="token operator">&gt;</span>
lotus-miner actor confirm-change-worker <span class="token operator">&lt;</span>address<span class="token operator">&gt;</span>
</code></pre> 
<h3><a id="FILowner_39"></a>从矿工账户转FIL到owner地址</h3> 
<pre><code class="prism language-shell">lotus-miner actor withdraw <span class="token operator">&lt;</span>amount<span class="token operator">&gt;</span>
</code></pre> 
<h3><a id="_43"></a>管理钱包</h3> 
<pre><code class="prism language-shell"><span class="token comment"># 创建钱包</span>
lotus wallet new bls	<span class="token comment"># BLS wallet</span>
lotus wallet new 	<span class="token comment"># secp256k1 wallet</span>
lotus msig create singeraddress1 signersaddress2<span class="token punctuation">..</span>	<span class="token comment"># multisig wallet</span>
<span class="token comment"># 备份钱包</span>
lotus wallet <span class="token function">export</span> <span class="token operator">&lt;</span>address<span class="token operator">&gt;</span> <span class="token operator">&gt;</span> <span class="token operator">&lt;</span>address<span class="token operator">&gt;</span>.key
<span class="token comment"># 导入钱包</span>
lotus wallet <span class="token function">import</span> <span class="token operator">&lt;</span>address<span class="token operator">&gt;</span>.key
<span class="token comment"># 查看钱包地址</span>
lotus wallet list
<span class="token comment"># 默认钱包地址</span>
lotus wallet deault <span class="token comment"># 查看默认钱包地址</span>
lotus wallet set-default <span class="token operator">&lt;</span>address<span class="token operator">&gt;</span> <span class="token comment"># 更改默认钱包地址</span>
<span class="token comment"># 查看钱包余额（default）</span>
lotus wallet balance
<span class="token comment"># 发送FIL</span>
lotus send <span class="token operator">&lt;</span>receive address<span class="token operator">&gt;</span> 3	<span class="token comment">#从默认钱包发送</span>
lotus send --from <span class="token operator">&lt;</span>send address<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>receive address<span class="token operator">&gt;</span> 3	<span class="token comment">#从指定钱包发送</span>
</code></pre> 
<h3><a id="miner_daemon_64"></a>安全重启miner daemon</h3> 
<pre><code class="prism language-shell"><span class="token comment"># tips1 尽量缩短miner离线时间</span>
<span class="token comment"># tips2 确保current deadline窗口的证明已经提交</span>
lotus-miner proving deadlines
<span class="token comment"># tips3 检查并暂时停止交易（deals）</span>
lotus-miner storage-deals list
lotus-miner retrieval-deals list
lotus-miner data-transfers list
<span class="token comment">## 拒绝交易</span>
lotus-miner storage-deals selection reject --online --offline
lotus-miner retrieval-deals selection reject --online --offline
<span class="token comment">## 重启之后</span>
lotus-miner storage-deals selection reset
lotus-miner retrieval-deals selection reset
<span class="token comment"># tips4 检查正在进行中的封装操作</span>
lotus-miner sectors list
<span class="token comment"># tips5 重启miner</span>
lotus-miner stop
lotus-miner start
</code></pre> 
<h3><a id="pledge_sectors_85"></a>封装承诺扇区（pledge sectors）</h3> 
<pre><code class="prism language-shell"><span class="token comment"># 提交封装任务</span>
lotus-miner sectors pledge
<span class="token comment"># 查看封装sector时间长度</span>
lotus-miner sectors status --log <span class="token operator">&lt;</span>id<span class="token operator">&gt;</span>
<span class="token comment"># 升级承诺扇区到包含交易的新扇区</span>
lotus-miner sectors mark-for-upgrade <span class="token operator">&lt;</span>sector number<span class="token operator">&gt;</span>
</code></pre> 
<h3><a id="_94"></a>自定义存储位置</h3> 
<pre><code class="prism language-shell"><span class="token comment"># 自定义封装（sealing）位置</span>
lotus-miner storage attach --init --seal <span class="token operator">&lt;</span>PATH_FOR_SEALING_STORAGE<span class="token operator">&gt;</span>
<span class="token comment"># 自定义存储（storing）位置</span>
lotus-miner storage attach --init --store <span class="token operator">&lt;</span>PATH_FOR_LONG_TERM_STORAGE<span class="token operator">&gt;</span>
<span class="token comment"># 查看存储路径</span>
</code></pre> 
<h3><a id="_102"></a>订单</h3> 
<pre><code class="prism language-shell">查看接单情况
lotus-miner storage-deals selection list
关闭订单
lotus-miner storage-deals selection reject --online --offline
恢复接单
lotus-miner storage-deals selection reset
</code></pre> 
<h3><a id="Lotus_Miner_111"></a>备份和恢复Lotus Miner</h3> 
<pre><code class="prism language-shell"><span class="token comment"># 备份</span>
<span class="token comment"># step1 创建备份文件夹</span>
<span class="token function">mkdir</span> -p ~/lotus-backups/2020-12-15
<span class="token comment"># step2 备份</span>
lotus-miner backup ~/lotus-backups/2020-12-15/backup.cbor <span class="token comment"># 需要设置LOTUS_BACKUP_BASE_PATH</span>
lotus-miner backup --offline ~/lotus-backups/2020-12-15/backup.cbor
<span class="token comment"># step3 备份config.toml 和 storage.json</span>
<span class="token function">cp</span> ~/.lotusminer/config.toml ~/.lotusminer/storage.json ~/lotus-backups/2012-12-15

<span class="token comment"># 恢复</span>
<span class="token comment"># step1 拷贝backup.cbor, config.toml, storage.json到miner所在的机器</span>
<span class="token comment"># step2 从备份文件恢复</span>
lotus-miner init resotre ~/lotus-backups/2020-12-15/backup.cbor
<span class="token comment"># step3 拷贝覆盖config.toml 和 storage.json</span>
<span class="token function">cp</span> ~/lotus-backups/2020-12-15/config.toml ~/lotus-backups/2020-12-15/storage.json <span class="token variable">$LOTUS_MINER_PATH</span>/
<span class="token comment"># step4 启动miner</span>
lotus-miner run
</code></pre> 
<h3><a id="lotus_daemon_131"></a>连接其他lotus daemon</h3> 
<pre><code class="prism language-shell"><span class="token comment"># 设置FULLNODE_API_INFO 环境变量</span>
<span class="token function">export</span> FULLNODE_API_INFO<span class="token operator">=</span><span class="token string">"TOKEN:/ip4/&lt;ip&gt;/tcp/&lt;port&gt;/http"</span>
<span class="token comment"># FULLNODE_API_INFO 值通过如下命令产生, ip需要修改</span>
lotus auth api-info --perm admin
</code></pre> 
<h3><a id="lotus_138"></a>lotus在国内运行注意</h3> 
<pre><code class="prism language-shell"><span class="token comment"># 加速首次启动 proof parameter 下载</span>
<span class="token function">export</span> IPFS_GATEWAY<span class="token operator">=</span>https://proof-parameters.s3.cn-south-1.jdcloud-oss.com/ipfs/
<span class="token comment"># 加快lotus 构建时Go依赖模块下载</span>
<span class="token function">export</span> GOPROXY<span class="token operator">=</span>https://goproxy.cn
</code></pre> 
<h3><a id="_146"></a>常用命令</h3> 
<pre><code class="prism language-shell"><span class="token comment"># 通过ip从众多worker机器中找出没有运行的worker</span>
lotus-miner sealing workers <span class="token operator">|</span><span class="token function">grep</span> Worker<span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{ print <span class="token variable">$4</span>}'</span> <span class="token operator">|</span> <span class="token function">awk</span> -F: <span class="token string">'{print <span class="token variable">$1</span>}'</span> <span class="token operator">|</span><span class="token function">awk</span> -F. <span class="token string">'{print <span class="token variable">$4</span>}'</span> <span class="token operator">|</span><span class="token function">sort</span> -n
<span class="token comment"># 查找存储下的tmp文件</span>
<span class="token function">sudo</span> <span class="token function">find</span>  <span class="token keyword">.</span>  -maxdepth 5 -type f -name <span class="token string">"*.tmp"</span>

<span class="token comment"># 批量删除sealing jobs</span>
lotus-miner sealing <span class="token function">jobs</span> <span class="token operator">|</span><span class="token function">awk</span> <span class="token string">'{print <span class="token variable">$1</span>}'</span> <span class="token operator">&gt;</span> remove.job
<span class="token function">cat</span> remove.job <span class="token operator">|</span>xagrs -n 1 lotus-miner sealing abort

<span class="token comment">#磁盘目录下写入挂载点内容</span>
m<span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">ls</span> /data <span class="token operator">|</span><span class="token function">xargs</span> -n 1<span class="token variable">)</span></span><span class="token punctuation">;</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token variable">$m</span> <span class="token punctuation">;</span> <span class="token keyword">do</span>  <span class="token function">touch</span> <span class="token string">"/data/<span class="token variable">$i</span>/data-<span class="token variable">$i</span>"</span><span class="token punctuation">;</span> <span class="token keyword">echo</span> <span class="token string">"/data/<span class="token variable">$i</span>/"</span> <span class="token operator">&gt;</span> <span class="token string">"/data/<span class="token variable">$i</span>/data-<span class="token variable">$i</span>"</span><span class="token punctuation">;</span><span class="token function">cat</span> <span class="token string">"/data/<span class="token variable">$i</span>/data-<span class="token variable">$i</span>"</span><span class="token punctuation">;</span> <span class="token keyword">done</span>

ip<span class="token operator">=</span>10.0.228.201<span class="token punctuation">;</span>m<span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">ls</span> /mnt/$ip <span class="token operator">|</span><span class="token function">xargs</span> -n 1<span class="token variable">)</span></span><span class="token punctuation">;</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token variable">$m</span> <span class="token punctuation">;</span> <span class="token keyword">do</span>  <span class="token function">touch</span> <span class="token string">"/mnt/<span class="token variable">$ip</span>/<span class="token variable">$i</span>/mountpoint"</span><span class="token punctuation">;</span> <span class="token keyword">echo</span> <span class="token string">"/mnt/<span class="token variable">$i</span>/"</span> <span class="token operator">&gt;</span> <span class="token string">"/mnt/<span class="token variable">$ip</span>/<span class="token variable">$i</span>/mountpoint"</span><span class="token punctuation">;</span><span class="token function">cat</span> <span class="token string">"/mnt/<span class="token variable">$ip</span>/<span class="token variable">$i</span>/mountpoint"</span><span class="token punctuation">;</span> <span class="token keyword">done</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/78aa63ceebf4c860f98a237e2216c083/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">树莓派连接蓝牙音箱播放音频-bluealsa</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a065894f8e8b397beca2397ff05735f2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Python实现多个pdf文件合并</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>