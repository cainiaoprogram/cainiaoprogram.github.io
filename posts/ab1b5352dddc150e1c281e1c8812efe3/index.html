<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>mycat的安装使用（技术篇） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="mycat的安装使用（技术篇）" />
<meta property="og:description" content="第一章：概念 1.为什么要拆分： ①MySQL 实例内部结构
1.单一架构
[2]复制架构：
尽管搭建了复制架构，但是实际上从逻辑上来说仍然只有一个 db_hr 数据库。
②性能瓶颈
MySQL 工作过程中的性能瓶颈主要来自于下面三个方面（同等硬件条件下）：
数据存储量：单表 1000 万条数据达到极限；500 万条开始性能明显下降；300 万条开始就应该考虑拆分。I/O 瓶颈：关系型数据库以硬盘作为主要存储介质，所以必然存在 I/O 瓶颈。访问量瓶颈：通常 MySQL 的最大连接数默认是100，最大可以达到 16384。 由此我们可以看出，对数据库进行拆分主要是出于数据量不断增加的挑战。
2、拆分方式 ①垂直拆分 垂直拆分是最容易想到的拆分方式。它按照项目的业务功能模块，把从属于不同模块的数据库表分散到对应的不同数据库中。
这种拆分的优缺点： -优点： -拆分的规则明确，不同的功能模块或者服务模块分配到不同的数据库 -数据库维护与定位简单 -缺点： -并没有解决单表数据量太大的问题 -会出现跨库join -需要对上层应用系统的代码进行重构，修改原有的事务操作 ②水平拆分
针对一张数据量很大的表，把它拆分为多张表，数据分流保存到各个拆分后的数据库表中。
如果数据量继续增加，超过一个单库能够容纳的极限则需要继续分库：
这种拆分方式的优缺点评价： - 只分表不分库： - 同库无分布式事务问题，事务处理相对简单 - 同库无跨库 join 问题 - 表拆分后不存在超大型表的性能问题 - 只要拆分规则定义好，很难出现扩展性的限制，但拆分规则设定并不简单 ，规则一定会和业务挂钩，如根据 id、根据时间等。 - 既分表又分库： - 异库存在分布式事务问题 - 异库存在跨库 join 问题 - 多数据源管理难度加大，代码复杂度增加 3、MyCat 简介 尽管拆分后面临很多问题，但是随着数据量的增加又不得不拆，mycat就是帮助我们实现这个功能的：
MyCat 是一款数据库中间件。
对于应用程序来说完全透明：不管底层的数据如何拆分，应用只需要连接 MyCat 即可完成对数据的操作。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/ab1b5352dddc150e1c281e1c8812efe3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-03-15T12:37:00+08:00" />
<meta property="article:modified_time" content="2022-03-15T12:37:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">mycat的安装使用（技术篇）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3>第一章：概念</h3> 
<h4>1.为什么要拆分：</h4> 
<p><strong>①MySQL 实例内部结构</strong></p> 
<p>1.单一架构</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/f7/3b/QD3lKzDV_o.png"></p> 
<p>[2]复制架构：</p> 
<p>尽管搭建了复制架构，但是实际上从逻辑上来说仍然只有一个 db_hr 数据库。</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/32/9f/0d50ThqA_o.png"></p> 
<p><strong>②性能瓶颈</strong></p> 
<p>MySQL 工作过程中的性能瓶颈主要来自于下面三个方面（同等硬件条件下）：</p> 
<ul><li>数据存储量：单表 1000 万条数据达到极限；500 万条开始性能明显下降；300 万条开始就应该考虑拆分。</li><li>I/O 瓶颈：关系型数据库以硬盘作为主要存储介质，所以必然存在 I/O 瓶颈。</li><li>访问量瓶颈：通常 MySQL 的最大连接数默认是100，最大可以达到 16384。</li></ul> 
<p>由此我们可以看出，对数据库进行拆分主要是出于数据量不断增加的挑战。</p> 
<p></p> 
<h4>2、拆分方式</h4> 
<h4>①垂直拆分</h4> 
<p>垂直拆分是最容易想到的拆分方式。它按照项目的业务功能模块，把从属于不同模块的数据库表分散到对应的不同数据库中。</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/e7/9d/zGx3MBM7_o.png"></p> 
<pre><code>这种拆分的优缺点：
    -优点：
        -拆分的规则明确，不同的功能模块或者服务模块分配到不同的数据库
        -数据库维护与定位简单
    -缺点：
        -并没有解决单表数据量太大的问题
        -会出现跨库join
        -需要对上层应用系统的代码进行重构，修改原有的事务操作</code></pre> 
<p></p> 
<p><strong>②水平拆分</strong></p> 
<p>针对一张数据量很大的表，把它拆分为多张表，数据分流保存到各个拆分后的数据库表中。</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/6a/43/QL9W8jq8_o.png"></p> 
<p>如果数据量继续增加，超过一个单库能够容纳的极限则需要继续分库：</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/5a/82/x1m8zUl5_o.png"></p> 
<pre><code>这种拆分方式的优缺点评价：

- 只分表不分库：
    - 同库无分布式事务问题，事务处理相对简单
    - 同库无跨库 join 问题
    - 表拆分后不存在超大型表的性能问题
    - 只要拆分规则定义好，很难出现扩展性的限制，但拆分规则设定并不简单
，规则一定会和业务挂钩，如根据 id、根据时间等。
- 既分表又分库：
    - 异库存在分布式事务问题
    - 异库存在跨库 join 问题
    - 多数据源管理难度加大，代码复杂度增加</code></pre> 
<p></p> 
<h4>3、MyCat 简介</h4> 
<p>尽管拆分后面临很多问题，但是随着数据量的增加又不得不拆，mycat就是帮助我们实现这个功能的：</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/cf/7e/2wlbayr5_o.png"></p> 
<p>MyCat 是一款数据库中间件。</p> 
<p>对于应用程序来说完全透明：不管底层的数据如何拆分，应用只需要连接 MyCat 即可完成对数据的操作。</p> 
<p>支持 MySQL、SQL Server、Oracle、DB2、PostgreSQL 等主流数据库。</p> 
<p>MyCat 不存储数据，它只是数据的路由。</p> 
<p>底层拦截用户发送过来的 SQL 语句并进行分析：如分片分析、路由分析、读写分离分析、缓存分析等，然后将此 SQL 发往后端的真实数据库，并将返回的结果做适当的处理，最终再返回给用户。</p> 
<p>Mycat的特性如下:</p> 
<ul><li>支持SQL92标准</li><li>遵守Mysql原生协议，跨语言，跨平台，跨数据库的通用中间件代理</li><li>基于心跳的自动故障切换，支持读写分离，支持MySQL主从，以及galera cluster集群</li><li>支持Galera for MySQL集群，Percona Cluster或者MariaDB cluster</li><li>基于Nio实现，有效管理线程，高并发问题</li><li>支持数据的多片自动路由与聚合，支持sum,count,max等常用的聚合函数</li><li>支持单库内部任意join，支持跨库2表join</li><li>支持通过全局表，ER关系的分片策略，实现了高效的多表join查询</li><li>支持多租户方案</li><li>支持分布式事务</li><li>支持全局序列号，解决分布式下的主键生成问题</li><li>分片规则丰富，插件化开发，易于扩展</li><li>强大的web，命令行监控</li><li>支持前端作为mysq通用代理，后端JDBC方式支持Oracle、DB2、SQL Server 、 mongodb</li><li>支持密码加密</li><li>支持服务降级</li><li>支持IP白名单</li><li>支持SQL黑名单、sql注入攻击拦截</li><li>支持分表(1.6以后版本)</li><li>集群基于ZooKeeper管理，在线升级，扩容，智能优化，大数据处理（2.0以后版本）</li></ul> 
<p></p> 
<h3>第二章 安装与配置</h3> 
<h4>1、获取 MyCat 程序</h4> 
<p>访问这个地址下载：https://codeload.github.com/MyCATApache/Mycat-Server/zip/Mycat-server-1675-release</p> 
<h4>2、解压 MyCat 压缩包到idea中</h4> 
<h4>3、配置 schema.xml</h4> 
<p>从这里开始，我们就是在初步搭建 MyCat 服务器。我们想要初步实现的目标：</p> 
<ul><li>MyCat 中配置虚拟数据库、虚拟数据库表，物理库和物理表暂时不拆分</li><li>启动 MyCat</li><li>使用客户端连接到 MyCat</li></ul> 
<p>而让 MyCat 连接物理库、配置虚拟库、虚拟表都需要在 schema.xml 中配置。</p> 
<p><strong>①配置文件位置</strong> <img alt="" src="https://images2.imgbox.com/43/f1/aORTDQXC_o.png"></p> 
<p>         </p> 
<p>②告诉 MyCat 如何连接物理库schema.xml中配置</p> 
<pre><code>&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE mycat:schema SYSTEM "schema.dtd"&gt;
&lt;mycat:schema xmlns:mycat="http://io.mycat/"&gt;

&lt;!--	配置虚拟数据库（虚拟数据库名，检查sql模型，sql最大限制，随机数据节点）--&gt;
	&lt;schema name="virtual_hr" checkSQLschema="true" sqlMaxLimit="100" randomDataNode="datanode"&gt;
&lt;!--        配置虚拟表（制定虚拟表的名称，制定主键，制定使用的节点，制定规则，
				是否开启自增长主键，根据jdbc取出存储
				制定虚拟表对应的物理表）--&gt;
		&lt;table name="virtual_dept" primaryKey="dept_id" dataNode="datanode"
			   rule="sharding-by-intfile" autoIncrement="true"
			   fetchStoreNodeByJdbc="true" subTables="t_dept"&gt;
		&lt;/table&gt;

	&lt;/schema&gt;

&lt;!--	配置数据节点（名称，物理数据库链接连接，具体的数据库）--&gt;
	&lt;dataNode name="datanode" dataHost="physics_db_connect" database="db_hr" /&gt;

&lt;!--	物理数据库连接的配置 （名称，最大连接数，最小连接数，负载均衡，写入方式，数据库类型，驱动，选择类型，从服务器数）--&gt;
	&lt;dataHost name="physics_db_connect" maxCon="1000" minCon="10" balance="0"
			  writeType="0" dbType="mysql" dbDriver="jdbc" switchType="1"  slaveThreshold="100"&gt;
&lt;!--		心跳检查--&gt;
		&lt;heartbeat&gt;select user()&lt;/heartbeat&gt;
&lt;!--		真实物理机地址（命名，url，用户，密码）--&gt;
		&lt;writeHost host="hostM1" url="jdbc:mysql://159.75.227.188:3306" user="root"
				   password="R8tPj-.aC9hWfD8"&gt;
		&lt;/writeHost&gt;
	&lt;/dataHost&gt;

&lt;/mycat:schema&gt;</code></pre> 
<p></p> 
<h4>4、配置 server.xml</h4> 
<p><strong>①配置文件位置</strong></p> 
<p style="text-align:center;"><strong><img alt="" src="https://images2.imgbox.com/80/b8/ZbkuRAwB_o.png"></strong></p> 
<p><strong>②配置 MyCat 自身的连接信息 </strong></p> 
<pre><code>&lt;!--	配置外界连接mycat时候使用的链接信息（mycat用户名，制定密码，
		要链接的虚拟机名称（schema.xml 配置文件中找到 schema 标签的name属性））--&gt;
	&lt;user name="user"&gt;
		&lt;property name="password"&gt;123456&lt;/property&gt;
		&lt;property name="schemas"&gt;virtual_hr&lt;/property&gt;
	&lt;/user&gt;</code></pre> 
<p></p> 
<h4>5、启动 MyCat</h4> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/11/88/5NmOB07O_o.png"></p> 
<p>②配置 JVM 参数</p> 
<ul><li>指定 MYCAT_HOME：这个参数是需要指定 MyCat 工程的 src/main 目录的完整路径。</li><li>指定直接内存大小：如果 512M 不够，那就指定 1024M。</li></ul> 
<blockquote> 
 <p>-DMYCAT_HOME=D:\idea2019workspace\mycat210722\src\main<br> -XX:MaxDirectMemorySize=512M</p> 
</blockquote> 
<p>有可能的问题：</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/db/27/jpn6ENej_o.png"> </p> 
<p>此时就可以通过数据库进行链接了（注意启动服务是本地localhost，端口8066）</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/74/06/TrSllZN9_o.png"></p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/71d04cfa0328924febdd5ceac5563a8e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">webstorm解决git冲突</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4e21d2e1a5dcab582616ada03c123dae/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">1.8版本HashMap底层原理分析</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>