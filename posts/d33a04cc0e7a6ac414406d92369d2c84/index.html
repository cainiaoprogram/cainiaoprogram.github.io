<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Gitlab runner安装和使用 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Gitlab runner安装和使用" />
<meta property="og:description" content="Runner 分为&#34;指定Runner &#34;和&#34;共享Runner &#34;，共享Runner 适用于所有群组和项目，根据tags标签来匹配并执行（Runner 的标签和.gitlab-ci.yml文件任务里的标签）；指定Runner是项目独享的，可以为某个项目单独配置Runner。以下配置的是共享Runner，指定Runner的配置方式一样，只是Token获取的地方不同。
1、下载地址：https://mirrors.tuna.tsinghua.edu.cn/gitlab-runner/yum/el7/
2、安装
wget https://mirrors.tuna.tsinghua.edu.cn/gitlab-runner/yum/el7/gitlab-runner-15.8.1-1.x86_64.rpm yum -y install gitlab-runner-15.8.1-1.x86_64.rpm #查看运行状态 systemctl status gitlab-runner 3、注册到GitLab
3.1 查看GitLab的runner token 图中Show Runner installation instructions按钮也有安装和注册gitlab Runner的步骤 3.2 执行注册命令
gitlab-runner register --url http://192.168.48.128:8001/ --registration-token _sRaUvmhkgzdbLXJ9Gy1 最后的执行器我选择的是shell，常用的还有docker和kubernetes(k8s)
可以在gitlab后台看到刚才注册的runner：
前面没有输入好的，可以在这里进行修改：
tags选项与.gitlab-ci.yml中的tags对应，多个以逗号分隔。
在某个项目里可以看到共享Runner：
4、创建和执行一个流水线
4.1 在项目根目录下面创建文件，并提交：.gitlab-ci.yml stages: - build - deploy #当master分支变更的时候触发 build: stage: build script: #需要执行的脚本内容，也可以是一个sh脚本文件用于执行。 - echo &#34;hello world build&#34; only: - master tags: - trade_runner #这个标签需要与Runner配置的标签匹配 deploy: stage: deploy script: - echo &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/d33a04cc0e7a6ac414406d92369d2c84/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-10T11:09:13+08:00" />
<meta property="article:modified_time" content="2023-02-10T11:09:13+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Gitlab runner安装和使用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>        Runner 分为"指定Runner "和"共享Runner "，共享Runner 适用于所有群组和项目，根据tags标签来匹配并执行（Runner 的标签和<a href="https://mp.csdn.net/mp_blog/creation/editor/120606388" title=".gitlab-ci.yml">.gitlab-ci.yml</a>文件任务里的标签）；指定Runner是项目独享的，可以为某个项目单独配置Runner。以下配置的是共享Runner，指定Runner的配置方式一样，只是Token获取的地方不同。</p> 
<p><strong>1、下载地址：</strong>https://mirrors.tuna.tsinghua.edu.cn/gitlab-runner/yum/el7/</p> 
<p><strong>2、安装</strong></p> 
<pre><code>wget https://mirrors.tuna.tsinghua.edu.cn/gitlab-runner/yum/el7/gitlab-runner-15.8.1-1.x86_64.rpm
yum -y install gitlab-runner-15.8.1-1.x86_64.rpm
#查看运行状态
systemctl status gitlab-runner </code></pre> 
<p><strong>3、注册到GitLab</strong></p> 
<p>        <strong>3.1 查看GitLab的runner token </strong><img alt="" height="298" src="https://images2.imgbox.com/60/81/cJBZ45E4_o.png" width="528"></p> 
<p>                图中Show Runner installation instructions按钮也有安装和注册gitlab Runner的步骤 </p> 
<p>           <strong>3.2 执行注册命令</strong></p> 
<pre><code>gitlab-runner register --url http://192.168.48.128:8001/ --registration-token _sRaUvmhkgzdbLXJ9Gy1</code></pre> 
<p><img alt="" height="344" src="https://images2.imgbox.com/0c/b3/lbRGZyhr_o.png" width="944">        最后的执行器我选择的是shell，常用的还有docker和kubernetes(k8s)</p> 
<p>        可以在gitlab后台看到刚才注册的runner：</p> 
<p><img alt="" height="478" src="https://images2.imgbox.com/b6/ba/5HhSaNdE_o.png" width="1200"></p> 
<p>        前面没有输入好的，可以在这里进行修改：</p> 
<p>        tags选项与.gitlab-ci.yml中的tags对应，多个以逗号分隔。</p> 
<p><img alt="" height="584" src="https://images2.imgbox.com/bb/86/jLzpUt8B_o.png" width="1200"></p> 
<p>        在某个项目里可以看到共享Runner：</p> 
<p><img alt="" height="831" src="https://images2.imgbox.com/e5/be/Bv7AUOiT_o.png" width="1200"></p> 
<p><strong>4、创建和执行一个流水线</strong></p> 
<p>        4.1 在项目根目录下面创建文件，并提交：.gitlab-ci.yml    <img alt="" height="285" src="https://images2.imgbox.com/e1/2c/9FSgP79i_o.png" width="1147"></p> 
<pre><code>stages:
    - build
    - deploy

#当master分支变更的时候触发
build:
    stage: build
    script:    #需要执行的脚本内容，也可以是一个sh脚本文件用于执行。
        - echo "hello world build"   
    only:
        - master
    tags:
        - trade_runner #这个标签需要与Runner配置的标签匹配

deploy:
    stage: deploy
    script:
        - echo "hello world deploy"
    only:
        - master
    tags:
        - trade_runner
</code></pre> 
<p>         可以看到本次提交，就会立马触发流水线，后面更改了一次文件，也触发了一次流水线</p> 
<p><img alt="" height="436" src="https://images2.imgbox.com/b4/b1/9qVJiC7Z_o.png" width="1200">         在”作业“里可以看到流水线中每个步骤的执行日志：   <img alt="" height="506" src="https://images2.imgbox.com/7d/fc/YXmvHkC5_o.png" width="1004"></p> 
<p>  <strong>4、相关命令</strong></p> 
<pre><code>systemctl status gitlab-runner
systemctl stop gitlab-runner
systemctl start gitlab-runner
systemctl restart gitlab-runner

gitlab-runner -h #查看帮助文档
# --user指定将用于执行构建的用户,--working-directory  指定将运行构建时数据存储的根目录
gitlab-runner install --user=gitlab-runner --working-directory=/home/gitlab-runner
gitlab-runner uninstall #停止运行并从服务中卸载GitLab Runner
gitlab-runner start     #启动GitLab Runner服务
gitlab-runner stop      #停止GitLab Runner服务
gitlab-runner restart   #重启GitLab Runner服务
gitlab-runner status #显示GitLab Runner服务的状态

gitlab-runner --debug &lt;command&gt;   #调试模式排查错误特别有用
gitlab-runner &lt;command&gt; --help    #获取帮助信息
gitlab-runner run       #普通用户模式,配置文件: ~/.gitlab-runner/config.toml
sudo gitlab-runner run  # 超级用户模式,配置文件:/etc/gitlab-runner/config.toml

gitlab-runner register  #默认交互模式下使用，非交互模式添加 --non-interactive
gitlab-runner list      #此命令列出了保存在配置文件中的所有运行程序
gitlab-runner verify    #此命令检查注册的runner是否可以连接，但不验证GitLab服务是否正在使用runner。 --delete 删除
gitlab-runner unregister   #该命令使用GitLab取消已注册的runner
gitlab-runner unregister --url http://gitlab.dev.com/ --token djiih23   #使用令牌注销
gitlab-runner unregister --name test-runner #使用名称注销（同名删除第一个）
gitlab-runner unregister --all-runners #注销所有runner</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2d9a1cb4548116f317e1862b9b9c2044/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">[DiceCTF 2023] rSabin</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/acf14130882b1e8f9994f9b42d06482c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【BUG记录】谷粒商城微博登录重定向地址不匹配</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>