<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>图像处理:傅里叶变换 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="图像处理:傅里叶变换" />
<meta property="og:description" content="0 引言
在之前的博客 图像增强， 傅里叶变换（OpenCV)中都有用到过傅里叶变换，但一直都不是特别理解，现系统地学习一下。先来看一个视频 傅里叶级数与傅立叶变换，我们了解到任何周期函数都可以表示为不同频率的正弦函数和/或余弦函数之和，其中每个正弦函数和/或余弦函数都乘以不同的系数。如何找到是哪些频率组成的该周期函数？可以看一下这篇文章 从傅里叶变换进阶到小波变换。学习傅里叶还是要踏踏实实弄清楚公式和概念，没有捷径，接下来我们来推导公式。
1 傅里叶级数
周期为T的 连续变量t的 周期函数f(t)，可表示为乘以适当系数的 正弦函数和余弦函数之和。 这个和就是 傅里叶级数，其形式为
式中，C n 是傅里叶级数
从上式可知， 若要将一个周期信号展开为傅里叶级数形式，实际上就是确定级数，接下来我们讨论如何求出cn。
1.1 三角函数正交性
三角函数是周期函数，其在-π到π的积分必定为0，即
由三角函数的积化和差公式，可以继续推导出下列公式
因为三角函数在-π到π内的积分为0，因此当m≠n时上面三个式子必定为0，因此可以得出以下结论， 频率不同的三角函数相乘在一个周期内(-π到π)的积分必定为0。
假设一函数f(t)由一个直流分量和若干正余弦函数组成
在上式两边同时乘以sin⁡(kωt)，并对它们在一个周期内进行积分，可得
化简得
因此，可得 bn，同理也可得 an
1.2 欧拉公式与傅里叶级数
根据 欧拉公式
当θ=nωt和θ=-nωt时，
将这两项代入傅里叶级数
当n=0时，代入上一小节得到的a0
当n=1,2,3,...时，代入an，bn
当n=-1,-2,-3,...时，代入an，bn
可以看出， 对于任意的n，所有Cn的表达式都是一样的，傅里叶级数最终可以写为：
得证。
2 傅里叶变换 2.1 连续傅里叶变换
傅立叶级数是针对周期函数的，而 傅里叶变换针对非周期函数， 一个非周期函数可以看做周期无限大的函数。当T趋于无穷大时，频率间隔 ω=2π/T趋于无穷小; Δω=(n&#43;1)ω-nω=ω=2π/T，因此 Δω也趋于0， 1/T=Δω/2π;ΣΔω可以写成积分的形式 ∫dω。我们以 nω为变量，当 ω不等于0时， nω为离散值，，但当 ω趋于无穷小时， nω就变成连续的量 ，令 nω=W。
我们将这个式子中标红的部分称作 函数f(t)的傅里叶变换，记作F(w),即
而原始函数f(t)可以写为
我们称之为 傅里叶反变换。
二维连续函数f(x,y)的傅里叶正变换为" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/5dc07c378ac9db98fcb40bb3fe4a92d5/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-19T10:15:10+08:00" />
<meta property="article:modified_time" content="2023-03-19T10:15:10+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">图像处理:傅里叶变换</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="kdocs-document"> 
 <p style="text-align:left;">0 引言</p> 
 <p style="text-align:left;">在之前的博客 <span class="kdocs-bold" style="font-weight:bold;">图像增强</span>， <span class="kdocs-bold" style="font-weight:bold;">傅里叶变换（OpenCV)</span>中都有用到过傅里叶变换，但一直都不是特别理解，现系统地学习一下。先来看一个视频 <span class="kdocs-bold" style="font-weight:bold;">傅里叶级数与傅立叶变换</span>，我们了解到任何周期函数都可以表示为不同频率的正弦函数和/或余弦函数之和，其中每个正弦函数和/或余弦函数都乘以不同的系数。如何找到是哪些频率组成的该周期函数？可以看一下这篇文章 <span class="kdocs-bold" style="font-weight:bold;">从傅里叶变换进阶到小波变换</span>。学习傅里叶还是要踏踏实实弄清楚公式和概念，没有捷径，接下来我们来推导公式。</p> 
 <p style="text-align:left;">1 傅里叶级数</p> 
 <p style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">周期为T的 连续变量t的 周期函数f(t)，可表示为乘以适当系数的 正弦函数和余弦函数之和。 </span>这个和就是 <span class="kdocs-bold" style="font-weight:bold;">傅里叶级数</span>，其形式为</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:211px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:36.966824%;height:0;"> 
    <img src="https://images2.imgbox.com/e6/3c/ojSOR9W3_o.png" style="margin-left:;display:block;width:211px;margin-top:-36.966824%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="text-align:left;">式中，C n 是傅里叶级数</p> 
 <p style="text-align:left;">从上式可知， <span class="kdocs-bold" style="font-weight:bold;">若要将一个周期信号展开为傅里叶级数形式，实际上就是确定级数，接下来我们讨论如何求出cn</span>。</p> 
 <p style="text-align:left;">1.1 三角函数正交性</p> 
 <p style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">三角函数是周期函数，其在-π到π的积分必定为0</span>，即</p> 
 <p style="text-align:left;">由三角函数的积化和差公式，可以继续推导出下列公式</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:511px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:30.136988%;height:0;"> 
    <img src="https://images2.imgbox.com/e2/a6/jK3ofFUs_o.png" style="margin-left:;display:block;width:511px;margin-top:-30.136988%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="text-align:left;">因为三角函数在-π到π内的积分为0，因此当m≠n时上面三个式子必定为0，因此可以得出以下结论， <span class="kdocs-bold" style="font-weight:bold;">频率不同的三角函数相乘在一个周期内(-π到π)的积分必定为0</span>。</p> 
 <p style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">假设一函数f(t)由一个直流分量和若干正余弦函数组成</span></p> 
 <p style="text-align:left;">在上式两边同时乘以sin⁡(kωt)，并对它们在一个周期内进行积分，可得</p> 
 <p style="text-align:left;">化简得</p> 
 <p style="text-align:left;">因此，可得 <span class="kdocs-bold" style="font-weight:bold;">bn</span>，同理也可得 <span class="kdocs-bold" style="font-weight:bold;">an</span></p> 
 <p style="text-align:left;">1.2 欧拉公式与傅里叶级数</p> 
 <p style="text-align:left;">根据 <span class="kdocs-bold" style="font-weight:bold;">欧拉公式</span></p> 
 <p style="text-align:left;">当θ=nωt和θ=-nωt时，</p> 
 <p style="text-align:left;">将这两项代入傅里叶级数</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:511px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:41.87867%;height:0;"> 
    <img src="https://images2.imgbox.com/74/af/vKZD7Yyk_o.png" style="margin-left:;display:block;width:511px;margin-top:-41.87867%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">当n=0时</span>，代入上一小节得到的a0</p> 
 <p style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">当n=1,2,3,...时</span>，代入an，bn</p> 
 <p style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">当n=-1,-2,-3,...时</span>，代入an，bn</p> 
 <p style="text-align:left;">可以看出， <span class="kdocs-bold" style="font-weight:bold;">对于任意的n，所有Cn的表达式都是一样的</span>，傅里叶级数最终可以写为：</p> 
 <p style="text-align:left;">得证。</p> 
 <p style="text-align:left;">2 傅里叶变换 2.1 连续傅里叶变换</p> 
 <p style="text-align:left;">傅立叶级数是针对周期函数的，而 <span class="kdocs-bold" style="font-weight:bold;">傅里叶变换针对非周期函数</span>， <span class="kdocs-bold" style="font-weight:bold;">一个非周期函数可以看做周期无限大的函数</span>。当T趋于无穷大时，频率间隔 ω=2π/T趋于无穷小; Δω=(n+1)ω-nω=ω=2π/T，因此 Δω也趋于0， 1/T=Δω/2π;ΣΔω可以写成积分的形式 ∫dω。我们以 nω为变量，当 ω不等于0时， nω为离散值，，但当 ω趋于无穷小时， <span class="kdocs-bold" style="font-weight:bold;">nω就变成连续的量 </span>，令 nω=W。</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:517px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:42.94004%;height:0;"> 
    <img src="https://images2.imgbox.com/9f/9b/n4lSerzK_o.png" style="margin-left:;display:block;width:517px;margin-top:-42.94004%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="text-align:left;">我们将这个式子中标红的部分称作 <span class="kdocs-bold" style="font-weight:bold;">函数f(t)的傅里叶变换，记作F(w)</span>,即</p> 
 <p style="text-align:left;">而原始函数f(t)可以写为</p> 
 <p style="text-align:left;">我们称之为 <span class="kdocs-bold" style="font-weight:bold;">傅里叶反变换</span>。</p> 
 <p style="text-align:left;">二维连续函数f(x,y)的傅里叶正变换为</p> 
 <p style="text-align:left;">相应的傅里叶逆变换公式为</p> 
 <p style="text-align:left;">2.2 离散傅里叶变换</p> 
 <p style="text-align:left;">实际的信号往往是离散且有限的，在这种受限下要用到 <span class="kdocs-bold" style="font-weight:bold;">离散傅里叶变换</span>（Discrete Fourier Transform简称DFT)。首先，假设采集了N个信号点，其时间为 t 0 , t 1 , ... , t N-1 ，对应的信号值为 f(t 0 ), f(t 1 ), ... , f(t N-1 ) 。信号连续的时候是积分，现在数据离散了用累加，于是</p> 
 <p style="text-align:left;">我们发现，原信号有N个数据点，DFT变换后的信号却变成连续的了，我们将之称为 <span class="kdocs-bold" style="font-weight:bold;">离散时间傅里叶变换</span>（DISCRETE TIME FOURIER TRANSFORM，简称DTFT）。 <span class="kdocs-bold" style="font-weight:bold;">DTFT有两个缺点</span>，第一， ω∈(−∞,+∞)且连续， <span class="kdocs-bold" style="font-weight:bold;">需要进行无数次计算</span>，计算机无法计算；第二，在进行计算的时候，我们 <span class="kdocs-bold" style="font-weight:bold;">需要已知 t 0 , t 1 , ... , t N-1 ， 和 f(t 0 ), f(t 1 ), ... , f(t N-1 ) </span>，但是FFT函数只需要已知 f(t 0 ), f(t 1 ), ... , f(t N-1 ) 就可以进行。</p> 
 <p style="text-align:left;">我们可以采用相对时间n=0,1,...,N-1来代替真实采样时间 t 0 , t 1 , ... , t N-1 ， 可以得到</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:283px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:34.982334%;height:0;"> 
    <img src="https://images2.imgbox.com/66/c9/cV96GJ3l_o.png" style="margin-left:;display:block;width:283px;margin-top:-34.982334%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="text-align:left;">此时我们发现 F(ω)变成了以 2π为周期的函数，即</p> 
 <p style="text-align:left;">我们只需要计算 ω∈(0,2π)区间的 F(ω)，就可以得到 ω∈(−∞,+∞)区间的 F(ω)了。也就是说，通过使用相对采样时间 n=0,1,...N−1代替真实采样时间 t 0 , t 1 , ... , t N-1 ，我们将 F(ω)的范围从 (−∞,+∞)缩小到了 (0,2π)。再将 (0,2π)离散化为N个点，这样计算机就可以计算了，取 ω=2πk/N， k=0,1,...N−1，得 <span class="kdocs-bold" style="font-weight:bold;">离散傅里叶变换</span>DFT</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:284px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:32.74648%;height:0;"> 
    <img src="https://images2.imgbox.com/df/10/5EPdDyGj_o.png" style="margin-left:;display:block;width:284px;margin-top:-32.74648%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">二维离散函数f(x,y)的傅里叶正变换</span>的公式如下：</p> 
 <p style="text-align:left;">其中，u=0,1,2,...,M-1;v=0,1,2,...N-1。</p> 
 <p style="text-align:left;">相应的 <span class="kdocs-bold" style="font-weight:bold;">傅里叶逆变换</span>的公式如下：</p> 
 <p style="text-align:left;">其中，x=0,1,2,...,M-1;y=0,1,2,...N-1。</p> 
 <p style="text-align:left;">一维信号是一个序列，傅里叶变换将其分解成若干个一维的简单函数之和。二维信号可以说是一个图像， <span class="kdocs-bold" style="font-weight:bold;">二维傅里叶变换 将图像分解成若干个复平面波之和</span>。通过上面的公式，我们可以计算出，每个平面波在图像重的成分是多少。从公式也可以看出，二维傅里叶变换就是将图像与每个不同频率的不同方向的复平面波做内积（先再求和），也就是一个求在基上投影的过程。 <span class="kdocs-bold" style="font-weight:bold;">一维的正弦波可以通过三个参数确定，频率ω，幅度A和相位φ。因此在频域中，一维坐标表示频率，每个坐标对应的函数值F(ω)是一个复数，它的模|F(w)|就是幅度A，幅角∠F(w)就是相位。</span>而二维正弦平面波需要四个参数，其中三个和一维一样（ <span class="kdocs-bold" style="font-weight:bold;">频率ω ，幅度A 和相位φ </span>），令一个是 <span class="kdocs-bold" style="font-weight:bold;">方向n</span>。如下图所示，两个平面波仅在方向参数上不同：</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:423px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:73.99527%;height:0;"> 
    <img src="https://images2.imgbox.com/45/bb/1YJHKFTM_o.png" style="margin-left:;display:block;width:423px;margin-top:-73.99527%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="text-align:left;">如何存储频率ω ，幅度A，相位φ和方向n这些参数呢？和一维一样， <span class="kdocs-bold" style="font-weight:bold;">幅度和 相位可以用一个 复数表示，复数的模是幅度，幅角是相位 </span>。向量有方向和长度，可以用来表示方向和频率。一个向量n=（u,v)，向量的模√u2+v2代表这个平面波的频率，方向是平面波的方向，在该点的值F(u,v)表示幅度和相位。包含所有（u,v)点的矩阵是K空间，如下图所示</p> 
 <p style="text-align:left;">上图中，频谱图的中心为原点，即u=0，v=0，中间区域为低频，频率低周期大，条纹间隔宽，从中间向外，频率增大，平面波周期减小，条纹间隔小。图像区域灰度越高表示该频率平面波在图像中成分越多，由于低频表示图像灰度平稳区域，高频表示细节和边缘，所以图像主要是低频，频谱图中间灰度较高。在不同象限的点所代表的平面波方向不同。链接中有很多 <span class="kdocs-bold" style="font-weight:bold;">图像的二维傅里叶变换频谱图</span>，可以验证下自己弄懂了没。</p> 
 <p style="text-align:left;">3 应用</p> 
 <p style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">二维离散傅里叶变换</span>(Two-Dimensional Discrete Fourier Transform)是一种数字变换方法，一般应用于 <span class="kdocs-bold" style="font-weight:bold;">将图像从 空间域转至 频域</span>，在 <span class="kdocs-bold" style="font-weight:bold;">图像增强</span>、 <span class="kdocs-bold" style="font-weight:bold;">图像去噪</span>、 <span class="kdocs-bold" style="font-weight:bold;">图像边缘检测</span>、 <span class="kdocs-bold" style="font-weight:bold;">图像特征提取</span>、 <span class="kdocs-bold" style="font-weight:bold;">图像压缩</span>等等应用中都起着极其重要的作用。</p> 
 <p style="text-align:left;">3.1 频域滤波</p> 
 <p style="text-align:left;">图像实质上是二维矩阵。将空间域（二维灰度数表）的图像转换到频域（频率数表）能够更直观地观察和处理图像，也更有利于进行频域滤波等操作。在博客 <span class="kdocs-bold" style="font-weight:bold;">图像增强</span>中介绍了不少常用的低通滤波器，也在博客 <span class="kdocs-bold" style="font-weight:bold;">傅里叶变换</span>中介绍过OpenCV中傅里叶变换的写法。接下来的这个示例和之前的写法有些不同。</p> 
 <p style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">示例 频域滤波</span></p> 
 <div style=""> 
  <table class="kdocs-table" border="1" cellpadding="1" cellspacing="1" style=""><tbody><tr class="kdocs-tableRow"><td class="kdocs-tableCell" style="width:369px;vertical-align:top;height:52px;"><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">1</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">2</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">3</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">4</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">5</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">6</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">7</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">8</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">9</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">10</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">11</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">12</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">13</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">14</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">15</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">16</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">17</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">18</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">19</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">20</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">21</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">22</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">23</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">24</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">25</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">26</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">27</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">28</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">29</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">30</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">31</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">32</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">33</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">34</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">35</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">36</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">37</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">38</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">39</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">40</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">41</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">42</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">43</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">44</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">45</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">46</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">47</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">48</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">49</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">50</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">51</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">52</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">53</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">54</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">55</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">56</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">57</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">58</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">59</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">60</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">61</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">62</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">63</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">64</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">65</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">66</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">67</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">68</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">69</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">70</span></p></td><td class="kdocs-tableCell" style="width:369px;vertical-align:top;height:52px;"><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">#include &lt;opencv2/opencv.hpp&gt;</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">using namespace cv;</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">using namespace std;</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">int main {<!-- --></span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">clock_t start = clock ;</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">Mat src = imread( "E:/C++projects/CH11/CH11/5.png" , 0);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">imshow( "src" , src);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">// 填充到傅里叶变换最佳尺寸 （gpu下加速明显）</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">int h = getOptimalDFTSize(src.rows);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">int w = getOptimalDFTSize(src.cols);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">Mat padded;</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">copyMakeBorder(src, padded, 0, h - src.rows, 0, w - src.cols, BORDER_CONSTANT, Scalar::all(0));</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">Mat pMat = Mat(padded.size, CV_32FC1);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">// 中心化 （在时域做中心化，傅里叶变换后的频谱图低频在中心）</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">for ( int i = 0; i &lt; padded.rows; i++)</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">{<!-- --></span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">for ( int j = 0; j &lt; padded.cols; j++)</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">{<!-- --></span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">pMat.at&lt; float &gt;(i, j) = pow (-1, i + j) * padded.at&lt;uchar&gt;(i, j);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">}</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">}</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">// 傅里叶变换</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">Mat planes[] = { pMat, Mat::zeros(padded.size, CV_32F) };</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">Mat complexImg;</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">merge(planes, 2, complexImg);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">dft(complexImg, complexImg, DFT_COMPLEX_OUTPUT);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">// 显示频谱图</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">split(complexImg, planes);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">Mat magMat;</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">magnitude(planes[0], planes[1], magMat);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">magMat += 1;</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">log (magMat, magMat);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">normalize(magMat, magMat, 0, 255, NORM_MINMAX);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">magMat.convertTo(magMat, CV_8UC1);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">// 低通滤波</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">//Mat mask(Size(w, h), CV_32FC2, Scalar(0, 0));</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">//circle(mask, Point(w / 2, h / 2), 50, Scalar(255, 255), -1);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">//complexImg = complexImg.mul(mask);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">//高通滤波</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">Mat mask(Size(w, h), CV_32FC2, Scalar(255, 255));</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">circle(mask, Point(w / 2, h / 2), 50, Scalar(0, 0), -1);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">complexImg = complexImg.mul(mask);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">// 傅里叶反变换</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">Mat dst, tmp;</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">idft(complexImg, tmp, DFT_REAL_OUTPUT);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">// 去中心化</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">for ( int i = 0; i &lt; padded.rows; i++)</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">{<!-- --></span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">for ( int j = 0; j &lt; padded.cols; j++)</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">{<!-- --></span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">pMat.at&lt; float &gt;(i, j) = pow (-1, i + j) * tmp.at&lt; float &gt;(i, j);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">}</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">}</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">dst = pMat({ 0,0,src.cols ,src.rows }).clone;</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">normalize(dst, dst, 0, 1, NORM_MINMAX);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">dst.convertTo(dst, CV_8U, 255);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">imshow( "dst" , dst);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">clock_t end = clock ;</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">cout &lt;&lt; "spend time:" &lt;&lt; end - start &lt;&lt; "ms" &lt;&lt; endl;</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">waitKey(0);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">return 0;</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">}</span></p></td></tr></tbody></table> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:643px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:35.147743%;height:0;"> 
    <img src="https://images2.imgbox.com/c3/64/9WRSFxXP_o.png" style="margin-left:;display:block;width:643px;margin-top:-35.147743%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="text-align:left;">不知道有没有人发现，是中心化的方法不一样。之前是在频域做的中心化，这次是在时域做中心化→傅里叶变换→滤波→傅里叶逆变换→去中心化。这是傅里叶变换的平移性质，在第4节会详细讲解下。</p> 
 <p style="text-align:left;">3.2 加速滤波计算</p> 
 <p style="text-align:left;">用大小为m×n元素的核对大小为M×N的图像进行滤波时，需要的运算次数为MNmn（乘法和加法）。如果核是可分离的，那么运算次数可减少为MN(m+n)。在频率域中执行等效滤波所需要的运算次数仅为2MNlog2MN，前面的系数2表示我们要计算一次正FFT和一次反FFT。</p> 
 <p style="text-align:left;">为说明频率域滤波相对于空间滤波的计算优势，我们分别考虑大小为M×M的方形图像与m×m的核。采用不可分离的核所需的运算次数为M 2 m 2 ，采用可分离的核所需的运算次数为2M 2 m，而采用FFT对这种图像滤波所需的运算次数为2M 2 log 2 M 2 ，定义FFT方法的计算优势为</p> 
 <p style="text-align:left;">两种情况下，当C(m)&gt;1时，FFT方法的计算优势更大（根据计算次数）；而当C(m)≤1时，空间滤波的优势更大。下图显示了中等大小图像(M=2048)的Cn(m)与m的曲线关系。对于7×7或更大的核，FFT具有计算优势。这一优势随着m的增大而迅速增大，例如m=101时计算优势超过200，而m=201时计算优势接近1000.下面说明这一优势的含义。如果用FFT对大小为2048×2048的一组图像进行滤波需要1分钟，那么用大小为201×201元素的不可分离核对同一组图像滤波要17小时。这一差异非常明显，因此清楚地表明了使用FFT进行频率域处理的重要性。</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:550px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:52.545456%;height:0;"> 
    <img src="https://images2.imgbox.com/de/a2/qYcqyQbz_o.png" style="margin-left:;display:block;width:550px;margin-top:-52.545456%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="text-align:left;">3.3 倾斜文本校正</p> 
 <p style="text-align:left;">对于分行的文本，其频率谱上一定会有一定的特征，当图像旋转时，其频谱也会同步旋转，因此找出这个特征的倾角，就可以将图像旋转校正回去。这是 <span class="kdocs-bold" style="font-weight:bold;">二维傅里叶变换的旋转性质</span>，傅里叶变换对</p> 
 <p style="text-align:left;">使用极坐标</p> 
 <p style="text-align:left;">可得到如下变换对</p> 
 <p style="text-align:left;">它指出，若f(x,y)旋转 θ 0 角度，则F(u,v)也旋转相同的角度。反之，若F(u,v)旋转某个角度，f(x,y)也旋转相同的角度。</p> 
 <p style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">示例 倾斜文本校正</span></p> 
 <div style=""> 
  <table class="kdocs-table" border="1" cellpadding="1" cellspacing="1" style=""><tbody><tr class="kdocs-tableRow"><td class="kdocs-tableCell" style="width:369px;vertical-align:top;height:52px;"><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">1</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">2</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">3</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">4</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">5</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">6</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">7</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">8</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">9</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">10</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">11</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">12</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">13</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">14</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">15</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">16</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">17</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">18</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">19</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">20</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">21</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">22</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">23</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">24</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">25</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">26</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">27</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">28</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">29</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">30</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">31</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">32</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">33</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">34</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">35</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">36</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">37</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">38</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">39</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">40</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">41</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">42</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">43</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">44</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">45</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">46</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">47</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">48</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">49</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">50</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">51</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">52</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">53</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">54</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">55</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">56</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">57</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">58</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">59</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">60</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">61</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">62</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">63</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">64</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">65</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">66</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">67</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">68</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">69</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">70</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">71</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">72</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">73</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">74</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">75</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">76</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">77</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">78</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">79</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">80</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">81</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">82</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">83</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">84</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">85</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">86</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">87</span></p></td><td class="kdocs-tableCell" style="width:369px;vertical-align:top;height:52px;"><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">#include &lt;opencv2/opencv.hpp&gt;</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">using namespace cv;</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">using namespace std;</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">double point2Line(Point2f pointP, Point2f pointA, Point2f pointB)</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">{<!-- --></span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">//求直线方程</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">double A = 0, B = 0, C = 0;</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">A = pointA.y - pointB.y;</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">B = pointB.x - pointA.x;</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">C = pointA.x * pointB.y - pointA.y * pointB.x;</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">//代入点到直线距离公式</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">double distance = 0;</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">double tmp1 = abs (A * pointP.x + B * pointP.y + C);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">double tmp2 = (( float )sqrtf(A * A + B * B));</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">distance = tmp1 / tmp2;</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">return distance;</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">}</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">int main {<!-- --></span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">vector&lt;string&gt; filenames;</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">glob( "./" , filenames);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">for ( int n = 0; n &lt; filenames.size; n++) {<!-- --></span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">string filename = filenames[n];</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">Mat src = imread(filename, 0);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">// 填充到傅里叶变换的最佳尺寸</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">int h = getOptimalDFTSize(src.rows);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">int w = getOptimalDFTSize(src.cols);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">Mat padded;</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">copyMakeBorder(src, padded, 0, h - src.rows, 0, w - src.cols, BORDER_CONSTANT, Scalar::all(0));</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">// 傅里叶变换</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">Mat planes[] = { Mat_&lt; float &gt;(padded), Mat::zeros(padded.size, CV_32F) };</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">Mat complexImg;</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">merge(planes, 2, complexImg);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">dft(complexImg, complexImg, DFT_COMPLEX_INPUT | DFT_COMPLEX_OUTPUT);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">// 求幅值</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">split(complexImg, planes);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">Mat magMat;</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">magnitude(planes[0], planes[1], magMat);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">magMat += 1;</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">log (magMat, magMat);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">normalize(magMat, magMat, 0, 255, NORM_MINMAX);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">magMat.convertTo(magMat, CV_8UC1);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">// 把零频移到中心</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">Mat magImg = magMat.clone;</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">int cx = magImg.cols / 2;</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">int cy = magImg.rows / 2;</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">Mat q1 = magImg({ 0, 0, cx, cy });</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">Mat q2 = magImg({ 0, cy, cx, cy });</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">Mat q3 = magImg({ cx, 0, cx, cy });</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">Mat q4 = magImg({ cx, cy, cx, cy });</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">Mat temp;</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">q1.copyTo(temp);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">q4.copyTo(q1);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">temp.copyTo(q4);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">q2.copyTo(temp);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">q3.copyTo(q2);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">temp.copyTo(q3);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">// 霍夫直线检测有角度的斜线</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">Mat binImg;</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">threshold(magImg, binImg, 150, 255, THRESH_BINARY);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">Mat markImg;</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">cvtColor(binImg, markImg, COLOR_GRAY2BGR);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">vector&lt;Vec4i&gt; lines;</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">Vec4i l;</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">HoughLinesP(binImg, lines, 1, CV_PI / 180.0, 30, 200, 50);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">Point2f p = Point2f(magImg.cols / 2.0, magImg.rows / 2.0);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">for ( int i = 0; i &lt; lines.size; i++)</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">{<!-- --></span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">if ( abs (lines[i][1] - lines[i][3]) &gt; 15) {<!-- --></span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">line(markImg, Point(lines[i][0], lines[i][1]), Point(lines[i][2], lines[i][3]), Scalar(0, 255, 0), 1, 8, 0);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">l = lines[i];</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">}</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">}</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">float theta = atan ((l[1] - l[3]) * 1.0 / (l[0] - l[2]) * src.cols / src.rows) * 180 / CV_PI;</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">float angle = theta &lt;= 0 ? theta + 90 : theta - 90;</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">// 放射变换</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">Point2f center = Point2f(src.cols / 2.0, src.rows / 2.0);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">Mat rotMat = getRotationMatrix2D(center, angle, 1.0);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">Mat dst = Mat::ones(src.size, CV_8UC1);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">warpAffine(src, dst, rotMat, src.size, 1, 0, Scalar(255, 255, 255));</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">imshow( "src" , src);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">imshow( "markImg" , markImg);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">imshow( "dst" , dst);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">waitKey(0);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">}</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">return 0;</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">}</span></p></td></tr></tbody></table> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:740px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:35.0%;height:0;"> 
    <img src="https://images2.imgbox.com/31/c6/NvB55ZLb_o.png" style="margin-left:;display:block;width:740px;margin-top:-35.0%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="text-align:left;">4 Q&amp;A Q: 为什么要中心化？如何中心化？</p> 
 <p style="text-align:left;">直接对数字图像进行二维DFT变换得到的频谱图是高频在中间，低频在四角。为了把能量（在低频）集中起来便于使用滤波器，可以利用 <span class="kdocs-bold" style="font-weight:bold;">二维DFT的平移性质</span>对频谱进行中心化。频谱图比较亮的地方是低频，图像的能量一般都是集中在低频部分。中心化不是必须的，主要是为了方便理解和滤波。</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:488px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:48.77049%;height:0;"> 
    <img src="https://images2.imgbox.com/ca/fd/odhD0VPG_o.png" style="margin-left:;display:block;width:488px;margin-top:-48.77049%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="text-align:left;">根据 <span class="kdocs-bold" style="font-weight:bold;">二维傅里叶的平移性质</span>，用&lt;=&gt;表示函数和其傅里叶变换的对应性</p> 
 <p style="text-align:left;">第一个公式表明，将f(x,y)与一个指数项相乘就相当于把其变换后的频域中心移动到新的位置。第二个公式表明将F(u,v)与一个指数项相乘就相当于把其变换后的空域中心移到新的位置，同时可以看出对f(x,y)的平移不会影响其傅里叶变换的幅值。将u0=M/2和v0=N/2代入第一个公式，指数部分就变为</p> 
 <p style="text-align:left;">代入上面的公式</p> 
 <p style="text-align:left;">也就是说，对数字图像的每个像素点的取值直接乘以(-1)^(x+y)，x和y是像素坐标。这之后再做傅里叶变换，最后即为中心化后的傅里叶变换。和在频域移动M/2和N/2一样的效果。</p> 
 <p style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">Q: 为什么用图像二维傅里叶变换的相位谱进行反变换，能够大致得到原图的形状，而幅度谱则不行呢？</span></p> 
 <p style="text-align:left;">k空间中储存的是一个复数，其幅度代表平面波的波动的大小，相位代表平面波的相位也就是偏离原点的多少。从k空间回复图像的时候，是将每个复平面乘上对应的复系数，相加而成。可以分为两步：（1）乘上波动大小（幅度）（2）移动相应的距离（相位）</p> 
 <p style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">示例 谱和相角对图像信息的贡献</span></p> 
 <p style="text-align:left;">只用相角重建男孩图像，就是令|F(u,v)|=1，可以看出，图像丢失了灰度信息，但有形状特征。只使用谱重建，这意味着指数项为1，也就是令相角为0，此时结果中值包含灰度信息，没有形状信息。最后两张图显示了相位在确定图像空间特征内容方面的优势。</p> 
 <div style=""> 
  <table class="kdocs-table" border="1" cellpadding="1" cellspacing="1" style=""><tbody><tr class="kdocs-tableRow"><td class="kdocs-tableCell" style="width:369px;vertical-align:top;height:52px;"><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">1</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">2</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">3</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">4</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">5</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">6</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">7</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">8</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">9</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">10</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">11</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">12</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">13</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">14</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">15</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">16</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">17</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">18</span></p></td><td class="kdocs-tableCell" style="width:369px;vertical-align:top;height:52px;"><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">...</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">Mat planes[] = { Mat_&lt; float &gt;(padded), Mat::zeros(padded.size, CV_32F) };</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">Mat complexImg;</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">merge(planes, 2, complexImg);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">dft(complexImg, complexImg, DFT_COMPLEX_OUTPUT);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">split(complexImg, planes);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">Mat magMat;</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">magnitude(planes[0], planes[1], magMat);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">// 相角重建</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">//divide(planes[0], magMat, planes[0]);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">//divide(planes[1], magMat, planes[1]);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">//谱重建</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">planes[0] = magMat;</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">planes[1] = Mat::zeros(padded.size, CV_32F);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">merge(planes, 2, complexImg);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">Mat dst, tmp;</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">idft(complexImg, tmp, DFT_REAL_OUTPUT);</span></p><p style=""><span class="kdocs-fontSize" style="font-size:9pt;">...</span></p></td></tr></tbody></table> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:658px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:75.22797%;height:0;"> 
    <img src="https://images2.imgbox.com/49/50/SqAWlIdq_o.png" style="margin-left:;display:block;width:658px;margin-top:-75.22797%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="text-align:left;">Q: 傅里叶变换为什么要填充0？</p> 
 <p style="text-align:left;">A: (1)提升运算性能；(2)时域补零相当于频域插值，补零操作增加了频域的插值点数，让频域曲线看起来更加光滑，也就是增加了FFT频率分辨率。从傅里叶变换公式可以看出，频域的点数和时域的点数是一样的，时域补零后，采样点增加。详见快速傅里叶变换(FFT)中为什么要“补零”？</p> 
 <p style="text-align:left;">Q: 什么是频率（谱）泄漏？</p> 
 <p style="text-align:left;">频率泄漏是指傅里叶变换后的频谱中出现了本不该有的频率分量。原来的信号的序列我们认为是无限长的，但我们要分析某个信号的频谱的时候只能对它有限长度的序列进行分析，相当于时域上对它进行了加窗，类似于盒式函数乘上f(t)，在频率域中这一相乘意味着原变换与一个sinc函数的卷积，进而导致由sinc函数的高频分量产生所谓的频率泄漏。归根结底，频率泄漏的原因就是加窗导致的序列长度有限。</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:374px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:47.860962%;height:0;"> 
    <img src="https://images2.imgbox.com/4f/b2/F7qjzABX_o.png" style="margin-left:;display:block;width:374px;margin-top:-47.860962%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="text-align:left;">频率泄漏会使得图像块效应。虽然频率泄漏无法完全消除，但让取样后的函数乘以另一个两端平滑地过渡到0的函数，可明显降低频率泄漏。这个想法是为了抑制“盒式函数”的急剧过渡。</p> 
 <p style="text-align:left;">参考</p> 
 <p style="text-align:left;">1. 冈萨雷斯《数字图像处理（第四版）》Chapter4（所有图片可在链接中下载）</p> 
 <p style="text-align:left;">2. 傅里叶变换推导详解</p> 
 <p style="text-align:left;">3. 傅里叶级数与傅里叶变换</p> 
 <p style="text-align:left;">4. 从傅里叶变换进阶到小波变换</p> 
 <p style="text-align:left;">5. 形象理解二维傅里叶变换</p> 
 <p style="text-align:left;">6. 二维傅里叶变换是怎么进行的？</p> 
 <p style="text-align:left;">7. 快速傅里叶变换(FFT)中为什么要“补零”？</p> 
 <p style=""></p> 
 <p style="">转载： <a class="kdocs-link" style="color:#0A6CFF;" href="https://www.sohu.com/a/650204973_121124363" rel="nofollow noopener noreferrer" target="_blank">https://www.sohu.com/a/650204973_121124363</a></p> 
 <h2 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">图像处理:傅里叶变换 </span></h2> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0994d0b5d94cd5a03fe81e6513c9aa2a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Android应用开发（3）App的工程结构</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/25770e0a404aab365a7a8e8fffb18d78/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">多层多输入的CNN-LSTM时间序列回归预测（卷积神经网络-长短期记忆网络）——附代码</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>