<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Docker镜像制作 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Docker镜像制作" />
<meta property="og:description" content="Docker镜像制作 1 Docker中的镜像分层1.1 Docker 镜像为什么分层1.2 可写的容器层1.3 容器层的细节说明 2 制作镜像2.1 镜像的生成途径2.2 基于容器制作2.2.1 使用 commit2.2.1.2 示例一2.2.1.2 示例二 2.2.2 使用 export 和 import2.2.2.1 导出（容器转变为镜像文件）2.2.2.2 导入（镜像文件转变为镜像） 2.2.3 使用 save 和 load2.2.3.1 保存（镜像转变为镜像文件）2.2.3.1.1 演示一（保存单镜像）2.2.3.1.1 演示一（保存多镜像） 2.2.3.2 加载（镜像文件转变为镜像） 2.2.4 两种方案的差别 1 Docker中的镜像分层 Docker 支持通过扩展现有镜像创建新的镜像。DockerHub 中 99% 的镜像都是通过在base镜像的基础上安装和配置需要的软件所构建出来的。
1.1 Docker 镜像为什么分层 镜像分层最大的一个好处就是共享资源。
多个镜像均以同一个 base 镜像为基础构建而来，而Docker Host 只需在磁盘上保存一份 base 镜像，同时内存中也只需加载一份 base 镜像，就可以为所有容器服务了，且镜像的每一层都可以被共享。
如果多个容器共享一份基础镜像，当某个容器修改了基础镜像的内容，比如 /etc 下的文件，这时其他容器的 /etc 是不会被修改的，修改只会被限制在单个容器内，这就是容器 Copy-on-Write 特性。
1.2 可写的容器层 当容器启动时，一个新的可写层被加载到镜像的顶部，这一层通常被称作“容器层”，“容器层”之下的都叫“镜像层”。
所有对容器的改动，无论添加、删除还是修改文件都只会发生在容器层中。只有容器层是可写的，容器层下面的所有镜像层都是只读的。
1.3 容器层的细节说明 镜像层数量可能会很多，所有镜像层会联合在一起组成一个统一的文件系统。如果不同层中有一个相同路径的文件，比如/a，上层的/a会覆盖下层的/a，也就是说用户只能访问到上层中的文件/a。在容器层中，用户看到的是一个叠加之后的文件系统。
只有当需要修改时才复制一份数据，这种特性被称作 Copy-on-Write。可见，容器层保存的是镜像变化的部分，不会对镜像本身进行任何修改。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/891acc757c431e456b4908c713e71b9a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-08-13T19:15:10+08:00" />
<meta property="article:modified_time" content="2022-08-13T19:15:10+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Docker镜像制作</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>Docker镜像制作</h4> 
 <ul><li><a href="#1_Docker_1" rel="nofollow">1 Docker中的镜像分层</a></li><li><ul><li><a href="#11_Docker__4" rel="nofollow">1.1 Docker 镜像为什么分层</a></li><li><a href="#12__8" rel="nofollow">1.2 可写的容器层</a></li><li><a href="#13__12" rel="nofollow">1.3 容器层的细节说明</a></li></ul> 
  </li><li><a href="#2__17" rel="nofollow">2 制作镜像</a></li><li><ul><li><a href="#21__18" rel="nofollow">2.1 镜像的生成途径</a></li><li><a href="#22__21" rel="nofollow">2.2 基于容器制作</a></li><li><ul><li><a href="#221__commit_22" rel="nofollow">2.2.1 使用 commit</a></li><li><ul><li><a href="#2212__35" rel="nofollow">2.2.1.2 示例一</a></li><li><a href="#2212__63" rel="nofollow">2.2.1.2 示例二</a></li></ul> 
    </li><li><a href="#222__export__import_87" rel="nofollow">2.2.2 使用 export 和 import</a></li><li><ul><li><a href="#2221__88" rel="nofollow">2.2.2.1 导出（容器转变为镜像文件）</a></li><li><a href="#2222__113" rel="nofollow">2.2.2.2 导入（镜像文件转变为镜像）</a></li></ul> 
    </li><li><a href="#223__save__load_140" rel="nofollow">2.2.3 使用 save 和 load</a></li><li><ul><li><a href="#2231__141" rel="nofollow">2.2.3.1 保存（镜像转变为镜像文件）</a></li><li><ul><li><a href="#22311__153" rel="nofollow">2.2.3.1.1 演示一（保存单镜像）</a></li><li><a href="#22311__165" rel="nofollow">2.2.3.1.1 演示一（保存多镜像）</a></li></ul> 
     </li><li><a href="#2232__175" rel="nofollow">2.2.3.2 加载（镜像文件转变为镜像）</a></li></ul> 
    </li><li><a href="#224__196" rel="nofollow">2.2.4 两种方案的差别</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="1_Docker_1"></a>1 Docker中的镜像分层</h2> 
<p>Docker 支持<strong>通过扩展现有镜像创建新的镜像</strong>。DockerHub 中 99% 的镜像都是通过在base镜像的基础上安装和配置需要的软件所构建出来的。<br> <img src="https://images2.imgbox.com/55/71/ylMt4bXy_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="11_Docker__4"></a>1.1 Docker 镜像为什么分层</h3> 
<p>镜像分层最大的一个好处就是共享资源。<br> 多个镜像均以同一个 base 镜像为基础构建而来，而<strong>Docker Host 只需</strong>在磁盘上<strong>保存一份 base 镜像</strong>，同时<strong>内存</strong>中也<strong>只需加载一份 base 镜像</strong>，就可以为所有容器服务了，且<strong>镜像</strong>的<strong>每一层都可以被共享</strong>。<br> 如果多个容器共享一份基础镜像，当某个容器修改了基础镜像的内容，比如 /etc 下的文件，这时其他容器的 /etc 是不会被修改的，<strong>修改只会被限制在单个容器内</strong>，这就是容器 <strong>Copy-on-Write</strong> 特性。</p> 
<h3><a id="12__8"></a>1.2 可写的容器层</h3> 
<p>当容器启动时，一个新的可写层被加载到镜像的<strong>顶部</strong>，这一层通常被称作“<strong>容器层</strong>”，“容器层”<strong>之下</strong>的都叫“<strong>镜像层</strong>”。<br> <img src="https://images2.imgbox.com/22/01/5XVDabWy_o.png" alt="在这里插入图片描述"><br> 所有<strong>对容器的改动</strong>，无论添加、删除还是修改文件都<strong>只会发生在容器层</strong>中。<strong>只有容器层</strong>是<strong>可写</strong>的，容器层下面的所有<strong>镜像层</strong>都是<strong>只读</strong>的。</p> 
<h3><a id="13__12"></a>1.3 容器层的细节说明</h3> 
<p>镜像层数量可能会很多，所有<strong>镜像层</strong>会<strong>联合在一起组成一个统一的文件系统</strong>。如果不同层中有一个相同路径的文件，比如<code>/a</code>，<strong>上层</strong>的<code>/a</code>会<strong>覆盖下层</strong>的<code>/a</code>，也就是说用户<strong>只能访问到上层</strong>中的文件<code>/a</code>。在<strong>容器层</strong>中，用户<strong>看到的是一个叠加之后的文件系统</strong>。<br> <img src="https://images2.imgbox.com/bd/66/k0XWDmxm_o.png" alt="在这里插入图片描述"><br> <strong>只有当需要修改时才复制一份数据</strong>，这种<strong>特性</strong>被称作 <strong>Copy-on-Write</strong>。可见，容器层<strong>保存</strong>的是<strong>镜像变化的部分</strong>，<strong>不会对<mark>镜像本身</mark>进行任何修改</strong>。<br> 这样就解释了我们前面提出的问题：容器层记录对镜像的修改，所有镜像层都是只读的，不会被容器修改，所以镜像可以被多个容器共享。</p> 
<h2><a id="2__17"></a>2 制作镜像</h2> 
<h3><a id="21__18"></a>2.1 镜像的生成途径</h3> 
<ul><li>基于容器制作</li><li>dockerfile &amp; docker build（<strong>后面单独讲</strong>）</li></ul> 
<h3><a id="22__21"></a>2.2 基于容器制作</h3> 
<h4><a id="221__commit_22"></a>2.2.1 使用 commit</h4> 
<p>格式</p> 
<pre><code class="prism language-javascript"><span class="token literal-property property">Usage</span><span class="token operator">:</span> docker commit <span class="token punctuation">[</span><span class="token constant">OPTIONS</span><span class="token punctuation">]</span> <span class="token constant">CONTAINER</span> <span class="token punctuation">[</span><span class="token constant">REPOSITORY</span><span class="token punctuation">[</span><span class="token operator">:</span><span class="token constant">TAG</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
</code></pre> 
<p>参数</p> 
<pre><code class="prism language-javascript"><span class="token literal-property property">Options</span><span class="token operator">:</span>
	<span class="token operator">-</span>a 作者（例如，“along along@along<span class="token punctuation">.</span>com”）
	<span class="token operator">-</span>c 修改Dockerfile指令应用于创建的镜像
	<span class="token operator">-</span>m 提交消息（可以理解是注释）
	<span class="token operator">-</span>p 在提交期间暂停容器（默认为<span class="token boolean">true</span>）
</code></pre> 
<h5><a id="2212__35"></a>2.2.1.2 示例一</h5> 
<pre><code class="prism language-javascript"><span class="token punctuation">[</span>root@johnnyg03 <span class="token operator">~</span><span class="token punctuation">]</span># docker run <span class="token operator">-</span>it <span class="token operator">--</span>name b1 busybox<span class="token operator">:</span>latest <span class="token operator">/</span>bin<span class="token operator">/</span>sh
<span class="token operator">/</span> # mkdir <span class="token operator">/</span>data<span class="token operator">/</span>html <span class="token operator">-</span>p
<span class="token operator">/</span> # echo <span class="token string">"hello world"</span> <span class="token operator">&gt;</span> <span class="token operator">/</span>data<span class="token operator">/</span>html<span class="token operator">/</span>index<span class="token punctuation">.</span>html
<span class="token operator">/</span> # cat <span class="token operator">/</span>data<span class="token operator">/</span>html<span class="token operator">/</span>index<span class="token punctuation">.</span>html 
hello world
</code></pre> 
<pre><code class="prism language-javascript"><span class="token punctuation">[</span>root@johnnyg03 <span class="token operator">~</span><span class="token punctuation">]</span># docker commit <span class="token operator">-</span>a <span class="token string">"johnnyg johnnyg@test.com"</span> <span class="token operator">-</span>p b1
<span class="token literal-property property">sha256</span><span class="token operator">:</span>0b187f35d8cbe31aa845c2247dd25ee968b45cc20e76a54390904d45e5884a41
<span class="token punctuation">[</span>root@johnnyg03 <span class="token operator">~</span><span class="token punctuation">]</span># docker images
<span class="token constant">REPOSITORY</span>                        <span class="token constant">TAG</span>       <span class="token constant">IMAGE</span> <span class="token constant">ID</span>       <span class="token constant">CREATED</span>         <span class="token constant">SIZE</span>
<span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>                            <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>    0b187f35d8cb   <span class="token number">4</span> seconds ago   <span class="token number">1</span><span class="token punctuation">.</span>24MB   
</code></pre> 
<pre><code class="prism language-javascript"><span class="token punctuation">[</span>root@johnnyg03 <span class="token operator">~</span><span class="token punctuation">]</span># docker tag 0b187f35d8cb johnnyg<span class="token operator">/</span>busybox<span class="token operator">:</span>latest
<span class="token punctuation">[</span>root@johnnyg03 <span class="token operator">~</span><span class="token punctuation">]</span># docker images
<span class="token constant">REPOSITORY</span>                        <span class="token constant">TAG</span>       <span class="token constant">IMAGE</span> <span class="token constant">ID</span>       <span class="token constant">CREATED</span>          <span class="token constant">SIZE</span>
johnnyg<span class="token operator">/</span>busybox                   v1    0b187f35d8cb   <span class="token number">58</span> seconds ago   <span class="token number">1</span><span class="token punctuation">.</span>24MB
</code></pre> 
<pre><code class="prism language-javascript"><span class="token punctuation">[</span>root@johnnyg03 <span class="token operator">~</span><span class="token punctuation">]</span># docker run <span class="token operator">-</span>it <span class="token operator">--</span>name b2 johnnyg<span class="token operator">/</span>busybox<span class="token operator">:</span>v1 <span class="token operator">/</span>bin<span class="token operator">/</span>sh
<span class="token operator">/</span> # ls
bin   data  dev   etc   home  proc  root  sys   tmp   usr   <span class="token keyword">var</span>
<span class="token operator">/</span> # cat <span class="token operator">/</span>data<span class="token operator">/</span>html<span class="token operator">/</span>index<span class="token punctuation">.</span>html 
hello world
</code></pre> 
<h5><a id="2212__63"></a>2.2.1.2 示例二</h5> 
<pre><code class="prism language-javascript"><span class="token punctuation">[</span>root@johnnyg03 <span class="token operator">~</span><span class="token punctuation">]</span># docker commit <span class="token operator">-</span>a <span class="token string">"johnnyg &lt;johnnyg@test.com&gt;"</span> <span class="token operator">-</span>c <span class="token string">'CMD ["/bin/httpd","-f","-h","/data/html"]'</span> <span class="token operator">-</span>p b1 johnnyg<span class="token operator">/</span>busybox<span class="token operator">:</span>v2
<span class="token punctuation">[</span>root@johnnyg03 <span class="token operator">~</span><span class="token punctuation">]</span># docker images
<span class="token constant">REPOSITORY</span>                        <span class="token constant">TAG</span>       <span class="token constant">IMAGE</span> <span class="token constant">ID</span>       <span class="token constant">CREATED</span>          <span class="token constant">SIZE</span>
johnnyg<span class="token operator">/</span>busybox                   v2        6601a1526ad0   <span class="token number">6</span> seconds ago    <span class="token number">1</span><span class="token punctuation">.</span>24MB
</code></pre> 
<pre><code class="prism language-javascript"><span class="token punctuation">[</span>root@johnnyg03 <span class="token operator">~</span><span class="token punctuation">]</span># docker run <span class="token operator">-</span>d <span class="token operator">--</span>name b3 johnnyg<span class="token operator">/</span>busybox<span class="token operator">:</span>v2 
a0e5fc970f34cbe2097a0a57b90f34ce7616285310cf05c48ff61332ac0bf6ec
</code></pre> 
<pre><code class="prism language-javascript"><span class="token punctuation">[</span>root@johnnyg03 <span class="token operator">~</span><span class="token punctuation">]</span># docker inspect b3 <span class="token operator">|</span> grep <span class="token constant">IPA</span>
            <span class="token string-property property">"SecondaryIPAddresses"</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
            <span class="token string-property property">"IPAddress"</span><span class="token operator">:</span> <span class="token string">"172.17.0.4"</span><span class="token punctuation">,</span>
                    <span class="token string-property property">"IPAMConfig"</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
                    <span class="token string-property property">"IPAddress"</span><span class="token operator">:</span> <span class="token string">"172.17.0.4"</span><span class="token punctuation">,</span>

<span class="token punctuation">[</span>root@johnnyg03 <span class="token operator">~</span><span class="token punctuation">]</span># curl <span class="token number">172.17</span><span class="token number">.0</span><span class="token number">.4</span>
hello world
</code></pre> 
<h4><a id="222__export__import_87"></a>2.2.2 使用 export 和 import</h4> 
<h5><a id="2221__88"></a>2.2.2.1 导出（容器转变为镜像文件）</h5> 
<p>格式</p> 
<pre><code class="prism language-javascript"><span class="token punctuation">[</span>root@johnnyg03 <span class="token operator">~</span><span class="token punctuation">]</span># docker <span class="token keyword">export</span> <span class="token operator">--</span>help

<span class="token literal-property property">Usage</span><span class="token operator">:</span>  docker <span class="token keyword">export</span> <span class="token punctuation">[</span><span class="token constant">OPTIONS</span><span class="token punctuation">]</span> <span class="token constant">CONTAINER</span>
</code></pre> 
<p>参数</p> 
<pre><code class="prism language-javascript"><span class="token literal-property property">Options</span><span class="token operator">:</span>
	<span class="token operator">-</span>o 输出（可以用<span class="token operator">&gt;</span>取代）后面跟路径文件名
</code></pre> 
<p>演示</p> 
<pre><code class="prism language-javascript"><span class="token punctuation">[</span>root@johnnyg03 <span class="token operator">~</span><span class="token punctuation">]</span># docker <span class="token keyword">export</span> b1 <span class="token operator">&gt;</span> docker_image_b1<span class="token punctuation">.</span>tar

or

<span class="token punctuation">[</span>root@johnnyg03 <span class="token operator">~</span><span class="token punctuation">]</span># docker <span class="token keyword">export</span> b1 <span class="token operator">-</span>o docker_image_b1<span class="token punctuation">.</span>tar
</code></pre> 
<pre><code class="prism language-javascript"><span class="token punctuation">[</span>root@johnnyg03 <span class="token operator">~</span><span class="token punctuation">]</span># ll docker_image_b1<span class="token punctuation">.</span>tar 
<span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">--</span>r<span class="token operator">--</span> <span class="token number">1</span> root root <span class="token number">1467392</span> Aug <span class="token number">13</span> <span class="token number">17</span><span class="token operator">:</span><span class="token number">23</span> docker_image_b1<span class="token punctuation">.</span>tar
</code></pre> 
<h5><a id="2222__113"></a>2.2.2.2 导入（镜像文件转变为镜像）</h5> 
<p>格式</p> 
<pre><code class="prism language-javascript"><span class="token punctuation">[</span>root@johnnyg03 <span class="token operator">~</span><span class="token punctuation">]</span># docker <span class="token keyword">import</span> <span class="token operator">--</span>help

<span class="token literal-property property">Usage</span><span class="token operator">:</span>  docker <span class="token keyword">import</span> <span class="token punctuation">[</span><span class="token constant">OPTIONS</span><span class="token punctuation">]</span> file<span class="token operator">|</span><span class="token constant">URL</span><span class="token operator">|</span><span class="token operator">-</span> <span class="token punctuation">[</span><span class="token constant">REPOSITORY</span><span class="token punctuation">[</span><span class="token operator">:</span><span class="token constant">TAG</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
</code></pre> 
<p>参数</p> 
<pre><code class="prism language-javascript"><span class="token literal-property property">Options</span><span class="token operator">:</span>
	<span class="token operator">-</span>c 应用docker 指令创建镜像；
	<span class="token operator">-</span>m 提交时的说明文字（注释）
</code></pre> 
<p>演示</p> 
<pre><code class="prism language-javascript"><span class="token punctuation">[</span>root@johnnyg03 <span class="token operator">~</span><span class="token punctuation">]</span># docker <span class="token keyword">import</span> docker_image_b1<span class="token punctuation">.</span>tar johnnyg<span class="token operator">/</span>busybox<span class="token operator">:</span>v3
<span class="token punctuation">[</span>root@johnnyg03 <span class="token operator">~</span><span class="token punctuation">]</span># docker images
<span class="token constant">REPOSITORY</span>                        <span class="token constant">TAG</span>       <span class="token constant">IMAGE</span> <span class="token constant">ID</span>       <span class="token constant">CREATED</span>             <span class="token constant">SIZE</span>
johnnyg<span class="token operator">/</span>busybox                   v3        c74a65ab0d71   <span class="token number">6</span> seconds ago       <span class="token number">1</span><span class="token punctuation">.</span>24MB
</code></pre> 
<pre><code class="prism language-javascript"><span class="token punctuation">[</span>root@johnnyg03 <span class="token operator">~</span><span class="token punctuation">]</span># docker run <span class="token operator">-</span>it <span class="token operator">--</span>name b4 johnnyg<span class="token operator">/</span>busybox<span class="token operator">:</span>v3 <span class="token operator">/</span>bin<span class="token operator">/</span>sh
<span class="token operator">/</span> # ls
bin   data  dev   etc   home  proc  root  sys   tmp   usr   <span class="token keyword">var</span>
<span class="token operator">/</span> # cat <span class="token operator">/</span>data<span class="token operator">/</span>html<span class="token operator">/</span>index<span class="token punctuation">.</span>html 
hello world
</code></pre> 
<h4><a id="223__save__load_140"></a>2.2.3 使用 save 和 load</h4> 
<h5><a id="2231__141"></a>2.2.3.1 保存（镜像转变为镜像文件）</h5> 
<p>格式</p> 
<pre><code class="prism language-javascript"><span class="token punctuation">[</span>root@johnnyg03 <span class="token operator">~</span><span class="token punctuation">]</span># docker save <span class="token operator">--</span>help

<span class="token literal-property property">Usage</span><span class="token operator">:</span>  docker save <span class="token punctuation">[</span><span class="token constant">OPTIONS</span><span class="token punctuation">]</span> <span class="token constant">IMAGE</span> <span class="token punctuation">[</span><span class="token constant">IMAGE</span><span class="token operator">...</span><span class="token punctuation">]</span>
</code></pre> 
<p>参数</p> 
<pre><code class="prism language-javascript"><span class="token literal-property property">Options</span><span class="token operator">:</span>
	<span class="token operator">-</span>o 输出（可以用<span class="token operator">&gt;</span>取代）后面跟路径文件名
</code></pre> 
<h6><a id="22311__153"></a>2.2.3.1.1 演示一（保存单镜像）</h6> 
<pre><code class="prism language-javascript"><span class="token punctuation">[</span>root@johnnyg03 <span class="token operator">~</span><span class="token punctuation">]</span># docker save johnnyg<span class="token operator">/</span>busybox <span class="token operator">&gt;</span> docker_image_b1_2<span class="token punctuation">.</span>tar

or

<span class="token punctuation">[</span>root@johnnyg03 <span class="token operator">~</span><span class="token punctuation">]</span># docker save johnnyg<span class="token operator">/</span>busybox <span class="token operator">-</span>o docker_image_b1_2<span class="token punctuation">.</span>tar
</code></pre> 
<pre><code class="prism language-javascript"><span class="token punctuation">[</span>root@johnnyg03 <span class="token operator">~</span><span class="token punctuation">]</span># ll docker_image_b1_2<span class="token punctuation">.</span>tar 
<span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">--</span>r<span class="token operator">--</span> <span class="token number">1</span> root root <span class="token number">2956288</span> Aug <span class="token number">13</span> <span class="token number">18</span><span class="token operator">:</span><span class="token number">11</span> docker_image_b1_2<span class="token punctuation">.</span>tar
</code></pre> 
<h6><a id="22311__165"></a>2.2.3.1.1 演示一（保存多镜像）</h6> 
<p><strong><mark>【注：如果需要load（加载），操作是一样的】</mark></strong></p> 
<pre><code class="prism language-javascript"><span class="token punctuation">[</span>root@johnnyg03 <span class="token operator">~</span><span class="token punctuation">]</span># docker save busybox<span class="token operator">:</span>latest nginx<span class="token operator">:</span>latest <span class="token operator">&gt;</span> docker_images_busybox_nginx<span class="token punctuation">.</span>tar
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">+</span>  Done                    docker save busybox<span class="token operator">:</span>latest nginx<span class="token operator">:</span>latest <span class="token operator">&gt;</span> docker_images_busybox
</code></pre> 
<pre><code class="prism language-javascript"><span class="token punctuation">[</span>root@johnnyg03 <span class="token operator">~</span><span class="token punctuation">]</span># ll docker_images_busybox_nginx<span class="token punctuation">.</span>tar 
<span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">--</span>r<span class="token operator">--</span> <span class="token number">1</span> root root <span class="token number">147370496</span> Aug <span class="token number">13</span> <span class="token number">19</span><span class="token operator">:</span><span class="token number">11</span> docker_images_busybox_nginx<span class="token punctuation">.</span>tar
</code></pre> 
<h5><a id="2232__175"></a>2.2.3.2 加载（镜像文件转变为镜像）</h5> 
<p>格式</p> 
<pre><code class="prism language-javascript"><span class="token punctuation">[</span>root@johnnyg03 <span class="token operator">~</span><span class="token punctuation">]</span># docker load <span class="token operator">--</span>help

<span class="token literal-property property">Usage</span><span class="token operator">:</span>  docker load <span class="token punctuation">[</span><span class="token constant">OPTIONS</span><span class="token punctuation">]</span>
</code></pre> 
<p>参数</p> 
<pre><code class="prism language-javascript"><span class="token literal-property property">Options</span><span class="token operator">:</span>
	<span class="token operator">-</span>i 指定导入的文件，代替 <span class="token constant">STDIN</span>（标准输入“<span class="token operator">&lt;</span>”）
	<span class="token operator">-</span>q 精简输出信息
</code></pre> 
<p>演示</p> 
<pre><code class="prism language-javascript"><span class="token punctuation">[</span>root@johnnyg03 <span class="token operator">~</span><span class="token punctuation">]</span># docker load <span class="token operator">&lt;</span> docker_image_b1_2<span class="token punctuation">.</span>tar

or

<span class="token punctuation">[</span>root@johnnyg03 <span class="token operator">~</span><span class="token punctuation">]</span># docker load <span class="token operator">-</span>i docker_image_b1_2<span class="token punctuation">.</span>tar
</code></pre> 
<h4><a id="224__196"></a>2.2.4 两种方案的差别</h4> 
<p>特别注意：两种方法不可混用。<br> 如果使用 import 导入 save 产生的文件，虽然导入不提示错误，但是启动容器时会提示失败，会出现类似"docker: Error response from daemon: Container command not found or does not exist"的错误。</p> 
<ul><li>文件大小不同</li></ul> 
<blockquote> 
 <p>export 导出的镜像文件体积小于 save 保存的镜像</p> 
</blockquote> 
<ul><li>是否可以对镜像重命名</li></ul> 
<blockquote> 
 <p>docker import 可以为镜像指定新名称<br> docker load 不能对载入的镜像重命名</p> 
</blockquote> 
<ul><li>是否可以同时将多个镜像打包到一个文件中</li></ul> 
<blockquote> 
 <p>docker export 不支持<br> docker save 支持</p> 
</blockquote> 
<ul><li>是否包含镜像历史</li></ul> 
<blockquote> 
 <p>export 导出（import 导入）是根据容器拿到的镜像，再导入时会丢失镜像所有的历史记录和元数据信息（即仅保存容器当时的快照状态），所以无法进行回滚操作。<br> save 保存（load 加载）的镜像，没有丢失镜像的历史，可以回滚到之前的层（layer）。</p> 
</blockquote> 
<ul><li>应用场景不同</li></ul> 
<blockquote> 
 <p>docker export 的应用场景：主要用来制作基础镜像，比如我们从一个 ubuntu 镜像启动一个容器，然后安装一些软件和进行一些设置后，使用 docker export 保存为一个基础镜像。然后，把这个镜像分发给其他人使用，比如作为基础的开发环境。<br> docker save 的应用场景：如果我们的应用是使用 docker-compose.yml 编排的多个镜像组合，但我们要部署的客户服务器并不能连外网。这时就可以使用 docker save 将用到的镜像打个包，然后拷贝到客户服务器上使用 docker load 载入。</p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a5b0be8a43cd0875c77e6a72b796311d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Jenkins&#43;Docker 一键自动化部署 SpringBoot 项目</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/bc255c1e297038bfb1b9f2f91cf3d3c6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Web自动化成长之路：selenium中的PO模式</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>