<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Ubuntu 21.04系统安装 &#43; Nvidia RTX3080 Ti 显卡驱动安装&#43;驱动安装后重启黑屏解决&#43;cuda&#43;pytorch深度学习环境搭建 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Ubuntu 21.04系统安装 &#43; Nvidia RTX3080 Ti 显卡驱动安装&#43;驱动安装后重启黑屏解决&#43;cuda&#43;pytorch深度学习环境搭建" />
<meta property="og:description" content="Ubuntu 21.04系统安装 &#43; Nvidia RTX3080 Ti 显卡驱动安装&#43;驱动安装后重启黑屏解决&#43;cuda&#43;pytorch深度学习环境搭建 前言
因为要做论文的实验，实验室新购置了3080TI，配置ubuntu深度学习环境，因为在安装3080TI的显卡驱动上遇到很多次问题，便做一个经验分享
1. Ubuntu 21.04 系统安装 1.1 准备系统盘 在ubuntu 官网下载官方镜像 （21.04 河马系统）
使用 Rufus 制作系统盘
尝试了18.04、20.04系统，能装系统，但和新卡3080TI驱动兼容的不是很好，遂考虑21.04，终于是成功了，可用去做跑实验了
1.2 安装流程 安装系统时选择其他选项，手动地分配各项空间，默认主动分区，不用设为逻辑分区
因为我是双硬盘：1T固态硬盘&#43;4T机械硬盘，空间就比较自由
固态硬盘：
名称分配大小类型备注EFI200MB自动确定如果电脑时单系统，一定要配置；双系统则无需配置。/204800MBExt4系统盘大小， 200GB 为佳。 因此一些系统软件会在这里安装，e.g., CUDA, apt-get install 等。自动确定65536MB交换空间一般和电脑内存一样大，64GB 为佳。/home剩下所有内存Ext4相当与Windows C: 盘了。 一些用户软件会在这里安装，e.g., anaconda 及其环境， pycharm 等机械硬盘：
名称分配大小类型备注/home/data4T（全部机械硬盘）EXT4data也可以起别的名字 安装完毕后，重启并移除U盘。 如进入系统则安装完成。
2. 显卡驱动安装 （RTX 3080 Ti） 2.1 下载驱动程序 下载nvidia驱动程序，RTX 3080 Ti 下载的是 470 版本
将 该 .run file 拷贝到 /home 下， 以方便获取并安装 2.2 Ubuntu 系统环境准备 安装必要的依赖" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/b534076c4f3134cb8d6f5650038df157/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-08-05T20:19:16+08:00" />
<meta property="article:modified_time" content="2021-08-05T20:19:16+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Ubuntu 21.04系统安装 &#43; Nvidia RTX3080 Ti 显卡驱动安装&#43;驱动安装后重启黑屏解决&#43;cuda&#43;pytorch深度学习环境搭建</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="Ubuntu_2104__Nvidia_RTX3080_Ti_cudapytorch_0"></a>Ubuntu 21.04系统安装 + Nvidia RTX3080 Ti 显卡驱动安装+驱动安装后重启黑屏解决+cuda+pytorch深度学习环境搭建</h2> 
<p>前言</p> 
<p>因为要做论文的实验，实验室新购置了3080TI，配置ubuntu深度学习环境，因为在安装3080TI的显卡驱动上遇到很多次问题，便做一个经验分享</p> 
<h3><a id="1_Ubuntu_2104__6"></a>1. Ubuntu 21.04 系统安装</h3> 
<h4><a id="11__8"></a>1.1 准备系统盘</h4> 
<ul><li> <p>在ubuntu 官网下载官方镜像 （21.04 河马系统）</p> </li><li> <p>使用 Rufus 制作系统盘</p> <p>尝试了18.04、20.04系统，能装系统，但和新卡3080TI驱动兼容的不是很好，遂考虑21.04，终于是成功了，可用去做跑实验了</p> </li></ul> 
<h4><a id="12__18"></a>1.2 安装流程</h4> 
<ul><li> <p>安装系统时选择其他选项，手动地分配各项空间，默认主动分区，不用设为逻辑分区</p> <p>因为我是双硬盘：1T固态硬盘+4T机械硬盘，空间就比较自由</p> <p>固态硬盘：</p> 
  <table><thead><tr><th>名称</th><th>分配大小</th><th>类型</th><th>备注</th></tr></thead><tbody><tr><td>EFI</td><td>200MB</td><td>自动确定</td><td>如果电脑时单系统，一定要配置；双系统则无需配置。</td></tr><tr><td>/</td><td>204800MB</td><td>Ext4</td><td>系统盘大小， 200GB 为佳。 因此一些系统软件会在这里安装，e.g., CUDA, apt-get install 等。</td></tr><tr><td>自动确定</td><td>65536MB</td><td>交换空间</td><td>一般和电脑内存一样大，64GB 为佳。</td></tr><tr><td>/home</td><td>剩下所有内存</td><td>Ext4</td><td>相当与Windows C: 盘了。 一些用户软件会在这里安装，e.g., anaconda 及其环境， pycharm 等</td></tr></tbody></table><p>机械硬盘：</p> 
  <table><thead><tr><th>名称</th><th>分配大小</th><th>类型</th><th>备注</th></tr></thead><tbody><tr><td>/home/data</td><td>4T（全部机械硬盘）</td><td>EXT4</td><td>data也可以起别的名字</td></tr></tbody></table></li><li> <p>安装完毕后，重启并移除U盘。 如进入系统则安装完成。</p> </li></ul> 
<h3><a id="2__RTX_3080_Ti_42"></a>2. 显卡驱动安装 （RTX 3080 Ti）</h3> 
<h4><a id="21__44"></a>2.1 下载驱动程序</h4> 
<ul><li> <p>下载nvidia驱动程序，RTX 3080 Ti 下载的是 470 版本</p> </li></ul> 
<p><img src="https://images2.imgbox.com/3e/12/Dnu1GD30_o.png" alt="在这里插入图片描述"></p> 
<ul><li>将 该 .run file 拷贝到 /home 下， 以方便获取并安装</li></ul> 
<h4><a id="22_Ubuntu__55"></a>2.2 Ubuntu 系统环境准备</h4> 
<ul><li> <p>安装必要的依赖</p> <pre><code>sudo apt-get install gcc make
sudo apt-get install lightdm
</code></pre> </li></ul> 
<h4><a id="23_Ubuntu__65"></a>2.3 Ubuntu 图形界面配置</h4> 
<ul><li> <p>禁用 <strong>nouveau</strong></p> <pre><code>sudo gedit /etc/modprobe.d/blacklist.conf 
</code></pre> <p>在文件最后一行加入</p> <pre><code>blacklist nouveau
options nouveau modeset=0
</code></pre> <p>更新内核</p> <pre><code>sudo update-initramfs -u 
</code></pre> <p>重启系统</p> <pre><code>reboot
</code></pre> <p>重启之后， 验证 <strong>nouveau</strong>是否已被禁用</p> <pre><code>lsmod | grep nouveau
</code></pre> <p>无输出则成功禁用</p> </li><li> <p>关闭 <strong>lightdm</strong></p> <pre><code>sudo service lightdm stop
</code></pre> <p>此时进入黑窗界面</p> <pre><code>Ctrl+Alt+F1
</code></pre> <p>登录账户</p> </li><li> <p>进入下一步安装显卡驱动</p> </li></ul> 
<h4><a id="24__116"></a>2.4 安装显卡驱动</h4> 
<ul><li> <p>找到之前在 /home 中保存的 NVIDIA-*.run 文件</p> </li><li> <p>运行</p> <pre><code>sudo bash NVIDIA-*.run
</code></pre> <p>比如我的就是</p> <pre><code>sudo bash NVIDIA-Linux-x86_64-470.57.02.run
</code></pre> </li><li> <p>安装过程：</p> </li><li> <p>如果前面配置都完成了，基本是一路确定，其中 32-bit 库 选择 No， restart X service 选择 Yes 即可</p> </li><li> <p>完成后 验证 ：</p> </li></ul> 
<pre><code>nvidia-smi
</code></pre> 
<p>如过正常输出，则安装完成。</p> 
<ul><li> <p>安装后重启系统，如果进不了图形界面了，进入黑窗只有左上角有个输入光标。</p> <p>按 Ctrl+Alt+F1进入命令界面</p> <h6><a id="_150"></a>这是由于新卡驱动兼容性不够好导致的</h6> <p><em>解决方法：</em></p> <pre><code>sudo rm /etc/X11/xorg.conf
</code></pre> <p>重启即可进入图形界面</p> </li></ul> 
<h4><a id="3cuda_160"></a>3.cuda安装</h4> 
<h5><a id="31cuda_162"></a>3.1下载cuda</h5> 
<p><img src="https://images2.imgbox.com/09/54/aNKglwBt_o.png" alt="在这里插入图片描述"></p> 
<p>因为没有21.04的版本，就近选择20.04版本</p> 
<p>在终端输入以下命令下载cuda</p> 
<pre><code>wget https://developer.download.nvidia.com/compute/cuda/11.4.1/local_installers/cuda_11.4.1_470.57.02_linux.run
</code></pre> 
<h5><a id="32cuda_177"></a>3.2安装cuda</h5> 
<pre><code>sudo sh cuda_11.4.1_470.57.02_linux.run
</code></pre> 
<p>因为安装过了驱动，所以在安装步骤中就把驱动选项取消勾选</p> 
<h5><a id="33_185"></a>3.3配置环境变量</h5> 
<p>终端输入</p> 
<pre><code>sudo gedit ~/.bashrc
</code></pre> 
<p>在文档最后加上</p> 
<pre><code>export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/cuda/lib64
export PATH=$PATH:/usr/local/cuda/bin
export CUDA_HOME=$CUDA_HOME:/usr/local/cuda
</code></pre> 
<p>终端输入source ~/.bashrc更新</p> 
<h5><a id="34_203"></a>3.4验证安装完成</h5> 
<p>在终端输入 nvcc -V</p> 
<p>返回版本结果就成功了，如果终端让你安装什么包就安装上，然后再测试</p> 
<h4><a id="4pytorch_209"></a>4.pytorch安装</h4> 
<h5><a id="41pytorch_210"></a>4.1pytorch下载</h5> 
<blockquote> 
 <p>https://pytorch.org/</p> 
</blockquote> 
<p>选择合适的版本</p> 
<p><img src="https://images2.imgbox.com/7d/ab/14NgsRPX_o.png" alt="在这里插入图片描述"></p> 
<p>进入环境后复制命令输入终端</p> 
<pre><code>pip3 install torch==1.9.0+cu111 torchvision==0.10.0+cu111 torchaudio==0.9.0 -f https://download.pytorch.org/whl/torch_stable.html
</code></pre> 
<h5><a id="42_224"></a>4.2验证安装成功</h5> 
<p>在py文件中写上</p> 
<pre><code>import torch
flag = torch.cuda.is_available()
print(flag)
ngpu= 1
# Decide which device we want to run on
device = torch.device("cuda:0" if (torch.cuda.is_available() and ngpu &gt; 0) else "cpu")
print(device)
print(torch.cuda.get_device_name(0))
print(torch.rand(3,3).cuda()) 
</code></pre> 
<p>运行，能正常返回说明pytorch和cuda都可用<br> <img src="https://images2.imgbox.com/2a/cd/GhUL6RaW_o.png" alt="在这里插入图片描述"></p> 
<p>一起解决这个问题的实验室师兄的帖子：</p> 
<p>https://zhuanlan.zhihu.com/p/396680736</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/19f12420100af813676a6b9c4c13aac9/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">php判断请求是都ajax,PHP判断一个请求是Ajax请求仍是普通请求</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fde73872298201f8b94af5491fd1352d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">剑灵狂欢区服务器位置,9377《剑灵洪门崛起》4月16日部分区合服公告</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>