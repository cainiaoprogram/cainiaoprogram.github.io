<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>simulink和GUI实时通信 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="simulink和GUI实时通信" />
<meta property="og:description" content="simulink与matlab-GUI通信：实时绘制曲线 本文主要采用了监听器的方法来进行simulink和GUI进行通信，采用get_params和set_params进行实时获取数据和修改参数，监听器可以设置一个也可以设置多个。
步骤如下：
1.在simulink中右击，选择ModelProperties.
2.选择callbacks中的startFcn,此时右侧代码区为空白。
3.添加代码
set(0,&#39;ShowHiddenHandles&#39;,&#39;on&#39;); blk=&#39;DNMPC/position1&#39;; event=&#39;PostOutputs&#39;; listener=@hhh; h=add_exec_event_listener(blk,event,listener); 这里的
blk=‘simulink_name/模块_name’
event有很多参数，这里的’PostOutputs‘意思是监听模块的输出。
listener是监听函数
最后add_exec_event_listener生成监听器
具体的用法可以help add_exec_event_listener,结果如下：
4.在matlab-GUI中的****_OpeningFcn写入
guidata(hObject, handles); load_system(&#39;DNMPC&#39;); line_p1 = line(&#39;Parent&#39;,handles.axes1,... &#39;XData&#39;,[],... &#39;YData&#39;,[],... &#39;Color&#39;,&#39;blue&#39;,... &#39;EraseMode&#39;,&#39;xor&#39;,... &#39;Tag&#39;,&#39;line_p1&#39;) line_p2 = line(&#39;Parent&#39;,handles.axes1,... &#39;XData&#39;,[],... &#39;YData&#39;,[],... &#39;Color&#39;,&#39;red&#39;,... &#39;EraseMode&#39;,&#39;xor&#39;,... &#39;Tag&#39;,&#39;line_p2&#39;) line_p1、line_p2是创建了一个绘图对象，画两张图
5.在matlab-GUI中创建监听函数
function hhh(block,eventdata) hf = findall(0,&#39;Tag&#39;,&#39;figure1&#39;); ax = findall(hf,&#39;Tag&#39;,&#39;axes1&#39;); title(ax,&#39;位置图&#39;); thisLineHandle1 = findall(hf,&#39;Tag&#39;,&#39;line_p1&#39;); xdata1 = get(thisLineHandle1,&#39;XData&#39;); ydata1 = get(thisLineHandle1,&#39;YData&#39;); sTime1 = block.CurrentTime; data1 =block.OutputPort(1).Data; if length(xdata1) &lt; 100001 newXData1 = [xdata1 sTime1]; newYData1 = [ydata1 data1]; else newXData1 = [xdata1(2:end) sTime1]; newYData1 = [ydata1(2:end) data1]; end set(thisLineHandle1,." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/a9cd7407c8ab48e10714cc88d42096e6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-04-03T12:05:27+08:00" />
<meta property="article:modified_time" content="2022-04-03T12:05:27+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">simulink和GUI实时通信</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="simulinkmatlabGUI_0"></a>simulink与matlab-GUI通信：实时绘制曲线</h3> 
<p>本文主要采用了监听器的方法来进行simulink和GUI进行通信，采用get_params和set_params进行实时获取数据和修改参数，监听器可以设置一个也可以设置多个。<br> 步骤如下：<br> 1.在simulink中右击，选择ModelProperties.<br> <img src="https://images2.imgbox.com/74/6b/nTRHs5jh_o.png" alt="在这里插入图片描述"><br> 2.选择callbacks中的startFcn,此时右侧代码区为空白。<br> <img src="https://images2.imgbox.com/29/a7/ODFrMzc6_o.png" alt="在这里插入图片描述"><br> 3.添加代码</p> 
<pre><code class="prism language-powershell"><span class="token function">set</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span><span class="token string">'ShowHiddenHandles'</span><span class="token punctuation">,</span><span class="token string">'on'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
blk=<span class="token string">'DNMPC/position1'</span><span class="token punctuation">;</span>
event=<span class="token string">'PostOutputs'</span><span class="token punctuation">;</span>
listener=@hhh<span class="token punctuation">;</span>
h=add_exec_event_listener<span class="token punctuation">(</span>blk<span class="token punctuation">,</span>event<span class="token punctuation">,</span>listener<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这里的<br> blk=‘simulink_name/模块_name’<br> event有很多参数，这里的’PostOutputs‘意思是监听模块的输出。<br> listener是监听函数<br> 最后add_exec_event_listener生成监听器<br> 具体的用法可以help add_exec_event_listener,结果如下：<br> <img src="https://images2.imgbox.com/2f/03/2ee0CECD_o.png" alt="在这里插入图片描述"><br> 4.在matlab-GUI中的****_OpeningFcn写入</p> 
<pre><code class="prism language-powershell">guidata<span class="token punctuation">(</span>hObject<span class="token punctuation">,</span> handles<span class="token punctuation">)</span><span class="token punctuation">;</span>
load_system<span class="token punctuation">(</span><span class="token string">'DNMPC'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
line_p1 = line<span class="token punctuation">(</span><span class="token string">'Parent'</span><span class="token punctuation">,</span>handles<span class="token punctuation">.</span>axes1<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 <span class="token string">'XData'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 <span class="token string">'YData'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 <span class="token string">'Color'</span><span class="token punctuation">,</span><span class="token string">'blue'</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 <span class="token string">'EraseMode'</span><span class="token punctuation">,</span><span class="token string">'xor'</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 <span class="token string">'Tag'</span><span class="token punctuation">,</span><span class="token string">'line_p1'</span><span class="token punctuation">)</span>
 line_p2 = line<span class="token punctuation">(</span><span class="token string">'Parent'</span><span class="token punctuation">,</span>handles<span class="token punctuation">.</span>axes1<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 <span class="token string">'XData'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 <span class="token string">'YData'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 <span class="token string">'Color'</span><span class="token punctuation">,</span><span class="token string">'red'</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 <span class="token string">'EraseMode'</span><span class="token punctuation">,</span><span class="token string">'xor'</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 <span class="token string">'Tag'</span><span class="token punctuation">,</span><span class="token string">'line_p2'</span><span class="token punctuation">)</span>
</code></pre> 
<p>line_p1、line_p2是创建了一个绘图对象，画两张图<br> 5.在matlab-GUI中创建监听函数</p> 
<pre><code class="prism language-powershell"><span class="token keyword">function</span> hhh<span class="token punctuation">(</span>block<span class="token punctuation">,</span>eventdata<span class="token punctuation">)</span>
hf = findall<span class="token punctuation">(</span>0<span class="token punctuation">,</span><span class="token string">'Tag'</span><span class="token punctuation">,</span><span class="token string">'figure1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ax = findall<span class="token punctuation">(</span>hf<span class="token punctuation">,</span><span class="token string">'Tag'</span><span class="token punctuation">,</span><span class="token string">'axes1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
title<span class="token punctuation">(</span>ax<span class="token punctuation">,</span><span class="token string">'位置图'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
thisLineHandle1 = findall<span class="token punctuation">(</span>hf<span class="token punctuation">,</span><span class="token string">'Tag'</span><span class="token punctuation">,</span><span class="token string">'line_p1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xdata1 = get<span class="token punctuation">(</span>thisLineHandle1<span class="token punctuation">,</span><span class="token string">'XData'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ydata1 = get<span class="token punctuation">(</span>thisLineHandle1<span class="token punctuation">,</span><span class="token string">'YData'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sTime1 = block<span class="token punctuation">.</span>CurrentTime<span class="token punctuation">;</span>
data1 =block<span class="token punctuation">.</span>OutputPort<span class="token punctuation">(</span>1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">Data</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> length<span class="token punctuation">(</span>xdata1<span class="token punctuation">)</span> &lt; 100001
newXData1 = <span class="token namespace">[xdata1 sTime1]</span><span class="token punctuation">;</span>
newYData1 = <span class="token namespace">[ydata1 data1]</span><span class="token punctuation">;</span>
<span class="token keyword">else</span>
newXData1 = <span class="token namespace">[xdata1(2:end) sTime1]</span><span class="token punctuation">;</span>
newYData1 = <span class="token namespace">[ydata1(2:end) data1]</span><span class="token punctuation">;</span>
<span class="token keyword">end</span>
<span class="token function">set</span><span class="token punctuation">(</span>thisLineHandle1<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token string">'XData'</span><span class="token punctuation">,</span>newXData1<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token string">'YData'</span><span class="token punctuation">,</span>newYData1<span class="token punctuation">)</span><span class="token punctuation">;</span>


thisLineHandle2 = findall<span class="token punctuation">(</span>hf<span class="token punctuation">,</span><span class="token string">'Tag'</span><span class="token punctuation">,</span><span class="token string">'line_p2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xdata2 = get<span class="token punctuation">(</span>thisLineHandle2<span class="token punctuation">,</span><span class="token string">'XData'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ydata2 = get<span class="token punctuation">(</span>thisLineHandle2<span class="token punctuation">,</span><span class="token string">'YData'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
rto2= get_param<span class="token punctuation">(</span><span class="token string">'DNMPC/position2'</span><span class="token punctuation">,</span><span class="token string">'RuntimeObject'</span><span class="token punctuation">)</span><span class="token operator">%</span>获得simulink中的gain
sTime2 = rto2<span class="token punctuation">.</span>CurrentTime<span class="token punctuation">;</span>
data2 =rto2<span class="token punctuation">.</span>OutputPort<span class="token punctuation">(</span>1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">Data</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> length<span class="token punctuation">(</span>xdata2<span class="token punctuation">)</span> &lt; 100001
newXData2 = <span class="token namespace">[xdata2 sTime2]</span><span class="token punctuation">;</span>
newYData2 = <span class="token namespace">[ydata2 data2]</span><span class="token punctuation">;</span>
<span class="token keyword">else</span>
newXData2 = <span class="token namespace">[xdata2(2:end) sTime2]</span><span class="token punctuation">;</span>
newYData2 = <span class="token namespace">[ydata2(2:end) data2]</span><span class="token punctuation">;</span>
<span class="token keyword">end</span>
<span class="token function">set</span><span class="token punctuation">(</span>thisLineHandle2<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token string">'XData'</span><span class="token punctuation">,</span>newXData2<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token string">'YData'</span><span class="token punctuation">,</span>newYData2<span class="token punctuation">)</span><span class="token punctuation">;</span>


</code></pre> 
<p>这个需要介绍一下，监听器就是每个simulink周期就会调用一次监听函数，在监听函数中获取simulink数据，之后进行画图。<br> 如果需要监听多个数据，有两种方法：<br> （1）.设置多个监听器和多个监听函数<br> （2）.设置一个监听器和一个监听函数，在一个监听函数中获取其他模块的数据：<br> 采用rto2= get_param(‘DNMPC/position2’,‘RuntimeObject’)的方式，我个人推荐这种，上述代码就是这样的思路。同时如果需要更改simulink参数则可以调用set_param这个函数进行修改参数。<br> 画图的方式有很多，不是只有line这个对象可以，这个根据自己需求而定。<br> <img src="https://images2.imgbox.com/51/1f/bD1fLWNO_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3e4eac50876ab8a4b80ba1375bb9231c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">计算机网络面试准备</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c42770bd3b3fea26118b5f5a6608bbd7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">东航建设漏洞管理平台的探索实践</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>