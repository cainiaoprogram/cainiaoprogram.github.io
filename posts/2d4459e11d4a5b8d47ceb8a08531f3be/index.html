<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Zabbix5.0 LTS&#43;PHP7.4.30&#43;Nginx-1.21.6编译安装&#43;mysql rpm安装教程 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Zabbix5.0 LTS&#43;PHP7.4.30&#43;Nginx-1.21.6编译安装&#43;mysql rpm安装教程" />
<meta property="og:description" content="Zabbix5.0 LTS，PHP7.4.30，Nginx-1.21.6编译安装，mysqlrpm安装教程 由于生产环境各种权限要求，没有rpm安装权限以及内网环境限制，本文主要介绍 Zabbix生产环境编译安装方法，方便内网安装部署。并介绍zabbix自定义监控部署步骤。
**注意：**本文配置中部分路径以及ip来自生产环境，部分测试环境，前后可能有矛盾，可忽略。
zabbix简介 概述 ​ Zabbix是一个基于WEB界面的提供分布式系统监视以及网络监视功能的企业级的开源解决方案。zabbix能监视各种网络参数，保证服务器系统的安全运营；并提供柔软的通知机制以让系统管理员快速定位/解决存在的各种问题。
基础架构 ​ 核心组件主要是 Agent 和 Server，其中 Agent 主要负责采集数据并通过主动或者被动的方 式采集数据发送到 Server/Proxy，除此之外，为了扩展监控项，Agent 还支持执行自定义 脚本。Server 主要负责接收 Agent 发送的监控信息，并进行汇总存储，触发告警等。Zabbix Server 将收集的监控数据存储到 Zabbix Database 中。Zabbix Database 支持常用的关系 型数据库，如果 MySQL、PostgreSQL、Oracle 等，默认是 MySQL，并提供 Zabbix Web 页面（PHP 编写）数据查询。
主机规划： IP地址组件10.8.71.29zabbix_agent10.8.71.30zabbix_agent10.8.71.31zabbix_agent10.8.71.32zabbix_agent10.8.71.33zabbix_agent10.8.71.34zabbix_agent10.8.71.35zabbix_agent,mysql10.8.71.36zabbix_server,zabbix_agent,php7.4.30,nginx Mysql安装 注意：mysql以下操作需要root用户或需要sudo权限
下载安装包 mysql下载地址：https://downloads.mysql.com/archives/community/
清理mysql环境 一台服务器只能安装一个版本的MySQL/MariaDB软件，所以需要删除原有的MySQL/MariaDB
# 查看是否自带mysql rpm -qa | grep mariadb 或 rpm -qa|grep -i mysql # 如果安装了MySQL，就先卸载 rpm -e --nodeps mariadb-libs-5.5.56-2.el7.x86_64 安装 #上传并解压tar文件 tar -xvf mysql-5." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/2d4459e11d4a5b8d47ceb8a08531f3be/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-10-12T15:59:20+08:00" />
<meta property="article:modified_time" content="2022-10-12T15:59:20+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Zabbix5.0 LTS&#43;PHP7.4.30&#43;Nginx-1.21.6编译安装&#43;mysql rpm安装教程</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="Zabbix50_LTSPHP7430Nginx1216mysqlrpm_0"></a>Zabbix5.0 LTS，PHP7.4.30，Nginx-1.21.6编译安装，mysqlrpm安装教程</h2> 
<p>由于生产环境各种权限要求，没有rpm安装权限以及内网环境限制，本文主要介绍 Zabbix生产环境编译安装方法，方便内网安装部署。并介绍zabbix自定义监控部署步骤。</p> 
<p>**注意：**本文配置中部分路径以及ip来自生产环境，部分测试环境，前后可能有矛盾，可忽略。</p> 
<h3><a id="zabbix_6"></a>zabbix简介</h3> 
<h4><a id="_8"></a>概述</h4> 
<p>​ Zabbix是一个基于WEB界面的提供分布式系统监视以及网络监视功能的企业级的开源解决方案。zabbix能监视各种网络参数，保证服务器系统的安全运营；并提供柔软的通知机制以让系统管理员快速定位/解决存在的各种问题。</p> 
<h4><a id="_12"></a>基础架构</h4> 
<p><img src="https://images2.imgbox.com/03/a2/aPCkyWdH_o.png" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-NO5rdgGT-1665560035881)(D:\阳光笔记\zabbix\zabbix生产环境安装.assets\1665556169519.png)]"></p> 
<p>​ 核心组件主要是 Agent 和 Server，其中 Agent 主要负责采集数据并通过主动或者被动的方 式采集数据发送到 Server/Proxy，除此之外，为了扩展监控项，Agent 还支持执行自定义 脚本。Server 主要负责接收 Agent 发送的监控信息，并进行汇总存储，触发告警等。Zabbix Server 将收集的监控数据存储到 Zabbix Database 中。Zabbix Database 支持常用的关系 型数据库，如果 MySQL、PostgreSQL、Oracle 等，默认是 MySQL，并提供 Zabbix Web 页面（PHP 编写）数据查询。</p> 
<h3><a id="_18"></a>主机规划：</h3> 
<table><thead><tr><th>IP地址</th><th>组件</th></tr></thead><tbody><tr><td>10.8.71.29</td><td>zabbix_agent</td></tr><tr><td>10.8.71.30</td><td>zabbix_agent</td></tr><tr><td>10.8.71.31</td><td>zabbix_agent</td></tr><tr><td>10.8.71.32</td><td>zabbix_agent</td></tr><tr><td>10.8.71.33</td><td>zabbix_agent</td></tr><tr><td>10.8.71.34</td><td>zabbix_agent</td></tr><tr><td>10.8.71.35</td><td>zabbix_agent,mysql</td></tr><tr><td>10.8.71.36</td><td>zabbix_server,zabbix_agent,php7.4.30,nginx</td></tr></tbody></table> 
<h3><a id="Mysql_31"></a>Mysql安装</h3> 
<p><strong>注意：mysql以下操作需要root用户或需要sudo权限</strong></p> 
<h4><a id="_35"></a>下载安装包</h4> 
<p>mysql下载地址：https://downloads.mysql.com/archives/community/</p> 
<p><img src="https://images2.imgbox.com/e3/a7/tLVcqzuz_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="mysql_42"></a>清理mysql环境</h4> 
<p>一台服务器只能安装一个版本的MySQL/MariaDB软件，所以需要删除原有的MySQL/MariaDB</p> 
<pre><code class="prism language-sh"># 查看是否自带mysql
rpm -qa | grep mariadb  或  rpm -qa|grep -i mysql

# 如果安装了MySQL，就先卸载
rpm -e --nodeps mariadb-libs-5.5.56-2.el7.x86_64
</code></pre> 
<h4><a id="_54"></a>安装</h4> 
<pre><code class="prism language-sh">#上传并解压tar文件
tar -xvf mysql-5.7.38-1.el7.x86_64.rpm-bundle.tar -C ./

#按顺序安装以下rpm包
rpm -ivh mysql-community-common-5.7.38-1.el7.x86_64.rpm
rpm -ivh mysql-community-libs-5.7.38-1.el7.x86_64.rpm
rpm -ivh mysql-community-libs-compat-5.7.38-1.el7.x86_64.rpm
rpm -ivh mysql-community-client-5.7.38-1.el7.x86_64.rpm
rpm -ivh mysql-community-server-5.7.38-1.el7.x86_64.rpm

#使用RPM软件包标准安装的MySQL的目录结构
文件                               位置
客户端和脚本                        /usr/bin
mysqld服务器                       /usr/sbin
配置文件                            /etc/my.cnf
数据目录                            /var/lib/mysql
错误日志                            /var/log/mysqld.log
System V初始化脚本                   /etc/init.d/mysqld
PID文件                             /run/mysqld/mysqld.pid
socket文件                          /var/lib/mysql/mysql.sock
客户端和脚本                         /usr/bin
</code></pre> 
<h4><a id="mysql_80"></a>mysql初始化</h4> 
<p><code>MySQL 5.7</code>之后的版本，在初次启动MySQL时会生成临时的密码。超级用户<code>'root'@'localhost'</code>临时密码存储在错误日志文件中，可以通过查看<code>/var/log/mysqld.log</code>来获取。</p> 
<pre><code class="prism language-sh">#启动mysql
$ systemctl start mysqld
#查看mysql初始密码
$ grep password /var/log/mysqld.log
2022-10-09T09:09:21.622156Z 1 [Note] A temporary password is generated for root@localhost: !9ctet_VfEo?
#初次登录mysql密码为初始密码 !9ctet_VfEo?
$ mysql -uroot -p
#更改mysql密码 为方便后续登录，mysql登录密码改为 000000
mysql&gt; set global validate_password_policy=LOW;
mysql&gt; set global validate_password_length=6;
mysql&gt; SET PASSWORD=PASSWORD('000000');
</code></pre> 
<h4><a id="mysqlzabbix_98"></a>mysql关联zabbix相关配置</h4> 
<pre><code class="prism language-sh"># 创建zabbix数据库并指定字符集及排序规则， zabbix 5.0 要求zabbix数据库字符集为 utf8_bin 或 utf8mb3_bin
mysql&gt; create database zabbix character set utf8 collate utf8_bin;
# 创建zabbix用户并赋予权限,如果安装的数据库与zabbix，PHP不在同一台服务器，要设置为 zabbix@'192.168.10.%'，若在，zabbix@'localhost' 即可
mysql&gt; create user zabbix@'10.8.71.%' identified by '000000';
mysql&gt; grant all privileges on zabbix.* to 'zabbix'@'10.8.71.%';
mysql&gt; flush privileges;
mysql&gt; quit;

#以zabbix用户登录mysql
$ mysql -uzabbix -h10.8.71.35 -p
Enter password: 000000
#导入zabbix数据库，以下文件在zabbix安装包解压后database路径下
mysql&gt; use zabbix;
# 按顺序导入数据
mysql&gt; source /bigdata/package/zabbix-5.0.27/database/mysql/schema.sql
mysql&gt; source /bigdata/package/zabbix-5.0.27/database/mysql/images.sql
mysql&gt; source /bigdata/package/zabbix-5.0.27/database/mysql/data.sql
mysql&gt; quit;
</code></pre> 
<h3><a id="Nginx_121"></a>Nginx安装</h3> 
<h4><a id="_123"></a>依赖安装</h4> 
<pre><code class="prism language-sh">#方案一：内网环境，需要sudo权限
$ yum reinstall --downloadonly --downloaddir=/home/hadoop zlib zlib-devel pcre pcre-devel gcc
$ yum reinstall --downloadonly --downloaddir=/home/hadoop openssl openssl-devel
$ sudo rpm -Uvh --force --nodeps *rpm
#方案二：外网环境，需要sudo权限
1.通过yum
$ yum install -y zlib zlib-devel
$ yum install pcre  pcre-devel -y
$ yum install -y gcc
</code></pre> 
<h4><a id="_137"></a>下载安装</h4> 
<pre><code class="prism language-sh">#下载
$ wget https://nginx.org/download/nginx-1.21.6.tar.gz
$ tar -zxvf nginx-1.21.6.tar.gz
$ cd nginx-1.21.6/
#编译安装
$ ./configure --prefix=/app/zxr/install/nginx
$ make &amp;&amp; make install
</code></pre> 
<p><img src="https://images2.imgbox.com/70/e4/EXAKPV3X_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/1b/91/pclYrJiN_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_153"></a>设置环境变量</h4> 
<pre><code class="prism language-sh">$ vim .bashrc
$ export PATH=/app/zxr/install/nginx/sbin:$PATH
$ source .bashrc
</code></pre> 
<h4><a id="nginx_161"></a>更改nginx端口</h4> 
<pre><code class="prism language-sh">#nginx 默认端口号为80，端口号为1-1024 的需要root权限启动
$ vim /app/zxr/install/nginx/conf/nginx.conf
  listen 8000
</code></pre> 
<p><strong>检测nginx配置文件是否正确：nginx -t</strong></p> 
<p><img src="https://images2.imgbox.com/4c/c3/VvDtJ3Z8_o.png" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-fvj9DNQf-1665560035884)(D:\阳光笔记\zabbix\zabbix生产环境安装.assets\1665467232196.png)]"></p> 
<h4><a id="nginx_174"></a>nginx启停命令</h4> 
<pre><code class="prism language-sh">./nginx 启动
./nginx -s stop 快速停止
./nginx -s quit 优雅关闭，在退出前完成已经接受的连接请求
./nginx -s reload 重新加载配置
</code></pre> 
<h4><a id="nginx_183"></a>启动nginx并检测</h4> 
<pre><code class="prism language-sh">$ nginx
#检查nginx进程
$ ps -ef |grep nginx
#检查nginx端口
$ netstat -tunlp | grep nginx
</code></pre> 
<p><img src="https://images2.imgbox.com/71/0f/P9kZuj0a_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-sh">#查看自己ip地址（要记得关闭防火墙哦）去浏览器上输入ip地址，确认安装已经成功。
http://192.168.10.103:8080/  IP+Listen端口号
</code></pre> 
<p><img src="https://images2.imgbox.com/92/4d/MWvZQuXV_o.png" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-x2xlz441-1665560035886)(D:\阳光笔记\zabbix\zabbix生产环境安装.assets\1665467593601.png)]"></p> 
<h3><a id="PHP74_203"></a>PHP74安装</h3> 
<p>Zabbix Web界面使用PHP语言编写,所以Zabbix Web界面必须在支持PHP环境的web服务器上运行.</p> 
<p>PHP-7.4.30下载地址：https://www.php.net/downloads.php</p> 
<h4><a id="_209"></a>依赖安装</h4> 
<pre><code class="prism language-sh"># 依赖安装需要sudo权限
#方案1：内网环境
	1.1.下载所有依赖：（当前环境已安装的也会下载)
$ repotrack libxml2 libxml2-devel openssl openssl-devel bzip2 bzip2-devel libcurl libcurl-devel  libjpeg libjpeg-devel libpng libpng-devel freetype freetype-devel gmp gmp-devel libmcrypt libmcrypt-devel readline readline-devel libxslt libxslt-devel zlib zlib-devel glibc glibc-devel glib2 glib2-devel ncurses curl gdbm-devel db4-devel libXpm-devel libX11-devel gd-devel gmp-devel expat-devel xmlrpc-c xmlrpc-c-devel libicu-devel libmcrypt-devel libmemcached-devel libzip libsqlite3x-devel oniguruma  oniguruma-devel openldap openldap-devel
	1.2.安装rpm
$ sudo rpm -Uvh --force --nodeps *rpm
#方案2：外网环境
$ yum install libxml2 libxml2-devel openssl openssl-devel bzip2 bzip2-devel libcurl libcurl-devel  libjpeg libjpeg-devel libpng libpng-devel freetype freetype-devel gmp gmp-devel libmcrypt libmcrypt-devel readline readline-devel libxslt libxslt-devel zlib zlib-devel glibc glibc-devel glib2 glib2-devel ncurses curl gdbm-devel db4-devel libXpm-devel libX11-devel gd-devel gmp-devel expat-devel xmlrpc-c xmlrpc-c-devel libicu-devel libmcrypt-devel libmemcached-devel libzip libsqlite3x-devel oniguruma  oniguruma-devel openldap openldap-devel -y

3.安装libzip
    #因yum安装的libzip 版本不支持，所以需要先卸载已有，再编译安装
3.1.先卸载已有libzip
$ yum remove libzip
3.2.安装
#下载libzip（版本要求：libzip &gt;= 0.11 libzip != 1.3.1 libzip != 1.7.0）
$ wget https://libzip.org/download/libzip-1.2.0.tar.gz
$ tar -zxvf libzip-1.2.0.tar.gz
$ cd libzip-1.2.0
$ ./configure --prefix=/bigdata/libzip
$ make &amp;&amp; make install
#装完了之后找一下/bigdata/libzip/lib下有没有 pkgconfig 目录，有的话执行命令 
$ export PKG_CONFIG_PATH="/bigdata/libzip/lib/pkgconfig/"
</code></pre> 
<h4><a id="PHP_236"></a>PHP编译</h4> 
<pre><code class="prism language-sh">$ tar -zxvf php-7.4.30.tar.gz
$ cd cd php-7.4.30/
$ ./configure --prefix=/bigdata/php74 --with-config-file-path=/bigdata/php74/etc --with-fpm-user=www --with-fpm-group=www --enable-fpm --with-bz2 --enable-gd --with-mysqli=mysqlnd --with-jpeg --with-freetype --with-zlib-dir --with-iconv-dir=/bigdata/php74 --enable-soap --enable-ftp --enable-mbstring --enable-exif --disable-ipv6 --with-curl --enable-bcmath --enable-sockets --enable-calendar --with-gettext --with-pdo-mysql=mysqlnd --disable-fileinfo --with-ldap --with-openssl --with-pear --with-xmlrpc --with-libdir=lib64 --with-xsl --with-zlib --with-mhash  --enable-inline-optimization --enable-mbregex --enable-opcache --enable-pcntl --enable-shmop --enable-sysvsem --enable-sysvshm --enable-xml --with-zip
#部分参数详解
--prefix:软件安装位置
--with-config-file-path：php.ini 配置文件位置
--enable-fpm：nginx操作php
	nginx与php结合有2种方式：
		1.socket nginx与php需要在同一台机器上
		2.网络方式：可以不在一台机器上（默认）
</code></pre> 
<p><strong>表示编译成功：</strong></p> 
<p><img src="https://images2.imgbox.com/6d/37/Vw3nX2ev_o.png" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-eQSRy31Z-1665560035887)(D:\阳光笔记\zabbix\zabbix生产环境安装.assets\1663816977782.png)]"></p> 
<h4><a id="PHP_256"></a>PHP安装</h4> 
<pre><code class="prism language-sh">执行：make &amp;&amp; make install
没有报错信息，命令行 echo $? 输出 0 ，表示安装成功

# 配置文件准备
$ cp /bigdata/package/php-7.4.30/php.ini-production /bigdata/php74/etc/php.ini
$ cd /bigdata/php74/etc
$ cp php-fpm.conf.default php-fpm.conf
$ cd php-fpm.d/
$ cp www.conf.default www.conf
</code></pre> 
<p><strong>表示安装成功：</strong></p> 
<p><img src="https://images2.imgbox.com/25/b7/Oz4cUVbU_o.png" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-sB5N3XSW-1665560035887)(D:\阳光笔记\zabbix\zabbix生产环境安装.assets\1663817867179.png)]"></p> 
<h4><a id="_275"></a>环境变量设置</h4> 
<pre><code class="prism language-sh">$ vim .bashrc
export PATH=/bigdata/php74/bin:/bigdata/php74/sbin:$PATH
$ source .bashrc
#查看配置是否报错
$ php-fpm -t
#查看版本信息
$ php-fpm -v
</code></pre> 
<p><img src="https://images2.imgbox.com/e0/dc/y0jallAu_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_290"></a>启动</h4> 
<pre><code class="prism language-sh">#更改php.ini配置文件,以下配置为zabbix页面要求
$ vim /bigdata/php74/etc/php.ini
max_execution_time = 300
max_input_time = 300
post_max_size = 16M
date.timezone = Asia/Shanghai

#启动php
$ php-fpm
# php进程检查
ps -ef | grep php
# php端口检查
netstat -tulnp | grep php-fpm

若如下图所示，启动成功！！！
</code></pre> 
<p><img src="https://images2.imgbox.com/af/2c/Qz8dGggA_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="Zabbix50__313"></a>Zabbix5.0 编译安装配置</h3> 
<p>**下载地址：**https://www.zabbix.com/cn/download_sources#50LTS</p> 
<h4><a id="server_317"></a>server端</h4> 
<h5><a id="_319"></a>依赖安装</h5> 
<pre><code class="prism language-sh">#mysql-devel 依赖 mariadb-libs，zabbix server不能和mysql在一台机器上
$ sudo yum reinstall --downloadonly --downloaddir=/home/hadoop/rpm mysql-devel libevent-devel curl-devel libcurl net-snmp-devel OpenIPMI-devel libxml2 libxml2-devel libssh2-devel
$ sudo rpm -Uvh --force --nodeps *rpm
</code></pre> 
<h5><a id="_327"></a>编译安装</h5> 
<pre><code class="prism language-sh">#编译
./configure --prefix=/bigdata/zabbix --enable-server --enable-agent --with-mysql --enable-ipv6 --with-net-snmp --with-libcurl --with-libxml2 --with-ssh2
</code></pre> 
<p><img src="https://images2.imgbox.com/bf/38/SI5BizqU_o.png" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-ei4ceO0o-1665560035890)(D:\阳光笔记\zabbix\zabbix生产环境安装.assets\1663834193899.png)]"></p> 
<pre><code class="prism language-sh">#安装
make install
#创建日志存储目录
cd /bigdata/zabbix
mkdir logs
</code></pre> 
<h5><a id="_345"></a>添加环境变量</h5> 
<pre><code class="prism language-sh">vim .bashrc
export PATH=/bigdata/zabbix/sbin:$PATH
source .bashrc
</code></pre> 
<h5><a id="_353"></a>配置文件修改</h5> 
<pre><code class="prism language-sh"># zabbix_server 配置文件
vim /bigdata/zabbix/etc/zabbix_server.conf
LogFile=/bigdata/zabbix/logs/zabbix_server.log
PidFile=/bigdata/zabbix/logs/zabbix_server.pid
DBHost=10.7.130.103
DBName=zabbix
DBUser=zabbix
DBPassword=zabbix123$
DBPort=3306
Timeout=30
LogSlowQueries=3000
StatsAllowedIP=127.0.0.1
</code></pre> 
<pre><code class="prism language-sh"># zabbix_agentd 配置文件
vim /bigdata/zabbix/etc/zabbix_agentd.conf
LogFile=/bigdata/zabbix/logs/zabbix_agentd.log
PidFile=/bigdata/zabbix/logs/zabbix_agentd.pid
Include=/bigdata/zabbix/etc/zabbix_agentd.conf.d/*.conf
AllowKey=system.run[*]
LogRemoteCommands=1
Server=10.7.130.104
ServerActive=10.7.130.104
Hostname=bdicus130-104
AllowRoot=1
StartAgents=10
BufferSend=10
BufferSize=150
MaxLinesPerSecond=100
Timeout=30
</code></pre> 
<h5><a id="_389"></a>启动</h5> 
<pre><code class="prism language-sh"># 启动 agent
zabbix_agentd
# 启动server
zabbix_server
</code></pre> 
<h4><a id="agent_398"></a>agent端</h4> 
<p>zabbix 集群其他节点只需编译安装 agent 即可，无需依赖</p> 
<pre><code class="prism language-sh">./configure --prefix=/bigdata/zabbix --enable-agent 
</code></pre> 
<p><img src="https://images2.imgbox.com/87/a0/ngQjRY2V_o.png" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-Zvf3UDsb-1665560035891)(D:\阳光笔记\zabbix\zabbix生产环境安装.assets\1663923306367.png)]"></p> 
<pre><code class="prism language-sh">make install
-- 如下图无报错即安装成功
</code></pre> 
<p><img src="https://images2.imgbox.com/0f/a1/B4cQUBC9_o.png" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-hdpiZXmX-1665560035891)(D:\阳光笔记\zabbix\zabbix生产环境安装.assets\1663923404309.png)]"></p> 
<pre><code class="prism language-sh"># 修改 zabbix_agentd 配置文件
mkdir /bigdata/zabbix/logs
vim /bigdata/zabbix/etc/zabbix_agentd.conf
LogFile=/bigdata/zabbix/logs/zabbix_agentd.log
PidFile=/bigdata/zabbix/logs/zabbix_agentd.pid
Include=/bigdata/zabbix/etc/zabbix_agentd.conf.d/*.conf  		 # 监控项的key存放路径
AllowKey=system.run[*]
LogRemoteCommands=1
Server=10.7.130.104
ServerActive=10.7.130.104
Hostname=bdicus130-104
AllowRoot=1
StartAgents=10
BufferSend=10
BufferSize=150
MaxLinesPerSecond=100
Timeout=30

#配置环境变量
vim .bashrc
# zabbix
export PATH=/bigdata/zabbix/sbin:$PATH
source .bashrc

#启动
zabbix_agentd
</code></pre> 
<p><strong>验证</strong></p> 
<pre><code class="prism language-sh"># 进程验证
ps -ef | grep zabbix
# 端口验证 agent 默认 10050 端口
netstat -tunlp | grep zabbix
</code></pre> 
<p><img src="https://images2.imgbox.com/6e/69/CewRBZrG_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="web_458"></a>web配置</h4> 
<h5><a id="zabbix_460"></a>zabbix前端文件配置</h5> 
<pre><code class="prism language-sh">#复制 zabbix5.0 安装包下的 ui 文件夹到 nginx 的 html 目录下
$ cp -r /bigdata/package/zabbix-5.0.27/ui/* /bigdata/nginx/nginx-1.12.1/html/zabbix
$ cd /bigdata/nginx/nginx-1.12.1/html/zabbix
$ cp ./conf/zabbix.conf.php.example ./conf/zabbix.conf.php
$ chmod 777 ./conf/zabbix.conf.php  
$ vim ./conf/zabbix.conf.php
#修改如下图
</code></pre> 
<p><img src="https://images2.imgbox.com/95/5c/xcdSjtGI_o.png" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-rRCbmEu6-1665560035893)(D:\阳光笔记\zabbix\zabbix生产环境安装.assets\1665475583083.png)]"></p> 
<h5><a id="zabbix_475"></a>适应zabbix配置</h5> 
<pre><code class="prism language-sh">$ vim /app/zxr/install/nginx/conf/nginx.conf
#修改配置
添加：index.php
listen       8000;
        server_name  localhost;
        root /home/hadoop/install/nginx/html/zxbbix;
     location / {
            root   html;
            index index.html index.htm index.php;
        }

 --打开注释：
 location ~ \.php$ {
            root           html;
            fastcgi_pass   127.0.0.1:9000;
            fastcgi_index  index.php;
            fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
            include        fastcgi_params;
        }

# 重启nginx
$ nginx -s reload
</code></pre> 
<h5><a id="zabbix_web_502"></a>zabbix web页面初始化配置</h5> 
<pre><code class="prism language-sh">#登录web页面：默认账户密码为 Admin/zabbix
192.168.10.101:8000/zabbix/setup.php
</code></pre> 
<p>默认账户密码为 Admin/zabbix：</p> 
<p><img src="https://images2.imgbox.com/52/2a/McXfOkaM_o.png" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-1nrM062h-1665560035894)(D:\阳光笔记\zabbix\zabbix生产环境安装.assets\1665479507325.png)]"></p> 
<p>在检测时，可查看具体的报错信息进行解决:</p> 
<p><img src="https://images2.imgbox.com/4f/d3/2Svq7VWq_o.png" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-pV4kLFPE-1665560035894)(D:\阳光笔记\zabbix\zabbix生产环境安装.assets\1665479590747.png)]"></p> 
<p>选择mysql数据库，根据之前设置的参数进行填写：</p> 
<p><img src="https://images2.imgbox.com/8e/f7/r0sB8XZ1_o.png" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-yvCB6siv-1665560035895)(D:\阳光笔记\zabbix\zabbix生产环境安装.assets\1665479600673.png)]"></p> 
<p>若报错，MySQL server has gone away ：解除 Database TLS encryption 勾选</p> 
<p><img src="https://images2.imgbox.com/43/1c/HELmGrNz_o.png" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-dgnrEx4W-1665560035895)(D:\阳光笔记\zabbix\zabbix生产环境安装.assets\1665479681359.png)]"></p> 
<p>IP地址为zabbix-server所在地址：</p> 
<p><img src="https://images2.imgbox.com/ee/67/4d1LJtb8_o.png" alt="在这里插入图片描述"></p> 
<p>下一步：</p> 
<p><img src="https://images2.imgbox.com/ee/18/m0hpZkkt_o.png" alt="在这里插入图片描述"></p> 
<p>安装完成：<img src="https://images2.imgbox.com/80/ab/qG6lJeB4_o.png" alt="在这里插入图片描述"><br> 更改语言为中文：<br> <img src="https://images2.imgbox.com/33/53/GP9d8I6P_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="zabbix_544"></a>zabbix自定义监控</h3> 
<h4><a id="agent_546"></a>配置agent配置文件</h4> 
<pre><code class="prism language-sh"># 在zabbix安装目录 /bigdata/zabbix/etc/zabbix_agentd.conf.d 下创建 *.conf 文件
# 文件内格式如下图所示，1部分为固定；2部分为键值，名称任意；3部分为监控进程的脚本，脚本需自己编写

# 参数示意：UserParameter=key[*],&lt;shell_command&gt; $1 $2 $...
key：表示监控项的key值，
[*]：表示接受参数
shell_command：表示脚本所在的路径或者shell命令
$1, $2, $n：表示参数，参数个数与n相同
</code></pre> 
<p><img src="https://images2.imgbox.com/89/ac/KB7mTLmJ_o.png" alt="在这里插入图片描述"></p> 
<p>监控mongo脚本部分示意：</p> 
<p><img src="https://images2.imgbox.com/cf/eb/KVRYa7o1_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-sh"># 修改agent配置文件后需要重启agent
</code></pre> 
<h4><a id="_571"></a>创建主机群组</h4> 
<pre><code class="prism language-sh"># 创建主机群组，便于管理zabbix集群
配置 --&gt; 主机群组 --&gt; 创建主机群组
</code></pre> 
<p><img src="https://images2.imgbox.com/c4/bf/XcWekvLk_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/49/e1/BdUsSP82_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="Host_582"></a>创建主机（Host）</h4> 
<pre><code class="prism language-sh">添加对应主机名称和端口号。
主机名称： 要与主机名相同，这是zabbix server程序用的
可见名称： 显示在zabbix网页上的，给我们看的
注意：主机名称要与 zabbix_agent 配置文件中的 Hostname 一致，否则报错。
</code></pre> 
<p><img src="https://images2.imgbox.com/8c/82/DhTYLbJf_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/a0/a0/AtepBvdW_o.png" alt="在这里插入图片描述"></p> 
<p>3）重复以上步骤，添加其他主机</p> 
<p>注意：主机刚添加，主机可用性会不显示，添加监控项后，状态会改变。</p> 
<p><img src="https://images2.imgbox.com/e0/b4/8TeZjtpq_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_606"></a>创建应用集</h4> 
<pre><code>应用集一般配合监控项使用，其作用是给监控项分类。
配置 --&gt; 主机 --&gt; 应用集 --&gt; 创建应用集 --&gt; 添加
</code></pre> 
<p><img src="https://images2.imgbox.com/72/76/hEI0KXxS_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/be/68/yW66FTy7_o.png" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-f7VdVXZo-1665560035902)(D:\阳光笔记\zabbix\zabbix生产环境安装.assets\1664179631996.png)]"></p> 
<p><img src="https://images2.imgbox.com/9d/18/4bCQwwEa_o.png" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-GnAlK5Xw-1665560035902)(D:\阳光笔记\zabbix\zabbix生产环境安装.assets\1664179695093.png)]"></p> 
<h4><a id="Items_622"></a>创建监控项（Items）</h4> 
<pre><code class="prism language-sh">监控项（iterm）就是你要监控的指标，比如cpu利用率，cpu负载，内存使用率等等。
配置 --&gt; 主机 --&gt; 监控项 --&gt; 创建监控项 --&gt; 添加

注意：监控项添加完毕后，等待一会，主机 的可用性状态改变，变为绿色，说明主机成功连接server并监控成功。
名称为改item名，可随意指定，键值要和 /bigdata/zabbix/etc/zabbix_agentd.conf.d/bfd_parameters.conf中指定的key一致。

#信息类型：
	Numeric (unsigned) ：正整数
	Numeric (float) ：小数，可以是负数
	Log：日志格式，可以使用专门的匹配语法
	Character：255以内的字符串
	Text：文本大字段		
</code></pre> 
<p><img src="https://images2.imgbox.com/76/76/cRyx8NJ0_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/55/2c/qClKmBdQ_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/64/99/LyaIU4hf_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/e7/94/kQYvBwly_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="Trigger_645"></a>创建触发器（Trigger）</h4> 
<pre><code class="prism language-sh">触发器的作用：当监控项获取到的值达到一定条件时就触发报警
配置 --&gt; 主机 --&gt; 监控项 --&gt; 创建监控项 --&gt; 添加
名称随意指定，表达式中的项目添加特定的项目，功能根据实际自行选择

#监控脚本状态为，进程存在，输出0；进程挂掉，输出1。即zabbix触发器为1时，zabbix报警
</code></pre> 
<p><img src="https://images2.imgbox.com/69/7f/1iLCucf5_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/54/b6/So1jiV2K_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/4b/03/jp8WC0Ue_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/11/bb/UqXlBjza_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="Action_661"></a>创建动作（Action）</h4> 
<pre><code class="prism language-sh">动作：一个对事件做出反应的预定义的操作，比如失败重启。

名称随意指定，条件指定特定触发器触发则执行相应的动作，操作为改动作要执行的动作。
本集群执行的 动作 为重启操作。
</code></pre> 
<p><img src="https://images2.imgbox.com/28/75/mKy1tTsQ_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/61/bf/TVhA8fRm_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/73/20/EzKaO0XB_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/29/d4/keRCWCDk_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/58/59/gjgvHOfL_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_678"></a>部分错误汇总</h3> 
<h4><a id="_680"></a>数据库字符集错误</h4> 
<pre><code class="prism language-sql"><span class="token comment">--报错信息：</span>
	Unsupported <span class="token keyword">charset</span> <span class="token operator">or</span> collation <span class="token keyword">for</span> <span class="token keyword">tables</span>
<span class="token comment">--原因：</span>
	zabbix 从<span class="token number">4.4</span><span class="token number">.6</span>开始数据库只支持 <span class="token keyword">character</span> <span class="token keyword">set</span> utf8 <span class="token keyword">collate</span> utf8_bin
<span class="token comment">--解决方法：</span>
 <span class="token comment">#方案1：</span>
	<span class="token keyword">drop</span> <span class="token keyword">database</span> zabbix<span class="token punctuation">;</span>
	<span class="token keyword">create</span> <span class="token keyword">database</span> zabbix <span class="token keyword">character</span> <span class="token keyword">set</span> utf8 <span class="token keyword">collate</span> utf8_bin<span class="token punctuation">;</span>
 <span class="token comment">#方案2：配置面上显示有错的表进行以下操作，修改表的字符集及排序规则</span>
 	<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> acknowledges <span class="token keyword">CONVERT</span> <span class="token keyword">TO</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_bin<span class="token punctuation">;</span> 
</code></pre> 
<p><img src="https://images2.imgbox.com/f4/82/q573DQOl_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/0d/91/cjnxvPqL_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="libpcre_698"></a>libpcre</h4> 
<pre><code class="prism language-sh">configure: error: Unable to use libpcre(libpcre check failed)
解决：yum -y install pcre*
</code></pre> 
<p><img src="https://images2.imgbox.com/51/51/dDr3MApg_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e8ccec023e9b0f57bd2bef8014f83e7f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Mybatis 源码分析（二）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c02289f48808f8f5aceb9a02989d5ca5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">盘点下半年EI国际会议，值得收藏！</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>