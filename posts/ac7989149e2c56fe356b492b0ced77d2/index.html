<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>zForce SDK的使用 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="zForce SDK的使用" />
<meta property="og:description" content="0、根据具体的操作系统参考以下SDK指导手册 Windows
Linux
1、下载zForce SDK zForce SDK 2.8.0
2、准备系统以安装和运行SDK程序 安装Visual Studio 2017及以上版本并选择用于构建C程序（而不仅仅是C&#43;&#43;）的选项。
将zForceSDK-x.x.x.zip提取到任何文件夹
3、构建并运行示例程序 该示例程序包含在 SDK 中的原因有两个，一是允许您开始与触摸传感器模块进行通信，二是作为创建自己的应用程序的起点。
4、构建程序 ①打开解决方案文件 zForceSDK-Example.sln，执行以下任一操作：
a. 打开Visual Studio 2017 。
b. 从文件资源管理器打开它。
②确保配置设置为“x64”。
③选择构建类型：Release或Debug
④在菜单中选择生成（build） » 构建解决方案（ Build Solution）。
结果：创建了 zForceSDK 目录。
5、第一次运行程序 ①将手势条通过USB与PC机进行连接
②从文件资源管理器中，打开文件夹 zForceSDK\Windows\x86-64。
③复制 zForce.dll。
④打开文件夹 zForceSDK\x64 将 zForce.dll 粘贴到子文件夹 Release 或子文件夹 Debug 中（根据所选配置，两者都会出现）
⑤ 选择“调试（Debug ）”»“开始调试（Start Debugging）”，或“调试”（Debug ）»“开始调试（不执行）（Start without Debugging）”
运行结果如下：
运行结果分析如下：
根据运行结果分析如下： 1. 首先，创建了一个连接并成功连接到设备。 2. 发现了2个设备，其中一个设备名称为&#34;Air&#34;。 3. 接收到了一个消息，消息序列号为1，消息类型为OperationModesMessageType，表示接收到了操作模式消息。 - 操作模式报告显示检测模式打开，信号模式关闭，LED亮度模式关闭，检测HID模式关闭。 4." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/ac7989149e2c56fe356b492b0ced77d2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-12T10:33:43+08:00" />
<meta property="article:modified_time" content="2024-01-12T10:33:43+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">zForce SDK的使用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="0SDK_1"></a>0、根据具体的操作系统参考以下SDK指导手册</h3> 
<p><a href="https://support.neonode.com/docs/display/SDKDOC/Getting+started+with+SDK+for+Windows" rel="nofollow">Windows</a></p> 
<p><a href="https://support.neonode.com/docs/display/SDKDOC/Getting+started+with+SDK+for+Linux" rel="nofollow">Linux</a></p> 
<h3><a id="1zForce_SDK_7"></a>1、下载zForce SDK</h3> 
<p><a href="https://customer.neonode.com/hubfs/Downloads%20for%20Touch%20Sensor%20Modules/Developer%20Toolkit%20-%20Software%20Development%20Kit/zForceSDK-2.8.0.zip?hsLang=en" rel="nofollow">zForce SDK 2.8.0</a></p> 
<h3><a id="2SDK_10"></a>2、准备系统以安装和运行SDK程序</h3> 
<p>安装Visual Studio 2017及以上版本并选择用于构建C程序（而不仅仅是C++）的选项。<br> 将zForceSDK-x.x.x.zip提取到任何文件夹</p> 
<h3><a id="3_14"></a>3、构建并运行示例程序</h3> 
<p>该示例程序包含在 SDK 中的原因有两个，一是允许您开始与触摸传感器模块进行通信，二是作为创建自己的应用程序的起点。</p> 
<h3><a id="4_17"></a>4、构建程序</h3> 
<p>①打开解决方案文件 zForceSDK-Example.sln，执行以下任一操作：<br> a. 打开Visual Studio 2017 。<br> b. 从文件资源管理器打开它。<br> ②确保配置设置为“x64”。<br> ③选择构建类型：Release或Debug<br> ④在菜单中选择生成（build） » 构建解决方案（ Build Solution）。<br> 结果：创建了 zForceSDK 目录。<br> <img src="https://images2.imgbox.com/44/58/IvJubV0B_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="5_29"></a>5、第一次运行程序</h3> 
<p>①将手势条通过USB与PC机进行连接<br> ②从文件资源管理器中，打开文件夹 zForceSDK\Windows\x86-64。<br> ③复制 zForce.dll。<br> ④打开文件夹 zForceSDK\x64 将 zForce.dll 粘贴到子文件夹 Release 或子文件夹 Debug 中（根据所选配置，两者都会出现）<br> ⑤ 选择“调试（Debug ）”»“开始调试（Start Debugging）”，或“调试”（Debug ）»“开始调试（不执行）（Start without Debugging）”<br> <img src="https://images2.imgbox.com/4c/3b/bqXDPJlT_o.png" alt="在这里插入图片描述"></p> 
<p><strong>运行结果如下：</strong><br> <img src="https://images2.imgbox.com/60/0c/AEe7MSmM_o.png" alt="在这里插入图片描述"><br> 运行结果分析如下：</p> 
<pre><code class="prism language-bash">根据运行结果分析如下：

<span class="token number">1</span>. 首先，创建了一个连接并成功连接到设备。
<span class="token number">2</span>. 发现了2个设备，其中一个设备名称为<span class="token string">"Air"</span>。
<span class="token number">3</span>. 接收到了一个消息，消息序列号为1，消息类型为OperationModesMessageType，表示接收到了操作模式消息。
   - 操作模式报告显示检测模式打开，信号模式关闭，LED亮度模式关闭，检测HID模式关闭。
<span class="token number">4</span>. 接收到了一个消息，消息序列号为2，消息类型为McuUniqueIdentifierMessageType，表示接收到了微控制器唯一标识符消息。
   - 打印了微控制器唯一标识符为450055000751363334393737。
<span class="token number">5</span>. 接收到了一个消息，消息序列号为3，消息类型为EnableMessageType，表示接收到了启用消息。
   - 启用状态为是，连续模式为是，消息数量为0。

根据运行结果，可以看出代码成功连接到设备，接收到了不同类型的消息，并根据消息类型进行相应的处理。
</code></pre> 
<h3><a id="6_56"></a>6、代码分析</h3> 
<pre><code class="prism language-c"><span class="token comment">/*! \file
    这段代码是一个示例程序，展示了如何使用zForce SDK。它连接到一个设备，初始化zForce库，并执行一系列操作。
  1、代码创建了一个Connection对象，并使用hidpipe协议连接到设备。这个Connection对象用于与设备进行通信。
  2、代码通过Connection对象找到了Platform设备和Sensor设备。Platform设备通常表示与传感器相关的平台信息，而Sensor设备则表示实际的传感器设备。
  代码之后设置了Sensor设备的操作模式，并进入一个无限循环。
  3、在循环中，代码等待来自设备的消息，并根据消息的类型做出相应的处理。
     当收到EnableMessageType类型的消息时，表示已成功启用设备并可以接收通知。
     当收到OperationModesMessageType类型的消息时，表示成功获取了MCU唯一标识符。
     当收到McuUniqueIdentifierMessageType类型的消息时，表示已成功设置了传感器设备的使能状态。
  4、最后，代码在Destroy函数中关闭了所有资源，并在SignalHandler函数中处理了程序终止的信号。
 */</span>
<span class="token comment">// 这里包含一些C标准库头文件以及一些zForce SDK的头文件。</span>
<span class="token comment">// Header Files</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">_WIN32</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;windows.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">// _WIN32</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdint.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdbool.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;errno.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;zForceCommon.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;OsAbstractionLayer.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;zForce.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Queue.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Connection.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Device.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Message.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"ErrorString.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"DumpMessage.h"</span></span>
<span class="token comment">// 这里定义了一些宏常量，用于表示设备的厂商ID、产品ID以及测试分辨率。</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">HIDDEVICEVID</span> <span class="token string">"0x1536"</span>     <span class="token comment">// Vendor ID of Device.</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">HIDDEVICEPID</span> <span class="token string">"0x0101"</span>     <span class="token comment">// Product ID of Device.</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">TESTRESOLUTIONX1</span> <span class="token expression"><span class="token number">640</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">TESTRESOLUTIONY1</span> <span class="token expression"><span class="token number">480</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">TESTRESOLUTIONZ1</span> <span class="token expression"><span class="token number">100</span></span></span>
<span class="token comment">// 这些是函数的前向声明，用于后面的函数实现或调用。</span>
<span class="token keyword">void</span>   <span class="token function">DumpMessage</span> <span class="token punctuation">(</span>Message <span class="token operator">*</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span>   <span class="token function">DumpEnableMessage</span> <span class="token punctuation">(</span>Message <span class="token operator">*</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span>   <span class="token function">DumpDisableMessage</span> <span class="token punctuation">(</span>Message <span class="token operator">*</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span>   <span class="token function">DumpOperationModesMessage</span> <span class="token punctuation">(</span>Message <span class="token operator">*</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span>   <span class="token function">DumpResolutionMessage</span> <span class="token punctuation">(</span>Message <span class="token operator">*</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span>   <span class="token function">DumpTouchActiveArea</span> <span class="token punctuation">(</span>Message <span class="token operator">*</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span>   <span class="token function">DumpReverseTouchActiveArea</span> <span class="token punctuation">(</span>Message <span class="token operator">*</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span>   <span class="token function">DumpTouchMessage</span> <span class="token punctuation">(</span>Message <span class="token operator">*</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span>   <span class="token function">DumpNumberOfTrackedObjectsMessage</span> <span class="token punctuation">(</span>Message <span class="token operator">*</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span>   <span class="token function">DumpFingerFrequencyMessage</span> <span class="token punctuation">(</span>Message <span class="token operator">*</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span>   <span class="token function">DumpIdleFrequencyMessage</span> <span class="token punctuation">(</span>Message <span class="token operator">*</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span>   <span class="token function">DumpDetectedObjectSizeRestrictionMessage</span> <span class="token punctuation">(</span>Message <span class="token operator">*</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span>   <span class="token function">DumpMessageError</span> <span class="token punctuation">(</span>Message <span class="token operator">*</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">char</span> <span class="token operator">*</span> <span class="token function">ErrorString</span> <span class="token punctuation">(</span><span class="token keyword">int</span> errorCode<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span>   <span class="token function">DoDisable</span> <span class="token punctuation">(</span>SensorDevice <span class="token operator">*</span> sensorDevice<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span>   <span class="token function">DoEnable</span> <span class="token punctuation">(</span>SensorDevice <span class="token operator">*</span> sensorDevice<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span>   <span class="token function">DoOperationModes</span> <span class="token punctuation">(</span>SensorDevice <span class="token operator">*</span> sensorDevice<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span>   <span class="token function">DoTouchActiveArea</span> <span class="token punctuation">(</span>SensorDevice <span class="token operator">*</span> sensorDevice<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span>   <span class="token function">DoResolution</span> <span class="token punctuation">(</span>SensorDevice <span class="token operator">*</span> sensorDevice<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span>   <span class="token function">DoNumberOfTrackedObjects</span> <span class="token punctuation">(</span>SensorDevice <span class="token operator">*</span> sensorDevice<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span>   <span class="token function">DoFingerFrequency</span> <span class="token punctuation">(</span>SensorDevice <span class="token operator">*</span> sensorDevice<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span>   <span class="token function">DoIdleFrequency</span> <span class="token punctuation">(</span>SensorDevice <span class="token operator">*</span> sensorDevice<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span>   <span class="token function">DoDetectedObjectSizeRestrictionMessage</span> <span class="token punctuation">(</span>SensorDevice <span class="token operator">*</span> sensorDevice<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/*
 * We will let the user quit the program by pressing
 * Control-C. In such an event SignalHandler will be called.
 */</span>
<span class="token keyword">void</span>   <span class="token function">SignalHandler</span> <span class="token punctuation">(</span><span class="token keyword">int</span> sig<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/*
 * The procedure we sue to close everything down correctly.
 */</span>
<span class="token keyword">void</span> <span class="token function">Destroy</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Local (static) Variables</span>
<span class="token comment">// 定义了一些静态变量和函数的声明。</span>
<span class="token keyword">static</span> bool         zForceInitialized <span class="token operator">=</span> false<span class="token punctuation">;</span>
<span class="token keyword">static</span> Connection <span class="token operator">*</span> MyConnection <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> bool         IsConnected <span class="token operator">=</span> false<span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 首先调用了zForce_Initialize函数进行zForce库的初始化，并检查初始化的结果。如果初始化失败，打印错误信息并退出程序。</span>
    bool resultCode <span class="token operator">=</span> <span class="token function">zForce_Initialize</span> <span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>resultCode<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        zForceInitialized <span class="token operator">=</span> true<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"zForce initialization failed.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">Destroy</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Install the Control-C handler.</span>
    <span class="token comment">// 这里设置了信号处理函数，当收到SIGINT信号（通常是用户按下Ctrl+C）时，会调用SignalHandler函数。</span>
    <span class="token function">signal</span> <span class="token punctuation">(</span>SIGINT<span class="token punctuation">,</span> SignalHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Here we connect to a device using hidpipe.</span>
    <span class="token comment">//</span>
    <span class="token comment">// HidPipeTransport (hidpipe) has the following options:</span>
    <span class="token comment">//</span>
    <span class="token comment">// vid: Vendor ID. Current neonode sensors have VID 0x1536.</span>
    <span class="token comment">// pid: Product ID. Current neonode sensors have PID 0x0101.</span>
    <span class="token comment">// index: If the computer has multiple connected Neonode sensors,</span>
    <span class="token comment">//        the first one has index 0, the second has index 1, etc.</span>
    <span class="token comment">//        Note: The order is decided by the Operating System.</span>
    <span class="token comment">//</span>
    <span class="token comment">// Asn1Protocol (asn1) currently has no options.</span>
    <span class="token comment">//</span>
    <span class="token comment">// StreamingDataFrame (Streaming) is the DataFrame type used by both</span>
    <span class="token comment">// HidPipeTransport and Asn1Protocol.</span>
    <span class="token comment">// 创建了一个Connection对象，并使用hidpipe协议连接到设备。hidpipe协议需要指定设备的厂商ID、产品ID和索引。</span>
    MyConnection <span class="token operator">=</span> <span class="token function">Connection_New</span> <span class="token punctuation">(</span>
            <span class="token string">"hidpipe://vid="</span>HIDDEVICEVID<span class="token string">",pid="</span>HIDDEVICEPID<span class="token string">",index=0"</span><span class="token punctuation">,</span> <span class="token comment">// Transport</span>
            <span class="token string">"asn1://"</span><span class="token punctuation">,</span>                                                 <span class="token comment">// Protocol</span>
            <span class="token string">"Streaming"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                              <span class="token comment">// DataFrame type. Both Transport and Protocol must support the same.</span>
    <span class="token comment">// 检查Connection对象的创建是否成功，如果失败则打印错误信息并退出程序。</span>
    <span class="token comment">// 然后尝试连接到设备，如果连接失败则打印错误信息并退出程序。</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> MyConnection<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"Unable to create connection: (%d) %s.\n"</span><span class="token punctuation">,</span>
                zForceErrno<span class="token punctuation">,</span>
                <span class="token function">ErrorString</span> <span class="token punctuation">(</span>zForceErrno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">Destroy</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"Connection created.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"Connecting to Device.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    bool connectionAttemptResult <span class="token operator">=</span> MyConnection<span class="token operator">-&gt;</span><span class="token function">Connect</span> <span class="token punctuation">(</span>MyConnection<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>connectionAttemptResult<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"Unable to connect to device: (%d) %s\n"</span><span class="token punctuation">,</span>
                zForceErrno<span class="token punctuation">,</span>
                <span class="token function">ErrorString</span> <span class="token punctuation">(</span>zForceErrno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">Destroy</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Wait for Connection response to arrive within 1000 seconds.</span>
    <span class="token comment">// 这里从Connection对象的连接队列中获取连接消息(ConnectionMessage)。如果获取失败，则打印错误信息并退出程序。</span>
    ConnectionMessage <span class="token operator">*</span> connectionMessage <span class="token operator">=</span>
        MyConnection<span class="token operator">-&gt;</span>ConnectionQueue<span class="token operator">-&gt;</span><span class="token function">Dequeue</span> <span class="token punctuation">(</span>MyConnection<span class="token operator">-&gt;</span>ConnectionQueue<span class="token punctuation">,</span>
                                                <span class="token number">1000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> connectionMessage<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"No Connection Message Received.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"   Reason: %s\n"</span><span class="token punctuation">,</span> <span class="token function">ErrorString</span> <span class="token punctuation">(</span>zForceErrno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">Destroy</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"Devices: %d\n"</span><span class="token punctuation">,</span> MyConnection<span class="token operator">-&gt;</span>NumberOfDevices<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 通过Connection对象的FindDevice函数找到了Platform设备和Sensor设备。如果没有找到对应的设备，则打印错误信息并退出程序。</span>
    PlatformDevice <span class="token operator">*</span> platformDevice <span class="token operator">=</span>
        <span class="token punctuation">(</span>PlatformDevice <span class="token operator">*</span><span class="token punctuation">)</span>MyConnection<span class="token operator">-&gt;</span><span class="token function">FindDevice</span> <span class="token punctuation">(</span>MyConnection<span class="token punctuation">,</span> Platform<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> platformDevice<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"No Platform device found.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">Destroy</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Find the first Sensor type device (Core/Air/Plus).</span>
    SensorDevice <span class="token operator">*</span> sensorDevice <span class="token operator">=</span>
        <span class="token punctuation">(</span>SensorDevice <span class="token operator">*</span><span class="token punctuation">)</span>MyConnection<span class="token operator">-&gt;</span><span class="token function">FindDevice</span> <span class="token punctuation">(</span>MyConnection<span class="token punctuation">,</span> Sensor<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> sensorDevice<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"No Sensor device found.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">Destroy</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">char</span>     <span class="token operator">*</span> deviceTypeString <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    DeviceType deviceType <span class="token operator">=</span> sensorDevice<span class="token operator">-&gt;</span>DeviceType <span class="token operator">&amp;</span> <span class="token operator">~</span>Sensor<span class="token punctuation">;</span>

    <span class="token keyword">switch</span> <span class="token punctuation">(</span>deviceType<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">case</span> Platform<span class="token operator">:</span>
            deviceTypeString <span class="token operator">=</span> <span class="token string">"Platform"</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> Core<span class="token operator">:</span>
            deviceTypeString <span class="token operator">=</span> <span class="token string">"Core"</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> Air<span class="token operator">:</span>
            deviceTypeString <span class="token operator">=</span> <span class="token string">"Air"</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> Plus<span class="token operator">:</span>
            deviceTypeString <span class="token operator">=</span> <span class="token string">"Plus"</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> Lighting<span class="token operator">:</span>
            deviceTypeString <span class="token operator">=</span> <span class="token string">"Lighting"</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            deviceTypeString <span class="token operator">=</span> <span class="token string">"Unknown"</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"Found Device: %s.\n"</span><span class="token punctuation">,</span> deviceTypeString<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/*
     * The sequence will now be
     * 1) SetOperationModes.
     * 2) GetResolution.
     * 3) GetMcuUniqueIdentifier.
     * 4) Enable notifications.
     *
     */</span>
    <span class="token comment">// 设置了Sensor设备的操作模式</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>sensorDevice<span class="token operator">-&gt;</span><span class="token function">SetOperationModes</span> <span class="token punctuation">(</span>sensorDevice<span class="token punctuation">,</span>
                                          DetectionMode<span class="token operator">|</span>SignalsMode<span class="token operator">|</span>LedLevelsMode<span class="token operator">|</span>DetectionHidMode<span class="token operator">|</span>GesturesMode<span class="token punctuation">,</span>
                                          DetectionMode<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"SetOperationModes error (%d) %s.\n"</span><span class="token punctuation">,</span> zForceErrno<span class="token punctuation">,</span> <span class="token function">ErrorString</span> <span class="token punctuation">(</span>zForceErrno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">Destroy</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// Wait for the answer to arrive, timeout after 1 second (1000ms).</span>
        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">DEQUEUETIMEOUT</span> <span class="token expression"><span class="token number">1000</span></span></span>
        <span class="token comment">// 从设备队列中获取消息。通过调用Dequeue函数，传入设备队列和超时时间来获取消息。</span>
        Message <span class="token operator">*</span> message <span class="token operator">=</span> MyConnection<span class="token operator">-&gt;</span>DeviceQueue<span class="token operator">-&gt;</span><span class="token function">Dequeue</span> <span class="token punctuation">(</span>MyConnection<span class="token operator">-&gt;</span>DeviceQueue<span class="token punctuation">,</span> DEQUEUETIMEOUT<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">!=</span> message<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token function">DumpMessage</span> <span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">switch</span> <span class="token punctuation">(</span>message<span class="token operator">-&gt;</span>MessageType<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">case</span> EnableMessageType<span class="token operator">:</span>
                    <span class="token comment">/* We are enabled and can now receive notifications */</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>

                <span class="token keyword">case</span> OperationModesMessageType<span class="token operator">:</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>platformDevice<span class="token operator">-&gt;</span><span class="token function">GetMcuUniqueIdentifier</span> <span class="token punctuation">(</span>platformDevice<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{<!-- --></span>
                        <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"GetMcuUniqueIdentifier error (%d) %s.\n"</span><span class="token punctuation">,</span> zForceErrno<span class="token punctuation">,</span> <span class="token function">ErrorString</span><span class="token punctuation">(</span>zForceErrno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                        <span class="token function">Destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>

                <span class="token keyword">case</span> McuUniqueIdentifierMessageType<span class="token operator">:</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>sensorDevice<span class="token operator">-&gt;</span><span class="token function">SetEnable</span> <span class="token punctuation">(</span>sensorDevice<span class="token punctuation">,</span> true<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{<!-- --></span>
                        <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"SetEnable error (%d) %s.\n"</span><span class="token punctuation">,</span> zForceErrno<span class="token punctuation">,</span> <span class="token function">ErrorString</span> <span class="token punctuation">(</span>zForceErrno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                        <span class="token function">Destroy</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token function">exit</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">default</span><span class="token operator">:</span>
                    <span class="token comment">/* Do nothing */</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            message<span class="token operator">-&gt;</span><span class="token function">Destructor</span> <span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 从连接队列中获取连接消息</span>
        connectionMessage <span class="token operator">=</span> MyConnection<span class="token operator">-&gt;</span>ConnectionQueue<span class="token operator">-&gt;</span><span class="token function">Dequeue</span> <span class="token punctuation">(</span>MyConnection<span class="token operator">-&gt;</span>ConnectionQueue<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">!=</span> connectionMessage<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>   <span class="token comment">// 根据连接消息的ConnectionStatus进行不同的处理：</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span>connectionMessage<span class="token operator">-&gt;</span>ConnectionStatus<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">case</span> Connected<span class="token operator">:</span> <span class="token comment">// 表示已连接成功</span>
                <span class="token comment">/* Should only be received upon connect. */</span>
                <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"Connection status: Connected\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">/* Do nothing */</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> Disconnected<span class="token operator">:</span> <span class="token comment">// 表示连接已断开，打印相应的信息，然后调用Destroy函数释放资源并退出程序</span>
                <span class="token comment">/* Should only be received if the program calls MyConnection-&gt;Disconnect(MyConnection); */</span>
                <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"Connection status: Disconnected\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token function">Destroy</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">exit</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> ConnectionFault<span class="token operator">:</span> <span class="token comment">// 表示连接出现故障，可能是传感器物理断开或系统不再识别传感器，打印错误信息，然后调用Destroy函数释放资源并退出程序</span>
                <span class="token comment">/* This should only happen if the sensor is physically disconnected or no longer 
                recognised by the system (i.e driver crash or similar). */</span>
                <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"Connection status: (%d) %s\n"</span><span class="token punctuation">,</span> connectionMessage<span class="token operator">-&gt;</span>ErrorCode<span class="token punctuation">,</span> 
                         <span class="token function">ErrorString</span> <span class="token punctuation">(</span>connectionMessage<span class="token operator">-&gt;</span>ErrorCode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">Destroy</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">exit</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
                <span class="token comment">/* Do nothing */</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// 释放连接消息对象</span>
            connectionMessage<span class="token operator">-&gt;</span><span class="token function">Destructor</span><span class="token punctuation">(</span>connectionMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
    <span class="token comment">// 释放资源</span>
    <span class="token function">Destroy</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 用于释放资源。如果zForce库已经初始化，则调用zForce_Uninitialize函数进行释放。</span>
<span class="token keyword">void</span> <span class="token function">Destroy</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>IsConnected<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        MyConnection<span class="token operator">-&gt;</span><span class="token function">Disconnect</span> <span class="token punctuation">(</span>MyConnection<span class="token punctuation">)</span><span class="token punctuation">;</span>
        IsConnected <span class="token operator">=</span> false<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">!=</span> MyConnection<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        MyConnection<span class="token operator">-&gt;</span><span class="token function">Destructor</span> <span class="token punctuation">(</span>MyConnection<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>zForceInitialized<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">zForce_Uninitialize</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        zForceInitialized <span class="token operator">=</span> false<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">SignalHandler</span> <span class="token punctuation">(</span><span class="token keyword">int</span> sig<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> sig<span class="token punctuation">;</span>

    <span class="token function">Destroy</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">exit</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e33091b028574e58b33df8207f2e0df8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">软件系统培训方案（Word）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5e4b4dad1c4d86703001f69a42e0795f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">信息系统中的需求分析</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>