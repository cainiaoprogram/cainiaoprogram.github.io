<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>java连接打印机并进行打印 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="java连接打印机并进行打印" />
<meta property="og:description" content="首先添加maven依赖 &lt;dependency&gt; &lt;groupId&gt;org.apache.pdfbox&lt;/groupId&gt; &lt;artifactId&gt;pdfbox&lt;/artifactId&gt; &lt;version&gt;2.0.24&lt;/version&gt; &lt;/dependency&gt; 连接同网段的打印机 1.先查询本网段的在线打印机名称
public JsonResult&lt;List&lt;String&gt;&gt; getPrinterList() { List&lt;String&gt; list = new ArrayList&lt;&gt;(); HashPrintRequestAttributeSet requestAttributeSet = new HashPrintRequestAttributeSet(); DocFlavor flavor = DocFlavor.INPUT_STREAM.AUTOSENSE; //查找所有的可用的打印服务 PrintService[] printService = PrintServiceLookup.lookupPrintServices(flavor, requestAttributeSet); if (printService == null || printService.length == 0) { log.info(&#34;打印获取失败，未找到可用打印机，请检查。&#34;); } if (printService != null) { for (PrintService print : printService) { list.add(print.getName()); } } return JsonResult.ok(list); } 因为打印的时候只需要打印机名称就行了，所以这里只获取了打印机名称。
2.再通过打印机名称来进行打印操作
方法入参为打印机名称和文件。
public Boolean printFile(String printerName, MultipartFile multipartFile) { } 匹配打印机名称" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/9fe169aec0ab3172142e518371c429c4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-12T11:39:06+08:00" />
<meta property="article:modified_time" content="2023-07-12T11:39:06+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">java连接打印机并进行打印</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>首先添加maven依赖</h2> 
<pre><code class="hljs">        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.pdfbox&lt;/groupId&gt;
            &lt;artifactId&gt;pdfbox&lt;/artifactId&gt;
            &lt;version&gt;2.0.24&lt;/version&gt;
        &lt;/dependency&gt;</code></pre> 
<h2>连接同网段的打印机</h2> 
<p><strong>1.先查询本网段的在线打印机名称</strong></p> 
<pre><code class="language-java">    public JsonResult&lt;List&lt;String&gt;&gt; getPrinterList() {
        List&lt;String&gt; list = new ArrayList&lt;&gt;();
        HashPrintRequestAttributeSet requestAttributeSet = new HashPrintRequestAttributeSet();
        DocFlavor flavor = DocFlavor.INPUT_STREAM.AUTOSENSE;
        //查找所有的可用的打印服务
        PrintService[] printService = PrintServiceLookup.lookupPrintServices(flavor, requestAttributeSet);
        if (printService == null || printService.length == 0) {
            log.info("打印获取失败，未找到可用打印机，请检查。");
        }
        if (printService != null) {
            for (PrintService print : printService) {
                list.add(print.getName());
            }
        }
        return JsonResult.ok(list);
    }</code></pre> 
<p>因为打印的时候只需要打印机名称就行了，所以这里只获取了打印机名称。</p> 
<p><strong>2.再通过打印机名称来进行打印操作</strong></p> 
<p>方法入参为打印机名称和文件。</p> 
<pre><code class="language-java">public Boolean printFile(String printerName, MultipartFile multipartFile) {

}</code></pre> 
<p>匹配打印机名称</p> 
<pre><code class="language-java">if (printerName != null) {
                // 查找并设置打印机
                //获得本台电脑连接的所有打印机
                PrintService[] printServices = PrinterJob.lookupPrintServices();
                if(printServices == null || printServices.length == 0) {
                    System.out.print("打印失败，未找到可用打印机，请检查。");
                    return false;
                }
                PrintService printService = null;
                //匹配指定打印机
                for (int i = 0;i &lt; printServices.length; i++) {
                    System.out.println(printServices[i].getName());
                    if (printServices[i].getName().contains(printerName)) {
                        printService = printServices[i];
                        break;
                    }
                }
                if(printService!=null){
                    printJob.setPrintService(printService);
                }else{
                    System.out.print("打印失败，未找到名称为" + printerName + "的打印机，请检查。");
                    return false;
                }
            }</code></pre> 
<p>设置纸张大小、方向、页数等信息</p> 
<pre><code class="language-java"> //设置纸张及缩放
            PDFPrintable pdfPrintable = new PDFPrintable(document, Scaling.ACTUAL_SIZE);
            //设置多页打印
            Book book = new Book();
            PageFormat pageFormat = new PageFormat();
            //设置打印方向
            pageFormat.setOrientation(PageFormat.PORTRAIT);//纵向
            pageFormat.setPaper(getPaper());//设置纸张
            book.append(pdfPrintable, pageFormat, document.getNumberOfPages());
            printJob.setPageable(book);
            printJob.setCopies(1);//设置打印份数
            //添加打印属性
            HashPrintRequestAttributeSet pars = new HashPrintRequestAttributeSet();
            pars.add(Sides.DUPLEX); //设置单双页</code></pre> 
<p>最后进行打印</p> 
<pre>printJob.print(pars);</pre> 
<p>注意这里需要捕获异常</p> 
<p>完整打印代码如下：</p> 
<pre><code class="language-java">public Boolean printFile(String printerName, MultipartFile multipartFile) {
        PDDocument document = null;
        try {
            File file = new File(multipartFile.getOriginalFilename());
            FileUtils.copyInputStreamToFile(multipartFile.getInputStream(), file);
            document = PDDocument.load(file);
            PrinterJob printJob = PrinterJob.getPrinterJob();
            printJob.setJobName(file.getName());
            if (printerName != null) {
                // 查找并设置打印机
                //获得本台电脑连接的所有打印机
                PrintService[] printServices = PrinterJob.lookupPrintServices();
                if(printServices == null || printServices.length == 0) {
                    System.out.print("打印失败，未找到可用打印机，请检查。");
                    return false;
                }
                PrintService printService = null;
                //匹配指定打印机
                for (int i = 0;i &lt; printServices.length; i++) {
                    System.out.println(printServices[i].getName());
                    if (printServices[i].getName().contains(printerName)) {
                        printService = printServices[i];
                        break;
                    }
                }
                if(printService!=null){
                    printJob.setPrintService(printService);
                }else{
                    System.out.print("打印失败，未找到名称为" + printerName + "的打印机，请检查。");
                    return false;
                }
            }
            //设置纸张及缩放
            PDFPrintable pdfPrintable = new PDFPrintable(document, Scaling.ACTUAL_SIZE);
            //设置多页打印
            Book book = new Book();
            PageFormat pageFormat = new PageFormat();
            //设置打印方向
            pageFormat.setOrientation(PageFormat.PORTRAIT);//纵向
            pageFormat.setPaper(getPaper());//设置纸张
            book.append(pdfPrintable, pageFormat, document.getNumberOfPages());
            printJob.setPageable(book);
            printJob.setCopies(1);//设置打印份数
            //添加打印属性
            HashPrintRequestAttributeSet pars = new HashPrintRequestAttributeSet();
            pars.add(Sides.DUPLEX); //设置单双页
            printJob.print(pars);
        } catch (PrinterException e) {
            e.printStackTrace();
        } catch (IOException e) {
            e.printStackTrace();
        } finally {
            if (document != null) {
                try {
                    document.close();
                } catch (IOException e) {
                    e.printStackTrace();
                }   
            }
        }
        return true;
    }</code></pre> 
<p><strong>以上方法自己用于本地启动后连接本地打印机打印，如果服务发布到服务器上，那么打印机和服务所处的网段不一致，就搜索不到打印机，导致无法打印。</strong></p> 
<p><strong>解决以上问题可以代码通过socket连接指定ip，在指定ip搜索打印机。</strong></p> 
<p><strong>可以通过这个链接查看方法：</strong></p> 
<p><a href="https://blog.csdn.net/freak_csh/article/details/97533334?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522168178821816800222842317%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=168178821816800222842317&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-1-97533334-null-null.142%5Ev84%5Epc_search_v2,239%5Ev2%5Einsert_chatgpt&amp;utm_term=%E9%80%9A%E8%BF%87socket%E8%BF%9E%E6%8E%A5%E6%8C%87%E5%AE%9Aip&amp;spm=1018.2226.3001.4187" title="硬件系列（一）----------WIFI打印机之使用socket进行打印机搜索_打印机socket协议_freak_csh的博客-CSDN博客">硬件系列（一）----------WIFI打印机之使用socket进行打印机搜索_打印机socket协议_freak_csh的博客-CSDN博客</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/43aac739eb81c8e98041745eaf857b8d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Linux驱动开发：uboot移植流程</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a497d2e6c0a9fbec86741b82a6a461a9/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">基于单片机的楼宇水塔水位检测系统设计与实现（设计报告&#43;源代码&#43;proteus仿真&#43;PCB&#43;开题报告&#43;中期报告）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>