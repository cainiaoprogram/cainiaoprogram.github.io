<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>electron&#43;react&#43;mysql快速构建桌面应用程序 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="electron&#43;react&#43;mysql快速构建桌面应用程序" />
<meta property="og:description" content="electron&#43;react&#43;mysql快速构建桌面应用程序 在electron中创建react项目创建react项目安装electron相关模块创建electron文件夹和main.js修改package.json创建.env文件此时electron-react的目录结构启动electron 安装mysql2模块测试安装 利用IPC模块完成数据交互创建预加载文件preload.js修改main.jsreact代码中调用electron API 在electron中创建react项目 创建react项目 npx create-react-app electron-react-ipc-app 安装electron相关模块 npm install electron electron-builder wait-on npm install electron-is-dev concurrently electron-builder：用于为 macOS、Windows 和 Linux 打包和构建准备好分发的 Electron 应用程序，并提供开箱即用的“自动更新”支持。
wait-on：用于等待资源的简单命令行实用程序和 Node.js API，确保开发环境下electron能够访问到react服务。
electron-is-dev：仅在开发期间用于启用调试功能。 这个包必须在 Electron 主进程中使用。
concurrently：同时运行多个命令。像 npm run watch-js 和 npm run watch-less 但更好。
创建electron文件夹和main.js const {app, BrowserWindow} = require(&#39;electron&#39;); const isDev = require(&#39;electron-is-dev&#39;); const path = require(&#39;path&#39;); let win ; function createWindow() { win = new BrowserWindow({ width:800, height:600, }); // const startURL = isDev ?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/9fe9d3c7fa07b09a9da9bdcfb88ada02/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-05T23:58:13+08:00" />
<meta property="article:modified_time" content="2023-01-05T23:58:13+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">electron&#43;react&#43;mysql快速构建桌面应用程序</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>electron+react+mysql快速构建桌面应用程序</h4> 
 <ul><li><a href="#electronreact_1" rel="nofollow">在electron中创建react项目</a></li><li><ul><li><ul><li><a href="#react_2" rel="nofollow">创建react项目</a></li><li><a href="#electron_6" rel="nofollow">安装electron相关模块</a></li><li><a href="#electronmainjs_15" rel="nofollow">创建electron文件夹和main.js</a></li><li><a href="#packagejson_56" rel="nofollow">修改package.json</a></li><li><a href="#env_159" rel="nofollow">创建.env文件</a></li><li><a href="#electronreact_165" rel="nofollow">此时electron-react的目录结构</a></li><li><a href="#electron_168" rel="nofollow">启动electron</a></li></ul> 
  </li></ul> 
  </li><li><a href="#mysql2_175" rel="nofollow">安装mysql2模块</a></li><li><ul><li><ul><li><a href="#_181" rel="nofollow">测试安装</a></li></ul> 
  </li></ul> 
  </li><li><a href="#IPC_212" rel="nofollow">利用IPC模块完成数据交互</a></li><li><ul><li><ul><li><a href="#preloadjs_214" rel="nofollow">创建预加载文件preload.js</a></li><li><a href="#mainjs_224" rel="nofollow">修改main.js</a></li><li><a href="#reactelectron_API_247" rel="nofollow">react代码中调用electron API</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="electronreact_1"></a>在electron中创建react项目</h2> 
<h4><a id="react_2"></a>创建react项目</h4> 
<pre><code>npx create-react-app electron-react-ipc-app
</code></pre> 
<h4><a id="electron_6"></a>安装electron相关模块</h4> 
<pre><code>npm install electron electron-builder wait-on
npm install electron-is-dev concurrently
</code></pre> 
<p><a href="https://www.electron.build/" rel="nofollow"><em>electron-builder</em></a>：用于为 macOS、Windows 和 Linux 打包和构建准备好分发的 Electron 应用程序，并提供开箱即用的“自动更新”支持。<br> <a href="https://www.npmjs.com/package/wait-on" rel="nofollow"><em>wait-on</em></a>：用于等待资源的简单命令行实用程序和 Node.js API，确保开发环境下electron能够访问到react服务。<br> <a href="https://www.npmjs.com/package/electron-is-dev" rel="nofollow"><em>electron-is-dev</em></a>：仅在开发期间用于启用调试功能。 这个包必须在 Electron 主进程中使用。<br> <a href="https://www.npmjs.com/package/concurrently" rel="nofollow"><em>concurrently</em></a>：同时运行多个命令。像 npm run watch-js 和 npm run watch-less 但更好。</p> 
<h4><a id="electronmainjs_15"></a>创建electron文件夹和main.js</h4> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span>app<span class="token punctuation">,</span> BrowserWindow<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> isDev <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron-is-dev'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> win <span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">createWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    win  <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BrowserWindow</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">width</span><span class="token operator">:</span><span class="token number">800</span><span class="token punctuation">,</span>
        <span class="token literal-property property">height</span><span class="token operator">:</span><span class="token number">600</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// const startURL = isDev ? 'http://localhost:3000' :</span>
    <span class="token comment">//  `file://${path.join(__dirname, '../build/index.html')}`;</span>
    <span class="token comment">// win.loadURL(startURL); //npm run dev</span>
    <span class="token keyword">const</span> startURL <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">file://</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../build/index.html'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><span class="token comment">//npm run estart</span>
    win<span class="token punctuation">.</span><span class="token function">loadURL</span><span class="token punctuation">(</span>startURL<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
     <span class="token comment">// Open the DevTools.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isDev<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        win<span class="token punctuation">.</span>webContents<span class="token punctuation">.</span><span class="token function">openDevTools</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">'detach'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> 
   
<span class="token punctuation">}</span>

app<span class="token punctuation">.</span><span class="token function">whenReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">createWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'window-all-closed'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>platform <span class="token operator">!==</span> <span class="token string">'darwin'</span><span class="token punctuation">)</span> app<span class="token punctuation">.</span><span class="token function">quit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'activate'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>BrowserWindow<span class="token punctuation">.</span><span class="token function">getAllWindows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token function">createWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="packagejson_56"></a>修改package.json</h4> 
<p>添加main属性指向electron的启动js及项目主页的url</p> 
<pre><code class="prism language-javascript"><span class="token string-property property">"main"</span><span class="token operator">:</span> <span class="token string">"electron/main.js"</span><span class="token punctuation">,</span>
<span class="token string-property property">"homepage"</span><span class="token operator">:</span> <span class="token string">"./"</span><span class="token punctuation">,</span>
</code></pre> 
<p>添加electron启动和打包脚本</p> 
<pre><code class="prism language-javascript"><span class="token string-property property">"dev"</span><span class="token operator">:</span> <span class="token string">"concurrently \"npm start\" \"wait-on http://localhost:3000 &amp;&amp; electron .\""</span><span class="token punctuation">,</span>
<span class="token string-property property">"ebuild"</span><span class="token operator">:</span> <span class="token string">"npm run build &amp;&amp; electron-builder"</span><span class="token punctuation">,</span>
<span class="token string-property property">"estart"</span><span class="token operator">:</span> <span class="token string">"npm run build &amp;&amp; electron ."</span>
</code></pre> 
<p><em><strong>防止electron打包报错</strong></em></p> 
<ol><li> <p>添加devDependencies属性，并将dependencies属性中的electron和electron-builder移动到devDependencies中。</p> </li><li> <p>electron-builder打包默认是去找 <em>public/electron.js</em>，如果想把electron代码放在别处（如<em>electron/main.js</em>）,则需要在package.js中添加如下配置，它指定了electron-builder打包文件及额外的配置文件（main的路径），然后将react和electron的清单文件分离。</p> <pre><code class="prism language-javascript"><span class="token string-property property">"build"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"files"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">"build/**/*"</span><span class="token punctuation">,</span>
      <span class="token string">"node_modules/**/*"</span><span class="token punctuation">,</span>
      <span class="token string">"electron/**/*"</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">"directories"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
      <span class="token string-property property">"buildResources"</span><span class="token operator">:</span> <span class="token string">"assets"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string-property property">"extraMetadata"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string-property property">"main"</span><span class="token operator">:</span> <span class="token string">"electron/main.js"</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> 
</code></pre> </li></ol> 
<p>修改后的package.json如下：</p> 
<pre><code class="prism language-javascript"><span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"name"</span><span class="token operator">:</span> <span class="token string">"electron-react-ipc-app"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"main"</span><span class="token operator">:</span> <span class="token string">"electron/main.js"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"homepage"</span><span class="token operator">:</span> <span class="token string">"./"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"description"</span><span class="token operator">:</span><span class="token string">"test"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"author"</span><span class="token operator">:</span><span class="token string">"test"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"version"</span><span class="token operator">:</span> <span class="token string">"0.1.0"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"private"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token string-property property">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"electron"</span><span class="token operator">:</span> <span class="token string">"^22.0.0"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"electron-builder"</span><span class="token operator">:</span> <span class="token string">"^23.6.0"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"@testing-library/jest-dom"</span><span class="token operator">:</span> <span class="token string">"^5.16.5"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"@testing-library/react"</span><span class="token operator">:</span> <span class="token string">"^13.4.0"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"@testing-library/user-event"</span><span class="token operator">:</span> <span class="token string">"^13.5.0"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"concurrently"</span><span class="token operator">:</span> <span class="token string">"^7.6.0"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"electron-is-dev"</span><span class="token operator">:</span> <span class="token string">"^2.0.0"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"react"</span><span class="token operator">:</span> <span class="token string">"^18.2.0"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"react-dom"</span><span class="token operator">:</span> <span class="token string">"^18.2.0"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"react-scripts"</span><span class="token operator">:</span> <span class="token string">"5.0.1"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"wait-on"</span><span class="token operator">:</span> <span class="token string">"^7.0.1"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"web-vitals"</span><span class="token operator">:</span> <span class="token string">"^2.1.4"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"dev"</span><span class="token operator">:</span> <span class="token string">"concurrently \"npm start\" \"wait-on  http://10.10.10.5:3000 &amp;&amp; electron .\""</span><span class="token punctuation">,</span>
    <span class="token string-property property">"start"</span><span class="token operator">:</span> <span class="token string">"react-scripts start"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"build"</span><span class="token operator">:</span> <span class="token string">"react-scripts build"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"test"</span><span class="token operator">:</span> <span class="token string">"react-scripts test"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"eject"</span><span class="token operator">:</span> <span class="token string">"react-scripts eject"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"ebuild"</span><span class="token operator">:</span> <span class="token string">"npm run build &amp;&amp; electron-builder"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"estart"</span><span class="token operator">:</span> <span class="token string">"npm run build &amp;&amp; electron ."</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">"eslintConfig"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"extends"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">"react-app"</span><span class="token punctuation">,</span>
      <span class="token string">"react-app/jest"</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">"browserslist"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"production"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">"&gt;0.2%"</span><span class="token punctuation">,</span>
      <span class="token string">"not dead"</span><span class="token punctuation">,</span>
      <span class="token string">"not op_mini all"</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">"development"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">"last 1 chrome version"</span><span class="token punctuation">,</span>
      <span class="token string">"last 1 firefox version"</span><span class="token punctuation">,</span>
      <span class="token string">"last 1 safari version"</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">"build"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"files"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">"build/**/*"</span><span class="token punctuation">,</span>
      <span class="token string">"node_modules/**/*"</span><span class="token punctuation">,</span>
      <span class="token string">"electron/**/*"</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">"directories"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
      <span class="token string-property property">"buildResources"</span><span class="token operator">:</span> <span class="token string">"assets"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string-property property">"extraMetadata"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string-property property">"main"</span><span class="token operator">:</span> <span class="token string">"electron/main.js"</span>
    <span class="token punctuation">}</span>
    
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="env_159"></a>创建.env文件</h4> 
<pre><code class="prism language-javascript"><span class="token constant">BROWSER</span><span class="token operator">=</span>none （避免react服务启动时打开浏览器）
</code></pre> 
<h4><a id="electronreact_165"></a>此时electron-react的目录结构</h4> 
<p><img src="https://images2.imgbox.com/70/f2/zWAgAcj4_o.png" alt="当前目录结构"></p> 
<h4><a id="electron_168"></a>启动electron</h4> 
<pre><code class="prism language-javascript">npm run <span class="token function">dev</span> <span class="token punctuation">(</span>会先启动react服务，再启动electron服务访问localhost<span class="token operator">:</span><span class="token number">4000</span><span class="token punctuation">)</span>
npm run <span class="token function">ebuild</span><span class="token punctuation">(</span>会先打包react项目，再打包electron<span class="token punctuation">)</span>
npm run <span class="token function">estart</span><span class="token punctuation">(</span>会先打包react项目，再启动electron访问react打包后的静态文件<span class="token punctuation">)</span>
</code></pre> 
<h2><a id="mysql2_175"></a>安装mysql2模块</h2> 
<p>electron可以通过安装<a href="https://www.npmjs.com/package/mysql2" rel="nofollow"><em>mysql2</em></a>模块，建立连接并访问数据库，还可以创建数据库连接池。</p> 
<pre><code class="prism language-javascript">npm install mysql2
</code></pre> 
<h4><a id="_181"></a>测试安装</h4> 
<p><em>测试代码</em></p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> mysql <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mysql2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> connection <span class="token operator">=</span> mysql<span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token string">'root'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token string">'123456'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token string">'3306'</span><span class="token punctuation">,</span>                   
    <span class="token literal-property property">database</span><span class="token operator">:</span> <span class="token string">'test'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

connection<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span>  sql <span class="token operator">=</span> <span class="token string">'SELECT * FROM material'</span><span class="token punctuation">;</span>
connection<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'[SELECT ERROR] - '</span><span class="token punctuation">,</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

connection<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>控制台输入 <code>node .\electron\connection.js</code><br> <img src="https://images2.imgbox.com/c9/81/HxRDh4FI_o.png" alt="控制台输出"><br> 接着将connection引入到electron中即可完成增删改查操作。</p> 
<h2><a id="IPC_212"></a>利用IPC模块完成数据交互</h2> 
<p>现在通过electron可以访问数据库数据，可以通过electron的<a href="https://www.electronjs.org/zh/docs/latest/tutorial/ipc" rel="nofollow"><em>IPC(进程间通信)</em></a>模块完成数据交互和渲染。在react项目利用Elctron的ipcRenderer.invoke()函数从渲染器请求主进程数据，主进程通过ipcMain.handle()函数监听渲染器请求数据完成数据交互。这里访问数据库直接采用 <em>mysql2/promise</em> 模块。</p> 
<h4><a id="preloadjs_214"></a>创建预加载文件preload.js</h4> 
<p>为了安全起见，electron主进程不会直接暴露整个 ipcRenderer.invoke API。 确保尽可能限制渲染器对 Electron API 的访问。</p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> contextBridge<span class="token punctuation">,</span> ipcRenderer <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span>

contextBridge<span class="token punctuation">.</span><span class="token function">exposeInMainWorld</span><span class="token punctuation">(</span><span class="token string">'electronAPI'</span><span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span>
  <span class="token function-variable function">findAll</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ipcRenderer<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token string">'findAll'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="mainjs_224"></a>修改main.js</h4> 
<p>main.js中指定预加载文件路径</p> 
<pre><code class="prism language-javascript">win  <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BrowserWindow</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">width</span><span class="token operator">:</span><span class="token number">800</span><span class="token punctuation">,</span>
        <span class="token literal-property property">height</span><span class="token operator">:</span><span class="token number">600</span><span class="token punctuation">,</span>
        <span class="token comment">//指定预加载文件的路径</span>
        <span class="token literal-property property">webPreferences</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">preload</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'preload.js'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>main.js中添加ipcMain.handle()监听事件</p> 
<pre><code class="prism language-javascript">ipcMain<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span><span class="token string">'findAll'</span><span class="token punctuation">,</span> <span class="token keyword">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">var</span> sql <span class="token operator">=</span> <span class="token string">'SELECT * FROM material'</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> <span class="token punctuation">[</span>rows<span class="token punctuation">,</span>fields<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> rows<span class="token punctuation">;</span>
    
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="reactelectron_API_247"></a>react代码中调用electron API</h4> 
<pre><code class="prism language-javascript"><span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>result<span class="token punctuation">,</span>setResult<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token keyword">await</span> window<span class="token punctuation">.</span>electronAPI<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
      <span class="token function">setResult</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"App"</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>header className<span class="token operator">=</span><span class="token string">"App-header"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>logo<span class="token punctuation">}</span> className<span class="token operator">=</span><span class="token string">"App-logo"</span> alt<span class="token operator">=</span><span class="token string">"logo"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>handleClick<span class="token punctuation">}</span><span class="token operator">&gt;</span>发送请求<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>textarea value<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>result<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>a
          className<span class="token operator">=</span><span class="token string">"App-link"</span>
          href<span class="token operator">=</span><span class="token string">"https://reactjs.org"</span>
          target<span class="token operator">=</span><span class="token string">"_blank"</span>
          rel<span class="token operator">=</span><span class="token string">"noopener noreferrer"</span>
        <span class="token operator">&gt;</span>
          Learn React
        <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>header<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>运行效果<br> <img src="https://images2.imgbox.com/f0/7b/ZzeBlf21_o.png" alt="运行效果"></p> 
<p><a href="https://github.com/KeJi0/electron-react-ipc-app"><em>完整源码</em></a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9b7632b133a0f6d7e5a3e0f2b2bd956b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">jmeter《关于时间戳 日期调用》</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2a73ddd0a4a6f83df7dc4eaa811562b0/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">详解KEIL的分散加载文件</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>