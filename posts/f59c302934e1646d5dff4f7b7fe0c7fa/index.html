<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【数据库运维】MYSQL备份恢复管理（上） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【数据库运维】MYSQL备份恢复管理（上）" />
<meta property="og:description" content="目录
MYSQL备份恢复管理
一，备份类型
二，逻辑备份优缺点
三，MySQL备份内容 四，MySQL备份工具
五，MySQL备份策略
1，策略一：直接拷贝数据库文件
案例：直接拷贝备份数据库company
2，策略二：mysqldump备份数据库
案例一：备份恢复单个数据库
案例二：备份单个表
案例三：备份数据库的结构
案例四：mysqldump&#43;binlog 完全&#43;增量备份恢复
六，binlog日志的GTID新特性
1，什么是GTID
2，GTID的格式与存储
3，版本支持
4，如何开启
5， DDL和DML语句查看gtid
6，基于GTID进行查看binlog
案例：演示跨binlog文件截取日志。
MYSQL备份恢复管理 一，备份类型 热备份、温备份、冷备份 （根据服务器状态）
热备份：读、写不受影响；
温备份：仅可以执行读操作；
冷备份：离线备份；读、写操作均中止；
物理备份与逻辑备份 （从对象来分）
物理备份：复制数据文件；
逻辑备份：将数据导出至文本文件中；
完全备份、增量备份、差异备份 （从数据收集来分）
完全备份：备份全部数据；
备份速度慢，恢复快
增量备份：仅备份上次完全备份或增量备份以后变化的数据；
备份速度快，恢复慢；
差异备份：仅备份上次完全备份以来变化的数据；
备份速度慢，恢复快；
二，逻辑备份优缺点 （1）逻辑备份的优点：
在备份速度上两种备份要取决于不同的存储引擎
物理备份的还原速度非常快。但是物理备份的最小力度只能做到表
逻辑备份保存的结构通常都是纯ASCII的，所以我们可以使用文本处理工具来处理
逻辑备份有非常强的兼容性，而物理备份则对版本要求非常高
逻辑备份也对保持数据的安全性有保证
（2）逻辑备份的缺点：
逻辑备份要对RDBMS产生额外的压力，而裸备份无压力
逻辑备份的结果可能要比源文件更大。所以很多人都对备份的内容进行压缩
逻辑备份可能会丢失浮点数的精度信息
三，MySQL备份内容 数据文件
日志文件（比如事务日志，二进制日志）
存储过程，存储函数，触发器
配置文件（十分重要，各个配置文件都要备份）
用于实现数据库备份的脚本，数据库自身清理的Crontab等……
四，MySQL备份工具 Mysql自带的备份工具
mysqldump 逻辑备份工具，支持所有引擎，MyISAM引擎是温备，InnoDB引擎是热备，备份速度中速，还原速度非常非常慢，但是在实现还原的时候，具有很大的操作余地。具有很好的弹性。
mysqlhotcopy 物理备份工具，但只支持MyISAM引擎，基本上属于冷备的范畴，物理备份，速度比较快。
文件系统备份工具
cp 冷备份，支持所有引擎，复制命令，只能实现冷备，物理备份。使用归档工具，cp命令，对其进行备份的，备份速度快，还原速度几乎最快，但是灵活度很低，可以跨系统，但是跨平台能力很差。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/f59c302934e1646d5dff4f7b7fe0c7fa/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-05T20:00:00+08:00" />
<meta property="article:modified_time" content="2023-04-05T20:00:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【数据库运维】MYSQL备份恢复管理（上）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="-toc" style="margin-left:0px;"></p> 
<p id="MYSQL%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E7%AE%A1%E7%90%86-toc" style="margin-left:0px;"><a href="#MYSQL%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E7%AE%A1%E7%90%86" rel="nofollow">MYSQL备份恢复管理</a></p> 
<p id="%E4%B8%80%EF%BC%8CMySQL%E5%A4%87%E4%BB%BD-toc" style="margin-left:40px;"><a href="#%E4%B8%80%EF%BC%8CMySQL%E5%A4%87%E4%BB%BD" rel="nofollow">一，备份类型</a></p> 
<p id="2%EF%BC%8C%E9%80%BB%E8%BE%91%E5%A4%87%E4%BB%BD%E4%BC%98%E7%BC%BA%E7%82%B9-toc" style="margin-left:40px;"><a href="#2%EF%BC%8C%E9%80%BB%E8%BE%91%E5%A4%87%E4%BB%BD%E4%BC%98%E7%BC%BA%E7%82%B9" rel="nofollow">二，逻辑备份优缺点</a></p> 
<p id="3%EF%BC%8CMySQL%E5%A4%87%E4%BB%BD%E5%86%85%E5%AE%B9%C2%A0%C2%A0%C2%A0%C2%A0-toc" style="margin-left:40px;"><a href="#3%EF%BC%8CMySQL%E5%A4%87%E4%BB%BD%E5%86%85%E5%AE%B9%C2%A0%C2%A0%C2%A0%C2%A0" rel="nofollow">三，MySQL备份内容    </a></p> 
<p id="4%EF%BC%8CMySQL%E5%A4%87%E4%BB%BD%E5%B7%A5%E5%85%B7-toc" style="margin-left:40px;"><a href="#4%EF%BC%8CMySQL%E5%A4%87%E4%BB%BD%E5%B7%A5%E5%85%B7" rel="nofollow">四，MySQL备份工具</a></p> 
<p id="5%EF%BC%8CMySQL%E5%A4%87%E4%BB%BD%E7%AD%96%E7%95%A5-toc" style="margin-left:40px;"><a href="#5%EF%BC%8CMySQL%E5%A4%87%E4%BB%BD%E7%AD%96%E7%95%A5" rel="nofollow">五，MySQL备份策略</a></p> 
<p id="%EF%BC%881%EF%BC%89%E7%AD%96%E7%95%A5%E4%B8%80%EF%BC%9A%E7%9B%B4%E6%8E%A5%E6%8B%B7%E8%B4%9D%E6%95%B0%E6%8D%AE%E5%BA%93%E6%96%87%E4%BB%B6-toc" style="margin-left:40px;"><a href="#%EF%BC%881%EF%BC%89%E7%AD%96%E7%95%A5%E4%B8%80%EF%BC%9A%E7%9B%B4%E6%8E%A5%E6%8B%B7%E8%B4%9D%E6%95%B0%E6%8D%AE%E5%BA%93%E6%96%87%E4%BB%B6" rel="nofollow">1，策略一：直接拷贝数据库文件</a></p> 
<p id="%E6%A1%88%E4%BE%8B%EF%BC%9A%E7%9B%B4%E6%8E%A5%E6%8B%B7%E8%B4%9D%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE%E5%BA%93company-toc" style="margin-left:80px;"><a href="#%E6%A1%88%E4%BE%8B%EF%BC%9A%E7%9B%B4%E6%8E%A5%E6%8B%B7%E8%B4%9D%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE%E5%BA%93company" rel="nofollow">案例：直接拷贝备份数据库company</a></p> 
<p id="%EF%BC%882%EF%BC%89%E7%AD%96%E7%95%A5%E4%BA%8C%EF%BC%9Amysqldump%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE%E5%BA%93-toc" style="margin-left:40px;"><a href="#%EF%BC%882%EF%BC%89%E7%AD%96%E7%95%A5%E4%BA%8C%EF%BC%9Amysqldump%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE%E5%BA%93" rel="nofollow">2，策略二：mysqldump备份数据库</a></p> 
<p id="%E6%A1%88%E4%BE%8B%E4%B8%80%EF%BC%9A%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E5%8D%95%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%BA%93-toc" style="margin-left:80px;"><a href="#%E6%A1%88%E4%BE%8B%E4%B8%80%EF%BC%9A%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E5%8D%95%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%BA%93" rel="nofollow">案例一：备份恢复单个数据库</a></p> 
<p id="%E6%A1%88%E4%BE%8B%E4%BA%8C%EF%BC%9A%E5%A4%87%E4%BB%BD%E5%8D%95%E4%B8%AA%E8%A1%A8-toc" style="margin-left:80px;"><a href="#%E6%A1%88%E4%BE%8B%E4%BA%8C%EF%BC%9A%E5%A4%87%E4%BB%BD%E5%8D%95%E4%B8%AA%E8%A1%A8" rel="nofollow">案例二：备份单个表</a></p> 
<p id="%E6%A1%88%E4%BE%8B%E4%B8%89%EF%BC%9A%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E7%BB%93%E6%9E%84-toc" style="margin-left:80px;"><a href="#%E6%A1%88%E4%BE%8B%E4%B8%89%EF%BC%9A%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E7%BB%93%E6%9E%84" rel="nofollow">案例三：备份数据库的结构</a></p> 
<p id="%E6%A1%88%E4%BE%8B%E5%9B%9B%EF%BC%9Amysqldump%2Bbinlog%C2%A0%C2%A0%20%E5%AE%8C%E5%85%A8%2B%E5%A2%9E%E9%87%8F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D-toc" style="margin-left:80px;"><a href="#%E6%A1%88%E4%BE%8B%E5%9B%9B%EF%BC%9Amysqldump%2Bbinlog%C2%A0%C2%A0%20%E5%AE%8C%E5%85%A8%2B%E5%A2%9E%E9%87%8F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D" rel="nofollow">案例四：mysqldump+binlog   完全+增量备份恢复</a></p> 
<p id="binlog%E6%97%A5%E5%BF%97%E7%9A%84GTID%E6%96%B0%E7%89%B9%E6%80%A7-toc" style="margin-left:40px;"><a href="#binlog%E6%97%A5%E5%BF%97%E7%9A%84GTID%E6%96%B0%E7%89%B9%E6%80%A7" rel="nofollow">六，binlog日志的GTID新特性</a></p> 
<p id="1%EF%BC%8C%E4%BB%80%E4%B9%88%E6%98%AFGTID-toc" style="margin-left:80px;"><a href="#1%EF%BC%8C%E4%BB%80%E4%B9%88%E6%98%AFGTID" rel="nofollow">1，什么是GTID</a></p> 
<p id="2%EF%BC%8C%20GTID%E7%9A%84%E6%A0%BC%E5%BC%8F%E4%B8%8E%E5%AD%98%E5%82%A8-toc" style="margin-left:80px;"><a href="#2%EF%BC%8C%20GTID%E7%9A%84%E6%A0%BC%E5%BC%8F%E4%B8%8E%E5%AD%98%E5%82%A8" rel="nofollow">2，GTID的格式与存储</a></p> 
<p id="3%EF%BC%8C%E7%89%88%E6%9C%AC%E6%94%AF%E6%8C%81-toc" style="margin-left:80px;"><a href="#3%EF%BC%8C%E7%89%88%E6%9C%AC%E6%94%AF%E6%8C%81" rel="nofollow">3，版本支持</a></p> 
<p id="4%EF%BC%8C%E5%A6%82%E4%BD%95%E5%BC%80%E5%90%AF-toc" style="margin-left:80px;"><a href="#4%EF%BC%8C%E5%A6%82%E4%BD%95%E5%BC%80%E5%90%AF" rel="nofollow">4，如何开启</a></p> 
<p id="5%EF%BC%8C%20DDL%E5%92%8CDML%E8%AF%AD%E5%8F%A5%E6%9F%A5%E7%9C%8Bgtid-toc" style="margin-left:80px;"><a href="#5%EF%BC%8C%20DDL%E5%92%8CDML%E8%AF%AD%E5%8F%A5%E6%9F%A5%E7%9C%8Bgtid" rel="nofollow">5， DDL和DML语句查看gtid</a></p> 
<p id="6%EF%BC%8C%E5%9F%BA%E4%BA%8EGTID%E8%BF%9B%E8%A1%8C%E6%9F%A5%E7%9C%8Bbinlog-toc" style="margin-left:80px;"><a href="#6%EF%BC%8C%E5%9F%BA%E4%BA%8EGTID%E8%BF%9B%E8%A1%8C%E6%9F%A5%E7%9C%8Bbinlog" rel="nofollow">6，基于GTID进行查看binlog</a></p> 
<p id="%E6%A1%88%E4%BE%8B%EF%BC%9A%E6%BC%94%E7%A4%BA%E8%B7%A8binlog%E6%96%87%E4%BB%B6%E6%88%AA%E5%8F%96%E6%97%A5%E5%BF%97%E3%80%82-toc" style="margin-left:80px;"><a href="#%E6%A1%88%E4%BE%8B%EF%BC%9A%E6%BC%94%E7%A4%BA%E8%B7%A8binlog%E6%96%87%E4%BB%B6%E6%88%AA%E5%8F%96%E6%97%A5%E5%BF%97%E3%80%82" rel="nofollow">案例：演示跨binlog文件截取日志。</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2 id="MYSQL%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E7%AE%A1%E7%90%86" style="margin-left:0;"><span style="color:#0d0016;">MYSQL备份恢复管理</span></h2> 
<h3 id="%E4%B8%80%EF%BC%8CMySQL%E5%A4%87%E4%BB%BD" style="margin-left:0px;"><span style="color:#0d0016;">一，备份类型</span></h3> 
<p style="margin-left:0;">热备份、温备份、冷备份 （根据服务器状态）</p> 
<p style="margin-left:0;">热备份：读、写不受影响；</p> 
<p style="margin-left:0;">温备份：仅可以执行读操作；</p> 
<p style="margin-left:0;">冷备份：离线备份；读、写操作均中止；</p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">物理备份与逻辑备份 （从对象来分）</p> 
<p style="margin-left:0;">物理备份：复制数据文件；</p> 
<p style="margin-left:0;">逻辑备份：将数据导出至文本文件中；</p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">完全备份、增量备份、差异备份 （从数据收集来分）</p> 
<p style="margin-left:0;">完全备份：备份全部数据；</p> 
<p style="margin-left:0;">                  备份速度慢，恢复快</p> 
<p style="margin-left:0;">增量备份：仅备份上次完全备份或增量备份以后变化的数据；</p> 
<p style="margin-left:0;">                  备份速度快，恢复慢；</p> 
<p style="margin-left:0;">差异备份：仅备份上次完全备份以来变化的数据；</p> 
<p style="margin-left:0;">                  备份速度慢，恢复快；</p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<h3 id="2%EF%BC%8C%E9%80%BB%E8%BE%91%E5%A4%87%E4%BB%BD%E4%BC%98%E7%BC%BA%E7%82%B9" style="margin-left:0px;"><span style="color:#0d0016;">二，逻辑备份优缺点</span></h3> 
<p style="margin-left:0;">（1）逻辑备份的优点：</p> 
<p style="margin-left:0;">在备份速度上两种备份要取决于不同的存储引擎</p> 
<p style="margin-left:0;">物理备份的还原速度非常快。但是物理备份的最小力度只能做到表</p> 
<p style="margin-left:0;">逻辑备份保存的结构通常都是纯ASCII的，所以我们可以使用文本处理工具来处理</p> 
<p style="margin-left:0;">逻辑备份有非常强的兼容性，而物理备份则对版本要求非常高</p> 
<p style="margin-left:0;">逻辑备份也对保持数据的安全性有保证</p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">（2）逻辑备份的缺点：</p> 
<p style="margin-left:0;">  逻辑备份要对RDBMS产生额外的压力，而裸备份无压力</p> 
<p style="margin-left:0;">  逻辑备份的结果可能要比源文件更大。所以很多人都对备份的内容进行压缩</p> 
<p style="margin-left:0;">  逻辑备份可能会丢失浮点数的精度信息</p> 
<p style="margin-left:0;"></p> 
<h4 style="margin-left:0;"></h4> 
<h3 id="3%EF%BC%8CMySQL%E5%A4%87%E4%BB%BD%E5%86%85%E5%AE%B9%C2%A0%C2%A0%C2%A0%C2%A0" style="margin-left:0px;"><span style="color:#0d0016;">三，MySQL备份内容   </span><span style="color:#5b9bd5;">  </span></h3> 
<p style="margin-left:0;"><strong>数据文件</strong></p> 
<p style="margin-left:0;">日志文件（比如事务日志，二进制日志）</p> 
<p style="margin-left:0;">存储过程，存储函数，触发器</p> 
<p style="margin-left:0;">配置文件（十分重要，各个配置文件都要备份）</p> 
<p style="margin-left:0;">用于实现数据库备份的脚本，数据库自身清理的Crontab等……</p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<h3 id="4%EF%BC%8CMySQL%E5%A4%87%E4%BB%BD%E5%B7%A5%E5%85%B7" style="margin-left:0px;"><span style="color:#0d0016;">四，MySQL备份工具</span></h3> 
<p style="margin-left:0;"><strong>Mysql</strong><strong>自带的备份工具</strong></p> 
<p style="margin-left:0;">mysqldump 逻辑备份工具，支持所有引擎，MyISAM引擎是温备，InnoDB引擎是热备，备份速度中速，还原速度非常非常慢，但是在实现还原的时候，具有很大的操作余地。具有很好的弹性。</p> 
<p style="margin-left:0;">mysqlhotcopy 物理备份工具，但只支持MyISAM引擎，基本上属于冷备的范畴，物理备份，速度比较快。</p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"><strong>文件系统备份工具</strong></p> 
<p style="margin-left:0;">cp 冷备份，支持所有引擎，复制命令，只能实现冷备，物理备份。使用归档工具，cp命令，对其进行备份的，备份速度快，还原速度几乎最快，但是灵活度很低，可以跨系统，但是跨平台能力很差。</p> 
<p style="margin-left:0;">lvm 几乎是热备份，支持所有引擎，基于快照(LVM，ZFS)的物理备份，速度非常快，几乎是热备。只影响数据几秒钟而已。但是创建快照的过程本身就影响到了数据库在线的使用，所以备份速度比较快，恢复速度比较快，没有什么弹性空间，而且LVM的限制：不能对多个逻辑卷同一时间进行备份，所以数据文件和事务日志等各种文件必须放在同一个LVM上。而ZFS则非常好的可以在多逻辑卷之间备份。</p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"><strong>其它工具</strong></p> 
<p style="margin-left:0;">ibbackup 商业工具 MyISAM是温备份，InnoDB是热备份 ，备份和还原速度都很快，这个软件它的每服务器授权版本是5000美元。</p> 
<p style="margin-left:0;">xtrabackup 开源工具 MyISAM是温备份，InnoDB是热备份 ，是ibbackup商业工具的替代工具。</p> 
<p style="margin-left:0;">mysqlbackup ORACLE公司也提供了针对企业的备份软件MySQL Enterprise Backup简称：mysqlbackup。</p> 
<p style="margin-left:0;">MySQL企业备份工具执行在线“热备“，无阻塞的MySQL数据库备份。全备份可以在所有InnoDB数据库上执行，而无需中断MySQL查询或更新。此外，支持增量备份，只备份自上次备份后有变化的数据。另外部分备份，支持特定的表或表空间按需要进行备份。</p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<h3 id="5%EF%BC%8CMySQL%E5%A4%87%E4%BB%BD%E7%AD%96%E7%95%A5" style="margin-left:0px;"><span style="color:#0d0016;">五，MySQL备份策略</span></h3> 
<h4 style="margin-left:0px;"></h4> 
<h3 id="%EF%BC%881%EF%BC%89%E7%AD%96%E7%95%A5%E4%B8%80%EF%BC%9A%E7%9B%B4%E6%8E%A5%E6%8B%B7%E8%B4%9D%E6%95%B0%E6%8D%AE%E5%BA%93%E6%96%87%E4%BB%B6" style="margin-left:0px;"><strong>1，策略一：直接拷贝数据库文件</strong></h3> 
<p style="margin-left:0;">直接拷贝数据库文件（文件系统备份工具 cp）（适合小型数据库，是最可靠的）</p> 
<p style="margin-left:0;">当你使用直接备份方法时，必须保证表不在被使用。如果服务器在你正在拷贝一个表时改变它，拷贝就失去意义。保证你的拷贝完整性的最好方法是关闭服务器，拷贝文件，然后重启服务器。</p> 
<p style="margin-left:0;">当你完成了备份时，需要重启服务器(如果关闭了它)或释放加在表上的锁定(如果你让服务器运行)。要用直接拷贝文件把一个数据库从一台机器拷贝到另一台机器上，只是将文件拷贝到另一台服务器主机的适当数据目录下即可。</p> 
<p style="margin-left:0;">要确保文件是MyIASM格式或两台机器有相同的硬件结构，否则你的数据库在另一台主机上有奇怪的内容。</p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"><strong>准备工作</strong></p> 
<p style="margin-left:0;">（1）在配置文件/etc/my.cnf中的[mysqld]下添加命令，使其支持中文</p> 
<blockquote> 
 <p style="margin-left:0;">character-set-server=utf8</p> 
</blockquote> 
<p style="margin-left:0;"><img alt="" height="64" src="https://images2.imgbox.com/f3/2e/LkbhpK0R_o.png" width="555"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">（2）重启服务</p> 
<pre><code>[root@node1 data]# systemctl restart mysqld</code></pre> 
<p style="margin-left:0;"><img alt="" height="79" src="https://images2.imgbox.com/94/e4/PL90KKU2_o.png" width="929"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">（3）查看配置后的结果</p> 
<pre><code>mysql&gt; show variables like '%char%';</code></pre> 
<p style="margin-left:0;"><img alt="" height="528" src="https://images2.imgbox.com/69/1e/hiXsmTC2_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">（4）创建数据库company；并使用</p> 
<pre><code>mysql&gt; create database company;
mysql&gt; use company;</code></pre> 
<p style="margin-left:0;"><img alt="" height="205" src="https://images2.imgbox.com/0b/40/cLSdQJaL_o.png" width="728"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">（5）在数据库下建表emp</p> 
<pre><code>mysql&gt; CREATE TABLE `emp`  (
       `empno` int(4) NOT NULL,
       `ename` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,
       `job` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,
       `mgr` int(4) NULL DEFAULT NULL,
       `hiredate` date NOT NULL,
       `sai` int(255) NOT NULL,
       `comm` int(255) NULL DEFAULT NULL,
       `deptno` int(2) NOT NULL,
       PRIMARY KEY (`empno`) USING BTREE
     ) ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Dynamic;</code></pre> 
<p style="margin-left:0;"><img alt="" height="459" src="https://images2.imgbox.com/b2/be/CkVMFrDQ_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">（6）向表emp中插入数据</p> 
<pre><code>INSERT INTO `emp` VALUES (1001, '甘宁', '文员', 1013, '2000-12-17', 8000, NULL, 20);
INSERT INTO `emp` VALUES (1002, '黛绮丝', '销售员', 1006, '2001-02-20', 16000, 3000, 30);
INSERT INTO `emp` VALUES (1003, '殷天正', '销售员', 1006, '2001-02-22', 12500, 5000, 30);
INSERT INTO `emp` VALUES (1004, '刘备', '经理', 1009, '2001-04-02', 29750, NULL, 20);
INSERT INTO `emp` VALUES (1005, '谢逊', '销售员', 1006, '2001-09-28', 12500, 14000, 30);
INSERT INTO `emp` VALUES (1006, '关羽', '经理', 1009, '2001-05-01', 28500, NULL, 30);
INSERT INTO `emp` VALUES (1007, '张飞', '经理', 1009, '2001-09-01', 24500, NULL, 10);
INSERT INTO `emp` VALUES (1008, '诸葛亮', '分析师', 1004, '2007-04-19', 30000, NULL, 20);
INSERT INTO `emp` VALUES (1009, '曾阿牛', '董事长', NULL, '2001-11-17', 50000, NULL, 10);
INSERT INTO `emp` VALUES (1010, '韦一笑', '销售员', 1006, '2001-09-08', 15000, 0, 30);
INSERT INTO `emp` VALUES (1011, '周泰', '文员', 1006, '2007-05-23', 11000, NULL, 20);
INSERT INTO `emp` VALUES (1012, '程普', '文员', 1006, '2001-12-03', 9500, NULL, 30);
INSERT INTO `emp` VALUES (1013, '庞统', '分析师', 1004, '2001-12-03', 30000, NULL, 20);
INSERT INTO `emp` VALUES (1014, '黄盖', '文员', 1007, '2002-01-23', 13000, NULL, 10);
INSERT INTO `emp` VALUES (1015, '张三', '保洁员', 1001, '2013-05-01', 80000, 50000, 50);</code></pre> 
<p style="margin-left:0;"><img alt="" height="1083" src="https://images2.imgbox.com/04/83/WVTGAwXt_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">（7）在数据库company中查看表emp的信息</p> 
<p style="margin-left:0;"><img alt="" height="901" src="https://images2.imgbox.com/5a/ec/jYu5Katc_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<h4 id="%E6%A1%88%E4%BE%8B%EF%BC%9A%E7%9B%B4%E6%8E%A5%E6%8B%B7%E8%B4%9D%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE%E5%BA%93company" style="margin-left:0px;"><strong>案例：直接拷贝备份数据库company</strong></h4> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">1、停止MySQL服务器。</p> 
<pre><code>[root@node1 data]# systemctl stop mysqld</code></pre> 
<p style="margin-left:0;"><img alt="" height="76" src="https://images2.imgbox.com/ae/ad/u8QlwaPz_o.png" width="763"></p> 
<p style="margin-left:0;">查看mysql是否停止</p> 
<pre><code>[root@node1 data]# systemctl status mysqld</code></pre> 
<p style="margin-left:0;"><img alt="" height="244" src="https://images2.imgbox.com/db/62/szrJr8GG_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">2、直接复制整个数据库目录。注意：使用这种方法最好还原到相同版本服务器中，不同版本可能不兼容。</p> 
<p style="margin-left:0;">（1）把当前所有的数据目录打包放在/tmp/database.tar.gz</p> 
<pre><code>[root@node1 data]# tar czf /tmp/database.tar.gz *</code></pre> 
<p style="margin-left:0;"><img alt="" height="77" src="https://images2.imgbox.com/25/50/xtd8813I_o.png" width="919"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">（2）可以查看包中的所有目录</p> 
<pre><code>[root@node1 data]# tar tf /tmp/database.tar.gz</code></pre> 
<p style="margin-left:0;"><img alt="" height="485" src="https://images2.imgbox.com/bd/ce/dO4IRzDL_o.png" width="1131"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">3、目标服务器上还原。</p> 
<p style="margin-left:0;">（1）使用scp命令将刚才的压缩文件拷贝到目标服务器上node2上的/tmp下面</p> 
<pre><code>[root@node1 data]# scp /tmp/database.tar.gz 192.168.206.142:/tmp</code></pre> 
<p style="margin-left:0;"><img alt="" height="143" src="https://images2.imgbox.com/75/7b/3wxnOA5K_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">（2）在node2主机上开启二进制日志并设置可读中文</p> 
<blockquote> 
 <p style="margin-left:0;">log_bin=mysql-bin</p> 
 <p style="margin-left:0;">server_id=2</p> 
 <p style="margin-left:0;">character-set-server=utf8</p> 
</blockquote> 
<p style="margin-left:0;"><img alt="" height="123" src="https://images2.imgbox.com/50/89/2CLmdcoc_o.png" width="807"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">（3）node2主机上重启服务mysqld</p> 
<pre><code>[root@node2 ~]# systemctl restart mysqld</code></pre> 
<p style="margin-left:0;"><img alt="" height="75" src="https://images2.imgbox.com/6b/fc/GFrIR0QE_o.png" width="824"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">（4）在node2主机上关闭mysqld服务</p> 
<pre><code>[root@node2 ~]# systemctl stop mysqld</code></pre> 
<p style="margin-left:0;"><img alt="" height="74" src="https://images2.imgbox.com/ee/c5/Fvmrwz7H_o.png" width="713"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">（5）在node2主机上删除/usr/local/mysql/data/ 目录下的所有文件</p> 
<pre><code>[root@node2 ~]# rm -rf /usr/local/mysql/data/*</code></pre> 
<p style="margin-left:0;"><img alt="" height="84" src="https://images2.imgbox.com/64/5e/RRLJ8nFG_o.png" width="821"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">（6）将从node1主机上拷贝过来的/tmp/database.tar.gz 解开到/usr/local/mysql/data/下面</p> 
<pre><code>[root@node2 ~]# tar xf /tmp/database.tar.gz -C /usr/local/mysql/data/</code></pre> 
<p style="margin-left:0;"><img alt="" height="71" src="https://images2.imgbox.com/d1/6a/2ZiQEGWM_o.png" width="1168"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">4、目标服务器数据库目录授权，重启服务器测试。</p> 
<p style="margin-left:0;">（如果重启失败，记得授权：chown -R mysql.mysql /usr/local/mysql/data/*）</p> 
<pre><code>[root@node2 ~]# systemctl restart mysqld</code></pre> 
<p style="margin-left:0;"><img alt="" height="84" src="https://images2.imgbox.com/4a/e2/Q4kYzSa7_o.png" width="798"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">5，此时可以登录数据库查看是否备份成功</p> 
<pre><code>[root@node2 ~]# mysql -uroot -p123456 -e 'select * from company.emp'</code></pre> 
<p style="margin-left:0;"><img alt="" height="719" src="https://images2.imgbox.com/42/d2/GKnp5LaD_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<h3 id="%EF%BC%882%EF%BC%89%E7%AD%96%E7%95%A5%E4%BA%8C%EF%BC%9Amysqldump%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE%E5%BA%93" style="margin-left:0px;"><strong>2，策略二：</strong><strong>mysqldump</strong><strong>备份数据库</strong></h3> 
<h4 id="%E6%A1%88%E4%BE%8B%E4%B8%80%EF%BC%9A%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E5%8D%95%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%BA%93" style="margin-left:0px;"><strong>案例一：备份恢复单个数据库</strong></h4> 
<blockquote> 
 <p style="margin-left:0;"><strong>语法</strong>：</p> 
 <p style="margin-left:0;"><strong>备份</strong>：mydqldump -u 用户 –p’密码’ –default-character-set=Iatin1 数据库名 [|gzip] &gt; 备份文件名</p> 
 <p style="margin-left:0;">注意：-B 作用：创建数据库和切换到数据库，恢复时不用创建数据库和删表。备份多个库，-B 数据库1 数据库2 ...</p> 
 <p style="margin-left:0;"><strong>恢复：</strong></p> 
 <p style="margin-left:0;">1）MySQL中用source命令</p> 
 <p style="margin-left:0;">2）mysql命令恢复</p> 
 <p style="margin-left:0;">-F      刷新日志</p> 
 <p style="margin-left:0;">-A      备份所有的数据库</p> 
 <p style="margin-left:0;">-B      备份数据库时包含创建数据库并切入到数据库中的语句</p> 
</blockquote> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"><strong>备份数据库</strong><strong>company</strong></p> 
<p style="margin-left:0;">（1）在node1主机上创建目录/back/db用于存放备份文件</p> 
<pre><code>[root@node1 data]# mkdir -p /backup/db</code></pre> 
<p style="margin-left:0;"><img alt="" height="82" src="https://images2.imgbox.com/db/3e/RVFNMdj7_o.png" width="815"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">（2）将node1主机上的数据库company备份到/backup/db/下面命名为company_1.sql</p> 
<pre><code>[root@node1 data]# mysqldump -uroot -p123456 company &gt; /backup/db/company_1.sql</code></pre> 
<p style="margin-left:0;"><img alt="" height="108" src="https://images2.imgbox.com/db/78/WilHnvW5_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">（3）加上B选项后再次备份到/backup/db/下面命名为company_2.sql</p> 
<pre><code>[root@node1 data]# mysqldump -uroot -p123456 -B company &gt; /backup/db/company_2.sql</code></pre> 
<p style="margin-left:0;"><img alt="" height="129" src="https://images2.imgbox.com/4e/cf/NgYYqdZM_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">（4）对比加上B选项后的作用；可以看出加上B选项后，多了创建数据库并使用数据库的命令</p> 
<pre><code>[root@node1 data]# diff /backup/db/company_2.sql /backup/db/company_1.sql</code></pre> 
<p style="margin-left:0;"><img alt="" height="638" src="https://images2.imgbox.com/9c/32/NqutDVhi_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"><strong>删除数据库company</strong></p> 
<pre><code>mysql8.0.30 [(none)]&gt;drop database company;</code></pre> 
<p style="margin-left:0;"><img alt="" height="592" src="https://images2.imgbox.com/70/28/wtAcagjI_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"><strong>恢复数据库company</strong></p> 
<p style="margin-left:0;">方法一：在数据库里面用source命令</p> 
<p style="margin-left:0;">（1）创建数据库company并使用</p> 
<pre><code>mysql8.0.30 [(none)]&gt;create database company;
mysql8.0.30 [(none)]&gt;use company;</code></pre> 
<p style="margin-left:0;"><img alt="" height="246" src="https://images2.imgbox.com/5e/00/00BRUeha_o.png" width="1095"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">（2）使用命令恢复数据库company</p> 
<pre><code>mysql8.0.30 [company]&gt;source /backup/db/company_1.sql</code></pre> 
<p style="margin-left:0;"><img alt="" height="333" src="https://images2.imgbox.com/6d/7c/CboDHzMQ_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">（3）查看恢复后的数据库中的数据</p> 
<pre><code>mysql8.0.30 [company]&gt;select * from company.emp;</code></pre> 
<p style="margin-left:0;"><img alt="" height="907" src="https://images2.imgbox.com/7c/a4/Ihy9yje0_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">方法二：使用mysql命令来恢复</p> 
<p style="margin-left:0;">（1）此时的company数据库已经被删除</p> 
<pre><code>mysql8.0.30 [company]&gt;drop database company;
mysql8.0.30 [(none)]&gt;show databases;</code></pre> 
<p style="margin-left:0;"><img alt="" height="591" src="https://images2.imgbox.com/ff/41/ImSwe3KU_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">（2）恢复数据库company_2.sql</p> 
<pre><code>[root@node1 data]# mysql -uroot -p123456 &lt; /backup/db/company_2.sql</code></pre> 
<p style="margin-left:0;"><img alt="" height="132" src="https://images2.imgbox.com/d7/02/oBptfoMR_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">（3）查看恢复后的数据库中的数据</p> 
<pre><code>mysql8.0.30 [(none)]&gt;select * from company.emp;</code></pre> 
<p style="margin-left:0;"><img alt="" height="898" src="https://images2.imgbox.com/81/fe/xZA2yj8w_o.png" width="1200"></p> 
<p style="margin-left:0;">注意：备份多个数据库用空格间隔开，备份所有数据库用-A选项</p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<h4 id="%E6%A1%88%E4%BE%8B%E4%BA%8C%EF%BC%9A%E5%A4%87%E4%BB%BD%E5%8D%95%E4%B8%AA%E8%A1%A8" style="margin-left:0px;"><strong>案例二：备份单个表</strong></h4> 
<blockquote> 
 <p style="margin-left:0;">语法：</p> 
 <p style="margin-left:0;">备份：mysqldump -u 用户名 -p 数据库名 表名 &gt; 备份的文件名</p> 
 <p style="margin-left:0;">示例：mysqldump -uroot -p school Books &gt; /tmp/Books.$(date +%F).sql</p> 
 <p style="margin-left:0;">备份多个表：mysqldump -u 用户名 -p 数据库名 表名1 表名2 &gt; 备份的文件名</p> 
</blockquote> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"><strong>备份company数据库中的表emp</strong></p> 
<p style="margin-left:0;">（1）把数据库company的emp表备份到/backup/db/下面命名为emp.sql</p> 
<pre><code>[root@node1 data]# mysqldump -uroot -p123456 company emp &gt; /backup/db/emp.sql</code></pre> 
<p style="margin-left:0;"><img alt="" height="134" src="https://images2.imgbox.com/33/5a/YKPwugBO_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">（2）在数据库company中删除表emp</p> 
<pre><code>mysql8.0.30 [company]&gt;drop table emp;
mysql8.0.30 [company]&gt;show tables;</code></pre> 
<p style="margin-left:0;"><img alt="" height="278" src="https://images2.imgbox.com/d2/bf/tETBrI4k_o.png" width="1036"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"><strong>恢复数据库中的表emp</strong></p> 
<pre><code>[root@node1 data]# mysql -uroot -p123456 company &lt;  /backup/db/emp.sql</code></pre> 
<p style="margin-left:0;"><img alt="" height="132" src="https://images2.imgbox.com/a7/a0/YZhPGIb5_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">此时在数据库company中查看表tables，发现信息已经被恢复</p> 
<pre><code>mysql8.0.30 [company]&gt;show tables;
mysql8.0.30 [company]&gt;select * from emp;</code></pre> 
<p style="margin-left:0;"><img alt="" height="1200" src="https://images2.imgbox.com/3a/12/9ZCZwub8_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<h4 id="%E6%A1%88%E4%BE%8B%E4%B8%89%EF%BC%9A%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E7%BB%93%E6%9E%84" style="margin-left:0px;"><strong>案例三：备份数据库的结构</strong></h4> 
<blockquote> 
 <p style="margin-left:0;">-d只备份库结构，不包含数据内容</p> 
 <p style="margin-left:0;">备份并压缩： 备份命令 | gzip &gt; 备份的路径文件.gz</p> 
</blockquote> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">（1）备份数据库company的结构</p> 
<pre><code>[root@node1 data]# mysqldump -uroot -p123456 -d company &gt; /backup/db/company_3.sql</code></pre> 
<p style="margin-left:0;"><img alt="" height="127" src="https://images2.imgbox.com/8b/b4/abqhsR2W_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">（2）查看备份文件/backup/db/company_3.sql的内容；发现只有创建表，并没有插入数据</p> 
<p style="margin-left:0;"><img alt="" height="564" src="https://images2.imgbox.com/7c/17/3fJvsrEN_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<h4 id="%E6%A1%88%E4%BE%8B%E5%9B%9B%EF%BC%9Amysqldump%2Bbinlog%C2%A0%C2%A0%20%E5%AE%8C%E5%85%A8%2B%E5%A2%9E%E9%87%8F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D" style="margin-left:0px;"><strong>案例四：</strong><strong>mysqldump+binlog   </strong><strong>完全</strong><strong>+</strong><strong>增量备份恢复</strong></h4> 
<blockquote> 
 <p style="margin-left:0;">前提：1）my.cnf，是要开启MySQL log-bin日志功能，重启MySQL log_bin</p> 
 <p style="margin-left:0;">                 =  /data/mysql/data/mysql-bin</p> 
 <p style="margin-left:0;">          2）存在一个完全备份，生产环境一般凌晨某个时刻进行全备</p> 
 <p style="margin-left:0;">示例：mysqldump -uroot -p --default-character-set=gbk --single-transaction -F -B school |gzip &gt; /server/backup/school_$(date +%F).sql.gz</p> 
 <p style="margin-left:0;"> InnoDB 表在备份时，通常启用选项 --single-transaction 来保证备份的一致性</p> 
</blockquote> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">MySQL增量恢复案例图解</p> 
<p style="margin-left:0;"><img alt="" height="648" src="https://images2.imgbox.com/82/50/WIofwqA5_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"><strong>1，数据库的准备工作</strong></p> 
<p style="margin-left:0;">（1）创建数据库it</p> 
<pre><code>mysql8.0.30 [company]&gt;create database it DEFAULT CHARACTER SET utf8;</code></pre> 
<p style="margin-left:0;"><img alt="" height="675" src="https://images2.imgbox.com/3d/87/CVWGqrDs_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">（2）在数据库it中创建表student</p> 
<pre><code>mysql8.0.30 [it]&gt;CREATE TABLE `Student` (
       `Sno` int(10) NOT NULL COMMENT '学号',  `Sname` varchar(16) NOT NULL COMMENT '姓 名',
       `Ssex` char(2) NOT NULL COMMENT '性别',  `Sage` tinyint(2) NOT NULL DEFAULT '0' COMMENT '学生年龄',
       `Sdept` varchar(16) DEFAULT 'NULL' COMMENT '学生所在系别',  PRIMARY KEY (`Sno`)
     ) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;</code></pre> 
<p style="margin-left:0;"><img alt="" height="481" src="https://images2.imgbox.com/9e/57/pUK5AYz0_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">（3）向表student中插入数据</p> 
<pre><code>mysql8.0.30 [it]&gt;INSERT INTO `Student` VALUES (1, '陆亚', '男', 24, '计算机网络'),(2, 'tom', '男', 26, '英语'),(3, '张阳', '男', 21, '物流管理'), (4, 'alex', '女', 22, '电子商务');</code></pre> 
<p style="margin-left:0;"><img alt="" height="272" src="https://images2.imgbox.com/a6/b7/7Wyx3vng_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">（4）查看表student中的详细信息</p> 
<pre><code>mysql8.0.30 [it]&gt;select * from Student;</code></pre> 
<p style="margin-left:0;"><img alt="" height="475" src="https://images2.imgbox.com/60/73/WvZ96F1r_o.png" width="1108"></p> 
<p></p> 
<p style="margin-left:0;"><strong>2，完全备份</strong></p> 
<p style="margin-left:0;">（1）完全备份此时的it数据库并压缩保存到/backup/db/it_`date +%F`.sql.gz中</p> 
<p style="margin-left:0;">--single-transaction   保持一致性</p> 
<pre><code>[root@node1 data]# mysqldump -uroot -p123456 -F -B it --single-transaction | gzip &gt; /backup/db/it_`date +%F`.sql.gz</code></pre> 
<p style="margin-left:0;"><img alt="" height="167" src="https://images2.imgbox.com/76/1d/MwrkNqXs_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">（2）备份文件如下所示：</p> 
<pre><code>[root@node1 data]# ll /backup/db/</code></pre> 
<p style="margin-left:0;"><img alt="" height="324" src="https://images2.imgbox.com/aa/b9/a1fn8BRL_o.png" width="1200"></p> 
<p></p> 
<p></p> 
<p style="margin-left:0;"><strong>3，等60秒后再次向表中插入数据</strong></p> 
<p>睡眠60秒 </p> 
<pre><code>[root@node1 data]# sleep 60</code></pre> 
<p style="margin-left:0;"><img alt="" height="90" src="https://images2.imgbox.com/06/fd/Gf4EtXQm_o.png" width="1039"></p> 
<p></p> 
<p>向表中插入两条数据 </p> 
<pre><code>mysql8.0.30 [it]&gt;INSERT INTO Student values(0005,'xumubin','男',29,'中文专业'),(0006,'wangzhao','男',21,'导弹专业');</code></pre> 
<p style="margin-left:0;"><img alt="" height="251" src="https://images2.imgbox.com/53/c0/RNJh4Liy_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">查看插入数据后的student表</p> 
<pre><code>mysql8.0.30 [it]&gt;select * from it.Student;</code></pre> 
<p style="margin-left:0;"><img alt="" height="557" src="https://images2.imgbox.com/1f/e0/VMfK3N1q_o.png" width="1060"></p> 
<p></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"><strong>4，模拟破坏数据库</strong></p> 
<pre><code>mysql8.0.30 [it]&gt;drop database it;</code></pre> 
<p style="margin-left:0;"><img alt="" height="179" src="https://images2.imgbox.com/31/c2/x5RLicJb_o.png" width="978"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">此时的数据库it已经被破坏</p> 
<pre><code>mysql8.0.30 [(none)]&gt;show databases;</code></pre> 
<p style="margin-left:0;"><img alt="" height="510" src="https://images2.imgbox.com/55/7c/i9psoL4i_o.png" width="1085"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"><strong>5，检查完全备份后面的所有binlog日志</strong></p> 
<pre><code>[root@node1 data]# ls -lrt /usr/local/mysql/data/mysql-bin.*</code></pre> 
<p style="margin-left:0;"><img alt="" height="359" src="https://images2.imgbox.com/dd/dc/w9u6frkg_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">立即刷新日志，保护现场</p> 
<pre><code>[root@node1 data]# mysqladmin -uroot -p flush-logs</code></pre> 
<p style="margin-left:0;"><img alt="" height="126" src="https://images2.imgbox.com/cc/45/BOYKzj88_o.png" width="1012"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">此时多出来一条8日志，我们要备份7日志</p> 
<pre><code>[root@node1 data]# ls -lrt /usr/local/mysql/data/mysql-bin.*</code></pre> 
<p style="margin-left:0;"><img alt="" height="408" src="https://images2.imgbox.com/2f/99/ajyiVty9_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"><strong>6，增量备份</strong></p> 
<p style="margin-left:0;">（1）将日志7保存到/backup/db下面</p> 
<pre><code>[root@node1 data]# cp /usr/local/mysql/data/mysql-bin.000007 /backup/db</code></pre> 
<p style="margin-left:0;"><img alt="" height="87" src="https://images2.imgbox.com/2a/9a/FryWOjCm_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">（2）恢复binlog生成sql语句</p> 
<pre><code>[root@node1 data]# mysqlbinlog  mysql-bin.000006 &gt; bin.sql</code></pre> 
<p style="margin-left:0;"><img alt="" height="82" src="https://images2.imgbox.com/5c/dc/uNrdZ4RA_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"><strong>7，恢复数据</strong></p> 
<p style="margin-left:0;">（1）恢复完全备份</p> 
<pre><code>[root@node1 db]# zcat it_2023-04-04.sql.gz | mysql -uroot -p123456</code></pre> 
<p style="margin-left:0;"><img alt="" height="125" src="https://images2.imgbox.com/3c/0c/Jzg9R1bh_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">此时的it数据库的student中完全备份的信息已经被恢复</p> 
<pre><code>mysql8.0.30 [(none)]&gt;show databases;
mysql8.0.30 [(none)]&gt;select * from it.Student;</code></pre> 
<p style="margin-left:0;"><img alt="" height="976" src="https://images2.imgbox.com/75/9c/pdby0iSN_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">（2）增量恢复：</p> 
<p style="margin-left:0;">查看binlog生成sql语句</p> 
<pre><code>[root@node1 db]# mysqlbinlog  --base64-output=DECODE-ROWS -vv mysql-bin.000007</code></pre> 
<p style="margin-left:0;"><img alt="" height="1200" src="https://images2.imgbox.com/b6/f4/nKEAdUII_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"><strong>方法一</strong>：基于时间恢复</p> 
<p style="margin-left:0;">按时间选取要恢复的sql语句并保存到文件time1.sql</p> 
<pre><code>[root@node1 db]# mysqlbinlog --start-datetime='2023-04-04 12:57:34' mysql-bin.000007 --stop-datetime='2023-04-04 12:58:26' -r time1.sql</code></pre> 
<p style="margin-left:0;"><img alt="" height="128" src="https://images2.imgbox.com/5e/66/Bk7nUqV9_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">恢复增量备份的文件</p> 
<pre><code>[root@node1 db]# mysql -uroot -p123456 &lt; time1.sql</code></pre> 
<p style="margin-left:0;"><img alt="" height="128" src="https://images2.imgbox.com/be/21/8MP5FTJV_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">查看恢复后的数据库的student表的信息</p> 
<pre><code>mysql8.0.30 [(none)]&gt;select * from it.Student;</code></pre> 
<p style="margin-left:0;"><img alt="" height="560" src="https://images2.imgbox.com/d4/02/11zyvFzT_o.png" width="1138"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"><strong>方法二</strong>：基于位置恢复</p> 
<p style="margin-left:0;">按时间选取要恢复的sql语句并保存到文件pos1.sql</p> 
<pre><code>[root@node1 db]# mysqlbinlog --start-position=347 --stop-position=476 mysql-bin.000007 -r pos1.sql</code></pre> 
<p style="margin-left:0;"><img alt="" height="133" src="https://images2.imgbox.com/7a/97/D2RD6206_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">恢复增量备份的文件</p> 
<pre><code>[root@node1 db]# mysql -uroot -p123456 &lt; pos1.sql</code></pre> 
<p style="margin-left:0;"><img alt="" height="121" src="https://images2.imgbox.com/0a/6e/wRfT5nHz_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">查看恢复后的数据库的student表的信息</p> 
<pre><code>mysql8.0.30 [(none)]&gt;select * from it.Student;</code></pre> 
<p style="margin-left:0;"><img alt="" height="560" src="https://images2.imgbox.com/b0/b4/WG2yzLIk_o.png" width="1138"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">高级备份参数：</p> 
<p style="margin-left:0;">-R                备份存储过程及函数</p> 
<p style="margin-left:0;">--triggers   备份触发器</p> 
<p style="margin-left:0;">-E                备份事件</p> 
<p style="margin-left:0;">-F                备份开始时间，刷新一个binlog日志</p> 
<p style="margin-left:0;">--master-data=2    以注释的形式，保存备份开始时间及binlog的状态信息</p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">gtid默认没有开启，如果开启，下一个编号默认增加</p> 
<p style="margin-left:0;">mysql8.0.30 [it]&gt;show variables like '%gtid%';</p> 
<p style="margin-left:0;"><img alt="" height="632" src="https://images2.imgbox.com/1e/7c/v5nzJPky_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<h3 id="binlog%E6%97%A5%E5%BF%97%E7%9A%84GTID%E6%96%B0%E7%89%B9%E6%80%A7" style="margin-left:0px;"><span style="color:#0d0016;">六，binlog日志的GTID新特性 </span></h3> 
<h4 id="%E4%B8%80%EF%BC%8C%20GTID%20%E4%BB%8B%E7%BB%8D" style="margin-left:0px;"></h4> 
<h4 id="1%EF%BC%8C%E4%BB%80%E4%B9%88%E6%98%AFGTID" style="margin-left:0px;"><span style="color:#0d0016;"><strong>1，什么是GTID </strong></span></h4> 
<p style="margin-left:0;">GTID(Global Transaction ID)，全局事务标识符。是对于一个已提交事务的编号，并且是一个全局唯一的编号。</p> 
<p style="margin-left:0;">它是MySQL 5.6加入的一个强大特性，目的在于能够实现主从自动定位和切换，而不像以前需要指定文件和位置。</p> 
<h4 style="margin-left:0;"></h4> 
<h4 id="2%EF%BC%8C%20GTID%E7%9A%84%E6%A0%BC%E5%BC%8F%E4%B8%8E%E5%AD%98%E5%82%A8" style="margin-left:0;"><span style="color:#0d0016;">2， GTID的格式与存储 </span></h4> 
<p style="margin-left:0;">（1）单个GTID</p> 
<p style="margin-left:0;">GTID与主库上提交的每个事务相关联。此标识符不仅对发起事务的库是唯一的，而且在给定复制拓扑中的所有库中都是唯一的。GTID用冒号分隔的一对坐标表示，</p> 
<p style="margin-left:0;">例如：8eed0f5b-6f9b-11e9-94a9-005056a57a4e:23</p> 
<p style="margin-left:0;">前一部分是主库的server_uuid，后面一部分是主库上按提交事务的顺序确定的序列号，提交的事务序号从1开始。</p> 
<p style="margin-left:0;">GTID = server_uuid ：transaction_id</p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">（2）GTID集</p> 
<p style="margin-left:0;">GTID集是包括一个或多个单个GTID或GTID范围的集合。源自同一服务器的一系列GTID可以折叠为单个表达式，</p> 
<p style="margin-left:0;">例如：8eed0f5b-6f9b-11e9-94a9-005056a57a4e:1-321</p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">上面的示例表示源自server_uuid为8eed0f5b-6f9b-11e9-94a9-005056a57a4e服务器的第1到第</p> 
<p style="margin-left:0;">321个事务。源自同一服务器的多个单GTID或GTID范围可以同时包含在由冒号分隔的单个表达式中，</p> 
<p style="margin-left:0;">例如：8eed0f5b-6f9b-11e9-94a9-005056a57a4e:1-3:11:47-49</p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">（3）mysql.gtid_executed表</p> 
<p style="margin-left:0;">mysql.gtid_executed表结构如下：</p> 
<p style="margin-left:0;">mysql8.0.30 [(none)]&gt;desc mysql.gtid_executed;</p> 
<p style="margin-left:0;"><img alt="" height="440" src="https://images2.imgbox.com/5d/d5/sCFh9Er4_o.png" width="1200"></p> 
<p style="margin-left:0;">mysql.gtid_executed表记录的是服务器上已经执行事务的GTID。三个字段分别表示发起事务的服务器UUID、UUID集的起始和结束事务ID。对于单个GTID，后两个字段的值相同。</p> 
<p style="margin-left:0;"></p> 
<h4 id="3%EF%BC%8C%E7%89%88%E6%9C%AC%E6%94%AF%E6%8C%81" style="margin-left:0;"><span style="color:#0d0016;">3，版本支持 </span></h4> 
<p style="margin-left:0;">5.6 版本新加的特性,5.7中做了加强</p> 
<p style="margin-left:0;">5.6 中不开启,没有这个功能.</p> 
<p style="margin-left:0;">5.7 中的GTID,即使不开也会有自动生成</p> 
<p style="margin-left:0;"><img alt="" height="637" src="https://images2.imgbox.com/0f/03/rmA1aJxJ_o.png" width="1165"></p> 
<h4 style="margin-left:0;"></h4> 
<h4 style="margin-left:0;"></h4> 
<h4 style="margin-left:0;"></h4> 
<h4 style="margin-left:0;"></h4> 
<h4 id="4%EF%BC%8C%E5%A6%82%E4%BD%95%E5%BC%80%E5%90%AF" style="margin-left:0;"><span style="color:#0d0016;">4，如何开启 </span></h4> 
<p style="margin-left:0;">（1）编辑my.cnf文件</p> 
<pre><code>[root@node1 ~]# vim /etc/my.cnf</code></pre> 
<p style="margin-left:0;"><img alt="" height="88" src="https://images2.imgbox.com/5f/31/uMfT7LRK_o.png" width="903"></p> 
<p style="margin-left:0;"></p> 
<blockquote> 
 <p style="margin-left:0;">gtid-mode=on</p> 
 <p style="margin-left:0;">enforce-gtid-consistency=true</p> 
</blockquote> 
<p style="margin-left:0;"><img alt="" height="94" src="https://images2.imgbox.com/0e/1f/ougEJYrO_o.png" width="786"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">（2）重启mysqld服务</p> 
<pre><code>[root@node1 ~]# systemctl restart mysqld</code></pre> 
<p style="margin-left:0;"><img alt="" height="90" src="https://images2.imgbox.com/14/4c/l2qdeali_o.png" width="865"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">（3）此时查看gtid，发现已经开启</p> 
<pre><code>mysql8.0.30 [(none)]&gt;show variables like '%gtid%';</code></pre> 
<p style="margin-left:0;"><img alt="" height="636" src="https://images2.imgbox.com/5a/f6/l6Ig3Cqn_o.png" width="1120"></p> 
<p style="margin-left:0;"></p> 
<h4 style="margin-left:0;"></h4> 
<h4 style="margin-left:0;"></h4> 
<h4 style="margin-left:0;"></h4> 
<h4 id="5%EF%BC%8C%20DDL%E5%92%8CDML%E8%AF%AD%E5%8F%A5%E6%9F%A5%E7%9C%8Bgtid" style="margin-left:0;"><span style="color:#0d0016;">5， DDL和DML语句查看gtid </span></h4> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"><strong>DDL一个语句产生一个gtid </strong></p> 
<p style="margin-left:0;"><strong>创建数据库，创建表，插入数据都会产生一个</strong><strong>gtid</strong></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">（1）查看此时的gtid与日志文件编号</p> 
<pre><code>mysql8.0.30 [(none)]&gt;show master status;</code></pre> 
<p style="margin-left:0;"><img alt="" height="280" src="https://images2.imgbox.com/75/52/FpQlvUwM_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">（2）创建一个数据库t2</p> 
<pre><code>mysql8.0.30 [(none)]&gt;create database db2;</code></pre> 
<p style="margin-left:0;"><img alt="" height="130" src="https://images2.imgbox.com/26/74/s93vXiRz_o.png" width="794"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">（3）此时查看gtid，发现创建了一个数据库后多了一个gtid</p> 
<blockquote> 
 <p style="margin-left:0;">服务器的uuid为：7010c99b-c62f-11ed-a197-000c293aaeaf</p> 
 <p style="margin-left:0;">gtid的编号为： 1-4</p> 
</blockquote> 
<pre><code>mysql8.0.30 [(none)]&gt;show master status;</code></pre> 
<p style="margin-left:0;"><img alt="" height="273" src="https://images2.imgbox.com/50/16/tjItBWmi_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">（4）使用数据库db2，并不会产生新的gtid</p> 
<pre><code>mysql8.0.30 [(none)]&gt;use database db2;
mysql8.0.30 [db2]&gt;show master status;</code></pre> 
<p style="margin-left:0;"><img alt="" height="331" src="https://images2.imgbox.com/bd/65/I1RnYVdb_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">（5）在数据库db2中创建表t1，发现产生了新的gtid</p> 
<pre><code>mysql8.0.30 [db2]&gt;create table t1(id int);
mysql8.0.30 [db2]&gt;show master status;</code></pre> 
<p style="margin-left:0;"><img alt="" height="359" src="https://images2.imgbox.com/c4/cf/U6sxqXdb_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">（6）向表t1中插入数据1，发现产生了新的gtid</p> 
<pre><code>mysql8.0.30 [db2]&gt;insert into t1 values(1);
mysql8.0.30 [db2]&gt;show master status;</code></pre> 
<p style="margin-left:0;"><img alt="" height="361" src="https://images2.imgbox.com/54/d2/D9u2lsET_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"><strong>DML一个事务产生一个gtid </strong></p> 
<p style="margin-left:0;"><strong>一个事物产生一个</strong><strong>gtid</strong></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">把多个语句放入一个事物中，用begin开始，commit结束；一个事物产生一个gtid</p> 
<pre><code>mysql8.0.30 [db2]&gt;begin;
mysql8.0.30 [db2]&gt;insert into t1 values(2);
mysql8.0.30 [db2]&gt;insert into t1 values(3);
mysql8.0.30 [db2]&gt;insert into t1 values(4);
mysql8.0.30 [db2]&gt;commit;
mysql8.0.30 [db2]&gt;show master status;</code></pre> 
<p style="margin-left:0;"><img alt="" height="716" src="https://images2.imgbox.com/18/d0/H3DywPGb_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<h4 id="6%EF%BC%8C%E5%9F%BA%E4%BA%8EGTID%E8%BF%9B%E8%A1%8C%E6%9F%A5%E7%9C%8Bbinlog" style="margin-left:0;"><span style="color:#0d0016;">6，基于GTID进行查看binlog </span></h4> 
<p></p> 
<blockquote> 
 <p style="margin-left:0;">具备GTID后,截取查看某些事务日志:</p> 
 <p style="margin-left:0;">--include-gtids</p> 
 <p style="margin-left:0;">--exclude-gtids</p> 
</blockquote> 
<pre><code>mysql8.0.30 [db2]&gt;show binlog events in 'mysql-bin.000011';</code></pre> 
<p style="margin-left:0;"><img alt="" height="1017" src="https://images2.imgbox.com/a7/65/UGdf36Tg_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<h4 id="%E6%A1%88%E4%BE%8B%EF%BC%9A%E6%BC%94%E7%A4%BA%E8%B7%A8binlog%E6%96%87%E4%BB%B6%E6%88%AA%E5%8F%96%E6%97%A5%E5%BF%97%E3%80%82" style="margin-left:0px;">案例：演示跨binlog文件截取日志。</h4> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">（1）此时的日志文件存在 mysql-bin.000011里面，gtid为1-7</p> 
<pre><code>mysql8.0.30 [db2]&gt;show master status;</code></pre> 
<p style="margin-left:0;"><img alt="" height="234" src="https://images2.imgbox.com/31/a4/nS1b00vI_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"><strong>第一次操作</strong></p> 
<p style="margin-left:0;">（2）创建一个数据库gtid，产生一个新的gtid,8</p> 
<pre><code>mysql8.0.30 [db2]&gt;create database gtid;
mysql8.0.30 [db2]&gt;show master status;</code></pre> 
<p style="margin-left:0;"><img alt="" height="307" src="https://images2.imgbox.com/1a/f0/TF68NNME_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">（3）创建t1表并插入数据，此时产生了两个gtid，9,10；</p> 
<pre><code>mysql8.0.30 [gtid]&gt;create table t1(id int);
mysql8.0.30 [gtid]&gt; insert into t1 values(1);
mysql8.0.30 [gtid]&gt;show master status;</code></pre> 
<p style="margin-left:0;"><img alt="" height="379" src="https://images2.imgbox.com/c7/60/TSAkqsPl_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">（4）刷新日志文件，此时查看，发现产生了一个新的日志文件12</p> 
<pre><code>mysql8.0.30 [gtid]&gt;flush logs;
mysql8.0.30 [gtid]&gt;show master status;</code></pre> 
<p style="margin-left:0;"><img alt="" height="316" src="https://images2.imgbox.com/61/fd/gW3wVLuK_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"><strong>第二次操作</strong></p> 
<p style="margin-left:0;">（5）在新的日志文件12中创建一个新表t2;插入数据，刷新日志；</p> 
<pre><code>mysql8.0.30 [gtid]&gt;create table t2(id int);
mysql8.0.30 [gtid]&gt;insert into t2 values(1);
mysql8.0.30 [gtid]&gt;flush logs;</code></pre> 
<p style="margin-left:0;"><img alt="" height="262" src="https://images2.imgbox.com/cf/b0/xSNLaopt_o.png" width="730"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">（6）此时会产生一个新的日志文件13</p> 
<pre><code>mysql8.0.30 [gtid]&gt;show master status;</code></pre> 
<p style="margin-left:0;"><img alt="" height="244" src="https://images2.imgbox.com/dc/40/0QjsxKKk_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"><strong>第三次操作</strong></p> 
<p style="margin-left:0;">（7）在新的日志文件中创建表t3，并插入数据，此时的gid已经到14</p> 
<pre><code>mysql8.0.30 [gtid]&gt;create table t3(id int);
mysql8.0.30 [gtid]&gt;create table t3(id int);
mysql8.0.30 [gtid]&gt;insert into t3 values(1);
mysql8.0.30 [gtid]&gt;show master status;</code></pre> 
<p style="margin-left:0;"><img alt="" height="439" src="https://images2.imgbox.com/21/b8/xY0gSDKh_o.png" width="1200"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"><strong>使用binlog日志恢复误删除的gitd数据库。 </strong></p> 
<p style="margin-left:0;"><strong>首先要确定gtid的起始和结束。 </strong></p> 
<blockquote> 
 <p style="margin-left:0;">此时gtid的范围为7-14</p> 
 <p style="margin-left:0;">uuid为 ：7010c99b-c62f-11ed-a197-000c293aaeaf</p> 
 <p style="margin-left:0;">涉及到的文件mysql-bin.000011,12,13</p> 
</blockquote> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"><strong>误操作删除数据库</strong><strong>gtid</strong></p> 
<p style="margin-left:0;">mysql8.0.30 [gtid]&gt;drop database gtid;</p> 
<p style="margin-left:0;"><img alt="" height="112" src="https://images2.imgbox.com/98/84/FMuLWAPM_o.png" width="704"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"><strong>恢复数据库的信息：</strong></p> 
<p style="margin-left:0;"><span style="color:#333333;">（1）binlog</span><span style="color:#333333;">使用</span><span style="color:#333333;">gtid截取日志，日志保存到/backup/db/t1.sql</span></p> 
<pre><code>[root@node1 data]#  mysqlbinlog --skip-gtids --include-gtids='7010c99b-c62f-11ed-a197-000c293aaeaf:8-14' mysql-bin.000011 mysql-bin.000012 mysql-bin.000013 -r /backup/db/t1.sql</code></pre> 
<p style="margin-left:0;"><img alt="" height="130" src="https://images2.imgbox.com/3b/63/9UBsaWl6_o.png" width="1200"></p> 
<p></p> 
<div> 
 <span style="color:#333333;">（2）使用</span> 
 <span style="color:#333333;">binlog</span> 
 <span style="color:#333333;">日志恢复 </span>， 
 <span style="color:#0d0016;">设为0后，在Master数据库上执行的语句都不记录binlog</span> 
</div> 
<pre><code>mysql8.0.30 [(none)]&gt;set sql_log_bin=0;</code></pre> 
<p style="margin-left:0;"><img alt="" height="110" src="https://images2.imgbox.com/e3/cf/9ucXoRgF_o.png" width="686"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"><span style="color:#333333;">（3）使用binlog</span><span style="color:#333333;">日志恢复 </span></p> 
<pre><code>mysql8.0.30 [(none)]&gt;source /backup/db/t1.sql;</code></pre> 
<p style="margin-left:0;"><img alt="" height="337" src="https://images2.imgbox.com/c3/68/Wk2oJiMg_o.png" width="918"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">（4）查看所有数据库，发现gtid已经恢复</p> 
<pre><code>mysql8.0.30 [gtid]&gt;show databases;</code></pre> 
<p style="margin-left:0;"><img alt="" height="560" src="https://images2.imgbox.com/1e/41/JnIX4y32_o.png" width="782"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">（5）在gtid数据库中查看所有表，发现3张表已经恢复</p> 
<pre><code>mysql8.0.30 [gtid]&gt;show tables;</code></pre> 
<p style="margin-left:0;"><img alt="" height="361" src="https://images2.imgbox.com/9f/e7/jFLwClSs_o.png" width="725"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">（6）查看三张表中的数据，发现数据已经被恢复</p> 
<pre><code>mysql8.0.30 [gtid]&gt;select * from t1;</code></pre> 
<p style="margin-left:0;"><img alt="" height="818" src="https://images2.imgbox.com/32/4f/B0ENVZOp_o.png" width="1017"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6feb56782ee2581f7dc4eb4e8b3249c2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">数据挖掘的基础</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/62e0d2585df4489a05e17a3ea762b04f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">IO图解及Java中InputStream，OutputStream，FileReader，FileWriter用法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>