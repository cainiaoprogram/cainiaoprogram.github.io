<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Slurm随手记 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Slurm随手记" />
<meta property="og:description" content="写在前面：项目要用，随便记录一下
文章目录 简介快速开始框架命令建议MPI 参考资料：
https://slurm.schedmd.com/quickstart.html
https://blog.csdn.net/weixin_42279314/article/details/109677459
https://hpc.pku.edu.cn/_book/guide/slurm/sbatch.html
简介 Slurm是一个开源、容错、高度可扩展的集群管理和作业调度系统，适用于大型和小型Linux集群。Slurm的操作不需要对内核进行修改，并且相对独立。作为集群工作负载管理器，Slurm具有三个关键功能。首先，它将对资源（计算节点）的独占和/或非独占访问分配给用户一段时间，以便他们可以执行工作。其次，它提供了一个框架，用于在分配的节点集上启动、执行和监视工作（通常是并行作业）。最后，它通过管理挂起的工作队列来仲裁资源争用。
快速开始 框架 Slurm系统由两个关键部分组成，如图1所示。每个计算节点上都有一个slurmd守护进程，而管理节点上则有中央slurmctld守护进程（还可以选择启用故障转移）。slurmd负责提供容错通信。用户可以使用一系列命令来与系统交互，包括：sacct、sacctmgr、salloc、sattach、sbatch、sbcast、scancel、scontrol、scrontab、sdiag、sh5util、sinfo、sprio、squeue、sreport、srun、sshare、sstat、strigger、sview。所有这些命令都可以在集群的任何位置执行。
Slurm系统中有多个组成部分，如图2所示。这些包括节点（计算资源的基本单元）、分区（将节点分组成逻辑集合，可以有重叠）、作业（在指定时间内分配给用户的任务或资源）、以及作业步骤（作业中的一组可能并行执行的任务）。分区可以看作是作业的队列，每个分区都有一些限制，比如作业大小、运行时间、允许使用的用户等。系统会按照优先级将作业分配给分区内的节点，直到该分区的资源（如节点、处理器、内存等）被用尽。一旦作业被分配到一组节点，用户就可以启动并行工作，可以是利用所有节点的单个作业步骤，也可以是几个独立的作业步骤，每个步骤使用分配的一部分资源。
命令 所有Slurm守护进程、命令和API函数都有手册页。命令选项–help还提供了选项的简要摘要。请注意，命令选项都区分大小写。
sacct 用于报告有关活动或已完成作业的作业或作业步骤的会计信息。
salloc 用于实时分配作业的资源。通常用于分配资源并生成一个 shell。然后使用该 shell 执行 srun 命令启动并行任务。
sattach 用于将标准输入、输出和错误以及信号功能附加到当前运行的作业或作业步骤。可以多次附加到和分离从作业。
sbatch 用于提交作业脚本以供以后执行。脚本通常包含一个或多个 srun 命令以启动并行任务。 假设你有一个名为 my_job_script.sh的脚本，其中包含作业的详细信息和要执行的命令。通过以下命令将作业提交到队列：sbatch my_job_script.sh
sbcast 用于将文件从本地磁盘传输到分配给作业的节点的本地磁盘。这可用于有效地使用无磁盘的计算节点或相对于共享文件系统提供更好的性能。
scancel 用于取消挂起或运行中的作业或作业步骤。还可以用于向与运行中的作业或作业步骤关联的所有进程发送任意信号。
scontrol 是用于查看和/或修改 Slurm 状态的管理工具。请注意，许多 scontrol 命令只能以 root 用户身份执行。
sinfo 报告由 Slurm 管理的分区和节点的状态。它具有各种过滤、排序和格式化选项。
sprio 用于显示影响作业优先级的组件的详细视图。
squeue 报告作业或作业步骤的状态。它具有各种过滤、排序和格式化选项。默认情况下，它按优先级顺序报告运行中的作业，然后按优先级顺序报告挂起的作业。
srun 用于实时提交作业以执行或启动实时作业步骤。srun 具有各种选项，可指定资源要求，包括：最小和最大节点数、处理器数、要使用或不使用的特定节点以及作业的节点分配中的特定节点特性（内存、磁盘空间、某些所需功能等）。作业可以包含在作业的节点分配内顺序或并行执行的多个作业步骤。
如果你想直接在命令行中启动一个 MPI 进程，可以使用 srun，例如srun -n 4 ./my_mpi_program
sshare 显示有关集群上公平份额使用情况的详细信息。请注意，这仅在使用优先级/多因素插件时才可行。
sstat 用于获取有关运行中作业或作业步骤使用的资源的信息。
strigger 用于设置、获取或查看事件触发器。事件触发器包括节点宕机或作业接近其时间限制等情况。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/2e827dd27b0135118d9e5282ec886a66/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-21T22:47:11+08:00" />
<meta property="article:modified_time" content="2023-12-21T22:47:11+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Slurm随手记</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>写在前面：项目要用，随便记录一下</p> 
<hr> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_10" rel="nofollow">简介</a></li><li><a href="#_13" rel="nofollow">快速开始</a></li><li><ul><li><a href="#_14" rel="nofollow">框架</a></li><li><a href="#_19" rel="nofollow">命令</a></li><li><a href="#_291" rel="nofollow">建议</a></li><li><a href="#MPI_296" rel="nofollow">MPI</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<p>参考资料：<br> <a href="https://slurm.schedmd.com/quickstart.html" rel="nofollow">https://slurm.schedmd.com/quickstart.html</a><br> <a href="https://blog.csdn.net/weixin_42279314/article/details/109677459">https://blog.csdn.net/weixin_42279314/article/details/109677459</a></p> 
<p><a href="https://hpc.pku.edu.cn/_book/guide/slurm/sbatch.html" rel="nofollow">https://hpc.pku.edu.cn/_book/guide/slurm/sbatch.html</a></p> 
<h2><a id="_10"></a>简介</h2> 
<p>Slurm是一个开源、容错、高度可扩展的集群管理和作业调度系统，适用于大型和小型Linux集群。Slurm的操作不需要对内核进行修改，并且相对独立。作为集群工作负载管理器，Slurm具有三个关键功能。首先，它将对资源（计算节点）的独占和/或非独占访问分配给用户一段时间，以便他们可以执行工作。其次，它提供了一个框架，用于在分配的节点集上启动、执行和监视工作（通常是并行作业）。最后，它通过管理挂起的工作队列来仲裁资源争用。</p> 
<h2><a id="_13"></a>快速开始</h2> 
<h3><a id="_14"></a>框架</h3> 
<p>Slurm系统由两个关键部分组成，如图1所示。每个计算节点上都有一个slurmd守护进程，而管理节点上则有中央slurmctld守护进程（还可以选择启用故障转移）。slurmd负责提供容错通信。用户可以使用一系列命令来与系统交互，包括：sacct、sacctmgr、salloc、sattach、sbatch、sbcast、scancel、scontrol、scrontab、sdiag、sh5util、sinfo、sprio、squeue、sreport、srun、sshare、sstat、strigger、sview。所有这些命令都可以在集群的任何位置执行。<br> <img src="https://images2.imgbox.com/3b/8c/KeivOGNs_o.png" alt="在这里插入图片描述"><br> Slurm系统中有多个组成部分，如图2所示。这些包括节点（计算资源的基本单元）、分区（将节点分组成逻辑集合，可以有重叠）、作业（在指定时间内分配给用户的任务或资源）、以及作业步骤（作业中的一组可能并行执行的任务）。分区可以看作是作业的队列，每个分区都有一些限制，比如作业大小、运行时间、允许使用的用户等。系统会按照优先级将作业分配给分区内的节点，直到该分区的资源（如节点、处理器、内存等）被用尽。一旦作业被分配到一组节点，用户就可以启动并行工作，可以是利用所有节点的单个作业步骤，也可以是几个独立的作业步骤，每个步骤使用分配的一部分资源。<br> <img src="https://images2.imgbox.com/45/ff/F7dkXRfk_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_19"></a>命令</h3> 
<p>所有Slurm守护进程、命令和API函数都有手册页。命令选项–help还提供了选项的简要摘要。请注意，命令选项都区分大小写。</p> 
<p><code>sacct</code> 用于报告有关活动或已完成作业的作业或作业步骤的会计信息。</p> 
<p><code>salloc</code> 用于实时分配作业的资源。通常用于分配资源并生成一个 shell。然后使用该 shell 执行 srun 命令启动并行任务。</p> 
<p><code>sattach</code> 用于将标准输入、输出和错误以及信号功能附加到当前运行的作业或作业步骤。可以多次附加到和分离从作业。</p> 
<p><code>sbatch</code> 用于提交作业脚本以供以后执行。脚本通常包含一个或多个 srun 命令以启动并行任务。 假设你有一个名为 my_job_script.sh的脚本，其中包含作业的详细信息和要执行的命令。通过以下命令将作业提交到队列：<code>sbatch my_job_script.sh</code></p> 
<p><code>sbcast</code> 用于将文件从本地磁盘传输到分配给作业的节点的本地磁盘。这可用于有效地使用无磁盘的计算节点或相对于共享文件系统提供更好的性能。</p> 
<p><code>scancel</code> 用于取消挂起或运行中的作业或作业步骤。还可以用于向与运行中的作业或作业步骤关联的所有进程发送任意信号。</p> 
<p>scontrol 是用于查看和/或修改 Slurm 状态的管理工具。请注意，许多 scontrol 命令只能以 root 用户身份执行。</p> 
<p><code>sinfo</code> 报告由 Slurm 管理的分区和节点的状态。它具有各种过滤、排序和格式化选项。</p> 
<p><code>sprio</code> 用于显示影响作业优先级的组件的详细视图。</p> 
<p><code>squeue</code> 报告作业或作业步骤的状态。它具有各种过滤、排序和格式化选项。默认情况下，它按优先级顺序报告运行中的作业，然后按优先级顺序报告挂起的作业。</p> 
<p><code>srun</code> 用于实时提交作业以执行或启动实时作业步骤。srun 具有各种选项，可指定资源要求，包括：最小和最大节点数、处理器数、要使用或不使用的特定节点以及作业的节点分配中的特定节点特性（内存、磁盘空间、某些所需功能等）。作业可以包含在作业的节点分配内顺序或并行执行的多个作业步骤。<br> 如果你想直接在命令行中启动一个 MPI 进程，可以使用<code> srun</code>，例如<code>srun -n 4 ./my_mpi_program</code></p> 
<p><code>sshare</code> 显示有关集群上公平份额使用情况的详细信息。请注意，这仅在使用优先级/多因素插件时才可行。</p> 
<p><code>sstat</code> 用于获取有关运行中作业或作业步骤使用的资源的信息。</p> 
<p><code>strigger</code> 用于设置、获取或查看事件触发器。事件触发器包括节点宕机或作业接近其时间限制等情况。</p> 
<p><code>sview</code> 是用于获取和更新由 Slurm 管理的作业、分区和节点状态信息的图形用户界面。</p> 
<p>我们可以使用 <code>sinfo</code> 命令来查看系统上存在哪些分区，这些分区包含哪些节点以及系统的整体状态。在下面的例子中，我们发现系统有两个分区：debug 和 batch。分区名字后面的 * 表示 debug 分区是默认的提交作业的分区。我们可以看到两个分区都是 UP 状态，但有些配置可能导致某些分区在非工作时间（例如周末或晚上）处于 DOWN 状态，尤其是用于处理较大作业的分区。关于每个分区的信息可能会跨多行，以清晰地标识节点的不同状态。在这个例子中，两个节点 adev[1-2] 处于下线状态，* 表示这些节点未响应。需要注意的是，节点名称采用 adev 作为通用前缀，后跟数字范围或特定数字的简洁表示方式。这种格式使得对于庞大的集群能够轻松进行管理。<code>sinfo</code> 命令提供了许多选项，可以按照用户的喜好以各种格式查看感兴趣的信息。如需了解更多信息，请参考相关的 man 页面。</p> 
<pre><code class="prism language-python">adev0<span class="token punctuation">:</span> sinfo
PARTITION AVAIL  TIMELIMIT NODES  STATE NODELIST
debug<span class="token operator">*</span>       up      <span class="token number">30</span><span class="token punctuation">:</span><span class="token number">00</span>     <span class="token number">2</span>  down<span class="token operator">*</span> adev<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span>
debug<span class="token operator">*</span>       up      <span class="token number">30</span><span class="token punctuation">:</span><span class="token number">00</span>     <span class="token number">3</span>   idle adev<span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">]</span>
batch        up      <span class="token number">30</span><span class="token punctuation">:</span><span class="token number">00</span>     <span class="token number">3</span>  down<span class="token operator">*</span> adev<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">]</span>
batch        up      <span class="token number">30</span><span class="token punctuation">:</span><span class="token number">00</span>     <span class="token number">3</span>  alloc adev<span class="token punctuation">[</span><span class="token number">7</span><span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">]</span>
batch        up      <span class="token number">30</span><span class="token punctuation">:</span><span class="token number">00</span>     <span class="token number">4</span>   idle adev<span class="token punctuation">[</span><span class="token number">9</span><span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">]</span>
</code></pre> 
<p>接下来，我们使用 <code>squeue</code> 命令确定系统上存在哪些作业。其中，ST 字段表示作业状态。有两个作业处于运行状态（R 是 Running 的缩写），而一个作业处于挂起状态（PD 是 Pending 的缩写）。TIME 字段显示作业运行的时长，格式为天-小时:分钟:秒。NODELIST(REASON) 字段指示作业正在哪里运行，或者它仍然挂起的原因。挂起作业的典型原因包括资源（等待资源可用）和优先级（在优先级较高的作业之后排队）。<code>squeue</code> 命令提供了许多选项，让您可以轻松查看您感兴趣的信息，以您喜欢的格式显示。有关更多信息，请参阅相关的 man 页面。</p> 
<pre><code class="prism language-python">adev0<span class="token punctuation">:</span> squeue
JOBID PARTITION  NAME  USER ST  TIME NODES NODELIST<span class="token punctuation">(</span>REASON<span class="token punctuation">)</span>
<span class="token number">65646</span>     batch  chem  mike  R <span class="token number">24</span><span class="token punctuation">:</span><span class="token number">19</span>     <span class="token number">2</span> adev<span class="token punctuation">[</span><span class="token number">7</span><span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">]</span>
<span class="token number">65647</span>     batch   bio  joan  R  <span class="token number">0</span><span class="token punctuation">:</span><span class="token number">09</span>     <span class="token number">1</span> adev14
<span class="token number">65648</span>     batch  math  phil PD  <span class="token number">0</span><span class="token punctuation">:</span><span class="token number">00</span>     <span class="token number">6</span> <span class="token punctuation">(</span>Resources<span class="token punctuation">)</span>
</code></pre> 
<p><code>scontrol</code> 命令可用于报告有关节点、分区、作业、作业步骤和配置的更详细信息。它还可供系统管理员进行配置更改。以下是一些示例。有关更多信息，请参阅相关的 man 页面。</p> 
<pre><code class="prism language-python">adev0<span class="token punctuation">:</span> scontrol show partition
PartitionName<span class="token operator">=</span>debug TotalNodes<span class="token operator">=</span><span class="token number">5</span> TotalCPUs<span class="token operator">=</span><span class="token number">40</span> RootOnly<span class="token operator">=</span>NO
   Default<span class="token operator">=</span>YES OverSubscribe<span class="token operator">=</span>FORCE<span class="token punctuation">:</span><span class="token number">4</span> PriorityTier<span class="token operator">=</span><span class="token number">1</span> State<span class="token operator">=</span>UP
   MaxTime<span class="token operator">=</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">30</span><span class="token punctuation">:</span><span class="token number">00</span> Hidden<span class="token operator">=</span>NO
   MinNodes<span class="token operator">=</span><span class="token number">1</span> MaxNodes<span class="token operator">=</span><span class="token number">26</span> DisableRootJobs<span class="token operator">=</span>NO AllowGroups<span class="token operator">=</span>ALL
   Nodes<span class="token operator">=</span>adev<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">]</span> NodeIndices<span class="token operator">=</span><span class="token number">0</span><span class="token operator">-</span><span class="token number">4</span>

PartitionName<span class="token operator">=</span>batch TotalNodes<span class="token operator">=</span><span class="token number">10</span> TotalCPUs<span class="token operator">=</span><span class="token number">80</span> RootOnly<span class="token operator">=</span>NO
   Default<span class="token operator">=</span>NO OverSubscribe<span class="token operator">=</span>FORCE<span class="token punctuation">:</span><span class="token number">4</span> PriorityTier<span class="token operator">=</span><span class="token number">1</span> State<span class="token operator">=</span>UP
   MaxTime<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span> Hidden<span class="token operator">=</span>NO
   MinNodes<span class="token operator">=</span><span class="token number">1</span> MaxNodes<span class="token operator">=</span><span class="token number">26</span> DisableRootJobs<span class="token operator">=</span>NO AllowGroups<span class="token operator">=</span>ALL
   Nodes<span class="token operator">=</span>adev<span class="token punctuation">[</span><span class="token number">6</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">]</span> NodeIndices<span class="token operator">=</span><span class="token number">5</span><span class="token operator">-</span><span class="token number">14</span>


adev0<span class="token punctuation">:</span> scontrol show node adev1
NodeName<span class="token operator">=</span>adev1 State<span class="token operator">=</span>DOWN<span class="token operator">*</span> CPUs<span class="token operator">=</span><span class="token number">8</span> AllocCPUs<span class="token operator">=</span><span class="token number">0</span>
   RealMemory<span class="token operator">=</span><span class="token number">4000</span> TmpDisk<span class="token operator">=</span><span class="token number">0</span>
   Sockets<span class="token operator">=</span><span class="token number">2</span> Cores<span class="token operator">=</span><span class="token number">4</span> Threads<span class="token operator">=</span><span class="token number">1</span> Weight<span class="token operator">=</span><span class="token number">1</span> Features<span class="token operator">=</span>intel
   Reason<span class="token operator">=</span>Not responding <span class="token punctuation">[</span>slurm@<span class="token number">06</span><span class="token operator">/</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">14</span><span class="token punctuation">:</span><span class="token number">01</span><span class="token punctuation">:</span><span class="token number">24</span><span class="token punctuation">]</span>

<span class="token number">65648</span>     batch  math  phil PD  <span class="token number">0</span><span class="token punctuation">:</span><span class="token number">00</span>     <span class="token number">6</span> <span class="token punctuation">(</span>Resources<span class="token punctuation">)</span>
adev0<span class="token punctuation">:</span> scontrol show job
JobId<span class="token operator">=</span><span class="token number">65672</span> UserId<span class="token operator">=</span>phil<span class="token punctuation">(</span><span class="token number">5136</span><span class="token punctuation">)</span> GroupId<span class="token operator">=</span>phil<span class="token punctuation">(</span><span class="token number">5136</span><span class="token punctuation">)</span>
   Name<span class="token operator">=</span>math
   Priority<span class="token operator">=</span><span class="token number">4294901603</span> Partition<span class="token operator">=</span>batch BatchFlag<span class="token operator">=</span><span class="token number">1</span>
   AllocNode<span class="token punctuation">:</span>Sid<span class="token operator">=</span>adev0<span class="token punctuation">:</span><span class="token number">16726</span> TimeLimit<span class="token operator">=</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token number">00</span> ExitCode<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">0</span>
   StartTime<span class="token operator">=</span><span class="token number">06</span><span class="token operator">/</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">27</span><span class="token punctuation">:</span><span class="token number">11</span> EndTime<span class="token operator">=</span><span class="token number">06</span><span class="token operator">/</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">37</span><span class="token punctuation">:</span><span class="token number">11</span>
   JobState<span class="token operator">=</span>PENDING NodeList<span class="token operator">=</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span> NodeListIndices<span class="token operator">=</span>
   NumCPUs<span class="token operator">=</span><span class="token number">24</span> ReqNodes<span class="token operator">=</span><span class="token number">1</span> ReqS<span class="token punctuation">:</span>C<span class="token punctuation">:</span>T<span class="token operator">=</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">65535</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">65535</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">65535</span>
   OverSubscribe<span class="token operator">=</span><span class="token number">1</span> Contiguous<span class="token operator">=</span><span class="token number">0</span> CPUs<span class="token operator">/</span>task<span class="token operator">=</span><span class="token number">0</span> Licenses<span class="token operator">=</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span>
   MinCPUs<span class="token operator">=</span><span class="token number">1</span> MinSockets<span class="token operator">=</span><span class="token number">1</span> MinCores<span class="token operator">=</span><span class="token number">1</span> MinThreads<span class="token operator">=</span><span class="token number">1</span>
   MinMemory<span class="token operator">=</span><span class="token number">0</span> MinTmpDisk<span class="token operator">=</span><span class="token number">0</span> Features<span class="token operator">=</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span>
   Dependency<span class="token operator">=</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span> Account<span class="token operator">=</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span> Requeue<span class="token operator">=</span><span class="token number">1</span>
   Reason<span class="token operator">=</span><span class="token boolean">None</span> Network<span class="token operator">=</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span>
   ReqNodeList<span class="token operator">=</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span> ReqNodeListIndices<span class="token operator">=</span>
   ExcNodeList<span class="token operator">=</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span> ExcNodeListIndices<span class="token operator">=</span>
   SubmitTime<span class="token operator">=</span><span class="token number">06</span><span class="token operator">/</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">27</span><span class="token punctuation">:</span><span class="token number">11</span> SuspendTime<span class="token operator">=</span><span class="token boolean">None</span> PreSusTime<span class="token operator">=</span><span class="token number">0</span>
   Command<span class="token operator">=</span><span class="token operator">/</span>home<span class="token operator">/</span>phil<span class="token operator">/</span>math
   WorkDir<span class="token operator">=</span><span class="token operator">/</span>home<span class="token operator">/</span>phil
</code></pre> 
<p>上面提供了一些与 Slurm 调度器相关的信息，包括分区、节点和作业的配置。</p> 
<p>信息表明系统中存在两个分区（debug 和 batch），其中 debug 是默认分区。adev1 节点当前处于 DOWN* 状态，不响应。还有一个名为 “math” 的作业处于挂起状态（Pending），在 batch 分区中等待资源（Resources）。该作业需求的资源包括 24 个 CPU 核心，要求在 1 个节点上运行，预计运行时间为 10 分钟。</p> 
<p>下面是对这些信息的分析：</p> 
<ol><li> <p><strong>分区信息:</strong></p> 
  <ul><li> <p><strong>debug 分区:</strong></p> 
    <ul><li>节点数量：5</li><li>CPU 总数：40</li><li>默认分区：是</li><li>节点范围：adev[1-5]</li><li>状态：UP</li><li>最大运行时间：00:30:00</li><li>可用于非 root 用户的作业：是</li></ul> </li><li> <p><strong>batch 分区:</strong></p> 
    <ul><li>节点数量：10</li><li>CPU 总数：80</li><li>默认分区：否</li><li>节点范围：adev[6-15]</li><li>状态：UP</li><li>最大运行时间：16:00:00</li><li>可用于非 root 用户的作业：是</li></ul> </li></ul> </li><li> <p><strong>节点信息:</strong></p> 
  <ul><li><strong>adev1 节点:</strong> 
    <ul><li>节点名称：adev1</li><li>状态：DOWN*</li><li>可用 CPU 数量：8</li><li>实际内存：4000 MB</li><li>临时磁盘：0 MB</li><li>CPU 架构：2 插槽、4 核心、1 线程</li><li>不响应原因：Not responding [slurm@06/02-14:01:24]</li></ul> </li></ul> </li><li> <p><strong>作业信息:</strong></p> 
  <ul><li><strong>JobID=65648:</strong> 
    <ul><li>作业名称：math</li><li>作业状态：PD（Pending）</li><li>提交时间：06/02-15:27:11</li><li>最大运行时间：00:10:00</li><li>所需 CPU 数量：24</li><li>所需节点数：1</li><li>队列：batch</li><li>预计开始时间：06/02-15:27:11</li><li>预计结束时间：06/02-15:37:11</li><li>命令：/home/phil/math</li></ul> </li></ul> </li></ol> 
<p>使用 <code>srun</code> 命令可以在单个命令行中创建资源分配并启动作业步骤的任务。根据所使用的 MPI 实现，MPI 作业也可以通过这种方式启动。有关更多 MPI 具体信息，请参阅 MPI 部分。在此示例中，我们在三个节点上执行 <code>/bin/hostname</code> 命令（-N3），并在输出中包含任务编号（-l）。将使用默认分区，默认情况下每个节点将使用一个任务。请注意，<code>srun</code> 命令有许多选项可用于控制分配哪些资源以及如何在这些资源上分配任务。</p> 
<pre><code class="prism language-python">adev0<span class="token punctuation">:</span> srun <span class="token operator">-</span>N3 <span class="token operator">-</span>l <span class="token operator">/</span><span class="token builtin">bin</span><span class="token operator">/</span>hostname
<span class="token number">0</span><span class="token punctuation">:</span> adev3
<span class="token number">1</span><span class="token punctuation">:</span> adev4
<span class="token number">2</span><span class="token punctuation">:</span> adev5
</code></pre> 
<p>在Python中，你可以使用<code>mpi4py</code>库来编写MPI程序。下面是一个简单的"Hello, World!"示例，演示了如何在Python中使用MPI：</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> mpi4py <span class="token keyword">import</span> MPI

<span class="token comment"># 初始化MPI</span>
comm <span class="token operator">=</span> MPI<span class="token punctuation">.</span>COMM_WORLD
rank <span class="token operator">=</span> comm<span class="token punctuation">.</span>Get_rank<span class="token punctuation">(</span><span class="token punctuation">)</span>
size <span class="token operator">=</span> comm<span class="token punctuation">.</span>Get_size<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 输出Hello, World!消息，包括进程的排名</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Hello, World! I am process {} of {}."</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>rank<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 结束MPI</span>
MPI<span class="token punctuation">.</span>Finalize<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<p>这个与之前例子的变种在四个任务中执行 <code>/bin/hostname</code>（-n4）。默认情况下，每个任务将使用一个处理器（请注意，我们没有指定节点数量）。</p> 
<pre><code class="prism language-python">adev0<span class="token punctuation">:</span> srun <span class="token operator">-</span>n4 <span class="token operator">-</span>l <span class="token operator">/</span><span class="token builtin">bin</span><span class="token operator">/</span>hostname
<span class="token number">0</span><span class="token punctuation">:</span> adev3
<span class="token number">1</span><span class="token punctuation">:</span> adev3
<span class="token number">2</span><span class="token punctuation">:</span> adev3
<span class="token number">3</span><span class="token punctuation">:</span> adev3
</code></pre> 
<p>一种常见的操作模式是提交一个脚本以供以后执行。在这个例子中，脚本的名称是 my.script，我们明确使用节点 adev9 和 adev10（-w “adev[9-10]”，请注意使用了节点范围表达式）。我们还明确说明后续的作业步骤将每个生成四个任务，这将确保我们的分配至少包含四个处理器（每个任务启动一个处理器）。输出将显示在文件 my.stdout 中（“-o my.stdout”）。这个脚本包含了嵌入其中的作业的时间限制。其他选项可以通过在脚本中的任何要执行的命令之前使用 “#SBATCH” 前缀，后跟选项来提供。在命令行上提供的选项将覆盖在脚本中指定的任何选项。请注意，my.script 包含了在分配的第一个节点上执行的命令 /bin/hostname，以及使用 srun 命令启动并按顺序执行的两个作业步骤。</p> 
<pre><code class="prism language-bash">adev0: <span class="token function">cat</span> my.script
<span class="token comment">#!/bin/sh</span>
<span class="token comment">#SBATCH --time=1</span>
/bin/hostname
srun <span class="token parameter variable">-l</span> /bin/hostname
srun <span class="token parameter variable">-l</span> /bin/pwd

adev0: sbatch <span class="token parameter variable">-n4</span> <span class="token parameter variable">-w</span> <span class="token string">"adev[9-10]"</span> <span class="token parameter variable">-o</span> my.stdout my.script
sbatch: Submitted batch job <span class="token number">469</span>

adev0: <span class="token function">cat</span> my.stdout
adev9
<span class="token number">0</span>: adev9
<span class="token number">1</span>: adev9
<span class="token number">2</span>: adev10
<span class="token number">3</span>: adev10
<span class="token number">0</span>: /home/jette
<span class="token number">1</span>: /home/jette
<span class="token number">2</span>: /home/jette
<span class="token number">3</span>: /home/jette
</code></pre> 
<p>上面这个例子展示了一个使用 Slurm 的脚本来执行作业的过程：</p> 
<ol><li> <p><strong>脚本内容 (my.script):</strong></p> <pre><code class="prism language-bash"><span class="token shebang important">#!/bin/sh</span>
<span class="token comment">#SBATCH --time=1</span>
/bin/hostname
srun <span class="token parameter variable">-l</span> /bin/hostname
srun <span class="token parameter variable">-l</span> /bin/pwd
</code></pre> 
  <ul><li><code> #SBATCH --time=1</code>脚本指定了作业的执行时间为 1 分钟。</li><li>首先执行 <code>/bin/hostname</code> 命令，输出当前主机的主机名。</li><li><code>-l</code>选项是<code>srun</code>的一个参数，它指示<code>srun</code>在每个计算节点上运行作业。这意味着每个节点都会运行相同的作业。</li><li>接着使用 <code>srun -l /bin/hostname</code> 启动了四个任务，每个任务执行 <code>/bin/hostname</code> 命令，并输出每个任务的编号及对应的主机名。</li><li>最后使用 <code>srun -l /bin/pwd</code> 启动了四个任务，每个任务执行 <code>/bin/pwd</code> 命令，输出每个任务的编号及对应的当前工作目录。</li></ul> </li><li> <p><strong>提交作业 (sbatch):</strong></p> <pre><code class="prism language-bash">adev0: sbatch <span class="token parameter variable">-n4</span> <span class="token parameter variable">-w</span> <span class="token string">"adev[9-10]"</span> <span class="token parameter variable">-o</span> my.stdout my.script
sbatch: Submitted batch job <span class="token number">469</span>
</code></pre> 
  <ul><li>使用 <code>sbatch</code> 提交了作业，指定了四个任务（<code>-n4</code>），使用节点范围表达式指定了节点 <code>adev9</code> 和 <code>adev10</code>（<code>-w "adev[9-10]"</code>），并将输出重定向到 my.stdout 文件（<code>-o my.stdout</code>）。</li></ul> </li><li> <p><strong>查看输出 (my.stdout):</strong></p> <pre><code class="prism language-bash">adev9
<span class="token number">0</span>: adev9
<span class="token number">1</span>: adev9
<span class="token number">2</span>: adev10
<span class="token number">3</span>: adev10
<span class="token number">0</span>: /home/jette
<span class="token number">1</span>: /home/jette
<span class="token number">2</span>: /home/jette
<span class="token number">3</span>: /home/jette
</code></pre> 
  <ul><li>输出显示了作业执行的结果。首先，显示了执行 <code>/bin/hostname</code> 的任务，然后是执行 <code>/bin/pwd</code> 的任务。每个任务都有相应的任务编号，以及执行命令的结果。</li></ul> </li></ol> 
<p>总体而言，这个例子演示了如何通过 Slurm 在指定的节点上执行作业，包括如何在作业中运行不同的命令，并将输出保存到文件。</p> 
<p>最终的操作模式是创建资源分配并在该分配中启动作业步骤。<code>salloc</code> 命令用于创建资源分配，并通常在该分配中启动一个 shell。通常会使用 <code>srun</code> 命令在该分配中执行一个或多个作业步骤，以启动任务（根据使用的 MPI 类型，启动机制可能会有所不同，详见下面的 MPI 详细信息）。最后，使用 <code>exit</code> 命令终止由 <code>salloc</code> 创建的 shell。Slurm 不会自动将可执行文件或数据文件迁移到分配给作业的节点。文件必须存在于本地磁盘或某个全局文件系统中（例如 NFS 或 Lustre）。我们提供了 <code>sbcast</code> 工具，使用 Slurm 的分层通信将文件传输到已分配节点的本地存储中。在此示例中，我们使用 <code>sbcast</code> 将可执行程序 <code>a.out</code> 传输到已分配节点的本地存储中的 <code>/tmp/joe.a.out</code>。执行程序后，我们从本地存储中删除它。</p> 
<pre><code class="prism language-python">tux0<span class="token punctuation">:</span> salloc <span class="token operator">-</span>N1024 bash
$ sbcast a<span class="token punctuation">.</span>out <span class="token operator">/</span>tmp<span class="token operator">/</span>joe<span class="token punctuation">.</span>a<span class="token punctuation">.</span>out
Granted job allocation <span class="token number">471</span>
$ srun <span class="token operator">/</span>tmp<span class="token operator">/</span>joe<span class="token punctuation">.</span>a<span class="token punctuation">.</span>out
Result <span class="token keyword">is</span> <span class="token number">3.14159</span>
$ srun rm <span class="token operator">/</span>tmp<span class="token operator">/</span>joe<span class="token punctuation">.</span>a<span class="token punctuation">.</span>out
$ exit
salloc<span class="token punctuation">:</span> Relinquishing job allocation <span class="token number">471</span>
</code></pre> 
<p><code>salloc -N1024 bash</code>：该命令用于分配1024个节点并启动一个交互式bash会话。这意味着用户将在Slurm集群上获得1024个计算节点的进程，可以在这些节点上运行命令。</p> 
<p><code>sbcast</code>是Slurm命令之一，用于将文件广播到集群的所有节点。</p> 
<p><code>srun /tmp/joe.a.out</code>：该命令使用<code>srun</code>命令在集群节点上运行<code>/tmp/joe.a.out</code>可执行文件。<code>srun</code>是Slurm命令之一，用于在集群节点上运行作业。</p> 
<p><code>srun rm /tmp/joe.a.out</code>：该命令使用<code>srun</code>命令在集群节点上删除<code>/tmp/joe.a.out</code>文件。</p> 
<p><code>exit</code>：该命令退出当前的bash会话。</p> 
<p><code>salloc: Relinquishing job allocation 471</code>：这条消息表示Slurm调度系统释放了作业分配号为471的作业。</p> 
<h3><a id="_291"></a>建议</h3> 
<p>考虑将相关工作放入一个包含多个作业步骤的单个 Slurm 作业中，这样做既有助于提高性能，又便于管理。每个 Slurm 作业可以包含大量的作业步骤，而 Slurm 在管理作业步骤的开销远低于单独作业的开销。</p> 
<p>作业数组是管理具有相同资源需求的一组批处理作业的有效机制。大多数 Slurm 命令都可以将作业数组视为单个实体来管理，可以作为单独的元素（任务）或作为单个实体（例如，在单个命令中删除整个作业数组）。</p> 
<h3><a id="MPI_296"></a>MPI</h3> 
<p>MPI的使用取决于所使用的MPI类型。有三种基本不同的操作模式由这些不同的MPI实现使用：</p> 
<ol><li>Slurm直接启动任务并通过PMI2或PMIx API执行通信初始化。（由大多数现代MPI实现支持。）</li><li>Slurm为作业创建资源分配，然后mpirun使用Slurm的基础设施启动任务（较旧版本的OpenMPI）。</li><li>Slurm为作业创建资源分配，然后mpirun使用除Slurm之外的某种机制启动任务，例如SSH或RSH。这些任务在Slurm的监控或控制之外启动。在放弃作业分配时，建议配置Slurm的epilog以清理这些任务。强烈建议使用pam_slurm_adopt。</li></ol>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5717b0013e8de397ccfdfc28ff4e8ff5/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">windows下使用gtest</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5c6f3351bc779e83cb1e8b8a23ee6c1b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Qt/C&#43;&#43;视频监控Onvif工具/组播搜索/显示监控画面/图片参数调节/OSD管理/祖传原创</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>