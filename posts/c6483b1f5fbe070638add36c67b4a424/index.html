<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SwinIR实战：详细记录SwinIR的训练过程 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="SwinIR实战：详细记录SwinIR的训练过程" />
<meta property="og:description" content="文章目录 SwinIR实战：详细记录SwinIR的训练过程。下载训练代码数据集训练完整的代码： SwinIR实战：详细记录SwinIR的训练过程。 论文地址：https://arxiv.org/pdf/2108.10257.pdf
预训练模型下载：https://github.com/JingyunLiang/SwinIR/releases
训练代码下载：https://github.com/cszn/KAIR
测试代码：https://github.com/JingyunLiang/SwinIR
论文翻译：https://blog.csdn.net/hhhhhhhhhhwwwwwwwwww/article/details/124434886
测试：https://wanghao.blog.csdn.net/article/details/124517210
在写这边文章之前，我已经翻译了论文，讲解了如何使用SWinIR进行测试？
接下来，我们讲讲如何SwinIR完成训练，有于作者训练了很多任务，我只复现其中的一种任务。
下载训练代码 地址：https://github.com/cszn/KAIR
这是个超分的库，里面包含多个超分的模型，比如SCUNet、VRT、SwinIR、BSRGGAN、USRNet等模型。
[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-B5Md9i7H-1651410061139)(https://gitee.com/wanghao1090220084/cloud-image/raw/master/img/face_09_comparison.png)]
下载后解压，训练SwinIR的REANDME.md,路径：./docs/README_SwinIR.md
数据集 训练和测试集可以下载如下。 请将它们分别放在 trainsets 和 testsets 中。
任务训练集测试集classical/lightweight image SRDIV2K (800 training images) or DIV2K &#43;Flickr2K (2650 images)set5 &#43; Set14 &#43; BSD100 &#43; Urban100 &#43; Manga109 download allreal-world image SRSwinIR-M (middle size):
DIV2K (800 training images) &#43;Flickr2K (2650 images) &#43; OST (10324 images,sky,water,grass,mountain,building,plant,animal) SwinIR-L (large size): DIV2K &#43; Flickr2K &#43; OST &#43; WED(4744 images) &#43; FFHQ (first 2000 images, face) &#43; Manga109 (manga) &#43; SCUT-CTW1500 (first 100 training images, texts) RealSRSet&#43;5imagescolor/grayscale image denoisingDIV2K (800 training images) &#43; Flickr2K (2650 images) &#43; BSD500 (400 training&amp;testing images) &#43; WED(4744 images)grayscale: Set12 &#43; BSD68 &#43; Urban100 color: CBSD68 &#43; Kodak24 &#43; McMaster &#43; Urban100 download allJPEG compression artifact reductionDIV2K (800 training images) &#43; Flickr2K (2650 images) &#43; BSD500 (400 training&amp;testing images) &#43; WED(4744 images)grayscale: Classic5 &#43;LIVE1 download all 我下载了DIV2K数据集和 Flickr2K数据集，DIV2K大小有7G&#43;，Flickr2K约20G。如果网速不好建议只下载DIV2K。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/c6483b1f5fbe070638add36c67b4a424/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-05-14T16:00:51+08:00" />
<meta property="article:modified_time" content="2022-05-14T16:00:51+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SwinIR实战：详细记录SwinIR的训练过程</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atelier-sulphurpool-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#SwinIRSwinIR_1" rel="nofollow">SwinIR实战：详细记录SwinIR的训练过程。</a></li><li><a href="#_19" rel="nofollow">下载训练代码</a></li><li><a href="#_33" rel="nofollow">数据集</a></li><li><a href="#_68" rel="nofollow">训练</a></li><li><a href="#_196" rel="nofollow">完整的代码：</a></li></ul> 
</div> 
<p></p> 
<h2><a id="SwinIRSwinIR_1"></a>SwinIR实战：详细记录SwinIR的训练过程。</h2> 
<p>论文地址：https://arxiv.org/pdf/2108.10257.pdf</p> 
<p>预训练模型下载：https://github.com/JingyunLiang/SwinIR/releases</p> 
<p>训练代码下载：https://github.com/cszn/KAIR</p> 
<p>测试代码：https://github.com/JingyunLiang/SwinIR</p> 
<p>论文翻译：https://blog.csdn.net/hhhhhhhhhhwwwwwwwwww/article/details/124434886</p> 
<p>测试：https://wanghao.blog.csdn.net/article/details/124517210</p> 
<p>在写这边文章之前，我已经翻译了论文，讲解了如何使用SWinIR进行测试？</p> 
<p>接下来，我们讲讲如何SwinIR完成训练，有于作者训练了很多任务，我只复现其中的一种任务。</p> 
<h2><a id="_19"></a>下载训练代码</h2> 
<p>地址：https://github.com/cszn/KAIR</p> 
<p>这是个超分的库，里面包含多个超分的模型，比如SCUNet、VRT、SwinIR、BSRGGAN、USRNet等模型。</p> 
<p><img src="https://images2.imgbox.com/2c/de/SuG0hiKx_o.png" alt="face_13_comparison"></p> 
<p><img src="https://images2.imgbox.com/41/e9/YIXnk0gt_o.png" alt="face_04_comparison"></p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-B5Md9i7H-1651410061139)(https://gitee.com/wanghao1090220084/cloud-image/raw/master/img/face_09_comparison.png)]</p> 
<p>下载后解压，训练SwinIR的REANDME.md,路径：./docs/README_SwinIR.md</p> 
<h2><a id="_33"></a>数据集</h2> 
<p>训练和测试集可以下载如下。 请将它们分别放在 <code>trainsets</code> 和 <code>testsets</code> 中。</p> 
<table><thead><tr><th align="left">任务</th><th align="left">训练集</th><th align="center">测试集</th></tr></thead><tbody><tr><td align="left">classical/lightweight image SR</td><td align="left"><a href="https://cv.snu.ac.kr/research/EDSR/DIV2K.tar" rel="nofollow">DIV2K</a> (800 training images) or DIV2K +<a href="https://cv.snu.ac.kr/research/EDSR/Flickr2K.tar" rel="nofollow">Flickr2K</a> (2650 images)</td><td align="center">set5 + Set14 + BSD100 + Urban100 + Manga109 <a href="https://drive.google.com/drive/folders/1B3DJGQKB6eNdwuQIhdskA64qUuVKLZ9u" rel="nofollow">download all</a></td></tr><tr><td align="left">real-world image SR</td><td align="left">SwinIR-M (middle size):<br> <a href="https://cv.snu.ac.kr/research/EDSR/DIV2K.tar" rel="nofollow">DIV2K</a> (800 training images) +<a href="https://cv.snu.ac.kr/research/EDSR/Flickr2K.tar" rel="nofollow">Flickr2K</a> (2650 images) + <a href="https://openmmlab.oss-cn-hangzhou.aliyuncs.com/datasets/OST_dataset.zip" rel="nofollow">OST</a> (10324 images,sky,water,grass,mountain,building,plant,animal) <br> SwinIR-L (large size): <br>DIV2K + Flickr2K + OST + <a href="http://ivc.uwaterloo.ca/database/WaterlooExploration/exploration_database_and_code.rar" rel="nofollow">WED</a>(4744 images) + <a href="https://drive.google.com/drive/folders/1tZUcXDBeOibC6jcMCtgRRz67pzrAHeHL" rel="nofollow">FFHQ</a> (first 2000 images, face) + Manga109 (manga) + <a href="https://universityofadelaide.box.com/shared/static/py5uwlfyyytbb2pxzq9czvu6fuqbjdh8.zip" rel="nofollow">SCUT-CTW1500</a> (first 100 training images, texts) <br></td><td align="center"><a href="https://github.com/JingyunLiang/SwinIR/releases/download/v0.0/RealSRSet+5images.zip">RealSRSet+5images</a></td></tr><tr><td align="left">color/grayscale image denoising</td><td align="left"><a href="https://cv.snu.ac.kr/research/EDSR/DIV2K.tar" rel="nofollow">DIV2K</a> (800 training images) + <a href="https://cv.snu.ac.kr/research/EDSR/Flickr2K.tar" rel="nofollow">Flickr2K</a> (2650 images) + <a href="http://www.eecs.berkeley.edu/Research/Projects/CS/vision/grouping/BSR/BSR_bsds500.tgz" rel="nofollow">BSD500</a> (400 training&amp;testing images) + <a href="http://ivc.uwaterloo.ca/database/WaterlooExploration/exploration_database_and_code.rar" rel="nofollow">WED</a>(4744 images)</td><td align="center">grayscale: Set12 + BSD68 + Urban100 <br> color: CBSD68 + Kodak24 + McMaster + Urban100 <a href="https://github.com/cszn/FFDNet/tree/master/testsets">download all</a></td></tr><tr><td align="left">JPEG compression artifact reduction</td><td align="left"><a href="https://cv.snu.ac.kr/research/EDSR/DIV2K.tar" rel="nofollow">DIV2K</a> (800 training images) + <a href="https://cv.snu.ac.kr/research/EDSR/Flickr2K.tar" rel="nofollow">Flickr2K</a> (2650 images) + <a href="http://www.eecs.berkeley.edu/Research/Projects/CS/vision/grouping/BSR/BSR_bsds500.tgz" rel="nofollow">BSD500</a> (400 training&amp;testing images) + <a href="http://ivc.uwaterloo.ca/database/WaterlooExploration/exploration_database_and_code.rar" rel="nofollow">WED</a>(4744 images)</td><td align="center">grayscale: Classic5 +LIVE1 <a href="https://github.com/cszn/DnCNN/tree/master/testsets">download all</a></td></tr></tbody></table> 
<p>我下载了DIV2K数据集和 Flickr2K数据集，DIV2K大小有7G+，Flickr2K约20G。如果网速不好建议只下载DIV2K。</p> 
<p>注：在选用classical任务，做训练时，只能使用DIV2K或者Flickr2K，不能把两种数据集放在一起训练，否则就出现维度对不上的情况，如下图：</p> 
<p><img src="https://images2.imgbox.com/d4/46/QXcpgn7x_o.png" alt="image-20220501075409750"></p> 
<p>暂时没有找到原因。</p> 
<p>构建测试集，测试集的路径如下图：</p> 
<p><img src="https://images2.imgbox.com/40/04/SWzneLnP_o.png" alt="image-20220501200746759"></p> 
<p>由于表格中的测试集放在google，我不能下载，但是SwinIR的测试代码中有测试集，代码链接：https://github.com/JingyunLiang/SwinIR，下载下来直接复制到testsets文件夹下面。</p> 
<p>构建训练集，将下载下来的DIV2K解压。将DIV2K_train_HR复制到trainsets文件夹下面，将其改为trainH。</p> 
<p><img src="https://images2.imgbox.com/72/72/DJGMhQSq_o.png" alt="image-20220501201617513"></p> 
<p>将DIV2K_train_LR_bicubic文件夹的X2文件夹复制到trainsets文件夹下面，然后将其改名为trainL。</p> 
<p><img src="https://images2.imgbox.com/85/a0/13CqwHo6_o.png" alt="image-20220501202215478"></p> 
<p>到这里，数据集部分就完成了，接下来开始训练。</p> 
<h2><a id="_68"></a>训练</h2> 
<p>首先，打开options/swinir/train_swinir_sr_classical.json文件，查看里面的内容。</p> 
<pre><code class="prism language-python"><span class="token string">"task"</span><span class="token punctuation">:</span> <span class="token string">"swinir_sr_classical_patch48_x2"</span> 
</code></pre> 
<p>训练任务的名字。</p> 
<pre><code class="prism language-python"><span class="token string">"gpu_ids"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span>
</code></pre> 
<p>选择GPU的ID，如果只有一快GPU，改为 [0]。如果有更多的GPU，直接往后面添加即可。</p> 
<pre><code class="prism language-python"><span class="token string">"scale"</span><span class="token punctuation">:</span> <span class="token number">2</span>  <span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">48</span>
</code></pre> 
<p>放大的倍数，可以设置为2、3、4、8.</p> 
<pre><code class="prism language-python"><span class="token string">"datasets"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
  <span class="token string">"train"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"train_dataset"</span>           <span class="token operator">//</span> just name
    <span class="token punctuation">,</span> <span class="token string">"dataset_type"</span><span class="token punctuation">:</span> <span class="token string">"sr"</span>         <span class="token operator">//</span> <span class="token string">"dncnn"</span> <span class="token operator">|</span> <span class="token string">"dnpatch"</span> <span class="token operator">|</span> <span class="token string">"fdncnn"</span> <span class="token operator">|</span> <span class="token string">"ffdnet"</span> <span class="token operator">|</span> <span class="token string">"sr"</span> <span class="token operator">|</span> <span class="token string">"srmd"</span> <span class="token operator">|</span> <span class="token string">"dpsr"</span> <span class="token operator">|</span> <span class="token string">"plain"</span> <span class="token operator">|</span> <span class="token string">"plainpatch"</span> <span class="token operator">|</span> <span class="token string">"jpeg"</span>
    <span class="token punctuation">,</span> <span class="token string">"dataroot_H"</span><span class="token punctuation">:</span> <span class="token string">"trainsets/trainH"</span><span class="token operator">//</span> path of H training dataset<span class="token punctuation">.</span> DIV2K <span class="token punctuation">(</span><span class="token number">800</span> training images<span class="token punctuation">)</span>
    <span class="token punctuation">,</span> <span class="token string">"dataroot_L"</span><span class="token punctuation">:</span> <span class="token string">"trainsets/trainL"</span>              <span class="token operator">//</span> path of L training dataset

    <span class="token punctuation">,</span> <span class="token string">"H_size"</span><span class="token punctuation">:</span> <span class="token number">96</span>                   <span class="token operator">//</span> <span class="token number">96</span><span class="token operator">/</span><span class="token number">144</span><span class="token operator">|</span><span class="token number">192</span><span class="token operator">/</span><span class="token number">384</span> <span class="token operator">|</span> <span class="token number">128</span><span class="token operator">/</span><span class="token number">192</span><span class="token operator">/</span><span class="token number">256</span><span class="token operator">/</span><span class="token number">512.</span> LR patch size <span class="token keyword">is</span> <span class="token builtin">set</span> to <span class="token number">48</span> <span class="token keyword">or</span> <span class="token number">64</span> when compared <span class="token keyword">with</span> RCAN <span class="token keyword">or</span> RRDB<span class="token punctuation">.</span>

    <span class="token punctuation">,</span> <span class="token string">"dataloader_shuffle"</span><span class="token punctuation">:</span> true
    <span class="token punctuation">,</span> <span class="token string">"dataloader_num_workers"</span><span class="token punctuation">:</span> <span class="token number">4</span>
    <span class="token punctuation">,</span> <span class="token string">"dataloader_batch_size"</span><span class="token punctuation">:</span> <span class="token number">1</span>      <span class="token operator">//</span> batch size <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">16</span> <span class="token operator">|</span> <span class="token number">32</span> <span class="token operator">|</span> <span class="token number">48</span> <span class="token operator">|</span> <span class="token number">64</span> <span class="token operator">|</span> <span class="token number">128.</span> Total batch size <span class="token operator">=</span>4x8<span class="token operator">=</span><span class="token number">32</span> <span class="token keyword">in</span> SwinIR
  <span class="token punctuation">}</span>
  <span class="token punctuation">,</span> <span class="token string">"test"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"test_dataset"</span>            <span class="token operator">//</span> just name
    <span class="token punctuation">,</span> <span class="token string">"dataset_type"</span><span class="token punctuation">:</span> <span class="token string">"sr"</span>         <span class="token operator">//</span> <span class="token string">"dncnn"</span> <span class="token operator">|</span> <span class="token string">"dnpatch"</span> <span class="token operator">|</span> <span class="token string">"fdncnn"</span> <span class="token operator">|</span> <span class="token string">"ffdnet"</span> <span class="token operator">|</span> <span class="token string">"sr"</span> <span class="token operator">|</span> <span class="token string">"srmd"</span> <span class="token operator">|</span> <span class="token string">"dpsr"</span> <span class="token operator">|</span> <span class="token string">"plain"</span> <span class="token operator">|</span> <span class="token string">"plainpatch"</span> <span class="token operator">|</span> <span class="token string">"jpeg"</span>
    <span class="token punctuation">,</span> <span class="token string">"dataroot_H"</span><span class="token punctuation">:</span> <span class="token string">"testsets/Set5/HR"</span>  <span class="token operator">//</span> path of H testing dataset
    <span class="token punctuation">,</span> <span class="token string">"dataroot_L"</span><span class="token punctuation">:</span> <span class="token string">"testsets/Set5/LR_bicubic/X2"</span>              <span class="token operator">//</span> path of L testing dataset

  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>上面的参数是对数据集的设置。<br> “H_size”: 96 ，HR图像的大小，和下面的img_size有对应关系，大小设置为img_size×scale。</p> 
<p>“dataloader_num_workers”: 4，CPU的核数设置。</p> 
<p>“dataloader_batch_size”: 32 ，设置训练的batch_size。</p> 
<p>dataset_type：sr，指的是数据集类型SwinIR。</p> 
<pre><code class="prism language-python"><span class="token string">"netG"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"net_type"</span><span class="token punctuation">:</span> <span class="token string">"swinir"</span> 
    <span class="token punctuation">,</span> <span class="token string">"upscale"</span><span class="token punctuation">:</span> <span class="token number">2</span>                      <span class="token operator">//</span> <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">3</span>  <span class="token operator">|</span> <span class="token number">4</span> <span class="token operator">|</span> <span class="token number">8</span>
    <span class="token punctuation">,</span> <span class="token string">"in_chans"</span><span class="token punctuation">:</span> <span class="token number">3</span> 
    <span class="token punctuation">,</span> <span class="token string">"img_size"</span><span class="token punctuation">:</span> <span class="token number">48</span>                    <span class="token operator">//</span> For fair comparison<span class="token punctuation">,</span> LR patch size <span class="token keyword">is</span> <span class="token builtin">set</span> to <span class="token number">48</span> <span class="token keyword">or</span> <span class="token number">64</span> when compared <span class="token keyword">with</span> RCAN <span class="token keyword">or</span> RRDB<span class="token punctuation">.</span>
    <span class="token punctuation">,</span> <span class="token string">"window_size"</span><span class="token punctuation">:</span> <span class="token number">8</span>  
    <span class="token punctuation">,</span> <span class="token string">"img_range"</span><span class="token punctuation">:</span> <span class="token number">1.0</span> 
    <span class="token punctuation">,</span> <span class="token string">"depths"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span> 
    <span class="token punctuation">,</span> <span class="token string">"embed_dim"</span><span class="token punctuation">:</span> <span class="token number">180</span> 
    <span class="token punctuation">,</span> <span class="token string">"num_heads"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span>
    <span class="token punctuation">,</span> <span class="token string">"mlp_ratio"</span><span class="token punctuation">:</span> <span class="token number">2</span> 
    <span class="token punctuation">,</span> <span class="token string">"upsampler"</span><span class="token punctuation">:</span> <span class="token string">"pixelshuffle"</span>        <span class="token operator">//</span> <span class="token string">"pixelshuffle"</span> <span class="token operator">|</span> <span class="token string">"pixelshuffledirect"</span> <span class="token operator">|</span> <span class="token string">"nearest+conv"</span> <span class="token operator">|</span> null
    <span class="token punctuation">,</span> <span class="token string">"resi_connection"</span><span class="token punctuation">:</span> <span class="token string">"1conv"</span>        <span class="token operator">//</span> <span class="token string">"1conv"</span> <span class="token operator">|</span> <span class="token string">"3conv"</span>
    <span class="token punctuation">,</span> <span class="token string">"init_type"</span><span class="token punctuation">:</span> <span class="token string">"default"</span>
  <span class="token punctuation">}</span>
</code></pre> 
<p>upscale：2，放大的倍数，和上面的scale参数对应。</p> 
<p>img_size：48，这里可以设置两个数值，48和64。和测试的training_patch_size参数对应。</p> 
<p>官方提供的指令是基于DDP方式，比较复杂一下，好处是速度快。如下：</p> 
<pre><code># 001 Classical Image SR (middle size)
python -m torch.distributed.launch --nproc_per_node=8 --master_port=1234 main_train_psnr.py --opt options/swinir/train_swinir_sr_classical.json  --dist True

# 002 Lightweight Image SR (small size)
python -m torch.distributed.launch --nproc_per_node=8 --master_port=1234 main_train_psnr.py --opt options/swinir/train_swinir_sr_lightweight.json  --dist True

# 003 Real-World Image SR (middle size)
python -m torch.distributed.launch --nproc_per_node=8 --master_port=1234 main_train_psnr.py --opt options/swinir/train_swinir_sr_realworld_psnr.json  --dist True
# before training gan, put the PSNR-oriented model into superresolution/swinir_sr_realworld_x4_gan/models/
python -m torch.distributed.launch --nproc_per_node=8 --master_port=1234 main_train_psnr.py --opt options/swinir/train_swinir_sr_realworld_gan.json  --dist True

# 004 Grayscale Image Deoising (middle size)
python -m torch.distributed.launch --nproc_per_node=8 --master_port=1234 main_train_psnr.py --opt options/swinir/train_swinir_denoising_gray.json  --dist True

# 005 Color Image Deoising (middle size)
python -m torch.distributed.launch --nproc_per_node=8 --master_port=1234 main_train_psnr.py --opt options/swinir/train_swinir_denoising_color.json  --dist True

# 006 JPEG Compression Artifact Reduction (middle size)
python -m torch.distributed.launch --nproc_per_node=8 --master_port=1234 main_train_psnr.py --opt options/swinir/train_swinir_car_jpeg.json  --dist True
</code></pre> 
<p>我没有使用上面的方式，而是选择用DP的方式，虽然慢一点，但是简单，更稳定。</p> 
<p>在Terminal里面输入：</p> 
<pre><code class="prism language-python">python main_train_psnr<span class="token punctuation">.</span>py <span class="token operator">-</span><span class="token operator">-</span>opt options<span class="token operator">/</span>swinir<span class="token operator">/</span>train_swinir_sr_classical<span class="token punctuation">.</span>json
</code></pre> 
<p>即可开始训练。</p> 
<p>运行结果如下：</p> 
<p><img src="https://images2.imgbox.com/40/07/lMZSX3Y5_o.png" alt="image-20220501205428982"></p> 
<p>等待训练完成后，我们使用测试代码测试。将模型复制到./model_zoo/swinir文件夹下面</p> 
<p><img src="https://images2.imgbox.com/35/3a/Waozd1zD_o.png" alt="image-20220501205611736"></p> 
<p>输入命令：</p> 
<pre><code class="prism language-python">python main_test_swinir<span class="token punctuation">.</span>py <span class="token operator">-</span><span class="token operator">-</span>task classical_sr <span class="token operator">-</span><span class="token operator">-</span>scale <span class="token number">2</span> <span class="token operator">-</span><span class="token operator">-</span>training_patch_size <span class="token number">48</span> <span class="token operator">-</span><span class="token operator">-</span>model_path model_zoo<span class="token operator">/</span>swinir<span class="token operator">/</span>45000_G<span class="token punctuation">.</span>pth <span class="token operator">-</span><span class="token operator">-</span>folder_lq testsets<span class="token operator">/</span>Set5<span class="token operator">/</span>LR_bicubic<span class="token operator">/</span>X2 
</code></pre> 
<p>然后在result下面可以看到测试结果。</p> 
<p><img src="https://images2.imgbox.com/7f/c2/ebqfuCOP_o.png" alt="image-20220501210025110"></p> 
<h2><a id="_196"></a>完整的代码：</h2> 
<p>https://download.csdn.net/download/hhhhhhhhhhwwwwwwwwww/85258387</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2b72269e0d822da883e42e214811f812/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Debugger executable ‘/usr/local/bin/x86_64-elf-gdb‘ is not signed. &amp;&amp; 在汇编文件中打断点</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4948cbe4675311065a5a849dce805053/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Day4 多线程下对druid的测试</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>