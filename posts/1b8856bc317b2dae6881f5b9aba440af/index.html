<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>cv基础算法02-VGG - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="cv基础算法02-VGG" />
<meta property="og:description" content="东阳的学习记录，坚持就是胜利！
文章目录 研究意义网络结构5个结构的相同点和不同点深度的增加并不会带来参数数量的大量增加Vgg16结构示意图Vgg的pytorch官方实现 Vgg的特点模型训练细节数据增强尺度扰动 模型初始化 模型测试细节多尺度测试稠密测试Multi-Crop测试Multi-crop &amp; Dense 结果分析单尺度评估多尺度评估 模型融合（什么是模型融合）论文的关键点/创新点思考与展望 研究意义 开启小卷积核时代：3*3卷积核成为主流模型作为各类图像任务的骨干网络结构：分类、定位、检测、分割一系列图像任务大都有VGG为骨干网络的尝试 网络结构 VGG的网络结构如下：
由上图可以看到，论文共给出了5个结构（其中D为Vgg16, E为Vgg19）。
5个结构的相同点和不同点 相同点：
5个maxpool（降低分辨率）maxpool后，特征图通道数翻倍直至达到最大值5123个FC层进行分类输出maxpool之间采用多个卷积层堆叠，对特征进行提取和抽象
为什么从11层开始？（具体原因不知道）
Goodfellow et al. (2014) applied deep ConvNets (11 weight layers) to the task of street number recognition 不同点：
A：11层卷积
A-LRN：基于A增加一个LRN
B： 第1，2个block中增加1个卷积33卷积
C： 第3， 4， 5个block分别增加1个11卷积，表明增加非线性有益于指标提升（每增加一层卷积伴随着一个ReLU层）
D：第3， 4， 5个block的11卷积替换为33，
E：第3， 4， 5个block再分别增加1个3*3卷积
深度的增加并不会带来参数数量的大量增加 下图为参数数量及其计算过程
Vgg16结构示意图 Vgg的pytorch官方实现 class VGG(nn.Module): def __init__(self, features, num_classes=1000, init_weights=True): super(VGG, self).__init__() self.features = features self.avgpool = nn." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/1b8856bc317b2dae6881f5b9aba440af/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-08-16T16:12:41+08:00" />
<meta property="article:modified_time" content="2020-08-16T16:12:41+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">cv基础算法02-VGG</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>东阳的学习记录，坚持就是胜利！</p> 
</blockquote> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#_4" rel="nofollow">研究意义</a></li><li><a href="#_9" rel="nofollow">网络结构</a></li><li><ul><li><a href="#5_14" rel="nofollow">5个结构的相同点和不同点</a></li><li><a href="#_33" rel="nofollow">深度的增加并不会带来参数数量的大量增加</a></li><li><a href="#Vgg16_37" rel="nofollow">Vgg16结构示意图</a></li><li><a href="#Vggpytorch_39" rel="nofollow">Vgg的pytorch官方实现</a></li></ul> 
   </li><li><a href="#Vgg_126" rel="nofollow">Vgg的特点</a></li><li><a href="#_139" rel="nofollow">模型训练细节</a></li><li><ul><li><a href="#_140" rel="nofollow">数据增强</a></li><li><ul><li><a href="#_149" rel="nofollow">尺度扰动</a></li></ul> 
    </li><li><a href="#_152" rel="nofollow">模型初始化</a></li></ul> 
   </li><li><a href="#_162" rel="nofollow">模型测试细节</a></li><li><ul><li><a href="#_164" rel="nofollow">多尺度测试</a></li><li><a href="#_173" rel="nofollow">稠密测试</a></li><li><a href="#MultiCrop_179" rel="nofollow">Multi-Crop测试</a></li><li><a href="#Multicrop__Dense_182" rel="nofollow">Multi-crop &amp; Dense</a></li></ul> 
   </li><li><a href="#_185" rel="nofollow">结果分析</a></li><li><ul><li><a href="#_187" rel="nofollow">单尺度评估</a></li><li><a href="#_193" rel="nofollow">多尺度评估</a></li></ul> 
   </li><li><a href="#_197" rel="nofollow">模型融合（什么是模型融合）</a></li><li><a href="#_206" rel="nofollow">论文的关键点/创新点</a></li><li><a href="#_211" rel="nofollow">思考与展望</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="_4"></a>研究意义</h3> 
<ol><li>开启小卷积核时代：3*3卷积核成为主流模型</li><li>作为各类图像任务的骨干网络结构：分类、定位、检测、分割一系列图像任务大都有VGG为骨干网络的尝试</li></ol> 
<h3><a id="_9"></a>网络结构</h3> 
<p>VGG的网络结构如下：<br> <img src="https://images2.imgbox.com/45/f5/bLfyDAWL_o.png" alt="在这里插入图片描述"><br> 由上图可以看到，论文共给出了5个结构（其中D为Vgg16, E为Vgg19）。</p> 
<h4><a id="5_14"></a>5个结构的相同点和不同点</h4> 
<p>相同点：</p> 
<ol><li>5个maxpool（降低分辨率）</li><li>maxpool后，特征图通道数翻倍直至达到最大值512</li><li>3个FC层进行分类输出</li><li>maxpool之间采用多个卷积层堆叠，对特征进行提取和抽象<br> 为什么从11层开始？（具体原因不知道）<br> Goodfellow et al. (2014) applied deep ConvNets (11 weight layers) to the task of street number recognition</li></ol> 
<p>不同点：</p> 
<p>A：11层卷积<br> A-LRN：基于A增加一个LRN<br> B： 第1，2个block中增加1个卷积3<em>3卷积<br> C： 第3， 4， 5个block分别增加1个1</em>1卷积，表明增加非线性有益于指标提升（每增加一层卷积伴随着一个ReLU层）<br> D：第3， 4， 5个block的1<em>1卷积替换为3</em>3，<br> E：第3， 4， 5个block再分别增加1个3*3卷积</p> 
<h4><a id="_33"></a>深度的增加并不会带来参数数量的大量增加</h4> 
<p>下图为参数数量及其计算过程<br> <img src="https://images2.imgbox.com/a8/38/bjU0uTjN_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/34/11/AaAxomWY_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="Vgg16_37"></a>Vgg16结构示意图</h4> 
<p><img src="https://images2.imgbox.com/c7/d1/ia04vM94_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="Vggpytorch_39"></a>Vgg的pytorch官方实现</h4> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">VGG</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> features<span class="token punctuation">,</span> num_classes<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span> init_weights<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>VGG<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>features <span class="token operator">=</span> features
        self<span class="token punctuation">.</span>avgpool <span class="token operator">=</span> nn<span class="token punctuation">.</span>AdaptiveAvgPool2d<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>classifier <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>
            nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">512</span> <span class="token operator">*</span> <span class="token number">7</span> <span class="token operator">*</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">4096</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            nn<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">4096</span><span class="token punctuation">,</span> <span class="token number">4096</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            nn<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">4096</span><span class="token punctuation">,</span> num_classes<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span>
        <span class="token keyword">if</span> init_weights<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_initialize_weights<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>features<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>avgpool<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        x <span class="token operator">=</span> torch<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>classifier<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        <span class="token keyword">return</span> x

    <span class="token keyword">def</span> <span class="token function">_initialize_weights</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> m <span class="token keyword">in</span> self<span class="token punctuation">.</span>modules<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">)</span><span class="token punctuation">:</span>
                nn<span class="token punctuation">.</span>init<span class="token punctuation">.</span>kaiming_normal_<span class="token punctuation">(</span>m<span class="token punctuation">.</span>weight<span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'fan_out'</span><span class="token punctuation">,</span> nonlinearity<span class="token operator">=</span><span class="token string">'relu'</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> m<span class="token punctuation">.</span>bias <span class="token keyword">is</span> <span class="token operator">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                    nn<span class="token punctuation">.</span>init<span class="token punctuation">.</span>constant_<span class="token punctuation">(</span>m<span class="token punctuation">.</span>bias<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword">elif</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">)</span><span class="token punctuation">:</span>
                nn<span class="token punctuation">.</span>init<span class="token punctuation">.</span>constant_<span class="token punctuation">(</span>m<span class="token punctuation">.</span>weight<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
                nn<span class="token punctuation">.</span>init<span class="token punctuation">.</span>constant_<span class="token punctuation">(</span>m<span class="token punctuation">.</span>bias<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword">elif</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">)</span><span class="token punctuation">:</span>
                nn<span class="token punctuation">.</span>init<span class="token punctuation">.</span>normal_<span class="token punctuation">(</span>m<span class="token punctuation">.</span>weight<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.01</span><span class="token punctuation">)</span>
                nn<span class="token punctuation">.</span>init<span class="token punctuation">.</span>constant_<span class="token punctuation">(</span>m<span class="token punctuation">.</span>bias<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">make_layers</span><span class="token punctuation">(</span>cfg<span class="token punctuation">,</span> batch_norm<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    layers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    in_channels <span class="token operator">=</span> <span class="token number">3</span>
    <span class="token keyword">for</span> v <span class="token keyword">in</span> cfg<span class="token punctuation">:</span>
        <span class="token keyword">if</span> v <span class="token operator">==</span> <span class="token string">'M'</span><span class="token punctuation">:</span>
            layers <span class="token operator">+=</span> <span class="token punctuation">[</span>nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span>kernel_size<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            conv2d <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>in_channels<span class="token punctuation">,</span> v<span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> batch_norm<span class="token punctuation">:</span>
                layers <span class="token operator">+=</span> <span class="token punctuation">[</span>conv2d<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                layers <span class="token operator">+=</span> <span class="token punctuation">[</span>conv2d<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
            in_channels <span class="token operator">=</span> v
    <span class="token keyword">return</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span><span class="token operator">*</span>layers<span class="token punctuation">)</span>


cfgs <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'A'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token string">'M'</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token string">'M'</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token string">'M'</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token string">'M'</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token string">'M'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'B'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token string">'M'</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token string">'M'</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token string">'M'</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token string">'M'</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token string">'M'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'D'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token string">'M'</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token string">'M'</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token string">'M'</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token string">'M'</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token string">'M'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'E'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token string">'M'</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token string">'M'</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token string">'M'</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token string">'M'</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token string">'M'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>


<span class="token keyword">def</span> <span class="token function">_vgg</span><span class="token punctuation">(</span>arch<span class="token punctuation">,</span> cfg<span class="token punctuation">,</span> batch_norm<span class="token punctuation">,</span> pretrained<span class="token punctuation">,</span> progress<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> pretrained<span class="token punctuation">:</span>
        kwargs<span class="token punctuation">[</span><span class="token string">'init_weights'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">False</span>
    model <span class="token operator">=</span> VGG<span class="token punctuation">(</span>make_layers<span class="token punctuation">(</span>cfgs<span class="token punctuation">[</span>cfg<span class="token punctuation">]</span><span class="token punctuation">,</span> batch_norm<span class="token operator">=</span>batch_norm<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
    <span class="token keyword">if</span> pretrained<span class="token punctuation">:</span>
        state_dict <span class="token operator">=</span> load_state_dict_from_url<span class="token punctuation">(</span>model_urls<span class="token punctuation">[</span>arch<span class="token punctuation">]</span><span class="token punctuation">,</span>
                                              progress<span class="token operator">=</span>progress<span class="token punctuation">)</span>
        model<span class="token punctuation">.</span>load_state_dict<span class="token punctuation">(</span>state_dict<span class="token punctuation">)</span>
    <span class="token keyword">return</span> model


<span class="token keyword">def</span> <span class="token function">vgg11</span><span class="token punctuation">(</span>pretrained<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> progress<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    r<span class="token triple-quoted-string string">"""VGG 11-layer model (configuration "A") from
    `"Very Deep Convolutional Networks For Large-Scale Image Recognition" &lt;https://arxiv.org/pdf/1409.1556.pdf&gt;`_

    Args:
        pretrained (bool): If True, returns a model pre-trained on ImageNet
        progress (bool): If True, displays a progress bar of the download to stderr
    """</span>
    <span class="token keyword">return</span> _vgg<span class="token punctuation">(</span><span class="token string">'vgg11'</span><span class="token punctuation">,</span> <span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> pretrained<span class="token punctuation">,</span> progress<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
</code></pre> 
<h3><a id="Vgg_126"></a>Vgg的特点</h3> 
<ol><li>使用3<em>3卷积核的堆叠代替大卷积核（7</em>7， 11*11）</li><li>增加了网络的非线性，由此增强了模型的泛化能力（因每一个3*3卷积都会附带一个非线性ReLU层）</li><li>减少了训练参数（小卷积核）</li><li>3<em>3卷积核可以看作是7</em>7卷积核的正则化，强迫7<em>7分解为3</em>3</li></ol> 
<p>假设输入，输出通道均为C个通道<br> 一个7<em>7卷积核所需参数量：7</em>7<em>C</em>C= 49C^2<br> 三个3<em>3卷积核所需参数量：3</em>(3<em>3</em>C*C)=27C^2<br> 参数减少比： （49-27）/ 49 ≈ 44%</p> 
<p>模型C相比于模型B，增加了1<em>1卷积核。（C比B的表现要好，那为什么不在D， E上也加上1</em>1卷积核呢）</p> 
<h3><a id="_139"></a>模型训练细节</h3> 
<h4><a id="_140"></a>数据增强</h4> 
<p>Vgg论文中的数据增强方法主要包括两种：</p> 
<ol><li>针对位置： 
  <ul><li>按比例缩放图片至最小边为S（保持长宽比）</li><li>随机位置裁减出队224*224区域</li><li>随机水平翻转</li></ul> </li><li>针对颜色 
  <ul><li>修改RGB通道的像素值，实现颜色扰动</li></ul> </li></ol> 
<h5><a id="_149"></a>尺度扰动</h5> 
<p>上述S的设置有两种方法：一是设置为固定值（256、384）；二是，随机值（尺度波动）</p> 
<h4><a id="_152"></a>模型初始化</h4> 
<p>论文提出：深度神经网络对初始化敏感，<br> （3.1）The initialisation of the network weights is important, since bad initialisation can stall learning due to the instability of gradient in deep nets.</p> 
<ol><li>深度加深时，用浅层网络初始化<br> B，C，D，E用A模型初始化</li><li>Multi-scale训练时，用小尺度初始化 
  <ul><li>S=384时，用S=256模型初始化</li><li>S=[256, 512]时，用S=384模型初始化（什么是Xavier）</li></ul> </li></ol> 
<h3><a id="_162"></a>模型测试细节</h3> 
<h4><a id="_164"></a>多尺度测试</h4> 
<p>图片等比例缩放至最短边为Q，设置三个Q，对图片进行预测，取平均</p> 
<p>方法1 当S为固定值时:<br> Q = [S-32, S, S+32]</p> 
<p>方法2 当S为随机值时：<br> Q = (S_min, 0.5*(S_min + S_max), S_max）</p> 
<h4><a id="_173"></a>稠密测试</h4> 
<p><code>稠密测试（Dense test）:</code>将FC层转换为卷积操作，变为全卷积网络，实现任意尺寸的图片输入<br> <img src="https://images2.imgbox.com/a4/fb/sFI97gzk_o.png" alt="在这里插入图片描述"></p> 
<ol><li>经过全卷积网络得到 N<em>N</em>1000 特征图</li><li>在通道维度上求和（sum pool）计算平均值，得到1*1000 输出向量<br> <img src="https://images2.imgbox.com/c7/af/Oyu3NRBl_o.png" alt="在这里插入图片描述"></li></ol> 
<h4><a id="MultiCrop_179"></a>Multi-Crop测试</h4> 
<p>借鉴AlexNet与GoogLeNet，对图片进行Multi-crop，裁剪大小为224*224，并水平翻转1张图，缩放至3种尺寸，然后每种尺寸裁减出50张图片；50 = 5 * 5 * 2</p> 
<h4><a id="Multicrop__Dense_182"></a>Multi-crop &amp; Dense</h4> 
<p>取两种方法的平均。</p> 
<h3><a id="_185"></a>结果分析</h3> 
<p><img src="https://images2.imgbox.com/1a/c1/4jm7cO7H_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_187"></a>单尺度评估</h4> 
<ol><li>误差随深度加深而降低，当模型到达19层时，误差饱和，不再下降</li><li>增加1*1有助于性能提升（模型C和B之间比较）</li><li>训练时加入尺度扰动，有助于性能提升（由上图可以看到，加上尺度扰动后的性能比不加优）</li><li>B模型中，3<em>3替换为5</em>5卷积，top1下降7%</li></ol> 
<h4><a id="_193"></a>多尺度评估</h4> 
<p><img src="https://images2.imgbox.com/27/62/IbjMCDjg_o.png" alt="在这里插入图片描述"><br> 由上图卷红处对比，不难得出：<code>测试时采用Scale jittering有助于性能提升</code></p> 
<h3><a id="_197"></a>模型融合（什么是模型融合）</h3> 
<p><img src="https://images2.imgbox.com/30/b3/1BtfYncS_o.png" alt="在这里插入图片描述"><br> ILSVRC中提交的模型为7个模型融合</p> 
<p>采用最优的两个模型<br> D/[256, 512]/256,384, 512<br> E/[256, 512]/256,384, 512<br> 结合multi-crop和dense，得到最优结果</p> 
<h3><a id="_206"></a>论文的关键点/创新点</h3> 
<ol><li>堆叠小卷积核，加深网络（使用两个3<em>3代替一个5</em>5，三个3<em>3代替一个7</em>7）</li><li>训练阶段，尺度扰动</li><li>测试阶段，多尺度及Dense+Multi crop</li></ol> 
<h3><a id="_211"></a>思考与展望</h3> 
<ol><li> <p><code>采用小卷积核</code>，有点像大卷积核的正则化，可以大大减少参数量（3个3<em>3卷积核比1个7</em>7卷积核减少81%的参数）<br> This can be seen as imposing a regularisation on the 7 × 7 conv. filters, forcing them to<br> have a decomposition through the 3 × 3 filters (with non-linearity injected （ReLU） in between)（1 Introduction p2）</p> </li><li> <p>采用多尺度及稠密预测，获得高精度<br> Another line of improvements dealt with training and testing the networks densely over the whole image and over multiple scales. (1 Introduction p2)</p> </li><li> <p><code>1*1卷积可认为是线性变换，同时增加非线性层</code>（ReLU）<br> In one of the configurations we also utilise 1 × 1 convolution filters, which can be seen as a linear transformation of the input channels (followed by non-linearity). (2.1 Architecture p1)</p> </li><li> <p><code>padding大小设置准则</code>：保持卷积后特征图分辨率不变（便于计算特征图的大小）<br> the spatial padding of conv. layer input is such that the spatial resolution is preserved after convolution (2.1 Architecture p1)</p> </li><li> <p>LRN对精度无提升（在后续的论文中基本弃用了LRN）<br> such normalisation does not improve the performance on the ILSVRC dataset, but leads to increased memory con- sumption and computation time. (2.1 Architecture p3)</p> </li><li> <p><code>Xavier初始化可达较好效果</code>（什么是Xavier?）<br> It is worth noting that after the paper submission we found that it is possible to initialise the weights without pre-training by using the random initialisation procedure of Glorot &amp; Bengio (2010).（3.1 Trainning p2）</p> </li><li> <p>S远大于224，图片可能仅包含物体的一部分（多尺度训练可以提升训练效果）<br> S ≫ 224 the crop will correspond to a small part of the image, containing a small object or an object part （3.1 Trainning p4）</p> </li><li> <p>大尺度模型采用小尺度模型初始化，可加快收敛<br> To speed-up training of the S = 384 network, it was initialised with the weights pre-trained with S = 256, and we used a smaller initial learning rate of 0.001. (3.1 Trainning p5)</p> </li><li> <p>物体尺寸不一，因此采用多尺度训练，可以提高精度（这里先留个疑问，好像有个<code>金字塔</code>模型，对这个有实现）<br> Since objects in images can be of different size, multi scale training is beneficial to take this into account during training.(3.1 Trainning p6)</p> </li><li> <p>测试时不需要使用multi crop， 存在重复计算，因而低效<br> there is no need to sample multiple crops at test time (Krizhevsky et al., 2012), which is less efficient as it requires network re-computation for each crop.(3.2 Testing p2)</p> </li><li> <p>multi crop可看成dense的补充，因为它们边界处理有所不同<br> Also, multi-crop evaluation is complementary to dense evaluation due to different convolution boundary conditions (3.2 Testing p2)</p> </li><li> <p><code>小而深的卷积网络优于大而浅的卷积网络</code><br> which confirms that a deep net with small filters outperforms a shallow net with larger filters. （4.1 Single scale evaluation p3）</p> </li><li> <p><code>尺度扰动</code>对训练和测试阶段有帮助<br> The results, presented in Table 4, indicate that scale jittering at test time leads to better performance（4.2 Multi scale evaluation p2）</p> </li></ol>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e7eca1c3c6898df71bf92ea925589df2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">《啊哈！算法》第二章 - 第一节 - 解密QQ号（Java实现）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1fb38a94a38eeb11cfeb42a5f2362bbe/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">shell报错：-bash: [: ==: 期待一元表达式 解决方法 ([: ==: unary operator expected)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>