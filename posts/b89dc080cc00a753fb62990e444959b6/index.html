<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Hyperledger Fabric搭建测试网络 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Hyperledger Fabric搭建测试网络" />
<meta property="og:description" content="本文使用的Fabric版本：V2.5.4
Ubuntu系统：16.04LTS
前序文章已经详细介绍了如何安装部署Hyperledger Fabric系统，这里不再赘述。本篇文章主要介绍如何使用Fabric的测试网络。在正式开始之前，有一点需要说明：
Hyperledger Fabric的完整安装路径如下： $HOME/go/src/github.com/hyperledger/fabric 为了方便，下文cd命令中的路径从fabric开始书写，fabric之前的省略。
1 启动/关闭测试网络 为了方便开发人员学习及测试智能合约和DApp，fabric-samples文件中提供了一个测试网络test-network。
1.1 启动测试网络 进入fabric/scripts/fabric-samples/test-network，可以执行如下命令启动测试网络：
cd fabric/scripts/fabric-samples/test-network ./network.sh up 如果命令在执行过程中遇到“permission denied&#34;提示，则使用sudo权限执行第二条命令：
sudo ./network.sh up 执行成功将看到以下提示信息：
从图中可以看到，这个测试网络包括一个Orderer节点、两个Peer节点和一个CLI客户端(这些都部署在docker容器中)，其中这两个Peer节点分属两个组织：Org1和Org2。
1.2 关闭测试网络 可以使用以下命令关闭测试网络：
sudo ./network.sh down Tips:测试网络关闭之后，创建的通道、部署的链码以及配置的环境变量都会失效，都要重新设置。
1.3 重启测试网络 可以使用如下命令重启测试网络：
sudo ./network.sh restart 2 创建通道 通道提供一种通信机制，将指定的Peer和Orderer连接在一起，形成一个具有保密性的通信链路，进行数据隔离(区块数据只能存储在已加入到通道中的成员节点内)。
测试网络成功启动之后，就可以创建通道了。创建命令如下：
sudo ./network.sh createChannel 命令会默认创建一个名为&#34;mychannel&#34;的通道，并且将两个Peer节点加入该通道中。
Anchor peer set for org ‘Org1MSP’ on channel ‘mychannel’
Anchor peer set for org ‘Org2MSP’ on channel ‘mychannel’
Channel ‘mychannel’ joined
创建通道时，还可以指定通道的名字。命令如下：
//创建一个名为first_channel的通道 sudo ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/b89dc080cc00a753fb62990e444959b6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-08T17:40:52+08:00" />
<meta property="article:modified_time" content="2023-11-08T17:40:52+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Hyperledger Fabric搭建测试网络</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>本文使用的Fabric版本：V2.5.4<br> Ubuntu系统：16.04LTS</p> 
</blockquote> 
<p>  前序文章已经详细介绍了如何安装部署Hyperledger Fabric系统，这里不再赘述。本篇文章主要介绍如何使用Fabric的测试网络。在正式开始之前，有一点需要说明：</p> 
<ul><li>Hyperledger Fabric的完整安装路径如下：</li></ul> 
<pre><code class="prism language-bash"><span class="token environment constant">$HOME</span>/go/src/github.com/hyperledger/fabric
</code></pre> 
<p>为了方便，<font color="red"><strong>下文cd命令中的路径从fabric开始书写，fabric之前的省略</strong></font>。</p> 
<h4><a id="1__9"></a>1 启动/关闭测试网络</h4> 
<p>  为了方便开发人员学习及测试智能合约和DApp，fabric-samples文件中提供了一个测试网络test-network。</p> 
<h5><a id="11_%09_11"></a>1.1 启动测试网络</h5> 
<p>进入fabric/scripts/fabric-samples/test-network，可以执行如下命令启动测试网络：</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> fabric/scripts/fabric-samples/test-network
./network.sh up
</code></pre> 
<p>如果命令在执行过程中遇到“<font color="red">permission denied</font>"提示，则使用sudo权限执行第二条命令：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> ./network.sh up
</code></pre> 
<p>执行成功将看到以下提示信息：<br> <img src="https://images2.imgbox.com/7f/07/x1vTQjLp_o.png" alt="在这里插入图片描述"><br> 从图中可以看到，这个测试网络包括一个Orderer节点、两个Peer节点和一个CLI客户端(这些都部署在docker容器中)，其中这两个Peer节点分属两个组织：Org1和Org2。</p> 
<h5><a id="12__25"></a>1.2 关闭测试网络</h5> 
<p>可以使用以下命令关闭测试网络：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> ./network.sh down
</code></pre> 
<p><font color="red" size="1">Tips:测试网络关闭之后，创建的通道、部署的链码以及配置的环境变量都会失效，都要重新设置。</font></p> 
<h5><a id="13__32"></a>1.3 重启测试网络</h5> 
<p>可以使用如下命令重启测试网络：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> ./network.sh restart
</code></pre> 
<h4><a id="2__37"></a>2 创建通道</h4> 
<p>  通道提供一种通信机制，将指定的Peer和Orderer连接在一起，形成一个具有保密性的通信链路，进行数据隔离(区块数据只能存储在已加入到通道中的成员节点内)。<br> 测试网络成功启动之后，就可以创建通道了。创建命令如下：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> ./network.sh createChannel
</code></pre> 
<p>命令会默认创建一个名为"mychannel"的通道，并且将两个Peer节点加入该通道中。</p> 
<blockquote> 
 <p>Anchor peer set for org ‘Org1MSP’ on channel ‘mychannel’<br> Anchor peer set for org ‘Org2MSP’ on channel ‘mychannel’<br> Channel ‘mychannel’ joined</p> 
</blockquote> 
<p>创建通道时，还可以指定通道的名字。命令如下：</p> 
<pre><code class="prism language-bash">//创建一个名为first_channel的通道
<span class="token function">sudo</span> ./network.sh crateChannel <span class="token parameter variable">-c</span> first_channel
</code></pre> 
<p>通道名称遵循以下规则：</p> 
<ul><li>由小写字母、点(.)和短横线(-)构成；并且字母开头；</li><li>长度小于250字符</li></ul> 
<p><font color="red"><strong>Hyperledger Fabric中通道、节点、组织之间的关系：</strong></font></p> 
<p>通道、节点和组织之间的关系可以用以下方式概括：每个参与方组织可以拥有一个或多个节点，节点可以属于一个或多个组织，而不同的组织可以通过一个或多个通道进行隔离和交互。每个通道的参与方可以通过Peer节点之间的共享账本实现数据的一致性和交易的隐私性。同时，Orderer节点作为整个网络的协调者，负责交易的排序和共识。</p> 
<h4><a id="3__63"></a>3 安装部署链码</h4> 
<p>  链码(Chaincode)就是Hyperledger Fabric中的智能合约，是一个可以对账本数据进行操作的可开发的组件程序。调用链码之前需要先安装部署，链码也部署在容器中。部署命令如下：</p> 
<pre><code class="prism language-bash">./network.sh deployCC <span class="token parameter variable">-ccn</span> basic <span class="token parameter variable">-ccp</span> <span class="token punctuation">..</span>/asset-transfer-basic/chaincode-go <span class="token parameter variable">-ccl</span> go
</code></pre> 
<p>该命令将会部署一个使用go语言编写的链码。其中：</p> 
<ul><li>ccn:表示链码的名字；</li><li>ccp:表示链码文件的地址；这是fabric-samples提供的链码案例。</li><li>ccl: 表示链码文件使用的语言；</li></ul> 
<p>除了上述参数之外，还可以使用-c指定安装的通道。举例如下：</p> 
<pre><code class="prism language-bash">./network.sh deployCC <span class="token parameter variable">-ccn</span> basic <span class="token parameter variable">-ccp</span> <span class="token punctuation">..</span>/asset-transfer-basic/chaincode-go <span class="token parameter variable">-ccl</span> go <span class="token parameter variable">-c</span> channel1
</code></pre> 
<p>链码部署的命令<font color="red"><strong>一定不能用sudo来执行。</strong></font>但如果在执行上述命令的时候出现如下错误：<br> <strong>go executable file not found in $PATH</strong><br> <img src="https://images2.imgbox.com/0a/d2/XNZ4Nft4_o.png" alt="在这里插入图片描述"><br> <strong>权限不够错误</strong><br> <img src="https://images2.imgbox.com/10/ce/tRUt0vkg_o.png" alt="在这里插入图片描述">可以通过修改～/go文件的权限来解决。具体如下：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token parameter variable">-R</span> <span class="token number">777</span> ~/go
</code></pre> 
<h4><a id="4_peer_CLI_87"></a>4 peer CLI</h4> 
<p>  创建了网络之后，可以使用peer CLI操作网络，包括安装部署智能合约、调用智能合约以及更新通道等。只需要配置环境变量就可以使用peer CLI。具体如下：</p> 
<h5><a id="41_peer_CLI_89"></a>4.1 配置peer CLI</h5> 
<p>(1) 将/fabric/scripts/fabric-samples/bin目录加入到环境变量PATH中。<br> <strong>第一种方法：通过/etc/profile文件配置</strong><br> <img src="https://images2.imgbox.com/d9/3f/Hz47iE0E_o.png" alt="在这里插入图片描述"><br> <strong>第二种方法：通过export命令</strong><br> 网络上很多资料给出的使用export配置环境变量的命令如下：</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token variable">${<!-- --><span class="token environment constant">PWD</span>}</span>/<span class="token punctuation">..</span>/bin:<span class="token environment constant">$PATH</span>
</code></pre> 
<p>但是这里并不推荐这种写法。原因有以下两点：</p> 
<ul><li>这个命令当中用到了PWD变量，即用户当前的工作路径。如果你当前的路径不是/fabric/scripts/fabric-samples/test-network 的话，那么最终添加到PATH中的路径就是错的。</li><li>即使当前的工作路径为/fabric/scripts/fabric-samples/test-network，有些系统也无法映射到正确的路径。比如：<br> <img src="https://images2.imgbox.com/7e/4f/OcGxnwHj_o.png" alt="在这里插入图片描述"></li></ul> 
<p>如果想要使用export方法配置该环境变量的话，建议使用如下命令</p> 
<pre><code class="prism language-bash">//先跳转到fabric-samples文件所在的地址
<span class="token builtin class-name">cd</span> /fabric/scripts/fabric-samples
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PWD</span>/bin:<span class="token environment constant">$PATH</span>
</code></pre> 
<p>(2) 配置FABRIC_CFG_PATH</p> 
<pre><code class="prism language-bash">//先跳转到fabric-samples文件所在的地址
<span class="token builtin class-name">cd</span> /fabric/scripts/fabric-samples
<span class="token builtin class-name">export</span> <span class="token assign-left variable">FABRIC_CFG_PATH</span><span class="token operator">=</span><span class="token variable">${<!-- --><span class="token environment constant">PWD</span>}</span>/config/
</code></pre> 
<p>(3) 配置Org1环境变量</p> 
<p>要先进入test-network文件目录:</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> /fabric/scripts/fabric-samples/test-network
</code></pre> 
<p>然后用命令行部署环境变量：</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">CORE_PEER_TLS_ENABLED</span><span class="token operator">=</span>true
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CORE_PEER_LOCALMSPID</span><span class="token operator">=</span><span class="token string">"Org1MSP"</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CORE_PEER_TLS_ROOTCERT_FILE</span><span class="token operator">=</span><span class="token variable">${<!-- --><span class="token environment constant">PWD</span>}</span>/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CORE_PEER_MSPCONFIGPATH</span><span class="token operator">=</span><span class="token variable">${<!-- --><span class="token environment constant">PWD</span>}</span>/organizations/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CORE_PEER_ADDRESS</span><span class="token operator">=</span>localhost:7051
</code></pre> 
<p>接下来就可以使用peer CLI了。可以输入如下命令验证是否正确配置：</p> 
<pre><code class="prism language-bash">peer channel list
</code></pre> 
<p>如果能返回刚才创建的“mychannel"信息(如下图)，则说明peer CLI已经正确配置。<br> <img src="https://images2.imgbox.com/a1/3b/ctxqmx48_o.png" alt="在这里插入图片描述"><br> 如果出现如下错误：</p> 
<blockquote> 
 <p>Error: error getting endorser client for invoke: endorser client failed to connect to localhost:7051: failed to create new connection: context deadline exceeded.</p> 
</blockquote> 
<p>这是因为前面创建的Orderer、Peer节点都不存在了，可以使用docker ps -a查看一下。需要重新启动网络、创建通道、部署链码和配置环境变量。</p> 
<h5><a id="42__141"></a>4.2 说明</h5> 
<p>关于peer CLI有以下几点需要说明(后续补充)：</p> 
<ul><li>peer CLI是用于与Fabric网络中的peer节点进行交互的命令行工具。上文示例中的peer CLI绑定的是Org1中的peer节点。如果需要绑定Org2中的peer节点，则需要重新配置环境变量。</li></ul> 
<p>  到目前为止，测试网络已经搭建完成。至于如何使用peer CLI调用智能合约，留待下一篇博客。</p> 
<h4><a id="_146"></a>参考资料</h4> 
<ol><li><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.5/test_network.html" rel="nofollow">https://hyperledger-fabric.readthedocs.io/en/release-2.5/test_network.html</a></li><li><a href="https://blog.51cto.com/zhuxianzhong/7241974?articleABtest=0" rel="nofollow">https://blog.51cto.com/zhuxianzhong/7241974?articleABtest=0</a></li><li><a href="https://blog.51cto.com/zhuxianzhong/7242582?articleABtest=0" rel="nofollow">https://blog.51cto.com/zhuxianzhong/7242582?articleABtest=0</a></li><li><a href="https://blog.51cto.com/zhuxianzhong/7246193?articleABtest=0" rel="nofollow">https://blog.51cto.com/zhuxianzhong/7246193?articleABtest=0</a></li><li><a href="https://blog.csdn.net/qq_45179762/article/details/122217058">https://blog.csdn.net/qq_45179762/article/details/122217058</a></li><li><a href="https://blog.csdn.net/wybnmsl/article/details/113743268">https://blog.csdn.net/wybnmsl/article/details/113743268</a></li><li><a href="https://blog.csdn.net/Blockchain210/article/details/127707353">https://blog.csdn.net/Blockchain210/article/details/127707353</a></li></ol>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9010305f6a115888713cd2e2c1c93c53/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">scrcpy常用命令</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9f52b0d6cccd427c7496acd40f5606be/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">用css画勾和叉</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>