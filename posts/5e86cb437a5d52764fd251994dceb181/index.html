<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>vue-baidu-map-3x 使用记录 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="vue-baidu-map-3x 使用记录" />
<meta property="og:description" content="在 Vue3 &#43; TypeScript 项目中，为了采用 标签组件 的方式，使用百度地图组件，冲浪发现了一个开源库 ovo，很方便！喜欢的朋友记得帮 原作者 点下 star ~
vue-baidu-map-3xbaidu-map的vue3/vue2版本（支持v2.0、v3.0和webGl api）我全都有。同时也是vue2-baidu-map的文档https://map.heifahaizei.com/doc/index.html
目录
快速上手
全局注册
局部注册
注意事项
错误示例
正确示例
输入框搜索点位，并定位至该点位
实现效果
引入地图组件
为什么不采用 BmAutoComplete？
使用 BmControl 实现自定义控件
定义响应式变量
关于初始化变量的踩坑
添加地图初始化方法 ready
监听外部组件传入地址的监变化
ready 方法逻辑 获取地址搜索结果列表
使用百度地图 API 检索跨域
获取搜索结果列表方法 执行定位
使用 nextTick 修改数据
点位弹窗信息
展示搜索点位的周边点位弹窗
实现效果
引入地图组件
辐射圆、海量点组件
控制弹框在地图范围内显示
接收弹框组件的周边点位数据，并显示
【一个我很迷惑的报错】多个页面引用地图组件时，路由报错
快速上手 全局注册 一次性引入 百度地图组件库 的所有组件
import { createApp } from &#39;vue&#39; import App from &#39;./App.vue&#39; import BaiduMap from &#39;vue-baidu-map-3x&#39; const app = createApp(App); app." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/5e86cb437a5d52764fd251994dceb181/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-05T10:58:59+08:00" />
<meta property="article:modified_time" content="2023-08-05T10:58:59+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">vue-baidu-map-3x 使用记录</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>在 Vue3 + TypeScript 项目中，为了采用 标签组件 的方式，使用百度地图组件，冲浪发现了一个开源库 ovo，很方便！喜欢的朋友记得帮 <a href="https://github.com/YangJianFei/vue-baidu-map-3x#readme" title="原作者">原作者</a> 点下 star ~</p> 
<p><a class="has-card" href="https://map.heifahaizei.com/doc/index.html" rel="nofollow" title="vue-baidu-map-3x"><span class="link-card-box"><span class="link-title">vue-baidu-map-3x</span><span class="link-desc">baidu-map的vue3/vue2版本（支持v2.0、v3.0和webGl api）我全都有。同时也是vue2-baidu-map的文档</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/29/99/f4RRO3Av_o.png" alt="icon-default.png?t=N6B9">https://map.heifahaizei.com/doc/index.html</span></span></a></p> 
<p id="main-toc"><strong>目录</strong></p> 
<p id="%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B-toc" style="margin-left:0px;"><a href="#%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B" rel="nofollow">快速上手</a></p> 
<p id="%E5%85%A8%E5%B1%80%E6%B3%A8%E5%86%8C-toc" style="margin-left:40px;"><a href="#%E5%85%A8%E5%B1%80%E6%B3%A8%E5%86%8C" rel="nofollow">全局注册</a></p> 
<p id="%E5%B1%80%E9%83%A8%E6%B3%A8%E5%86%8C-toc" style="margin-left:40px;"><a href="#%E5%B1%80%E9%83%A8%E6%B3%A8%E5%86%8C" rel="nofollow">局部注册</a></p> 
<p id="%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9-toc" style="margin-left:40px;"><a href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9" rel="nofollow">注意事项</a></p> 
<p id="%E9%94%99%E8%AF%AF%E7%A4%BA%E4%BE%8B-toc" style="margin-left:80px;"><a href="#%E9%94%99%E8%AF%AF%E7%A4%BA%E4%BE%8B" rel="nofollow">错误示例</a></p> 
<p id="%E6%AD%A3%E7%A1%AE%E7%A4%BA%E4%BE%8B-toc" style="margin-left:80px;"><a href="#%E6%AD%A3%E7%A1%AE%E7%A4%BA%E4%BE%8B" rel="nofollow">正确示例</a></p> 
<p id="%E8%BE%93%E5%85%A5%E6%A1%86%E6%90%9C%E7%B4%A2%E7%82%B9%E4%BD%8D%EF%BC%8C%E5%B9%B6%E5%AE%9A%E4%BD%8D%E8%87%B3%E8%AF%A5%E7%82%B9%E4%BD%8D-toc" style="margin-left:0px;"><a href="#%E8%BE%93%E5%85%A5%E6%A1%86%E6%90%9C%E7%B4%A2%E7%82%B9%E4%BD%8D%EF%BC%8C%E5%B9%B6%E5%AE%9A%E4%BD%8D%E8%87%B3%E8%AF%A5%E7%82%B9%E4%BD%8D" rel="nofollow">输入框搜索点位，并定位至该点位</a></p> 
<p id="%E5%AE%9E%E7%8E%B0%E6%95%88%E6%9E%9C-toc" style="margin-left:40px;"><a href="#%E5%AE%9E%E7%8E%B0%E6%95%88%E6%9E%9C" rel="nofollow">实现效果</a></p> 
<p id="%E5%BC%95%E5%85%A5%E5%9C%B0%E5%9B%BE%E7%BB%84%E4%BB%B6-toc" style="margin-left:40px;"><a href="#%E5%BC%95%E5%85%A5%E5%9C%B0%E5%9B%BE%E7%BB%84%E4%BB%B6" rel="nofollow">引入地图组件</a></p> 
<p id="%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E9%87%87%E7%94%A8%20BmAutoComplete%EF%BC%9F-toc" style="margin-left:80px;"><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E9%87%87%E7%94%A8%20BmAutoComplete%EF%BC%9F" rel="nofollow">为什么不采用 BmAutoComplete？</a></p> 
<p id="%E4%BD%BF%E7%94%A8%20BmControl%20%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-toc" style="margin-left:80px;"><a href="#%E4%BD%BF%E7%94%A8%20BmControl%20%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6" rel="nofollow">使用 BmControl 实现自定义控件</a></p> 
<p id="%E5%AE%9A%E4%B9%89%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8F%98%E9%87%8F-toc" style="margin-left:40px;"><a href="#%E5%AE%9A%E4%B9%89%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8F%98%E9%87%8F" rel="nofollow">定义响应式变量</a></p> 
<p id="%E5%85%B3%E4%BA%8E%E5%88%9D%E5%A7%8B%E5%8C%96%E5%8F%98%E9%87%8F%E7%9A%84%E8%B8%A9%E5%9D%91-toc" style="margin-left:80px;"><a href="#%E5%85%B3%E4%BA%8E%E5%88%9D%E5%A7%8B%E5%8C%96%E5%8F%98%E9%87%8F%E7%9A%84%E8%B8%A9%E5%9D%91" rel="nofollow">关于初始化变量的踩坑</a></p> 
<p id="%E6%B7%BB%E5%8A%A0%E5%9C%B0%E5%9B%BE%E5%88%9D%E5%A7%8B%E5%8C%96%E6%96%B9%E6%B3%95%20ready-toc" style="margin-left:40px;"><a href="#%E6%B7%BB%E5%8A%A0%E5%9C%B0%E5%9B%BE%E5%88%9D%E5%A7%8B%E5%8C%96%E6%96%B9%E6%B3%95%20ready" rel="nofollow">添加地图初始化方法 ready</a></p> 
<p id="%E7%9B%91%E5%90%AC%E5%A4%96%E9%83%A8%E7%BB%84%E4%BB%B6%E4%BC%A0%E5%85%A5%E5%9C%B0%E5%9D%80%E7%9A%84%E7%9B%91%E5%8F%98%E5%8C%96-toc" style="margin-left:80px;"><a href="#%E7%9B%91%E5%90%AC%E5%A4%96%E9%83%A8%E7%BB%84%E4%BB%B6%E4%BC%A0%E5%85%A5%E5%9C%B0%E5%9D%80%E7%9A%84%E7%9B%91%E5%8F%98%E5%8C%96" rel="nofollow">监听外部组件传入地址的监变化</a></p> 
<p id="ready%20%E6%96%B9%E6%B3%95%E9%80%BB%E8%BE%91%C2%A0-toc" style="margin-left:80px;"><a href="#ready%20%E6%96%B9%E6%B3%95%E9%80%BB%E8%BE%91%C2%A0" rel="nofollow">ready 方法逻辑 </a></p> 
<p id="%E8%8E%B7%E5%8F%96%E5%9C%B0%E5%9D%80%E6%90%9C%E7%B4%A2%E7%BB%93%E6%9E%9C%E5%88%97%E8%A1%A8-toc" style="margin-left:40px;"><a href="#%E8%8E%B7%E5%8F%96%E5%9C%B0%E5%9D%80%E6%90%9C%E7%B4%A2%E7%BB%93%E6%9E%9C%E5%88%97%E8%A1%A8" rel="nofollow">获取地址搜索结果列表</a></p> 
<p id="%E4%BD%BF%E7%94%A8%E7%99%BE%E5%BA%A6%E5%9C%B0%E5%9B%BE%20API%20%E6%A3%80%E7%B4%A2%E8%B7%A8%E5%9F%9F-toc" style="margin-left:80px;"><a href="#%E4%BD%BF%E7%94%A8%E7%99%BE%E5%BA%A6%E5%9C%B0%E5%9B%BE%20API%20%E6%A3%80%E7%B4%A2%E8%B7%A8%E5%9F%9F" rel="nofollow">使用百度地图 API 检索跨域</a></p> 
<p id="%E8%8E%B7%E5%8F%96%E6%90%9C%E7%B4%A2%E7%BB%93%E6%9E%9C%E5%88%97%E8%A1%A8%E6%96%B9%E6%B3%95%C2%A0-toc" style="margin-left:80px;"><a href="#%E8%8E%B7%E5%8F%96%E6%90%9C%E7%B4%A2%E7%BB%93%E6%9E%9C%E5%88%97%E8%A1%A8%E6%96%B9%E6%B3%95%C2%A0" rel="nofollow">获取搜索结果列表方法 </a></p> 
<p id="%E6%89%A7%E8%A1%8C%E5%AE%9A%E4%BD%8D-toc" style="margin-left:40px;"><a href="#%E6%89%A7%E8%A1%8C%E5%AE%9A%E4%BD%8D" rel="nofollow">执行定位</a></p> 
<p id="%E4%BD%BF%E7%94%A8%20nextTick%20%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE-toc" style="margin-left:80px;"><a href="#%E4%BD%BF%E7%94%A8%20nextTick%20%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE" rel="nofollow">使用 nextTick 修改数据</a></p> 
<p id="%E7%82%B9%E4%BD%8D%E5%BC%B9%E7%AA%97%E4%BF%A1%E6%81%AF-toc" style="margin-left:80px;"><a href="#%E7%82%B9%E4%BD%8D%E5%BC%B9%E7%AA%97%E4%BF%A1%E6%81%AF" rel="nofollow">点位弹窗信息</a></p> 
<p id="%E5%B1%95%E7%A4%BA%E6%90%9C%E7%B4%A2%E7%82%B9%E4%BD%8D%E7%9A%84%E5%91%A8%E8%BE%B9%E7%82%B9%E4%BD%8D%E5%BC%B9%E7%AA%97-toc" style="margin-left:0px;"><a href="#%E5%B1%95%E7%A4%BA%E6%90%9C%E7%B4%A2%E7%82%B9%E4%BD%8D%E7%9A%84%E5%91%A8%E8%BE%B9%E7%82%B9%E4%BD%8D%E5%BC%B9%E7%AA%97" rel="nofollow">展示搜索点位的周边点位弹窗</a></p> 
<p id="%E5%AE%9E%E7%8E%B0%E6%95%88%E6%9E%9C-toc" style="margin-left:40px;"><a href="#%E5%AE%9E%E7%8E%B0%E6%95%88%E6%9E%9C" rel="nofollow">实现效果</a></p> 
<p id="%E5%BC%95%E5%85%A5%E5%9C%B0%E5%9B%BE%E7%BB%84%E4%BB%B6-toc" style="margin-left:40px;"><a href="#%E5%BC%95%E5%85%A5%E5%9C%B0%E5%9B%BE%E7%BB%84%E4%BB%B6" rel="nofollow">引入地图组件</a></p> 
<p id="%E8%BE%90%E5%B0%84%E5%9C%86%E3%80%81%E6%B5%B7%E9%87%8F%E7%82%B9%E7%BB%84%E4%BB%B6-toc" style="margin-left:80px;"><a href="#%E8%BE%90%E5%B0%84%E5%9C%86%E3%80%81%E6%B5%B7%E9%87%8F%E7%82%B9%E7%BB%84%E4%BB%B6" rel="nofollow">辐射圆、海量点组件</a></p> 
<p id="%E6%8E%A7%E5%88%B6%E5%BC%B9%E6%A1%86%E5%9C%A8%E5%9C%B0%E5%9B%BE%E8%8C%83%E5%9B%B4%E5%86%85%E6%98%BE%E7%A4%BA-toc" style="margin-left:80px;"><a href="#%E6%8E%A7%E5%88%B6%E5%BC%B9%E6%A1%86%E5%9C%A8%E5%9C%B0%E5%9B%BE%E8%8C%83%E5%9B%B4%E5%86%85%E6%98%BE%E7%A4%BA" rel="nofollow">控制弹框在地图范围内显示</a></p> 
<p id="%E6%8E%A5%E6%94%B6%E5%BC%B9%E6%A1%86%E7%BB%84%E4%BB%B6%E7%9A%84%E5%91%A8%E8%BE%B9%E7%82%B9%E4%BD%8D%E6%95%B0%E6%8D%AE%EF%BC%8C%E5%B9%B6%E6%98%BE%E7%A4%BA-toc" style="margin-left:40px;"><a href="#%E6%8E%A5%E6%94%B6%E5%BC%B9%E6%A1%86%E7%BB%84%E4%BB%B6%E7%9A%84%E5%91%A8%E8%BE%B9%E7%82%B9%E4%BD%8D%E6%95%B0%E6%8D%AE%EF%BC%8C%E5%B9%B6%E6%98%BE%E7%A4%BA" rel="nofollow">接收弹框组件的周边点位数据，并显示</a></p> 
<p id="%E3%80%90%E4%B8%80%E4%B8%AA%E6%88%91%E5%BE%88%E8%BF%B7%E6%83%91%E7%9A%84%E6%8A%A5%E9%94%99%E3%80%91%E5%A4%9A%E4%B8%AA%E9%A1%B5%E9%9D%A2%E5%BC%95%E7%94%A8%E5%9C%B0%E5%9B%BE%E7%BB%84%E4%BB%B6%E6%97%B6%EF%BC%8C%E8%B7%AF%E7%94%B1%E6%8A%A5%E9%94%99-toc" style="margin-left:0px;"><a href="#%E3%80%90%E4%B8%80%E4%B8%AA%E6%88%91%E5%BE%88%E8%BF%B7%E6%83%91%E7%9A%84%E6%8A%A5%E9%94%99%E3%80%91%E5%A4%9A%E4%B8%AA%E9%A1%B5%E9%9D%A2%E5%BC%95%E7%94%A8%E5%9C%B0%E5%9B%BE%E7%BB%84%E4%BB%B6%E6%97%B6%EF%BC%8C%E8%B7%AF%E7%94%B1%E6%8A%A5%E9%94%99" rel="nofollow">【一个我很迷惑的报错】多个页面引用地图组件时，路由报错</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2 id="%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B" style="background-color:transparent;">快速上手</h2> 
<h3 id="%E5%85%A8%E5%B1%80%E6%B3%A8%E5%86%8C">全局注册</h3> 
<p>一次性引入 百度地图组件库 的所有组件</p> 
<pre><code class="language-TypeScript">import { createApp } from 'vue'
import App from './App.vue'
import BaiduMap from 'vue-baidu-map-3x'

const app = createApp(App);

app.use(BaiduMap, {
  // ak 是在百度地图开发者平台申请的密钥 详见 http://lbsyun.baidu.com/apiconsole/key */
  ak: '百度地图ak',
  // v:'2.0',  // 默认使用3.0
  // type: 'WebGL' // ||API 默认API  (使用此模式 BMap=BMapGL)
});
app.mount('#app');</code></pre> 
<p></p> 
<h3 id="%E5%B1%80%E9%83%A8%E6%B3%A8%E5%86%8C">局部注册</h3> 
<pre><code class="language-TypeScript">&lt;template&gt;
  &lt;baidu-map class="map" ak="BaiduMapAK" v="3.0" type="API" :center="{lng: 116.404, lat: 39.915}" :zoom="15"&gt;
  &lt;/baidu-map&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { BaiduMap } from 'vue-baidu-map-3x'
&lt;/script&gt;

&lt;style&gt;
.map {
  width: 100%;
  height: 300px;
}
&lt;/style&gt;</code></pre> 
<p></p> 
<h3 id="%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9">注意事项</h3> 
<ul><li><span style="color:#fe2c24;">百度地图容器 必须 定义高度：</span>BaiduMap 组件容器本身是一个空的块级元素，如果容器不定义高度，百度地图将渲染在一个高度为 0 不可见的容器内</li><li><span style="color:#fe2c24;">百度地图容器 必须 定义 center、zoom：</span>没有设置 center 和 zoom 属性的地图组件是不进行地图渲染的。当 center 属性为合法地名字符串时例外，因为百度地图会根据地名自动调整 zoom 的值</li><li><span style="color:#fe2c24;">在 ready 中执行地图 API 加载后的代码，不能在 onMounted 中执行：</span>由于百度地图 JS API 只有 JSONP 一种加载方式，因此 BaiduMap 组件及其所有子组件的渲染只能是异步的。因此，请使用在组件的 ready 事件来执行地图 API 加载完毕后才能执行的代码，不要试图在 vue 自身的生命周期中调用 BMap 类，更不要在这些时机修改 model 层</li></ul> 
<p></p> 
<h4 id="%E9%94%99%E8%AF%AF%E7%A4%BA%E4%BE%8B">错误示例</h4> 
<pre><code class="language-TypeScript">&lt;script setup&gt;
import {ref,onMounted} from 'vue';

const center = ref({lng: 0, lat: 0});
const zoom = ref(3);

onMounted(() =&gt; {
  center.value.lng = 116.404;
  center.value.lat = 39.915;
  zoom.value = 15;
});
&lt;/script&gt;</code></pre> 
<h4 id="%E6%AD%A3%E7%A1%AE%E7%A4%BA%E4%BE%8B">正确示例</h4> 
<pre><code class="language-TypeScript">&lt;script setup&gt;
import {ref,onMounted} from 'vue';

const center = ref({lng: 0, lat: 0});
const zoom = ref(3);

const handler = ({BMap, map}) =&gt; {
  console.log(BMap, map);
  center.value.lng = 116.404;
  center.value.lat = 39.915;
  zoom.value = 15;
}
&lt;/script&gt;</code></pre> 
<p></p> 
<h2 id="%E8%BE%93%E5%85%A5%E6%A1%86%E6%90%9C%E7%B4%A2%E7%82%B9%E4%BD%8D%EF%BC%8C%E5%B9%B6%E5%AE%9A%E4%BD%8D%E8%87%B3%E8%AF%A5%E7%82%B9%E4%BD%8D" style="background-color:transparent;">输入框搜索点位，并定位至该点位</h2> 
<h3 id="%E5%AE%9E%E7%8E%B0%E6%95%88%E6%9E%9C" style="background-color:transparent;">实现效果</h3> 
<p>二次封装地图组件：</p> 
<ul><li>该组件可以被 编辑、查看、其他页面 进行引入</li><li>该组件可以接收指定的值（地点名称、经纬度等等）</li><li>点击 确认按钮 后，搜索显示结果列表</li><li>点击 结果列表的某项 后，定位到该点，并让该点居中展示</li></ul> 
<p></p> 
<p>接收搜索字段，显示搜索结果列表：</p> 
<p><img alt="" height="610" src="https://images2.imgbox.com/cd/22/80CE49ST_o.png" width="847"></p> 
<p>点击结果列表，执行定位，展示点位信息：<img alt="" height="581" src="https://images2.imgbox.com/94/87/ph6KIGNj_o.png" width="862"></p> 
<p></p> 
<h3 id="%E5%BC%95%E5%85%A5%E5%9C%B0%E5%9B%BE%E7%BB%84%E4%BB%B6">引入地图组件</h3> 
<p>先来看看完整代码</p> 
<pre><code class="language-TypeScript">    &lt;baidu-map
      class="ths-map"
      :zoom="mapZoom"
      :center="mapCenter"
      @ready="ready"
    &gt;
      &lt;!-- 比例尺控件 --&gt;
      &lt;bm-scale anchor="BMAP_ANCHOR_TOP_RIGHT"&gt;&lt;/bm-scale&gt;
      &lt;!-- 缩放控件 --&gt;
      &lt;bm-navigation anchor="BMAP_ANCHOR_TOP_RIGHT"&gt;&lt;/bm-navigation&gt;
      &lt;!-- 定位控件 --&gt;
      &lt;bm-geolocation anchor="BMAP_ANCHOR_BOTTOM_RIGHT" :show-address-bar="true" :auto-location="true"&gt;&lt;/bm-geolocation&gt;

      &lt;!-- 自定义控件 --&gt;
      &lt;bm-control class="map-search-bm-control"&gt;
        &lt;!-- 手写输入框 --&gt;
        &lt;div class="flex map-search-container"&gt;
          &lt;el-input v-model="keyword" class="map-search-input" @input="getSearchList"&gt;&lt;/el-input&gt;
          &lt;el-button type="primary" class="map-search-btn" @click="getSearchList"&gt;
            搜索
          &lt;/el-button&gt;
        &lt;/div&gt;
        &lt;!-- 搜索列表 --&gt;
        &lt;div v-if="searchListVisible" class="map-search-list"&gt;
          &lt;div
            v-for="(elem, eIndex) of searchList"
            :key="eIndex"
            class="map-search-item"
            @click="performPositioning(elem)"
          &gt;
            &lt;p class="map-search-item-title"&gt;
              {<!-- -->{ elem.name }}
            &lt;/p&gt;
            &lt;p class="map-search-item-addr"&gt;
              {<!-- -->{ elem.address }}
            &lt;/p&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/bm-control&gt;

      &lt;!-- 点 https://map.heifahaizei.com/doc/overlay/marker.html --&gt;
      &lt;bm-marker
        v-if="isShowSearchPoint"
        :position="{ lng: searchPoint.location.lng, lat: searchPoint.location.lat }"
        @click="spInfoWindow.show = true"
      &gt;
      &lt;/bm-marker&gt;

      &lt;!-- 搜索点位弹窗 https://map.heifahaizei.com/doc/overlay/info-window.html#%E5%B1%9E%E6%80%A7 --&gt;
      &lt;bm-info-window
        :show="spInfoWindow.show"
        :title="spInfoWindow.name"
        :offset="{ width: 0, height: -24 }"
        :position="{ lng: spInfoWindow.location.lng, lat: spInfoWindow.location.lat }"
        :width="0"
        :max-width="300"
        @close="spInfoWindow.show = false"
        @open="spInfoWindow.show = true"
      &gt;
        &lt;!-- {<!-- -->{ spInfoWindow }} --&gt;
        &lt;!-- 搜索点位地址 --&gt;
        &lt;p class="sp-info-window-addr"&gt;
          {<!-- -->{ spInfoWindow.spName }}:&lt;br /&gt;
          {<!-- -->{ spInfoWindow.spAddress }}
        &lt;/p&gt;
        &lt;div class="sp-info-window-header"&gt;
          &lt;!-- 搜索点位名称 --&gt;
          &lt;!-- &lt;span class="sp-info-window-name"&gt;{<!-- -->{ spInfoWindow.spName }}&lt;/span&gt; --&gt;
          &lt;span class="sp-info-window-around" @click="infoWinGoAround"&gt; 搜周边 &lt;/span&gt;
        &lt;/div&gt;
      &lt;/bm-info-window&gt;
    &lt;/baidu-map&gt;
</code></pre> 
<p> </p> 
<h4 id="%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E9%87%87%E7%94%A8%20BmAutoComplete%EF%BC%9F">为什么不采用 BmAutoComplete？</h4> 
<p>这个需求使用 官网组件 <a href="https://map.heifahaizei.com/doc/other/auto-complete.html" rel="nofollow" title="bm-auto-complete">bm-auto-complete</a> 能实现，不采用是基于以下几个原因：</p> 
<ul><li>UI 定制效果太差了，无法 深度定制 输入框样式（使用 el-input 组件会出现 bug，貌似只能采用原生 input 组件）</li><li>控制 请求发送时机 不方便（文字发生变化直接就请求了，有的时候希望点了确认按钮再请求）</li><li>无法自定义请求结果列表</li></ul> 
<p><img alt="" height="512" src="https://images2.imgbox.com/01/3b/il0Ik8l7_o.png" width="986"></p> 
<p></p> 
<h4 id="%E4%BD%BF%E7%94%A8%20BmControl%20%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6" style="background-color:transparent;">使用 BmControl 实现自定义控件</h4> 
<p>为了解决上一个问题，采用了 <a href="https://map.heifahaizei.com/doc/control/control.html" rel="nofollow" title="BmControl">BmControl</a></p> 
<p></p> 
<h3 id="%E5%AE%9A%E4%B9%89%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8F%98%E9%87%8F">定义响应式变量</h3> 
<h4 id="%E5%85%B3%E4%BA%8E%E5%88%9D%E5%A7%8B%E5%8C%96%E5%8F%98%E9%87%8F%E7%9A%84%E8%B8%A9%E5%9D%91" style="background-color:transparent;">关于初始化变量的踩坑</h4> 
<p>这些变量 <span style="color:#fe2c24;">尽量 </span>一开始就写好数据结构：</p> 
<ul><li>比如 mapCenter 里，一开始就应该定义 lng、lat，后面具体的值可以是 0 state.mapCenter = { lng: 0, lat: 0}</li><li>如果直接初始化成 state.mapCenter = {}，会导致发生不可预知的错误</li></ul> 
<p>当然这并不是绝对的：</p> 
<ul><li>我最开始没初始化 单个点位 searchPoint 的对象结构时，没报错</li><li>我最开始没初始化 点位信息弹窗 spInfoWindow 的对象结构时，就报错找不到 lng 属性了</li></ul> 
<pre><code class="language-TypeScript">    const state = reactive({
      // 地图缩放级别
      mapZoom: 11,
      // 地图中心点
      mapCenter: {
        lng: 113.88402,
        lat: 22.555259,
      },
      // 是否展示搜索点位
      isShowSearchPoint: false,
      // 搜索点位信息
      searchPoint: {
        lng: 0,
        lat: 0,
      } as any,
      // 搜索点位弹窗信息
      spInfoWindow: {
        show: false,
        spName: '',
        spAddress: '',
        location: {
          lng: 0,
          lat: 0,
        },
      } as any,
      // 搜索关键字
      keyword: '',
      // 搜索列表
      searchList: [] as any[],
      // 搜索列表是否可见
      searchListVisible: false,
    });</code></pre> 
<p></p> 
<p><span style="color:#fe2c24;">初始化方法可以在 ready 函数中执行，不能在 onMounted 中执行</span></p> 
<pre><code class="language-TypeScript">    /**
     * 页面初始化
     */
    const initPage = () =&gt; {
      // 是否展示搜索点位
      state.isShowSearchPoint = false;
      // 搜索点位信息
      state.searchPoint = {} as any;
      // 搜索点位弹窗信息
      state.spInfoWindow = {
        show: false,
        spName: '',
        spAddress: '',
        location: {
          lng: 0,
          lat: 0,
        },
      };
      // 搜索列表
      state.searchList = [];
      // 搜索列表是否可见
      state.searchListVisible = false;
    };</code></pre> 
<p></p> 
<p></p> 
<h3 id="%E6%B7%BB%E5%8A%A0%E5%9C%B0%E5%9B%BE%E5%88%9D%E5%A7%8B%E5%8C%96%E6%96%B9%E6%B3%95%20ready">添加地图初始化方法 ready</h3> 
<h4 id="%E7%9B%91%E5%90%AC%E5%A4%96%E9%83%A8%E7%BB%84%E4%BB%B6%E4%BC%A0%E5%85%A5%E5%9C%B0%E5%9D%80%E7%9A%84%E7%9B%91%E5%8F%98%E5%8C%96">监听外部组件传入地址的监变化</h4> 
<p>外部传入的地址，会被赋值给 state 中的变量，防止 props 被修改</p> 
<pre><code class="language-TypeScript">    watch(
      () =&gt; props.complaintsAddr,
      () =&gt; {
        state.keyword = props.complaintsAddr;
        // 关闭周边搜索弹框
        state.aroundDialogVisible = false;
      },
    );</code></pre> 
<p></p> 
<h4 id="ready%20%E6%96%B9%E6%B3%95%E9%80%BB%E8%BE%91%C2%A0">ready 方法逻辑 </h4> 
<p>props.complaintsAddr 是供其他页面传入 地址 的字段：</p> 
<ul><li>如果接收到了这个字段，则直接调用百度地图 API 接口，获取搜索结果列表，执行定位</li><li>如果没接收到这个字段，则执行初始化，调整 state 中的变量，隐藏不该出现的内容</li></ul> 
<pre><code class="language-TypeScript">    const ready = async (e: any) =&gt; {
      if (props.complaintsAddr) {
        await getSearchList();
        for (const elem of state.searchList) {
          if (elem.address === props.complaintsAddr || elem.name === props.complaintsAddr) {
            performPositioning(elem);
            break;
          }
        }
      } else {
        // 页面初始化
        await initPage();
      }
    };

    onMounted(async () =&gt; {
      /*
       *  页面初始化
       * await initPage();
       */
    });</code></pre> 
<p> </p> 
<h3 id="%E8%8E%B7%E5%8F%96%E5%9C%B0%E5%9D%80%E6%90%9C%E7%B4%A2%E7%BB%93%E6%9E%9C%E5%88%97%E8%A1%A8">获取地址搜索结果列表</h3> 
<h4 id="%E4%BD%BF%E7%94%A8%E7%99%BE%E5%BA%A6%E5%9C%B0%E5%9B%BE%20API%20%E6%A3%80%E7%B4%A2%E8%B7%A8%E5%9F%9F">使用百度地图 API 检索跨域</h4> 
<p> <a href="https://lbsyun.baidu.com/index.php?title=webapi/guide/webservice-placeapi" rel="nofollow" title="地点检索 | 百度地图API SDK">地点检索 | 百度地图API SDK</a></p> 
<p><img alt="" height="849" src="https://images2.imgbox.com/63/9d/BA8QHdKc_o.png" width="1200"></p> 
<p></p> 
<p>本地调用百度接口，会出现跨域问题，这是正常的，<span style="color:#fe2c24;">使用 nginx 代理本地发送的请求</span></p> 
<pre><code class="language-TypeScript">        location /mapapi/ {
            proxy_pass   http://api.map.baidu.com/;
           add_header Access-Control-Allow-Origin *;
        }</code></pre> 
<p> </p> 
<h4 id="%E8%8E%B7%E5%8F%96%E6%90%9C%E7%B4%A2%E7%BB%93%E6%9E%9C%E5%88%97%E8%A1%A8%E6%96%B9%E6%B3%95%C2%A0">获取搜索结果列表方法 </h4> 
<pre><code class="language-TypeScript">    /**
     * 获取搜索列表
     */
    const getSearchList = async () =&gt; {
      state.searchList = [];
      try {
        const res = await getInputList(state.keyword, '宝安区');
        if (res.data.message === 'ok') {
          state.searchList = res.data?.results;
          // 展示搜索列表
          state.searchListVisible = true;
        }
      } catch (err) {
        console.error('地图 搜索列表 接口请求失败', err);
        state.searchList = [];
        state.searchListVisible = true;
      }
    };</code></pre> 
<p></p> 
<h3 id="%E6%89%A7%E8%A1%8C%E5%AE%9A%E4%BD%8D">执行定位</h3> 
<h4 id="%E4%BD%BF%E7%94%A8%20nextTick%20%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE">使用 nextTick 修改数据</h4> 
<p>单个点 BmMaker 组件，使用 v-if 进行控制，否则一开始没点搜索结果的时候，就会直接渲染</p> 
<p><span style="color:#fe2c24;"><u>使用 nextTick，修改点位坐标数据、中心点数据、点位弹框信息</u></span>，原因如下：</p> 
<ul><li>如果不使用 nextTick，会导致 点位弹框信息 报错 —— 获取不到 img 这个 DOM 元素</li><li>也就是说，点位弹框信息 必须在 点位存在 的时候，才能渲染</li></ul> 
<p></p> 
<p>选择结果列表后，应该把选中的结果信息发出去，告诉外面使用地图的组件</p> 
<pre><code class="language-TypeScript">    /**
     * 执行定位
     * @param elem 点位信息，必传
     * @param isCloseSearchList 是否关闭搜索列表，菲必传
     */
    const performPositioning = async (elem: any) =&gt; {
      // console.log('执行定位 ---', elem);

      // 隐藏列表
      state.searchListVisible = false;

      // 修改关键字信息
      state.keyword = elem.address ? elem.address : elem.name;
      // 更新外部组件的关键字信息
      emit('search-point-info', elem);

      // 渲染点位
      nextTick(() =&gt; {
        // 修改中心点坐标，把当前搜索点，设置为中心点
        state.mapCenter.lng = elem.location.lng;
        state.mapCenter.lat = elem.location.lat;

        // 修改搜索点位坐标
        state.searchPoint = elem;
        // 展示搜索点位
        state.isShowSearchPoint = true;
        console.log('搜索点位的经纬度 ---', state.searchPoint);

        // 设置点位弹窗信息
        showInfoWindow(elem);
      });
    };</code></pre> 
<p> </p> 
<h4 id="%E7%82%B9%E4%BD%8D%E5%BC%B9%E7%AA%97%E4%BF%A1%E6%81%AF">点位弹窗信息</h4> 
<pre><code class="language-TypeScript">    /**
     * 展示点位弹窗
     * @param elem 点位信息
     */
    const showInfoWindow = (elem: any) =&gt; {
      // 设置点位弹窗信息
      state.spInfoWindow.spName = elem.name; // 标题
      state.spInfoWindow.spAddress = elem.address; // 地址
      state.spInfoWindow.location = elem.location; // 弹框坐标

      // 展示点位信息弹框
      state.spInfoWindow.show = true;

      // 修改搜索点位坐标
      state.searchPoint = elem;

      state.mapCenter = elem.location;

      console.log('展示点位弹窗 ---', state.spInfoWindow);
    };</code></pre> 
<p></p> 
<h2 id="%E5%B1%95%E7%A4%BA%E6%90%9C%E7%B4%A2%E7%82%B9%E4%BD%8D%E7%9A%84%E5%91%A8%E8%BE%B9%E7%82%B9%E4%BD%8D%E5%BC%B9%E7%AA%97" style="background-color:transparent;">展示搜索点位的周边点位弹窗</h2> 
<h3>实现效果</h3> 
<ul><li>点击搜索点位的去周边后，出现弹框</li><li>弹窗只能在地图中显示，不能在整个屏幕中显示</li><li>搜索到周边点位后，地图绘制周边距离（辐射圆），并把所有点位进行打点</li></ul> 
<p><img alt="" height="691" src="https://images2.imgbox.com/54/5e/7eqMLQub_o.png" width="1200"></p> 
<p> </p> 
<p> </p> 
<h3>引入地图组件</h3> 
<h4 id="%E8%BE%90%E5%B0%84%E5%9C%86%E3%80%81%E6%B5%B7%E9%87%8F%E7%82%B9%E7%BB%84%E4%BB%B6">辐射圆、海量点组件</h4> 
<pre><code class="language-TypeScript">      &lt;!-- 添加-多个点 https://map.heifahaizei.com/doc/overlay/point-collection.html --&gt;
      &lt;bm-point-collection
        :points="points"
        shape="BMAP_POINT_SHAPE_STAR"
        color="red"
        size="BMAP_POINT_SIZE_SMALL"
      &gt;
      &lt;/bm-point-collection&gt;

      &lt;!-- 圆 https://map.heifahaizei.com/doc/overlay/circle.html --&gt;
      &lt;bm-circle
        :center="circlePath.center"
        :radius="circlePath.radius"
        stroke-color="blue"
        :stroke-opacity="0.5"
        :stroke-weight="2"
        :editing="false"
        :mass-clear="true"
      &gt;&lt;/bm-circle&gt;</code></pre> 
<p> </p> 
<h4 id="%E6%8E%A7%E5%88%B6%E5%BC%B9%E6%A1%86%E5%9C%A8%E5%9C%B0%E5%9B%BE%E8%8C%83%E5%9B%B4%E5%86%85%E6%98%BE%E7%A4%BA">控制弹框在地图范围内显示</h4> 
<p>el-dialog 只能在全局内显示，所以：手写 div 当弹框，让弹框跟地图点位同级，通过绝对定位实现</p> 
<p><img alt="" height="287" src="https://images2.imgbox.com/18/17/pfhqiSnJ_o.png" width="733"></p> 
<p></p> 
<h3 id="%E6%8E%A5%E6%94%B6%E5%BC%B9%E6%A1%86%E7%BB%84%E4%BB%B6%E7%9A%84%E5%91%A8%E8%BE%B9%E7%82%B9%E4%BD%8D%E6%95%B0%E6%8D%AE%EF%BC%8C%E5%B9%B6%E6%98%BE%E7%A4%BA" style="background-color:transparent;">接收弹框组件的周边点位数据，并显示</h3> 
<p><span style="color:#fe2c24;">注意：辐射圆单位是 m，画太小了，页面就显示不出辐射圆了（……）</span></p> 
<pre><code class="language-TypeScript">    /**
     * 地图多个点集合
     */
    const addPoints = (elems: any) =&gt; {
      const pointAll = [];
      for (const workSite of elems.workSiteResult) {
        const position = { lng: workSite.longitude, lat: workSite.latitude };
        pointAll.push(position);
      }

      state.points = pointAll;
      // 填充辐射圆半径
      state.circlePath.radius = elems.kilometerDistance * 1000;
      // 填充辐射圆中心坐标
      state.circlePath.center = elems.location;
    };</code></pre> 
<p> </p> 
<h2 id="%E3%80%90%E4%B8%80%E4%B8%AA%E6%88%91%E5%BE%88%E8%BF%B7%E6%83%91%E7%9A%84%E6%8A%A5%E9%94%99%E3%80%91%E5%A4%9A%E4%B8%AA%E9%A1%B5%E9%9D%A2%E5%BC%95%E7%94%A8%E5%9C%B0%E5%9B%BE%E7%BB%84%E4%BB%B6%E6%97%B6%EF%BC%8C%E8%B7%AF%E7%94%B1%E6%8A%A5%E9%94%99" style="background-color:transparent;">【一个我很迷惑的报错】多个页面引用地图组件时，路由报错</h2> 
<p>我在查看、编辑页都引用了地图组件，就会出现下面的报错</p> 
<p><img alt="" height="441" src="https://images2.imgbox.com/32/59/E0jao3Lo_o.png" width="1200"></p> 
<p>后来发现，只要我把地图、地图组件内部的组件，再 cv 一份出来，分别引入到对应的页面，才能解决报错</p> 
<p>如下所示，3 中的 edit、view 会引用地图组件，如果 3 中的 edit、view 同时引用了 1 或者同时引用了 2，那就会报错</p> 
<p>3 中的 edit 引用 1，view 引用 2，就不会报错</p> 
<p><img alt="" height="416" src="https://images2.imgbox.com/70/13/t2tsaWdA_o.png" width="346"></p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/87c0ea466ac38597d2eb40cea1ec858c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">使用docker 生成镜像，并启动容器。</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3901e1b804b811713b4d510f2db5f446/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Jupyter Notebook 7.0 更新远程访问配置</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>