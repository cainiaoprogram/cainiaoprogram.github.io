<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>java周查询和mysql的yearWeek同步 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="java周查询和mysql的yearWeek同步" />
<meta property="og:description" content="需求要实现按周统计某个数量，本来以为调用mysql的week和java里calendar.get(Calendar.WEEK_OF_YEAR)就行了，结果发现对应不上，而且还有蛋疼的跨年问题，上一年的年末几日和这一年的开头几日可能属于同一周，而且根据天数分布这周可能归属于上一年也可能归属于下一年。mysql还好，有yearWeek方法，而java根本没有类似的方法calendar.get(Calendar.WEEK_OF_YEAR)根本没有包含年份信息，这一点也是比较奇怪，因为单独使用calendar.get(Calendar.WEEK_OF_YEAR)没什么意义。
我绝对参考百度上的日历，以星期一作为一周的开始
mysql使用yearweek(date,1)就行了
java则麻烦一点需要写个方法
public static Integer getYearWeek(Date date) { Calendar calendar = Calendar.getInstance(); calendar.setTime(date); return getYearWeek(calendar); } public static Integer getYearWeek(Calendar calendar) { calendar.setFirstDayOfWeek(Calendar.MONDAY); calendar.setMinimalDaysInFirstWeek(4); int week = calendar.get(Calendar.WEEK_OF_YEAR); int year = calendar.get(Calendar.YEAR); calendar.add(Calendar.DATE, -7);//获得上一周的周数 int lastWeek = calendar.get(Calendar.WEEK_OF_YEAR); int lastYear = calendar.get(Calendar.YEAR); if(week &lt; lastWeek &amp;&amp; year == lastYear) {//周数小于上一周，年数不变说明时间在年末，但是周数已经算到明年，年数需要&#43;1 year &#43;= 1; } if(week &gt; lastWeek &amp;&amp; year &gt; lastYear &amp;&amp; lastWeek != 1) {//周数大于上周，年数也大于上周，并且上周不等于1，说明时间在新年的一月，但是周数还是去年的，年数需要-1 year -= 1; } return year * 100 &#43; week; } 经过测试得出的值是一致的" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/d84062020cc07d9a298786ef670c944a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-05-12T14:55:28+08:00" />
<meta property="article:modified_time" content="2020-05-12T14:55:28+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">java周查询和mysql的yearWeek同步</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>需求要实现按周统计某个数量，本来以为调用mysql的week和java里calendar.get(Calendar.WEEK_OF_YEAR)就行了，结果发现对应不上，而且还有蛋疼的跨年问题，上一年的年末几日和这一年的开头几日可能属于同一周，而且根据天数分布这周可能归属于上一年也可能归属于下一年。mysql还好，有yearWeek方法，而java根本没有类似的方法calendar.get(Calendar.WEEK_OF_YEAR)根本没有包含年份信息，这一点也是比较奇怪，因为单独使用calendar.get(Calendar.WEEK_OF_YEAR)没什么意义。</p> 
<p>我绝对参考百度上的日历，以星期一作为一周的开始</p> 
<p>mysql使用yearweek(date,1)就行了</p> 
<p>java则麻烦一点需要写个方法</p> 
<pre><code>    public static Integer getYearWeek(Date date) {
    	Calendar calendar = Calendar.getInstance();
    	calendar.setTime(date);
    	return getYearWeek(calendar);
    }
    public static Integer getYearWeek(Calendar calendar) {
    	calendar.setFirstDayOfWeek(Calendar.MONDAY);
    	calendar.setMinimalDaysInFirstWeek(4);
    	int week = calendar.get(Calendar.WEEK_OF_YEAR);
    	int year = calendar.get(Calendar.YEAR);
    	calendar.add(Calendar.DATE, -7);//获得上一周的周数
    	int lastWeek = calendar.get(Calendar.WEEK_OF_YEAR);
    	int lastYear = calendar.get(Calendar.YEAR);
    	if(week &lt; lastWeek &amp;&amp; year == lastYear) {//周数小于上一周，年数不变说明时间在年末，但是周数已经算到明年，年数需要+1
    		year += 1;
    	}
    	if(week &gt; lastWeek &amp;&amp; year &gt; lastYear &amp;&amp; lastWeek != 1) {//周数大于上周，年数也大于上周，并且上周不等于1，说明时间在新年的一月，但是周数还是去年的，年数需要-1
    		year -= 1;
    	}
    	return year * 100 + week;
    }</code></pre> 
<p>经过测试得出的值是一致的</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b41fe22ab61531c60889f6d4628cfb34/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">ERROR 1327 (42000): Undeclared variable:</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/930e62cc418ef68c991e0e9c940075d0/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">ZooKeeper 原理及其在 Hadoop 和 HBase 中的应用</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>