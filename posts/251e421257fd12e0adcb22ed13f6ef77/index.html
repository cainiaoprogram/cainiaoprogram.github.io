<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>MyBatis的原理、配置、使用、高级映射和代理机制和缓存机制 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="MyBatis的原理、配置、使用、高级映射和代理机制和缓存机制" />
<meta property="og:description" content="文章目录 一、MyBatis介绍二、MyBatis原理三、MyBatis的配置1、配置全局配置文件2、XML配置1、Properties2、setting3、typeAliases（类型别名）4、Mappers 3、标签详解1、select标签2、insert标签3、update标签4、delete标签 四、MyBatis的使用1、MyBatis中接口绑定的两种实现方式2、XML方式（使用步骤）1、创建Mapper.java接口文件2、创建Mapper.xml配置文件3、配置映射路径4、XML方式的开发规范5、标签1、select标签2、resultMap和resultType的区别3、insert标签 3、注解方式（实现步骤）1、给定POJO类；2、给定mapper.java接口3、配置文件中指定文件映射位置4、@Select注解5、@Insert注解6、@Update注解7、@Delete注解 4、缓存4、自定义缓存5、动态SQL1、if标签2、where标签3、 trim标签4、foreach标签 5、模糊匹配1、直接在参数上进行参数模糊匹配2、mysql中提供的方法concat(,)3、bind表达式 五、MyBatis的高级映射1、订单数据模型1、数据表2、表与表之间的业务关系3、一对一映射 六、MyBatis的深入1、MyBatis代理详解2、MyBatis的缓存机制1、缓存1、一级缓存2、一级缓存测试3、二级缓存4、二级缓存原理5、二级缓存使用测试 一、MyBatis介绍 官网中给出的解释是：
MyBatis 是一款优秀的持久层框架，它支持自定义 SQL、存储过程以及高级映射。MyBatis 免除了几乎所有的 JDBC 代码以及设置参数和获取结果集的工作。MyBatis 可以通过简单的 XML 或注解来配置和映射原始类型、接口和 Java POJO（Plain Old Java Objects，普通老式 Java 对象）为数据库中的记录。 二、MyBatis原理 如果使用 Maven 来构建项目，则需将下面的依赖代码置于 pom.xml 文件中： &lt;dependency&gt; &lt;groupId&gt;org.mybatis&lt;/groupId&gt; &lt;artifactId&gt;mybatis&lt;/artifactId&gt; &lt;version&gt;3.4.1&lt;/version&gt; &lt;/dependency&gt; 从XML文件中构建SqlSessionFactory。每个基于 MyBatis 的应用都是以一个 SqlSessionFactory 的实例为核心的。SqlSessionFactory 的实例可以通过 SqlSessionFactoryBuilder 获得。而 SqlSessionFactoryBuilder 则可以从 XML 配置文件或一个预先配置的 Configuration 实例来构建出 SqlSessionFactory 实例。从 XML 文件中构建 SqlSessionFactory 的实例非常简单，建议使用类路径下的资源文件进行配置。 但也可以使用任意的输入流（InputStream）实例，比如用文件路径字符串或 file:// URL 构造的输入流。MyBatis 包含一个名叫 Resources 的工具类，它包含一些实用方法，使得从类路径或其它位置加载资源文件更加容易。 String resource = &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/251e421257fd12e0adcb22ed13f6ef77/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-03-30T16:18:11+08:00" />
<meta property="article:modified_time" content="2022-03-30T16:18:11+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">MyBatis的原理、配置、使用、高级映射和代理机制和缓存机制</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#MyBatis_1" rel="nofollow">一、MyBatis介绍</a></li><li><a href="#MyBatis_6" rel="nofollow">二、MyBatis原理</a></li><li><a href="#MyBatis_43" rel="nofollow">三、MyBatis的配置</a></li><li><ul><li><a href="#1_54" rel="nofollow">1、配置全局配置文件</a></li><li><a href="#2XML_228" rel="nofollow">2、XML配置</a></li><li><ul><li><a href="#1Properties_232" rel="nofollow">1、Properties</a></li><li><a href="#2setting_258" rel="nofollow">2、setting</a></li><li><a href="#3typeAliases_265" rel="nofollow">3、typeAliases（类型别名）</a></li><li><a href="#4Mappers_277" rel="nofollow">4、Mappers</a></li></ul> 
    </li><li><a href="#3_331" rel="nofollow">3、标签详解</a></li><li><ul><li><a href="#1select_332" rel="nofollow">1、select标签</a></li><li><a href="#2insert_346" rel="nofollow">2、insert标签</a></li><li><a href="#3update_360" rel="nofollow">3、update标签</a></li><li><a href="#4delete_375" rel="nofollow">4、delete标签</a></li></ul> 
   </li></ul> 
   </li><li><a href="#MyBatis_388" rel="nofollow">四、MyBatis的使用</a></li><li><ul><li><a href="#1MyBatis_389" rel="nofollow">1、MyBatis中接口绑定的两种实现方式</a></li><li><a href="#2XML_394" rel="nofollow">2、XML方式（使用步骤）</a></li><li><ul><li><a href="#1Mapperjava_396" rel="nofollow">1、创建Mapper.java接口文件</a></li><li><a href="#2Mapperxml_403" rel="nofollow">2、创建Mapper.xml配置文件</a></li><li><a href="#3_417" rel="nofollow">3、配置映射路径</a></li><li><a href="#4XML_425" rel="nofollow">4、XML方式的开发规范</a></li><li><a href="#5_430" rel="nofollow">5、标签</a></li><li><ul><li><a href="#1select_431" rel="nofollow">1、select标签</a></li><li><a href="#2resultMapresultType_462" rel="nofollow">2、resultMap和resultType的区别</a></li><li><a href="#3insert_469" rel="nofollow">3、insert标签</a></li></ul> 
    </li></ul> 
    </li><li><a href="#3_491" rel="nofollow">3、注解方式（实现步骤）</a></li><li><ul><li><a href="#1POJO_495" rel="nofollow">1、给定POJO类；</a></li><li><a href="#2mapperjava_505" rel="nofollow">2、给定mapper.java接口</a></li><li><a href="#3_511" rel="nofollow">3、配置文件中指定文件映射位置</a></li><li><a href="#4Select_516" rel="nofollow">4、@Select注解</a></li><li><a href="#5Insert_542" rel="nofollow">5、@Insert注解</a></li><li><a href="#6Update_555" rel="nofollow">6、@Update注解</a></li><li><a href="#7Delete_572" rel="nofollow">7、@Delete注解</a></li></ul> 
    </li><li><a href="#4_578" rel="nofollow">4、缓存</a></li><li><a href="#4_609" rel="nofollow">4、自定义缓存</a></li><li><a href="#5SQL_634" rel="nofollow">5、动态SQL</a></li><li><ul><li><a href="#1if_641" rel="nofollow">1、if标签</a></li><li><a href="#2where_698" rel="nofollow">2、where标签</a></li><li><a href="#3_trim_717" rel="nofollow">3、 trim标签</a></li><li><a href="#4foreach_739" rel="nofollow">4、foreach标签</a></li></ul> 
    </li><li><a href="#5_767" rel="nofollow">5、模糊匹配</a></li><li><ul><li><a href="#1_773" rel="nofollow">1、直接在参数上进行参数模糊匹配</a></li><li><a href="#2mysqlconcat_786" rel="nofollow">2、mysql中提供的方法concat(,)</a></li><li><a href="#3bind_794" rel="nofollow">3、bind表达式</a></li></ul> 
   </li></ul> 
   </li><li><a href="#MyBatis_809" rel="nofollow">五、MyBatis的高级映射</a></li><li><ul><li><a href="#1_811" rel="nofollow">1、订单数据模型</a></li><li><ul><li><a href="#1_812" rel="nofollow">1、数据表</a></li><li><a href="#2_882" rel="nofollow">2、表与表之间的业务关系</a></li><li><a href="#3_891" rel="nofollow">3、一对一映射</a></li></ul> 
   </li></ul> 
   </li><li><a href="#MyBatis_977" rel="nofollow">六、MyBatis的深入</a></li><li><ul><li><a href="#1MyBatis_978" rel="nofollow">1、MyBatis代理详解</a></li><li><a href="#2MyBatis_1143" rel="nofollow">2、MyBatis的缓存机制</a></li><li><ul><li><a href="#1_1144" rel="nofollow">1、缓存</a></li><li><ul><li><a href="#1_1146" rel="nofollow">1、一级缓存</a></li><li><a href="#2_1162" rel="nofollow">2、一级缓存测试</a></li><li><a href="#3_1224" rel="nofollow">3、二级缓存</a></li><li><a href="#4_1229" rel="nofollow">4、二级缓存原理</a></li><li><a href="#5_1272" rel="nofollow">5、二级缓存使用测试</a></li></ul> 
    </li></ul> 
   </li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="MyBatis_1"></a>一、MyBatis介绍</h3> 
<ol><li>官网中给出的解释是：<br> <strong>MyBatis 是一款优秀的持久层框架</strong>，它支持自定义 SQL、存储过程以及高级映射。</li><li>MyBatis 免除了几乎所有的 JDBC 代码以及设置参数和获取结果集的工作。</li><li>MyBatis 可以通过简单的 XML 或注解来配置和映射原始类型、接口和 Java POJO（Plain Old Java Objects，普通老式 Java 对象）为数据库中的记录。</li></ol> 
<h3><a id="MyBatis_6"></a>二、MyBatis原理</h3> 
<p><img src="https://images2.imgbox.com/d9/b5/9f8t7A8G_o.png" alt="在这里插入图片描述"></p> 
<ol><li>如果使用 Maven 来构建项目，则需将下面的依赖代码置于 pom.xml 文件中：</li></ol> 
<pre><code class="prism language-java"><span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
            <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>mybatis<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>mybatis<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">3.4</span><span class="token number">.1</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
</code></pre> 
<ol start="2"><li>从XML文件中构建SqlSessionFactory。每个基于 MyBatis 的应用都是以一个 SqlSessionFactory 的实例为核心的。SqlSessionFactory 的实例可以通过 SqlSessionFactoryBuilder 获得。而 SqlSessionFactoryBuilder 则可以从 XML 配置文件或一个预先配置的 Configuration 实例来构建出 SqlSessionFactory 实例。</li><li>从 XML 文件中构建 SqlSessionFactory 的实例非常简单，建议使用类路径下的资源文件进行配置。 但也可以使用任意的输入流（InputStream）实例，比如用文件路径字符串或 file:// URL 构造的输入流。MyBatis 包含一个名叫 Resources 的工具类，它包含一些实用方法，使得从类路径或其它位置加载资源文件更加容易。</li></ol> 
<pre><code class="prism language-java"><span class="token class-name">String</span> resource <span class="token operator">=</span> <span class="token string">"org/mybatis/example/mybatis-config.xml"</span><span class="token punctuation">;</span>
<span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> <span class="token class-name">Resources</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">SqlSessionFactory</span> sqlSessionFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ol start="4"><li>从 SqlSessionFactory 中获取 SqlSession;</li></ol> 
<pre><code class="prism language-java"><span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">SqlSession</span> session <span class="token operator">=</span> sqlSessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token class-name">Blog</span> blog <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Blog</span><span class="token punctuation">)</span> session<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span><span class="token string">"org.mybatis.example.BlogMapper.selectBlog"</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>使用和指定语句的参数和返回值相匹配的接口（比如 BlogMapper.class），现在你的代码不仅更清晰，更加类型安全，还不用担心可能出错的字符串字面值以及强制类型转换。<br> 例如：</p> 
<pre><code class="prism language-java"><span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">SqlSession</span> session <span class="token operator">=</span> sqlSessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token class-name">BlogMapper</span> mapper <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">BlogMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">Blog</span> blog <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">selectBlog</span><span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="MyBatis_43"></a>三、MyBatis的配置</h3> 
<ol><li>除了给定MyBatis依赖之外，还要连接数据库，那就需要再导入数据库驱动：</li></ol> 
<pre><code class="prism language-java"><span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
            <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>mysql<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>mysql<span class="token operator">-</span>connector<span class="token operator">-</span>java<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">5.1</span><span class="token number">.39</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
</code></pre> 
<h4><a id="1_54"></a>1、配置全局配置文件</h4> 
<ol><li>首先在创建的项目中找到resource；<br> <img src="https://images2.imgbox.com/96/ca/RUZEC6SM_o.png" alt="在这里插入图片描述"><br> 如果没有那就创建一个新建一个包，包名设置为resource；然后鼠标右键点击依次点击如下图，将这个包设置为Resource Root；<br> <img src="https://images2.imgbox.com/4a/db/kV84d2VH_o.png" alt="在这里插入图片描述"></li><li>在这个resource下新建一个xml类型的文件，<br> <img src="https://images2.imgbox.com/3a/16/d6loYL11_o.png" alt="在这里插入图片描述"><br> 打开文件在MyBatis官网中找到配置信息，然后再根据需要做出一点修改；</li></ol> 
<pre><code class="prism language-java"><span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">"1.0"</span> encoding<span class="token operator">=</span><span class="token string">"UTF-8"</span> <span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE configuration
        PUBLIC <span class="token string">"-//mybatis.org//DTD Config 3.0//EN"</span>
        <span class="token string">"http://mybatis.org/dtd/mybatis-3-config.dtd"</span><span class="token operator">&gt;</span>
<span class="token generics"><span class="token punctuation">&lt;</span>configuration<span class="token punctuation">&gt;</span></span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>配置数据源<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>environments <span class="token keyword">default</span><span class="token operator">=</span><span class="token string">"development"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>environment id<span class="token operator">=</span><span class="token string">"development"</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>transactionManager type<span class="token operator">=</span><span class="token string">"JDBC"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>dataSource type<span class="token operator">=</span><span class="token string">"POOLED"</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"driver"</span> value<span class="token operator">=</span><span class="token string">"com.mysql.jdbc.Driver"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"url"</span> value<span class="token operator">=</span><span class="token string">"jdbc:mysql://localhost:3306/test"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"username"</span> value<span class="token operator">=</span><span class="token string">"root"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"password"</span> value<span class="token operator">=</span><span class="token string">"123456"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>dataSource<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>environment<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>environments<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>configuration<span class="token operator">&gt;</span>
</code></pre> 
<ol start="3"><li>在main目录的java下创建POJO类，即创建一个包，命名为POJO，然后新建一个类为：Student.java，与数据库中的Student表数据映射为student对象，给定数据库中的属性名，注意属性名要与数据库中的属性要一一对应；</li></ol> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Student</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> SID<span class="token punctuation">;</span><span class="token comment">//学生ID</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token class-name">Sname</span><span class="token punctuation">;</span><span class="token comment">//学生姓名</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token class-name">Ssex</span><span class="token punctuation">;</span><span class="token comment">//学生性别</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> <span class="token class-name">Sage</span><span class="token punctuation">;</span><span class="token comment">//学生年龄</span>
   <span class="token comment">//省略getter和setter方法</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="4"><li>然后再POJO包同一位置上新建一个mapper包，这个包用来存放我们创建的Mapper接口的文件；</li></ol> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">StudentMapper</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">Student</span> <span class="token function">selectStudentById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//通过学生的ID来进行检索</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="5"><li>配置Mapper的xml文件，即在resource资源的目录下创建一个mapper包，在这个包下来存放我们创建的Mapper的xml文件；</li></ol> 
<pre><code class="prism language-java"><span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">"1.0"</span> encoding<span class="token operator">=</span><span class="token string">"UTF-8"</span> <span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE mapper
        PUBLIC <span class="token string">"-//mybatis.org//DTD Mapper 3.0//EN"</span>
        <span class="token string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>根标签  namespace命令空间：给定接口文件的全路径<span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>mapper namespace<span class="token operator">=</span><span class="token string">"com.example.springBootDemo.TestMabits.mapper.StudentMapper"</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>
        当<span class="token class-name">ResultType</span>无法完成某些字段映射时，需要resultMap进行显性映射
        resultMap标签主要用来显性指定返回映射关系
        id<span class="token operator">:</span>必填，表示去名称，可以随便取
        type：必填，指定显性映射的java类的全限定名
        id标签：指定主键映射关系，ID标签一般使用一次指定主键即可
        result：指定非主属性映射关系，可以多次使用
        property：指定java类中属性名（必填
        column：指定数据库中的属性名称（必填
        jdbcType：指定数据库中当前属性类型（选填
        typeHandler：如果是有自定义类型处理器需要在这里指定自定义类型处理器的

<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>resultMap id<span class="token operator">=</span><span class="token string">"studentMap"</span> type<span class="token operator">=</span><span class="token string">"student"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>id property<span class="token operator">=</span><span class="token string">"SID"</span> column<span class="token operator">=</span><span class="token string">"SID"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>result property<span class="token operator">=</span><span class="token string">"Sname"</span> column<span class="token operator">=</span><span class="token string">"Sname"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>result property<span class="token operator">=</span><span class="token string">"Ssex"</span> column<span class="token operator">=</span><span class="token string">"Ssex"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>result property<span class="token operator">=</span><span class="token string">"Sage"</span> column<span class="token operator">=</span><span class="token string">"Sage"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>resultMap<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>
    select标签是查询操作标签
    id属性：（必填的）<span class="token class-name">Statement</span>的id，必填的，和接口文件中的方法名保持一致
    parameterType：表述输入参数的类型（<span class="token class-name">String</span>，pojo，<span class="token class-name">Integer</span>）
    resultType<span class="token operator">:</span>（必填）表示输出参数的类型（<span class="token class-name">String</span>，pojo，<span class="token class-name">Integer</span>）还可以返回resultMap类型（返回的是hashmap）两种类型二选一
    #<span class="token punctuation">{<!-- --></span>XXX<span class="token punctuation">}</span><span class="token operator">:</span>表示占位符  XXX<span class="token operator">:</span>接口方法中的参数名称
    <span class="token operator">--</span><span class="token operator">&gt;</span>


    <span class="token operator">&lt;</span>select id<span class="token operator">=</span><span class="token string">"selectStudentById"</span> parameterType<span class="token operator">=</span><span class="token string">"int"</span> resultType<span class="token operator">=</span><span class="token string">"com.example.springBootDemo.TestMabits.pojo.StudentA"</span><span class="token operator">&gt;</span>
        select <span class="token operator">*</span> from <span class="token class-name">Student</span> where SID <span class="token operator">=</span>#<span class="token punctuation">{<!-- --></span>sid<span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>select<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>    id<span class="token operator">:</span>在空间命名具有唯一性，和方法名保持一致
        parameterType：指定入参的类型，可以是类的全限定名或者

<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>insert id<span class="token operator">=</span><span class="token string">"insertStudent"</span> flushCache<span class="token operator">=</span><span class="token string">"true"</span> parameterType<span class="token operator">=</span><span class="token string">"student"</span><span class="token operator">/</span><span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>select id<span class="token operator">=</span><span class="token string">"selectAllStudents"</span> resultType<span class="token operator">=</span><span class="token string">"com.example.springBootDemo.TestMabits.pojo.Student"</span><span class="token operator">&gt;</span>
        select <span class="token operator">*</span> from <span class="token class-name">Student</span><span class="token punctuation">;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>select<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>mapper<span class="token operator">&gt;</span>
</code></pre> 
<ol start="6"><li>将mapper.xml文件的映射路径配置到全局配置文件中；</li></ol> 
<pre><code class="prism language-java"> <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>映射文件<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>mappers<span class="token punctuation">&gt;</span></span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>resource属性，指定mapper<span class="token punctuation">.</span>xml文件的路径<span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>mapper resource<span class="token operator">=</span><span class="token string">"mapper/StudentMapper.xml"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>mappers<span class="token operator">&gt;</span>
</code></pre> 
<ol start="7"><li>然后再新建一个测试类，用来通过java代码执行查询操作；</li></ol> 
<pre><code class="prism language-java">  <span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>springBootDemo<span class="token punctuation">.</span></span><span class="token class-name">TestMabits</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>springBootDemo<span class="token punctuation">.</span></span><span class="token class-name">TestMabits</span><span class="token punctuation">.</span>mapper<span class="token punctuation">.</span>StudentMapper<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>springBootDemo<span class="token punctuation">.</span></span><span class="token class-name">TestMabits</span><span class="token punctuation">.</span>pojo<span class="token punctuation">.</span>Student<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Delete</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Resources</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span><span class="token class-name">SqlSession</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span><span class="token class-name">SqlSessionFactory</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span><span class="token class-name">SqlSessionFactoryBuilder</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStream</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Properties</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MybatisDemo</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//1、创建SQLSessionFactory对象</span>

        <span class="token comment">//1.读取全局配置文件</span>
        <span class="token class-name">String</span> path<span class="token operator">=</span><span class="token string">"mybatis_config.xml"</span><span class="token punctuation">;</span>

        <span class="token comment">//通过Resource获取文件流</span>
        <span class="token class-name">InputStream</span> resourceAsStream <span class="token operator">=</span> <span class="token class-name">Resources</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//创建会话工厂，通过SQLSessionFactoryBUilder来创建</span>
        <span class="token class-name">Properties</span> properties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        properties<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">,</span><span class="token string">"root"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        properties<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">,</span><span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token class-name">SqlSessionFactory</span> sqlSessionFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>resourceAsStream<span class="token punctuation">,</span>properties<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//        创建会话，会话工厂是用来读取全局配置文件，通过builder类来创建</span>
<span class="token comment">//        通过读取配置文件来创建实例，一般配置文件读取依次即可</span>
<span class="token comment">//        对数据库CRUD操作</span>
<span class="token comment">//        SQLSession是线程不安全的，将其设置为方法的局部变量</span>
<span class="token comment">//        以及缓存是基于SQLSession</span>
        <span class="token class-name">SqlSession</span> sqlSession <span class="token operator">=</span> sqlSessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        通过代理模式创建代理类</span>
        <span class="token class-name">StudentMapper</span> studentMapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">StudentMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        Student student = studentMapper.selectStudentById(4);</span>
<span class="token comment">//        System.out.println(student);</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">&gt;</span></span> students<span class="token operator">=</span>studentMapper<span class="token punctuation">.</span><span class="token function">selectAllStudents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Student</span> s<span class="token operator">:</span>students<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>运行结果：<br> <img src="https://images2.imgbox.com/d5/48/9vsOHLP5_o.png" alt="在这里插入图片描述"></p> 
<ol start="8"><li>MyBatis的操作流程 
  <ol><li>配置MyBatis的全局配置文件（数据源，mapper映射）</li><li>创建SQLSessionFactory对象；</li><li>通过SQLSessionFactory创建SQLSession对象；</li><li>通过SQLSession来操作数据库CRUD操作；</li><li>关闭SQLSession资源；</li></ol> </li></ol> 
<h4><a id="2XML_228"></a>2、XML配置</h4> 
<ol><li>MyBatis 的配置文件包含了会深深影响 MyBatis 行为的设置和属性信息。 配置文档的顶层结构如下：</li></ol> 
<p><img src="https://images2.imgbox.com/0c/14/rS9g0AKo_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="1Properties_232"></a>1、Properties</h5> 
<ol><li>这些属性可以在外部进行配置，并可以进行动态替换。你既可以在典型的 Java 属性文件中配置这些属性，也可以在 properties 元素的子元素中设置。例如：</li></ol> 
<pre><code class="prism language-java">    <span class="token operator">&lt;</span>properties  resource<span class="token operator">=</span><span class="token string">"db.properties"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"username"</span> value<span class="token operator">=</span><span class="token string">"root"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"password"</span> value<span class="token operator">=</span><span class="token string">"123456"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>properties<span class="token operator">&gt;</span>
</code></pre> 
<ol start="2"><li>在其中对应的属性可以用来提花为需要的动态配置的属性值，比如：</li></ol> 
<pre><code class="prism language-java"> <span class="token operator">&lt;</span>dataSource type<span class="token operator">=</span><span class="token string">"POOLED"</span><span class="token operator">&gt;</span>
         <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"driver"</span> value<span class="token operator">=</span><span class="token string">"com.mysql.jdbc.Driver"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
         <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"url"</span> value<span class="token operator">=</span><span class="token string">"jdbc:mysql://localhost:3306/test"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
         <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"username"</span> value<span class="token operator">=</span><span class="token string">"${username}"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
         <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"password"</span> value<span class="token operator">=</span><span class="token string">"${password}"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span><span class="token operator">/</span>dataSource<span class="token operator">&gt;</span>
</code></pre> 
<ol start="3"><li>这个例子中的 username 和 password 将会由 properties 元素中设置的相应值来替换<br> 如果一个属性在不只一个地方进行了配置，那么，MyBatis 将按照下面的顺序来加载：</li></ol> 
<ul><li>首先读取在 properties 元素体内指定的属性。</li><li>然后根据 properties 元素中的 resource 属性读取类路径下属性文件，或根据 url 属性指定的路径读取属性文件，并覆盖之前读取过的同名属性。</li><li>最后读取作为方法参数传递的属性，并覆盖之前读取过的同名属性。<br> 因此，通过方法参数传递的属性具有最高优先级，resource/url 属性中指定的配置文件次之，最低优先级的则是 properties 元素中指定的属性。</li></ul> 
<h5><a id="2setting_258"></a>2、setting</h5> 
<ol><li>这是 MyBatis 中极为重要的调整设置，它们会改变 MyBatis 的运行时行为。 下表描述了设置中各项设置的含义、默认值等。</li></ol> 
<p><img src="https://images2.imgbox.com/71/e8/JQjoFLoE_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/c8/bd/xJkNEkTU_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/44/bf/u1VkQFI8_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/09/b1/AOGO1jus_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="3typeAliases_265"></a>3、typeAliases（类型别名）</h5> 
<ol><li>类型别名是Java类型的短名称，和XML配置有关，存在是在于用来减少类全限定名的冗余,在mapper.xml中，会有很多的Statement，Statement需要的parameterType指定入参类型，需要resultType执行输出参数类型，如果是指定类型需要书写全限定名，不方便开发，可以通过类型别名，较少代码冗余</li></ol> 
<pre><code class="prism language-java">    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>类型别名<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>typeAliases<span class="token punctuation">&gt;</span></span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>单个类型定义别名： type：pojo全路径  alias：别名的名称<span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>typeAlias type<span class="token operator">=</span><span class="token string">"com.tulun.Mybatis.pojo.Student"</span> alias<span class="token operator">=</span><span class="token string">"student"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>批量的别名定义 <span class="token keyword">package</span><span class="token operator">:</span>指定包名，将包下的所有pojo类定义别名，别名是类型（首字母大写或者小写都可以）<span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token keyword">package</span> <span class="token namespace">name</span><span class="token operator">=</span><span class="token string">"com.tulun.Mybatis.pojo"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>typeAliases<span class="token operator">&gt;</span>
</code></pre> 
<h5><a id="4Mappers_277"></a>4、Mappers</h5> 
<ol><li>映射器</li></ol> 
<pre><code class="prism language-java">    <span class="token generics"><span class="token punctuation">&lt;</span>mappers<span class="token punctuation">&gt;</span></span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>单个文件映射：resource属性一次加载一个文件，
        指定xml文件位置，通过namespace来查找mapper接口文件<span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>mapper resource<span class="token operator">=</span><span class="token string">"mapper/StudentMapper.xml"</span><span class="token operator">/</span><span class="token operator">&gt;</span>

        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span><span class="token keyword">class</span>方式映射：通过mapper接口映射单个文件，
        遵循规则：mapper<span class="token punctuation">.</span>java和mapper<span class="token punctuation">.</span>xml放在同一个目录下<span class="token punctuation">,</span>且命名相同<span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span><span class="token operator">&lt;</span>mapper <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"com.tulun.Mybatis.mapper.StudentMapper"</span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">--</span><span class="token operator">&gt;</span>

        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>批量mapper的接口扫描规则
         遵循规则：mapper<span class="token punctuation">.</span>java和mapper<span class="token punctuation">.</span>xml放在同一个目录下<span class="token punctuation">,</span>且命名相同<span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span><span class="token operator">&lt;</span><span class="token keyword">package</span> <span class="token namespace">name</span><span class="token operator">=</span><span class="token string">"com.tulun.Mybatis.mapper"</span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>mappers<span class="token operator">&gt;</span>

</code></pre> 
<ol start="2"><li>MyBatis 的行为已经由上述元素配置完了，我们现在就要来定义 SQL 映射语句了。 但首先，我们需要告诉 MyBatis 到哪里去找到这些语句。 在自动查找资源方面，Java 并没有提供一个很好的解决方案，所以最好的办法是直接告诉 MyBatis 到哪里去找映射文件。 你可以使用相对于类路径的资源引用，或完全限定资源定位符（包括 file:/// 形式的 URL），或类名和包名等。例如：</li></ol> 
<pre><code class="prism language-java"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 使用相对于类路径的资源引用 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token generics"><span class="token punctuation">&lt;</span>mappers<span class="token punctuation">&gt;</span></span>
  <span class="token operator">&lt;</span>mapper resource<span class="token operator">=</span><span class="token string">"org/mybatis/builder/AuthorMapper.xml"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>mapper resource<span class="token operator">=</span><span class="token string">"org/mybatis/builder/BlogMapper.xml"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>mapper resource<span class="token operator">=</span><span class="token string">"org/mybatis/builder/PostMapper.xml"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>mappers<span class="token operator">&gt;</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 使用完全限定资源定位符（URL） <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token generics"><span class="token punctuation">&lt;</span>mappers<span class="token punctuation">&gt;</span></span>
  <span class="token operator">&lt;</span>mapper url<span class="token operator">=</span><span class="token string">"file:///var/mappers/AuthorMapper.xml"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>mapper url<span class="token operator">=</span><span class="token string">"file:///var/mappers/BlogMapper.xml"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>mapper url<span class="token operator">=</span><span class="token string">"file:///var/mappers/PostMapper.xml"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>mappers<span class="token operator">&gt;</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 使用映射器接口实现类的完全限定类名 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token generics"><span class="token punctuation">&lt;</span>mappers<span class="token punctuation">&gt;</span></span>
  <span class="token operator">&lt;</span>mapper <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"org.mybatis.builder.AuthorMapper"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>mapper <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"org.mybatis.builder.BlogMapper"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>mapper <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"org.mybatis.builder.PostMapper"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>mappers<span class="token operator">&gt;</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 将包内的映射器接口实现全部注册为映射器 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token generics"><span class="token punctuation">&lt;</span>mappers<span class="token punctuation">&gt;</span></span>
  <span class="token operator">&lt;</span><span class="token keyword">package</span> <span class="token namespace">name</span><span class="token operator">=</span><span class="token string">"org.mybatis.builder"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>mappers<span class="token operator">&gt;</span>
</code></pre> 
<h4><a id="3_331"></a>3、标签详解</h4> 
<h5><a id="1select_332"></a>1、select标签</h5> 
<pre><code class="prism language-java">    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>
    查询操作是select标签
    id属性：<span class="token punctuation">(</span>必填的<span class="token punctuation">)</span><span class="token class-name">Statement</span>的id是唯一标识，和接口文件中的方法名保持一致
    parameterType：表示输入参数的类型（<span class="token class-name">Pojo</span><span class="token punctuation">,</span><span class="token class-name">Integer</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>）入参类型也可以是parameterMap（hashMap）两种类型二选<span class="token number">1</span>
    <span class="token function">resultType</span><span class="token punctuation">(</span>必填<span class="token punctuation">)</span><span class="token operator">:</span>表示输出参数的类型（<span class="token class-name">Pojo</span><span class="token punctuation">,</span><span class="token class-name">Integer</span><span class="token punctuation">,</span><span class="token class-name">String</span>） 返回类型也可以是resultMap（hashMap）两种类型二选<span class="token number">1</span>
    #<span class="token punctuation">{<!-- --></span>XXX<span class="token punctuation">}</span><span class="token operator">:</span>表示占位符  XXX<span class="token operator">:</span>接口方法中的参数名称
    <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>select id<span class="token operator">=</span><span class="token string">"selectStudentById"</span>  parameterType<span class="token operator">=</span><span class="token string">"int"</span> rresultType<span class="token operator">=</span><span class="token string">"student"</span><span class="token operator">&gt;</span>
        select <span class="token operator">*</span> from student where SID <span class="token operator">=</span>#<span class="token punctuation">{<!-- --></span>sid<span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>select<span class="token operator">&gt;</span>
</code></pre> 
<h5><a id="2insert_346"></a>2、insert标签</h5> 
<pre><code class="prism language-java"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>
    插入操作是insert标签
    id属性：<span class="token punctuation">(</span>必填的<span class="token punctuation">)</span><span class="token class-name">Statement</span>的id是唯一标识，和接口文件中的方法名保持一致
    parameterType：<span class="token punctuation">(</span>可选操作<span class="token punctuation">)</span>表示输入参数的类型（<span class="token class-name">Pojo</span><span class="token punctuation">,</span><span class="token class-name">Integer</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>）入参类型也可以是parameterMap（hashMap）两种类型二选<span class="token number">1</span>
    useGeneratedKeys<span class="token operator">:</span>开启主键回写  
    keyColumn：指定数据库的主键
    keyProperty：主键对应的pojo类属性名
    <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>insert id<span class="token operator">=</span><span class="token string">"testInsert"</span> parameterMap<span class="token operator">=</span><span class="token string">""</span> useGeneratedKeys<span class="token operator">=</span><span class="token string">"true"</span> keyColumn<span class="token operator">=</span><span class="token string">""</span> keyProperty<span class="token operator">=</span><span class="token string">""</span>

</code></pre> 
<h5><a id="3update_360"></a>3、update标签</h5> 
<pre><code class="prism language-java">    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>
    变更操作是update标签
    id属性：<span class="token punctuation">(</span>必填的<span class="token punctuation">)</span><span class="token class-name">Statement</span>的id是唯一标识，和接口文件中的方法名保持一致
    parameterType：<span class="token punctuation">(</span>可选操作<span class="token punctuation">)</span>表示输入参数的类型（<span class="token class-name">Pojo</span><span class="token punctuation">,</span><span class="token class-name">Integer</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>）入参类型也可以是parameterMap（hashMap）两种类型二选<span class="token number">1</span>
    useGeneratedKeys<span class="token operator">:</span>开启主键回写
    keyColumn：指定数据库的主键
    keyProperty：主键对应的pojo类属性名
    <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>update id<span class="token operator">=</span><span class="token string">"testUpdate"</span> <span class="token operator">&gt;</span>
        
    <span class="token operator">&lt;</span><span class="token operator">/</span>update<span class="token operator">&gt;</span>
</code></pre> 
<h5><a id="4delete_375"></a>4、delete标签</h5> 
<pre><code class="prism language-java">    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>
    删除操作是delete标签
    id属性：<span class="token punctuation">(</span>必填的<span class="token punctuation">)</span><span class="token class-name">Statement</span>的id是唯一标识，和接口文件中的方法名保持一致
    parameterType：<span class="token punctuation">(</span>可选操作<span class="token punctuation">)</span>表示输入参数的类型（<span class="token class-name">Pojo</span><span class="token punctuation">,</span><span class="token class-name">Integer</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>）入参类型也可以是parameterMap（hashMap）两种类型二选<span class="token number">1</span>

    <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>delete id<span class="token operator">=</span><span class="token string">"testdelete"</span><span class="token operator">&gt;</span>
        
    <span class="token operator">&lt;</span><span class="token operator">/</span>delete<span class="token operator">&gt;</span> 
</code></pre> 
<h3><a id="MyBatis_388"></a>四、MyBatis的使用</h3> 
<h4><a id="1MyBatis_389"></a>1、MyBatis中接口绑定的两种实现方式</h4> 
<ol><li>通过注解绑定：就是在接口的方法上加上@Select、@update等注解，里面包含SQL语句进行绑定；</li><li>通过XML里面写SQL进行绑定，需要指定xml映射文件里的namespace必须为接口的全路径<br> 语句比较简单时，使用注解绑定，当SQL语句比较复杂是，用xml绑定，一般使用xml比较多；</li></ol> 
<h4><a id="2XML_394"></a>2、XML方式（使用步骤）</h4> 
<p>MyBatis的强大之处在于自定义SQL语句，映射器的xml文件方式相比JDBC简单，节省代码量</p> 
<h5><a id="1Mapperjava_396"></a>1、创建Mapper.java接口文件</h5> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">StudentMapper</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">Student</span> <span class="token function">selectStudentById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> sid<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="2Mapperxml_403"></a>2、创建Mapper.xml配置文件</h5> 
<pre><code class="prism language-java"><span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">"1.0"</span> encoding<span class="token operator">=</span><span class="token string">"UTF-8"</span> <span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE mapper
        PUBLIC <span class="token string">"-//mybatis.org//DTD Mapper 3.0//EN"</span>
        <span class="token string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>根标签  namespace命令空间：给定接口文件的全路径<span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>mapper namespace<span class="token operator">=</span><span class="token string">"com.tulun.Mybatis.mapper.StudentMapper"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>select id<span class="token operator">=</span><span class="token string">"selectStudentById"</span>  parameterType<span class="token operator">=</span><span class="token string">"int"</span> resultType<span class="token operator">=</span><span class="token string">"student"</span><span class="token operator">&gt;</span>
        select <span class="token operator">*</span> from student where SID <span class="token operator">=</span>#<span class="token punctuation">{<!-- --></span>sid<span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>select<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>mapper<span class="token operator">&gt;</span>
</code></pre> 
<h5><a id="3_417"></a>3、配置映射路径</h5> 
<pre><code class="prism language-java">
<span class="token generics"><span class="token punctuation">&lt;</span>mappers<span class="token punctuation">&gt;</span></span>
      <span class="token operator">&lt;</span>mapper resource<span class="token operator">=</span><span class="token string">"mapper/StudentMapper.xml"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>mappers<span class="token operator">&gt;</span>
</code></pre> 
<h5><a id="4XML_425"></a>4、XML方式的开发规范</h5> 
<ol><li>在mapper.xml中namespace命令空间等于Mapper接口的全路径名；</li><li>Mapper.java接口中的方法名和Mapper.xml中的Statement的Id一致；</li><li>Mapper.java接口中方法的参数类型和Mapper.xml中parameterType的指定类型一致；</li><li>Mapper.java接口中方法的返回值类型和Mapper.xml中的resultType指定的类型一致；</li></ol> 
<h5><a id="5_430"></a>5、标签</h5> 
<h6><a id="1select_431"></a>1、select标签</h6> 
<pre><code class="prism language-java"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>
    当resultType无法完成某些自动字段映射时，需要resultMap进行显性映射关系配置
    resultMap标签主要是用来显性指定返回值映射关系
    id属性：必填，表示取名称，可以随便给定
    type属性：必填，指定显性映射的<span class="token class-name">Java</span>类的全限定名
      id标签：指定主键映射关系 id标签一般使用一次指定主键即可
      result标签：指定非主属性映射关系，可以多次使用
        property属性：指定<span class="token class-name">Java</span>类中属性名<span class="token punctuation">(</span>必填<span class="token punctuation">)</span>
        column属性：指定数据库中的属性名称<span class="token punctuation">(</span>必填<span class="token punctuation">)</span>
        jdbcType属性：指定数据库中当前属性类型<span class="token punctuation">(</span>选填<span class="token punctuation">)</span>
        javaType属性：指定<span class="token class-name">Java</span>类中属性类型<span class="token punctuation">(</span>选填<span class="token punctuation">)</span>
        typeHandler属性：类型<span class="token class-name">Handler</span>，如果是有自定义类型处理器需要在这里指定自定义类型处理器的全限定名<span class="token punctuation">(</span>选填<span class="token punctuation">)</span>
    <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>resultMap id<span class="token operator">=</span><span class="token string">"studentMap"</span> type<span class="token operator">=</span><span class="token string">"student"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>id property<span class="token operator">=</span><span class="token string">"SID"</span> column<span class="token operator">=</span><span class="token string">"SID"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>result property<span class="token operator">=</span><span class="token string">"name"</span> column<span class="token operator">=</span><span class="token string">"Sname"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>result property<span class="token operator">=</span><span class="token string">"Ssex"</span> column<span class="token operator">=</span><span class="token string">"Ssex"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>result property<span class="token operator">=</span><span class="token string">"Sage"</span> column<span class="token operator">=</span><span class="token string">"Sage"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>resultMap<span class="token operator">&gt;</span>
</code></pre> 
<pre><code>select标签是查询操作标签
id属性：（必填的）Statement的id，必填的，和接口文件中的方法名保持一致
parameterType：表述输入参数的类型（String，pojo，Integer）
resultType:（必填）表示输出参数的类型（String，pojo，Integer）还可以返回resultMap类型（返回的是hashmap）两种类型二选一
#{XXX}:表示占位符  XXX:接口方法中的参数名称
</code></pre> 
<p><img src="https://images2.imgbox.com/cd/dd/CkgKQKww_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="2resultMapresultType_462"></a>2、resultMap和resultType的区别</h6> 
<ol><li>resultMap和resultType都是指定返回参数类型，类型可以是pojo类全限定名或别名,对于结果物理是单个对象还是多个对象resultMap和resultType都可以使用，值关注映射类型；</li><li>resultType可以完成自动映射过程，但是对于字段不一致是是无法完成字段映射的，如果字段完全一致优先选取resultType；</li><li>resultMap是可以线程完成映射过程，对于字段不一致是能够完成映射，字段不一致优先选取resultMap进行映射；</li><li>如果数据库属性名和Java的字段名全不一样？还能创建出映射对象嘛？不能创建出来映射对象</li><li>如果数据库属性名和Java的字段名只存在一个相同的，能创建出对象嘛？都能创建出对象</li></ol> 
<h6><a id="3insert_469"></a>3、insert标签</h6> 
<pre><code class="prism language-java">  <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>
    insert标签表示插入数据
    id<span class="token operator">:</span>是<span class="token class-name">Statementid</span>，在命名空间具有唯一性，和方法名保持一致
    parameterType<span class="token operator">/</span>parameterType属性：指定入参的类型，可以是类的全限定名或者别名
    flushCache属性：参数为<span class="token boolean">true</span>或者<span class="token boolean">false</span> 默认为<span class="token boolean">true</span> ，用来清除一级缓存和二级缓存
    keyProperty：指定pojo类中主键属性名
    useGeneratedKeys属性：默认为<span class="token boolean">false</span>，可以是<span class="token boolean">false</span>或者是<span class="token boolean">true</span>，
        如果是<span class="token boolean">true</span>，会采用数据自增主键  auto_increment 完整性约束
    keyColumn：表示数据库表中主键的属性名，在update和insert中有效

    没有返回类型指定，如果接口方法返回为<span class="token keyword">int</span>自动给定值
    <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>insert id<span class="token operator">=</span><span class="token string">"insertStudent"</span>  parameterType<span class="token operator">=</span><span class="token string">"student"</span><span class="token operator">&gt;</span>
       insert  into 
       <span class="token function">student</span><span class="token punctuation">(</span>SID<span class="token punctuation">,</span><span class="token class-name">Sname</span><span class="token punctuation">,</span><span class="token class-name">Sage</span><span class="token punctuation">,</span><span class="token class-name">Ssex</span><span class="token punctuation">)</span> 
       values 
       <span class="token punctuation">(</span>#<span class="token punctuation">{<!-- --></span>SID<span class="token punctuation">}</span><span class="token punctuation">,</span>#<span class="token punctuation">{<!-- --></span>name<span class="token punctuation">}</span><span class="token punctuation">,</span>#<span class="token punctuation">{<!-- --></span><span class="token class-name">Sage</span><span class="token punctuation">}</span><span class="token punctuation">,</span>#<span class="token punctuation">{<!-- --></span><span class="token class-name">Ssex</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>insert<span class="token operator">&gt;</span>
</code></pre> 
<h4><a id="3_491"></a>3、注解方式（实现步骤）</h4> 
<ol><li>注解形式就是直接将SQL写在接口方法上；</li><li>效率比较高；</li><li>但是SQL有变化时需要重新编译代码；</li></ol> 
<h5><a id="1POJO_495"></a>1、给定POJO类；</h5> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> passwd<span class="token punctuation">;</span>
  <span class="token comment">//省略getter和setter方法</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="2mapperjava_505"></a>2、给定mapper.java接口</h5> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserMapper</span> <span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="3_511"></a>3、配置文件中指定文件映射位置</h5> 
<pre><code class="prism language-java"><span class="token operator">&lt;</span>mapper <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"com.tulun.Mybatis.mapper.UserMapper"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre> 
<h5><a id="4Select_516"></a>4、@Select注解</h5> 
<pre><code class="prism language-java">    <span class="token comment">/**
     * 通过ID查询
     */</span>
    <span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from user where id = #{id}"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">selectUserById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>当字段无法映射是，通过@Results注解完成显性映射；</p> 
<pre><code class="prism language-java">    <span class="token comment">/**
     * 在mybatis的早的版本：3.3.0之前版本@Results是不能共用
       在mybatis的3.3.1之后的版本@Results 增加了id属性，可以通过id共用同一个Results结果

     @Results和XML形式中resultMap标签类型
     */</span>

    <span class="token annotation punctuation">@Results</span><span class="token punctuation">(</span>id <span class="token operator">=</span> <span class="token string">"userMap"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>property <span class="token operator">=</span> <span class="token string">"id"</span><span class="token punctuation">,</span> column <span class="token operator">=</span> <span class="token string">"id"</span><span class="token punctuation">,</span> id <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>property <span class="token operator">=</span> <span class="token string">"name"</span><span class="token punctuation">,</span> column <span class="token operator">=</span> <span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>property <span class="token operator">=</span> <span class="token string">"pass"</span><span class="token punctuation">,</span> column <span class="token operator">=</span> <span class="token string">"passwd"</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
</code></pre> 
<h5><a id="5Insert_542"></a>5、@Insert注解</h5> 
<pre><code class="prism language-java">    <span class="token comment">/**
     * 插入数据
     * @Insert表示插入
     * @Insert和XML中的insert标签类似
     * 采用数据库自增主键时使用@Options注解，其中有useGeneratedKeys属性，设置为true
     */</span>
    <span class="token annotation punctuation">@Options</span><span class="token punctuation">(</span>useGeneratedKeys <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>keyColumn <span class="token operator">=</span> <span class="token string">"id"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Insert</span><span class="token punctuation">(</span><span class="token string">"insert into user(name,passwd) values(#{name},#{pass})"</span><span class="token punctuation">)</span>
    <span class="token keyword">int</span> <span class="token function">insertUser</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h5><a id="6Update_555"></a>6、@Update注解</h5> 
<p>@Update的两种情况</p> 
<ol><li>update操作传递一个参数；</li></ol> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Update</span><span class="token punctuation">(</span><span class="token string">"update Studet set sex='男' where id=#{id}"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这种情况只有一个参数，参数id可以不使用@Param；</p> 
<ol start="2"><li>update操作传递两个及以上参数</li></ol> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Update</span><span class="token punctuation">(</span><span class="token string">"update Student set sex=#{name} where id=#{id}"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token keyword">int</span> id<span class="token punctuation">,</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这种情况有两个参数，需要使用@Param进行两个参数的区分，否则，在操作数据表时会报出SQL语句的注入风险；</p> 
<h5><a id="7Delete_572"></a>7、@Delete注解</h5> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Delete</span><span class="token punctuation">(</span><span class="token string">"delete from Student where id=#{id}"</span><span class="token punctuation">)</span>
<span class="token keyword">int</span> <span class="token function">deleteStudentById</span><span class="token punctuation">(</span><span class="token class-name">Int</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="4_578"></a>4、缓存</h4> 
<ol><li>MyBatis 内置了一个强大的事务性查询缓存机制，它可以非常方便地配置和定制。 为了使它更加强大而且易于配置，我们对 MyBatis 3 中的缓存实现进行了许多改进。</li><li>默认情况下，只启用了本地的会话缓存，它仅仅对一个会话中的数据进行缓存。 要启用全局的二级缓存，只需要在你的 SQL 映射文件中添加一行：</li><li>映射语句文件中的所有select语句的结果将会被缓存；</li><li>缓存语句文件中所有的Insert、update和delete语句将会刷新缓存；</li><li>缓存会使用最近最少使用算法（LRU，least Recently Used）算法来清除不需要的缓存；</li><li>缓存不会定时进行刷新，（也就是说，没有刷新间隔）；</li><li>缓存会保存列表或对象（无论查询方法返回哪种）的1024个引用；</li><li>缓存会被视为读/写缓存，这意味着获取到的对象并不是共享的，可以安全的被调用者修改，而不干扰其他调用者或线程所做的潜在修改。</li><li>缓存只作用于cache标签所在的映射文件中的语句，如果混合使用Java API和XML映射文件，在共用接口中的语句将不会被默认缓存，需要使用@CacheNamespaceRef注解指定缓存作用域。</li><li>这些属性可以通过cache元素的属性来修改，</li></ol> 
<pre><code class="prism language-java"><span class="token operator">&lt;</span>cache
  eviction<span class="token operator">=</span><span class="token string">"FIFO"</span>
  flushInterval<span class="token operator">=</span><span class="token string">"60000"</span>
  size<span class="token operator">=</span><span class="token string">"512"</span>
  readOnly<span class="token operator">=</span><span class="token string">"true"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre> 
<p>这个更高级的配置创建了一个 FIFO 缓存，每隔 60 秒刷新，最多可以存储结果对象或列表的 512 个引用，而且返回的对象被认为是只读的，因此对它们进行修改可能会在不同线程中的调用者产生冲突。</p> 
<p>可用的清除策略有：</p> 
<ol><li>LRU – 最近最少使用：移除最长时间不被使用的对象。</li><li>FIFO – 先进先出：按对象进入缓存的顺序来移除它们。</li><li>SOFT – 软引用：基于垃圾回收器状态和软引用规则移除对象。</li><li>WEAK – 弱引用：更积极地基于垃圾收集器状态和弱引用规则移除对象。<br> 默认的清除策略是 LRU。</li><li>flushInterval（刷新间隔）属性可以被设置为任意的正整数，设置的值应该是一个以毫秒为单位的合理时间量。 默认情况是不设置，也就是没有刷新间隔，缓存仅仅会在调用语句时刷新。</li><li>size（引用数目）属性可以被设置为任意正整数，要注意欲缓存对象的大小和运行环境中可用的内存资源。默认值是 1024。</li><li>readOnly（只读）属性可以被设置为 true 或 false。只读的缓存会给所有调用者返回缓存对象的相同实例。 因此这些对象不能被修改。这就提供了可观的性能提升。而可读写的缓存会（通过序列化）返回缓存对象的拷贝。 速度上会慢一些，但是更安全，因此默认值是 false。</li></ol> 
<h4><a id="4_609"></a>4、自定义缓存</h4> 
<pre><code class="prism language-java"><span class="token operator">&lt;</span>cache type<span class="token operator">=</span><span class="token string">"com.domain.something.MyCustomCache"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre> 
<ol><li>这个示例展示了如何使用一个自定义的缓存实现。type 属性指定的类必须实现 org.apache.ibatis.cache.Cache 接口，且提供一个接受 String 参数作为 id 的构造器。 这个接口是 MyBatis 框架中许多复杂的接口之一，但是行为却非常简单。</li></ol> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Cache</span> <span class="token punctuation">{<!-- --></span>
  <span class="token class-name">String</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> <span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">putObject</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">Object</span> <span class="token function">getObject</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">boolean</span> <span class="token function">hasKey</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">Object</span> <span class="token function">removeObject</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="2"><li>为了对你的缓存进行配置，只需要简单地在你的缓存实现中添加公有的 JavaBean 属性，然后通过 cache 元素传递属性值，例如，下面的例子将在你的缓存实现上调用一个名为 setCacheFile(String file) 的方法：</li></ol> 
<pre><code class="prism language-java"><span class="token operator">&lt;</span>cache type<span class="token operator">=</span><span class="token string">"com.domain.something.MyCustomCache"</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"cacheFile"</span> value<span class="token operator">=</span><span class="token string">"/tmp/my-custom-cache.tmp"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>cache<span class="token operator">&gt;</span>
</code></pre> 
<h4><a id="5SQL_634"></a>5、动态SQL</h4> 
<ol><li>MyBatis中特征之一支持动态SQL，以标签的形式动态编写SQL，根据业务逻辑来动态的进行SQL拼接功能；</li><li>MyBatis提供9种动态SQL标签</li></ol> 
<pre><code class="prism language-java">trim、<span class="token keyword">if</span>、where、set、foreach、choose、when、otherwise、bind
</code></pre> 
<h5><a id="1if_641"></a>1、if标签</h5> 
<ol><li>动态SQL通常放在where子句，常用于查询、插入、更新等操作；</li><li>根据姓名、性别、姓名和性别的查询相应的数据<br> <img src="https://images2.imgbox.com/4b/56/DpxTFeAj_o.png" alt="在这里插入图片描述"></li><li>if表达式中判断参数是否传递if test属性，该属性必填，为true或者为false，test使用OGNL表达式处理，返回为true则进入if标签中的SQL，返回为false则不会进入标签中；</li></ol> 
<pre><code class="prism language-java">    <span class="token operator">&lt;</span>select id<span class="token operator">=</span><span class="token string">"selectStudentsByNameOrSex"</span> parameterType<span class="token operator">=</span><span class="token string">"student"</span> resultMap<span class="token operator">=</span><span class="token string">"studentMap"</span><span class="token operator">&gt;</span>
        select <span class="token operator">*</span> from student where <span class="token number">1</span><span class="token operator">=</span><span class="token number">1</span>
        <span class="token operator">&lt;</span><span class="token keyword">if</span> test<span class="token operator">=</span><span class="token string">"name != null"</span> <span class="token operator">&gt;</span>
            and <span class="token class-name">Sname</span> <span class="token operator">=</span> #<span class="token punctuation">{<!-- --></span>name<span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token keyword">if</span> test<span class="token operator">=</span><span class="token string">"Ssex != null"</span><span class="token operator">&gt;</span>
            and <span class="token class-name">Ssex</span> <span class="token operator">=</span> #<span class="token punctuation">{<!-- --></span><span class="token class-name">Ssex</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>select<span class="token operator">&gt;</span>
</code></pre> 
<ol start="4"><li>传递两个参数</li></ol> 
<pre><code class="prism language-java"> <span class="token class-name">StudentMapper</span> studentMapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">StudentMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Student</span> student<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        student<span class="token punctuation">.</span><span class="token function">setSname</span><span class="token punctuation">(</span><span class="token string">"李小龙"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        student<span class="token punctuation">.</span><span class="token function">setSsex</span><span class="token punctuation">(</span><span class="token string">"男"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        studentMapper<span class="token punctuation">.</span><span class="token function">selectStudentsByNameOrSex</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/59/7c/v9fNYvid_o.png" alt="在这里插入图片描述"></p> 
<ol start="5"><li>只传递Sname属性</li></ol> 
<pre><code class="prism language-java"> <span class="token class-name">StudentMapper</span> studentMapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">StudentMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Student</span> student<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        student<span class="token punctuation">.</span><span class="token function">setSname</span><span class="token punctuation">(</span><span class="token string">"李小龙"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        studentMapper<span class="token punctuation">.</span><span class="token function">selectStudentsByNameOrSex</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/11/7a/XwfLvCkF_o.png" alt="在这里插入图片描述"></p> 
<ol start="6"><li>只传递Ssex属性</li></ol> 
<pre><code class="prism language-java"> <span class="token class-name">StudentMapper</span> studentMapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">StudentMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Student</span> student<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        student<span class="token punctuation">.</span><span class="token function">setSsex</span><span class="token punctuation">(</span><span class="token string">"男"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        studentMapper<span class="token punctuation">.</span><span class="token function">selectStudentsByNameOrSex</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/ca/1a/lwiH81yQ_o.png" alt="在这里插入图片描述"></p> 
<ol start="7"><li>不传递参数</li></ol> 
<pre><code class="prism language-java">  <span class="token class-name">StudentMapper</span> studentMapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">StudentMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Student</span> student<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        studentMapper<span class="token punctuation">.</span><span class="token function">selectStudentsByNameOrSex</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/3b/d5/hYdbeerz_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="2where_698"></a>2、where标签</h5> 
<ol><li>where标签：如果该标签包含的元素有返回值，就插入一个where，如果where后面的字符串是以and或者or开头的，就将它们剔除；</li></ol> 
<pre><code class="prism language-java"> <span class="token operator">&lt;</span>select id<span class="token operator">=</span><span class="token string">"selectStudentsByNameOrSex"</span> parameterType<span class="token operator">=</span><span class="token string">"student"</span> resultMap<span class="token operator">=</span><span class="token string">"studentMap"</span><span class="token operator">&gt;</span>
        select <span class="token operator">*</span> from student
        <span class="token generics"><span class="token punctuation">&lt;</span>where<span class="token punctuation">&gt;</span></span>
            <span class="token operator">&lt;</span><span class="token keyword">if</span> test<span class="token operator">=</span><span class="token string">"Sname != null"</span> <span class="token operator">&gt;</span>
                and <span class="token class-name">Sname</span> <span class="token operator">=</span> #<span class="token punctuation">{<!-- --></span><span class="token class-name">Sname</span><span class="token punctuation">}</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token keyword">if</span> test<span class="token operator">=</span><span class="token string">"Ssex != null"</span><span class="token operator">&gt;</span>
                and <span class="token class-name">Ssex</span> <span class="token operator">=</span> #<span class="token punctuation">{<!-- --></span><span class="token class-name">Ssex</span><span class="token punctuation">}</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>where<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>select<span class="token operator">&gt;</span>
</code></pre> 
<ol start="2"><li>传递两个参数，只传递Sname，只传递Ssex和不传递参数<br> <img src="https://images2.imgbox.com/1d/28/joxkkC6C_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/0d/ae/RuBuNKQP_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/a6/45/wSANVCCr_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/51/80/yC5C48AN_o.png" alt="在这里插入图片描述"></li><li>where表达式一般和if表达式一起使用，如果条件一个都不满足，则不拼接where条件，如果有一个或者多个表达式，where会直接拼接在SQL上，并且紧随where的表达式的and/or会忽略掉；</li></ol> 
<h5><a id="3_trim_717"></a>3、 trim标签</h5> 
<ol><li>MyBatis提供trim标签一般适用于取出SQL语句中多余的and关键字，“逗号”，或者给SQL语句拼接“where”，“、”，“Set”，“values”等，可用于选择性插入，更新，删除或者是条件查询等操作，where和set标签都可以通过trim标签来实现；</li><li>trim标签存在的属性 
  <ol><li>prefix：给SQL语句拼接的前缀；</li><li>suffix：给SQL语句拼接的后缀；</li><li>prefixOverrides：去除SQL语句前面的关键字或者字符，该关键字或者字符由prefixOverrides属性指定，假设该属性指定为“AND”，当SQL语句的开头为“AND”trim标签将会去除该“AND”;</li><li>suffixOverrides:去除SQL语句后面的关键字或者字符，该关键字或者字符由suffixOverrides属性指定；</li></ol> </li><li>trim可以和上面的where实现相同的功能</li></ol> 
<pre><code class="prism language-java">    <span class="token operator">&lt;</span>select id<span class="token operator">=</span><span class="token string">"selectStudentsByNameOrSex"</span> parameterType<span class="token operator">=</span><span class="token string">"student"</span> resultMap<span class="token operator">=</span><span class="token string">"studentMap"</span><span class="token operator">&gt;</span>
        select <span class="token operator">*</span> from student
        <span class="token operator">&lt;</span>trim prefix<span class="token operator">=</span><span class="token string">"where"</span> prefixOverrides<span class="token operator">=</span><span class="token string">"and"</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token keyword">if</span> test<span class="token operator">=</span><span class="token string">"name != null"</span><span class="token operator">&gt;</span>
                and <span class="token class-name">Sname</span> <span class="token operator">=</span> #<span class="token punctuation">{<!-- --></span>name<span class="token punctuation">}</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token keyword">if</span> test<span class="token operator">=</span><span class="token string">"Ssex != null"</span><span class="token operator">&gt;</span>
                and <span class="token class-name">Ssex</span> <span class="token operator">=</span> #<span class="token punctuation">{<!-- --></span><span class="token class-name">Ssex</span><span class="token punctuation">}</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>trim<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>select<span class="token operator">&gt;</span>
</code></pre> 
<h5><a id="4foreach_739"></a>4、foreach标签</h5> 
<ol><li>适用于批量操作；</li><li>通过一批ID来查询用户；</li></ol> 
<pre><code class="prism language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">&gt;</span></span> <span class="token function">batchQueryStudent</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> ids<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-java">select <span class="token operator">*</span> from student where <span class="token class-name">SID</span> <span class="token function">in</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-java">   <span class="token operator">&lt;</span>select id<span class="token operator">=</span><span class="token string">"batchQueryStudent"</span>  resultMap<span class="token operator">=</span><span class="token string">"studentMap"</span><span class="token operator">&gt;</span>
        select <span class="token operator">*</span> from student where SID in
        <span class="token operator">&lt;</span>foreach collection<span class="token operator">=</span><span class="token string">"list"</span> item<span class="token operator">=</span><span class="token string">"id"</span> <span class="token keyword">open</span><span class="token operator">=</span><span class="token string">"("</span> close<span class="token operator">=</span><span class="token string">")"</span> separator<span class="token operator">=</span><span class="token string">","</span> <span class="token operator">&gt;</span>
            #<span class="token punctuation">{<!-- --></span>id<span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>foreach<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span><span class="token operator">/</span>select<span class="token operator">&gt;</span>
</code></pre> 
<ol start="3"><li>foreach表达式中collection属性是必填的，指定参数入参类型列表（list）、数组（array）、HashMap（map）； 
  <ol><li>item属性：起名字，给集合中单个元素起名称；</li><li>open属性：开始字符串；</li><li>close属性：结束字符串；</li><li>separator属性：分隔符；</li><li>index属性：索引的属性名，在集合数组下值为当前的索引值；</li></ol> </li></ol> 
<h4><a id="5_767"></a>5、模糊匹配</h4> 
<ol><li>需求：查询student表中用户名包含有L的所有用户；</li></ol> 
<pre><code class="prism language-java">select <span class="token operator">*</span> from student where <span class="token class-name">Sname</span> like “<span class="token operator">%</span><span class="token class-name">L</span><span class="token operator">%</span>”
</code></pre> 
<h5><a id="1_773"></a>1、直接在参数上进行参数模糊匹配</h5> 
<ol><li>接口方法</li></ol> 
<pre><code class="prism language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectStudentByName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-java">    <span class="token operator">&lt;</span>select id<span class="token operator">=</span><span class="token string">"selectStudentByName"</span> parameterType<span class="token operator">=</span><span class="token string">"string"</span> resultMap<span class="token operator">=</span><span class="token string">"studentMap"</span><span class="token operator">&gt;</span>
        select <span class="token operator">*</span> from student where <span class="token class-name">Sname</span> like #<span class="token punctuation">{<!-- --></span>name<span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>select<span class="token operator">&gt;</span>
</code></pre> 
<h5><a id="2mysqlconcat_786"></a>2、mysql中提供的方法concat(,)</h5> 
<ol><li>xml配置文件</li></ol> 
<pre><code class="prism language-java">    <span class="token operator">&lt;</span>select id<span class="token operator">=</span><span class="token string">"selectStudentByName"</span> parameterType<span class="token operator">=</span><span class="token string">"string"</span> resultMap<span class="token operator">=</span><span class="token string">"studentMap"</span><span class="token operator">&gt;</span>
        select <span class="token operator">*</span> from student where <span class="token class-name">Sname</span> like  <span class="token function">concat</span><span class="token punctuation">(</span><span class="token string">'%'</span><span class="token punctuation">,</span>#<span class="token punctuation">{<!-- --></span>name<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">'%'</span><span class="token punctuation">)</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>select<span class="token operator">&gt;</span>
</code></pre> 
<h5><a id="3bind_794"></a>3、bind表达式</h5> 
<ol><li>接口方法</li></ol> 
<pre><code class="prism language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectStudentByName</span><span class="token punctuation">(</span><span class="token class-name">Student</span> student<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ol start="2"><li>xml配置文件</li></ol> 
<pre><code class="prism language-java">    <span class="token operator">&lt;</span>select id<span class="token operator">=</span><span class="token string">"selectStudentByName"</span> parameterType<span class="token operator">=</span><span class="token string">"student"</span> resultMap<span class="token operator">=</span><span class="token string">"studentMap"</span><span class="token operator">&gt;</span>
       <span class="token operator">&lt;</span>bind name<span class="token operator">=</span><span class="token string">"ln"</span> value<span class="token operator">=</span><span class="token string">"'%'+name+'%'"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        select <span class="token operator">*</span> from student where <span class="token class-name">Sname</span> like #<span class="token punctuation">{<!-- --></span>ln<span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>select<span class="token operator">&gt;</span>
</code></pre> 
<ol start="3"><li>bind表达式中参数必须是具有getter方法，底层是通过OGNL表达式来进行解析，该表达式通过属性的getter进行获取值</li></ol> 
<h3><a id="MyBatis_809"></a>五、MyBatis的高级映射</h3> 
<ol><li>本质上来说就是多个表联合进行查询的过程；</li></ol> 
<h4><a id="1_811"></a>1、订单数据模型</h4> 
<h5><a id="1_812"></a>1、数据表</h5> 
<ol><li>用户表user：记录了购买商品的用户信息</li><li>订单表orders：记录了用户所创建的订单（购买商品的订单）；</li><li>订单明细表orderdetail：记录了订单的详细信息即购买商品的信息；</li><li>商品表items：记录了商品信息；</li></ol> 
<pre><code class="prism language-java"> drop table <span class="token keyword">if</span> exists `items`<span class="token punctuation">;</span>
CREATE TABLE `items` <span class="token punctuation">(</span>
  `id` <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> NOT <span class="token class-name">NULL</span> AUTO_INCREMENT<span class="token punctuation">,</span>
  `name` <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> NOT NULL COMMENT <span class="token string">'商品名称'</span><span class="token punctuation">,</span>
  `price` <span class="token keyword">float</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> NOT NULL COMMENT <span class="token string">'商品定价'</span><span class="token punctuation">,</span>
  `detail` text COMMENT <span class="token string">'商品描述'</span><span class="token punctuation">,</span>
  `pic` <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> DEFAULT NULL COMMENT <span class="token string">'商品图片'</span><span class="token punctuation">,</span>
  `createtime` datetime NOT NULL COMMENT <span class="token string">'生产日期'</span><span class="token punctuation">,</span>
  <span class="token class-name">PRIMARY</span> KEY <span class="token punctuation">(</span>`id`<span class="token punctuation">)</span>
<span class="token punctuation">)</span> ENGINE<span class="token operator">=</span><span class="token class-name">InnoDB</span>  <span class="token class-name">DEFAULT</span> CHARSET<span class="token operator">=</span>utf8<span class="token punctuation">;</span>

<span class="token comment">/*Table structure for table `user` */</span>
drop table <span class="token keyword">if</span> exists `user`<span class="token punctuation">;</span>
CREATE TABLE `user` <span class="token punctuation">(</span>
  `id` <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> NOT <span class="token class-name">NULL</span> AUTO_INCREMENT<span class="token punctuation">,</span>
  `username` <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> NOT NULL COMMENT <span class="token string">'用户名称'</span><span class="token punctuation">,</span>
  `sex` <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> DEFAULT NULL COMMENT <span class="token string">'性别'</span><span class="token punctuation">,</span>
  `address` <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span> DEFAULT NULL COMMENT <span class="token string">'地址'</span><span class="token punctuation">,</span>
  <span class="token class-name">PRIMARY</span> KEY <span class="token punctuation">(</span>`id`<span class="token punctuation">)</span>
<span class="token punctuation">)</span> ENGINE<span class="token operator">=</span><span class="token class-name">InnoDB</span>  <span class="token class-name">DEFAULT</span> CHARSET<span class="token operator">=</span>utf8<span class="token punctuation">;</span>

<span class="token comment">/*Table structure for table `orders` */</span>
drop table <span class="token keyword">if</span> exists `orders`<span class="token punctuation">;</span>
CREATE TABLE `orders` <span class="token punctuation">(</span>
  `id` <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> NOT <span class="token class-name">NULL</span> AUTO_INCREMENT<span class="token punctuation">,</span>
  `user_id` <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> NOT NULL COMMENT <span class="token string">'下单用户id'</span><span class="token punctuation">,</span>
  `number` <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> NOT NULL COMMENT <span class="token string">'订单号'</span><span class="token punctuation">,</span>
  `createtime` datetime NOT NULL COMMENT <span class="token string">'创建订单时间'</span><span class="token punctuation">,</span>
  `note` <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> DEFAULT NULL COMMENT <span class="token string">'备注'</span><span class="token punctuation">,</span>
  <span class="token class-name">PRIMARY</span> KEY <span class="token punctuation">(</span>`id`<span class="token punctuation">)</span><span class="token punctuation">,</span>
  KEY `<span class="token class-name">FK_orders_1</span>` <span class="token punctuation">(</span>`user_id`<span class="token punctuation">)</span>
<span class="token punctuation">)</span> ENGINE<span class="token operator">=</span><span class="token class-name">InnoDB</span>  <span class="token class-name">DEFAULT</span> CHARSET<span class="token operator">=</span>utf8<span class="token punctuation">;</span>



<span class="token comment">/*Table structure for table `orderdetail` */</span>

drop table <span class="token keyword">if</span> exists `orderdetail`<span class="token punctuation">;</span>
CREATE TABLE `orderdetail` <span class="token punctuation">(</span>
  `id` <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> NOT <span class="token class-name">NULL</span> AUTO_INCREMENT<span class="token punctuation">,</span>
  `orders_id` <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> NOT NULL COMMENT <span class="token string">'订单id'</span><span class="token punctuation">,</span>
  `items_id` <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> NOT NULL COMMENT <span class="token string">'商品id'</span><span class="token punctuation">,</span>
  `items_num` <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> DEFAULT NULL COMMENT <span class="token string">'商品购买数量'</span><span class="token punctuation">,</span>
  <span class="token class-name">PRIMARY</span> KEY <span class="token punctuation">(</span>`id`<span class="token punctuation">)</span><span class="token punctuation">,</span>
  KEY `<span class="token class-name">FK_orderdetail_1</span>` <span class="token punctuation">(</span>`orders_id`<span class="token punctuation">)</span><span class="token punctuation">,</span>
  KEY `<span class="token class-name">FK_orderdetail_2</span>` <span class="token punctuation">(</span>`items_id`<span class="token punctuation">)</span>
<span class="token punctuation">)</span> ENGINE<span class="token operator">=</span><span class="token class-name">InnoDB</span> AUTO_INCREMENT<span class="token operator">=</span><span class="token number">5</span> <span class="token class-name">DEFAULT</span> CHARSET<span class="token operator">=</span>utf8<span class="token punctuation">;</span>
</code></pre> 
<ol start="5"><li>测试基本数据</li></ol> 
<pre><code class="prism language-java">insert  into `items`<span class="token punctuation">(</span>`id`<span class="token punctuation">,</span>`name`<span class="token punctuation">,</span>`price`<span class="token punctuation">,</span>`detail`<span class="token punctuation">,</span>`pic`<span class="token punctuation">,</span>`createtime`<span class="token punctuation">)</span> values <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'台式机'</span><span class="token punctuation">,</span><span class="token number">3000.0</span><span class="token punctuation">,</span><span class="token string">'该电脑质量非常好！！！！'</span><span class="token punctuation">,</span>NULL<span class="token punctuation">,</span><span class="token string">'2015-02-03 13:22:53'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'笔记本'</span><span class="token punctuation">,</span><span class="token number">6000.0</span><span class="token punctuation">,</span><span class="token string">'笔记本性能好，质量好！！！！！'</span><span class="token punctuation">,</span>NULL<span class="token punctuation">,</span><span class="token string">'2015-02-09 13:22:57'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">'背包'</span><span class="token punctuation">,</span><span class="token number">200.0</span><span class="token punctuation">,</span><span class="token string">'名牌背包，容量大质量好！！！！'</span><span class="token punctuation">,</span>NULL<span class="token punctuation">,</span><span class="token string">'2015-02-06 13:23:02'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/*Data for the table `user` */</span>
insert  into `user`<span class="token punctuation">(</span>`id`<span class="token punctuation">,</span>`username`<span class="token punctuation">,</span>`sex`<span class="token punctuation">,</span>`address`<span class="token punctuation">)</span> values <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'王五'</span><span class="token punctuation">,</span><span class="token string">'2'</span><span class="token punctuation">,</span>NULL<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token string">'张三'</span><span class="token punctuation">,</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'北京市'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token string">'张小明'</span><span class="token punctuation">,</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'陕西西安'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token string">'陈小明'</span><span class="token punctuation">,</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'陕西西安'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">,</span><span class="token string">'张三丰'</span><span class="token punctuation">,</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'陕西西安'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">,</span><span class="token string">'陈小明'</span><span class="token punctuation">,</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'陕西西安'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">26</span><span class="token punctuation">,</span><span class="token string">'王五'</span><span class="token punctuation">,</span>NULL<span class="token punctuation">,</span>NULL<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/*Data for the table `orders` */</span>
insert  into `orders`<span class="token punctuation">(</span>`id`<span class="token punctuation">,</span>`user_id`<span class="token punctuation">,</span>`number`<span class="token punctuation">,</span>`createtime`<span class="token punctuation">,</span>`note`<span class="token punctuation">)</span> values <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'1000010'</span><span class="token punctuation">,</span><span class="token string">'2015-02-04 13:22:35'</span><span class="token punctuation">,</span>NULL<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'1000011'</span><span class="token punctuation">,</span><span class="token string">'2015-02-03 13:22:41'</span><span class="token punctuation">,</span>NULL<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token string">'1000012'</span><span class="token punctuation">,</span><span class="token string">'2015-02-12 16:13:23'</span><span class="token punctuation">,</span>NULL<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/*Data for the table `orderdetail` */</span>
insert  into `orderdetail`<span class="token punctuation">(</span>`id`<span class="token punctuation">,</span>`orders_id`<span class="token punctuation">,</span>`items_id`<span class="token punctuation">,</span>`items_num`<span class="token punctuation">)</span> values <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/58/ce/pw3vQ0PJ_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="2_882"></a>2、表与表之间的业务关系</h5> 
<ol><li> <p>user和orders：一对多关系<br> user-&gt;orders:一个用户可以创建多个订单，一对多<br> orders-&gt;user:一个订单只能由一个用户创建，一对一</p> </li><li> <p>orders和orderdetail:（一对多关系）<br> orders-&gt;orderdetail:一个订单可以包括多个订单明细 一对多<br> orderdetail-&gt;orders:一个订单明细只能包括在一个订单中 一对一</p> </li></ol> 
<h5><a id="3_891"></a>3、一对一映射</h5> 
<ol><li>通过订单号来查询订单即用户信息</li></ol> 
<pre><code class="prism language-java">select <span class="token operator">*</span> from orders o<span class="token punctuation">,</span>user u where o<span class="token punctuation">.</span>user_id <span class="token operator">=</span> u<span class="token punctuation">.</span>id and u<span class="token punctuation">.</span>number<span class="token operator">=</span><span class="token operator">?</span>
</code></pre> 
<p>分析：通过分析，orders表示主表，user表是辅助表<br> 在Order的pojo类上添加上User属性</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Orders213</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> userId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> number<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> createTime<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> note<span class="token punctuation">;</span>
    
    <span class="token comment">//新增属性</span>
    <span class="token keyword">private</span> <span class="token class-name">User213</span> user<span class="token punctuation">;</span>
  <span class="token comment">//省略了getter和setter方法</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="2"><li>接口方法</li></ol> 
<pre><code class="prism language-java"><span class="token class-name">Orders213</span> <span class="token function">selectOrdersByNumber</span><span class="token punctuation">(</span><span class="token class-name">String</span> number<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ol start="3"><li>返回结果通过resultType返回</li></ol> 
<pre><code class="prism language-java">    <span class="token operator">&lt;</span>select id<span class="token operator">=</span><span class="token string">"selectOrdersByNumber"</span> parameterType<span class="token operator">=</span><span class="token string">"string"</span> resultType<span class="token operator">=</span><span class="token string">"com.tulun.Mybatis.pojo.Orders213"</span><span class="token operator">&gt;</span>
        select o<span class="token punctuation">.</span>*<span class="token punctuation">,</span>u<span class="token punctuation">.</span>id <span class="token string">"user.id"</span><span class="token punctuation">,</span>u<span class="token punctuation">.</span>username <span class="token string">"user.username"</span><span class="token punctuation">,</span>u<span class="token punctuation">.</span>sex <span class="token string">"user.sex"</span><span class="token punctuation">,</span>u<span class="token punctuation">.</span>address <span class="token string">"user.address"</span> from orders o<span class="token punctuation">,</span>user u where o<span class="token punctuation">.</span>user_id <span class="token operator">=</span> u<span class="token punctuation">.</span>id and o<span class="token punctuation">.</span>number<span class="token operator">=</span> #<span class="token punctuation">{<!-- --></span>number<span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>select<span class="token operator">&gt;</span>
</code></pre> 
<ol start="4"><li>使用resultMap配置一对一映射</li></ol> 
<pre><code class="prism language-java">    <span class="token operator">&lt;</span>resultMap id<span class="token operator">=</span><span class="token string">"orderUserMap"</span> type<span class="token operator">=</span><span class="token string">"com.tulun.Mybatis.pojo.Orders213"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>id property<span class="token operator">=</span><span class="token string">"id"</span> column<span class="token operator">=</span><span class="token string">"id"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>result property<span class="token operator">=</span><span class="token string">"userId"</span> column<span class="token operator">=</span><span class="token string">"user_id"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>result property<span class="token operator">=</span><span class="token string">"number"</span> column<span class="token operator">=</span><span class="token string">"number"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>result property<span class="token operator">=</span><span class="token string">"createTime"</span> column<span class="token operator">=</span><span class="token string">"createtime"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>result property<span class="token operator">=</span><span class="token string">"note"</span> column<span class="token operator">=</span><span class="token string">"note"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>user属性配置<span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>result property<span class="token operator">=</span><span class="token string">"user.id"</span> column<span class="token operator">=</span><span class="token string">"u_id"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>result property<span class="token operator">=</span><span class="token string">"user.username"</span> column<span class="token operator">=</span><span class="token string">"u_username"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>result property<span class="token operator">=</span><span class="token string">"user.sex"</span> column<span class="token operator">=</span><span class="token string">"u_sex"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>result property<span class="token operator">=</span><span class="token string">"user.address"</span> column<span class="token operator">=</span><span class="token string">"u_address"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>resultMap<span class="token operator">&gt;</span>


    <span class="token operator">&lt;</span>select id<span class="token operator">=</span><span class="token string">"selectOrdersByNumber"</span> parameterType<span class="token operator">=</span><span class="token string">"string"</span> resultMap<span class="token operator">=</span><span class="token string">"orderUserMap"</span><span class="token operator">&gt;</span>
        select o<span class="token punctuation">.</span>*<span class="token punctuation">,</span>u<span class="token punctuation">.</span>id u_id<span class="token punctuation">,</span>u<span class="token punctuation">.</span>username u_username<span class="token punctuation">,</span>u<span class="token punctuation">.</span>sex u_sex<span class="token punctuation">,</span>u<span class="token punctuation">.</span>address u_address from orders o<span class="token punctuation">,</span>user u where o<span class="token punctuation">.</span>user_id <span class="token operator">=</span> u<span class="token punctuation">.</span>id and o<span class="token punctuation">.</span>number<span class="token operator">=</span> #<span class="token punctuation">{<!-- --></span>number<span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>select<span class="token operator">&gt;</span>
</code></pre> 
<ol start="5"><li>使用resultMap中提供的association配置一对一关系<br> association：用于配置关联查询的单个对象<br> property属性：要映射到pojo类中的对象的属性<br> javaType：要映射的pojo属性的全限定名<br> columnPrefix：针对数据库相同前缀的别名</li></ol> 
<pre><code class="prism language-java">    <span class="token operator">&lt;</span>resultMap id<span class="token operator">=</span><span class="token string">"orderUserMap1"</span> type<span class="token operator">=</span><span class="token string">"com.tulun.Mybatis.pojo.Orders213"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>id property<span class="token operator">=</span><span class="token string">"id"</span> column<span class="token operator">=</span><span class="token string">"id"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>result property<span class="token operator">=</span><span class="token string">"userId"</span> column<span class="token operator">=</span><span class="token string">"user_id"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>result property<span class="token operator">=</span><span class="token string">"number"</span> column<span class="token operator">=</span><span class="token string">"number"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>result property<span class="token operator">=</span><span class="token string">"createTime"</span> column<span class="token operator">=</span><span class="token string">"createtime"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>result property<span class="token operator">=</span><span class="token string">"note"</span> column<span class="token operator">=</span><span class="token string">"note"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>association property<span class="token operator">=</span><span class="token string">"user"</span> columnPrefix<span class="token operator">=</span><span class="token string">"u_"</span> javaType<span class="token operator">=</span><span class="token string">"com.tulun.Mybatis.pojo.User213"</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>result property<span class="token operator">=</span><span class="token string">"id"</span> column<span class="token operator">=</span><span class="token string">"id"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>result property<span class="token operator">=</span><span class="token string">"username"</span> column<span class="token operator">=</span><span class="token string">"username"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>result property<span class="token operator">=</span><span class="token string">"sex"</span> column<span class="token operator">=</span><span class="token string">"sex"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>result property<span class="token operator">=</span><span class="token string">"address"</span> column<span class="token operator">=</span><span class="token string">"address"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>association<span class="token operator">&gt;</span> 
    <span class="token operator">&lt;</span><span class="token operator">/</span>resultMap<span class="token operator">&gt;</span>
</code></pre> 
<p>优化：</p> 
<pre><code class="prism language-java"><span class="token keyword">extends</span>继承自主类，resultMap使用一个已经存在的map类
<span class="token operator">&lt;</span>resultMap id<span class="token operator">=</span><span class="token string">"orderUserMap2"</span> <span class="token keyword">extends</span><span class="token operator">=</span><span class="token string">"orderMap"</span> type<span class="token operator">=</span><span class="token string">"com.tulun.Mybatis.pojo.Orders213"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>association property<span class="token operator">=</span><span class="token string">"user"</span> columnPrefix<span class="token operator">=</span><span class="token string">"u_"</span> resultMap<span class="token operator">=</span><span class="token string">"com.tulun.Mybatis.mapper.User213Mapper.userMap"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>resultMap<span class="token operator">&gt;</span>
</code></pre> 
<ol start="6"><li>一对一映射使用resultMap下的association来配置映射关系</li></ol> 
<h3><a id="MyBatis_977"></a>六、MyBatis的深入</h3> 
<h4><a id="1MyBatis_978"></a>1、MyBatis代理详解</h4> 
<ol><li>java中动态代理主要是JDK动态代理（接口），CGLib动态代理（类继承）</li></ol> 
<pre><code class="prism language-java">      <span class="token class-name">SqlSession</span> sqlSession <span class="token operator">=</span> sqlSessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token comment">/**
         *在通过sqlSession.getMapper可以获取一个代理对象
         * 对于StudentMapper并没有显性的实现该接口的实现类，
         * 该对象是在运行时动态产生的，该对象就是动态代理对象
         *
         * JDK动态代理
         * 1、首先存在接口（StudentMapper.java）
         * 2、必须存在该接口的实现类(sqlSession.selectOne)
         * 3、实现invocationHandler辅助类
         * 4、通过Proxy类来产生代理对象
         */</span>

        <span class="token comment">//单个对象原始调用方式</span>
<span class="token comment">//        Student student = sqlSession.selectOne("com.tulun.Mybatis.mapper.StudentMapper.selectStudentById", 4);</span>
        <span class="token class-name">StudentMapper</span> studentMapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">StudentMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Student</span> student <span class="token operator">=</span> studentMapper<span class="token punctuation">.</span><span class="token function">selectStudentById</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ol start="2"><li>mybatis中代理对象的获取是通过如下方法</li></ol> 
<pre><code class="prism language-java"> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">StudentMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ol start="3"><li>mapper接口是如何添加进去的？<br> 通过Java代码形式来进行数据源、映射文件的配置形式如下：</li></ol> 
<pre><code class="prism language-java">        <span class="token class-name">Configuration</span> configuration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">PooledDataSourceFactory</span> dataSourceFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PooledDataSourceFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DataSource</span> dataSource <span class="token operator">=</span> dataSourceFactory<span class="token punctuation">.</span><span class="token function">getDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">JdbcTransactionFactory</span> jdbcTransactionFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JdbcTransactionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置环境</span>
        <span class="token class-name">Environment</span> environment <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Environment</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">,</span> jdbcTransactionFactory<span class="token punctuation">,</span> dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
        configuration<span class="token punctuation">.</span><span class="token function">setEnvironment</span><span class="token punctuation">(</span>environment<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//设置mapper接口</span>
        configuration<span class="token punctuation">.</span><span class="token function">addMapper</span><span class="token punctuation">(</span><span class="token class-name">StudentMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>configuration<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ol start="4"><li>重点在于接口的额添加形式：</li></ol> 
<pre><code class="prism language-java">configuration<span class="token punctuation">.</span><span class="token function">addMapper</span><span class="token punctuation">(</span><span class="token class-name">StudentMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ol start="5"><li>在Configuration类中</li></ol> 
<pre><code class="prism language-java">  <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">void</span> <span class="token function">addMapper</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> type<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    mapperRegistry<span class="token punctuation">.</span><span class="token function">addMapper</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> 
<ol start="6"><li>mapper在Configuration类中没有做任何事，添加到mapperRegistry类中</li></ol> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">void</span> <span class="token function">addMapper</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> type<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>type<span class="token punctuation">.</span><span class="token function">isInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">//只允许添加接口</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasMapper</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">//不允许重复添加</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BindingException</span><span class="token punctuation">(</span><span class="token string">"Type "</span> <span class="token operator">+</span> type <span class="token operator">+</span> <span class="token string">" is already known to the MapperRegistry."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">boolean</span> loadCompleted <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        knownMappers<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">MapperProxyFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">MapperAnnotationBuilder</span> parser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MapperAnnotationBuilder</span><span class="token punctuation">(</span>config<span class="token punctuation">,</span> type<span class="token punctuation">)</span><span class="token punctuation">;</span>
        parser<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        loadCompleted <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>loadCompleted<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          knownMappers<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<ol start="7"><li>执行的configuration.addMapper(StudentMapper.class)，实际上最终被放入HashMap中，其命名knownMappers，它是mapperRegistry类中的私有属性，是一个HashMap对象，key是接口class对象，value是MapperProxyFactory的对象实例；</li><li>通过getMapper获取代理对象<br> DefaultSqlSession类：</li></ol> 
<pre><code class="prism language-java">  <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> type<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> configuration<span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token function">getMapper</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> 
<ol start="9"><li>configuration类中存放所有的mybatis全局配置信息从参数上可以知道class类型<br> configuration类：</li></ol> 
<pre><code class="prism language-java">  <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> type<span class="token punctuation">,</span> <span class="token class-name">SqlSession</span> sqlSession<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> mapperRegistry<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> sqlSession<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> 
<ol start="10"><li>configuration类中getmapper调用了mapperRegistry.getMapper，mapperRegistry中存放一个HashMap<br> mapperRegistry类：</li></ol> 
<pre><code class="prism language-java"> <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">MapperProxyFactory</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> knownMappers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">MapperProxyFactory</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> type<span class="token punctuation">,</span> <span class="token class-name">SqlSession</span> sqlSession<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">final</span> <span class="token class-name">MapperProxyFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> mapperProxyFactory <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">MapperProxyFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> knownMappers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mapperProxyFactory <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BindingException</span><span class="token punctuation">(</span><span class="token string">"Type "</span> <span class="token operator">+</span> type <span class="token operator">+</span> <span class="token string">" is not known to the MapperRegistry."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">return</span> mapperProxyFactory<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span>sqlSession<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BindingException</span><span class="token punctuation">(</span><span class="token string">"Error getting mapper instance. Cause: "</span> <span class="token operator">+</span> e<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre> 
<ol start="11"><li>调用mapperRegistry类中的getMapper方法，该方法中会到hashmap中通过类名获取对应的value值，是MapperProxyFactory对象，然后调用newInstance方法，该方法是创建了一个对象</li></ol> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MapperProxyFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span><span class="token comment">//映射器代理工厂</span>

  <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> mapperInterface<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Method</span><span class="token punctuation">,</span> <span class="token class-name">MapperMethod</span><span class="token punctuation">&gt;</span></span> methodCache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Method</span><span class="token punctuation">,</span> <span class="token class-name">MapperMethod</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"unchecked"</span><span class="token punctuation">)</span>
  <span class="token keyword">protected</span> <span class="token class-name">T</span> <span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token class-name">MapperProxy</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> mapperProxy<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">//使用的是JDK自带的动态代理对象生成代理类对象</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>mapperInterface<span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{<!-- --></span> mapperInterface <span class="token punctuation">}</span><span class="token punctuation">,</span> mapperProxy<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token class-name">SqlSession</span> sqlSession<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">final</span> <span class="token class-name">MapperProxy</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> mapperProxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MapperProxy</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>sqlSession<span class="token punctuation">,</span> mapperInterface<span class="token punctuation">,</span> methodCache<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">newInstance</span><span class="token punctuation">(</span>mapperProxy<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MapperProxy</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">InvocationHandler</span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{<!-- --></span>
<span class="token comment">//实现了InvocationHandler接口</span>

  <span class="token annotation punctuation">@Override</span>
    <span class="token comment">//代理之后，所有的mapper的方法调用，都会调用这个invoke方法</span>
  <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">getDeclaringClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//该位置就调用了原始的调用方法：SQLSession.selectOne</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">throw</span> <span class="token class-name">ExceptionUtil</span><span class="token punctuation">.</span><span class="token function">unwrapThrowable</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">final</span> <span class="token class-name">MapperMethod</span> mapperMethod <span class="token operator">=</span> <span class="token function">cachedMapperMethod</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//执行CURD操作  </span>
    <span class="token keyword">return</span> mapperMethod<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>sqlSession<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="12"><li>mybatis中getmapper的代理对象的获取，使用的是JDK动态代理，在MapperRegistry类中的HashMap中存放了所有的mapper接口，key是接口的类名信息，value是MapperProxyFactory类型实例，getmapper操作会是当前对象调用newInstance操作，该操作会调用Proxy.newProxyInstance核心在于调用InvocationHandler接口，实现了invoke方法，除了调用原始的接口调用，而且还对调用进行增强，进行了方法缓存，且最终会执行增删改查操作；</li><li>总结Mapper接口方法执行的几个点： 
  <ol><li>Mapper接口初始在SQLSessionFactory注册的</li><li>Mapper接口注册在MapperRegistry类的HashMap中，key是mapper的接口类名，value是创建当前代理工厂</li><li>Mapper注册之后，可以从过SQLSession来获取get对象</li><li>SQLSession.getMapper运用了JDK动态代理，产生了目标Mapper接口的代理对象，动态代理的代理类是MapperProxy，实现了增删改查调用</li></ol> </li></ol> 
<h4><a id="2MyBatis_1143"></a>2、MyBatis的缓存机制</h4> 
<h5><a id="1_1144"></a>1、缓存</h5> 
<ol><li>mybatis中提供查询缓存，用于减轻数据库的压力，提高数据库的性能mybatis提了了一级缓存和二级缓存</li></ol> 
<h6><a id="1_1146"></a>1、一级缓存</h6> 
<ol><li>一级缓存是SQLSession界别缓存，在操作数据库时都需要构造SQLSession对象，在对象中有一个数据结构（HashMap）用于存储缓存数据，不同的SQLSession之间的缓存数据区域是互不影响的</li><li>一级缓存的作用于是在同一个SQLSession，在同一个SQLSession中执行相同的两次SQL，第一次执行完毕在后会将数据写到缓存中，第二次从缓存中进行后去就不在数据库中查询，从而提高了效率，<br> 当一个SQLSession结束后该SQLSession中的一级缓存也就不存在了，mybatis默认开启一级缓存</li></ol> 
<p><img src="https://images2.imgbox.com/41/49/FZQE3Lon_o.png" alt="在这里插入图片描述"></p> 
<ol start="3"><li>每个SqlSession中持有一个执行器Executor，每个执行器中有一个Local Cache，当用户发起查询时，mybatis根据当前执行的语句生成mapperStatement,在Local Cache中进行查询，如果缓存命中的话，直接返回给用户，如果没有命中，查询数据库，结果写入Local Cache中，最后返回给用户</li><li>通过ID查询用户信息</li></ol> 
<p><img src="https://images2.imgbox.com/f2/23/KfhxbkiF_o.png" alt="在这里插入图片描述"></p> 
<ol start="5"><li>缓存生效失效时机：<br> 如果是连续的查询同一个数据操作，在第一次查询之后，后续查询都可以命中缓存<br> 如果在查询之后，紧接着是进行变更操作，就会导致缓存失效</li></ol> 
<h6><a id="2_1162"></a>2、一级缓存测试</h6> 
<ol><li>mybatis是默认支持一级缓存，不需要做其他配置；</li><li>测试1：同一个SQLSession下连续进行查询操作</li></ol> 
<pre><code class="prism language-java">        <span class="token comment">//同一个SQLSession连续进行查询操作</span>
        <span class="token class-name">StudentMapper</span> studentMapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">StudentMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//第一次查询操作</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"第一次查询开始......"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Student</span> student <span class="token operator">=</span> studentMapper<span class="token punctuation">.</span><span class="token function">selectStudentById</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"第一次查询结束......"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"第二次查询开始......"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Student</span> student1 <span class="token operator">=</span> studentMapper<span class="token punctuation">.</span><span class="token function">selectStudentById</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"第二次查询结束......"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


</code></pre> 
<ol start="3"><li>通过执行结果可知：第一次查询会查询数据库，第二次查询操作是没有查询SQL，即通过缓存查询到结果返回</li><li>测试2：第一次查询结束后，对数据进行变更操作，再次执行查询操作</li></ol> 
<pre><code class="prism language-java">        <span class="token comment">//同一个SQLSession连续进行查询操作</span>
        <span class="token class-name">StudentMapper</span> studentMapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">StudentMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//第一次查询操作</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"第一次查询开始......"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Student</span> student <span class="token operator">=</span> studentMapper<span class="token punctuation">.</span><span class="token function">selectStudentById</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"第一次查询结束......"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//对数据进行变更操作</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"变更操作开始...."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        studentMapper<span class="token punctuation">.</span><span class="token function">updateNameById</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sqlSession<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"变更操作结束...."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//第二次查询</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"第二次查询开始......"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Student</span> student1 <span class="token operator">=</span> studentMapper<span class="token punctuation">.</span><span class="token function">selectStudentById</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"第二次查询结束......"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> 
<ol start="5"><li>在查询结束后，如果对于数据进行变更操作，会删除掉缓存，导致第二次查询依然需要进入到数据库</li><li>case3:不同的SQLSession下同一个操作是否会命中缓存</li></ol> 
<pre><code class="prism language-java"><span class="token class-name">SqlSession</span> sqlSession <span class="token operator">=</span> sqlSessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//分别数据不同的SQLSession是否会命中缓存</span>
        <span class="token class-name">StudentMapper</span> studentMapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">StudentMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//第一次查询操作</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"第一次查询开始......"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Student</span> student <span class="token operator">=</span> studentMapper<span class="token punctuation">.</span><span class="token function">selectStudentById</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"第一次查询结束......"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">SqlSession</span> sqlSession1 <span class="token operator">=</span> sqlSessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">StudentMapper</span> studentMapper1 <span class="token operator">=</span> sqlSession1<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">StudentMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//第二次查询</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"第二次查询开始......"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Student</span> student1 <span class="token operator">=</span> studentMapper1<span class="token punctuation">.</span><span class="token function">selectStudentById</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"第二次查询结束......"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ol start="7"><li>不同的SQLSession的一级缓存是无法共享</li></ol> 
<h6><a id="3_1224"></a>3、二级缓存</h6> 
<ol><li>二级缓存是mapper级别缓存，多个SQLSession去操作同一个mapper的SQL语句，多个SQLSession操作都会存在二级缓存中，多个SQLSession共用二级缓存，二级缓存是跨SQLSession</li><li>二级缓存是多个SQLSession共享的，作用域是mapper下的同一个namespace。不同的SQLSession两次执行相同的namespace下的SQL最终能获取相同的SQL语句结果</li><li>mybatis默认是没有开启二级缓存的，需要在全局配置文件中配置开启二级缓存</li><li>mybatis中二级缓存是mapper级别的缓存，默认是关闭。对于一个mapper下的不同的SQLSession可以共享二级缓存，不同的mapper是相互隔离的，二级缓存的特点是需要打开二级缓存的配置，并且需要映射的java类需要实现序列化</li></ol> 
<h6><a id="4_1229"></a>4、二级缓存原理</h6> 
<p><img src="https://images2.imgbox.com/6c/7d/1nzKpBXq_o.png" alt="在这里插入图片描述"></p> 
<p>二级缓存和一级缓存的区别：<br> 二级缓存范围更大，多个SQLSession可以共享一个mapper级别的二级缓存，数据类型依然是HashMap来存储二级缓存内容，mapper是按照namespace划分，如果namespace相同则使用同一个二级缓存，<br> 一级缓存范围会更小，是一个SQLSession级别</p> 
<ol><li>二级缓存使用步骤 
  <ol><li>在mybatis的全局配置文件中开启二级缓存</li></ol> </li></ol> 
<pre><code class="prism language-java">    <span class="token generics"><span class="token punctuation">&lt;</span>settings<span class="token punctuation">&gt;</span></span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>cacheEnabled<span class="token operator">:</span>开启mybatis的二级缓存<span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>setting name<span class="token operator">=</span><span class="token string">"cacheEnabled"</span> value<span class="token operator">=</span><span class="token string">" true"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>settings<span class="token operator">&gt;</span>
</code></pre> 
<pre><code>2.  将映射的pojo类实现序列化
</code></pre> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Student</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span>
</code></pre> 
<pre><code>3. 在mapper配置文件中使用cache标签
</code></pre> 
<pre><code class="prism language-java"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>
    cache和二级缓存相关标签
    eviction属性：代表缓存的回收策略，mybatis提供了回收策略如下：
    LRU：最近最少使用，对于最长时间不用的对象进行回收
    FIFO：先进先出，按照帝乡进入缓存的顺序来进行回收
    SOFT：软引用，移除基于垃圾回收器状态和软引用规则的对象
    WEAK：弱引用，基于垃圾回收器状态和弱引用规则的对象

    flushInterval属性：刷新间隔时间，单位是毫秒
    size属性：引用数目，代表缓存可以存储最多多少个对象
    readOnly属性：只读，意味着缓存数据只能读取不能修改
    <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>cache eviction<span class="token operator">=</span><span class="token string">"FIFO"</span> flushInterval<span class="token operator">=</span><span class="token string">"1000"</span> size<span class="token operator">=</span><span class="token string">"1024"</span> readOnly<span class="token operator">=</span><span class="token string">"false"</span><span class="token operator">/</span><span class="token operator">&gt;</span>

</code></pre> 
<h6><a id="5_1272"></a>5、二级缓存使用测试</h6> 
<pre><code class="prism language-java">    <span class="token comment">//二级缓存的测试</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testCache2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//不同的SQLSession会话进行相同的SQL查询操作</span>
        <span class="token comment">//SQLSession1实例</span>
        <span class="token class-name">SqlSession</span> sqlSession <span class="token operator">=</span> sessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Student23Mapper</span> student23Mapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">Student23Mapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//SQLSession2实例</span>
        <span class="token class-name">SqlSession</span> sqlSession1 <span class="token operator">=</span> sessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Student23Mapper</span> student23Mapper1 <span class="token operator">=</span> sqlSession1<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">Student23Mapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//sqlsession实例3</span>
        <span class="token class-name">SqlSession</span> sqlSession2 <span class="token operator">=</span> sessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Student23Mapper</span> student23Mapper2 <span class="token operator">=</span> sqlSession2<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">Student23Mapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token comment">//第一次查询id为1的用户</span>
        <span class="token class-name">Student23</span> student23 <span class="token operator">=</span> student23Mapper<span class="token punctuation">.</span><span class="token function">selectStudentByUid</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>student23<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//这里执行关闭操作，将SQLSession中的数据写入到二级缓存区域</span>
        sqlSession<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>



        <span class="token comment">//第二次查询id为1的用户</span>
        <span class="token class-name">Student23</span> student24 <span class="token operator">=</span> student23Mapper1<span class="token punctuation">.</span><span class="token function">selectStudentByUid</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>student24<span class="token punctuation">)</span><span class="token punctuation">;</span>
        sqlSession1<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<ol><li>表明不同的SQLSession可以共享一个二级缓存</li><li>底层：二级缓存是一个Cache接口的实现类，一级缓存是一个localCache是一个HashMap的属性<br> 执行过程先经过二级缓存，在二级缓存未命中时才会走一级缓存</li></ol>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/dd7f1184423a8b9c80c706134415708c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">小猫爪：S32K3学习笔记12-S32K3之STCU2</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9307b5e92d5c1bcc26efd9364a326661/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Python之Socket自动重连</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>