<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>python划分训练集、验证集和测试集 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="python划分训练集、验证集和测试集" />
<meta property="og:description" content="将图片和标注文件分别划分到文件夹中去
# 将图片和标注数据按比例切分为 训练集和测试集、验证集 import shutil import random import os # 原始路径 image_original_path = &#39;a/images/&#39; label_original_path = &#39;a/annotations/&#39; # 训练集路径 train_image_path = &#39;a/train/images/&#39; train_label_path = &#39;a/train/labels/&#39; # 验证集路径 val_image_path = &#39;a/val/images/&#39; val_label_path = &#39;a/val/labels/&#39; # 测试集路径 test_image_path = &#39;a/test/images/&#39; test_label_path = &#39;a/test/labels/&#39; # 数据集划分比例，训练集80%，验证集10%，测试集10% train_percent = 0.8 val_percent = 0.1 test_percent = 0.1 # 检查文件夹是否存在 def mkdir(): if not os.path.exists(train_image_path): os.makedirs(train_image_path) if not os.path.exists(train_label_path): os.makedirs(train_label_path) if not os.path.exists(val_image_path): os.makedirs(val_image_path) if not os." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/59774ed254f058b69c87eddd0f758e9b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-02-21T15:50:45+08:00" />
<meta property="article:modified_time" content="2022-02-21T15:50:45+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">python划分训练集、验证集和测试集</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>将图片和标注文件分别划分到文件夹中去</p> 
<pre><code class="prism language-python"><span class="token comment"># 将图片和标注数据按比例切分为 训练集和测试集、验证集</span>
<span class="token keyword">import</span> shutil
<span class="token keyword">import</span> random
<span class="token keyword">import</span> os

<span class="token comment"># 原始路径</span>
image_original_path <span class="token operator">=</span> <span class="token string">'a/images/'</span>
label_original_path <span class="token operator">=</span> <span class="token string">'a/annotations/'</span>
<span class="token comment"># 训练集路径</span>
train_image_path <span class="token operator">=</span> <span class="token string">'a/train/images/'</span>
train_label_path <span class="token operator">=</span> <span class="token string">'a/train/labels/'</span>
<span class="token comment"># 验证集路径</span>
val_image_path <span class="token operator">=</span> <span class="token string">'a/val/images/'</span>
val_label_path <span class="token operator">=</span> <span class="token string">'a/val/labels/'</span>
<span class="token comment"># 测试集路径</span>
test_image_path <span class="token operator">=</span> <span class="token string">'a/test/images/'</span>
test_label_path <span class="token operator">=</span> <span class="token string">'a/test/labels/'</span>

<span class="token comment"># 数据集划分比例，训练集80%，验证集10%，测试集10%</span>
train_percent <span class="token operator">=</span> <span class="token number">0.8</span>
val_percent <span class="token operator">=</span> <span class="token number">0.1</span>
test_percent <span class="token operator">=</span> <span class="token number">0.1</span>

<span class="token comment"># 检查文件夹是否存在</span>
<span class="token keyword">def</span> <span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>train_image_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>train_image_path<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>train_label_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>train_label_path<span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>val_image_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>val_image_path<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>val_label_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>val_label_path<span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>test_image_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>test_image_path<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>test_label_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>test_label_path<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    mkdir<span class="token punctuation">(</span><span class="token punctuation">)</span>

    total_txt <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>label_original_path<span class="token punctuation">)</span>
    num_txt <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>total_txt<span class="token punctuation">)</span>
    list_all_txt <span class="token operator">=</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_txt<span class="token punctuation">)</span>  <span class="token comment"># 范围 range(0, num)</span>

    num_train <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>num_txt <span class="token operator">*</span> train_percent<span class="token punctuation">)</span>
    num_val <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>num_txt <span class="token operator">*</span> val_percent<span class="token punctuation">)</span>
    num_test <span class="token operator">=</span> num_txt <span class="token operator">-</span> num_train <span class="token operator">-</span> num_val

    train <span class="token operator">=</span> random<span class="token punctuation">.</span>sample<span class="token punctuation">(</span>list_all_txt<span class="token punctuation">,</span> num_train<span class="token punctuation">)</span>
    <span class="token comment"># train从list_all_txt取出num_train个元素</span>
    <span class="token comment"># 所以list_all_txt列表只剩下了这些元素：val_test</span>
    val_test <span class="token operator">=</span> <span class="token punctuation">[</span>i <span class="token keyword">for</span> i <span class="token keyword">in</span> list_all_txt <span class="token keyword">if</span> <span class="token keyword">not</span> i <span class="token keyword">in</span> train<span class="token punctuation">]</span>
    <span class="token comment"># 再从val_test取出num_val个元素，val_test剩下的元素就是test</span>
    val <span class="token operator">=</span> random<span class="token punctuation">.</span>sample<span class="token punctuation">(</span>val_test<span class="token punctuation">,</span> num_val<span class="token punctuation">)</span>
    <span class="token comment"># 检查两个列表元素是否有重合的元素</span>
    <span class="token comment"># set_c = set(val_test) &amp; set(val)</span>
    <span class="token comment"># list_c = list(set_c)</span>
    <span class="token comment"># print(list_c)</span>
    <span class="token comment"># print(len(list_c))</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"训练集数目：{}, 验证集数目：{},测试集数目：{}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>train<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>val_test<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token builtin">len</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> list_all_txt<span class="token punctuation">:</span>
        name <span class="token operator">=</span> total_txt<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">]</span>

        srcImage <span class="token operator">=</span> image_original_path <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">'.jpg'</span>
        srcLabel <span class="token operator">=</span> label_original_path <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">'.txt'</span>

        <span class="token keyword">if</span> i <span class="token keyword">in</span> train<span class="token punctuation">:</span>
            dst_train_Image <span class="token operator">=</span> train_image_path <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">'.jpg'</span>
            dst_train_Label <span class="token operator">=</span> train_label_path <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">'.txt'</span>
            shutil<span class="token punctuation">.</span>copyfile<span class="token punctuation">(</span>srcImage<span class="token punctuation">,</span> dst_train_Image<span class="token punctuation">)</span>
            shutil<span class="token punctuation">.</span>copyfile<span class="token punctuation">(</span>srcLabel<span class="token punctuation">,</span> dst_train_Label<span class="token punctuation">)</span>
        <span class="token keyword">elif</span> i <span class="token keyword">in</span> val<span class="token punctuation">:</span>
            dst_val_Image <span class="token operator">=</span> val_image_path <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">'.jpg'</span>
            dst_val_Label <span class="token operator">=</span> val_label_path <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">'.txt'</span>
            shutil<span class="token punctuation">.</span>copyfile<span class="token punctuation">(</span>srcImage<span class="token punctuation">,</span> dst_val_Image<span class="token punctuation">)</span>
            shutil<span class="token punctuation">.</span>copyfile<span class="token punctuation">(</span>srcLabel<span class="token punctuation">,</span> dst_val_Label<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            dst_test_Image <span class="token operator">=</span> test_image_path <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">'.jpg'</span>
            dst_test_Label <span class="token operator">=</span> test_label_path <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">'.txt'</span>
            shutil<span class="token punctuation">.</span>copyfile<span class="token punctuation">(</span>srcImage<span class="token punctuation">,</span> dst_test_Image<span class="token punctuation">)</span>
            shutil<span class="token punctuation">.</span>copyfile<span class="token punctuation">(</span>srcLabel<span class="token punctuation">,</span> dst_test_Label<span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span>



</code></pre> 
<p>下面这个代码仅仅将每个数据的名字划分成训练集、验证集和测试集，上面那个会将图片和标注文件分别放到不同的文件夹。</p> 
<p>这里是贴的B站一个博主的.py文件—Bubbliiiing！！这个博主人超好的</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> os
<span class="token keyword">import</span> random
<span class="token keyword">import</span> xml<span class="token punctuation">.</span>etree<span class="token punctuation">.</span>ElementTree <span class="token keyword">as</span> ET

<span class="token keyword">from</span> utils<span class="token punctuation">.</span>utils <span class="token keyword">import</span> get_classes

<span class="token comment">#--------------------------------------------------------------------------------------------------------------------------------#</span>
<span class="token comment">#   annotation_mode用于指定该文件运行时计算的内容</span>
<span class="token comment">#   annotation_mode为0代表整个标签处理过程，包括获得VOCdevkit/VOC2007/ImageSets里面的txt以及训练用的2007_train.txt、2007_val.txt</span>
<span class="token comment">#   annotation_mode为1代表获得VOCdevkit/VOC2007/ImageSets里面的txt</span>
<span class="token comment">#   annotation_mode为2代表获得训练用的2007_train.txt、2007_val.txt</span>
<span class="token comment">#--------------------------------------------------------------------------------------------------------------------------------#</span>
annotation_mode     <span class="token operator">=</span> <span class="token number">0</span>
<span class="token comment">#-------------------------------------------------------------------#</span>
<span class="token comment">#   必须要修改，用于生成2007_train.txt、2007_val.txt的目标信息</span>
<span class="token comment">#   与训练和预测所用的classes_path一致即可</span>
<span class="token comment">#   如果生成的2007_train.txt里面没有目标信息</span>
<span class="token comment">#   那么就是因为classes没有设定正确</span>
<span class="token comment">#   仅在annotation_mode为0和2的时候有效</span>
<span class="token comment">#-------------------------------------------------------------------#</span>
classes_path <span class="token operator">=</span> <span class="token string">'model_data/voc_classes.txt'</span>  <span class="token comment"># 类别名称，例如person，cat，dog等等</span>
<span class="token comment">#--------------------------------------------------------------------------------------------------------------------------------#</span>
<span class="token comment">#   trainval_percent用于指定(训练集+验证集)与测试集的比例，默认情况下 (训练集+验证集):测试集 = 9:1 </span>
<span class="token comment">#   train_percent用于指定(训练集+验证集)中训练集与验证集的比例，默认情况下 训练集:验证集 = 9:1 </span>
<span class="token comment">#   仅在annotation_mode为0和1的时候有效</span>
<span class="token comment">#--------------------------------------------------------------------------------------------------------------------------------#</span>
trainval_percent <span class="token operator">=</span> <span class="token number">0.9</span>
train_percent <span class="token operator">=</span> <span class="token number">0.9</span>
<span class="token comment">#-------------------------------------------------------#</span>
<span class="token comment">#   指向VOC数据集所在的文件夹</span>
<span class="token comment">#   默认指向根目录下的VOC数据集</span>
<span class="token comment">#-------------------------------------------------------#</span>
VOCdevkit_path <span class="token operator">=</span> <span class="token string">'VOCdevkit'</span>

VOCdevkit_sets <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'2007'</span><span class="token punctuation">,</span> <span class="token string">'train'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'2007'</span><span class="token punctuation">,</span> <span class="token string">'val'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
classes<span class="token punctuation">,</span> _  <span class="token operator">=</span> get_classes<span class="token punctuation">(</span>classes_path<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">convert_annotation</span><span class="token punctuation">(</span>year<span class="token punctuation">,</span> image_id<span class="token punctuation">,</span> list_file<span class="token punctuation">)</span><span class="token punctuation">:</span>
    in_file <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>VOCdevkit_path<span class="token punctuation">,</span> <span class="token string">'VOC%s/Annotations/%s.xml'</span><span class="token operator">%</span><span class="token punctuation">(</span>year<span class="token punctuation">,</span> image_id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    tree<span class="token operator">=</span>ET<span class="token punctuation">.</span>parse<span class="token punctuation">(</span>in_file<span class="token punctuation">)</span>
    root <span class="token operator">=</span> tree<span class="token punctuation">.</span>getroot<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> obj <span class="token keyword">in</span> root<span class="token punctuation">.</span><span class="token builtin">iter</span><span class="token punctuation">(</span><span class="token string">'object'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        difficult <span class="token operator">=</span> <span class="token number">0</span> 
        <span class="token keyword">if</span> obj<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'difficult'</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token boolean">None</span><span class="token punctuation">:</span>
            difficult <span class="token operator">=</span> obj<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'difficult'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text
        cls <span class="token operator">=</span> obj<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text
        <span class="token keyword">if</span> cls <span class="token keyword">not</span> <span class="token keyword">in</span> classes <span class="token keyword">or</span> <span class="token builtin">int</span><span class="token punctuation">(</span>difficult<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">:</span>
            <span class="token keyword">continue</span>
        cls_id <span class="token operator">=</span> classes<span class="token punctuation">.</span>index<span class="token punctuation">(</span>cls<span class="token punctuation">)</span>
        xmlbox <span class="token operator">=</span> obj<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'bndbox'</span><span class="token punctuation">)</span>
        b <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>xmlbox<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'xmin'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>xmlbox<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'ymin'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>xmlbox<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'xmax'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>xmlbox<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'ymax'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        list_file<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">" "</span> <span class="token operator">+</span> <span class="token string">","</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token keyword">for</span> a <span class="token keyword">in</span> b<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">','</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>cls_id<span class="token punctuation">)</span><span class="token punctuation">)</span>
        
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> annotation_mode <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">or</span> annotation_mode <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Generate txt in ImageSets."</span><span class="token punctuation">)</span>
        xmlfilepath <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>VOCdevkit_path<span class="token punctuation">,</span> <span class="token string">'VOC2007/Annotations'</span><span class="token punctuation">)</span>
        saveBasePath <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>VOCdevkit_path<span class="token punctuation">,</span> <span class="token string">'VOC2007/ImageSets/Main'</span><span class="token punctuation">)</span>
        temp_xml <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>xmlfilepath<span class="token punctuation">)</span>
        total_xml <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> xml <span class="token keyword">in</span> temp_xml<span class="token punctuation">:</span>
            <span class="token keyword">if</span> xml<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">".xml"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                total_xml<span class="token punctuation">.</span>append<span class="token punctuation">(</span>xml<span class="token punctuation">)</span>

        num <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>total_xml<span class="token punctuation">)</span>  
        <span class="token builtin">list</span> <span class="token operator">=</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span>  
        tv <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>num<span class="token operator">*</span>trainval_percent<span class="token punctuation">)</span>  
        tr <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>tv<span class="token operator">*</span>train_percent<span class="token punctuation">)</span>  
        trainval <span class="token operator">=</span> random<span class="token punctuation">.</span>sample<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">,</span>tv<span class="token punctuation">)</span>  
        train <span class="token operator">=</span> random<span class="token punctuation">.</span>sample<span class="token punctuation">(</span>trainval<span class="token punctuation">,</span>tr<span class="token punctuation">)</span>  
        
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"train and val size"</span><span class="token punctuation">,</span>tv<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"train size"</span><span class="token punctuation">,</span>tr<span class="token punctuation">)</span>
        ftrainval <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>saveBasePath<span class="token punctuation">,</span><span class="token string">'trainval.txt'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>  
        ftest <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>saveBasePath<span class="token punctuation">,</span><span class="token string">'test.txt'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>  
        ftrain <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>saveBasePath<span class="token punctuation">,</span><span class="token string">'train.txt'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>  
        fval <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>saveBasePath<span class="token punctuation">,</span><span class="token string">'val.txt'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>  
        
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">list</span><span class="token punctuation">:</span>  
            name<span class="token operator">=</span>total_xml<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">'\n'</span>  
            <span class="token keyword">if</span> i <span class="token keyword">in</span> trainval<span class="token punctuation">:</span>  
                ftrainval<span class="token punctuation">.</span>write<span class="token punctuation">(</span>name<span class="token punctuation">)</span>  
                <span class="token keyword">if</span> i <span class="token keyword">in</span> train<span class="token punctuation">:</span>  
                    ftrain<span class="token punctuation">.</span>write<span class="token punctuation">(</span>name<span class="token punctuation">)</span>  
                <span class="token keyword">else</span><span class="token punctuation">:</span>  
                    fval<span class="token punctuation">.</span>write<span class="token punctuation">(</span>name<span class="token punctuation">)</span>  
            <span class="token keyword">else</span><span class="token punctuation">:</span>  
                ftest<span class="token punctuation">.</span>write<span class="token punctuation">(</span>name<span class="token punctuation">)</span>  
        
        ftrainval<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>  
        ftrain<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>  
        fval<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>  
        ftest<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Generate txt in ImageSets done."</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> annotation_mode <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">or</span> annotation_mode <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Generate 2007_train.txt and 2007_val.txt for train."</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> year<span class="token punctuation">,</span> image_set <span class="token keyword">in</span> VOCdevkit_sets<span class="token punctuation">:</span>
            image_ids <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>VOCdevkit_path<span class="token punctuation">,</span> <span class="token string">'VOC%s/ImageSets/Main/%s.txt'</span><span class="token operator">%</span><span class="token punctuation">(</span>year<span class="token punctuation">,</span> image_set<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span>
            list_file <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'%s_%s.txt'</span><span class="token operator">%</span><span class="token punctuation">(</span>year<span class="token punctuation">,</span> image_set<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> image_id <span class="token keyword">in</span> image_ids<span class="token punctuation">:</span>
                list_file<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'%s/VOC%s/JPEGImages/%s.jpg'</span><span class="token operator">%</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span>VOCdevkit_path<span class="token punctuation">)</span><span class="token punctuation">,</span> year<span class="token punctuation">,</span> image_id<span class="token punctuation">)</span><span class="token punctuation">)</span>

                convert_annotation<span class="token punctuation">(</span>year<span class="token punctuation">,</span> image_id<span class="token punctuation">,</span> list_file<span class="token punctuation">)</span>
                list_file<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
            list_file<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Generate 2007_train.txt and 2007_val.txt for train done."</span><span class="token punctuation">)</span>

</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/28959493281a9223ba10f1c8d1b2bc2c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">vivado中coe文件的生成</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/cadafaa0b3244b0359e29a5606c78cd7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">terminator alt &#43; n 不切换tab 的深究收获</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>