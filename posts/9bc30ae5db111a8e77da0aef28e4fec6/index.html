<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>2.服务器部署web服务器 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="2.服务器部署web服务器" />
<meta property="og:description" content="文章目录 1.看图说话2.开始部署django3.遇到的坑4.声明 #前几天按照文档走了一道，也记录了一下操作过程，其实挖了很多坑，没走通。又捯饬了几天终于在ubuntu成功运行了django&#43;Nginx，记录如下 1.看图说话 首先使用django web开发框架（因为我不会html，css，js等，所以有个好用的开发框架将会开发简单，部署也简单）django使用python作为开发语言，开发完毕作为web应用程序运行在web服务器上，但是我们选择的web服务器例如Nginx，uWSGI都不认识python，所以web应用程序django要和web服务器进行交互则需要通信标准wsgiuWSGI是一种web服务器，它实现了WSGI协议、uwsgi、http等协议，我们选择uWSGI服务器运行django，他们之间使用wsgi协议通信。同时为了提高网页的响应效率，有人采用网页的动静分析措施，比如利用Nguinx服务器处理/响应静态网页，uWSGI服务器响应动态网页。（我仅仅是听说）为了达到动静分离的效果，我又安装了nginx，nginx与uWSGI两个web服务器协同工作则需要通信，他们的通信可以采用socket实现（这两个运行在服务器上的web服务器其实也就是两个运行程序嘛，他们之间相互调用/通信采用一种方法称为socket）客户端，即用户的浏览器方位服务器端时，通过http协议与nginx通信，nginx处理静态请求/响应,然后动态请求/响应交给uWSGI。uWSGI调用python程序（django）处理请求，返回处理结果。 2.开始部署django step1：
#安装django web开发框架 #安装conda的用户主要python和pip对应起来，文中的python和pip3皆是/usr/bin中的可执行程序 #python和pip对应错误可能出现调用包错误的现象 pip3 install django #验证是否安装成功 django-admin.py startproject mysite #创建项目mysite cd mysite #进入项目文件 /usr/bin/python3 runserver 0.0.0.0:8000 #8000端口运行django的测试文件，浏览器打开返回的地址会出现小火箭 #安装uWSGI web服务器 pip3 install uwsgi #验证uwsgi是否安装成功 vim test.py def application(env, start_response): start_response(&#39;200 OK&#39;, [(&#39;Content-Type&#39;,&#39;text/html&#39;)]) return [b&#34;Hello World&#34;] # python3 #return [&#34;Hello World&#34;] # python2 uwsgi --http :8000 --wsgi-file test.py #8000端口运行test测试文件，浏览器打开返回的地址会出现hello world #安装postgresql数据库的以及数据库操作接口 #安装数据库 sudo apt-get install postgresql postgresql-client #安装完毕后，系统会创建一个数据库超级用户 postgres，密码为空 pip3 install psycopg2-binary #验证psycopg2是否安装成功 /usr/bin/python3 &gt;&gt;&gt;import psycopg2 &gt;&gt;&gt;dir(psycopg2) #安装nginx web服务器 #nginx负责静态web页面处理，uWSGI负责动态页面处理，实现动静分离，提高页面响应效率 sudo apt-get install nginx #安装成功nginx会自动启用 #检查nginx sudo service nginx status #或者访问浏览器出现欢迎界面 127." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/9bc30ae5db111a8e77da0aef28e4fec6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-11-01T16:37:43+08:00" />
<meta property="article:modified_time" content="2021-11-01T16:37:43+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">2.服务器部署web服务器</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#1_3" rel="nofollow">1.看图说话</a></li><li><a href="#2django_12" rel="nofollow">2.开始部署django</a></li><li><a href="#3_107" rel="nofollow">3.遇到的坑</a></li><li><a href="#4_235" rel="nofollow">4.声明</a></li></ul> 
</div> 
<br> #前几天按照文档走了一道，也记录了一下操作过程，其实挖了很多坑，没走通。又捯饬了几天终于在ubuntu成功运行了django+Nginx，记录如下 
<p></p> 
<h2><a id="1_3"></a>1.看图说话</h2> 
<p><img src="https://images2.imgbox.com/37/e8/lQKiOcBa_o.jpg" alt="请添加图片描述"></p> 
<ul><li>首先使用django web开发框架（因为我不会html，css，js等，所以有个好用的开发框架将会开发简单，部署也简单）</li><li>django使用python作为开发语言，开发完毕作为<a href="https://baike.baidu.com/item/web%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F/2498090" rel="nofollow">web应用程序</a>运行在<a href="https://baike.baidu.com/item/WEB%E6%9C%8D%E5%8A%A1%E5%99%A8/8390210?fr=aladdin" rel="nofollow">web服务器</a>上，但是我们选择的web服务器例如Nginx，uWSGI都不认识python，所以web应用程序django要和web服务器进行交互则需要<a href="https://baike.baidu.com/item/wsgi/3381529?fr=aladdin" rel="nofollow">通信标准wsgi</a></li><li>uWSGI是一种web服务器，它实现了WSGI协议、uwsgi、http等协议，我们选择uWSGI服务器运行django，他们之间使用wsgi协议通信。</li><li>同时为了提高网页的响应效率，有人采用网页的动静分析措施，比如利用Nguinx服务器处理/响应静态网页，uWSGI服务器响应动态网页。（我仅仅是听说）</li><li>为了达到动静分离的效果，我又安装了nginx，nginx与uWSGI两个web服务器协同工作则需要通信，他们的通信可以采用<a href="https://baike.baidu.com/item/%E5%A5%97%E6%8E%A5%E5%AD%97/9637606?fromtitle=socket&amp;fromid=281150" rel="nofollow">socket</a>实现（这两个运行在服务器上的web服务器其实也就是两个运行程序嘛，他们之间相互调用/通信采用一种方法称为socket）</li><li>客户端，即用户的浏览器方位服务器端时，通过http协议与nginx通信，nginx处理静态请求/响应,然后动态请求/响应交给uWSGI。uWSGI调用python程序（django）处理请求，返回处理结果。</li></ul> 
<h2><a id="2django_12"></a>2.开始部署django</h2> 
<p>step1：</p> 
<pre><code class="prism language-bash"><span class="token comment">#安装django web开发框架</span>
<span class="token comment">#安装conda的用户主要python和pip对应起来，文中的python和pip3皆是/usr/bin中的可执行程序</span>
<span class="token comment">#python和pip对应错误可能出现调用包错误的现象</span>
pip3 <span class="token function">install</span> django
<span class="token comment">#验证是否安装成功</span>
django-admin.py startproject mysite <span class="token comment">#创建项目mysite</span>
<span class="token builtin class-name">cd</span> mysite <span class="token comment">#进入项目文件</span>
/usr/bin/python3 runserver <span class="token number">0.0</span>.0.0:8000 <span class="token comment">#8000端口运行django的测试文件，浏览器打开返回的地址会出现小火箭</span>
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment">#安装uWSGI web服务器</span>
pip3 <span class="token function">install</span> uwsgi
<span class="token comment">#验证uwsgi是否安装成功</span>

<span class="token function">vim</span> test.py
def application<span class="token punctuation">(</span>env, start_response<span class="token punctuation">)</span>:
    start_response<span class="token punctuation">(</span><span class="token string">'200 OK'</span>, <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span>,<span class="token string">'text/html'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token builtin class-name">return</span> <span class="token punctuation">[</span>b<span class="token string">"Hello World"</span><span class="token punctuation">]</span> <span class="token comment"># python3</span>
    <span class="token comment">#return ["Hello World"] # python2</span>

uwsgi --http :8000 --wsgi-file test.py <span class="token comment">#8000端口运行test测试文件，浏览器打开返回的地址会出现hello world</span>
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment">#安装postgresql数据库的以及数据库操作接口</span>
<span class="token comment">#安装数据库</span>
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> postgresql postgresql-client <span class="token comment">#安装完毕后，系统会创建一个数据库超级用户 postgres，密码为空</span>

pip3 <span class="token function">install</span> psycopg2-binary
<span class="token comment">#验证psycopg2是否安装成功</span>
/usr/bin/python3

<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span>import psycopg2
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span>dir<span class="token punctuation">(</span>psycopg2<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment">#安装nginx web服务器</span>
<span class="token comment">#nginx负责静态web页面处理，uWSGI负责动态页面处理，实现动静分离，提高页面响应效率</span>
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> nginx <span class="token comment">#安装成功nginx会自动启用</span>
<span class="token comment">#检查nginx</span>
<span class="token function">sudo</span> <span class="token function">service</span> nginx status
<span class="token comment">#或者访问浏览器出现欢迎界面</span>
<span class="token number">127.0</span>.0.1：80
<span class="token comment">#激活或者stop、restart nginx</span>
<span class="token function">sudo</span> <span class="token function">sudo</span> /etc/init.d/nginx start<span class="token operator">|</span>stop<span class="token operator">|</span>restart 
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment">#修改nginx的配置文件，具体请看《遇到的坑那一节》</span>
<span class="token comment">#假设修改害了nginx的配置文件</span>
<span class="token builtin class-name">cd</span> mysite <span class="token comment">#进入mysite顶级项目文件夹</span>
<span class="token comment">#</span>
uwsgi --http :8000 --module mysite.wsgi  <span class="token comment">#测试uwsgi与nginx是否可以联用，如果可以恭喜你，你实现了上面的图片内容</span>
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment">#推荐使用ini配置文件运行uwsgi</span>
<span class="token function">vim</span> mysite_uwsgi.ini

<span class="token punctuation">[</span>uwsgi<span class="token punctuation">]</span>
<span class="token comment"># Django-related settings</span>
<span class="token comment"># the base directory (full path)</span>
chdir           <span class="token operator">=</span> /path/to/your/mysite
<span class="token comment"># Django's wsgi file</span>
module          <span class="token operator">=</span> mysite.wsgi:application
<span class="token comment"># the virtualenv (full path) (optional)</span>
home            <span class="token operator">=</span> /path/to/virtualenv
<span class="token comment"># process-related settings</span>
<span class="token comment"># master</span>
master          <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token comment"># maximum number of worker processes</span>
processes       <span class="token operator">=</span> <span class="token number">4</span>
<span class="token comment"># the socket (use the full path to be safe</span>
socket          <span class="token operator">=</span> <span class="token number">127.0</span>.0.1:8001
<span class="token comment"># ... with appropriate permissions - may be needed</span>
<span class="token comment"># chmod-socket    = 664</span>
<span class="token comment"># clear environment on exit</span>
vacuum          <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token comment"># background the process</span>
<span class="token assign-left variable">daemonize</span><span class="token operator">=</span>/path/to/mysite/mysite.log  <span class="token comment">#后台运行uwsgi服务器</span>
<span class="token assign-left variable">pidfile</span><span class="token operator">=</span>/path/to/mysite/mysite.pid <span class="token comment">#储存uwsgi运行时的pid，可以用于终止uwsgi服务器</span>
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment">#启动web服务器</span>
uwsgi --ini /path/to/mysite_uwsgi.ini
<span class="token comment">#查看服务</span>
<span class="token function">ps</span> -aux <span class="token operator">|</span><span class="token function">grep</span> <span class="token string">"uwsgi"</span>
<span class="token comment">#访问你自己的项目</span>
<span class="token number">127.0</span>.0.1:8000   <span class="token comment">#注意我们设置nginx监听的端口是8000，而8001端口是nginx与uWSGI通信的端口</span>
<span class="token comment">#停止</span>
uwsgi --stop  /path/to/mysite/mysite.pid
或者
<span class="token function">sudo</span> <span class="token function">pkill</span> -f uwsgi -9
</code></pre> 
<h2><a id="3_107"></a>3.遇到的坑</h2> 
<ul><li>apache2与nginx重复安装，重复卸载，最后两个web服务器懂启动不了，好吧！最后卸载apache2，apt安装nginx</li></ul> 
<pre><code class="prism language-bash">$ <span class="token function">which</span> nginx
/usr/sbin/nginx  <span class="token comment">#我也不知道为啥到sbin里面去了</span>

$ <span class="token function">sudo</span> /usr/sbin/nginx -t   <span class="token comment">#测试nginx的配置文件等是否正确，而且会告诉你配置文件位置</span>

$ <span class="token function">sudo</span> /usr/sbin/nginx   <span class="token comment">#启动nginx</span>

$ <span class="token function">ps</span> -aux <span class="token operator">|</span><span class="token function">grep</span> <span class="token string">"nginx"</span>  <span class="token comment">#验证nginx启动成功</span>

$ <span class="token function">sudo</span> /usr/sbin/nginx -s stop   <span class="token comment">#显将nginx停了，我们要去修改配置文件</span>
</code></pre> 
<ul><li>nginx配置文件的坑</li></ul> 
<pre><code class="prism language-bash">$ <span class="token function">sudo</span> /usr/sbin/nginx -t 告诉我nginx配置文件在/etc/nginx/conf.d/*.conf   ；有些人的配置文件在/etc/nginx/sites-enabled/文件夹里
</code></pre> 
<pre><code class="prism language-b">#如果配置文件在/etc/nginx/sites-enbled，操作如下

#create /etc/nginx/sites-available/ directory and put this in it
#sites-available文件夹包括一些可配置文件
#sites-enabled文件夹包括一些已经配置了的文件
#最好不要修改nginx.conf文件
#在sites-available文件夹创建mysite_nginx.conf文件并写入如下内容
---------------------------------------------------------------------------------------------------------
# mysite_nginx.conf

# the upstream component nginx needs to connect to
upstream django {
    # server unix:///path/to/your/mysite/mysite.sock; # for a file socket
    server 127.0.0.1:8001; # for a web port socket (we'll use this first)  nginx与uWSGI通信使用8001端口
}

# configuration of the server
server {
    # the port your site will be served on
    listen      8000; #nginx监听8000端口
    # the domain name it will serve for
    server_name 172.XXX.XXX.XXX; # substitute your machine's IP address or FQDN
    charset     utf-8;

    # max upload size
    client_max_body_size 75M;   # adjust to taste

    # Django media
    location /media  {
        alias /path/to/your/mysite/media;  # your Django project's media files - amend as required
    }

    location /static {
        alias /path/to/your/mysite/static; # your Django project's static files - amend as required
    }

    # Finally, send all non-media requests to the Django server.
    location / {
        uwsgi_pass  django;
        include     /path/to/your/mysite/uwsgi_params; # the uwsgi_params file you installed #/etc/nginx/uwsgi_params;
    }
}
----------------------------------------------------------------------------------------------------------------------------
#symlink to this file from /etc/nginx/site-enabled so nginx can see it
sudo ln -s /etc/nginx/sites-available/mysite_nginx.conf /etc/nginx/sites-enabled/
#重启nginx服务
sudo /etc/init.d/nginx restart  或者  sudo /usr/sbin/nginx
ps -aux |grep nginx
</code></pre> 
<pre><code class="prism language-b">#如果配置文件在/etc/nginx/conf.d/，操作如下
-----------------------------------------------------------------------------------------------------
# mysite_nginx.conf

# the upstream component nginx needs to connect to
upstream django {
    # server unix:///path/to/your/mysite/mysite.sock; # for a file socket
    server 127.0.0.1:8001; # for a web port socket (we'll use this first)  nginx与uWSGI通信使用8001端口
}

# configuration of the server
server {
    # the port your site will be served on
    listen      8000; #nginx监听8000端口
    # the domain name it will serve for
    server_name 172.XXX.XXX.XXX; # substitute your machine's IP address or FQDN
    charset     utf-8;

    # max upload size
    client_max_body_size 75M;   # adjust to taste

    # Django media
    location /media  {
        alias /path/to/your/mysite/media;  # your Django project's media files - amend as required
    }

    location /static {
        alias /path/to/your/mysite/static; # your Django project's static files - amend as required
    }

    # Finally, send all non-media requests to the Django server.
    location / {
        uwsgi_pass  django;
        include     /path/to/your/mysite/uwsgi_params; # the uwsgi_params file you installed #/etc/nginx/uwsgi_params;
    }
}
----------------------------------------------------------------------------------------------------------------------------
#symlink to this file from /etc/nginx/conf.d/ so nginx can see it
sudo ln -s /etc/nginx/sites-available/mysite_nginx.conf /etc/nginx/conf.d/
#重启nginx服务
sudo /etc/init.d/nginx restart  或者  sudo /usr/sbin/nginx
ps -aux |grep nginx
</code></pre> 
<ul><li>nginx欢迎页面一直存在</li></ul> 
<pre><code class="prism language-b">#方法一
sudo rm /etc/nginx/sites-enabled/default.conf
#方法二
修改default.conf中监听的端口，让默认监听的端口与刚才mysite-nginx.conf监听的端口不一样
</code></pre> 
<ul><li>uwsgi安装失败</li></ul> 
<pre><code>有没有安装python-dev包？
</code></pre> 
<ul><li>uwsgi调用失败</li></ul> 
<pre><code>pip 是不是使用的conda安装的？
</code></pre> 
<h2><a id="4_235"></a>4.声明</h2> 
<p>纯粹用于记录，交流学习也是可行的，没有任何教学目的，请根据自己的实际情况操作自己的系统。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fb6a1ad01236c760f414b3d4e162a889/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">java获取当前日期的前一天,年，月等</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7a6f12db773c88d2f7d408454d0308f2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">阿里云优化求解器mindopt安装配置教程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>