<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SC7A20获取三轴加速度值 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="SC7A20获取三轴加速度值" />
<meta property="og:description" content="原文地址::SC7A20获取三轴加速度值_sc7a20敲击_QDDA的博客-CSDN博客
SC7A20获取三轴加速度值(I2C)
1. I2C.h
#ifndef __I2C_H
#define __I2C_H
#include &#34;config.h&#34;
sbit I2C_SCL=P3^2;//SCL
sbit I2C_SDA=P3^3;//SDA
#define I2C_SCL_Clr() I2C_SCL=0
#define I2C_SCL_Set() I2C_SCL=1
#define I2C_SDA_Clr() I2C_SDA=0
#define I2C_SDA_Set() I2C_SDA=1
//void Wait();
void Start();
void SendData(char dat);
void RecvACK();
char RecvData(u8 SF_Ack);
void SendACK();
void SendNAK();
void Stop();
#endif
2. I2C.c (IO口模拟I2C)
#include &#34;I2C.h&#34;
//延时
void I2C_delay(void)
{
u8 t=1;
while(t--);
}
void Start()
{
I2C_SDA_Set();
I2C_SCL_Set();
I2C_delay();
I2C_SDA_Clr();
I2C_delay();
I2C_SCL_Clr();
}
//========================================================================" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/c97b57f7338f5f47767022d0aa3c96ed/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-20T21:11:19+08:00" />
<meta property="article:modified_time" content="2023-07-20T21:11:19+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SC7A20获取三轴加速度值</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>原文地址::<a href="https://blog.csdn.net/qq_43538613/article/details/118901748?ydreferer=aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTM4NjEzL2NhdGVnb3J5XzExMjE5ODUzLmh0bWw%3D" title="SC7A20获取三轴加速度值_sc7a20敲击_QDDA的博客-CSDN博客">SC7A20获取三轴加速度值_sc7a20敲击_QDDA的博客-CSDN博客</a></p> 
<p></p> 
<p>SC7A20获取三轴加速度值(I2C)<br> 1. I2C.h<br> #ifndef    __I2C_H<br> #define    __I2C_H</p> 
<p>#include    "config.h"</p> 
<p>sbit I2C_SCL=P3^2;//SCL<br> sbit I2C_SDA=P3^3;//SDA</p> 
<p>#define I2C_SCL_Clr() I2C_SCL=0<br> #define I2C_SCL_Set() I2C_SCL=1</p> 
<p>#define I2C_SDA_Clr() I2C_SDA=0<br> #define I2C_SDA_Set() I2C_SDA=1</p> 
<p>//void Wait();<br> void Start();<br> void SendData(char dat);<br> void RecvACK();<br> char RecvData(u8 SF_Ack);<br> void SendACK();<br> void SendNAK();<br> void Stop();</p> 
<p>#endif<br><br> 2. I2C.c (IO口模拟I2C)<br> #include    "I2C.h"</p> 
<p>//延时<br> void I2C_delay(void)<br> {<!-- --><br>     u8 t=1;<br>     while(t--);<br> }</p> 
<p>void Start()<br> {<!-- --><br>     I2C_SDA_Set();<br>     I2C_SCL_Set();<br>     I2C_delay();<br>     I2C_SDA_Clr();<br>     I2C_delay();<br>     I2C_SCL_Clr();<br> }</p> 
<p>//========================================================================<br> // 函数: void SendData (char dat)<br> // 描述: I2C发送一个字节数据函数.<br> // 参数: 发送的数据.<br> // 返回: none.<br> //========================================================================<br> void SendData(u8 dat)<br> {<!-- --><br>     u8 i;<br>     for(i=0;i&lt;8;i++)<br>     {<!-- --><br>         I2C_SCL_Clr();//将时钟信号设置为低电平<br>         if(dat&amp;0x80)//将dat的8位从最高位依次写入<br>         {<!-- --><br>             I2C_SDA_Set();<br>     }<br>         else<br>         {<!-- --><br>             I2C_SDA_Clr();<br>     }<br>         I2C_delay();<br>         I2C_SCL_Set();<br>         I2C_delay();<br>         I2C_SCL_Clr();<br>         dat&lt;&lt;=1;<br>   }<br> }</p> 
<p>//========================================================================<br> // 函数: void RecvACK (void)<br> // 描述: I2C获取ACK函数.<br> // 参数: none.<br> // 返回: none.<br> // 版本: V1.0, 2020-09-15<br> //========================================================================<br> void RecvACK()<br> {<!-- --><br>     I2C_SDA_Set();<br>     I2C_delay();<br>     I2C_SCL_Set();<br>     I2C_delay();<br>     I2C_SCL_Clr();<br>     I2C_delay();<br> }</p> 
<p>//========================================================================<br> // 函数: char RecvData (void)<br> // 描述: I2C读取一个字节数据函数.<br> // 参数: none.<br> // 返回: 读取数据.<br> // 版本: V1.0, 2020-09-15<br> //========================================================================<br> char RecvData(u8 SF_Ack)<br> {<!-- --><br>     u8 Rb_Cnt = 0; //读数据位计数 <br>     u8 RByte  = 0; //读字节<br>       //I2C_SDA_Dir(0);//SDA设置为输入<br>       for(Rb_Cnt=0; Rb_Cnt&lt;8; Rb_Cnt++)<br>       {<!-- --><br>             I2C_SCL_Clr(); //拉低时钟线   准备开始传送数据位 <br>         I2C_delay();<br>         I2C_SCL_Set(); //拉高时钟线<br>         RByte &lt;&lt;= 1; //数据移位<br>         if(I2C_SDA)<br>           {<!-- --><br>               RByte++;<br>         }            <br>         I2C_delay();<br>       }                     <br>     if(!SF_Ack)    //0    不发送Ack<br>     {<!-- --><br>       SendNAK(); //发送NAck<br>     }<br>     else           //1        发送Ack<br>     {<!-- --><br>       SendACK();  //发送Ack<br>     }        <br>     return RByte;<br> }</p> 
<p>//========================================================================<br> // 函数: void SendACK (void)<br> // 描述: I2C发送ACK函数.<br> // 参数: none.<br> // 返回: none.<br> // 版本: V1.0, 2020-09-15<br> //========================================================================<br> void SendACK()<br> {<!-- --><br>     I2C_SCL_Clr();   //拉低时钟线 <br>  // I2C_SDA_Dir(1);//I2C_SDA线输出<br>   I2C_SDA_Clr();   //拉低数据线<br>   I2C_delay();;<br>   I2C_SCL_Set();   //拉高时钟线<br>   I2C_delay();;<br>   I2C_SCL_Clr();   //拉低时钟线 <br> }</p> 
<p>//========================================================================<br> // 函数: void SendNAK (void)<br> // 描述: I2C发送NAK函数.<br> // 参数: none.<br> // 返回: none.<br> // 版本: V1.0, 2020-09-15<br> //========================================================================<br> void SendNAK()<br> {<!-- --><br>     I2C_SCL_Clr();   //拉低时钟线 <br>  // I2C_SDA_Dir(1);//I2C_SDA线输出<br>   I2C_SCL_Set();   //拉高数据线<br>   I2C_delay();;<br>   I2C_SCL_Set();   //拉高时钟线<br>   I2C_delay();;<br>   I2C_SCL_Clr();   //拉低时钟线 <br> }</p> 
<p>//========================================================================<br> // 函数: void Stop (void)<br> // 描述: I2C总线停止函数.<br> // 参数: none.<br> // 返回: none.<br> // 版本: V1.0, 2020-09-15<br> //========================================================================<br> void Stop()<br> {<!-- --><br>     I2C_SDA_Clr();<br>     I2C_SCL_Set();<br>     I2C_delay();<br>     I2C_SDA_Set();<br> }</p> 
<p><br> 3. SC7A20.h<br> #ifndef __SC7A20_H<br> #define __SC7A20_H</p> 
<p>#include "config.h"<br> #include "delay.h"</p> 
<p>#define SC7A20_I2C_WADDR 0x30    //I2C写地址：7位I2C地址+一位写<br> #define SC7A20_I2C_RADDR 0x31    //I2C写地址：7位I2C地址+一位读</p> 
<p>void SC7A20_Init();</p> 
<p>#endif  <br><br> 4. SC7A20.c<br> #include "SC7A20.h"<br> #include "I2C.h"<br> #include "stdio.h"    //使用printf打印数据到串口</p> 
<p>/*<br> SC7A20向寄存器写一个字节<br> RAddr：寄存器地址<br> WData：数据<br> */<br> void SC7A20_Write_Byte(u8 RAddr, u8 WData)<br> {<!-- --><br>      Start();<br>     SendData(SC7A20_I2C_WADDR);<br>     RecvACK();<br>     SendData(RAddr);<br>     RecvACK();    <br>     SendData(WData);<br>     RecvACK();<br>     Stop();<br> }</p> 
<p>/*<br> SC7A20从寄存器读一个字节<br> RAddr：寄存器地址<br> RData：接收数据地址<br> */<br> void SC7A20_Read_Byte(u8 RAddr, u8 *RData)<br> {<!-- --><br>     Start();<br>     SendData(SC7A20_I2C_WADDR);<br>     RecvACK();<br>     SendData(RAddr);<br>     RecvACK();<br>     Start();<br>     SendData(SC7A20_I2C_RADDR);<br>     RecvACK();<br>     *RData = RecvData(0);<br>     Stop();<br> }</p> 
<p>/*<br> SC7A20初始化<br> */<br> void SC7A20_Init()<br> {<!-- --><br>      SC7A20_Write_Byte(0x20,0x77);  //400Hz+正常模式xyz使能<br>      SC7A20_Write_Byte(0x21,0x88);  //高通滤波：正常模式,00+滤波使能<br>      SC7A20_Write_Byte(0x23,0x88);  //读取完成再更新、2g+正常模式<br> }</p> 
<p>/*<br> SC7A20获取加速度值<br> accd_lsb：加速度值低寄存器地址<br> accd_msb：加速度值高寄存器地址<br> 返回值accd_f：加速度值，单位mg<br> */<br> int SC7A20_Get_ACCD(u8 accd_lsb,u8 accd_msb)<br> {<!-- --><br>     u8 accd_l,accd_m = 0;<br>     unsigned int temp;<br>     int accd;</p> 
<p>    SC7A20_Read_Byte(accd_lsb,&amp;accd_l);<br>     SC7A20_Read_Byte(accd_msb,&amp;accd_m);<br>     temp &amp;= 0x0000;<br>     temp |= accd_m;<br>     temp &lt;&lt;= 8;<br>     temp &amp;= 0xff00;<br>     temp |= accd_l;    <br>     if(temp&amp;0x8000)<br>     {<!-- --><br>         temp &gt;&gt;= 4;<br>         temp |= 0xf000;<br>     }<br>     else<br>     {<!-- --><br>         temp &gt;&gt;= 4;<br>         temp &amp;= 0x0fff;<br>     }<br>     accd = temp*1;<br>     return accd;<br> }</p> 
<p>/*<br> SC7A20获取xyz轴加速度值<br> */<br> void SC7A20_GetInfo()<br> {<!-- --><br>     //获取三轴数据<br>     int x,y,z = 0;<br>     unsigned char i = 16;<br>     for(i=8;i&gt;0;i--)<br>     {<!-- --><br>         x += SC7A20_Get_ACCD(0x28,0x29);<br>         y += SC7A20_Get_ACCD(0x2A,0x2B);<br>         z += SC7A20_Get_ACCD(0x2C,0x2D);<br>     }<br>     x /= 8;<br>     y /= 8;<br>     z /= 8;    <br>     printf("x:%hd mg, y:%hd mg, z:%hd mg \r\n",x,y,z);<br> }<br> ————————————————<br> 版权声明：本文为CSDN博主「QDDA」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。<br> 原文链接：https://blog.csdn.net/qq_43538613/article/details/118901748</p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0963dc12707cc132e9d1b211dfd8853a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Git项目开发最常用命令</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/505d9a3eac817202845e27d952d05fe8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Redis【基础篇01】</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>