<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>MindOpt Tuner调参器，提升求解速度、性能（二） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="MindOpt Tuner调参器，提升求解速度、性能（二）" />
<meta property="og:description" content="MindOpt Tuner是达摩院决策智能实验室基于mindopt优化求解器研发的调参器，超参自动优化工具，它可以帮助运筹优化工程师在使用求解器时自动搜索最佳参数组合，尝试不同的参数组合，评估每组参数的性能，然后基于这些结果来确定最佳参数。这样可以大大减少手动调整参数的时间和精力，并且可以帮助提升求解性能。
Python调用 上一篇中讲解了如何使用命令行来调用和查询结果。里面的接口都有封装为Python接口，我们可以输入如下指令引入文件，也可以再输入help指令来查看对应的Python API说明：
import mtunerpy as mtuner #help(mtuner) OpenBLAS WARNING - could not determine the L2 cache size on this system, assuming 256k 这里我们可以如下方式来提交任务：
scenario_dict = { &#39;solver&#39;: &#39;cbc&#39;, &#39;problem&#39;: [&#39;./model/nl_train_1.nl&#39;], &#39;max_tuning_time&#39;: 600 } mtuner.create_task(scenario_dict) Problem file &#34;nl_train_1.nl&#34; uploaded successfully. Task #438397484918644736 created succesfully. 这里小编得到任务ID：438394637284024320。
类似地，我们还可以提交一组优化问题算例mps_train_oss.txt进行调参。
如下，得到任务ID 438394766997069824。
scenario_dict = { &#39;solver&#39;: &#39;cbc&#39;, &#39;problem&#39;: [&#39;./model/mps_train_oss.txt&#39;], &#39;max_tuning_time&#39;: 3600 } mtuner.create_task(scenario_dict) Task #438397553394851840 created succesfully. 运行成功后，我们可以通过如下方式获取结果。可以看到和命令行的结果一样，都可以得到比较多的求解效率提升。
import mtunerpy as mtuner #print(&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/dd7db665f34f952a0c110f241037f97e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-12T13:23:02+08:00" />
<meta property="article:modified_time" content="2023-06-12T13:23:02+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">MindOpt Tuner调参器，提升求解速度、性能（二）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>MindOpt Tuner是达摩院决策智能实验室基于mindopt优化求解器研发的调参器，超参自动优化工具，它可以帮助运筹优化工程师在使用求解器时自动搜索最佳参数组合，尝试不同的参数组合，评估每组参数的性能，然后基于这些结果来确定最佳参数。这样可以大大减少手动调整参数的时间和精力，并且可以帮助提升求解性能。</p> 
<h2><a id="Python_2"></a>Python调用</h2> 
<p><a href="https://developer.aliyun.com/article/1240073?spm=a2c6h.12873581.technical-group.dArticle1240073.56f17567fpnQDx" rel="nofollow">上一篇</a>中讲解了如何使用命令行来调用和查询结果。里面的接口都有封装为Python接口，我们可以输入如下指令引入文件，也可以再输入help指令来查看对应的Python API说明：</p> 
<pre><code>import mtunerpy as mtuner
#help(mtuner)
</code></pre> 
<pre><code>OpenBLAS WARNING - could not determine the L2 cache size on this system, assuming 256k
</code></pre> 
<p>这里我们可以如下方式来提交任务：</p> 
<pre><code>scenario_dict = {
    'solver': 'cbc',
    'problem': ['./model/nl_train_1.nl'],
    'max_tuning_time': 600
}
mtuner.create_task(scenario_dict)
</code></pre> 
<pre><code>Problem file "nl_train_1.nl" uploaded successfully.
Task #438397484918644736 created succesfully.
</code></pre> 
<p>这里小编得到任务ID：<code>438394637284024320</code>。<br> 类似地，我们还可以提交一组优化问题算例<a href="https://opt.aliyun.com/#/platform/case/detail/src/./model/mps_train_oss.txt?projectName=BFnQjmumY7zq" rel="nofollow">mps_train_oss.txt</a>进行调参。<br> 如下，得到任务ID <code>438394766997069824</code>。</p> 
<pre><code>scenario_dict = {
    'solver': 'cbc',
    'problem': ['./model/mps_train_oss.txt'],
    'max_tuning_time': 3600
}
mtuner.create_task(scenario_dict)
</code></pre> 
<pre><code>Task #438397553394851840 created succesfully.
</code></pre> 
<p>运行成功后，我们可以通过如下方式获取结果。可以看到和命令行的结果一样，都可以得到比较多的求解效率提升。</p> 
<pre><code>import mtunerpy as mtuner

#print("----调参状态和文件---")
#mtuner.task_status(['438394637284024320','438394766997069824'])

print("----nl_train_1.nl调参效果---")
mtuner.fetch_result('438394637284024320','result/performance.txt')
print("----一组3个问题调参效果---")
mtuner.fetch_result('438394766997069824','result/performance.txt', False)
</code></pre> 
<pre><code>----nl_train_1.nl调参效果---
Tuning finished, the best wallclock_time is 0.09 [** 36.33x improvement **]

----一组3个问题调参效果---
Tuning finished, the best avg_wallclock_time is 3.83 [** 33.32x improvement **]
</code></pre> 
<h2><a id="_70"></a>调参的进阶用法</h2> 
<p>前面主要讲解调参的基础用法。提交任务的时候，通过选择了求解器后，由MindOpt Tuner来给出调参任务的默认设置来进行调参。比如页面提交，可以不用参数填写的格子，直接使用。</p> 
<p>除此之外，我们还可以设置调参的任务。详情我们可以查看用户文档的<a href="https://yuque.com/mindopt/tuner/giy6obgbqkic8n8x" rel="nofollow">调参任务配置</a>。</p> 
<p>这里我们先 <code>-h</code>一下查看接口的说明:</p> 
<pre><code>!mindopt-tuner create-task -h
</code></pre> 
<pre><code>OpenBLAS WARNING - could not determine the L2 cache size on this system, assuming 256k
MindOpt Tuner v0.9.0 (Build: 20230404)

Usage: mindopt-tuner create-task [-h] --solver {cbc,cplex} --problem &lt;problem&gt; [&lt;problem&gt; ...]
                                 [--parameters &lt;parameters&gt; [&lt;parameters&gt; ...]] [--log-level {info,debug,error}]
                                 [--verbose {0,1,2}] [--tuning-objective {wallclock_time,cpu_time}]
                                 [--max-distinct-para-combos &lt;number&gt;] [--max-tuning-time &lt;seconds&gt;]
                                 [--max-eval-time &lt;seconds&gt;]

Create a new tuning task, and then start it.

Arguments:
  -h, --help                                    Show help information.
  --solver {cbc,cplex}                          (Required) Specify the solver to tune.
  --problem &lt;problem&gt; [&lt;problem&gt; ...]           (Required) Path to the optimization problem file(s), separated by space.
  --parameters &lt;parameters&gt; [&lt;parameters&gt; ...]  Specify the solver's tunable parameters (see documentation), separated
                                                by space.
  --log-level {info,debug,error}                Log detail level.
  --verbose {0,1,2}                             Set verbosity level.
  --tuning-objective {wallclock_time,cpu_time}  Select the tuning objective.
  --max-distinct-para-combos &lt;number&gt;           Tuning will be terminated after the number of distinct parameter
                                                combinations reach this number.
  --max-tuning-time &lt;seconds&gt;                   Tuning will be terminated after surpassing this time (in seconds) 1, 2,
                                                ..., 3600000.
  --max-eval-time &lt;seconds&gt;                     Maximum time allowed for a single evaluation in seconds 1, 2, ...,
                                                144000).
</code></pre> 
<p>这里我们自定义这些参数。</p> 
<p>这里可以举个cbc相关的例子。比如默认参数定义文件内容是<a href="https://opt.aliyun.com/#/platform/case/detail/src/./param/test_cbc_params.txt?projectName=BFnQjmumY7zq" rel="nofollow">test_cbc_params.txt</a>：</p> 
<hr> 
<pre><code class="prism language-bash">cuts <span class="token punctuation">{<!-- --></span>off, on, root, ifmove, forceOn<span class="token punctuation">}</span><span class="token punctuation">[</span>on<span class="token punctuation">]</span> <span class="token comment"># Switches all cut generators on or off. cat</span>
preprocess <span class="token punctuation">{<!-- --></span>off, on, save, equal, sos, trysos, equalall, strategy, aggregate, forcesos<span class="token punctuation">}</span><span class="token punctuation">[</span>sos<span class="token punctuation">]</span> <span class="token comment"># Whether to use integer preprocessing. cat</span>
heuristics <span class="token punctuation">[</span><span class="token number">0</span>, <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>i <span class="token comment"># Switches most primal heuristics on or off. boolean</span>
strongBranching <span class="token punctuation">[</span><span class="token number">0</span>, <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span>i <span class="token comment"># Number of variables to look at in strong branching. int</span>
trustPseudoCosts <span class="token punctuation">[</span>-3, <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span>i <span class="token comment"># Number of branches before we trust pseudocosts. int</span>
</code></pre> 
<hr> 
<p>这里是遵循 <code>参数名 取值范围 默认值</code>的格式来，最后面的 <code>[10]i</code>指的是整型变量。</p> 
<p><strong>特别提醒</strong> ：无特殊需求不需要动这个参数，取值错误等都会导致调参任务异常。</p> 
<p>这里，我们可以将这个参数、里面选取部分参数来条，比如：我们可以通过如下指令来自定义自己的调参范围，<strong>只调2个参数</strong>，还可以<strong>减少调参时间</strong>。</p> 
<pre><code>!mindopt-tuner create-task --solver cbc --problem './model/nl_train_1.nl' --max-tuning-time 400 --parameters cuts preprocess
</code></pre> 
<pre><code>OpenBLAS WARNING - could not determine the L2 cache size on this system, assuming 256k
Problem file "nl_train_1.nl" uploaded successfully.
Task #438413495201964032 created succesfully.
</code></pre> 
<p>小编这里得到taskID 438413495201964032。<br> 求解完后，我们可以通过如下方式获取结果，也可以直接访问页面端作业列表。<br> <img src="https://images2.imgbox.com/de/61/hhBIg28z_o.png" alt="image.png"><br> 从结果看，<strong>缩小调参的范围，也会有提升结果！提速了32倍！</strong>。</p> 
<pre><code>#print("-------查看状态和results文件链接--------")
#!mindopt-tuner task-status --task-id 438413495201964032

print("-------本地的提交结果--------")
! mindopt-tuner fetch-result --task-id 438413495201964032 --file result/performance.txt
</code></pre> 
<pre><code>-------本地的提交结果--------
OpenBLAS WARNING - could not determine the L2 cache size on this system, assuming 256k
Tuning finished, the best wallclock_time is 0.1 [** 32.00x improvement **]
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1aecd960a3cead9164ad5173d5afaf4e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">怎么在C盘之外的安装WSL - 以Ubuntu20.04为例</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/eea73a900b8558f993d9d058d9feadf5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">PowerShell系列（六）：PowerShell脚本执行策略梳理</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>