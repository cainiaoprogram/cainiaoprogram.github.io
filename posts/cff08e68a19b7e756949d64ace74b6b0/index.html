<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Zabbix自定义监控mysql数据库、自动注册服务器及部署代理服务器 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Zabbix自定义监控mysql数据库、自动注册服务器及部署代理服务器" />
<meta property="og:description" content="目录
一、zabbix自定义监控数据库
1、编写监控脚本
2、服务端测试
3、web页面配置
①创建自定义监控项
②创建触发器
③创建图形 ④测试自定义监控是否成功
二、zabbix自动注册
1、什么是自动注册
2、环境准备
3、 zabbix客户端配置
4、web页面配置自动注册
5、验证自动注册
三、代理服务器部署
1、代理服务器作用
2、部署环境
3、代理服务器配置
4、客户端配置
5、web页面配置
①删除原环境
② 添加代理
③创建主机 ④重启服务
6、验证结果
一、zabbix自定义监控数据库 1、编写监控脚本 首先在被监控服务器的子配置文件路径中编写监控脚本
cd /etc/zabbix/zabbix_agent2.d #进入agent2的子配置文件，本实验为yum安装为zabbix_zagent2客户端 vim mysql.conf #创建一个新的mysql.conf子配置文件，名称无所谓但是结尾必须以.conf结尾，主配置文件中有规定，yum安装的主配置文件目录为 /etc/zabbix/zabbix_agent2.conf #添加内容如下 UserParameter=lhj.user,netstat -antp | grep 3306 |wc -l #UserParameter为键名，此键名不可随意更改主配置文件中有要求 #lhj.user为键值，键值可以自定义 #,后的为此键值的内容，可以是一个有标准输出的命令也可以直接写执行某个脚本，执行脚本注意权限问题 systemctl restart zabbix-agent2.service #保存脚本内容后重启zabbix客户端 2、服务端测试 服务端测试是否可以监控到自定义键值的内容
服务端： yum install -y zabbix-get #安装zabbix主动获取命令 zabbix_get -s &#39;192.168.30.12&#39; -p 10050 -k &#39;lhj.user&#39; #-s表示指定客户端ip -p表示指定客户端端口 -k 指定测试那个键值，返回结果为脚本命令输出结果即可以进行监控 3、web页面配置 ①创建自定义监控项 选择要监控的主机创建监控项，如何添加主机请看此博客分布式系统监控zabbix安装部署及使用_阿杰。159的博客-CSDN博客 在配置--主机中找到要监控的主机，点击监控项然后点击创建监控项 ②创建触发器 在配置--主机中找到要监控的主机，点击触发器然后点击创建触发器添加规则" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/cff08e68a19b7e756949d64ace74b6b0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-11T10:47:56+08:00" />
<meta property="article:modified_time" content="2023-08-11T10:47:56+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Zabbix自定义监控mysql数据库、自动注册服务器及部署代理服务器</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="%E4%B8%80%E3%80%81zabbix%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9B%91%E6%8E%A7%E6%95%B0%E6%8D%AE%E5%BA%93-toc" style="margin-left:0px;"><a href="#%E4%B8%80%E3%80%81zabbix%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9B%91%E6%8E%A7%E6%95%B0%E6%8D%AE%E5%BA%93" rel="nofollow">一、zabbix自定义监控数据库</a></p> 
<p id="1%E3%80%81%E7%BC%96%E5%86%99%E7%9B%91%E6%8E%A7%E8%84%9A%E6%9C%AC-toc" style="margin-left:40px;"><a href="#1%E3%80%81%E7%BC%96%E5%86%99%E7%9B%91%E6%8E%A7%E8%84%9A%E6%9C%AC" rel="nofollow">1、编写监控脚本</a></p> 
<p id="2%E3%80%81%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B5%8B%E8%AF%95-toc" style="margin-left:40px;"><a href="#2%E3%80%81%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B5%8B%E8%AF%95" rel="nofollow">2、服务端测试</a></p> 
<p id="3%E3%80%81web%E9%A1%B5%E9%9D%A2%E9%85%8D%E7%BD%AE-toc" style="margin-left:40px;"><a href="#3%E3%80%81web%E9%A1%B5%E9%9D%A2%E9%85%8D%E7%BD%AE" rel="nofollow">3、web页面配置</a></p> 
<p id="%E2%91%A0%E5%88%9B%E5%BB%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9B%91%E6%8E%A7%E9%A1%B9-toc" style="margin-left:80px;"><a href="#%E2%91%A0%E5%88%9B%E5%BB%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9B%91%E6%8E%A7%E9%A1%B9" rel="nofollow">①创建自定义监控项</a></p> 
<p id="%E2%91%A1%E5%88%9B%E5%BB%BA%E8%A7%A6%E5%8F%91%E5%99%A8-toc" style="margin-left:80px;"><a href="#%E2%91%A1%E5%88%9B%E5%BB%BA%E8%A7%A6%E5%8F%91%E5%99%A8" rel="nofollow">②创建触发器</a></p> 
<p id="%E2%91%A2%E5%88%9B%E5%BB%BA%E5%9B%BE%E5%BD%A2%C2%A0-toc" style="margin-left:80px;"><a href="#%E2%91%A2%E5%88%9B%E5%BB%BA%E5%9B%BE%E5%BD%A2%C2%A0" rel="nofollow">③创建图形 </a></p> 
<p id="%E2%91%A3%E6%B5%8B%E8%AF%95%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9B%91%E6%8E%A7%E6%98%AF%E5%90%A6%E6%88%90%E5%8A%9F-toc" style="margin-left:80px;"><a href="#%E2%91%A3%E6%B5%8B%E8%AF%95%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9B%91%E6%8E%A7%E6%98%AF%E5%90%A6%E6%88%90%E5%8A%9F" rel="nofollow">④测试自定义监控是否成功</a></p> 
<p id="%E4%BA%8C%E3%80%81zabbix%E8%87%AA%E5%8A%A8%E6%B3%A8%E5%86%8C-toc" style="margin-left:0px;"><a href="#%E4%BA%8C%E3%80%81zabbix%E8%87%AA%E5%8A%A8%E6%B3%A8%E5%86%8C" rel="nofollow">二、zabbix自动注册</a></p> 
<p id="1%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF%E8%87%AA%E5%8A%A8%E6%B3%A8%E5%86%8C-toc" style="margin-left:40px;"><a href="#1%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF%E8%87%AA%E5%8A%A8%E6%B3%A8%E5%86%8C" rel="nofollow">1、什么是自动注册</a></p> 
<p id="2%E3%80%81%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87-toc" style="margin-left:40px;"><a href="#2%E3%80%81%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87" rel="nofollow">2、环境准备</a></p> 
<p id="3%E3%80%81%20zabbix%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%85%8D%E7%BD%AE-toc" style="margin-left:40px;"><a href="#3%E3%80%81%20zabbix%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%85%8D%E7%BD%AE" rel="nofollow">3、 zabbix客户端配置</a></p> 
<p id="4%E3%80%81web%E9%A1%B5%E9%9D%A2%E9%85%8D%E7%BD%AE%E8%87%AA%E5%8A%A8%E6%B3%A8%E5%86%8C-toc" style="margin-left:40px;"><a href="#4%E3%80%81web%E9%A1%B5%E9%9D%A2%E9%85%8D%E7%BD%AE%E8%87%AA%E5%8A%A8%E6%B3%A8%E5%86%8C" rel="nofollow">4、web页面配置自动注册</a></p> 
<p id="5%E3%80%81%E9%AA%8C%E8%AF%81%E8%87%AA%E5%8A%A8%E6%B3%A8%E5%86%8C-toc" style="margin-left:40px;"><a href="#5%E3%80%81%E9%AA%8C%E8%AF%81%E8%87%AA%E5%8A%A8%E6%B3%A8%E5%86%8C" rel="nofollow">5、验证自动注册</a></p> 
<p id="%E4%B8%89%E3%80%81%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2-toc" style="margin-left:0px;"><a href="#%E4%B8%89%E3%80%81%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2" rel="nofollow">三、代理服务器部署</a></p> 
<p id="1%E3%80%81%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BD%9C%E7%94%A8-toc" style="margin-left:40px;"><a href="#1%E3%80%81%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BD%9C%E7%94%A8" rel="nofollow">1、代理服务器作用</a></p> 
<p id="2%E3%80%81%E9%83%A8%E7%BD%B2%E7%8E%AF%E5%A2%83-toc" style="margin-left:40px;"><a href="#2%E3%80%81%E9%83%A8%E7%BD%B2%E7%8E%AF%E5%A2%83" rel="nofollow">2、部署环境</a></p> 
<p id="3%E3%80%81%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE-toc" style="margin-left:40px;"><a href="#3%E3%80%81%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE" rel="nofollow">3、代理服务器配置</a></p> 
<p id="4%E3%80%81%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%85%8D%E7%BD%AE-toc" style="margin-left:40px;"><a href="#4%E3%80%81%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%85%8D%E7%BD%AE" rel="nofollow">4、客户端配置</a></p> 
<p id="5%E3%80%81web%E9%A1%B5%E9%9D%A2%E9%85%8D%E7%BD%AE-toc" style="margin-left:40px;"><a href="#5%E3%80%81web%E9%A1%B5%E9%9D%A2%E9%85%8D%E7%BD%AE" rel="nofollow">5、web页面配置</a></p> 
<p id="%E2%91%A0%E5%88%A0%E9%99%A4%E5%8E%9F%E7%8E%AF%E5%A2%83-toc" style="margin-left:80px;"><a href="#%E2%91%A0%E5%88%A0%E9%99%A4%E5%8E%9F%E7%8E%AF%E5%A2%83" rel="nofollow">①删除原环境</a></p> 
<p id="%E2%91%A1%20%E6%B7%BB%E5%8A%A0%E4%BB%A3%E7%90%86-toc" style="margin-left:80px;"><a href="#%E2%91%A1%20%E6%B7%BB%E5%8A%A0%E4%BB%A3%E7%90%86" rel="nofollow">② 添加代理</a></p> 
<p id="%E2%91%A2%E5%88%9B%E5%BB%BA%E4%B8%BB%E6%9C%BA%C2%A0-toc" style="margin-left:80px;"><a href="#%E2%91%A2%E5%88%9B%E5%BB%BA%E4%B8%BB%E6%9C%BA%C2%A0" rel="nofollow">③创建主机 </a></p> 
<p id="%E2%91%A3%E9%87%8D%E5%90%AF%E6%9C%8D%E5%8A%A1-toc" style="margin-left:80px;"><a href="#%E2%91%A3%E9%87%8D%E5%90%AF%E6%9C%8D%E5%8A%A1" rel="nofollow">④重启服务</a></p> 
<p id="6%E3%80%81%E9%AA%8C%E8%AF%81%E7%BB%93%E6%9E%9C-toc" style="margin-left:40px;"><a href="#6%E3%80%81%E9%AA%8C%E8%AF%81%E7%BB%93%E6%9E%9C" rel="nofollow">6、验证结果</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2>一、zabbix自定义监控数据库</h2> 
<h3 id="1%E3%80%81%E7%BC%96%E5%86%99%E7%9B%91%E6%8E%A7%E8%84%9A%E6%9C%AC">1、编写监控脚本</h3> 
<p>首先在被监控服务器的子配置文件路径中编写监控脚本</p> 
<pre><code>cd  /etc/zabbix/zabbix_agent2.d
#进入agent2的子配置文件，本实验为yum安装为zabbix_zagent2客户端
vim mysql.conf
#创建一个新的mysql.conf子配置文件，名称无所谓但是结尾必须以.conf结尾，主配置文件中有规定，yum安装的主配置文件目录为 /etc/zabbix/zabbix_agent2.conf
#添加内容如下
UserParameter=lhj.user,netstat -antp | grep 3306 |wc -l
#UserParameter为键名，此键名不可随意更改主配置文件中有要求
#lhj.user为键值，键值可以自定义
#,后的为此键值的内容，可以是一个有标准输出的命令也可以直接写执行某个脚本，执行脚本注意权限问题
systemctl  restart  zabbix-agent2.service
#保存脚本内容后重启zabbix客户端
</code></pre> 
<h3 id="2%E3%80%81%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B5%8B%E8%AF%95">2、服务端测试</h3> 
<p>服务端测试是否可以监控到自定义键值的内容</p> 
<pre><code>服务端：
yum install -y zabbix-get
#安装zabbix主动获取命令
zabbix_get  -s '192.168.30.12'  -p 10050 -k 'lhj.user'
#-s表示指定客户端ip  -p表示指定客户端端口  -k 指定测试那个键值，返回结果为脚本命令输出结果即可以进行监控</code></pre> 
<h3 id="3%E3%80%81web%E9%A1%B5%E9%9D%A2%E9%85%8D%E7%BD%AE">3、web页面配置</h3> 
<h4 id="%E2%91%A0%E5%88%9B%E5%BB%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9B%91%E6%8E%A7%E9%A1%B9">①创建自定义监控项</h4> 
<p>选择要监控的主机创建监控项，如何添加主机请看此博客<a href="https://blog.csdn.net/weixin_67287151/article/details/130083170?spm=1001.2014.3001.5501" title="分布式系统监控zabbix安装部署及使用_阿杰。159的博客-CSDN博客">分布式系统监控zabbix安装部署及使用_阿杰。159的博客-CSDN博客</a> 在配置--主机中找到要监控的主机，点击监控项然后点击创建监控项 </p> 
<p><img alt="" height="792" src="https://images2.imgbox.com/67/d6/1DOBHqee_o.png" width="1200"></p> 
<p><img alt="" height="769" src="https://images2.imgbox.com/21/06/ha3J5hBt_o.png" width="1200"></p> 
<p><img alt="" height="845" src="https://images2.imgbox.com/9b/89/hQF4FMVa_o.png" width="1129"> <img alt="" height="654" src="https://images2.imgbox.com/b0/89/TYeTME75_o.png" width="1200"></p> 
<h4 id="%E2%91%A1%E5%88%9B%E5%BB%BA%E8%A7%A6%E5%8F%91%E5%99%A8">②创建触发器</h4> 
<p> 在配置--主机中找到要监控的主机，点击触发器然后点击创建触发器添加规则</p> 
<p><img alt="" height="724" src="https://images2.imgbox.com/de/ed/8CctueEA_o.png" width="1200"> <img alt="" height="556" src="https://images2.imgbox.com/50/be/Y4Rsfa0G_o.png" width="1200"></p> 
<p><img alt="" height="635" src="https://images2.imgbox.com/95/fd/aJld1qzZ_o.png" width="1200"><img alt="" height="635" src="https://images2.imgbox.com/d3/26/2MxjoUUN_o.png" width="1200"></p> 
<h4 id="%E2%91%A2%E5%88%9B%E5%BB%BA%E5%9B%BE%E5%BD%A2%C2%A0">③创建图形 </h4> 
<p> 配置-主机-图形中创建图形并添加规则<img alt="" height="686" src="https://images2.imgbox.com/6b/b3/hbmqz8Oh_o.png" width="1200"></p> 
<p><img alt="" height="583" src="https://images2.imgbox.com/8d/f4/sAwPmSmc_o.png" width="1200"></p> 
<p><img alt="" height="758" src="https://images2.imgbox.com/3f/ac/x9jqkoEz_o.png" width="1200"></p> 
<h4 id="%E2%91%A3%E6%B5%8B%E8%AF%95%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9B%91%E6%8E%A7%E6%98%AF%E5%90%A6%E6%88%90%E5%8A%9F">④测试自定义监控是否成功</h4> 
<p>点击监测--主机--选择被监控的主机--单击后选择图形找到自己创图形的名称，有数据则表示正常</p> 
<p><img alt="" height="841" src="https://images2.imgbox.com/bb/7f/JUGDPm99_o.png" width="1200"></p> 
<p><img alt="" height="795" src="https://images2.imgbox.com/32/15/NofGJQCe_o.png" width="1200"></p> 
<h2 id="%E4%BA%8C%E3%80%81zabbix%E8%87%AA%E5%8A%A8%E6%B3%A8%E5%86%8C">二、zabbix自动注册</h2> 
<h3 id="1%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF%E8%87%AA%E5%8A%A8%E6%B3%A8%E5%86%8C">1、什么是自动注册</h3> 
<p>zabbix 自动注册（对于 agent2 是主动模式）<br> zabbix agent2 会主动上报自己的信息，发给 zabbix server。<br> 缺点是可能因为配置文件配置错误或者网络不通等原因导致 zabbix agent2 可能找不到 zabbix server。</p> 
<h3 id="2%E3%80%81%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87">2、环境准备</h3> 
<p>点击左边菜单栏【配置】中的【自动发现】，勾选发现规则，点击 禁用<br> 点击左边菜单栏【配置】中的【主机】，勾选原有的客户端主机，点击 删除<img alt="" height="653" src="https://images2.imgbox.com/16/e9/LZmgtcZW_o.png" width="1200"></p> 
<p><img alt="" height="748" src="https://images2.imgbox.com/aa/21/KeTmTtVO_o.png" width="1200"></p> 
<h3 id="3%E3%80%81%20zabbix%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%85%8D%E7%BD%AE">3、 zabbix客户端配置</h3> 
<pre><code>vim /etc/hosts
192.168.30.1 zbx-server
192.168.30.12 zbx-agent01
#添加hosts，注意要更改对应主机名且bash刷新使得主机名生效
vim /etc/zabbix/zabbix_agent2.conf
#修改客户端配置文件
HostnameItem=system.hostname	
#139行，取消注释即可保存退出
grep -Ev "^#|^$" /etc/zabbix/zabbix_agent2.conf 
#过滤出客户端配置文件不以#开头且不是空行的内容，内容展示如下
PidFile=/var/run/zabbix/zabbix_agent2.pid
LogFile=/var/log/zabbix/zabbix_agent2.log
LogFileSize=0
Server=192.168.30.11
ServerActive=192.168.30.11
Hostname=zbx-agent01
HostnameItem=system.hostname
Include=/etc/zabbix/zabbix_agent2.d/*.conf
ControlSocket=/tmp/agent.sock

</code></pre> 
<h3 id="4%E3%80%81web%E9%A1%B5%E9%9D%A2%E9%85%8D%E7%BD%AE%E8%87%AA%E5%8A%A8%E6%B3%A8%E5%86%8C">4、web页面配置自动注册</h3> 
<p>登录界面点击配置--动作--左上角点击--选择自动注册动作--创建动作--添加完成动作名称和条件后--点击右上角操作--添加一个操作类型为主机名称的然后add--再添加一个操作类型为添加到主机群组，群组选择linux serversadd后--再添加一个与模板关联模板选择Template OS Linux by Zabbix agent--点击add后添加<img alt="" height="716" src="https://images2.imgbox.com/5e/37/Pqysjw4P_o.png" width="1200"> <img alt="" height="562" src="https://images2.imgbox.com/98/c7/1RTrAQmF_o.png" width="1200"></p> 
<p><img alt="" height="615" src="https://images2.imgbox.com/57/de/6JIRSWbV_o.png" width="1200"></p> 
<p><img alt="" height="626" src="https://images2.imgbox.com/42/ee/8yQqlDv2_o.png" width="1200"></p> 
<p><img alt="" height="593" src="https://images2.imgbox.com/40/a6/BPEVEjqu_o.png" width="1200"></p> 
<h3 id="5%E3%80%81%E9%AA%8C%E8%AF%81%E8%87%AA%E5%8A%A8%E6%B3%A8%E5%86%8C">5、验证自动注册</h3> 
<pre><code>服务端：
tail -f /var/log/zabbix/zabbix_server.log
#实时查看server日志</code></pre> 
<p>web页面点击配置--主机-然后刷新等待自动注册内容出现且zbx亮起<img alt="" height="675" src="https://images2.imgbox.com/1b/36/vLYFXCqW_o.png" width="1200"></p> 
<h2 id="%E4%B8%89%E3%80%81%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2">三、代理服务器部署</h2> 
<h3 id="1%E3%80%81%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BD%9C%E7%94%A8">1、代理服务器作用</h3> 
<p>①分担 server 的集中式压力<br> ②解决多机房之间的网络延时问题 </p> 
<p> <img alt="" height="306" src="https://images2.imgbox.com/a2/dc/u3nm5OiF_o.png" width="681"></p> 
<h3 id="2%E3%80%81%E9%83%A8%E7%BD%B2%E7%8E%AF%E5%A2%83">2、部署环境</h3> 
<p>在原有zabbix server和zabbix agent2上再添加一台代理服务器</p> 
<table cellspacing="0" style="width:248.43pt;"><tbody><tr><td style="background-color:#4f81bd;vertical-align:middle;width:82.2pt;"><span style="color:#ffffff;"><strong>主机名</strong></span></td><td style="background-color:#4f81bd;vertical-align:middle;width:84pt;"><span style="color:#ffffff;"><strong>服务</strong></span></td><td style="background-color:#4f81bd;vertical-align:middle;width:82.2pt;"><span style="color:#ffffff;"><strong>ip地址</strong></span></td></tr><tr><td style="vertical-align:middle;"><span style="color:#000000;">zbx-server</span></td><td style="vertical-align:middle;"><span style="color:#000000;">zabbix-server</span></td><td style="vertical-align:middle;"><span style="color:#000000;">192.168.30.11</span></td></tr><tr><td style="vertical-align:middle;"><span style="color:#000000;">zbx-agent0</span></td><td style="vertical-align:middle;"><span style="color:#000000;">zabbix-agent2</span></td><td style="vertical-align:middle;"><span style="color:#000000;">192.168.30.12</span></td></tr><tr><td style="vertical-align:middle;"><span style="color:#000000;">zbx-proxy</span></td><td style="vertical-align:middle;"><span style="color:#000000;">zabbix-proxy</span></td><td style="vertical-align:middle;"><span style="color:#000000;">192.168.30.13</span></td></tr></tbody></table> 
<h3 id="3%E3%80%81%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE">3、代理服务器配置</h3> 
<pre><code>systemctl disable --now firewalld
setenforce 0
hostnamectl set-hostname zbx-proxy
bash
#关闭防火墙selinux并修改主机名刷新
rpm -ivh https://mirrors.aliyun.com/zabbix/zabbix/5.0/rhel/7/x86_64/zabbix-release-5.0-1.el7.noarch.rpm
#配置zabbix的yum源
cd /etc/yum.repos.d
sed -i 's#http://repo.zabbix.com#https://mirrors.aliyun.com/zabbix#' /etc/yum.repos.d/zabbix.repo
#更改为国内阿里源
yum install -y zabbix-proxy-mysql zabbix-get
#设置zabbix的下载源，然后改为国内源，安装zabbix-proxy 和zabbix-get工具
yum install -y mariadb-server mariadb
systemctl enable --now mariadb
#安装zabbix需要的数据库开启并设置开机自启
mysql_secure_installation 
#初始化数据库设置密码为abc123，当前密码为空第一个直接回车，然后输入y回车，输入abc123回车，确认设置abc123位密码回车，然后一直y到最后
mysql -u root -pabc123
#登录数据
CREATE DATABASE zabbix_proxy character set utf8 collate utf8_bin;
GRANT all ON zabbix_proxy.* TO 'zabbix'@'%' IDENTIFIED BY 'zabbix';
flush privileges;
exit
#创建zabbix_proxy库并设置为utf-8模式，创建远程登录用户zabbix_proyx并设置密码为zabbix，刷新配置，退出数据库
rpm -ql zabbix-proxy-mysql
#查询数据库sql文件位置，/usr/share/doc/zabbix-proxy-mysql-5.0.33/schema.sql.gz一般为这个，若版本号不同则看最后的文件
zcat /usr/share/doc/zabbix-proxy-mysql-5.0.33/schema.sql.gz | mysql -uroot -pabc123 zabbix_proxy
#将查到的数据文件导入zabbix_proxy库中
vim /etc/zabbix/zabbix_proxy.conf
#编辑zabbix配置文件
Server=192.168.30.11				
#30行，指定 zabbix 服务端的 IP 地址
Hostname=zbx-proxy					
#49行，指定当前 zabbix 代理服务器的主机名
DBPassword=zabbix					
#196行，去掉注释指定当前数据库 zabbix 用户的密码
systemctl start zabbix-proxy
systemctl enable zabbix-proxy
#启动zabbix-proxy服务并设置开机自启
所有主机执行：
vim /etc/hosts
192.168.30.11 zbx-server
192.168.30.12 zbx-agent01
192.168.30.13 zbx-proxy
#添加hosts文件</code></pre> 
<h3 id="4%E3%80%81%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%85%8D%E7%BD%AE">4、客户端配置</h3> 
<p>客户端本身配置文件中服务器地址配置是zabbix server的地址，需要改为代理服务器的地址。</p> 
<pre><code>客户端执行：
vim /etc/zabbix/zabbix_agent2.conf
Server=192.168.30.13			
#80行，指定 zabbix 代理服务器的 IP 地址
ServerActive=192.168.30.13		
#120行，指定 zabbix 代理服务器的 IP 地址</code></pre> 
<h3 id="5%E3%80%81web%E9%A1%B5%E9%9D%A2%E9%85%8D%E7%BD%AE">5、web页面配置</h3> 
<h4 id="%E2%91%A0%E5%88%A0%E9%99%A4%E5%8E%9F%E7%8E%AF%E5%A2%83">①删除原环境</h4> 
<p>点击左边菜单栏【配置】中的【动作】，勾选自动注册规则，点击 禁用<br> 点击左边菜单栏【配置】中的【主机】，勾选原有的客户端主机，点击 删除 <img alt="" height="653" src="https://images2.imgbox.com/07/7f/FfBhJHaq_o.png" width="1200"></p> 
<p><img alt="" height="748" src="https://images2.imgbox.com/c8/1e/nfrnZJWp_o.png" width="1200"></p> 
<h4 id="%E2%91%A1%20%E6%B7%BB%E5%8A%A0%E4%BB%A3%E7%90%86">② 添加代理</h4> 
<p>点击左边菜单栏【管理】中的【agent代理程序】，点击【创建代理】<br> 【agent代理程序名称】设置为 zbx-proxy<br> 【系统代理程序模式】选择 主动式<br> 【代理地址】设置为 192.168.30.13<br> 点击 【添加】</p> 
<p><img alt="" height="620" src="https://images2.imgbox.com/48/6d/ElBMcGGj_o.png" width="1200"></p> 
<p><img alt="" height="618" src="https://images2.imgbox.com/11/e2/r0LLt19s_o.png" width="1200"></p> 
<h4 id="%E2%91%A2%E5%88%9B%E5%BB%BA%E4%B8%BB%E6%9C%BA%C2%A0">③创建主机 </h4> 
<p> 在 Web 页面配置<br> 点击左边菜单栏【配置】中的【主机】，点击【创建主机】<br> 【主机名称】设置成 zbx-agent01<br> 【可见的名称】设置成 zbx-agent01<br> 【群组】选择 Linux server<br> 【Interfaces】的【IP地址】设置成 192.168.30.12<br> 【由agent代理程序监测】选择 zbx-proxy<img alt="" height="636" src="https://images2.imgbox.com/c3/34/u8ZcQPiT_o.png" width="1200"></p> 
<h4 id="%E2%91%A3%E9%87%8D%E5%90%AF%E6%9C%8D%E5%8A%A1">④重启服务</h4> 
<pre><code>客户端：
systemctl restart zabbix-agent2
代理服务器：
systemctl restart zabbix-proxy</code></pre> 
<h3 id="6%E3%80%81%E9%AA%8C%E8%AF%81%E7%BB%93%E6%9E%9C">6、验证结果</h3> 
<p>①点击左边菜单栏【配置】中的【主机】刷新，查看客户端主机监控状态正常 <img alt="" height="782" src="https://images2.imgbox.com/3e/3e/VhmcdzYx_o.png" width="1200"></p> 
<p>②上图为正常，若不正常请在代理服务器查看日志报错： tail -f /var/log/zabbix/zabbix_proxy.log</p> 
<p> 图中报错cannot send proxy data to server at "192.168.30.11": proxy "zabbix-proxy" not found表示zabbix-proxy配置文件中写的主机名不存在，即配置文件中主机名和代理服务器本身的主机名不一致，更改一致即可<br><img alt="" height="331" src="https://images2.imgbox.com/43/1e/zZTK2J6A_o.png" width="1186"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d0687382bdacf40d74fd8d13fd26561a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Pycharm Run 控制台打印中文乱码</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/cf25a95c763c74ab8a2c7615079f90a7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">如何解决MongoDB安装时报错2503、2502等</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>