<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>c#制作ActiveX控件 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="c#制作ActiveX控件" />
<meta property="og:description" content="使用VS2010制作ActiveX控件
工具/原料 一台windows操作平台的电脑VS2010工具 方法/步骤 新建一个项目，选window-&gt;类库（这里选控件库也是可以的） 在应用程序-&gt;程序集信息，勾选里面的“使程序集com可见” 然后在生成-&gt;勾选“为com互操作注册”然后重新生成解决方案 在AssemblyInfo.cs类里面添加一下内容 然后添加接口IObjectSafety.cs，这里的名字不要改它 接口里面的内容如下，特别注意的是这里面的guid 不能更改，只要将下面的代码复制到接口里面去就可以了 [ComImport, GuidAttribute(&#34;CB5BDC81-93C1-11CF-8F20-00805F2CD064&#34;)]
[InterfaceTypeAttribute(ComInterfaceType.InterfaceIsIUnknown)]
interface IObjectSafety
{
[PreserveSig]
int GetInterfaceSafetyOptions(ref Guid riid, [MarshalAs(UnmanagedType.U4)] ref int pdwSupportedOptions, [MarshalAs(UnmanagedType.U4)] ref int pdwEnabledOptions);
[PreserveSig()]
int SetInterfaceSafetyOptions(ref Guid riid, [MarshalAs(UnmanagedType.U4)] int dwOptionSetMask, [MarshalAs(UnmanagedType.U4)] int dwEnabledOptions);
}
添加用户控件，然后在里面拉一个label控件，textbox控件，button控件，然后给button1添加一个点击事件 private void button1_Click(object sender, EventArgs e)
{
label1.Text = textBox1.Text;
}
这里是生成guid，工具-&gt;创建guid,点击右边的复制就可以了 将刚才生成的guid添加到用户控件上面去，并且让用户控件继承接口IObjectSafety，并且在用户控件里面实现接口IObjectSafety，将下面的复制粘贴就可以了 #region IObjectSafety 成员
private const string _IID_IDispatch = &#34;{00020400-0000-0000-C000-000000000046}&#34;;
private const string _IID_IDispatchEx = &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/fc1d0334506f04a96125c46eda693e2b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-04-18T17:18:19+08:00" />
<meta property="article:modified_time" content="2019-04-18T17:18:19+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">c#制作ActiveX控件</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>使用VS2010制作ActiveX控件</p> 
<h3>工具/原料</h3> 
<ul><li>一台windows操作平台的电脑</li><li>VS2010工具</li></ul> 
<h3>方法/步骤</h3> 
<ul><li>新建一个项目，选window-&gt;类库（这里选控件库也是可以的）</li></ul> 
<p><a href="http://jingyan.baidu.com/album/8ebacdf010ba2c49f65cd5aa.html?picindex=1" rel="nofollow"><img alt="c#制作ActiveX控件" class="has" src="https://images2.imgbox.com/44/11/FwHTc15H_o.jpg"></a></p> 
<ul><li>在应用程序-&gt;程序集信息，勾选里面的“使程序集com可见”</li></ul> 
<p><a href="http://jingyan.baidu.com/album/8ebacdf010ba2c49f65cd5aa.html?picindex=3" rel="nofollow"><img alt="c#制作ActiveX控件" class="has" src="https://images2.imgbox.com/a3/58/HDSIH102_o.jpg"></a></p> 
<ul><li>然后在生成-&gt;勾选“为com互操作注册”然后重新生成解决方案</li></ul> 
<p><a href="http://jingyan.baidu.com/album/8ebacdf010ba2c49f65cd5aa.html?picindex=4" rel="nofollow"><img alt="c#制作ActiveX控件" class="has" src="https://images2.imgbox.com/58/8b/Iom7PL8o_o.jpg"></a></p> 
<ul><li>在AssemblyInfo.cs类里面添加一下内容</li></ul> 
<p><a href="http://jingyan.baidu.com/album/8ebacdf010ba2c49f65cd5aa.html?picindex=5" rel="nofollow"><img alt="c#制作ActiveX控件" class="has" src="https://images2.imgbox.com/06/22/PYGRPnVd_o.jpg"></a></p> 
<ul><li>然后添加接口IObjectSafety.cs，这里的名字不要改它</li></ul> 
<p><a href="http://jingyan.baidu.com/album/8ebacdf010ba2c49f65cd5aa.html?picindex=6" rel="nofollow"><img alt="c#制作ActiveX控件" class="has" src="https://images2.imgbox.com/68/be/pVSnMrvs_o.jpg"></a></p> 
<ul><li>接口里面的内容如下，特别注意的是这里面的guid 不能更改，只要将下面的代码复制到接口里面去就可以了</li></ul> 
<p>        [ComImport, GuidAttribute("CB5BDC81-93C1-11CF-8F20-00805F2CD064")]</p> 
<p>        [InterfaceTypeAttribute(ComInterfaceType.InterfaceIsIUnknown)]</p> 
<p>        interface IObjectSafety</p> 
<p>        {<!-- --></p> 
<p>            [PreserveSig]</p> 
<p>            int GetInterfaceSafetyOptions(ref Guid riid, [MarshalAs(UnmanagedType.U4)] ref int pdwSupportedOptions, [MarshalAs(UnmanagedType.U4)] ref int pdwEnabledOptions);</p> 
<p>            [PreserveSig()]</p> 
<p>            int SetInterfaceSafetyOptions(ref Guid riid, [MarshalAs(UnmanagedType.U4)] int dwOptionSetMask, [MarshalAs(UnmanagedType.U4)] int dwEnabledOptions);</p> 
<p>        }</p> 
<p><a href="http://jingyan.baidu.com/album/8ebacdf010ba2c49f65cd5aa.html?picindex=7" rel="nofollow"><img alt="c#制作ActiveX控件" class="has" src="https://images2.imgbox.com/bc/fc/LcAB6LVt_o.jpg"></a></p> 
<ul><li>添加用户控件，然后在里面拉一个label控件，textbox控件，button控件，然后给button1添加一个点击事件</li></ul> 
<p>private void button1_Click(object sender, EventArgs e)</p> 
<p>{<!-- --></p> 
<p>      label1.Text = textBox1.Text;</p> 
<p>}</p> 
<p><a href="http://jingyan.baidu.com/album/8ebacdf010ba2c49f65cd5aa.html?picindex=8" rel="nofollow"><img alt="c#制作ActiveX控件" class="has" src="https://images2.imgbox.com/d1/0a/kBVdeuNh_o.jpg"></a></p> 
<p><a href="http://jingyan.baidu.com/album/8ebacdf010ba2c49f65cd5aa.html?picindex=9" rel="nofollow"><img alt="c#制作ActiveX控件" class="has" src="https://images2.imgbox.com/fe/cf/PkPaDTwm_o.jpg"></a></p> 
<ul><li>这里是生成guid，工具-&gt;创建guid,点击右边的复制就可以了</li></ul> 
<p><a href="http://jingyan.baidu.com/album/8ebacdf010ba2c49f65cd5aa.html?picindex=10" rel="nofollow"><img alt="c#制作ActiveX控件" class="has" src="https://images2.imgbox.com/21/65/UMXWnq9V_o.jpg"></a></p> 
<p><a href="http://jingyan.baidu.com/album/8ebacdf010ba2c49f65cd5aa.html?picindex=11" rel="nofollow"><img alt="c#制作ActiveX控件" class="has" src="https://images2.imgbox.com/8f/40/IOOvCcSy_o.jpg"></a></p> 
<ul><li>将刚才生成的guid添加到用户控件上面去，并且让用户控件继承接口IObjectSafety，并且在用户控件里面实现接口IObjectSafety，将下面的复制粘贴就可以了</li></ul> 
<p>#region IObjectSafety 成员</p> 
<p>        private const string _IID_IDispatch = "{00020400-0000-0000-C000-000000000046}";</p> 
<p>        private const string _IID_IDispatchEx = "{a6ef9860-c720-11d0-9337-00a0c90dcaa9}";</p> 
<p>        private const string _IID_IPersistStorage = "{0000010A-0000-0000-C000-000000000046}";</p> 
<p>        private const string _IID_IPersistStream = "{00000109-0000-0000-C000-000000000046}";</p> 
<p>        private const string _IID_IPersistPropertyBag = "{37D84F60-42CB-11CE-8135-00AA004BB851}";</p> 
<p>        private const int INTERFACESAFE_FOR_UNTRUSTED_CALLER = 0x00000001;</p> 
<p>        private const int INTERFACESAFE_FOR_UNTRUSTED_DATA = 0x00000002;</p> 
<p>        private const int S_OK = 0;</p> 
<p>        private const int E_FAIL = unchecked((int)0x80004005);</p> 
<p>        private const int E_NOINTERFACE = unchecked((int)0x80004002);</p> 
<p>        private bool _fSafeForScripting = true;</p> 
<p>        private bool _fSafeForInitializing = true;</p> 
<p>        public int GetInterfaceSafetyOptions(ref Guid riid, ref int pdwSupportedOptions, ref int pdwEnabledOptions)</p> 
<p>        {<!-- --></p> 
<p>            int Rslt = E_FAIL;</p> 
<p>            string strGUID = riid.ToString("B");</p> 
<p>            pdwSupportedOptions = INTERFACESAFE_FOR_UNTRUSTED_CALLER | INTERFACESAFE_FOR_UNTRUSTED_DATA;</p> 
<p>            switch (strGUID)</p> 
<p>            {<!-- --></p> 
<p>                case _IID_IDispatch:</p> 
<p>                case _IID_IDispatchEx:</p> 
<p>                    Rslt = S_OK;</p> 
<p>                    pdwEnabledOptions = 0;</p> 
<p>                    if (_fSafeForScripting == true)</p> 
<p>                        pdwEnabledOptions = INTERFACESAFE_FOR_UNTRUSTED_CALLER;</p> 
<p>                    break;</p> 
<p>                case _IID_IPersistStorage:</p> 
<p>                case _IID_IPersistStream:</p> 
<p>                case _IID_IPersistPropertyBag:</p> 
<p>                    Rslt = S_OK;</p> 
<p>                    pdwEnabledOptions = 0;</p> 
<p>                    if (_fSafeForInitializing == true)</p> 
<p>                        pdwEnabledOptions = INTERFACESAFE_FOR_UNTRUSTED_DATA;</p> 
<p>                    break;</p> 
<p>                default:</p> 
<p>                    Rslt = E_NOINTERFACE;</p> 
<p>                    break;</p> 
<p>            }</p> 
<p>            return Rslt;</p> 
<p>        }</p> 
<p>        public int SetInterfaceSafetyOptions(ref Guid riid, int dwOptionSetMask, int dwEnabledOptions)</p> 
<p>        {<!-- --></p> 
<p>            int Rslt = E_FAIL;</p> 
<p>            string strGUID = riid.ToString("B");</p> 
<p>            switch (strGUID)</p> 
<p>            {<!-- --></p> 
<p>                case _IID_IDispatch:</p> 
<p>                case _IID_IDispatchEx:</p> 
<p>                    if (((dwEnabledOptions &amp; dwOptionSetMask) == INTERFACESAFE_FOR_UNTRUSTED_CALLER) &amp;&amp; (_fSafeForScripting == true))</p> 
<p>                        Rslt = S_OK;</p> 
<p>                    break;</p> 
<p>                case _IID_IPersistStorage:</p> 
<p>                case _IID_IPersistStream:</p> 
<p>                case _IID_IPersistPropertyBag:</p> 
<p>                    if (((dwEnabledOptions &amp; dwOptionSetMask) == INTERFACESAFE_FOR_UNTRUSTED_DATA) &amp;&amp; (_fSafeForInitializing == true))</p> 
<p>                        Rslt = S_OK;</p> 
<p>                    break;</p> 
<p>                default:</p> 
<p>                    Rslt = E_NOINTERFACE;</p> 
<p>                    break;</p> 
<p>            }</p> 
<p>            return Rslt;</p> 
<p>        }</p> 
<p>        #endregion</p> 
<p><a href="http://jingyan.baidu.com/album/8ebacdf010ba2c49f65cd5aa.html?picindex=12" rel="nofollow"><img alt="c#制作ActiveX控件" class="has" src="https://images2.imgbox.com/76/09/XrSJSuBB_o.jpg"></a></p> 
<p> </p> 
<ul><li>然后添加一个安装部署项目，然后添加项目输出，将刚刚的项目选上就可以了</li></ul> 
<p><a href="http://jingyan.baidu.com/album/8ebacdf010ba2c49f65cd5aa.html?picindex=13" rel="nofollow"><img alt="c#制作ActiveX控件" class="has" src="https://images2.imgbox.com/96/4b/mY5uWAPG_o.jpg"></a></p> 
<p><a href="http://jingyan.baidu.com/album/8ebacdf010ba2c49f65cd5aa.html?picindex=14" rel="nofollow"><img alt="c#制作ActiveX控件" class="has" src="https://images2.imgbox.com/8c/aa/3z4PDEHd_o.jpg"></a></p> 
<p><a href="http://jingyan.baidu.com/album/8ebacdf010ba2c49f65cd5aa.html?picindex=15" rel="nofollow"><img alt="c#制作ActiveX控件" class="has" src="https://images2.imgbox.com/dc/5e/uGLDDemb_o.jpg"></a></p> 
<p><a href="http://jingyan.baidu.com/album/8ebacdf010ba2c49f65cd5aa.html?picindex=16" rel="nofollow"><img alt="c#制作ActiveX控件" class="has" src="https://images2.imgbox.com/18/c3/tVbuTfd4_o.jpg"></a></p> 
<ul><li>然后右键部署项目，生成之后在项目下的debug文件夹下有两个文件分别为exe和msi文件，双击msi文件按照安装步骤安装。</li><li>然后在解决方案里面再添加一个项目。主要是用来测试的，这里我选择的页面来测试，然后在Default.aspx里面添加一个object，里面的classid为刚刚给用户控件添加的guid，一定要相同的，不然的话 系统找不到你制作的控件，然后将项目设为启动项目，运行就可以了</li></ul> 
<p><a href="http://jingyan.baidu.com/album/8ebacdf010ba2c49f65cd5aa.html?picindex=17" rel="nofollow"><img alt="c#制作ActiveX控件" class="has" src="https://images2.imgbox.com/67/1f/t8w8Lj4N_o.jpg"></a></p> 
<p><a href="http://jingyan.baidu.com/album/8ebacdf010ba2c49f65cd5aa.html?picindex=18" rel="nofollow"><img alt="c#制作ActiveX控件" class="has" src="https://images2.imgbox.com/63/af/jG33FNlC_o.jpg"></a></p> 
<p><a href="http://jingyan.baidu.com/album/8ebacdf010ba2c49f65cd5aa.html?picindex=19" rel="nofollow"><img alt="c#制作ActiveX控件" class="has" src="https://images2.imgbox.com/c8/26/ip9DxWif_o.jpg"></a></p> 
<h3><strong>注意：</strong></h3> 
<ul><li>IObjectSafety.cs接口的guid一定不能变，这个是一个固定值</li><li>页面的guid一定要和控件上的guid一样</li><li>如果你制作的ActiveX控件需要添加信任站点之后才可以看到的话，一是你没有让你的控件继承接口IObjectSafety.cs，二就是你改了接口上的guid值</li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f1d18aaa9584e4947a3d76f6b636b21a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">java Lambda表达式示例</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9f4be6b8eb94db940d3685325ad12b76/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">JAVA基础知识面向对象之 ---- 参数类型与返回值类型、修饰符</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>