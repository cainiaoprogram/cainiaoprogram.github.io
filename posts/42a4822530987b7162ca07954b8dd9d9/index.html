<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【opengl】两种方法在Qt中使用OpenGL库加载stl三维模型 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【opengl】两种方法在Qt中使用OpenGL库加载stl三维模型" />
<meta property="og:description" content="【opengl】两种方法在Qt中使用OpenGL库加载stl三维模型 OpenGL（Open Graphics Library）是一种用于渲染2D、3D矢量图形的跨语言、跨平台的应用程序接口。OpenGL的实现利用了图形加速硬件，这些实现一般由显示设备厂商提供。但真正使用时，一般采用基于gl的第三方库，用于在程序的运行期判断当前硬件是否支持相关的扩展，防止程序崩溃甚至造成硬件损坏。目前我了解到的第三方库就有glad、glew、glfw、freeglut等，下图反映了它们之间的关系。
此外在安装Qt后，Qt本身也会对gl库进行一定的封装，即qopengl.h和QOpenGLFunctions。Qt是目前做UI非常好的一款工具，再结合它给的例子，比如cube、hellogl2等，可以仿照着做出很多比较好的人机交互界面。
对于三维模型，常用的软件有solid work，AutoCAD等，可以采用这些软件画出后导出stl模型文件。 STL 文件有2 种类型：文本文件(ASCII格式)和二进制文件(BINARY)。其中文本格式的可以用notepad&#43;&#43;打开，它里面包含多个三角形面片的定义组成，每个三角形的定义包括三角形各个定点的三维坐标及三角形面片的法矢量，三角形顶点的排列顺序遵循右手法则。因此对于用opengl渲染stl文件，我们首先得加载它，https://free3d.com也可下到很多模型文件。
1. 使用Qt自带的库 使用Qt自带的库，窗口可继承public QOpenGLWidget, protected QOpenGLFunctions（提供了一套OpenGL ES2.0 API，免去开发人员手动解析这些函数符号）。不过关于OpenGL ES的写法，我还是有点迷糊，没有看到比较系统性的介绍，一般给的例子都是采用现成的模板，我这里采用的是Qt例子中的方法。关于stl文本文件的加载，网上就有太多方法。
bool QObjLoad::load(QString fileName, QVector&lt;float&gt;&amp; vPoints) { if (fileName.mid(fileName.lastIndexOf(&#39;.&#39;)) != &#34;.obj&#34; &amp;&amp; fileName.mid(fileName.lastIndexOf(&#39;.&#39;)) != &#34;.OBJ&#34;) { qDebug() &lt;&lt; &#34;file is not a obj file.&#34;; return false; } QFile objFile(fileName); if (!objFile.open(QIODevice::ReadOnly)) { qDebug() &lt;&lt; &#34;open&#34; &lt;&lt; fileName &lt;&lt; &#34;failed&#34;; return false; } else { qDebug() &lt;&lt; &#34;open&#34; &lt;&lt; fileName &lt;&lt; &#34;success!&#34;; } QVector&lt;float&gt; vertextPoints, texturePoints, normalPoints; QVector&lt;int&gt; facesIndexs; while (!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/42a4822530987b7162ca07954b8dd9d9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-13T09:43:54+08:00" />
<meta property="article:modified_time" content="2023-03-13T09:43:54+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【opengl】两种方法在Qt中使用OpenGL库加载stl三维模型</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="openglQtOpenGLstl_0"></a>【opengl】两种方法在Qt中使用OpenGL库加载stl三维模型</h2> 
<p><code>OpenGL（Open Graphics Library）</code>是一种用于渲染2D、3D矢量图形的跨语言、跨平台的应用程序接口。OpenGL的实现利用了图形加速硬件，这些实现一般由显示设备厂商提供。但真正使用时，一般采用基于gl的第三方库，用于在程序的运行期判断当前硬件是否支持相关的扩展，防止程序崩溃甚至造成硬件损坏。目前我了解到的第三方库就有<code>glad</code>、<code>glew</code>、<code>glfw</code>、<code>freeglut</code>等，下图反映了它们之间的关系。<br> <img src="https://images2.imgbox.com/31/d3/m4CDXhll_o.png" alt="在这里插入图片描述"></p> 
<p>此外在安装Qt后，Qt本身也会对gl库进行一定的封装，即<code>qopengl.h</code>和<code>QOpenGLFunction</code>s。Qt是目前做UI非常好的一款工具，再结合它给的例子，比如<code>cube</code>、<code>hellogl2</code>等，可以仿照着做出很多比较好的人机交互界面。</p> 
<p><img src="https://images2.imgbox.com/a1/79/UH3XWAPl_o.png" alt="在这里插入图片描述"><br> 对于三维模型，常用的软件有solid work，AutoCAD等，可以采用这些软件画出后导出stl模型文件。 STL 文件有2 种类型：文本文件(ASCII格式)和二进制文件(BINARY)。其中文本格式的可以用notepad++打开，它里面包含多个三角形面片的定义组成，每个三角形的定义包括三角形各个定点的三维坐标及三角形面片的法矢量，三角形顶点的排列顺序遵循右手法则。因此对于用opengl渲染stl文件，我们首先得加载它，<a href="https://free3d.com" rel="nofollow">https://free3d.com</a>也可下到很多模型文件。</p> 
<h3><a id="1_Qt_8"></a>1. 使用Qt自带的库</h3> 
<p>使用<code>Qt自带的库</code>，窗口可继承<code>public QOpenGLWidget, protected QOpenGLFunctions</code>（提供了一套<code>OpenGL ES2.0 API</code>，免去开发人员手动解析这些函数符号）。不过关于OpenGL ES的写法，我还是有点迷糊，没有看到比较系统性的介绍，一般给的例子都是采用现成的模板，我这里采用的是Qt例子中的方法。关于stl文本文件的加载，网上就有太多方法。</p> 
<pre><code class="prism language-cpp"><span class="token keyword">bool</span> <span class="token class-name">QObjLoad</span><span class="token double-colon punctuation">::</span><span class="token function">load</span><span class="token punctuation">(</span>QString fileName<span class="token punctuation">,</span> QVector<span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span><span class="token operator">&amp;</span> vPoints<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>fileName<span class="token punctuation">.</span><span class="token function">mid</span><span class="token punctuation">(</span>fileName<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token char">'.'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">".obj"</span> <span class="token operator">&amp;&amp;</span> fileName<span class="token punctuation">.</span><span class="token function">mid</span><span class="token punctuation">(</span>fileName<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token char">'.'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">".OBJ"</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"file is not a obj file."</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    QFile <span class="token function">objFile</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>objFile<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>QIODevice<span class="token double-colon punctuation">::</span>ReadOnly<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"open"</span> <span class="token operator">&lt;&lt;</span> fileName <span class="token operator">&lt;&lt;</span> <span class="token string">"failed"</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"open"</span> <span class="token operator">&lt;&lt;</span> fileName <span class="token operator">&lt;&lt;</span> <span class="token string">"success!"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    QVector<span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span> vertextPoints<span class="token punctuation">,</span> texturePoints<span class="token punctuation">,</span> normalPoints<span class="token punctuation">;</span>
    QVector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> facesIndexs<span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>objFile<span class="token punctuation">.</span><span class="token function">atEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        QByteArray lineData <span class="token operator">=</span> objFile<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
        QList<span class="token operator">&lt;</span>QByteArray<span class="token operator">&gt;</span> strValues <span class="token operator">=</span> lineData<span class="token punctuation">.</span><span class="token function">trimmed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token char">' '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        QString dataType <span class="token operator">=</span> strValues<span class="token punctuation">.</span><span class="token function">takeFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>dataType <span class="token operator">==</span> <span class="token string">"v"</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            std<span class="token double-colon punctuation">::</span><span class="token function">transform</span><span class="token punctuation">(</span>strValues<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> strValues<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span><span class="token function">back_inserter</span><span class="token punctuation">(</span>vertextPoints<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span>QByteArray<span class="token operator">&amp;</span> str<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> str<span class="token punctuation">.</span><span class="token function">toFloat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>dataType <span class="token operator">==</span> <span class="token string">"vt"</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            std<span class="token double-colon punctuation">::</span><span class="token function">transform</span><span class="token punctuation">(</span>strValues<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> strValues<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span><span class="token function">back_inserter</span><span class="token punctuation">(</span>texturePoints<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span>QByteArray<span class="token operator">&amp;</span> str<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> str<span class="token punctuation">.</span><span class="token function">toFloat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>dataType <span class="token operator">==</span> <span class="token string">"vn"</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            std<span class="token double-colon punctuation">::</span><span class="token function">transform</span><span class="token punctuation">(</span>strValues<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> strValues<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span><span class="token function">back_inserter</span><span class="token punctuation">(</span>normalPoints<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span>QByteArray<span class="token operator">&amp;</span> str<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> str<span class="token punctuation">.</span><span class="token function">toFloat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>dataType <span class="token operator">==</span> <span class="token string">"f"</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            facesIndexs <span class="token operator">&lt;&lt;</span> strValues<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> strValues<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> strValues<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    objFile<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> verFaceInfo <span class="token operator">:</span> facesIndexs<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">int</span> vIndex <span class="token operator">=</span> verFaceInfo <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
 
        vPoints <span class="token operator">&lt;&lt;</span> vertextPoints<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>vIndex <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        vPoints <span class="token operator">&lt;&lt;</span> vertextPoints<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>vIndex <span class="token operator">*</span> <span class="token number">3</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        vPoints <span class="token operator">&lt;&lt;</span> vertextPoints<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>vIndex <span class="token operator">*</span> <span class="token number">3</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    vertextPoints<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    texturePoints<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    normalPoints<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    facesIndexs<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>这里主要是为了获取顶点坐标，接着就是在Qt的窗口上显示了，要重新实现三个函数<code>void initializeGL() override</code>、<code>void paintGL() override</code>和<code>void resizeGL(int width, int height) override。</code></p> 
<pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token class-name">GLWindow</span><span class="token double-colon punctuation">::</span><span class="token function">initializeGL</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">initializeOpenGLFunctions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glClearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    m_program <span class="token operator">=</span> <span class="token keyword">new</span> QOpenGLShaderProgram<span class="token punctuation">;</span>
    m_program<span class="token operator">-&gt;</span><span class="token function">addShaderFromSourceCode</span><span class="token punctuation">(</span>QOpenGLShader<span class="token double-colon punctuation">::</span>Vertex<span class="token punctuation">,</span> vertexShaderSourceCore<span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_program<span class="token operator">-&gt;</span><span class="token function">addShaderFromSourceCode</span><span class="token punctuation">(</span>QOpenGLShader<span class="token double-colon punctuation">::</span>Fragment<span class="token punctuation">,</span> fragmentShaderSourceCore<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>m_program<span class="token operator">-&gt;</span><span class="token function">link</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"link success!"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"link failed"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    m_program<span class="token operator">-&gt;</span><span class="token function">bindAttributeLocation</span><span class="token punctuation">(</span><span class="token string">"vertex"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_program<span class="token operator">-&gt;</span><span class="token function">bindAttributeLocation</span><span class="token punctuation">(</span><span class="token string">"normal"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_program<span class="token operator">-&gt;</span><span class="token function">link</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_program<span class="token operator">-&gt;</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_projMatrixLoc <span class="token operator">=</span> m_program<span class="token operator">-&gt;</span><span class="token function">uniformLocation</span><span class="token punctuation">(</span><span class="token string">"projMatrix"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_mvMatrixLoc <span class="token operator">=</span> m_program<span class="token operator">-&gt;</span><span class="token function">uniformLocation</span><span class="token punctuation">(</span><span class="token string">"mvMatrix"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_normalMatrixLoc <span class="token operator">=</span> m_program<span class="token operator">-&gt;</span><span class="token function">uniformLocation</span><span class="token punctuation">(</span><span class="token string">"normalMatrix"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_lightPosLoc <span class="token operator">=</span> m_program<span class="token operator">-&gt;</span><span class="token function">uniformLocation</span><span class="token punctuation">(</span><span class="token string">"lightPos"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token comment">// Setup our vertex buffer object.</span>
    m_Vbo<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_Vbo<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_Vbo<span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span>m_vPoints<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m_vPoints<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token comment">// Store the vertex attribute bindings for the program.</span>
    <span class="token function">setupVertexAttribs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token comment">// Light position is fixed.</span>
    m_program<span class="token operator">-&gt;</span><span class="token function">setUniformValue</span><span class="token punctuation">(</span>m_lightPosLoc<span class="token punctuation">,</span> <span class="token function">QVector3D</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    m_program<span class="token operator">-&gt;</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 
<span class="token keyword">void</span> <span class="token class-name">GLWindow</span><span class="token double-colon punctuation">::</span><span class="token function">paintGL</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">glClear</span><span class="token punctuation">(</span>GL_COLOR_BUFFER_BIT <span class="token operator">|</span> GL_DEPTH_BUFFER_BIT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glEnable</span><span class="token punctuation">(</span>GL_DEPTH_TEST<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glEnable</span><span class="token punctuation">(</span>GL_CULL_FACE<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    m_world<span class="token punctuation">.</span><span class="token function">setToIdentity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_world<span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span>m_xRot <span class="token operator">/</span> <span class="token number">16.0f</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_world<span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span>m_yRot <span class="token operator">/</span> <span class="token number">16.0f</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_world<span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span>m_zRot <span class="token operator">/</span> <span class="token number">16.0f</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    m_camera<span class="token punctuation">.</span><span class="token function">setToIdentity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_camera<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>m_camera_pos<span class="token punctuation">,</span> <span class="token function">QVector3D</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">QVector3D</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    m_program<span class="token operator">-&gt;</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_program<span class="token operator">-&gt;</span><span class="token function">setUniformValue</span><span class="token punctuation">(</span>m_projMatrixLoc<span class="token punctuation">,</span> m_proj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_program<span class="token operator">-&gt;</span><span class="token function">setUniformValue</span><span class="token punctuation">(</span>m_mvMatrixLoc<span class="token punctuation">,</span> m_camera <span class="token operator">*</span> m_world<span class="token punctuation">)</span><span class="token punctuation">;</span>
    QMatrix3x3 normalMatrix <span class="token operator">=</span> m_world<span class="token punctuation">.</span><span class="token function">normalMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_program<span class="token operator">-&gt;</span><span class="token function">setUniformValue</span><span class="token punctuation">(</span>m_normalMatrixLoc<span class="token punctuation">,</span> normalMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token function">glDrawArrays</span><span class="token punctuation">(</span>GL_TRIANGLES<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> m_vPoints<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    m_program<span class="token operator">-&gt;</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 
<span class="token keyword">void</span> <span class="token class-name">GLWindow</span><span class="token double-colon punctuation">::</span><span class="token function">resizeGL</span><span class="token punctuation">(</span><span class="token keyword">int</span> w<span class="token punctuation">,</span> <span class="token keyword">int</span> h<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    m_proj<span class="token punctuation">.</span><span class="token function">setToIdentity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_proj<span class="token punctuation">.</span><span class="token function">perspective</span><span class="token punctuation">(</span><span class="token number">45.0f</span><span class="token punctuation">,</span> <span class="token function">GLfloat</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span> <span class="token operator">/</span> h<span class="token punctuation">,</span> <span class="token number">0.01f</span><span class="token punctuation">,</span> <span class="token number">100.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>最后通过lookAt设置视角去显示。我把视角进行了可调，这样就能从不同视角来查看，效果如下。<br> <img src="https://images2.imgbox.com/5f/68/mrMZGRsT_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2_freeglutQt_158"></a>2. 通过freeglut和Qt的结合</h3> 
<p>freeglut是GLUT的开源替代库，里面很多函数，而且大多数人比较熟悉，所以用这个可能更受青睐。freeglut可以在<a href="http://freeglut.sourceforge.net" rel="nofollow">http://freeglut.sourceforge.net</a>下到，下载后通过cmake生成vs工程，然后就可以使用freeglut.lib和freeglut.dll库，同时需将GL目录下的头文件也拷到相应的目录下。</p> 
<p>还是一样的，加载stl文件并显示。不过这种方法对于鼠标或者键盘的操作等的处理就非常麻烦。而且不知道为啥，我显示的颜色和角度有点奇怪。关于灯光位置，视角，渲染，各种矩阵变换，还是有很多有待弄清楚的。</p> 
<p><img src="https://images2.imgbox.com/1c/94/l7Z2K6zT_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-cpp"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">Vertex</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">//定义三维图形的</span>
    <span class="token comment">//用于face结构体中</span>
    <span class="token keyword">float</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">;</span>
<span class="token punctuation">}</span> Vertex<span class="token punctuation">;</span>
 
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">Face</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">//多边形（三角形）面的结构体</span>
    <span class="token function">Face</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">vert_number</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">verts</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> vert_number<span class="token punctuation">;</span>        <span class="token comment">//记录顶点的个数</span>
    Vertex<span class="token operator">*</span><span class="token operator">*</span> verts<span class="token punctuation">;</span>          <span class="token comment">//这是一个面的所有 顶点数组（含有坐标）</span>
    <span class="token keyword">float</span> normal<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>         <span class="token comment">//记录点的法向量，分别是x，y，z三个方向</span>
    <span class="token comment">//注意点的法向量通过顶点的信息计算得到！</span>
    <span class="token comment">//对于obj模型如果我们已经得到了法线的信息</span>
    <span class="token comment">//那么就直接拿来用就好！</span>
<span class="token punctuation">}</span> Face<span class="token punctuation">;</span>
 
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">myMesh</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">//自定义mesh的结构体</span>
    <span class="token function">myMesh</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">vert_number</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">verts</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">face_number</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">faces</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">//自定义构造器</span>
    <span class="token keyword">int</span> vert_number<span class="token punctuation">;</span>        <span class="token comment">//总的顶点个数</span>
    Vertex<span class="token operator">*</span> verts<span class="token punctuation">;</span>          <span class="token comment">//定点数组</span>
    <span class="token keyword">int</span> face_number<span class="token punctuation">;</span>        <span class="token comment">//面的数目</span>
    Face<span class="token operator">*</span> faces<span class="token punctuation">;</span>
    vector<span class="token operator">&lt;</span>Vertex<span class="token operator">&gt;</span>point<span class="token punctuation">;</span>
<span class="token punctuation">}</span> myMesh<span class="token punctuation">;</span>
 
<span class="token keyword">void</span> <span class="token class-name">GLWin</span><span class="token double-colon punctuation">::</span><span class="token function">drawObj</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>m_mesh<span class="token operator">-&gt;</span>face_number <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> m_mesh<span class="token operator">-&gt;</span>face_number<span class="token punctuation">;</span>
 
    <span class="token keyword">float</span> bbox<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token punctuation">{<!-- --></span> <span class="token number">1.0E30F</span><span class="token punctuation">,</span> <span class="token number">1.0E30F</span><span class="token punctuation">,</span> <span class="token number">1.0E30F</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> <span class="token operator">-</span><span class="token number">1.0E30F</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0E30F</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0E30F</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
 
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> m_mesh<span class="token operator">-&gt;</span>vert_number<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        Vertex<span class="token operator">&amp;</span> vert <span class="token operator">=</span> m_mesh<span class="token operator">-&gt;</span>verts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>vert<span class="token punctuation">.</span>x <span class="token operator">&lt;</span> bbox<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            bbox<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> vert<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>vert<span class="token punctuation">.</span>x <span class="token operator">&gt;</span> bbox<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            bbox<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> vert<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
 
        <span class="token keyword">if</span> <span class="token punctuation">(</span>vert<span class="token punctuation">.</span>y <span class="token operator">&lt;</span> bbox<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            bbox<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> vert<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>vert<span class="token punctuation">.</span>y <span class="token operator">&gt;</span> bbox<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            bbox<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> vert<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
 
        <span class="token keyword">if</span> <span class="token punctuation">(</span>vert<span class="token punctuation">.</span>z <span class="token operator">&lt;</span> bbox<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            bbox<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> vert<span class="token punctuation">.</span>z<span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>vert<span class="token punctuation">.</span>z <span class="token operator">&gt;</span> bbox<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            bbox<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> vert<span class="token punctuation">.</span>z<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token comment">// Setup initial viewing scale</span>
    <span class="token keyword">float</span> dx <span class="token operator">=</span> bbox<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> bbox<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> dy <span class="token operator">=</span> bbox<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> bbox<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> dz <span class="token operator">=</span> bbox<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">-</span> bbox<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    scale <span class="token operator">=</span> <span class="token number">2.0</span> <span class="token operator">/</span> <span class="token function">sqrt</span><span class="token punctuation">(</span>dx <span class="token operator">*</span> dx <span class="token operator">+</span> dy <span class="token operator">*</span> dy <span class="token operator">+</span> dz <span class="token operator">*</span> dz<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
 
    <span class="token function">glPushMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glColor3f</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glScalef</span><span class="token punctuation">(</span>scale<span class="token punctuation">,</span> scale<span class="token punctuation">,</span> scale<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token function">glRotatef</span><span class="token punctuation">(</span>rotation<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glRotatef</span><span class="token punctuation">(</span>rotation<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glRotatef</span><span class="token punctuation">(</span>rotation<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> m_mesh<span class="token operator">-&gt;</span>face_number<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        Face<span class="token operator">&amp;</span> face <span class="token operator">=</span> m_mesh<span class="token operator">-&gt;</span>faces<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token function">glBegin</span><span class="token punctuation">(</span>GL_TRIANGLES<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glNormal3fv</span><span class="token punctuation">(</span>face<span class="token punctuation">.</span>normal<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> face<span class="token punctuation">.</span>vert_number<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            Vertex<span class="token operator">*</span> vert <span class="token operator">=</span> face<span class="token punctuation">.</span>verts<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token function">glVertex3f</span><span class="token punctuation">(</span>vert<span class="token operator">-&gt;</span>x<span class="token punctuation">,</span> vert<span class="token operator">-&gt;</span>y<span class="token punctuation">,</span> vert<span class="token operator">-&gt;</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">glEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token function">glPopMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 
<span class="token keyword">void</span> <span class="token class-name">GLWin</span><span class="token double-colon punctuation">::</span><span class="token function">initializeGL</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">glClear</span><span class="token punctuation">(</span>GL_COLOR_BUFFER_BIT <span class="token operator">|</span> GL_DEPTH_BUFFER_BIT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glClearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glutInitDisplayMode</span><span class="token punctuation">(</span>GLUT_DOUBLE <span class="token operator">|</span> GLUT_RGB <span class="token operator">|</span> GLUT_DEPTH<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glEnable</span><span class="token punctuation">(</span>GL_NORMALIZE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glEnable</span><span class="token punctuation">(</span>GL_DEPTH_TEST<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glutInitWindowSize</span><span class="token punctuation">(</span><span class="token number">600</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 
<span class="token keyword">void</span> <span class="token class-name">GLWin</span><span class="token double-colon punctuation">::</span><span class="token function">paintGL</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">glLoadIdentity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token function">glMatrixMode</span><span class="token punctuation">(</span>GL_MODELVIEW<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glLoadIdentity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token function">glLightfv</span><span class="token punctuation">(</span>GL_LIGHT0<span class="token punctuation">,</span> GL_POSITION<span class="token punctuation">,</span> light0_position<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token function">gluLookAt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token comment">//draw axis</span>
    <span class="token function">glPushMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glLineWidth</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glBegin</span><span class="token punctuation">(</span>GL_LINES<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glColor3f</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glVertex3f</span><span class="token punctuation">(</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glVertex3f</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token function">glBegin</span><span class="token punctuation">(</span>GL_LINES<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glColor3f</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glVertex3f</span><span class="token punctuation">(</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glVertex3f</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token function">glBegin</span><span class="token punctuation">(</span>GL_LINES<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glColor3f</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glVertex3f</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glVertex3f</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glPopMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    CLoadStlObj stlobj<span class="token punctuation">;</span>
    m_mesh <span class="token operator">=</span> stlobj<span class="token punctuation">.</span><span class="token function">ReaderOBj</span><span class="token punctuation">(</span><span class="token string">"head.obj"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">drawObj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token comment">// 设置光照信息</span>
    <span class="token keyword">static</span> GLfloat lmodel_ambient<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">1.0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">glLightModelfv</span><span class="token punctuation">(</span>GL_LIGHT_MODEL_AMBIENT<span class="token punctuation">,</span> lmodel_ambient<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glLightModeli</span><span class="token punctuation">(</span>GL_LIGHT_MODEL_LOCAL_VIEWER<span class="token punctuation">,</span> GL_TRUE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> GLfloat light0_diffuse<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    设置满散射
    <span class="token function">glLightfv</span><span class="token punctuation">(</span>GL_LIGHT0<span class="token punctuation">,</span> GL_DIFFUSE<span class="token punctuation">,</span> light0_diffuse<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glEnable</span><span class="token punctuation">(</span>GL_LIGHT0<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> GLfloat light1_diffuse<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1.0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">glLightfv</span><span class="token punctuation">(</span>GL_LIGHT1<span class="token punctuation">,</span> GL_DIFFUSE<span class="token punctuation">,</span> light1_diffuse<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glEnable</span><span class="token punctuation">(</span>GL_LIGHT1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glEnable</span><span class="token punctuation">(</span>GL_LIGHTING<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 
<span class="token keyword">void</span> <span class="token class-name">GLWin</span><span class="token double-colon punctuation">::</span><span class="token function">resizeGL</span><span class="token punctuation">(</span><span class="token keyword">int</span> width<span class="token punctuation">,</span> <span class="token keyword">int</span> height<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">glMatrixMode</span><span class="token punctuation">(</span>GL_PROJECTION<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glLoadIdentity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">gluPerspective</span><span class="token punctuation">(</span><span class="token number">45.0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>GLfloat<span class="token punctuation">)</span>width <span class="token operator">/</span> <span class="token punctuation">(</span>GLfloat<span class="token punctuation">)</span>height<span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">100.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token function">glMatrixMode</span><span class="token punctuation">(</span>GL_MODELVIEW<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glLoadIdentity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>方法1的工程代码可以在<a href="https://github.com/WelinLee/QtOpenGLDemo">https://github.com/WelinLee/QtOpenGLDemo</a>中找到，enjoy!</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/aa2c8b7a19718ee4f0db74a19c06de26/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Ubuntu20.04安装Nvidia显卡驱动教程</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a3eb65ef2283375ba09e56cfb5c73d3e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">ubuntu mysql密码忘记了怎么办，ubuntu怎么查看mysql密码</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>