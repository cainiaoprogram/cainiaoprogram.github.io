<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>贝叶斯变分推断 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="贝叶斯变分推断" />
<meta property="og:description" content="Variational Bayesian Inference Abstract 贝叶推断是统计学中的一个重要问题，也是许多机器学习方法中经常遇到的问题。贝叶斯推断已经被应用于各行各业。传统的贝叶斯技术需要通过积分来计算后验分布，而伴随着计算机的发展这一问题得到解决。在面对高维的参数空间时，基于蒙特卡洛抽样的方法难以直接评估或样本。而贝叶斯变分推断技术将后验推断问题巧妙地转化为优化问题进行求解，具有更好的收敛性和可扩展性。本文将对贝叶斯变分推断技术做出介绍。
1. Introduction 贝叶斯推断（Bayesian inference）是推论统计的一种方法，是统计学（特别是数理统计学）中很重要的技巧之一。它使用贝叶斯定理，在有更多证据及信息时，更新特定假设的概率。近些年来，贝叶斯推断在许多的领域中扮演者日益重要的角色，包括科学、工程学、哲学、医学、体育运动、法律等。
贝叶斯推断的关键是要确定统计模型的后验分布，此后模型将被用来对未知样本做出预测。然而由于积分的求解并容易（特别是在较为复杂的参数空间），在很多情形下，我们无法直接获得后验分布的理论解。这一点制约着基于贝叶斯的统计推断方法普遍的应用于各种问题。
近年来，随着计算机技术的发展，后验分布的近似计算问题取得了突破。其中基于马尔可夫的方法通过采样的方法使用随机化方法完成近似。然而，随着后验分布的复杂化，基于蒙特卡洛抽样的方法，特别是，马尔可夫链蒙特卡罗方法，如吉布斯抽样采取完全贝叶斯方法的统计推断复杂分布，难以直接评估或样本。而变分贝叶斯推断则是一个好的替代方法。变分贝叶斯提供了一个局部最优的精确后验的解析解。下面我们主要介绍贝叶斯变分推断的基本思想。
2. Method 变分推断方法的基本思想是通过使用已知简单分布来逼近需推断的复杂分布，并通过限制近似分布的类型，从而得到一种局部最优、但具有确定解的近似后验分布。在这一部分，我们将从问题的角度出发，介绍贝叶斯变分推断的具体流程。
2.1 Problem Formulation 给定一组数据 X = { x 1 , x 2 , , . . . , x n } \textbf{X} = \{x_1, x_2, , ..., x_n\} X={x1​,x2​,,...,xn​}，我们需要计算隐含变量 Z = { z 1 , z 2 , . . . , z m } \textbf{Z}=\{z_1, z_2, ..., z_m\} Z={z1​,z2​,...,zm​} 的后验分布 P ( Z ∣ X ) P(\textbf{Z} | \textbf{X}) P(Z∣X)，其中隐含变量 Z \textbf{Z} Z 可以是给定模型的未知参数，是不能观察到的。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/0c883d1c07c35c52b5e9c6e8f0de6a78/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-20T11:18:09+08:00" />
<meta property="article:modified_time" content="2023-02-20T11:18:09+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">贝叶斯变分推断</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="Variational_Bayesian_Inference_0"></a>Variational Bayesian Inference</h2> 
<h3><a id="Abstract_2"></a>Abstract</h3> 
<p>贝叶推断是统计学中的一个重要问题，也是许多机器学习方法中经常遇到的问题。贝叶斯推断已经被应用于各行各业。传统的贝叶斯技术需要通过积分来计算后验分布，而伴随着计算机的发展这一问题得到解决。在面对高维的参数空间时，基于蒙特卡洛抽样的方法难以直接评估或样本。而贝叶斯变分推断技术将后验推断问题巧妙地转化为优化问题进行求解，具有更好的收敛性和可扩展性。本文将对贝叶斯变分推断技术做出介绍。</p> 
<h3><a id="1_Introduction_6"></a>1. Introduction</h3> 
<p>贝叶斯推断（<em>Bayesian inference</em>）是推论统计的一种方法，是统计学（特别是数理统计学）中很重要的技巧之一。它使用贝叶斯定理，在有更多证据及信息时，更新特定假设的概率。近些年来，贝叶斯推断在许多的领域中扮演者日益重要的角色，包括科学、工程学、哲学、医学、体育运动、法律等。</p> 
<p>贝叶斯推断的关键是要确定统计模型的后验分布，此后模型将被用来对未知样本做出预测。然而由于积分的求解并容易（特别是在较为复杂的参数空间），在很多情形下，我们无法直接获得后验分布的理论解。这一点制约着基于贝叶斯的统计推断方法普遍的应用于各种问题。</p> 
<p>近年来，随着计算机技术的发展，后验分布的近似计算问题取得了突破。其中基于马尔可夫的方法通过采样的方法使用随机化方法完成近似。然而，随着后验分布的复杂化，基于蒙特卡洛抽样的方法，特别是，马尔可夫链蒙特卡罗方法，如吉布斯抽样采取完全贝叶斯方法的统计推断复杂分布，难以直接评估或样本。而变分贝叶斯推断则是一个好的替代方法。变分贝叶斯提供了一个局部最优的精确后验的解析解。下面我们主要介绍贝叶斯变分推断的基本思想。</p> 
<h3><a id="2_Method_14"></a>2. Method</h3> 
<p>变分推断方法的基本思想是通过使用已知简单分布来逼近需推断的复杂分布，并通过限制近似分布的类型，从而得到一种局部最优、但具有确定解的近似后验分布。在这一部分，我们将从问题的角度出发，介绍贝叶斯变分推断的具体流程。</p> 
<h4><a id="21_Problem_Formulation_18"></a>2.1 Problem Formulation</h4> 
<p>给定一组数据 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         X 
        
       
         = 
        
       
         { 
        
        
        
          x 
         
        
          1 
         
        
       
         , 
        
        
        
          x 
         
        
          2 
         
        
       
         , 
        
       
         , 
        
       
         . 
        
       
         . 
        
       
         . 
        
       
         , 
        
        
        
          x 
         
        
          n 
         
        
       
         } 
        
       
      
        \textbf{X} = \{x_1, x_2, , ..., x_n\} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6861em;"></span><span class="mord text"><span class="mord textbf">X</span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">{<!-- --></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">}</span></span></span></span></span>，我们需要计算隐含变量 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         Z 
        
       
         = 
        
       
         { 
        
        
        
          z 
         
        
          1 
         
        
       
         , 
        
        
        
          z 
         
        
          2 
         
        
       
         , 
        
       
         . 
        
       
         . 
        
       
         . 
        
       
         , 
        
        
        
          z 
         
        
          m 
         
        
       
         } 
        
       
      
        \textbf{Z}=\{z_1, z_2, ..., z_m\} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6861em;"></span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">{<!-- --></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.044em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.044em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.044em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.044em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.044em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.044em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">}</span></span></span></span></span> 的后验分布 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         P 
        
       
         ( 
        
       
         Z 
        
       
         ∣ 
        
       
         X 
        
       
         ) 
        
       
      
        P(\textbf{Z} | \textbf{X}) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mord">∣</span><span class="mord text"><span class="mord textbf">X</span></span><span class="mclose">)</span></span></span></span></span>，其中隐含变量 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         Z 
        
       
      
        \textbf{Z} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6861em;"></span><span class="mord text"><span class="mord textbf">Z</span></span></span></span></span></span> 可以是给定模型的未知参数，是不能观察到的。</p> 
<h4><a id="22_Bayes_Theorem_22"></a>2.2 Bayes’ Theorem</h4> 
<p>对于以上问题，很自然的，我们尝试使用贝叶斯定理求解隐变量的后验分布：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          P 
         
        
          ( 
         
        
          Z 
         
        
          ∣ 
         
        
          X 
         
        
          ) 
         
        
          = 
         
         
          
          
            P 
           
          
            ( 
           
          
            X 
           
          
            ∣ 
           
          
            Z 
           
          
            ) 
           
          
            P 
           
          
            ( 
           
          
            Z 
           
          
            ) 
           
          
          
          
            P 
           
          
            ( 
           
          
            X 
           
          
            ) 
           
          
         
        
       
         P(\textbf{Z}|\textbf{X})=\frac{P(\textbf{X}|\textbf{Z})P(\textbf{Z})}{P(\textbf{X})} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mord">∣</span><span class="mord text"><span class="mord textbf">X</span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.363em; vertical-align: -0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.427em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">X</span></span><span class="mclose">)</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">X</span></span><span class="mord">∣</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.936em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span><br> 其中 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         P 
        
       
         ( 
        
       
         X 
        
       
         ) 
        
       
         = 
        
        
        
          ∫ 
         
        
          Z 
         
        
       
         P 
        
       
         ( 
        
       
         X 
        
       
         , 
        
       
         Z 
        
       
         ) 
        
       
         d 
        
       
         Z 
        
       
      
        P(\textbf{X})=\int_\textbf{Z} P(\textbf{X},\textbf{Z})d\textbf{Z} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">X</span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1.1608em; vertical-align: -0.3558em;"></span><span class="mop"><span class="mop op-symbol small-op" style="margin-right: 0.1945em; position: relative; top: -0.0006em;">∫</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1245em;"><span class="" style="top: -2.3442em; margin-left: -0.1945em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord textbf mtight">Z</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.3558em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">X</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mclose">)</span><span class="mord mathnormal">d</span><span class="mord text"><span class="mord textbf">Z</span></span></span></span></span></span>，为边缘密度， <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         P 
        
       
         ( 
        
       
         X 
        
       
         , 
        
       
         Z 
        
       
         ) 
        
       
      
        P(\textbf{X},\textbf{Z}) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">X</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mclose">)</span></span></span></span></span> 表示样本 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         X 
        
       
      
        \textbf{X} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6861em;"></span><span class="mord text"><span class="mord textbf">X</span></span></span></span></span></span> 与隐变量 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         Z 
        
       
      
        \textbf{Z} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6861em;"></span><span class="mord text"><span class="mord textbf">Z</span></span></span></span></span></span> 的联合分布。我们注意到分子部分的样本的似然函数 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         P 
        
       
         ( 
        
       
         X 
        
       
         ∣ 
        
       
         Z 
        
       
         ) 
        
       
      
        P(\textbf{X}|\textbf{Z}) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">X</span></span><span class="mord">∣</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mclose">)</span></span></span></span></span> 与隐变量的先验 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         P 
        
       
         ( 
        
       
         Z 
        
       
         ) 
        
       
      
        P(\textbf{Z}) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mclose">)</span></span></span></span></span> 在给定了模型的假设的条件下很容易求得。我们重点关注分母——对于边缘分布 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         P 
        
       
         ( 
        
       
         X 
        
       
         ) 
        
       
      
        P(\textbf{X}) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">X</span></span><span class="mclose">)</span></span></span></span></span> 的计算。由于积分计算的复杂性，很多情况下，我们无法得到积分的显式表达，因而就无法计算后验分布，进行贝叶斯推断。</p> 
<h4><a id="23_Approximate_Inference_30"></a>2.3 Approximate Inference</h4> 
<p>对于后验分布，虽然难以直接得到其精确解，但我们仍可以采用近似估计的方法得到其近似解，即：我们构造一个分布 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         Q 
        
       
         ( 
        
       
         Z 
        
       
         ) 
        
       
      
        Q(\textbf{Z}) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mclose">)</span></span></span></span></span> 使得：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          P 
         
        
          ( 
         
        
          Z 
         
        
          ∣ 
         
        
          X 
         
        
          ) 
         
        
          ≈ 
         
        
          Q 
         
        
          ( 
         
        
          Z 
         
        
          ) 
         
        
       
         P(\textbf{Z}|\textbf{X})\approx Q(\textbf{Z}) 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mord">∣</span><span class="mord text"><span class="mord textbf">X</span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mclose">)</span></span></span></span></span></span><br> 其中 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         Q 
        
       
         ( 
        
       
         Z 
        
       
         ) 
        
       
      
        Q(\textbf{Z}) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mclose">)</span></span></span></span></span> 称为变分分布（<em>variational distribution</em>），通常来说是几类比较简单的分布族（例如：高斯分布族）。举个例子，如图一所示，绿色的分布为真实的分布 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         P 
        
       
      
        P 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span></span></span></span></span> ，我们所希望的是找到一个分布 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         Q 
        
       
      
        Q 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8778em; vertical-align: -0.1944em;"></span><span class="mord mathnormal">Q</span></span></span></span></span>（其他颜色） ，来近似估计分布<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         P 
        
       
      
        P 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span></span></span></span></span>：</p> 
<p><img src="https://images2.imgbox.com/3d/7a/HK45QNYF_o.png" alt="img"></p> 
<center>
  图一：近似估计 
 <center> 
 </center> 
</center> 
<p>由此，我们就将求解后验分布问题转化为了近似分布问题。那么，如何衡量两个分布之间的差异呢？</p> 
<h4><a id="24_KullbackLeibler_Divergence_44"></a>2.4 Kullback-Leibler Divergence</h4> 
<p>我们引入KL散度（<em>Kullback-Leibler Divergence</em>） 来衡量两个分布之间的差异。定义分布<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         Q 
        
       
         ( 
        
       
         Z 
        
       
         ) 
        
       
      
        Q(\textbf{Z}) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mclose">)</span></span></span></span></span> 与分布 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         P 
        
       
         ( 
        
       
         Z 
        
       
         ∣ 
        
       
         X 
        
       
         ) 
        
       
      
        P(\textbf{Z}|\textbf{X}) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mord">∣</span><span class="mord text"><span class="mord textbf">X</span></span><span class="mclose">)</span></span></span></span></span> 间的KL散度如下：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           D 
          
          
          
            K 
           
          
            L 
           
          
         
        
          ( 
         
        
          Q 
         
        
          ( 
         
        
          Z 
         
        
          ) 
         
        
          ∣ 
         
        
          ∣ 
         
        
          P 
         
        
          ( 
         
        
          Z 
         
        
          ∣ 
         
        
          X 
         
        
          ) 
         
        
          ) 
         
        
          = 
         
         
         
           ∑ 
          
         
           Z 
          
         
        
          Q 
         
        
          ( 
         
        
          Z 
         
        
          ) 
         
        
          log 
         
        
          ⁡ 
         
         
          
          
            Q 
           
          
            ( 
           
          
            Z 
           
          
            ) 
           
          
          
          
            P 
           
          
            ( 
           
          
            Z 
           
          
            ∣ 
           
          
            X 
           
          
            ) 
           
          
         
        
       
         D_{KL}\Big(Q(\textbf{Z})||P(\textbf{Z}|\textbf{X})\Big)=\sum_{\textbf{Z}}Q(\textbf{Z})\log \frac{Q(\textbf{Z})}{P(\textbf{Z}|\textbf{X})} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.8em; vertical-align: -0.65em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0278em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3283em;"><span class="" style="top: -2.55em; margin-left: -0.0278em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0715em;">K</span><span class="mord mathnormal mtight">L</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="delimsizing size2">(</span></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mclose">)</span><span class="mord">∣∣</span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mord">∣</span><span class="mord text"><span class="mord textbf">X</span></span><span class="mclose">)</span><span class="mord"><span class="delimsizing size2">)</span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.7233em; vertical-align: -1.2963em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05em;"><span class="" style="top: -1.8537em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord textbf mtight">Z</span></span></span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.2963em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">lo<span style="margin-right: 0.0139em;">g</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.427em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mord">∣</span><span class="mord text"><span class="mord textbf">X</span></span><span class="mclose">)</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.936em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span><br> 注意，KL散度（又称相互熵）是一种不对称的度量标准，即：<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          D 
         
         
         
           K 
          
         
           L 
          
         
        
       
         ( 
        
       
         Q 
        
       
         ∣ 
        
       
         ∣ 
        
       
         P 
        
       
         ) 
        
       
         ≠ 
        
        
        
          D 
         
         
         
           K 
          
         
           L 
          
         
        
       
         ( 
        
       
         P 
        
       
         ∣ 
        
       
         ∣ 
        
       
         Q 
        
       
         ) 
        
       
      
        D_{KL}(Q||P)\ne D_{KL}(P||Q) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0278em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3283em;"><span class="" style="top: -2.55em; margin-left: -0.0278em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0715em;">K</span><span class="mord mathnormal mtight">L</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">Q</span><span class="mord">∣∣</span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel"><span class="mrel"><span class="mord vbox"><span class="thinbox"><span class="rlap"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="inner"><span class="mord"><span class="mrel"></span></span></span><span class="fix"></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0278em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3283em;"><span class="" style="top: -2.55em; margin-left: -0.0278em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0715em;">K</span><span class="mord mathnormal mtight">L</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mord">∣∣</span><span class="mord mathnormal">Q</span><span class="mclose">)</span></span></span></span></span>。并且KL散度的值是非负的，当两个分布相同时，即：<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         Q 
        
       
         ( 
        
       
         Z 
        
       
         ) 
        
       
         = 
        
       
         P 
        
       
         ( 
        
       
         Z 
        
       
         ∣ 
        
       
         X 
        
       
         ) 
        
       
      
        Q(\textbf{Z})=P(\textbf{Z}|\textbf{X}) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mord">∣</span><span class="mord text"><span class="mord textbf">X</span></span><span class="mclose">)</span></span></span></span></span> 时，KL散度的值为0。</p> 
<p>更进一步的，我们将公式 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         ( 
        
       
         1 
        
       
         ) 
        
       
      
        (1) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span> 代入上式消去后验分布，得到：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           D 
          
          
          
            K 
           
          
            L 
           
          
         
        
          ( 
         
        
          Q 
         
        
          ( 
         
        
          Z 
         
        
          ) 
         
        
          ∣ 
         
        
          ∣ 
         
        
          P 
         
        
          ( 
         
        
          Z 
         
        
          ∣ 
         
        
          X 
         
        
          ) 
         
        
          ) 
         
        
          = 
         
         
         
           ∑ 
          
         
           Z 
          
         
        
          Q 
         
        
          ( 
         
        
          Z 
         
        
          ) 
         
        
          [ 
         
        
          log 
         
        
          ⁡ 
         
        
          Q 
         
        
          ( 
         
        
          Z 
         
        
          ) 
         
        
          − 
         
        
          log 
         
        
          ⁡ 
         
        
          P 
         
        
          ( 
         
        
          Z 
         
        
          , 
         
        
          X 
         
        
          ) 
         
        
          ] 
         
        
          + 
         
         
         
           ∑ 
          
         
           Z 
          
         
        
          Q 
         
        
          ( 
         
        
          Z 
         
        
          ) 
         
        
          [ 
         
        
          log 
         
        
          ⁡ 
         
        
          P 
         
        
          ( 
         
        
          X 
         
        
          ) 
         
        
          ] 
         
        
       
         D_{KL}\Big(Q(\textbf{Z})||P(\textbf{Z}|\textbf{X})\Big)=\sum_{\textbf{Z}}Q(\textbf{Z})\Big[\log Q(\textbf{Z})- \log P(\textbf{Z},\textbf{X})\Big]+\sum_{\textbf{Z}}Q(\textbf{Z})\Big[\log P(\textbf{X})\Big] 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.8em; vertical-align: -0.65em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0278em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3283em;"><span class="" style="top: -2.55em; margin-left: -0.0278em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0715em;">K</span><span class="mord mathnormal mtight">L</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="delimsizing size2">(</span></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mclose">)</span><span class="mord">∣∣</span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mord">∣</span><span class="mord text"><span class="mord textbf">X</span></span><span class="mclose">)</span><span class="mord"><span class="delimsizing size2">)</span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.4463em; vertical-align: -1.2963em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05em;"><span class="" style="top: -1.8537em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord textbf mtight">Z</span></span></span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.2963em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mclose">)</span><span class="mord"><span class="delimsizing size2">[</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">lo<span style="margin-right: 0.0139em;">g</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1.8em; vertical-align: -0.65em;"></span><span class="mop">lo<span style="margin-right: 0.0139em;">g</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord text"><span class="mord textbf">X</span></span><span class="mclose">)</span><span class="mord"><span class="delimsizing size2">]</span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 2.4463em; vertical-align: -1.2963em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05em;"><span class="" style="top: -1.8537em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord textbf mtight">Z</span></span></span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.2963em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mclose">)</span><span class="mord"><span class="delimsizing size2">[</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">lo<span style="margin-right: 0.0139em;">g</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">X</span></span><span class="mclose">)</span><span class="mord"><span class="delimsizing size2">]</span></span></span></span></span></span></span><br> 我们注意到等式右边第二项 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         P 
        
       
         ( 
        
       
         X 
        
       
         ) 
        
       
      
        P(\textbf{X}) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">X</span></span><span class="mclose">)</span></span></span></span></span> 对于 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         Z 
        
       
      
        \textbf{Z} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6861em;"></span><span class="mord text"><span class="mord textbf">Z</span></span></span></span></span></span> 的求和来讲可以看作常量，并且 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          ∑ 
         
        
          Z 
         
        
       
         Q 
        
       
         ( 
        
       
         Z 
        
       
         ) 
        
       
         = 
        
       
         1 
        
       
      
        \sum_{\textbf{Z}}Q(\textbf{Z})=1 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.0497em; vertical-align: -0.2997em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position: relative; top: 0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1806em;"><span class="" style="top: -2.4003em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord textbf mtight">Z</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2997em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">1</span></span></span></span></span>。故上市可以简化为：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           D 
          
          
          
            K 
           
          
            L 
           
          
         
        
          ( 
         
        
          Q 
         
        
          ( 
         
        
          Z 
         
        
          ) 
         
        
          ∣ 
         
        
          ∣ 
         
        
          P 
         
        
          ( 
         
        
          Z 
         
        
          ∣ 
         
        
          X 
         
        
          ) 
         
        
          ) 
         
        
          = 
         
         
         
           ∑ 
          
         
           Z 
          
         
        
          Q 
         
        
          ( 
         
        
          Z 
         
        
          ) 
         
        
          [ 
         
        
          log 
         
        
          ⁡ 
         
        
          Q 
         
        
          ( 
         
        
          Z 
         
        
          ) 
         
        
          − 
         
        
          log 
         
        
          ⁡ 
         
        
          P 
         
        
          ( 
         
        
          Z 
         
        
          , 
         
        
          X 
         
        
          ) 
         
        
          ] 
         
        
          + 
         
        
          log 
         
        
          ⁡ 
         
        
          P 
         
        
          ( 
         
        
          X 
         
        
          ) 
         
        
       
         D_{KL}\Big(Q(\textbf{Z})||P(\textbf{Z}|\textbf{X})\Big)=\sum_{\textbf{Z}}Q(\textbf{Z})\Big[\log Q(\textbf{Z})- \log P(\textbf{Z},\textbf{X})\Big]+\log P(\textbf{X}) 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.8em; vertical-align: -0.65em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0278em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3283em;"><span class="" style="top: -2.55em; margin-left: -0.0278em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0715em;">K</span><span class="mord mathnormal mtight">L</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="delimsizing size2">(</span></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mclose">)</span><span class="mord">∣∣</span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mord">∣</span><span class="mord text"><span class="mord textbf">X</span></span><span class="mclose">)</span><span class="mord"><span class="delimsizing size2">)</span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.4463em; vertical-align: -1.2963em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05em;"><span class="" style="top: -1.8537em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord textbf mtight">Z</span></span></span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.2963em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mclose">)</span><span class="mord"><span class="delimsizing size2">[</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">lo<span style="margin-right: 0.0139em;">g</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1.8em; vertical-align: -0.65em;"></span><span class="mop">lo<span style="margin-right: 0.0139em;">g</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord text"><span class="mord textbf">X</span></span><span class="mclose">)</span><span class="mord"><span class="delimsizing size2">]</span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mop">lo<span style="margin-right: 0.0139em;">g</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">X</span></span><span class="mclose">)</span></span></span></span></span></span><br> 我们移项可以得到：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          log 
         
        
          ⁡ 
         
        
          P 
         
        
          ( 
         
        
          X 
         
        
          ) 
         
        
          = 
         
         
         
           D 
          
          
          
            K 
           
          
            L 
           
          
         
        
          ( 
         
        
          Q 
         
        
          ( 
         
        
          Z 
         
        
          ) 
         
        
          ∣ 
         
        
          ∣ 
         
        
          P 
         
        
          ( 
         
        
          Z 
         
        
          ∣ 
         
        
          X 
         
        
          ) 
         
        
          ) 
         
        
          + 
         
         
         
           ∑ 
          
         
           Z 
          
         
        
          Q 
         
        
          ( 
         
        
          Z 
         
        
          ) 
         
        
          [ 
         
        
          log 
         
        
          ⁡ 
         
        
          P 
         
        
          ( 
         
        
          Z 
         
        
          , 
         
        
          X 
         
        
          ) 
         
        
          − 
         
        
          log 
         
        
          ⁡ 
         
        
          Q 
         
        
          ( 
         
        
          Z 
         
        
          ) 
         
        
          ] 
         
        
       
         \log P(\textbf{X})= D_{KL}\Big(Q(\textbf{Z})||P(\textbf{Z}|\textbf{X})\Big)+\sum_{\textbf{Z}}Q(\textbf{Z})\Big[\log P(\textbf{Z},\textbf{X})-\log Q(\textbf{Z})\Big] 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mop">lo<span style="margin-right: 0.0139em;">g</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">X</span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1.8em; vertical-align: -0.65em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0278em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3283em;"><span class="" style="top: -2.55em; margin-left: -0.0278em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0715em;">K</span><span class="mord mathnormal mtight">L</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="delimsizing size2">(</span></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mclose">)</span><span class="mord">∣∣</span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mord">∣</span><span class="mord text"><span class="mord textbf">X</span></span><span class="mclose">)</span><span class="mord"><span class="delimsizing size2">)</span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 2.4463em; vertical-align: -1.2963em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05em;"><span class="" style="top: -1.8537em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord textbf mtight">Z</span></span></span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.2963em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mclose">)</span><span class="mord"><span class="delimsizing size2">[</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">lo<span style="margin-right: 0.0139em;">g</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord text"><span class="mord textbf">X</span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1.8em; vertical-align: -0.65em;"></span><span class="mop">lo<span style="margin-right: 0.0139em;">g</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mclose">)</span><span class="mord"><span class="delimsizing size2">]</span></span></span></span></span></span></span><br> 在上式中，在给定了隐变量 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         Z 
        
       
      
        \textbf{Z} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6861em;"></span><span class="mord text"><span class="mord textbf">Z</span></span></span></span></span></span> 之后，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         P 
        
       
         ( 
        
       
         X 
        
       
         ) 
        
       
      
        P(\textbf{X}) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">X</span></span><span class="mclose">)</span></span></span></span></span> 是恒定。由于 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          D 
         
         
         
           K 
          
         
           L 
          
         
        
       
         ( 
        
       
         Q 
        
       
         ( 
        
       
         Z 
        
       
         ) 
        
       
         ∣ 
        
       
         ∣ 
        
       
         P 
        
       
         ( 
        
       
         Z 
        
       
         ∣ 
        
       
         X 
        
       
         ) 
        
       
         ) 
        
       
         &gt; 
        
       
         = 
        
       
         0 
        
       
      
        D_{KL}\Big(Q(\textbf{Z})||P(\textbf{Z}|\textbf{X})\Big)&gt;=0 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.8em; vertical-align: -0.65em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0278em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3283em;"><span class="" style="top: -2.55em; margin-left: -0.0278em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0715em;">K</span><span class="mord mathnormal mtight">L</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="delimsizing size2">(</span></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mclose">)</span><span class="mord">∣∣</span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mord">∣</span><span class="mord text"><span class="mord textbf">X</span></span><span class="mclose">)</span><span class="mord"><span class="delimsizing size2">)</span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">&gt;=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">0</span></span></span></span></span>，因而很自然的我们可以得到 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         log 
        
       
         ⁡ 
        
       
         P 
        
       
         ( 
        
       
         X 
        
       
         ) 
        
       
      
        \log P(\textbf{X}) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mop">lo<span style="margin-right: 0.0139em;">g</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">X</span></span><span class="mclose">)</span></span></span></span></span> 的下界 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          ∑ 
         
        
          Z 
         
        
       
         Q 
        
       
         ( 
        
       
         Z 
        
       
         ) 
        
       
         [ 
        
       
         log 
        
       
         ⁡ 
        
       
         P 
        
       
         ( 
        
       
         Z 
        
       
         , 
        
       
         X 
        
       
         ) 
        
       
         − 
        
       
         log 
        
       
         ⁡ 
        
       
         Q 
        
       
         ( 
        
       
         Z 
        
       
         ) 
        
       
         ] 
        
       
      
        \sum_{\textbf{Z}}Q(\textbf{Z})\Big[\log P(\textbf{Z},\textbf{X})-\log Q(\textbf{Z})\Big] 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.8em; vertical-align: -0.65em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position: relative; top: 0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1806em;"><span class="" style="top: -2.4003em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord textbf mtight">Z</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2997em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mclose">)</span><span class="mord"><span class="delimsizing size2">[</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">lo<span style="margin-right: 0.0139em;">g</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord text"><span class="mord textbf">X</span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1.8em; vertical-align: -0.65em;"></span><span class="mop">lo<span style="margin-right: 0.0139em;">g</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mclose">)</span><span class="mord"><span class="delimsizing size2">]</span></span></span></span></span></span>，在期望最大化框架下 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         log 
        
       
         ⁡ 
        
       
         P 
        
       
         ( 
        
       
         X 
        
       
         ) 
        
       
      
        \log P(\textbf{X}) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mop">lo<span style="margin-right: 0.0139em;">g</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">X</span></span><span class="mclose">)</span></span></span></span></span> 又被称为 <em>log-evidence</em>，而其下界又称<em>ELBO</em>（<em>Evidence Lower Boundary</em>）。</p> 
<p>我们的目标——最小化KL散度可以转化为最大化 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          ∑ 
         
        
          Z 
         
        
       
         Q 
        
       
         ( 
        
       
         Z 
        
       
         ) 
        
       
         [ 
        
       
         log 
        
       
         ⁡ 
        
       
         P 
        
       
         ( 
        
       
         Z 
        
       
         , 
        
       
         X 
        
       
         ) 
        
       
         − 
        
       
         log 
        
       
         ⁡ 
        
       
         Q 
        
       
         ( 
        
       
         Z 
        
       
         ) 
        
       
         ] 
        
       
      
        \sum_{\textbf{Z}}Q(\textbf{Z})\Big[\log P(\textbf{Z},\textbf{X})-\log Q(\textbf{Z})\Big] 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.8em; vertical-align: -0.65em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position: relative; top: 0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1806em;"><span class="" style="top: -2.4003em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord textbf mtight">Z</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2997em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mclose">)</span><span class="mord"><span class="delimsizing size2">[</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">lo<span style="margin-right: 0.0139em;">g</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord text"><span class="mord textbf">X</span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1.8em; vertical-align: -0.65em;"></span><span class="mop">lo<span style="margin-right: 0.0139em;">g</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mclose">)</span><span class="mord"><span class="delimsizing size2">]</span></span></span></span></span></span>：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
          
          
            arg 
           
          
            ⁡ 
           
          
            min 
           
          
            ⁡ 
           
          
         
           Q 
          
         
         
         
           D 
          
          
          
            K 
           
          
            L 
           
          
         
        
          ( 
         
        
          Q 
         
        
          ( 
         
        
          Z 
         
        
          ) 
         
        
          ∣ 
         
        
          ∣ 
         
        
          P 
         
        
          ( 
         
        
          Z 
         
        
          ∣ 
         
        
          X 
         
        
          ) 
         
        
          ) 
         
        
          ↔ 
         
         
          
          
            arg 
           
          
            ⁡ 
           
          
            max 
           
          
            ⁡ 
           
          
         
           Q 
          
         
         
         
           ∑ 
          
         
           Z 
          
         
        
          Q 
         
        
          ( 
         
        
          Z 
         
        
          ) 
         
        
          [ 
         
        
          log 
         
        
          ⁡ 
         
        
          P 
         
        
          ( 
         
        
          Z 
         
        
          , 
         
        
          X 
         
        
          ) 
         
        
          − 
         
        
          log 
         
        
          ⁡ 
         
        
          Q 
         
        
          ( 
         
        
          Z 
         
        
          ) 
         
        
          ] 
         
        
       
         \mathop{\arg \min}\limits_{Q} D_{KL}\Big(Q(\textbf{Z})||P(\textbf{Z}|\textbf{X})\Big)\leftrightarrow\mathop{\arg \max}\limits_{Q}\sum_{\textbf{Z}}Q(\textbf{Z})\Big[\log P(\textbf{Z},\textbf{X})-\log Q(\textbf{Z})\Big] 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 2.2249em; vertical-align: -1.0749em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.6679em;"><span class="" style="top: -2.1612em; margin-left: 0em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">Q</span></span></span></span><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class=""><span class="mop"><span class="mop">ar<span style="margin-right: 0.0139em;">g</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">min</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.0749em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0278em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3283em;"><span class="" style="top: -2.55em; margin-left: -0.0278em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0715em;">K</span><span class="mord mathnormal mtight">L</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="delimsizing size2">(</span></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mclose">)</span><span class="mord">∣∣</span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mord">∣</span><span class="mord text"><span class="mord textbf">X</span></span><span class="mclose">)</span><span class="mord"><span class="delimsizing size2">)</span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">↔</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.4463em; vertical-align: -1.2963em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.4306em;"><span class="" style="top: -2.1612em; margin-left: 0em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">Q</span></span></span></span><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class=""><span class="mop"><span class="mop">ar<span style="margin-right: 0.0139em;">g</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">max</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.0749em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05em;"><span class="" style="top: -1.8537em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord textbf mtight">Z</span></span></span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.2963em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mclose">)</span><span class="mord"><span class="delimsizing size2">[</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">lo<span style="margin-right: 0.0139em;">g</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord text"><span class="mord textbf">X</span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1.8em; vertical-align: -0.65em;"></span><span class="mop">lo<span style="margin-right: 0.0139em;">g</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mclose">)</span><span class="mord"><span class="delimsizing size2">]</span></span></span></span></span></span></span></p> 
<h4><a id="25_Mean_field_approximation_71"></a>2.5 Mean field approximation</h4> 
<p>我们可以借助平均场（<em>Mean field</em>）的思想简化上述目标的计算。平均场认为构成变分分布 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         Q 
        
       
         ( 
        
       
         Z 
        
       
         ) 
        
       
      
        Q(\textbf{Z}) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mclose">)</span></span></span></span></span> 的隐变量相互之间时独立的，即：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          Q 
         
        
          ( 
         
        
          Z 
         
        
          ) 
         
        
          = 
         
         
         
           ∏ 
          
          
          
            i 
           
          
            = 
           
          
         
           m 
          
         
        
          Q 
         
        
          ( 
         
         
         
           z 
          
         
           i 
          
         
        
          ) 
         
        
       
         Q(\textbf{Z})=\prod_{i=}^{m}Q(z_i) 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.9291em; vertical-align: -1.2777em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.6514em;"><span class="" style="top: -1.8723em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span></span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∏</span></span></span><span class="" style="top: -4.3em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.2777em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.044em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em;"><span class="" style="top: -2.55em; margin-left: -0.044em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></span><br> 我们将其带入ELBO的公式得：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          E 
         
        
          L 
         
        
          B 
         
        
          O 
         
        
          = 
         
         
         
           ∑ 
          
         
           Z 
          
         
         
         
           ∏ 
          
          
          
            i 
           
          
            = 
           
          
            1 
           
          
         
           m 
          
         
        
          Q 
         
        
          ( 
         
         
         
           z 
          
         
           i 
          
         
        
          ) 
         
        
          [ 
         
        
          log 
         
        
          ⁡ 
         
        
          P 
         
        
          ( 
         
         
         
           z 
          
         
           i 
          
         
        
          , 
         
        
          X 
         
        
          ) 
         
        
          ] 
         
        
          − 
         
         
         
           ∑ 
          
         
           Z 
          
         
         
         
           ∏ 
          
          
          
            i 
           
          
            = 
           
          
            1 
           
          
         
           m 
          
         
        
          Q 
         
        
          ( 
         
         
         
           z 
          
         
           i 
          
         
        
          ) 
         
        
          [ 
         
        
          log 
         
        
          ⁡ 
         
        
          Q 
         
        
          ( 
         
         
         
           z 
          
         
           i 
          
         
        
          ) 
         
        
          ] 
         
        
       
         ELBO=\sum_{\textbf{Z}}\prod_{i=1}^{m}Q(z_i)\Big[\log P(z_i,\textbf{X})\Big]-\sum_{\textbf{Z}}\prod_{i=1}^{m}Q(z_i)\Big[\log Q(z_i)\Big] 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.0576em;">E</span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right: 0.0278em;">BO</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.9477em; vertical-align: -1.2963em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05em;"><span class="" style="top: -1.8537em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord textbf mtight">Z</span></span></span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.2963em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.6514em;"><span class="" style="top: -1.8723em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∏</span></span></span><span class="" style="top: -4.3em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.2777em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.044em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em;"><span class="" style="top: -2.55em; margin-left: -0.044em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span class="delimsizing size2">[</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">lo<span style="margin-right: 0.0139em;">g</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.044em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em;"><span class="" style="top: -2.55em; margin-left: -0.044em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord text"><span class="mord textbf">X</span></span><span class="mclose">)</span><span class="mord"><span class="delimsizing size2">]</span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 2.9477em; vertical-align: -1.2963em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05em;"><span class="" style="top: -1.8537em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord textbf mtight">Z</span></span></span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.2963em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.6514em;"><span class="" style="top: -1.8723em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∏</span></span></span><span class="" style="top: -4.3em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.2777em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.044em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em;"><span class="" style="top: -2.55em; margin-left: -0.044em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span class="delimsizing size2">[</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">lo<span style="margin-right: 0.0139em;">g</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.044em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em;"><span class="" style="top: -2.55em; margin-left: -0.044em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span class="delimsizing size2">]</span></span></span></span></span></span></span><br> 进一步的，我们可以利用条件概率公式对隐变量和观测值的联合概率进行展开：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          E 
         
        
          L 
         
        
          B 
         
        
          O 
         
        
          = 
         
         
         
           ∑ 
          
         
           Z 
          
         
         
         
           ∏ 
          
          
          
            i 
           
          
            = 
           
          
            1 
           
          
         
           m 
          
         
        
          Q 
         
        
          ( 
         
         
         
           z 
          
         
           i 
          
         
        
          ) 
         
        
          [ 
         
        
          log 
         
        
          ⁡ 
         
        
          P 
         
        
          ( 
         
         
         
           z 
          
         
           i 
          
         
        
          ∣ 
         
        
          X 
         
        
          ) 
         
        
          ] 
         
        
          + 
         
         
         
           ∑ 
          
         
           Z 
          
         
         
         
           ∏ 
          
          
          
            i 
           
          
            = 
           
          
            1 
           
          
         
           m 
          
         
        
          Q 
         
        
          ( 
         
         
         
           z 
          
         
           i 
          
         
        
          ) 
         
        
          [ 
         
        
          log 
         
        
          ⁡ 
         
        
          P 
         
        
          ( 
         
        
          X 
         
        
          ) 
         
        
          ] 
         
        
          − 
         
         
         
           ∑ 
          
         
           Z 
          
         
         
         
           ∏ 
          
          
          
            i 
           
          
            = 
           
          
            1 
           
          
         
           m 
          
         
        
          Q 
         
        
          ( 
         
         
         
           z 
          
         
           i 
          
         
        
          ) 
         
        
          [ 
         
        
          log 
         
        
          ⁡ 
         
        
          Q 
         
        
          ( 
         
         
         
           z 
          
         
           i 
          
         
        
          ) 
         
        
          ] 
         
        
       
         ELBO=\sum_{\textbf{Z}}\prod_{i=1}^{m}Q(z_i)\Big[\log P(z_i|\textbf{X})\Big]+\sum_{\textbf{Z}}\prod_{i=1}^{m}Q(z_i)\Big[\log P(\textbf{X})\Big]-\sum_{\textbf{Z}}\prod_{i=1}^{m}Q(z_i)\Big[\log Q(z_i)\Big] 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.0576em;">E</span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right: 0.0278em;">BO</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.9477em; vertical-align: -1.2963em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05em;"><span class="" style="top: -1.8537em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord textbf mtight">Z</span></span></span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.2963em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.6514em;"><span class="" style="top: -1.8723em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∏</span></span></span><span class="" style="top: -4.3em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.2777em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.044em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em;"><span class="" style="top: -2.55em; margin-left: -0.044em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span class="delimsizing size2">[</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">lo<span style="margin-right: 0.0139em;">g</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.044em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em;"><span class="" style="top: -2.55em; margin-left: -0.044em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord">∣</span><span class="mord text"><span class="mord textbf">X</span></span><span class="mclose">)</span><span class="mord"><span class="delimsizing size2">]</span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 2.9477em; vertical-align: -1.2963em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05em;"><span class="" style="top: -1.8537em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord textbf mtight">Z</span></span></span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.2963em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.6514em;"><span class="" style="top: -1.8723em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∏</span></span></span><span class="" style="top: -4.3em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.2777em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.044em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em;"><span class="" style="top: -2.55em; margin-left: -0.044em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span class="delimsizing size2">[</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">lo<span style="margin-right: 0.0139em;">g</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">X</span></span><span class="mclose">)</span><span class="mord"><span class="delimsizing size2">]</span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 2.9477em; vertical-align: -1.2963em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05em;"><span class="" style="top: -1.8537em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord textbf mtight">Z</span></span></span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.2963em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.6514em;"><span class="" style="top: -1.8723em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∏</span></span></span><span class="" style="top: -4.3em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.2777em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.044em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em;"><span class="" style="top: -2.55em; margin-left: -0.044em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span class="delimsizing size2">[</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">lo<span style="margin-right: 0.0139em;">g</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.044em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em;"><span class="" style="top: -2.55em; margin-left: -0.044em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span class="delimsizing size2">]</span></span></span></span></span></span></span><br> 由此我们就得到了ELBO的平均场近似形式。之后。我们分别固定 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         i 
        
       
      
        i 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span></span> 的取值，对于每一个 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          z 
         
        
          i 
         
        
       
      
        z_i 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.044em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em;"><span class="" style="top: -2.55em; margin-left: -0.044em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span> 我们利用坐标上升算法（<em>coordinate ascent</em>）进行优化，最终完成我们目标。</p> 
<h4><a id="26_Black_Box_Variational_Inference_87"></a>2.6 Black Box Variational Inference</h4> 
<p>我们还可以节借助黑盒变分推断（<em>Mean field</em>）来完成最大化ELBO的计算。我们假设 变分分布 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         Q 
        
       
         ( 
        
       
         Z 
        
       
         ) 
        
       
      
        Q(\textbf{Z}) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mclose">)</span></span></span></span></span> 的参数为 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         θ 
        
       
      
        \theta 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6944em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">θ</span></span></span></span></span>，那么变分分布可以记为 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         Q 
        
       
         ( 
        
       
         Z 
        
       
         ; 
        
       
         θ 
        
       
         ) 
        
       
      
        Q(Z;\theta) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.0715em;">Z</span><span class="mpunct">;</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">θ</span><span class="mclose">)</span></span></span></span></span> 因而ELBO可以重写做：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          E 
         
        
          L 
         
        
          B 
         
        
          O 
         
        
          = 
         
         
         
           ∑ 
          
         
           Z 
          
         
        
          Q 
         
        
          ( 
         
        
          Z 
         
        
          ; 
         
        
          θ 
         
        
          ) 
         
        
          [ 
         
        
          log 
         
        
          ⁡ 
         
        
          P 
         
        
          ( 
         
        
          Z 
         
        
          , 
         
        
          X 
         
        
          ) 
         
        
          − 
         
        
          log 
         
        
          ⁡ 
         
        
          Q 
         
        
          ( 
         
        
          Z 
         
        
          ; 
         
        
          θ 
         
        
          ) 
         
        
          ] 
         
        
       
         ELBO=\sum_{\textbf{Z}}Q(\textbf{Z};\theta)\Big[\log P(\textbf{Z},\textbf{X})-\log Q(\textbf{Z};\theta)\Big] 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.0576em;">E</span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right: 0.0278em;">BO</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.4463em; vertical-align: -1.2963em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05em;"><span class="" style="top: -1.8537em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord textbf mtight">Z</span></span></span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.2963em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mpunct">;</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">θ</span><span class="mclose">)</span><span class="mord"><span class="delimsizing size2">[</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">lo<span style="margin-right: 0.0139em;">g</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord text"><span class="mord textbf">X</span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1.8em; vertical-align: -0.65em;"></span><span class="mop">lo<span style="margin-right: 0.0139em;">g</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mpunct">;</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">θ</span><span class="mclose">)</span><span class="mord"><span class="delimsizing size2">]</span></span></span></span></span></span></span><br> 为了得到我们的优化目标，我们对 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         θ 
        
       
      
        \theta 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6944em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">θ</span></span></span></span></span> 求导：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          ∇ 
         
        
          E 
         
        
          L 
         
        
          B 
         
        
          O 
         
        
          = 
         
        
          ∇ 
         
         
         
           ∑ 
          
         
           Z 
          
         
        
          Q 
         
        
          ( 
         
        
          Z 
         
        
          ; 
         
        
          θ 
         
        
          ) 
         
        
          [ 
         
        
          log 
         
        
          ⁡ 
         
         
          
          
            P 
           
          
            ( 
           
          
            Z 
           
          
            , 
           
          
            X 
           
          
            ) 
           
          
          
          
            Q 
           
          
            ( 
           
          
            Z 
           
          
            ; 
           
          
            θ 
           
          
            ) 
           
          
         
        
          ] 
         
        
       
         \nabla ELBO=\nabla \sum_{\textbf{Z}} Q(\textbf{Z};\theta)\Big[\log \frac{P(\textbf{Z},\textbf{X})}{Q(\textbf{Z};\theta)}\Big] 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord">∇</span><span class="mord mathnormal" style="margin-right: 0.0576em;">E</span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right: 0.0278em;">BO</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.7233em; vertical-align: -1.2963em;"></span><span class="mord">∇</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05em;"><span class="" style="top: -1.8537em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord textbf mtight">Z</span></span></span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.2963em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mpunct">;</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">θ</span><span class="mclose">)</span><span class="mord"><span class="delimsizing size2">[</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">lo<span style="margin-right: 0.0139em;">g</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.427em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mpunct">;</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">θ</span><span class="mclose">)</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord text"><span class="mord textbf">X</span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.936em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="delimsizing size2">]</span></span></span></span></span></span></span></p> 
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          ▽ 
         
        
          E 
         
        
          L 
         
        
          B 
         
        
          O 
         
        
          = 
         
         
         
           ∑ 
          
         
           Z 
          
         
        
          ∇ 
         
        
          Q 
         
        
          ( 
         
        
          Z 
         
        
          ; 
         
        
          θ 
         
        
          ) 
         
        
          [ 
         
        
          log 
         
        
          ⁡ 
         
         
          
          
            P 
           
          
            ( 
           
          
            Z 
           
          
            , 
           
          
            X 
           
          
            ) 
           
          
          
          
            Q 
           
          
            ( 
           
          
            Z 
           
          
            ; 
           
          
            θ 
           
          
            ) 
           
          
         
        
          ] 
         
        
          + 
         
         
         
           ∑ 
          
         
           Z 
          
         
        
          Q 
         
        
          ( 
         
        
          Z 
         
        
          ; 
         
        
          θ 
         
        
          ) 
         
        
          ∇ 
         
        
          [ 
         
        
          log 
         
        
          ⁡ 
         
         
          
          
            P 
           
          
            ( 
           
          
            Z 
           
          
            , 
           
          
            X 
           
          
            ) 
           
          
          
          
            Q 
           
          
            ( 
           
          
            Z 
           
          
            ; 
           
          
            θ 
           
          
            ) 
           
          
         
        
          ] 
         
        
       
         \triangledown ELBO=\sum_{\textbf{Z}} \nabla Q(\textbf{Z};\theta)\Big[\log \frac{P(\textbf{Z},\textbf{X})}{Q(\textbf{Z};\theta)}\Big] + \sum_{\textbf{Z}} Q(\textbf{Z};\theta)\nabla \Big[\log \frac{P(\textbf{Z},\textbf{X})}{Q(\textbf{Z};\theta)}\Big] 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord amsrm">▽</span><span class="mord mathnormal" style="margin-right: 0.0576em;">E</span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right: 0.0278em;">BO</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.7233em; vertical-align: -1.2963em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05em;"><span class="" style="top: -1.8537em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord textbf mtight">Z</span></span></span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.2963em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord">∇</span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mpunct">;</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">θ</span><span class="mclose">)</span><span class="mord"><span class="delimsizing size2">[</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">lo<span style="margin-right: 0.0139em;">g</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.427em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mpunct">;</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">θ</span><span class="mclose">)</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord text"><span class="mord textbf">X</span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.936em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="delimsizing size2">]</span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 2.7233em; vertical-align: -1.2963em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05em;"><span class="" style="top: -1.8537em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord textbf mtight">Z</span></span></span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.2963em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mpunct">;</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">θ</span><span class="mclose">)</span><span class="mord">∇</span><span class="mord"><span class="delimsizing size2">[</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">lo<span style="margin-right: 0.0139em;">g</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.427em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mpunct">;</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">θ</span><span class="mclose">)</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord text"><span class="mord textbf">X</span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.936em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="delimsizing size2">]</span></span></span></span></span></span></span></p> 
<p>经过一系列变换我们可以发现ELBO的第二项为0：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          ∇ 
         
        
          E 
         
        
          L 
         
        
          B 
         
        
          O 
         
        
          = 
         
         
         
           ∑ 
          
         
           Z 
          
         
        
          ∇ 
         
        
          Q 
         
        
          ( 
         
        
          Z 
         
        
          ; 
         
        
          θ 
         
        
          ) 
         
        
          [ 
         
        
          log 
         
        
          ⁡ 
         
         
          
          
            P 
           
          
            ( 
           
          
            Z 
           
          
            , 
           
          
            X 
           
          
            ) 
           
          
          
          
            Q 
           
          
            ( 
           
          
            Z 
           
          
            ; 
           
          
            θ 
           
          
            ) 
           
          
         
        
          ] 
         
        
       
         \nabla ELBO=\sum_{\textbf{Z}} \nabla Q(\textbf{Z};\theta)\Big[\log \frac{P(\textbf{Z},\textbf{X})}{Q(\textbf{Z};\theta)}\Big] 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord">∇</span><span class="mord mathnormal" style="margin-right: 0.0576em;">E</span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right: 0.0278em;">BO</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.7233em; vertical-align: -1.2963em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05em;"><span class="" style="top: -1.8537em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord textbf mtight">Z</span></span></span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.2963em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord">∇</span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mpunct">;</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">θ</span><span class="mclose">)</span><span class="mord"><span class="delimsizing size2">[</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">lo<span style="margin-right: 0.0139em;">g</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.427em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mpunct">;</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">θ</span><span class="mclose">)</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord text"><span class="mord textbf">X</span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.936em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="delimsizing size2">]</span></span></span></span></span></span></span><br> 进一步的，我们对其进行稍加变换：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          ∇ 
         
        
          E 
         
        
          L 
         
        
          B 
         
        
          O 
         
        
          = 
         
         
         
           ∑ 
          
         
           Z 
          
         
        
          Q 
         
        
          ( 
         
        
          Z 
         
        
          ; 
         
        
          θ 
         
        
          ) 
         
         
          
          
            ∇ 
           
          
            Q 
           
          
            ( 
           
          
            Z 
           
          
            ; 
           
          
            θ 
           
          
            ) 
           
          
          
          
            Q 
           
          
            ( 
           
          
            Z 
           
          
            ; 
           
          
            θ 
           
          
            ) 
           
          
         
        
          [ 
         
        
          log 
         
        
          ⁡ 
         
         
          
          
            P 
           
          
            ( 
           
          
            Z 
           
          
            , 
           
          
            X 
           
          
            ) 
           
          
          
          
            Q 
           
          
            ( 
           
          
            Z 
           
          
            ; 
           
          
            θ 
           
          
            ) 
           
          
         
        
          ] 
         
        
          = 
         
         
         
           ∑ 
          
         
           Z 
          
         
        
          Q 
         
        
          ( 
         
        
          Z 
         
        
          ; 
         
        
          θ 
         
        
          ) 
         
        
          ∇ 
         
        
          [ 
         
        
          ln 
         
        
          ⁡ 
         
         
         
           Q 
          
         
           ( 
          
         
           Z 
          
         
           ; 
          
         
           θ 
          
         
           ) 
          
         
        
          ] 
         
        
          log 
         
        
          ⁡ 
         
         
          
          
            P 
           
          
            ( 
           
          
            Z 
           
          
            , 
           
          
            X 
           
          
            ) 
           
          
          
          
            Q 
           
          
            ( 
           
          
            Z 
           
          
            ; 
           
          
            θ 
           
          
            ) 
           
          
         
        
       
         \nabla ELBO=\sum_{\textbf{Z}}Q(\textbf{Z};\theta)\frac{\nabla Q(\textbf{Z};\theta)}{Q(\textbf{Z};\theta)}\Big[\log \frac{P(\textbf{Z},\textbf{X})}{Q(\textbf{Z};\theta)}\Big]=\sum_{\textbf{Z}}Q(\textbf{Z};\theta)\nabla\Big[\ln{Q(\textbf{Z};\theta)}\Big]\log \frac{P(\textbf{Z},\textbf{X})}{Q(\textbf{Z};\theta)} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord">∇</span><span class="mord mathnormal" style="margin-right: 0.0576em;">E</span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right: 0.0278em;">BO</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.7233em; vertical-align: -1.2963em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05em;"><span class="" style="top: -1.8537em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord textbf mtight">Z</span></span></span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.2963em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mpunct">;</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">θ</span><span class="mclose">)</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.427em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mpunct">;</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">θ</span><span class="mclose">)</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">∇</span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mpunct">;</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">θ</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.936em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="delimsizing size2">[</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">lo<span style="margin-right: 0.0139em;">g</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.427em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mpunct">;</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">θ</span><span class="mclose">)</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord text"><span class="mord textbf">X</span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.936em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="delimsizing size2">]</span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.7233em; vertical-align: -1.2963em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05em;"><span class="" style="top: -1.8537em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord textbf mtight">Z</span></span></span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.2963em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mpunct">;</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">θ</span><span class="mclose">)</span><span class="mord">∇</span><span class="mord"><span class="delimsizing size2">[</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">ln</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mpunct">;</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">θ</span><span class="mclose">)</span></span><span class="mord"><span class="delimsizing size2">]</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">lo<span style="margin-right: 0.0139em;">g</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.427em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mpunct">;</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">θ</span><span class="mclose">)</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord text"><span class="mord textbf">X</span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.936em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span><br> 我们可以将上式看作 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         ∇ 
        
       
         [ 
        
       
         ln 
        
       
         ⁡ 
        
        
        
          Q 
         
        
          ( 
         
        
          Z 
         
        
          ; 
         
        
          θ 
         
        
          ) 
         
        
       
         ] 
        
       
         log 
        
       
         ⁡ 
        
        
         
         
           P 
          
         
           ( 
          
         
           Z 
          
         
           , 
          
         
           X 
          
         
           ) 
          
         
         
         
           Q 
          
         
           ( 
          
         
           Z 
          
         
           ; 
          
         
           θ 
          
         
           ) 
          
         
        
       
      
        \nabla\Big[\ln{Q(\textbf{Z};\theta)}\Big]\log \frac{P(\textbf{Z},\textbf{X})}{Q(\textbf{Z};\theta)} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.8em; vertical-align: -0.65em;"></span><span class="mord">∇</span><span class="mord"><span class="delimsizing size2">[</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">ln</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord text"><span class="mord textbf">Z</span></span><span class="mpunct">;</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">θ</span><span class="mclose">)</span></span><span class="mord"><span class="delimsizing size2">]</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">lo<span style="margin-right: 0.0139em;">g</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.01em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">Q</span><span class="mopen mtight">(</span><span class="mord text mtight"><span class="mord textbf mtight">Z</span></span><span class="mpunct mtight">;</span><span class="mord mathnormal mtight" style="margin-right: 0.0278em;">θ</span><span class="mclose mtight">)</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.485em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.1389em;">P</span><span class="mopen mtight">(</span><span class="mord text mtight"><span class="mord textbf mtight">Z</span></span><span class="mpunct mtight">,</span><span class="mord text mtight"><span class="mord textbf mtight">X</span></span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.52em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span> 的平均值，进而采取蒙特卡洛采样方法得到 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         ∇ 
        
       
         E 
        
       
         L 
        
       
         B 
        
       
         O 
        
       
      
        \nabla ELBO 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord">∇</span><span class="mord mathnormal" style="margin-right: 0.0576em;">E</span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right: 0.0278em;">BO</span></span></span></span></span> 的近似解：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          ∇ 
         
        
          E 
         
        
          L 
         
        
          B 
         
        
          O 
         
        
          = 
         
         
         
           1 
          
         
           N 
          
         
         
         
           ∑ 
          
          
          
            i 
           
          
            = 
           
          
            1 
           
          
         
           N 
          
         
        
          F 
         
        
          ( 
         
         
         
           Z 
          
         
           i 
          
         
        
          ) 
         
        
          = 
         
         
         
           1 
          
         
           N 
          
         
         
         
           ∑ 
          
          
          
            i 
           
          
            = 
           
          
            1 
           
          
         
           N 
          
         
        
          ∇ 
         
        
          [ 
         
        
          ln 
         
        
          ⁡ 
         
         
         
           Q 
          
         
           ( 
          
          
          
            Z 
           
          
            i 
           
          
         
           ; 
          
         
           θ 
          
         
           ) 
          
         
        
          ] 
         
        
          log 
         
        
          ⁡ 
         
         
          
          
            P 
           
          
            ( 
           
           
           
             Z 
            
           
             i 
            
           
          
            , 
           
          
            X 
           
          
            ) 
           
          
          
          
            Q 
           
          
            ( 
           
           
           
             Z 
            
           
             i 
            
           
          
            ; 
           
          
            θ 
           
          
            ) 
           
          
         
        
       
         \nabla ELBO = \frac1N \sum_{i=1}^N F(\textbf{Z}_i) = \frac1N \sum_{i=1}^N \nabla\Big[\ln{Q(\textbf{Z}_i;\theta)}\Big]\log \frac{P(\textbf{Z}_i,\textbf{X})}{Q(\textbf{Z}_i;\theta)} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord">∇</span><span class="mord mathnormal" style="margin-right: 0.0576em;">E</span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right: 0.0278em;">BO</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 3.106em; vertical-align: -1.2777em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.3214em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.109em;">N</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.8283em;"><span class="" style="top: -1.8723em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span><span class="" style="top: -4.3em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right: 0.109em;">N</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.2777em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">F</span><span class="mopen">(</span><span class="mord"><span class="mord text"><span class="mord textbf">Z</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 3.106em; vertical-align: -1.2777em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.3214em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.109em;">N</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.8283em;"><span class="" style="top: -1.8723em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span><span class="" style="top: -4.3em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right: 0.109em;">N</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.2777em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord">∇</span><span class="mord"><span class="delimsizing size2">[</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">ln</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord"><span class="mord text"><span class="mord textbf">Z</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">;</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">θ</span><span class="mclose">)</span></span><span class="mord"><span class="delimsizing size2">]</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">lo<span style="margin-right: 0.0139em;">g</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.427em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord"><span class="mord text"><span class="mord textbf">Z</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">;</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">θ</span><span class="mclose">)</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord text"><span class="mord textbf">Z</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord text"><span class="mord textbf">X</span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.936em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span></p> 
<p>然后我们可以使用如下的梯度下降方法，通过调整参数 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         θ 
        
       
      
        \theta 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6944em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">θ</span></span></span></span></span> 使 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         ∇ 
        
       
         E 
        
       
         L 
        
       
         B 
        
       
         O 
        
       
      
        \nabla ELBO 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord">∇</span><span class="mord mathnormal" style="margin-right: 0.0576em;">E</span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right: 0.0278em;">BO</span></span></span></span></span> 不断增大，直到出现最优解：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           θ 
          
          
          
            t 
           
          
            + 
           
          
            1 
           
          
         
        
          = 
         
         
         
           θ 
          
         
           t 
          
         
        
          + 
         
        
          η 
         
        
          ∇ 
         
        
          E 
         
        
          L 
         
        
          B 
         
        
          O 
         
        
       
         \theta^{t+1} = \theta^t + \eta \nabla ELBO 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8641em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0278em;">θ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8641em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.9269em; vertical-align: -0.0833em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0278em;">θ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8436em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.8778em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.0359em;">η</span><span class="mord">∇</span><span class="mord mathnormal" style="margin-right: 0.0576em;">E</span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right: 0.0278em;">BO</span></span></span></span></span></span><br> 其中，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         η 
        
       
      
        \eta 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.0359em;">η</span></span></span></span></span> 是梯度下降方法中的学习率。</p> 
<p>至此贝叶斯变分推断的方法介绍完成。</p> 
<h3><a id="3_Experiments_and_Discussion_127"></a>3. Experiments and Discussion</h3> 
<p>贝叶斯推理基于著名的贝叶斯理论发展而来，是统计学和机器学习领域的经典方法。其主要的缺点在于，在大部分情况下，需要复杂的计算。马尔可夫链蒙特卡罗旨在根据密度估计参数。密度可以非常复杂，也可以仅由一个因子确定。马尔可夫链蒙特卡罗在贝叶斯推理中主要用于从后验分布的“非标准化部分”中直接生成样本，避免复杂计算。变分推断是用于搜寻最优近似分布的方法。该方法通过优化参数，在给定数族中找到最优近似分布。 由于变分推断优化过程对目标分布中的乘积常数不敏感，该方法可以用于生成仅由一个归一化因子定义的后验分布的最优近似分布。</p> 
<p>由于马尔可夫链蒙特卡罗和变分推断各有特色，它们常用于不同类型的问题中。一方面，马尔可夫链蒙特卡罗复杂的采样过程不会造成偏差。所以，马尔可夫链蒙特卡罗方法在不考虑计算时间、需要得到精确结果的情况下更受青睐。另一方面，虽然变分推断的数族选择过程会造成结果偏差，但它的参数优化过程非常合理。所以，变分推断方法常用于需要快速计算的大规模推断问题中。</p> 
<h3><a id="4_Conclusion_133"></a>4. Conclusion</h3> 
<p>变分推断方法的基本思想是通过使用已知简单分布来逼近需推断的复杂分布，并通过限制近似分布的类型，从而得到一种局部最优、但具有确定解的近似后验分布。虽然变分推断的数族选择过程会造成结果偏差，但它的参数优化过程非常合理，变分推断方法常用于需要快速计算的大规模推断问题中。总之，变分推断与基于蒙特卡洛抽样的方法都在贝叶斯推断中起着举足轻重的作用。</p> 
<h3><a id="Reference_137"></a>Reference</h3> 
<ol><li><a href="http://www.inference.phy.cam.ac.uk/mackay/itila/" rel="nofollow">The on-line textbook: Information Theory, Inference, and Learning Algorithms</a>, by <a href="https://en.wikipedia.org/wiki/David_J.C._MacKay" rel="nofollow">David J.C. MacKay</a> provides an introduction to variational methods (p. 422).</li><li><a href="http://www.robots.ox.ac.uk/~sjrob/Pubs/fox_vbtut.pdf" rel="nofollow">A Tutorial on Variational Bayes</a>. Fox, C. and Roberts, S. 2012. Artificial Intelligence Review, <a href="https://en.wikipedia.org/wiki/Doi_%28identifier%29" rel="nofollow">doi</a>:<a href="https://doi.org/10.1007%2Fs10462-011-9236-8" rel="nofollow">10.1007/s10462-011-9236-8</a>.</li><li><a href="http://www.gatsby.ucl.ac.uk/vbayes/" rel="nofollow">Variational-Bayes Repository</a> A repository of research papers, software, and links related to the use of variational methods for approximate Bayesian learning up to 2003.</li><li><a href="http://www.cse.buffalo.edu/faculty/mbeal/thesis/index.html" rel="nofollow">Variational Algorithms for Approximate Bayesian Inference</a>, by M. J. Beal includes comparisons of EM to Variational Bayesian EM and derivations of several models including Variational Bayesian HMMs.</li><li><a href="http://www.cs.jhu.edu/~jason/tutorials/variational.html" rel="nofollow">High-Level Explanation of Variational Inference</a> by Jason Eisner may be worth reading before a more mathematically detailed treatment.</li><li><a href="https://arxiv.org/abs/1803.10998" rel="nofollow">Copula Variational Bayes inference via information geometry (pdf)</a> by Tran, V.H. 2018. This paper is primarily written for students. Via Bregman divergence.</li><li><a href="http://www.orchid.ac.uk/eprints/40/1/fox_vbtut.pdf" rel="nofollow">A Tutorial on Variational Bayesian InferenceCharles</a>, Fox·Stephen Roberts</li><li><a href="https://en.wikipedia.org/wiki/Variational_Bayesian_methods" rel="nofollow">Variational Bayesian methods</a>, Wikipedia</li><li><a href="https://www.zhihu.com/question/41765860" rel="nofollow">如何简单易懂地理解变分推断(variational inference)？</a>, 知乎</li><li><a href="https://blog.csdn.net/weixin_40255337/article/details/83088786?utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7Edefault-4.baidujs&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7Edefault-4.baidujs">一文学会变分推断及其求解方法</a>, CSDN</li><li><a href="https://blog.csdn.net/aws3217150/article/details/57072827?utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromMachineLearnPai2%7Edefault-2.baidujs&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromMachineLearnPai2%7Edefault-2.baidujs">变分贝叶斯推断(Variational Bayes Inference)简介</a>, CSDN</li><li><a href="https://blog.csdn.net/c9yv2cf9i06k2a9e/article/details/102735795">变分推断（Variational Inference）最新进展简述</a>, CSDN</li><li><a href="https://www.cnblogs.com/yifdu25/p/8181185.html" rel="nofollow">变分推断（Variational Inference）</a>, 博客园</li><li>机器学习, 周志华</li></ol> 
<p>本文为作者原创，转载请注明来源：<a href="https://blog.csdn.net/BrilliantAntonio/article/details/116885492">https://blog.csdn.net/BrilliantAntonio/article/details/116885492</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8773ab7ba73525d27a63059408fe87e2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">使用IDEA完成登录与注册</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/67206a5b7d88b5c78ff395b961c4b929/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">[yocto]bitbake使用详解</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>