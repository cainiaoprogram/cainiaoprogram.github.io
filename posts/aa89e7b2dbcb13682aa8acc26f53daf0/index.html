<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>QT操作Word，插入表格 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="QT操作Word，插入表格" />
<meta property="og:description" content="最近在做QT导出word报表，发现网上的资源不是很多，也浪费了很多时间，我自己做了一份demo,将会详细讲述如何做出需要样式的报表。在网上很容易查到java或者其他语言操作word的接口函数，但是QT能操作word的，不是很多，而且还不太好用。我把自己已经调试出来的代码，贡献出来，免得以后浪费时间。
写了一部分接口函数，可以满足大部分的word报表。在QT工程中，QWorddemo.pro中，需要加入如下：
QT默认安装在C盘中。
下载地址：http://download.csdn.net/download/blackbattery/10001438
分数有点高了，分享一个百度云盘网址：链接: https://pan.baidu.com/s/1qWv4tTY-VGPNONJUvyhLlw 提取码: esqk
链接：https://share.weiyun.com/59gwQjX 密码：v74rng
LIBS &#43;=C:\Qt\Qt5.5.1\5.5\msvc2010\lib\qtmaind.lib LIBS &#43;=C:\Qt\Qt5.5.1\5.5\msvc2010\lib\Qt5Cored.lib LIBS &#43;=C:\Qt\Qt5.5.1\5.5\msvc2010\lib\Qt5Guid.lib LIBS &#43;=C:\Qt\Qt5.5.1\5.5\msvc2010\lib\Qt5Widgetsd.lib LIBS &#43;=C:\Qt\Qt5.5.1\5.5\msvc2010\lib\Qt5AxContainerd.lib LIBS &#43;=C:\Qt\Qt5.5.1\5.5\msvc2010\lib\Qt5AxBased.lib 在word中插入表格：
void QWord::intsertTable(int row,int column) {	QAxObject* tables = m_document-&gt;querySubObject(&#34;Tables&#34;);	QAxObject* selection = m_word-&gt;querySubObject(&#34;Selection&#34;);	QAxObject* range = selection-&gt;querySubObject(&#34;Range&#34;); QVariantList params; params.append(range-&gt;asVariant());	params.append(row); params.append(column);	tables-&gt;querySubObject(&#34;Add(QAxObject*, int, int, QVariant&amp;, QVariant&amp;)&#34;, params); QAxObject* table = selection-&gt;querySubObject(&#34;Tables(int)&#34;,1); table-&gt;setProperty(&#34;Style&#34;,&#34;网格型&#34;); QAxObject* Borders = table-&gt;querySubObject(&#34;Borders&#34;); Borders-&gt;setProperty(&#34;InsideLineStyle&#34;,1); Borders-&gt;setProperty(&#34;OutsideLineStyle&#34;,1); QString doc = Borders-&gt;generateDocumentation(); QFile outFile(&#34;D:\\360Downloads\\Picutres\\Borders.html&#34;); outFile.open(QIODevice::WriteOnly|QIODevice::Append); QTextStream ts(&amp;outFile); ts&lt;&lt;doc&lt;&lt;endl; /*QString doc = tables-&gt;generateDocumentation(); QFile outFile(&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/aa89e7b2dbcb13682aa8acc26f53daf0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2016-07-24T11:28:28+08:00" />
<meta property="article:modified_time" content="2016-07-24T11:28:28+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">QT操作Word，插入表格</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>最近在做QT导出word报表，发现网上的资源不是很多，也浪费了很多时间，我自己做了一份demo,将会详细讲述如何做出需要样式的报表。在网上很容易查到java或者其他语言操作word的接口函数，但是QT能操作word的，不是很多，而且还不太好用。我把自己已经调试出来的代码，贡献出来，免得以后浪费时间。<br> 写了一部分接口函数，可以满足大部分的word报表。在QT工程中，QWorddemo.pro中，需要加入如下：<br> QT默认安装在C盘中。<br> 下载地址：http://download.csdn.net/download/blackbattery/10001438<br> 分数有点高了，分享一个百度云盘网址：链接: https://pan.baidu.com/s/1qWv4tTY-VGPNONJUvyhLlw 提取码: esqk<br> 链接：https://share.weiyun.com/59gwQjX 密码：v74rng</p> 
<pre><code>LIBS    +=C:\Qt\Qt5.5.1\5.5\msvc2010\lib\qtmaind.lib
LIBS    +=C:\Qt\Qt5.5.1\5.5\msvc2010\lib\Qt5Cored.lib
LIBS    +=C:\Qt\Qt5.5.1\5.5\msvc2010\lib\Qt5Guid.lib
LIBS    +=C:\Qt\Qt5.5.1\5.5\msvc2010\lib\Qt5Widgetsd.lib
LIBS    +=C:\Qt\Qt5.5.1\5.5\msvc2010\lib\Qt5AxContainerd.lib
LIBS    +=C:\Qt\Qt5.5.1\5.5\msvc2010\lib\Qt5AxBased.lib
</code></pre> 
<p>在word中插入表格：</p> 
<pre><code>void QWord::intsertTable(int row,int column)
{	
	QAxObject* tables = m_document-&gt;querySubObject("Tables");	
	QAxObject* selection = m_word-&gt;querySubObject("Selection");	
	QAxObject* range = selection-&gt;querySubObject("Range");
	QVariantList params;
	params.append(range-&gt;asVariant());		
	params.append(row);
	params.append(column);	
	tables-&gt;querySubObject("Add(QAxObject*, int, int, QVariant&amp;, QVariant&amp;)", params);
	QAxObject* table = selection-&gt;querySubObject("Tables(int)",1);
	table-&gt;setProperty("Style","网格型"); 

	QAxObject* Borders = table-&gt;querySubObject("Borders");
	Borders-&gt;setProperty("InsideLineStyle",1);
	Borders-&gt;setProperty("OutsideLineStyle",1);
	
	QString doc = Borders-&gt;generateDocumentation();
	QFile outFile("D:\\360Downloads\\Picutres\\Borders.html");
	outFile.open(QIODevice::WriteOnly|QIODevice::Append);
	QTextStream ts(&amp;outFile);
	ts&lt;&lt;doc&lt;&lt;endl;

	/*QString doc = tables-&gt;generateDocumentation();
	QFile outFile("D:\\360Downloads\\Picutres\\tables.html");
	outFile.open(QIODevice::WriteOnly|QIODevice::Append);
	QTextStream ts(&amp;outFile);
	ts&lt;&lt;doc&lt;&lt;endl;*/	
}
</code></pre> 
<p>这是插入表格的函数，其中border使用画出表格边线。其中<br> QString doc = Borders-&gt;generateDocumentation();这部分代码是将其中的关于border属性导出来的。<br> 合并单元格的函数有两种实现方法，我选择的是第一种，其中tableindex表示的是第几个table。<br> 合并单元格的函数：</p> 
<pre><code>void QWord::MergeCells(int tableIndex, int nStartRow,int nStartCol,int nEndRow,int nEndCol)//合并单元格
{
	QAxObject* tables = m_document-&gt;querySubObject("Tables");
	QAxObject* table = tables-&gt;querySubObject("Item(int)",tableIndex);
	QAxObject* StartCell =table-&gt;querySubObject("Cell(int, int)",nStartRow,nStartCol);
	QAxObject* EndCell = table-&gt;querySubObject("Cell(int, int)",nEndRow,nEndCol);
	StartCell-&gt;querySubObject("Merge(QAxObject *)",EndCell-&gt;asVariant());
}
//第二种方法调用
// void QWord::MergeCells(int tableIndex, int nStartRow,int nStartCol,int nEndRow,int nEndCol)//合并单元格
// {
// 	QAxObject* tables = m_document-&gt;querySubObject("Tables");	
// 	QAxObject* table = tables-&gt;querySubObject("Item(int)",tableIndex);
// 	QAxObject* StartCell =table-&gt;querySubObject("Cell(int, int)",nStartRow,nStartCol);
// 	QAxObject* EndCell = table-&gt;querySubObject("Cell(int, int)",nEndRow,nEndCol);
// 	StartCell-&gt;dynamicCall("Merge(LPDISPATCH)",EndCell-&gt;asVariant());
// }

插入图片的函数，需要考虑到图片的大小，固定单元格的大小，可以使图片自适应单元格的。
void QWord::insertCellPic(int row,int column,const QString&amp; picPath)
{
	QAxObject* selection = m_word-&gt;querySubObject("Selection");	
	QAxObject* table = selection-&gt;querySubObject("Tables(1)");
	QAxObject* range = table-&gt;querySubObject("Cell(int, int)",row,column)-&gt;querySubObject("Range");
	range-&gt;querySubObject("InlineShapes")-&gt;dynamicCall("AddPicture(const QString&amp;)",picPath);
}
</code></pre> 
<p>还有增加行的需求，我又写了增加行的接口函数，提供给别人调用。</p> 
<pre><code>void QWord::addTableRow(int tableIndex ,int nRow,int rowCount)
{
	QAxObject* tables=m_document-&gt;querySubObject("Tables");
	QAxObject* table = tables-&gt;querySubObject("Item(int)",tableIndex);
	QAxObject* rows =table-&gt;querySubObject("Rows");
	int Count =rows-&gt;dynamicCall("Count").toInt();
	if(0&lt; nRow &amp;&amp; nRow &lt; Count )
	{   
		for(int i =0; i&lt; rowCount; ++i)
		{
			QString sPos = QString("Item(%1)").arg(nRow+i);
			QAxObject* row= rows-&gt;querySubObject(sPos.toStdString().c_str());
			QVariant param =row -&gt;asVariant();
			rows-&gt;dynamicCall("Add(Variant)",param);
		}			
	}	
}
</code></pre> 
<p>这个函数很重要，再插入表格的时候，当你插入第二个表格的时候，必须要使用此函数，要不然的话，<br> 其他表格的数据将会覆盖第一个表格的内容。这个函数将光标移到末尾，跳出单元格。</p> 
<pre><code>void QWord::moveForEnd()//光标移到末尾，才能真正的跳出单元格
{
	QAxObject* selection = m_word-&gt;querySubObject("Selection");	
	QVariantList params;
	params.append(6);		
	params.append(0);		
	selection-&gt;dynamicCall("EndOf(QVariant&amp;, QVariant&amp;)", params).toInt();
}
</code></pre> 
<p>关于部分接口函数的dynamicCall和querySubObject，需要注意，<br> querySubObject调用的是属性或者返回值，dynamicCall调用的是方法。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/49dbb40781dd4ad6a66fdf9070093d1b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">POJ 1321 棋盘问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/24e4b3a3b827ebc6bc99e4ab1217f153/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【c&#43;&#43;】STL里的priority_queue用法总结</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>