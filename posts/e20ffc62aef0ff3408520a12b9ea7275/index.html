<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【大数据之Kafka】十六、Kafka集成外部系统之集成Flume - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【大数据之Kafka】十六、Kafka集成外部系统之集成Flume" />
<meta property="og:description" content="Flume 是一个在大数据开发中非常常用的组件。可以用于 Kafka 的生产者，也可以用于 Kafka 的消费者。
Flume安装和部署：https://blog.csdn.net/qq_18625571/article/details/131678589?spm=1001.2014.3001.5501
1 Flume生产者 （1）在hadoop102启动Kafka集群。
zk.sh start kf.sh start （2）在hadoop103启动Kafka消费者。
bin/kafka-console-consumer.sh --bootstrap-server hadoop102:9092,hadoop103:9092 --topic first （3）在hadoop102上安装Flume：https://blog.csdn.net/qq_18625571/article/details/131678589?spm=1001.2014.3001.5501 第一章Flume安装部署。
（4）在/opt/module/flume-1.9.0/job目录下创建配置文件file_to_kafka.conf。
# 1 组件定义 a1.sources = r1 a1.sinks = k1 a1.channels = c1 # 2 配置 source a1.sources.r1.type = TAILDIR a1.sources.r1.filegroups = f1 a1.sources.r1.filegroups.f1 = /opt/module/applog/app.* a1.sources.r1.positionFile = /opt/module/flume/taildir_position.json # 3 配置 channel a1.channels.c1.type = memory a1.channels.c1.capacity = 1000 a1.channels.c1.transactionCapacity = 100 # 4 配置 sink a1.sinks.k1.type = org." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/e20ffc62aef0ff3408520a12b9ea7275/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-21T22:15:00+08:00" />
<meta property="article:modified_time" content="2023-09-21T22:15:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【大数据之Kafka】十六、Kafka集成外部系统之集成Flume</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>  Flume 是一个在大数据开发中非常常用的组件。可以用于 Kafka 的生产者，也可以用于 Kafka 的消费者。<br> <img src="https://images2.imgbox.com/dc/c4/EQVsoDto_o.png" alt="在这里插入图片描述"><br> Flume安装和部署：<a href="https://blog.csdn.net/qq_18625571/article/details/131678589?spm=1001.2014.3001.5501">https://blog.csdn.net/qq_18625571/article/details/131678589?spm=1001.2014.3001.5501</a></p> 
<h3><a id="1_Flume_3"></a>1 Flume生产者</h3> 
<p><img src="https://images2.imgbox.com/28/3c/i7XyCet2_o.png" alt="在这里插入图片描述"><br> （1）在hadoop102启动Kafka集群。</p> 
<pre><code class="prism language-java">zk<span class="token punctuation">.</span>sh start
kf<span class="token punctuation">.</span>sh start
</code></pre> 
<p>（2）在hadoop103启动Kafka消费者。</p> 
<pre><code class="prism language-java">bin<span class="token operator">/</span>kafka<span class="token operator">-</span>console<span class="token operator">-</span>consumer<span class="token punctuation">.</span>sh <span class="token operator">--</span>bootstrap<span class="token operator">-</span>server hadoop102<span class="token operator">:</span><span class="token number">9092</span><span class="token punctuation">,</span>hadoop103<span class="token operator">:</span><span class="token number">9092</span> <span class="token operator">--</span>topic first
</code></pre> 
<p>（3）在hadoop102上安装Flume：https://blog.csdn.net/qq_18625571/article/details/131678589?spm=1001.2014.3001.5501 第一章Flume安装部署。</p> 
<p>（4）在/opt/module/flume-1.9.0/job目录下创建配置文件file_to_kafka.conf。</p> 
<pre><code class="prism language-java"># <span class="token number">1</span> 组件定义
a1<span class="token punctuation">.</span>sources <span class="token operator">=</span> r1
a1<span class="token punctuation">.</span>sinks <span class="token operator">=</span> k1
a1<span class="token punctuation">.</span>channels <span class="token operator">=</span> c1

# <span class="token number">2</span> 配置 source
a1<span class="token punctuation">.</span>sources<span class="token punctuation">.</span>r1<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token constant">TAILDIR</span>
a1<span class="token punctuation">.</span>sources<span class="token punctuation">.</span>r1<span class="token punctuation">.</span>filegroups <span class="token operator">=</span> f1
a1<span class="token punctuation">.</span>sources<span class="token punctuation">.</span>r1<span class="token punctuation">.</span>filegroups<span class="token punctuation">.</span>f1 <span class="token operator">=</span> <span class="token operator">/</span>opt<span class="token operator">/</span><span class="token keyword">module</span><span class="token operator">/</span>applog<span class="token operator">/</span>app<span class="token punctuation">.</span>*
a1<span class="token punctuation">.</span>sources<span class="token punctuation">.</span>r1<span class="token punctuation">.</span>positionFile <span class="token operator">=</span> <span class="token operator">/</span>opt<span class="token operator">/</span><span class="token keyword">module</span><span class="token operator">/</span>flume<span class="token operator">/</span>taildir_position<span class="token punctuation">.</span>json

# <span class="token number">3</span> 配置 channel
a1<span class="token punctuation">.</span>channels<span class="token punctuation">.</span>c1<span class="token punctuation">.</span>type <span class="token operator">=</span> memory
a1<span class="token punctuation">.</span>channels<span class="token punctuation">.</span>c1<span class="token punctuation">.</span>capacity <span class="token operator">=</span> <span class="token number">1000</span>
a1<span class="token punctuation">.</span>channels<span class="token punctuation">.</span>c1<span class="token punctuation">.</span>transactionCapacity <span class="token operator">=</span> <span class="token number">100</span>

# <span class="token number">4</span> 配置 sink
a1<span class="token punctuation">.</span>sinks<span class="token punctuation">.</span>k1<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flume<span class="token punctuation">.</span>sink<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span></span>KafkaSink</span>
a1<span class="token punctuation">.</span>sinks<span class="token punctuation">.</span>k1<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>bootstrap<span class="token punctuation">.</span>servers <span class="token operator">=</span> hadoop102<span class="token operator">:</span><span class="token number">9092</span><span class="token punctuation">,</span>hadoop103<span class="token operator">:</span><span class="token number">9092</span><span class="token punctuation">,</span>hadoop104<span class="token operator">:</span><span class="token number">9092</span>
a1<span class="token punctuation">.</span>sinks<span class="token punctuation">.</span>k1<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>topic <span class="token operator">=</span> first
a1<span class="token punctuation">.</span>sinks<span class="token punctuation">.</span>k1<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>flumeBatchSize <span class="token operator">=</span> <span class="token number">20</span>
a1<span class="token punctuation">.</span>sinks<span class="token punctuation">.</span>k1<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>producer<span class="token punctuation">.</span>acks <span class="token operator">=</span> <span class="token number">1</span>
a1<span class="token punctuation">.</span>sinks<span class="token punctuation">.</span>k1<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>producer<span class="token punctuation">.</span>linger<span class="token punctuation">.</span>ms <span class="token operator">=</span> <span class="token number">1</span>

# <span class="token number">5</span> 拼接组件
a1<span class="token punctuation">.</span>sources<span class="token punctuation">.</span>r1<span class="token punctuation">.</span>channels <span class="token operator">=</span> c1
a1<span class="token punctuation">.</span>sinks<span class="token punctuation">.</span>k1<span class="token punctuation">.</span>channel <span class="token operator">=</span> c1
</code></pre> 
<p>（5）启动Flume</p> 
<pre><code class="prism language-java">bin<span class="token operator">/</span>flume<span class="token operator">-</span>ng agent <span class="token operator">-</span>c conf<span class="token operator">/</span> <span class="token operator">-</span>n a1 <span class="token operator">-</span>f job<span class="token operator">/</span>file_to_kafka<span class="token punctuation">.</span>conf
</code></pre> 
<p>（6）向/opt/module/applog/app.log 里追加数据，查看 kafka 消费者消费情况。</p> 
<pre><code class="prism language-java">mkdir applog
echo hello <span class="token operator">&gt;&gt;</span> <span class="token operator">/</span>opt<span class="token operator">/</span><span class="token keyword">module</span><span class="token operator">/</span>applog<span class="token operator">/</span>app<span class="token punctuation">.</span>log
</code></pre> 
<p>（7）观察 kafka 消费者，能够看到消费的 hello 数据。</p> 
<h3><a id="2_Flume_62"></a>2 Flume消费者</h3> 
<p><img src="https://images2.imgbox.com/17/b4/5pOtW4ZC_o.png" alt="在这里插入图片描述"></p> 
<p>（1）在 hadoop102 节点的 Flume 的/opt/module/flume/job 目录下创建 kafka_to_file.conf。</p> 
<pre><code class="prism language-java"># <span class="token number">1</span> 组件定义
a1<span class="token punctuation">.</span>sources <span class="token operator">=</span> r1
a1<span class="token punctuation">.</span>sinks <span class="token operator">=</span> k1
a1<span class="token punctuation">.</span>channels <span class="token operator">=</span> c1

# <span class="token number">2</span> 配置 source
a1<span class="token punctuation">.</span>sources<span class="token punctuation">.</span>r1<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flume<span class="token punctuation">.</span>source<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span></span>KafkaSource</span>
a1<span class="token punctuation">.</span>sources<span class="token punctuation">.</span>r1<span class="token punctuation">.</span>batchSize <span class="token operator">=</span> <span class="token number">50</span>
a1<span class="token punctuation">.</span>sources<span class="token punctuation">.</span>r1<span class="token punctuation">.</span>batchDurationMillis <span class="token operator">=</span> <span class="token number">200</span>
a1<span class="token punctuation">.</span>sources<span class="token punctuation">.</span>r1<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>bootstrap<span class="token punctuation">.</span>servers <span class="token operator">=</span> hadoop102<span class="token operator">:</span><span class="token number">9092</span>
a1<span class="token punctuation">.</span>sources<span class="token punctuation">.</span>r1<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>topics <span class="token operator">=</span> first
a1<span class="token punctuation">.</span>sources<span class="token punctuation">.</span>r1<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>group<span class="token punctuation">.</span>id <span class="token operator">=</span> custom<span class="token punctuation">.</span>g<span class="token punctuation">.</span>id

# <span class="token number">3</span> 配置 channel
a1<span class="token punctuation">.</span>channels<span class="token punctuation">.</span>c1<span class="token punctuation">.</span>type <span class="token operator">=</span> memory
a1<span class="token punctuation">.</span>channels<span class="token punctuation">.</span>c1<span class="token punctuation">.</span>capacity <span class="token operator">=</span> <span class="token number">1000</span>
a1<span class="token punctuation">.</span>channels<span class="token punctuation">.</span>c1<span class="token punctuation">.</span>transactionCapacity <span class="token operator">=</span> <span class="token number">100</span>

# <span class="token number">4</span> 配置 sink
a1<span class="token punctuation">.</span>sinks<span class="token punctuation">.</span>k1<span class="token punctuation">.</span>type <span class="token operator">=</span> logger

# <span class="token number">5</span> 拼接组件
a1<span class="token punctuation">.</span>sources<span class="token punctuation">.</span>r1<span class="token punctuation">.</span>channels <span class="token operator">=</span> c1
a1<span class="token punctuation">.</span>sinks<span class="token punctuation">.</span>k1<span class="token punctuation">.</span>channel <span class="token operator">=</span> c1
</code></pre> 
<p>（2）启动 Flume。</p> 
<pre><code class="prism language-java">bin<span class="token operator">/</span>flume<span class="token operator">-</span>ng agent <span class="token operator">-</span>c conf<span class="token operator">/</span> <span class="token operator">-</span>n a1 <span class="token operator">-</span>f job<span class="token operator">/</span>kafka_to_file<span class="token punctuation">.</span>conf <span class="token operator">-</span><span class="token class-name">Dflume</span><span class="token punctuation">.</span>root<span class="token punctuation">.</span>logger<span class="token operator">=</span><span class="token constant">INFO</span><span class="token punctuation">,</span>console
</code></pre> 
<p>（3）启动 kafka 生产者，并输入数据，例如：hello world</p> 
<pre><code class="prism language-java">bin<span class="token operator">/</span>kafka<span class="token operator">-</span>console<span class="token operator">-</span>producer<span class="token punctuation">.</span>sh <span class="token operator">--</span>bootstrap<span class="token operator">-</span>server hadoop102<span class="token operator">:</span><span class="token number">9092</span> <span class="token operator">--</span>topic first
</code></pre> 
<p>（4）观察控制台输出的日志</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fed3927b366a30c44197e18e60328c39/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Android Studio Debugger一直卡在collecting data</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/708494adc58ed49dff107c2f04d5ea99/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">js实现短信验证码一键登录</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>