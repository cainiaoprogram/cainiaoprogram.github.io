<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>freeswitch部署及网关调试 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="freeswitch部署及网关调试" />
<meta property="og:description" content="freeswitch部署及网关调试 目录
freeswitch部署及网关调试... - 1 -
一、freeswitch部署... - 3 -
（一）基础部署... - 3 -
（二）根据实际情况需求的部署配置... - 4 -
1、freeswitch开启支持音频和视频... - 4 -
2、配置联通/电信双线... - 5 -
3、防掉线... - 5 -
4、默认号码及说明... - 5 -
5、配置文件说明... - 6 -
6、添加一个新的SIP账号... - 6 -
7、freeswitch用作软电话... - 6 -
8、配置SIP网关拨打外部电话... - 7 -
9、从某一分机上呼出... - 7 -
10、呼入电话处理。... - 8 -
11、测试freeswitch视频会议... - 8 -
12、freeswitch中的语音识别... - 9 -
13、在 FreeSWITCH 中使用 google translate 进行文本语音转换." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/4f69f460deb359ab273a24df1092b59b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-05-26T14:12:51+08:00" />
<meta property="article:modified_time" content="2020-05-26T14:12:51+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">freeswitch部署及网关调试</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2 style="margin-left:0cm;"><a name="_Toc514943604">freeswitch</a>部署及网关调试</h2> 
<p> </p> 
<p style="margin-left:0cm;"><strong>目录</strong></p> 
<p style="margin-left:0cm;"><a href="#_Toc514943604" rel="nofollow">freeswitch部署及网关调试... - 1 -</a></p> 
<p style="margin-left:11pt;"><a href="#_Toc514943605" rel="nofollow">一、freeswitch部署... - 3 -</a></p> 
<p style="margin-left:22pt;"><a href="#_Toc514943606" rel="nofollow">（一）基础部署... - 3 -</a></p> 
<p style="margin-left:22pt;"><a href="#_Toc514943607" rel="nofollow">（二）根据实际情况需求的部署配置... - 4 -</a></p> 
<p style="margin-left:63pt;"><a href="#_Toc514943608" rel="nofollow">1、freeswitch开启支持音频和视频... - 4 -</a></p> 
<p style="margin-left:63pt;"><a href="#_Toc514943609" rel="nofollow">2、配置联通/电信双线... - 5 -</a></p> 
<p style="margin-left:63pt;"><a href="#_Toc514943610" rel="nofollow">3、防掉线... - 5 -</a></p> 
<p style="margin-left:63pt;"><a href="#_Toc514943611" rel="nofollow">4、默认号码及说明... - 5 -</a></p> 
<p style="margin-left:63pt;"><a href="#_Toc514943612" rel="nofollow">5、配置文件说明... - 6 -</a></p> 
<p style="margin-left:63pt;"><a href="#_Toc514943613" rel="nofollow">6、添加一个新的SIP账号... - 6 -</a></p> 
<p style="margin-left:63pt;"><a href="#_Toc514943614" rel="nofollow">7、freeswitch用作软电话... - 6 -</a></p> 
<p style="margin-left:63pt;"><a href="#_Toc514943615" rel="nofollow">8、配置SIP网关拨打外部电话... - 7 -</a></p> 
<p style="margin-left:63pt;"><a href="#_Toc514943616" rel="nofollow">9、从某一分机上呼出... - 7 -</a></p> 
<p style="margin-left:63pt;"><a href="#_Toc514943617" rel="nofollow">10、呼入电话处理。... - 8 -</a></p> 
<p style="margin-left:63pt;"><a href="#_Toc514943618" rel="nofollow">11、测试freeswitch视频会议... - 8 -</a></p> 
<p style="margin-left:63pt;"><a href="#_Toc514943619" rel="nofollow">12、freeswitch中的语音识别... - 9 -</a></p> 
<p style="margin-left:63pt;"><a href="#_Toc514943620" rel="nofollow">13、在 FreeSWITCH 中使用 google translate 进行文本语音转换... - 9 -</a></p> 
<p style="margin-left:11pt;"><a href="#_Toc514943621" rel="nofollow">二、Freeswitch配置... - 9 -</a></p> 
<p style="margin-left:22pt;"><a href="#_Toc514943622" rel="nofollow">1、基础配置... - 9 -</a></p> 
<p style="margin-left:22pt;"><a href="#_Toc514943623" rel="nofollow">2、拨号规则配置... - 10 -</a></p> 
<p style="margin-left:22pt;"><a href="#_Toc514943624" rel="nofollow">3、NAT穿透配置... - 13 -</a></p> 
<p style="margin-left:63pt;"><a href="#_Toc514943625" rel="nofollow">（一）、freeswitch帮助终端穿越NAT解决方案... - 13 -</a></p> 
<p style="margin-left:63pt;"><a href="#_Toc514943626" rel="nofollow">（二）、freeswitch处于NAT后面的解决方案... - 13 -</a></p> 
<p style="margin-left:63pt;"><a href="#_Toc514943627" rel="nofollow">（三）其他NAT穿透相关设置... - 14 -</a></p> 
<p style="margin-left:11pt;"><a href="#_Toc514943628" rel="nofollow">三、网关配置... - 16 -</a></p> 
<p style="margin-left:22pt;"><a href="#_Toc514943629" rel="nofollow">1、修改本地网络... - 16 -</a></p> 
<p style="margin-left:22pt;"><a href="#_Toc514943630" rel="nofollow">2、修改登陆密码... - 17 -</a></p> 
<p style="margin-left:22pt;"><a href="#_Toc514943631" rel="nofollow">3、SIP服务器配置... - 18 -</a></p> 
<p style="margin-left:22pt;"><a href="#_Toc514943632" rel="nofollow">4、添加端口或端口组... - 18 -</a></p> 
<p style="margin-left:22pt;"><a href="#_Toc514943633" rel="nofollow">5、配置IP中继... - 21 -</a></p> 
<p style="margin-left:22pt;"><a href="#_Toc514943634" rel="nofollow">6、路由参数配置... - 21 -</a></p> 
<p style="margin-left:22pt;"><a href="#_Toc514943635" rel="nofollow">7、配置IPàTel路由... - 21 -</a></p> 
<p style="margin-left:22pt;"><a href="#_Toc514943636" rel="nofollow">8、配置IPàTel被叫号码变更... - 22 -</a></p> 
<p style="margin-left:22pt;"><a href="#_Toc514943637" rel="nofollow">9、保存完配置之后重启，并将网关接入本地网络... - 22 -</a></p> 
<p style="margin-left:0cm;"> </p> 
<p> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<h3 style="margin-left:0cm;"><a name="_Toc514943605">一、freeswitch</a>部署</h3> 
<h4 style="margin-left:0cm;"><a name="_Toc514943606">（一）基础部署</a></h4> 
<p style="margin-left:0cm;">1、数据库部署</p> 
<p style="margin-left:0cm;">⑴、安装MariaDB</p> 
<p style="margin-left:0cm;">安装命令</p> 
<p style="margin-left:0cm;">yum -y install mariadb mariadb-server</p> 
<p style="margin-left:0cm;">yum install mysql-connector-odbc</p> 
<p style="margin-left:0cm;">安装完成MariaDB，首先启动MariaDB</p> 
<p style="margin-left:0cm;">systemctl start mariadb</p> 
<p style="margin-left:0cm;">设置开机启动</p> 
<p style="margin-left:0cm;">systemctl enable mariadb</p> 
<p style="margin-left:0cm;">接下来进行MariaDB的相关简单配置</p> 
<p style="margin-left:0cm;">mysql_secure_installation</p> 
<p style="margin-left:0cm;">首先是设置密码，会提示先输入密码</p> 
<p style="margin-left:0cm;">Enter current password for root (enter for none):&lt;–初次运行直接回车</p> 
<p style="margin-left:0cm;">设置密码</p> 
<p style="margin-left:0cm;">Set root password? [Y/n] &lt;– 是否设置root用户密码，输入y并回车或直接回车</p> 
<p style="margin-left:0cm;">New password: &lt;– 设置root用户的密码</p> 
<p style="margin-left:0cm;">Re-enter new password: &lt;– 再输入一次你设置的密码</p> 
<p style="margin-left:0cm;">其他配置</p> 
<p style="margin-left:0cm;">Remove anonymous users? [Y/n] &lt;– 是否删除匿名用户，回车</p> 
<p style="margin-left:0cm;">Disallow root login remotely? [Y/n] &lt;–是否禁止root远程登录,回车,</p> 
<p style="margin-left:0cm;">Remove test database and access to it? [Y/n] &lt;– 是否删除test数据库，回车</p> 
<p style="margin-left:0cm;">Reload privilege tables now? [Y/n] &lt;– 是否重新加载权限表，回车</p> 
<p style="margin-left:0cm;">初始化MariaDB完成，接下来测试登录</p> 
<p style="margin-left:0cm;">mysql -uroot -ppassword</p> 
<p style="margin-left:0cm;">完成。</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">⑵、配置MariaDB的字符集</p> 
<p style="margin-left:0cm;">文件/etc/my.cnf</p> 
<p style="margin-left:0cm;">vi /etc/my.cnf</p> 
<p style="margin-left:0cm;">在[mysqld]标签下添加</p> 
<p style="margin-left:0cm;">init_connect='SET collation_connection = utf8_unicode_ci'</p> 
<p style="margin-left:0cm;">init_connect='SET NAMES utf8'</p> 
<p style="margin-left:0cm;">character-set-server=utf8</p> 
<p style="margin-left:0cm;">collation-server=utf8_unicode_ci</p> 
<p style="margin-left:0cm;">skip-character-set-client-handshake</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">文件/etc/my.cnf.d/client.cnf</p> 
<p style="margin-left:0cm;">vi /etc/my.cnf.d/client.cnf</p> 
<p style="margin-left:0cm;">在[client]中添加</p> 
<p style="margin-left:0cm;">default-character-set=utf8</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">文件/etc/my.cnf.d/mysql-clients.cnf</p> 
<p style="margin-left:0cm;">vi /etc/my.cnf.d/mysql-clients.cnf</p> 
<p style="margin-left:0cm;">在[mysql]中添加</p> 
<p style="margin-left:0cm;">default-character-set=utf8</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">全部配置完成，重启mariadb</p> 
<p style="margin-left:0cm;">systemctl restart mariadb</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">之后进入MariaDB查看字符集</p> 
<p style="margin-left:0cm;">mysql&gt; show variables like "%character%";show variables like "%collation%";</p> 
<p style="margin-left:0cm;">显示为</p> 
<p style="margin-left:0cm;">+--------------------------+----------------------------+</p> 
<p style="margin-left:0cm;">| Variable_name            | Value                      |</p> 
<p style="margin-left:0cm;">+--------------------------+----------------------------+</p> 
<p style="margin-left:0cm;">| character_set_client    | utf8                      |</p> 
<p style="margin-left:0cm;">| character_set_connection | utf8                      |</p> 
<p style="margin-left:0cm;">| character_set_database  | utf8                      |</p> 
<p style="margin-left:0cm;">| character_set_filesystem | binary                    |</p> 
<p style="margin-left:0cm;">| character_set_results    | utf8                      |</p> 
<p style="margin-left:0cm;">| character_set_server    | utf8                      |</p> 
<p style="margin-left:0cm;">| character_set_system    | utf8                      |</p> 
<p style="margin-left:0cm;">| character_sets_dir      | /usr/share/mysql/charsets/ |</p> 
<p style="margin-left:0cm;">+--------------------------+----------------------------+</p> 
<p style="margin-left:0cm;">8 rows in set (0.00 sec)</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">+----------------------+-----------------+</p> 
<p style="margin-left:0cm;">| Variable_name        | Value          |</p> 
<p style="margin-left:0cm;">+----------------------+-----------------+</p> 
<p style="margin-left:0cm;">| collation_connection | utf8_unicode_ci |</p> 
<p style="margin-left:0cm;">| collation_database  | utf8_unicode_ci |</p> 
<p style="margin-left:0cm;">| collation_server    | utf8_unicode_ci |</p> 
<p style="margin-left:0cm;">+----------------------+-----------------+</p> 
<p style="margin-left:0cm;">3 rows in set (0.00 sec)</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">字符集配置完成。</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">⑶、添加用户，设置权限</p> 
<p style="margin-left:0cm;">创建用户命令</p> 
<p style="margin-left:0cm;">mysql&gt;create user lwz@localhost identified by '123456';</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">直接创建用户并授权的命令</p> 
<p style="margin-left:0cm;">mysql&gt;grant all on *.* to lwz@localhost indentified by '123456';</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">授予外网登陆权限</p> 
<p style="margin-left:0cm;">mysql&gt;grant all <strong>privileges</strong> on *.* to lwz@'%' identified by '123456';</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">授予权限并且可以授权</p> 
<p style="margin-left:0cm;"><strong>mysql&gt;grant all privileges on *.* to lwz@'localhost' identified by '123456' with grant option;</strong></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">简单的用户和权限配置基本就这样了。</p> 
<p style="margin-left:0cm;">其中只授予部分权限把 其中 all privileges或者all改为select,insert,update,delete,create,drop,index,alter,grant,references,reload,shutdown,process,file其中一部分。</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">登录数据库创建新库</p> 
<p style="margin-left:0cm;"><strong>[root@VM_56_176_centos ~]# <span style="color:#ff0000;">mysql -ulwz -p</span></strong></p> 
<p style="margin-left:0cm;"><strong>Enter password: </strong></p> 
<p style="margin-left:0cm;"><strong>Welcome to the MariaDB monitor.  Commands end with ; or \g.</strong></p> 
<p style="margin-left:0cm;"><strong>Your MariaDB connection id is 79</strong></p> 
<p style="margin-left:0cm;"><strong>Server version: 5.5.56-MariaDB MariaDB Server</strong></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><strong>Copyright (c) 2000, 2017, Oracle, MariaDB Corporation Ab and others.</strong></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><strong>Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</strong></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><strong>MariaDB [(none)]&gt; <span style="color:#ff0000;">create database fsdb;</span></strong></p> 
<p style="margin-left:0cm;"><strong>Query OK, 1 row affected (0.00 sec)</strong></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><strong>MariaDB [(none)]&gt;<span style="color:#ff0000;"> show databases;</span></strong></p> 
<p style="margin-left:0cm;"><strong>+--------------------+</strong></p> 
<p style="margin-left:0cm;"><strong>| Database           |</strong></p> 
<p style="margin-left:0cm;"><strong>+--------------------+</strong></p> 
<p style="margin-left:0cm;"><strong>| information_schema |</strong></p> 
<p style="margin-left:0cm;"><strong>| fsdb               |</strong></p> 
<p style="margin-left:0cm;"><strong>| mysql              |</strong></p> 
<p style="margin-left:0cm;"><strong>| performance_schema |</strong></p> 
<p style="margin-left:0cm;"><strong>+--------------------+</strong></p> 
<p style="margin-left:0cm;"><strong>5 rows in set (0.00 sec)</strong></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><strong>MariaDB [(none)]&gt; </strong></p> 
<p style="margin-left:0cm;">修改odbc.ini文件，如果没有可以创建，内容如下：</p> 
<p style="margin-left:0cm;"><strong>[root@VM_56_176_centos ~]#<span style="color:#ff0000;"> vim /etc/odbc.ini </span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#ffff00;">[freeswitch]</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#ffff00;">Description=MySQL freeswitch database</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#ffff00;">Trace = On</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#ffff00;">TraceFile = stderr</span></strong></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><strong><span style="color:#ffff00;">Driver=MySQL</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#ffff00;">SERVER =localhost</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#ffff00;">PORT =3306 </span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#ffff00;">DATABASE = fsdb</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#ffff00;">USER = lwz</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#ffff00;">PASSWORD = 123456</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#ffff00;">CHARSET = UTF8</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#ffff00;">OPTION = 3</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#ffff00;">MULTI_STATEMENTS = 67108864</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#ffff00;">Threading = 0</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#ffff00;">MaxLongVarcharSize=65536</span></strong></p> 
<p style="margin-left:0cm;">查看odbc状态</p> 
<p style="margin-left:0cm;"><strong>[root@VM_56_176_centos ~]# <span style="color:#ff0000;">odbcinst -q -s</span></strong></p> 
<p style="margin-left:0cm;"><strong>[freeswitch]</strong></p> 
<p style="margin-left:0cm;"><strong>[root@VM_56_176_centos ~]# <span style="color:#ff0000;">odbcinst -q -d</span></strong></p> 
<p style="margin-left:0cm;"><strong>[PostgreSQL]</strong></p> 
<p style="margin-left:0cm;"><strong>[MySQL]</strong></p> 
<p style="margin-left:0cm;"><strong>[root@VM_56_176_centos ~]# <span style="color:#ff0000;">odbcinst -j</span></strong></p> 
<p style="margin-left:0cm;"><strong>unixODBC 2.3.1</strong></p> 
<p style="margin-left:0cm;"><strong>DRIVERS............: /etc/odbcinst.ini</strong></p> 
<p style="margin-left:0cm;"><strong>SYSTEM DATA SOURCES: /etc/odbc.ini</strong></p> 
<p style="margin-left:0cm;"><strong>FILE DATA SOURCES..: /etc/ODBCDataSources</strong></p> 
<p style="margin-left:0cm;"><strong>USER DATA SOURCES..: /etc/odbc.ini</strong></p> 
<p style="margin-left:0cm;"><strong>SQLULEN Size.......: 8</strong></p> 
<p style="margin-left:0cm;"><strong>SQLLEN Size........: 8</strong></p> 
<p style="margin-left:0cm;"><strong>SQLSETPOSIROW Size.: 8</strong></p> 
<p style="margin-left:0cm;"><strong>[root@VM_56_176_centos ~]#</strong></p> 
<p style="margin-left:0cm;">检查dsn连接状态</p> 
<p style="margin-left:0cm;"><strong>[root@VM_56_176_centos ~]#<span style="color:#ff0000;"> isql -v freeswitch</span></strong></p> 
<p style="margin-left:0cm;"><strong>+---------------------------------------+</strong></p> 
<p style="margin-left:0cm;"><strong>| Connected!                            |</strong></p> 
<p style="margin-left:0cm;"><strong>|                                       |</strong></p> 
<p style="margin-left:0cm;"><strong>| sql-statement                         |</strong></p> 
<p style="margin-left:0cm;"><strong>| help [tablename]                      |</strong></p> 
<p style="margin-left:0cm;"><strong>| quit                                  |</strong></p> 
<p style="margin-left:0cm;"><strong>|                                       |</strong></p> 
<p style="margin-left:0cm;"><strong>+---------------------------------------+</strong></p> 
<p style="margin-left:0cm;"><strong>SQL&gt;</strong></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">2、安装前准备</p> 
<p style="margin-left:0cm;">a.安装git：</p> 
<p style="margin-left:0cm;"><strong>[root@acs ~]# <span style="color:#ff0000;">yum install -y git</span></strong></p> 
<p style="margin-left:0cm;">b.安装epel-yum源：</p> 
<p style="margin-left:0cm;"><strong>[root@acs ~]#<span style="color:#ff0000;"> yum -y install epel-release</span></strong></p> 
<p style="margin-left:0cm;">c.安装freeswitch自己的yum源（因为epel中的libyuv-devel版本低，无法正常编译mod_fsv）：</p> 
<p style="margin-left:0cm;"><strong>[root@acs ~]# <span style="color:#ff0000;">rpm -Uvh http://files.freeswitch.org/freeswitch-release-1-6.noarch.rpm</span></strong></p> 
<p style="margin-left:0cm;"><strong>获取</strong><strong>http://files.freeswitch.org/freeswitch-release-1-6.noarch.rpm</strong></p> 
<p style="margin-left:0cm;"><strong>准备中</strong><strong>...                          ################################# [100%]</strong></p> 
<p style="margin-left:0cm;"><strong>正在升级</strong><strong>/</strong><strong>安装</strong><strong>...</strong></p> 
<p style="margin-left:0cm;"><strong>   1:freeswitch-release-1-6           ################################# [100%]</strong></p> 
<p style="margin-left:0cm;"><strong>[root@acs ~]#</strong></p> 
<p style="margin-left:0cm;">d.安装编译环境</p> 
<p style="margin-left:0cm;"><strong>[root@acs ~]# yum -y install git gcc-c++ autoconf automake libtool wget python ncurses-devel zlib-devel libjpeg-devel openssl-devel e2fsprogs-devel sqlite-devel libcurl-devel pcre-devel speex-devel ldns-devel libedit-devel libxml2-devel yasm</strong></p> 
<p style="margin-left:0cm;">e.安装各种库和头文件：</p> 
<p style="margin-left:0cm;"><strong>[root@acs ~]# yum -y install libyuv-devel opus-devel libvpx-devel libvpx2* libdb4* libidn-devel unbound-devel libuuid-devel lua-devel libsndfile-devel</strong></p> 
<p style="margin-left:0cm;">2、获取源码</p> 
<p style="margin-left:0cm;"><strong>[root@acs ~]# cd /usr/local/src</strong></p> 
<p style="margin-left:0cm;"><strong>[root@acs src]# git clone -b v1.6 https://freeswitch.org/stash/scm/fs/freeswitch.git</strong></p> 
<p style="margin-left:0cm;">3、安装</p> 
<p style="margin-left:0cm;"><strong>[root@acs src]# cd /usr/local/src/freeswitch</strong></p> 
<p style="margin-left:0cm;">#注意：我们要添加新的模块到freeswitch，所以要编辑模块的配置文件。到modules.conf中将所需要的模块去掉注释（mod_format_cdr,mod_xml_curl）</p> 
<p style="margin-left:0cm;"><strong>[root@acs freeswitch]# ./bootstrap.sh</strong></p> 
<p style="margin-left:0cm;">#配置制定安装路径</p> 
<p style="margin-left:0cm;"><strong>[root@acs freeswitch]# ./configure --prefix=/usr/local/freeswitch --with-openssl --enable-core-odbc-support</strong></p> 
<p style="margin-left:0cm;">#编译和编译安装</p> 
<p style="margin-left:0cm;"><strong>[root@acs freeswitch]# make &amp;&amp; make install</strong></p> 
<p style="margin-left:0cm;">#安装语音包（语音包的安装时向下兼容安装的，如果不用cd音质可以不装，但是装了cd音质，普通音质的语音包也会被安装。）</p> 
<p style="margin-left:0cm;"><strong>[root@acs freeswitch]# make sounds-install</strong></p> 
<p style="margin-left:0cm;">#安装等待音乐包（同上）</p> 
<p style="margin-left:0cm;"><strong>[root@acs freeswitch]# make moh-install</strong></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">到此完成安装</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">4、初始化配置</p> 
<p style="margin-left:0cm;">a.到vars.xml文件中将默认密码修改一下，否则不安全，而且终端中也会出现警告。另外为了防止默认端口被扫描，还可以修改下默认的端口号！</p> 
<p style="margin-left:0cm;">修改配置文件/usr/local/freeswitch/conf/vars.xml如下:</p> 
<p style="margin-left:0cm;"><strong>[root@acs ~]# <span style="color:#ff0000;">vim /usr/local/freeswitch/etc/freeswitch/vars.xml</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#ffff00;">&lt;X-PRE-PROCESS cmd="set" data="default_password=1234"/&gt;</span></strong><strong>  --&gt;</strong><strong>“</strong><strong>1234</strong><strong>”改成别的</strong><strong> </strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#ffff00;">&lt;X-PRE-PROCESS cmd="set" data="internal_sip_port=5060"/&gt;</span></strong><strong> --&gt;</strong><strong>“</strong><strong>5060</strong><strong>”改成别的</strong></p> 
<p style="margin-left:0cm;">b.取消对IPv6的支持（除非需要ipv6否则请取消）：</p> 
<p style="margin-left:0cm;"><strong>[root@acs ~]# <span style="color:#ff0000;">cd /usr/local/freeswitch/etc/freeswitch/sip_profiles</span></strong></p> 
<p style="margin-left:0cm;">执行下面的操作：</p> 
<p style="margin-left:0cm;"><strong>[root@acs sip_profiles]# <span style="color:#ff0000;">mv internal-ipv6.xml internal-ipv6.xml.removed</span></strong></p> 
<p style="margin-left:0cm;"><strong>[root@acs sip_profiles]# <span style="color:#ff0000;">mv external-ipv6.xml external-ipv6.xml.removed</span></strong></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">对freeswitch和fs_cli命令建立软连接，并且启动freeswitch</p> 
<p style="margin-left:0cm;"><strong>[root@acs ~]# <span style="color:#ff0000;">ln -s /usr/local/freeswitch/bin/freeswitch /usr/bin/freeswitch</span></strong></p> 
<p style="margin-left:0cm;"><strong>[root@acs ~]# <span style="color:#ff0000;">ln -s /usr/local/freeswitch/bin/fs_cli /usr/bin/fs_cli</span></strong></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">配置freeswitch连接数据库</p> 
<p style="margin-left:0cm;">进入freeswitch的配置文件目录，查看需要配置dsn的文件，根据需求修改配置文件就可以</p> 
<p style="margin-left:0cm;"><strong>[root@VM_56_176_centos ~]# cd /usr/local/freeswitch/etc/freeswitch/</strong></p> 
<p style="margin-left:0cm;"><strong>autoload_configs/ dialplan/         ivr_menus/        lang/             sip_profiles/     tls/              </strong></p> 
<p style="margin-left:0cm;"><strong>chatplan/         directory/        jingle_profiles/  mrcp_profiles/    skinny_profiles/  </strong></p> 
<p style="margin-left:0cm;"><strong>[root@VM_56_176_centos ~]# cd /usr/local/freeswitch/etc/freeswitch/</strong></p> 
<p style="margin-left:0cm;"><strong>[root@VM_56_176_centos freeswitch]# grep -ir dsn</strong></p> 
<p style="margin-left:0cm;"><strong>sip_profiles/internal.xml:    &lt;!--If you have ODBC support and a working dsn you can use it instead of SQLite--&gt;</strong></p> 
<p style="margin-left:0cm;"><strong>sip_profiles/internal.xml:    &lt;param name="odbc-dsn" value="freeswitch:lwz:123456"/&gt;</strong></p> 
<p style="margin-left:0cm;"><strong>sip_profiles/internal.xml:    &lt;!--&lt;param name="odbc-dsn" value="pgsql://hostaddr=127.0.0.1 dbname=freeswitch user=freeswitch password='' options='-c client_min_messages=NOTICE' application_name='freeswitch'" /&gt;--&gt;</strong></p> 
<p style="margin-left:0cm;"><strong>sip_profiles/internal-ipv6.xml.removed:    &lt;!--If you have ODBC support and a working dsn you can use it instead of SQLite--&gt;</strong></p> 
<p style="margin-left:0cm;"><strong>sip_profiles/internal-ipv6.xml.removed:    &lt;!--&lt;param name="odbc-dsn" value="dsn:user:pass"/&gt;--&gt;</strong></p> 
<p style="margin-left:0cm;"><strong>sip_profiles/external.xml:    &lt;param name="odbc-dsn" value="freeswitch:lwz:123456"/&gt;</strong></p> 
<p style="margin-left:0cm;"><strong>jingle_profiles/server.xml:    &lt;!--If you have ODBC support and a working dsn you can use it instead of SQLite--&gt;</strong></p> 
<p style="margin-left:0cm;"><strong>jingle_profiles/server.xml:    &lt;param name="odbc-dsn" value="freeswitch:lwz:123456"/&gt;</strong></p> 
<p style="margin-left:0cm;"><strong>mime.types:application/vnd.fdsn.mseed                           mseed</strong></p> 
<p style="margin-left:0cm;"><strong>mime.types:application/vnd.fdsn.seed                      seed dataless</strong></p> 
<p style="margin-left:0cm;"><strong>autoload_configs/cidlookup.conf.xml:    &lt;param name="odbc-dsn" value="phone:phone:phone"/&gt;</strong></p> 
<p style="margin-left:0cm;"><strong>autoload_configs/db.conf.xml:    &lt;param name="odbc-dsn" value="freeswitch:lwz:123456"/&gt;</strong></p> 
<p style="margin-left:0cm;"><strong>autoload_configs/switch.conf.xml:    &lt;!-- &lt;param name="core-db-dsn" value="pgsql://hostaddr=127.0.0.1 dbname=freeswitch user=freeswitch password='' options='-c client_min_messages=NOTICE'" /&gt; --&gt;</strong></p> 
<p style="margin-left:0cm;"><strong>autoload_configs/switch.conf.xml:    &lt;param name="core-db-dsn" value="freeswitch:lwz:123456" /&gt;</strong></p> 
<p style="margin-left:0cm;"><strong>autoload_configs/switch.conf.xml:    &lt;param name="odbc-dsn" value="freeswitch:lwz:123456"/&gt;</strong></p> 
<p style="margin-left:0cm;"><strong>autoload_configs/nibblebill.conf.xml:    &lt;param name="odbc-dsn" value="bandwidth.com"/&gt;</strong></p> 
<p style="margin-left:0cm;"><strong>autoload_configs/voicemail.conf.xml:      &lt;param name="odbc-dsn" value="freeswitch:lwz:123456"/&gt;--&gt;</strong></p> 
<p style="margin-left:0cm;"><strong>autoload_configs/lcr.conf.xml:    &lt;param name="odbc-dsn" value="freeswitch-mysql:freeswitch:Fr33Sw1tch"/&gt;</strong></p> 
<p style="margin-left:0cm;"><strong>autoload_configs/lcr.conf.xml:&lt;!--    &lt;param name="odbc-dsn" value="freeswitch-pgsql:freeswitch:Fr33Sw1tch"/&gt; --&gt;</strong></p> 
<p style="margin-left:0cm;"><strong>autoload_configs/callcenter.conf.xml:    &lt;param name="odbc-dsn" value="freeswitch:lwz:123456"/&gt;</strong></p> 
<p style="margin-left:0cm;"><strong>autoload_configs/easyroute.conf.xml:    &lt;param name="db-dsn" value="easyroute"/&gt;</strong></p> 
<p style="margin-left:0cm;"><strong>autoload_configs/directory.conf.xml:      &lt;param name="odbc-dsn" value="freeswitch:lwz:123456"/&gt;</strong></p> 
<p style="margin-left:0cm;"><strong>skinny_profiles/internal.xml:    &lt;param name="odbc-dsn" value=""/&gt;</strong></p> 
<p style="margin-left:0cm;"><strong>[root@VM_56_176_centos freeswitch]# </strong></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">修改完配置环境后直接启动freeswitch，默认会自动连接数据库，查看数据库fsdb中是否存在所需要的表，不存在会自动创建。</p> 
<p style="margin-left:0cm;">注意：很多时候在启动freeswitch的时候会失败，日志中查看是创建channels表失败，原因是创建channels表的字段时，使用的字符类型为varchar，默认搜索引擎是MyISAM</p> 
<p style="margin-left:0cm;">报错信息如下：</p> 
<p style="margin-left:0cm;">ERROR 1118 (42000): Row size too large. The maximum row size for the used table type, not counting BLOBs, is 65535. You have to change some columns to TEXT or BLOBs</p> 
<p style="margin-left:0cm;">解决办法：把床脚channels表的字段类型VARCHAR换成text</p> 
<p style="margin-left:0cm;">CREATE TABLE channels (</p> 
<p style="margin-left:0cm;">   uuid  VARCHAR(256),</p> 
<p style="margin-left:0cm;">   direction  VARCHAR(32),</p> 
<p style="margin-left:0cm;">   created  VARCHAR(128),</p> 
<p style="margin-left:0cm;">   created_epoch  INTEGER,</p> 
<p style="margin-left:0cm;">   name  VARCHAR(1024),</p> 
<p style="margin-left:0cm;">   state  VARCHAR(64),</p> 
<p style="margin-left:0cm;">   cid_name  VARCHAR(1024),</p> 
<p style="margin-left:0cm;">   cid_num  VARCHAR(256),</p> 
<p style="margin-left:0cm;">   ip_addr  VARCHAR(256),</p> 
<p style="margin-left:0cm;">   dest  VARCHAR(1024),</p> 
<p style="margin-left:0cm;">   application  VARCHAR(128),</p> 
<p style="margin-left:0cm;">   application_data  VARCHAR(4096),</p> 
<p style="margin-left:0cm;">   dialplan VARCHAR(128),</p> 
<p style="margin-left:0cm;">   context VARCHAR(128),</p> 
<p style="margin-left:0cm;">   read_codec  VARCHAR(128),</p> 
<p style="margin-left:0cm;">   read_rate  VARCHAR(32),</p> 
<p style="margin-left:0cm;">   read_bit_rate  VARCHAR(32),</p> 
<p style="margin-left:0cm;">   write_codec  VARCHAR(128),</p> 
<p style="margin-left:0cm;">   write_rate  VARCHAR(32),</p> 
<p style="margin-left:0cm;">   write_bit_rate  VARCHAR(32),</p> 
<p style="margin-left:0cm;">   secure VARCHAR(64),</p> 
<p style="margin-left:0cm;">   hostname VARCHAR(256),</p> 
<p style="margin-left:0cm;">   presence_id VARCHAR(4096),</p> 
<p style="margin-left:0cm;">   presence_data VARCHAR(4096),</p> 
<p style="margin-left:0cm;">   accountcode VARCHAR(256),</p> 
<p style="margin-left:0cm;">   callstate  VARCHAR(64),</p> 
<p style="margin-left:0cm;">   callee_name  VARCHAR(1024),</p> 
<p style="margin-left:0cm;">   callee_num  VARCHAR(256),</p> 
<p style="margin-left:0cm;">   callee_direction  VARCHAR(5),</p> 
<p style="margin-left:0cm;">   call_uuid  VARCHAR(256),</p> 
<p style="margin-left:0cm;">   sent_callee_name  VARCHAR(1024),</p> 
<p style="margin-left:0cm;">   sent_callee_num  VARCHAR(256),</p> 
<p style="margin-left:0cm;">   initial_cid_name  VARCHAR(1024),</p> 
<p style="margin-left:0cm;">   initial_cid_num  VARCHAR(256),</p> 
<p style="margin-left:0cm;">   initial_ip_addr  VARCHAR(256),</p> 
<p style="margin-left:0cm;">   initial_dest  VARCHAR(1024),</p> 
<p style="margin-left:0cm;">   initial_dialplan  VARCHAR(128),</p> 
<p style="margin-left:0cm;">   initial_context  VARCHAR(128)</p> 
<p style="margin-left:0cm;">);</p> 
<p style="margin-left:0cm;">换成</p> 
<p style="margin-left:0cm;">CREATE TABLE channels (</p> 
<p style="margin-left:0cm;">   uuid  text(256),</p> 
<p style="margin-left:0cm;">   direction  text(32),</p> 
<p style="margin-left:0cm;">   created  text(128),</p> 
<p style="margin-left:0cm;">   created_epoch  INTEGER,</p> 
<p style="margin-left:0cm;">   name  text(1024),</p> 
<p style="margin-left:0cm;">   state  text(64),</p> 
<p style="margin-left:0cm;">   cid_name  text(1024),</p> 
<p style="margin-left:0cm;">   cid_num  text(256),</p> 
<p style="margin-left:0cm;">   ip_addr  text(256),</p> 
<p style="margin-left:0cm;">   dest  text(1024),</p> 
<p style="margin-left:0cm;">   application  text(128),</p> 
<p style="margin-left:0cm;">   application_data  text(4096),</p> 
<p style="margin-left:0cm;">   dialplan text(128),</p> 
<p style="margin-left:0cm;">   context text(128),</p> 
<p style="margin-left:0cm;">   read_codec  text(128),</p> 
<p style="margin-left:0cm;">   read_rate  text(32),</p> 
<p style="margin-left:0cm;">   read_bit_rate  text(32),</p> 
<p style="margin-left:0cm;">   write_codec  text(128),</p> 
<p style="margin-left:0cm;">   write_rate  text(32),</p> 
<p style="margin-left:0cm;">   write_bit_rate  text(32),</p> 
<p style="margin-left:0cm;">   secure text(64),</p> 
<p style="margin-left:0cm;">   hostname text(256),</p> 
<p style="margin-left:0cm;">   presence_id text(4096),</p> 
<p style="margin-left:0cm;">   presence_data text(4096),</p> 
<p style="margin-left:0cm;">   accountcode text(256),</p> 
<p style="margin-left:0cm;">   callstate  text(64),</p> 
<p style="margin-left:0cm;">   callee_name  text(1024),</p> 
<p style="margin-left:0cm;">   callee_num  text(256),</p> 
<p style="margin-left:0cm;">   callee_direction  text(5),</p> 
<p style="margin-left:0cm;">   call_uuid  text(256),</p> 
<p style="margin-left:0cm;">   sent_callee_name  text(1024),</p> 
<p style="margin-left:0cm;">   sent_callee_num  text(256),</p> 
<p style="margin-left:0cm;">   initial_cid_name  text(1024),</p> 
<p style="margin-left:0cm;">   initial_cid_num  text(256),</p> 
<p style="margin-left:0cm;">   initial_ip_addr  text(256),</p> 
<p style="margin-left:0cm;">   initial_dest  text(1024),</p> 
<p style="margin-left:0cm;">   initial_dialplan  text(128),</p> 
<p style="margin-left:0cm;">   initial_context  text(128)</p> 
<p style="margin-left:0cm;">);</p> 
<p style="margin-left:0cm;">直接在fsdb库中创建就可以。</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">启动freeswitch</p> 
<p style="margin-left:0cm;">#nc的意思是no console 也就是后台运行</p> 
<p style="margin-left:0cm;"><strong>[root@acs ~]# <span style="color:#ff0000;">freeswitch -nc</span></strong></p> 
<p style="margin-left:0cm;">停止freeswitch</p> 
<p style="margin-left:0cm;"><strong>[root@acs ~]# <span style="color:#ff0000;">freeswitch -stop</span></strong></p> 
<p style="margin-left:0cm;">#使用客户端对freeswitch进行管理</p> 
<p style="margin-left:0cm;"><strong>[root@acs ~]# <span style="color:#ff0000;">fs_cli</span></strong></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">注意：如果需要FreeSWITCH通过ODBC访问数据库（包括运行数据库或Lua脚本访问），需要提前安装好unixODBC和相应数据库的ODBC软件包（如：mysql-connector-odbc）</p> 
<p style="margin-left:0cm;">     在configure时加上--enable-core-odbc-support 强制支持ODBC，如果没有这个参数可能会无法自动发现ODBC</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<h4 style="margin-left:0cm;"><a name="_Toc514943607">（二）根据实际情况需求的部署配置</a></h4> 
<p><a name="_Toc514943608">1</a>、freeswitch开启支持音频和视频</p> 
<p style="margin-left:0cm;">默认只支持音频，为了支持视频，需要修稿配置文件vars.xml（258和259行）</p> 
<p style="margin-left:0cm;"><strong>[root@acs ~]# vim /usr/local/freeswitch/etc/freeswitch/vars.xml</strong></p> 
<p style="margin-left:0cm;"><strong>#</strong><strong>修改下面两行</strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">  &lt;X-PRE-PROCESS</span></strong><strong> <span style="color:#006600;">cmd</span>=<span style="color:#ff0000;">"set"</span> <span style="color:#006600;">data</span>=<span style="color:#ff0000;">"global_codec_prefs=OPUS,G722,PCMU,PCMA,VP8"</span><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>  <span style="color:#66ff99;">&lt;X-PRE-PROCESS</span><span style="color:#006600;"> cmd</span>=<span style="color:#ff0000;">"set"</span> <span style="color:#006600;">data</span>=<span style="color:#ff0000;">"outbound_codec_prefs=OPUS,G722,PCMU,PCMA,VP8"</span><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>#</strong><strong>修改为</strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">  &lt;X-PRE-PROCESS</span></strong><strong> <span style="color:#006600;">cmd</span>=<span style="color:#ff0000;">"set"</span> <span style="color:#006600;">data</span>=<span style="color:#ff0000;">"global_codec_prefs= PCMU,PCMA,GSM,H264,H263-1998,H263"</span><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>  <span style="color:#66ff99;">&lt;X-PRE-PROCESS</span><span style="color:#006600;"> cmd</span>=<span style="color:#ff0000;">"set"</span> <span style="color:#006600;">data</span>=<span style="color:#ff0000;">"outbound_codec_prefs=PCMU,PCMA,GSM</span></strong><span style="color:#ff0000;">,H264,H263-1998,H263"</span><strong><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;"> </p> 
<p><a name="_Toc514943609">2</a>、配置联通/电信双线</p> 
<p style="margin-left:0cm;">复制internal.xml为internal2.xml，修改internal2.xml里第一行的name为internal2，再将sip-ip和rtp-ip改为与internal里不同的那个公网ip，重启freeswitch即可。（用sofia status命令应该可以看到新建的internal2生效）</p> 
<p style="margin-left:0cm;">要使用智能域名解析，将vars.xml里的domain改为域名即可。</p> 
<p><a name="_Toc514943610">3</a>、防掉线</p> 
<p style="margin-left:0cm;">在profile文件里修改nat-options-ping属性为true，大约每30秒FreeSwitch会发一个options包给客户端以保持连接。</p> 
<p style="margin-left:0cm;"> </p> 
<p><a name="_Toc514943611">4</a>、默认号码及说明</p> 
<p style="margin-left:0cm;"><strong>------------------</strong></p> 
<p style="margin-left:0cm;"><strong>号码</strong><strong>        |   </strong><strong>说明</strong></p> 
<p style="margin-left:0cm;"><strong>----------------------</strong></p> 
<p style="margin-left:0cm;"><strong>9664      |   </strong><strong>保持音乐</strong></p> 
<p style="margin-left:0cm;"><strong>9196      |   echo</strong><strong>，回音测试</strong><strong> </strong></p> 
<p style="margin-left:0cm;"><strong>9195      |   echo</strong><strong>，回音测试，延迟</strong><strong>5</strong><strong>秒</strong></p> 
<p style="margin-left:0cm;"><strong>9197      |   milliwatte extension</strong><strong>，铃音生成</strong><strong> </strong></p> 
<p style="margin-left:0cm;"><strong>9198      |   TGML </strong><strong>铃音生成示例</strong></p> 
<p style="margin-left:0cm;"><strong>5000      |   </strong><strong>示例</strong><strong>IVR</strong></p> 
<p style="margin-left:0cm;"><strong>4000      |   </strong><strong>听取语音信箱</strong></p> 
<p style="margin-left:0cm;"><strong>33xx      |   </strong><strong>电话会议，</strong><strong>48K(</strong><strong>其中</strong><strong>xx</strong><strong>可为</strong><strong>00-99</strong><strong>，下同</strong><strong>)</strong></p> 
<p style="margin-left:0cm;"><strong>32xx      |   </strong><strong>电话会议，</strong><strong>32K</strong></p> 
<p style="margin-left:0cm;"><strong>31xx      |   </strong><strong>电话会议，</strong><strong>16K</strong></p> 
<p style="margin-left:0cm;"><strong>30xx      |   </strong><strong>电话会议，</strong><strong>8K</strong></p> 
<p style="margin-left:0cm;"><strong>2000-2002 |   </strong><strong>呼叫组</strong></p> 
<p style="margin-left:0cm;"><strong>1000-1019 |   </strong><strong>默认分机号</strong></p> 
<p style="margin-left:0cm;"> </p> 
<p><a name="_Toc514943612">5</a>、配置文件说明</p> 
<p style="margin-left:0cm;"><strong>文件</strong><strong>                                |    </strong><strong>说明</strong></p> 
<p style="margin-left:0cm;"><strong>---------------------------------------------------</strong></p> 
<p style="margin-left:0cm;"><strong>vars.xml                          | </strong><strong>一些常用变量</strong></p> 
<p style="margin-left:0cm;"><strong>dialplan/default.xml              | </strong><strong>缺省的拨号计划</strong></p> 
<p style="margin-left:0cm;"><strong>directory/default/*.xml           | SIP</strong><strong>用户，每用户一个文件</strong></p> 
<p style="margin-left:0cm;"><strong>sip_profiles/internal.xml         | </strong><strong>一个</strong><strong>SIP profile</strong><strong>，或称作一个</strong><strong>SIP-UA</strong><strong>，监听在本地</strong><strong>IP</strong><strong>及端口</strong><strong>5060</strong><strong>，一般供内网用户使用</strong></p> 
<p style="margin-left:0cm;"><strong>sip_profiles/externa.xml          | </strong><strong>另一个</strong><strong>SIP-UA</strong><strong>，用作外部连接，端口</strong><strong>5080</strong></p> 
<p style="margin-left:0cm;"><strong>autoload_configs/modules.conf.xml | </strong><strong>配置当</strong><strong>FreeSWITCH</strong><strong>启动时自动装载哪些模块</strong></p> 
<p style="margin-left:0cm;"> </p> 
<p><a name="_Toc514943613">6</a>、添加一个新的SIP账号</p> 
<p style="margin-left:0cm;">Freeswitch默认设置了20个用户(1000-1019)，如果需要更多地用户，需要执行以下三个步骤：</p> 
<ul><li>在 etc/freeswitch /directory/default/ 增加一个用户配置文件</li><li>修改拨号计划(Dialplan)使其它用户可以呼叫到它</li><li>重新加载配置使其生效</li></ul> 
<p style="margin-left:0cm;">如果想添加用户Jack，分机号是1234。只需要到etc/freeswitch/directory/default 目录下，将 1000.xml 拷贝到 1234.xml。打开1234.xml，将所有1000都改为1234。并把 effective_caller_id_name 的值改为 Jack，然后存盘退出。如：</p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">&lt;variable</span></strong><strong> <span style="color:#006600;">name</span>=<span style="color:#ff0000;">"effective_caller_id_name"</span> <span style="color:#006600;">value</span>=<span style="color:#ff0000;">"Jack"</span><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;">接下来，打开 etc/freeswitch/dialplan/default.xml，找到 \ 一行，改为 \。熟悉正则表达式的人应该知道，“10[01][0-9]$”匹配被叫号码1000-1019。因此我们修改之后的表达式就多匹配了一个1234。FreeSWITCH使用Perl兼容的正则表达式(PCRE)。</p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">    &lt;extension </span></strong><strong><span style="color:#006600;">name</span></strong><strong>=<span style="color:#ff0000;">"Local_Extension"</span><span style="color:#66ff99;">&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">      &lt;condition</span></strong><strong><span style="color:#006600;"> field</span></strong><strong>=<span style="color:#ff0000;">"destination_number"</span> <span style="color:#006600;">expression</span>=<span style="color:#ff0000;">"^8(10[01][0-9])$"</span><span style="color:#66ff99;">&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>  </strong></p> 
<p style="margin-left:0cm;">现在，回到fs_cli，执行 reloadxml 命令或按快捷键F6，使新的配置生效</p> 
<p><a name="_Toc514943614">7</a>、freeswitch用作软电话</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<p><a name="_Toc514943615">8</a>、配置SIP网关拨打外部电话</p> 
<p style="margin-left:0cm;"><strong>如果你在某个运营商拥有SIP</strong><strong>账号</strong>，你就可以配置上拨打外部电话了。该SIP账号（或提供该账号的设备）在 FreeSWITCH 中称为SIP网关（Gateway）。添加一个网关只需要在 etc/freeswitch/sip_profiles/external/ 创建一个XML文件，名字可以随便起，如gw1.xml。</p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">&lt;gateway </span></strong><strong><span style="color:#006600;">name</span></strong><strong>=<span style="color:#ff0000;">"gw1"</span><span style="color:#66ff99;">&gt; </span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">    &lt;param </span></strong><strong><span style="color:#006600;">name</span></strong><strong>=<span style="color:#ff0000;">"realm"</span> <span style="color:#006600;">value</span>=<span style="color:#ff0000;">"SIP</span></strong><strong><span style="color:#ff0000;">服务器地址，可以是</span></strong><strong><span style="color:#ff0000;">IP</span></strong><strong><span style="color:#ff0000;">或</span></strong><strong><span style="color:#ff0000;">IP:</span></strong><strong><span style="color:#ff0000;">端口号</span></strong><strong><span style="color:#ff0000;">"</span></strong><strong><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">    &lt;param </span></strong><strong><span style="color:#006600;">name</span></strong><strong>=<span style="color:#ff0000;">"username"</span> <span style="color:#006600;">value</span>=<span style="color:#ff0000;">"SIP</span></strong><strong><span style="color:#ff0000;">用户名</span></strong><strong><span style="color:#ff0000;">"</span></strong><strong><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">    &lt;param </span></strong><strong><span style="color:#006600;">name</span></strong><strong><span style="color:#66ff99;">=</span></strong><strong><span style="color:#ff0000;">"password"</span></strong><strong> </strong><strong><span style="color:#006600;">value</span></strong><strong>=<span style="color:#ff0000;">"</span></strong><strong><span style="color:#ff0000;">密码</span></strong><strong><span style="color:#ff0000;">"</span></strong><strong><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">    &lt;param </span></strong><strong><span style="color:#006600;">name</span></strong><strong>=<span style="color:#ff0000;">"register"</span> <span style="color:#006600;">value</span>=<span style="color:#ff0000;">"true"</span><span style="color:#66ff99;"> /&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">&lt;/gateway&gt;</span></strong></p> 
<p style="margin-left:0cm;">如果你的SIP网关还需要其它参数，可以参阅同目录下的 example.xml，但一般来说上述参数就够了。你可以重启 FreeSWITCH，或者执行以下命令使用之生效。</p> 
<p style="margin-left:0cm;"><strong>freeswitch@acs&gt; sofia profile external rescan reloadxml</strong></p> 
<p style="margin-left:0cm;">然后显示一下状态：</p> 
<p style="margin-left:0cm;"><strong>freeswitch@acs &gt; sofia status</strong></p> 
<p style="margin-left:0cm;">如果显示 gateway gw1 的状态是 REGED ，则表明正确的注册到了网关上。你可以先用命令试一下网关是否工作正常：</p> 
<p style="margin-left:0cm;"><strong>freeswitch@acs &gt; originate sofia/gateway/gw1/xxxxxx &amp;echo()</strong></p> 
<p style="margin-left:0cm;">以上命令会通过网关 gw1 呼叫号码 xxxxxx（可能是你的手机号），被叫号码接听电话后，FreeSWITCH 会执行 echo() 程序，你应该能听到自己的回音</p> 
<p style="margin-left:0cm;"> </p> 
<p><a name="_Toc514943616">9</a>、从某一分机上呼出</p> 
<p style="margin-left:0cm;">如果网关测试正常，你就可以配置从你的SIP软电话或portaudio呼出了。由于我们是把 FreeSWITCH 当作 PBX 用，我们需要选一个出局字冠。常见的 PBX 一般是内部拨小号，打外部电话就需要加拨 0 或先拨 9 。当然，这是你自己的交换机，你可以用任何你喜欢的数字（甚至是字母）。 继续修改拨号计划，创建新XML文件： etc/freeswitch /dialplan/default/call_out.xml</p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">&lt;include&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">  &lt;extension </span></strong><strong><span style="color:#006600;">name</span></strong><strong>=<span style="color:#ff0000;">"call out"</span><span style="color:#66ff99;">&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">    &lt;condition</span></strong><strong><span style="color:#006600;"> field</span></strong><strong>=<span style="color:#ff0000;">"destination_number"</span> <span style="color:#006600;">expression</span>=<span style="color:#ff0000;">"^0(\d+)$"</span><span style="color:#66ff99;">&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">      &lt;action </span></strong><strong><span style="color:#006600;">application</span></strong><strong>=<span style="color:#ff0000;">"bridge"</span> <span style="color:#006600;">data</span>=<span style="color:#ff0000;">"sofia/gateway/gw1/$1"</span><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">    &lt;/condition&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">  &lt;/extension&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">&lt;/include&gt;</span></strong></p> 
<p style="margin-left:0cm;">其中，(\d+)为正则表达式，匹配 0 后面的所有数字并存到变量 $1 中。然后通过 bridge 程序通过网关 gw1 打出该号码。当然，建立该XML后需要在Fs-Con中执行 reloadxml 使用之生效。</p> 
<p style="margin-left:0cm;"> </p> 
<p><a name="_Toc514943617">10</a>、呼入电话处理。</p> 
<p style="margin-left:0cm;">如果你的 SIP 网关支持呼入，那么你需要知道呼入的 DID 。 DID的全称是 Direct Inbound Dial，即直接呼入。一般来说，呼入的 DID 就是你的 SIP 号码，如果你不知道，也没关系，后面你会学会如何得到。 编辑以下XML文件放到 etc/freeswitch /dialplan/public/my_did.xml</p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">&lt;include&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">  &lt;extension </span></strong><strong><span style="color:#006600;">name</span></strong><strong>=<span style="color:#ff0000;">"public_did"</span><span style="color:#66ff99;">&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">    &lt;condition </span></strong><strong><span style="color:#006600;">field</span></strong><strong>=<span style="color:#ff0000;">"destination_number"</span> <span style="color:#006600;">expression</span>=<span style="color:#ff0000;">"^(</span></strong><strong><span style="color:#ff0000;">你的</span></strong><strong><span style="color:#ff0000;">DID)$"</span></strong><strong><span style="color:#66ff99;">&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">      &lt;action </span></strong><strong><span style="color:#006600;">application</span></strong><strong>=<span style="color:#ff0000;">"transfer"</span> <span style="color:#006600;">data</span>=<span style="color:#ff0000;">"1000 XML default"</span><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">    &lt;/condition&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">  &lt;/extension&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">&lt;/include&gt;</span></strong></p> 
<p style="margin-left:0cm;">reloadxml 使之生效。上述配置会将来话直接转接到分机 1000 上</p> 
<p style="margin-left:0cm;"> </p> 
<p><a name="_Toc514943618">11</a>、测试freeswitch视频会议</p> 
<p style="margin-left:0cm;">链接地址：http://www.dujinfang.com/2011/04/24/ce-shi-freeswitch-shi-pin-hui-yi.html</p> 
<p style="margin-left:0cm;">一直想测一直 FreeSWITCH 的视频会议功能，但以前只有两个支持 H263 的设备 (Huawei视频电话及一个 Xlite），未能好好体验。最近买了两个 XPT8886 视频电话及一个 Bria 软电话授权，总算是可以测试三方会议了。</p> 
<p style="margin-left:0cm;">首先，要在 sofia profile 中设置支持的视频编码，简单起见我直接在 vars.xml 中设置了：</p> 
<p style="margin-left:0cm;">&lt;X-PRE-PROCESS cmd="set" data="global_codec_prefs=PCMU,PCMA,GSM,H264,H263-1998,H263"/&gt;</p> 
<p style="margin-left:0cm;">&lt;X-PRE-PROCESS cmd="set" data="outbound_codec_prefs=PCMU,PCMA,GSM,H264,H263-1998,H263"/&gt;</p> 
<p style="margin-left:0cm;">首先将所有视频设备设成只支持 H263，让我所有支持视频的设备连接互拨，测试均正常。然后将所有电话打入默认的电话会议号码 3000 ，电话会议正常。经过研究源代码，发现流程是这样的：</p> 
<ul><li>每个会议里都有一个 video 线程</li><li>每个会议里会有一个标志，叫做 floor，一般来说，当前正在发言的人会拥有这个 floor</li><li>拥有 floor 的人的视频会广播到所有的终端上，包括它自己</li></ul> 
<p style="margin-left:0cm;">如果在会议中，另一个人开始讲话，视频就会发生切换，但切换的画面会出现马赛克，而且有些慢，即使在局域网环境中也如此。</p> 
<p style="margin-left:0cm;">接下来测试 H264，由于我华为的设备不支持H264只好放到一边了。</p> 
<p style="margin-left:0cm;">全部打入 3000 以后发现 XPT8886 终端的视频不能正常显示，而 Bria 的则正常。百般测试无果只好查看源代码了，最后发现，在 mod_conference 的 1011 行左右，有一段检测 i-frame 的代码，对于 Bria 能检测通过，而 XPT8886 发出的 RTP 包无论如何都检测不通过，后来，直接将其改成 iframe = 1 ，视频功能正常。</p> 
<p style="margin-left:0cm;">} else if (vid_frame-&gt;codec-&gt;implementation-&gt;ianacode == 99) {  /* h.264 */</p> 
<p style="margin-left:0cm;">    iframe = (*((int16_t *) vid_frame-&gt;data) &gt;&gt; 5 == 0x11);</p> 
<p style="margin-left:0cm;">画质明显比 H263 好得多，切换也快得多。</p> 
<p style="margin-left:0cm;">在广域网的环境下测了一下，效果还不错。连接美国的 FreeSWITCH 服务器，发现视频质量很差，当然了，视频需要到美国绕一圈再回来，当然会大打折扣。准备哪天找个老外测一测，看看效果</p> 
<p style="margin-left:0cm;"> </p> 
<p><a name="_Toc514943619">12</a>、freeswitch中的语音识别</p> 
<p style="margin-left:0cm;">链接地址：<a href="http://www.dujinfang.com/2010/09/07/ye-tan-freeswitch-zhong-yu-yin-shi-bie.html" rel="nofollow">http://www.dujinfang.com/2010/09/07/ye-tan-freeswitch-zhong-yu-yin-shi-bie.html</a></p> 
<p style="margin-left:0cm;"> </p> 
<p><a name="_Toc514943620">13</a>、在 FreeSWITCH 中使用 google translate 进行文本语音转换</p> 
<p style="margin-left:0cm;">链接地址：<a href="http://www.dujinfang.com/2010/10/28/zai-freeswitch-zhong-shi-yong-google-translate-jin-xing-wen-ben-yu-yin-zhuan-huan.html" rel="nofollow">http://www.dujinfang.com/2010/10/28/zai-freeswitch-zhong-shi-yong-google-translate-jin-xing-wen-ben-yu-yin-zhuan-huan.html</a></p> 
<p style="margin-left:0cm;"> </p> 
<h3 style="margin-left:0cm;"><a name="_Toc514943621">二、Freeswitch</a>配置</h3> 
<h4 style="margin-left:0cm;"><a name="_Toc514943622">1</a>、基础配置</h4> 
<p style="margin-left:0cm;">修改配置文件</p> 
<p style="margin-left:0cm;"><strong>[root@acs ~]# vim /usr/local/freeswitch/etc/freeswitch/autoload_configs/event_socket.conf.xml</strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">&lt;configuration</span></strong><strong> <span style="color:#006600;">name</span>=<span style="color:#ff0000;">"event_socket.conf"</span> <span style="color:#006600;">description</span>=<span style="color:#ff0000;">"Socket Client"</span><span style="color:#66ff99;">&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">  &lt;settings&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>    <span style="color:#66ff99;">&lt;param </span><span style="color:#006600;">name</span>=<span style="color:#ff0000;">"nat-map"</span> <span style="color:#006600;">value</span>=<span style="color:#ff0000;">"false"</span><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>   <span style="color:#66ff99;"> &lt;param</span><span style="color:#006600;"> name</span>=<span style="color:#ff0000;">"listen-ip"</span> <span style="color:#006600;">value</span>=<span style="color:#ff0000;">"0.0.0.0"</span><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>    <span style="color:#66ff99;">&lt;param</span> <span style="color:#006600;">name</span>=<span style="color:#ff0000;">"listen-port"</span> <span style="color:#006600;">value</span>=<span style="color:#ff0000;">"8021"</span><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>    <span style="color:#66ff99;">&lt;param</span> <span style="color:#006600;">name</span>=<span style="color:#ff0000;">"password"</span> <span style="color:#006600;">value</span>=<span style="color:#ff0000;">"ClueCon"</span><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>   <span style="color:#66ff99;"> &lt;param</span> <span style="color:#006600;">name</span>=<span style="color:#ff0000;">"apply-inbound-acl"</span> <span style="color:#006600;">value</span>=<span style="color:#ff0000;">"lan"</span><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>    <span style="color:#1f4e79;">&lt;!--&lt;param name="apply-inbound-acl" value="loopback.auto"/&gt;--&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#1f4e79;">    &lt;!--&lt;param name="stop-on-bind-error" value="true"/&gt;--&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>  <span style="color:#66ff99;">&lt;/settings&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">&lt;/configuration&gt;</span></strong></p> 
<p style="margin-left:0cm;">来源地址的ACL控制</p> 
<p style="margin-left:0cm;"><strong>[root@acs ~]# vim /usr/local/freeswitch/etc/freeswitch/autoload_configs/acl.conf.xml</strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">&lt;configuration </span></strong><strong><span style="color:#006600;">name</span></strong><strong>=<span style="color:#ff0000;">"acl.conf"</span> <span style="color:#006600;">description</span>=<span style="color:#ff0000;">"Network Lists"</span><span style="color:#66ff99;">&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong> <span style="color:#66ff99;"> &lt;network-lists&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#1f4e79;">    &lt;!-- </span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#1f4e79;">         These ACL's are automatically created on startup.</span></strong></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><strong><span style="color:#1f4e79;">         rfc1918.auto  - RFC1918 Space</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#1f4e79;">         nat.auto      - RFC1918 Excluding your local lan.</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#1f4e79;">         localnet.auto - ACL for your local lan.</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#1f4e79;">         loopback.auto - ACL for your local lan.</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#1f4e79;">    --&gt;</span></strong></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><strong>   <span style="color:#66ff99;"> &lt;list </span><span style="color:#006600;">name</span>=<span style="color:#ff0000;">"lan"</span> <span style="color:#006600;">default</span>=<span style="color:#ff0000;">"allow"</span><span style="color:#66ff99;">&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>      <span style="color:#66ff99;">&lt;node</span><span style="color:#006600;"> type</span>=<span style="color:#ff0000;">"deny"</span><span style="color:#006600;"> cidr</span>=<span style="color:#ff0000;">"192.168.42.0/24"</span><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>      <span style="color:#66ff99;">&lt;node</span><span style="color:#006600;"> type</span>=<span style="color:#ff0000;">"allow" </span><span style="color:#006600;">cidr</span>=<span style="color:#ff0000;">"192.168.42.42/32"</span><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>      <span style="color:#66ff99;">&lt;node</span> <span style="color:#006600;">type</span>=<span style="color:#ff0000;">"allow"</span> <span style="color:#006600;">cidr</span>=<span style="color:#ff0000;">"0.0.0.0/32"</span><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>   <span style="color:#66ff99;"> &lt;/list&gt;</span></strong></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><strong><span style="color:#1f4e79;">    &lt;!--</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#1f4e79;">        This will traverse the directory adding all users </span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#1f4e79;">        with the cidr= tag to this ACL, when this ACL matches</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#1f4e79;">        the users variables and params apply as if they </span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#1f4e79;">        digest authenticated.</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#1f4e79;">    --&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>    <span style="color:#66ff99;">&lt;list </span><span style="color:#006600;">name</span>=<span style="color:#ff0000;">"domains"</span> <span style="color:#006600;">default</span>=<span style="color:#ff0000;">"deny"</span><span style="color:#66ff99;">&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>      <span style="color:#1f4e79;">&lt;!-- domain= is special it scans the domain from the directory to build the ACL --&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>     <span style="color:#66ff99;"> &lt;node</span> <span style="color:#006600;">type</span>=<span style="color:#ff0000;">"allow"</span> <span style="color:#006600;">domain</span>=<span style="color:#ff0000;">"$${domain}"</span><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>    <span style="color:#1f4e79;">  &lt;!-- use cidr= if you wish to allow ip ranges to this domains acl. --&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#1f4e79;">      &lt;!-- &lt;node type="allow" cidr="192.168.0.0/24"/&gt; --&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">    &lt;/list&gt;</span></strong></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">  &lt;/network-lists&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">&lt;/configuration&gt;</span></strong></p> 
<p style="margin-left:0cm;"> </p> 
<h4 style="margin-left:0cm;"><a name="_Toc514943623">2</a>、拨号规则配置</h4> 
<p style="margin-left:0cm;"><strong>[root@acs ~]# vim /usr/local/freeswitch/etc/freeswitch/dialplan/default.xml</strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#0070c0;">&lt;?</span></strong><strong><span style="color:#006600;">xml version</span></strong><strong>=<span style="color:#ff0000;">"1.0"</span> <span style="color:#006600;">encoding</span>=<span style="color:#ff0000;">"utf-8"</span><span style="color:#0070c0;">?&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#0070c0;">&lt;!--</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#0070c0;">    NOTICE:</span></strong></p> 
<p style="margin-left:0cm;"><strong>    </strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#0070c0;">    This context is usually accessed via authenticated callers on the sip profile on port 5060 </span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#0070c0;">    or transfered callers from the public context which arrived via the sip profile on port 5080.</span></strong></p> 
<p style="margin-left:0cm;"><strong>    </strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#0070c0;">    Authenticated users will use the user_context variable on the user to determine what context</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#0070c0;">    they can access.  You can also add a user in the directory with the cidr= attribute acl.conf.xml</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#0070c0;">    will build the domains ACL using this value.</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#0070c0;">--&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#0070c0;">&lt;!-- http://wiki.freeswitch.org/wiki/Dialplan_XML --&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">&lt;include&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">  &lt;context</span></strong><strong><span style="color:#006600;"> name</span></strong><strong>=<span style="color:#ff0000;">"default"</span><span style="color:#66ff99;">&gt;</span></strong></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><strong>   <span style="color:#66ff99;"> &lt;extension</span> <span style="color:#006600;">name</span>=<span style="color:#ff0000;">"unloop"</span><span style="color:#66ff99;">&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>     <span style="color:#66ff99;"> &lt;condition</span> <span style="color:#006600;">field</span>=<span style="color:#ff0000;">"${unroll_loops}"</span> <span style="color:#006600;">expression</span>=<span style="color:#ff0000;">"^true$"</span><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>     <span style="color:#66ff99;"> &lt;condition</span> <span style="color:#006600;">field</span>=<span style="color:#ff0000;">"${sip_looped_call}"</span><span style="color:#006600;"> expression</span>=<span style="color:#ff0000;">"^true$"</span><span style="color:#66ff99;">&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>        <span style="color:#66ff99;">&lt;action</span> <span style="color:#006600;">application</span>=<span style="color:#ff0000;">"deflect"</span> <span style="color:#006600;">data</span>=<span style="color:#ff0000;">"${destination_number}"</span><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>     <span style="color:#66ff99;"> &lt;/condition&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">    &lt;/extension&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#0070c0;">&lt;!—</span></strong><strong><span style="color:#0070c0;">呼出规则</span></strong><strong><span style="color:#0070c0;">--&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>   <span style="color:#66ff99;"> &lt;extension</span> <span style="color:#006600;">name</span>=<span style="color:#ff0000;">"callout"</span><span style="color:#66ff99;">&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>   <span style="color:#66ff99;">     &lt;condition</span><span style="color:#006600;"> field</span>=<span style="color:#ff0000;">"destination_number"</span> <span style="color:#006600;">expression</span>=<span style="color:#ff0000;">"^0(01|1\d{10})-(.*)$"</span><span style="color:#66ff99;">&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>       <span style="color:#66ff99;"> &lt;action</span> <span style="color:#006600;">application</span>=<span style="color:#ff0000;">"log"</span><span style="color:#006600;"> data</span>=<span style="color:#ff0000;">"ERROR hhhhhhh, I know you call ${destination_number} LLL $2 LLLLL $1 "</span><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>       <span style="color:#66ff99;"> &lt;action</span><span style="color:#006600;"> application</span>=<span style="color:#ff0000;">"set"</span> <span style="color:#006600;">dat</span>a=<span style="color:#ff0000;">"RECORD_TITLE=Recording ${destination_number} ${caller_id_number} ${strftime(%Y-%m-%d %H:%M)}"</span><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>    <span style="color:#66ff99;">     &lt;action</span><span style="color:#006600;"> application</span>=<span style="color:#ff0000;">"set"</span> <span style="color:#006600;">data</span>=<span style="color:#ff0000;">"RECORD_COPYRIGHT=(c) 2011"</span><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>       <span style="color:#66ff99;">  &lt;action</span><span style="color:#006600;"> application</span>=<span style="color:#ff0000;">"set"</span> <span style="color:#006600;">data</span>=<span style="color:#ff0000;">"RECORD_SOFTWARE=FreeSWITCH"</span><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>        <span style="color:#66ff99;"> &lt;action</span> <span style="color:#006600;">application</span>=<span style="color:#ff0000;">"set"</span> <span style="color:#006600;">data</span>=<span style="color:#ff0000;">"RECORD_ARTIST=FreeSWITCH"</span><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>        <span style="color:#66ff99;"> &lt;action</span> <span style="color:#006600;">application</span>=<span style="color:#ff0000;">"set"</span> <span style="color:#006600;">data</span>=<span style="color:#ff0000;">"RECORD_COMMENT=FreeSWITCH"</span><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>       <span style="color:#66ff99;">  &lt;action</span> <span style="color:#006600;">application</span>=<span style="color:#ff0000;">"set"</span> <span style="color:#006600;">data</span>=<span style="color:#ff0000;">"RECORD_DATE=${strftime(%Y-%m-%d %H:%M)}</span><span style="color:#66ff99;">"/&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>       <span style="color:#0070c0;">   &lt;!--</span></strong><strong><span style="color:#0070c0;">立体音</span></strong><strong><span style="color:#0070c0;">--&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>       <span style="color:#0070c0;"> &lt;!-- &lt;action application="set" data="RECORD_STEREO=true"/&gt;--&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#0070c0;">          &lt;!--</span></strong><strong><span style="color:#0070c0;">不应答不录音</span></strong><strong><span style="color:#0070c0;">--&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>        <span style="color:#66ff99;"> &lt;action</span> <span style="color:#006600;">application</span>=<span style="color:#ff0000;">"set"</span> <span style="color:#006600;">data</span>=<span style="color:#ff0000;">"RECORD_ANSWER_REQ=true"</span><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><strong>        <span style="color:#66ff99;"> &lt;action</span> <span style="color:#006600;">application</span>=<span style="color:#ff0000;">"record_session" </span><span style="color:#006600;">data</span>=<span style="color:#ff0000;">"/root/temp/${company}/${caller_id_number}/$2/${caller_id_number}_$2_$1_${strftime(%y%m%d%H%M%S)}.wav"</span><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">         &lt;action</span></strong><strong> <span style="color:#006600;">application</span>=<span style="color:#ff0000;">"bridge"</span> <span style="color:#006600;">data</span>=<span style="color:#ff0000;">"sofia/external/${accountcode}$1@222.130.134.29:15060"</span><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>      <span style="color:#66ff99;"> &lt;/condition&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">    &lt;/extension&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">&lt;extension</span></strong><strong><span style="color:#006600;"> name</span></strong><strong>=<span style="color:#ff0000;">"callin"</span>&gt;</strong></p> 
<p style="margin-left:0cm;"><strong>       <span style="color:#66ff99;">&lt;condition</span><span style="color:#006600;"> field</span>=<span style="color:#ff0000;">"destination_number"</span> <span style="color:#006600;">expression</span>=<span style="color:#ff0000;">"^(1\d{10})$"</span><span style="color:#66ff99;">&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>          <span style="color:#66ff99;">&lt;action</span> <span style="color:#006600;">application</span>=<span style="color:#ff0000;">"record_session" </span><span style="color:#006600;">data</span>=<span style="color:#ff0000;">"/root/temp/${company}/${strftime(%Y%m%d%H%M%S)}_${caller_id_number}_$1.wav</span><span style="color:#66ff99;">"/&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>          <span style="color:#66ff99;">&lt;action</span><span style="color:#006600;"> application</span>=<span style="color:#ff0000;">"bridge" </span><span style="color:#006600;">data</span>=<span style="color:#ff0000;">"sofia/external/${accountcode}$1@61.51.110.204:15060"</span><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>          <span style="color:#66ff99;">&lt;action</span> <span style="color:#006600;">application</span>=<span style="color:#ff0000;">"log"</span> <span style="color:#006600;">data</span>=<span style="color:#ff0000;">"ERROR hhhhhhh,${outbound_caller_id_name}        ${outbound_caller_id_number}    I know you call ${destination_number} L         ${domain_name}      LL $2 LLLLL $1 "</span><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>     <span style="color:#66ff99;">  &lt;/condition&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">    &lt;/extension&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>        <span style="color:#66ff99;">&lt;extension</span> <span style="color:#006600;">name</span>=<span style="color:#ff0000;">"call_out_0"</span><span style="color:#66ff99;">&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>       <span style="color:#66ff99;">&lt;condition</span> <span style="color:#006600;">field</span>=<span style="color:#ff0000;">"destination_number" </span><span style="color:#006600;">expression</span>=<span style="color:#ff0000;">"^(01\d{10})$"</span><span style="color:#66ff99;">&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>          <span style="color:#66ff99;">&lt;action</span><span style="color:#006600;"> application</span>=<span style="color:#ff0000;">"record_session" </span><span style="color:#006600;">data</span>=<span style="color:#ff0000;">"/root/temp/${company}/${strftime(%Y%m%d%H%M%S)}_${caller_id_number}_$1.wav"</span><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>          <span style="color:#66ff99;">&lt;action</span><span style="color:#006600;"> application</span>=<span style="color:#ff0000;">"bridge"</span> <span style="color:#006600;">data</span>=<span style="color:#ff0000;">"sofia/external/${accountcode}$1@61.51.110.204:15060"</span><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>          <span style="color:#66ff99;">&lt;action</span><span style="color:#006600;"> application</span>=<span style="color:#ff0000;">"log" </span><span style="color:#006600;">data</span>=<span style="color:#ff0000;">"ERROR hhhhhhh,${outbound_caller_id_name}        ${outbound_caller_id_number}    I know you call ${destination_number} L         ${domain_name}      LL $2 LLLLL $1 "</span><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">       &lt;/condition&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">    &lt;/extension&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">&lt;extension</span></strong><strong><span style="color:#006600;"> name</span></strong><strong>=<span style="color:#ff0000;">"call-out-gateway"</span><span style="color:#66ff99;">&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>       <span style="color:#66ff99;">&lt;condition</span> <span style="color:#006600;">field</span>=<span style="color:#ff0000;">"destination_number"</span> <span style="color:#006600;">expression</span>=<span style="color:#ff0000;">"^2(1\d{10})$"</span><span style="color:#66ff99;">&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>          <span style="color:#66ff99;">&lt;action</span> <span style="color:#006600;">application</span>=<span style="color:#ff0000;">"bridge"</span> <span style="color:#006600;">data</span>=<span style="color:#ff0000;">"sofia/gateway/test/$1"</span><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>          <span style="color:#66ff99;">&lt;action</span><span style="color:#006600;"> application</span>=<span style="color:#ff0000;">"info"</span> <span style="color:#006600;">data</span>=<span style="color:#ff0000;">"ERROR hhhhhhh,   I know you call ${destination_number} LLL $2 LLLLL $1 "</span><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>       <span style="color:#66ff99;">&lt;/condition&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">    &lt;/extension&gt;</span></strong></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><strong>  <span style="color:#0070c0;">  &lt;!-- Example of doing things based on time of day. </span></strong></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><strong><span style="color:#0070c0;">         year = 4 digit year. Example year="2009"</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#0070c0;">         yday = 1-365</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#0070c0;">         mon = 1-12</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#0070c0;">         mday = 1-31</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#0070c0;">         week = 1-52</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#0070c0;">         mweek= 1-6</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#0070c0;">         wday = 1-7</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#0070c0;">         hour = 0-23</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#0070c0;">         minute = 0-59</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#0070c0;">         minute-of-day = 1-1440</span></strong></p> 
<p style="margin-left:0cm;"><strong>         </strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#0070c0;">         Example:</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#0070c0;">         &lt;condition minute-of-day="540-1080"&gt; (9am to 6pm EVERY day)</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#0070c0;">         do something ...</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#0070c0;">         &lt;/condition&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#0070c0;">    --&gt;</span></strong></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<h4 style="margin-left:0cm;"><a name="_Toc514943624">3</a>、NAT穿透配置</h4> 
<p><a name="_Toc514943625">（一）、freeswitch</a>帮助终端穿越NAT解决方案</p> 
<ol><li>SIP穿越</li></ol> 
<p style="margin-left:0cm;">Freeswitch默认使用acl来判断对方是否处于NAT环境中，配置如下</p> 
<p style="margin-left:0cm;"><strong>[root@acs ~]# vim /usr/local/freeswitch/etc/freeswitch/sip_profiles/internal.xml</strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">&lt;param </span></strong><strong><span style="color:#006600;">name</span></strong><strong>=<span style="color:#ff0000;">"apply-nat-acl" </span><span style="color:#006600;">value</span>=<span style="color:#ff0000;">"nat.auto"</span><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;">nat.auto是一个ACL，包含了RFC1918规定的私网地址，并去掉了本地网络的地址。当SIP终端注册时，通过比较contact地址是否包含在此ACL中来判定该终端是否处于NAT背后，如果是那么它就把contact地址自动替换为SIP包的来源地址，后边的呼叫就可以正常抵达。</p> 
<p style="margin-left:0cm;">在实际工作当中，当局域网内架设另一个无法直接互通的子网时，信令无法正常抵达子网终端，那么就需要改为无论何种情况都使用SIP包的来源地址作为用户的contact地址。</p> 
<p style="margin-left:0cm;"> </p> 
<ol><li>RTP穿越</li></ol> 
<p style="margin-left:0cm;">NAT环境下SIP终端SDP信息中的IP地址是私网地址，因此freeswitch无法直接发送RTP包，而NAT设备基本都只允许内网主机曾经接触过的外网主机发送的UDP数据包进入。FreeSWITCH使用了一个名为RTP自动调整的特性，在SIP协商时给对方一个可用的公网RTP地址，然后等待客户端发送RTP包，一旦FreeSWITCH收到RTP包后，就可以根据对方发包的地址给它发RTP包了。此类情况发生时，Log中可看到类似信息：</p> 
<p style="margin-left:0cm;"><strong>[root@acs ~]# more /usr/local/freeswitch/var/log/freeswitch/freeswitch.log |grep switch_rtp.c</strong></p> 
<p style="margin-left:0cm;"><strong>4451c6b1-d422-40e0-af5f-f2547362f474 2018-05-24 11:20:53.277797 [INFO] switch_rtp.c:7268 Auto Changing audio port from 192.168.1.198:44978 to 61.51.110.204:44978</strong></p> 
<p style="margin-left:0cm;"><strong>71ec152b-a453-4e89-9b16-fc4ecf991d38 2018-05-24 11:20:53.497801 [DEBUG] switch_rtp.c:4137 Starting timer [soft] 160 bytes per 20ms</strong></p> 
<p style="margin-left:0cm;"><strong>71ec152b-a453-4e89-9b16-fc4ecf991d38 2018-05-24 11:20:55.397813<span style="color:#ffff00;"> [INFO] switch_rtp.c:7268 Auto Changing audio port from 192.168.1.101:8074 to 61.51.110.204:8074</span></strong></p> 
<p style="margin-left:0cm;">注意：此办法存在安全性问题，如某黑客向随机的RTP端口发数据包，FreeSWITCH收到后将远端地址调整到黑客的IP和端口，进而RTP数据全部跑歪了。所以为了防止这个问题，FreeSWITCH规定这种端口调整只能在电话开始的时候进行，且仅支持一次调整。自动调整的功能默认是开启的，配置如下：</p> 
<p style="margin-left:0cm;"><strong>[root@acs ~]# vim /usr/local/freeswitch/etc/freeswitch/sip_profiles/internal.xml</strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">&lt;param </span></strong><strong><span style="color:#006600;">name</span></strong><strong>=<span style="color:#ff0000;">"disable-rtp-auto-adjust"</span> <span style="color:#006600;">value</span>=<span style="color:#ff0000;">"false"</span><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;">或者仅针对个别的呼叫来禁用自动调整，在呼叫时设置通道变量"rtp_auto_adjust=false"来禁止</p> 
<p style="margin-left:0cm;"> </p> 
<p><a name="_Toc514943626">（二）、freeswitch</a>处于NAT后面的解决方案</p> 
<p style="margin-left:0cm;">1、如果路由支持uPnP或NAT-PMP协议</p> 
<p style="margin-left:0cm;">   FreeSWITCH支持通过uPnP或NAT-PMP协议在路由器上“打洞”，打洞完成后就知道自己将要映射的外网地址了，前提是路由器支持uPnp功能并开通。Freeswitch配置如下：</p> 
<p style="margin-left:0cm;"><strong>[root@acs ~]# vim /usr/local/freeswitch/etc/freeswitch/sip_profiles/external.xml</strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">&lt;param</span></strong><strong> </strong><strong><span style="color:#006600;">name</span></strong><strong>=<span style="color:#ff0000;">"ext-rtp-ip"</span> <span style="color:#006600;">value</span>=<span style="color:#ff0000;">"auto-nat"</span><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">&lt;param</span></strong><strong> </strong><strong><span style="color:#006600;">name</span></strong><strong>=<span style="color:#ff0000;">"ext-sip-ip"</span> <span style="color:#006600;">value</span>=<span style="color:#ff0000;">"auto-nat"</span><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;">FreeSWITCH检测到NAT以后，设置Profile的外网SIP和RTP的IP，通过命令可查询Ext-SIP-IP和Ext-RTP-IP的值，如下：</p> 
<p style="margin-left:0cm;"><strong>freeswitch@VM_56_176_centos&gt; sofia status profile external</strong></p> 
<p style="margin-left:0cm;"><strong>=================================================================================================</strong></p> 
<p style="margin-left:0cm;"><strong>Name                      external</strong></p> 
<p style="margin-left:0cm;"><strong>Domain Name              N/A</strong></p> 
<p style="margin-left:0cm;"><strong>Auto-NAT         false</strong></p> 
<p style="margin-left:0cm;"><strong>DBName                  sofia_reg_external</strong></p> 
<p style="margin-left:0cm;"><strong>Pres Hosts         </strong></p> 
<p style="margin-left:0cm;"><strong>Dialplan             XML</strong></p> 
<p style="margin-left:0cm;"><strong>Context            public</strong></p> 
<p style="margin-left:0cm;"><strong>Challenge Realm  auto_to</strong></p> 
<p style="margin-left:0cm;"><strong>RTP-IP             10.163.56.176</strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#ffff00;">Ext-RTP-IP          123.207.172.132</span></strong></p> 
<p style="margin-left:0cm;"><strong>SIP-IP               10.163.56.176</strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#ffff00;">Ext-SIP-IP           123.207.172.132</span></strong></p> 
<p style="margin-left:0cm;"><strong>URL              sip:mod_sofia@123.207.172.132:5080</strong></p> 
<p style="margin-left:0cm;"><strong>BIND-URL                  sip:mod_sofia@123.207.172.132:5080;maddr=10.163.56.176;transport=udp,tcp</strong></p> 
<p style="margin-left:0cm;"><strong>…………………………………………</strong></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">2、手动设置，当路由不支持uPnP和NAT-PMP协议是，需要手动设置，freeswitch配置如下：</p> 
<p style="margin-left:0cm;"><strong>[root@acs ~]# vim /usr/local/freeswitch/etc/freeswitch/sip_profiles/external.xml</strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">&lt;param</span></strong><strong> </strong><strong><span style="color:#006600;">name</span></strong><strong>=<span style="color:#ff0000;">"ext-rtp-ip"</span> <span style="color:#006600;">value</span>=<span style="color:#ff0000;">"autonat:1.2.3.4"</span><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">&lt;param</span></strong><strong> </strong><strong><span style="color:#006600;">name</span></strong><strong>=<span style="color:#ff0000;">"ext-sip-ip"</span> <span style="color:#006600;">value</span>=<span style="color:#ff0000;">"autonat:1.2.3.4"</span><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;">或者</p> 
<p style="margin-left:0cm;"><strong>[root@acs ~]# vim /usr/local/freeswitch/etc/freeswitch/sip_profiles/external.xml</strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">&lt;param</span></strong><strong> </strong><strong><span style="color:#006600;">name</span></strong><strong>=<span style="color:#ff0000;">"ext-rtp-ip"</span> <span style="color:#006600;">value</span>=<span style="color:#ff0000;">" 1.2.3.4"</span><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">&lt;param</span></strong><strong> </strong><strong><span style="color:#006600;">name</span></strong><strong>=<span style="color:#ff0000;">"ext-sip-ip"</span> <span style="color:#006600;">value</span>=<span style="color:#ff0000;">" 1.2.3.4"</span><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<p><a name="_Toc514943627">（三）其他NAT</a>穿透相关设置</p> 
<p style="margin-left:0cm;">1、开启rport功能（默认是开启的）</p> 
<p style="margin-left:0cm;"><strong>[root@acs ~]# vim /usr/local/freeswitch/etc/freeswitch/sip_profiles/internal.xml</strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">&lt;param</span></strong><strong> </strong><strong><span style="color:#006600;">name</span></strong><strong>=<span style="color:#ff0000;">"NDLB-force-rport"</span><span style="color:#006600;"> value</span>=<span style="color:#ff0000;">"true"</span><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;">2、针对没有rport功能的终端，在reg.xml中加入</p> 
<p style="margin-left:0cm;"><strong>[root@acs ~]# </strong></p> 
<p style="margin-left:0cm;">&lt;variablename="sip-force-contact"value="NDLB-connectile-dysfunction"/&gt;</p> 
<ol><li>检查acl参数，确定没有阻挡</li></ol> 
<p style="margin-left:0cm;">注意：此处做ACL控制，目前是全部放开，一旦发现可疑的攻击服务器的IP地址就需要加入到deny中阻止。</p> 
<p style="margin-left:0cm;"><strong>[root@acs ~]# vim /usr/local/freeswitch/etc/freeswitch/autoload_configs/acl.conf.xml</strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">&lt;configuration</span></strong><strong> <span style="color:#006600;">name</span>=<span style="color:#ff0000;">"acl.conf" </span><span style="color:#006600;">description</span>=<span style="color:#ff0000;">"Network Lists"</span><span style="color:#66ff99;">&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">  &lt;network-lists&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#0070c0;">    &lt;!-- </span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#0070c0;">         These ACL's are automatically created on startup.</span></strong></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><strong><span style="color:#0070c0;">         rfc1918.auto  - RFC1918 Space</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#0070c0;">         nat.auto      - RFC1918 Excluding your local lan.</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#0070c0;">         localnet.auto - ACL for your local lan.</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#0070c0;">         loopback.auto - ACL for your local lan.</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#0070c0;">    --&gt;</span></strong></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><strong>    <span style="color:#66ff99;">&lt;list</span> <span style="color:#006600;">name</span>=<span style="color:#ff0000;">"lan"</span> <span style="color:#006600;">default</span>=<span style="color:#ff0000;">"allow"</span><span style="color:#66ff99;">&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>      <span style="color:#66ff99;">&lt;node</span> <span style="color:#006600;">type</span>=<span style="color:#ff0000;">"deny"</span> <span style="color:#006600;">cidr</span>=<span style="color:#ff0000;">"192.168.42.0/24"</span><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>    <span style="color:#66ff99;">  &lt;node</span><span style="color:#006600;"> type</span>=<span style="color:#ff0000;">"allow"</span> <span style="color:#006600;">cidr</span>=<span style="color:#ff0000;">"192.168.42.42/32"</span><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>     <span style="color:#66ff99;"> &lt;node</span><span style="color:#006600;"> type</span>=<span style="color:#ff0000;">"allow"</span> <span style="color:#006600;">cidr</span>=<span style="color:#ff0000;">"0.0.0.0/32"</span><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>   <span style="color:#66ff99;"> &lt;/list&gt;</span></strong></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><strong><span style="color:#0070c0;">    &lt;!--</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#0070c0;">        This will traverse the directory adding all users </span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#0070c0;">        with the cidr= tag to this ACL, when this ACL matches</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#0070c0;">        the users variables and params apply as if they </span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#0070c0;">        digest authenticated.</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#0070c0;">    --&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>   <span style="color:#66ff99;"> &lt;list</span> <span style="color:#006600;">name</span>=<span style="color:#ff0000;">"domains"</span> <span style="color:#006600;">default</span>=<span style="color:#ff0000;">"deny"</span><span style="color:#66ff99;">&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>     <span style="color:#0070c0;"> &lt;!-- domain= is special it scans the domain from the directory to build the ACL --&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>    <span style="color:#66ff99;">  &lt;node</span> <span style="color:#006600;">type</span>=<span style="color:#ff0000;">"allow"</span> <span style="color:#006600;">domain</span>=<span style="color:#ff0000;">"$${domain}"</span><span style="color:#66ff99;">/&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>     <span style="color:#0070c0;"> &lt;!-- use cidr= if you wish to allow ip ranges to this domains acl. --&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#0070c0;">      &lt;!-- &lt;node type="allow" cidr="192.168.0.0/24"/&gt; --&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong>   <span style="color:#66ff99;"> &lt;/list&gt;</span></strong></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><strong> <span style="color:#66ff99;"> &lt;/network-lists&gt;</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#66ff99;">&lt;/configuration&gt;</span></strong></p> 
<ol><li>检查路由上的IP的端口映射</li><li>检查freeswitch机器的安全策略，确认表中端口</li></ol> 
<table border="1" cellspacing="0" style="margin-left:-.5pt;width:476pt;"><tbody><tr><td style="border-color:#000000;vertical-align:top;width:45.1pt;"> <p style="margin-left:0cm;"><strong>端口</strong></p> </td><td style="border-color:#000000;vertical-align:top;width:77.05pt;"> <p style="margin-left:0cm;"><strong><span style="color:#333333;">协议</span></strong></p> </td><td style="border-color:#000000;vertical-align:top;width:129.85pt;"> <p style="margin-left:0cm;"><strong><span style="color:#333333;">用途</span></strong></p> </td><td style="border-color:#000000;width:224pt;"> <p style="margin-left:0cm;"><strong><span style="color:#000000;">备注</span></strong></p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:45.1pt;"> <p style="margin-left:0cm;"><span style="color:#ff0000;">1719</span></p> </td><td style="vertical-align:top;width:77.05pt;"> <p style="margin-left:0cm;"><span style="color:#333333;">UDP</span></p> </td><td style="vertical-align:top;width:129.85pt;"> <p style="margin-left:0cm;"><span style="color:#333333;">H.323 Gatekeeper RAS port</span></p> </td><td style="width:224pt;"> <p style="margin-left:0cm;">　</p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:45.1pt;"> <p style="margin-left:0cm;"><span style="color:#ff0000;">1720</span></p> </td><td style="vertical-align:top;width:77.05pt;"> <p style="margin-left:0cm;"><span style="color:#333333;">TCP</span></p> </td><td style="vertical-align:top;width:129.85pt;"> <p style="margin-left:0cm;"><span style="color:#333333;">H.323 Call Signaling</span></p> </td><td style="width:224pt;"> <p style="margin-left:0cm;">　</p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:45.1pt;"> <p style="margin-left:0cm;"><span style="color:#ff0000;">3478</span></p> </td><td style="vertical-align:top;width:77.05pt;"> <p style="margin-left:0cm;"><span style="color:#333333;">UDP</span></p> </td><td style="vertical-align:top;width:129.85pt;"> <p style="margin-left:0cm;"><span style="color:#333333;">STUN service</span></p> </td><td style="vertical-align:top;width:224pt;"> <p style="margin-left:0cm;"><span style="color:#333333;">Used for NAT traversal</span></p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:45.1pt;"> <p style="margin-left:0cm;"><span style="color:#ff0000;">3479</span></p> </td><td style="vertical-align:top;width:77.05pt;"> <p style="margin-left:0cm;"><span style="color:#333333;">UDP</span></p> </td><td style="vertical-align:top;width:129.85pt;"> <p style="margin-left:0cm;"><span style="color:#333333;">STUN service</span></p> </td><td style="vertical-align:top;width:224pt;"> <p style="margin-left:0cm;"><span style="color:#333333;">Used for NAT traversal</span></p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:45.1pt;"> <p style="margin-left:0cm;"><span style="color:#ff0000;">5002</span></p> </td><td style="vertical-align:top;width:77.05pt;"> <p style="margin-left:0cm;"><span style="color:#333333;">TCP</span></p> </td><td style="vertical-align:top;width:129.85pt;"> <p style="margin-left:0cm;"><span style="color:#333333;">MLP protocol server</span></p> </td><td style="width:224pt;"> <p style="margin-left:0cm;">　</p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:45.1pt;"> <p style="margin-left:0cm;"><span style="color:#ff0000;">5003</span></p> </td><td style="vertical-align:top;width:77.05pt;"> <p style="margin-left:0cm;"><span style="color:#333333;">UDP</span></p> </td><td style="vertical-align:top;width:129.85pt;"> <p style="margin-left:0cm;"><span style="color:#333333;">Neighborhood service</span></p> </td><td style="width:224pt;"> <p style="margin-left:0cm;">　</p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:45.1pt;"> <p style="margin-left:0cm;"><span style="color:#ff0000;">5060</span></p> </td><td style="vertical-align:top;width:77.05pt;"> <p style="margin-left:0cm;"><span style="color:#333333;">UDP &amp; TCP</span></p> </td><td style="vertical-align:top;width:129.85pt;"> <p style="margin-left:0cm;"><span style="color:#333333;">SIP UAS</span></p> </td><td style="vertical-align:top;width:224pt;"> <p style="margin-left:0cm;"><span style="color:#333333;">Used for SIP signaling (Standard SIP Port, for default Internal Profile)</span></p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:45.1pt;"> <p style="margin-left:0cm;"><span style="color:#ff0000;">5070</span></p> </td><td style="vertical-align:top;width:77.05pt;"> <p style="margin-left:0cm;"><span style="color:#333333;">UDP &amp; TCP</span></p> </td><td style="vertical-align:top;width:129.85pt;"> <p style="margin-left:0cm;"><span style="color:#333333;">SIP UAS</span></p> </td><td style="vertical-align:top;width:224pt;"> <p style="margin-left:0cm;"><span style="color:#333333;">Used for SIP signaling (For default "NAT" Profile)</span></p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:45.1pt;"> <p style="margin-left:0cm;"><span style="color:#ff0000;">5080</span></p> </td><td style="vertical-align:top;width:77.05pt;"> <p style="margin-left:0cm;"><span style="color:#333333;">UDP &amp; TCP</span></p> </td><td style="vertical-align:top;width:129.85pt;"> <p style="margin-left:0cm;"><span style="color:#333333;">SIP UAS</span></p> </td><td style="vertical-align:top;width:224pt;"> <p style="margin-left:0cm;"><span style="color:#333333;">Used for SIP signaling (For default "External" Profile)</span></p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:45.1pt;"> <p style="margin-left:0cm;"><span style="color:#ff0000;">8021</span></p> </td><td style="vertical-align:top;width:77.05pt;"> <p style="margin-left:0cm;"><span style="color:#333333;">TCP</span></p> </td><td style="vertical-align:top;width:129.85pt;"> <p style="margin-left:0cm;"><span style="color:#333333;">ESL</span></p> </td><td style="vertical-align:top;width:224pt;"> <p style="margin-left:0cm;"><a href="https://wiki.freeswitch.org/wiki/Mod_event_socket" rel="nofollow">Used for mod_event_socket *</a></p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:45.1pt;"> <p style="margin-left:0cm;"><span style="color:#ff0000;">16384-32768</span></p> </td><td style="vertical-align:top;width:77.05pt;"> <p style="margin-left:0cm;"><span style="color:#333333;">UDP</span></p> </td><td style="vertical-align:top;width:129.85pt;"> <p style="margin-left:0cm;"><span style="color:#333333;">RTP/ RTCP multimedia streaming</span></p> </td><td style="vertical-align:top;width:224pt;"> <p style="margin-left:0cm;"><span style="color:#333333;">Used for audio/video data in SIP and other protocols</span></p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:45.1pt;"> <p style="margin-left:0cm;"><span style="color:#ff0000;">5066</span></p> </td><td style="vertical-align:top;width:77.05pt;"> <p style="margin-left:0cm;"><span style="color:#333333;">TCP</span></p> </td><td style="vertical-align:top;width:129.85pt;"> <p style="margin-left:0cm;"><span style="color:#333333;">Websocket</span></p> </td><td style="vertical-align:top;width:224pt;"> <p style="margin-left:0cm;"><span style="color:#333333;">Used for WebRTC</span></p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:45.1pt;"> <p style="margin-left:0cm;"><span style="color:#ff0000;">7443</span></p> </td><td style="vertical-align:top;width:77.05pt;"> <p style="margin-left:0cm;"><span style="color:#333333;">TCP</span></p> </td><td style="vertical-align:top;width:129.85pt;"> <p style="margin-left:0cm;"><span style="color:#333333;">Websocket</span></p> </td><td style="vertical-align:top;width:224pt;"> <p style="margin-left:0cm;"><span style="color:#333333;">Used for WebRTC</span></p> </td></tr></tbody></table> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<h3 style="margin-left:0cm;"><a name="_Toc514943628">三、网关配置</a></h3> 
<p style="margin-left:0cm;">本次使用16O口鼎信网关</p> 
<p style="margin-left:0cm;">首次连接网关，本地电脑需配置成192.168.11.0/24段的地址，网线直连本地电脑和网关设备，在浏览器中访问<a href="http://192.168.11.1" rel="nofollow">http://192.168.11.1</a></p> 
<p style="margin-left:0cm;">首次登陆的默认用户名admin密码admin</p> 
<h4 style="margin-left:0cm;"><a name="_Toc514943629">1</a>、修改本地网络</h4> 
<p style="margin-left:0cm;">修改本地网络，是网络连接到本地网络中。“网络à本地网络”</p> 
<p style="margin-left:0cm;"><img alt="" height="545" src="https://images2.imgbox.com/3f/19/12lwXhk5_o.png" width="708"></p> 
<h4 style="margin-left:0cm;"><a name="_Toc514943630">2</a>、修改登陆密码</h4> 
<p style="margin-left:0cm;">“安全设置à密码修改”，此处可以修改web登陆和telnet登陆的用户名和密码</p> 
<p style="margin-left:0cm;"><img alt="" height="427" src="https://images2.imgbox.com/6b/0b/myC7Gc63_o.png" width="618"></p> 
<h4 style="margin-left:0cm;"><a name="_Toc514943631">3</a>、SIP服务器配置</h4> 
<p style="margin-left:0cm;"><img alt="" height="715" src="https://images2.imgbox.com/8d/72/oEniWjOB_o.png" width="610"></p> 
<h4 style="margin-left:0cm;"><a name="_Toc514943632">4</a>、添加端口或端口组</h4> 
<p style="margin-left:0cm;">把接电话的端口进行配置“端口”，也可以直接配置端口组“呼叫和路由à端口组”</p> 
<p style="margin-left:0cm;"><img alt="" height="522" src="https://images2.imgbox.com/f2/76/dzp5BPpy_o.png" width="621"></p> 
<p style="margin-left:0cm;"><img alt="" height="496" src="https://images2.imgbox.com/35/b9/iJlSgniw_o.png" width="612"></p> 
<p style="margin-left:0cm;"><img alt="" height="527" src="https://images2.imgbox.com/73/90/5d9L4oos_o.png" width="722"></p> 
<h4 style="margin-left:0cm;"><a name="_Toc514943633">5</a>、配置IP中继</h4> 
<p style="margin-left:0cm;"> “呼叫和路由àIP中继”</p> 
<p style="margin-left:0cm;"><img alt="" height="256" src="https://images2.imgbox.com/db/cf/XXJSP0vD_o.png" width="619"></p> 
<h4 style="margin-left:0cm;"><a name="_Toc514943634">6</a>、路由参数配置</h4> 
<p style="margin-left:0cm;"><img alt="" height="180" src="https://images2.imgbox.com/4c/ce/dApVMycx_o.png" width="617"></p> 
<h4 style="margin-left:0cm;"><a name="_Toc514943635">7</a>、配置IPàTel路由</h4> 
<p style="margin-left:0cm;">本次是按端口配置的，这样每个坐席可固定座机电话号码</p> 
<p style="margin-left:0cm;"><img alt="" height="315" src="https://images2.imgbox.com/82/3c/8UoJAIDn_o.png" width="616"></p> 
<h4 style="margin-left:0cm;"><a name="_Toc514943636">8</a>、配置IPàTel被叫号码变更</h4> 
<p style="margin-left:0cm;"><img alt="" height="416" src="https://images2.imgbox.com/60/41/plLtEA7H_o.png" width="626"></p> 
<h4 style="margin-left:0cm;"><a name="_Toc514943637">9</a>、保存完配置之后重启，并将网关接入本地网络</h4> 
<p style="margin-left:0cm;">“工具à设备重启”</p> 
<p style="margin-left:0cm;"><img alt="" height="184" src="https://images2.imgbox.com/90/9c/rAbh1QJm_o.png" width="626"></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">freeswitch拨号规则</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/23930a005efc90e9363728e673879cbb/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">List list=new ArrayList()怎么回事</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/db24b8b3dcf56039cc6d9970cb6a9c86/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">与BSN的链码进行通信互动</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>