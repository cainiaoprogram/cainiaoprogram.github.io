<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Centos7在线安装CDH5 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Centos7在线安装CDH5" />
<meta property="og:description" content="以下步骤亲测有效无误！！！！！
一、 基础环境准备 1）软件清单
Centos7(64位)服务器3台，地址如下：
jdk1.8
Mysql5.7 （必须要5.7的版本！！）
mysql-connector-java-5.1.42-bin.jar
CDH包：https://ro-bucharest-repo.bigstepcloud.com/cloudera-repos/cdh5/parcels/5.15.2/
CM包：https://ro-bucharest-repo.bigstepcloud.com/cloudera-repos/cm5/redhat/7/x86_64/cm/5.15.2/RPMS/x86_64/
2）服务器地址
192.168.56.1 （此地址映射你自己的服务器地址）
192.168.56.2 （此地址映射你自己的服务器地址）
192.168.56.3 （此地址映射你自己的服务器地址）
3）修改hostname
vim /etc/hostname 修改主机名为cdh*后进行以下操作
service network restart 4）配置hosts
vim /etc/hosts 192.168.56.1 cdh1 192.168.56.2 cdh2 192.168.56.3 cdh3 5）免密访问
ssh-keygen -t rsa //三台服务器全都执行以下命令 ssh-copy-id root@cdh1 ssh-copy-id root@cdh2 ssh-copy-id root@cdh1 6）关闭防火墙
systemctl stop firewalld systemctl disable firewalld 7）关闭SELINUX
setenforce 0 vim /etc/sysconfig/selinux SELINUX=disabled 8）配置NTP
yum -y install ntp yum install nfs-utils rpcbind systemctl start rpcbind." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/82aee3433e5fb5d582cf6b2e5c62a7d5/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-02T16:48:49+08:00" />
<meta property="article:modified_time" content="2023-03-02T16:48:49+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Centos7在线安装CDH5</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>以下步骤亲测有效无误！！！！！</p> 
</blockquote> 
<h3><a id="__1"></a>一、 基础环境准备</h3> 
<p><strong>1）软件清单</strong><br> Centos7(64位)服务器3台，地址如下：<br> jdk1.8<br> Mysql5.7 （必须要5.7的版本！！）<br> mysql-connector-java-5.1.42-bin.jar<br> CDH包：https://ro-bucharest-repo.bigstepcloud.com/cloudera-repos/cdh5/parcels/5.15.2/<br> CM包：https://ro-bucharest-repo.bigstepcloud.com/cloudera-repos/cm5/redhat/7/x86_64/cm/5.15.2/RPMS/x86_64/</p> 
<p><strong>2）服务器地址</strong><br> 192.168.56.1 （此地址映射你自己的服务器地址）<br> 192.168.56.2 （此地址映射你自己的服务器地址）<br> 192.168.56.3 （此地址映射你自己的服务器地址）</p> 
<p><strong>3）修改hostname</strong></p> 
<pre><code>vim /etc/hostname
</code></pre> 
<p>修改主机名为cdh*后进行以下操作</p> 
<pre><code>service network restart
</code></pre> 
<p><strong>4）配置hosts</strong></p> 
<pre><code>vim /etc/hosts

192.168.56.1 cdh1
192.168.56.2 cdh2
192.168.56.3 cdh3
</code></pre> 
<p><strong>5）免密访问</strong></p> 
<pre><code>ssh-keygen -t rsa
//三台服务器全都执行以下命令
ssh-copy-id  root@cdh1
ssh-copy-id  root@cdh2
ssh-copy-id  root@cdh1
</code></pre> 
<p><strong>6）关闭防火墙</strong></p> 
<pre><code>systemctl stop firewalld
systemctl disable firewalld
</code></pre> 
<p><strong>7）关闭SELINUX</strong></p> 
<pre><code>setenforce 0
vim /etc/sysconfig/selinux
SELINUX=disabled
</code></pre> 
<p><strong>8）配置NTP</strong></p> 
<pre><code>yum -y install ntp
yum install nfs-utils rpcbind
systemctl start rpcbind.service
systemctl enable rpcbind.service
systemctl start ntpd 
systemctl enable ntpd 
在cdh1节点
vim /etc/ntp.conf
server 0.cn.pool.ntp.org
server 1.cn.pool.ntp.org
server 2.cn.pool.ntp.org
server 3.cn.pool.ntp.org
restrict 0.cn.pool.ntp.org nomodify notrap noquery
restrict 1.cn.pool.ntp.org nomodify notrap noquery
restrict 2.cn.pool.ntp.org nomodify notrap noquery
restrict 3.cn.pool.ntp.org nomodify notrap noquery
server 127.127.1.0
fudge 127.127.1.0 stratum 10

systemctl start ntpd.service
systemctl enable ntpd.service
ntpstat
在cdh[2-3]节点
vim /etc/ntp.conf
server cdh1 prefer

systemctl start ntpd.service
systemctl enable ntpd.service
ntpdate -u cdh1
ntpstat
</code></pre> 
<p><strong>9）安装JDK</strong></p> 
<pre><code>mkdir /usr/local/java
cp /home/ jdk-8u131-linux-x64.gz /usr/local/java/
cd /usr/local/java/
tar xvf jdk-8u131-linux-x64.gz
rm jdk-8u131-linux-x64.gz
scp -r /usr/local/java/ root@cdh2:/usr/local/
scp -r /usr/local/java/ root@cdh3:/usr/local/
</code></pre> 
<p>设置环境变量</p> 
<pre><code>vi /etc/profile
export JAVA_HOME=/usr/local/jdk
export JRE_HOME=$JAVA_HOME/jre
export CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib:$CLASSPATH
export PATH=$JAVA_HOME/bin:$PATH

java -version
</code></pre> 
<p><strong>10）安装MySQL</strong></p> 
<p>删除自带数据库</p> 
<pre><code>rpm -qa | grep mariadb
rpm -e –nodeps 包名
rm -rf /etc/my.cnf
</code></pre> 
<p>安装请参考以下链接：</p> 
<pre><code>https://blog.csdn.net/baidu_32872293/article/details/80557668
</code></pre> 
<p>创建数据库并使本地root用户有访问权限</p> 
<pre><code>mysql -u root -p
create database hive DEFAULT CHARSET utf8 COLLATE utf8_general_ci;
create database hue DEFAULT CHARSET utf8 COLLATE utf8_general_ci;
create database am DEFAULT CHARSET utf8 COLLATE utf8_general_ci;
create database oozie DEFAULT CHARSET utf8 COLLATE utf8_general_ci;
flush privileges;
</code></pre> 
<h3><a id="CDH_129"></a>安装CDH</h3> 
<pre><code>安装CM所有包
</code></pre> 
<p>修改agent配置</p> 
<pre><code>vim /etc/cloudera-scm-agent/config.ini
server_host=cdh1
</code></pre> 
<p>cdh1节点</p> 
<pre><code>cp /home/ mysql-connector-java-5.1.47-bin.jar  /usr/share/cmf/lib/
</code></pre> 
<p>所有节点</p> 
<pre><code>cp /home/ mysql-connector-java-5.1.47-bin.jar  /usr/share/java
</code></pre> 
<p>初始化脚本配置数据库</p> 
<pre><code>/usr/share/cmf/schema/scm_prepare_database.sh mysql -h cdh1 -uroot -p000000 --scm-host cdh1 scm root 000000
</code></pre> 
<p>将安装包文件复制到默认安装路径</p> 
<pre><code>cp /home/CDH-5.8.5-1.cdh5.8.5.p0.5-el7.parcel /opt/cloudera/parcel-repo/
cp /home/CDH-5.8.5-1.cdh5.8.5.p0.5-el7.parcel.sha1 /opt/cloudera/parcel-repo/CDH-5.8.5-1.cdh5.8.5.p0.5-el7.parcel.sha
cp /home/manifest.json /opt/cloudera/parcel-repo/
</code></pre> 
<p>cdh1启动服务器端:</p> 
<pre><code>/opt/cm-5.8.5/etc/init.d/cloudera-scm-server start
</code></pre> 
<p>cdh[1-3] 启动Agent:</p> 
<pre><code>/opt/cm-5.8.5/etc/init.d/cloudera-scm-agent start
</code></pre> 
<p>启动需要2-5分钟<br> 地址：http://localhost:7180<br> 用户：admin<br> 密码：admin</p> 
<h3><a id="_170"></a>常见问题汇总</h3> 
<p><strong>1、检查主机正确性警告解决方式</strong></p> 
<p>在三台服务器中执行以下命令</p> 
<pre><code>sysctl -w vm.swappiness=10
vim /etc/sysctl.conf
vm.swappiness=10

echo never &gt; /sys/kernel/mm/transparent_hugepage/defrag
echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled
vim /etc/rc.local
echo never &gt; /sys/kernel/mm/transparent_hugepage/defrag
echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled
</code></pre> 
<p><strong>2、数据库设置hue数据库无法连接</strong></p> 
<p>在cdh2和cdh3节点执行一下命令</p> 
<pre><code>scp -r /usr/lib64/mysql/libmysqlclient.so.18 root@cdh1:/usr/lib64

或者参考
https://blog.csdn.net/ckg8933/article/details/83379279
</code></pre> 
<p><strong>3、hive缺少mysql驱动</strong></p> 
<p>cdh1执行</p> 
<pre><code>cp /home/mysql-connector-java-5.1.42-bin.jar /opt/cloudera/parcels/CDH-5.8.5-1.cdh5.8.5.p0.5/lib/hive/lib/
</code></pre> 
<p><strong>4、oozie缺少mysql驱动</strong></p> 
<p>cdh1执行</p> 
<pre><code>cp /home/mysql-connector-java-5.1.42-bin.jar /opt/cloudera/parcels/CDH-5.8.5-1.cdh5.8.5.p0.5/lib/oozie/lib/
cp /home/mysql-connector-java-5.1.42-bin.jar /var/lib/oozie/mysql-connector-jave.jar
chmod 777 /var/lib/oozie/mysql-connector-jave.jar
</code></pre> 
<p><strong>5、hue数据库测试连接失败</strong></p> 
<pre><code>https://blog.csdn.net/ckg8933/article/details/83379279
</code></pre> 
<p><strong>6、数据库测试连接失败</strong></p> 
<pre><code>https://blog.csdn.net/levy_cui/article/details/51142843
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ade4d9eb2d28584133173492780cc6f4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">达梦数据库安装详解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/07092aa02b51892bddc11697d9d9149f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Linux 命令复习</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>