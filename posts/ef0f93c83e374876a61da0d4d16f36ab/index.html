<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Django - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Django" />
<meta property="og:description" content="文章目录 安装CPython解释器下载Djangopytharm 方法命令方法 创建项目setting数据库时间设置静态文件设置 迁移项目 运行Django项目创建应用把应用加入管理界面站点的标题修改应用标题修改字段加入管理 增加证书一、使用Django-sslserver的方式二、使用自定义的证书1.如果需要https协议，需要以下3个库2.配置settings文件 在INSTALLED_APPS下添加3. 在终端使用命令运行选用哪种证书 django字段AutoField：BooleanField：CharField：TextField：CommaSeparatedIntegerField：DateField：DateTimeField：EmailField：FileField：FilePathField：FloatField：ImageField：IntegerField：IPAddressField：NullBooleanField：PhoneNumberField：PositiveIntegerField：PositiveSmallIntegerField：SlugField：SmallIntegerField：TimeField：URLField：USStateField：XMLField：附：Field 选项 模块中字段使用获取外键的值显示外键的值related_name反向查询增加中文标识增加选择项增加筛选项 增加富文本字段安装tinymce基本配置修改配置实现图片上传图片上传的问题 orm使用mysql安装MySQL配置默认编码为utf8创建mysql数据库pycharm上安装pymysqlDjango项目设置默认数据库为mysql 模型数据迁移创建超级用户创建用户修改用户密码 导入一个已存在的项目删除原有配置信息修改数据库连接处取消终端窗口高亮显示 重建数据库记录更粗暴的方法 请求方法python开发的CBV和FBV跨站请求问题安装django-cors-headers配置settings.pyCORS_ORIGIN_ALLOW_ALL:CORS_ORIGIN_WHITELIST:CORS_ORIGIN_REGEX_WHITELIST:CORS_URLS_REGEX:CORS_ALLOW_METHODS:CORS_ALLOW_HEADERS:CORS_EXPOSE_HEADERS:CORS_PREFLIGHT_MAX_AGE:CORS_ALLOW_CREDENTIALS:CSRF整合CORS_REPLACE_HTTPS_REFERER 其他问题DEFAULT_AUTO_FIELD warnings报错：Forbidden (CSRF cookie not set.) 安装CPython解释器 可参考我的博文
https://blog.csdn.net/gsl371/article/details/120148727
下载Django pytharm 方法 注意：如果是用pycharm开发，并且使用虚拟环境，这一步掠过。
可在pycharm中直接创建虚拟环境，项目和应用。
如下：
然后在虚拟环境中使用pip安装需要的模块。
命令方法 打开管理员命令窗口
指定版本为1.11.28，指定源为清华源
pip install django==1.11.28 -i https://pypi.tuna.tsinghua.edu.cn/simple 查看
C:\Users\gsl&gt;pip list Package Version ---------- ------- Django 1.11.28 pip 21.0.1 pytz 2021.1 setuptools 28.8.0 C:\Users\gsl&gt;django-admin Type &#39;django-admin help &lt;subcommand&gt;&#39; for help on a specific subcommand. Available subcommands: [django] check compilemessages createcachetable dbshell diffsettings dumpdata flush inspectdb loaddata makemessages makemigrations migrate runserver sendtestemail shell showmigrations sqlflush sqlmigrate sqlsequencereset squashmigrations startapp startproject test testserver Note that only Django core commands are listed as settings are not properly configured (error: Requested setting INSTALLED_APPS, but settings are not configured." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/ef0f93c83e374876a61da0d4d16f36ab/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-29T15:34:38+08:00" />
<meta property="article:modified_time" content="2023-12-29T15:34:38+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Django</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#CPython_1" rel="nofollow">安装CPython解释器</a></li><li><a href="#Django_6" rel="nofollow">下载Django</a></li><li><ul><li><a href="#pytharm__7" rel="nofollow">pytharm 方法</a></li><li><a href="#_16" rel="nofollow">命令方法</a></li></ul> 
  </li><li><a href="#_69" rel="nofollow">创建项目</a></li><li><ul><li><a href="#setting_89" rel="nofollow">setting</a></li><li><ul><li><a href="#_90" rel="nofollow">数据库</a></li><li><a href="#_93" rel="nofollow">时间设置</a></li><li><ul><li><a href="#_112" rel="nofollow">静态文件设置</a></li></ul> 
   </li></ul> 
   </li><li><a href="#_127" rel="nofollow">迁移项目</a></li></ul> 
  </li><li><a href="#Django_144" rel="nofollow">运行Django项目</a></li><li><a href="#_292" rel="nofollow">创建应用</a></li><li><a href="#_309" rel="nofollow">把应用加入管理界面</a></li><li><ul><li><a href="#_310" rel="nofollow">站点的标题修改</a></li><li><a href="#_312" rel="nofollow">应用标题修改</a></li><li><a href="#_316" rel="nofollow">字段加入管理</a></li></ul> 
  </li><li><a href="#_319" rel="nofollow">增加证书</a></li><li><ul><li><a href="#Djangosslserver_323" rel="nofollow">一、使用Django-sslserver的方式</a></li><li><a href="#_337" rel="nofollow">二、使用自定义的证书</a></li><li><ul><li><a href="#1https3_339" rel="nofollow">1.如果需要https协议，需要以下3个库</a></li><li><a href="#2settings_INSTALLED_APPS_347" rel="nofollow">2.配置settings文件 在INSTALLED_APPS下添加</a></li><li><a href="#3__354" rel="nofollow">3. 在终端使用命令运行</a></li><li><a href="#_363" rel="nofollow">选用哪种证书</a></li></ul> 
  </li></ul> 
  </li><li><a href="#django_370" rel="nofollow">django字段</a></li><li><ul><li><a href="#AutoField_374" rel="nofollow">AutoField：</a></li><li><a href="#BooleanField_376" rel="nofollow">BooleanField：</a></li><li><a href="#CharField_378" rel="nofollow">CharField：</a></li><li><a href="#TextField_385" rel="nofollow">TextField：</a></li><li><a href="#CommaSeparatedIntegerField_387" rel="nofollow">CommaSeparatedIntegerField：</a></li><li><a href="#DateField_389" rel="nofollow">DateField：</a></li><li><a href="#DateTimeField_397" rel="nofollow">DateTimeField：</a></li><li><a href="#EmailField_399" rel="nofollow">EmailField：</a></li><li><a href="#FileField_401" rel="nofollow">FileField：</a></li><li><a href="#FilePathField_403" rel="nofollow">FilePathField：</a></li><li><a href="#FloatField_413" rel="nofollow">FloatField：</a></li><li><a href="#ImageField_421" rel="nofollow">ImageField：</a></li><li><a href="#IntegerField_423" rel="nofollow">IntegerField：</a></li><li><a href="#IPAddressField_425" rel="nofollow">IPAddressField：</a></li><li><a href="#NullBooleanField_427" rel="nofollow">NullBooleanField：</a></li><li><a href="#PhoneNumberField_429" rel="nofollow">PhoneNumberField：</a></li><li><a href="#PositiveIntegerField_431" rel="nofollow">PositiveIntegerField：</a></li><li><a href="#PositiveSmallIntegerField_433" rel="nofollow">PositiveSmallIntegerField：</a></li><li><a href="#SlugField_436" rel="nofollow">SlugField：</a></li><li><a href="#SmallIntegerField_438" rel="nofollow">SmallIntegerField：</a></li><li><a href="#TimeField_440" rel="nofollow">TimeField：</a></li><li><a href="#URLField_442" rel="nofollow">URLField：</a></li><li><a href="#USStateField_444" rel="nofollow">USStateField：</a></li><li><a href="#XMLField_446" rel="nofollow">XMLField：</a></li><li><a href="#Field__450" rel="nofollow">附：Field 选项</a></li></ul> 
  </li><li><a href="#_468" rel="nofollow">模块中字段使用</a></li><li><ul><li><a href="#_469" rel="nofollow">获取外键的值</a></li><li><a href="#_473" rel="nofollow">显示外键的值</a></li><li><a href="#related_name_478" rel="nofollow">related_name反向查询</a></li><li><a href="#_489" rel="nofollow">增加中文标识</a></li><li><a href="#_491" rel="nofollow">增加选择项</a></li><li><a href="#_494" rel="nofollow">增加筛选项</a></li></ul> 
  </li><li><a href="#_660" rel="nofollow">增加富文本字段</a></li><li><ul><li><a href="#tinymce_661" rel="nofollow">安装tinymce</a></li><li><a href="#_670" rel="nofollow">基本配置</a></li><li><a href="#_692" rel="nofollow">修改配置</a></li><li><a href="#_702" rel="nofollow">实现图片上传</a></li><li><a href="#_777" rel="nofollow">图片上传的问题</a></li></ul> 
  </li><li><a href="#orm_783" rel="nofollow">orm</a></li><li><a href="#mysql_796" rel="nofollow">使用mysql</a></li><li><ul><li><a href="#MySQL_805" rel="nofollow">安装MySQL</a></li><li><a href="#utf8_830" rel="nofollow">配置默认编码为utf8</a></li><li><a href="#mysql_879" rel="nofollow">创建mysql数据库</a></li><li><a href="#pycharmpymysql_900" rel="nofollow">pycharm上安装pymysql</a></li><li><a href="#Djangomysql_903" rel="nofollow">Django项目设置默认数据库为mysql</a></li></ul> 
  </li><li><a href="#_915" rel="nofollow">模型数据迁移</a></li><li><a href="#_932" rel="nofollow">创建超级用户</a></li><li><ul><li><a href="#_933" rel="nofollow">创建用户</a></li><li><a href="#_951" rel="nofollow">修改用户密码</a></li></ul> 
  </li><li><a href="#_956" rel="nofollow">导入一个已存在的项目</a></li><li><ul><li><a href="#_957" rel="nofollow">删除原有配置信息</a></li><li><a href="#_966" rel="nofollow">修改数据库连接处</a></li><li><a href="#_968" rel="nofollow">取消终端窗口高亮显示</a></li></ul> 
  </li><li><a href="#_973" rel="nofollow">重建数据库记录</a></li><li><ul><li><a href="#_1044" rel="nofollow">更粗暴的方法</a></li></ul> 
  </li><li><a href="#_1077" rel="nofollow">请求方法</a></li><li><a href="#pythonCBVFBV_1085" rel="nofollow">python开发的CBV和FBV</a></li><li><a href="#_1147" rel="nofollow">跨站请求问题</a></li><li><ul><li><a href="#djangocorsheaders_1154" rel="nofollow">安装django-cors-headers</a></li><li><a href="#settingspy_1168" rel="nofollow">配置settings.py</a></li><li><a href="#CORS_ORIGIN_ALLOW_ALL_1185" rel="nofollow">CORS_ORIGIN_ALLOW_ALL:</a></li><li><a href="#CORS_ORIGIN_WHITELIST_1193" rel="nofollow">CORS_ORIGIN_WHITELIST:</a></li><li><a href="#CORS_ORIGIN_REGEX_WHITELIST_1205" rel="nofollow">CORS_ORIGIN_REGEX_WHITELIST:</a></li><li><a href="#CORS_URLS_REGEX_1213" rel="nofollow">CORS_URLS_REGEX:</a></li><li><a href="#CORS_ALLOW_METHODS_1220" rel="nofollow">CORS_ALLOW_METHODS:</a></li><li><a href="#CORS_ALLOW_HEADERS_1244" rel="nofollow">CORS_ALLOW_HEADERS:</a></li><li><a href="#CORS_EXPOSE_HEADERS_1268" rel="nofollow">CORS_EXPOSE_HEADERS:</a></li><li><a href="#CORS_PREFLIGHT_MAX_AGE_1270" rel="nofollow">CORS_PREFLIGHT_MAX_AGE:</a></li><li><a href="#CORS_ALLOW_CREDENTIALS_1275" rel="nofollow">CORS_ALLOW_CREDENTIALS:</a></li><li><a href="#CSRF_1280" rel="nofollow">CSRF整合</a></li><li><a href="#CORS_REPLACE_HTTPS_REFERER_1296" rel="nofollow">CORS_REPLACE_HTTPS_REFERER</a></li></ul> 
  </li><li><a href="#_1317" rel="nofollow">其他问题</a></li><li><ul><li><a href="#DEFAULT_AUTO_FIELD_warnings_1318" rel="nofollow">DEFAULT_AUTO_FIELD warnings</a></li><li><a href="#Forbidden_CSRF_cookie_not_set_1415" rel="nofollow">报错：Forbidden (CSRF cookie not set.)</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="CPython_1"></a>安装CPython解释器</h2> 
<p>可参考我的博文<br> https://blog.csdn.net/gsl371/article/details/120148727</p> 
<h2><a id="Django_6"></a>下载Django</h2> 
<h3><a id="pytharm__7"></a>pytharm 方法</h3> 
<p>注意：如果是用pycharm开发，并且使用虚拟环境，这一步掠过。<br> 可在pycharm中直接创建虚拟环境，项目和应用。<br> 如下：<br> <img src="https://images2.imgbox.com/e1/05/HsN7Szlg_o.png" alt="在这里插入图片描述"><br> 然后在虚拟环境中使用pip安装需要的模块。<br> <img src="https://images2.imgbox.com/40/58/k3bjdC4o_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_16"></a>命令方法</h3> 
<p>打开管理员命令窗口<br> 指定版本为1.11.28，指定源为清华源</p> 
<pre><code class="prism language-bash">pip <span class="token function">install</span> <span class="token assign-left variable">django</span><span class="token operator">==</span><span class="token number">1.11</span>.28 <span class="token parameter variable">-i</span> https://pypi.tuna.tsinghua.edu.cn/simple
</code></pre> 
<p>查看</p> 
<pre><code class="prism language-bash">C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>gsl<span class="token operator">&gt;</span>pip list
Package    Version
---------- -------
Django     <span class="token number">1.11</span>.28
pip        <span class="token number">21.0</span>.1
pytz       <span class="token number">2021.1</span>
setuptools <span class="token number">28.8</span>.0
</code></pre> 
<pre><code class="prism language-bash">C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>gsl<span class="token operator">&gt;</span>django-admin

Type <span class="token string">'django-admin help &lt;subcommand&gt;'</span> <span class="token keyword">for</span> <span class="token builtin class-name">help</span> on a specific subcommand.

Available subcommands:

<span class="token punctuation">[</span>django<span class="token punctuation">]</span>
    check
    compilemessages
    createcachetable
    dbshell
    diffsettings
    dumpdata
    flush
    inspectdb
    loaddata
    makemessages
    makemigrations
    migrate
    runserver
    sendtestemail
    shell
    showmigrations
    sqlflush
    sqlmigrate
    sqlsequencereset
    squashmigrations
    startapp
    startproject
    <span class="token builtin class-name">test</span>
    testserver
Note that only Django core commands are listed as settings are not properly configured <span class="token punctuation">(</span>error: Requested setting INSTALLED_APPS, but settings are not configured. You must either define the environment variable DJANGO_SETTINGS_MODULE or call settings.configure<span class="token punctuation">(</span><span class="token punctuation">)</span> before accessing settings.<span class="token punctuation">)</span>.
</code></pre> 
<h2><a id="_69"></a>创建项目</h2> 
<p>创建项目testDjango</p> 
<pre><code class="prism language-bash">django-admin startproject testDjango
</code></pre> 
<p>查看</p> 
<pre><code class="prism language-bash">C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>gsl<span class="token punctuation">\</span>testDjango<span class="token operator">&gt;</span>tree /F
卷 sys 的文件夹 <span class="token environment constant">PATH</span> 列表
卷序列号为 0000006A 69B0:5632
C:.
│  manage.py
│
└─testDjango
        settings.py
        urls.py
        wsgi.py
        __init__.py
</code></pre> 
<h3><a id="setting_89"></a>setting</h3> 
<h4><a id="_90"></a>数据库</h4> 
<p><img src="https://images2.imgbox.com/a2/2f/w44qaTMj_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_93"></a>时间设置</h4> 
<p>这个地方不设置会造成存储到数据库时间与当前时间不一致问题</p> 
<p>首选需要对当前时区进行设置</p> 
<p>在 settings.py 文件中 修改</p> 
<pre><code class="prism language-bash">TIME_ZONE <span class="token operator">=</span> <span class="token string">'Asia/Shanghai'</span>
</code></pre> 
<p>然后还有一个非常重要的一点</p> 
<pre><code class="prism language-bash">USE_TZ <span class="token operator">=</span> False
</code></pre> 
<p>当两个地方都设置好了，此时存储到数据库的时间即为正确时间</p> 
<h5><a id="_112"></a>静态文件设置</h5> 
<pre><code># 配置静态文件url
STATIC_URL = '/static/'

# 配置聚合静态文件存放目录，需要在根目录下事先创建这个目录
STATIC_ROOT = os.path.join(BASE_DIR, "static")

# 配置上传文件上传url
MEDIA_URL = "/media/"

# 配置上传文件上传存放目录，需要在根目录下事先创建这个目录
MEDIA_ROOT = os.path.join(BASE_DIR, "media")
</code></pre> 
<h3><a id="_127"></a>迁移项目</h3> 
<p>迁移依赖<br> pip自动生成和安装requirements.txt</p> 
<p>在原项目f生成requirements.txt文件</p> 
<pre><code>pip freeze &gt; requirements.txt
</code></pre> 
<p>在新项目安装requirements.txt依赖</p> 
<pre><code>pip install -r requirements.txt
</code></pre> 
<h2><a id="Django_144"></a>运行Django项目</h2> 
<pre><code class="prism language-bash">python manage.py runserver 
</code></pre> 
<p>pycharm中运行项目<br> <img src="https://images2.imgbox.com/1a/24/zoVFKaGv_o.png" alt="在这里插入图片描述"><br> 修改配置<br> <img src="https://images2.imgbox.com/b8/ee/A9jUPJZC_o.png" alt="在这里插入图片描述"></p> 
<p>可以修改启动端口<br> <img src="https://images2.imgbox.com/33/19/2JZKSdy0_o.png" alt="在这里插入图片描述"><br> 如果是命令行创建项目，这里需要增加模板路径，pycharm可以帮助创建这些<img src="https://images2.imgbox.com/a1/ee/2KeYSNhM_o.png" alt="在这里插入图片描述"><br> setting文件</p> 
<pre><code class="prism language-bash"><span class="token string">""</span>"
Django settings <span class="token keyword">for</span> testDjango project.

Generated by <span class="token string">'django-admin startproject'</span> using Django <span class="token number">1.11</span>.28.

For <span class="token function">more</span> information on this file, see
https://docs.djangoproject.com/en/1.11/topics/settings/

For the full list of settings and their values, see
https://docs.djangoproject.com/en/1.11/ref/settings/
<span class="token string">""</span>"

<span class="token function">import</span> os

<span class="token comment"># Build paths inside the project like this: os.path.join(BASE_DIR, ...)</span>
<span class="token comment"># 项目的根目录</span>
BASE_DIR <span class="token operator">=</span> os.path.dirname<span class="token punctuation">(</span>os.path.dirname<span class="token punctuation">(</span>os.path.abspath<span class="token punctuation">(</span>__file__<span class="token punctuation">))</span><span class="token punctuation">)</span>


<span class="token comment"># Quick-start development settings - unsuitable for production</span>
<span class="token comment"># See https://docs.djangoproject.com/en/1.11/howto/deployment/checklist/</span>

<span class="token comment"># SECURITY WARNING: keep the secret key used in production secret!</span>
SECRET_KEY <span class="token operator">=</span> <span class="token string">'7w)f^*b^8nyy&amp;1ep^4e9j!%c-g7#qd8^xd8zvw1@i_*9!hxt93'</span>

<span class="token comment"># SECURITY WARNING: don't run with debug turned on in production!</span>
<span class="token comment"># 生产环境要设成False</span>
DEBUG <span class="token operator">=</span> True

<span class="token comment"># 允许所有ip访问</span>
ALLOWED_HOSTS <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'*'</span><span class="token punctuation">]</span>


<span class="token comment"># Application definition</span>

INSTALLED_APPS <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'django.contrib.admin'</span>,
    <span class="token string">'django.contrib.auth'</span>,
    <span class="token string">'django.contrib.contenttypes'</span>,
    <span class="token string">'django.contrib.sessions'</span>,
    <span class="token string">'django.contrib.messages'</span>,
    <span class="token string">'django.contrib.staticfiles'</span>,
<span class="token punctuation">]</span>

MIDDLEWARE <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'django.middleware.security.SecurityMiddleware'</span>,
    <span class="token string">'django.contrib.sessions.middleware.SessionMiddleware'</span>,
    <span class="token string">'django.middleware.common.CommonMiddleware'</span>,
    <span class="token string">'django.middleware.csrf.CsrfViewMiddleware'</span>,
    <span class="token string">'django.contrib.auth.middleware.AuthenticationMiddleware'</span>,
    <span class="token string">'django.contrib.messages.middleware.MessageMiddleware'</span>,
    <span class="token string">'django.middleware.clickjacking.XFrameOptionsMiddleware'</span>,
<span class="token punctuation">]</span>

ROOT_URLCONF <span class="token operator">=</span> <span class="token string">'testDjango.urls'</span>

<span class="token comment"># 模板，即html展示文件的模板</span>
TEMPLATES <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token string">'BACKEND'</span><span class="token builtin class-name">:</span> <span class="token string">'django.template.backends.django.DjangoTemplates'</span>,
        <span class="token string">'DIRS'</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>os.path.join<span class="token punctuation">(</span>BASE_DIR,<span class="token string">'templates'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>,    <span class="token comment">#如果是命令行创建项目，这里需要增加模板路径</span>
        <span class="token string">'APP_DIRS'</span><span class="token builtin class-name">:</span> True,
        <span class="token string">'OPTIONS'</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'context_processors'</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
                <span class="token string">'django.template.context_processors.debug'</span>,
                <span class="token string">'django.template.context_processors.request'</span>,
                <span class="token string">'django.contrib.auth.context_processors.auth'</span>,
                <span class="token string">'django.contrib.messages.context_processors.messages'</span>,
            <span class="token punctuation">]</span>,
        <span class="token punctuation">}</span>,
    <span class="token punctuation">}</span>,
<span class="token punctuation">]</span>

WSGI_APPLICATION <span class="token operator">=</span> <span class="token string">'testDjango.wsgi.application'</span>


<span class="token comment"># Database</span>
<span class="token comment"># https://docs.djangoproject.com/en/1.11/ref/settings/#databases</span>

DATABASES <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'default'</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'ENGINE'</span><span class="token builtin class-name">:</span> <span class="token string">'django.db.backends.sqlite3'</span>,
        <span class="token string">'NAME'</span><span class="token builtin class-name">:</span> os.path.join<span class="token punctuation">(</span>BASE_DIR, <span class="token string">'db.sqlite3'</span><span class="token punctuation">)</span>,
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment"># Password validation</span>
<span class="token comment"># https://docs.djangoproject.com/en/1.11/ref/settings/#auth-password-validators</span>

AUTH_PASSWORD_VALIDATORS <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token string">'NAME'</span><span class="token builtin class-name">:</span> <span class="token string">'django.contrib.auth.password_validation.UserAttributeSimilarityValidator'</span>,
    <span class="token punctuation">}</span>,
    <span class="token punctuation">{<!-- --></span>
        <span class="token string">'NAME'</span><span class="token builtin class-name">:</span> <span class="token string">'django.contrib.auth.password_validation.MinimumLengthValidator'</span>,
    <span class="token punctuation">}</span>,
    <span class="token punctuation">{<!-- --></span>
        <span class="token string">'NAME'</span><span class="token builtin class-name">:</span> <span class="token string">'django.contrib.auth.password_validation.CommonPasswordValidator'</span>,
    <span class="token punctuation">}</span>,
    <span class="token punctuation">{<!-- --></span>
        <span class="token string">'NAME'</span><span class="token builtin class-name">:</span> <span class="token string">'django.contrib.auth.password_validation.NumericPasswordValidator'</span>,
    <span class="token punctuation">}</span>,
<span class="token punctuation">]</span>


<span class="token comment"># Internationalization</span>
<span class="token comment"># https://docs.djangoproject.com/en/1.11/topics/i18n/</span>

LANGUAGE_CODE <span class="token operator">=</span> <span class="token string">'en-us'</span>

TIME_ZONE <span class="token operator">=</span> <span class="token string">'UTC'</span>

USE_I18N <span class="token operator">=</span> True

USE_L10N <span class="token operator">=</span> True

USE_TZ <span class="token operator">=</span> True


<span class="token comment"># Static files (CSS, JavaScript, Images)</span>
<span class="token comment"># https://docs.djangoproject.com/en/1.11/howto/static-files/</span>

STATIC_URL <span class="token operator">=</span> <span class="token string">'/static/'</span>

</code></pre> 
<p>static资源配置，名字不能错<br> <img src="https://images2.imgbox.com/e3/ab/c3YuerWi_o.png" alt="在这里插入图片描述"><br> 清楚缓存<br> <img src="https://images2.imgbox.com/7d/50/7LQWljEN_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_292"></a>创建应用</h2> 
<p>方便模块化开发管理<br> 进入项目文件夹</p> 
<pre><code class="prism language-bash">python manage.py startapp app01
</code></pre> 
<p>生成的目录作用<br> <img src="https://images2.imgbox.com/14/30/neYdDY5t_o.png" alt="在这里插入图片描述"></p> 
<p>注册app<br> <img src="https://images2.imgbox.com/f8/16/QXSoSm2p_o.png" alt="在这里插入图片描述"><br> 优化代码<br> 把业务逻辑从项目的urls移到app中的views<br> <img src="https://images2.imgbox.com/56/02/xQJ9SC1r_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/1b/8a/ifQuQzSS_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_309"></a>把应用加入管理界面</h2> 
<h3><a id="_310"></a>站点的标题修改</h3> 
<p><img src="https://images2.imgbox.com/26/26/TNsnUkYR_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_312"></a>应用标题修改</h3> 
<p><img src="https://images2.imgbox.com/ca/89/eXsN799q_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_316"></a>字段加入管理</h3> 
<p><img src="https://images2.imgbox.com/2d/6e/qQcvN6wt_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_319"></a>增加证书</h2> 
<p>django http转换为https<br> ​​​​​​Django使用HTTPS有两种方式：</p> 
<h3><a id="Djangosslserver_323"></a>一、使用Django-sslserver的方式</h3> 
<p>安装django-sslserver</p> 
<pre><code class="prism language-bash">pip <span class="token function">install</span> django-sslserver  <span class="token comment"># 安装django-sslserver</span>
</code></pre> 
<p>INSTALLED_APPS = [<br> …<br> “sslserver”, # 在settings里面添加sslserver<br> ]</p> 
<p>python3 manage.py runsslserver 0.0.0.0:443 # 启动的时候使用runsslserver即可</p> 
<p>这一种会报不是安全站点提示，因为证书不是受信任机构颁发的。</p> 
<h3><a id="_337"></a>二、使用自定义的证书</h3> 
<p>首先要购买证书。</p> 
<h4><a id="1https3_339"></a>1.如果需要https协议，需要以下3个库</h4> 
<pre><code class="prism language-bash">pip <span class="token function">install</span> django-extensions
pip <span class="token function">install</span> django-werkzeug-debugger-runserver
pip <span class="token function">install</span> pyOpenSSL
</code></pre> 
<h4><a id="2settings_INSTALLED_APPS_347"></a>2.配置settings文件 在INSTALLED_APPS下添加</h4> 
<pre><code class="prism language-bash">‘werkzeug_debugger_runserver’,
‘django_extensions’,
</code></pre> 
<h4><a id="3__354"></a>3. 在终端使用命令运行</h4> 
<pre><code class="prism language-bash">python manage.py runserver_plus --cert-file ./fullchain.pem --key-file ./privkey.pem <span class="token number">0.0</span>.0.0:443

</code></pre> 
<h4><a id="_363"></a>选用哪种证书</h4> 
<p><img src="https://images2.imgbox.com/1c/f7/GcNSmMCK_o.png" alt="在这里插入图片描述"></p> 
<p>如果您的业务通过浏览器进行访问，例如网站，则无需关注根证书。因为根证书已经内置在浏览器中，您只需在 Web 服务上安装已颁发的 SSL证书，即可实现浏览器与 Web 服务的 HTTPS 通信。详情请参见 如何选择 SSL 证书安装部署类型？<br> 如果您的业务需要通过非浏览器客户端访问您的服务，由于客户端没有预先内置根证书，您需要在对应客户端中安装根证书，保证客户端与服务端的正常通信。</p> 
<h2><a id="django_370"></a>django字段</h2> 
<p>Django model字段类型清单<br> Django 通过 models 实现数据库的创建、修改、删除等操作，本文为模型中一般常用的类型的清单，便于查询和使用：</p> 
<h3><a id="AutoField_374"></a>AutoField：</h3> 
<p>一个自动递增的整型字段，添加记录时它会自动增长。你通常不需要直接使用这个字段；如果你不指定主键的话，系统会自动添加一个主键字段到你的model。(参阅自动主键字段)</p> 
<h3><a id="BooleanField_376"></a>BooleanField：</h3> 
<p>布尔字段,管理工具里会自动将其描述为checkbox。</p> 
<h3><a id="CharField_378"></a>CharField：</h3> 
<p>字符串字段，单行输入，用于较短的字符串，如要保存大量文本, 使用 TextField，CharField有一个必填参数：</p> 
<pre><code class="prism language-bash">CharField.max_length：字符的最大长度，django会根据这个参数在数据库层和校验层限制该字段所允许的最大字符数。
</code></pre> 
<h3><a id="TextField_385"></a>TextField：</h3> 
<p>一个容量很大的文本字段， admin 管理界面用 多行编辑框表示该字段数据。</p> 
<h3><a id="CommaSeparatedIntegerField_387"></a>CommaSeparatedIntegerField：</h3> 
<p>用于存放逗号分隔的整数值。类似 CharField，必须maxlength 参数。</p> 
<h3><a id="DateField_389"></a>DateField：</h3> 
<p>日期字段，admin 用一个文本框 来表示该字段数据(附带一个 JavaScript 日历和一个”Today”快捷按键。有下列额外的可选参数：</p> 
<pre><code class="prism language-bash">auto_now：当对象被保存时,自动将该字段的值设置为当前时间.通常用于表示 “last-modified” 时间戳；
auto_now_add：当对象首次被创建时,自动将该字段的值设置为当前时间.通常用于表示对象创建时间。
</code></pre> 
<h3><a id="DateTimeField_397"></a>DateTimeField：</h3> 
<p>类似 DateField 支持同样的附加选项。</p> 
<h3><a id="EmailField_399"></a>EmailField：</h3> 
<p>一个带有检查 Email 合法性的 CharField，不接受 maxlength 参数。</p> 
<h3><a id="FileField_401"></a>FileField：</h3> 
<p>一个文件上传字段。 要求一个必须有的参数： upload_to， 一个用于保存上载文件的本地文件系统路径。 这个路径必须包含 strftime formatting， 该格式将被上载文件的 date/time 替换(so that uploaded files don’t fill up the given directory)。在一个 model 中使用 FileField 或 ImageField 需要以下步骤：在你的 settings 文件中， 定义一个完整路径给 MEDIA_ROOT 以便让 Django在此处保存上传文件。 (出于性能考虑，这些文件并不保存到数据库。) 定义 MEDIA_URL 作为该目录的公共 URL。 要确保该目录对 WEB 服务器用户帐号是可写的。在你的 model 中添加 FileField 或 ImageField， 并确保定义了 upload_to 选项，以告诉 Django 使用 MEDIA_ROOT 的哪个子目录保存上传文件。你的数据库中要保存的只是文件的路径(相对于 MEDIA_ROOT)。 出于习惯你一定很想使用 Django 提供的 get__url 函数。举例来说，如果你的 ImageField 叫作 mug_shot， 你就可以在模板中以 {<!-- -->{ object。get_mug_shot_url }} 这样的方式得到图像的绝对路径。</p> 
<h3><a id="FilePathField_403"></a>FilePathField：</h3> 
<p>选择指定目录按限制规则选择文件，有三个参数可选， 其中”path”必需的，这三个参数可以同时使用， 参数描述：</p> 
<pre><code class="prism language-bash">path：必需参数，一个目录的绝对文件系统路径。 FilePathField 据此得到可选项目。 Example： “/home/images”；
match：可选参数， 一个正则表达式， 作为一个字符串， FilePathField 将使用它过滤文件名。 注意这个正则表达式只会应用到 base filename 而不是路径全名。 Example： “foo。*<span class="token punctuation">\</span>。txt^”， 将匹配文件 foo23.txt 却不匹配 bar.txt 或 foo23.gif；
recursive：可选参数， 是否包括 path 下全部子目录，True 或 False，默认值为 False。
match 仅应用于 base filename， 而不是路径全名。 如：FilePathField<span class="token punctuation">(</span>path<span class="token operator">=</span>”/home/images”， <span class="token assign-left variable">match</span><span class="token operator">=</span>”foo.*”， <span class="token assign-left variable">recursive</span><span class="token operator">=</span>True<span class="token punctuation">)</span>…会匹配 /home/images/foo.gif 而不匹配 /home/images/foo/bar.gif
</code></pre> 
<h3><a id="FloatField_413"></a>FloatField：</h3> 
<p>浮点型字段。 必须提供两个 参数， 参数描述：</p> 
<pre><code class="prism language-bash">max_digits：总位数<span class="token punctuation">(</span>不包括小数点和符号<span class="token punctuation">)</span>
decimal_places：小数位数。如：要保存最大值为 <span class="token number">999</span> <span class="token punctuation">(</span>小数点后保存2位<span class="token punctuation">)</span>，你要这样定义字段：models.FloatField<span class="token punctuation">(</span>…，max_digits<span class="token operator">=</span><span class="token number">5</span>， <span class="token assign-left variable">decimal_places</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>，要保存最大值一百万<span class="token punctuation">(</span>小数点后保存10位<span class="token punctuation">)</span>的话，你要这样定义：models.FloatField<span class="token punctuation">(</span>…，max_digits<span class="token operator">=</span><span class="token number">19</span>， <span class="token assign-left variable">decimal_places</span><span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="ImageField_421"></a>ImageField：</h3> 
<p>类似 FileField， 不过要校验上传对象是否是一个合法图片。它有两个可选参数：height_field 和 width_field，如果提供这两个参数，则图片将按提供的高度和宽度规格保存。 该字段要求 Python Imaging 库。</p> 
<h3><a id="IntegerField_423"></a>IntegerField：</h3> 
<p>用于保存一个整数。</p> 
<h3><a id="IPAddressField_425"></a>IPAddressField：</h3> 
<p>一个字符串形式的 IP 地址， (如 “202.1241.30″)。</p> 
<h3><a id="NullBooleanField_427"></a>NullBooleanField：</h3> 
<p>类似 BooleanField， 不过允许 NULL 作为其中一个选项。 推荐使用这个字段而不要用 BooleanField 加 null=True 选项。 admin 用一个选择框 (三个可选择的值： “Unknown”， “Yes” 和 “No” ) 来表示这种字段数据。</p> 
<h3><a id="PhoneNumberField_429"></a>PhoneNumberField：</h3> 
<p>一个带有合法美国风格电话号码校验的 CharField(格式：XXX-XXX-XXXX)。</p> 
<h3><a id="PositiveIntegerField_431"></a>PositiveIntegerField：</h3> 
<p>类似 IntegerField， 但取值范围为非负整数（这个字段应该是允许0值的…可以理解为无符号整数）</p> 
<h3><a id="PositiveSmallIntegerField_433"></a>PositiveSmallIntegerField：</h3> 
<p>正小整型字段，类似 PositiveIntegerField， 取值范围较小(数据库相关)</p> 
<h3><a id="SlugField_436"></a>SlugField：</h3> 
<p>是一个报纸术语. slug 是某个东西的小小标记(短签), 只包含字母,数字,下划线和连字符.它们通常用于URLs。</p> 
<h3><a id="SmallIntegerField_438"></a>SmallIntegerField：</h3> 
<p>类似 IntegerField， 不过只允许某个取值范围内的整数。(依赖数据库)</p> 
<h3><a id="TimeField_440"></a>TimeField：</h3> 
<p>时间字段，类似于 DateField 和 DateTimeField。</p> 
<h3><a id="URLField_442"></a>URLField：</h3> 
<p>用于保存 URL。 若 verify_exists 参数为 True (默认)， 给定的 URL 会预先检查是否存在(即URL是否被有效装入且没有返回404响应)。</p> 
<h3><a id="USStateField_444"></a>USStateField：</h3> 
<p>美国州名缩写，由两个字母组成（天朝人民无视）。</p> 
<h3><a id="XMLField_446"></a>XMLField：</h3> 
<p>XML字符字段，校验值是否为合法XML的 TextField，必须提供参数：<br> schema_path：校验文本的 RelaxNG schema 的文件系统路径。</p> 
<h3><a id="Field__450"></a>附：Field 选项</h3> 
<pre><code class="prism language-bash">null ：缺省设置为false.通常不将其用于字符型字段上，比如CharField,TextField上.字符型字段如果没有值会返回空字符串。
blank：该字段是否可以为空。如果为假，则必须有值
choices：一个用来选择值的2维元组。第一个值是实际存储的值，第二个用来方便进行选择。如SEX_CHOICES<span class="token operator">=</span> <span class="token punctuation">((</span>‘F’,<span class="token string">'Female’),(‘M’,'</span>Male’<span class="token punctuation">)</span>,<span class="token punctuation">)</span>
core：db_column，db_index 如果为真将为此字段创建索引
default：设定缺省值
editable：如果为假，admin模式下将不能改写。缺省为真
help_text：admin模式下帮助文档
primary_key：设置主键，如果没有设置django创建表时会自动加上：
radio_admin：用于admin模式下将select转换为radio显示。只用于ForeignKey或者设置了choices
unique：数据唯一
unique_for_date：日期唯一，如下例中系统将不允许title和pub_date两个都相同的数据重复出现
title <span class="token operator">=</span> meta.CharField<span class="token punctuation">(</span>maxlength<span class="token operator">=</span><span class="token number">30</span>,unique_for_date<span class="token operator">=</span>’pub_date’<span class="token punctuation">)</span>
unique_for_month / unique_for_year：用法同上
validator_list：有效性检查。非有效产生 django.core.validators.ValidationError 错误
</code></pre> 
<h2><a id="_468"></a>模块中字段使用</h2> 
<h3><a id="_469"></a>获取外键的值</h3> 
<p><img src="https://images2.imgbox.com/82/43/6mzAj9dC_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/a3/d0/d1dkCNT8_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_473"></a>显示外键的值</h3> 
<p>当将对象类别表示为字符串时，必须告诉django要显示什么。例如<br> <img src="https://images2.imgbox.com/7f/18/WCVH2M2m_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/e3/1f/tQtG8Gq8_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="related_name_478"></a>related_name反向查询</h3> 
<p>模型中外键字段，多的一方，添加related_name属性。<br> <img src="https://images2.imgbox.com/85/65/26ZCgmqh_o.png" alt="在这里插入图片描述"><br> 序列化中，做子的序列化。可获得子的内容，否则，只能获得一个占位值。<br> <img src="https://images2.imgbox.com/db/46/Grm9lITT_o.png" alt="在这里插入图片描述"><br> 结果<br> <img src="https://images2.imgbox.com/aa/6d/EfpyTjxK_o.png" alt="在这里插入图片描述"><br> 不做子序列化结果<br> <img src="https://images2.imgbox.com/7c/78/cR6byae9_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_489"></a>增加中文标识</h3> 
<p><img src="https://images2.imgbox.com/fc/70/BX2wnl28_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_491"></a>增加选择项</h3> 
<p>对于简单的选择，可以不用通过建表外键关联实现选择。简洁快速。<br> <img src="https://images2.imgbox.com/b1/6e/JdBj69EN_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_494"></a>增加筛选项</h3> 
<p><img src="https://images2.imgbox.com/5d/82/f6yTQCP1_o.png" alt="在这里插入图片描述"><br> 其他的方法</p> 
<pre><code class="prism language-powershell">
<span class="token keyword">class</span> ProductListByCategoryView<span class="token punctuation">(</span>generics<span class="token punctuation">.</span>ListAPIView<span class="token punctuation">)</span>:
    <span class="token string">'''产品类别列表'''</span>
    serializer_class = ProductListSerializer
    permissin_classes = <span class="token punctuation">(</span>permissions<span class="token punctuation">.</span>AllowAny<span class="token punctuation">,</span><span class="token punctuation">)</span>
    filter_backends = <span class="token punctuation">(</span>OrderingFilter<span class="token punctuation">,</span> SearchFilter<span class="token punctuation">)</span>
    ordering_fields = <span class="token punctuation">(</span><span class="token string">'category'</span><span class="token punctuation">,</span> <span class="token string">'manufacturer'</span><span class="token punctuation">,</span> <span class="token string">'created'</span><span class="token punctuation">,</span> <span class="token string">'sold'</span><span class="token punctuation">,</span> <span class="token string">'stock'</span><span class="token punctuation">,</span> <span class="token string">'price'</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
    search_fields = <span class="token punctuation">(</span><span class="token string">'description'</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
    ordering = <span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
    <span class="token string">'''查询集根据条件获取'''</span>

    def get_queryset<span class="token punctuation">(</span>self<span class="token punctuation">)</span>:
        category = self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>query_params<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'category'</span><span class="token punctuation">,</span> None<span class="token punctuation">)</span>

        <span class="token keyword">if</span> category is not None:
            queryset = Product<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token keyword">filter</span><span class="token punctuation">(</span>category=category<span class="token punctuation">)</span>
        <span class="token keyword">else</span>:
            queryset = Product<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>all<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> queryset


<span class="token keyword">class</span> ProductListByCategoryManufacturerView<span class="token punctuation">(</span>generics<span class="token punctuation">.</span>ListAPIView<span class="token punctuation">)</span>:
    <span class="token string">'''产品按类别品牌列表'''</span>
    serializer_class = ProductListSerializer
    permissin_classes = <span class="token punctuation">(</span>permissions<span class="token punctuation">.</span>AllowAny<span class="token punctuation">,</span><span class="token punctuation">)</span>
    filter_backends = <span class="token punctuation">(</span>OrderingFilter<span class="token punctuation">,</span> SearchFilter<span class="token punctuation">)</span>
    ordering_fields = <span class="token punctuation">(</span><span class="token string">'category'</span><span class="token punctuation">,</span> <span class="token string">'manufacturer'</span><span class="token punctuation">,</span> <span class="token string">'created'</span><span class="token punctuation">,</span> <span class="token string">'sold'</span><span class="token punctuation">,</span> <span class="token string">'stock'</span><span class="token punctuation">,</span> <span class="token string">'price'</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
    search_fields = <span class="token punctuation">(</span><span class="token string">'description'</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
    ordering = <span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span><span class="token punctuation">)</span>

    def get_queryset<span class="token punctuation">(</span>self<span class="token punctuation">)</span>:
        category = self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>query_params<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'category'</span><span class="token punctuation">,</span> None<span class="token punctuation">)</span>
        manufacturer = self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>query_params<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'manufacturer'</span><span class="token punctuation">,</span> None<span class="token punctuation">)</span>

        <span class="token keyword">if</span> category is not None:
            queryset = Product<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token keyword">filter</span><span class="token punctuation">(</span>category=category<span class="token punctuation">,</span> manufacturer=manufacturer<span class="token punctuation">)</span>
        <span class="token keyword">else</span>:
            queryset = Product<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>all<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> queryset


<span class="token keyword">class</span> ProductRetrieveView<span class="token punctuation">(</span>generics<span class="token punctuation">.</span>RetrieveAPIView<span class="token punctuation">)</span>:
    queryset = Product<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>all<span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class = ProductRetrieveSerializer
    permission_classes = <span class="token punctuation">(</span>permissions<span class="token punctuation">.</span>AllowAny<span class="token punctuation">,</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> UserInfoView<span class="token punctuation">(</span>APIView<span class="token punctuation">)</span>:
    <span class="token string">'''用户基本信息'''</span>
    permission_classes = <span class="token punctuation">(</span>permissions<span class="token punctuation">.</span>IsAuthenticated<span class="token punctuation">,</span><span class="token punctuation">)</span>

    def get<span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> format=None<span class="token punctuation">)</span>:
        user = self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>user
        serializer = UserInfoSerializer<span class="token punctuation">(</span>user<span class="token punctuation">)</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span><span class="token keyword">data</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> UserProfileRUView<span class="token punctuation">(</span>generics<span class="token punctuation">.</span>RetrieveUpdateAPIView<span class="token punctuation">)</span>:
    <span class="token string">'''用户其他信息'''</span>
    serializer_class = UserProfileSerializer
    permission_classes = <span class="token punctuation">(</span>permissions<span class="token punctuation">.</span>IsAuthenticated<span class="token punctuation">,</span><span class="token punctuation">)</span>  <span class="token comment"># 需要认证</span>

    <span class="token string">''' 只能当前用户'''</span>

    def get_object<span class="token punctuation">(</span>self<span class="token punctuation">)</span>:
        user = self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>user
        obj = UserProfile<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>user=user<span class="token punctuation">)</span>
        <span class="token keyword">return</span> obj


<span class="token keyword">class</span> UserCreateView<span class="token punctuation">(</span>generics<span class="token punctuation">.</span>CreateAPIView<span class="token punctuation">)</span>:
    <span class="token string">'''用户创建'''</span>
    serializer_class = UserSerializer


<span class="token keyword">class</span> DeliveryAddressLCView<span class="token punctuation">(</span>generics<span class="token punctuation">.</span>ListCreateAPIView<span class="token punctuation">)</span>:
    <span class="token string">'''收货地址LC'''</span>
    serializer_class = DeliveryAddressSerilizer  <span class="token comment"># 没有加LC，因为较简单</span>
    permission_classes = <span class="token punctuation">(</span>permissions<span class="token punctuation">.</span>IsAuthenticated<span class="token punctuation">,</span><span class="token punctuation">)</span>  <span class="token comment"># 需要登陆认证</span>

    def get_queryset<span class="token punctuation">(</span>self<span class="token punctuation">)</span>:
        user = self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>user
        queryset = DeliveryAddress<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token keyword">filter</span><span class="token punctuation">(</span>user=user<span class="token punctuation">)</span>  <span class="token comment"># 模型来的对象</span>
        <span class="token keyword">return</span> queryset

    def perform_create<span class="token punctuation">(</span>self<span class="token punctuation">,</span> serializer<span class="token punctuation">)</span>:
        user = self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>user
        s = serializer<span class="token punctuation">.</span>save<span class="token punctuation">(</span>user=user<span class="token punctuation">)</span>
        profile = user<span class="token punctuation">.</span>profile_of  <span class="token comment"># profile_of 反向关系，从models来</span>
        profile<span class="token punctuation">.</span>delivery_address = s  <span class="token comment"># 把新创建的收货地址设为默认地址存入用户扩展信息中</span>
        profile<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> DeliveryAddressRUDView<span class="token punctuation">(</span>generics<span class="token punctuation">.</span>RetrieveUpdateDestroyAPIView<span class="token punctuation">)</span>:
    <span class="token string">'''收货地址RUD'''</span>
    serializer_class = DeliveryAddressSerilizer
    permission_classes = <span class="token punctuation">(</span>permissions<span class="token punctuation">.</span>IsAuthenticated<span class="token punctuation">,</span><span class="token punctuation">)</span>

    def get_object<span class="token punctuation">(</span>self<span class="token punctuation">)</span>:
        user = self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>user
        <span class="token comment"># obj =DeliveryAddress.objects.get(user=user)</span>
        <span class="token keyword">try</span>:
            obj = DeliveryAddress<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>id=self<span class="token punctuation">.</span>kwargs<span class="token punctuation">[</span><span class="token string">'pk'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> user=user<span class="token punctuation">)</span>  <span class="token comment"># id由前端传来，一个用户有多个id</span>
        except Exception as e:
            raise NotFound<span class="token punctuation">(</span><span class="token string">'no found'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> obj


<span class="token keyword">class</span> CartListView<span class="token punctuation">(</span>generics<span class="token punctuation">.</span>ListAPIView<span class="token punctuation">)</span>:
    <span class="token string">'''购物车列表'''</span>
    serializer_class = OrderListSerializer  <span class="token comment"># 可以和订单公用一个序列器</span>
    permissin_classes = <span class="token punctuation">(</span>permissions<span class="token punctuation">.</span>IsAuthenticated<span class="token punctuation">,</span><span class="token punctuation">)</span>

    def get_queryset<span class="token punctuation">(</span>self<span class="token punctuation">)</span>:
        user = self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>user
        queryset = Order<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token keyword">filter</span><span class="token punctuation">(</span>user=user<span class="token punctuation">,</span> status=<span class="token string">'0'</span><span class="token punctuation">)</span>  <span class="token comment"># 订单状态为零的，表示在购物车</span>
        <span class="token keyword">return</span> queryset


<span class="token keyword">class</span> OrderListView<span class="token punctuation">(</span>generics<span class="token punctuation">.</span>ListAPIView<span class="token punctuation">)</span>:
    <span class="token string">'''订单列表'''</span>
    serializer_class = OrderListSerializer  <span class="token comment"># 和cart公用一个序列化器</span>
    permissin_classes = <span class="token punctuation">(</span>permissions<span class="token punctuation">.</span>IsAuthenticated<span class="token punctuation">,</span><span class="token punctuation">)</span>

    def get_queryset<span class="token punctuation">(</span>self<span class="token punctuation">)</span>:
        user = self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>user
        queryset = Order<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token keyword">filter</span><span class="token punctuation">(</span>user=user<span class="token punctuation">,</span> status__in=<span class="token punctuation">[</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># status__in 是django用法，表示值在。。范围</span>
        <span class="token keyword">return</span> queryset


<span class="token keyword">class</span> OrderCreateView<span class="token punctuation">(</span>generics<span class="token punctuation">.</span>CreateAPIView<span class="token punctuation">)</span>:
    <span class="token string">'''创建订单'''</span>
    queryset = Order<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>all<span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class = OrderCreateSerializer
    permission_classes = <span class="token punctuation">(</span>permissions<span class="token punctuation">.</span>IsAuthenticated<span class="token punctuation">,</span><span class="token punctuation">)</span>

    def perform_create<span class="token punctuation">(</span>self<span class="token punctuation">,</span> serializer<span class="token punctuation">)</span>:
        user = self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>user
        product = serializer<span class="token punctuation">.</span>validated_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'product'</span><span class="token punctuation">)</span>
        serializer<span class="token punctuation">.</span>save<span class="token punctuation">(</span>user=user<span class="token punctuation">,</span> price=product<span class="token punctuation">.</span>price<span class="token punctuation">,</span> address=user<span class="token punctuation">.</span>profile_of<span class="token punctuation">.</span>delivery_address<span class="token punctuation">,</span> <span class="token punctuation">)</span>

        logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'user %d cart changed,product %d related.Time is %s.'</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span>id<span class="token punctuation">,</span> product<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
                     str<span class="token punctuation">(</span>datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> OrderRUDView<span class="token punctuation">(</span>generics<span class="token punctuation">.</span>RetrieveUpdateDestroyAPIView<span class="token punctuation">)</span>:
    <span class="token string">'''OrderRUD'''</span>
    serializer_class = OrderRUDSerializer
    permission_classes = <span class="token punctuation">(</span>permissions<span class="token punctuation">.</span>IsAuthenticated<span class="token punctuation">,</span><span class="token punctuation">)</span>

    def get_object<span class="token punctuation">(</span>self<span class="token punctuation">)</span>:
        user = self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>user
        obj = Order<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>user=user<span class="token punctuation">,</span> id=self<span class="token punctuation">.</span>kwargs<span class="token punctuation">[</span><span class="token string">'pk'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> obj

    def perform_update<span class="token punctuation">(</span>self<span class="token punctuation">,</span> serializer<span class="token punctuation">)</span>:
        user = self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>user
        serializer<span class="token punctuation">.</span>save<span class="token punctuation">(</span>user=user<span class="token punctuation">,</span> status=<span class="token string">'1'</span><span class="token punctuation">)</span>
</code></pre> 
<h2><a id="_660"></a>增加富文本字段</h2> 
<h3><a id="tinymce_661"></a>安装tinymce</h3> 
<p>Install django-tinymce using pip (or any other way to install python package) from PyPI. If you need to use a different way to install django-tinymce you can place the tinymce module on your Python path. You can put it into your Django project directory or run python setup.py install from a shell.</p> 
<pre><code class="prism language-powershell">pip install django-tinymce
</code></pre> 
<p>在虚拟环境下，包或者应用被安装为如下位置。<br> <img src="https://images2.imgbox.com/81/cd/oJTEHu7i_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_670"></a>基本配置</h3> 
<p>在项目设置中修改。<br> Add tinymce to INSTALLED_APPS in settings.py for your project:</p> 
<pre><code class="prism language-powershell">INSTALLED_APPS = <span class="token punctuation">(</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token string">'tinymce'</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">)</span>
</code></pre> 
<p>Add tinymce.urls to urls.py for your project:</p> 
<pre><code class="prism language-powershell">urlpatterns = patterns<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    path<span class="token punctuation">(</span><span class="token string">'tinymce/'</span><span class="token punctuation">,</span> include<span class="token punctuation">(</span><span class="token string">'tinymce.urls'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">)</span>
</code></pre> 
<h3><a id="_692"></a>修改配置</h3> 
<p>修改配置以满足需要。<br> <img src="https://images2.imgbox.com/8e/2c/6rCwyCr0_o.png" alt="在这里插入图片描述"><br> 项目的配置能覆盖掉虚拟环境中安装的tinymce setting.py中的配置。<br> 前者修改比较方便。<br> 修改后的界面<br> <img src="https://images2.imgbox.com/e0/05/GXgTTPfO_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_702"></a>实现图片上传</h3> 
<p>要使TinyMCE能够上传图片，需要如下几步：</p> 
<p>第1步：上传图片，首先要启用图片插件</p> 
<p>在plugins参数中把<code>image</code>加进去。</p> 
<p>第2步：在工具栏显示图片工具按钮</p> 
<p>在toolbar参数中把<code>image</code>加进去。</p> 
<p>此时，点图片按钮是没有上传选项的，只能添加图片地址。</p> 
<p>第3步：加入配置参数<code>images_upload_url</code></p> 
<p>此参数用于指定一个接受上传文件的后端处理程序地址，例如：</p> 
<pre><code class="prism language-powershell"><span class="token string">'images_upload_url'</span>: <span class="token string">'/upload_image/'</span><span class="token punctuation">,</span>
</code></pre> 
<p>如果返回的地址是相对路径，还有一个参数<code>images_upload_base_path</code>，可以给出访问的基本路径。</p> 
<pre><code class="prism language-powershell"><span class="token string">'images_upload_base_path'</span>: <span class="token string">'你的网站的地址，域名或ip'</span>
</code></pre> 
<p>修改后如下：<br> <img src="https://images2.imgbox.com/95/6f/b6OfWU02_o.png" alt="在这里插入图片描述"></p> 
<p>后端处理程序代码</p> 
<pre><code class="prism language-powershell"><span class="token comment"># 图片上传</span>
@csrf_exempt
def upload_image<span class="token punctuation">(</span>request<span class="token punctuation">)</span>:
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method == <span class="token string">"POST"</span>:
        file_obj = request<span class="token punctuation">.</span>FILES<span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span>
        file_name_suffix = file_obj<span class="token punctuation">.</span>name<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span>1<span class="token punctuation">]</span>
        <span class="token keyword">if</span> file_name_suffix not in <span class="token punctuation">[</span><span class="token string">"jpg"</span><span class="token punctuation">,</span> <span class="token string">"png"</span><span class="token punctuation">,</span> <span class="token string">"gif"</span><span class="token punctuation">,</span> <span class="token string">"jpeg"</span><span class="token punctuation">,</span> <span class="token punctuation">]</span>:
            <span class="token keyword">return</span> JsonResponse<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"message"</span>: <span class="token string">"错误的文件格式"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

        upload_time = timezone<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>
        path = os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>
            settings<span class="token punctuation">.</span>MEDIA_ROOT<span class="token punctuation">,</span>
            <span class="token string">'tinymce'</span><span class="token punctuation">,</span>
            str<span class="token punctuation">(</span>upload_time<span class="token punctuation">.</span>year<span class="token punctuation">)</span><span class="token punctuation">,</span>
            str<span class="token punctuation">(</span>upload_time<span class="token punctuation">.</span>month<span class="token punctuation">)</span><span class="token punctuation">,</span>
            str<span class="token punctuation">(</span>upload_time<span class="token punctuation">.</span>day<span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
        <span class="token comment"># 如果没有这个路径则创建</span>
        <span class="token keyword">if</span> not os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>path<span class="token punctuation">)</span>:
            os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>path<span class="token punctuation">)</span>

        file_path = os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>path<span class="token punctuation">,</span> file_obj<span class="token punctuation">.</span>name<span class="token punctuation">)</span>

        file_url = f<span class="token string">'{settings.MEDIA_URL}tinymce/{upload_time.year}/{upload_time.month}/{upload_time.day}/{file_obj.name}'</span>

        <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span>:
            <span class="token keyword">return</span> JsonResponse<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                <span class="token string">"message"</span>: <span class="token string">"文件已存在"</span><span class="token punctuation">,</span>
                <span class="token string">'location'</span>: file_url
            <span class="token punctuation">}</span><span class="token punctuation">)</span>

        with open<span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> <span class="token string">'wb+'</span><span class="token punctuation">)</span> as f:
            <span class="token keyword">for</span> chunk in file_obj<span class="token punctuation">.</span>chunks<span class="token punctuation">(</span><span class="token punctuation">)</span>:
                f<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span>

        <span class="token keyword">return</span> JsonResponse<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            <span class="token string">'message'</span>: <span class="token string">'上传图片成功'</span><span class="token punctuation">,</span>
            <span class="token string">'location'</span>: file_url
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> JsonResponse<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'detail'</span>: <span class="token string">"错误的请求"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p>后端处理程序位置<br> <img src="https://images2.imgbox.com/c5/46/cbmi1QM9_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_777"></a>图片上传的问题</h3> 
<p>在真机环境中，需要访问的图片地址是域名地址，http协议即可，不必https。<br> tinymce的配置需要更改下，否则上传后，在django后台一保存，即转换为相对路径，不是域名地址。<br> <img src="https://images2.imgbox.com/f8/37/C4Yf0txe_o.png" alt="在这里插入图片描述"><br> 另外，微信对域名的解析的辨识也是比较慢的，一开始以为有问题，过了会自己正常了。</p> 
<h2><a id="orm_783"></a>orm</h2> 
<p>在models.py中创建类，对应在数据库中生成表和字段</p> 
<p>对应关系<br> 类—》表<br> 对象—》数据行<br> 属性—》字段<br> <img src="https://images2.imgbox.com/80/15/ZvhGRgVg_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/86/42/xBfmJjqX_o.png" alt="在这里插入图片描述"></p> 
<p>下载驱动<br> <img src="https://images2.imgbox.com/ab/86/dXirt4K5_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/c3/30/pFZhfAPf_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="mysql_796"></a>使用mysql</h2> 
<p>下载<br> https://downloads.mysql.com/archives/community/<br> <img src="https://images2.imgbox.com/f9/f9/QVctZvVJ_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="MySQL_805"></a>安装MySQL</h3> 
<p>在输入框内输入cmd，以管理员的身份运行，注意这里一定一定一定要以管理员的身份运行，否则在安装过程中会出现因为管理权限不够而导致的Install/Remove of the Service Denied!（安装/卸载服务被拒绝），这一点非常重要！</p> 
<p>输入安装命令：mysqld -install，若出现Service successfully installed，证明安装成功；如出现Install of the Service Denied，则说明没有以管理员权限来运行cmd：</p> 
<p><img src="https://images2.imgbox.com/39/b6/rhCnmWg4_o.png" alt="在这里插入图片描述"><br> 下载 <a href="https://www.microsoft.com/en-us/download/details.aspx?id=40784" rel="nofollow">VC redist packages for x64</a>，下载完成，点击运行即可<br> <img src="https://images2.imgbox.com/27/4e/OuE8nctZ_o.png" alt="在这里插入图片描述"><br> 然后继续输入命令：mysqld --initialize，如果执行mysqld --initialize-insecure则不会创建密码。此时不会有任何提示：<br> 再输入启动命令：net start mysql，出现以下提示证明MySQL启动成功：<br> <img src="https://images2.imgbox.com/ae/c9/HAA0lOwr_o.png" alt="在这里插入图片描述"></p> 
<p>设置MySQL密码<br> 在MySQL解压文件下的data文件夹下的.err文件中查看错误日志,找到root用户默认初始化密码。<br> <img src="https://images2.imgbox.com/48/75/1sa4fktb_o.png" alt="在这里插入图片描述"></p> 
<p>进入mysql安装目录的bin文件夹</p> 
<pre><code class="prism language-bash">mysql <span class="token parameter variable">-uroot</span> -pzR3ENye8o.dW<span class="token punctuation">;</span>      
alter user <span class="token string">'root'</span>@<span class="token string">'localhost'</span> identified by <span class="token string">'123'</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="utf8_830"></a>配置默认编码为utf8</h3> 
<p>修改前</p> 
<pre><code class="prism language-powershell">mysql&gt; show variables like <span class="token string">'%character%'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">+</span>
<span class="token punctuation">|</span> Variable_name            <span class="token punctuation">|</span> Value                      <span class="token punctuation">|</span>
<span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">+</span>
<span class="token punctuation">|</span> character_set_client     <span class="token punctuation">|</span> utf8                       <span class="token punctuation">|</span>
<span class="token punctuation">|</span> character_set_connection <span class="token punctuation">|</span> utf8                       <span class="token punctuation">|</span>
<span class="token punctuation">|</span> character_set_database   <span class="token punctuation">|</span> latin1                     <span class="token punctuation">|</span>
<span class="token punctuation">|</span> character_set_filesystem <span class="token punctuation">|</span> binary                     <span class="token punctuation">|</span>
<span class="token punctuation">|</span> character_set_results    <span class="token punctuation">|</span> utf8                       <span class="token punctuation">|</span>
<span class="token punctuation">|</span> character_set_server     <span class="token punctuation">|</span> latin1                     <span class="token punctuation">|</span>
<span class="token punctuation">|</span> character_set_system     <span class="token punctuation">|</span> utf8                       <span class="token punctuation">|</span>
<span class="token punctuation">|</span> character_sets_dir       <span class="token punctuation">|</span> <span class="token operator">/</span>usr/share/mysql/charsets/ <span class="token punctuation">|</span>
<span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">+</span>
8 rows in <span class="token function">set</span> <span class="token punctuation">(</span>0<span class="token punctuation">.</span>01 sec<span class="token punctuation">)</span>
</code></pre> 
<p>修改/etc/my.cnf配置文件，在[mysqld]下添加编码配置，如下所示：</p> 
<pre><code>[mysqld]
character_set_server=utf8
init_connect='SET NAMES utf8'
</code></pre> 
<p>windows版免安装没有这个文件，可以创建一个<br> <img src="https://images2.imgbox.com/7e/51/oBHuIOvw_o.png" alt="在这里插入图片描述"></p> 
<p>重新启动mysql服务，查看数据库默认编码如下所示</p> 
<pre><code>mysql&gt; show variables like '%character%';
+--------------------------+----------------------------+
| Variable_name            | Value                      |
+--------------------------+----------------------------+
| character_set_client     | utf8                       |
| character_set_connection | utf8                       |
| character_set_database   | utf8                       |
| character_set_filesystem | binary                     |
| character_set_results    | utf8                       |
| character_set_server     | utf8                       |
| character_set_system     | utf8                       |
| character_sets_dir       | /usr/share/mysql/charsets/ |
+--------------------------+----------------------------+
8 rows in set (0.00 sec)

</code></pre> 
<h3><a id="mysql_879"></a>创建mysql数据库</h3> 
<pre><code class="prism language-bash">create database login<span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-bash">mysql<span class="token operator">&gt;</span> show databases<span class="token punctuation">;</span>
+--------------------+
<span class="token operator">|</span> Database           <span class="token operator">|</span>
+--------------------+
<span class="token operator">|</span> information_schema <span class="token operator">|</span>
<span class="token operator">|</span> login              <span class="token operator">|</span>
<span class="token operator">|</span> mysql              <span class="token operator">|</span>
<span class="token operator">|</span> performance_schema <span class="token operator">|</span>
<span class="token operator">|</span> sys                <span class="token operator">|</span>
+--------------------+
<span class="token number">5</span> rows <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre> 
<h3><a id="pycharmpymysql_900"></a>pycharm上安装pymysql</h3> 
<p><img src="https://images2.imgbox.com/4b/5b/8hTIDvTA_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="Djangomysql_903"></a>Django项目设置默认数据库为mysql</h3> 
<p><img src="https://images2.imgbox.com/94/b3/QiPFuvgf_o.png" alt="在这里插入图片描述"><br> 习惯上把后俩个行写入项目初始化文件中__init__.py中</p> 
<pre><code class="prism language-bash"><span class="token function">import</span> pymysql
pymysql.install_as_MySQLdb<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># </span>
</code></pre> 
<h2><a id="_915"></a>模型数据迁移</h2> 
<p>Django可以通过类创建表，然后迁移到数据库中。<br> 制作迁移文件，或检查所有app下的models.py的变化，记录变化</p> 
<pre><code class="prism language-bash">python manage.py makemigrations
</code></pre> 
<p><img src="https://images2.imgbox.com/0a/52/I0pv9OXx_o.png" alt="在这里插入图片描述"><br> 执行迁移，同步model.py中变化到数据库</p> 
<pre><code class="prism language-bash">python manage.py migrate
</code></pre> 
<p><img src="https://images2.imgbox.com/f7/37/iKGZfqSl_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/4f/04/tnsfE52I_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/b4/da/FyKOYmkx_o.png" alt="在这里插入图片描述"><br> 优化判断<br> <img src="https://images2.imgbox.com/27/2c/HHmnu1Oj_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_932"></a>创建超级用户</h2> 
<h3><a id="_933"></a>创建用户</h3> 
<pre><code class="prism language-bash">C:<span class="token punctuation">\</span>djproject<span class="token punctuation">\</span>helloworld<span class="token operator">&gt;</span>python manage.py createsuperuser
Username <span class="token punctuation">(</span>leave blank to use <span class="token string">'administrator'</span><span class="token punctuation">)</span>: admin
Email address: a@a.com
Password:123
Password <span class="token punctuation">(</span>again<span class="token punctuation">)</span>:123
This password is too short. It must contain at least <span class="token number">8</span> characters.
This password is too common.
This password is entirely numeric.
Bypass password validation and create user anyway? <span class="token punctuation">[</span>y/N<span class="token punctuation">]</span>: y
Superuser created successfully.

</code></pre> 
<p>user表中增加了一条记录<br> <img src="https://images2.imgbox.com/32/4b/3kIux4xR_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_951"></a>修改用户密码</h3> 
<pre><code class="prism language-bash">python manage.py changepassword username
</code></pre> 
<h2><a id="_956"></a>导入一个已存在的项目</h2> 
<h3><a id="_957"></a>删除原有配置信息</h3> 
<p>删除这个文件夹<br> <img src="https://images2.imgbox.com/81/fb/RvausTBt_o.png" alt="在这里插入图片描述"><br> 如果不删除，有标记，原来的环境配置信息。<br> <img src="https://images2.imgbox.com/74/4d/6Ih7ZsA2_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_966"></a>修改数据库连接处</h3> 
<p><img src="https://images2.imgbox.com/8a/21/JbGZvvE2_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_968"></a>取消终端窗口高亮显示</h3> 
<p><img src="https://images2.imgbox.com/02/43/lnbIWL7Z_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_973"></a>重建数据库记录</h2> 
<p>django删除数据库表后重建表总共分为四步</p> 
<p>1.在数据库中删除对应的表<br> <img src="https://images2.imgbox.com/19/ec/33064DdA_o.png" alt="在这里插入图片描述"><br> 2.删除表django_migrations中要删除表所在项目的记录</p> 
<p><img src="https://images2.imgbox.com/bb/10/uNqUDS1q_o.png" alt="在这里插入图片描述"><br> 3.删除此表对应的app目录下所有的临时生成的文件，除了__init__.py 外。<br> 删除项目的migrations文件夹中的所有 文件，除了__init__.py 文件<br> <img src="https://images2.imgbox.com/8a/58/GekGuJ1l_o.png" alt="在这里插入图片描述"><br> 这两个文件夹，及其子文件夹<br> <img src="https://images2.imgbox.com/7a/28/go43mo8R_o.png" alt="在这里插入图片描述"><br> 4.重新执行数据库迁移命令</p> 
<pre><code class="prism language-bash">python manage.py makemigrations
python manage.py migrate
</code></pre> 
<pre><code class="prism language-bash">D:<span class="token punctuation">\</span>djproject<span class="token punctuation">\</span>bookmanager<span class="token operator">&gt;</span>python manage.py makemigrations
Migrations <span class="token keyword">for</span> <span class="token string">'app01'</span><span class="token builtin class-name">:</span>
  app01<span class="token punctuation">\</span>migrations<span class="token punctuation">\</span>0001_initial.py
    - Create model Author
    - Create model Book
    - Create model Publisher
    - Add field publisher to book
    - Add field books to author

D:<span class="token punctuation">\</span>djproject<span class="token punctuation">\</span>bookmanager<span class="token operator">&gt;</span>python manage.py migrate
Operations to perform:
  Apply all migrations: admin, app01, auth, contenttypes, sessions
Running migrations:
  Applying contenttypes.0001_initial<span class="token punctuation">..</span>. OK
  Applying auth.0001_initial<span class="token punctuation">..</span>. OK
  Applying admin.0001_initial<span class="token punctuation">..</span>. OK
  Applying admin.0002_logentry_remove_auto_add<span class="token punctuation">..</span>. OK
  Applying app01.0001_initial<span class="token punctuation">..</span>. OK
  Applying contenttypes.0002_remove_content_type_name<span class="token punctuation">..</span>. OK
  Applying auth.0002_alter_permission_name_max_length<span class="token punctuation">..</span>. OK
  Applying auth.0003_alter_user_email_max_length<span class="token punctuation">..</span>. OK
  Applying auth.0004_alter_user_username_opts<span class="token punctuation">..</span>. OK
  Applying auth.0005_alter_user_last_login_null<span class="token punctuation">..</span>. OK
  Applying auth.0006_require_contenttypes_0002<span class="token punctuation">..</span>. OK
  Applying auth.0007_alter_validators_add_error_messages<span class="token punctuation">..</span>. OK
  Applying auth.0008_alter_user_username_max_length<span class="token punctuation">..</span>. OK
  Applying sessions.0001_initial<span class="token punctuation">..</span>. OK

</code></pre> 
<p>Django中删除和重建数据库中关于models类的映射数据库表的正确方法：</p> 
<p>在Django中删除models类的映射数据库表需要在models.py中剪切或删除对应的models类：然后在控制台中执行：</p> 
<p>python manage.py makemigrations(Django会重新对照你的models类与数据库中的映射表，如果你的model类被删除，则Django会生成一个删除迁移)<br> python manage.py migrate（执行删除迁移，删除数据库中对应的model映射表）</p> 
<p>数据库迁移问题：<br> 在执行python manage.py makemigrations迁移命令之后，正常输出并生成迁移文件，但执行python manage.py migrate之后显示，No migrations to apply</p> 
<p>，且查看数据库并没有生成对应的表；<br> 解决办法：<br> 1、首先删除migrations目录下的迁移文件<br> 2、执行 python manage.py makemigrations your-app-name<br> 3、mysql中执行delete from django_migrations where app = “your-app-name”;<br> 4、重新执行迁移命令：python manage.py makemigrations your-app-name；python manage.py migrate your-app-name</p> 
<h3><a id="_1044"></a>更粗暴的方法</h3> 
<p>解决：“外键约束失败”，可能是数据迁移操作过程中出问题了，导致数据表里的对应关系混乱，简单粗暴的方法就是手动删除自己创建的App的migrations文件夹下除了__init__.py的所有文件（包括pycache文件夹），然后再手动删除根目录下的db.sqlite3文件（这里面存了数据库表）</p> 
<p>运行数据迁移语句</p> 
<pre><code class="prism language-bash">python manage.py makemigrations
python manage.py migrate

</code></pre> 
<p>此后，那些删除的东西都会重建，此时你会发现创建的管理员和用户，都被注销了（搜索会显示不存在），还有之前发送给服务端的数据也都消失了，得重新来过</p> 
<pre><code class="prism language-bash"><span class="token comment"># 创建管理员账号</span>
<span class="token punctuation">(</span>venv<span class="token punctuation">)</span> E:<span class="token punctuation">\</span><span class="token operator">&gt;</span>python manage.py createsuperuser <span class="token comment"># 回车后出现如下语句</span>
Username <span class="token punctuation">(</span>leave blank to use <span class="token string">'administrator'</span><span class="token punctuation">)</span>: <span class="token comment"># </span>
Password: <span class="token comment"># 输入密码，此处无显示，也就是你输入了但没反应，直接回车就行</span>
Password <span class="token punctuation">(</span>again<span class="token punctuation">)</span>: <span class="token comment"># 重新输入密码确认，老规矩，不显示</span>
<span class="token comment"># 此处可能弹出密码过于简单的提示，如果只是用来测试的账户，直接忽略继续就好了</span>
<span class="token comment"># 然后就创建完成</span>

<span class="token comment"># 创建普通用户</span>
<span class="token punctuation">(</span>venv<span class="token punctuation">)</span> E:<span class="token punctuation">\</span><span class="token operator">&gt;</span>python manage.py shell
Python <span class="token number">3.8</span>.1 <span class="token punctuation">(</span>default, Mar  <span class="token number">2</span> <span class="token number">2020</span>, <span class="token number">13</span>:06:26<span class="token punctuation">)</span> <span class="token punctuation">[</span>MSC v.1916 <span class="token number">64</span> bit <span class="token punctuation">(</span>AMD64<span class="token punctuation">)</span><span class="token punctuation">]</span> on win32
Type <span class="token string">"help"</span>, <span class="token string">"copyright"</span>, <span class="token string">"credits"</span> or <span class="token string">"license"</span> <span class="token keyword">for</span> <span class="token function">more</span> information.
<span class="token punctuation">(</span>InteractiveConsole<span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> from django.contrib.auth.models <span class="token function">import</span> User
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> user <span class="token operator">=</span> User.objects.create_user<span class="token punctuation">(</span><span class="token string">'user1'</span>, <span class="token string">'user1@qq.com'</span>, <span class="token string">'123456'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> user.save<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> exit<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 退出终端</span>

</code></pre> 
<h2><a id="_1077"></a>请求方法</h2> 
<p>post 和get<br> request.GET url上携带的参数 例如 ?k1=v1&amp;k2=v2<br> request.POST post请求提交的数据的编码方式是URLencode，才有值<br> request.info 路径信息 不包含ip和端口 也不包含参数<br> request.body 请求体 bytes类型</p> 
<p><img src="https://images2.imgbox.com/74/60/TnpZsEza_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="pythonCBVFBV_1085"></a>python开发的CBV和FBV</h2> 
<p>视图形式</p> 
<p>FBV function based view</p> 
<p>CBV class based view<br> CBV写法</p> 
<pre><code class="prism language-bash">引入已经存在的类
from django.views <span class="token function">import</span> View

class Xxx<span class="token punctuation">(</span>View<span class="token punctuation">)</span>:     <span class="token comment">#定义一个类继承之</span>
    <span class="token comment"># 定义函数，处理逻辑</span>
    def get<span class="token punctuation">(</span>self,request<span class="token punctuation">)</span>
    	<span class="token comment"># 专门处理get请求</span>
        <span class="token builtin class-name">return</span> response
    
	def post<span class="token punctuation">(</span>self,request<span class="token punctuation">)</span>
    	<span class="token comment"># 专门处理post请求</span>
        <span class="token builtin class-name">return</span> response
</code></pre> 
<p>执行流程中通过url引入类<br> 通过类引入方法</p> 
<pre><code class="prism language-bash">url<span class="token punctuation">(</span>r<span class="token string">'xx/'</span>,Xxx.as_view<span class="token punctuation">(</span><span class="token punctuation">))</span>
</code></pre> 
<p>as_view()的流程</p> 
<ol><li> <p>项目运行时加载urls.py的文件，执行类.as_view()方法</p> </li><li> <p>as_view()执行后，内部定义了一个view函数，并且返回。</p> </li><li> <p>请求到来的时候，执行view函数：</p> 
  <ol><li> <p>实例化类 —— 》 self</p> </li><li> <p>self.request = request</p> </li><li> <p>执行self.dispatch(request, *args, **kwargs)的方法</p> 
    <ol><li> <p>判断请求方式是否被允许</p> 
      <ol><li> <p>允许：</p> <p>通过反射获取请求方式对应的请求方法 ——》 handler</p> <p>获取不到 self.http_method_not_allowed ——》 handler</p> </li><li> <p>不允许：</p> <p>self.http_method_not_allowed ——》 handler</p> </li></ol> </li><li> <p>执行handler，返回结果</p> </li></ol> </li></ol> </li></ol> 
<h2><a id="_1147"></a>跨站请求问题</h2> 
<p>跨站请求伪造（英语：Cross-site request forgery），也被称为 one-click attack 或者 session riding，通常缩写为 CSRF 或者 XSRF， 是一种挟制用户在当前已登录的Web应用程序上执行非本意的操作的攻击方法<br> 简单的说，就是为了防止CSRF攻击，需要一个cookie。</p> 
<p>退出登录，回到登录界面，打开开发者工具（我用的是谷歌浏览器），追踪一下网络请求，发现登录的时候，除了用户名密码，还有一个 csrfmiddlewaretoken 参数，而 csrfmiddlewaretoken 参数来自于 cookie 中的 csrftoken。<br> 　　<img src="https://images2.imgbox.com/6a/7d/NP6AMsAx_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="djangocorsheaders_1154"></a>安装django-cors-headers</h3> 
<pre><code class="prism language-bash">C:<span class="token punctuation">\</span>djproject<span class="token punctuation">\</span>eshop<span class="token operator">&gt;</span>pip <span class="token function">install</span> django-cors-headers
Defaulting to user installation because normal site-packages is not writeable
Collecting django-cors-headers
  Downloading django_cors_headers-3.7.0-py3-none-any.whl <span class="token punctuation">(</span><span class="token number">12</span> kB<span class="token punctuation">)</span>
Requirement already satisfied: Django<span class="token operator">&gt;=</span><span class="token number">2.2</span> <span class="token keyword">in</span> c:<span class="token punctuation">\</span>users<span class="token punctuation">\</span>administrator<span class="token punctuation">\</span>appdata<span class="token punctuation">\</span>roaming<span class="token punctuation">\</span>python<span class="token punctuation">\</span>python38<span class="token punctuation">\</span>site-packages <span class="token punctuation">(</span>from django-cors-headers<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token number">3.1</span>.7<span class="token punctuation">)</span>
Requirement already satisfied: sqlparse<span class="token operator">&gt;=</span><span class="token number">0.2</span>.2 <span class="token keyword">in</span> c:<span class="token punctuation">\</span>users<span class="token punctuation">\</span>administrator<span class="token punctuation">\</span>appdata<span class="token punctuation">\</span>roaming<span class="token punctuation">\</span>python<span class="token punctuation">\</span>python38<span class="token punctuation">\</span>site-packages <span class="token punctuation">(</span>from Django<span class="token operator">&gt;=</span><span class="token number">2.2</span>-<span class="token operator">&gt;</span>django-cors-headers<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token number">0.4</span>.1<span class="token punctuation">)</span>
Requirement already satisfied: asgiref<span class="token operator">&lt;</span><span class="token number">4</span>,<span class="token operator">&gt;=</span><span class="token number">3.2</span>.10 <span class="token keyword">in</span> c:<span class="token punctuation">\</span>users<span class="token punctuation">\</span>administrator<span class="token punctuation">\</span>appdata<span class="token punctuation">\</span>roaming<span class="token punctuation">\</span>python<span class="token punctuation">\</span>python38<span class="token punctuation">\</span>site-packages <span class="token punctuation">(</span>from Django<span class="token operator">&gt;=</span><span class="token number">2.2</span>-<span class="token operator">&gt;</span>django-cors-headers<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token number">3.3</span>.1<span class="token punctuation">)</span>
Requirement already satisfied: pytz <span class="token keyword">in</span> c:<span class="token punctuation">\</span>program files<span class="token punctuation">\</span>python38<span class="token punctuation">\</span>lib<span class="token punctuation">\</span>site-packages <span class="token punctuation">(</span>from Django<span class="token operator">&gt;=</span><span class="token number">2.2</span>-<span class="token operator">&gt;</span>django-cors-headers<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token number">2021.1</span><span class="token punctuation">)</span>
Installing collected packages: django-cors-headers
Successfully installed django-cors-headers-3.7.0

</code></pre> 
<h3><a id="settingspy_1168"></a>配置settings.py</h3> 
<pre><code class="prism language-bash">INSTALLED_APPS <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">..</span>.
    <span class="token string">'corsheaders'</span>,
    <span class="token punctuation">..</span>.
<span class="token punctuation">]</span>

MIDDLEWARE <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'corsheaders.middleware.CorsMiddleware'</span>,	<span class="token comment"># 放最前面</span>
    <span class="token punctuation">..</span>.
<span class="token punctuation">]</span>

</code></pre> 
<p>以下为可选配置</p> 
<h3><a id="CORS_ORIGIN_ALLOW_ALL_1185"></a>CORS_ORIGIN_ALLOW_ALL:</h3> 
<p>添加允许执行跨站点请求的主机</p> 
<pre><code class="prism language-bash"><span class="token comment"># 如果为True，则将不使用白名单，并且将接受所有来源。默认为False</span>
CORS_ORIGIN_ALLOW_ALL <span class="token operator">=</span> True	
</code></pre> 
<h3><a id="CORS_ORIGIN_WHITELIST_1193"></a>CORS_ORIGIN_WHITELIST:</h3> 
<p>授权进行跨站点HTTP请求的来源列表。默认为[]</p> 
<pre><code class="prism language-bash">CORS_ORIGIN_WHITELIST <span class="token operator">=</span> <span class="token punctuation">[</span>
	<span class="token string">"https://example.com"</span>，
    <span class="token string">"https://sub.example.com"</span>，
    <span class="token string">"http//localhost:8080"</span>,
    <span class="token string">"http://127.0.0.1:9000"</span>,
<span class="token punctuation">]</span>
</code></pre> 
<h3><a id="CORS_ORIGIN_REGEX_WHITELIST_1205"></a>CORS_ORIGIN_REGEX_WHITELIST:</h3> 
<p>代表正则表达式的字符串列表</p> 
<pre><code class="prism language-bash">CORS_ORIGIN_REGEX_WHITELIST <span class="token operator">=</span> <span class="token punctuation">[</span>
	r<span class="token string">"^https://\w+\.example\.com$"</span>,
<span class="token punctuation">]</span>
</code></pre> 
<h3><a id="CORS_URLS_REGEX_1213"></a>CORS_URLS_REGEX:</h3> 
<p>只需要在网站的一部分上使用CORS时很有用，例如位于的API /api/。</p> 
<pre><code class="prism language-bash">CORS_URLS_REGEX <span class="token operator">=</span> r<span class="token string">'^/api/.*$'</span>
</code></pre> 
<h3><a id="CORS_ALLOW_METHODS_1220"></a>CORS_ALLOW_METHODS:</h3> 
<p>实际请求所允许的HTTP动词列表。</p> 
<pre><code class="prism language-bash"><span class="token comment"># 默认为</span>
<span class="token comment"># CORS_ALLOW_METHODS = [</span>
<span class="token comment">#     'DELETE',</span>
<span class="token comment">#     'GET',</span>
<span class="token comment">#     'OPTIONS',</span>
<span class="token comment">#     'PATCH',</span>
<span class="token comment">#     'POST',</span>
<span class="token comment">#     'PUT',</span>
<span class="token comment"># ]</span>

<span class="token comment"># 自定义所允许的http动词列表</span>
from corsheaders.defaults <span class="token function">import</span> default_methods
CORS_ALLOW_METHODS <span class="token operator">=</span> list<span class="token punctuation">(</span>default_methods<span class="token punctuation">)</span> + <span class="token punctuation">[</span>
    <span class="token string">'POKE'</span>,
<span class="token punctuation">]</span>

</code></pre> 
<h3><a id="CORS_ALLOW_HEADERS_1244"></a>CORS_ALLOW_HEADERS:</h3> 
<p>发出实际请求时可以使用的非标准HTTP标头的列表。</p> 
<pre><code class="prism language-bash"><span class="token comment"># 默认为:</span>
CORS_ALLOW_HEADERS <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'accept'</span>,
    <span class="token string">'accept-encoding'</span>,
    <span class="token string">'authorization'</span>,
    <span class="token string">'content-type'</span>,
    <span class="token string">'dnt'</span>,
    <span class="token string">'origin'</span>,
    <span class="token string">'user-agent'</span>,
    <span class="token string">'x-csrftoken'</span>,
    <span class="token string">'x-requested-with'</span>,
<span class="token punctuation">]</span>

<span class="token comment"># 自定义http标头</span>
from corsheaders.defaults <span class="token function">import</span> default_headers
CORS_ALLOW_HEADERS <span class="token operator">=</span> list<span class="token punctuation">(</span>default_headers<span class="token punctuation">)</span> + <span class="token punctuation">[</span>
    <span class="token string">'my-custom-header'</span>,
<span class="token punctuation">]</span>
</code></pre> 
<h3><a id="CORS_EXPOSE_HEADERS_1268"></a>CORS_EXPOSE_HEADERS:</h3> 
<p>将向浏览器公开的HTTP标头列表。默认为 []。</p> 
<h3><a id="CORS_PREFLIGHT_MAX_AGE_1270"></a>CORS_PREFLIGHT_MAX_AGE:</h3> 
<p>客户端/浏览器可以缓存预检响应的秒数。如果该值为0（或任何错误值），则不会发送最大期限标头。默认为 86400（一天）。</p> 
<p>注意：预检请求是在发出“不太简单”的请求（例如Content-Type，不是 application/x-www-form-urlencoded）时确定的，它是确定服务器实际接受的请求的额外请求。</p> 
<h3><a id="CORS_ALLOW_CREDENTIALS_1275"></a>CORS_ALLOW_CREDENTIALS:</h3> 
<p>如果为True，则将允许将cookie包含在跨站点HTTP请求中。默认为False<br> 在Django 2.1中，添加了SESSION_COOKIE_SAMESITE设置，'Lax’默认情况下设置为 ，这将防止Django的会话cookie跨域发送。更改它以None绕过此安全限制。</p> 
<h3><a id="CSRF_1280"></a>CSRF整合</h3> 
<p>大多数站点都需要利用Django提供的跨站点请求伪造保护。CORS和CSRF是分开的，并且Django无法使用您的CORS配置免除网站Referer对安全请求所做的检查。做到这一点的方法是使用其CSRF_TRUSTED_ORIGINS设置。例如：</p> 
<pre><code class="prism language-bash">CORS_ORIGIN_WHITELIST <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'http://read.only.com'</span>,
    <span class="token string">'http://change.allowed.com'</span>,
<span class="token punctuation">]</span>

CSRF_TRUSTED_ORIGINS <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'change.allowed.com'</span>,
<span class="token punctuation">]</span>

</code></pre> 
<h3><a id="CORS_REPLACE_HTTPS_REFERER_1296"></a>CORS_REPLACE_HTTPS_REFERER</h3> 
<p>CSRF_TRUSTED_ORIGINS是Django 1.9中引入的，因此早期版本的用户将需要替代解决方案。如果CORS_REPLACE_HTTPS_REFERER为 True，CorsMiddleware则将Referer标头更改为每当CORS检查通过时将通过Django的CSRF检查的内容。默认为 False。</p> 
<p>请注意，与不同CSRF_TRUSTED_ORIGINS，此设置不允许您区分CORS 信任读取资源的域和避免CSRF保护而信任更改资源的域。</p> 
<p>启用此功能corsheaders.middleware.CorsPostCsrfMiddleware后django.middleware.csrf.CsrfViewMiddleware，还应该在之后 添加，MIDDLEWARE_CLASSES以撤消Referer替换：</p> 
<pre><code class="prism language-bash">MIDDLEWARE_CLASSES <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">..</span>.
    <span class="token string">'corsheaders.middleware.CorsMiddleware'</span>,
    <span class="token punctuation">..</span>.
    <span class="token string">'django.middleware.csrf.CsrfViewMiddleware'</span>,
    <span class="token string">'corsheaders.middleware.CorsPostCsrfMiddleware'</span>,
    <span class="token punctuation">..</span>.
<span class="token punctuation">]</span>

</code></pre> 
<h2><a id="_1317"></a>其他问题</h2> 
<h3><a id="DEFAULT_AUTO_FIELD_warnings_1318"></a>DEFAULT_AUTO_FIELD warnings</h3> 
<p>当您在Django中定义一个没有指定主键的model时，Django将自动为您创建一个主键。主键设置为整数类型（integer）。如果要覆盖该字段类型，可以在每个模型（model）的基础上执行此操作。</p> 
<p>从Django 3.2开始，您现在可以在您的设置（settings）中自定义自动创建的主键的类型。</p> 
<p>在Django 3.2中开始新项目时，主键的默认类型设置为BigAutoField，这是一个64位整数（64 bit integer）。但是，早期版本将隐式主键的类型设置为整数（integer）。</p> 
<p>这意味着当您升级到3.2版本时，您将开始看到有关您没有显式定义的主键类型的警告。满足Django对显式设置主键类型的要求很容易，但您还需要选择是否要将主键字段类型从整数升级到64位整数。</p> 
<p>升级到3.2后，官方文档中的建议是运行以下代码：</p> 
<pre><code class="prism language-bash">python <span class="token parameter variable">-Wa</span> manage.py <span class="token builtin class-name">test</span>
</code></pre> 
<p>有几种方法可以解决这个问题。一般说来，它们分为两类：不需要迁移的和需要迁移的。</p> 
<p>（一）不需要迁移的解决办法：No migrations<br> 如果您想要最简单的升级路径而不需要迁移，则需要告诉Django将DEFAULT_AUTO_FIELD设置为Autofield，这在幕后是一个IntegerField。有几个地方可以做到这一点</p> 
<p>（方法一）Configure DEFAULT_AUTO_FIELD in settings<br> 打开项目的settings.py并在文件底部添加新行，本例用的此法。</p> 
<pre><code class="prism language-bash">DEFAULT_AUTO_FIELD <span class="token operator">=</span> <span class="token string">'django.db.models.AutoField'</span>
</code></pre> 
<p>（方法二）Setting on a per app basis<br> 如果您更喜欢在每个应用程序（app）的基础上设置字段类型，而不是整个项目（project），您可以在apps.py中指定这一点。</p> 
<p>如果您希望每个应用程序使用不同的自动字段类型，则可能需要执行此操作。对于带有博客应用程序的假设项目，在apps.py中添加default_auto_field行就可以了：</p> 
<pre><code class="prism language-bash">from django.apps <span class="token function">import</span> AppConfig
 
class BlogConfig<span class="token punctuation">(</span>AppConfig<span class="token punctuation">)</span>:
    default_auto_field <span class="token operator">=</span> <span class="token string">'django.db.models.AutoField'</span>
    name <span class="token operator">=</span> <span class="token string">'blog'</span>
</code></pre> 
<p>（二）迁移的解决办法：Migrations<br> 如果您不介意创建和运行迁移，那么您可以使用新的BigAutoField。同样，有几种方法可以实现这一点：</p> 
<p>（1）Configure DEFAULT_AUTO_FIELD in settings to use BigAutoField<br> 打开项目的settings.py并将以下内容添加到底部：</p> 
<pre><code class="prism language-bash">DEFAULT_AUTO_FIELD <span class="token operator">=</span> <span class="token string">'django.db.models.BigAutoField'</span>
</code></pre> 
<p>然后，您需要创建并运行迁移以更新数据库以使用新的字段类型。迁移将改变model上的id字段。要在名为blog的假想应用程序中创建并运行迁移，您需要运行以下命令：</p> 
<pre><code class="prism language-bash">python manage.py makemigrations blog
 
python manage.py sqlmigrate blog <span class="token operator">&lt;</span>migration_number<span class="token operator">&gt;</span>
</code></pre> 
<p>（2）Set default_auto_field to BigAutoField on a per app basis<br> 如上所述，您可以针对每个应用程序（app）配置该设置，因此在apps.py中，您可以将DEFAULT_AUTO_FIELD设置为BigAutoField：</p> 
<pre><code class="prism language-bash">from django.apps <span class="token function">import</span> AppConfig
 
class BlogConfig<span class="token punctuation">(</span>AppConfig<span class="token punctuation">)</span>:
    default_auto_field <span class="token operator">=</span> <span class="token string">'django.db.models.BigAutoField'</span>
    name <span class="token operator">=</span> <span class="token string">'my_app'</span>
</code></pre> 
<p>并再次为您的应用程序创建和运行迁移。</p> 
<p>（3）Set AutoField or BigAutoField on a per model basis<br> 如果您喜欢更细粒度的控制，可以设置每个model的id字段。例如：Blog app可能有一个BlogPost model。您可以在每个model上显式设置一个id字段。<br> 在假设的博客应用程序中，您可以修改blog/models.py</p> 
<pre><code class="prism language-bash">class BlogPost<span class="token punctuation">(</span>models.Model<span class="token punctuation">)</span>:
    <span class="token function">id</span> <span class="token operator">=</span> models.BigAutoField<span class="token punctuation">(</span>primary_key<span class="token operator">=</span>True<span class="token punctuation">)</span>
    <span class="token comment"># ...other fields</span>
</code></pre> 
<p>如果您愿意，也可以将公共基础模型子类化。如果您有大量的model，或许可以省去一些打字工作。在假设的blog应用程序中，您将定义一个CommonBaseModel ，然后在每个Model中继承它</p> 
<pre><code class="prism language-bash">from django.db <span class="token function">import</span> models
 
class CommonBaseModel<span class="token punctuation">(</span>models.Model<span class="token punctuation">)</span>:
    <span class="token function">id</span> <span class="token operator">=</span> models.BigAutoField<span class="token punctuation">(</span>primary_key<span class="token operator">=</span>True<span class="token punctuation">)</span>
 
    class Meta:
        abstract <span class="token operator">=</span> True
 
 
<span class="token comment"># Create your models here.</span>
class BlogPost<span class="token punctuation">(</span>CommonBaseModel<span class="token punctuation">)</span>:
   <span class="token comment"># ...other fields</span>
</code></pre> 
<p>在前面两个示例中，如果您希望将主键保留为integer，则可以使用Autofield而不是BigAutoField。但是，您仍然需要进行并运行迁移以保持完全最新，因为您已经更改了模型定义。</p> 
<h3><a id="Forbidden_CSRF_cookie_not_set_1415"></a>报错：Forbidden (CSRF cookie not set.)</h3> 
<p>对使用django框架开发的web网页作接口测试时，使用POST方法请求数据时<br> 出现报错： Forbidden (CSRF cookie not set.): ****</p> 
<p>解决办法：项目文件中的setting.py中将csrf语句注释掉<br> <img src="https://images2.imgbox.com/90/a5/pRNC25vt_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/76ad0d2ecc3232cbf3daf494b2757ffd/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Linux 安装Jupyter notebook 并开启远程访问</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c49f53b4e3328cd32ee0593694a5e5a5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">API服务的快速搭建和测试</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>