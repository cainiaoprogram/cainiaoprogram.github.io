<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>取相关记录集数据 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="取相关记录集数据" />
<meta property="og:description" content="//1 使可以选择对象。
public void SelectPoint() { foreach (Layer currentLayer in m_mapControl.Map.Layers) { Dataset dataset = currentLayer.Dataset; #region //这里必须加dataset!= null 这样可以先判读dataset。 //如果dataset为空。就可以不执行dataset.Name == &#34;EQPoint&#34; //如果不加dataset!=null,如果dataset为空时，执行dataset.Name == &#34;EQPoint&#34;会使程序崩掉 //dataset.Name 要使用对象属性，先要保证对象不为空 #endregion if (dataset != null &amp;&amp; dataset.Name == &#34;Point&#34;) { currentLayer.IsSelectable = true; } else { currentLayer.IsSelectable = false; } } SetMapAction(Action.Select); //设置为可以选择地图图形对象，select只能点击选择，不能框选 } //2 触发图形对象选择事件，选点----》取点id----》根据点id取有关所有面id---》根据面ID找到 void m_mapControl_GeometrySelected(object sender, GeometrySelectedEventArgs e) { Recordset recordsetSelected = null; //获得选中的点对象。因为设了Acton.select 所以只能选中一个对象 Selection[] arrSelections = m_mapControl." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/c360df427dcc4eb3e6b2cf6abed16753/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2012-11-22T08:44:38+08:00" />
<meta property="article:modified_time" content="2012-11-22T08:44:38+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">取相关记录集数据</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>//1 使可以选择对象。</p> 
<p></p> 
<pre style="font-family:新宋体; font-size:13; color:black; background:white"><span style="color:blue">public</span> <span style="color:blue">void</span> SelectPoint()
{
    <span style="color:blue">foreach</span> (<span style="color:#2b91af">Layer</span> currentLayer <span style="color:blue">in</span> m_mapControl.Map.Layers)
    {
        <span style="color:#2b91af">Dataset</span> dataset = currentLayer.Dataset;
<span style="color:blue">        #region</span>
        <span style="color:green">//这里必须加dataset!= null  这样可以先判读dataset。</span>
        <span style="color:green">//如果dataset为空。就可以不执行dataset.Name == "EQPoint"</span>
        <span style="color:green">//如果不加dataset!=null,如果dataset为空时，执行dataset.Name == "EQPoint"会使程序崩掉</span>
        <span style="color:green">//dataset.Name  要使用对象属性，先要保证对象不为空</span>
<span style="color:blue">        #endregion</span>
        <span style="color:blue">if</span> (dataset != <span style="color:blue">null</span> &amp;&amp; dataset.Name == <span style="color:#a31515">"Point"</span>)
        {
            currentLayer.IsSelectable = <span style="color:blue">true</span>;
        }
        <span style="color:blue">else</span>
        {
            currentLayer.IsSelectable = <span style="color:blue">false</span>;
        }
    }
    SetMapAction(<span style="color:#2b91af">Action</span>.Select);  <span style="color:green">//设置为可以选择地图图形对象，select只能点击选择，不能框选</span>
 
}</pre> //2 触发图形对象选择事件，选点----》取点id----》根据点id取有关所有面id---》根据面ID找到 
<pre style="font-family:新宋体; font-size:13; color:black; background:white"><span style="color:blue">void</span> m_mapControl_GeometrySelected(<span style="color:blue">object</span> sender, <span style="color:#2b91af">GeometrySelectedEventArgs</span> e)
{
    <span style="color:#2b91af">Recordset</span> recordsetSelected = <span style="color:blue">null</span>;
    <span style="color:green">//获得选中的点对象。因为设了Acton.select  所以只能选中一个对象</span>
    <span style="color:#2b91af">Selection</span>[] arrSelections = m_mapControl.Map.FindSelection(<span style="color:blue">true</span>);
    <span style="color:blue">if</span> (arrSelections != <span style="color:blue">null</span> &amp;&amp; arrSelections.Length != 0)
    {
        <span style="color:green">//把选择集转化为记录集</span>
        recordsetSelected = arrSelections[0].ToRecordset();
        <span style="color:green">//要从记录集取数据，就先移到第一行</span>
        recordsetSelected.MoveFirst();
        <span style="color:blue">if</span> (!recordsetSelected.IsEOF)
        {
            <span style="color:green">//获得选中点 在EQPoint表中第三列值，即linkID</span>
            <span style="color:#2b91af">Object</span> objSelectedLinkID = recordsetSelected.GetFieldValue(2);
            <span style="color:blue">string</span> strSelectedLinkID = objSelectedLinkID.ToString();
            rs_EQCon = ds_EQCon.Query(<span style="color:#a31515">"ID='"</span> + strSelectedLinkID + <span style="color:#a31515">"'"</span>, <span style="color:#2b91af">CursorType</span>.Static);
            <span style="color:green">//获得记录集中所有AAC</span>
            <span style="color:#2b91af">ArrayList</span> arrlistAAC = <span style="color:blue">new</span> <span style="color:#2b91af">ArrayList</span>();
            rs_EQCon.MoveFirst();
            <span style="color:blue">while</span> (!rs_EQCon.IsEOF)
            {
                <span style="color:blue">object</span> objSelectedAAC = rs_EQCon.GetFieldValue(5);
                <span style="color:blue">if</span> (!arrlistAAC.Contains(objSelectedAAC))  <span style="color:green">//如果Arraylist中有的就不加入了</span>
                {
                    arrlistAAC.Add(objSelectedAAC.ToString());
                }
 
                rs_EQCon.MoveNext();
            }
            <span style="color:blue">string</span> strSelectedAAC = FormatArrayList(arrlistAAC);
            ShowThemeLayer(strSelectedAAC);
            rs_EQCon.Dispose();
        }
    }
    recordsetSelected.Dispose();
}

<pre style="font-family:新宋体; font-size:13; color:black; background:white"><span style="color:blue">private</span> <span style="color:blue">string</span> FormatArrayList(<span style="color:#2b91af">ArrayList</span> arrlist)
{
    <span style="color:#2b91af">StringBuilder</span> strBuilder = <span style="color:blue">new</span> <span style="color:#2b91af">StringBuilder</span>();
    strBuilder.Append(<span style="color:#a31515">"("</span>);
    <span style="color:blue">for</span> (<span style="color:blue">int</span> i = 0; i &lt; arrlist.Count; i++)
    {
        strBuilder.Append(<span style="color:#a31515">"'"</span> + arrlist[i].ToString() + <span style="color:#a31515">"'"</span>);
        <span style="color:blue">if</span> (i &lt; arrlist.Count - 1)
        {
            strBuilder.Append(<span style="color:#a31515">","</span>);
        }
    }
    strBuilder.Append(<span style="color:#a31515">")"</span>);
    <span style="color:blue">return</span> strBuilder.ToString();
}</pre><br></pre> 
<pre style="font-family:新宋体; font-size:13; color:black; background:white">        <span style="color:gray">///</span><span style="color:green"> </span><span style="color:gray">&lt;summary&gt;</span>
        <span style="color:gray">///</span><span style="color:green"> 根据条件筛选出需要的面</span>
        <span style="color:gray">///</span><span style="color:green"> </span><span style="color:gray">&lt;/summary&gt;</span>
<span style="color:blue">private</span> <span style="color:blue">void</span> ShowThemeLayer(<span style="color:blue">string</span> strSelectedAAC)
{
    m_mapControl.Map.Layers.Remove(str_ThemeLayerName);
    <span style="color:#2b91af">DatasetVector</span> dsvCON = m_workspace.Datasources[<span style="color:#a31515">0</span>].Datasets[<span style="color:#a31515">"mian"</span>] <span style="color:blue">as</span> <span style="color:#2b91af">DatasetVector</span>;
    <span style="color:#2b91af">ThemeLabel</span> themeLabel = <span style="color:blue">new</span> <span style="color:#2b91af">ThemeLabel</span>();
    themeLabel.LabelExpression = <span style="color:#a31515">"city"</span>;
 
    <span style="color:#2b91af">TextStyle</span> textStyle = <span style="color:blue">new</span> <span style="color:#2b91af">TextStyle</span>();
    textStyle.ForeColor = Color.Red;
    textStyle.FontHeight = 8;
    textStyle.IsSizeFixed = <span style="color:blue">true</span>;
 
    themeLabel.UniformStyle = textStyle;
 
    <span style="color:#2b91af">Layer</span> layerCON = m_mapControl.Map.Layers.Add(dsvCON, themeLabel, <span style="color:blue">true</span>);
    <span style="color:#2b91af">QueryParameter</span> parameter = <span style="color:blue">new</span> <span style="color:#2b91af">QueryParameter</span>();
 
    <span style="color:blue">string</span> strFilter = <span style="color:#a31515">"mianID in "</span> + strSelectedAAC;
    parameter.AttributeFilter = strFilter;
    layerCON.DisplayFilter = parameter;
    str_ThemeLayerName = layerCON.Name;
 
    m_mapControl.Map.Refresh();
}</pre> 
<pre style="font-family:新宋体; font-size:13; color:black; background:white"></pre> 
<br> 
<p></p> 
<br>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/de3ee6b2b91b945015071dbf3c9838e4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">北理工虚拟现实作业-OpenGL下实现3D Max模型的导入</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a382b0ce6978c901e07ed2b44af21d7a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">使用mod_wsgi部署django</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>