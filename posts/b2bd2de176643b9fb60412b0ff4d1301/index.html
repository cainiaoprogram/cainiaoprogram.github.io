<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Cesium学习笔记（4） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Cesium学习笔记（4）" />
<meta property="og:description" content="最近更新于2016/11/27
1.姿态与位置（orientation和position）
Orientation： 若以正北为参照。 Heading:初始方向为正北，正角度为向东旋转，即水平旋转，也叫偏航角 Pitch:正角度为平面之上，负角度为平面之下，即前后旋转，也叫俯仰角 Roll:左右旋转，也叫翻滚角
具体解释：http://blog.csdn.net/yuzhongchun/article/details/22749521
Position: 关于position有多种类型，如SampledPositionProperty类型，是一个含有多个样本点位置的对象，主要用于动态轨迹生成，通过插值算法对轨迹进行插值，其中setInterpolationOptions方法用来设置插值方法与程度,它的某一时间的位置可以用position.getValue()方法获得，参数是朱利安时间 2.实体（Entity） model: minimumPixelSize与maximumScale组合可以控制模型远近时候的大小 availability: 代表该实体存在的有效时间，如下所示， availability : new Cesium.TimeIntervalCollection([new Cesium.TimeInterval({ start : start, stop : stop })]),
3.图层（viewer.imageryLayers/viewer.scene. imageryLayers） 得到影像图层的集合，将其渲染到球体上，它是一个ImageryLayerCollection类型的，可以通过addImageryProvider()方法（返回值是ImageryLayer类型）进行添加,参数是各个provider(地图渲染引擎)。 viewer.imageryLayers.addImageryProvider(new Cesium.PieMapServerImageryProvider({ url: &#39;//localhost:8082/service/v1/tile?map=dongsha&#39;, enablePickFeatures: false }));
4.大气、光照、雾效等环境特效 光照: scene.globe.enableLighting 雾效：scene.fog.enabled 大气：scene.skyAtmosphere
5.相机控制 Scene.ScreenSpaceCameraController：根据鼠标修改相机的方位，在里面可以选择是否禁用鼠标缩放、旋转等功能 关于flyto和setView的方式详见例子camera.html
6.时间控制 获取当前时间 var time = viewer.clock.currentTime; viewer.clock.onTick.addEventListener(function(clock){ //回调函数，时间变化就执行（即使停止时间轴仍然会执行。。。。） }) JulianDate：代表天文朱利安时间，用的是世界协调时，比北京时间晚8个小时，它有clone方法，可避免时间被修改 var start = Cesium.JulianDate.fromDate(new Date(2015, 2, 25, 16)); var stop = Cesium.JulianDate.addSeconds(start, 360, new Cesium." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/b2bd2de176643b9fb60412b0ff4d1301/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2016-09-24T20:10:12+08:00" />
<meta property="article:modified_time" content="2016-09-24T20:10:12+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Cesium学习笔记（4）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><span style="color:#ff0000">最近更新于2016/11/27</span></p> 
<p><br> </p> 
<p>1.姿态与位置（orientation和position）</p> Orientation： 
<br> 若以正北为参照。 
<br> Heading:初始方向为正北，正角度为向东旋转，即水平旋转，也叫偏航角 
<br> Pitch:正角度为平面之上，负角度为平面之下，即前后旋转，也叫俯仰角 
<br> 
<p>Roll:左右旋转，也叫翻滚角</p> 
<p>具体解释：http://blog.csdn.net/yuzhongchun/article/details/22749521</p> Position: 
<br> 关于position有多种类型，如SampledPositionProperty类型，是一个含有多个样本点位置的对象，主要用于动态轨迹生成，通过插值算法对轨迹进行插值，其中setInterpolationOptions方法用来设置插值方法与程度,它的某一时间的位置可以用position.getValue()方法获得，参数是朱利安时间 
<br> 
<br> 
<br> 2.实体（Entity） 
<br> model: 
<br> minimumPixelSize与maximumScale组合可以控制模型远近时候的大小 
<br> availability: 代表该实体存在的有效时间，如下所示， 
<br> availability : new Cesium.TimeIntervalCollection([new Cesium.TimeInterval({ 
<br>         start : start, 
<br>         stop : stop 
<br> 
<p>    })]),</p> 
<p><br> </p> 3.图层（viewer.imageryLayers/viewer.scene. imageryLayers） 
<br> 得到影像图层的集合，将其渲染到球体上，它是一个ImageryLayerCollection类型的，可以通过addImageryProvider()方法（返回值是ImageryLayer类型）进行添加,参数是各个provider(地图渲染引擎)。 
<br> viewer.imageryLayers.addImageryProvider(new Cesium.PieMapServerImageryProvider({ 
<br>        url: '//localhost:8082/service/v1/tile?map=dongsha', 
<br>         enablePickFeatures: false 
<br> 
<p>    }));</p> 
<p><br> </p> 4.大气、光照、雾效等环境特效 
<br> 光照: scene.globe.enableLighting 
<br> 雾效：scene.fog.enabled 
<br> 
<p>大气：scene.skyAtmosphere</p> 
<p><br> </p> 5.相机控制 
<br> Scene.ScreenSpaceCameraController：根据鼠标修改相机的方位，在里面可以选择是否禁用鼠标缩放、旋转等功能 
<br> 
<p>关于flyto和setView的方式详见例子camera.html</p> 
<p><br> </p> 6.时间控制 
<br> 获取当前时间 var time = viewer.clock.currentTime; 
<br> viewer.clock.onTick.addEventListener(function(clock){ 
<br> 
<span style="white-space:pre"></span>//回调函数，时间变化就执行（即使停止时间轴仍然会执行。。。。） 
<br> }) 
<br> 
<br> 
<br> JulianDate：代表天文朱利安时间，用的是世界协调时，比北京时间晚8个小时，它有clone方法，可避免时间被修改 
<br> var start = Cesium.JulianDate.fromDate(new Date(2015, 2, 25, 16)); 
<br> var stop = Cesium.JulianDate.addSeconds(start, 360, new Cesium.JulianDate());//360是秒 
<br> viewer.clock.startTime = start.clone(); 
<br> viewer.clock.stopTime = stop.clone(); 
<br> viewer.clock.currentTime = start.clone(); 
<br> viewer.clock.clockRange = Cesium.ClockRange.LOOP_STOP;//待研究 
<br> 
<p>viewer.clock.multiplier = 1.0;//倍数</p> 
<p><br> </p> 7.关于地形 
<br> viewer.scene.globe.depthTestAgainstTerrain = true; 
<br> 
<p>为true时，球体会有高程遮挡效果（在没有地形时候也会有高程遮挡效果）。</p> 
<p><br> </p> 8.模型属性设置 
<br> 对于加入cesium中的模型，一般用entity。如若修改他们的属性，就可根据这两个类型向下寻找属性，不可修改它的私有属性。 
<br> 
<p>获取单个模型，用entity.getById()</p> 
<p><br> </p> 
<p>9.其他问题</p> 
<p><br> </p> 
<p>①Geocoder地理查询17版本不支持，我用的23版本是可以查的，而且支持中文查询。如果必须用17的话，可以将23版本的BingMapsApi.js和GeocoderViewModel.js替换到17版本的相应位置。</p> 
<p><br> </p> ②贴地线 
<br> 
<pre><code class="language-html">var viewer = new Cesium.Viewer('cesiumContainer');
viewer.terrainProvider = new Cesium.CesiumTerrainProvider({
    url : 'https://assets.agi.com/stk-terrain/world'
});


var ellipsoid = viewer.scene.globe.ellipsoid;
var positions = Cesium.Cartesian3.fromDegreesArray([
    -115, 35,
    -114, 36
]);


var flatPositions = Cesium.PolylinePipeline.generateArc({
    positions: positions,
    granularity: 0.000001
});


var cartographicArray = [];
for (var i = 0; i &lt; flatPositions.length; i+=3) {
    var cartesian = Cesium.Cartesian3.unpack(flatPositions, i);
    cartographicArray.push(ellipsoid.cartesianToCartographic(cartesian));
}


Cesium.sampleTerrain(viewer.terrainProvider, 15, cartographicArray)
.then(function(raisedPositionsCartograhpic) {
    var raisedPositions = ellipsoid.cartographicArrayToCartesianArray(raisedPositionsCartograhpic);
    //console.log(raisedPositions)
    viewer.entities.add({
        polyline : {
            positions : raisedPositions,
            width : 5,
            material : Cesium.Color.RED
        }
    });
    viewer.zoomTo(viewer.entities);
});</code></pre> 
<p><br> </p> ③去除版权信息 
<br> 
<p>viewer._cesiumWidget._creditContainer.style.display = "none";</p> 
<p><br> </p> 10.关于地图加载 
<br> ①图层是都保存在viewer.scene. imageryLayers或viewer.imageryLayers这个数组中。 
<br> ②图层加载流程：此为加载天地图方法 
<br> baseLayer = viewer.imageryLayers.addImageryProvider( 
<br>         new Cesium.WebMapTileServiceImageryProvider({ 
<br>             url:  "http://t0.tianditu.com/cva_w/wmts?service=wmts&amp;request=GetTile&amp;version=1.0.0&amp;LAYER=cva&amp;tileMatrixSet=w&amp;TileMatrix={TileMatrix}&amp;TileRow={TileRow}&amp;TileCol={TileCol}&amp;style=default&amp;format=tiles", 
<br>             layer: "tdtAnnoLayer", 
<br>             style: "default", 
<br>             format: "image/jpeg", 
<br>             tileMatrixSetID: "GoogleMapsCompatible", 
<br>             show: false 
<br>         }), 1); 
<br> 以此为例，添加一个wmts服务， 先到viewer.js里面，走addImageryProvider方法，得到this.scene.imageryLayers；再到scene.js里面，得到this.globe.imageryLayers；再到globe.js里面，得到this._imageryLayerCollection； 
<br> ③图层换级流程（过程太多，只写了一部分，后期继续跟进。。。）： 
<br> 
<p>当进行层级切换时，ImageryLayer.prototype. _createTileImagerySkeletons方法中有getLevelWithMaximumTexelSpacing方法，此方法是计算获得level层级。</p> 
<p><img src="https://images2.imgbox.com/17/49/3rDLAmDu_o.png" alt=""><br> </p>   ImageryLayer.prototype._requestImagery中执行doRequest()方法，进入渲染引擎的requestImage方法，参数为x,y,level；接着走buildImageUrl方法，里面主要是拼接url，将拼接后的url传入ImageryProvider.loadImage方法中，然后进行加载。接着继续重复执行doRequest()方法。
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f99559814a1a7ea7a4f1957f4830dfbe/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">MySQL数据类型 BLOB和TEXT</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0ed14e1d7a24fa4deca8f110de59b9d3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Android–多线程之Handler下载图片源码</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>