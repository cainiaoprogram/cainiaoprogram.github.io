<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>一文教你如何准确判断元素是否在可视区域！ - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="一文教你如何准确判断元素是否在可视区域！" />
<meta property="og:description" content="方法1：getBoundingClientRect 用法 let domRect = dom.getBoundingClientRect()； DOMRect：{ x/left：视图原点（左上角）距离dom左边框距离， y/top：视图原点（左上角）距离dom上边框距离， right：视图原点（左上角）距离dom右边框距离， bottom：视图原点（左上角）距离dom底边框距离， width：dom的宽度，标准盒模型，width = 宽度&#43;padding&#43;border；怪异盒模型，width = 设置的宽度， height：dom的高度， } 所以我们可以根据DOMRect的中的各个属性来判断dom是否在可视区域内。
eg:
&lt;!DOCTYPE html&gt; &lt;html lang=&#34;en&#34;&gt; &lt;head&gt; &lt;meta charset=&#34;UTF-8&#34;&gt; &lt;meta http-equiv=&#34;X-UA-Compatible&#34; content=&#34;IE=edge&#34;&gt; &lt;meta name=&#34;viewport&#34; content=&#34;width=device-width, initial-scale=1.0&#34;&gt; &lt;title&gt;getBoundingClientRect可视区域&lt;/title&gt; &lt;style&gt; * { margin: 0 } .circle-wrap { position: fixed; top: 50px; right: 50px; padding: 10px; box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1); width: 140px; background: #fff; } .circle-wrap .circle { display: inline-block; width: 20px; height: 20px; border-radius: 50%; background: red; } ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/8356ad4bd043463f265930de641bf698/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-06T17:41:34+08:00" />
<meta property="article:modified_time" content="2023-12-06T17:41:34+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">一文教你如何准确判断元素是否在可视区域！</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="1getBoundingClientRect_0"></a>方法1：getBoundingClientRect</h2> 
<h3><a id="_2"></a>用法</h3> 
<pre><code>let domRect = dom.getBoundingClientRect()；
</code></pre> 
<p><img src="https://images2.imgbox.com/4e/93/M55GJsJK_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/63/50/le6aRdjx_o.png" alt="在这里插入图片描述"></p> 
<pre><code>DOMRect：{
　　x/left：视图原点（左上角）距离dom左边框距离，
　　y/top：视图原点（左上角）距离dom上边框距离，
    right：视图原点（左上角）距离dom右边框距离，
    bottom：视图原点（左上角）距离dom底边框距离，
    width：dom的宽度，标准盒模型，width = 宽度+padding+border；怪异盒模型，width = 设置的宽度，
    height：dom的高度，
}
</code></pre> 
<p>所以我们可以根据<code>DOMRect</code>的中的各个属性来判断<code>dom</code>是否在可视区域内。</p> 
<p>eg:</p> 
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;

&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
  &lt;meta http-equiv="X-UA-Compatible" content="IE=edge"&gt;
  &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
  &lt;title&gt;getBoundingClientRect可视区域&lt;/title&gt;
  &lt;style&gt;
    * {
      margin: 0
    }
    .circle-wrap {
      position: fixed;
      top: 50px;
      right: 50px;
      padding: 10px;
      box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);
      width: 140px;
      background: #fff;
    }

    .circle-wrap .circle {
      display: inline-block;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: red;
    }

    .card-wrap {
      height: 2000px;
      width: 3000px;
      margin-top: 100px;
    }

    .card-wrap .card {
      width: 200px;
      height: 200px;
      padding: 20px;
      box-sizing: border-box;
      box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);
      margin-top: 500px;
      margin-left: 500px;
    }
  &lt;/style&gt;
&lt;/head&gt;

&lt;body&gt;
  &lt;div class="circle-wrap"&gt;
    &lt;span&gt;当下方的卡片在可视区域内，我的圈圈是绿色，否则是红色&lt;/span&gt;
    &lt;span class="circle"&gt;&lt;/span&gt;
  &lt;/div&gt;
  &lt;div class="card-wrap"&gt;
    &lt;div class="card"&gt;我是一个卡片&lt;/div&gt;
  &lt;/div&gt;
  &lt;script src="https://cdn.bootcdn.net/ajax/libs/lodash.js/4.17.20/lodash.js"&gt;&lt;/script&gt;
  &lt;script&gt;
    const card = document.querySelector(".card");
    const circle = document.querySelector(".circle");
    const getBoundingClientRectJudge = () =&gt; {
      let domRect = card.getBoundingClientRect();
      console.log(domRect)
      let ch = document.documentElement.clientHeight;
      let cw = document.documentElement.clientWidth;
      let isInsert = true;
      if (domRect.bottom &lt; 0 || domRect.top &gt; ch || domRect.right &lt; 0 || domRect.left &gt; cw) {
        isInsert = false;
      }
      let background = null
      if (isInsert) {
        background = "green"
      } else {
        background = "red"
      }
      circle.style.background = background
    }
    window.addEventListener("scroll", _.throttle(getBoundingClientRectJudge, 500))
    getBoundingClientRectJudge()
  &lt;/script&gt;
&lt;/body&gt;

&lt;/html&gt;
</code></pre> 
<p>效果图：</p> 
<p><img src="https://images2.imgbox.com/4d/ee/wuK5i5F8_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_119"></a>问题</h3> 
<p><code>getBoundingClientRect</code>并不能满足所有情况，甚至说，它只能满足一种情况的判断，那就是需要判断的那个<code>dom</code>节点，它只身处在一个滚动条的情况下。什么意思呢，就是它所有的祖先节点，加起来的滚动条只有1个，如果它父节点有滚动条，父父节点也有滚动条，那这种方法就不好用了，请看示例：</p> 
<p>下面展示的结果是错误的，圈圈应该是红色才对。 <img src="https://images2.imgbox.com/86/24/htXqdBMT_o.png" alt="在这里插入图片描述"></p> 
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;

&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
  &lt;meta http-equiv="X-UA-Compatible" content="IE=edge"&gt;
  &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
  &lt;title&gt;getBoundingClientRect可视区域&lt;/title&gt;
  &lt;style&gt;
    * {
      margin: 0
    }

    body {
      height: 2000px;
      width: 3000px;
    }

    .circle-wrap {
      position: fixed;
      top: 50px;
      right: 50px;
      padding: 10px;
      box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);
      width: 140px;
      background: #fff;
    }

    .circle-wrap .circle {
      display: inline-block;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: red;
    }

    .card-wrap {
      height: 400px;
      width: 600px;
      margin-top: 100px;
      margin-left: 100px;
      border: 1px solid green;
      overflow: auto;
    }

    .card-wrap .card {
      width: 200px;
      height: 200px;
      padding: 20px;
      box-sizing: border-box;
      box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);
      margin-top: 500px;
      margin-left: 500px;
    }

    .head {
      width: 100%;
      height: 100px;
      background: pink;
      /* position: fixed; */
      top: 0;
      left: 0;
    }
  &lt;/style&gt;
&lt;/head&gt;

&lt;body&gt;
  &lt;!-- &lt;div class="head"&gt;&lt;/div&gt; --&gt;
  &lt;div class="circle-wrap"&gt;
    &lt;span&gt;当下方的卡片在可视区域内，我的圈圈是绿色，否则是红色&lt;/span&gt;
    &lt;span class="circle"&gt;&lt;/span&gt;
  &lt;/div&gt;
  &lt;div class="card-wrap"&gt;
    &lt;div class="card"&gt;我是一个卡片&lt;/div&gt;
  &lt;/div&gt;
  &lt;script src="https://cdn.bootcdn.net/ajax/libs/lodash.js/4.17.20/lodash.js"&gt;&lt;/script&gt;
  &lt;script&gt;
    const card = document.querySelector(".card");
    const circle = document.querySelector(".circle");
    const getBoundingClientRectJudge = () =&gt; {
      let domRect = card.getBoundingClientRect();
      let ch = document.documentElement.clientHeight;
      let cw = document.documentElement.clientWidth;
      let isInsert = true;
      if (domRect.bottom &lt; 0 || domRect.top &gt; ch || domRect.right &lt; 0 || domRect.left &gt; cw) {
        isInsert = false;
      }
      let background = null
      if (isInsert) {
        background = "green"
      } else {
        background = "red"
      }
      circle.style.background = background
    }
    window.addEventListener("scroll", _.throttle(getBoundingClientRectJudge, 500))
    getBoundingClientRectJudge()
  &lt;/script&gt;
&lt;/body&gt;

&lt;/html&gt;
</code></pre> 
<blockquote> 
 <p>由此，我们引出第二种方法，IntersectionObserver。</p> 
</blockquote> 
<h2><a id="2IntersectionObserver_232"></a>方法2：IntersectionObserver</h2> 
<h3><a id="_234"></a>用法</h3> 
<p><img src="https://images2.imgbox.com/6a/c1/GE3jWe5l_o.png" alt="在这里插入图片描述"></p> 
<p>eg:</p> 
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;

&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
  &lt;meta http-equiv="X-UA-Compatible" content="IE=edge"&gt;
  &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
  &lt;title&gt;getBoundingClientRect可视区域&lt;/title&gt;
  &lt;style&gt;
    * {
      margin: 0
    }

    body {
      height: 2000px;
      width: 3000px;
    }

    .circle-wrap {
      position: fixed;
      top: 50px;
      right: 50px;
      padding: 10px;
      box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);
      width: 140px;
      background: #fff;
    }

    .circle-wrap .circle {
      display: inline-block;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: red;
    }

    .card-wrap {
      height: 400px;
      width: 600px;
      margin-top: 100px;
      margin-left: 100px;
      border: 1px solid green;
      overflow: auto;
    }

    .card-wrap .card {
      width: 200px;
      height: 200px;
      padding: 20px;
      box-sizing: border-box;
      box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);
      margin-top: 500px;
      margin-left: 500px;
    }
    .head{
      width: 100%;
      height: 100px;
      background: pink;
      /* position: fixed; */
      top:0;
      left: 0;
    }
  &lt;/style&gt;
&lt;/head&gt;

&lt;body&gt;
  &lt;!-- &lt;div class="head"&gt;&lt;/div&gt; --&gt;
  &lt;div class="circle-wrap"&gt;
    &lt;span&gt;当下方的卡片在可视区域内，我的圈圈是绿色，否则是红色&lt;/span&gt;
    &lt;span class="circle"&gt;&lt;/span&gt;
  &lt;/div&gt;
  &lt;div class="card-wrap"&gt;
    &lt;div class="card"&gt;我是一个卡片&lt;/div&gt;
  &lt;/div&gt;
  &lt;script src="https://cdn.bootcdn.net/ajax/libs/lodash.js/4.17.20/lodash.js"&gt;&lt;/script&gt;
  &lt;script&gt;
    const card = document.querySelector(".card");
    const circle = document.querySelector(".circle");
    const observer = new IntersectionObserver((changes) =&gt; {
      // changes是数组
      changes.forEach(one =&gt; {
        console.log(one)
        let isIntersecting = one.isIntersecting
        let background = null
        if (isIntersecting) {
          background = "green"
        } else {
          background = "red"
        }
        circle.style.background = background
      })
    })
    observer.observe(card)
    // console.log(observer)
    /* 取消观察特定的元素：observer.unobserve(dom) */
    /* 对象停止监听目标 observer.disconnect() */
  &lt;/script&gt;
&lt;/body&gt;

&lt;/html&gt;
</code></pre> 
<h3><a id="_344"></a>补充说明</h3> 
<p><code>IntersectionObserver</code>可以传<code>root</code>,进一步判断<code>dom</code>是相对于哪个节点，来判断是否在可视区域内，默认<code>root</code>是<code>document</code>。</p> 
<pre><code>const observer = new IntersectionObserver((changes) =&gt; {
      console.log(changes)
      changes.forEach(one =&gt; {
        console.log(one)
        let isIntersecting = one.isIntersecting
        let background = null
        if (isIntersecting) {
          background = "green"
        } else {
          background = "red"
        }
        circle.style.background = background
      })
    },{root:document.querySelector(".card-wrap")})
</code></pre> 
<h2><a id="3offsetTopscrollTop_365"></a>方法3：offsetTop、scrollTop</h2> 
<p><img src="https://images2.imgbox.com/bf/6c/bmw8EVIv_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_370"></a>说明</h3> 
<ul><li><code>offsetTop</code>：元素的上外边框至包含元素的上内边框之间的像素距离，其他方向相同</li><li><code>offsetWidth</code>:元素两端算上外边框的宽度，其他方向相同</li><li><code>scrollLeft</code> 和 <code>scrollTop</code>:既可以确定当前元素的滚动状态，也可以设置元素的滚动位置</li><li><code>scrollWidth</code> 和 <code>scrollHeight</code>:确定元素内容的实际大小</li><li><code>clientWidth</code>:元素内容区宽度加上左右内边距宽度，即<code>clientWidth = content + padding</code></li><li><code>clientHeight</code>:元素内容区高度加上上下内边距高度，即<code>clientHeight = content + padding</code></li></ul> 
<h3><a id="_379"></a>使用</h3> 
<p>公式：</p> 
<pre><code>0 &lt;= el.offsetTop - document.documentElement.scrollTop &lt;= viewPortHeight
</code></pre> 
<p>写法：</p> 
<pre><code>function isInViePortOfOne(el){
    const viewPortHeight = window.innerHeight || document.documentElement.clientHeight||document.body.clientHeight
    const offsetTop = el.offsetTop;
    const scollTop = document.documentElement.scrollTop
    const top = offsetTop - scollTop;
    return top &lt;= viewPortHeight &amp;&amp; top &gt;= 0
}
</code></pre> 
<p>项目附件：<a href="https://pan.baidu.com/s/14G-bpVthImHD4eosZUNSFA?pwd=yu27" rel="nofollow">点此下载</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/08abf5807abbb60f8976e5fedd4ac4e6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Linux CentOS7 安装Docker</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/73f79e8fb05ee2531f39a899d9f4a20e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">手势识别2：基于YOLOv5的手势识别系统(含手势识别数据集&#43;训练代码)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>