<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>storcli简易使用介绍 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="storcli简易使用介绍" />
<meta property="og:description" content="MegaCli 是LSI公司官方提供的SCSI卡管理工具，由于LSI被收购变成了现在的Broadcom，所以现在想下载MegaCli，需要去Broadcom官网查找Legacy产品支持，搜索MegaRAID即可。关于MegaCli 的使用可以看我的另一篇博文，这里就不再介绍了。
现在官方有storcli，storcli已经基本代替了megacli，整合了LSI和3ware所有产品。
安装方面比较简单，megacli还要Lib_Utils的支持，而storcli只用一个rpm包就可以下载，去Broadcom官网去找就行了：Search Results
storcli支持json格式输出，信息解析更加方便
安装完后，默认位置在 /opt/Mega/storcli下面，下面介绍storcli工具的简单使用
获取帮助 storcli64 -h
基础信息 storcli64 show [all]　显示raid卡相关信息、raid卡高级软件信息，可以看到只有一个控制器
控制器配置 获取控制器信息 storcli64 /c0 show　显示控制器0的信息，我们可以看到有6个物理设备，以及enclosure id号为58，硬盘大多是附在enclosure上不是直接附在controller上，如果你之前看过MegaCli 的操作，对这个应该就还挺熟悉了
剩余空间 storcli64 /c0 show freespace
CC（consistency check） storcli64 /c0 show cc
storcli64 /c0 show ccrate
设置cc
storcli /cx set consistencycheck|cc=[off|seq|conc] [delay=value]
storcli /cx set ccrate=&lt;value&gt;
rebuild storcli64 /c0 show rebuildrate　获取rebuild速率
storcli64 /c0 set rebuildrate=30　设置rebuild速率
清除缓存 storcli64 /c0 flushcache　清除raid卡、物理磁盘cache
enclosure 获取信息 storcli64 /c0/eall show" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/98b41135dcb787e230ac3c74636465d5/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-09-07T11:50:01+08:00" />
<meta property="article:modified_time" content="2022-09-07T11:50:01+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">storcli简易使用介绍</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>MegaCli 是LSI公司官方提供的SCSI卡管理工具，由于LSI被收购变成了现在的Broadcom，所以现在想下载MegaCli，需要去Broadcom官网查找Legacy产品支持，搜索MegaRAID即可。关于MegaCli 的使用可以看我的另一篇博文，这里就不再介绍了。</p> 
<p>现在官方有storcli，storcli已经基本代替了megacli，整合了LSI和3ware所有产品。</p> 
<p>安装方面比较简单，megacli还要Lib_Utils的支持，而storcli只用一个rpm包就可以下载，去Broadcom官网去找就行了：<a href="https://www.broadcom.com/site-search?q=storcli" rel="nofollow" title="Search Results">Search Results</a></p> 
<p>storcli支持json格式输出，信息解析更加方便</p> 
<p>安装完后，默认位置在 /opt/Mega/storcli下面，下面介绍storcli工具的简单使用</p> 
<p></p> 
<p><a name="_label0"></a></p> 
<h2>获取帮助</h2> 
<p>storcli64 -h</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/58/d9/8GOL3VY5_o.png"></p> 
<p></p> 
<p><a name="_label1"></a></p> 
<h2>基础信息</h2> 
<p>storcli64 show [all]　　显示raid卡相关信息、raid卡高级软件信息，可以看到只有一个控制器</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/86/3b/mqGPSxBq_o.png"></p> 
<p></p> 
<p><a name="_label2"></a></p> 
<h2>控制器配置</h2> 
<p><a name="_label2_0"></a></p> 
<h3>获取控制器信息</h3> 
<p> storcli64 /c0 show　　显示控制器0的信息，我们可以看到有6个物理设备，以及enclosure id号为58，硬盘大多是附在enclosure上不是直接附在controller上，如果你之前看过MegaCli 的操作，对这个应该就还挺熟悉了</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/6b/9e/fmIyDcPp_o.png"></p> 
<p></p> 
<p><a name="_label2_1"></a></p> 
<h3>剩余空间</h3> 
<p>storcli64 /c0 show freespace</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/1b/d5/E9RPL7y2_o.png"></p> 
<p></p> 
<p><a name="_label2_2"></a></p> 
<h3>CC（consistency check）</h3> 
<p>storcli64 /c0 show cc</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/f8/df/tTAZ4IjP_o.png"></p> 
<p></p> 
<p>storcli64 /c0 show ccrate</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/8f/94/1FW5x3G6_o.png"></p> 
<p></p> 
<p>设置cc</p> 
<p>storcli /cx set consistencycheck|cc=[off|seq|conc] [delay=value]</p> 
<p>storcli /cx set ccrate=&lt;value&gt;</p> 
<p></p> 
<p><a name="_label2_3"></a></p> 
<h3>rebuild</h3> 
<p> storcli64 /c0 show rebuildrate　　获取rebuild速率</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/20/ba/xjjTyKpA_o.png"></p> 
<p></p> 
<p>storcli64 /c0 set rebuildrate=30　　设置rebuild速率</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/76/ab/tloN76MO_o.png"></p> 
<p></p> 
<p><a name="_label2_4"></a></p> 
<h3>清除缓存</h3> 
<p>storcli64 /c0 flushcache　　清除raid卡、物理磁盘cache</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/7e/7d/gro9H7Gc_o.png"></p> 
<p></p> 
<p><a name="_label3"></a></p> 
<h2> enclosure</h2> 
<p><a name="_label3_0"></a></p> 
<h3>获取信息</h3> 
<p>storcli64 /c0/eall show</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/89/55/hM2NDj6O_o.png"></p> 
<p></p> 
<p> storcli64 /c0/e58 show　　获取单个enclosure信息</p> 
<p> </p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/fb/ed/qkBnSz0b_o.png"></p> 
<p></p> 
<p>  storcli64 /c0/e58 show all　　获取单个enclosure详细信息</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/d7/c4/MFSGVFtt_o.png"></p> 
<p></p> 
<p></p> 
<p> storcli64 /c0/e58 show status　　获取enclosure下磁盘风扇等设备的状态</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/c2/d7/A10dMbFf_o.png"></p> 
<p></p> 
<p><a name="_label4"></a></p> 
<h2> 磁盘配置</h2> 
<p><a name="_label4_0"></a></p> 
<h3>磁盘信息获取</h3> 
<p>storcli64 /cx/eall/sall show　　显示物理磁盘信息</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/0f/5d/CYwWqgrk_o.png"></p> 
<p></p> 
<p><a name="_label4_1"></a></p> 
<h3>磁盘状态设置</h3> 
<p>storcli64 /cx/ex/sx set good/offline/online/missing　　设置某块磁盘的状态</p> 
<p>good　　　　　 　　空闲</p> 
<p>online/offline　　 成员盘上下线</p> 
<p>missing　　　　    掉线？</p> 
<p></p> 
<p><a name="_label4_2"></a></p> 
<h3>磁盘热备</h3> 
<p>storcli64 /cx/ex/sx add hotsparedrive dgs=x　　设置模块磁盘为diskgroup x 的热备盘</p> 
<p>storcli64 /cx/ex/sx delete hotsparedrive</p> 
<p></p> 
<p><a name="_label4_3"></a></p> 
<h3>磁盘rebuild</h3> 
<p>storcli64 /cx/ex/sx show rebuild　　查看rebild</p> 
<p>storcli64 /cx/ex/sx start rebuild</p> 
<p>storcli64 /cx/ex/sx stop rebuild</p> 
<p></p> 
<p><a name="_label4_4"></a></p> 
<h3>磁盘点灯</h3> 
<p>storcli64 /cx/ex/sx start locate</p> 
<p>storcli64 /cx/ex/sx stop locate</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/0e/95/GibSCeQq_o.png"></p> 
<p></p> 
<p><a name="_label4_5"></a></p> 
<h3>磁盘擦除</h3> 
<p>快速擦除：</p> 
<p>storcli64 /cx/ex/sx set good</p> 
<p>storcli64 /cx/fall del|delete [securityKey = xxx]</p> 
<p></p> 
<p>完全擦除：</p> 
<p>storcli /cx[/ex]/sx secureerase [force]<br> storcli /cx[/ex]/sx start erase [simple| normal| thorough | standard| threepass | crypto]<br> storcli /cx[/ex]/sx stop erase<br> storcli /cx[/ex]/sx show erase</p> 
<p></p> 
<p><a name="_label5"></a></p> 
<h2>RAID组配置</h2> 
<p>命令格式如下：</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/a4/b0/zNUkV0kL_o.png"></p> 
<p></p> 
<p><a name="_label5_0"></a></p> 
<h3>RAID组（卷组）创建</h3> 
<p>这里创建两个卷组(创建逻辑卷自动添加卷组)，一个RAID5，一个RAID1带热备</p> 
<p>storcli64 /c0 add vd r5 size=1000 name=test drives=58:17-19 wt ra cached strip=8</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/20/e9/DIJmnTuX_o.png"></p> 
<p>storcli64 /c0 add vd r1 size=1000 name=test drives=58:7,11 spares=58:23</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/b2/d7/yADNLK09_o.png"></p> 
<p>此时磁盘信息如下：</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/aa/b0/QX36W8sx_o.png"></p> 
<p></p> 
<p><a name="_label5_1"></a></p> 
<h3>卷组信息获取</h3> 
<p>storcli64 /c0/dall show</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/e1/98/kcc71nSq_o.png"></p> 
<p></p> 
<p><a name="_label5_2"></a></p> 
<h3>创建逻辑卷</h3> 
<p>命令和创建卷组一样，会自动加入卷组</p> 
<p> </p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/af/05/JCkHSphK_o.png"></p> 
<p></p> 
<p><a name="_label5_3"></a></p> 
<h3>查询逻辑卷</h3> 
<p>storcli64 /c0/v2 show all</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/dd/a8/tt1MfoH7_o.png"></p> 
<p></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/0d/2f/t69L85Gr_o.png"></p> 
<p></p> 
<p><a name="_label5_4"></a></p> 
<h3>编辑逻辑卷</h3> 
<p>storcli64 /cx/vx set wrcache=WT|WB|AWB<br> storcli64 /cx/vx set rdcache=RA|NoRA<br> storcli64 /cx/vx set iopolicy=Cached|Direct<br> storcli64 /cx/vx set accesspolicy=RW|RO|Blocked|RmvBlkd</p> 
<p>属性的含义见Megacli的介绍</p> 
<p></p> 
<p><a name="_label5_5"></a></p> 
<h3>删除逻辑卷</h3> 
<p>storcli /cx/vx del [cachecade] [discardcache] [force]</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/75/14/Wi8UwQGm_o.png"></p> 
<p>PS：这里有个比较坑的地方就是删除卷组中间的卷，如果你再新建卷的容量大于这个空缺的话，即使卷组后面有再多的空间也创建不成功</p> 
<p></p> 
<p><a name="_label5_6"></a></p> 
<h3>删除RAID组</h3> 
<p>删除卷组的最后一个逻辑卷，卷组自动删除，卷组编号会自动调整</p> 
<p></p> 
<p><a name="_label6"></a></p> 
<h2>扩展卷组</h2> 
<p>只看到了这个迁移，不知道怎么扩容……</p> 
<p>storcli64 /cx/vx start migrate type=raidx [option=add|remove drives=[e:]s|[e:]s-x|[e:]s-x,y] [Force]</p> 
<p>storcli64 /cx/vx show migrate　　　　　　   显示扩容进度</p> 
<p>storcli64 /cx show migraterate　　　　　　  显示扩容速率</p> 
<p>storcli64 /cx set migraterate=&lt;value&gt; 　　  设置扩容速率</p> 
<p></p> 
<p></p> 
<p></p> 
<p><a name="_label7"></a></p> 
<h2>热备</h2> 
<p><a name="_label7_0"></a></p> 
<h3>全局热备</h3> 
<p>storcli64 /cx/ex/sx add hotsparedrive</p> 
<p><a name="_label7_1"></a></p> 
<h3>局部热备</h3> 
<p>storcli64 /cx/ex/sx add hotsparedrive dgs=x　　设置模块磁盘为diskgroup x 的热备盘</p> 
<p></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/8d/b2/ClivORe8_o.png"></p> 
<p></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/2a/eb/rZXFbYlX_o.png"></p> 
<p></p> 
<p>此时下线成员盘7</p> 
<p>storcli64 /c0/e58/s7 set offline</p> 
<p>可以看到18号热备盘已经顶替上进行重构了</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/11/1f/XbeOj5y7_o.png"></p> 
<p></p> 
<p>然后下线18号盘</p> 
<p>storcli64 /c0/e58/s18 set offline</p> 
<p>23号局部热备盘进行重构</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/d9/0f/Vy7xZYSR_o.png"></p> 
<p></p> 
<p>此时再下线11号盘，全局热备盘17开始重构，此时3块热备均被使用</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/6b/b1/2BqPSWsu_o.png"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4b129c9a0c196a2164ff301742184664/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">正则表达式（regex/regexp）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5452539351c3ac33b586b5e8d5c033ac/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">IDEA创建动态web工程并配置Tomcat服务器</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>