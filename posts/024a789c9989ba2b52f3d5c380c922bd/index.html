<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>vue项目播放海康,大华等rtsp视频流 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="vue项目播放海康,大华等rtsp视频流" />
<meta property="og:description" content="浏览器不能直接播放rtsp格式视频
需要将rtsp转为flv，然后再使用flv.js播放
1.rtsp转flv(需要node)
首先电脑需要下载 ffmpeg(将resp转为flv主要使用他)
官网：Download FFmpeg
下载完需要配置环境变量
配置好后 cmd 运行 ffmpeg -version 输出版本信息则成功
2.node代码
下载node依赖
npm i fluent-ffmpeg ws websocket-stream import WebSocket from &#39;ws&#39; import webSocketStream from &#39;websocket-stream/stream&#39; import ffmpeg from &#39;fluent-ffmpeg&#39; // 建立WebSocket服务 const wss = new WebSocket.Server({ port: 8888, perMessageDeflate: false }) // 监听连接 wss.on(&#39;connection&#39;, handleConnection) // 连接时触发事件 function handleConnection (ws, req) { // 获取前端请求的流地址（前端websocket连接时后面带上流地址） const url = req.url.slice(1) // 传入连接的ws客户端 实例化一个流 const stream = webSocketStream(ws, { binary: true }) // 通过ffmpeg命令 对实时流进行格式转换 输出flv格式 const ffmpegCommand = ffmpeg(url) ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/024a789c9989ba2b52f3d5c380c922bd/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-25T09:56:19+08:00" />
<meta property="article:modified_time" content="2023-05-25T09:56:19+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">vue项目播放海康,大华等rtsp视频流</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>浏览器不能直接播放rtsp格式视频</p> 
<p>需要将rtsp转为flv，然后再使用flv.js播放</p> 
<p><strong>1.rtsp转flv(需要node)</strong></p> 
<p>首先电脑需要下载 ffmpeg(将resp转为flv主要使用他)</p> 
<p>官网：<a href="http://www.ffmpeg.org/download.html" rel="nofollow" title="Download FFmpeg">Download FFmpeg</a></p> 
<p><img alt="" height="571" src="https://images2.imgbox.com/b0/12/9rts4vvz_o.png" width="1190"></p> 
<p><img alt="" height="698" src="https://images2.imgbox.com/0d/63/dk3rgVAB_o.png" width="1185"> </p> 
<p>下载完需要配置环境变量</p> 
<p> <img alt="" height="573" src="https://images2.imgbox.com/f7/84/DsMKM203_o.png" width="1189"></p> 
<p> <img alt="" height="627" src="https://images2.imgbox.com/dd/8a/tz4UOqET_o.png" width="645"></p> 
<p>配置好后 cmd 运行  ffmpeg -version 输出版本信息则成功</p> 
<p><strong>2.node代码</strong></p> 
<p>下载node依赖</p> 
<pre><code class="hljs">npm i fluent-ffmpeg ws websocket-stream</code></pre> 
<pre><code class="hljs">import WebSocket from 'ws'
import webSocketStream from 'websocket-stream/stream'
import ffmpeg from 'fluent-ffmpeg'

// 建立WebSocket服务
const wss = new WebSocket.Server({ port: 8888, perMessageDeflate: false })

// 监听连接
wss.on('connection', handleConnection)

// 连接时触发事件
function handleConnection (ws, req) {
  // 获取前端请求的流地址（前端websocket连接时后面带上流地址）
  const url = req.url.slice(1)
  // 传入连接的ws客户端 实例化一个流
  const stream = webSocketStream(ws, { binary: true })
  // 通过ffmpeg命令 对实时流进行格式转换 输出flv格式
  const ffmpegCommand = ffmpeg(url)
    .addInputOption('-analyzeduration', '100000', '-max_delay', '1000000')
    .on('start', function () { console.log('Stream started.') })
    .on('codecData', function () { console.log('Stream codecData.') })
    .on('error', function (err) {
      console.log('An error occured: ', err.message)
      stream.end()
    })
    .on('end', function () {
      console.log('Stream end!')
      stream.end()
    })
    .outputFormat('flv').videoCodec('copy').noAudio()

  stream.on('close', function () {
    ffmpegCommand.kill('SIGKILL')
  })

  try {
    // 执行命令 传输到实例流中返回给客户端
    ffmpegCommand.pipe(stream)
  } catch (error) {
    console.log(error)
  }
}

作者：有刃有鱼阮小六
链接：https://juejin.cn/post/6908641550046068744
来源：稀土掘金
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</code></pre> 
<p><strong>3.vue代码</strong></p> 
<pre><code class="hljs">npm i flv.js</code></pre> 
<pre><code class="hljs">&lt;template&gt;
  &lt;div class="wrap"&gt;
    &lt;video class="video" muted autoplay controls ref="player"&gt;&lt;/video&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
import flvjs from 'flv.js' // 引入flvjs
export default {
  data () {
    return {
      player: null
    }
  },
  mounted () {
    // 如果浏览器支持flvjs，则执行相应的程序
    if (flvjs.isSupported()) {
      // 准备监控设备流地址
      const url = 'rtsp://admin:1234567@192.168.1.100:554/Streaming/Channels/101?transportmode=unicast'
      // 创建一个flvjs实例
      // 下面的ws://localhost:8888换成你搭建的websocket服务地址，后面加上设备流地址
      this.player = flvjs.createPlayer({
        type: 'flv',
        isLive: true,
        url: 'ws://localhost:8888/' + url
      })
      
      this.player.on('error', (e) =&gt; {
        console.log(e)
      })
      
     // 将实例挂载到video元素上面
      this.player.attachMediaElement(this.$refs.player)
      
      try {
        // 开始运行加载 只要流地址正常 就可以在h5页面中播放出画面了
        this.player.load()
        this.player.play()
      } catch (error) {
        console.log(error)
      }  
    }
  },
  beforeDestroy () {
    // 页面销毁前 关闭flvjs
    this.player.destroy()
  }
}
&lt;/script&gt;

&lt;style lang="scss" scoped&gt;
  .wrap{
    .video {
      width: 300px;
      height: 300px;
    }
  }
&lt;/style&gt;

作者：有刃有鱼阮小六
链接：https://juejin.cn/post/6908641550046068744
来源：稀土掘金
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9e6771e743e27dc8136efcdd87a1f7c1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Centos8:修改密码超详细超实用方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/aac843b3e77a36060ac382665803b1ed/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Java中字符串与byte数组之间的转换方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>