<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>2022-06-23 VGMP-OSPF-域间安全策略-NAT策略 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="2022-06-23 VGMP-OSPF-域间安全策略-NAT策略" />
<meta property="og:description" content="本文章仅供学习和参考！
欢迎交流~
一、实验拓扑图： 二、实验配置： 1. 配置防火墙： （1）配置FW1
修改设备名称 sysname FW1 配置IP interface GigabitEthernet0/0/0 ip address 192.168.100.1 255.255.0.0 interface GigabitEthernet0/0/1 ip address 10.1.13.1 255.255.255.0 interface GigabitEthernet0/0/5 ip address 10.88.12.1 255.255.255.0 添加安全区域 firewall zone trust add interface GigabitEthernet0/0/0 add interface GigabitEthernet0/0/1 配置OSPF ospf 1 router-id 123.1.1.1 area 0.0.0.0 network 10.1.13.1 0.0.0.0 network 192.168.100.1 0.0.0.0 配置VRRP interface GigabitEthernet0/0/0	vrrp vrid 10 virtual-ip 192.168.10.254 16 master vrrp vrid 20 virtual-ip 192.168.20.254 16 slave vrrp vrid 30 virtual-ip 192." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/0e23a07ddedc1ca544a18a494c263c29/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-08-10T14:24:56+08:00" />
<meta property="article:modified_time" content="2022-08-10T14:24:56+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">2022-06-23 VGMP-OSPF-域间安全策略-NAT策略</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><span style="color:#fe2c24;">本文章仅供学习和参考！</span></p> 
<p><span style="color:#fe2c24;">欢迎交流~</span></p> 
<p></p> 
<h3>一、实验拓扑图：</h3> 
<p><img alt="" height="797" src="https://images2.imgbox.com/96/22/FQb63fvB_o.png" width="1200"></p> 
<p></p> 
<p></p> 
<h3>二、实验配置：</h3> 
<h4>1. 配置防火墙：</h4> 
<p>（1）配置FW1</p> 
<pre><code> 
修改设备名称
sysname FW1
 
 
配置IP
interface GigabitEthernet0/0/0
 ip address 192.168.100.1 255.255.0.0
interface GigabitEthernet0/0/1
 ip address 10.1.13.1 255.255.255.0
interface GigabitEthernet0/0/5
 ip address 10.88.12.1 255.255.255.0
 
 
添加安全区域
firewall zone trust
 add interface GigabitEthernet0/0/0
 add interface GigabitEthernet0/0/1
 
 
配置OSPF
ospf 1 router-id 123.1.1.1
 area 0.0.0.0
  network 10.1.13.1 0.0.0.0
  network 192.168.100.1 0.0.0.0
 
 
配置VRRP
interface GigabitEthernet0/0/0	
 vrrp vrid 10 virtual-ip 192.168.10.254 16 master
 vrrp vrid 20 virtual-ip 192.168.20.254 16 slave
 vrrp vrid 30 virtual-ip 192.168.30.254 16 master
 vrrp virtual-mac enable
 
 
防止来回路径不一致
进行会话快速备份功能
根据VGMP状态调整OSPF Cost值功能
指定心跳口
启用双击热备
undo firewall session link-state check
hrp mirror session enable
hrp ospf-cost adjust-enable
hrp interface GigabitEthernet0/0/5
hrp enable
 </code></pre> 
<p>（2）配置FW2</p> 
<pre><code> 
修改设备名称
sysname FW2
 
 
配置IP
interface GigabitEthernet0/0/0
 ip address 192.168.100.2 255.255.0.0
interface GigabitEthernet0/0/1
 ip address 10.1.24.2 255.255.255.0
interface GigabitEthernet0/0/5
 ip address 10.88.12.2 255.255.255.0
 
 
添加安全区域
firewall zone trust
 add interface GigabitEthernet0/0/0
 add interface GigabitEthernet0/0/1
 
 
配置OSPF
ospf 1 router-id 123.2.2.2
 area 0.0.0.0
  network 10.1.24.2 0.0.0.0
  network 192.168.100.2 0.0.0.0
 
 
配置VRRP
interface GigabitEthernet0/0/0	
 vrrp vrid 10 virtual-ip 192.168.10.254 16 slave
 vrrp vrid 20 virtual-ip 192.168.20.254 16 master
 vrrp vrid 30 virtual-ip 192.168.30.254 16 slave
 vrrp virtual-mac enable
 
 
防止来回路径不一致
进行会话快速备份功能
根据VGMP状态调整OSPF Cost值功能
指定心跳口
启用双击热备
undo firewall session link-state check
hrp mirror session enable
hrp ospf-cost adjust-enable
hrp interface GigabitEthernet0/0/5
hrp enable
 </code></pre> 
<p>（3）配置FW5</p> 
<pre><code> 
修改设备名称
sysname FW5
 
配置IP
interface GigabitEthernet0/0/0
 ip address 10.5.5.1 255.255.255.0
interface GigabitEthernet0/0/1
 ip address 10.1.35.5 255.255.255.0
interface GigabitEthernet0/0/2
 ip address 10.1.45.5 255.255.255.0
interface GigabitEthernet0/0/5
 ip address 202.103.56.5 255.255.255.0
 
 
添加信任区域
firewall zone trust
 add interface GigabitEthernet0/0/1
 add interface GigabitEthernet0/0/2
 
 
添加不信任区域
firewall zone untrust
 add interface GigabitEthernet0/0/5
 
 
添加非军事化区域
firewall zone dmz
 add interface GigabitEthernet0/0/0
 
 
配置OSPF
ospf 1 router-id 123.5.5.5
 default-route-advertise always
 area 0.0.0.0
  network 10.5.5.1 0.0.0.0
  network 10.1.35.5 0.0.0.0
  network 10.1.45.5 0.0.0.0
 
 
配置默认路由 / 公网路由可达
ip route-static 0.0.0.0 0.0.0.0 202.103.56.6
 
 
防止来回路径不一致
undo firewall session link-state check


配置区域间的安全策略：trust到dmz
policy interzone trust dmz outbound
 policy 1
  action permit


配置区域间的安全策略：untrust到dmz
policy interzone dmz untrust inbound
 policy 1
  action permit
  policy service service-set ftp
  policy service service-set http
  policy service service-set https
  policy destination 10.5.5.100 0
  policy destination 10.5.5.101 0


配置区域间的安全策略：untrust到trust
policy interzone trust untrust inbound
 policy 1
  action permit
  policy service service-set ssh
  policy service service-set telnet
  policy destination 10.1.45.4 0


配置区域间的安全策略：trust到untrust
policy interzone trust untrust outbound
 policy 1
  action permit


配置NAPT（内网到公网转换的地址池）：
nat address-group 7 202.103.56.100 202.103.56.120


配置NAT策略-NAPT方式：trust到untrust（192.168.10.0/24和192.168.30.0/24用户）
nat-policy interzone trust untrust outbound
 policy 1
  action source-nat
  policy source 192.168.10.0 0.0.0.255
  policy source 192.168.30.0 0.0.0.255
  address-group 7


配置NAT策略-easy ip方式：trust到untrust（192.168.20.0/24用户）
nat-policy interzone trust untrust outbound
 policy 2
  action source-nat
  policy source 192.168.20.0 0.0.0.255
  easy-ip GigabitEthernet0/0/5


配置nat server，内网服务器向公网提供FTP、HTTP、HTTPs服务：
nat server protocol tcp global 202.103.56.99 8003 inside 10.5.5.100 80
nat server protocol tcp global 202.103.56.99 443 inside 10.5.5.100 443
nat server protocol tcp global 202.103.56.99 21 inside 10.5.5.100 21
nat server protocol tcp global 202.103.56.99 20 inside 10.5.5.100 20


配置nat server，内网设备向公网提供telnet和SSH服务：
nat server protocol tcp global 202.103.56.88  23 inside 10.1.45.4 23
nat server protocol tcp global 202.103.56.88  22 inside 10.1.45.4 22


配置区域间的安全策略：local到untrust
policy interzone local untrust outbound
 policy 1
  action permit


配置感兴趣流
acl number 3000
 rule 5 permit ip source 192.168.0.0 0.0.255.255 destination 172.16.99.0 0.0.0.2


配置Ipsec 安全提议
ipsec proposal ipsec2tiyi1
 encapsulation-mode tunnel
 esp authentication-algorithm sha1
 esp encryption-algorithm aes 192


配置IKE安全提议，认证方式=预共享密钥pre-share，认证算法使用aes-cbc 192，DH group=2，完整性算法使用hmac-sha1-96
ike proposal 10
 authentication-method pre-share
 encryption-algorithm aes-cbc 192
 dh group2
 integrity-algorithm hmac-sha1-96


配置IKE peer，IKE peer name=5，预共享密钥密码pre-shared-key=Admin@123，对端IP地址=202.103.78.8
ike peer 5
 ike-proposal 10
 pre-shared-key Admin@123
 remote-address 202.103.78.8


配置IPsec策略组，IPsec策略名=celue1，序号=5，使用Internet安全关联密钥管理协议(isakmp)，把感兴趣流量、IPsec安全提议、ike-peer进行关联
ipsec policy celue1 5 isakmp
 security acl 3000
 proposal ipsec2tiyi1
 ike-peer 5


接口下调用Ipsec 安全策略
interface GigabitEthernet0/0/5
 ipsec policy celue1


配置静态明细路由通往分支172.16.99.0/24
ip route-static 172.16.99.0 255.255.255.0 202.103.56.6


配置静态明细路由引入到OSPF中
ospf 1
 import-route static

</code></pre> 
<p>（4）配置FW8</p> 
<pre><code> 
修改设备名称
sysname FW8
 
 
配置IP
interface GigabitEthernet0/0/0
 ip address 172.16.99.1 255.255.0.0
interface GigabitEthernet0/0/2
 ip address 202.103.78.8 255.255.255.0
 
 
添加不安全区域
firewall zone untrust
 add interface GigabitEthernet0/0/2


配置默认路由 / 公网路由可达
ip route-static 0.0.0.0 0.0.0.0 202.103.78.7


配置区域间的安全策略：trust到untrust
policy interzone trust untrust outbound
 policy 1
  policy source 172.16.99.0 0.0.0.255
  action permit


配置NAT策略-easy ip方式：trust到untrust（172.16.99.0/24用户）
nat-policy interzone trust untrust outbound
 policy 1
  action source-nat
  policy source 172.16.99.0 0.0.0.255
  easy-ip GigabitEthernet0/0/2


分支防火墙FW8配置SYN Flood、UDP Flood和ICMP Flood攻击防范功能，并限制每条会话允许通过的ICMP报文最大速率为5包/秒：
firewall defend syn-flood enable
firewall defend udp-flood enable
firewall defend icmp-flood enable
firewall defend icmp-flood base-session max-rate 5


配置区域间的安全策略：local到untrust
policy interzone local untrust outbound
 policy 1
  action permit


配置感兴趣流
acl number 3000
 rule 5 permit ip source 172.16.99.0 0.0.0.255 destination 192.168.0.0 0.0.255.255


配置Ipsec 安全提议
ipsec proposal ipsec2tiyi1
 encapsulation-mode tunnel
 esp authentication-algorithm sha1
 esp encryption-algorithm aes 192


配置IKE安全提议，认证方式=预共享密钥pre-share，认证算法使用aes-cbc 192，DH group=2，完整性算法使用hmac-sha1-96
ike proposal 10
 authentication-method pre-share
 encryption-algorithm aes-cbc 192
 dh group2
 integrity-algorithm hmac-sha1-96


配置IKE peer，IKE peer name=5，预共享密钥密码pre-shared-key=Admin@123，对端IP地址=202.103.56.5
ike peer 5
 ike-proposal 10
 pre-shared-key Admin@123
 remote-address 202.103.56.5


配置IPsec策略组，IPsec策略名=celue1，序号=5，使用Internet安全关联密钥管理协议(isakmp)，把感兴趣流量、IPsec安全提议、ike-peer进行关联
ipsec policy celue1 3 isakmp
 security acl 3000
 proposal ipsec2tiyi1
 ike-peer 5


接口下调用Ipsec 安全策略
interface GigabitEthernet0/0/2
 ipsec policy celue1


配置静态明细路由通往分支172.16.99.0/24
ip route-static 172.16.99.0 255.255.255.0 202.103.56.6


配置静态明细路由引入到OSPF中
ip route-static 192.168.0.0 255.255.0.0 202.103.78.7

</code></pre> 
<h4>2. 配置路由器：</h4> 
<p>（1）配置R3</p> 
<pre><code> 
修改设备名称
sysname R3
 
 
配置IP
interface GigabitEthernet0/0/0
 ip address 10.1.35.3 255.255.255.0 
interface GigabitEthernet0/0/1
 ip address 10.1.13.3 255.255.255.0 
interface GigabitEthernet0/0/2
 ip address 10.1.34.3 255.255.255.0 
 
 
配置OSPF
ospf 1 router-id 123.3.3.3 
 area 0.0.0.0 
  network 10.1.13.3 0.0.0.0 
  network 10.1.34.3 0.0.0.0 
  network 10.1.35.3 0.0.0.0 
 
</code></pre> 
<p>（2）配置R4</p> 
<pre><code> 
修改设备名称
sysname R4
 
 
配置IP
interface GigabitEthernet0/0/0
 ip address 10.1.45.4 255.255.255.0 
interface GigabitEthernet0/0/1
 ip address 10.1.24.4 255.255.255.0 
interface GigabitEthernet0/0/2
 ip address 10.1.34.4 255.255.255.0 
 
 
配置OSPF
ospf 1 router-id 123.4.4.4 
 area 0.0.0.0 
  network 10.1.24.4 0.0.0.0 
  network 10.1.34.4 0.0.0.0 
  network 10.1.45.4 0.0.0.0 
 

配置telnet功能: 其中密码=telnet123，用户权限级别=3
telnet server enable
user-interface vty  0 4 
 set authentication  password cipher telnet123
 user privilege level 3

</code></pre> 
<p>（3）配置ISP6</p> 
<pre><code> 
修改设备名称
sysname ISP6
 
 
配置IP
interface GigabitEthernet0/0/1
 ip address 202.103.67.6 255.255.255.0 
interface GigabitEthernet0/0/2
 ip address 202.103.56.6 255.255.255.0 
 
 
配置OSPF
ospf 200 router-id 123.6.6.6 
 default-route-advertise always
 area 0.0.0.0 
  network 202.103.67.6 0.0.0.0 
 
 
配置默认路由
ip route-static 0.0.0.0 0.0.0.0 202.103.56.5
 
</code></pre> 
<p>（4）配置ISP7</p> 
<pre><code> 
修改设备名称
sysname ISP7
 
 
配置IP
interface GigabitEthernet0/0/0
 ip address 200.1.1.1 255.255.255.0 
interface GigabitEthernet0/0/1
 ip address 202.103.67.7 255.255.255.0 
interface GigabitEthernet0/0/2
 ip address 100.1.1.1 255.255.255.0 
interface GigabitEthernet2/0/0
 ip address 202.103.78.7 255.255.255.0
 
 
配置OSPF
ospf 200 router-id 123.7.7.7 
 area 0.0.0.0 
  network 100.1.1.1 0.0.0.0 
  network 200.1.1.1 0.0.0.0 
  network 202.103.67.7 0.0.0.0 
  network 202.103.78.7 0.0.0.0 

</code></pre> 
<h4>3. 配置服务器：</h4> 
<p><img alt="" height="509" src="https://images2.imgbox.com/fb/41/vYsgZZh9_o.png" width="734"></p> 
<p><img alt="" height="509" src="https://images2.imgbox.com/35/73/I0VG8X8W_o.png" width="734"></p> 
<h4>4. 配置终端设备：</h4> 
<p><img alt="" height="533" src="https://images2.imgbox.com/ea/19/WxxEpiHW_o.png" width="781"></p> 
<p><img alt="" height="533" src="https://images2.imgbox.com/e6/45/ztHMev92_o.png" width="781"> <img alt="" height="509" src="https://images2.imgbox.com/25/73/gDhfLxwk_o.png" width="734"></p> 
<p><img alt="" height="509" src="https://images2.imgbox.com/21/78/FMkYhv20_o.png" width="734"></p> 
<p><img alt="" height="509" src="https://images2.imgbox.com/72/24/NZLVYej8_o.png" width="734"></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8f7bd7368db9e376ae2b56a952b4334c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">HW-蓝队工作流程（1）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ef531b7c5490cbcf7be571e9d63dca0f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">spinal HDL - 09 - 时序逻辑</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>