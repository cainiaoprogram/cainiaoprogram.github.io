<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【OpenCV-Python】29.OpenCV的特征检测——特征匹配 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【OpenCV-Python】29.OpenCV的特征检测——特征匹配" />
<meta property="og:description" content="29.OpenCV的特征检测——特征匹配
文章目录 前言一、暴力匹配器二、FLANN匹配器三、OpenCV-Python资源下载总结 前言 获得图像的关键点后，可通过计算得到关键点的描述符。关键点描述符可用于图像的特征匹配。通常，在计算图A是否包含图B的特征区域时，将图A称做训练图像，将图B称为查询图像。图A的关键点描述符称为训练描述符，图B的关键点描述符称为查询描述符。
一、暴力匹配器 暴力匹配器使用描述符进行特征比较。在比较时，暴力匹配器首先在查询描述符中取一个关键点的描述符，将其与训练描述符中的所有关键点描述符进行比较，每次比较后会给出一个距离值，距离最小的值对应最佳匹配结果。所有描述符比较完后，匹配器返回匹配结果列表。
OpenCV的cv2.BFMatcher_create()函数用于创建暴力匹配器，其基本格式如下：
bf = cv2.BFMatcher_create([normType[, crossCheck]]) bf为返回的暴力匹配器对象 normType为距离测量类型, 默认为cv2.NORM_L2, 通常, SIFT描述符使用cv2.NORM_L1或cv2.NORM_L2, ORB描述符使用cv2.NORM_HAMMING crossCheck默认为False, 匹配器为每个查询描述符找到k个距离最近的匹配描述符, 为True时, 只返回满足交叉验证条件的匹配结果 暴力匹配器对象的match()方法返回每个关键点的最佳匹配结果，其基本格式如下：
ms = bf.match(des1, des2) ms为返回的结果, 它是一个DMatch对象列表, 每个DMatch对象表示关键点的一个匹配结果, 其dintance属性表示距离, 距离值越小匹配度越高 des1为查询描述符 des2为训练描述符 获得匹配结果后，可调用cv2.drawMatches()函数或cv2.drawMatchesKnn()函数绘制匹配结果图像，其基本格式如下：
outImg = cv2.drawMatches(img1, keypoints1, img2, keypoints2, matches1to2[, matchColor[, singlePointColor[, matchesMask[, flags]]]]) outImg = cv2.drawMatches(img1, keypoints1, img2, keypoints2, matches1to2[, matchColor[, singlePointColor[, matchesMask[, flags]]]]) outImg为返回的绘制结果图像, 图像中查询图像与训练图像中匹配的关键点个两点之间的连线为彩色 img1为查询图像 keypoints1为img1的关键点 img2为训练图像 keypoints2为img2的关键点 matches1to2为img1与img2的匹配结果 matchColor为关键点和链接线的颜色, 默认使用随机颜色 singlePointColor为单个关键点的颜色, 默认使用随机颜色 matchesMask为掩膜, 用于决定绘制哪些匹配结果, 默认为空, 表示绘制所有匹配结果 flags为标志, 可设置为下列参数值: cv2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/0506fce3e2c6d62cc04d59390b16f1cd/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-12-30T20:38:53+08:00" />
<meta property="article:modified_time" content="2021-12-30T20:38:53+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【OpenCV-Python】29.OpenCV的特征检测——特征匹配</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><font color="#000000" size="5"><strong>29.OpenCV的特征检测——特征匹配</strong></font></p> 
<hr color="#000000" size='1"'> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_11" rel="nofollow">前言</a></li><li><a href="#_19" rel="nofollow">一、暴力匹配器</a></li><li><a href="#FLANN_158" rel="nofollow">二、FLANN匹配器</a></li><li><a href="#OpenCVPython_260" rel="nofollow">三、OpenCV-Python资源下载</a></li><li><a href="#_266" rel="nofollow">总结</a></li></ul> 
</div> 
<p></p> 
<hr color="#000000" size='1"'> 
<h2><a id="_11"></a>前言</h2> 
<p><font color="#000000">  获得图像的关键点后，可通过计算得到关键点的描述符。关键点描述符可用于图像的特征匹配。通常，在计算图A是否包含图B的特征区域时，将图A称做训练图像，将图B称为查询图像。图A的关键点描述符称为训练描述符，图B的关键点描述符称为查询描述符。</font></p> 
<hr color="#000000" size='1"'> 
<h2><a id="_19"></a>一、暴力匹配器</h2> 
<p><font color="#000000">  暴力匹配器使用描述符进行特征比较。在比较时，暴力匹配器首先在查询描述符中取一个关键点的描述符，将其与训练描述符中的所有关键点描述符进行比较，每次比较后会给出一个距离值，距离最小的值对应最佳匹配结果。所有描述符比较完后，匹配器返回匹配结果列表。<br> <font color="#000000">  OpenCV的cv2.BFMatcher_create()函数用于创建暴力匹配器，其基本格式如下：</font></font></p> 
<pre><code class="prism language-python">bf <span class="token operator">=</span> cv2<span class="token punctuation">.</span>BFMatcher_create<span class="token punctuation">(</span><span class="token punctuation">[</span>normType<span class="token punctuation">[</span><span class="token punctuation">,</span> crossCheck<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

bf为返回的暴力匹配器对象
normType为距离测量类型<span class="token punctuation">,</span> 默认为cv2<span class="token punctuation">.</span>NORM_L2<span class="token punctuation">,</span> 通常<span class="token punctuation">,</span> SIFT描述符使用cv2<span class="token punctuation">.</span>NORM_L1或cv2<span class="token punctuation">.</span>NORM_L2<span class="token punctuation">,</span> ORB描述符使用cv2<span class="token punctuation">.</span>NORM_HAMMING
crossCheck默认为<span class="token boolean">False</span><span class="token punctuation">,</span> 匹配器为每个查询描述符找到k个距离最近的匹配描述符<span class="token punctuation">,</span> 为<span class="token boolean">True</span>时<span class="token punctuation">,</span> 只返回满足交叉验证条件的匹配结果
</code></pre> 
<p><font color="#000000">  暴力匹配器对象的match()方法返回每个关键点的最佳匹配结果，其基本格式如下：</font></p> 
<pre><code class="prism language-python">ms <span class="token operator">=</span> bf<span class="token punctuation">.</span>match<span class="token punctuation">(</span>des1<span class="token punctuation">,</span> des2<span class="token punctuation">)</span>

ms为返回的结果<span class="token punctuation">,</span> 它是一个DMatch对象列表<span class="token punctuation">,</span> 每个DMatch对象表示关键点的一个匹配结果<span class="token punctuation">,</span> 其dintance属性表示距离<span class="token punctuation">,</span> 距离值越小匹配度越高
des1为查询描述符
des2为训练描述符
</code></pre> 
<p><font color="#000000">  获得匹配结果后，可调用cv2.drawMatches()函数或cv2.drawMatchesKnn()函数绘制匹配结果图像，其基本格式如下：</font></p> 
<pre><code class="prism language-python">outImg <span class="token operator">=</span> cv2<span class="token punctuation">.</span>drawMatches<span class="token punctuation">(</span>img1<span class="token punctuation">,</span> keypoints1<span class="token punctuation">,</span> img2<span class="token punctuation">,</span> keypoints2<span class="token punctuation">,</span> matches1to2<span class="token punctuation">[</span><span class="token punctuation">,</span> matchColor<span class="token punctuation">[</span><span class="token punctuation">,</span> singlePointColor<span class="token punctuation">[</span><span class="token punctuation">,</span> matchesMask<span class="token punctuation">[</span><span class="token punctuation">,</span> flags<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

outImg <span class="token operator">=</span> cv2<span class="token punctuation">.</span>drawMatches<span class="token punctuation">(</span>img1<span class="token punctuation">,</span> keypoints1<span class="token punctuation">,</span> img2<span class="token punctuation">,</span> keypoints2<span class="token punctuation">,</span> matches1to2<span class="token punctuation">[</span><span class="token punctuation">,</span> matchColor<span class="token punctuation">[</span><span class="token punctuation">,</span> singlePointColor<span class="token punctuation">[</span><span class="token punctuation">,</span> matchesMask<span class="token punctuation">[</span><span class="token punctuation">,</span> flags<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

outImg为返回的绘制结果图像<span class="token punctuation">,</span> 图像中查询图像与训练图像中匹配的关键点个两点之间的连线为彩色
img1为查询图像
keypoints1为img1的关键点
img2为训练图像
keypoints2为img2的关键点
matches1to2为img1与img2的匹配结果
matchColor为关键点和链接线的颜色<span class="token punctuation">,</span> 默认使用随机颜色
singlePointColor为单个关键点的颜色<span class="token punctuation">,</span> 默认使用随机颜色
matchesMask为掩膜<span class="token punctuation">,</span> 用于决定绘制哪些匹配结果<span class="token punctuation">,</span> 默认为空<span class="token punctuation">,</span> 表示绘制所有匹配结果
flags为标志<span class="token punctuation">,</span> 可设置为下列参数值<span class="token punctuation">:</span>
cv2<span class="token punctuation">.</span>DrawMatchesFlags_DEFAUL<span class="token punctuation">:</span>默认方式<span class="token punctuation">,</span> 绘制两个源图像、匹配项和单个关键点<span class="token punctuation">,</span> 没有围绕关键点的圆以及关键点的大小和方向
cv2<span class="token punctuation">.</span>DrawMatchesFlags_NOT_DRAW_SINGLE_POINTS<span class="token punctuation">:</span>不会绘制单个关键点
cv2<span class="token punctuation">.</span>DrawMatchesFlags_DRAW_RICH_KEYPOINTS<span class="token punctuation">:</span>在关键点周围绘制具有关键点大小和方向的圆圈
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># 暴力匹配器、ORB描述符和match()方法</span>
<span class="token keyword">import</span> cv2

img1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">"xhu1.jpg"</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>IMREAD_GRAYSCALE<span class="token punctuation">)</span>
img2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">"xhu2.jpg"</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>IMREAD_GRAYSCALE<span class="token punctuation">)</span>

orb <span class="token operator">=</span> cv2<span class="token punctuation">.</span>ORB_create<span class="token punctuation">(</span><span class="token punctuation">)</span>
kp1<span class="token punctuation">,</span> des1 <span class="token operator">=</span> orb<span class="token punctuation">.</span>detectAndCompute<span class="token punctuation">(</span>img1<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
kp2<span class="token punctuation">,</span> des2 <span class="token operator">=</span> orb<span class="token punctuation">.</span>detectAndCompute<span class="token punctuation">(</span>img2<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>

bf <span class="token operator">=</span> cv2<span class="token punctuation">.</span>BFMatcher_create<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>NORM_HAMMING<span class="token punctuation">,</span> crossCheck <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
ms <span class="token operator">=</span> bf<span class="token punctuation">.</span>match<span class="token punctuation">(</span>des1<span class="token punctuation">,</span> des2<span class="token punctuation">)</span>
ms <span class="token operator">=</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>ms<span class="token punctuation">,</span> key <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span>x<span class="token punctuation">.</span>distance<span class="token punctuation">)</span>
img3 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>drawMatches<span class="token punctuation">(</span>img1<span class="token punctuation">,</span> kp1<span class="token punctuation">,</span> img2<span class="token punctuation">,</span> kp2<span class="token punctuation">,</span> ms<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> flags<span class="token operator">=</span>cv2<span class="token punctuation">.</span>DrawMatchesFlags_NOT_DRAW_SINGLE_POINTS<span class="token punctuation">)</span>

cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">"Xhu1"</span><span class="token punctuation">,</span> img1<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">"Xhu2"</span><span class="token punctuation">,</span> img2<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">"Matches"</span><span class="token punctuation">,</span> img3<span class="token punctuation">)</span>

cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/ec/a0/ECKXbG7O_o.png" alt="请添加图片描述"></p> 
<pre><code class="prism language-python"><span class="token comment"># 暴力匹配器、SIFT描述符和match()方法</span>
<span class="token keyword">import</span> cv2

img1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">"xhu1.jpg"</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>IMREAD_GRAYSCALE<span class="token punctuation">)</span>
img2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">"xhu2.jpg"</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>IMREAD_GRAYSCALE<span class="token punctuation">)</span>

sift<span class="token operator">=</span>cv2<span class="token punctuation">.</span>SIFT_create<span class="token punctuation">(</span><span class="token punctuation">)</span>
kp1<span class="token punctuation">,</span> des1 <span class="token operator">=</span> sift<span class="token punctuation">.</span>detectAndCompute<span class="token punctuation">(</span>img1<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
kp2<span class="token punctuation">,</span> des2 <span class="token operator">=</span> sift<span class="token punctuation">.</span>detectAndCompute<span class="token punctuation">(</span>img2<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>

bf <span class="token operator">=</span> cv2<span class="token punctuation">.</span>BFMatcher_create<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>NORM_L1<span class="token punctuation">,</span> crossCheck <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
ms <span class="token operator">=</span> bf<span class="token punctuation">.</span>match<span class="token punctuation">(</span>des1<span class="token punctuation">,</span> des2<span class="token punctuation">)</span>
ms <span class="token operator">=</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>ms<span class="token punctuation">,</span> key <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span>x<span class="token punctuation">.</span>distance<span class="token punctuation">)</span>
img3 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>drawMatches<span class="token punctuation">(</span>img1<span class="token punctuation">,</span> kp1<span class="token punctuation">,</span> img2<span class="token punctuation">,</span> kp2<span class="token punctuation">,</span> ms<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> flags<span class="token operator">=</span>cv2<span class="token punctuation">.</span>DrawMatchesFlags_NOT_DRAW_SINGLE_POINTS<span class="token punctuation">)</span>

<span class="token comment"># ms = np.expand_dims(ms,1)</span>
<span class="token comment"># img3 = cv2.drawMatchesKnn(img1, kp1, img2, kp2, ms[:20], None, flags=cv2.DrawMatchesFlags_NOT_DRAW_SINGLE_POINTS)</span>

cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">"Xhu1"</span><span class="token punctuation">,</span> img1<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">"Xhu2"</span><span class="token punctuation">,</span> img2<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">"Matches"</span><span class="token punctuation">,</span> img3<span class="token punctuation">)</span>

cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/77/b0/52fmF4Gj_o.png" alt="请添加图片描述"><br> <font color="#000000">  暴力匹配器对象的knnMatch()方法可返回指定数量的最佳匹配结果，其基本格式如下：</font></p> 
<pre><code class="prism language-python">ms <span class="token operator">=</span> knnMatch<span class="token punctuation">(</span>des1<span class="token punctuation">,</span> des2<span class="token punctuation">,</span> k<span class="token operator">=</span>n<span class="token punctuation">)</span>

ms为返回的匹配结果<span class="token punctuation">,</span> 每个列表元素是一个子列表<span class="token punctuation">,</span> 它包含了由参数k指定个数的DMatch对象
des1为查询描述符
des2为训练描述符
k为返回的最佳匹配个数
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># 暴力匹配器、ORB描述符和knnMatch()方法</span>
<span class="token keyword">import</span> cv2

img1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">"xhu1.jpg"</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>IMREAD_GRAYSCALE<span class="token punctuation">)</span>
img2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">"xhu2.jpg"</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>IMREAD_GRAYSCALE<span class="token punctuation">)</span>

orb <span class="token operator">=</span> cv2<span class="token punctuation">.</span>ORB_create<span class="token punctuation">(</span><span class="token punctuation">)</span>
kp1<span class="token punctuation">,</span> des1 <span class="token operator">=</span> orb<span class="token punctuation">.</span>detectAndCompute<span class="token punctuation">(</span>img1<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
kp2<span class="token punctuation">,</span> des2 <span class="token operator">=</span> orb<span class="token punctuation">.</span>detectAndCompute<span class="token punctuation">(</span>img2<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>

bf <span class="token operator">=</span> cv2<span class="token punctuation">.</span>BFMatcher_create<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>NORM_HAMMING<span class="token punctuation">,</span> crossCheck <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
ms <span class="token operator">=</span> bf<span class="token punctuation">.</span>knnMatch<span class="token punctuation">(</span>des1<span class="token punctuation">,</span> des2<span class="token punctuation">,</span> k<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>

<span class="token comment"># 应用比例测试选择要使用的匹配结果</span>
good <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> m<span class="token punctuation">,</span> n <span class="token keyword">in</span> ms<span class="token punctuation">:</span>
    <span class="token keyword">if</span> m<span class="token punctuation">.</span>distance <span class="token operator">&lt;</span> <span class="token number">0.75</span> <span class="token operator">*</span> n<span class="token punctuation">.</span>distance<span class="token punctuation">:</span>
		good<span class="token punctuation">.</span>append<span class="token punctuation">(</span>m<span class="token punctuation">)</span>

img3 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>drawMatches<span class="token punctuation">(</span>img1<span class="token punctuation">,</span> kp1<span class="token punctuation">,</span> img2<span class="token punctuation">,</span> kp2<span class="token punctuation">,</span> good<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> flags<span class="token operator">=</span>cv2<span class="token punctuation">.</span>DrawMatchesFlags_NOT_DRAW_SINGLE_POINTS<span class="token punctuation">)</span>
<span class="token comment"># good = np.expand_dims(good,1)</span>
<span class="token comment">#img3 = cv2.drawMatchesKnn(img1, kp1, img2, kp2, good[:20], None, flags=cv2.DrawMatchesFlags_NOT_DRAW_SINGLE_POINTS)</span>

cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">"Xhu1"</span><span class="token punctuation">,</span> img1<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">"Xhu2"</span><span class="token punctuation">,</span> img2<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">"Matches"</span><span class="token punctuation">,</span> img3<span class="token punctuation">)</span>


cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<hr color="#000000" size='1"'> 
<h2><a id="FLANN_158"></a>二、FLANN匹配器</h2> 
<p><font color="#000000">  FLANN(Fast Library for Approximate Nearest Neignbors)为近似最近邻的快速库，FLANN特征匹配算法比其它的最近邻算法更快。<br> <font color="#000000">  在创建FLANN匹配器时，需要传递两参数：index_params和search_params。<br> <font color="#000000">  index_params用来指定索引树的算法类型和数量。SIFT算法可以使用下面的代码来设置。</font></font></font></p> 
<pre><code class="prism language-python">FLANN_INDEX_KDTREE <span class="token operator">=</span> <span class="token number">1</span>
index_params <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>algorithm <span class="token operator">=</span> FLANN_INDEX_KDTREE<span class="token punctuation">,</span>
                    trees<span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">)</span>
</code></pre> 
<p><font color="#000000">  ORB算法可以使用下面的代码来设置。</font></p> 
<pre><code class="prism language-python">FLANN_INDEX_LSH <span class="token operator">=</span> <span class="token number">6</span>
index_params <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>algorithm <span class="token operator">=</span> FLANN_INDEX_LSH<span class="token punctuation">,</span>
                    table_number <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">,</span>
                    key_size <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">,</span>
                    multi_probe_level <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>
</code></pre> 
<p><font color="#000000">  search_params用于指定索引树的遍历次数，遍历次数越多，匹配结果越精细，通常设置为50即可，如下所示：</font></p> 
<pre><code class="prism language-python">search_params <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>check <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># FLANN匹配器、ORB描述符</span>
<span class="token keyword">import</span> cv2

img1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">"xhu1.jpg"</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>IMREAD_GRAYSCALE<span class="token punctuation">)</span>
img2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">"xhu2.jpg"</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>IMREAD_GRAYSCALE<span class="token punctuation">)</span>

orb <span class="token operator">=</span> cv2<span class="token punctuation">.</span>ORB_create<span class="token punctuation">(</span><span class="token punctuation">)</span>
kp1<span class="token punctuation">,</span> des1 <span class="token operator">=</span> orb<span class="token punctuation">.</span>detectAndCompute<span class="token punctuation">(</span>img1<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
kp2<span class="token punctuation">,</span> des2 <span class="token operator">=</span> orb<span class="token punctuation">.</span>detectAndCompute<span class="token punctuation">(</span>img2<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>

<span class="token comment"># 定义FLANN参数</span>
FLANN_INDEX_LSH <span class="token operator">=</span> <span class="token number">6</span>
index_params <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>algorithm <span class="token operator">=</span> FLANN_INDEX_LSH<span class="token punctuation">,</span>
                    table_number <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">,</span>
                    key_size <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">,</span>
                    multi_probe_level <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>
search_params <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>check <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">)</span>

flann <span class="token operator">=</span> cv2<span class="token punctuation">.</span>FlannBasedMatcher<span class="token punctuation">(</span>index_params<span class="token punctuation">,</span> search_params<span class="token punctuation">)</span>
matches <span class="token operator">=</span> flann<span class="token punctuation">.</span>match<span class="token punctuation">(</span>des1<span class="token punctuation">,</span> des2<span class="token punctuation">)</span>
draw_params <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>matchColor <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                   singlePointColor <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                   matchesMask <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
                   flags <span class="token operator">=</span> cv2<span class="token punctuation">.</span>DrawMatchesFlags_DEFAULT<span class="token punctuation">)</span>

img3 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>drawMatches<span class="token punctuation">(</span>img1<span class="token punctuation">,</span> kp1<span class="token punctuation">,</span> img2<span class="token punctuation">,</span> kp2<span class="token punctuation">,</span> matches<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token operator">**</span>draw_params<span class="token punctuation">)</span>

cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">"Xhu1"</span><span class="token punctuation">,</span> img1<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">"Xhu2"</span><span class="token punctuation">,</span> img2<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">"Matches"</span><span class="token punctuation">,</span> img3<span class="token punctuation">)</span>


cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/8e/ab/C3ZrkpHs_o.png" alt="请添加图片描述"></p> 
<pre><code class="prism language-python"><span class="token comment"># FLANN匹配器、SIFT描述符</span>
<span class="token keyword">import</span> cv2

img1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">"xhu1.jpg"</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>IMREAD_GRAYSCALE<span class="token punctuation">)</span>
img2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">"xhu2.jpg"</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>IMREAD_GRAYSCALE<span class="token punctuation">)</span>

sift <span class="token operator">=</span> cv2<span class="token punctuation">.</span>SIFT_create<span class="token punctuation">(</span><span class="token punctuation">)</span>
kp1<span class="token punctuation">,</span> des1 <span class="token operator">=</span> sift<span class="token punctuation">.</span>detectAndCompute<span class="token punctuation">(</span>img1<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
kp2<span class="token punctuation">,</span> des2 <span class="token operator">=</span> sift<span class="token punctuation">.</span>detectAndCompute<span class="token punctuation">(</span>img2<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>

<span class="token comment"># 定义FLANN参数</span>
FLANN_INDEX_KDTREE <span class="token operator">=</span> <span class="token number">1</span>
index_params <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>algorithm <span class="token operator">=</span> FLANN_INDEX_KDTREE<span class="token punctuation">,</span>
                    trees <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">)</span>
search_params <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>check <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">)</span>

flann <span class="token operator">=</span> cv2<span class="token punctuation">.</span>FlannBasedMatcher<span class="token punctuation">(</span>index_params<span class="token punctuation">,</span> search_params<span class="token punctuation">)</span>
matches <span class="token operator">=</span> flann<span class="token punctuation">.</span>match<span class="token punctuation">(</span>des1<span class="token punctuation">,</span> des2<span class="token punctuation">)</span>
draw_params <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>matchColor <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                   singlePointColor <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                   matchesMask <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
                   flags <span class="token operator">=</span> cv2<span class="token punctuation">.</span>DrawMatchesFlags_DEFAULT<span class="token punctuation">)</span>

img3 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>drawMatches<span class="token punctuation">(</span>img1<span class="token punctuation">,</span> kp1<span class="token punctuation">,</span> img2<span class="token punctuation">,</span> kp2<span class="token punctuation">,</span> matches<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token operator">**</span>draw_params<span class="token punctuation">)</span>

cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">"Xhu1"</span><span class="token punctuation">,</span> img1<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">"Xhu2"</span><span class="token punctuation">,</span> img2<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">"Matches"</span><span class="token punctuation">,</span> img3<span class="token punctuation">)</span>


cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/48/8b/vv0OkIpa_o.png" alt="在这里插入图片描述"></p> 
<hr color="#000000" size='1"'> 
<h2><a id="OpenCVPython_260"></a>三、OpenCV-Python资源下载</h2> 
<p><a href="https://download.csdn.net/download/weixin_43843069/57802303">OpenCV-Python测试用图片、中文官方文档、opencv-4.5.4源码</a></p> 
<hr color="#000000" size='1"'> 
<h2><a id="_266"></a>总结</h2> 
<p><font color="#000000">  以上内容介绍了OpenCV-Python特征检测中的特征匹配，有关Python、数据科学、人工智能等文章后续会不定期发布，请大家多多关注，一键三连哟(●’◡’●)。</font></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cef8070394bfb3b912fec1d4a3c139c9/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">机器学习入门（2）之模型评估与选择</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/edb0f3bb71f95d755f095fa89d8bc14a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">cv2.polylines</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>