<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>alsa config - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="alsa config" />
<meta property="og:description" content="#title:box:HDMI Audio
#author:wangsijie
#:0,1
------------------------------------------------------------------------------
硬件环境
Nvidia(290)
------------------------------------------------------------------------------
软件环境
alsa-1.0.24.1-3.1
------------------------------------------------------------------------------
配置文件
/etc/asound.conf(简易配置) :
{{{
pcm.!default{
type hw
card 1
devive 7
} ctl.!default{
type hw
card 1
device 7
} }}}
其中card代表声卡号, device代表设备号, asound.conf的配置极其强大和复杂,详情可查阅http://www.alsa-project.org/main/index.php/Main_Page
---------------------------------------------------------------------------
card, device的确定方法
card, device必须对应hdmi的声卡号和设备号,可以使用aplay -l查看对应的hdmi设备,可能会有出现多个hdmi设备,确定当前可以使用的hdmi设备的方法如下:
#. cat /proc/asound/cards 查看nvidia设备对应的ID号(假设=1)
#. alsamixer -c 1 打开声音设置,其中&lt;S/PDIF&gt;即为HDMI输出,“MM”代表静音,alsa在每次重启声音设备时都会默认为静音,所以必须首先打开音量再进行后续的操作。
#. alsactl store 保存上述配置
#. aplay -D hw:1,7 /usr/share/sounds/alsa/test.wav &#34;hw后的1代表声卡号,7代表设备号,需要根据aplay -l的输出来确定这两个数字&#34;找到对应的hdmi输出口。
--------------------------------------------------------------------------------------------------------------------------------------------------------------
参考网站：
ALSA的配置文件对于ALSA非常重要。常见的有三个：alsa.conf, asoundrc, asound.conf。
1. 核心配置文件 ALSA核心配置文件位于/usr/share/alsa/目录下， 主要配置文件为/usr/share/alsa/alsa." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/2b80168de2694cc441b406b7fa5006de/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2012-12-13T16:12:26+08:00" />
<meta property="article:modified_time" content="2012-12-13T16:12:26+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">alsa config</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>#title:box:HDMI Audio</p> 
<p>#author:wangsijie</p> 
<p>#:0,1</p> 
<p>------------------------------------------------------------------------------</p> 
<p>硬件环境</p> 
<p><wbr></wbr><wbr></wbr><wbr></wbr>Nvidia(290)<br> ------------------------------------------------------------------------------</p> 
<p>软件环境</p> 
<p><wbr></wbr><wbr></wbr><wbr></wbr>alsa-1.0.24.1-3.1<br> ------------------------------------------------------------------------------</p> 
<p>配置文件</p> 
<p><wbr></wbr><wbr></wbr><wbr></wbr>/etc/asound.conf(简易配置) :</p> 
<p><wbr></wbr><wbr></wbr><wbr></wbr>{<!-- -->{<!-- -->{<!-- --></p> 
<p><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr>pcm.!default{<!-- --></p> 
<p><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr>type hw</p> 
<p><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr>card 1</p> 
<p><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr>devive 7</p> 
<p><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr>} <wbr></wbr><wbr></wbr></p> 
<p><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr>ctl.!default{<!-- --></p> 
<p><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr>type hw</p> 
<p><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr>card 1</p> 
<p><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr>device 7</p> 
<p><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr>} <wbr></wbr><wbr></wbr></p> 
<p><wbr></wbr><wbr></wbr><wbr></wbr>}}}</p> 
<p>其中card代表声卡号, device代表设备号, asound.conf的配置极其强大和复杂,详情可查阅<a href="http://www.alsa-project.org/main/index.php/Main_Page" rel="nofollow">http://www.alsa-project.org/main/index.php/Main_Page</a></p> 
<p><wbr></wbr>---------------------------------------------------------------------------</p> 
<p>card, device的确定方法<br> <wbr></wbr><wbr></wbr><wbr></wbr>card, device必须对应hdmi的声卡号和设备号,可以使用aplay -l查看对应的hdmi设备,可能会有出现多个hdmi设备,确定当前可以使用的hdmi设备的方法如下:</p> 
<p><wbr></wbr><wbr></wbr><wbr></wbr>#. cat /proc/asound/cards 查看nvidia设备对应的ID号(假设=1)</p> 
<p><wbr></wbr><wbr></wbr><wbr></wbr>#. alsamixer -c 1 打开声音设置,其中&lt;S/PDIF&gt;即为HDMI输出,“MM”代表静音,alsa在每次重启声音设备时都会默认为静音,所以必须首先打开音量再进行后续的操作。</p> 
<p><wbr></wbr><wbr></wbr><wbr></wbr>#. alsactl store 保存上述配置</p> 
<p><wbr></wbr><wbr></wbr><wbr></wbr>#. aplay -D hw:1,7 <wbr></wbr>/usr/share/sounds/alsa/test.wav <wbr></wbr>"hw后的1代表声卡号,7代表设备号,需要根据aplay -l的输出来确定这两个数字"找到对应的hdmi输出口。</p> 
<p><wbr></wbr></p> 
<p>--------------------------------------------------------------------------------------------------------------------------------------------------------------</p> 
<p><wbr></wbr></p> 
<p>参考网站：</p> 
<div> 
 <br> 
</div> 
<p>ALSA的配置文件对于ALSA非常重要。常见的有三个：alsa.conf, asoundrc, asound.conf。</p> 
<div> 
 <br> 
</div> 
<div> 
 <strong>1. 核心配置文件</strong> 
</div> 
<div>
  ALSA核心配置文件位于/usr/share/alsa/目录下， 
 <span style="font-family:Arial">主要配置文件为/usr/share/alsa/alsa.conf 。其它文件是否需要，位置在哪，都是由alsa.conf来决定的。</span> 
 通常会有/usr/share/alsa/card 和/usr/share/alsa/pcm两个子目录，用于设置Card相关的参数，别名以及一些PCM默认设置。 
</div> 
<div> 
 此外，在alsa.conf中，通常还会引用 /etc/asound.conf 和 ~/.asoundrc这两个配置文件，这两个文件通常是放置个人需要特殊设置的相关参数。按照Alsa官方文档的说法，1.0.9版本以后，这两个文件就不再是必要的，甚至是不应该需要的。至少是不推荐使用。不过，在嵌入式系统中使用，为了简单和方便测试，恰恰是需要修改这两个文件。 
</div> 
<div> 
 <br> 
</div> 
<div> 
 <strong>2. alsa.conf</strong> 
</div> 
<div>
  alsa.conf中主要的一些内容包括： 
</div> 
<div>
  1) 
 <strong>用hook读取了/etc/asound.conf 和 ~/.asoundrc这两个配置文件</strong>： 
</div> 
<div>
  @hooks [ 
</div> 
<div> 
 {<!-- --> 
</div> 
<div> 
 func load 
</div> 
<div> 
 files [ 
</div> 
<div> 
 "/etc/asound.conf" 
</div> 
<div> 
 "~/.asoundrc" 
</div> 
<div> 
 ] 
</div> 
<div> 
 errors false 
</div> 
<div> 
 } 
</div> 
<div>
  ] 
</div> 
<div>
  2) 
 <strong>设置了default pcm的一些默认参数，如，默认使用Card 0 ，Device 0作为音频设备等等</strong> 
</div> 
<div>
  defaults.ctl.card 0 
</div> 
<div>
  defaults.pcm.card 0 
</div> 
<div>
  defaults.pcm.device 0 
</div> 
<div>
  defaults.pcm.subdevice -1 
</div> 
<div>
  defaults.pcm.nonblock 1 
</div> 
<div>
  defaults.pcm.ipc_key 5678293 
</div> 
<div>
  。。。 
</div> 
<div>
  3) 
 <strong>设置了Alsa 内置的一些plugin的接口参数，例如file：</strong> 
</div> 
<div>
  pcm.file { 
</div> 
<div> 
 @args [ FILE FORMAT ] 
</div> 
<div> 
 @args.FILE {<!-- --> 
</div> 
<div> 
 type string 
</div> 
<div> 
 } 
</div> 
<div> 
 @args.FORMAT {<!-- --> 
</div> 
<div> 
 type string 
</div> 
<div> 
 default raw 
</div> 
<div> 
 } 
</div> 
<div> 
 type file 
</div> 
<div> 
 slave.pcm null 
</div> 
<div> 
 file $FILE 
</div> 
<div> 
 format $FORMAT 
</div> 
<div>
  } 
</div> 
<div>
  File plugin的作用是将PCM数据流存储到文件中。 
</div> 
<div> 
 <br> 
</div> 
<div> 
 <strong>3. asoundrc和asound.conf</strong> 
</div> 
<div>
  按照ALSA官方说法，asoundrc是针对个人用户的配置文件，asound.conf是全局的配置文件。其中，asoundrc位于主目录下，是个隐藏文件：“.asoundrc”。asound.conf位于/etc目录下。对于最新版本的ALSA库来说，这两个文件已不再需要。但是对于一些特定应用来说，他们的使用恰到好处。典型的asoundrc文件如下： 
 <div></div> 
 <wbr></wbr># Overwrite existing devices 
</div> 
<div>
  pcm.!default 
</div> 
<div>
  { 
</div> 
<div>
  type plug 
</div> 
<div>
  slave.pcm "softvol" 
</div> 
<div>
  channels 2 
</div> 
<div>
  } 
</div> 
<div> 
 <br> 
</div> 
<div>
  # Add new sofvol PCM device 
</div> 
<div>
  pcm.softvol 
</div> 
<div>
  { 
</div> 
<div>
  type softvol 
</div> 
<div>
  slave 
</div> 
<div>
  { 
</div> 
<div>
  pcm "hw:0,0" 
</div> 
<div>
  } 
</div> 
<div> 
 <br> 
</div> 
<div>
  control 
</div> 
<div>
  { 
</div> 
<div>
  name "Softmaster" 
</div> 
<div>
  card 0 
</div> 
<div>
  } 
</div> 
<div>
  } 
</div> 
<div> 
 <br> 
</div> 
<div> 
 <strong>4. ALSA配置状态保存，恢复和自动加载</strong> 
</div> 
<div>
  实际使用过程中，常常需要动态修改声卡的配置信息，如更新asoundrc中的Mixer信息。如果不对当前声卡的配置状态进行保存，下次启动系统时，将还原到原始状态。为此，我们有必要对声卡的配置状态进行保存。声卡配置状态保存工具为：alsactl，具体保存命令为： 
</div> 
<div> 
 <wbr></wbr> 
</div> 
<div> 
 <strong><span style="color:#ff00">alsactl store -f /var/lib/alsa/asound.state</span></strong> 
  <wbr></wbr> 
</div> 
<div>
  这样就在/var/lib/alsa/目录下生成了asound.state文件，该文件保存了声卡的状态配置信息，包括常用的mixer配置信息。相应的声卡状态恢复命令为： 
</div> 
alsactl restore -f /var/lib/alsa/asound.state 
<div> 
 注：在每次修改完声卡配置文件之后，必须要保证配置文件被系统加载，否则在保存声卡配置状态信息时，alsactl读取的是上次声卡的状态。常用的加载配置文件的方法是播放一个音频文件，例如： 
</div> 
<div style="text-align:center"> 
 speaker-test -twav 
</div> 
<div>
  这样就可以将刚刚修改的配置文件加载到系统中，然后执行相应的保存命令，即可将相应的声卡状态信息保存到文件中。 
</div> 
<div> 
 <br> 
</div> 
<div>
  得到了声卡的配置状态信息仍不能保证系统启动时自动加载并应用状态信息。需要修改启动配置文件，加入ALSA Daemon。启动配置文件为：/etc/rc.conf，在包含DAEMONS的一行内加入alsa项目。这样，系统启动时会自动执行/etc/rc.d/alsa脚本，该脚本会自动执行前面所说的声卡状态恢复命令，恢复Mixer配置信息。 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fdb4373f953101dde1deb2d39223b870/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">设计模式之工厂模式、抽象工厂模式、单例模式(C&#43;&#43;代码)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5241b929194b260161d4775386938489/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">MDE工程入门</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>