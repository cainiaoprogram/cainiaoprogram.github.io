<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>VC&#43;&#43;&#43;  操作word - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="VC&#43;&#43;&#43;  操作word" />
<meta property="og:description" content="最近完成了一个使用VC&#43;&#43; 操作word生成扫描报告的功能，在这里将过程记录下来，开发环境为visual studio 2008
导入接口 首先在创建的MFC项目中引入word相关组件
右键点击 项目 --&gt; 添加 --&gt; 新类,在弹出的对话框中选择Typelib中的MFC类。
然后在弹出的对话框中选择文件，从文件中导入MSWORD.OLB组件。
这个文件的路径一般在C:\Program Files (x86)\Microsoft Office\Office14 中，注意：最后一层可能不一定是Office14，这个看机器中安装的office 版本。
选择之后会要求我们决定导入那些接口，为了方便我们导入所有接口。
导入之后可以看到项目中省成本了很多代码文件，这些就是系统生成的操作Word的相关类。
这里编译可能会报错，error C2786: “BOOL (HDC,int,int,int,int)”: __uuidof 的操作数无效
解决方法：
修改对应头文件
#import &#34;C:\\Program Files\\Microsoft Office\\Office14\\MSWORD.OLB&#34; no_namespace 为：
#import &#34;C:\\Program Files\\Microsoft Office\\Office14\\MSWORD.OLB&#34; no_namespace raw_interfaces_only \ rename(&#34;FindText&#34;,&#34;_FindText&#34;) \ rename(&#34;Rectangle&#34;,&#34;_Rectangle&#34;) \ rename(&#34;ExitWindows&#34;,&#34;_ExitWindows&#34;) 再次编译，错误消失
常见接口介绍 要了解一些常见的类，我们首先需要明白这些接口的层次结构：
Application(WORD 为例，只列出一部分） Documents（所有的文档） Document（一个文档） ...... Templates（所有模板） Template（一个模板） ...... Windows（所有窗口） Window Selection View Selection（编辑对象） Font Style Range 这些组件其实是采用远程调用的方式调用word进程来完成相关操作。
Application：相当于一个word进程，每次操作之前都需要一个application对象，这个对象用于创建一个word进程。Documents：相当于word中打开的所有文档，如果用过word编辑多个文件，那么这个概念应该很好理解Templates：是一个模板对象，至于word模板，不了解的请自行百度Windows：word进程中的窗口Selection：编辑对象。也就是我们要写入word文档中的内容。一般包括文本、样式、图形等等对象。 回忆一下我们手动编写word的情景，其实使用这些接口是很简单的。我们在使用word编辑的时候首先会打开word程序，这里对应在代码里面就是创建一个Application对象。然后我们会用word程序打开一个文档或者新建一个文档。这里对应着创建Documents对象并从中引用一个Document对象表示一个具体的文档。当然这个Document对象可以是新建的也可以是打开一个现有的。接着就是进行相关操作了，比如插入图片、插入表格、编写段落文本等等了。这些都对应着创建类似于Font、Style、TypeText对象，然后将这些对象进行添加的操作了。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/fb9354afbb501a50f1696d0a57e3b2c2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-04-14T15:23:32+08:00" />
<meta property="article:modified_time" content="2019-04-14T15:23:32+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">VC&#43;&#43;&#43;  操作word</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>最近完成了一个使用VC++ 操作word生成扫描报告的功能，在这里将过程记录下来，开发环境为visual studio 2008</p> 
 
<h3><a id="_2"></a>导入接口</h3> 
<p>首先在创建的MFC项目中引入word相关组件<br> 右键点击 项目 --&gt; 添加 --&gt; 新类,在弹出的对话框中选择Typelib中的MFC类。<br> <img src="https://images2.imgbox.com/00/20/RrMFbbm2_o.jpg" alt=""><br> 然后在弹出的对话框中选择文件，从文件中导入MSWORD.OLB组件。<br> <img src="https://images2.imgbox.com/18/f7/ddvJ7ETv_o.jpg" alt=""></p> 
<p>这个文件的路径一般在C:\Program Files (x86)\Microsoft Office\Office14 中，注意：最后一层可能不一定是Office14，这个看机器中安装的office 版本。<br> 选择之后会要求我们决定导入那些接口，为了方便我们导入所有接口。<br> <img src="https://images2.imgbox.com/c5/7a/3fY14UXX_o.jpg" alt=""></p> 
<p>导入之后可以看到项目中省成本了很多代码文件，这些就是系统生成的操作Word的相关类。</p> 
<p>这里编译可能会报错，error C2786: “BOOL (HDC,int,int,int,int)”: __uuidof 的操作数无效<br> 解决方法：<br> 修改对应头文件</p> 
<pre><code class="prism language-cpp"><span class="token macro property">#<span class="token directive keyword">import</span> "C:\\Program Files\\Microsoft Office\\Office14\\MSWORD.OLB" no_namespace</span>
</code></pre> 
<p>为：</p> 
<pre><code class="prism language-cpp"><span class="token macro property">#<span class="token directive keyword">import</span> "C:\\Program Files\\Microsoft Office\\Office14\\MSWORD.OLB" no_namespace raw_interfaces_only \
	rename("FindText","_FindText") \
	rename("Rectangle","_Rectangle") \
	rename("ExitWindows","_ExitWindows")</span>
</code></pre> 
<p>再次编译，错误消失</p> 
<h3><a id="_30"></a>常见接口介绍</h3> 
<p>要了解一些常见的类，我们首先需要明白这些接口的层次结构：</p> 
<pre><code>Application(WORD 为例，只列出一部分）
　　Documents（所有的文档）
        Document（一个文档）
            ......
　　Templates（所有模板）
        Template（一个模板）
            ......
　　Windows（所有窗口）
        Window
        Selection
        View
　　Selection（编辑对象）
        Font
        Style
        Range
</code></pre> 
<p>这些组件其实是采用远程调用的方式调用word进程来完成相关操作。</p> 
<ul><li>Application：相当于一个word进程，每次操作之前都需要一个application对象，这个对象用于创建一个word进程。</li><li>Documents：相当于word中打开的所有文档，如果用过word编辑多个文件，那么这个概念应该很好理解</li><li>Templates：是一个模板对象，至于word模板，不了解的请自行百度</li><li>Windows：word进程中的窗口</li><li>Selection：编辑对象。也就是我们要写入word文档中的内容。一般包括文本、样式、图形等等对象。</li></ul> 
<p>回忆一下我们手动编写word的情景，其实使用这些接口是很简单的。我们在使用word编辑的时候首先会打开word程序，这里对应在代码里面就是创建一个Application对象。然后我们会用word程序打开一个文档或者新建一个文档。这里对应着创建Documents对象并从中引用一个Document对象表示一个具体的文档。当然这个Document对象可以是新建的也可以是打开一个现有的。接着就是进行相关操作了，比如插入图片、插入表格、编写段落文本等等了。这些都对应着创建类似于Font、Style、TypeText对象，然后将这些对象进行添加的操作了。<br> 说了这么多。这些接口这么多，我怎么知道哪个接口对应哪个对象呢，而且这些参数怎么传递呢？其实这个问题很好解决。我们可以手工进行相关操作，然后用宏记录下来，最后我们再将宏中的VB代码转化为VC代码即可。</p> 
<h3><a id="_61"></a>相关操作</h3> 
<p>为了方便在项目中使用，这里创建一个类用于封装Word的相关操作</p> 
<pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">CCreateWordReport</span>  
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">private</span><span class="token operator">:</span>
    CApplication m_wdApp<span class="token punctuation">;</span>
    CDocuments m_wdDocs<span class="token punctuation">;</span>
    CDocument0 m_wdDoc<span class="token punctuation">;</span>
    CSelection m_wdSel<span class="token punctuation">;</span> 
    CRange     m_wdRange<span class="token punctuation">;</span>
    CnlineShapes m_wdInlineShapes<span class="token punctuation">;</span>
    CnlineShape m_wdInlineShape<span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">CCreateWordReport</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">CCreateWordReport</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token comment">//操作</span>
    <span class="token comment">//**********************创建新文档*******************************************</span>
    BOOL <span class="token function">CreateApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">//创建一个新的WORD应用程序</span>
    BOOL <span class="token function">CreateDocuments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//创建一个新的Word文档集合</span>
    BOOL <span class="token function">CreateDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//创建一个新的Word文档</span>
    BOOL <span class="token function">Create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment">//创建新的WORD应用程序并创建一个新的文档</span>
    <span class="token keyword">void</span> <span class="token function">ShowApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment">//显示WORD文档</span>
    <span class="token keyword">void</span> <span class="token function">HideApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment">//隐藏word文档</span>

    <span class="token comment">//**********************打开文档*********************************************</span>
    BOOL <span class="token function">OpenDocument</span><span class="token punctuation">(</span>CString fileName<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//打开已经存在的文档。</span>
    BOOL <span class="token function">Open</span><span class="token punctuation">(</span>CString fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//创建新的WORD应用程序并打开一个已经存在的文档。</span>
    BOOL <span class="token function">SetActiveDocument</span><span class="token punctuation">(</span><span class="token keyword">short</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//设置当前激活的文档。</span>

    <span class="token comment">//**********************保存文档*********************************************</span>
    BOOL <span class="token function">SaveDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//文档是以打开形式，保存。</span>
    BOOL <span class="token function">SaveDocumentAs</span><span class="token punctuation">(</span>CString fileName<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//文档以创建形式，保存。</span>
    BOOL <span class="token function">CloseDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">CloseApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

    <span class="token comment">//**********************文本书写操作*****************************************</span>
    <span class="token keyword">void</span> <span class="token function">WriteText</span><span class="token punctuation">(</span>CString szText<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//当前光标处写文本</span>
    <span class="token keyword">void</span> <span class="token function">WriteNewLineText</span><span class="token punctuation">(</span>CString szText<span class="token punctuation">,</span> <span class="token keyword">int</span> nLineCount <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//换N行写字</span>
    <span class="token keyword">void</span> <span class="token function">WriteEndLine</span><span class="token punctuation">(</span>CString szText<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//文档结尾处写文本</span>
    <span class="token keyword">void</span> <span class="token function">WholeStory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">//全选文档内容</span>
    <span class="token keyword">void</span> <span class="token function">Copy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment">//复制文本内容到剪贴板</span>
    <span class="token keyword">void</span> <span class="token function">InsertFile</span><span class="token punctuation">(</span>CString fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//将本地的文件全部内容写入到当前文档的光标处。</span>
    <span class="token keyword">void</span> <span class="token function">InsertTable</span><span class="token punctuation">(</span><span class="token keyword">int</span> nRow<span class="token punctuation">,</span> <span class="token keyword">int</span> nColumn<span class="token punctuation">,</span> CTable0<span class="token operator">&amp;</span> wdTable<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//**********************图片插入操作*****************************************</span>
    <span class="token keyword">void</span> <span class="token function">InsertShapes</span><span class="token punctuation">(</span>CString fileName<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//在当前光标的位置插入图片</span>
    
    <span class="token comment">//**********************超链接插入操作*****************************************</span>
    <span class="token keyword">void</span> <span class="token function">InsertHyperlink</span><span class="token punctuation">(</span>CString fileLink<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//超级链接地址，可以是相对路径。</span>

	<span class="token comment">//***********************表格操作表格操作**********************************</span>
	BOOL <span class="token function">InsertTableToMarkBook</span><span class="token punctuation">(</span><span class="token keyword">const</span> CString csMarkName<span class="token punctuation">,</span> <span class="token keyword">int</span> nRow<span class="token punctuation">,</span> <span class="token keyword">int</span> nColumn<span class="token punctuation">,</span> CTable0<span class="token operator">&amp;</span> wdTable<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//表格行数与列数</span>
	BOOL <span class="token function">WriteDataToTable</span><span class="token punctuation">(</span>CTable0<span class="token operator">&amp;</span> wdTable<span class="token punctuation">,</span> <span class="token keyword">int</span> nRow<span class="token punctuation">,</span> <span class="token keyword">int</span> nColumn<span class="token punctuation">,</span> <span class="token keyword">const</span> CString <span class="token operator">&amp;</span>csData<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//往表格中写入输入</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-cpp">BOOL CCreateWordReport<span class="token operator">::</span><span class="token function">CreateApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>FALSE <span class="token operator">==</span> m_wdApp<span class="token punctuation">.</span><span class="token function">CreateDispatch</span><span class="token punctuation">(</span><span class="token string">"word.application"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">AfxMessageBox</span><span class="token punctuation">(</span><span class="token string">"Application创建失败，请确保安装了word 2000或以上版本!"</span><span class="token punctuation">,</span> MB_OK<span class="token operator">|</span>MB_ICONWARNING<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> TRUE<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

BOOL CCreateWordReport<span class="token operator">::</span><span class="token function">CreateDocuments</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>FALSE <span class="token operator">==</span> <span class="token function">CreateApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    m_wdDocs <span class="token operator">=</span> m_wdApp<span class="token punctuation">.</span><span class="token function">get_Documents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>m_wdDocs<span class="token punctuation">.</span>m_lpDispatch<span class="token punctuation">)</span> 
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">AfxMessageBox</span><span class="token punctuation">(</span><span class="token string">"Documents创建失败!"</span><span class="token punctuation">,</span> MB_OK<span class="token operator">|</span>MB_ICONWARNING<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> TRUE<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

BOOL CCreateWordReport<span class="token operator">::</span><span class="token function">CreateDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>m_wdDocs<span class="token punctuation">.</span>m_lpDispatch<span class="token punctuation">)</span> 
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">AfxMessageBox</span><span class="token punctuation">(</span><span class="token string">"Documents为空!"</span><span class="token punctuation">,</span> MB_OK<span class="token operator">|</span>MB_ICONWARNING<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    COleVariant <span class="token function">varTrue</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>VT_BOOL<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">vOptional</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>DISP_E_PARAMNOTFOUND<span class="token punctuation">,</span> VT_ERROR<span class="token punctuation">)</span><span class="token punctuation">;</span>
    CComVariant <span class="token function">Template</span><span class="token punctuation">(</span><span class="token function">_T</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//没有使用WORD的文档模板</span>
    CComVariant <span class="token function">NewTemplate</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">DocumentType</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>Visible<span class="token punctuation">;</span>

    m_wdDocs<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Template<span class="token punctuation">,</span><span class="token operator">&amp;</span>NewTemplate<span class="token punctuation">,</span><span class="token operator">&amp;</span>DocumentType<span class="token punctuation">,</span><span class="token operator">&amp;</span>Visible<span class="token punctuation">)</span><span class="token punctuation">;</span>    

    <span class="token comment">//得到document变量</span>
    m_wdDoc <span class="token operator">=</span> m_wdApp<span class="token punctuation">.</span><span class="token function">get_ActiveDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>m_wdDoc<span class="token punctuation">.</span>m_lpDispatch<span class="token punctuation">)</span> 
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">AfxMessageBox</span><span class="token punctuation">(</span><span class="token string">"Document获取失败!"</span><span class="token punctuation">,</span> MB_OK<span class="token operator">|</span>MB_ICONWARNING<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//得到selection变量</span>
    m_wdSel <span class="token operator">=</span> m_wdApp<span class="token punctuation">.</span><span class="token function">get_Selection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>m_wdSel<span class="token punctuation">.</span>m_lpDispatch<span class="token punctuation">)</span> 
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">AfxMessageBox</span><span class="token punctuation">(</span><span class="token string">"Select获取失败!"</span><span class="token punctuation">,</span> MB_OK<span class="token operator">|</span>MB_ICONWARNING<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//得到Range变量</span>
    m_wdRange <span class="token operator">=</span> m_wdDoc<span class="token punctuation">.</span><span class="token function">Range</span><span class="token punctuation">(</span>vOptional<span class="token punctuation">,</span>vOptional<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>m_wdRange<span class="token punctuation">.</span>m_lpDispatch<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">AfxMessageBox</span><span class="token punctuation">(</span><span class="token string">"Range获取失败!"</span><span class="token punctuation">,</span> MB_OK<span class="token operator">|</span>MB_ICONWARNING<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> TRUE<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

BOOL CCreateWordReport<span class="token operator">::</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>FALSE <span class="token operator">==</span> <span class="token function">CreateDocuments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">CreateDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

BOOL CCreateWordReport<span class="token operator">::</span><span class="token function">OpenDocument</span><span class="token punctuation">(</span>CString fileName<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>m_wdDocs<span class="token punctuation">.</span>m_lpDispatch<span class="token punctuation">)</span> 
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">AfxMessageBox</span><span class="token punctuation">(</span><span class="token string">"Documents为空!"</span><span class="token punctuation">,</span> MB_OK<span class="token operator">|</span>MB_ICONWARNING<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    COleVariant <span class="token function">vTrue</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span>TRUE<span class="token punctuation">)</span><span class="token punctuation">,</span>    
                <span class="token function">vFalse</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span>FALSE<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">vOptional</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>DISP_E_PARAMNOTFOUND<span class="token punctuation">,</span> VT_ERROR<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">vZ</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    COleVariant     <span class="token function">vFileName</span><span class="token punctuation">(</span><span class="token function">_T</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">//得到document变量</span>
    m_wdDoc <span class="token operator">=</span> m_wdDocs<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>
                                vFileName<span class="token punctuation">,</span>        <span class="token comment">// FileName</span>
                                vTrue<span class="token punctuation">,</span>            <span class="token comment">// Confirm Conversion.</span>
                                vFalse<span class="token punctuation">,</span>            <span class="token comment">// ReadOnly.</span>
                                vFalse<span class="token punctuation">,</span>            <span class="token comment">// AddToRecentFiles.</span>
                                vOptional<span class="token punctuation">,</span>        <span class="token comment">// PasswordDocument.</span>
                                vOptional<span class="token punctuation">,</span>        <span class="token comment">// PasswordTemplate.</span>
                                vOptional<span class="token punctuation">,</span>        <span class="token comment">// Revert.</span>
                                vOptional<span class="token punctuation">,</span>        <span class="token comment">// WritePasswordDocument.</span>
                                vOptional<span class="token punctuation">,</span>        <span class="token comment">// WritePasswordTemplate.</span>
                                vOptional<span class="token punctuation">,</span>        <span class="token comment">// Format. // Last argument for Word 97</span>
                                vOptional<span class="token punctuation">,</span>        <span class="token comment">// Encoding // New for Word 2000/2002</span>
                                vOptional<span class="token punctuation">,</span>        <span class="token comment">// Visible</span>
                                <span class="token comment">/*如下4个是word2003需要的参数。本版本是word2000。*/</span>
                                vOptional<span class="token punctuation">,</span>    <span class="token comment">// OpenAndRepair</span>
                                vZ<span class="token punctuation">,</span>            <span class="token comment">// DocumentDirection wdDocumentDirection LeftToRight</span>
                                vOptional<span class="token punctuation">,</span>    <span class="token comment">// NoEncodingDialog</span>
                                vOptional
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>m_wdDoc<span class="token punctuation">.</span>m_lpDispatch<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">AfxMessageBox</span><span class="token punctuation">(</span><span class="token string">"Document获取失败!"</span><span class="token punctuation">,</span> MB_OK<span class="token operator">|</span>MB_ICONWARNING<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//得到selection变量</span>
    m_wdSel <span class="token operator">=</span> m_wdApp<span class="token punctuation">.</span><span class="token function">get_Selection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>m_wdSel<span class="token punctuation">.</span>m_lpDispatch<span class="token punctuation">)</span> 
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">AfxMessageBox</span><span class="token punctuation">(</span><span class="token string">"Select获取失败!"</span><span class="token punctuation">,</span> MB_OK<span class="token operator">|</span>MB_ICONWARNING<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//得到全部DOC的Range变量</span>
    m_wdRange <span class="token operator">=</span> m_wdDoc<span class="token punctuation">.</span><span class="token function">Range</span><span class="token punctuation">(</span>vOptional<span class="token punctuation">,</span>vOptional<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>m_wdRange<span class="token punctuation">.</span>m_lpDispatch<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">AfxMessageBox</span><span class="token punctuation">(</span><span class="token string">"Range获取失败!"</span><span class="token punctuation">,</span> MB_OK<span class="token operator">|</span>MB_ICONWARNING<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> TRUE<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

BOOL CCreateWordReport<span class="token operator">::</span><span class="token function">Open</span><span class="token punctuation">(</span>CString fileName<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>FALSE <span class="token operator">==</span> <span class="token function">CreateDocuments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">OpenDocument</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

BOOL CCreateWordReport<span class="token operator">::</span><span class="token function">SetActiveDocument</span><span class="token punctuation">(</span><span class="token keyword">short</span> i<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    COleVariant     <span class="token function">vIndex</span><span class="token punctuation">(</span><span class="token function">_T</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">vOptional</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>DISP_E_PARAMNOTFOUND<span class="token punctuation">,</span> VT_ERROR<span class="token punctuation">)</span><span class="token punctuation">;</span>

    m_wdDoc<span class="token punctuation">.</span><span class="token function">AttachDispatch</span><span class="token punctuation">(</span>m_wdDocs<span class="token punctuation">.</span><span class="token function">Item</span><span class="token punctuation">(</span>vIndex<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_wdDoc<span class="token punctuation">.</span><span class="token function">Activate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>m_wdDoc<span class="token punctuation">.</span>m_lpDispatch<span class="token punctuation">)</span> 
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">AfxMessageBox</span><span class="token punctuation">(</span><span class="token string">"Document获取失败!"</span><span class="token punctuation">,</span> MB_OK<span class="token operator">|</span>MB_ICONWARNING<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//得到selection变量</span>
    m_wdSel <span class="token operator">=</span> m_wdApp<span class="token punctuation">.</span><span class="token function">get_Selection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>m_wdSel<span class="token punctuation">.</span>m_lpDispatch<span class="token punctuation">)</span> 
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">AfxMessageBox</span><span class="token punctuation">(</span><span class="token string">"Select获取失败!"</span><span class="token punctuation">,</span> MB_OK<span class="token operator">|</span>MB_ICONWARNING<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//得到全部DOC的Range变量</span>
    m_wdRange <span class="token operator">=</span> m_wdDoc<span class="token punctuation">.</span><span class="token function">Range</span><span class="token punctuation">(</span>vOptional<span class="token punctuation">,</span>vOptional<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>m_wdRange<span class="token punctuation">.</span>m_lpDispatch<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">AfxMessageBox</span><span class="token punctuation">(</span><span class="token string">"Range获取失败!"</span><span class="token punctuation">,</span> MB_OK<span class="token operator">|</span>MB_ICONWARNING<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token comment">//	HideApp();</span>
    <span class="token keyword">return</span> TRUE<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

BOOL CCreateWordReport<span class="token operator">::</span><span class="token function">SaveDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>m_wdDoc<span class="token punctuation">.</span>m_lpDispatch<span class="token punctuation">)</span> 
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">AfxMessageBox</span><span class="token punctuation">(</span><span class="token string">"Document获取失败!"</span><span class="token punctuation">,</span> MB_OK<span class="token operator">|</span>MB_ICONWARNING<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    m_wdDoc<span class="token punctuation">.</span><span class="token function">Save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> TRUE<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

BOOL CCreateWordReport<span class="token operator">::</span><span class="token function">SaveDocumentAs</span><span class="token punctuation">(</span>CString fileName<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>m_wdDoc<span class="token punctuation">.</span>m_lpDispatch<span class="token punctuation">)</span> 
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">AfxMessageBox</span><span class="token punctuation">(</span><span class="token string">"Document获取失败!"</span><span class="token punctuation">,</span> MB_OK<span class="token operator">|</span>MB_ICONWARNING<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

	COleVariant <span class="token function">covOptional</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>DISP_E_PARAMNOTFOUND<span class="token punctuation">,</span>VT_ERROR<span class="token punctuation">)</span><span class="token punctuation">;</span>
	COleVariant <span class="token function">varZero</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
	COleVariant <span class="token function">varTrue</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>VT_BOOL<span class="token punctuation">)</span><span class="token punctuation">;</span> 
	COleVariant <span class="token function">varFalse</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>VT_BOOL<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    COleVariant <span class="token function">vFileName</span><span class="token punctuation">(</span><span class="token function">_T</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	m_wdDoc<span class="token punctuation">.</span><span class="token function">SaveAs</span><span class="token punctuation">(</span>
		vFileName<span class="token punctuation">,</span>
		covOptional<span class="token punctuation">,</span> 
		covOptional<span class="token punctuation">,</span> 
		covOptional<span class="token punctuation">,</span> 
		covOptional<span class="token punctuation">,</span>
		covOptional<span class="token punctuation">,</span> 
		covOptional<span class="token punctuation">,</span> 
		covOptional<span class="token punctuation">,</span> 
		covOptional<span class="token punctuation">,</span> 
		covOptional<span class="token punctuation">,</span> 
		covOptional<span class="token punctuation">,</span> 
		covOptional<span class="token punctuation">,</span> 
		covOptional<span class="token punctuation">,</span> 
		covOptional<span class="token punctuation">,</span> 
		covOptional<span class="token punctuation">,</span>
		covOptional
	<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span>    TRUE<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

BOOL CCreateWordReport<span class="token operator">::</span><span class="token function">CloseDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    COleVariant <span class="token function">vTrue</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span>TRUE<span class="token punctuation">)</span><span class="token punctuation">,</span>    
                <span class="token function">vFalse</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span>FALSE<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">vOptional</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>DISP_E_PARAMNOTFOUND<span class="token punctuation">,</span> VT_ERROR<span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_wdDoc<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span>vFalse<span class="token punctuation">,</span>    <span class="token comment">// SaveChanges.</span>
             vTrue<span class="token punctuation">,</span>            <span class="token comment">// OriginalFormat.</span>
             vFalse            <span class="token comment">// RouteDocument.</span>
             <span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_wdDoc<span class="token punctuation">.</span><span class="token function">AttachDispatch</span><span class="token punctuation">(</span>m_wdApp<span class="token punctuation">.</span><span class="token function">get_ActiveDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>m_wdDoc<span class="token punctuation">.</span>m_lpDispatch<span class="token punctuation">)</span> 
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">AfxMessageBox</span><span class="token punctuation">(</span><span class="token string">"Document获取失败!"</span><span class="token punctuation">,</span> MB_OK<span class="token operator">|</span>MB_ICONWARNING<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//得到selection变量</span>
    m_wdSel <span class="token operator">=</span> m_wdApp<span class="token punctuation">.</span><span class="token function">get_Selection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>m_wdSel<span class="token punctuation">.</span>m_lpDispatch<span class="token punctuation">)</span> 
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">AfxMessageBox</span><span class="token punctuation">(</span><span class="token string">"Select获取失败!"</span><span class="token punctuation">,</span> MB_OK<span class="token operator">|</span>MB_ICONWARNING<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//得到全部DOC的Range变量</span>
    m_wdRange <span class="token operator">=</span> m_wdDoc<span class="token punctuation">.</span><span class="token function">Range</span><span class="token punctuation">(</span>vOptional<span class="token punctuation">,</span>vOptional<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>m_wdRange<span class="token punctuation">.</span>m_lpDispatch<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">AfxMessageBox</span><span class="token punctuation">(</span><span class="token string">"Range获取失败!"</span><span class="token punctuation">,</span> MB_OK<span class="token operator">|</span>MB_ICONWARNING<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> TRUE<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> CCreateWordReport<span class="token operator">::</span><span class="token function">CloseApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    COleVariant <span class="token function">vTrue</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span>TRUE<span class="token punctuation">)</span><span class="token punctuation">,</span>    
                <span class="token function">vFalse</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span>FALSE<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">vOptional</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>DISP_E_PARAMNOTFOUND<span class="token punctuation">,</span> VT_ERROR<span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_wdDoc<span class="token punctuation">.</span><span class="token function">Save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_wdApp<span class="token punctuation">.</span><span class="token function">Quit</span><span class="token punctuation">(</span>vFalse<span class="token punctuation">,</span>    <span class="token comment">// SaveChanges.</span>
             vTrue<span class="token punctuation">,</span>            <span class="token comment">// OriginalFormat.</span>
             vFalse            <span class="token comment">// RouteDocument.</span>
             <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//释放内存申请资源</span>
    m_wdInlineShape<span class="token punctuation">.</span><span class="token function">ReleaseDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_wdInlineShapes<span class="token punctuation">.</span><span class="token function">ReleaseDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//m_wdTb.ReleaseDispatch();</span>
    m_wdRange<span class="token punctuation">.</span><span class="token function">ReleaseDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_wdSel<span class="token punctuation">.</span><span class="token function">ReleaseDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//m_wdFt.ReleaseDispatch();</span>
    m_wdDoc<span class="token punctuation">.</span><span class="token function">ReleaseDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_wdDocs<span class="token punctuation">.</span><span class="token function">ReleaseDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_wdApp<span class="token punctuation">.</span><span class="token function">ReleaseDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> CCreateWordReport<span class="token operator">::</span><span class="token function">WriteText</span><span class="token punctuation">(</span>CString szText<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    m_wdSel<span class="token punctuation">.</span><span class="token function">TypeText</span><span class="token punctuation">(</span>szText<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> CCreateWordReport<span class="token operator">::</span><span class="token function">WriteNewLineText</span><span class="token punctuation">(</span>CString szText<span class="token punctuation">,</span> <span class="token keyword">int</span> nLineCount <span class="token comment">/* = 1 */</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> i<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>nLineCount <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        nLineCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nLineCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        m_wdSel<span class="token punctuation">.</span><span class="token function">TypeParagraph</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">WriteText</span><span class="token punctuation">(</span>szText<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> CCreateWordReport<span class="token operator">::</span><span class="token function">WriteEndLine</span><span class="token punctuation">(</span>CString szText<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    m_wdRange<span class="token punctuation">.</span><span class="token function">InsertAfter</span><span class="token punctuation">(</span>szText<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> CCreateWordReport<span class="token operator">::</span><span class="token function">WholeStory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    m_wdRange<span class="token punctuation">.</span><span class="token function">WholeStory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> CCreateWordReport<span class="token operator">::</span><span class="token function">Copy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    m_wdRange<span class="token punctuation">.</span><span class="token function">CopyAsPicture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> CCreateWordReport<span class="token operator">::</span><span class="token function">InsertFile</span><span class="token punctuation">(</span>CString fileName<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    COleVariant     <span class="token function">vFileName</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">,</span>
                 <span class="token function">vTrue</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span>TRUE<span class="token punctuation">)</span><span class="token punctuation">,</span>
                 <span class="token function">vFalse</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span>FALSE<span class="token punctuation">)</span><span class="token punctuation">,</span>
                 <span class="token function">vOptional</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>DISP_E_PARAMNOTFOUND<span class="token punctuation">,</span> VT_ERROR<span class="token punctuation">)</span><span class="token punctuation">,</span>
                 <span class="token function">vNull</span><span class="token punctuation">(</span><span class="token function">_T</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/*
    void InsertFile(LPCTSTR FileName, VARIANT* Range, VARIANT* ConfirmConversions, VARIANT* Link, VARIANT* Attachment);
    */</span>
    m_wdSel<span class="token punctuation">.</span><span class="token function">InsertFile</span><span class="token punctuation">(</span>
                    fileName<span class="token punctuation">,</span>
                    vNull<span class="token punctuation">,</span>
                    vFalse<span class="token punctuation">,</span>
                    vFalse<span class="token punctuation">,</span>
                    vFalse
                    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> CCreateWordReport<span class="token operator">::</span><span class="token function">InsertShapes</span><span class="token punctuation">(</span>CString fileName<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    COleVariant <span class="token function">vTrue</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span>TRUE<span class="token punctuation">)</span><span class="token punctuation">,</span>    
                <span class="token function">vFalse</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span>FALSE<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">vOptional</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>DISP_E_PARAMNOTFOUND<span class="token punctuation">,</span> VT_ERROR<span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_wdInlineShapes<span class="token operator">=</span>m_wdSel<span class="token punctuation">.</span><span class="token function">get_InlineShapes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_wdInlineShape<span class="token operator">=</span>m_wdInlineShapes<span class="token punctuation">.</span><span class="token function">AddPicture</span><span class="token punctuation">(</span>fileName<span class="token punctuation">,</span>vFalse<span class="token punctuation">,</span>vTrue<span class="token punctuation">,</span>vOptional<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> CCreateWordReport<span class="token operator">::</span><span class="token function">InsertHyperlink</span><span class="token punctuation">(</span>CString fileLink<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    COleVariant     <span class="token function">vAddress</span><span class="token punctuation">(</span><span class="token function">_T</span><span class="token punctuation">(</span>fileLink<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">vSubAddress</span><span class="token punctuation">(</span><span class="token function">_T</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    CRange aRange <span class="token operator">=</span> m_wdSel<span class="token punctuation">.</span><span class="token function">get_Range</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    CHyperlinks <span class="token function">vHyperlinks</span><span class="token punctuation">(</span>aRange<span class="token punctuation">.</span><span class="token function">get_Hyperlinks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    vHyperlinks<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>
                    aRange<span class="token punctuation">,</span>            <span class="token comment">//Object，必需。转换为超链接的文本或图形。</span>
                    vAddress<span class="token punctuation">,</span>         <span class="token comment">//Variant 类型，可选。指定的链接的地址。此地址可以是电子邮件地址、Internet 地址或文件名。请注意，Microsoft Word 不检查该地址的正确性。</span>
                    vSubAddress<span class="token punctuation">,</span>     <span class="token comment">//Variant 类型，可选。目标文件内的位置名，如书签、已命名的区域或幻灯片编号。</span>
                    vAddress<span class="token punctuation">,</span>         <span class="token comment">//Variant 类型，可选。当鼠标指针放在指定的超链接上时显示的可用作“屏幕提示”的文本。默认值为 Address。</span>
                    vAddress<span class="token punctuation">,</span>         <span class="token comment">//Variant 类型，可选。指定的超链接的显示文本。此参数的值将取代由 Anchor 指定的文本或图形。</span>
                    vSubAddress        <span class="token comment">//Variant 类型，可选。要在其中打开指定的超链接的框架或窗口的名字。</span>
                    <span class="token punctuation">)</span><span class="token punctuation">;</span> 
	aRange<span class="token punctuation">.</span><span class="token function">ReleaseDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    vHyperlinks<span class="token punctuation">.</span><span class="token function">ReleaseDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>这样我们就封装好了一些基本的操作，其实这些操作都是我自己根据网上的资料以及VB宏转化而来得到的代码。</p> 
<h3><a id="_470"></a>特殊操作</h3> 
<p>在这里主要介绍一些比较骚的操作，这也是这篇文章主要有用的内容，前面基本操作网上都有源代码直接拿来用就OK了，这里的骚操作是我在项目中使用的主要操作，应该有应用价值。先请各位仔细想想，如果我们要根据前面的代码，从0开始完全用代码生成一个完整的报表是不是很累，而且一般报表都会包含一些通用的废话，这些话基本不会变化。如果将这些写到代码里面，如果后面这些话变了，我们就要修改并重新编译，是不是很麻烦。所以这里介绍的第一个操作就是利用模板和书签在合适的位置插入内容。</p> 
<h4><a id="_473"></a>书签的使用</h4> 
<p>首先我们在Word中的适当位置创建一个标签，至于如何创建标签，请自行百度。然后在代码中的思路就是在文档中查找我们的标签，再获取光标的位置，最后就是在该位置处添加相应的内容了，这里我们举一个在光标位置插入文本的例子:</p> 
<pre><code>void CCreateWordReport::WriteTextToBookMark(const CString&amp; csMarkName, const CString&amp; szText)
{
	CBookmarks bks = m_wdDoc.get_Bookmarks(); //获取文档中的所有书签
	CBookmark0 bk;
	COleVariant bk_name(csMarkName); 
	
	bk = bks.Item(&amp;bk_name); //查询对应名称的书签
	CRange  hRange = bk.get_Range(); //获取书签位置
	
	if (hRange != NULL)
	{
		hRange.put_Text(szText); //在该位置处插入文本
	}

    //最后不要忘记清理相关资源
	hRange.ReleaseDispatch();
	bk.ReleaseDispatch();
	bks.ReleaseDispatch();
}
</code></pre> 
<h4><a id="_497"></a>表格的使用</h4> 
<p>在word报表中表格应该是一个重头戏，表格中常用的接口如下:</p> 
<ul><li>CTables0: 表格集合</li><li>CTable0: 某个具体的表格，一般通过CTables来创建CTable</li><li>CColumn: 表格列对象</li><li>CRow：表格行对象</li><li>CCel：表格单元格对象</li></ul> 
<p>创建表格一般的操作如下:</p> 
<pre><code class="prism language-cpp"><span class="token keyword">void</span> CCreateWordReport<span class="token operator">::</span><span class="token function">InsertTable</span><span class="token punctuation">(</span><span class="token keyword">int</span> nRow<span class="token punctuation">,</span> <span class="token keyword">int</span> nColumn<span class="token punctuation">,</span> CTable0<span class="token operator">&amp;</span> wdTable<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	VARIANT vtDefault<span class="token punctuation">;</span>
	COleVariant vtAuto<span class="token punctuation">;</span>
	vtDefault<span class="token punctuation">.</span>vt <span class="token operator">=</span> VT_INT<span class="token punctuation">;</span>
	vtDefault<span class="token punctuation">.</span>intVal <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	vtAuto<span class="token punctuation">.</span>vt <span class="token operator">=</span> VT_INT<span class="token punctuation">;</span>
	vtAuto<span class="token punctuation">.</span>intVal <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    
	CTables0 wordtables <span class="token operator">=</span> m_wdDoc<span class="token punctuation">.</span><span class="token function">get_Tables</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	wdTable <span class="token operator">=</span> 	wordtables<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>m_wdSel<span class="token punctuation">.</span><span class="token function">get_Range</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nRow<span class="token punctuation">,</span> nColumn<span class="token punctuation">,</span> <span class="token operator">&amp;</span>vtDefault<span class="token punctuation">,</span> <span class="token operator">&amp;</span>vtAuto<span class="token punctuation">)</span><span class="token punctuation">;</span>
	wordtables<span class="token punctuation">.</span><span class="token function">ReleaseDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>往表格中写入内容的操作如下:</p> 
<pre><code class="prism language-cpp">BOOL CCreateWordReport<span class="token operator">::</span><span class="token function">WriteDataToTable</span><span class="token punctuation">(</span>CTable0<span class="token operator">&amp;</span> wdTable<span class="token punctuation">,</span> <span class="token keyword">int</span> nRow<span class="token punctuation">,</span> <span class="token keyword">int</span> nColumn<span class="token punctuation">,</span> <span class="token keyword">const</span> CString <span class="token operator">&amp;</span>csData<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span> 
	CCell cell <span class="token operator">=</span> wdTable<span class="token punctuation">.</span><span class="token function">Cell</span><span class="token punctuation">(</span>nRow<span class="token punctuation">,</span> nColumn<span class="token punctuation">)</span><span class="token punctuation">;</span>
	cell<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//将光标移动到单元格</span>
	m_wdSel<span class="token punctuation">.</span><span class="token function">TypeText</span><span class="token punctuation">(</span>csData<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	cell<span class="token punctuation">.</span><span class="token function">ReleaseDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> TRUE<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>合并单元格的操作如下:</p> 
<pre><code class="prism language-cpp">CTable0 wdTable<span class="token punctuation">;</span>
<span class="token function">InsertTable</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> wdTable<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//创建一个5行3列的表格</span>
CCell cell <span class="token operator">=</span> wdTable<span class="token punctuation">.</span><span class="token function">Cell</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//获得第一行第一列的单元格</span>
<span class="token comment">//设置第二列列宽</span>
CColumns0 columns <span class="token operator">=</span> wdTable<span class="token punctuation">.</span><span class="token function">get_Columns</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
CColumn col<span class="token punctuation">;</span>
col<span class="token punctuation">.</span><span class="token function">AttachDispatch</span><span class="token punctuation">(</span>columns<span class="token punctuation">.</span><span class="token function">Item</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
col<span class="token punctuation">.</span><span class="token function">SetWidth</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

cell<span class="token punctuation">.</span><span class="token function">Merge</span><span class="token punctuation">(</span>wdTable<span class="token punctuation">.</span><span class="token function">Cell</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//合并单元格，一直合并到第5行的第1列。</span>
cell<span class="token punctuation">.</span><span class="token function">SetWidth</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cell<span class="token punctuation">.</span><span class="token function">ReleaseDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>合并单元格用的是Merge函数，该函数的参数是一个单元格对象，表示合并结束的单元格。这里合并类似于我们画矩形时提供的左上角坐标和右下角坐标</p> 
<h4><a id="_554"></a>移动光标跳出表格</h4> 
<p>当时由于需要连续的生成多个表格，当时我将前一个表格的数据填完，光标位于最后一个单元格里面，这个时候如果再插入的时候会在这个单元格里面插入表格，这个时候需要我手动向下移动光标，让光标移除到表格外。移动光标的代码如下:</p> 
<pre><code class="prism language-cpp">m_wdSel<span class="token punctuation">.</span><span class="token function">MoveDown</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token function">COleVariant</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span>wdLine<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token function">COleVariant</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token function">COleVariant</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span>wdNULL<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre> 
<p>这里wdLine 是word相关接口定义的，表示希望以何种单位来移动，这里我是以行为单位。后面的1表示移动1行。</p> 
<p>但是我发现在面临换页的时候一次移动根本移动不出来，这个时候我又添加了一行这样的代码移动两行。但是问题又出现了，这一系列表格后面跟着另一个大标题，多移动几次之后可能会造成它移动到大标题的位置，而破坏我原来定义的模板，这个时候该怎么办呢？我采取的办法是，判断当前光标是否在表格中，如果是则移动一行，知道出了表格。这里的代码如下:</p> 
<pre><code class="prism language-cpp"><span class="token comment">//移动光标，直到跳出表格外</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span>TRUE<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    m_wdSel<span class="token punctuation">.</span><span class="token function">MoveDown</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token function">COleVariant</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span>wdLine<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token function">COleVariant</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token function">COleVariant</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span>wdNULL<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_wdSel<span class="token punctuation">.</span><span class="token function">Collapse</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token function">COleVariant</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span>wdCollapseStart<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>m_wdSel<span class="token punctuation">.</span><span class="token function">get_Information</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>wdWithInTable<span class="token punctuation">)</span><span class="token punctuation">.</span>boolVal<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="_575"></a>样式的使用</h4> 
<p>在使用样式的时候当然也可以用代码来定义，但是我们可以采取另一种方式，我们可以事先在模板文件中创建一系列样式，然后在需要的时候直接定义段落或者文本的样式即可</p> 
<pre><code class="prism language-cpp">m_wdSel<span class="token punctuation">.</span><span class="token function">put_Style</span><span class="token punctuation">(</span><span class="token function">COleVariant</span><span class="token punctuation">(</span><span class="token string">"二级标题"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//在当前光标处的样式定义为二级标题样式，这里的二级标题样式是我们在word中事先定义好的</span>
m_wdSel<span class="token punctuation">.</span><span class="token function">TypeText</span><span class="token punctuation">(</span>csTitle<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//在当前位置输出文本</span>
m_wdSel<span class="token punctuation">.</span><span class="token function">TypeParagraph</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//插入段落，这里主要为了换行，这个时候光标也会跟着动</span>
m_wdSel<span class="token punctuation">.</span><span class="token function">put_Style</span><span class="token punctuation">(</span><span class="token function">COleVariant</span><span class="token punctuation">(</span><span class="token string">"正文"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//定义此处样式为正文样式</span>
m_wdSel<span class="token punctuation">.</span><span class="token function">TypeText</span><span class="token punctuation">(</span>csText<span class="token punctuation">;</span>
</code></pre> 
<h3><a id="_585"></a>插入图表</h3> 
<p>我自己尝试用word生成的图表样式还可以，但是用代码插入的时候，样式就特别丑，这里没有办法，我采用GDI+绘制了一个饼图，然后将图片插入word中。</p> 
<pre><code class="prism language-cpp">BOOL CCreateWordReport<span class="token operator">::</span><span class="token function">DrawVulInforPic</span><span class="token punctuation">(</span><span class="token keyword">const</span> CString<span class="token operator">&amp;</span> csMarkName<span class="token punctuation">,</span> <span class="token keyword">int</span> nVulCnt<span class="token punctuation">,</span> <span class="token keyword">int</span> nVulCris<span class="token punctuation">,</span> <span class="token keyword">int</span> nHigh<span class="token punctuation">,</span> <span class="token keyword">int</span> nMid<span class="token punctuation">,</span> <span class="token keyword">int</span> nLow<span class="token punctuation">,</span> <span class="token keyword">int</span> nPossible<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	CBookmarks bks <span class="token operator">=</span> m_wdDoc<span class="token punctuation">.</span><span class="token function">get_Bookmarks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	COleVariant <span class="token function">bk_name</span><span class="token punctuation">(</span>csMarkName<span class="token punctuation">)</span><span class="token punctuation">;</span>
	CBookmark0 bk <span class="token operator">=</span> bks<span class="token punctuation">.</span><span class="token function">Item</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>bk_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
	bk<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	CnlineShapes isps <span class="token operator">=</span> m_wdSel<span class="token punctuation">.</span><span class="token function">get_InlineShapes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	COleVariant <span class="token function">vFalse</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span>FALSE<span class="token punctuation">)</span><span class="token punctuation">;</span>
	COleVariant <span class="token function">vNull</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	COleVariant <span class="token function">vOptional</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>DISP_E_PARAMNOTFOUND<span class="token punctuation">,</span>VT_ERROR<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//创建一个与桌面环境兼容的内存DC</span>
	HWND hWnd <span class="token operator">=</span> <span class="token function">GetDesktopWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	HDC hDc <span class="token operator">=</span> <span class="token function">GetDC</span><span class="token punctuation">(</span>hWnd<span class="token punctuation">)</span><span class="token punctuation">;</span>
	HDC hMemDc <span class="token operator">=</span> <span class="token function">CreateCompatibleDC</span><span class="token punctuation">(</span>hDc<span class="token punctuation">)</span><span class="token punctuation">;</span>
	HBITMAP hMemBmp <span class="token operator">=</span> <span class="token function">CreateCompatibleBitmap</span><span class="token punctuation">(</span>hDc<span class="token punctuation">,</span> PICTURE_WIDTH <span class="token operator">+</span> GLOBAL_MARGIN<span class="token punctuation">,</span> PICTURE_LENGTH <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">*</span> GLOBAL_MARGIN <span class="token operator">+</span> LENGED_BORDER_LENGTH<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">SelectObject</span><span class="token punctuation">(</span>hMemDc<span class="token punctuation">,</span> hMemBmp<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//绘制并保存图表</span>
	<span class="token function">DrawPie</span><span class="token punctuation">(</span>hMemDc<span class="token punctuation">,</span> nVulCnt<span class="token punctuation">,</span> nVulCris<span class="token punctuation">,</span> nHigh<span class="token punctuation">,</span> nMid<span class="token punctuation">,</span> nLow<span class="token punctuation">,</span> nPossible<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	COleVariant <span class="token function">vTrue</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span>TRUE<span class="token punctuation">)</span><span class="token punctuation">;</span>
	CnlineShape isp<span class="token operator">=</span>isps<span class="token punctuation">.</span><span class="token function">AddPicture</span><span class="token punctuation">(</span><span class="token string">"D:\\Program\\WordReport\\WordReport\\test.png"</span><span class="token punctuation">,</span>vFalse<span class="token punctuation">,</span>vTrue<span class="token punctuation">,</span>vOptional<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//以图片的方式插入图表</span>
	
    <span class="token comment">//设置图片的大小</span>
    isp<span class="token punctuation">.</span><span class="token function">put_Height</span><span class="token punctuation">(</span><span class="token number">141</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	isp<span class="token punctuation">.</span><span class="token function">put_Width</span><span class="token punctuation">(</span><span class="token number">423</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
    bks<span class="token punctuation">.</span><span class="token function">ReleaseDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	bk<span class="token punctuation">.</span><span class="token function">ReleaseDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	isps<span class="token punctuation">.</span><span class="token function">ReleaseDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	isp<span class="token punctuation">.</span><span class="token function">ReleaseDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">DeleteObject</span><span class="token punctuation">(</span>hMemDc<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">DeleteDC</span><span class="token punctuation">(</span>hMemDc<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">ReleaseDC</span><span class="token punctuation">(</span>hWnd<span class="token punctuation">,</span> hDc<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">return</span> TRUE<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>最后，各个接口的参数可以参考下面的链接:<br> <a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.office.interop.word?view=word-pia" rel="nofollow">.net Word office组件接口文档</a></p> 
<hr>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/67e0b4ce0d57a3307bd20d49ac5c671e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">ATCommand拨号</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7129e60b160ae14615307f584357250b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">个人笔记-大佬主页</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>