<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>后台权限管理控制shiro&#43;jsonMenu - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="后台权限管理控制shiro&#43;jsonMenu" />
<meta property="og:description" content="在学习后台的权限控制，自己参考了各种资料后的新手demo，ui框架选型为大家可以参照网上的，项目架构为spring mvc &#43; spring&#43;mybatis，简单易用好上手！搭建好框架后开始了第一个任务，设计并实现一套简单的权限管理功能。
一套最基本的权限管理包括用户、角色、资源。
数据库设计：
资源表：tb_menu （含菜单项、菜单栏、按钮等） 角色表：tb_role（这里我没有创建中间表，所有的权限通过组合的字符串存储） 用户表：tb_users（关联角色ID获取资源权限）
注：1）、做法支持1对多，也就是用户有多对多权限控制，表的数据机构设计就靠大家自己构思啦，也可以参考我设计思路 2）、因是简单的DEMO版本，所以service层和controller层写在一起，大家实际做的时候，可不要模仿哦。
后台分发权限页面效果实现 采用ztree树来展示效果 所需JS资源下载路径：http://download.csdn.net/detail/u014799292/9502805
展示效果页： 实现代码如下：
&lt;%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34; pageEncoding=&#34;UTF-8&#34;%&gt; &lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head lang=&#34;en&#34;&gt; &lt;meta http-equiv=&#34;Content-Type&#34; content=&#34;text/html; charset=utf-8&#34; /&gt; &lt;title&gt;权限功能&lt;/title&gt; &lt;link rel=&#34;stylesheet&#34; href=&#34;${pageContext.request.contextPath}/js/ztree/zTreeStyle/demo.css&#34; type=&#34;text/css&#34;&gt; &lt;link rel=&#34;stylesheet&#34; href=&#34;${pageContext.request.contextPath}/js/ztree/zTreeStyle/zTreeStyle.css&#34; type=&#34;text/css&#34;&gt; &lt;script type=&#34;text/javascript&#34; src=&#34;${pageContext.request.contextPath}/js/jquery-1.11.3.min.js&#34;&gt;&lt;/script&gt; &lt;script type=&#34;text/javascript&#34; src=&#34;${pageContext.request.contextPath}/js/ztree/jquery-migrate-1.2.1.js&#34;&gt;&lt;/script&gt; &lt;script type=&#34;text/javascript&#34; src=&#34;${pageContext.request.contextPath}/js/ztree/jquery.ztree.core-3.5.js&#34;&gt;&lt;/script&gt; &lt;script type=&#34;text/javascript&#34; src=&#34;${pageContext.request.contextPath}/js/ztree/jquery.ztree.excheck-3.5.js&#34;&gt;&lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;div class=&#34;form&#34; align=&#34;center&#34;&gt; &lt;form id=&#34;rolePowerForm&#34; action=&#34;${pageContext.request.contextPath}/role/powerRole&#34;&gt; &lt;input type=&#34;hidden&#34; name=&#34;roleId&#34; value=&#34;${role.roleId}&#34;/&gt; &lt;input type=&#34;hidden&#34; id=&#34;menuLinksId&#34; name=&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/49d4560cfe518fbcfc664fbfb1790491/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2016-04-26T12:26:45+08:00" />
<meta property="article:modified_time" content="2016-04-26T12:26:45+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">后台权限管理控制shiro&#43;jsonMenu</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>在学习后台的权限控制，自己参考了各种资料后的新手demo，ui框架选型为大家可以参照网上的，项目架构为spring mvc + spring+mybatis，简单易用好上手！搭建好框架后开始了第一个任务，设计并实现一套简单的权限管理功能。</p> 
<p>一套最基本的权限管理包括用户、角色、资源。</p> 
<p>数据库设计：</p> 
<p>资源表：tb_menu （含菜单项、菜单栏、按钮等） <br> 角色表：tb_role（这里我没有创建中间表，所有的权限通过组合的字符串存储） <br> 用户表：tb_users（关联角色ID获取资源权限）</p> 
<p><strong>注</strong>：1）、做法支持<strong>1对多</strong>，也就是用户有多对多权限控制，表的数据机构设计就靠大家自己构思啦，也可以参考我设计思路 <br> 2）、因是简单的DEMO版本，所以service层和controller层写在一起，大家实际做的时候，可不要模仿哦。</p> 
<p>后台分发权限页面效果实现 <br> 采用ztree树来展示效果 <br> 所需JS资源下载路径：<a href="http://download.csdn.net/detail/u014799292/9502805">http://download.csdn.net/detail/u014799292/9502805</a></p> 
<p>展示效果页： <br> <img src="https://images2.imgbox.com/ce/01/bcX0KAru_o.png" alt="这里写图片描述" title=""></p> 
<p>实现代码如下：</p> 
<pre class="prettyprint"><code class=" hljs xml"><span class="vbscript">&lt;%@ page language=<span class="hljs-string">"java"</span> contentType=<span class="hljs-string">"text/html; charset=UTF-8"</span> pageEncoding=<span class="hljs-string">"UTF-8"</span>%&gt;</span>
<span class="hljs-doctype">&lt;!DOCTYPE html&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">head</span> <span class="hljs-attribute">lang</span>=<span class="hljs-value">"en"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">http-equiv</span>=<span class="hljs-value">"Content-Type"</span> <span class="hljs-attribute">content</span>=<span class="hljs-value">"text/html; charset=utf-8"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">title</span>&gt;</span>权限功能<span class="hljs-tag">&lt;/<span class="hljs-title">title</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"${pageContext.request.contextPath}/js/ztree/zTreeStyle/demo.css"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/css"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"${pageContext.request.contextPath}/js/ztree/zTreeStyle/zTreeStyle.css"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/css"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"${pageContext.request.contextPath}/js/jquery-1.11.3.min.js"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"${pageContext.request.contextPath}/js/ztree/jquery-migrate-1.2.1.js"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"${pageContext.request.contextPath}/js/ztree/jquery.ztree.core-3.5.js"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"${pageContext.request.contextPath}/js/ztree/jquery.ztree.excheck-3.5.js"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-title">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">body</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"form"</span> <span class="hljs-attribute">align</span>=<span class="hljs-value">"center"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">form</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"rolePowerForm"</span> <span class="hljs-attribute">action</span>=<span class="hljs-value">"${pageContext.request.contextPath}/role/powerRole"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"hidden"</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"roleId"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"${role.roleId}"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"hidden"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"menuLinksId"</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"menuLinksId"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"${role.menuLinksId}"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">ul</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"treeDemo"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"ztree"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">ul</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">br</span>&gt;</span>
<span class="hljs-comment">&lt;!--        &lt;input id="sumbitBut" type='button' value='确认'/&gt; --&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">form</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">script</span>&gt;</span><span class="javascript">
    $.browser={};
    <span class="hljs-keyword">var</span> zNodes = ${requestScope.roleMenuJsons}
<span class="hljs-comment">//     console.log(zNodes);</span>
    $(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{<!-- --></span>
        $.browser.msie=<span class="hljs-literal">false</span>;
        $.browser.version=<span class="hljs-number">0</span>;
        <span class="hljs-keyword">if</span>(navigator.userAgent.match(<span class="hljs-regexp">/MSIE ([0-9]+)./</span>)){
            $.browser.msie=<span class="hljs-literal">true</span>;
            $.browser.version=<span class="hljs-built_in">RegExp</span>.$<span class="hljs-number">1</span>;
        }
         $.fn.zTree.init($(<span class="hljs-string">"#treeDemo"</span>), setting, zNodes); 
    });
    <span class="hljs-keyword">var</span> tree = <span class="hljs-string">""</span>;  
    <span class="hljs-keyword">var</span> setting = {  
        check : {  
            chkboxType:{<!-- --><span class="hljs-string">"Y"</span>:<span class="hljs-string">"ps"</span>,<span class="hljs-string">"N"</span>:<span class="hljs-string">"ps"</span>},<span class="hljs-comment">//勾选checkbox对于父子节点的关联关系,取消勾选时不关联父  </span>
            chkStyle:<span class="hljs-string">"checkbox"</span>,  
            enable : <span class="hljs-literal">true</span>   <span class="hljs-comment">//是否复选框  </span>
        },  
        <span class="hljs-comment">//数据  </span>
        data : {  
            simpleData : {  
                enable : <span class="hljs-literal">true</span>,  
                idKey: <span class="hljs-string">"id"</span>,
                pIdKey: <span class="hljs-string">"pid"</span>
            }  
        }, 
        callback:{
            onCheck:onCheck
        }
    };
    <span class="hljs-comment">//获取选中节点  </span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onCheck</span><span class="hljs-params">()</span>{<!-- --></span>  
        <span class="hljs-keyword">var</span> treeObj=$.fn.zTree.getZTreeObj(<span class="hljs-string">"treeDemo"</span>);  
        <span class="hljs-keyword">var</span> nodes=treeObj.getCheckedNodes(<span class="hljs-literal">true</span>);  
        <span class="hljs-keyword">var</span> linkIds = <span class="hljs-string">""</span>;  
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>;i&lt;nodes.length;i++){  
            linkIds += nodes[i].id+<span class="hljs-string">","</span>;
        }  
        <span class="hljs-keyword">var</span> list = linkIds.substring(<span class="hljs-number">0</span>,linkIds.length-<span class="hljs-number">1</span>);
        $(<span class="hljs-string">"#menuLinksId"</span>).val(list);
    }
</span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">html</span>&gt;</span></code></pre> 
<p>ztree的方法调用可参照API：<a href="http://www.ztree.me/v3/api.php" rel="nofollow">zTree v3.5.23 API 文档</a></p> 
<p>实体层 RoleMenuJson </p> 
<pre class="prettyprint"><code class=" hljs java"><span class="hljs-keyword">package</span> com.softAngel.admin.beans;

<span class="hljs-javadoc">/**
 * 角色授权列表菜单选项
 *<span class="hljs-javadoctag"> @author</span> Administrator
 *
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RoleMenuJson</span> {<!-- --></span>

    <span class="hljs-javadoc">/**  */</span>
    <span class="hljs-keyword">private</span> Integer id;
    <span class="hljs-javadoc">/** 统一权限节点 */</span>
    <span class="hljs-keyword">private</span> Integer pid;
    <span class="hljs-javadoc">/** 功能名称 */</span>
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-javadoc">/** 选中状态 */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> checked;
    <span class="hljs-javadoc">/** 展开状态 */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> open;


    <span class="hljs-keyword">public</span> Integer <span class="hljs-title">getId</span>() {
        <span class="hljs-keyword">return</span> id;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setId</span>(Integer id) {
        <span class="hljs-keyword">this</span>.id = id;
    }
    <span class="hljs-keyword">public</span> Integer <span class="hljs-title">getPid</span>() {
        <span class="hljs-keyword">return</span> pid;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPid</span>(Integer pid) {
        <span class="hljs-keyword">this</span>.pid = pid;
    }
    <span class="hljs-keyword">public</span> String <span class="hljs-title">getName</span>() {
        <span class="hljs-keyword">return</span> name;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setName</span>(String name) {
        <span class="hljs-keyword">this</span>.name = name;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isChecked</span>() {
        <span class="hljs-keyword">return</span> checked;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setChecked</span>(<span class="hljs-keyword">boolean</span> checked) {
        <span class="hljs-keyword">this</span>.checked = checked;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isOpen</span>() {
        <span class="hljs-keyword">return</span> open;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setOpen</span>(<span class="hljs-keyword">boolean</span> open) {
        <span class="hljs-keyword">this</span>.open = open;
    }


}
</code></pre> 
<p>Action层</p> 
<p>RolePermission</p> 
<pre class="prettyprint"><code class=" hljs java"><span class="hljs-javadoc">/**
     * 跳转到分配权限页
     *<span class="hljs-javadoctag"> @param</span> res
     *<span class="hljs-javadoctag"> @param</span> id
     */</span>
    <span class="hljs-annotation">@RequestMapping</span>(value=<span class="hljs-string">"/rePowerRole"</span>)
    <span class="hljs-keyword">public</span> String <span class="hljs-title">rePowerRole</span>(){
        <span class="hljs-annotation">@SuppressWarnings</span>(<span class="hljs-string">"unchecked"</span>)
        Map&lt;String, Object&gt; map = ReqToMap.toMap(request);
        String roleId = (String) map.get(<span class="hljs-string">"roleId"</span>);
        SqlSession dao = getDao();
        Tbrole role = dao.selectOne(<span class="hljs-string">"role.findTbRoleById"</span>,roleId);

        request.setAttribute(<span class="hljs-string">"role"</span>, role);
        request.setAttribute(<span class="hljs-string">"roleMenuJsons"</span>, JSONObject.toJSONString(getRoleMenuJsons(dao,role.getMenuLinksId())));
        <span class="hljs-keyword">return</span> <span class="hljs-string">"/admin/role/rolePower"</span>;
    }

    <span class="hljs-javadoc">/**
     * 获取所有资源，并打开拥有的资源权限
     *<span class="hljs-javadoctag"> @param</span> dao
     *<span class="hljs-javadoctag"> @param</span> link
     *<span class="hljs-javadoctag"> @return</span>
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> List&lt;RoleMenuJson&gt; <span class="hljs-title">getRoleMenuJsons</span>(SqlSession dao,String link){
        String []linkTemps = <span class="hljs-keyword">null</span>;
        <span class="hljs-keyword">if</span>(!StringUtil.isEmpty(link)){
            linkTemps = link.split(<span class="hljs-string">","</span>);
        }
        List&lt;RoleMenuJson&gt; roleMenuJsons = <span class="hljs-keyword">new</span> ArrayList&lt;RoleMenuJson&gt;();
        RoleMenuJson titleJson = <span class="hljs-keyword">new</span> RoleMenuJson();
        titleJson.setId(<span class="hljs-number">0</span>);
        titleJson.setPid(<span class="hljs-number">0</span>);
        <span class="hljs-keyword">if</span>(!StringUtil.isEmpty(link)){  <span class="hljs-comment">//如果角色有权限，总目录应该选中</span>
            titleJson.setChecked(<span class="hljs-keyword">true</span>);
        }<span class="hljs-keyword">else</span>{
            titleJson.setChecked(<span class="hljs-keyword">false</span>);
        }
        List&lt;TbmenuLink&gt; menuList = dao.selectList(<span class="hljs-string">"menuLink.menuForRoleList"</span>);     <span class="hljs-comment">//获取所有显示的菜单项</span>
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span> ; i &lt; menuList.size() ; i ++ ){
            TbmenuLink menu = menuList.get(i);
            RoleMenuJson single = <span class="hljs-keyword">new</span> RoleMenuJson();   <span class="hljs-comment">//创建节点</span>
            single.setId(menu.getMenuId());
            single.setPid(menu.getParentId());
            single.setName(menu.getMenuName());
            <span class="hljs-keyword">if</span>(linkTemps != <span class="hljs-keyword">null</span>){
                <span class="hljs-keyword">for</span>(String temp : linkTemps){
                    <span class="hljs-keyword">if</span>(!StringUtil.isEmpty(temp)){
                        <span class="hljs-keyword">int</span> number = Integer.parseInt(temp);
                        <span class="hljs-keyword">if</span>(number == menu.getMenuId()){     <span class="hljs-comment">//拥有的权限功能点将被选中</span>
                            single.setChecked(<span class="hljs-keyword">true</span>);
                            single.setOpen(<span class="hljs-keyword">true</span>);
                        }
                    }
                }
            }
            roleMenuJsons.add(single);
        }   
        titleJson.setName(<span class="hljs-string">"权限菜单"</span>);
        titleJson.setOpen(<span class="hljs-keyword">true</span>);
        roleMenuJsons.add(titleJson);<span class="hljs-comment">//存放头部菜单</span>

        <span class="hljs-keyword">return</span> roleMenuJsons;
    }
    <span class="hljs-javadoc">/**
     * 分配权限
     *<span class="hljs-javadoctag"> @param</span> res
     *<span class="hljs-javadoctag"> @param</span> id
     */</span>
    <span class="hljs-annotation">@RequestMapping</span>(value=<span class="hljs-string">"/powerRole"</span>)
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">powerRole</span>(HttpServletResponse res,
            @<span class="hljs-title">RequestParam</span>(required=<span class="hljs-keyword">true</span>)<span class="hljs-keyword">int</span> roleId){
        JSONObject msg = <span class="hljs-keyword">new</span> JSONObject();
        <span class="hljs-keyword">if</span>(roleId &gt; <span class="hljs-number">0</span>){
            <span class="hljs-annotation">@SuppressWarnings</span>(<span class="hljs-string">"unchecked"</span>)
            Map&lt;String, Object&gt; map = ReqToMap.toMap(request);
            SqlSession dao = getDao();
            Tbusers loginUser = <span class="hljs-keyword">null</span>;
            <span class="hljs-keyword">try</span>{
                loginUser = (Tbusers) session.getAttribute(<span class="hljs-string">"loginUser"</span>);
                map.put(<span class="hljs-string">"updater"</span>,loginUser.getId());
                <span class="hljs-keyword">int</span> result = dao.update(<span class="hljs-string">"role.updateRolePower"</span>,map);    <span class="hljs-comment">//更新角色权限</span>
                <span class="hljs-keyword">if</span>(result &gt; <span class="hljs-number">0</span>){
                    msg.put(<span class="hljs-string">"code"</span>, <span class="hljs-number">0</span>);
                    msg.put(<span class="hljs-string">"info"</span>, <span class="hljs-string">"授权成功"</span>);
                }<span class="hljs-keyword">else</span>{
                    msg.put(<span class="hljs-string">"code"</span>, <span class="hljs-number">1</span>);
                    msg.put(<span class="hljs-string">"info"</span>, <span class="hljs-string">"数据有误，授权失败"</span>);
                }
            }<span class="hljs-keyword">catch</span>(Exception e){
                e.printStackTrace();
                logger.info(<span class="hljs-string">"后台未找到登录用户"</span>);
                msg.put(<span class="hljs-string">"code"</span>, <span class="hljs-number">1</span>);
                msg.put(<span class="hljs-string">"info"</span>, <span class="hljs-string">"操作失败，后台未找到登录用户"</span>);
            }
        }<span class="hljs-keyword">else</span>{
            msg.put(<span class="hljs-string">"code"</span>, <span class="hljs-number">1</span>);
            msg.put(<span class="hljs-string">"info"</span>, <span class="hljs-string">"角色信息错误"</span>);
        }
        out(msg.toJSONString(), res);
    }</code></pre> 
<p>登录时进行判断操作，获取有JSON权限的菜单栏 <br> Menu 菜单实例</p> 
<pre class="prettyprint"><code class=" hljs java"><span class="hljs-keyword">package</span> com.softAngel.admin.beans;

<span class="hljs-keyword">import</span> java.io.Serializable;
<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;


<span class="hljs-javadoc">/**
*@author leopard
*/</span>
<span class="hljs-annotation">@SuppressWarnings</span>(<span class="hljs-string">"serial"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Menu</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span>{<!-- --></span>

    <span class="hljs-javadoc">/**  */</span>
    <span class="hljs-keyword">private</span> Integer menuid;
    <span class="hljs-javadoc">/** 栏目名 */</span>
    <span class="hljs-keyword">private</span> String menuname;
    <span class="hljs-javadoc">/** 权限类型（所属父级，0本身） */</span>
    <span class="hljs-keyword">private</span> Integer menuParentId;
    <span class="hljs-javadoc">/** 链接地址 */</span>
    <span class="hljs-keyword">private</span> String url;
    <span class="hljs-javadoc">/** 排序 */</span>
    <span class="hljs-keyword">private</span> Integer menuSort;
    <span class="hljs-javadoc">/** 菜单栏图标 */</span>
    <span class="hljs-keyword">private</span> String icon;

    <span class="hljs-javadoc">/** 菜单栏集合 */</span>
    List&lt;Menu&gt; menus = <span class="hljs-keyword">new</span> ArrayList&lt;Menu&gt;();

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> List&lt;Menu&gt; <span class="hljs-title">formatTree</span>(List&lt;Menu&gt; list) { 
        List&lt;Menu&gt; parentNodes = <span class="hljs-keyword">new</span> ArrayList&lt;Menu&gt;();<span class="hljs-comment">// parentnodes存放所有的父节点</span>
        Menu node = <span class="hljs-keyword">new</span> Menu();
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span> ; i &lt; list.size() ; i ++){<!-- --><span class="hljs-comment">//寻找父级节点</span>
            node = list.get(i);
            <span class="hljs-keyword">if</span>(node.menuParentId == <span class="hljs-number">0</span>){
                parentNodes.add(node);<span class="hljs-comment">//为tree root （父级菜单）</span>
            }
        }
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span> ; i &lt; list.size() ; i ++){<!-- --><span class="hljs-comment">//查看菜单栏长度，循环数据</span>
            node = list.get(i);
            <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span> ; j &lt; parentNodes.size() ; j ++){<!-- --><span class="hljs-comment">//循环父节点数据</span>
                Menu temp = parentNodes.get(j);<span class="hljs-comment">//获取父节点</span>
                <span class="hljs-keyword">if</span>(node.getMenuParentId() == temp.getMenuid()){<!-- --><span class="hljs-comment">//如果子节点的父级ID 和 父级节点的ID相同，归属到对应的父级节点下</span>
                    temp.getMenus().add(node);<span class="hljs-comment">//父节点添加对应的子节点ID</span>
                }
            }
        }

        <span class="hljs-keyword">return</span> parentNodes;
    }

    <span class="hljs-keyword">public</span> Integer <span class="hljs-title">getMenuid</span>() {
        <span class="hljs-keyword">return</span> menuid;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setMenuid</span>(Integer menuid) {
        <span class="hljs-keyword">this</span>.menuid = menuid;
    }
    <span class="hljs-keyword">public</span> String <span class="hljs-title">getMenuname</span>() {
        <span class="hljs-keyword">return</span> menuname;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setMenuname</span>(String menuname) {
        <span class="hljs-keyword">this</span>.menuname = menuname;
    }
    <span class="hljs-keyword">public</span> Integer <span class="hljs-title">getMenuParentId</span>() {
        <span class="hljs-keyword">return</span> menuParentId;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setMenuParentId</span>(Integer menuParentId) {
        <span class="hljs-keyword">this</span>.menuParentId = menuParentId;
    }
    <span class="hljs-keyword">public</span> String <span class="hljs-title">getUrl</span>() {
        <span class="hljs-keyword">return</span> url;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUrl</span>(String url) {
        <span class="hljs-keyword">this</span>.url = url;
    }
    <span class="hljs-keyword">public</span> Integer <span class="hljs-title">getMenuSort</span>() {
        <span class="hljs-keyword">return</span> menuSort;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setMenuSort</span>(Integer menuSort) {
        <span class="hljs-keyword">this</span>.menuSort = menuSort;
    }
    <span class="hljs-keyword">public</span> String <span class="hljs-title">getIcon</span>() {
        <span class="hljs-keyword">return</span> icon;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setIcon</span>(String icon) {
        <span class="hljs-keyword">this</span>.icon = icon;
    }
    <span class="hljs-keyword">public</span> List&lt;Menu&gt; <span class="hljs-title">getMenus</span>() {
        <span class="hljs-keyword">return</span> menus;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setMenus</span>(List&lt;Menu&gt; menus) {
        <span class="hljs-keyword">this</span>.menus = menus;
    }
}
</code></pre> 
<p>UserAction</p> 
<pre class="prettyprint"><code class=" hljs java"><span class="hljs-javadoc">/**
     * 确认登录POST请求
     *<span class="hljs-javadoctag"> @return</span>
     */</span>
    <span class="hljs-annotation">@RequestMapping</span>(method ={RequestMethod.POST},value=<span class="hljs-string">"/comit"</span>) 
    <span class="hljs-keyword">public</span> String <span class="hljs-title">comit</span>(HttpServletResponse res,
             @<span class="hljs-title">RequestParam</span>(required=<span class="hljs-keyword">true</span>) String pass,
             <span class="hljs-annotation">@RequestParam</span>(required=<span class="hljs-keyword">true</span>) String user,
                        <span class="hljs-keyword">final</span> ModelMap model){
        Object obj=session.getAttribute(<span class="hljs-string">"loginUser"</span>);
        String message=<span class="hljs-string">""</span>;
        <span class="hljs-keyword">if</span>(obj==<span class="hljs-keyword">null</span>){
                logger.debug(<span class="hljs-string">"************ pass="</span>+pass+<span class="hljs-string">",  user="</span>+user);            
                <span class="hljs-annotation">@SuppressWarnings</span>(<span class="hljs-string">"rawtypes"</span>)
                Map map=ReqToMap.toMap(request);
                map.put(<span class="hljs-string">"loginName"</span>,user);
                map.put(<span class="hljs-string">"md5pass"</span>,MD5Crypter.encryptHEX(pass));
                SqlSession dao=getDao();
                Tbusers admin = dao.selectOne(<span class="hljs-string">"user.checkLogin"</span>, map);
                <span class="hljs-keyword">if</span>(admin==<span class="hljs-keyword">null</span>){
                    message=<span class="hljs-string">"账号或密码错误"</span>;
                    model.put(<span class="hljs-string">"login_text"</span>, message);
                    <span class="hljs-keyword">return</span> <span class="hljs-string">"/login/login"</span>;
                }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(admin.getUserState() == <span class="hljs-number">1</span>){
                    message=<span class="hljs-string">"此账号不可用"</span>;
                    model.put(<span class="hljs-string">"login_text"</span>, message);
                    <span class="hljs-keyword">return</span> <span class="hljs-string">"/login/login"</span>;
                }<span class="hljs-keyword">else</span>{
                    map.put(<span class="hljs-string">"loginCount"</span>, admin.getLoginCount()+<span class="hljs-number">1</span>);
                    map.put(<span class="hljs-string">"id"</span>, admin.getId());
                    dao.update(<span class="hljs-string">"user.updateLogin"</span>, map);
                    session.setAttribute(<span class="hljs-string">"loginUser"</span>,admin);

                    <span class="hljs-javadoc">/*** 查询有权限的菜单栏列表 ***/</span>
                    Map&lt;String, Object&gt; param = <span class="hljs-keyword">new</span> HashMap&lt;String, Object&gt;();
                    List&lt;TbmenuLink&gt; menuLinks = <span class="hljs-keyword">null</span>;
                    <span class="hljs-keyword">if</span>(admin.getUserType()==<span class="hljs-number">1</span>){
                        menuLinks = dao.selectList(<span class="hljs-string">"power.menuLinks"</span>,param);
                    }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(admin.getUserType()==<span class="hljs-number">0</span>){
                        String rolePower = getRolePowerList(dao,admin.getRoleId());
                        <span class="hljs-keyword">if</span>(!StringUtil.isEmpty(rolePower)){
                            param.put(<span class="hljs-string">"rolePower"</span>, rolePower);
                            menuLinks = dao.selectList(<span class="hljs-string">"power.menuLinks"</span>,param);<span class="hljs-comment">//获取所有菜单栏和菜单项，除按钮外</span>
                        }
                    }
                    List&lt;Menu&gt; menuTemp = <span class="hljs-keyword">new</span> ArrayList&lt;Menu&gt;();
                    <span class="hljs-keyword">if</span>(menuLinks != <span class="hljs-keyword">null</span>){
                        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span> ;i&lt;menuLinks.size();i++){
                            Menu menu = <span class="hljs-keyword">new</span> Menu();
                            menu.setMenuid(menuLinks.get(i).getMenuId());
                            menu.setMenuname(menuLinks.get(i).getMenuName());
                            menu.setMenuParentId(menuLinks.get(i).getParentId());
                            menu.setUrl(request.getContextPath()+menuLinks.get(i).getMenuUrl());
<span class="hljs-comment">//                          System.out.println(request.getContextPath());//项目根路径</span>
                            <span class="hljs-keyword">if</span>(menuLinks.get(i).getMenuNodeType()==<span class="hljs-number">0</span>){<!-- --><span class="hljs-comment">//父级菜单</span>
                                menu.setIcon(<span class="hljs-string">"icon-sys"</span>);
                            }<span class="hljs-keyword">else</span>{<!-- --><span class="hljs-comment">//二级菜单</span>
                                menu.setIcon(<span class="hljs-string">"icon-nav"</span>);
                            }
                            menuTemp.add(menu);
                        }
                    }
                    List&lt;Menu&gt; menus = Menu.formatTree(menuTemp);
                    session.setAttribute(<span class="hljs-string">"menus"</span>, JSONObject.toJSONString(menus));
                    <span class="hljs-keyword">return</span> <span class="hljs-string">"/login/main"</span>;
                }

        }<span class="hljs-keyword">else</span>{
            <span class="hljs-keyword">return</span> <span class="hljs-string">"/login/main"</span>;
        }
    }</code></pre> 
<p>前台页面展示</p> 
<pre class="prettyprint"><code class=" hljs cs">JS展示。。JsonMENU
<span class="hljs-keyword">var</span> json = ${sessionScope.menus};
<span class="hljs-keyword">var</span> _menus ={<!-- --><span class="hljs-string">"menus"</span>:json};

旧式原先数据展示：
<span class="hljs-keyword">var</span> _menus = {<!-- --><span class="hljs-string">"menus"</span>:[
                    {<!-- --><span class="hljs-string">"menuid"</span>:<span class="hljs-string">"1"</span>,<span class="hljs-string">"icon"</span>:<span class="hljs-string">"icon-sys"</span>,<span class="hljs-string">"menuname"</span>:<span class="hljs-string">"用户管理"</span>,
                        <span class="hljs-string">"menus"</span>:[
                            {<!-- --><span class="hljs-string">"menuid"</span>:<span class="hljs-string">"11"</span>,<span class="hljs-string">"menuname"</span>:<span class="hljs-string">"用户列表1"</span>,<span class="hljs-string">"icon"</span>:<span class="hljs-string">"icon-nav"</span>,    <span class="hljs-string">"url"</span>:<span class="hljs-string">"${pageContext.request.contextPath}/user/toUserList"</span>},
                        ]
                    }
            ]
};</code></pre> 
<p>以上可实现获取有权限的菜单项，后台权限角色分配就略过，直接上效果图 <br> <img src="https://images2.imgbox.com/1e/2b/jPckwzlw_o.png" alt="这里写图片描述" title=""></p> 
<p>权限分配好后，用权限用户登录，只能看到有权限的一栏菜单栏和对应的权限菜单项</p> 
<p><img src="https://images2.imgbox.com/3e/fc/zmjlc4IF_o.png" alt="这里写图片描述" title=""></p> 
<p>对于按钮，下面以shiro来讲解如何设置按钮权限</p> 
<p>页面展示的按钮由shiro权限标签控制</p> 
<p>在<strong>WEB-INF</strong>目录下建立文件夹tlds 建立自定义标签文件shiros.tld，我们通过自定义标签实现页面按钮的控制。</p> 
<pre class="prettyprint"><code class=" hljs xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">taglib</span> <span class="hljs-attribute">version</span>=<span class="hljs-value">"2.0"</span> <span class="hljs-attribute">xmlns</span>=<span class="hljs-value">"http://java.sun.com/xml/ns/j2ee"</span>
 <span class="hljs-attribute">xmlns:xsi</span>=<span class="hljs-value">"http://www.w3.org/2001/XMLSchema-instance"</span> 
 <span class="hljs-attribute">xsi:schemaLocation</span>=<span class="hljs-value">"http://java.sun.com/xml/ns/j2ee web-jsptaglibrary_2_0.xsd"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 描述 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">description</span>&gt;</span>p2p permission taglib<span class="hljs-tag">&lt;/<span class="hljs-title">description</span>&gt;</span>  
    <span class="hljs-tag">&lt;<span class="hljs-title">display-name</span>&gt;</span>permission taglib<span class="hljs-tag">&lt;/<span class="hljs-title">display-name</span>&gt;</span>  
    <span class="hljs-comment">&lt;!-- 版本号 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">tlib-version</span>&gt;</span>1.0<span class="hljs-tag">&lt;/<span class="hljs-title">tlib-version</span>&gt;</span>  
    <span class="hljs-comment">&lt;!-- 标签短名 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">short-name</span>&gt;</span>admin<span class="hljs-tag">&lt;/<span class="hljs-title">short-name</span>&gt;</span>  
    <span class="hljs-tag">&lt;<span class="hljs-title">uri</span>&gt;</span>http://servenboy.cn/<span class="hljs-tag">&lt;/<span class="hljs-title">uri</span>&gt;</span>  <span class="hljs-comment">&lt;!--不是必须--&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">tag</span>&gt;</span>  
        <span class="hljs-tag">&lt;<span class="hljs-title">description</span>&gt;</span>权限校验标签，有权限就显示标签体的内容，否则不显示<span class="hljs-tag">&lt;/<span class="hljs-title">description</span>&gt;</span>  <span class="hljs-comment">&lt;!-- 描述 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">name</span>&gt;</span>permission<span class="hljs-tag">&lt;/<span class="hljs-title">name</span>&gt;</span>  
        <span class="hljs-tag">&lt;<span class="hljs-title">tag-class</span>&gt;</span>com.softAngel.admin.beans.PermissionTag<span class="hljs-tag">&lt;/<span class="hljs-title">tag-class</span>&gt;</span>  
        <span class="hljs-tag">&lt;<span class="hljs-title">body-content</span>&gt;</span>JSP<span class="hljs-tag">&lt;/<span class="hljs-title">body-content</span>&gt;</span>   <span class="hljs-comment">&lt;!--这里如果设为empty,则无body--&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">attribute</span>&gt;</span>  
            <span class="hljs-tag">&lt;<span class="hljs-title">description</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">description</span>&gt;</span>  
            <span class="hljs-tag">&lt;<span class="hljs-title">name</span>&gt;</span>module<span class="hljs-tag">&lt;/<span class="hljs-title">name</span>&gt;</span> <span class="hljs-comment">&lt;!-- 属性名--&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">required</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-title">required</span>&gt;</span>  <span class="hljs-comment">&lt;!--标签的属性是否是必须的--&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">rtexprvalue</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-title">rtexprvalue</span>&gt;</span>  
        <span class="hljs-tag">&lt;/<span class="hljs-title">attribute</span>&gt;</span>  
        <span class="hljs-tag">&lt;<span class="hljs-title">attribute</span>&gt;</span>  
            <span class="hljs-tag">&lt;<span class="hljs-title">description</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">description</span>&gt;</span>  
            <span class="hljs-tag">&lt;<span class="hljs-title">name</span>&gt;</span>code<span class="hljs-tag">&lt;/<span class="hljs-title">name</span>&gt;</span>  
            <span class="hljs-tag">&lt;<span class="hljs-title">required</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-title">required</span>&gt;</span>  
            <span class="hljs-tag">&lt;<span class="hljs-title">rtexprvalue</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-title">rtexprvalue</span>&gt;</span>  
        <span class="hljs-tag">&lt;/<span class="hljs-title">attribute</span>&gt;</span>  
    <span class="hljs-tag">&lt;/<span class="hljs-title">tag</span>&gt;</span>  
<span class="hljs-tag">&lt;/<span class="hljs-title">taglib</span>&gt;</span>
</code></pre> 
<p>自定义标签类</p> 
<pre class="prettyprint"><code class=" hljs java"><span class="hljs-keyword">package</span> com.softAngel.admin.beans;

<span class="hljs-keyword">import</span> javax.servlet.http.HttpSession;
<span class="hljs-keyword">import</span> javax.servlet.jsp.JspException;
<span class="hljs-keyword">import</span> javax.servlet.jsp.tagext.TagSupport;

<span class="hljs-keyword">import</span> org.apache.ibatis.session.SqlSession;

<span class="hljs-keyword">import</span> com.softAngel.admin.db.StaticFactory;
<span class="hljs-keyword">import</span> com.softAngel.admin.web.action.user.UserAction;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PermissionTag</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">TagSupport</span>{<!-- --></span>

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span>  <span class="hljs-keyword">final</span> ThreadLocal&lt;SqlSession&gt; localDAO =<span class="hljs-keyword">new</span> ThreadLocal&lt;SqlSession&gt;();

    <span class="hljs-keyword">private</span> String module;

    <span class="hljs-keyword">private</span> String code;


    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">doStartTag</span>() <span class="hljs-keyword">throws</span> JspException {
        <span class="hljs-keyword">boolean</span> result = <span class="hljs-keyword">false</span>;
        HttpSession session = pageContext.getSession();
        <span class="hljs-comment">//CusPermission.getSessionUser()</span>
        Tbusers user = (Tbusers) session.getAttribute(<span class="hljs-string">"loginUser"</span>);
        <span class="hljs-keyword">if</span>(user!=<span class="hljs-keyword">null</span> ){
            <span class="hljs-keyword">if</span>(user.getLoginName().equals(<span class="hljs-string">"admin"</span>)){
                result = <span class="hljs-keyword">true</span>;
            }<span class="hljs-keyword">else</span>{
                String roleMenuLinkList = UserAction.getRolePowerList(getDao(), user.getRoleId());
                <span class="hljs-keyword">if</span>(roleMenuLinkList!=<span class="hljs-keyword">null</span>){
                    String LinkIds[] = roleMenuLinkList.split(<span class="hljs-string">","</span>);
                    <span class="hljs-keyword">for</span>(String temp : LinkIds){
                        <span class="hljs-keyword">if</span>(temp.equals(code)){
                            result = <span class="hljs-keyword">true</span>;
                            <span class="hljs-keyword">break</span>;
                        }
                    }
                }
            }
        }
        <span class="hljs-comment">//  真：返回EVAL_BODY_INCLUDE（执行标签）；假：返回SKIP_BODY（跳过标签不执行）</span>
        <span class="hljs-keyword">return</span> result ? EVAL_BODY_INCLUDE : SKIP_BODY;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title">getModule</span>() {
        <span class="hljs-keyword">return</span> module;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setModule</span>(String module) {
        <span class="hljs-keyword">this</span>.module = module;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title">getCode</span>() {
        <span class="hljs-keyword">return</span> code;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setCode</span>(String code) {
        <span class="hljs-keyword">this</span>.code = code;
    }

    <span class="hljs-keyword">protected</span> SqlSession <span class="hljs-title">getDao</span>(){
        SqlSession dao=localDAO.get();
        <span class="hljs-keyword">if</span>(dao==<span class="hljs-keyword">null</span>){  
            dao=StaticFactory.getSqlSession(<span class="hljs-keyword">true</span>);
            localDAO.set(dao);
        }
        <span class="hljs-keyword">return</span> dao;
    }
}

</code></pre> 
<p>在web.xml中配置权限类引用路径</p> 
<pre class="prettyprint"><code class=" hljs xml">    <span class="hljs-tag">&lt;<span class="hljs-title">jsp-config</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">taglib</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">taglib-uri</span>&gt;</span>/adminPower<span class="hljs-tag">&lt;/<span class="hljs-title">taglib-uri</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">taglib-location</span>&gt;</span>/WEB-INF/tlds/shiros.tld<span class="hljs-tag">&lt;/<span class="hljs-title">taglib-location</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">taglib</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">jsp-config</span>&gt;</span></code></pre> 
<p>页面头部直接引入</p> 
<pre class="prettyprint"><code class=" hljs mel">&lt;<span class="hljs-variable">%@</span> taglib uri=<span class="hljs-string">"/adminPower"</span> prefix=<span class="hljs-string">"pr"</span> <span class="hljs-variable">%&gt;</span></code></pre> 
<p>在页面需要展示的地方包裹标签&lt;.pr : permission code=”2”&gt;</p> 
<pre class="prettyprint"><code class=" hljs ocaml">&lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">"btnList"</span>&gt;
      &lt;pr:permission <span class="hljs-keyword">module</span>=<span class="hljs-string">"1"</span> code=<span class="hljs-string">"2"</span>&gt;&lt;input <span class="hljs-class"><span class="hljs-keyword">type</span>=</span><span class="hljs-string">"button"</span> <span class="hljs-keyword">value</span>=<span class="hljs-string">'测试1-1'</span>/&gt;&lt;/pr:permission&gt;
      &lt;pr:permission <span class="hljs-keyword">module</span>=<span class="hljs-string">"1"</span> code=<span class="hljs-string">"3"</span>&gt;&lt;input <span class="hljs-class"><span class="hljs-keyword">type</span>=</span><span class="hljs-string">"button"</span> <span class="hljs-keyword">value</span>=<span class="hljs-string">'测试1-2'</span>/&gt;&lt;/pr:permission&gt;
      &lt;pr:permission <span class="hljs-keyword">module</span>=<span class="hljs-string">"1"</span> code=<span class="hljs-string">"4"</span>&gt;&lt;input <span class="hljs-class"><span class="hljs-keyword">type</span>=</span><span class="hljs-string">"button"</span> <span class="hljs-keyword">value</span>=<span class="hljs-string">'测试1-3'</span>/&gt;&lt;/pr:permission&gt;        
&lt;/div&gt;</code></pre> 
<p>以上就是该权限管理中权限树（为角色分配权限）的大体实现。</p> 
<p>简单详解：&lt;.pr : permission module=”1” code=”2”&gt; 中的module 代表 资源ID为1的 角色管理菜单栏 (也就是所谓的父级) code代表资源ID 为2的 按钮（父级菜单下对应的子级菜单栏项或按钮），也可理解为权限资源里面同时含有 1,2这两个ID的权限，按钮-测试1-1 就会显示出来，否则为隐藏不可见</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a33d9fcb456cfd3f004910e0edd5c05e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">VS2015英文版代码对齐快捷键修改</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/89086f0ed3f4c9699a224ffbac07faae/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">JSONObject与JAVABEAN之间的转换</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>