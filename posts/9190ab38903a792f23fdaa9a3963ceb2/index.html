<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Mybatis数据库一对多查询 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Mybatis数据库一对多查询" />
<meta property="og:description" content="1，进行一对多查询，首先准备两个mysql数据表，查询读者与借书信息的关联关系
#创建readers表用来储存读者信息
CREATE TABLE `readers`( `id` INT PRIMARY KEY AUTO_INCREMENT, `name` VARCHAR(255) NOT NULL, `phone` DOUBLE(30,0) NOT NULL, `code` VARCHAR(50) NOT NULL ); #插入数据 INSERT INTO readers VALUES(1,&#39;admin&#39;,19872675353,&#39;AS0001&#39;); #创建lend_books表用来储存书籍信息
CREATE TABLE `lend_books`( `id` INT PRIMARY KEY AUTO_INCREMENT, `bksName` VARCHAR(255) NOT NULL, `price` DOUBLE(30,2) NOT NULL, `date` DATE NOT NULL, `bksCode` VARCHAR(50) NOT NULL, `lend_id` INT UNIQUE, FOREIGN KEY (lend_id) REFERENCES readers(id) ); #插入数据 INSERT INTO lend_books VALUES(NULL,&#39;《测试》&#39;,100.00,&#39;2023-3-24&#39;,2023843,NULL); 2，在IDEA创建maven项目并命名JavaEE
在项目src/main/java下创建com.three.pojo包" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/9190ab38903a792f23fdaa9a3963ceb2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-24T09:22:58+08:00" />
<meta property="article:modified_time" content="2023-03-24T09:22:58+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Mybatis数据库一对多查询</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="kdocs-document"> 
 <p style="text-align:left;"><span class="kdocs-color" style="color:#C21C13;">1，进行一对多查询，首先准备两个mysql数据表，查询读者与借书信息的关联关系</span></p> 
 <p style="text-align:left;"><span class="kdocs-color" style="color:#DA326B;">#创建readers表用来储存读者信息</span></p> 
 <pre class="kdocs-sql"><code class="language-sql">CREATE TABLE `readers`(
`id` INT PRIMARY KEY AUTO_INCREMENT,
`name` VARCHAR(255) NOT NULL,
`phone` DOUBLE(30,0) NOT NULL,
`code` VARCHAR(50) NOT NULL
);
#插入数据
INSERT INTO readers VALUES(1,'admin',19872675353,'AS0001');</code></pre> 
 <p style="text-align:left;"><span class="kdocs-color" style="color:#DA326B;">#创建lend_books表用来储存书籍信息</span></p> 
 <pre class="kdocs-sql"><code class="language-sql">CREATE TABLE `lend_books`(
`id` INT PRIMARY KEY AUTO_INCREMENT,
`bksName` VARCHAR(255) NOT NULL,
`price` DOUBLE(30,2) NOT NULL,
`date` DATE NOT NULL,
`bksCode` VARCHAR(50) NOT NULL,
`lend_id` INT UNIQUE,
FOREIGN KEY (lend_id) REFERENCES readers(id)
);
#插入数据
INSERT INTO lend_books VALUES(NULL,'《测试》',100.00,'2023-3-24',2023843,NULL);</code></pre> 
 <p style="text-align:left;"><span class="kdocs-color" style="color:#C21C13;">2，在IDEA创建maven项目并命名</span><span class="kdocs-color" style="color:#116AF0;">JavaEE</span></p> 
 <p style="text-align:left;">在项目src/main/java下创建com.three.pojo包</p> 
 <p style="text-align:left;"><span class="kdocs-color" style="color:#DA326B;">#在pojo包下创建</span><span class="kdocs-fontSize" style="font-size:9pt;"><span class="kdocs-color" style="color:#116AF0;">Readers</span></span><span class="kdocs-color" style="color:#DA326B;">类封装属性值及返回成员变量</span><span class="kdocs-fontSize" style="font-size:9pt;"><span class="kdocs-color" style="color:#DA326B;">：</span></span></p> 
 <pre class="kdocs-java"><code class="language-java">package com.three.pojo.reader;

import java.util.List;

public class Readers {
    private int id;
    private String name;
    private String phone;
    private String code;
    private List&lt;Lend_Books&gt; lend_booksList;

    public int getId() {
        return id;
    }

    public void setId(int id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public String getPhone() {
        return phone;
    }

    public void setPhone(String phone) {
        this.phone = phone;
    }

    public String getCode() {
        return code;
    }

    public void setCode(String code) {
        this.code = code;
    }

    public List&lt;Lend_Books&gt; getLend_booksList() {
        return lend_booksList;
    }

    public void setLend_booksList(List&lt;Lend_Books&gt; lend_booksList) {
        this.lend_booksList = lend_booksList;
    }

    @Override
    public String toString() {
        return "Readers{" +
                "id=" + id +
                ", name='" + name + '\'' +
                ", phone='" + phone + '\'' +
                ", code='" + code + '\'' +
                ", lend_booksList=" + lend_booksList +
                '}';
    }
}
</code></pre> 
 <p style="text-align:left;"><span class="kdocs-color" style="color:#DA326B;">#在pojo包下创建</span><span class="kdocs-fontSize" style="font-size:9pt;"><span class="kdocs-color" style="color:#116AF0;">Lend_Books</span></span><span class="kdocs-color" style="color:#DA326B;">类封装属性值及返回成员变量</span><span class="kdocs-fontSize" style="font-size:9pt;"><span class="kdocs-color" style="color:#DA326B;">：</span></span></p> 
 <pre class="kdocs-java"><code class="language-java">package com.three.pojo.reader;

import java.sql.Date;

public class Lend_Books {
    private int id;
    private String bksName;
    private Double price;
    private Date date;
    private String bksCode;

    public int getId() {
        return id;
    }

    public void setId(int id) {
        this.id = id;
    }

    public String getBksName() {
        return bksName;
    }

    public void setBksName(String bksName) {
        this.bksName = bksName;
    }

    public Double getPrice() {
        return price;
    }

    public void setPrice(Double price) {
        this.price = price;
    }

    public Date getDate() {
        return date;
    }

    public void setDate(Date date) {
        this.date = date;
    }

    public String getBksCode() {
        return bksCode;
    }

    public void setBksCode(String bksCode) {
        this.bksCode = bksCode;
    }

    @Override
    public String toString() {
        return "Lend_Books{" +
                "id=" + id +
                ", bksName='" + bksName + '\'' +
                ", price=" + price +
                ", date=" + date +
                ", bksCode='" + bksCode + '\'' +
                '}';
    }
}
</code></pre> 
 <p style="text-align:left;">在项目com.three下创建dao包并在当前位置创建接口类<span class="kdocs-fontSize" style="font-size:9pt;"><span class="kdocs-color" style="color:#116AF0;">InformationMapper</span></span></p> 
 <pre class="kdocs-java"><code class="language-java">package com.three.dao;

import com.three.pojo.person.PersonInformation;
import com.three.pojo.reader.Readers;

import java.util.List;

public interface InformationMapper {
    public List&lt;Readers&gt; selectOne_for_many(Integer id);

}
</code></pre> 
 <p style="text-align:left;">在com.three下创建包untils包存放工具类<span class="kdocs-fontSize" style="font-size:9pt;"><span class="kdocs-color" style="color:#116AF0;">Mybatis</span></span></p> 
 <pre class="kdocs-java"><code class="language-java">package com.three.utils;

import org.apache.ibatis.io.Resources;
import org.apache.ibatis.session.SqlSession;
import org.apache.ibatis.session.SqlSessionFactory;
import org.apache.ibatis.session.SqlSessionFactoryBuilder;

import java.io.IOException;
import java.io.Reader;

public class Mybatis {
    private static SqlSessionFactory sqlSessionFactory=null;
    static {
        try {
            Reader reader= Resources.getResourceAsReader("mybatis-config.xml");
            SqlSessionFactoryBuilder builder=new SqlSessionFactoryBuilder();
            sqlSessionFactory=builder.build(reader);
        } catch (IOException e) {
            throw new RuntimeException(e);
        }
    }
    public static SqlSession getSqlSession(){
        return sqlSessionFactory.openSession(true);
    }
}
</code></pre> 
 <p style="text-align:left;"><span class="kdocs-color" style="color:#DA326B;">#为了美观查询界面，为此准备了一个Swing窗口JFrame，JTable的</span><span class="kdocs-fontSize" style="font-size:9pt;"><span class="kdocs-color" style="color:#116AF0;">TableOne_for_many</span></span></p> 
 <pre class="kdocs-java"><code class="language-java">package com.three.utils;

import javax.swing.*;
import javax.swing.table.DefaultTableModel;
import java.awt.*;

public class TableOne_for_many extends JFrame {
    private static JLabel jLabel1,jLabel2;
    private static DefaultTableModel dTableModel1,dTableModel2;
    private static JTable table1,table2;
    private static JScrollPane jScrollPane1,jScrollPane2;
    private static JPanel jPanelA,jPanelB,jPanel1,jPanel2;
    private static Object[] columns1 = {"读者ID","读者姓名","电话","卡号"};
    private static Object[] columns2 = {"书籍ID", "书籍名称","借书价格", "借书日期", "书籍编号"};

    private static Object[][] data = null;

    {
        jScrollPane1=new JScrollPane();
        jPanel1=new JPanel();
        jPanel1.setBackground(Color.magenta);
        dTableModel1=new DefaultTableModel(data,columns1);
        dTableModel1.setRowCount(0);
        table1=new JTable(dTableModel1);
        table1.setBackground(Color.CYAN);
        jScrollPane1.setViewportView(table1);

        jScrollPane2=new JScrollPane();
        jPanel2=new JPanel();
        jPanel2.setBackground(Color.blue);
        dTableModel2=new DefaultTableModel(data,columns2);
        dTableModel2.setRowCount(0);
        table2=new JTable(dTableModel2);
        table2.setBackground(Color.yellow);
        jScrollPane2.setViewportView(table2);

        jPanel1.add(jScrollPane1);;
        jPanel2.add(jScrollPane2);

        this.setTitle("读者借书信息：(一对多查询)");
        this.setBounds(100,0,1000,500);
        this.setBackground(Color.PINK);
        this.setLayout(new FlowLayout(FlowLayout.CENTER));
        this.add(jPanel1);
        this.add(jPanel2);
        this.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        this.setVisible(true);
    }
    public DefaultTableModel addTable1(){
        return dTableModel1;
    }
    public DefaultTableModel addTable2(){
        return dTableModel2;
    }
}
</code></pre> 
 <p style="text-align:left;">在当前dao包下创建impl包并在此包下实现类<span class="kdocs-fontSize" style="font-size:9pt;"><span class="kdocs-color" style="color:#116AF0;">InformationMapperImpl</span></span></p> 
 <pre class="kdocs-java"><code class="language-java">package com.three.dao.impl;

import com.three.dao.InformationMapper;
import com.three.pojo.person.PersonInformation;
import com.three.pojo.reader.Readers;
import com.two.utils.Mybatis;
import org.apache.ibatis.session.SqlSession;

import java.util.List;

public class InformationMapperImpl implements InformationMapper {
    @Override
    public List&lt;Readers&gt; selectOne_for_many(Integer id) {
        SqlSession session=Mybatis.getSqlSession();
        return session.selectList("selectOne_for_many",id);
    }

}
</code></pre> 
 <p style="text-align:left;">在resource下创建文件夹mappers，并在文件夹下创建<span class="kdocs-fontSize" style="font-size:9pt;"><span class="kdocs-color" style="color:#116AF0;">InformationMapper.xml</span><span class="kdocs-color" style="color:#080F17;">编写SQL语句</span></span></p> 
 <pre class="kdocs-xml"><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" &gt;
&lt;!--namespace的值通常为接口的全限定名--&gt;
&lt;mapper namespace="com.three.dao.InformationMapper"&gt;
&lt;!--    一对多查询借阅者与借书信息。--&gt;
    &lt;select id="selectOne_for_many" parameterType="Integer" resultMap="lend_BooksInformation"&gt;
        select r.*,l.id as bkId,l.bksName,l.price,l.date,l.bksCode
        from readers r,lend_books l
        where r.id=l.lend_id
        and r.id=#{id}
    &lt;/select&gt;
    &lt;resultMap id="lend_BooksInformation" type="Readers"&gt;
        &lt;id property="id" column="id"/&gt;
        &lt;result property="name" column="name"/&gt;
        &lt;result property="phone" column="phone"/&gt;
        &lt;result property="code" column="code"/&gt;
        &lt;collection property="lend_booksList" ofType="Lend_Books"&gt;
            &lt;id property="id" column="bkId"/&gt;
            &lt;result property="bksName" column="bksName"/&gt;
            &lt;result property="price" column="price"/&gt;
            &lt;result property="date" column="date"/&gt;
            &lt;result property="bksCode" column="bksCode"/&gt;
        &lt;/collection&gt;
    &lt;/resultMap&gt;
&lt;/mapper&gt;</code></pre> 
 <p style="text-align:left;">在测试包下编写测试类<span class="kdocs-fontSize" style="font-size:9pt;"><span class="kdocs-color" style="color:#116AF0;">Three</span></span></p> 
 <pre class="kdocs-xml"><code class="language-xml">import com.three.dao.InformationMapper;
import com.three.dao.impl.InformationMapperImpl;
import com.three.pojo.person.Person;
import com.three.pojo.person.PersonInformation;
import com.three.pojo.reader.Lend_Books;
import com.three.pojo.reader.Readers;
import com.three.utils.TableOne_for_many;
import com.three.utils.TableOne_for_one;

import java.util.List;

public class Three {
    public static void main(String[] args) {
        Three three=new Three();
        three.one_for_many();
    }
    public void one_for_many(){
        InformationMapper informationMapper=new InformationMapperImpl();
        List&lt;Readers&gt; informations = informationMapper.selectOne_for_many(1);
        TableOne_for_many table=new TableOne_for_many();
        for (Readers readers:informations){
            String[] arr=new String[4];
            arr[0]= String.valueOf(readers.getId());
            arr[1]= readers.getName();
            arr[2]= readers.getPhone();
            arr[3]= readers.getCode();
            table.addTable1().addRow(arr);

            List&lt;Lend_Books&gt; lend_books=readers.getLend_booksList();
            for (Lend_Books lendBooks:lend_books) {
                String[] brr = new String[5];
                brr[0] = String.valueOf(lendBooks.getId());
                brr[1] = lendBooks.getBksName();
                brr[2] = String.valueOf(lendBooks.getPrice());
                brr[3] = String.valueOf(lendBooks.getDate());
                brr[4] = lendBooks.getBksCode();
                table.addTable2().addRow(brr);
            }
        }
        System.out.println(informations);
    }
}
</code></pre> 
 <p style="text-align:left;">测试结果如下</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:1500px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:50.0%;height:0;"> 
    <img src="https://images2.imgbox.com/81/11/zWtS9Dyf_o.png" style="margin-left:;display:block;width:1500px;margin-top:-50.0%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""></p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2854ba0d7a1531ffe475718589b22619/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">基于QT的TCP通信实现(TCPServer和TCPClient)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b655aa077bdb76815c5ea5e0ca3a7f94/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">如何解决：安装linux时报错Operating System not found 怎么办？</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>