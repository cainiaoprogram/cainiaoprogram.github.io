<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Qt/C&#43;&#43;视频监控Onvif工具/组播搜索/显示监控画面/图片参数调节/OSD管理/祖传原创 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Qt/C&#43;&#43;视频监控Onvif工具/组播搜索/显示监控画面/图片参数调节/OSD管理/祖传原创" />
<meta property="og:description" content="一、前言 能够写出简单易用而又不失功能强大的组件，一直是我的追求，简单主要体现在易用性，不能搞一些繁琐的流程和一些极难使用的API接口，或者一些看不懂的很难以理解的函数名称，一定是要越简单越好。功能强大主要体现在功能的完整性，常规的接口肯定是必备的，然后在默认值方面，尽量将值设置成最常用的合规的值，然后提供了接口可以修改这些值，以便兼容各种各样的需求场景。比如一些开关的值，如果90%的人希望默认是关闭的，而你搞个默认值开启，这就很纳闷了，大部分的用户每次都需要去主动修改后才能适用自己的场景。在做软件开发这些年，一直遵循这些原则和逻辑搞到今天，包括精心打磨很多年的各种组件，比如视频播放组件，Onvif组件等。
代码使用示例：
第一步：拷贝onvif组件源码到你的项目，放到同级目录。第二步：在项目pro文件中引入组件 include ($$PWD/…/core_onvif/core_onvif.pri)。第三步：代码文件引入头文件 #include “onvifsearch.h” #include “onvifdevice.h”，其中onvifsearch用于搜索设备，onvifdevice用于获取设备的详细信息比如rtsp视频流地址。第四步：组播或者单播搜索设备，获取到对应的onvif地址。每个设备都有一个唯一的onvif地址。 //实例化搜索对象并关联信号槽 OnvifSearch *search = new OnvifSearch(this); connect(search, SIGNAL(receiveDevice(OnvifDeviceInfo)), this, SLOT(receiveDevice(OnvifDeviceInfo))); //参数1是网卡地址/参数2指定地址则表示单播 search-&gt;search(&#34;192.168.0.110&#34;, &#34;&#34;); void frmSimple::receiveDevice(const OnvifDeviceInfo &amp;deviceInfo) { QString msg = QString(&#34;收到设备: %1&#34;).arg(deviceInfo.onvifAddr); ui-&gt;textEdit-&gt;append(msg); QListWidgetItem *item = new QListWidgetItem; item-&gt;setText(deviceInfo.deviceIp); item-&gt;setData(Qt::UserRole, deviceInfo.onvifAddr); ui-&gt;listWidget-&gt;addItem(item); } 第五步：对指定的onvif地址发送http请求，获取详细信息。 //实例化onvif对象实例 OnvifDevice *device = new OnvifDevice(this); //设置用户信息用于请求的时候认证用 device-&gt;setUserInfo(&#34;admin&#34;, &#34;123456&#34;); //设置请求地址 device-&gt;setOnvifAddr(&#34;http://192.168.0.64/onvif/device_service&#34;); //先获取服务文件 device-&gt;getServices(); //可能为空需要按照另一种方式获取 if (device-&gt;getMediaUrl().isEmpty()) { device-&gt;getCapabilities(); } //获取配置文件 QList&lt;OnvifProfileInfo&gt; profiles = device-&gt;getProfiles(); foreach (OnvifProfileInfo profile, profiles) { ui-&gt;cboxProfiles-&gt;addItem(profile." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/5c6f3351bc779e83cb1e8b8a23ee6c1b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-22T08:53:26+08:00" />
<meta property="article:modified_time" content="2023-12-22T08:53:26+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Qt/C&#43;&#43;视频监控Onvif工具/组播搜索/显示监控画面/图片参数调节/OSD管理/祖传原创</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_1"></a>一、前言</h3> 
<p>能够写出简单易用而又不失功能强大的组件，一直是我的追求，简单主要体现在易用性，不能搞一些繁琐的流程和一些极难使用的API接口，或者一些看不懂的很难以理解的函数名称，一定是要越简单越好。功能强大主要体现在功能的完整性，常规的接口肯定是必备的，然后在默认值方面，尽量将值设置成最常用的合规的值，然后提供了接口可以修改这些值，以便兼容各种各样的需求场景。比如一些开关的值，如果90%的人希望默认是关闭的，而你搞个默认值开启，这就很纳闷了，大部分的用户每次都需要去主动修改后才能适用自己的场景。在做软件开发这些年，一直遵循这些原则和逻辑搞到今天，包括精心打磨很多年的各种组件，比如视频播放组件，Onvif组件等。</p> 
<p>代码使用示例：</p> 
<ol><li>第一步：拷贝onvif组件源码到你的项目，放到同级目录。</li><li>第二步：在项目pro文件中引入组件 include ($$PWD/…/core_onvif/core_onvif.pri)。</li><li>第三步：代码文件引入头文件 #include “onvifsearch.h” #include “onvifdevice.h”，其中onvifsearch用于搜索设备，onvifdevice用于获取设备的详细信息比如rtsp视频流地址。</li><li>第四步：组播或者单播搜索设备，获取到对应的onvif地址。每个设备都有一个唯一的onvif地址。</li></ol> 
<pre><code class="prism language-cpp"><span class="token comment">//实例化搜索对象并关联信号槽</span>
OnvifSearch <span class="token operator">*</span>search <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">OnvifSearch</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">connect</span><span class="token punctuation">(</span>search<span class="token punctuation">,</span> <span class="token function">SIGNAL</span><span class="token punctuation">(</span><span class="token function">receiveDevice</span><span class="token punctuation">(</span>OnvifDeviceInfo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token function">SLOT</span><span class="token punctuation">(</span><span class="token function">receiveDevice</span><span class="token punctuation">(</span>OnvifDeviceInfo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//参数1是网卡地址/参数2指定地址则表示单播</span>
search<span class="token operator">-&gt;</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token string">"192.168.0.110"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> frmSimple<span class="token double-colon punctuation">::</span><span class="token function">receiveDevice</span><span class="token punctuation">(</span><span class="token keyword">const</span> OnvifDeviceInfo <span class="token operator">&amp;</span>deviceInfo<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    QString msg <span class="token operator">=</span> <span class="token function">QString</span><span class="token punctuation">(</span><span class="token string">"收到设备: %1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>deviceInfo<span class="token punctuation">.</span>onvifAddr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    ui<span class="token operator">-&gt;</span>textEdit<span class="token operator">-&gt;</span><span class="token function">append</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>

    QListWidgetItem <span class="token operator">*</span>item <span class="token operator">=</span> <span class="token keyword">new</span> QListWidgetItem<span class="token punctuation">;</span>
    item<span class="token operator">-&gt;</span><span class="token function">setText</span><span class="token punctuation">(</span>deviceInfo<span class="token punctuation">.</span>deviceIp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    item<span class="token operator">-&gt;</span><span class="token function">setData</span><span class="token punctuation">(</span>Qt<span class="token double-colon punctuation">::</span>UserRole<span class="token punctuation">,</span> deviceInfo<span class="token punctuation">.</span>onvifAddr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    ui<span class="token operator">-&gt;</span>listWidget<span class="token operator">-&gt;</span><span class="token function">addItem</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="5"><li>第五步：对指定的onvif地址发送http请求，获取详细信息。</li></ol> 
<pre><code class="prism language-cpp"><span class="token comment">//实例化onvif对象实例</span>
OnvifDevice <span class="token operator">*</span>device <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">OnvifDevice</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//设置用户信息用于请求的时候认证用</span>
device<span class="token operator">-&gt;</span><span class="token function">setUserInfo</span><span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">,</span> <span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//设置请求地址</span>
device<span class="token operator">-&gt;</span><span class="token function">setOnvifAddr</span><span class="token punctuation">(</span><span class="token string">"http://192.168.0.64/onvif/device_service"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//先获取服务文件</span>
device<span class="token operator">-&gt;</span><span class="token function">getServices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//可能为空需要按照另一种方式获取</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>device<span class="token operator">-&gt;</span><span class="token function">getMediaUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    device<span class="token operator">-&gt;</span><span class="token function">getCapabilities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//获取配置文件</span>
QList<span class="token operator">&lt;</span>OnvifProfileInfo<span class="token operator">&gt;</span> profiles <span class="token operator">=</span> device<span class="token operator">-&gt;</span><span class="token function">getProfiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">foreach</span> <span class="token punctuation">(</span>OnvifProfileInfo profile<span class="token punctuation">,</span> profiles<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    ui<span class="token operator">-&gt;</span>cboxProfiles<span class="token operator">-&gt;</span><span class="token function">addItem</span><span class="token punctuation">(</span>profile<span class="token punctuation">.</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//对指定的配置文件获取视频地址</span>
QString token <span class="token operator">=</span> ui<span class="token operator">-&gt;</span>cboxProfiles<span class="token operator">-&gt;</span><span class="token function">currentText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
QString url <span class="token operator">=</span> device<span class="token operator">-&gt;</span><span class="token function">getStreamUri</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
ui<span class="token operator">-&gt;</span>txtStreamUri<span class="token operator">-&gt;</span><span class="token function">setText</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="_56"></a>二、效果图</h3> 
<p><img src="https://images2.imgbox.com/03/8d/ATktdN5c_o.jpg" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/ad/59/mFjx9nuJ_o.jpg" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/d9/a1/HxSo4XEH_o.jpg" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/20/d1/q5eyD0qz_o.jpg" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/ac/23/6cPg8ztQ_o.jpg" alt="在这里插入图片描述"></p> 
<h3><a id="_64"></a>三、体验地址</h3> 
<ol><li>体验地址：<a href="https://pan.baidu.com/s/1d7TH_GEYl5nOecuNlWJJ7g" rel="nofollow">https://pan.baidu.com/s/1d7TH_GEYl5nOecuNlWJJ7g</a> 提取码：01jf 名称：bin_video_onvif</li><li>国内站点：<a href="https://gitee.com/feiyangqingyun" rel="nofollow">https://gitee.com/feiyangqingyun</a></li><li>国际站点：<a href="https://github.com/feiyangqingyun">https://github.com/feiyangqingyun</a></li><li>个人主页：<a href="https://blog.csdn.net/feiyangqingyun">https://blog.csdn.net/feiyangqingyun</a></li><li>视频主页：<a href="https://space.bilibili.com/687803542/" rel="nofollow">https://space.bilibili.com/687803542/</a></li></ol> 
<p></p> 
<div class="csdn-video-box"> 
 <iframe id="s8iLlNak-1703039476655" frameborder="0" src="https://live.csdn.net/v/embed/308178" allowfullscreen="true" data-mediaembed="csdn"></iframe> 
 <p>Qt/C++视频监控Onvif示例（搜索/云台/预置位等）</p> 
</div> 
<p></p> 
<p></p> 
<div class="csdn-video-box"> 
 <iframe id="Y4rxHjkd-1703039268251" frameborder="0" src="https://live.csdn.net/v/embed/353078" allowfullscreen="true" data-mediaembed="csdn"></iframe> 
 <p>Qt/C++监控Onvif组件安卓版/设备搜索/云台预置位</p> 
</div> 
<p></p> 
<h3><a id="_75"></a>四、功能特点</h3> 
<ol><li>广播搜索设备，支持IPC和NVR，依次返回。</li><li>可选择不同的网卡IP进行对应网段设备的搜索。</li><li>依次获取Onvif地址、Media地址、Profile文件、Rtsp地址。</li><li>可对指定的Profile获取视频流Rtsp地址，比如主码流地址、子码流地址。</li><li>可对每个设备设置Onvif用户信息，用于认证获取详细信息。</li><li>可实时预览摄像机图像。</li><li>支持云台控制，可上下左右调节云台，支持绝对移动、相对移动、连续移动三种方式，可对图像拉近拉远。</li><li>支持获取预置位集合、调用预置位、添加预置位、删除预置位等。</li><li>支持图片参数设置，包括亮度、对比度、饱和度、锐度等。</li><li>支持Qt4和Qt6任意Qt版本以及后续Qt版本，亲测Qt4.7到Qt6.5。</li><li>支持任意编译器，亲测mingw、msvc、gcc、clang。</li><li>支持任意操作系统，亲测xp、win7、win10、android、linux、嵌入式linux、树莓派全志H3等。</li><li>支持任意Onvif摄像机和NVR，亲测海康、大华、宇视、天地伟业、华为、海思芯片内核等，可定制开发。</li><li>支持对指定IP地址及onvif地址进行单播搜索，比如跨网段情况下非常有用。</li><li>支持指定过滤条件过滤搜索设备，比如只搜索某个网段的设备或者针对某个地址的设备。</li><li>支持搜索间隔和搜索策略设置，保证所有设备搜索回来，在大量设备现场很有用（亲测上千个摄像机现场，搜索回来的设备数量比摄像机厂家自带搜索工具还要准确）。</li><li>可对设备进行重启、网络参数获取等。</li><li>支持各种事件订阅（入侵报警、越界报警、遮挡报警等）、Onvif抓图等操作。</li><li>支持NTP校时和时间同步设置。</li><li>支持OSD相关操作，可以增删改查OSD信息。</li><li>内置了线程实时执行Onvif指令队列，排队最大速度的执行对应的指令，执行结果信号发出。</li><li>采用的最底层的TCP+UDP通信机制，原创最底层协议解析，纯QtWidget编写。</li><li>超级小巧轻量，总共约3000行代码，不依赖任何第三方的库和组件，跨平台。</li><li>封装好了通用的数据发送和接收解析的函数，可以非常方便的自行拓展其他Onvif处理。</li><li>工具上提供了收发数据文本框，显示收发的数据，方便查看和分析。</li><li>支持所有Onvif设备，代码工整，接口友好，直接引入pri即可使用。</li></ol>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2e827dd27b0135118d9e5282ec886a66/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Slurm随手记</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e20955b2b421438cd2a6effd52ee905d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">win10 安装tvm（aarch64进行推理）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>