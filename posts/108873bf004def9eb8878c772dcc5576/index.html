<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>51单片机--AT24C02数据存储 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="51单片机--AT24C02数据存储" />
<meta property="og:description" content="文章目录 存储器的介绍AT24C02I2C总线I2C时序结构AT24C02数据帧AT24C02数据存储实例 存储器的介绍 存储器是计算机系统中的一种重要设备，用于存储程序和数据，它可以通过电子、磁性介质等技术来记录和保持数据。在这里，主要介绍的是随机存储器（RAM）和只读存储器（ROM）。
随机存储器（Random Access Memory，RAM）是一种可以读取和写入数据的存储器。 它的特点是可以随机访问其中的任意位置，并且读写速度较快。RAM通常由电子芯片制成，用于临时存储计算机运行时所需的程序和数据。
RAM可以分为静态随机存储器（Static RAM，SRAM）和动态随机存储器（Dynamic RAM，DRAM）两种类型。
静态随机存储器（SRAM）：SRAM使用了触发器电路来存储数据，每个存储单元由多个触发器组成，具有较高的稳定性和快速的读写速度。由于使用了更多的电子元件，SRAM的密度较低，成本相对较高。它常用于高速缓存（Cache）等需要快速访问的场景。
动态随机存储器（DRAM）：DRAM使用了电容器和开关电路来存储数据，每个存储单元由一个电容器和一个访问开关组成。由于电容器的电荷会随时间衰减，DRAM需要周期性地进行刷新操作来保持数据的稳定。DRAM具有较高的存储密度和较低的成本，但相对而言读写速度较慢。它常用于主存储器（内存）等需要较大容量的场景。
只读存储器（Read-Only Memory，ROM）是一种只能读取数据而无法写入或修改数据的存储器。ROM中的数据在制造时被写入，通常用于存储固化的程序代码、系统设置、固件等不需要频繁修改的数据。ROM的数据在断电后依然可以保持，具有非易失性。
ROM根据存储数据的方式可以分为多种类型，如只读存储器（ROM）、可编程只读存储器（PROM）、可擦除可编程只读存储器（EPROM）和电可擦除可编程只读存储器（EEPROM）等。这些ROM的特点是在制造或编程后，其存储的数据无法修改或只能经过特定方式修改。对于我们这款单片机来说，AT24C02就是E2PROM，电可擦除可编程ROM，可以通过编程来进行存储数据，数据根据具体的地址存储；断电之后，他还会保存在地址中，当我们需要读取时，可以通过相对应的地址取出数据；
AT24C02 AT24C02是一种2K位（256字节）的串行EEPROM（Electrically Erasable Programmable Read-Only Memory），常用于51单片机系统中的数据存储。
AT24C02采用I2C总线协议进行通信，通过两根线路（SCL和SDA）与单片机进行连接。它具有8位的设备地址，可通过引脚A0、A1和A2进行编程设置，从而允许多个AT24C02共存在同一I2C总线上。
对于AT24C02，在读写速度上支持400kHz标准模式，数据保存能力可达10年之久，而且有写入保护，可以防止误操作；
在单片机系统中，可以使用AT24C02来存储各种数据，如配置参数、校准数据、历史记录等。单片机可以使用相应的I2C库函数来向AT24C02写入或读取数据，以实现对其存储空间的读写操作。
需要注意的是，AT24C02是一种非易失性存储器，即使在断电情况下也可以保持存储的数据。因此，它适用于需要长期保存数据的应用场景。
上图时AT24C02的内部结构框图，红色部分为它的存储位置；
I2C总线 I2C，全称为Inter-Integrated Circuit，是一种串行通信协议，用于在电子设备之间进行数字数据传输。它由飞利浦半导体（现在的NXP半导体）公司在1980年代开发，并于1982年发布。I2C采用了两根导线（一根用于传输数据，另一根用于传输时钟信号）来连接设备，这使得多个设备可以通过同一组导线进行通信。
I2C协议有两个重要的角色：主设备（Master）和从设备（Slave）。主设备负责控制通信的序列和时钟信号的生成，而从设备则被动响应主设备的指令。
I2C支持多主设备和多从设备的连接，每个设备都有一个唯一的地址标识。主设备可以向从设备发送数据或者接收从设备的数据。在传输数据时，数据被分为多个字节，每个字节都会被从设备确认。
在51单片机中，AT24C02通过I2C总线与单片机进行数据通信；
通过I2C总线，单片机可以发送读取或写入命令给AT24C02，然后AT24C02会响应相应的操作。例如，单片机可以向AT24C02发送写入命令，并指定要写入的地址和数据，AT24C02会将数据写入指定地址的存储单元。而当单片机需要读取AT24C02中的数据时，它可以向AT24C02发送读取命令和要读取的地址，然后AT24C02会返回相应的数据给单片机。
I2C时序结构 I2C总线的时序结构一般分为6部分：起始条件、终止条件、发送数据、接收数据、接收应答和发送应答；
起始条件：主设备通过SCL(串行时钟线)保持高电平的同时，将SDA(串行数据线)由高电平转换为低电平，表示要启动一次通信；
代码：
void I2C_Start() { I2C_SDA=1;//表示SCL高电平之前SDA就是高电平了 I2C_SCL=1;//SCL高电平期间 I2C_SDA=0;//SDA降为低电平 I2C_SCL=0;//SCL回到低电平 } 发送一个字节：SCL低电平期间，主设备将数据位依次放到SDA线上（高位在前），然后拉高SCL，在SCL上升沿时从设备将在SCL高电平期间读取数据位，所以SCL高电平期间SDA不允许有数据变化，依次循环上述过程8次，即可发送一个字节；
代码：
void I2C_SendByte(unsigned char byte) { unsigned char i; for(i=0;i&lt;8;i&#43;&#43;) { I2C_SDA=byte&amp;(0x80&gt;&gt;i);//先将数据放到SDA上 I2C_SCL=1; //SCL为上升沿时，从设备读取数据 I2C_SCL=0; } } 接收一个字节：SCL低电平期间，从设备将数据位依次放到SDA线上（高位在前），然后拉高SCL，主设备将在SCL上升沿期间读取数据位，所以SCL高电平期间SDA不允许有数据变化，依次循环上述过程8次，即可接收一个字节（主机在接收之前，需要释放SDA）
代码：
unsigned char I2C_ReceiveByte() { unsigned char i,byte=0x00; I2C_SDA=1; //释放SDA，规定置于高电平 for(i=0;i&lt;8;i&#43;&#43;) { //在SCL上升沿期间，主设备读取SDA的数据， I2C_SCL=1; if(I2C_SDA){byte|=(0x80&gt;&gt;i); //通过判断SDA位的数据是否为1，进行位赋值 //为1执行条件内容，将位变为1，为0则不变，仍为0； I2C_SCL=0; } return byte; } 发送应答：在接收完一个字节之后，主机在下一个时钟发送一位数据，数据0表示应答，数据1表示非应答 ；" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/108873bf004def9eb8878c772dcc5576/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-21T13:16:11+08:00" />
<meta property="article:modified_time" content="2023-07-21T13:16:11+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">51单片机--AT24C02数据存储</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_1" rel="nofollow">存储器的介绍</a></li><li><a href="#AT24C02_12" rel="nofollow">AT24C02</a></li><li><a href="#I2C_23" rel="nofollow">I2C总线</a></li><li><a href="#I2C_33" rel="nofollow">I2C时序结构</a></li><li><a href="#AT24C02_132" rel="nofollow">AT24C02数据帧</a></li><li><a href="#AT24C02_198" rel="nofollow">AT24C02数据存储实例</a></li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>存储器的介绍</h2> 
<p>存储器是计算机系统中的一种重要设备，用于存储程序和数据，它可以通过电子、磁性介质等技术来记录和保持数据。在这里，主要介绍的是随机存储器（RAM）和只读存储器（ROM）。<br> 随机存储器（Random Access Memory，RAM）是一种<strong>可以读取和写入数据的存储器</strong>。 它的特点是可以<mark>随机访问其中的任意位置，并且读写速度较快</mark>。RAM通常由电子芯片制成，用于临时存储计算机运行时所需的程序和数据。<br> RAM可以分为静态随机存储器（Static RAM，SRAM）和动态随机存储器（Dynamic RAM，DRAM）两种类型。<br> <strong>静态随机存储器（SRAM</strong>）：SRAM使用了触发器电路来存储数据，每个存储单元由多个触发器组成，<mark>具有较高的稳定性和快速的读写速度</mark>。由于使用了更多的电子元件，SRAM的密度较低，成本相对较高。它常用于高速缓存（Cache）等需要快速访问的场景。<br> <strong>动态随机存储器（DRAM</strong>）：DRAM使用了电容器和开关电路来存储数据，每个存储单元由一个电容器和一个访问开关组成。由于电容器的电荷会随时间衰减，DRAM需要周期性地进行刷新操作来保持数据的稳定。<mark>DRAM具有较高的存储密度和较低的成本，但相对而言读写速度较慢</mark>。它常用于主存储器（内存）等需要较大容量的场景。<br> <img src="https://images2.imgbox.com/80/0f/8v3PTIyA_o.png" alt="在这里插入图片描述"></p> 
<p>只读存储器（Read-Only Memory，ROM）是<strong>一种只能读取数据而无法写入或修改数据的存储器</strong>。ROM中的数据在制造时被写入，通常用于存储固化的程序代码、系统设置、固件等不需要频繁修改的数据。ROM的数据在断电后依然可以保持，具有<strong>非易失性</strong>。<br> ROM根据存储数据的方式可以分为多种类型，如只读存储器（ROM）、可编程只读存储器（PROM）、可擦除可编程只读存储器（EPROM）和电可擦除可编程只读存储器（EEPROM）等。这些ROM的特点是<strong>在制造或编程后，其存储的数据无法修改或只能经过特定方式修改</strong>。对于我们这款单片机来说，<mark>AT24C02就是E2PROM，电可擦除可编程ROM</mark>，可以通过编程来进行存储数据，<strong>数据根据具体的地址存储</strong>；断电之后，他还会保存在地址中，当我们需要读取时，可以通过相对应的地址取出数据；</p> 
<h2><a id="AT24C02_12"></a>AT24C02</h2> 
<p>AT24C02是一种2K位（256字节）的串行EEPROM（Electrically Erasable Programmable Read-Only Memory），<strong>常用于51单片机系统中的数据存储</strong>。<br> AT24C02<strong>采用I2C总线协议进行通信</strong>，通过<strong>两根线路（SCL和SDA）与单片机进行连接</strong>。它具有8位的设备地址，可通过引脚A0、A1和A2进行编程设置，从而允许多个AT24C02共存在同一I2C总线上。<br> <img src="https://images2.imgbox.com/5e/42/J612G5f4_o.png" alt="在这里插入图片描述"><br> 对于AT24C02，在读写速度上支持400kHz标准模式，数据保存能力可达10年之久，而且有写入保护，可以防止误操作；<br> 在单片机系统中，可以使用AT24C02来存储各种数据，如配置参数、校准数据、历史记录等。单片机可以使用相应的I2C库函数来向AT24C02写入或读取数据，以实现对其存储空间的读写操作。</p> 
<p>需要注意的是，<mark>AT24C02是一种非易失性存储器，即使在断电情况下也可以保持存储的数据</mark>。因此，它适用于需要长期保存数据的应用场景。<br> <img src="https://images2.imgbox.com/10/0b/4I00e0Fh_o.png" alt="在这里插入图片描述"><br> 上图时AT24C02的内部结构框图，红色部分为它的存储位置；</p> 
<h2><a id="I2C_23"></a>I2C总线</h2> 
<p>I2C，全称为Inter-Integrated Circuit，是一种<strong>串行通信协议</strong>，<strong>用于在电子设备之间进行数字数据传输</strong>。它由飞利浦半导体（现在的NXP半导体）公司在1980年代开发，并于1982年发布。<mark>I2C采用了两根导线（一根用于传输数据，另一根用于传输时钟信号）来连接设备，这使得多个设备可以通过同一组导线进行通信。</mark><br> I2C协议有两个重要的角色：<strong>主设备（Master）和从设备（Slave）</strong>。<mark>主设备负责控制通信的序列和时钟信号的生成，而从设备则被动响应主设备的指令。</mark></p> 
<p>I<strong>2C支持多主设备和多从设备的连接，每个设备都有一个唯一的地址标识</strong>。主设备可以向从设备发送数据或者接收从设备的数据。在传输数据时，数据被分为多个字节，每个字节都会被从设备确认。<br> <img src="https://images2.imgbox.com/5f/d6/Ic6areLX_o.png" alt="在这里插入图片描述"></p> 
<p>在51单片机中，<strong>AT24C02通过I2C总线与单片机进行数据通信</strong>；<br> 通过<strong>I2C总线，单片机可以发送读取或写入命令给AT24C02，然后AT24C02会响应相应的操作</strong>。例如，单片机可以向AT24C02发送写入命令，并指定要写入的地址和数据，AT24C02会将数据写入指定地址的存储单元。而当单片机需要读取AT24C02中的数据时，它可以向AT24C02发送读取命令和要读取的地址，然后AT24C02会返回相应的数据给单片机。</p> 
<h2><a id="I2C_33"></a>I2C时序结构</h2> 
<p>I2C总线的时序结构一般分为6部分：起始条件、终止条件、发送数据、接收数据、接收应答和发送应答；</p> 
<p><strong>起始条件</strong>：<mark>主设备通过SCL(串行时钟线)保持高电平的同时，将SDA(串行数据线)由高电平转换为低电平，表示要启动一次通信</mark>；<br> <img src="https://images2.imgbox.com/55/ea/5zlHAkIe_o.png" alt="在这里插入图片描述"><br> 代码：</p> 
<pre><code class="prism language-c"><span class="token keyword">void</span> <span class="token function">I2C_Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	I2C_SDA<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//表示SCL高电平之前SDA就是高电平了</span>
	I2C_SCL<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//SCL高电平期间</span>
	I2C_SDA<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//SDA降为低电平</span>
	I2C_SCL<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//SCL回到低电平</span>
	
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>发送一个字节</strong>：SCL低电平期间，主设备将数据位依次放到SDA线上（高位在前），然后拉高SCL，<mark>在SCL上升沿时从设备将在SCL高电平期间读取数据位</mark>，所以SCL高电平期间SDA不允许有数据变化，依次循环上述过程8次，即可发送一个字节；<br> <img src="https://images2.imgbox.com/87/91/9WBtIsAP_o.png" alt="在这里插入图片描述"><br> 代码：</p> 
<pre><code class="prism language-c"><span class="token keyword">void</span> <span class="token function">I2C_SendByte</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> byte<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> i<span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		I2C_SDA<span class="token operator">=</span>byte<span class="token operator">&amp;</span><span class="token punctuation">(</span><span class="token number">0x80</span><span class="token operator">&gt;&gt;</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//先将数据放到SDA上</span>
		I2C_SCL<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//SCL为上升沿时，从设备读取数据</span>
		I2C_SCL<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>接收一个字节</strong>：SCL低电平期间，从设备将数据位依次放到SDA线上（高位在前），然后拉高SCL，<mark>主设备将在SCL上升沿期间读取数据位</mark>，所以SCL高电平期间SDA不允许有数据变化，依次循环上述过程8次，即可接收一个字节（<strong>主机在接收之前，需要释放SDA</strong>）<br> <img src="https://images2.imgbox.com/01/88/NSjatSpM_o.png" alt="在这里插入图片描述"><br> 代码：</p> 
<pre><code class="prism language-c"><span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token function">I2C_ReceiveByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> i<span class="token punctuation">,</span>byte<span class="token operator">=</span><span class="token number">0x00</span><span class="token punctuation">;</span>
	I2C_SDA<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//释放SDA，规定置于高电平</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//在SCL上升沿期间，主设备读取SDA的数据，</span>
		I2C_SCL<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>I2C_SDA<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>byte<span class="token operator">|=</span><span class="token punctuation">(</span><span class="token number">0x80</span><span class="token operator">&gt;&gt;</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//通过判断SDA位的数据是否为1，进行位赋值</span>
		<span class="token comment">//为1执行条件内容，将位变为1，为0则不变，仍为0；</span>
		I2C_SCL<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">return</span> byte<span class="token punctuation">;</span>
	
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>发送应答</strong>：在接收完一个字节之后，主机在下一个时钟发送一位数据，数据0表示应答，数据1表示非应答 ；<br> <img src="https://images2.imgbox.com/60/92/FLZjoiCD_o.png" alt="在这里插入图片描述"><br> 代码：</p> 
<pre><code class="prism language-c"><span class="token keyword">void</span> <span class="token function">I2C_SendAck</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> AckBit<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	I2C_SDA<span class="token operator">=</span>AckBit<span class="token punctuation">;</span>
	<span class="token comment">//SDA发送应答，应答或者不应答</span>
	I2C_SCL<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token comment">//在SCL上升沿期间，从设备接收主设备发送应答</span>
	I2C_SCL<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>接收应答</strong>：在发送完一个字节之后，主机在下一个时钟接收一位数据，判断从机是否应答，数据0表示应答，数据1表示非应答（主机在接收之前，需要释放SDA）；<strong>主设备发送一个高电平的SDA并保持SCL线为高电平，使得从设备可以拉低SDA线来应答。如果接收方正确收到数据，它会发一个低电平的SDA信号应答</strong>；<br> <img src="https://images2.imgbox.com/c9/b2/BBnihX1N_o.png" alt="在这里插入图片描述"><br> 代码：</p> 
<pre><code class="prism language-c"><span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token function">I2C_ReceiveAck</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> AckBit<span class="token punctuation">;</span>
	I2C_SDA<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//释放SDA</span>
	I2C_SCL<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">//在SCL高电平期间</span>
	AckBit<span class="token operator">=</span>I2C_SDA<span class="token punctuation">;</span> <span class="token comment">//接收SDA的应答数据</span>
	I2C_SCL<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
	<span class="token keyword">return</span> AckBit<span class="token punctuation">;</span>
	
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/71/f1/mzlRcfnF_o.png" alt="在这里插入图片描述"></p> 
<p><strong>终止条件</strong>：将SCL线保持高电平的同时，将SDA线由低电平转换为高电平，表示通信结束；<br> <img src="https://images2.imgbox.com/b1/7b/TKp1Efec_o.png" alt="在这里插入图片描述"></p> 
<p>代码：</p> 
<pre><code class="prism language-c"><span class="token keyword">void</span> <span class="token function">I2C_Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	I2C_SDA<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">// 在SCL高电平之前SDA就为低电平</span>
	I2C_SCL<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//SCL处于高电平期间</span>
	I2C_SDA<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="AT24C02_132"></a>AT24C02数据帧</h2> 
<p><mark>数据帧是在通信中用于传输数据的基本单元</mark>。<br> 对于AT24C02，数据帧包括<strong>一个地址字节和一个或多个数据字节</strong>；</p> 
<p><img src="https://images2.imgbox.com/d0/b2/zZ5ORa4e_o.png" alt="在这里插入图片描述"><br> 上图为AT24C02数据帧的格式：</p> 
<blockquote> 
 <ol><li>起始位（Start Bit）：数据传输开始时，为低电平。</li><li>7位地址（Address）：表示要访问的内存地址。AT24C02共有256个地址，即0x00到0xFF。</li><li>R/W位（Read/Write Bit）：用于选择读（高电平）或写（低电平）操作。</li><li>数据字节（Data Byte）：在写操作中，数据字节表示要写入到指定地址的数据。在读操作中，数据字节表示从指定地址读取到的数据。</li><li>应答位（Acknowledge Bit）：用于发送方向接收方确认数据传输的成功。</li></ol> 
</blockquote> 
<p>而这些数据帧的格式是遵循I2C总线的通信协议的；所以我们只需要运用I2O的时序结构，将它们对应进AT24C02的数据帧即可；</p> 
<p>对于<strong>读操作</strong>，数据帧的格式如下：<br> 起始位 + 7位地址 + R/W位（设置为高电平）+ 应答位 + 存储的地址标识 + 应答位 + 数据字节 + 应答位 + 起始位 +读取数据+ 应答位 + 停止位</p> 
<p>对于<strong>写操作</strong>，数据帧的格式如下：<br> 起始位 + 7位地址 + R/W位（设置为低电平）+ 应答位 + 存储的地址标识 + 应答位 + 数据字节 + 应答位 + 停止位</p> 
<p>代码（利用到I2C总线时序写的代码）：</p> 
<p>写入字节：</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">AT24C02_ADDRESS</span> <span class="token expression"><span class="token number">0xA0</span> </span><span class="token comment">//AT24C02的写操作地址</span></span>
<span class="token keyword">void</span> <span class="token function">AT24C02_WriteByte</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> WordAddress<span class="token punctuation">,</span>Data<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	
	<span class="token function">I2C_Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//起始条件</span>
	<span class="token function">I2C_SendByte</span><span class="token punctuation">(</span>AT24C02_ADDRESS<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//主设备发送AT24C02的地址</span>
	<span class="token function">I2C_ReceiveAck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//从设备接收应答（确认地址）</span>
	<span class="token function">I2C_SendByte</span><span class="token punctuation">(</span>WordAddress<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 主设备向从设备发送地址</span>
	<span class="token function">I2C_ReceiveAck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//从设备接收应答</span>
	<span class="token function">I2C_SendByte</span><span class="token punctuation">(</span>Data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//主设备向从设备发送数据</span>
	<span class="token function">I2C_ReceiveAck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//从设备接收应答</span>
	<span class="token function">I2C_Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//终止条件</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>读取字节：</p> 
<pre><code class="prism language-c"><span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token function">AT24C02_ReadByte</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> WordAddress<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> Data<span class="token punctuation">;</span>
	<span class="token function">I2C_Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//起始条件</span>
	<span class="token function">I2C_SendByte</span><span class="token punctuation">(</span>AT24C02_ADDRESS<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//主设备发送AT24C02的地址</span>
	<span class="token function">I2C_ReceiveAck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//从设备接收应答（确认地址）</span>
	<span class="token function">I2C_SendByte</span><span class="token punctuation">(</span>WordAddress<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 主设备向从设备发送要读取字节的地址</span>
	<span class="token function">I2C_ReceiveAck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//从设备接收应答</span>
	<span class="token comment">//以上操作完成了主设备向从设备要读取字节的地址的操作，是主设备</span>
	<span class="token comment">//告诉从设备的地址</span>
	<span class="token comment">//下面操作是从设备向主设备发送对应的字节操作，主设备从写入变</span>
	<span class="token comment">//为读取，所以要重新开始定起始条件</span>
	<span class="token function">I2C_Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//起始条件</span>
	<span class="token function">I2C_SendByte</span><span class="token punctuation">(</span>AT24C02_ADDRESS<span class="token operator">|</span><span class="token number">0x01</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//主设备发送AT24C02的读取地址</span>
	<span class="token function">I2C_ReceiveAck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//从设备接收应答（确认地址</span>
	Data<span class="token operator">=</span><span class="token function">I2C_ReceiveByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//读取从设备对应地址的数据字节</span>
	<span class="token function">I2C_SendAck</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//主设备发送应答(地址对应正确发送回应给从设备）</span>
	<span class="token function">I2C_Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//终止条件</span>
	<span class="token keyword">return</span> Data<span class="token punctuation">;</span>
	
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="AT24C02_198"></a>AT24C02数据存储实例</h2> 
<p><strong>写一个能通过独立按键让数字逐渐增加或者减少的程序，并且让这个程序能记住某一个数字，断电或者置0的时候可以恢复到这个数字</strong>；<br> 代码：<br> Delay.h</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">__DELAY_H__</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">__DELAY_H__</span></span>
<span class="token comment">//获取一个毫秒为单位的延迟函数，填入对应数字表示延迟多少毫秒</span>
<span class="token keyword">void</span> <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> xms<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

</code></pre> 
<p>Delay.c</p> 
<pre><code class="prism language-c"><span class="token keyword">void</span> <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> xms<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> i<span class="token punctuation">,</span> j<span class="token punctuation">;</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span>xms<span class="token operator">--</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
		j <span class="token operator">=</span> <span class="token number">239</span><span class="token punctuation">;</span>
		<span class="token keyword">do</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">--</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">--</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>Key.h</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">__KEY_H__</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">__KEY_H__</span></span>

<span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token function">Key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

</code></pre> 
<p>Key.c</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;REGX52.H&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Delay.h"</span></span>

<span class="token comment">/**
  * @brief  获取独立按键键码
  * @param  无
  * @retval 按下按键的键码，范围：0~4，无按键按下时返回值为0
  */</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token function">Key</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> KeyNumber<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	
	<span class="token keyword">if</span><span class="token punctuation">(</span>P3_1<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">while</span><span class="token punctuation">(</span>P3_1<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>KeyNumber<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>P3_0<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">while</span><span class="token punctuation">(</span>P3_0<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>KeyNumber<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>P3_2<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">while</span><span class="token punctuation">(</span>P3_2<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>KeyNumber<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>P3_3<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">while</span><span class="token punctuation">(</span>P3_3<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>KeyNumber<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
	
	<span class="token keyword">return</span> KeyNumber<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>LCD1602.h</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">__LCD1602_H__</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">__LCD1602_H__</span></span>

<span class="token comment">//用户调用函数：</span>
<span class="token keyword">void</span> <span class="token function">LCD_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">LCD_ShowChar</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Line<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Column<span class="token punctuation">,</span><span class="token keyword">char</span> Char<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">LCD_ShowString</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Line<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Column<span class="token punctuation">,</span><span class="token keyword">char</span> <span class="token operator">*</span>String<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">LCD_ShowNum</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Line<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Column<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> Number<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">LCD_ShowSignedNum</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Line<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Column<span class="token punctuation">,</span><span class="token keyword">int</span> Number<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">LCD_ShowHexNum</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Line<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Column<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> Number<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">LCD_ShowBinNum</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Line<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Column<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> Number<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Length<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

</code></pre> 
<p>LCD1602.c</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;REGX52.H&gt;</span></span>

<span class="token comment">//引脚配置：</span>
sbit LCD_RS<span class="token operator">=</span>P2<span class="token operator">^</span><span class="token number">6</span><span class="token punctuation">;</span>
sbit LCD_RW<span class="token operator">=</span>P2<span class="token operator">^</span><span class="token number">5</span><span class="token punctuation">;</span>
sbit LCD_EN<span class="token operator">=</span>P2<span class="token operator">^</span><span class="token number">7</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LCD_DataPort</span> <span class="token expression">P0</span></span>

<span class="token comment">//函数定义：</span>
<span class="token comment">/**
  * @brief  LCD1602延时函数，12MHz调用可延时1ms
  * @param  无
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">LCD_Delay</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> i<span class="token punctuation">,</span> j<span class="token punctuation">;</span>

	i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
	j <span class="token operator">=</span> <span class="token number">239</span><span class="token punctuation">;</span>
	<span class="token keyword">do</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">--</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">--</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief  LCD1602写命令
  * @param  Command 要写入的命令
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">LCD_WriteCommand</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Command<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	LCD_RS<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	LCD_RW<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	LCD_DataPort<span class="token operator">=</span>Command<span class="token punctuation">;</span>
	LCD_EN<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token function">LCD_Delay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	LCD_EN<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token function">LCD_Delay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief  LCD1602写数据
  * @param  Data 要写入的数据
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">LCD_WriteData</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Data<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	LCD_RS<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
	LCD_RW<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	LCD_DataPort<span class="token operator">=</span>Data<span class="token punctuation">;</span>
	LCD_EN<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token function">LCD_Delay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	LCD_EN<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token function">LCD_Delay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief  LCD1602设置光标位置
  * @param  Line 行位置，范围：1~2
  * @param  Column 列位置，范围：1~16
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">LCD_SetCursor</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Line<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Column<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>Line<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">LCD_WriteCommand</span><span class="token punctuation">(</span><span class="token number">0x80</span><span class="token operator">|</span><span class="token punctuation">(</span>Column<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>Line<span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">LCD_WriteCommand</span><span class="token punctuation">(</span><span class="token number">0x80</span><span class="token operator">|</span><span class="token punctuation">(</span>Column<span class="token operator">-</span><span class="token number">1</span><span class="token operator">+</span><span class="token number">0x40</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief  LCD1602初始化函数
  * @param  无
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">LCD_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">LCD_WriteCommand</span><span class="token punctuation">(</span><span class="token number">0x38</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//八位数据接口，两行显示，5*7点阵</span>
	<span class="token function">LCD_WriteCommand</span><span class="token punctuation">(</span><span class="token number">0x0c</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//显示开，光标关，闪烁关</span>
	<span class="token function">LCD_WriteCommand</span><span class="token punctuation">(</span><span class="token number">0x06</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//数据读写操作后，光标自动加一，画面不动</span>
	<span class="token function">LCD_WriteCommand</span><span class="token punctuation">(</span><span class="token number">0x01</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//光标复位，清屏</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief  在LCD1602指定位置上显示一个字符
  * @param  Line 行位置，范围：1~2
  * @param  Column 列位置，范围：1~16
  * @param  Char 要显示的字符
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">LCD_ShowChar</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Line<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Column<span class="token punctuation">,</span><span class="token keyword">char</span> Char<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">LCD_SetCursor</span><span class="token punctuation">(</span>Line<span class="token punctuation">,</span>Column<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">LCD_WriteData</span><span class="token punctuation">(</span>Char<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief  在LCD1602指定位置开始显示所给字符串
  * @param  Line 起始行位置，范围：1~2
  * @param  Column 起始列位置，范围：1~16
  * @param  String 要显示的字符串
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">LCD_ShowString</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Line<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Column<span class="token punctuation">,</span><span class="token keyword">char</span> <span class="token operator">*</span>String<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> i<span class="token punctuation">;</span>
	<span class="token function">LCD_SetCursor</span><span class="token punctuation">(</span>Line<span class="token punctuation">,</span>Column<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>String<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">!=</span><span class="token char">'\0'</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">LCD_WriteData</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief  返回值=X的Y次方
  */</span>
<span class="token keyword">int</span> <span class="token function">LCD_Pow</span><span class="token punctuation">(</span><span class="token keyword">int</span> X<span class="token punctuation">,</span><span class="token keyword">int</span> Y<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> i<span class="token punctuation">;</span>
	<span class="token keyword">int</span> Result<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>Y<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		Result<span class="token operator">*=</span>X<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> Result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief  在LCD1602指定位置开始显示所给数字
  * @param  Line 起始行位置，范围：1~2
  * @param  Column 起始列位置，范围：1~16
  * @param  Number 要显示的数字，范围：0~65535
  * @param  Length 要显示数字的长度，范围：1~5
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">LCD_ShowNum</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Line<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Column<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> Number<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Length<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> i<span class="token punctuation">;</span>
	<span class="token function">LCD_SetCursor</span><span class="token punctuation">(</span>Line<span class="token punctuation">,</span>Column<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span>Length<span class="token punctuation">;</span>i<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">--</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">LCD_WriteData</span><span class="token punctuation">(</span>Number<span class="token operator">/</span><span class="token function">LCD_Pow</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">10</span><span class="token operator">+</span><span class="token char">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief  在LCD1602指定位置开始以有符号十进制显示所给数字
  * @param  Line 起始行位置，范围：1~2
  * @param  Column 起始列位置，范围：1~16
  * @param  Number 要显示的数字，范围：-32768~32767
  * @param  Length 要显示数字的长度，范围：1~5
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">LCD_ShowSignedNum</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Line<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Column<span class="token punctuation">,</span><span class="token keyword">int</span> Number<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Length<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> i<span class="token punctuation">;</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">int</span> Number1<span class="token punctuation">;</span>
	<span class="token function">LCD_SetCursor</span><span class="token punctuation">(</span>Line<span class="token punctuation">,</span>Column<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>Number<span class="token operator">&gt;=</span><span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">LCD_WriteData</span><span class="token punctuation">(</span><span class="token char">'+'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		Number1<span class="token operator">=</span>Number<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">LCD_WriteData</span><span class="token punctuation">(</span><span class="token char">'-'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		Number1<span class="token operator">=</span><span class="token operator">-</span>Number<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span>Length<span class="token punctuation">;</span>i<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">--</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">LCD_WriteData</span><span class="token punctuation">(</span>Number1<span class="token operator">/</span><span class="token function">LCD_Pow</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">10</span><span class="token operator">+</span><span class="token char">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief  在LCD1602指定位置开始以十六进制显示所给数字
  * @param  Line 起始行位置，范围：1~2
  * @param  Column 起始列位置，范围：1~16
  * @param  Number 要显示的数字，范围：0~0xFFFF
  * @param  Length 要显示数字的长度，范围：1~4
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">LCD_ShowHexNum</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Line<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Column<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> Number<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Length<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> i<span class="token punctuation">,</span>SingleNumber<span class="token punctuation">;</span>
	<span class="token function">LCD_SetCursor</span><span class="token punctuation">(</span>Line<span class="token punctuation">,</span>Column<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span>Length<span class="token punctuation">;</span>i<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">--</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		SingleNumber<span class="token operator">=</span>Number<span class="token operator">/</span><span class="token function">LCD_Pow</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">16</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>SingleNumber<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token function">LCD_WriteData</span><span class="token punctuation">(</span>SingleNumber<span class="token operator">+</span><span class="token char">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token function">LCD_WriteData</span><span class="token punctuation">(</span>SingleNumber<span class="token operator">-</span><span class="token number">10</span><span class="token operator">+</span><span class="token char">'A'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief  在LCD1602指定位置开始以二进制显示所给数字
  * @param  Line 起始行位置，范围：1~2
  * @param  Column 起始列位置，范围：1~16
  * @param  Number 要显示的数字，范围：0~1111 1111 1111 1111
  * @param  Length 要显示数字的长度，范围：1~16
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">LCD_ShowBinNum</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Line<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Column<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> Number<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Length<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> i<span class="token punctuation">;</span>
	<span class="token function">LCD_SetCursor</span><span class="token punctuation">(</span>Line<span class="token punctuation">,</span>Column<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span>Length<span class="token punctuation">;</span>i<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">--</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">LCD_WriteData</span><span class="token punctuation">(</span>Number<span class="token operator">/</span><span class="token function">LCD_Pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">2</span><span class="token operator">+</span><span class="token char">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>AT24C02.h</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">__KEY_H__</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">__KEY_H__</span></span>

<span class="token keyword">void</span> <span class="token function">AT24C02_WriteByte</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> WordAddress<span class="token punctuation">,</span>Data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token function">AT24C02_ReadByte</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> WordAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

</code></pre> 
<p>AT24C02.c</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;REGX52.H&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"I2C.h"</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">AT24C02_ADDRESS</span> <span class="token expression"><span class="token number">0xA0</span></span></span>
<span class="token keyword">void</span> <span class="token function">AT24C02_WriteByte</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> WordAddress<span class="token punctuation">,</span>Data<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	
	<span class="token function">I2C_Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">I2C_SendByte</span><span class="token punctuation">(</span>AT24C02_ADDRESS<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">I2C_ReceiveAck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">I2C_SendByte</span><span class="token punctuation">(</span>WordAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">I2C_ReceiveAck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">I2C_SendByte</span><span class="token punctuation">(</span>Data<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">I2C_ReceiveAck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">I2C_Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token function">AT24C02_ReadByte</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> WordAddress<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> Data<span class="token punctuation">;</span>
	<span class="token function">I2C_Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">I2C_SendByte</span><span class="token punctuation">(</span>AT24C02_ADDRESS<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">I2C_ReceiveAck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">I2C_SendByte</span><span class="token punctuation">(</span>WordAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">I2C_ReceiveAck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">I2C_Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">I2C_SendByte</span><span class="token punctuation">(</span>AT24C02_ADDRESS<span class="token operator">|</span><span class="token number">0x01</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">I2C_ReceiveAck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Data<span class="token operator">=</span><span class="token function">I2C_ReceiveByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">I2C_SendAck</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">I2C_Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> Data<span class="token punctuation">;</span>
	
<span class="token punctuation">}</span>
</code></pre> 
<p>I2C.h</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">__KEY_H__</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">__KEY_H__</span></span>

<span class="token keyword">void</span> <span class="token function">I2C_Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//¶ÔI2C³õÊ¼»¯</span>
<span class="token keyword">void</span> <span class="token function">I2C_Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//¶ÔI2CÄ©¶Ë</span>
<span class="token keyword">void</span> <span class="token function">I2C_SendByte</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> byte<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//I2CÖ÷»ú·¢ËÍÒ»¸ö×Ö½Ú</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token function">I2C_ReceiveByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//½ÓÊÕÒ»¸ö×Ö½Ú</span>
<span class="token keyword">void</span> <span class="token function">I2C_SendAck</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> AckBit<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//·¢ËÍÓ¦´ð</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token function">I2C_ReceiveAck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//½ÓÊÕÓ¦´ð</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre> 
<p>I2C.c</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;REGX52.H&gt;</span></span>


sbit I2C_SCL<span class="token operator">=</span>P2<span class="token operator">^</span><span class="token number">1</span><span class="token punctuation">;</span>
sbit I2C_SDA<span class="token operator">=</span>P2<span class="token operator">^</span><span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">I2C_Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	I2C_SDA<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
	I2C_SCL<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
	I2C_SDA<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	I2C_SCL<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">I2C_Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	I2C_SDA<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	I2C_SCL<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
	I2C_SDA<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">I2C_SendByte</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> byte<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> i<span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		I2C_SDA<span class="token operator">=</span>byte<span class="token operator">&amp;</span><span class="token punctuation">(</span><span class="token number">0x80</span><span class="token operator">&gt;&gt;</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
		I2C_SCL<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
		I2C_SCL<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token function">I2C_ReceiveByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> i<span class="token punctuation">,</span>byte<span class="token operator">=</span><span class="token number">0x00</span><span class="token punctuation">;</span>
	I2C_SDA<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		I2C_SCL<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>I2C_SDA<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>byte<span class="token operator">|=</span><span class="token punctuation">(</span><span class="token number">0x80</span><span class="token operator">&gt;&gt;</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
		I2C_SCL<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">return</span> byte<span class="token punctuation">;</span>
	
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">I2C_SendAck</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> AckBit<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	I2C_SDA<span class="token operator">=</span>AckBit<span class="token punctuation">;</span>
	I2C_SCL<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
	I2C_SCL<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	
<span class="token punctuation">}</span>

<span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token function">I2C_ReceiveAck</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> AckBit<span class="token punctuation">;</span>
	I2C_SDA<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
	I2C_SCL<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
	AckBit<span class="token operator">=</span>I2C_SDA<span class="token punctuation">;</span>
	I2C_SCL<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> AckBit<span class="token punctuation">;</span>
	
<span class="token punctuation">}</span>


</code></pre> 
<p>main.c</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;REGX52.H&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"AT24C02.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"I2C.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"LCD1602.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"Delay.h"</span></span>

<span class="token keyword">unsigned</span> <span class="token keyword">char</span> KeyNum<span class="token punctuation">;</span>
<span class="token keyword">unsigned</span> <span class="token keyword">short</span> Num<span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">LCD_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">LCD_ShowNum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>Num<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		KeyNum<span class="token operator">=</span><span class="token function">Key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>KeyNum<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment">//K1按键，Num自增</span>
		<span class="token punctuation">{<!-- --></span>
			Num<span class="token operator">++</span><span class="token punctuation">;</span>
			<span class="token function">LCD_ShowNum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>Num<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>KeyNum<span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">)</span>   <span class="token comment">//K2按键，Num自减</span>
		<span class="token punctuation">{<!-- --></span>
			Num<span class="token operator">--</span><span class="token punctuation">;</span>
			<span class="token function">LCD_ShowNum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>Num<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>KeyNum<span class="token operator">==</span><span class="token number">3</span><span class="token punctuation">)</span>  <span class="token comment">//K3按键，向AT24C02写入数据</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token function">AT24C02_WriteByte</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>Num<span class="token operator">%</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">AT24C02_WriteByte</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>Num<span class="token operator">/</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">LCD_ShowString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"Write OK"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">LCD_ShowString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"        "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>KeyNum<span class="token operator">==</span><span class="token number">4</span><span class="token punctuation">)</span>  <span class="token comment">//K4按键，从AT24C02读取数据</span>
		<span class="token punctuation">{<!-- --></span>
			Num<span class="token operator">=</span><span class="token function">AT24C02_ReadByte</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			Num<span class="token operator">|=</span><span class="token function">AT24C02_ReadByte</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>
			<span class="token function">LCD_ShowNum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>Num<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">LCD_ShowString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"Read OK "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">LCD_ShowString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"        "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p><strong>对于无符号的short类型数字，范围是0~65535，对应的有两个字节，所以写入数据要分别两部分，前8位和后8位，存储的地址可由自己选取，但在写入多个数据之间要延迟5ms，否则将会报错</strong>；</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5578c5974c26b10707b0b6319084fcce/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Java、maven、tomcat、idea的安装、配置以及各种常见错误</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1b31d8a6b2927228e981bf2f9f26d9bd/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【嵌入式工具】Keil自制格式化插件</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>