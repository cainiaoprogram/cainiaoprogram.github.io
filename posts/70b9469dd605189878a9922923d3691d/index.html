<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Proteus仿真STM32的课设实例3——汽车倒车测距提示仪 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Proteus仿真STM32的课设实例3——汽车倒车测距提示仪" />
<meta property="og:description" content="链接：https://pan.baidu.com/s/1qQ8AC6V8a4dp8aqpMWCa-A?pwd=e0yo 提取码：e0yo
以stm32为最小系统电路进行连接，按钮控制系统开关，使用SRF04采集倒车，LM016L液晶显示屏显示汽车距离障碍物的实时距离。当距离障碍物大于100cm时，小车自由倒退，蜂鸣器、LED提示灯关闭，车辆正常倒退；当距离障碍物大于50cm小于100cm时，蜂鸣器报警，LED灯关闭，车辆正常倒退；当距离障碍物大于30cm小于50cm时，蜂鸣器报警，LED灯闪烁提示，车辆正常倒退；当距离障碍物小于30cm时，蜂鸣器报警，LED灯关闭，小车停止。
链接：https://pan.baidu.com/s/1qQ8AC6V8a4dp8aqpMWCa-A?pwd=e0yo 提取码：e0yo
该系统主要由stm32f103r6作为单片机最小系统、SRF04超声波传感器、LM016L显示屏、L298驱动直流电机、电容、二极管、蜂鸣器、LED灯、按键等硬件组成。
tm32f103r6作为单片机最小系统进行其他部件的连接；按键控制倒车测距系统的开关；SRF04超声波传感器进行小车距障碍物的距离测量；LM016L液晶显示屏显示实时距离；L298驱动直流电机对小车提供动力，驱动小车倒车的动力；led灯和蜂鸣器对倒车距离情况进行反馈。
链接：https://pan.baidu.com/s/1qQ8AC6V8a4dp8aqpMWCa-A?pwd=e0yo 提取码：e0yo
部分源代码
#include &#34;delay.h&#34;
#define PRESCALER_US 1e6
#define PRESCALER_MS 1e3
void delay_ms(int32_t ms){
uint32_t temp,temp1; SysTick-&gt;LOAD=(uint32_t)ms*(SystemCoreClock/PRESCALER_MS); //时间加载(SysTick-&gt;LOAD为24bit)
SysTick-&gt;VAL =0x00; //清空计数器
SysTick-&gt;CTRL|=SysTick_CTRL_ENABLE_Msk ; //开始倒数 temp1=SysTick-&gt;VAL;
do
{
temp=SysTick-&gt;CTRL;
}while((temp&amp;0x01)&amp;&amp;!(temp&amp;(1&lt;&lt;16))); //等待时间到达 SysTick-&gt;CTRL&amp;=~SysTick_CTRL_ENABLE_Msk; //关闭计数器
SysTick-&gt;VAL =0X00; //清空计数器 }
void delay_us(uint32_t time) //3.5us&#43;1.5us*（time-1）
{ time=2*time;
while(time--); }
2.LCD液晶显示屏配置：
#include &#34;main.h&#34;
//使能1602液晶使用的引脚
void LCD1602_PORT_Init(void)
{
GPIO_InitTypeDef GPIO_InitStructure;
RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOx,ENABLE); //使能PC端口时钟 GPIO_InitStructure.GPIO_Pin = GPIOx_Pin; //端口配置 GPIO_InitStructure.GPIO_Mode = GPIO_Mode_Out_PP; //推挽输出" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/70b9469dd605189878a9922923d3691d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-18T22:16:53+08:00" />
<meta property="article:modified_time" content="2023-10-18T22:16:53+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Proteus仿真STM32的课设实例3——汽车倒车测距提示仪</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="margin-left:0;text-align:left;">链接：https://pan.baidu.com/s/1qQ8AC6V8a4dp8aqpMWCa-A?pwd=e0yo <br> 提取码：e0yo</p> 
<p style="margin-left:0;text-align:left;">以stm32为最小系统电路进行连接，按钮控制系统开关，使用SRF04采集倒车，LM016L液晶显示屏显示汽车距离障碍物的实时距离。当距离障碍物大于100cm时，小车自由倒退，蜂鸣器、LED提示灯关闭，车辆正常倒退；当距离障碍物大于50cm小于100cm时，蜂鸣器报警，LED灯关闭，车辆正常倒退；当距离障碍物大于30cm小于50cm时，蜂鸣器报警，LED灯闪烁提示，车辆正常倒退；当距离障碍物小于30cm时，蜂鸣器报警，LED灯关闭，小车停止。</p> 
<p style="margin-left:0;text-align:left;">链接：https://pan.baidu.com/s/1qQ8AC6V8a4dp8aqpMWCa-A?pwd=e0yo <br> 提取码：e0yo</p> 
<p style="margin-left:0;text-align:left;"><img alt="" height="666" src="https://images2.imgbox.com/99/df/qRrTfGoX_o.png" width="1200"></p> 
<p style="margin-left:0;text-align:justify;">该系统主要由stm32f103r6作为单片机最小系统、SRF04超声波传感器、LM016L显示屏、L298驱动直流电机、电容、二极管、蜂鸣器、LED灯、按键等硬件组成。</p> 
<p>tm32f103r6作为单片机最小系统进行其他部件的连接；按键控制倒车测距系统的开关；SRF04超声波传感器进行小车距障碍物的距离测量；LM016L液晶显示屏显示实时距离；L298驱动直流电机对小车提供动力，驱动小车倒车的动力；led灯和蜂鸣器对倒车距离情况进行反馈。</p> 
<p><img alt="" height="246" src="https://images2.imgbox.com/a3/d3/2GR3wpqx_o.png" width="534"></p> 
<p>链接：https://pan.baidu.com/s/1qQ8AC6V8a4dp8aqpMWCa-A?pwd=e0yo <br> 提取码：e0yo</p> 
<p><img alt="" height="565" src="https://images2.imgbox.com/51/ec/LwQgWfGP_o.png" width="1200"></p> 
<p></p> 
<p>部分源代码</p> 
<p style="margin-left:0;text-align:left;"><span style="color:#0000ff;">#include</span> <span style="color:#a31515;">"delay.h"</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#0000ff;">#define</span> PRESCALER_US  1e6</p> 
<p style="margin-left:0;text-align:left;"><span style="color:#0000ff;">#define</span> PRESCALER_MS  1e3</p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#0000ff;">void</span> delay_ms(int32_t ms){<!-- --></p> 
<p style="margin-left:0;text-align:left;">        uint32_t temp,temp1;        </p> 
<p style="margin-left:0;text-align:left;">    SysTick-&gt;LOAD=(uint32_t)ms*(SystemCoreClock/PRESCALER_MS);                <span style="color:#008000;">//</span><span style="color:#008000;">时间加载(SysTick-&gt;LOAD为24bit)</span></p> 
<p style="margin-left:0;text-align:left;">    SysTick-&gt;VAL =0x00;                            <span style="color:#008000;">//</span><span style="color:#008000;">清空计数器</span></p> 
<p style="margin-left:0;text-align:left;">    SysTick-&gt;CTRL|=SysTick_CTRL_ENABLE_Msk ;    <span style="color:#008000;">//</span><span style="color:#008000;">开始倒数  </span></p> 
<p style="margin-left:0;text-align:left;">    temp1=SysTick-&gt;VAL;</p> 
<p style="margin-left:0;text-align:left;">    <span style="color:#0000ff;">do</span></p> 
<p style="margin-left:0;text-align:left;">    {<!-- --></p> 
<p style="margin-left:0;text-align:left;">        temp=SysTick-&gt;CTRL;</p> 
<p style="margin-left:0;text-align:left;">    }<span style="color:#0000ff;">while</span>((temp&amp;0x01)&amp;&amp;!(temp&amp;(1&lt;&lt;16)));       <span style="color:#008000;">//</span><span style="color:#008000;">等待时间到达   </span></p> 
<p style="margin-left:0;text-align:left;">    SysTick-&gt;CTRL&amp;=~SysTick_CTRL_ENABLE_Msk;    <span style="color:#008000;">//</span><span style="color:#008000;">关闭计数器</span></p> 
<p style="margin-left:0;text-align:left;">    SysTick-&gt;VAL =0X00;                        <span style="color:#008000;">//</span><span style="color:#008000;">清空计数器   </span></p> 
<p style="margin-left:0;text-align:left;">}</p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#0000ff;">void</span> delay_us(uint32_t time) <span style="color:#008000;">//3.5us+1.5us*</span><span style="color:#008000;">（time-1）</span></p> 
<p style="margin-left:0;text-align:left;">{    </p> 
<p style="margin-left:0;text-align:left;">    time=2*time;</p> 
<p style="margin-left:0;text-align:left;">    <span style="color:#0000ff;">while</span>(time--); </p> 
<p style="margin-left:0;text-align:left;">}</p> 
<p style="margin-left:0;text-align:left;"><strong>2.LCD</strong><strong>液晶显示屏配置：</strong></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#0000ff;">#include</span> <span style="color:#a31515;">"main.h"</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">//</span><span style="color:#008000;">使能1602液晶使用的引脚</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#0000ff;">void</span> LCD1602_PORT_Init(<span style="color:#0000ff;">void</span>)</p> 
<p style="margin-left:0;text-align:left;">{<!-- --></p> 
<p style="margin-left:0;text-align:left;">    GPIO_InitTypeDef  GPIO_InitStructure;</p> 
<p style="margin-left:0;text-align:left;">    RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOx,ENABLE); <span style="color:#008000;">//</span><span style="color:#008000;">使能PC端口时钟   </span></p> 
<p style="margin-left:0;text-align:left;">    GPIO_InitStructure.GPIO_Pin = GPIOx_Pin;                               <span style="color:#008000;">//</span><span style="color:#008000;">端口配置 </span></p> 
<p style="margin-left:0;text-align:left;">    GPIO_InitStructure.GPIO_Mode = GPIO_Mode_Out_PP;            <span style="color:#008000;">//</span><span style="color:#008000;">推挽输出</span></p> 
<p style="margin-left:0;text-align:left;">  GPIO_InitStructure.GPIO_Speed = GPIO_Speed_10MHz;               <span style="color:#008000;">//IO</span><span style="color:#008000;">口速度为10MHz</span></p> 
<p style="margin-left:0;text-align:left;">  GPIO_Init(GPIOx, &amp;GPIO_InitStructure);                             <span style="color:#008000;">//</span><span style="color:#008000;">根据设定参数初始化</span></p> 
<p style="margin-left:0;text-align:left;">}</p> 
<p style="margin-left:0;text-align:left;"><span style="color:#0000ff;">void</span> delay_nus(uint16_t n)</p> 
<p style="margin-left:0;text-align:left;">{<!-- --></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;">    delay_nms(5);</p> 
<p style="margin-left:0;text-align:left;">    LCD_cmd(0x38);<span style="color:#008000;">//16*2</span><span style="color:#008000;">显示,5*7点阵,8数据</span></p> 
<p style="margin-left:0;text-align:left;">    delay_nms(1);</p> 
<p style="margin-left:0;text-align:left;">    LCD_cmd(0x38);<span style="color:#008000;">//16*2</span><span style="color:#008000;">显示,5*7点阵,8数据</span></p> 
<p style="margin-left:0;text-align:left;">    delay_nms(1);</p> 
<p style="margin-left:0;text-align:left;">    LCD_cmd(0x38);<span style="color:#008000;">//16*2</span><span style="color:#008000;">显示,5*7点阵,8数据</span></p> 
<p style="margin-left:0;text-align:left;">    delay_nms(1);</p> 
<p style="margin-left:0;text-align:left;">    LCD_cmd(0x08);<span style="color:#008000;">//</span><span style="color:#008000;">先关显示，后开显示</span></p> 
<p style="margin-left:0;text-align:left;">    delay_nms(1);</p> 
<p style="margin-left:0;text-align:left;">    LCD_cmd(0x01);<span style="color:#008000;">//</span><span style="color:#008000;">清屏</span></p> 
<p style="margin-left:0;text-align:left;">    delay_nms(1);</p> 
<p style="margin-left:0;text-align:left;">    LCD_cmd(0x06);<span style="color:#008000;">//</span><span style="color:#008000;">写命令，注意</span></p> 
<p style="margin-left:0;text-align:left;">    delay_nms(1);  </p> 
<p style="margin-left:0;text-align:left;">    LCD_cmd(0x0c);<span style="color:#008000;">//</span><span style="color:#008000;">显示开，关光标</span></p> 
<p style="margin-left:0;text-align:left;">    delay_nms(1);</p> 
<p style="margin-left:0;text-align:left;">}</p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">//</span><span style="color:#008000;">清屏</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#0000ff;">void</span> LCD_clr(<span style="color:#0000ff;">void</span>) </p> 
<p style="margin-left:0;text-align:left;">{<!-- --></p> 
<p style="margin-left:0;text-align:left;">    LCD_cmd(0x01);</p> 
<p style="margin-left:0;text-align:left;">}</p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">//</span><span style="color:#008000;">写命令</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#0000ff;">void</span> LCD_cmd(uint16_t cmd)</p> 
<p style="margin-left:0;text-align:left;">{  </p> 
<p style="margin-left:0;text-align:left;">    <span style="color:#008000;">//LCD1602_WaitReady();</span></p> 
<p style="margin-left:0;text-align:left;">        delay_nms(1);</p> 
<p style="margin-left:0;text-align:left;">        LCD_RS_0;       </p> 
<p style="margin-left:0;text-align:left;">        delay_nus(1);  </p> 
<p style="margin-left:0;text-align:left;">        LCD_RW_0;    </p> 
<p style="margin-left:0;text-align:left;">        delay_nus(1);  </p> 
<p style="margin-left:0;text-align:left;">        LCD_EN_0;     </p> 
<p style="margin-left:0;text-align:left;">        delay_nus(1);</p> 
<p style="margin-left:0;text-align:left;">        GPIO_SetBits(LCDPORT, LCD_DATA_PORT &amp; cmd);</p> 
<p style="margin-left:0;text-align:left;">        GPIO_ResetBits(LCDPORT, LCD_DATA_PORT &amp;(~cmd));</p> 
<p style="margin-left:0;text-align:left;">        LCD_EN_1;</p> 
<p style="margin-left:0;text-align:left;">        delay_nus(1);   </p> 
<p style="margin-left:0;text-align:left;">        LCD_EN_0;    </p> 
<p style="margin-left:0;text-align:left;">}</p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">//</span><span style="color:#008000;">写数据</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#0000ff;">void</span> LCD_dat(uint8_t dat)</p> 
<p style="margin-left:0;text-align:left;">{<!-- --></p> 
<p style="margin-left:0;text-align:left;">    LCD_RS_1;</p> 
<p style="margin-left:0;text-align:left;">    delay_nus(1);          </p> 
<p style="margin-left:0;text-align:left;">    LCD_RW_0;                </p> 
<p style="margin-left:0;text-align:left;">    delay_nus(1);</p> 
<p style="margin-left:0;text-align:left;">    LCD_EN_0;                 </p> 
<p style="margin-left:0;text-align:left;">    delay_nus(1);</p> 
<p style="margin-left:0;text-align:left;">        GPIO_SetBits(LCDPORT, LCD_DATA_PORT &amp; dat);</p> 
<p style="margin-left:0;text-align:left;">        GPIO_ResetBits(LCDPORT, LCD_DATA_PORT &amp;(~dat));</p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;">    LCD_dat(c);</p> 
<p style="margin-left:0;text-align:left;">}</p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#0000ff;">void</span> LCD_prints(uint16_t x,uint16_t y,uint8_t *s)<span style="color:#008000;">//</span><span style="color:#008000;">显示字符串，不需要修改</span></p> 
<p style="margin-left:0;text-align:left;">{<!-- --></p> 
<p style="margin-left:0;text-align:left;">    LCD_pos(x,y);</p> 
<p style="margin-left:0;text-align:left;">    <span style="color:#0000ff;">while</span>(*s!=<span style="color:#a31515;">'\0'</span>)</p> 
<p style="margin-left:0;text-align:left;">    {<!-- --></p> 
<p style="margin-left:0;text-align:left;">        LCD_dat(*s);</p> 
<p style="margin-left:0;text-align:left;">        s++;</p> 
<p style="margin-left:0;text-align:left;">        <span style="color:#008000;">//delay_nms(1);</span></p> 
<p style="margin-left:0;text-align:left;">    }</p> 
<p style="margin-left:0;text-align:left;">}</p> 
<p style="margin-left:0;text-align:left;"><strong>3.</strong><strong>主函数函数的配置（其包含超声波的使用、LCD的使用、中断的使用、按键的开关、电机的运行、蜂鸣器的开关等）：</strong></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#0000ff;">#include</span> <span style="color:#a31515;">"main.h"</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">/****</span><span style="color:#008000;">全局变量******************************************/</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">uint8_t dis0[</span><span style="color:#2e74b5;">20</span><span style="color:#000000;">];</span><span style="color:#008000;">//</span><span style="color:#008000;">液晶显示数组</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#0000ff;">float</span><span style="color:#000000;"> JuLi[</span><span style="color:#2e74b5;">4</span><span style="color:#000000;">];            </span><span style="color:#008000;">//</span><span style="color:#008000;">距离0正常前进时候的距离  </span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">uchar start_stop_bit=0;</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">/**********</span><span style="color:#008000;">函数申明****************************************/</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#0000ff;">void</span><span style="color:#000000;"> Tim1_Init(</span><span style="color:#0000ff;">void</span><span style="color:#000000;">);</span><span style="color:#008000;">//</span><span style="color:#008000;">定时器1初始化  计算超声波距离</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#0000ff;">void</span><span style="color:#000000;"> TIM1_UP_IRQHandler(</span><span style="color:#0000ff;">void</span><span style="color:#000000;">) ; </span><span style="color:#008000;"> //TIM1</span><span style="color:#008000;">中断</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#0000ff;">void</span><span style="color:#000000;"> Tim2_Init(</span><span style="color:#0000ff;">void</span><span style="color:#000000;">);</span><span style="color:#008000;">//</span><span style="color:#008000;">定时器2初始化，0.5更新中断</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#0000ff;">void</span><span style="color:#000000;"> TIM2_IRQHandler(</span><span style="color:#0000ff;">void</span><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#0000ff;">void</span><span style="color:#000000;"> GPIO_MOTOR_INIT(</span><span style="color:#0000ff;">void</span><span style="color:#000000;">);</span><span style="color:#008000;">//</span><span style="color:#008000;">电机引脚初始化</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#0000ff;">void</span><span style="color:#000000;"> GPIO_SRF04_INIT(</span><span style="color:#0000ff;">void</span><span style="color:#000000;">);</span><span style="color:#008000;">//</span><span style="color:#008000;">超声波引脚初始化</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#0000ff;">void</span><span style="color:#000000;"> SRF04(</span><span style="color:#0000ff;">unsigned char</span><span style="color:#000000;"> ch); </span><span style="color:#008000;"> //</span><span style="color:#008000;">超声波测量函数</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#0000ff;">void</span><span style="color:#000000;"> GPIO_SRF04_INIT(</span><span style="color:#0000ff;">void</span><span style="color:#000000;">);</span><span style="color:#008000;">// </span><span style="color:#008000;">超声波引脚初始化</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#0000ff;">void</span><span style="color:#000000;"> car_f(</span><span style="color:#0000ff;">void</span><span style="color:#000000;">); </span><span style="color:#008000;">//</span><span style="color:#008000;">前进</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#0000ff;">void</span><span style="color:#000000;"> car_b(</span><span style="color:#0000ff;">void</span><span style="color:#000000;">); </span><span style="color:#008000;">//</span><span style="color:#008000;">后退</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#0000ff;">void</span><span style="color:#000000;"> car_s(</span><span style="color:#0000ff;">void</span><span style="color:#000000;">); </span><span style="color:#008000;">//</span><span style="color:#008000;">停止</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#0000ff;">void</span><span style="color:#000000;"> car_bizhang(</span><span style="color:#0000ff;">void</span><span style="color:#000000;">); </span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#0000ff;">void</span><span style="color:#000000;"> GPIO_KEY_INIT(</span><span style="color:#0000ff;">void</span><span style="color:#000000;">);</span><span style="color:#008000;">//</span><span style="color:#008000;">按键引脚初始化</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">/*****************************************</span></p> 
<p style="margin-left:0;text-align:left;">    <span style="color:#008000;">Main</span><span style="color:#008000;">函数</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">*****************************************/</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#0000ff;">int</span><span style="color:#000000;"> main(</span><span style="color:#0000ff;">void</span><span style="color:#000000;">){<!-- --></span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    NVIC_PriorityGroupConfig(NVIC_PriorityGroup_2);</span><span style="color:#008000;">//</span><span style="color:#008000;">中断向量分组2</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">    //io</span><span style="color:#008000;">初始化</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    GPIO_MOTOR_INIT();</span><span style="color:#008000;">//</span><span style="color:#008000;">电机引脚，led，蜂鸣器初始化</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    GPIO_SRF04_INIT();</span><span style="color:#008000;">//</span><span style="color:#008000;">超声波引脚</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    GPIO_KEY_INIT();</span><span style="color:#008000;">//</span><span style="color:#008000;">按键引脚</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">    //</span><span style="color:#008000;">定时器初始化</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    Tim1_Init();</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    Tim2_Init();</span></p> 
<p style="margin-left:0;text-align:left;">    <span style="color:#008000;">//1602</span><span style="color:#008000;">液晶</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">  LCD_init();   </span><span style="color:#008000;"> //LCD1602</span><span style="color:#008000;">初始化</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    LCD_clr();</span><span style="color:#008000;">//LCD</span><span style="color:#008000;">清屏</span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#008000;">//</span><span style="color:#008000;">主循环</span></p> 
<p style="margin-left:0;text-align:left;">    <span style="color:#0000ff;">while</span><span style="color:#000000;"> (</span><span style="color:#0070c0;">1</span><span style="color:#000000;">)         </span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    {   </span></p> 
<p style="margin-left:0;text-align:left;">        <span style="color:#0000ff;">if</span><span style="color:#000000;">(!k1</span>)<span style="color:#008000;">//</span><span style="color:#008000;">开始停止按键</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">        {<!-- --></span></p> 
<p style="margin-left:0;text-align:left;">             <span style="color:#0000ff;">while</span><span style="color:#000000;">(!k1);</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">             LCD_clr();</span><span style="color:#008000;">//</span><span style="color:#008000;">清屏</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">             start_stop_bit=!start_stop_bit;</span><span style="color:#008000;">//</span><span style="color:#008000;">切换模式</span></p> 
<p style="margin-left:0;text-align:left;">             <span style="color:#0000ff;">if</span><span style="color:#000000;">(start_stop_bit)</span><span style="color:#008000;">///</span><span style="color:#008000;">运行状态下显示下面字符</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">             {<!-- --></span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">                 sprintf(dis0,"</span><span style="color:#7030a0;">====Reverse====\n</span><span style="color:#000000;">");</span><span style="color:#008000;">//</span><span style="color:#008000;">更新显示 </span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">                 LCD_Write_String(</span><span style="color:#0070c0;">0</span><span style="color:#000000;">,</span><span style="color:#0070c0;">0</span><span style="color:#000000;">,dis0);</span><span style="color:#008000;">//</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">             }       </span></p> 
<p style="margin-left:0;text-align:left;">             <span style="color:#0000ff;">else</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">             {<!-- --></span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">                 beep =</span><span style="color:#0070c0;">0</span><span style="color:#000000;">;</span><span style="color:#008000;">//</span><span style="color:#008000;">关闭蜂鸣器</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">                 TIM_Cmd(TIM2,DISABLE);</span><span style="color:#008000;">//</span><span style="color:#008000;">关闭定时器2</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">                 LED = </span><span style="color:#0070c0;">1</span><span style="color:#000000;">;</span><span style="color:#008000;">//</span><span style="color:#008000;">关led  </span>       </p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">             }            </span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">        }   </span></p> 
<p style="margin-left:0;text-align:left;">        <span style="color:#0000ff;">if</span><span style="color:#000000;">(start_stop_bit)    </span><span style="color:#008000;">//</span><span style="color:#008000;">运行状态</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">        {       </span></p> 
<p style="margin-left:0;text-align:left;">             <span style="color:#008000;">//</span><span style="color:#008000;">超声波测距</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">             SRF04(0);</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">             car_bizhang(); </span><span style="color:#008000;">//</span><span style="color:#008000;">小车状态函数</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">             sprintf(dis0,"%3.0fCM\n",JuLi[0]);</span><span style="color:#008000;">//</span><span style="color:#008000;">更新显示</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">             LCD_Write_String(5,1,dis0);</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">             delay_ms(500);</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">        }</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    }</span></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">}</span></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#0000ff;">void</span><span style="color:#000000;"> SRF04(</span><span style="color:#0000ff;">unsigned char</span><span style="color:#000000;"> ch) </span><span style="color:#008000;"> //</span><span style="color:#008000;">超声波测试函数</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">{<!-- --></span></p> 
<p style="margin-left:0;text-align:left;">    <span style="color:#0000ff;">int</span><span style="color:#000000;"> delay=</span><span style="color:#0070c0;">0xFf</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    u16 tim;</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">        GPIO_ResetBits(SRF04_PORT,SRF04_TR_PIN);    </span></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    delay_us(</span><span style="color:#0070c0;">20</span><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    GPIO_SetBits(SRF04_PORT,SRF04_TR_PIN);</span></p> 
<p style="margin-left:0;text-align:left;">    <span style="color:#0000ff;">while</span><span style="color:#000000;">(!GPIO_ReadInputDataBit(GPIOA,SRF04_ECHO_PIN));</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    TIM_Cmd(TIM1,ENABLE);</span></p> 
<p style="margin-left:0;text-align:left;">    <span style="color:#0000ff;">while</span><span style="color:#000000;">(GPIO_ReadInputDataBit(GPIOA,SRF04_ECHO_PIN));</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    TIM_Cmd(TIM1,DISABLE);</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    tim = TIM_GetCounter(TIM1);</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    JuLi[ch]=tim</span>/<span style="color:#0070c0;">58.0</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    TIM1-&gt;CNT=0; </span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">}</span></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#0000ff;">void</span><span style="color:#000000;"> car_f(void)</span><span style="color:#008000;"> //</span><span style="color:#008000;">前进</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">{<!-- --></span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    ena =</span><span style="color:#0070c0;">1</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    ena1=</span><span style="color:#0070c0;">1</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    in_b = </span><span style="color:#0070c0;">0</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    in_b1=</span><span style="color:#0070c0;">0</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    in_f=</span><span style="color:#0070c0;">1</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">             {<!-- --></span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">                     beep =</span><span style="color:#0070c0;">1</span><span style="color:#000000;">;</span><span style="color:#008000;">//</span><span style="color:#008000;">蜂鸣器开</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">                     TIM_Cmd(TIM2,ENABLE);</span><span style="color:#008000;">//</span><span style="color:#008000;">使能定时器2，led闪烁</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">                     car_s();</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">             }</span></p> 
<p style="margin-left:0;text-align:left;">        <span style="color:#0000ff;">else if</span><span style="color:#000000;">(JuLi[0]&lt;50)</span><span style="color:#008000;">//</span><span style="color:#008000;">小车距离小于50，蜂鸣器开启，led闪烁</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">             {<!-- --></span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">                     beep =</span><span style="color:#0070c0;">1</span><span style="color:#000000;">;</span><span style="color:#008000;">//</span><span style="color:#008000;">蜂鸣器开</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">                     TIM_Cmd(TIM2,ENABLE);</span><span style="color:#008000;">//</span><span style="color:#008000;">使能定时器2，led闪烁</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">             }</span></p> 
<p style="margin-left:0;text-align:left;">             <span style="color:#0000ff;">else if</span><span style="color:#000000;">(JuLi[0]&lt;100)</span><span style="color:#008000;">//</span><span style="color:#008000;">小车距离小于100，蜂鸣器开启</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">             {<!-- --></span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">                 beep =</span><span style="color:#0070c0;">1</span><span style="color:#000000;">;</span><span style="color:#008000;">//</span><span style="color:#008000;">蜂鸣器开</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">                 TIM_Cmd(TIM2,DISABLE);</span><span style="color:#008000;">//</span><span style="color:#008000;">关闭定时器2</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">                 LED = </span><span style="color:#0070c0;">1</span><span style="color:#000000;">;</span><span style="color:#008000;">//</span><span style="color:#008000;">关led</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">             }</span></p> 
<p style="margin-left:0;text-align:left;">             <span style="color:#0000ff;">else</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">             {<!-- --></span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">                 beep =</span><span style="color:#0070c0;">0</span><span style="color:#000000;">;</span><span style="color:#008000;">//</span><span style="color:#008000;">关闭蜂鸣器</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">                 TIM_Cmd(TIM2,DISABLE);</span><span style="color:#008000;">//</span><span style="color:#008000;">关闭定时器2</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">                 LED = </span><span style="color:#0070c0;">1</span><span style="color:#000000;">;</span><span style="color:#008000;">//</span><span style="color:#008000;">关led  </span>       </p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">             }</span></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">}</span></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#0000ff;">void</span><span style="color:#000000;"> TIM1_UP_IRQHandler(</span><span style="color:#0000ff;">void</span><span style="color:#000000;">)  </span><span style="color:#008000;"> //TIM1</span><span style="color:#008000;">中断</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">{<!-- --></span></p> 
<p style="margin-left:0;text-align:left;">   </p> 
<p style="margin-left:0;text-align:left;">    <span style="color:#0000ff;">if</span><span style="color:#000000;"> (TIM_GetITStatus(TIM1, TIM_IT_Update) != RESET) </span><span style="color:#008000;">//</span><span style="color:#008000;">检查指定的tim中断发生与否 </span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    {<!-- --></span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">        TIM_ClearITPendingBit(TIM1, TIM_IT_Update  ); </span><span style="color:#008000;"> //</span><span style="color:#008000;">清除timx的中断待处理位</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    }</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">}</span></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#0000ff;">void</span><span style="color:#000000;"> TIM2_IRQHandler(</span><span style="color:#0000ff;">void</span><span style="color:#000000;">)</span><span style="color:#008000;">//</span><span style="color:#008000;">定时器2，捕获中断和更新中断0.5s</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">{<!-- --></span></p> 
<p style="margin-left:0;text-align:left;">    <span style="color:#0000ff;">if</span><span style="color:#000000;">(TIM_GetITStatus(TIM2,TIM_IT_Update))</span><span style="color:#008000;">//0.5s</span><span style="color:#008000;">更新中断</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    {<!-- --></span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">        LED=!LED;</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    }</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    TIM_ClearITPendingBit(TIM2,TIM_IT_Update);</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">}</span></p> 
<p style="margin-left:0;text-align:left;">   </p> 
<p style="margin-left:0;text-align:left;"><span style="color:#0000ff;">void</span><span style="color:#000000;"> GPIO_SRF04_INIT(</span><span style="color:#0000ff;">void</span><span style="color:#000000;">)</span><span style="color:#008000;">//</span><span style="color:#008000;">超声波引脚初始化</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">{<!-- --></span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    GPIO_InitTypeDef GPIO_InitStructure;</span></p> 
<p style="margin-left:0;text-align:left;">    <span style="color:#008000;">/trig</span><span style="color:#008000;">触发信号/</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    GPIO_InitStructure.GPIO_Speed=GPIO_Speed_50MHz;</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    GPIO_InitStructure.GPIO_Mode=GPIO_Mode_Out_PP;</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    GPIO_InitStructure.GPIO_Pin=SRF04_TR_PIN;</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    GPIO_Init(SRF04_PORT, &amp;GPIO_InitStructure);</span></p> 
<p style="margin-left:0;text-align:left;">    <span style="color:#008000;">/*ECOH</span><span style="color:#008000;">回响信号/</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    GPIO_InitStructure.GPIO_Mode=GPIO_Mode_IN_FLOATING;</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    GPIO_InitStructure.GPIO_Pin=SRF04_ECHO_PIN;</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    GPIO_Init(SRF04_PORT, &amp; GPIO_InitStructure);    </span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">}</span></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#0000ff;">void</span><span style="color:#000000;"> GPIO_MOTOR_INIT(</span><span style="color:#0000ff;">void</span><span style="color:#000000;">)</span><span style="color:#008000;">//</span><span style="color:#008000;">电机引脚初始化</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">{<!-- --></span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    GPIO_InitTypeDef GPIO_InitStructure;</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA,ENABLE);</span><span style="color:#008000;">//</span><span style="color:#008000;">打开时钟</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    GPIO_InitStructure.GPIO_Pin = GPIO_Pin_0|GPIO_Pin_1|GPIO_Pin_2|GPIO_Pin_3</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">                                  |GPIO_Pin_4|GPIO_Pin_5|GPIO_Pin_6|GPIO_Pin_10;</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    GPIO_InitStructure.GPIO_Mode = GPIO_Mode_Out_PP; </span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    GPIO_InitStructure.GPIO_Speed = GPIO_Speed_10MHz;    </span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    GPIO_Init(GPIOA, &amp;GPIO_InitStructure);</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    beep=0;LED=1; </span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">}</span></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#0000ff;">void</span><span style="color:#000000;"> GPIO_KEY_INIT(</span><span style="color:#0000ff;">void</span><span style="color:#000000;">)</span><span style="color:#008000;">//</span><span style="color:#008000;">按键引脚初始化</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">{<!-- --></span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    GPIO_InitTypeDef GPIO_InitStructure;</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA,ENABLE);</span><span style="color:#008000;">//</span><span style="color:#008000;">打开时钟</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    GPIO_InitStructure.GPIO_Pin = GPIO_Pin_8|GPIO_Pin_9;</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    GPIO_InitStructure.GPIO_Mode = GPIO_Mode_IPU;   </span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    GPIO_InitStructure.GPIO_Speed = GPIO_Speed_10MHz;    </span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    GPIO_Init(GPIOA, &amp;GPIO_InitStructure);          </span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">}</span></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#0000ff;">void</span><span style="color:#000000;"> Tim1_Init(</span><span style="color:#0000ff;">void</span><span style="color:#000000;">)</span><span style="color:#008000;">//</span><span style="color:#008000;">定时器1初始化，计算超声波距离</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">{<!-- --></span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    TIM_TimeBaseInitTypeDef TIM_InitStructure;</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    NVIC_InitTypeDef NVIC_InitStructer;</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    RCC_APB2PeriphClockCmd(RCC_APB2Periph_TIM1,ENABLE);</span></p> 
<p style="margin-left:0;text-align:left;">    <span style="color:#008000;">//</span><span style="color:#008000;">定时器tim2初始化</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    TIM_DeInit(TIM1);</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    TIM_InitStructure.TIM_Period        = </span><span style="color:#0070c0;">0xffff</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    TIM_InitStructure.TIM_Prescaler     = SystemCoreClock/</span><span style="color:#0070c0;">1000000-1</span><span style="color:#000000;">; </span><span style="color:#008000;">//lus</span><span style="color:#008000;">一个计数</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    TIM_InitStructure.TIM_ClockDivision = TIM_CKD_DIV1;                      </span><span style="color:#008000;">  //</span><span style="color:#008000;">不分频</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    TIM_InitStructure.TIM_CounterMode   = TIM_CounterMode_Up;//ÏòÉÏ¼ÆÊý</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    TIM_TimeBaseInit(TIM1,&amp;TIM_InitStructure);</span></p> 
<p style="margin-left:0;text-align:left;">    <span style="color:#008000;">//</span><span style="color:#008000;">开启更新中断</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    TIM_ITConfig(TIM1,TIM_IT_Update,ENABLE);</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">    //</span><span style="color:#008000;">中断参数设置</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    NVIC_InitStructer.NVIC_IRQChannelPreemptionPriority =</span><span style="color:#0070c0;"> 2</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    NVIC_InitStructer.NVIC_IRQChannelSubPriority        = </span><span style="color:#0070c0;">2</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    NVIC_InitStructer.NVIC_IRQChannel                   =TIM1_UP_IRQn;</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    NVIC_InitStructer.NVIC_IRQChannelCmd                = ENABLE;</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    NVIC_Init(&amp;NVIC_InitStructer); </span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">    //</span><span style="color:#008000;">关闭定时器使能</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    TIM_Cmd(TIM1,DISABLE);</span></p> 
<p style="margin-left:0;text-align:left;">   </p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">}</span></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#0000ff;">void</span><span style="color:#000000;"> Tim2_Init(</span><span style="color:#0000ff;">void</span><span style="color:#000000;">)</span><span style="color:#008000;">//</span><span style="color:#008000;">定时器2初始化，捕获和0.5更新中断</span></p> 
<p style="margin-left:0;text-align:left;">   </p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">{<!-- --></span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    GPIO_InitTypeDef GPIO_InitStructure;</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    TIM_TimeBaseInitTypeDef TIM_InitStructure;</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    TIM_ICInitTypeDef TIM_ICInitStructure;</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    NVIC_InitTypeDef NVIC_InitStructure;</span></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA|RCC_APB2Periph_AFIO,ENABLE);    </span><span style="color:#008000;">//</span><span style="color:#008000;">使能PA端口时钟和复用时钟</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    RCC_APB1PeriphClockCmd(RCC_APB1Periph_TIM2,ENABLE);  </span><span style="color:#008000;">//</span><span style="color:#008000;">使能tim2时钟</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">    //</span><span style="color:#008000;">写初值（预分频寄存器psc，自动重装载寄存器arr，计数模板cr1.Bit4）</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    TIM_InitStructure.TIM_Prescaler = SystemCoreClock/</span><span style="color:#0070c0;">10000-1</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    TIM_InitStructure.TIM_Period =</span><span style="color:#0070c0;"> 5000-1</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    TIM_InitStructure.TIM_CounterMode = TIM_CounterMode_Up;</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    TIM_InitStructure.TIM_ClockDivision = TIM_CKD_DIV1;</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    TIM_InitStructure.TIM_RepetitionCounter = 0;</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    TIM_TimeBaseInit(TIM2,&amp;TIM_InitStructure);</span></p> 
<p style="margin-left:0;text-align:left;">    <span style="color:#008000;">//</span><span style="color:#008000;">使能中断允许位 DIER.BIT0</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    TIM_ITConfig(TIM2,TIM_IT_Update,ENABLE);</span></p> 
<p style="margin-left:0;text-align:left;">    <span style="color:#008000;">    //</span><span style="color:#008000;">中断通道使能</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    NVIC_InitStructure.NVIC_IRQChannel = TIM2_IRQn;</span><span style="color:#008000;">//</span><span style="color:#008000;">使能tim2</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority = 2;</span><span style="color:#008000;"> //</span><span style="color:#008000;">设置抢占优先级2</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    NVIC_InitStructure.NVIC_IRQChannelSubPriority = 1</span><span style="color:#008000;">;//</span><span style="color:#008000;">设置响应优先级2</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    NVIC_InitStructure.NVIC_IRQChannelCmd = ENABLE;</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    NVIC_Init(&amp;NVIC_InitStructure);    </span></p> 
<p style="margin-left:0;text-align:left;">    <span style="color:#008000;">//</span><span style="color:#008000;">开启计数器CR1.BIT0</span></p> 
<p style="margin-left:0;text-align:left;">    <span style="color:#008000;">//TIM_Cmd(TIM2,ENABLE);</span></p> 
<p><span style="color:#000000;">}</span><br> 源文件链接：https://pan.baidu.com/s/1fU4isp7UXTtUFHwpt76zzw?pwd=9x7t <br> 提取码：9x7t<br>  </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1751fadcf2e6fedf6f5f39ed0acc838c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Java面试题一</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c9c7676ea5162ea7473268e4f8ff7787/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Ubuntu - 安装 MySQL 8</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>