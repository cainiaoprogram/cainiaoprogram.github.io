<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>php 调用eth智能合约,以太坊常见问题和错误 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="php 调用eth智能合约,以太坊常见问题和错误" />
<meta property="og:description" content="我对如何使怎么用Web3.js 1.0认证和发送提交智能合约的方法感到很困惑。
这是工作代码(通常我要先手动解锁帐户)：
var contract = new web3.eth.Contract(contractJson, contractAddress);
contract.methods
.transfer(&#34;0x0e0479bC23a96F6d701D003c5F004Bb0f28e773C&#34;, 1000)
.send({
from: &#34;0x2EBd0A4729129b45b23aAd4656b98026cf67650A&#34;
})
.on(&#39;confirmation&#39;, (confirmationNumber, receipt) =&gt; {
io.emit(&#39;confirmation&#39;, confirmationNumber);
});
我得到这个错误(如果我不手动解锁的话)：
Returned error: authentication needed: password or unlock
上面的代码是Node.js中的一个API端点，我希望它以编程方式解锁或做身份认证(鉴权)。
在Web3.js 1.0中好像没有解锁帐户的方法。
我也不认为这是必要的(这就是我所困惑的)。因为我在管理帐号，所以我知道私钥是什么。
我想交易需要用私钥签名吗？这是正常的吗？这与unlocking the account账户解锁是否有关？
我又试着这样写代码：
var contract = new web3.eth.Contract(contractJson, contractAddress);
var tx = {
from: &#34;...{fromAddress -- address that has the private key below}&#34;,
to: &#34;...&#34;,
value: ...
};
var signed = web3.eth.accounts.signTransaction(tx," />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/3fd6bdabd9d3eec7bdb0d5a1b035f350/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-03-27T06:31:31+08:00" />
<meta property="article:modified_time" content="2021-03-27T06:31:31+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">php 调用eth智能合约,以太坊常见问题和错误</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="font-size:16px;"> 
 <p>我对如何使怎么用Web3.js 1.0认证和发送提交智能合约的方法感到很困惑。</p> 
 <p>这是工作代码(通常我要先手动解锁帐户)：</p> 
 <p>var contract = new web3.eth.Contract(contractJson, contractAddress);</p> 
 <p>contract.methods</p> 
 <p>.transfer("0x0e0479bC23a96F6d701D003c5F004Bb0f28e773C", 1000)</p> 
 <p>.send({<!-- --></p> 
 <p>from: "0x2EBd0A4729129b45b23aAd4656b98026cf67650A"</p> 
 <p>})</p> 
 <p>.on('confirmation', (confirmationNumber, receipt) =&gt; {<!-- --></p> 
 <p>io.emit('confirmation', confirmationNumber);</p> 
 <p>});</p> 
 <p>我得到这个错误(如果我不手动解锁的话)：</p> 
 <p>Returned error: authentication needed: password or unlock</p> 
 <p>上面的代码是Node.js中的一个API端点，我希望它以编程方式解锁或做身份认证(鉴权)。</p> 
 <p>在Web3.js 1.0中好像没有解锁帐户的方法。</p> 
 <p>我也不认为这是必要的(这就是我所困惑的)。因为我在管理帐号，所以我知道私钥是什么。</p> 
 <p>我想交易需要用私钥签名吗？这是正常的吗？这与unlocking the account账户解锁是否有关？</p> 
 <p>我又试着这样写代码：</p> 
 <p>var contract = new web3.eth.Contract(contractJson, contractAddress);</p> 
 <p>var tx = {<!-- --></p> 
 <p>from: "...{fromAddress -- address that has the private key below}",</p> 
 <p>to: "...",</p> 
 <p>value: ...</p> 
 <p>};</p> 
 <p>var signed = web3.eth.accounts.signTransaction(tx,</p> 
 <p>"...{privateKey}");</p> 
 <p>console.log(signed);</p> 
 <p>var promise = web3.eth.sendSignedTransaction(signed);</p> 
 <p>我得到下面这个错误：</p> 
 <p>Returned error: The method net_version does not exist/is not available</p> 
 <p>有什么最简单的方法来认证和发布提交一个以太坊交易？</p> 
 <p>理想情况下，我想用上面的第一种方法，因为它比较干净。</p> 
 <p>解决方法</p> 
 <p>用web3.js认证发送智能合约方法，此代码允许我使用我创建的帐户(web3.eth.accounts.create()),使用privateKey签署Node.js服务器端的交易，并将签名的交易发送到网络，而不必解锁用户帐户。</p> 
 <p>我用的是GETH 1.7.1</p> 
 <p>var contract = new web3.eth.Contract(contractJson, contractAddress);</p> 
 <p>var transfer = contract.methods.transfer("0x...", 490);</p> 
 <p>var encodedABI = transfer.encodeABI();</p> 
 <p>var tx = {<!-- --></p> 
 <p>from: "0x...",</p> 
 <p>to: contractAddress,</p> 
 <p>gas: 2000000,</p> 
 <p>data: encodedABI</p> 
 <p>};</p> 
 <p>web3.eth.accounts.signTransaction(tx, privateKey).then(signed =&gt; {<!-- --></p> 
 <p>var tran = web3.eth.sendSignedTransaction(signed.rawTransaction);</p> 
 <p>tran.on('confirmation', (confirmationNumber, receipt) =&gt; {<!-- --></p> 
 <p>console.log('confirmation: ' + confirmationNumber);</p> 
 <p>});</p> 
 <p>tran.on('transactionHash', hash =&gt; {<!-- --></p> 
 <p>console.log('hash');</p> 
 <p>console.log(hash);</p> 
 <p>});</p> 
 <p>tran.on('receipt', receipt =&gt; {<!-- --></p> 
 <p>console.log('reciept');</p> 
 <p>console.log(receipt);</p> 
 <p>});</p> 
 <p>tran.on('error', console.error);</p> 
 <p>});</p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b6cd6c5c98550803e738cc9cf5b5a9ec/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【C语言】 --- 段错误</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/977ebd72078d36616cc999b3de698d4d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">matlab p值 z值,显著性水平 p值 z值</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>