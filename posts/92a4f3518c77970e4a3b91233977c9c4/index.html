<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>人脸检测&#43;识别---04绘制矩形&#43;05检测人脸（OpenCV&#43;PyCharm适用于高中信息技术新教材）持续更新中…… - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="人脸检测&#43;识别---04绘制矩形&#43;05检测人脸（OpenCV&#43;PyCharm适用于高中信息技术新教材）持续更新中……" />
<meta property="og:description" content="04绘制矩形 在图像上绘制矩形和圆形还是比较简单的，直接调用opencv中的rectangle和circle函数，并给出适合的参数即可。
# 导入opencv库 import cv2 # 读取图片文件dehua.jpg（文件名不能有中文）,存入img img = cv2.imread(&#34;./images/dehua.jpg&#34;) # 坐标，（x,y）矩形左上角坐标，（w,h）矩形的宽和高 x,y,w,h=100,100,100,100 # 在图像img上绘制矩形，左上角坐标（x,y），矩形的宽和高w,h，红色外框（BGR），粗细为2 cv2.rectangle(img,(x,y,w,h),color=(0,0,255),thickness=2) # 在图像img上绘制圆形，圆心为坐标(x&#43;int(w/2),y&#43;int(h/2))，半径为50，蓝色外框（BGR），粗细为2 cv2.circle(img,center=(x&#43;int(w/2),y&#43;int(h/2)),radius=50,color=(255,0,0),thickness=2) #显示图像img cv2.imshow(&#34;img&#34;,img) while True: # 如果按下小写字母键&#34;q&#34;,则结束循环，执行最候一句语句cv2.destroyAllWindows() if cv2.waitKey() == ord(&#34;q&#34;): # 否则一直循环，即等待 break cv2.destroyAllWindows() # 释放内存 对应高中生来说，比较难理解的还是
while True: # 如果按下小写字母键&#34;q&#34;,则结束循环，执行最候一句语句cv2.destroyAllWindows() if cv2.waitKey() == ord(&#34;q&#34;): # 否则一直循环，即等待 break cv2.destroyAllWindows() # 释放内存 下面我用流程图来解释，需要对同学们理解有所帮助。
05人脸检测 用opencv进行人脸检测，一般的过程如下：
其中“将图像转换为灰度图像”、“调用人脸模型”、“获取人脸ROI”、“根据ROI进行标记”、“输出标记后的图像”这些步骤写到了函数def face_detect_demo(img)中，参数img就是读入的图像文件。
具体的代码如下：
import cv2 #自定义函数，人脸检测，参数img def face_detect_demo(img): # 转换成灰度图像 gray=cv2.cvtColor(img,cv2.COLOR_BGR2GRAY) # 设置人脸分类器（即用opencv内置的人脸检测模型） face_detect=cv2.CascadeClassifier(&#34;./venv/Lib/site-packages/cv2/data/haarcascade_frontalface_default.xml&#34;) # 调用人脸检测函数（参数详解见最后），得到的人脸数据存放于faces中（faces是numpy." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/92a4f3518c77970e4a3b91233977c9c4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-11-26T08:49:38+08:00" />
<meta property="article:modified_time" content="2021-11-26T08:49:38+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">人脸检测&#43;识别---04绘制矩形&#43;05检测人脸（OpenCV&#43;PyCharm适用于高中信息技术新教材）持续更新中……</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="04_0"></a>04绘制矩形</h3> 
<p>在图像上绘制矩形和圆形还是比较简单的，直接调用opencv中的rectangle和circle函数，并给出适合的参数即可。</p> 
<pre><code class="prism language-python"><span class="token comment"># 导入opencv库</span>
<span class="token keyword">import</span> cv2
<span class="token comment"># 读取图片文件dehua.jpg（文件名不能有中文）,存入img</span>
img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">"./images/dehua.jpg"</span><span class="token punctuation">)</span>
<span class="token comment"># 坐标，（x,y）矩形左上角坐标，（w,h）矩形的宽和高</span>
x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>w<span class="token punctuation">,</span>h<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span>
<span class="token comment"># 在图像img上绘制矩形，左上角坐标（x,y），矩形的宽和高w,h，红色外框（BGR），粗细为2</span>
cv2<span class="token punctuation">.</span>rectangle<span class="token punctuation">(</span>img<span class="token punctuation">,</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>w<span class="token punctuation">,</span>h<span class="token punctuation">)</span><span class="token punctuation">,</span>color<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>thickness<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token comment"># 在图像img上绘制圆形，圆心为坐标(x+int(w/2),y+int(h/2))，半径为50，蓝色外框（BGR），粗细为2</span>
cv2<span class="token punctuation">.</span>circle<span class="token punctuation">(</span>img<span class="token punctuation">,</span>center<span class="token operator">=</span><span class="token punctuation">(</span>x<span class="token operator">+</span><span class="token builtin">int</span><span class="token punctuation">(</span>w<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>y<span class="token operator">+</span><span class="token builtin">int</span><span class="token punctuation">(</span>h<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>radius<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">,</span>color<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>thickness<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token comment">#显示图像img</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">"img"</span><span class="token punctuation">,</span>img<span class="token punctuation">)</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>                         <span class="token comment"># 如果按下小写字母键"q",则结束循环，执行最候一句语句cv2.destroyAllWindows()</span>
    <span class="token keyword">if</span> cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">"q"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token comment"># 否则一直循环，即等待</span>
        <span class="token keyword">break</span>
cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 释放内存</span>
</code></pre> 
<p>对应高中生来说，比较难理解的还是</p> 
<pre><code class="prism language-python"><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>                         <span class="token comment"># 如果按下小写字母键"q",则结束循环，执行最候一句语句cv2.destroyAllWindows()</span>
    <span class="token keyword">if</span> cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">"q"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token comment"># 否则一直循环，即等待</span>
        <span class="token keyword">break</span>
cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 释放内存</span>
</code></pre> 
<p>下面我用流程图来解释，需要对同学们理解有所帮助。<br> <img src="https://images2.imgbox.com/98/a6/3FsX5wCZ_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="05_30"></a>05人脸检测</h3> 
<p>用opencv进行人脸检测，一般的过程如下：<br> <img src="https://images2.imgbox.com/6f/d0/7OUdPRSL_o.png" alt="在这里插入图片描述"><br> 其中“将图像转换为灰度图像”、“调用人脸模型”、“获取人脸ROI”、“根据ROI进行标记”、“输出标记后的图像”这些步骤写到了函数def face_detect_demo(img)中，参数img就是读入的图像文件。</p> 
<p>具体的代码如下：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2

<span class="token comment">#自定义函数，人脸检测，参数img</span>
<span class="token keyword">def</span> <span class="token function">face_detect_demo</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 转换成灰度图像</span>
    gray<span class="token operator">=</span>cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img<span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>
    <span class="token comment"># 设置人脸分类器（即用opencv内置的人脸检测模型）</span>
    face_detect<span class="token operator">=</span>cv2<span class="token punctuation">.</span>CascadeClassifier<span class="token punctuation">(</span><span class="token string">"./venv/Lib/site-packages/cv2/data/haarcascade_frontalface_default.xml"</span><span class="token punctuation">)</span>
    <span class="token comment"># 调用人脸检测函数（参数详解见最后），得到的人脸数据存放于faces中（faces是numpy.ndarray）</span>
    faces<span class="token operator">=</span>face_detect<span class="token punctuation">.</span>detectMultiScale<span class="token punctuation">(</span>gray<span class="token punctuation">,</span><span class="token number">1.1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># 在每一张人脸上画框</span>
    <span class="token keyword">for</span> x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>w<span class="token punctuation">,</span>h <span class="token keyword">in</span> faces<span class="token punctuation">:</span>
        cv2<span class="token punctuation">.</span>rectangle<span class="token punctuation">(</span>img<span class="token punctuation">,</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>x<span class="token operator">+</span>w<span class="token punctuation">,</span>y<span class="token operator">+</span>h<span class="token punctuation">)</span><span class="token punctuation">,</span>color<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>thickness<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token comment"># 显示画框后的图像</span>
    cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">"result"</span><span class="token punctuation">,</span>img<span class="token punctuation">)</span>


img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">"./images/DSC04753.jpg"</span><span class="token punctuation">)</span>
face_detect_demo<span class="token punctuation">(</span>img<span class="token punctuation">)</span>               <span class="token comment"># 调用自定义人脸检测函数，参数是读取的图像img</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>                         <span class="token comment"># 如果按下小写字母键"q",则结束循环，执行最候一句语句cv2.destroyAllWindows()</span>
    <span class="token keyword">if</span> cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">"q"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token comment"># 否则一直循环，即等待</span>
        <span class="token keyword">break</span>
cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 释放内存</span>
</code></pre> 
<p>说明1：haarcascade_frontalface_default.xml是opencv中内置的人脸检测模型文件（即，opencv已经将人脸的特征交于计算机进行了学习，生成了一个通用性很强的人脸检测模型文件，无特殊要求的情况下可直接使用）。此文件一般位于cv2安装的目录下，大家可以自行寻找一下。</p> 
<p>说明2：face_detect.detectMultiScale(gray,1.1,5,0,(20,20),(100,100))人脸检测函数参数说明。</p> 
<p>detectMultiScale(image,scaleFactor,minNeighbors,flags,minSize,maxSize)</p> 
<table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>image</td><td>用opencv读取的图片（必须为灰度图像）</td></tr><tr><td>scaleFactor</td><td>每一个图像尺度中的尺度参数，默认值为1.1</td></tr><tr><td>minNeighbors</td><td>构成检测目标（人脸）的相邻矩形的最小个数，默认值3个</td></tr><tr><td>flags</td><td>略，默认值取0，（一般用不到，有兴趣可以自行查阅相关资料）</td></tr><tr><td>minSize</td><td>最小人脸尺寸</td></tr><tr><td>maxSize</td><td>最大人脸尺寸</td></tr></tbody></table> 
<p>说明3：faces=face_detect.detectMultiScale(gray,1.1,5,0,(20,20),(100,100))返回图像中检测得到多人人脸信息，存于faces，其数据类型为numpy.ndarray（numpy中的多维数组）。</p> 
<p>返回的多维数组faces中x，y，w，h为其中的四个一维数组（可能这样描述不准确），存储每张人脸的左上角坐标、宽度和高度，因此可以使用for语句+rectangle函数来画框标记，代码如下：</p> 
<pre><code class="prism language-python">    <span class="token keyword">for</span> x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>w<span class="token punctuation">,</span>h <span class="token keyword">in</span> faces<span class="token punctuation">:</span>
        cv2<span class="token punctuation">.</span>rectangle<span class="token punctuation">(</span>img<span class="token punctuation">,</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>x<span class="token operator">+</span>w<span class="token punctuation">,</span>y<span class="token operator">+</span>h<span class="token punctuation">)</span><span class="token punctuation">,</span>color<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>thickness<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
</code></pre> 
<p>rectangle函数的参数比较简单，这里就不用详细的介绍了。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7330f34d159ad49e15a958a511b669b9/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">缅怀我的虾皮，瓜皮总是马后炮，事后明明也不是不会写</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b2d8a8c6e8f5d892b26662c187eea538/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">什么是闭包？如何解决闭包？</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>