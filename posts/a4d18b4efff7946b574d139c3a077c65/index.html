<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>交通灯电路及verilog实现（状态机） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="交通灯电路及verilog实现（状态机）" />
<meta property="og:description" content="一、功能 功能描述 ： 1 ）初始状态：主路绿灯、支路红灯； 2 ）检测到支路有车 (X=1)，灯状态的变化过程为： ①主路变黄灯、支路红灯 ②主路变红灯、支路红灯 ③主路红灯、支路变绿灯 3）当支路没车(X=0)，灯状态的变化过程为： ①主路红灯、支路绿灯 ②主路红灯、 支路变黄灯 ③主路绿灯、支路变红灯 道路示意图如下: 二、状态分析 对于以上转换过程，可以采用状态机电路来描述： 状态描述： S0:主路绿灯亮，支路红灯亮; 检测到支路有车 (X=1), 进入 S1; S1:主路黄灯亮，支路红灯亮, 延时进入 S2 ； S2:主路红灯亮，支路红灯亮, 延时进入 S3 ； S3:主路红灯亮，支路绿灯亮；检测到支路没车(X=0)进入S4; S4:主路红灯亮，支路黄灯亮；延时进入S0； S0:主路绿灯亮，支路红灯亮 三、verilog实现 用三段式状态机实现交通灯电路，设计和TB代码如下：
// Design Name: traffic_light // Module Name: traffic_light // Description: ↓ ↓ ↓ // Create Date: 2022/3/28 /* state: s0: main-green, branch-red, when x=1 s0-&gt;s1 s1: main-yellow, branch-red, delay s1-&gt;s2 s2: main-red, branch-red, delay s2-&gt;s3 s3: main-red, branch-green, when x=0 s3-&gt;s4 s4: main-red, branch-yellow, delay s4-&gt;s1 port: input: clk,rst_n,x output: main, branch */ `timescale 1ns / 1ps module traffic_light( input clk, input rst_n, input x, output reg [1:0] main, output reg [1:0] branch ); parameter green = 2&#39;d1, yellow = 2&#39;d2, red = 2&#39;d3; parameter s0 = 3&#39;d0, s1 = 3&#39;d1, s2 = 3&#39;d2, s3 = 3&#39;d3, s4 = 3&#39;d4; reg [3:0] state; reg [3:0] next_state; //state transfer always @(posedge clk or negedge rst_n) begin if(!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/a4d18b4efff7946b574d139c3a077c65/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-30T09:42:23+08:00" />
<meta property="article:modified_time" content="2023-06-30T09:42:23+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">交通灯电路及verilog实现（状态机）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>一、功能</h2> 
<div> 
 <span style="color:#ff0000;"><strong>功能描述</strong></span> 
 <span style="color:#000000;">： </span> 
</div> 
<div> 
 <span style="color:#000000;">1</span> 
 <span style="color:#000000;">）初始状态：主路绿灯、支路红灯； </span> 
</div> 
<div> 
 <span style="color:#000000;">2</span> 
 <span style="color:#000000;">）检测到支路有车</span> 
 <span style="color:#000000;">(X=1)，灯状态的变化过程为：</span> 
</div> 
<div> 
 <span style="color:#000000;">        ①主路变黄灯、支路红灯</span> 
</div> 
<div> 
 <span style="color:#000000;">        ②主路变红灯、支路红灯</span> 
</div> 
<div> 
 <span style="color:#000000;">        ③主路红灯、支路变绿灯</span> 
</div> 
<div> 
 <span style="color:#000000;">3）当支路没车(X=0)，灯状态的变化过程为：</span> 
</div> 
<div> 
 <span style="color:#000000;">        ①主路红灯、支路绿灯</span> 
</div> 
<div>
          ②主路红灯、 
 <span style="color:#000000;">支路变黄灯</span> 
</div> 
<div> 
 <span style="color:#000000;">        ③主路绿灯、支路变红灯</span> 
</div> 
<div> 
 <span style="color:#000000;">道路示意图如下:</span> 
</div> 
<div> 
 <img alt="" height="213" src="https://images2.imgbox.com/f5/df/SU7z6RHF_o.png" width="262"> 
</div> 
<div></div> 
<h2>二、状态分析</h2> 
<div>
  对于以上转换过程，可以采用状态机电路来描述： 
</div> 
<div></div> 
<div> 
 <span style="color:#ff0000;"><strong>状态描述： </strong></span> 
</div> 
<div> 
 <span style="color:#000000;">S0:主路绿灯亮，支路红灯亮; 检测到支路有车</span> 
 <span style="color:#000000;">(X=1),</span> 
 <span style="color:#000000;">进入</span> 
 <span style="color:#000000;">S1; </span> 
</div> 
<div> 
 <span style="color:#000000;">S1:主路黄灯亮，支路红灯亮, 延时进入</span> 
 <span style="color:#000000;">S2</span> 
 <span style="color:#000000;">； </span> 
</div> 
<div> 
 <span style="color:#000000;">S2:主路红灯亮，支路红灯亮, 延时进入</span> 
 <span style="color:#000000;">S3 </span> 
 <span style="color:#000000;">； </span> 
</div> 
<div> 
 <span style="color:#000000;">S3:主路红灯亮，支路绿灯亮；检测到支路没车(X=0)进入S4; </span> 
</div> 
<div> 
 <span style="color:#000000;">S4:主路红灯亮，支路黄灯亮；延时进入S0；</span> 
</div> 
<div> 
 <span style="color:#000000;">S0:主路绿灯亮，支路红灯亮</span> 
</div> 
<div> 
 <img alt="" height="204" src="https://images2.imgbox.com/74/7b/80QmvcGi_o.png" width="250"> 
</div> 
<p></p> 
<h2> 三、verilog实现</h2> 
<p>用三段式状态机实现交通灯电路，设计和TB代码如下：</p> 
<pre><code>
// Design Name: traffic_light
// Module Name: traffic_light               
// Description:  ↓ ↓ ↓
// Create Date: 2022/3/28

/*

state:
s0: main-green,     branch-red,     when x=1    s0-&gt;s1
s1: main-yellow,    branch-red,     delay       s1-&gt;s2
s2: main-red,       branch-red,     delay       s2-&gt;s3
s3: main-red,       branch-green,   when x=0    s3-&gt;s4
s4: main-red,       branch-yellow,  delay       s4-&gt;s1

port:
input:  clk,rst_n,x
output: main, branch

*/


`timescale 1ns / 1ps

module traffic_light(
    input   clk,
    input   rst_n,
    input   x,
    output  reg [1:0] main,
    output  reg [1:0] branch
);

parameter   green   = 2'd1,
           	yellow  = 2'd2,
			red     = 2'd3;

parameter   s0 = 3'd0,
            s1 = 3'd1,
            s2 = 3'd2,
            s3 = 3'd3,
            s4 = 3'd4;


reg [3:0] state;
reg [3:0] next_state;

//state transfer
always @(posedge clk or negedge rst_n) begin
    if(!rst_n)
        state &lt;= s0;
    else
        state &lt;= next_state;
end

//transfer logic
always @(*)begin
    case(state)
        s0:                 next_state = x ? s1 : s0;
        s1:         #600    next_state = s2;
        s2:         #600    next_state = s3;
        s3:                 next_state = x ? s3 : s4;
        s4:         #600    next_state = s0;
        default:            next_state = state;
     endcase
end

//output
always @(posedge clk or negedge rst_n)begin
    if(!rst_n)begin
        main    &lt;= green;
        branch  &lt;= red;
    end
    else begin
        case(state)
        s0:         begin       main &lt;= green;        branch &lt;= red;       end
        s1:         begin       main &lt;= yellow;       branch &lt;= red;       end
        s2:         begin       main &lt;= red;          branch &lt;= red;       end
        s3:         begin       main &lt;= red;          branch &lt;= green;     end
        s4:         begin       main &lt;= red;          branch &lt;= yellow;    end
        default:    begin       main &lt;= green;        branch &lt;= red;       end
        endcase
    end
end

endmodule
</code></pre> 
<p>testbench：</p> 
<pre><code>`timescale 1ns / 1ps

module tb_traffic_light();

parameter period = 10; //100mhz

reg     clk;
reg     rst_n;
reg     x;
wire    [1:0] main;
wire    [1:0] branch;

always #(period/2) clk = ~clk;

initial begin
    clk = 1'b0;
    rst_n = 1'b0;
    x = 0;
    #60
    rst_n = 1'b1;
    #1234
    x = 1;
    #1234
    x = 0;
end


traffic_light u_traffic_light(clk,rst_n,x,main,branch);


endmodule
</code></pre> 
<h2> 四、仿真&amp;综合</h2> 
<p>仿真结果：</p> 
<p><img alt="" height="315" src="https://images2.imgbox.com/e2/f5/iVcQgxIQ_o.png" width="1200">综合结果：</p> 
<p><img alt="" height="392" src="https://images2.imgbox.com/f8/dd/qxT4pylb_o.png" width="1081"></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0f285ac1baa34a62b36d2b37e336315c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">java将数据存入excel中并保存本地</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/20166c4eaf20e24b9036137024d92d52/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">SpringSecurity授权流程详解和代码实现</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>