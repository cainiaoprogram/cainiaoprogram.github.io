<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SpringBoot项目使用docker-maven-plugin插件构建docker镜像以及推送到docker hub或docker registry私服 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="SpringBoot项目使用docker-maven-plugin插件构建docker镜像以及推送到docker hub或docker registry私服" />
<meta property="og:description" content="我们知道docker可将应用程序和基础设施层隔离，可更快地打包、测试以及部署应用程序。本文主要介绍SpringBoot项目如何构建docker镜像以及推送到私服或者docker hub服务器上。
本文介绍的方式是使用docker-maven-plugin的方式构建SpringBoot的docker镜像以及推送到私服或docker hub服务器上。
Docker环境配置 本地环境配置 docker-maven-plugin 插件默认连接本地 Docker 地址为：localhost:2375，如果我们本地开发环境有docker环境并准备使用本地开发环境的docker，只需要先设置下本地开发环境的环境变量。
DOCKER_HOST=tcp://&lt;host&gt;:2375 服务器环境配置 如果使用CentOS服务器上的docker环境 （CentOS上安装docker环境），则需要在服务器上修改 docker 配置，开启允许远程访问 docker 的功能，开启方式很简单，修改 /usr/lib/systemd/system/docker.service 文件，ExecStart中加入如下内容：
-H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock 修改好配置后，使用如下命令重启docker生效：
systemctl daemon-reload systemctl restart docker IDEA测试docker连接 IDEA 中我们可以测试服务器上的docker环境是否连接成功，打开 File-&gt;Settings-&gt;Build,Execution,Deployment-&gt;Docker ，然后配置一下 Docker 的远程连接地址：
配置一下 Docker 的地址，配置完成后，提示 Connection successful 信息，表示 Docker 已经连接上了。
SpringBoot项目引入docker-maven-plugin插件 pom.xml配置 项目中引入docker-maven-plugin插件，在pom.xml引入插件并做相应的配置：
&lt;project&gt; &lt;!-- other setting--&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;!-- https://mvnrepository.com/artifact/com.spotify/docker-maven-plugin --&gt; &lt;groupId&gt;com.spotify&lt;/groupId&gt; &lt;artifactId&gt;docker-maven-plugin&lt;/artifactId&gt; &lt;version&gt;1.2.2&lt;/version&gt; &lt;executions&gt; &lt;!-- 当mvn执行install操作的时候，执行docker的build和push --&gt; &lt;execution&gt; &lt;id&gt;buildAndPush&lt;/id&gt; &lt;phase&gt;install&lt;/phase&gt; &lt;goals&gt; &lt;goal&gt;build&lt;/goal&gt; &lt;goal&gt;push&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;configuration&gt; &lt;!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/c1f6d64c1d42f2fc63031a02cfa955c6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-10-17T15:01:26+08:00" />
<meta property="article:modified_time" content="2022-10-17T15:01:26+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SpringBoot项目使用docker-maven-plugin插件构建docker镜像以及推送到docker hub或docker registry私服</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>我们知道docker可将应用程序和基础设施层隔离，可更快地打包、测试以及部署应用程序。本文主要介绍SpringBoot项目如何构建docker镜像以及推送到私服或者docker hub服务器上。</p> 
<p>本文介绍的方式是使用docker-maven-plugin的方式构建SpringBoot的docker镜像以及推送到私服或docker hub服务器上。</p> 
<h3>Docker环境配置</h3> 
<h4>本地环境配置</h4> 
<p>docker-maven-plugin 插件默认连接本地 Docker 地址为：localhost:2375，如果我们本地开发环境有docker环境并准备使用本地开发环境的docker，只需要先设置下本地开发环境的环境变量。</p> 
<pre><code class="language-bash">DOCKER_HOST=tcp://&lt;host&gt;:2375</code></pre> 
<h4>服务器环境配置</h4> 
<p>如果使用CentOS服务器上的docker环境 （<a href="https://blog.csdn.net/fly_duck/article/details/125279280" title="CentOS上安装docker环境">CentOS上安装docker环境</a>），则需要在服务器上修改 docker 配置，开启允许远程访问 docker 的功能，开启方式很简单，修改 /usr/lib/systemd/system/docker.service 文件，ExecStart中加入如下内容：</p> 
<pre><code class="language-bash">-H tcp://0.0.0.0:2375  -H unix:///var/run/docker.sock</code></pre> 
<p><img alt="" height="205" src="https://images2.imgbox.com/d4/1d/hmcyipzJ_o.png" width="1200"> </p> 
<p> 修改好配置后，使用如下命令重启docker生效：</p> 
<pre><code class="language-bash">systemctl daemon-reload    
systemctl restart docker </code></pre> 
<h4>IDEA测试docker连接</h4> 
<p>IDEA 中我们可以测试服务器上的docker环境是否连接成功，打开 <code>File-&gt;Settings-&gt;Build,Execution,Deployment-&gt;Docker</code> ，然后配置一下 Docker 的远程连接地址：</p> 
<p><img alt="" height="884" src="https://images2.imgbox.com/cc/cd/MUBY8pK6_o.png" width="1200"></p> 
<p>配置一下 Docker 的地址，配置完成后，提示 Connection successful 信息，表示 Docker 已经连接上了。</p> 
<h3>SpringBoot项目引入docker-maven-plugin插件</h3> 
<h4>pom.xml配置</h4> 
<p>项目中引入docker-maven-plugin插件，在pom.xml引入插件并做相应的配置：</p> 
<pre><code class="language-XML">&lt;project&gt;
    &lt;!-- other setting--&gt;
    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;!-- https://mvnrepository.com/artifact/com.spotify/docker-maven-plugin --&gt;
                &lt;groupId&gt;com.spotify&lt;/groupId&gt;
                &lt;artifactId&gt;docker-maven-plugin&lt;/artifactId&gt;
                &lt;version&gt;1.2.2&lt;/version&gt;
                &lt;executions&gt;
                    &lt;!-- 当mvn执行install操作的时候，执行docker的build和push --&gt;
                    &lt;execution&gt;
                        &lt;id&gt;buildAndPush&lt;/id&gt;
                        &lt;phase&gt;install&lt;/phase&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;build&lt;/goal&gt;
                            &lt;goal&gt;push&lt;/goal&gt;
                        &lt;/goals&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
                &lt;configuration&gt;
                    &lt;!-- 连接到 带docker环境的linux服务器 编译image --&gt;
                    &lt;dockerHost&gt;http://192.168.**.***:2375&lt;/dockerHost&gt;

                    &lt;!-- push到 docker hub 开始 --&gt;
                    &lt;!-- serverId 这个是配置在maven的setting.xml中私服的登录账户信息--&gt;
                    &lt;serverId&gt;docker-hub&lt;/serverId&gt;
                    &lt;retryPushCount&gt;1&lt;/retryPushCount&gt;
                    &lt;retryPushTimeout&gt;2000&lt;/retryPushTimeout&gt;
                    &lt;registryUrl&gt;https://index.docker.io/v1/&lt;/registryUrl&gt;
                    &lt;!-- 格式：私有仓库/镜像名称:版本号, 如果要执行push操作， 那么镜像名称必须为私有仓库为前缀，不然无效。--&gt;
                    &lt;imageName&gt;flyduck128/${project.artifactId}&lt;/imageName&gt;
                    &lt;!-- push到 docker hub 结束 --&gt;

                    &lt;!-- 指定tag版本 --&gt;
                    &lt;imageTags&gt;
                        &lt;imageTag&gt;v1.0&lt;/imageTag&gt;
                    &lt;/imageTags&gt;
                    &lt;dockerDirectory&gt;${project.basedir}/src/main/docker&lt;/dockerDirectory&gt;
                    &lt;!-- optionally overwrite tags every time image is built with docker:build --&gt;
                    &lt;forceTags&gt;true&lt;/forceTags&gt;
                    &lt;resources&gt;
                        &lt;resource&gt;
                            &lt;targetPath&gt;/&lt;/targetPath&gt;
                            &lt;directory&gt;${project.build.directory}&lt;/directory&gt;
                            &lt;include&gt;${project.build.finalName}.zip&lt;/include&gt;
                        &lt;/resource&gt;
                    &lt;/resources&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
&lt;/project&gt;</code></pre> 
<p>Docker命令可以绑定到maven各阶段命令中。该示例配置中我们在execution上将docker的build和push命令绑定在了maven的install阶段命令中。当springboot项目执行maven的install命令阶段，会执行docker的build和push命令。</p> 
<p>如果需要推送到docker hub或者私服，还需要在本地的maven目录的setting.xml中配置相应的server：</p> 
<pre><code class="language-XML">    &lt;server&gt;
      &lt;id&gt;docker-hub&lt;/id&gt;
      &lt;username&gt;flyduck128&lt;/username&gt;
      &lt;password&gt;***&lt;/password&gt;
      &lt;configuration&gt;
        &lt;email&gt;***@qq.com&lt;/email&gt;
      &lt;/configuration&gt;
    &lt;/server&gt;</code></pre> 
<p>如果我们不需要推送到docker hub或者私服，可以不配置docker的push命令以及相应的推送配置：</p> 
<pre><code class="language-XML">                    &lt;!-- push到 docker hub 开始 --&gt;
                    &lt;!-- serverId 这个是配置在maven的setting.xml中私服的登录账户信息--&gt;
                    &lt;serverId&gt;docker-hub&lt;/serverId&gt;
                    &lt;retryPushCount&gt;1&lt;/retryPushCount&gt;
                    &lt;retryPushTimeout&gt;2000&lt;/retryPushTimeout&gt;
                    &lt;registryUrl&gt;https://index.docker.io/v1/&lt;/registryUrl&gt;
                    &lt;!-- 格式：私有仓库/镜像名称:版本号, 如果要执行push操作， 那么镜像名称必须为私有仓库为前缀，不然无效。--&gt;
                    &lt;imageName&gt;flyduck128/${project.artifactId}&lt;/imageName&gt;
                    &lt;!-- push到 docker hub 结束 --&gt;</code></pre> 
<h4>Dockerfile文件配置</h4> 
<p>Dockerfile文件放入项目的/src/main/docker目录，在上面的pom.xml中dockerDirectory节点中保持一致。Dockerfile文件配置如下：</p> 
<pre><code class="language-bash">FROM openjdk:8
MAINTAINER flyduck 'flyduck@flyduck.com'
ENV APP_HOME=/usr/local/app
ENV PROJECT_HOME=${APP_HOME}/springboot-docker-1.0-SNAPSHOT
COPY springboot-docker-1.0-SNAPSHOT.zip springboot-docker.zip
RUN mkdir -p ${APP_HOME} &amp;&amp; mv springboot-docker.zip ${APP_HOME}
RUN cd ${APP_HOME} &amp;&amp; unzip springboot-docker.zip &amp;&amp; rm -rf springboot-docker.zip
RUN chmod 777 ${PROJECT_HOME}/bin/dockerrun.sh
EXPOSE 7003
ENTRYPOINT sh ${PROJECT_HOME}/bin/dockerrun.sh</code></pre> 
<p>Dockerfile镜像制作逻辑如下：</p> 
<ol><li>项目的运行依赖 Java 环境，所以镜像基于 openjdk:8镜像来构建。</li><li>容器中创建/user/local/app目录，将打包的zip文件拷贝到容器中，并移动到/user/local/app目录，然后解压zip文件到/user/local/app目录。</li><li>将程序的端口通过EXPOSE暴露出来。</li><li>最后就是配置一下启动命令，由于我们springboot项目使用的zip打包发布的方式，所以启动的方式和默认springboot项目有些区别。这里我们单独将启动配置放入dockerrun.sh文件，然后通过运行dockerrun.sh文件的方式启动程序。</li></ol> 
<p>dockerrun.sh运行程序配置如下：</p> 
<pre><code class="language-bash"># app home
APP_HOME=/usr/local/app/springboot-docker-1.0-SNAPSHOT
# java jar
PROJECT_NAME=${APP_HOME}/springboot-docker-1.0-SNAPSHOT.jar

#spring init load application properties or yml
CONF_FILE=${APP_HOME}/config/application.yml

# java opts.
JAVA_OPTS="-Xms64m -Xmx64m -Xmn64m"

#pid file
PID_CONF=${APP_HOME}/pid/process.pid

java ${JAVA_OPTS} -Djava.ext.dirs=${APP_HOME}/lib:$JAVA_HOME/jre/lib/ext -Dspring.config.location=${CONF_FILE} -jar ${PROJECT_NAME}</code></pre> 
<h3>构建镜像以及推送到服务器</h3> 
<p>在IDEA中直接点击install，会先打包springboot项目，然后在dockerHost配置的服务器上构建镜像，最后推送到registerUrl配置的docker私服或者hub docker上。</p> 
<p><img alt="" height="913" src="https://images2.imgbox.com/ab/c3/EMbpBSf5_o.png" width="1200"></p> 
<p> 项目install完成后，登录linux服务器，可以看到镜像已经构建成功：</p> 
<p><img alt="" height="83" src="https://images2.imgbox.com/56/1c/uj2mTnEc_o.png" width="984"></p> 
<p>登录docker hub网站，可以看到镜像已经推送到docker hub上： </p> 
<p> <img alt="" height="311" src="https://images2.imgbox.com/7c/41/rPdUWwlh_o.png" width="1200"></p> 
<h3>总结</h3> 
<p>本文主要介绍如何在IDEA中将SpringBoot项目构建docker镜像并推送到私服或者docker hub上，本文通过使用docker-maven-plugin插件的方式，连接docker环境的linux服务器构建docker镜像，并推送到docker hub上。如果需要推送到私服上，只需要将pom.xml中推送的配置修改私服的配置即可。<a class="link-info" href="https://gitee.com/flyduck128/springboot-demo/tree/master/flyduck-springboot-docker" rel="nofollow" title="示例代码">示例代码</a>已经上传至Gitee上，感兴趣的小伙伴可以直接获取查看。</p> 
<p></p> 
<h3>参考</h3> 
<p><a href="https://blog.csdn.net/fly_duck/article/details/125279280" title="CentOS上安装docker环境">CentOS上安装docker环境</a></p> 
<p><a class="link-info" href="https://blog.csdn.net/m0_67400973/article/details/126435153" title="Maven 插件之 docker-maven-plugin 的使用">Maven 插件之 docker-maven-plugin 的使用</a></p> 
<p><a class="link-info" href="https://github.com/spotify/docker-maven-plugin" title="Github上docker-maven-plugin源码地址">Github上docker-maven-plugin源码地址</a></p> 
<p><a class="link-info" href="https://www.lmlphp.com/user/16575/article/item/586128/" rel="nofollow" title="docker与Spring boot的集成：docker-maven-plugin使用">docker与Spring boot的集成：docker-maven-plugin使用</a><br><a class="link-info" href="https://www.cnblogs.com/jpfss/p/10945324.html" rel="nofollow" title="Maven 插件之 docker-maven-plugin 的使用">Maven 插件之 docker-maven-plugin 的使用</a><br><a class="link-info" href="https://github.com/spotify/docker-maven-plugin" title="docker-maven-plugin的github地址">docker-maven-plugin的github地址</a></p> 
<p><a href="http://www.manongjc.com/detail/50-fwgfzapojyzikyd.html" rel="nofollow" title="使用Maven插件构建SpringBoot项目,生成Docker镜像push到DockerHub上 - 码农教程">使用Maven插件构建SpringBoot项目,生成Docker镜像push到DockerHub上 - 码农教程</a></p> 
<p><a href="http://www.cppcns.com/jiqiao/fuwuqi/426602.html" rel="nofollow" title="详细docker-maven-plugin使用方法_服务器_网站技巧 - 编程客栈">详细docker-maven-plugin使用方法_服务器_网站技巧 - 编程客栈</a></p> 
<p><a class="link-info" href="https://docs.docker.com/registry/deploying/" rel="nofollow" title="私服docker registry server安装">私服docker registry server安装</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6e9c5edc87714170e6065fe5fcefcd21/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【apache-tomcat安装配置】完整教程（保姆级）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e6fd3c2222a1995b4e3d165a1d052025/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">读论文（二） - BERT</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>