<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>C&#43;&#43;重温笔记(四): 继承和派生 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="C&#43;&#43;重温笔记(四): 继承和派生" />
<meta property="og:description" content="1. 写在前面 c&#43;&#43;在线编译工具，可快速进行实验: https://www.dooccn.com/cpp/
这段时间打算重新把c&#43;&#43;捡起来， 实习给我的一个体会就是算法工程师是去解决实际问题的，所以呢，不能被算法或者工程局限住，应时刻提高解决问题的能力，在这个过程中，我发现cpp很重要， 正好这段时间也在接触些c&#43;&#43;开发相关的任务，所有想借这个机会把c&#43;&#43;重新学习一遍。 在推荐领域， 目前我接触到的算法模型方面主要是基于Python， 而线上的服务全是c&#43;&#43;(算法侧， 业务那边基本上用go)，我们所谓的模型，也一般是训练好部署上线然后提供接口而已。所以现在也终于知道，为啥只单纯熟悉Python不太行了， cpp，才是yyds。
和python一样， 这个系列是重温，依然不会整理太基础性的东西，更像是查缺补漏， 不过，c&#43;&#43;对我来说， 已经5年没有用过了， 这个缺很大， 也差不多相当重学了， 所以接下来的时间， 重温一遍啦 😉
资料参考主要是C语言中文网和光城哥写的C&#43;&#43;教程，然后再加自己的理解和编程实验作为辅助，加深印象。
今天这篇文章是C&#43;&#43;非常重要的一块，关于类的继承和派生，我们知道C&#43;&#43;面向对象开发有四大特性: 抽象，封装，继承和多态。 前面发现，通过定义类，把事物的数据和功能进行抽象，而通过隐藏对象的属性和实现细节，对外只提供接口的方式对类的内部成员形成了封装。 这两个前面都已经了解过， 而这篇文章主要是整理继承，即子类继承父类的特征和行为，使得子类具有父类的成员变量和方法， 继承最大的一个好处就是代码复用，两个类有一些相同的属性和方法。
这篇内容会有些偏多，还是各取所需即可 😊
主要内容如下:
C&#43;&#43;继承和派生初识C&#43;&#43;继承的三种方式C&#43;&#43;继承时的名字遮蔽问题与作用域嵌套C&#43;&#43;继承时的对象内存模型C&#43;&#43;基类和派生类的构造函数和析构函数C&#43;&#43;的多继承C&#43;&#43;虚继承(虚基类，虚继承构造函数，虚继承内存模型)C&#43;&#43;向上转型(派生类指针赋值给基类)与过程原理剖析借助指针突破访问权限的限制 Ok, let’s go!
2. C&#43;&#43;继承和派生初识 2.1 C&#43;&#43;面向对象开发的四大特性 在聊C&#43;&#43;继承和派生之前，先来看看C&#43;&#43;面向对象开发的四大特性，这样能先宏观把握一下继承到底位于什么样的位置。
C&#43;&#43;面向对象开发有四大特性: 抽象，封装，继承和多态， 正所谓编程语言的背后都非常相似，Java既然也是面向对象的语言，同样也会有这四大特性。
抽象和封装前面其实已经整理过了， 封装主要讲的是信息隐藏，保护数据，而抽象又可以从两个层面来理解。
抽象:
从现实生活的具体事物到类层面的抽象(包括各个成员)，比如人，有姓名，年龄等各个属性，又有学习，运动等各项功能，那么就可以定义people类把这些数据抽象出来，再通过创建对象的方式把具体实体人创建出来，调用相应的方法实现相应的功能。
宏观上，这是一种大层面的抽象，而这里面其实又可以看成数据抽象(目标的特性信息)和过程抽象(目标的功能是啥，注意不关注具体实现逻辑)封装
所谓封装，就是隐藏对象的属性和实现细节，仅仅对外公开接口，控制程序对类属性的读取和修改。在类的内部， 成员函数可以自由修改成员变量，进行精确控制，但是在类的内部，通过良好的封装， 减少耦合，隐藏实现细节。继承
继承，就是子类继承父亲的特征和行为，使得子类具有父类的成员变量和方法。 这个和生活中儿子继承他爹的家产差不多是一个道理，更有意思的是继承有两种模式，单继承和多继承，单继承比较好理解，一个子类只继承一个父类， 而多继承是一个子类，继承多个父类，联想到生活中，可能有好几个爸爸。多态
同一个行为具有多个不同表现形式或形态的能力，有两种表现形式覆盖和重载，这个到这里不理解也不要紧，下一篇文章会重点整理。 重载： 这个之前学习过，相同作用域中存在多个同名函数，但函数的参数列表会不一样重写或者叫覆盖: 主要体现在继承关系里面，子类重写了从他爸那里继承过来的函数，如果子类的对象调用成员函数的时候，如果子类的成员函数重写了他爸的，那么就执行子类自己的函数，否则继承他爸的。 这个也比较好理解，比如同样是挣钱，他爸的路子很可能和儿子的不一样，那么儿子在调用挣钱的时候，肯定是先找找儿子有没有独特的挣钱方式，如果没有，就默认和他爸一样，走他爸的挣钱方式。 2.2 再看继承 有了上面的宏观把握，再看继承就比较容易理解， 简单的讲，继承就是一个类从另一个类获取成员变量和成员函数的过程。 此时，被继承的类称为父类或基类，而继承的类称为子类或派生类。
C&#43;&#43;中派生和继承是站在不同角度看的同种概念。继承时从儿子的角度看，派生是父亲的角度看，实际说的是一回事。
派生类除了拥有他爹的成员，还可以定义自己的新成员，增强功能，此时的好处就是只需要定义新成员即可，老的成员和功能，直接继承，实现了代码复用。
下面是两种典型使用继承的场景：
创建的新类与现有类相似，只多出若干个成员变量和成员函数的时候，用继承，减少代码量，且新类会拥有基类的所有功能创建多个类， 他们拥有很多相似的成员变量或函数，可以用继承，把这些类共同的成员提取出来，定义为基类，然后从基类继承， 可以减少代码量，也方便后续的修改。 继承的语法:" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/2dbde7faa0c3788fdd20c7fecf8afde4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-10-12T10:04:35+08:00" />
<meta property="article:modified_time" content="2021-10-12T10:04:35+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">C&#43;&#43;重温笔记(四): 继承和派生</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="1__0"></a>1. 写在前面</h3> 
<p>c++在线编译工具，可快速进行实验: <a href="https://www.dooccn.com/cpp/" rel="nofollow">https://www.dooccn.com/cpp/</a></p> 
<p>这段时间打算重新把c++捡起来， 实习给我的一个体会就是算法工程师是去解决实际问题的，所以呢，不能被算法或者工程局限住，应时刻提高解决问题的能力，在这个过程中，我发现cpp很重要， 正好这段时间也在接触些c++开发相关的任务，所有想借这个机会把c++重新学习一遍。 在推荐领域， 目前我接触到的算法模型方面主要是基于Python， 而线上的服务全是c++(算法侧， 业务那边基本上用go)，我们所谓的模型，也一般是训练好部署上线然后提供接口而已。所以现在也终于知道，为啥只单纯熟悉Python不太行了， cpp，才是yyds。</p> 
<p>和python一样， 这个系列是重温，依然不会整理太基础性的东西，更像是查缺补漏， 不过，c++对我来说， 已经5年没有用过了， 这个缺很大， 也差不多相当重学了， 所以接下来的时间， 重温一遍啦 😉</p> 
<p>资料参考主要是<a href="http://c.biancheng.net/cplus/" rel="nofollow">C语言中文网</a>和<a href="https://light-city.club/sc/" rel="nofollow">光城哥写的C++教程</a>，然后再加自己的理解和编程实验作为辅助，加深印象。</p> 
<p>今天这篇文章是C++非常重要的一块，关于类的继承和派生，我们知道C++面向对象开发有四大特性: 抽象，封装，继承和多态。 前面发现，通过定义类，把事物的数据和功能进行抽象，而通过隐藏对象的属性和实现细节，对外只提供接口的方式对类的内部成员形成了封装。 这两个前面都已经了解过， 而这篇文章主要是整理继承，即<strong>子类继承父类的特征和行为，使得子类具有父类的成员变量和方法</strong>， 继承最大的一个好处就是代码复用，两个类有一些相同的属性和方法。</p> 
<p>这篇内容会有些偏多，还是各取所需即可 😊</p> 
<p>主要内容如下:</p> 
<ul><li>C++继承和派生初识</li><li>C++继承的三种方式</li><li>C++继承时的名字遮蔽问题与作用域嵌套</li><li>C++继承时的对象内存模型</li><li>C++基类和派生类的构造函数和析构函数</li><li>C++的多继承</li><li>C++虚继承(虚基类，虚继承构造函数，虚继承内存模型)</li><li>C++向上转型(派生类指针赋值给基类)与过程原理剖析</li><li>借助指针突破访问权限的限制</li></ul> 
<p>Ok, let’s go!</p> 
<h3><a id="2_C_26"></a>2. C++继承和派生初识</h3> 
<h4><a id="21_C_27"></a>2.1 C++面向对象开发的四大特性</h4> 
<p>在聊C++继承和派生之前，先来看看C++面向对象开发的四大特性，这样能先宏观把握一下继承到底位于什么样的位置。</p> 
<p>C++面向对象开发有四大特性: 抽象，封装，继承和多态， 正所谓编程语言的背后都非常相似，Java既然也是面向对象的语言，同样也会有这四大特性。</p> 
<p>抽象和封装前面其实已经整理过了， 封装主要讲的是信息隐藏，保护数据，而抽象又可以从两个层面来理解。</p> 
<ul><li>抽象:<br> 从现实生活的具体事物到类层面的抽象(包括各个成员)，比如人，有姓名，年龄等各个属性，又有学习，运动等各项功能，那么就可以定义people类把这些数据抽象出来，再通过创建对象的方式把具体实体人创建出来，调用相应的方法实现相应的功能。<br><br>宏观上，这是一种大层面的抽象，而这里面其实又可以看成数据抽象(目标的特性信息)和过程抽象(目标的功能是啥，注意不关注具体实现逻辑)</li><li>封装<br> 所谓封装，就是隐藏对象的属性和实现细节，仅仅对外公开接口，控制程序对类属性的读取和修改。在类的内部， 成员函数可以自由修改成员变量，进行精确控制，但是在类的内部，通过良好的封装， 减少耦合，隐藏实现细节。</li><li>继承<br> 继承，就是子类继承父亲的特征和行为，使得子类具有父类的成员变量和方法。 这个和生活中儿子继承他爹的家产差不多是一个道理，更有意思的是继承有两种模式，单继承和多继承，单继承比较好理解，一个子类只继承一个父类， 而多继承是一个子类，继承多个父类，联想到生活中，可能有好几个爸爸。</li><li>多态<br> 同一个行为具有多个不同表现形式或形态的能力，有两种表现形式覆盖和重载，这个到这里不理解也不要紧，下一篇文章会重点整理。 
  <ul><li>重载： 这个之前学习过，相同作用域中存在多个同名函数，但函数的参数列表会不一样</li><li>重写或者叫覆盖: 主要体现在继承关系里面，子类重写了从他爸那里继承过来的函数，如果子类的对象调用成员函数的时候，如果子类的成员函数重写了他爸的，那么就执行子类自己的函数，否则继承他爸的。 这个也比较好理解，比如同样是挣钱，他爸的路子很可能和儿子的不一样，那么儿子在调用挣钱的时候，肯定是先找找儿子有没有独特的挣钱方式，如果没有，就默认和他爸一样，走他爸的挣钱方式。</li></ul> </li></ul> 
<h4><a id="22__44"></a>2.2 再看继承</h4> 
<p>有了上面的宏观把握，再看继承就比较容易理解， 简单的讲，继承就是一个类从另一个类获取成员变量和成员函数的过程。 此时，被继承的类称为父类或基类，而继承的类称为子类或派生类。</p> 
<p>C++中派生和继承是站在不同角度看的同种概念。继承时从儿子的角度看，派生是父亲的角度看，实际说的是一回事。</p> 
<p>派生类除了拥有他爹的成员，还可以定义自己的新成员，增强功能，此时的好处就是只需要定义新成员即可，老的成员和功能，直接继承，实现了代码复用。</p> 
<p>下面是两种典型使用继承的场景：</p> 
<ol><li>创建的新类与现有类相似，只多出若干个成员变量和成员函数的时候，用继承，减少代码量，且新类会拥有基类的所有功能</li><li>创建多个类， 他们拥有很多相似的成员变量或函数，可以用继承，把这些类共同的成员提取出来，定义为基类，然后从基类继承， 可以减少代码量，也方便后续的修改。</li></ol> 
<p>继承的语法:</p> 
<pre><code class="prism language-cpp"><span class="token keyword">class</span> 派生类名<span class="token operator">:</span>［继承方式］ 基类名<span class="token punctuation">{<!-- --></span>
    派生类新增加的成员
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>直接看个栗子:</p> 
<pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">People</span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">setname</span><span class="token punctuation">(</span>string name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    string <span class="token function">getname</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    string m_name<span class="token punctuation">;</span>
    <span class="token keyword">int</span> m_age<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token class-name">People</span><span class="token operator">::</span><span class="token function">setname</span><span class="token punctuation">(</span>string name<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>m_name <span class="token operator">=</span> name<span class="token punctuation">;</span><span class="token punctuation">}</span>   
string <span class="token class-name">People</span><span class="token operator">::</span><span class="token function">getname</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token keyword">return</span> m_name<span class="token punctuation">;</span><span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">People</span></span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">setage</span><span class="token punctuation">(</span><span class="token keyword">int</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> <span class="token function">getage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">int</span> m_age<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token class-name">Student</span><span class="token operator">::</span><span class="token function">setage</span><span class="token punctuation">(</span><span class="token keyword">int</span> age<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>m_age <span class="token operator">=</span> age<span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token class-name">Student</span><span class="token operator">::</span><span class="token function">getage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token keyword">return</span> m_age<span class="token punctuation">;</span><span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    Student stu<span class="token punctuation">;</span>
    stu<span class="token punctuation">.</span><span class="token function">setname</span><span class="token punctuation">(</span><span class="token string">"zhongqiang"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    stu<span class="token punctuation">.</span><span class="token function">setage</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> stu<span class="token punctuation">.</span><span class="token function">getname</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"的年龄是"</span> <span class="token operator">&lt;&lt;</span> stu<span class="token punctuation">.</span><span class="token function">getage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>这个例子比较简单，不解释， 这里就会发现， Student继承了People之后，就有他的<code>setname()</code>和<code>getname()</code>方法，在子类里面可以直接调用。</p> 
<p>上面演示了public的继承方式，但继承方式其实有3种, public, private, protected, 这哥仨不仅可以修饰类的成员，还可以指定继承方式。如果不写，<strong>默认是private(成员变量和成员函数默认也是private)</strong>， 那么这三种继承方式到底有啥区别呢？</p> 
<h3><a id="3_C_100"></a>3. C++继承的三种方式</h3> 
<h4><a id="31__101"></a>3.1 哥仨修饰类成员</h4> 
<p>public, private, protected这哥仨，可以修饰类成员，之前见识过public和private了， 这里加上protected之后统一整理下访问权限的问题。</p> 
<p>类成员的访问权限从高到低依次是<code>public --&gt; protected --&gt; private</code>。 public成员可以通过对象来访问， private成员不能通过对象访问， protected成员和private成员蕾西， 也不能通过对象访问。</p> 
<p>But， 如果存在继承关系的时候， protected和private就不一样了: <strong>基类中的protected成员可以在派生类中使用，但是基类中的private成员不能再派生类中使用</strong>。</p> 
<h4><a id="32__108"></a>3.2 继承方式会影响基类成员在派生类中的访问权限</h4> 
<p>不同的继承方式使得基类成员在派生类中的访问权限也不一样， 下面这个很重要:</p> 
<ul><li>public继承方式 
  <ul><li>基类中所有public成员 -&gt; 继承到派生类 -&gt; public属性</li><li>基类中所有protected成员 -&gt; 继承到派生类 -&gt; protected 属性</li><li>基类中所有private 成员 -&gt; 继承到派生类 -&gt; 不能使用</li></ul> </li><li>protect继承方式 
  <ul><li>基类中所有public成员 -&gt; 继承到派生类 -&gt; protected属性</li><li>基类中所有protected成员 -&gt; 继承到派生类 -&gt; protected 属性</li><li>基类中所有private 成员 -&gt; 继承到派生类 -&gt; 不能使用</li></ul> </li><li>private继承方式 
  <ul><li>基类中所有public成员 -&gt; 继承到派生类 -&gt; private属性</li><li>基类中所有protected成员 -&gt; 继承到派生类 -&gt; private 属性</li><li>基类中所有private 成员 -&gt; 继承到派生类 -&gt; 不能使用</li></ul> </li></ul> 
<p>使用方法:</p> 
<ol><li>基类成员在派生类中的访问权限不得高于继承方式中指定的权限，也就是说**继承方式中的public, protected, private是用来指明基类成员在派生类中最高访问权限的。</li><li>不管继承方式如何， 基类中的private成员在派生类中始终不能使用(不能在派生类的成员函数中访问或者调用)</li><li>如果希望基类的成员能够在派生类继承并且使用， 那么这些成员应该声明public或者protected， 只有那些不希望在派生类中使用的成员声明为private</li><li>如果希望基类的成员既不向外暴露(不能通过对象访问)， 还能在派生类中使用， 那么就声明为protected。</li></ol> 
<p>下面通过上面的代码例子来演示下, 由于private和protect继承方式会改变基类成员在派生类中的访问权限，导致继承关系复杂， 所以实际开发中一般使用public。</p> 
<p>把上面的栗子修改下， 测试下上面的这几种情况，方便理解，这里只看public继承下面的。</p> 
<pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">People</span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">setname</span><span class="token punctuation">(</span>string name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    string <span class="token function">getname</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">setage</span><span class="token punctuation">(</span><span class="token keyword">int</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> <span class="token function">getage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">setsex</span><span class="token punctuation">(</span>string sex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    string <span class="token function">getsex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">setwork</span><span class="token punctuation">(</span>string work<span class="token punctuation">)</span><span class="token punctuation">;</span>
    string <span class="token function">getwork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 属性</span>
    string m_sex<span class="token punctuation">;</span>
    
<span class="token keyword">protected</span><span class="token operator">:</span>
    string m_work<span class="token punctuation">;</span>
    
<span class="token keyword">private</span><span class="token operator">:</span>
    string m_name<span class="token punctuation">;</span>
    <span class="token keyword">int</span> m_age<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token class-name">People</span><span class="token operator">::</span><span class="token function">setname</span><span class="token punctuation">(</span>string name<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>m_name <span class="token operator">=</span> name<span class="token punctuation">;</span><span class="token punctuation">}</span>   
string <span class="token class-name">People</span><span class="token operator">::</span><span class="token function">getname</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token keyword">return</span> m_name<span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token class-name">People</span><span class="token operator">::</span><span class="token function">setage</span><span class="token punctuation">(</span><span class="token keyword">int</span> age<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>m_age <span class="token operator">=</span> age<span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token class-name">People</span><span class="token operator">::</span><span class="token function">getage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token keyword">return</span> m_age<span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token class-name">People</span><span class="token operator">::</span><span class="token function">setsex</span><span class="token punctuation">(</span>string sex<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>m_sex<span class="token operator">=</span>sex<span class="token punctuation">;</span><span class="token punctuation">}</span>
string <span class="token class-name">People</span><span class="token operator">::</span><span class="token function">getsex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token keyword">return</span> m_sex<span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token class-name">People</span><span class="token operator">::</span><span class="token function">setwork</span><span class="token punctuation">(</span>string work<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>m_work<span class="token operator">=</span>work<span class="token punctuation">;</span><span class="token punctuation">}</span>
string <span class="token class-name">People</span><span class="token operator">::</span><span class="token function">getwork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token keyword">return</span> m_work<span class="token punctuation">;</span><span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">People</span></span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    
    <span class="token keyword">void</span> <span class="token function">setscore</span><span class="token punctuation">(</span><span class="token keyword">float</span> score<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> <span class="token function">getscore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 定义问候方法，这里面会访问基类的私有属性</span>
    string <span class="token function">helloname</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    string <span class="token function">hellowork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    string <span class="token function">hellosex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">float</span> m_score<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token class-name">Student</span><span class="token operator">::</span><span class="token function">setscore</span><span class="token punctuation">(</span><span class="token keyword">float</span> score<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>m_score <span class="token operator">=</span> score<span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token keyword">float</span> <span class="token class-name">Student</span><span class="token operator">::</span><span class="token function">getscore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token keyword">return</span> m_score<span class="token punctuation">;</span><span class="token punctuation">}</span>

<span class="token comment">// 访问基类中的公有属性</span>
string <span class="token class-name">Student</span><span class="token operator">::</span><span class="token function">hellosex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token keyword">return</span> <span class="token string">"hello, "</span> <span class="token operator">+</span> m_sex<span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token comment">// 访问基类中的protect属性</span>
string <span class="token class-name">Student</span><span class="token operator">::</span><span class="token function">hellowork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token keyword">return</span> <span class="token string">"hello, "</span> <span class="token operator">+</span> m_work<span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token comment">// 访问基类中的私有属性</span>
<span class="token comment">// string Student::helloname(){return "hello, " + m_name;}  error: 'std::string People::m_name' is private within this context</span>



<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    
    Student stu<span class="token punctuation">;</span>
    stu<span class="token punctuation">.</span><span class="token function">setname</span><span class="token punctuation">(</span><span class="token string">"zhongqiang"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    stu<span class="token punctuation">.</span><span class="token function">setsex</span><span class="token punctuation">(</span><span class="token string">"man"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    stu<span class="token punctuation">.</span><span class="token function">setwork</span><span class="token punctuation">(</span><span class="token string">"student"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    stu<span class="token punctuation">.</span><span class="token function">setage</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    stu<span class="token punctuation">.</span><span class="token function">setscore</span><span class="token punctuation">(</span><span class="token number">66.6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    cout <span class="token operator">&lt;&lt;</span> stu<span class="token punctuation">.</span><span class="token function">getname</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"今年"</span> <span class="token operator">&lt;&lt;</span> stu<span class="token punctuation">.</span><span class="token function">getage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">",性别: "</span> <span class="token operator">&lt;&lt;</span> stu<span class="token punctuation">.</span><span class="token function">getsex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">", 职业: "</span> <span class="token operator">&lt;&lt;</span> stu<span class="token punctuation">.</span><span class="token function">getwork</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">", 分数: "</span> <span class="token operator">&lt;&lt;</span> stu<span class="token punctuation">.</span><span class="token function">getscore</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    
    <span class="token comment">//cout &lt;&lt; stu.helloname() &lt;&lt; endl;</span>
    cout <span class="token operator">&lt;&lt;</span> stu<span class="token punctuation">.</span><span class="token function">hellowork</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> stu<span class="token punctuation">.</span><span class="token function">hellosex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    
    <span class="token comment">// 直接通过对象访问属性</span>
    cout <span class="token operator">&lt;&lt;</span> stu<span class="token punctuation">.</span>m_sex <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>     <span class="token comment">// 公有属性到子类中依然是公有， 可以被访问</span>
    <span class="token comment">//cout &lt;&lt; stu.m_name &lt;&lt; endl;  // error 'std::string People::m_name' is private within this context</span>
    <span class="token comment">//cout &lt;&lt; stu.m_work &lt;&lt; endl;   // error 'std::string People::m_work' is protected within this context</span>
    
    <span class="token comment">//cout &lt;&lt; stu.m_score &lt;&lt; endl;  // error 'float Student::m_score' is private within this context</span>
    
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在这里面就可以看出来， 在Student里面的成员函数中，只能访问到他爹的public属性和protect属性，不能访问他爹的private属性。而如果是通过Student的对象， 那么只能访问public属性，protect和private的都访问不到。</p> 
<p><mark>在派生类中访问基类的private成员的唯一方法就是借助基类的非private成员函数，如果基类没有非private成员函数，那么该成员在派生类中将无法访问</mark>。</p> 
<p>这里注意一个问题，这里说的是基类的 private 成员不能在派生类中使用，<strong>并不是说基类的 private 成员不能被继承</strong>。实际上，基类的 private 成员是能够被继承的，并且（成员变量）会占用派生类对象的内存，它只是<strong>在派生类中不可见，导致无法使用罢了</strong>。private 成员的这种特性，能够很好的对派生类隐藏基类的实现，以体现面向对象的封装性。</p> 
<p><img src="https://images2.imgbox.com/9a/63/iwG28Ypk_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="33_using_223"></a>3.3 using改变访问权限</h4> 
<p>using关键字可以改变基类成员在派生类中的访问权限， 比如将public改成private， protected改成public。</p> 
<p><mark>注意：using 只能改变基类中 public 和 protected 成员的访问权限，不能改变 private 成员的访问权限，因为基类中 private 成员在派生类中是不可见的，根本不能使用，所以基类中的 private 成员在派生类中无论如何都不能访问</mark></p> 
<pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">People</span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">setname</span><span class="token punctuation">(</span>string name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    string <span class="token function">getname</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">setage</span><span class="token punctuation">(</span><span class="token keyword">int</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> <span class="token function">getage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">setsex</span><span class="token punctuation">(</span>string sex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    string <span class="token function">getsex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">setwork</span><span class="token punctuation">(</span>string work<span class="token punctuation">)</span><span class="token punctuation">;</span>
    string <span class="token function">getwork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 属性</span>
    string m_sex<span class="token punctuation">;</span>
    
<span class="token keyword">protected</span><span class="token operator">:</span>
    string m_work<span class="token punctuation">;</span>
    
<span class="token keyword">private</span><span class="token operator">:</span>
    string m_name<span class="token punctuation">;</span>
    <span class="token keyword">int</span> m_age<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token class-name">People</span><span class="token operator">::</span><span class="token function">setname</span><span class="token punctuation">(</span>string name<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>m_name <span class="token operator">=</span> name<span class="token punctuation">;</span><span class="token punctuation">}</span>   
string <span class="token class-name">People</span><span class="token operator">::</span><span class="token function">getname</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token keyword">return</span> m_name<span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token class-name">People</span><span class="token operator">::</span><span class="token function">setage</span><span class="token punctuation">(</span><span class="token keyword">int</span> age<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>m_age <span class="token operator">=</span> age<span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token class-name">People</span><span class="token operator">::</span><span class="token function">getage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token keyword">return</span> m_age<span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token class-name">People</span><span class="token operator">::</span><span class="token function">setsex</span><span class="token punctuation">(</span>string sex<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>m_sex<span class="token operator">=</span>sex<span class="token punctuation">;</span><span class="token punctuation">}</span>
string <span class="token class-name">People</span><span class="token operator">::</span><span class="token function">getsex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token keyword">return</span> m_sex<span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token class-name">People</span><span class="token operator">::</span><span class="token function">setwork</span><span class="token punctuation">(</span>string work<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>m_work<span class="token operator">=</span>work<span class="token punctuation">;</span><span class="token punctuation">}</span>
string <span class="token class-name">People</span><span class="token operator">::</span><span class="token function">getwork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token keyword">return</span> m_work<span class="token punctuation">;</span><span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">People</span></span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    
    <span class="token keyword">void</span> <span class="token function">setscore</span><span class="token punctuation">(</span><span class="token keyword">float</span> score<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> <span class="token function">getscore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 定义问候方法，这里面会访问基类的私有属性</span>
    string <span class="token function">helloname</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    string <span class="token function">hellowork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    string <span class="token function">hellosex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">using</span> People<span class="token operator">::</span>m_work<span class="token punctuation">;</span>       <span class="token comment">// 将m_work提升成public权限</span>
    
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">float</span> m_score<span class="token punctuation">;</span>
    <span class="token keyword">using</span> People<span class="token operator">::</span>m_sex<span class="token punctuation">;</span>        <span class="token comment">// 将m_sex降低为private权限</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token class-name">Student</span><span class="token operator">::</span><span class="token function">setscore</span><span class="token punctuation">(</span><span class="token keyword">float</span> score<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>m_score <span class="token operator">=</span> score<span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token keyword">float</span> <span class="token class-name">Student</span><span class="token operator">::</span><span class="token function">getscore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token keyword">return</span> m_score<span class="token punctuation">;</span><span class="token punctuation">}</span>

<span class="token comment">// 访问基类中的公有属性</span>
string <span class="token class-name">Student</span><span class="token operator">::</span><span class="token function">hellosex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token keyword">return</span> <span class="token string">"hello, "</span> <span class="token operator">+</span> m_sex<span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token comment">// 访问基类中的protect属性</span>
string <span class="token class-name">Student</span><span class="token operator">::</span><span class="token function">hellowork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token keyword">return</span> <span class="token string">"hello, "</span> <span class="token operator">+</span> m_work<span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token comment">// 访问基类中的私有属性</span>
<span class="token comment">// string Student::helloname(){return "hello, " + m_name;}  error: 'std::string People::m_name' is private within this context</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    
    Student stu<span class="token punctuation">;</span>
    stu<span class="token punctuation">.</span><span class="token function">setname</span><span class="token punctuation">(</span><span class="token string">"zhongqiang"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    stu<span class="token punctuation">.</span><span class="token function">setsex</span><span class="token punctuation">(</span><span class="token string">"man"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    stu<span class="token punctuation">.</span><span class="token function">setwork</span><span class="token punctuation">(</span><span class="token string">"student"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    stu<span class="token punctuation">.</span><span class="token function">setage</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    stu<span class="token punctuation">.</span><span class="token function">setscore</span><span class="token punctuation">(</span><span class="token number">66.6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    cout <span class="token operator">&lt;&lt;</span> stu<span class="token punctuation">.</span><span class="token function">getname</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"今年"</span> <span class="token operator">&lt;&lt;</span> stu<span class="token punctuation">.</span><span class="token function">getage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">",性别: "</span> <span class="token operator">&lt;&lt;</span> stu<span class="token punctuation">.</span><span class="token function">getsex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">", 职业: "</span> <span class="token operator">&lt;&lt;</span> stu<span class="token punctuation">.</span><span class="token function">getwork</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">", 分数: "</span> <span class="token operator">&lt;&lt;</span> stu<span class="token punctuation">.</span><span class="token function">getscore</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
   
    <span class="token comment">// 直接通过对象访问属性</span>
    <span class="token comment">//cout &lt;&lt; stu.m_sex &lt;&lt; endl;     // 这个这时候就会报错了</span>
    cout <span class="token operator">&lt;&lt;</span> stu<span class="token punctuation">.</span>m_work <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>   <span class="token comment">// 这个就可以访问了</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>注意，using修改的是派生类里面的成员访问权限。并且是只能修改public和protected的访问权限。</p> 
<h3><a id="4_C_307"></a>4. C++继承时的名字遮蔽问题与作用域嵌套</h3> 
<h4><a id="41__308"></a>4.1 名字遮蔽问题</h4> 
<p>这个说的情况是派生类中的成员(变量和函数)，如果和基类中的成员重名，那么在派生类中使用该成员，实际上用的是派生类新增的成员，而不是从基类继承过来的。 即派生类遮蔽掉从基类继承过来的成员。</p> 
<p>下面的这个例子，是Student继承了People， 又重写了People的show函数，那么通过Student对象调用show的时候，实际上是用的Student自身的show函数，但People的show函数也被Student继承了过来，如果想用，需要加上类名和域解析符。</p> 
<pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">People</span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">protected</span><span class="token operator">:</span>
    string m_name<span class="token punctuation">;</span>
    <span class="token keyword">int</span> m_age<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token class-name">People</span><span class="token operator">::</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    cout <span class="token operator">&lt;&lt;</span> m_name <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span> <span class="token operator">&lt;&lt;</span> m_age <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span> 
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">People</span></span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">Student</span><span class="token punctuation">(</span>string name<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">,</span> string sex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 遮蔽基类的show()</span>
    
<span class="token keyword">private</span><span class="token operator">:</span>
    string m_sex<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token class-name">Student</span><span class="token operator">::</span><span class="token function">Student</span><span class="token punctuation">(</span>string name<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">,</span> string sex<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">m_sex</span><span class="token punctuation">(</span>sex<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    m_name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    m_age <span class="token operator">=</span> age<span class="token punctuation">;</span>
    <span class="token comment">//m_sex = sex;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">Student</span><span class="token operator">::</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    cout <span class="token operator">&lt;&lt;</span> m_name <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span> <span class="token operator">&lt;&lt;</span> m_age <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span> <span class="token operator">&lt;&lt;</span> m_sex <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    
    Student <span class="token function">stu</span><span class="token punctuation">(</span><span class="token string">"zhongqiang"</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token string">"man"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 派生类新增的成员函数</span>
    stu<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// zhongqiang 25 man</span>
    
    <span class="token comment">// 使用从基类继承过来的成员函数</span>
    stu<span class="token punctuation">.</span><span class="token class-name">People</span><span class="token operator">::</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// zhongqiang 25</span>
    
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>这里我在实验的时候，发现个问题，就是Student的构造函数定义的时候， 本来是想用构造函数初始化列表的方式，一开始写的代码是这样:</p> 
<pre><code class="prism language-cpp">
<span class="token class-name">Student</span><span class="token operator">::</span><span class="token function">Student</span><span class="token punctuation">(</span>string name<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">,</span> string sex<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">m_name</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m_age</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    m_sex <span class="token operator">=</span> sex<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>此时编译错误， 报错原因<code>class 'Student' does not have any field named 'm_name'</code>, 而如果写成上面那种形式，或者不用参数化列表的方式，就没问题， 所以这里我感觉，参数化列表那个地方的参数，应该是当前类具有的成员变量才行， 继承过来的应该是不能往这里写。</p> 
<p>上面的例子，其实就是派生类对基类的函数重写，内部在执行的时候， 先找派生类里面有没有对应的函数，如果有，就先执行派生类里面的重名函数，如果没有，那么再执行基类里面定义的。</p> 
<p>那么，如果派生类里面的函数和基类的函数重名，但形参列表不一样的时候，此时会发生重载现象吗？ 答： 不会。 一旦派生类中有同名函数，不管他们的参数是否一样，都会把基类中所有的同名函数遮蔽掉。</p> 
<p>这个就不用例子演示了，而是整理下背后的所以然吧。</p> 
<h4><a id="42__376"></a>4.2 作用域嵌套</h4> 
<p>之前整理过，每个类都会有自己的作用域， 在这个作用域内会定义类的成员，那么，当存在继承关系的时候， 派生类的作用域嵌套在基类的作用域之内，如果一个名字在派生类的作用域没有找到，编译器会继续到外层的基类作用域查找该名字的定义。<br> <img src="https://images2.imgbox.com/d2/83/pHsLgHVz_o.png" alt="在这里插入图片描述"><br> 两条:</p> 
<ul><li>一旦在外层作用域中声明或定义了某个名字， 那么它嵌套着的所有内层作用域都能访问这个名字</li><li>同时，允许在内层作用域重新定义外层作用域中已经有的名字</li></ul> 
<p>看个嵌套作用域的例子:</p> 
<pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token class-name">A</span><span class="token operator">::</span><span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> cout<span class="token operator">&lt;&lt;</span><span class="token string">"hello, changjinhu!!!"</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">B</span><span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">A</span></span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">5000</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> m<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">C</span><span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">B</span></span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">50000</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> x<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    C obj<span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> obj<span class="token punctuation">.</span>n <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    obj<span class="token punctuation">.</span><span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cout<span class="token operator">&lt;&lt;</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>C<span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>这个例子中的继承关系， B继承A， C继承B，那么作用域的嵌套关系如下:</p> 
<p><img src="https://images2.imgbox.com/65/d7/8dvrt06b_o.png" alt="在这里插入图片描述"></p> 
<ul><li>obj是C类的对象， 访问成员变量n时，由于C类自己有n， 那么编译器就会直接用，此时不会去B或者A中找，即派生类中的成员变量会遮蔽基类中的成员变量。</li><li>访问成员函数<code>func()</code>的时候，编译器没有在C类里面找到func这个名字，会继续到B作用域找，也没有找到，再往外，从A里面找到了，于是，调用A类作用域的<code>func()</code>函数。</li><li>对于成员变量，名字查找过程好理解，成员函数要注意，编译器<strong>仅仅是根据函数名字查找，不理会函数参数</strong>，所以一旦在内层作用域找到同名函数，不管有几个，编译器都不会再到外层作用域查找，编译器仅仅把最内层作用域的这些同名函数作为一组候选， 而也只有这组候选构成一组重载函数。 即<mark>只有一个作用域内的同名函数才会有重载关系，不同作用域的同名函数会造成遮蔽，外层函数会被内层遮蔽掉</mark>， 这其实也是重载和重写的一个区别了。</li></ul> 
<p>有了上面这些，就能回答上面的两点疑问:</p> 
<ol><li>构造函数的参数初始化列表那里， 初始化列表里面要列本类作用域里面的成员，如果是外层作用域，会报错找不到成员</li><li>派生类和基类拥有不同的作用域，所以它们的同名函数不具有重载关系， 而是重写或者覆盖。</li></ol> 
<h3><a id="5_C_423"></a>5. C++继承时的对象内存模型</h3> 
<p>没有继承时对象内存的分布情况，成员变量和成员函数分开存储：</p> 
<ul><li>对象的内存中只包含成员变量，存储在栈区或者堆区(new创建)</li><li>成员函数与对象内存分离，存储在代码区</li></ul> 
<p>有继承关系的时候， 派生类的内存模型可以看成是基类成员变量和新增成员变量的总和，所有成员函数仍然存储在另外一个区域–代码区，由所有对象共享。</p> 
<p>看个例子:</p> 
<pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">A</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">protected</span><span class="token operator">:</span>
    <span class="token keyword">int</span> m_a<span class="token punctuation">;</span>
    <span class="token keyword">int</span> m_b<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">A</span><span class="token operator">::</span><span class="token function">A</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">m_a</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m_b</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">B</span><span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">A</span></span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">B</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token keyword">int</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">int</span> m_c<span class="token punctuation">;</span>
    
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 这种参数初始化应该是这么写</span>
<span class="token class-name">B</span><span class="token operator">::</span><span class="token function">B</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token keyword">int</span> c<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">A</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m_c</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">C</span><span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">B</span></span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">C</span><span class="token punctuation">(</span><span class="token keyword">char</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token keyword">int</span> c<span class="token punctuation">,</span> <span class="token keyword">int</span> d<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">int</span> m_d<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">C</span><span class="token operator">::</span><span class="token function">C</span><span class="token punctuation">(</span><span class="token keyword">char</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token keyword">int</span> c<span class="token punctuation">,</span> <span class="token keyword">int</span> d<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">B</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m_d</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

<span class="token comment">// 成员遮蔽的情况</span>
<span class="token keyword">class</span> <span class="token class-name">D</span><span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">B</span></span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">D</span><span class="token punctuation">(</span><span class="token keyword">char</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token keyword">int</span> c<span class="token punctuation">,</span> <span class="token keyword">int</span> d<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">int</span> m_b<span class="token punctuation">;</span>    <span class="token comment">// 遮蔽A类的成员变量</span>
    <span class="token keyword">int</span> m_c<span class="token punctuation">;</span>    <span class="token comment">// 遮蔽B类的成员变量</span>
    <span class="token keyword">int</span> m_d<span class="token punctuation">;</span>    <span class="token comment">// 新增成员变量</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">D</span><span class="token operator">::</span><span class="token function">D</span><span class="token punctuation">(</span><span class="token keyword">char</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token keyword">int</span> c<span class="token punctuation">,</span> <span class="token keyword">int</span> d<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">B</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m_b</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m_c</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m_d</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
</code></pre> 
<p>这里面写了四个类，继承关系是A是最基类， B继承A，新增成员m_c， C继承B，新增成员m_d， D继承B，新增成员m_b, m_c, m_d， 前面两个产生了覆盖。</p> 
<p>成员函数不必多说，与成员变量分开，存到了代码区，这里主要看下成员变量每个类的内存存储情况。<br> <img src="https://images2.imgbox.com/e4/cc/qVQgCANW_o.png" alt="在这里插入图片描述"><br> 三点需要注意:</p> 
<ol><li>派生类的对象模型中，会包含所有基类的成员变量，但如果在派生类中通过派生成员函数访问到，必须基类的声明为protected或者public的。</li><li>基类的成员变量排在前面，派生类的成员变量排在后面</li><li>如果想在派生类构造函数中通过参数化列表给基类的成员变量赋值，此时要借助基类的构造函数才行，否则会报派生类field内找不到成员变量的问题，毕竟是继承过来的。</li></ol> 
<h3><a id="6_C_482"></a>6. C++基类和派生类的构造函数和析构函数</h3> 
<h4><a id="61__483"></a>6.1 构造函数</h4> 
<p>基类的成员函数可以被继承，可以通过派生类的对象访问，但<strong>类的构造函数不能被继承</strong>。</p> 
<p>在设计派生类时， 对继承过来的成员变量初始化工作也要由派生类的构造函数完成，但大部分基类都有Private属性的成员变量，在派生类无法访问(不能用派生类构造函数初始化)， 此时需要<strong>在派生类的构造函数中调用基类的构造函数</strong>。</p> 
<p>下面这个例子:</p> 
<pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">People</span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">People</span><span class="token punctuation">(</span>string name<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">protected</span><span class="token operator">:</span>
    string m_name<span class="token punctuation">;</span>
    <span class="token keyword">int</span> m_age<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">People</span><span class="token operator">::</span><span class="token function">People</span><span class="token punctuation">(</span>string name<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">m_name</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m_age</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">People</span></span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">Student</span><span class="token punctuation">(</span>string name<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">,</span> <span class="token keyword">float</span> score<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">float</span> m_score<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//People(name, age)是调用基类的构造函数</span>
<span class="token class-name">Student</span><span class="token operator">::</span><span class="token function">Student</span><span class="token punctuation">(</span>string name<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">,</span> <span class="token keyword">float</span> score<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">People</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m_score</span><span class="token punctuation">(</span>score<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token class-name">Student</span><span class="token operator">::</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    cout <span class="token operator">&lt;&lt;</span> m_name <span class="token operator">&lt;&lt;</span> m_age <span class="token operator">&lt;&lt;</span> m_score <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    Student <span class="token function">stu</span><span class="token punctuation">(</span><span class="token string">"zhongqaing"</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    stu<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>这里给基类的成员变量赋值的时候，是调用的基类的构造函数<code>People(name, age)</code>， 并将name和age作为实参传递给他，注意这里是调用，此时也可以用常量给他赋值，比如<code>People("zhongqiang", 25)</code>，这样子。</p> 
<p><mark>派生类的构造函数，总是先调用基类的构造函数再执行其他代码(包括参数初始化列表以及其他函数体的代码)</mark></p> 
<p>关于构造函数的调用顺序， 基类的构造函数总是被优先调用，即创建派生类对象的时候， 会先调用基类的构造函数，如果继承关系好几层<code>A --&gt; B --&gt; C</code>， 那么创建C类对象构造函数的执行顺序: <code>A类构造函数 --&gt; B类构造函数 --&gt; C类构造函数</code>，另外就是<strong>派生类构造函数中只能调用直接基类的构造函数，不能调用间接基类的</strong>，即C不能调用A的构造函数，只能调用B的。 这么做是因为在B里面调用了A的构造函数， C如果再调，可能A构造函数调用了多次，重复了初始化工作。</p> 
<blockquote> 
 <p>事实上，通过<strong>派生类创建对象时必须要调用基类的构造函数</strong>，这是语法规定。换句话说，<strong>定义派生类构造函数时最好指明基类构造函数；如果不指明，就调用基类的默认构造函数（不带参数的构造函数）</strong>；如果没有默认构造函数，那么编译失败</p> 
</blockquote> 
<h4><a id="62__527"></a>6.2 析构函数</h4> 
<p>和构造函数一样，析构函数也不能被继承，但派生类的析构函数中不用显式调用基类的析构函数，析构函数的执行顺序和构造函数的执行顺序恰好相反:</p> 
<ul><li>创建派生类对象时，构造函数的执行顺序和继承顺序相同，先执行基构造函数，再执行派生类构造函数</li><li>销毁派生类对象时，析构函数执行顺序和继承顺序相反，先执行派生类析构函数，再执行基类析构函数</li></ul> 
<pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>cout<span class="token operator">&lt;&lt;</span><span class="token string">"A constructor"</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span><span class="token punctuation">}</span>
    <span class="token operator">~</span><span class="token function">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>cout<span class="token operator">&lt;&lt;</span><span class="token string">"A destructor"</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">B</span><span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">A</span></span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>cout<span class="token operator">&lt;&lt;</span><span class="token string">"B constructor"</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span><span class="token punctuation">}</span>
    <span class="token operator">~</span><span class="token function">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>cout<span class="token operator">&lt;&lt;</span><span class="token string">"B destructor"</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">C</span><span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">B</span></span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">C</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>cout<span class="token operator">&lt;&lt;</span><span class="token string">"C constructor"</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span><span class="token punctuation">}</span>
    <span class="token operator">~</span><span class="token function">C</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>cout<span class="token operator">&lt;&lt;</span><span class="token string">"C destructor"</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    C test<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 结果</span>
A constructor
B constructor
C constructor
C destructor
B destructor
A destructor
</code></pre> 
<h3><a id="7_C_561"></a>7. C++多继承</h3> 
<p>派生类只有一个基类，这叫单继承，在C++里面，允许一个派生类有多个基类，这叫多继承</p> 
<blockquote> 
 <p>多继承容易让代码逻辑复杂，思路混乱，在Java中取消了多继承</p> 
</blockquote> 
<p>多继承语法:</p> 
<pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">D</span><span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">A</span><span class="token punctuation">,</span> <span class="token keyword">private</span> <span class="token class-name">B</span><span class="token punctuation">,</span> <span class="token keyword">protected</span> <span class="token class-name">C</span></span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//类D新增加的成员</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="71__572"></a>7.1 多继承下的构造函数</h4> 
<p>和单继承形式基本相同，在派生类中的构造函数中，要调用多个基类的构造函数。</p> 
<pre><code class="prism language-cpp"><span class="token function">D</span><span class="token punctuation">(</span>形参列表<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">A</span><span class="token punctuation">(</span>实参列表<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">B</span><span class="token punctuation">(</span>实参列表<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">C</span><span class="token punctuation">(</span>实参列表<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//其他操作</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>基类构造函数的调用顺序和和它们在派生类构造函数中出现的顺序无关，而是和声明派生类时基类出现的顺序相同。这个无论怎么在这里写这个顺序，总是先调用A类构造函数，然后调用B类，最后调用C类的。</p> 
<p>同理，析构函数的执行顺序和构造函数的执行顺序相反。</p> 
<p>当两个或者多个基类有同名成员，如果直接访问该成员，会产生命名冲突，编译器不知道使用哪个基类的成员，这时候，要在成员名字前面加上类名和域解析符<code>::</code>，显式的指明到底使用哪个类的成员，消除二义性。</p> 
<p>看个整体的例子:</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">BaseA</span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">BaseA</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">~</span><span class="token function">BaseA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">protected</span><span class="token operator">:</span>
    <span class="token keyword">int</span> m_a<span class="token punctuation">;</span>
    <span class="token keyword">int</span> m_b<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">BaseA</span><span class="token operator">::</span><span class="token function">BaseA</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span><span class="token operator">:</span><span class="token function">m_a</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m_b</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"BaseA constructor"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">BaseA</span><span class="token operator">::</span><span class="token operator">~</span><span class="token function">BaseA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"BaseA destructor"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token class-name">BaseA</span><span class="token operator">::</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"m_a = "</span> <span class="token operator">&lt;&lt;</span> m_a <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"m_b = "</span> <span class="token operator">&lt;&lt;</span> m_b <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">BaseB</span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">BaseB</span><span class="token punctuation">(</span><span class="token keyword">int</span> c<span class="token punctuation">,</span> <span class="token keyword">int</span> d<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">~</span><span class="token function">BaseB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">protected</span><span class="token operator">:</span>
    <span class="token keyword">int</span> m_c<span class="token punctuation">;</span>
    <span class="token keyword">int</span> m_d<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">BaseB</span><span class="token operator">::</span><span class="token function">BaseB</span><span class="token punctuation">(</span><span class="token keyword">int</span> c<span class="token punctuation">,</span> <span class="token keyword">int</span> d<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">m_c</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m_d</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"BaseB constructor"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">BaseB</span><span class="token operator">::</span><span class="token operator">~</span><span class="token function">BaseB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"BaseB destructor"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token class-name">BaseB</span><span class="token operator">::</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"m_c = "</span> <span class="token operator">&lt;&lt;</span> m_c <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"m_d = "</span> <span class="token operator">&lt;&lt;</span> m_d <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Derived</span><span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">BaseA</span><span class="token punctuation">,</span> <span class="token keyword">public</span> <span class="token class-name">BaseB</span></span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">Derived</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token keyword">int</span> c<span class="token punctuation">,</span> <span class="token keyword">int</span> d<span class="token punctuation">,</span> <span class="token keyword">int</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">~</span><span class="token function">Derived</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">int</span> m_e<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">Derived</span><span class="token operator">::</span><span class="token function">Derived</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token keyword">int</span> c<span class="token punctuation">,</span> <span class="token keyword">int</span> d<span class="token punctuation">,</span> <span class="token keyword">int</span> e<span class="token punctuation">)</span><span class="token operator">:</span><span class="token function">BaseA</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">BaseB</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m_e</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Derived constructor"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">Derived</span><span class="token operator">::</span><span class="token operator">~</span><span class="token function">Derived</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Derived destructor"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token class-name">Derived</span><span class="token operator">::</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token class-name">BaseA</span><span class="token operator">::</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 这里要加::限制</span>
    <span class="token class-name">BaseB</span><span class="token operator">::</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"m_e = "</span> <span class="token operator">&lt;&lt;</span> m_e <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    Derived <span class="token function">obj</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    obj<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 结果</span>
BaseA constructor
BaseB constructor
Derived constructor
m_a <span class="token operator">=</span> <span class="token number">1</span>
m_b <span class="token operator">=</span> <span class="token number">2</span>
m_c <span class="token operator">=</span> <span class="token number">3</span>
m_d <span class="token operator">=</span> <span class="token number">4</span>
m_e <span class="token operator">=</span> <span class="token number">5</span>
Derived destructor
BaseB destructor
BaseA destructor
</code></pre> 
<h4><a id="72__672"></a>7.2 多继承时的对象内存模型</h4> 
<p>这个其实和单继承时候的差不多，直接看个有覆盖的例子即可。</p> 
<pre><code class="prism language-cpp"><span class="token comment">//基类A</span>
<span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">A</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">protected</span><span class="token operator">:</span>
    <span class="token keyword">int</span> m_a<span class="token punctuation">;</span>
    <span class="token keyword">int</span> m_b<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">A</span><span class="token operator">::</span><span class="token function">A</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">m_a</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m_b</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> <span class="token punctuation">}</span>

<span class="token comment">//基类B</span>
<span class="token keyword">class</span> <span class="token class-name">B</span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">B</span><span class="token punctuation">(</span><span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token keyword">int</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">protected</span><span class="token operator">:</span>
    <span class="token keyword">int</span> m_b<span class="token punctuation">;</span>
    <span class="token keyword">int</span> m_c<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">B</span><span class="token operator">::</span><span class="token function">B</span><span class="token punctuation">(</span><span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token keyword">int</span> c<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">m_b</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m_c</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> <span class="token punctuation">}</span>

<span class="token comment">//派生类C</span>
<span class="token keyword">class</span> <span class="token class-name">C</span><span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">A</span><span class="token punctuation">,</span> <span class="token keyword">public</span> <span class="token class-name">B</span></span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">C</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token keyword">int</span> c<span class="token punctuation">,</span> <span class="token keyword">int</span> d<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">int</span> m_a<span class="token punctuation">;</span>
    <span class="token keyword">int</span> m_c<span class="token punctuation">;</span>
    <span class="token keyword">int</span> m_d<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">C</span><span class="token operator">::</span><span class="token function">C</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token keyword">int</span> c<span class="token punctuation">,</span> <span class="token keyword">int</span> d<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">A</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">B</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m_a</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m_c</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m_d</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> <span class="token punctuation">}</span>
</code></pre> 
<p>C继承A和B，主要是看下C里面内存分布图:</p> 
<p><img src="https://images2.imgbox.com/67/cd/iYP9XM5i_o.png" alt="在这里插入图片描述"><br> 基类对象的排列顺序和继承时候声明的顺序相同。</p> 
<h3><a id="8_C_714"></a>8. C++虚继承</h3> 
<h4><a id="81__715"></a>8.1 虚基类</h4> 
<p>多继承很容易产生命名冲突问题，比如下面这种情况：<br> <img src="https://images2.imgbox.com/ac/92/e6lfQznl_o.png" alt="在这里插入图片描述"><br> 类 A 派生出类 B 和类 C，类 D 继承自类 B 和类 C，这个时候类 A 中的成员变量和成员函数继承到类 D 中变成了两份，一份来自 <code>A--&gt;B--&gt;D</code> 这条路径，另一份来自 <code>A--&gt;C--&gt;D</code> 这条路径。</p> 
<p>在一个派生类中保留间接基类的多份同名成员，虽然可以在不同的成员变量中分别存放不同的数据，但大多数情况下这是多余的：因为保留多份成员变量不仅占用较多的存储空间，还容易产生命名冲突。假如类 A 有一个成员变量 a，那么在类 D 中直接访问 a 就会产生歧义，编译器不知道它究竟来自 <code>A --&gt;B--&gt;D</code> 这条路径，还是来自 <code>A--&gt;C--&gt;D</code> 这条路径。</p> 
<p>为了解决<strong>多继承</strong>时候命名冲突和冗余数据问题，C++提出了虚继承，使得派生类中只保留一份间接基类的成员。</p> 
<p>看个例子：</p> 
<pre><code class="prism language-cpp"><span class="token comment">// 间接基类A</span>
<span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">protected</span><span class="token operator">:</span>
    <span class="token keyword">int</span> m_a<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 直接基类B</span>
<span class="token keyword">class</span> <span class="token class-name">B</span><span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">virtual</span> <span class="token keyword">public</span> <span class="token class-name">A</span></span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">protected</span><span class="token operator">:</span>
    <span class="token keyword">int</span> m_b<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 直接基类C</span>
<span class="token keyword">class</span> <span class="token class-name">C</span><span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">virtual</span> <span class="token keyword">public</span> <span class="token class-name">A</span></span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">protected</span><span class="token operator">:</span>
    <span class="token keyword">int</span> m_c<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 派生类D</span>
<span class="token keyword">class</span> <span class="token class-name">D</span><span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">B</span><span class="token punctuation">,</span> <span class="token keyword">public</span> <span class="token class-name">C</span></span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">seta</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>m_a <span class="token operator">=</span> a<span class="token punctuation">;</span><span class="token punctuation">}</span>   <span class="token comment">// 如果不是虚继承， 这里会报错，编译器不知道这个m_a走的是B还是C这条线</span>
    <span class="token keyword">void</span> <span class="token function">setb</span><span class="token punctuation">(</span><span class="token keyword">int</span> b<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>m_b <span class="token operator">=</span> b<span class="token punctuation">;</span><span class="token punctuation">}</span>
    <span class="token keyword">void</span> <span class="token function">setc</span><span class="token punctuation">(</span><span class="token keyword">int</span> c<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>m_c <span class="token operator">=</span> c<span class="token punctuation">;</span><span class="token punctuation">}</span>
    <span class="token keyword">void</span> <span class="token function">setd</span><span class="token punctuation">(</span><span class="token keyword">int</span> d<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>m_d <span class="token operator">=</span> d<span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">int</span> m_d<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>虚继承的目的是让某个类做出声明， 承诺共享它的基类。 其中，这个被共享的基类被称为虚基类，比如这里的A。 在这种机制下， 不论虚基类在继承体系中出现了多少次，在派生类中都包含一份虚基类的成员。<br> <img src="https://images2.imgbox.com/40/fc/zN0ltvl6_o.png" alt="在这里插入图片描述"><br> 虚继承有一个不太直观的特征: <strong>必须在虚派生的真实需求出现前就已经完成虚派生的操作</strong>，比如当当以D类时才出现对虚派生的需求，但如果B类和C类不是从A类虚派生的，那么D还是会保留A的两份成员。 即<strong>虚派生只影响从指定了虚基类的派生类中进一步派生出来的类，不会影响派生类本身(B或者C)</strong></p> 
<blockquote> 
 <p>在实际开发中，位于中间层次的基类将其继承声明为虚继承一般不会带来什么问题。通常情况下，使用虚继承的类层次是由一个人或者一个项目组一次性设计完成的。对于一个独立开发的类来说，很少需要基类中的某一个类是虚基类，况且新类的开发者也无法改变已经存在的类体系。</p> 
</blockquote> 
<p>因为在虚继承的最终派生类中只保留了一份虚基类的成员，所以该成员可以被直接访问，不会产生二义性。此外，如果虚基类的成员只被一条派生路径覆盖，那么仍然可以直接访问这个被覆盖的成员。但是如果该成员被两条或多条路径覆盖了，那就不能直接访问了，此时必须指明该成员属于哪个类。</p> 
<p>比如，上面这个图， 假设A定义了一个x的成员变量，当在D中直接访问x的时候，会有三种可能性:</p> 
<ul><li>如果B和C都没有x的定义，那么x将被解析为A的成员，此时不存在二义性</li><li>如果B或C其中一个类定义了x，也不会有二义性，派生类的x要比虚基类的x优先级更高</li><li>如果B和C都定义了x，那么直接访问x会产生二义性问题。</li></ul> 
<p>总之， <strong>多继承不提倡使用，能用单一继承解决的问题，不要用多继承</strong>，这也是Java等不支持多继承的原因， 写多了容易混乱。</p> 
<h4><a id="82__768"></a>8.2 虚继承的构造函数</h4> 
<p>虚继承中，虚基类由最终的派生类进行初始化的，即<strong>最终派生类的构造函数必须要调用虚基类的构造函数</strong>。 对最终派生类来说， 虚基类是间接基类，不是直接基类。 这跟普通继承不同，在普通继承中，派生类构造函数只能调用直接基类的构造函数，不能调用间接基类的。</p> 
<p>下面这个例子，会体现虚继承和普通多继承的不一样:</p> 
<pre><code class="prism language-cpp"><span class="token comment">//虚基类A</span>
<span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">A</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">protected</span><span class="token operator">:</span>
    <span class="token keyword">int</span> m_a<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">A</span><span class="token operator">::</span><span class="token function">A</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">m_a</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> <span class="token punctuation">}</span>
<span class="token comment">//直接派生类B</span>
<span class="token keyword">class</span> <span class="token class-name">B</span><span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">virtual</span> <span class="token keyword">public</span> <span class="token class-name">A</span></span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">B</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">protected</span><span class="token operator">:</span>
    <span class="token keyword">int</span> m_b<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">B</span><span class="token operator">::</span><span class="token function">B</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">A</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m_b</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> <span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token class-name">B</span><span class="token operator">::</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    cout<span class="token operator">&lt;&lt;</span><span class="token string">"m_a="</span><span class="token operator">&lt;&lt;</span>m_a<span class="token operator">&lt;&lt;</span><span class="token string">", m_b="</span><span class="token operator">&lt;&lt;</span>m_b<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//直接派生类C</span>
<span class="token keyword">class</span> <span class="token class-name">C</span><span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">virtual</span> <span class="token keyword">public</span> <span class="token class-name">A</span></span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">C</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">protected</span><span class="token operator">:</span>
    <span class="token keyword">int</span> m_c<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">C</span><span class="token operator">::</span><span class="token function">C</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> c<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">A</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m_c</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> <span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token class-name">C</span><span class="token operator">::</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    cout<span class="token operator">&lt;&lt;</span><span class="token string">"m_a="</span><span class="token operator">&lt;&lt;</span>m_a<span class="token operator">&lt;&lt;</span><span class="token string">", m_c="</span><span class="token operator">&lt;&lt;</span>m_c<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//间接派生类D</span>
<span class="token keyword">class</span> <span class="token class-name">D</span><span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">B</span><span class="token punctuation">,</span> <span class="token keyword">public</span> <span class="token class-name">C</span></span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">D</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token keyword">int</span> c<span class="token punctuation">,</span> <span class="token keyword">int</span> d<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">int</span> m_d<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 这行比较关键  如果去掉A(a), error: no matching function for call to 'A::A()'</span>
<span class="token class-name">D</span><span class="token operator">::</span><span class="token function">D</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token keyword">int</span> c<span class="token punctuation">,</span> <span class="token keyword">int</span> d<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">A</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">B</span><span class="token punctuation">(</span><span class="token number">90</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">C</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m_d</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> <span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token class-name">D</span><span class="token operator">::</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    cout<span class="token operator">&lt;&lt;</span><span class="token string">"m_a="</span><span class="token operator">&lt;&lt;</span>m_a<span class="token operator">&lt;&lt;</span><span class="token string">", m_b="</span><span class="token operator">&lt;&lt;</span>m_b<span class="token operator">&lt;&lt;</span><span class="token string">", m_c="</span><span class="token operator">&lt;&lt;</span>m_c<span class="token operator">&lt;&lt;</span><span class="token string">", m_d="</span><span class="token operator">&lt;&lt;</span>m_d<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    B <span class="token function">b</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    b<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   
    C <span class="token function">c</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    c<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    D <span class="token function">d</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    d<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在上面D构造函数初始化的时候，除了调用B和C的构造函数，还调用了A的构造函数。说明D不但要负责初始化直接基类B和C，还要负责初始化间接基类A。 在<strong>以往普通多继承，派生类构造函数只负责初始化它直接基类，再由直接基类构造函数初始化间接基类</strong>。</p> 
<p>现在采用了虚继承，虚基类 A 在最终派生类 D 中只保留了一份成员变量 m_a，如果由 B 和 C 初始化 m_a，那么 B 和 C 在调用 A 的构造函数时很有可能给出不同的实参，这个时候编译器就会犯迷糊，不知道使用哪个实参初始化 m_a。</p> 
<p>为了避免出现这种矛盾的情况，C++ 干脆规定必须由最终的派生类 D 来初始化虚基类 A，直接派生类 B 和 C 对 A 的构造函数的调用是无效的。</p> 
<p>另外注意，构造函数的执行顺序。 <strong>虚继承构造函数的执行顺序和普通继承也不同</strong>， 在最终派生类构造函数调用列表中，不管各个构造函数出现的顺序如何，编译器总是先调用虚基类构造函数，再按照声明继承时候各个基类出现的顺序，相应调用他们的构造函数。</p> 
<h4><a id="83__842"></a>8.3 虚继承下的内存模型</h4> 
<p>对于普通继承，基类成员变量始终在派生类成员变量前面，且不管继承层次多深，相对于派生类对象顶部的偏移量固定。</p> 
<p>看个例子：</p> 
<pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">protected</span><span class="token operator">:</span>
    <span class="token keyword">int</span> m_a1<span class="token punctuation">;</span>
    <span class="token keyword">int</span> m_a2<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">B</span><span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">A</span></span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">protected</span><span class="token operator">:</span>
    <span class="token keyword">int</span> b1<span class="token punctuation">;</span>
    <span class="token keyword">int</span> b2<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">C</span><span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">B</span></span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">protected</span><span class="token operator">:</span>
    <span class="token keyword">int</span> c1<span class="token punctuation">;</span>
    <span class="token keyword">int</span> c2<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">D</span><span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">C</span></span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">protected</span><span class="token operator">:</span>
    <span class="token keyword">int</span> d1<span class="token punctuation">;</span>
    <span class="token keyword">int</span> d2<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    A obj_a<span class="token punctuation">;</span>
    B obj_b<span class="token punctuation">;</span>
    C obj_c<span class="token punctuation">;</span>
    D obj_d<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>这是一个多层单继承， 比较好理解，这时候，内存模型也非常容易画:</p> 
<p><img src="https://images2.imgbox.com/cc/b7/sIMij1jC_o.png" alt="在这里插入图片描述"><br> A 是最顶层的基类，在派生类 B、C、D 的对象中，A 类子对象始终位于最前面，偏移量是固定的，为 0。b1、b2 是派生类 B 的新增成员变量，它们的偏移量也是固定的，分别为 8 和 12。c1、c2、d1、d2 也是同样的道理。</p> 
<blockquote> 
 <p>编译器在知道对象首地址的情况下，通过计算偏移来存取成员变量。对于普通继承，基类成员变量的偏移是固定的，不会随着继承层级的增加而改变，存取起来非常方便。<br><br>但是，对于虚继承，恰恰和普通继承相反，<strong>大部分编译器会把基类成员变量放在派生类成员变量的后面，这样随着继承层级的增加，基类成员变量的偏移就会改变，就得通过其他方案计算偏移量</strong></p> 
</blockquote> 
<p>比如，上面假设A是B的虚基类， B是C的虚基类，那么各个对象的内存模型图编程下面这个样子:<br> <img src="https://images2.imgbox.com/89/c8/pKbKzsBR_o.png" alt="在这里插入图片描述"><br> 不管是虚基类的直接派生类还是间接派生类，虚基类的子对象始终位于派生类对象的最后面。上面图里面，虚继承时的派生类对象被分成了两部分:</p> 
<ul><li>不带阴影的一部分偏移量固定，不会随着继承层次增加而改变，称为固定部分</li><li>带阴影的一部分是虚基类的子对象，偏移量会随着继承层次增加而改变，称为共享部分</li></ul> 
<p>当访问对象的成员变量时，需要知道对象的首地址和变量的偏移，对象的首地址很好获得，关键是对象偏移。对于固定部分，偏移是不变的，好计算。 而对于共享部分，偏移会随着继承层次的增加而改变，这就需要设计一种方案，在偏移不断变化过程中准确计算偏移。 各个编译器可能不一样。</p> 
<blockquote> 
 <p>对于虚继承，将派生类分为固定部分和共享部分，并把共享部分放在最后，几乎所有的编译器都在这一点上达成了共识。主要的分歧就是如何计算共享部分的偏移，可谓是百花齐放，没有统一标准。</p> 
</blockquote> 
<p>这个比较复杂，只看一类编译器VC的解决。 VC引入了虚基类表，如果某个派生类有一个或多个虚基类，编译器就会在派生类对象中安插一个指针，指向虚基类表。 虚基类表就是一个数组，数组中的元素存放各个虚基类的偏移。</p> 
<p>假设A是B的虚基类， B是C的虚基类，那么有了虚基类表的内存模型:</p> 
<p><img src="https://images2.imgbox.com/29/92/aUtiBokn_o.png" alt="在这里插入图片描述"><br> 虚继承表中保存的是所有虚基类(直接继承和间接继承)相对于当前对象的偏移，这样通过派生类指针访问虚基类成员变量时，不管继承层次多深，只需要一次间接转换即可。</p> 
<h3><a id="9_C_899"></a>9. C++向上转型</h3> 
<p>C++中经常发生数据类型转换，比如int-&gt;float， 编译器先把int类型数据转为float再赋值，反过来也是同理， 数据类型转换的前提是<strong>编译器知道如何对数据取舍</strong>。</p> 
<p>类也是一种数据类型，也可以发生数据类型转换，不过这种转换只有在基类和派生类之间才有意义。并且只能派生类赋值给基类(对象，指针，引用)， 在C++中称为向上转型。向上转型比较安全，可以由编译器自动完成。</p> 
<h4><a id="91__904"></a>9.1 派生类对象赋值给基类对象</h4> 
<p>先来个例子:</p> 
<pre><code class="prism language-cpp"><span class="token comment">//基类</span>
<span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">A</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">int</span> m_a<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">A</span><span class="token operator">::</span><span class="token function">A</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">m_a</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> <span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token class-name">A</span><span class="token operator">::</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    cout<span class="token operator">&lt;&lt;</span><span class="token string">"Class A: m_a="</span><span class="token operator">&lt;&lt;</span>m_a<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//派生类</span>
<span class="token keyword">class</span> <span class="token class-name">B</span><span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">A</span></span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">B</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">int</span> m_b<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">B</span><span class="token operator">::</span><span class="token function">B</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">A</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m_b</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> <span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token class-name">B</span><span class="token operator">::</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    cout<span class="token operator">&lt;&lt;</span><span class="token string">"Class B: m_a="</span><span class="token operator">&lt;&lt;</span>m_a<span class="token operator">&lt;&lt;</span><span class="token string">", m_b="</span><span class="token operator">&lt;&lt;</span>m_b<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    A <span class="token function">a</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    B <span class="token function">b</span><span class="token punctuation">(</span><span class="token number">66</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//赋值前</span>
    a<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    b<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cout<span class="token operator">&lt;&lt;</span><span class="token string">"--------------"</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
    <span class="token comment">//赋值后</span>
    a <span class="token operator">=</span> b<span class="token punctuation">;</span>
    a<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    b<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 结果</span>
Class A<span class="token operator">:</span> m_a<span class="token operator">=</span><span class="token number">10</span>
Class B<span class="token operator">:</span> m_a<span class="token operator">=</span><span class="token number">66</span><span class="token punctuation">,</span> m_b<span class="token operator">=</span><span class="token number">99</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
Class A<span class="token operator">:</span> m_a<span class="token operator">=</span><span class="token number">66</span>    <span class="token comment">// 这里注意，a的成员m_a的值已经变了</span>
Class B<span class="token operator">:</span> m_a<span class="token operator">=</span><span class="token number">66</span><span class="token punctuation">,</span> m_b<span class="token operator">=</span><span class="token number">99</span>
</code></pre> 
<p>这里的B继承A， 由于派生类B包含了从基类A继承过来的成员，所以可以将派生对象b赋值给基类对象a。 此时再a.display()， 调用的是a的成员函数，访问的b中继承过来的成员变量。</p> 
<p><mark>赋值的本质是将现有的数据写入已分配好的内存，对象的内存只包含成员变量，所以对象之间的赋值时成员变量的赋值，成员函数不存在赋值问题</mark>。所以，对象之间的赋值不会影响成员函数，也不会影响this指针。</p> 
<p>将派生类对象赋值给基类对象的时候，会舍弃派生类新增的成员。</p> 
<p><img src="https://images2.imgbox.com/56/41/TGaF4L8k_o.png" alt="在这里插入图片描述"><br> 可以发现，即使将派生类对象赋值给基类对象，基类对象也不会包含派生类的成员，<strong>所以依然不同通过基类对象来访问派生类的成员</strong>。对于上面的例子，<code>a.m_a</code> 是正确的，但 <code>a.m_b</code> 就是错误的，因为 a 不包含成员 m_b。</p> 
<p>所以<strong>只能用派生类对象给基类对象赋值，而不能用基类对象给派生类对象赋值</strong>。因为基类不包含派生类成员变量。</p> 
<h4><a id="92__966"></a>9.2 派生类指针赋值给基类指针</h4> 
<p>派生类指针可以赋值给基类指针，看个例子:</p> 
<p><img src="https://images2.imgbox.com/c5/13/9lpEgdeA_o.png" alt="在这里插入图片描述"><br> 这个翻译成代码就是:</p> 
<pre><code class="prism language-cpp"><span class="token comment">//基类A</span>
<span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">A</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">protected</span><span class="token operator">:</span>
    <span class="token keyword">int</span> m_a<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">A</span><span class="token operator">::</span><span class="token function">A</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">m_a</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> <span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token class-name">A</span><span class="token operator">::</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    cout<span class="token operator">&lt;&lt;</span><span class="token string">"Class A: m_a="</span><span class="token operator">&lt;&lt;</span>m_a<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//中间派生类B</span>
<span class="token keyword">class</span> <span class="token class-name">B</span><span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">A</span></span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">B</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">protected</span><span class="token operator">:</span>
    <span class="token keyword">int</span> m_b<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">B</span><span class="token operator">::</span><span class="token function">B</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">A</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m_b</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> <span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token class-name">B</span><span class="token operator">::</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    cout<span class="token operator">&lt;&lt;</span><span class="token string">"Class B: m_a="</span><span class="token operator">&lt;&lt;</span>m_a<span class="token operator">&lt;&lt;</span><span class="token string">", m_b="</span><span class="token operator">&lt;&lt;</span>m_b<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//基类C</span>
<span class="token keyword">class</span> <span class="token class-name">C</span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">C</span><span class="token punctuation">(</span><span class="token keyword">int</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">protected</span><span class="token operator">:</span>
    <span class="token keyword">int</span> m_c<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">C</span><span class="token operator">::</span><span class="token function">C</span><span class="token punctuation">(</span><span class="token keyword">int</span> c<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">m_c</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> <span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token class-name">C</span><span class="token operator">::</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    cout<span class="token operator">&lt;&lt;</span><span class="token string">"Class C: m_c="</span><span class="token operator">&lt;&lt;</span>m_c<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//最终派生类D</span>
<span class="token keyword">class</span> <span class="token class-name">D</span><span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">B</span><span class="token punctuation">,</span> <span class="token keyword">public</span> <span class="token class-name">C</span></span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">D</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token keyword">int</span> c<span class="token punctuation">,</span> <span class="token keyword">int</span> d<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">int</span> m_d<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">D</span><span class="token operator">::</span><span class="token function">D</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token keyword">int</span> c<span class="token punctuation">,</span> <span class="token keyword">int</span> d<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">B</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">C</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m_d</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> <span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token class-name">D</span><span class="token operator">::</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    cout<span class="token operator">&lt;&lt;</span><span class="token string">"Class D: m_a="</span><span class="token operator">&lt;&lt;</span>m_a<span class="token operator">&lt;&lt;</span><span class="token string">", m_b="</span><span class="token operator">&lt;&lt;</span>m_b<span class="token operator">&lt;&lt;</span><span class="token string">", m_c="</span><span class="token operator">&lt;&lt;</span>m_c<span class="token operator">&lt;&lt;</span><span class="token string">", m_d="</span><span class="token operator">&lt;&lt;</span>m_d<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    A <span class="token operator">*</span>pa <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">A</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    B <span class="token operator">*</span>pb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">B</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    C <span class="token operator">*</span>pc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">C</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    D <span class="token operator">*</span>pd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">D</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">,</span> <span class="token number">4000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    pa <span class="token operator">=</span> pd<span class="token punctuation">;</span>
    pa <span class="token operator">-&gt;</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    pb <span class="token operator">=</span> pd<span class="token punctuation">;</span>
    pb <span class="token operator">-&gt;</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    pc <span class="token operator">=</span> pd<span class="token punctuation">;</span>
    pc <span class="token operator">-&gt;</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cout<span class="token operator">&lt;&lt;</span><span class="token string">"-----------------------"</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
    cout<span class="token operator">&lt;&lt;</span><span class="token string">"pa="</span><span class="token operator">&lt;&lt;</span>pa<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
    cout<span class="token operator">&lt;&lt;</span><span class="token string">"pb="</span><span class="token operator">&lt;&lt;</span>pb<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
    cout<span class="token operator">&lt;&lt;</span><span class="token string">"pc="</span><span class="token operator">&lt;&lt;</span>pc<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
    cout<span class="token operator">&lt;&lt;</span><span class="token string">"pd="</span><span class="token operator">&lt;&lt;</span>pd<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 结果如下</span>
Class A<span class="token operator">:</span> m_a<span class="token operator">=</span><span class="token number">4</span>
Class B<span class="token operator">:</span> m_a<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> m_b<span class="token operator">=</span><span class="token number">40</span>
Class C<span class="token operator">:</span> m_c<span class="token operator">=</span><span class="token number">400</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
pa<span class="token operator">=</span><span class="token number">0x9b17f8</span>
pb<span class="token operator">=</span><span class="token number">0x9b17f8</span>
pc<span class="token operator">=</span><span class="token number">0x9b1800</span>
pd<span class="token operator">=</span><span class="token number">0x9b17f8</span>
</code></pre> 
<p>这个例子里面，尝试将派生类指针赋值给基类指针。与对象变量赋值不同的是，对象指针之间并没有拷贝对象的成员，也没有修改对象本身的数据，仅仅是改变了指针的指向。</p> 
<p>所以这个要和对象变量赋值区分开了， 那个地方是会拷贝对象成员的，然后把数据填入，而这里只改变指针的指向。</p> 
<ol><li> <p>通过基类指针访问派生类的成员<br> 这里要知道<strong>将派生类指针赋值给基类指针时，通过基类指针只能使用派生类的成员变量，但不能使用派生类的成员函数</strong>， 这里得分析一下了。<br> <br>上面的<code>pa=pd，pa-&gt;display()</code>这行代码，将派生类指针pd赋值给了基类指针pa, 即pa指向了派生类D的对象，所以呢， 在<code>display()</code>内部使用的是D类对象的成员变量，但是呢？ 后面调用的成员函数却是基类的。 这是为啥呢？<br><br>编译器是通过指针的指向来访问成员变量，但不是通过指针的指向访问成员函数，<strong>编译器是通过指针的类型访问成员函数</strong>。这个在第二篇成员函数调用整理过。 编译器在编译的时候， 会给这个<code>display()</code>一个新的函数名，并且会传入一个当前对象的指针，通过这个指针访问成员变量。 即<code>new_func_name(A * const p){cout &lt;&lt; p-&gt;m_a;}</code>，这么看就容易理解了， p是A类的指针，指向的是D类对象，所以访问的时候，访问的D类成员变量。<br><br><mark>编译器通过指针访问成员变量，指针指向哪个对象就使用哪个对象的数据；<br>编译器通过指针的l类型访问成员函数，指针属于哪个类的类型就使用哪个类的函数。</mark></p> </li><li> <p>赋值前后不一致<br> 上面代码里面，将最终派生类的指针pd分别赋值给基类指针pa, pb, pc, 正常来讲，它们指向的同一块内存，值应该相等，但运行结果发现pc比较特殊，和那俩哥们的值并不一样。即<code>pc=pd</code>之后，pc和pd值不相等， why?<br><br>赋值是将一个变量的值交给另外一个变量，但注意，赋值以前，编译器可能对现有的值进行处理。比如double类型赋值给int类型，编译器会抹掉小数部分， 导致两边变量值不相等。<br><br><strong>派生类指针赋给基类指针的时候也是同理，编译器可能在赋值前进行处理</strong>。先看下D类对象的内存模型:<br> <img src="https://images2.imgbox.com/9e/a9/tN3RZeCG_o.png" alt="在这里插入图片描述"><br> <mark>对象的指针必须要指向对象的起始位置</mark>。对于A类和B类来说，它们子对象的起始位置和D类对象一样，所以将pd赋值给pa、pb时不需要做任何调整，直接传递现有的值。 而C类子对象距离D类对象的开头有一定偏移，将pd赋值给pc时要加上这个偏移，这样pc才能指向C类子对象的起始位置。 即执行<code>pc=pd</code>，编译器对pd的值进行了调整，导致了pc,pd的不同。<code>pc = (C*)( (int)pd + sizeof(B) );</code><br><br>如果将B，C的继承顺序换下</p> <pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">D</span><span class="token operator">:</span> <span class="token keyword">public</span> C<span class="token punctuation">,</span> <span class="token keyword">public</span> B
</code></pre> <p>此时，再输出，结果就变了</p> <pre><code class="prism language-cpp">pa<span class="token operator">=</span><span class="token number">0x4a5ed4</span>
pb<span class="token operator">=</span><span class="token number">0x4a5ed4</span>
pc<span class="token operator">=</span><span class="token number">0x4a5ed0</span>
pd<span class="token operator">=</span><span class="token number">0x4a5ed0</span>
</code></pre> <p>这个的原因是D类对象的内存模型成了下面这个样子:<br> <img src="https://images2.imgbox.com/f5/de/v1SWp1dZ_o.png" alt="在这里插入图片描述"><br> 所以呢， 原理就是这样啦。</p> </li></ol> 
<h4><a id="93___1082"></a>9.3 派生类引用赋值给基类引用</h4> 
<p>引用本质上通过指针方式实现，基类的指针可以指向派生类对象，那么基类的引用也指向派生类对象，表现和指针类型。</p> 
<p>这个就不详细整理了， 引用仅仅是指针简单封装， 只需要注意， 向上转型通过基类的对象，指针和引用只能访问从基类继承过去的成员(成员变量和成员函数)，不能访问派生类新增的成员。</p> 
<h3><a id="10_1088"></a>10.借助指针突破访问权限的限制</h3> 
<p>这里再补充一点小知识，算是开阔眼界了，实际中并用不到感觉。</p> 
<p>C++不允许通过对象访问private, protected属性的成员变量</p> 
<pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">A</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token keyword">int</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">int</span> m_a<span class="token punctuation">;</span>
    <span class="token keyword">int</span> m_b<span class="token punctuation">;</span>
    <span class="token keyword">int</span> m_c<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">A</span><span class="token operator">::</span><span class="token function">A</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token keyword">int</span> c<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">m_a</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m_b</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m_c</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> <span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    A <span class="token function">obj</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> a <span class="token operator">=</span> obj<span class="token punctuation">.</span>m_a<span class="token punctuation">;</span>  <span class="token comment">//Compile Error</span>
    A <span class="token operator">*</span>p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">A</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> b <span class="token operator">=</span> p<span class="token operator">-&gt;</span>m_b<span class="token punctuation">;</span>  <span class="token comment">//Compile Error</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>但是呢， 我们可以通过更加灵活的指针来突破这个限制。</p> 
<h4><a id="101__1113"></a>10.1 偏移</h4> 
<p>在对象模型中，成员变量和对象的开头位置会有一定的距离，比如上面的obj对象</p> 
<p><img src="https://images2.imgbox.com/e2/f3/CQoYgAO6_o.png" alt="在这里插入图片描述"><br> 假设它起始地址0x1000, m_a, m_b, m_c与对象开头分别相距0,4,8个字节，这个距离就是偏移。 一旦知道对象的起始位置，加上偏移，就能求出成员变量的地址。知道了成员变量的地址和类型，就能知道值。指针访问成员变量的时候，编译器也是用这种方式取得它的值。</p> 
<p><img src="https://images2.imgbox.com/e4/e2/ueuSNkXS_o.png" alt="在这里插入图片描述"></p> 
<p>所以，如果将成员变量的访问权限改为public的时候， 此时可以通过对象访问，而访问的背后，就是编译器通过指针偏移，对成员变量的寻址过程，比如：</p> 
<pre><code class="prism language-cpp"><span class="token keyword">int</span> b <span class="token operator">=</span> p<span class="token operator">-&gt;</span>m_b<span class="token punctuation">;</span>

<span class="token comment">// 编译器内部的转换</span>
<span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>p <span class="token operator">+</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="102__1129"></a>10.2 突破访问权限限制</h4> 
<p>我们如果想突破的话呢？ 手动计算偏移即可。</p> 
<p>比如上面的例子中，主函数修改了:</p> 
<pre><code class="prism language-cpp"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    A <span class="token function">obj</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> a1 <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>obj<span class="token punctuation">;</span>
    <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>obj <span class="token operator">+</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    A <span class="token operator">*</span>p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">A</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> a2 <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span>p<span class="token punctuation">;</span>
    <span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>p <span class="token operator">+</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
   
    cout<span class="token operator">&lt;&lt;</span><span class="token string">"a1="</span><span class="token operator">&lt;&lt;</span>a1<span class="token operator">&lt;&lt;</span><span class="token string">", a2="</span><span class="token operator">&lt;&lt;</span>a2<span class="token operator">&lt;&lt;</span><span class="token string">", b="</span><span class="token operator">&lt;&lt;</span>b<span class="token operator">&lt;&lt;</span><span class="token string">", c="</span><span class="token operator">&lt;&lt;</span>c<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>不过，上面这个代码有的编译器编译失败，会报<code>error: cast from 'A*' to 'int' loses precision</code>，这里知道原理就行了， 这种方法还是不要用。</p> 
<p>这篇内容有些多了，详细内容还是参考上面的第一个链接。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d369831731026989ab59177114e7e2f1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">opencv-python数字图像处理学习3：拉伸低对比度图像、过度曝光图像，观察图像变换，对图像直方图均衡算法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/49ed4cfae96a4be6b0fe01518917bd03/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">LOOP指令——汇编语言学习笔记3</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>