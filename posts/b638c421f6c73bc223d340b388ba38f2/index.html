<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Elasticsearch集群搭建（含开启安全认证详细步骤） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Elasticsearch集群搭建（含开启安全认证详细步骤）" />
<meta property="og:description" content="环境：
Elasticsearch: 6.8.0
Kibana: 6.8.0
1.下载Elasticsearch的tar.gz包
地址：https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.8.0.tar.gz
2.解压
tar -zxvf https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.8.0.tar.gz
3.单机版是可以直接启动的
./bin/elasticsearch -d 项目是可以直接启动的，访问http://localhost:9200就可以了。
至此，单机版ES就完成了。
4.集群搭建 vim /config/elasticsearch.yml 添加一下配置:
cluster.name: my_cluster node.name: node-1 node.master: true node.data: true network.host: 0.0.0.0 http.port: 9200 transport.tcp.port: 9300 discovery.zen.ping.unicast.hosts: [&#34;你的IP1:9300&#34;,&#34;你的IP2:9300&#34;,&#34;你的IP3:9300&#34;] discovery.zen.minimum_master_nodes: 1 bootstrap.memory_lock: false bootstrap.system_call_filter: false 需要修改的地方:你的IP部分替换成对应的IP地址就行了。
其他两个节点：
cluster.name: my_cluster node.name: node-2 node.master: true node.data: true network.host: 0.0.0.0 http.port: 9200 transport.tcp.port: 9300 discovery.zen.ping.unicast.hosts: [&#34;你的IP1:9300&#34;,&#34;你的IP2:9300&#34;,&#34;你的IP3:9300&#34;] discovery.zen.minimum_master_nodes: 1 bootstrap.memory_lock: false bootstrap.system_call_filter: false cluster.name: my_cluster node.name: node-2 node." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/b638c421f6c73bc223d340b388ba38f2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-03-29T23:38:46+08:00" />
<meta property="article:modified_time" content="2020-03-29T23:38:46+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Elasticsearch集群搭建（含开启安全认证详细步骤）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p></p> 
<p>环境：</p> 
<p>Elasticsearch: 6.8.0</p> 
<p>Kibana: 6.8.0</p> 
<p>1.下载Elasticsearch的tar.gz包</p> 
<p>    地址：https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.8.0.tar.gz</p> 
<p>2.解压</p> 
<p>    tar -zxvf https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.8.0.tar.gz</p> 
<p>3.单机版是可以直接启动的</p> 
<pre><code class="language-bash">./bin/elasticsearch -d</code></pre> 
<p>  项目是可以直接启动的，访问<u>http://localhost:9200</u>就可以了。</p> 
<p>  至此，单机版ES就完成了。</p> 
<p>4.集群搭建  </p> 
<pre><code class="language-bash">vim /config/elasticsearch.yml</code></pre> 
<p>  添加一下配置:</p> 
<pre><code>cluster.name: my_cluster
node.name: node-1
node.master: true
node.data: true
network.host: 0.0.0.0
http.port: 9200
transport.tcp.port: 9300
discovery.zen.ping.unicast.hosts: ["你的IP1:9300","你的IP2:9300","你的IP3:9300"]
discovery.zen.minimum_master_nodes: 1

bootstrap.memory_lock: false
bootstrap.system_call_filter: false</code></pre> 
<p>  需要修改的地方:你的IP部分替换成对应的IP地址就行了。</p> 
<p>  其他两个节点：</p> 
<pre><code>cluster.name: my_cluster
node.name: node-2
node.master: true
node.data: true
network.host: 0.0.0.0
http.port: 9200
transport.tcp.port: 9300
discovery.zen.ping.unicast.hosts: ["你的IP1:9300","你的IP2:9300","你的IP3:9300"]
discovery.zen.minimum_master_nodes: 1

bootstrap.memory_lock: false
bootstrap.system_call_filter: false</code></pre> 
<pre><code>cluster.name: my_cluster
node.name: node-2
node.master: true
node.data: true
network.host: 0.0.0.0
http.port: 9200
transport.tcp.port: 9300
discovery.zen.ping.unicast.hosts: ["你的IP1:9300","你的IP2:9300","你的IP3:9300"]
discovery.zen.minimum_master_nodes: 1

bootstrap.memory_lock: false
bootstrap.system_call_filter: false</code></pre> 
<p> 5.逐个启动节点</p> 
<pre><code class="language-bash">./bin/elasticsearch -d</code></pre> 
<p>到此，集群就搭建成功了。</p> 
<p>6.访问：http://你的IP1:9200 看到如下界面，说明启动成功了。</p> 
<p><img alt="" height="348" src="https://images2.imgbox.com/0d/1d/PbMVDmLZ_o.png" width="498"></p> 
<p>到这里，大家可能觉得就结束了。</p> 
<p>But，这个集群是没有安全认证的，在生产环境，这样的集群是及其容易被人攻击的。</p> 
<p>所以，想要建立以安全的ES集群，请往下看：</p> 
<p>开启ES集群的安全认证之路</p> 
<p>（这里说明一下，ES集群之间的节点是通过凭证来通信的，所以才有生成凭证这一步骤，大家别不耐烦，耐心看，仔细操作，能成功的）</p> 
<p>1. 生成证书：</p> 
<pre><code class="language-bash">./bin/elasticsearch-certutil ca</code></pre> 
<p>中间会让输入路径跟密码，路径可以不输，直接回车，但是密码还要设置一下的，为了安全嘛，我们就假定密码就是：123456</p> 
<p>完成后会生成一个文件：elastic-stack-ca.p12</p> 
<p>2.生成秘钥</p> 
<pre><code class="language-bash">bin/elasticsearch-certutil cert --ca elastic-stack-ca.p12</code></pre> 
<p>中间需要输入刚才设置的密码就直接输入就可以了，需要输入路径的地方就直接回车，别输了，然后会生成一个文件：elastic-certificates.p12</p> 
<p>这个就是ES的各个节点之间通信的凭证了。</p> 
<p>这里说明一下，一个ES集群生成一个凭证就可以了，其他节点不许要生成凭证。</p> 
<p>3.将凭证迁移到指定目录</p> 
<pre><code class="language-bash">mv /bin/elastic-certificates.p12 /config/certificates/</code></pre> 
<p>记得修改一下文件的权限（否则启动的时候会有权限问题）：</p> 
<pre><code class="language-bash">chmod 777 /config/certificates/elastic-certificates.p12</code></pre> 
<p>4.修改配置文件</p> 
<pre><code class="language-bash">vim /config/elasticsearch.yml</code></pre> 
<p>修改内容如下(把路径替换成相应的路径可以了)：</p> 
<pre><code>cluster.name: my_cluster
node.name: node-1
node.master: true
node.data: true
network.host: 0.0.0.0
http.port: 9200
transport.tcp.port: 9300
discovery.zen.ping.unicast.hosts: ["你的IP1:9300","你的IP2:9300","你的IP3:9300"]
discovery.zen.minimum_master_nodes: 1

bootstrap.memory_lock: false
bootstrap.system_call_filter: false

xpack.security.enabled: true
xpack.security.authc.accept_default_password: true
xpack.security.transport.ssl.enabled: true
xpack.security.transport.ssl.verification_mode: certificate
xpack.security.transport.ssl.keystore.path:/elasticsearch/config/certificates/elastic-certificates.p12
xpack.security.transport.ssl.truststore.path:/elasticsearch/config/certificates/elastic-certificates.p12</code></pre> 
<p>5. 将凭证同步到另外两个节点，同步骤3、4</p> 
<p>另外两节点的配置：</p> 
<pre><code>cluster.name: my_cluster
node.name: node-2
node.master: true
node.data: true
network.host: 0.0.0.0
http.port: 9200
transport.tcp.port: 9300
discovery.zen.ping.unicast.hosts: ["你的IP1:9300","你的IP2:9300","你的IP3:9300"]
discovery.zen.minimum_master_nodes: 1

bootstrap.memory_lock: false
bootstrap.system_call_filter: false

xpack.security.enabled: true
xpack.security.authc.accept_default_password: true
xpack.security.transport.ssl.enabled: true
xpack.security.transport.ssl.verification_mode: certificate
xpack.security.transport.ssl.keystore.path:/elasticsearch/config/certificates/elastic-certificates.p12
xpack.security.transport.ssl.truststore.path:/elasticsearch/config/certificates/elastic-certificates.p12</code></pre> 
<pre><code>cluster.name: my_cluster
node.name: node-3
node.master: true
node.data: true
network.host: 0.0.0.0
http.port: 9200
transport.tcp.port: 9300
discovery.zen.ping.unicast.hosts: ["你的IP1:9300","你的IP2:9300","你的IP3:9300"]
discovery.zen.minimum_master_nodes: 1

bootstrap.memory_lock: false
bootstrap.system_call_filter: false

xpack.security.enabled: true
xpack.security.authc.accept_default_password: true
xpack.security.transport.ssl.enabled: true
xpack.security.transport.ssl.verification_mode: certificate
xpack.security.transport.ssl.keystore.path:/elasticsearch/config/certificates/elastic-certificates.p12
xpack.security.transport.ssl.truststore.path:/elasticsearch/config/certificates/elastic-certificates.p12</code></pre> 
<p>6.这时候，大家是不是觉得可以启动集群了？错！！！还差最后一步：你还需要在各个节点上添加密码</p> 
<pre><code>bin/elasticsearch-keystore add xpack.security.transport.ssl.keystore.secure_password</code></pre> 
<p>输入密码：123456（之前设定的密码，请往上看）</p> 
<pre><code>bin/elasticsearch-keystore add xpack.security.transport.ssl.truststore.secure_password
</code></pre> 
<p>输入密码：123456（之前设定的密码，请往上看）</p> 
<p>7.逐个启动节点</p> 
<pre><code class="language-bash">./bin/elasticsearch -d</code></pre> 
<p>8.这时候打开  http://你的IP1:9200 看到如下画面</p> 
<p><img alt="" height="233" src="https://images2.imgbox.com/f3/d8/sGXacOkF_o.png" width="451"><br> 大家可能会有疑问了，我的账号跟密码在哪里呢？刚才的密码么？</p> 
<p>不是的，同学们，我们还没设置密码呢。</p> 
<p>9.设置密码：</p> 
<pre><code>/bin/elasticsearch-setup-passwords  interactive</code></pre> 
<p>然后逐个设置吧，记住，中间会有一个elastic账号的密码，然后在用户名跟密码栏填写上就可以了。</p> 
<p>至此ES集群的账号跟密码就设置完成了。</p> 
<p></p> 
<p>如果问题想咨询，可加企鹅：782861070</p> 
<p>可加技术交流群：72570834</p> 
<p><img alt="" height="653" src="https://images2.imgbox.com/95/4e/17ZDStal_o.png" width="463"></p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/17137ec3e87af22adc1cb002b7682893/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">[Vue warn]: Invalid prop: type check failed for prop &#34;total&#34;. Expected Number with value NaN报错详解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c917e0befa0281bafac694d89d6c755d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">通过pyarrow.jvm加速Python访问JDBC</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>