<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>入手3060显卡真香，却不知如何配置YOLOv5环境？ - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="入手3060显卡真香，却不知如何配置YOLOv5环境？" />
<meta property="og:description" content="！！此文若有版权上的冲突，望及时联系本人，本人会在受到消息的第一时间进行修改。！！
！！！注：请整篇文章读完再进行操作！！！
（文采有限、排版不佳，望各位读者多多包涵）
最近刚入手联想的r9000p/RTX3060系列笔记本，作为学生党使用真香~
但随之而来的问题就是由于硬件导致一些软件环境搭建十分繁琐，本人在学习机器视觉时需要借助YOLOv5来进行预训练，AI圈都知道深度学习跑起来需要NVIDIA显卡，但是3060显卡却不知如何正确匹配对应版本的pytorch，匹配之后YOLOv5依然无法正常运行到想要的结果。就以上问题，本人在此发表一篇博客，希望对各位读者起到一定帮助，同时作为以后自己搭建的参考。
1、进行YOLOv5训练的第一步就是配置一个虚拟环境（默认读者已经安装了Anaconda和pycharm），这边我们点击下方红勾，输入代码
conda create -n yolo python=3.8.5
创建一个名为yolo，python版本为3.8.5的虚拟环境(如果名字不同请记住自己的环境名)
2、虚拟环境创建成功后，输入exit()退出虚拟环境，打开你从网上下载、用yolov5实现的小demo，这边我也可以给各位推荐一个我看过的up主的视频链接(视频内含其口罩demo下载)
手把手教你使用YOLOV5训练自己的目标检测模型_哔哩哔哩_bilibili
在你的demo下载完成后找到下载的文件夹，输入cmd，如下图：
选中输入cmd之后开启终端模式，如下图所示
在此路径下激活刚刚你创建的虚拟环境，输入代码为：
activate yolo
红框为你的虚拟环境名，表示此demo已经在虚拟环境下运行。
3、在正式的YOLOv5环境准备前，还需要一个关键步骤就是修改镜像源，修改代码如下：
conda config --remove-key channels conda config --add channels https://mirrors.ustc.edu.cn/anaconda/pkgs/main/ conda config --add channels https://mirrors.ustc.edu.cn/anaconda/pkgs/free/ conda config --add channels https://mirrors.bfsu.edu.cn/anaconda/cloud/pytorch/ conda config --set show_channel_urls yes pip config set global.index-url https://mirrors.ustc.edu.cn/pypi/web/simple 直接将其复制到虚拟环境的终端内
到此准备完毕，开始YOLOv5的环境准备。
4、因为其他旧版本的都可搜到，本人在这就直接讲3060（其余3050系列显卡应该都一样）系列该如何搭配，避免读者们踩坑。
本人先使用的是pytorch 1.8.0版本的，正版链接：Previous PyTorch Versions | PyTorch，输入代码
修改完镜像源之后下载会很快，
conda install pytorch==1.10.1 torchvision==0.11.2 torchaudio==0.10.1 cudatoolkit=11.3 -c pytorch 下载完成后如图，" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/8e779031fde351d868c27232cabdd331/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-10-20T20:46:14+08:00" />
<meta property="article:modified_time" content="2022-10-20T20:46:14+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">入手3060显卡真香，却不知如何配置YOLOv5环境？</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p></p> 
<p> ！！此文若有版权上的冲突，望及时联系本人，本人会在受到消息的第一时间进行修改。！！</p> 
<p> ！！！注：请整篇文章读完再进行操作！！！</p> 
<p>（文采有限、排版不佳，望各位读者多多包涵）</p> 
<p>最近刚入手联想的r9000p/RTX3060系列笔记本，作为学生党使用真香~</p> 
<p>但随之而来的问题就是由于硬件导致一些软件环境搭建十分繁琐，本人在学习机器视觉时需要借助YOLOv5来进行预训练，AI圈都知道深度学习跑起来需要NVIDIA显卡，但是3060显卡却不知如何正确匹配对应版本的pytorch，匹配之后YOLOv5依然无法正常运行到想要的结果。就以上问题，本人在此发表一篇博客，希望对各位读者起到一定帮助，同时作为以后自己搭建的参考。</p> 
<p>1、进行YOLOv5训练的第一步就是配置一个虚拟环境（默认读者已经安装了Anaconda和pycharm），这边我们点击下方红勾，输入代码</p> 
<p>conda create -n yolo python=3.8.5</p> 
<p>创建一个名为yolo，python版本为3.8.5的虚拟环境(如果名字不同请记住自己的环境名)</p> 
<p class="img-center"><img alt="" height="420" src="https://images2.imgbox.com/e6/f3/a18z8Qa7_o.png" width="500"></p> 
<p> 2、虚拟环境创建成功后，输入exit()退出虚拟环境，打开你从网上下载、用yolov5实现的小demo，这边我也可以给各位推荐一个我看过的up主的视频链接(视频内含其口罩demo下载)</p> 
<p><a href="https://www.bilibili.com/video/BV1YL4y1J7xz?p=2&amp;spm_id_from=pageDriver" title="手把手教你使用YOLOV5训练自己的目标检测模型_哔哩哔哩_bilibili">手把手教你使用YOLOV5训练自己的目标检测模型_哔哩哔哩_bilibili</a></p> 
<p>在你的demo下载完成后找到下载的文件夹，输入cmd，如下图：</p> 
<p class="img-center"><img alt="" height="450" src="https://images2.imgbox.com/52/e3/eX7n9ng8_o.png" width="500"></p> 
<p></p> 
<p class="img-center"><img alt="" height="355" src="https://images2.imgbox.com/44/f8/li0DYYir_o.png" width="500"></p> 
<p></p> 
<p>选中输入cmd之后开启终端模式，如下图所示</p> 
<p class="img-center"><img alt="" height="261" src="https://images2.imgbox.com/4e/5e/LGI0D61q_o.png" width="500"></p> 
<p> 在此路径下激活刚刚你创建的虚拟环境，输入代码为：</p> 
<p> activate yolo</p> 
<p>红框为你的虚拟环境名，表示此demo已经在虚拟环境下运行。</p> 
<p><img alt="" height="241" src="https://images2.imgbox.com/2a/c7/Fs44YnvH_o.png" width="753"></p> 
<p> 3、在正式的YOLOv5环境准备前，还需要一个关键步骤就是修改镜像源，修改代码如下：</p> 
<pre><code class="language-Go">conda config --remove-key channels
conda config --add channels https://mirrors.ustc.edu.cn/anaconda/pkgs/main/
conda config --add channels https://mirrors.ustc.edu.cn/anaconda/pkgs/free/
conda config --add channels https://mirrors.bfsu.edu.cn/anaconda/cloud/pytorch/
conda config --set show_channel_urls yes
pip config set global.index-url https://mirrors.ustc.edu.cn/pypi/web/simple
</code></pre> 
<p><br> 直接将其复制到虚拟环境的终端内</p> 
<p><img alt="" height="512" src="https://images2.imgbox.com/5a/cf/YufTDaWf_o.png" width="1200"></p> 
<p> 到此准备完毕，开始YOLOv5的环境准备。</p> 
<p>4、因为其他旧版本的都可搜到，本人在这就直接讲3060（其余3050系列显卡应该都一样）系列该如何搭配，避免读者们踩坑。</p> 
<p>本人先使用的是pytorch 1.8.0版本的，正版链接：<a href="https://pytorch.org/get-started/previous-versions/" rel="nofollow" title="Previous PyTorch Versions | PyTorch">Previous PyTorch Versions | PyTorch</a>，输入代码</p> 
<p>修改完镜像源之后下载会很快，</p> 
<pre><code>conda install pytorch==1.10.1 torchvision==0.11.2 torchaudio==0.10.1 cudatoolkit=11.3 -c pytorch</code></pre> 
<p><img alt="" height="893" src="https://images2.imgbox.com/0b/01/WNKKSlak_o.png" width="1200"></p> 
<p>下载完成后如图，</p> 
<p><img alt="" height="161" src="https://images2.imgbox.com/8c/e0/9bn8CX69_o.png" width="714"></p> 
<p> 再检查cuda是否符合要求， </p> 
<blockquote> 
 <p>python</p> 
 <p>import torch</p> 
 <p>print(torch.__version__)</p> 
 <p>print(torch.cuda.is_available())</p> 
</blockquote> 
<p><img alt="" height="323" src="https://images2.imgbox.com/2d/c2/CGFIjb32_o.png" width="1200"></p> 
<p>看见false之后人是懵的，当时也不知道问题在哪，搜了之后才知道是安装的pytorch版本和显卡不匹配。</p> 
<p><img alt="" height="842" src="https://images2.imgbox.com/0e/80/DBKg4V65_o.png" width="1200"></p> 
<p> 打开NVIDIA控制面板，查看驱动版本为466.92，对照CUDA 的配置表，发现之前的版本确实不匹配，只能删除整个虚拟环境进行重新下载，当然也可以不删除虚拟环境，利用pip uninstall torch 进行pytorch的卸载，但考虑到可能有残留文件造成干扰，本人选择删除虚拟环境。</p> 
<p>看到此小伙伴们可能觉得有点坑，是的！你的想法没错，我当时搭建环境时安装了5次，从CPU跑--换GPU，cuda不匹配，删除修改，反反复复。</p> 
<p class="img-center"><img alt="" height="223" src="https://images2.imgbox.com/74/d7/p5S19lPg_o.png" width="554"></p> 
<p><img alt="" height="704" src="https://images2.imgbox.com/af/5d/QJKabfJ8_o.png" width="1200"></p> 
<p> 再查组件信息，发现个细节，NVIDIA已经告诉了应该使用什么版本的CUDA，前去官网<a href="https://pytorch.org/" rel="nofollow" title="PyTorch">PyTorch</a></p> 
<p> <img alt="" height="1038" src="https://images2.imgbox.com/8e/4a/QzZxvk1I_o.png" width="1200"></p> 
<p> 复制蓝色(加入后面的 -c pytorch变成外网下载，速度很慢)，下载完成后重复检测GPU是否合格，出现true，长舒口气~</p> 
<p><img alt="" height="468" src="https://images2.imgbox.com/b2/3d/o90b2s9Y_o.png" width="1200"></p> 
<p> 附下载版本：(亲测有效)</p> 
<pre><code>conda install pytorch==1.10.1 torchvision==0.11.2 torchaudio==0.10.1 cudatoolkit=11.3</code></pre> 
<p> <img alt="" height="461" src="https://images2.imgbox.com/66/67/heJcoK5x_o.png" width="1200"></p> 
<p>5、接着就是下载一些其他必备的工具，如</p> 
<p>pip install pycocotools-windows -i https://pypi.tuna.tsinghua.edu.cn/simple</p> 
<p>pip install -r requirements.txt</p> 
<p>pip install pyqt5</p> 
<p><img alt="" height="923" src="https://images2.imgbox.com/f5/43/BzsRQGPO_o.png" width="1156"></p> 
<p> 输入dir ，确保你在当前文件目录下。全部安装好之后就开启你的训练，你以为到此结束？NO</p> 
<p>6、输入 python detect.py --source data/images/bus.jpg --weights pretrained/yolov5s.pt</p> 
<p>进行训练，发现报错！！！蓝色线为报错提示。</p> 
<p><img alt="" height="911" src="https://images2.imgbox.com/f2/2a/qekgJR2p_o.png" width="1200"></p> 
<p> 修改，进入红色线的文件路径，磁盘不同、虚拟环境名字不同，路径中间也会有差异一定</p> 
<p>E:\StudyTools\Anaconda\conda\envs\yolo\Lib\site-packages\torch\nn\modules</p> 
<p><img alt="" height="968" src="https://images2.imgbox.com/e6/c4/QXyFjFIJ_o.png" width="1200"></p> 
<p>打开此upsampling.py文件，将代码注释并增添一行，之后就可正常运行，出现结果。</p> 
<p><img alt="" height="814" src="https://images2.imgbox.com/5f/bb/vwimh21f_o.png" width="1200"></p> 
<p>再次执行代码，结果储存在第三条红线文件夹路径内，成功！！！撒花</p> 
<p><img alt="" height="356" src="https://images2.imgbox.com/de/3b/NnaSpFBF_o.png" width="1200"></p> 
<p> 之后就是修改为你的数据集进行代码上的各种修改，我也正在摸索，就不在此多谈了。</p> 
<p>在此感谢b站up主肆十二-</p> 
<p></p> 
<p>22/4/16补充：如果跑val.py(验证集)时出现此类问题</p> 
<p><img alt="" height="618" src="https://images2.imgbox.com/d8/a9/DyWeTh4g_o.png" width="913"></p> 
<p> 是pytorch版本1.11与YOLOv5版本不兼容，需要降低pytorch版本(可能版主下载的YOLOv5demo模型不是最新版，导致pytorch不兼容)</p> 
<p>22/10/20补充：</p> 
<h4>报错1</h4> 
<p>"OSError: [WinError 1455] 页面文件太小,无法完成操作" 的解决方案：将文件所在磁盘虚拟内存设置一下，具体如下：</p> 
<p><strong><span style="background-color:#ffd900;">注意：步骤6中有的小伙伴没有E盘（新买的、没加固态的笔记本只有CD两个盘）就选D盘同样操作！！</span></strong></p> 
<p><img alt="" height="955" src="https://images2.imgbox.com/6f/85/vQEaJORV_o.png" width="976"></p> 
<h4> 报错2：一串码，开头是An http error.....后面是')))',如下图<img alt="" height="722" src="https://images2.imgbox.com/1e/3f/kj5dxJCq_o.png" width="1200"></h4> 
<p> 解决：</p> 
<p>用此代码先生成condarc文件，因为Windows 用户无法直接创建名为 .<code>condarc</code> 的文件。</p> 
<pre><code class="language-python">conda config --set show_channel_urls yes </code></pre> 
<p>接着找到condarc文件，双击打开，将镜像源中下面三行  https改成http</p> 
<p>  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main<br>   - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free<br>   - https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/pytorch</p> 
<p><strong><span style="background-color:#ffd900;">似乎不论清华源、阿里源、中科大源都可以，</span></strong></p> 
<h4><strong><span style="background-color:#ed7976;">注意！！！只改三行！！！</span></strong></h4> 
<pre><code class="language-python">channels:
  - defaults
show_channel_urls: true
channel_alias: https://mirrors.tuna.tsinghua.edu.cn/anaconda
default_channels:
  - http://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main
  - http://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free
  - http://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/pytorch

custom_channels:
  conda-forge: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
  msys2: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
  bioconda: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
  menpo: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
  pytorch: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
  simpleitk: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
</code></pre> 
<p> 之后重新下载pytorch就解决了。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3605c46f505fc2f4c8ae3bfd1cc935ef/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">渗透测试神器-CobaltStrike</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/53ead1900c5cd3acf8bb37a9ce3dcc36/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">软考-错题积累（计算机系统）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>