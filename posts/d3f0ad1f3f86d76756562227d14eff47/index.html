<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Kudu-客户端API编程、生态整合(Spark、Flink、Impala) - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Kudu-客户端API编程、生态整合(Spark、Flink、Impala)" />
<meta property="og:description" content="文章目录 Kudu客户端API编程客户端API核心类Java编程接口环境准备创建表插入数据查询数据修改表结构更新数据删除数据更新和插入删除表 Hadoop生态整合整合概述集成SparkSpark shell中操作Kudu代码整合Kudu&#43;Spark-项目准备DDLCUD批处理读写Kudu特别注意 集成Flink集成说明编译bahir-flflink项目准备批处理读写流处理写 集成Impala各组件之间的关系环境准备为什么整合Kudu&#43;Impala怎么整合Kudu&#43;Impala整合Kudu&#43;ImpalaImpala Shell中操作Kudu谓词下推 Kudu客户端API编程 客户端API核心类 Kudu提供了主流语言客户端API，核心类、方法是一致的，我们首先简要盘点下核心的这些类以便于我们写代码。
（1）Kudu client
AsyncKuduClient：完全异步且线程安全的Kudu客户端。该类应该只实例化一次，同时访问很多表。只有操纵多个不同集群才需要实例化多次。不会阻塞操作，可以关联回调函数用于操作完成时的动作。Builder模式创建。KuduClient：对AsyncKuduClient的封装，同步执行、线程安全的Kudu客户端，Builder模式创建。 （2）Schema
表示表结构，主要是column的集合。该类提供了一些工具方法用于查询操作。
（3）ColumnSchema
表示一column，使用builder构建。
（4）CreateTableOptions
Builder模式类，用于创建表。
（5）KuduTable
表示集群上的一张表。含有当前表结构信息，隶属于特定AsyncKuduClient。
（6）Session
AsyncKuduSession：隶属于特定KuduClient，代表一个上下文环境，所有写操作都会在该上下文中进行。在一个session中，可以对多个操作按批处理方式执行，以获得较好的性能。每个session都可以设置超时、优先级以及跟踪id等信息。 session和KuduClient是独立的，主要是在多线程环境下，不同线程需要并发执行事务，事务的边界是基于每 个session的BeginTransaction和commit之间的过程。 来自于不同session的写操作不会组织到一个RPC请求batch中，意味着延迟敏感的客户端（低延迟）和面向吞吐量的客户端（高延迟）使用同一KuduClient，每个Session中可以设置特定的超时和优先级。KuduSession：对AsyncKuduSession封装，同步执行，但非线程安全 （7）Insert/Update/Delete/Upsert
表示插入/更新/删除/插入或者更新操作，对象不可复用。
（8）PartialRow
表示一行的部分列。
（9）KuduScanner
扫描对象，用于条件查询及迭代获取结果集。
Java编程接口 环境准备 接下来我们只需要在pom.xml中导入相关依赖即可：
&lt;properties&gt; &lt;kudu.version&gt;1.10.0&lt;/kudu.version&gt; &lt;junit.version&gt;4.12&lt;/junit.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;!-- Kudu client --&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.kudu&lt;/groupId&gt; &lt;artifactId&gt;kudu-client&lt;/artifactId&gt; &lt;version&gt;${kudu.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!-- Log --&gt; &lt;dependency&gt; &lt;groupId&gt;org.slf4j&lt;/groupId&gt; &lt;artifactId&gt;slf4j-simple&lt;/artifactId&gt; &lt;version&gt;1.7.12&lt;/version&gt; &lt;/dependency&gt; &lt;!-- Unit test --&gt; &lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;version&gt;${junit.version}&lt;/version&gt; &lt;scope&gt;provided&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;!-- 指定具体仓库 --&gt; &lt;repositories&gt; &lt;repository&gt; &lt;id&gt;cdh." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/d3f0ad1f3f86d76756562227d14eff47/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-11T18:04:19+08:00" />
<meta property="article:modified_time" content="2023-07-11T18:04:19+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Kudu-客户端API编程、生态整合(Spark、Flink、Impala)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#KuduAPI_1" rel="nofollow">Kudu客户端API编程</a></li><li><ul><li><a href="#API_3" rel="nofollow">客户端API核心类</a></li><li><a href="#Java_47" rel="nofollow">Java编程接口</a></li><li><ul><li><a href="#_49" rel="nofollow">环境准备</a></li><li><a href="#_114" rel="nofollow">创建表</a></li><li><a href="#_163" rel="nofollow">插入数据</a></li><li><a href="#_225" rel="nofollow">查询数据</a></li><li><a href="#_292" rel="nofollow">修改表结构</a></li><li><a href="#_387" rel="nofollow">更新数据</a></li><li><a href="#_420" rel="nofollow">删除数据</a></li><li><a href="#_454" rel="nofollow">更新和插入</a></li><li><a href="#_497" rel="nofollow">删除表</a></li></ul> 
   </li></ul> 
   </li><li><a href="#Hadoop_526" rel="nofollow">Hadoop生态整合</a></li><li><ul><li><a href="#_528" rel="nofollow">整合概述</a></li><li><a href="#Spark_536" rel="nofollow">集成Spark</a></li><li><ul><li><a href="#Spark_shellKudu_538" rel="nofollow">Spark shell中操作Kudu</a></li><li><a href="#KuduSpark_546" rel="nofollow">代码整合Kudu+Spark-项目准备</a></li><li><a href="#DDL_707" rel="nofollow">DDL</a></li><li><a href="#CUD_769" rel="nofollow">CUD</a></li><li><a href="#Kudu_807" rel="nofollow">批处理读写Kudu</a></li><li><a href="#_886" rel="nofollow">特别注意</a></li></ul> 
    </li><li><a href="#Flink_903" rel="nofollow">集成Flink</a></li><li><ul><li><a href="#_905" rel="nofollow">集成说明</a></li><li><a href="#bahirflflink_926" rel="nofollow">编译bahir-flflink</a></li><li><a href="#_948" rel="nofollow">项目准备</a></li><li><a href="#_1105" rel="nofollow">批处理读写</a></li><li><a href="#_1202" rel="nofollow">流处理写</a></li></ul> 
    </li><li><a href="#Impala_1252" rel="nofollow">集成Impala</a></li><li><ul><li><a href="#_1254" rel="nofollow">各组件之间的关系</a></li><li><a href="#_1270" rel="nofollow">环境准备</a></li><li><a href="#KuduImpala_1282" rel="nofollow">为什么整合Kudu+Impala</a></li><li><a href="#KuduImpala_1296" rel="nofollow">怎么整合Kudu+Impala</a></li><li><a href="#KuduImpala_1329" rel="nofollow">整合Kudu+Impala</a></li><li><a href="#Impala_ShellKudu_1364" rel="nofollow">Impala Shell中操作Kudu</a></li><li><a href="#_1548" rel="nofollow">谓词下推</a></li></ul> 
   </li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="KuduAPI_1"></a>Kudu客户端API编程</h3> 
<h4><a id="API_3"></a>客户端API核心类</h4> 
<p>Kudu提供了主流语言客户端API，核心类、方法是一致的，我们首先简要盘点下核心的这些类以便于我们写代码。</p> 
<p><strong>（1）Kudu client</strong></p> 
<ul><li>AsyncKuduClient：完全异步且线程安全的Kudu客户端。该类应该只实例化一次，同时访问很多表。只有操纵多个不同集群才需要实例化多次。不会阻塞操作，可以关联回调函数用于操作完成时的动作。Builder模式创建。</li><li>KuduClient：对AsyncKuduClient的封装，同步执行、线程安全的Kudu客户端，Builder模式创建。</li></ul> 
<p><strong>（2）Schema</strong></p> 
<p>表示表结构，主要是column的集合。该类提供了一些工具方法用于查询操作。</p> 
<p><strong>（3）ColumnSchema</strong></p> 
<p>表示一column，使用builder构建。</p> 
<p><strong>（4）CreateTableOptions</strong></p> 
<p>Builder模式类，用于创建表。</p> 
<p><strong>（5）KuduTable</strong></p> 
<p>表示集群上的一张表。含有当前表结构信息，隶属于特定AsyncKuduClient。</p> 
<p><strong>（6）Session</strong></p> 
<ul><li>AsyncKuduSession：隶属于特定KuduClient，代表一个上下文环境，所有写操作都会在该上下文中进行。在一个session中，可以对多个操作按批处理方式执行，以获得较好的性能。每个session都可以设置超时、优先级以及跟踪id等信息。 session和KuduClient是独立的，主要是在多线程环境下，不同线程需要并发执行事务，事务的边界是基于每 个session的BeginTransaction和commit之间的过程。 来自于不同session的写操作不会组织到一个RPC请求batch中，意味着延迟敏感的客户端（低延迟）和面向吞吐量的客户端（高延迟）使用同一KuduClient，每个Session中可以设置特定的超时和优先级。</li><li>KuduSession：对AsyncKuduSession封装，同步执行，但非线程安全</li></ul> 
<p><strong>（7）Insert/Update/Delete/Upsert</strong></p> 
<p>表示插入/更新/删除/插入或者更新操作，对象不可复用。</p> 
<p><strong>（8）PartialRow</strong></p> 
<p>表示一行的部分列。</p> 
<p><strong>（9）KuduScanner</strong></p> 
<p>扫描对象，用于条件查询及迭代获取结果集。</p> 
<h4><a id="Java_47"></a>Java编程接口</h4> 
<h5><a id="_49"></a>环境准备</h5> 
<p>接下来我们只需要在pom.xml中导入相关依赖即可：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>kudu.version</span><span class="token punctuation">&gt;</span></span>1.10.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>kudu.version</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>junit.version</span><span class="token punctuation">&gt;</span></span>4.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>junit.version</span><span class="token punctuation">&gt;</span></span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span> 

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span> 
    <span class="token comment">&lt;!-- Kudu client --&gt;</span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.kudu<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>kudu-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${kudu.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span> 
    <span class="token comment">&lt;!-- Log --&gt;</span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>slf4j-simple<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.7.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span> 
    <span class="token comment">&lt;!-- Unit test --&gt;</span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${junit.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span> 

<span class="token comment">&lt;!-- 指定具体仓库 --&gt;</span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repositories</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repository</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>cdh.repo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>Cloudera Repositories<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>https://repository.cloudera.com/content/repositories/releases<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>snapshots</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>enabled</span><span class="token punctuation">&gt;</span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>enabled</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>snapshots</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repository</span><span class="token punctuation">&gt;</span></span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repositories</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>代码骨架：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestKudu</span> <span class="token punctuation">{<!-- --></span> 
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> 
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"hello kudu!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>定义一个常量KUDU_MASTERS存放Kudu master的连接信息(根据自己的实际情况改为你的IP或者主机名)：</p> 
<pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">KUDU_MASTERS</span> <span class="token operator">=</span> <span class="token string">"node01:7051,node02:7051,node03:7051"</span><span class="token punctuation">;</span>
</code></pre> 
<h5><a id="_114"></a>创建表</h5> 
<p>执行结果：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span> 
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testCreateTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">KuduException</span> <span class="token punctuation">{<!-- --></span> 
    <span class="token comment">//1、创建Schema </span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ColumnSchema</span><span class="token punctuation">&gt;</span></span> columns <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    columns<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ColumnSchema<span class="token punctuation">.</span>ColumnSchemaBuilder</span><span class="token punctuation">(</span><span class="token string">"uid"</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span><span class="token constant">INT8</span><span class="token punctuation">)</span> 
                <span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> 
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    columns<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ColumnSchema<span class="token punctuation">.</span>ColumnSchemaBuilder</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> 
                                                     <span class="token class-name">Type</span><span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nullable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> 
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    columns<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ColumnSchema<span class="token punctuation">.</span>ColumnSchemaBuilder</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span><span class="token constant">INT8</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token class-name">Schema</span> schema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span>columns<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">//2、指定表选项 </span>
    <span class="token comment">//2.1 建表选项 </span>
    <span class="token class-name">CreateTableOptions</span> tableOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CreateTableOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">//2.2 创建分区字段列表(必须是主键列) </span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> hashCls <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    hashCls<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"uid"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token keyword">int</span> numBuckets <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span> 
    <span class="token comment">//2.3 分区策略 </span>
    tableOptions<span class="token punctuation">.</span><span class="token function">addHashPartitions</span><span class="token punctuation">(</span>hashCls<span class="token punctuation">,</span>numBuckets<span class="token punctuation">)</span> 
        <span class="token punctuation">.</span><span class="token function">setNumReplicas</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">//3、创建KuduClient </span>
    <span class="token class-name">KuduClient</span> client<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span> 
    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span> 
        client<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">KuduClient<span class="token punctuation">.</span>KuduClientBuilder</span><span class="token punctuation">(</span><span class="token constant">KUDU_MASTERS</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token comment">//4、创建表 </span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>client<span class="token punctuation">.</span><span class="token function">tableExists</span><span class="token punctuation">(</span><span class="token string">"users"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> 
            client<span class="token punctuation">.</span><span class="token function">createTable</span><span class="token punctuation">(</span><span class="token string">"users"</span><span class="token punctuation">,</span> schema<span class="token punctuation">,</span> tableOptions<span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">".........create table success........."</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span> 
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">".........the table already exists ........."</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span> 
        <span class="token comment">//5、关闭资源 </span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token operator">!=</span>client<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> 
            client<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span> 
</code></pre> 
<h5><a id="_163"></a>插入数据</h5> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span> 
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testInsert</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">KuduException</span> <span class="token punctuation">{<!-- --></span> 
    <span class="token comment">//1、获得kudu客户端 </span>
    <span class="token class-name">KuduClient</span> client <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> 
    <span class="token comment">//2、打开表 </span>
    <span class="token class-name">KuduTable</span> table <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> 
    <span class="token comment">//3、创建会话 </span>
    <span class="token class-name">KuduSession</span> session <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> 
    <span class="token keyword">try</span><span class="token punctuation">{<!-- --></span>
        client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KuduClient 
            <span class="token punctuation">.</span>KuduClientBuilder</span><span class="token punctuation">(</span><span class="token constant">KUDU_MASTERS</span><span class="token punctuation">)</span> 
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        table <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">openTable</span><span class="token punctuation">(</span><span class="token string">"users"</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> 
        session <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">newSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        session<span class="token punctuation">.</span><span class="token function">setFlushMode</span><span class="token punctuation">(</span><span class="token class-name">SessionConfiguration<span class="token punctuation">.</span>FlushMode</span><span class="token punctuation">.</span><span class="token constant">AUTO_FLUSH_BACKGROUND</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        session<span class="token punctuation">.</span><span class="token function">setFlushInterval</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token comment">//4、循环插入10行记录 </span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span> <span class="token punctuation">;</span> i <span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> 
            <span class="token comment">//新建Insert对象 </span>
            <span class="token class-name">Insert</span> insert <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token function">newInsert</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> 
            <span class="token class-name">PartialRow</span> row <span class="token operator">=</span> insert<span class="token punctuation">.</span><span class="token function">getRow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> 
            row<span class="token punctuation">.</span><span class="token function">addByte</span><span class="token punctuation">(</span><span class="token string">"uid"</span> <span class="token punctuation">,</span> <span class="token class-name">Byte</span><span class="token punctuation">.</span><span class="token function">parseByte</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token comment">//i是偶数 </span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> 
                row<span class="token punctuation">.</span><span class="token function">setNull</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
                row<span class="token punctuation">.</span><span class="token function">addString</span><span class="token punctuation">(</span><span class="token string">"name"</span> <span class="token punctuation">,</span> <span class="token string">"name "</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token punctuation">}</span>
            row<span class="token punctuation">.</span><span class="token function">addByte</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span><span class="token class-name">Byte</span><span class="token punctuation">.</span><span class="token function">parseByte</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token comment">//加入session </span>
            session<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>insert<span class="token punctuation">)</span> <span class="token punctuation">;</span> 
        <span class="token punctuation">}</span>
        <span class="token comment">//5、关闭session </span>
        session<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> 
        <span class="token comment">//判断错误数 </span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>session<span class="token punctuation">.</span><span class="token function">countPendingErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> 
            <span class="token comment">//获得操作结果 </span>
            <span class="token class-name">RowErrorsAndOverflowStatus</span> result <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">getPendingErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> 
            <span class="token keyword">if</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">isOverflowed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> 
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"............buffer溢出!................."</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token punctuation">}</span>
            <span class="token class-name">RowError</span><span class="token punctuation">[</span><span class="token punctuation">]</span> errs <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">getRowErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> 
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">RowError</span> er <span class="token operator">:</span> errs<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> 
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>er<span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token punctuation">}</span> 
        <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span> 
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token operator">!=</span>client<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> 
            client<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="_225"></a>查询数据</h5> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span> 
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSelect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">KuduException</span> <span class="token punctuation">{<!-- --></span> 
    <span class="token comment">//1、获得kudu客户端 </span>
    <span class="token class-name">KuduClient</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KuduClient<span class="token punctuation">.</span>KuduClientBuilder</span><span class="token punctuation">(</span><span class="token constant">KUDU_MASTERS</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">//2、打开表 </span>
    <span class="token class-name">KuduTable</span> table <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">openTable</span><span class="token punctuation">(</span><span class="token string">"users"</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> 
    <span class="token comment">//3、扫描器 </span>
    <span class="token class-name">KuduScanner</span> scanner <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> 
    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//4、获取表结构 </span>
        <span class="token class-name">Schema</span> schema <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token function">getSchema</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> 
        <span class="token comment">//5、指定查询条件 </span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> projectColumns <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        projectColumns<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"uid"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        projectColumns<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        projectColumns<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token comment">//age &gt;= 0 </span>
        <span class="token keyword">int</span> lowerBound <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 
        <span class="token class-name">KuduPredicate</span> lowerPred <span class="token operator">=</span> 
            <span class="token class-name">KuduPredicate</span><span class="token punctuation">.</span><span class="token function">newComparisonPredicate</span><span class="token punctuation">(</span>schema<span class="token punctuation">.</span><span class="token function">getColumn</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
                                                 <span class="token class-name">KuduPredicate<span class="token punctuation">.</span>ComparisonOp</span><span class="token punctuation">.</span><span class="token constant">GREATER_EQUAL</span><span class="token punctuation">,</span> lowerBound<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token comment">//age &lt; 10 </span>
        <span class="token keyword">int</span> upperBound <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> 
        <span class="token class-name">KuduPredicate</span> upperPred <span class="token operator">=</span> 
            <span class="token class-name">KuduPredicate</span><span class="token punctuation">.</span><span class="token function">newComparisonPredicate</span><span class="token punctuation">(</span>schema<span class="token punctuation">.</span><span class="token function">getColumn</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
                                                 <span class="token class-name">KuduPredicate<span class="token punctuation">.</span>ComparisonOp</span><span class="token punctuation">.</span><span class="token constant">LESS</span><span class="token punctuation">,</span> upperBound<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        scanner <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">newScannerBuilder</span><span class="token punctuation">(</span>table<span class="token punctuation">)</span> 
            <span class="token punctuation">.</span><span class="token function">setProjectedColumnNames</span><span class="token punctuation">(</span>projectColumns<span class="token punctuation">)</span> 
            <span class="token punctuation">.</span><span class="token function">addPredicate</span><span class="token punctuation">(</span>lowerPred<span class="token punctuation">)</span> 
            <span class="token punctuation">.</span><span class="token function">addPredicate</span><span class="token punctuation">(</span>upperPred<span class="token punctuation">)</span> 
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token keyword">int</span> resultCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 
        <span class="token keyword">while</span> <span class="token punctuation">(</span>scanner<span class="token punctuation">.</span><span class="token function">hasMoreRows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> 
            <span class="token class-name">RowResultIterator</span> results <span class="token operator">=</span> scanner<span class="token punctuation">.</span><span class="token function">nextRows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token keyword">while</span> <span class="token punctuation">(</span>results<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> 
                <span class="token class-name">RowResult</span> result <span class="token operator">=</span> results<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
                <span class="token keyword">byte</span> uid <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">getByte</span><span class="token punctuation">(</span><span class="token string">"uid"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
                <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token punctuation">;</span> 
                <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">isNull</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> 
                    name <span class="token operator">=</span> <span class="token string">"不存在"</span> <span class="token punctuation">;</span> 
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
                    name <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> 
                <span class="token punctuation">}</span>
                <span class="token keyword">byte</span> age <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">getByte</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"uid=%d, name=%s, age=%drn"</span> <span class="token punctuation">,</span> uid 
                                  <span class="token punctuation">,</span>name<span class="token punctuation">,</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span> 
                resultCount<span class="token operator">++</span><span class="token punctuation">;</span> 
            <span class="token punctuation">}</span> 
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"-----------------------"</span><span class="token operator">+</span>resultCount<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        scanner<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> 
    <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span> 
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token operator">!=</span>client<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> 
            client<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="_292"></a>修改表结构</h5> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span> 
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testAlterTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span> 
    <span class="token comment">//1、获得kudu客户端 </span>
    <span class="token class-name">KuduClient</span> client <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> 
    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//2、修改表选项 </span>
        <span class="token class-name">AlterTableOptions</span> ato <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AlterTableOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> 
        ato<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">"wage"</span> <span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span><span class="token constant">DOUBLE</span> <span class="token punctuation">,</span> <span class="token number">10000.000</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> 
        <span class="token comment">//3、修改表结构 </span>
        client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KuduClient<span class="token punctuation">.</span>KuduClientBuilder</span><span class="token punctuation">(</span><span class="token constant">KUDU_MASTERS</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token keyword">if</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span><span class="token function">tableExists</span><span class="token punctuation">(</span><span class="token string">"users"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> 
            client<span class="token punctuation">.</span><span class="token function">alterTable</span><span class="token punctuation">(</span><span class="token string">"users"</span> <span class="token punctuation">,</span> ato<span class="token punctuation">)</span> <span class="token punctuation">;</span> 
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"........alterTable success.........."</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span> 
        <span class="token comment">//4、关闭资源 </span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token operator">!=</span>client<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> 
            client<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span> 
</code></pre> 
<p>修改完再次查询：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span> 
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSelect2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">KuduException</span> <span class="token punctuation">{<!-- --></span> 
    <span class="token comment">//1、获得kudu客户端 </span>
    <span class="token class-name">KuduClient</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KuduClient<span class="token punctuation">.</span>KuduClientBuilder</span><span class="token punctuation">(</span><span class="token constant">KUDU_MASTERS</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">//2、打开表 </span>
    <span class="token class-name">KuduTable</span> table <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">openTable</span><span class="token punctuation">(</span><span class="token string">"users"</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> 
    <span class="token comment">//3、扫描器 </span>
    <span class="token class-name">KuduScanner</span> scanner <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> 
    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//4、获取表结构 </span>
        <span class="token class-name">Schema</span> schema <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token function">getSchema</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> 
        <span class="token comment">//5、指定查询条件 </span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> projectColumns <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        projectColumns<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"uid"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        projectColumns<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        projectColumns<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        projectColumns<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"wage"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token comment">//age &gt;= 0 </span>
        <span class="token keyword">int</span> lowerBound <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 
        <span class="token class-name">KuduPredicate</span> lowerPred <span class="token operator">=</span> 
            <span class="token class-name">KuduPredicate</span><span class="token punctuation">.</span><span class="token function">newComparisonPredicate</span><span class="token punctuation">(</span>schema<span class="token punctuation">.</span><span class="token function">getColumn</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
                                                 <span class="token class-name">KuduPredicate<span class="token punctuation">.</span>ComparisonOp</span><span class="token punctuation">.</span><span class="token constant">GREATER_EQUAL</span><span class="token punctuation">,</span> lowerBound<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token comment">//age &lt; 10 </span>
        <span class="token keyword">int</span> upperBound <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> 
        <span class="token class-name">KuduPredicate</span> upperPred <span class="token operator">=</span> 
            <span class="token class-name">KuduPredicate</span><span class="token punctuation">.</span><span class="token function">newComparisonPredicate</span><span class="token punctuation">(</span>schema<span class="token punctuation">.</span><span class="token function">getColumn</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
                                                 <span class="token class-name">KuduPredicate<span class="token punctuation">.</span>ComparisonOp</span><span class="token punctuation">.</span><span class="token constant">LESS</span><span class="token punctuation">,</span> upperBound<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        scanner <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">newScannerBuilder</span><span class="token punctuation">(</span>table<span class="token punctuation">)</span> 
            <span class="token punctuation">.</span><span class="token function">setProjectedColumnNames</span><span class="token punctuation">(</span>projectColumns<span class="token punctuation">)</span> 
            <span class="token punctuation">.</span><span class="token function">addPredicate</span><span class="token punctuation">(</span>lowerPred<span class="token punctuation">)</span> 
            <span class="token punctuation">.</span><span class="token function">addPredicate</span><span class="token punctuation">(</span>upperPred<span class="token punctuation">)</span> 
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token keyword">int</span> resultCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 
        <span class="token keyword">while</span> <span class="token punctuation">(</span>scanner<span class="token punctuation">.</span><span class="token function">hasMoreRows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> 
            <span class="token class-name">RowResultIterator</span> results <span class="token operator">=</span> scanner<span class="token punctuation">.</span><span class="token function">nextRows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token keyword">while</span> <span class="token punctuation">(</span>results<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> 
                <span class="token class-name">RowResult</span> result <span class="token operator">=</span> results<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
                <span class="token keyword">byte</span> uid <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">getByte</span><span class="token punctuation">(</span><span class="token string">"uid"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
                <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token punctuation">;</span> 
                <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">isNull</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> 
                    name <span class="token operator">=</span> <span class="token string">"不存在"</span> <span class="token punctuation">;</span> 
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
                    name <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> 
                <span class="token punctuation">}</span>
                <span class="token keyword">byte</span> age <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">getByte</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
                <span class="token keyword">double</span> wage <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">getDouble</span><span class="token punctuation">(</span><span class="token string">"wage"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"uid=%d, name=%s, age=%d, wage=%frn"</span> <span class="token punctuation">,</span> uid 
                                  <span class="token punctuation">,</span>name<span class="token punctuation">,</span>age<span class="token punctuation">,</span>wage<span class="token punctuation">)</span><span class="token punctuation">;</span> 
                resultCount<span class="token operator">++</span><span class="token punctuation">;</span> 
            <span class="token punctuation">}</span> 
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"-----------------------"</span><span class="token operator">+</span>resultCount<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        scanner<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> 
    <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span> 
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token operator">!=</span>client<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> 
            client<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="_387"></a>更新数据</h5> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span> 
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span> 
    <span class="token comment">//1、获得kudu客户端 </span>
    <span class="token class-name">KuduClient</span> client <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> 
    <span class="token comment">//2、打开表 </span>
    <span class="token class-name">KuduTable</span> table <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> 
    <span class="token comment">//3、会话 </span>
    <span class="token class-name">KuduSession</span> session <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> 
    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KuduClient<span class="token punctuation">.</span>KuduClientBuilder</span><span class="token punctuation">(</span><span class="token constant">KUDU_MASTERS</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        table <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">openTable</span><span class="token punctuation">(</span><span class="token string">"users"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        session <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">newSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token comment">//4、创建并执行update操作 </span>
        <span class="token class-name">Update</span> update <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token function">newUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token class-name">PartialRow</span> row <span class="token operator">=</span> update<span class="token punctuation">.</span><span class="token function">getRow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        row<span class="token punctuation">.</span><span class="token function">addByte</span><span class="token punctuation">(</span><span class="token string">"uid"</span><span class="token punctuation">,</span> <span class="token class-name">Byte</span><span class="token punctuation">.</span><span class="token function">parseByte</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token operator">+</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        row<span class="token punctuation">.</span><span class="token function">addDouble</span><span class="token punctuation">(</span><span class="token string">"wage"</span><span class="token punctuation">,</span> <span class="token number">20000.000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        session<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>update<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        session<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span> 
        <span class="token comment">//5、关闭资源 </span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token operator">!=</span>client<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> 
            client<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="_420"></a>删除数据</h5> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span> 
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDelete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span> 
    <span class="token comment">//1、获得kudu客户端 </span>
    <span class="token class-name">KuduClient</span> client <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> 
    <span class="token comment">//2、打开表 </span>
    <span class="token class-name">KuduTable</span> table <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> 
    <span class="token comment">//3、会话 </span>
    <span class="token class-name">KuduSession</span> session <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> 
    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KuduClient<span class="token punctuation">.</span>KuduClientBuilder</span><span class="token punctuation">(</span><span class="token constant">KUDU_MASTERS</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        table <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">openTable</span><span class="token punctuation">(</span><span class="token string">"users"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        session <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">newSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token comment">//4、新建并执行Delete操作 </span>
        <span class="token class-name">Delete</span> delete <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token function">newDelete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token comment">//得到row </span>
        <span class="token class-name">PartialRow</span> row <span class="token operator">=</span> delete<span class="token punctuation">.</span><span class="token function">getRow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token comment">//where key = 0 </span>
        row<span class="token punctuation">.</span><span class="token function">addByte</span><span class="token punctuation">(</span><span class="token string">"uid"</span><span class="token punctuation">,</span> <span class="token class-name">Byte</span><span class="token punctuation">.</span><span class="token function">parseByte</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">+</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        session<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>delete<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        session<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span> 
        <span class="token comment">//5、关闭资源 </span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token operator">!=</span>client<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> 
            client<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="_454"></a>更新和插入</h5> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span> 
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testUpsert</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span> 
    <span class="token comment">//1、获得kudu客户端 </span>
    <span class="token class-name">KuduClient</span> client <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> 
    <span class="token comment">//2、打开表 </span>
    <span class="token class-name">KuduTable</span> table <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> 
    <span class="token comment">//3、会话 </span>
    <span class="token class-name">KuduSession</span> session <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> 
    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KuduClient<span class="token punctuation">.</span>KuduClientBuilder</span><span class="token punctuation">(</span><span class="token constant">KUDU_MASTERS</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        table <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">openTable</span><span class="token punctuation">(</span><span class="token string">"users"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        session <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">newSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token comment">//4、upsert </span>
        <span class="token class-name">Upsert</span> upsert <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token function">newUpsert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token class-name">PartialRow</span> row <span class="token operator">=</span> upsert<span class="token punctuation">.</span><span class="token function">getRow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        row<span class="token punctuation">.</span><span class="token function">addByte</span><span class="token punctuation">(</span><span class="token string">"uid"</span><span class="token punctuation">,</span> <span class="token class-name">Byte</span><span class="token punctuation">.</span><span class="token function">parseByte</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">+</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        row<span class="token punctuation">.</span><span class="token function">addString</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"tomasLee"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        row<span class="token punctuation">.</span><span class="token function">addByte</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span> <span class="token class-name">Byte</span><span class="token punctuation">.</span><span class="token function">parseByte</span><span class="token punctuation">(</span><span class="token number">35</span><span class="token operator">+</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        row<span class="token punctuation">.</span><span class="token function">addDouble</span><span class="token punctuation">(</span><span class="token string">"wage"</span><span class="token punctuation">,</span> <span class="token number">18000.000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        session<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>upsert<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token class-name">Upsert</span> upsert1 <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token function">newUpsert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token class-name">PartialRow</span> row1 <span class="token operator">=</span> upsert1<span class="token punctuation">.</span><span class="token function">getRow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        row1<span class="token punctuation">.</span><span class="token function">addByte</span><span class="token punctuation">(</span><span class="token string">"uid"</span><span class="token punctuation">,</span> <span class="token class-name">Byte</span><span class="token punctuation">.</span><span class="token function">parseByte</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        row1<span class="token punctuation">.</span><span class="token function">addByte</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span> <span class="token class-name">Byte</span><span class="token punctuation">.</span><span class="token function">parseByte</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token operator">+</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        row1<span class="token punctuation">.</span><span class="token function">addDouble</span><span class="token punctuation">(</span><span class="token string">"wage"</span><span class="token punctuation">,</span> <span class="token number">15000.000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        session<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>upsert1<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        session<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span> 
        <span class="token comment">//5、关闭资源 </span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token operator">!=</span>client<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> 
            client<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre> 
<p>注意：Upsert主键一样则更新，否则为新增，不能为空的字段必须提供值，否则不执行。</p> 
<h5><a id="_497"></a>删除表</h5> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span> 
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDeleteTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">KuduException</span> <span class="token punctuation">{<!-- --></span> 
    <span class="token comment">//1、创建KuduClient </span>
    <span class="token class-name">KuduClient</span> client <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> 
    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span> 
        client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KuduClient<span class="token punctuation">.</span>KuduClientBuilder</span><span class="token punctuation">(</span><span class="token constant">KUDU_MASTERS</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token comment">//2、删除表 </span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span><span class="token function">tableExists</span><span class="token punctuation">(</span><span class="token string">"users"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> 
            client<span class="token punctuation">.</span><span class="token function">deleteTable</span><span class="token punctuation">(</span><span class="token string">"users"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"........delete table success.........."</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span> 
        <span class="token comment">//3、关闭资源 </span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token operator">!=</span>client<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> 
            client<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span> 
</code></pre> 
<p>其他语言编程接口</p> 
<p>请参看官方exaples：https://github.com/apache/kudu/tree/master/examples</p> 
<h3><a id="Hadoop_526"></a>Hadoop生态整合</h3> 
<h4><a id="_528"></a>整合概述</h4> 
<p>Kudu除了支持高吞吐离线分析（类似HDFS）和高并发随机读写（类似HBase），还可以整合主流分布式计算框架进行离线运算和即系查询，常见整合方案如下：</p> 
<p><img src="https://images2.imgbox.com/49/1a/oUHsvP4k_o.png" alt="MMSIZE"></p> 
<p>根据上表的总结，大家可以结合自己业务实际情况去选择整合方式，没有好坏之分。</p> 
<h4><a id="Spark_536"></a>集成Spark</h4> 
<h5><a id="Spark_shellKudu_538"></a>Spark shell中操作Kudu</h5> 
<p>在Spark shell中可以轻松操作Kudu，不过这种方式不常用，参考链接如下：</p> 
<p>https://kudu.apache.org/releases/1.10.0/docs/developing.html#_kudu_integration_with_spark</p> 
<h5><a id="KuduSpark_546"></a>代码整合Kudu+Spark-项目准备</h5> 
<p>（1）修改pom.xml，最中内容如下：</p> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">"</span></span> 
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span> 
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0 
                             http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.djt<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>kudu_tutorial<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>kudu.version</span><span class="token punctuation">&gt;</span></span>1.10.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>kudu.version</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>junit.version</span><span class="token punctuation">&gt;</span></span>4.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>junit.version</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scala.version</span><span class="token punctuation">&gt;</span></span>2.11.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scala.version</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spark.version</span><span class="token punctuation">&gt;</span></span>2.4.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spark.version</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span> 
        <span class="token comment">&lt;!-- Scala --&gt;</span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.scala-lang<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>scala-library<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${scala.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span> 
        <span class="token comment">&lt;!-- Spark --&gt;</span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.spark<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spark-core_2.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${spark.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.spark<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spark-sql_2.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${spark.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.spark<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spark-hive_2.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${spark.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span> 
        <span class="token comment">&lt;!-- kudu-spark --&gt;</span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.kudu<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>kudu-spark2_2.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${kudu.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span> 
        <span class="token comment">&lt;!-- Kudu client --&gt;</span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.kudu<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>kudu-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${kudu.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span> 
        <span class="token comment">&lt;!-- Log --&gt;</span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>slf4j-simple<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.7.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span> 
        <span class="token comment">&lt;!-- Unit test --&gt;</span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${junit.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span> 
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span> 
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-compiler-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span> 
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.5.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span> 
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span> 
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>source</span><span class="token punctuation">&gt;</span></span> 
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>target</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>target</span><span class="token punctuation">&gt;</span></span> 
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span> 
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>net.alchim31.maven<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span> 
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>scala-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span> 
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.2.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span> 
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">&gt;</span></span> 
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">&gt;</span></span> 
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">&gt;</span></span> 
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">&gt;</span></span>compile<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">&gt;</span></span> 
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">&gt;</span></span>testCompile<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">&gt;</span></span> 
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">&gt;</span></span> 
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span> 
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>args</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>arg</span><span class="token punctuation">&gt;</span></span>-dependencyfile<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>arg</span><span class="token punctuation">&gt;</span></span> 
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>arg</span><span class="token punctuation">&gt;</span></span>${project.build.directory}/.scala_dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>arg</span><span class="token punctuation">&gt;</span></span> 
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>args</span><span class="token punctuation">&gt;</span></span> 
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span> 
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">&gt;</span></span> 
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span> 
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span> 
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-shade-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span> 
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span> 
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">&gt;</span></span> 
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">&gt;</span></span> 
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>phase</span><span class="token punctuation">&gt;</span></span>package<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>phase</span><span class="token punctuation">&gt;</span></span> 
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">&gt;</span></span> 
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">&gt;</span></span>shade<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">&gt;</span></span> 
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">&gt;</span></span> 
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">&gt;</span></span> 
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span> 
    <span class="token comment">&lt;!-- 指定具体仓库 --&gt;</span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repositories</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repository</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>cdh.repo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>Cloudera Repositories<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>https://repository.cloudera.com/content/repositories/releases<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>snapshots</span><span class="token punctuation">&gt;</span></span> 
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>enabled</span><span class="token punctuation">&gt;</span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>enabled</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>snapshots</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repository</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repositories</span><span class="token punctuation">&gt;</span></span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span> 
</code></pre> 
<p>（2）准备数据文件</p> 
<p>在项目根目录创建目录dataset，并把数据文件students100k放进去：</p> 
<p><img src="https://images2.imgbox.com/a3/e8/v3stcgml_o.png" alt="MSIZE"></p> 
<p>（3）准备代码骨架</p> 
<p>跟java目录平行创建一个目录scala：</p> 
<p><img src="https://images2.imgbox.com/18/29/KOiycsBB_o.png" alt="MSIZE"></p> 
<p>将scala目录设置为sources root：</p> 
<p><img src="https://images2.imgbox.com/5e/52/iAAGe14Z_o.png" alt="MSIZE"></p> 
<p>创建Scala类com.djt.kudu.spark.KuduSparkDemo：</p> 
<pre><code class="prism language-scala"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>djt<span class="token punctuation">.</span>kudu<span class="token punctuation">.</span>spark</span> 
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span>Test 
<span class="token keyword">class</span> KuduSparkDemo <span class="token punctuation">{<!-- --></span> 
    <span class="token annotation punctuation">@Test</span> 
    <span class="token keyword">def</span> test<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> 
        println<span class="token punctuation">(</span><span class="token string">"hello kudu spark!"</span><span class="token punctuation">)</span> 
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre> 
<p>直接运行能正常输出，项目就准备好了。</p> 
<h5><a id="DDL_707"></a>DDL</h5> 
<p>首先，我们定义一个常量KUDU_MASTERS存放Kudu master的连接信息：</p> 
<pre><code class="prism language-bash">//master连接信息 
val KUDU_MASTERS <span class="token operator">=</span> <span class="token string">"node01:7051,node02:7051,node03:7051"</span> 
</code></pre> 
<p>接下来，我们创建case class Student，它的字段信息必须跟我们前面数据文件students100k相匹配：</p> 
<pre><code class="prism language-bash"><span class="token keyword">case</span> class Student<span class="token punctuation">(</span>sid: Int, name: String, gender: String, age: Int, height: Float, weight: Float<span class="token punctuation">)</span> 
</code></pre> 
<pre><code class="prism language-scala"><span class="token annotation punctuation">@Test</span> 
<span class="token keyword">def</span> ddl<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> 
    <span class="token comment">// 1. SparkSession </span>
    <span class="token keyword">val</span> spark <span class="token operator">=</span> SparkSession<span class="token punctuation">.</span>builder<span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>master<span class="token punctuation">(</span><span class="token string">"local[6]"</span><span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>appName<span class="token punctuation">(</span><span class="token string">"KuduSparkDemo"</span><span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>getOrCreate<span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token comment">//2 创建 KuduContext </span>
    <span class="token keyword">val</span> kuduContext <span class="token operator">=</span> <span class="token keyword">new</span> KuduContext<span class="token punctuation">(</span>KUDU_MASTERS<span class="token punctuation">,</span> spark<span class="token punctuation">.</span>sparkContext<span class="token punctuation">)</span> 
    <span class="token comment">//3、判断表是否存在, 如果存在则删除表 </span>
    <span class="token keyword">val</span> TABLE_NAME <span class="token operator">=</span> <span class="token string">"students"</span> 
    <span class="token keyword">if</span> <span class="token punctuation">(</span>kuduContext<span class="token punctuation">.</span>tableExists<span class="token punctuation">(</span>TABLE_NAME<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> 
        kuduContext<span class="token punctuation">.</span>deleteTable<span class="token punctuation">(</span>TABLE_NAME<span class="token punctuation">)</span> 
    <span class="token punctuation">}</span>
    <span class="token comment">//4. 定义一张Kudu表：students</span>
    <span class="token comment">//4.1 定义字段信息</span>
    <span class="token keyword">val</span> schema <span class="token operator">=</span> StructType<span class="token punctuation">(</span> 
        List<span class="token punctuation">(</span>
            StructField<span class="token punctuation">(</span><span class="token string">"sid"</span><span class="token punctuation">,</span> IntegerType<span class="token punctuation">,</span> nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
            StructField<span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> StringType<span class="token punctuation">,</span> nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
            StructField<span class="token punctuation">(</span><span class="token string">"gender"</span><span class="token punctuation">,</span> StringType<span class="token punctuation">,</span> nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
            StructField<span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span> IntegerType<span class="token punctuation">,</span> nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
            StructField<span class="token punctuation">(</span><span class="token string">"height"</span><span class="token punctuation">,</span> FloatType<span class="token punctuation">,</span> nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
            StructField<span class="token punctuation">(</span><span class="token string">"weight"</span><span class="token punctuation">,</span> FloatType<span class="token punctuation">,</span> nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> 
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    <span class="token comment">//4.2 定义主键(rowkey) </span>
    <span class="token keyword">val</span> keys <span class="token operator">=</span> Seq<span class="token punctuation">(</span><span class="token string">"sid"</span><span class="token punctuation">)</span> 
    <span class="token comment">//4.3 定义分区信息 </span>
    <span class="token keyword">import</span> <span class="token namespace">scala<span class="token punctuation">.</span>collection<span class="token punctuation">.</span></span>JavaConverters<span class="token punctuation">.</span>_ 
    <span class="token keyword">val</span> numBuckets <span class="token operator">=</span> <span class="token number">6</span> 
    <span class="token keyword">val</span> options <span class="token operator">=</span> <span class="token keyword">new</span> CreateTableOptions<span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>addHashPartitions<span class="token punctuation">(</span>List<span class="token punctuation">(</span><span class="token string">"sid"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>asJava<span class="token punctuation">,</span>numBuckets<span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>setNumReplicas<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> 
    <span class="token comment">//5. 创建一张Kudu表：students</span>
    kuduContext<span class="token punctuation">.</span>createTable<span class="token punctuation">(</span>tableName <span class="token operator">=</span> TABLE_NAME<span class="token punctuation">,</span> 
                            schema <span class="token operator">=</span> schema<span class="token punctuation">,</span> 
                            keys <span class="token operator">=</span> keys<span class="token punctuation">,</span> 
                            options <span class="token operator">=</span> options<span class="token punctuation">)</span> 
    <span class="token comment">//6、关闭资源 </span>
    spark<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="CUD_769"></a>CUD</h5> 
<pre><code class="prism language-scala"><span class="token annotation punctuation">@Test</span> 
<span class="token keyword">def</span> cud<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> 
    <span class="token comment">// 1、SparkSession </span>
    <span class="token keyword">val</span> spark <span class="token operator">=</span> SparkSession<span class="token punctuation">.</span>builder<span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>master<span class="token punctuation">(</span><span class="token string">"local[6]"</span><span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>appName<span class="token punctuation">(</span><span class="token string">"KuduSparkDemo"</span><span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>getOrCreate<span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token comment">//2、创建 KuduContext </span>
    <span class="token keyword">val</span> kuduContext <span class="token operator">=</span> <span class="token keyword">new</span> KuduContext<span class="token punctuation">(</span>KUDU_MASTERS<span class="token punctuation">,</span> spark<span class="token punctuation">.</span>sparkContext<span class="token punctuation">)</span> 
    <span class="token comment">// 3. 增加 </span>
    <span class="token keyword">import</span> <span class="token namespace">spark<span class="token punctuation">.</span>implicits<span class="token punctuation">.</span></span>_ 
    <span class="token keyword">val</span> df <span class="token operator">=</span> Seq<span class="token punctuation">(</span>Student<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">"王荣"</span><span class="token punctuation">,</span> <span class="token string">"F"</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">164.4f</span><span class="token punctuation">,</span> <span class="token number">116.5f</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Student<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token string">"李晓"</span><span class="token punctuation">,</span> 
                                                                    <span class="token string">"F"</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">174.4f</span><span class="token punctuation">,</span> <span class="token number">126.5f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>toDF<span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token keyword">val</span> TABLE_NAME <span class="token operator">=</span> <span class="token string">"students"</span> 
    kuduContext<span class="token punctuation">.</span>insertRows<span class="token punctuation">(</span>df<span class="token punctuation">,</span> TABLE_NAME<span class="token punctuation">)</span> 
    <span class="token comment">// 4. 删除 </span>
    kuduContext<span class="token punctuation">.</span>deleteRows<span class="token punctuation">(</span>df<span class="token punctuation">.</span>select<span class="token punctuation">(</span>$<span class="token string">"sid"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> TABLE_NAME<span class="token punctuation">)</span> 
    <span class="token comment">// 5. 增或改 </span>
    kuduContext<span class="token punctuation">.</span>upsertRows<span class="token punctuation">(</span>df<span class="token punctuation">,</span> TABLE_NAME<span class="token punctuation">)</span> 
    <span class="token comment">// 6. 修改 </span>
    kuduContext<span class="token punctuation">.</span>updateRows<span class="token punctuation">(</span>df<span class="token punctuation">,</span> TABLE_NAME<span class="token punctuation">)</span> 
    <span class="token comment">//7、关闭资源 </span>
    spark<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">}</span>

</code></pre> 
<p>用如下命令以验证结果（换成自己的主机名或者IP）：</p> 
<pre><code class="prism language-bash">kudu table scan node01:7051,node02:7051,node03:7051 students 
</code></pre> 
<h5><a id="Kudu_807"></a>批处理读写Kudu</h5> 
<p><strong>1）批量写</strong></p> 
<pre><code class="prism language-scala"><span class="token annotation punctuation">@Test</span> 
<span class="token keyword">def</span> batchWrite<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> 
    <span class="token comment">// 1.SparkSession </span>
    <span class="token keyword">val</span> spark <span class="token operator">=</span> SparkSession<span class="token punctuation">.</span>builder<span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>master<span class="token punctuation">(</span><span class="token string">"local[6]"</span><span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>appName<span class="token punctuation">(</span><span class="token string">"KuduSparkDemo"</span><span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>getOrCreate<span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token comment">// 2.定义数据schema </span>
    <span class="token keyword">val</span> schema <span class="token operator">=</span> StructType<span class="token punctuation">(</span> 
        List<span class="token punctuation">(</span>
            StructField<span class="token punctuation">(</span><span class="token string">"sid"</span><span class="token punctuation">,</span> IntegerType<span class="token punctuation">,</span> nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
            StructField<span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> StringType<span class="token punctuation">,</span> nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
            StructField<span class="token punctuation">(</span><span class="token string">"gender"</span><span class="token punctuation">,</span> StringType<span class="token punctuation">,</span> nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
            StructField<span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span> IntegerType<span class="token punctuation">,</span> nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
            StructField<span class="token punctuation">(</span><span class="token string">"height"</span><span class="token punctuation">,</span> FloatType<span class="token punctuation">,</span> nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
            StructField<span class="token punctuation">(</span><span class="token string">"weight"</span><span class="token punctuation">,</span> FloatType<span class="token punctuation">,</span> nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> 
        <span class="token punctuation">)</span> 
    <span class="token punctuation">)</span>
    <span class="token comment">// 3.从csv读取数据 </span>
    <span class="token keyword">val</span> studentsDF <span class="token operator">=</span> spark<span class="token punctuation">.</span>read 
    <span class="token punctuation">.</span>option<span class="token punctuation">(</span><span class="token string">"header"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>option<span class="token punctuation">(</span><span class="token string">"delimiter"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"t"</span><span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>schema<span class="token punctuation">(</span>schema<span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>csv<span class="token punctuation">(</span><span class="token string">"dataset/students100k"</span><span class="token punctuation">)</span> 
    <span class="token comment">// 4.写入Kudu </span>
    <span class="token keyword">val</span> TABLE_NAME <span class="token operator">=</span> <span class="token string">"students"</span> 
    studentsDF<span class="token punctuation">.</span>write 
    <span class="token punctuation">.</span>option<span class="token punctuation">(</span><span class="token string">"kudu.table"</span><span class="token punctuation">,</span> TABLE_NAME<span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>option<span class="token punctuation">(</span><span class="token string">"kudu.master"</span><span class="token punctuation">,</span> KUDU_MASTERS<span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>mode<span class="token punctuation">(</span>SaveMode<span class="token punctuation">.</span>Append<span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>format<span class="token punctuation">(</span><span class="token string">"kudu"</span><span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token comment">//5.回收资源 </span>
    spark<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>2）SQL分析(批量读)</strong></p> 
<pre><code class="prism language-scala"><span class="token annotation punctuation">@Test</span> 
<span class="token keyword">def</span> batchRead<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> 
    <span class="token comment">// 1.SparkSession </span>
    <span class="token keyword">val</span> spark <span class="token operator">=</span> SparkSession<span class="token punctuation">.</span>builder<span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>master<span class="token punctuation">(</span><span class="token string">"local[6]"</span><span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>appName<span class="token punctuation">(</span><span class="token string">"KuduSparkDemo"</span><span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>getOrCreate<span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token comment">// 2.从kudu表读取数据到DataFrame </span>
    <span class="token keyword">val</span> TABLE_NAME <span class="token operator">=</span> <span class="token string">"students"</span> 
    <span class="token keyword">val</span> studentsDF <span class="token operator">=</span> spark<span class="token punctuation">.</span>read 
    <span class="token punctuation">.</span>option<span class="token punctuation">(</span><span class="token string">"kudu.table"</span><span class="token punctuation">,</span> TABLE_NAME<span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>option<span class="token punctuation">(</span><span class="token string">"kudu.master"</span><span class="token punctuation">,</span> KUDU_MASTERS<span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>format<span class="token punctuation">(</span><span class="token string">"kudu"</span><span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token comment">// 3.直接使用Spark API查询 </span>
    <span class="token comment">//studentsDF.select("sid","name", "gender", "age").filter("sid &gt;= 5 and sid&lt;=10").show() </span>
    <span class="token comment">// 3.基于DataFrame创建临时视图(临时表) </span>
    studentsDF<span class="token punctuation">.</span>createOrReplaceTempView<span class="token punctuation">(</span><span class="token string">"students"</span><span class="token punctuation">)</span> 
    <span class="token comment">// 4.执行sql查询 </span>
    <span class="token comment">//val projectDF = spark.sql("select sid, name, gender, age from students where age &lt;= 19 and height &gt; 180") </span>

    <span class="token keyword">val</span> projectDF <span class="token operator">=</span> spark<span class="token punctuation">.</span>sql<span class="token punctuation">(</span><span class="token string">"select gender, count(), max(height) ,min(height), avg(height) from students where age &lt;= 19 and height &gt; 180 group by gender"</span><span class="token punctuation">)</span> 
    <span class="token comment">//5.打印结果 </span>
    projectDF<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token comment">//6.关闭资源 </span>
    spark<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">}</span> 

</code></pre> 
<h5><a id="_886"></a>特别注意</h5> 
<ul><li> <p>每个集群避免多KuduClient</p> <p>常见错误就是创建了多个KuduClient对象。在kudu-spark中，KuduClient对象由KuduContext所持有。对于同一kudu集群，不应该创建多个KuduClient对象，而是应该通过KuduContext访问KuduClient，方法为KuduContext.syncClient。</p> </li><li> <p>存在问题和限制</p> 
  <ul><li>Spark2.2+需要Java8支持，尽管Kudu Spark2.x兼容Java 7。Spark 2.2 默认依赖Kudu1.5.0。</li><li>Kudu表如果包含大写或非ascii字符的话，注册临时表时需要指定其他的名字。</li><li>列名如果含有大写或非ascii字符的，不能在Spark SQL中使用，否则必须重命名。</li><li>&lt;&gt;或or操作不会推送到kudu执行，而是最终由Spark的task来计算。只有以通配结尾的like运算才会推送到kudu执行，比如like foo%，但是like foo%bar则不会推送给Kudu。</li><li>并不是Spark SQL中的每种类型Kudu都支持，Date和Complex类型就不支持。</li><li>Kudu表在Spark SQL中只能注册成临时表，不能使用HiveContext访问。</li></ul> </li></ul> 
<h4><a id="Flink_903"></a>集成Flink</h4> 
<h5><a id="_905"></a>集成说明</h5> 
<p>在Spark和Flink先后崛起之后，开始与Hadoop生态中的各个组件整合（官方或者第三方）。Apache Bahir就是一个第三方项目，它对Spark和Flink进行扩展以便于它们整合其他组件（主要针对流处理）。</p> 
<p>以下是Apache Bahir的官网：</p> 
<p>http://bahir.apache.org/</p> 
<p><img src="https://images2.imgbox.com/1b/16/LzBdEwEZ_o.png" alt="MMSIZE"></p> 
<p>Apache Bahir对Flink的支持以子项目bahir-flflink的方式提供，以下是它的github主页：</p> 
<p>https://github.com/apache/bahir-flflink</p> 
<p>我们就基于bahir-flflink来整合Kudu+Flink，目前支持：</p> 
<ul><li>批处理读和写</li><li>流处理写（流处理读一般只针对消息队列，对于存储流处理读意义不大）</li></ul> 
<h5><a id="bahirflflink_926"></a>编译bahir-flflink</h5> 
<p>bahir-flflink目前1.0版还没正式发布，刚到1.0-rc5，且不支持Kudu。1.1版开始支持Kudu，目前还在1.1-SNAPSHOT版（Kudu1.10.0和Flink1.9.0），因此我们需要自己编译，且一定要在Linux或者MacOS下编译：</p> 
<p>编译并安装到maven本地仓库：</p> 
<pre><code class="prism language-bash"><span class="token function">git</span> clone https://github.com/apache/bahir-flink.git 
<span class="token builtin class-name">cd</span> bahir-flink/ 
mvn <span class="token parameter variable">-DskipTests</span> <span class="token parameter variable">-Drat.skip</span><span class="token operator">=</span>true clean <span class="token function">install</span> 
</code></pre> 
<p>执行完之后，我们去maven本地仓库查看：</p> 
<p><img src="https://images2.imgbox.com/cd/f3/jShTUAO5_o.png" alt="MSIZE"></p> 
<p>如果有些依赖包实在下载不下来导致编译不过的话，可以使用老师提供的编译好的包直接安装到maven本地仓库即可：</p> 
<pre><code class="prism language-bash">mvn install:install-file <span class="token parameter variable">-DgroupId</span><span class="token operator">=</span>org.apache.bahir <span class="token parameter variable">-DartifactId</span><span class="token operator">=</span>flink-connector-kudu_2.11 <span class="token parameter variable">-Dversion</span><span class="token operator">=</span><span class="token number">1.1</span>-SNAPSHOT <span class="token parameter variable">-Dpackaging</span><span class="token operator">=</span>jar <span class="token parameter variable">-Dfile</span><span class="token operator">=</span>./flink-connector-kudu_2.11-1.1-SNAPSHOT.jar 
</code></pre> 
<h5><a id="_948"></a>项目准备</h5> 
<p>修改pom.xml，最终内容如下：</p> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">"</span></span> 
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span> 
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0 
                             http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.djt<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>kudu-tutorial<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>kudu.version</span><span class="token punctuation">&gt;</span></span>1.10.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>kudu.version</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>junit.version</span><span class="token punctuation">&gt;</span></span>4.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>junit.version</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scala.version</span><span class="token punctuation">&gt;</span></span>2.11.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scala.version</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spark.version</span><span class="token punctuation">&gt;</span></span>2.4.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spark.version</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>flink.version</span><span class="token punctuation">&gt;</span></span>1.9.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>flink.version</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>flink-connector.version</span><span class="token punctuation">&gt;</span></span>1.1-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>flink-connector.version</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span> 
        <span class="token comment">&lt;!-- bahir-flink --&gt;</span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.bahir<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-connector-kudu_2.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${flink-connector.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.flink<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-streaming-java_2.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${flink.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span> 
        <span class="token comment">&lt;!-- Scala --&gt;</span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.scala-lang<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>scala-library<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${scala.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span> 
        <span class="token comment">&lt;!-- Spark --&gt;</span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.spark<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spark-core_2.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${spark.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.spark<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spark-sql_2.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${spark.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.spark<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spark-hive_2.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${spark.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span> 
        <span class="token comment">&lt;!-- kudu-spark --&gt;</span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.kudu<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>kudu-spark2_2.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${kudu.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span> 
        <span class="token comment">&lt;!-- Kudu client --&gt;</span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.kudu<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>kudu-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${kudu.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span> 
        <span class="token comment">&lt;!-- Log --&gt;</span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>slf4j-simple<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.7.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span> 
        <span class="token comment">&lt;!-- Unit test --&gt;</span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${junit.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span> 
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span> 
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-compiler-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span> 
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.5.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span> 
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span> 
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>source</span><span class="token punctuation">&gt;</span></span> 
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>target</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>target</span><span class="token punctuation">&gt;</span></span> 
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span> 
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>net.alchim31.maven<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span> 
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>scala-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span> 
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.2.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span> 
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">&gt;</span></span> 
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">&gt;</span></span> 
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">&gt;</span></span> 
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">&gt;</span></span>compile<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">&gt;</span></span> 
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">&gt;</span></span>testCompile<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">&gt;</span></span> 
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">&gt;</span></span> 
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span> 
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>args</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>arg</span><span class="token punctuation">&gt;</span></span>-dependencyfile<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>arg</span><span class="token punctuation">&gt;</span></span> 
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>arg</span><span class="token punctuation">&gt;</span></span>${project.build.directory}/.scala_dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>arg</span><span class="token punctuation">&gt;</span></span> 
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>args</span><span class="token punctuation">&gt;</span></span> 
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span> 
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">&gt;</span></span> 
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span> 
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span> 
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-shade-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span> 
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span> 
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">&gt;</span></span> 
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">&gt;</span></span> 
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>phase</span><span class="token punctuation">&gt;</span></span>package<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>phase</span><span class="token punctuation">&gt;</span></span> 
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">&gt;</span></span> 
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">&gt;</span></span>shade<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">&gt;</span></span> 
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">&gt;</span></span> 
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">&gt;</span></span> 
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span> 
    <span class="token comment">&lt;!-- 指定具体仓库 --&gt;</span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repositories</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repository</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>cdh.repo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>Cloudera Repositories<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>https://repository.cloudera.com/content/repositories/releases<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>snapshots</span><span class="token punctuation">&gt;</span></span> 
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>enabled</span><span class="token punctuation">&gt;</span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>enabled</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>snapshots</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repository</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repositories</span><span class="token punctuation">&gt;</span></span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span> 
</code></pre> 
<p>骨架代码：</p> 
<pre><code class="prism language-scala"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>djt<span class="token punctuation">.</span>kudu<span class="token punctuation">.</span>flink</span><span class="token punctuation">;</span> 
public <span class="token keyword">class</span> KuduFlinkDemo <span class="token punctuation">{<!-- --></span> 
    public static void main<span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> 
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span>println<span class="token punctuation">(</span><span class="token string">"hello kudu flink!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre> 
<p>运行能正常输出就OK了。</p> 
<h5><a id="_1105"></a>批处理读写</h5> 
<p><strong>（1）批处理读</strong></p> 
<p>批处理读需要开启Kudu安全，这里就不做演示了。</p> 
<p>批处理读使用KuduInputFormat，代码如下：</p> 
<pre><code class="prism language-scala"><span class="token annotation punctuation">@Test</span> 
public void testBatchRead<span class="token punctuation">(</span><span class="token punctuation">)</span> throws Exception <span class="token punctuation">{<!-- --></span> 
    <span class="token comment">//1、初始化执行环境 </span>
    ExecutionEnvironment env <span class="token operator">=</span> ExecutionEnvironment<span class="token punctuation">.</span>getExecutionEnvironment<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    env<span class="token punctuation">.</span>setParallelism<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">//2、构建数据处理逻辑(输入--&gt;处理--输出) </span>
    <span class="token comment">//2.1 输入(读取kudu的students表) </span>
    <span class="token comment">//a、创建KuduReaderConfig </span>
    KuduReaderConfig kuduReaderConfig <span class="token operator">=</span> KuduReaderConfig<span class="token punctuation">.</span>Builder 
    <span class="token punctuation">.</span>setMasters<span class="token punctuation">(</span>KUDU_MASTERS<span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>build<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">//b、创建KuduTableInfo </span>
    KuduTableInfo tableInfo <span class="token operator">=</span> KuduTableInfo<span class="token punctuation">.</span>Builder 
    <span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token string">"students"</span><span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>replicas<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>addColumn<span class="token punctuation">(</span>KuduColumnInfo<span class="token punctuation">.</span>Builder<span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token string">"sid"</span><span class="token punctuation">,</span> 
                                             Type<span class="token punctuation">.</span>INT32<span class="token punctuation">)</span><span class="token punctuation">.</span>key<span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hashKey<span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span>build<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>addColumn<span class="token punctuation">(</span>KuduColumnInfo<span class="token punctuation">.</span>Builder<span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> Type<span class="token punctuation">.</span>STRING<span class="token punctuation">)</span><span class="token punctuation">.</span>build<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>addColumn<span class="token punctuation">(</span>KuduColumnInfo<span class="token punctuation">.</span>Builder<span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token string">"gender"</span><span class="token punctuation">,</span> Type<span class="token punctuation">.</span>STRING<span class="token punctuation">)</span><span class="token punctuation">.</span>build<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>addColumn<span class="token punctuation">(</span>KuduColumnInfo<span class="token punctuation">.</span>Builder<span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span> Type<span class="token punctuation">.</span>INT32<span class="token punctuation">)</span><span class="token punctuation">.</span>build<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>addColumn<span class="token punctuation">(</span>KuduColumnInfo<span class="token punctuation">.</span>Builder<span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token string">"height"</span><span class="token punctuation">,</span> Type<span class="token punctuation">.</span>FLOAT<span class="token punctuation">)</span><span class="token punctuation">.</span>build<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>addColumn<span class="token punctuation">(</span>KuduColumnInfo<span class="token punctuation">.</span>Builder<span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token string">"weight"</span><span class="token punctuation">,</span> Type<span class="token punctuation">.</span>FLOAT<span class="token punctuation">)</span><span class="token punctuation">.</span>build<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>build<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">//c、创建反序列化器KuduDeserialization </span>
    KuduDeserialization serDe <span class="token operator">=</span> <span class="token keyword">new</span> PojoSerDe<span class="token punctuation">(</span>Student<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">//d、组装过滤条件 </span>
    List<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">KuduFilterInfo</span><span class="token punctuation">&gt;</span></span> tableFilters <span class="token operator">=</span> <span class="token keyword">new</span> ArrayList<span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    tableFilters<span class="token punctuation">.</span>add<span class="token punctuation">(</span>KuduFilterInfo<span class="token punctuation">.</span>Builder<span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>greaterThan<span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">.</span>build<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    tableFilters<span class="token punctuation">.</span>add<span class="token punctuation">(</span>KuduFilterInfo<span class="token punctuation">.</span>Builder<span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>lessThan<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">.</span>build<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">//e、指定要返回的列 </span>
    List<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> tableProjections <span class="token operator">=</span> Arrays<span class="token punctuation">.</span>asList<span class="token punctuation">(</span><span class="token string">"sid"</span><span class="token punctuation">,</span> <span class="token string">"age"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">//f、组装KuduInputFormat </span>
    DataSet<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> env<span class="token punctuation">.</span>createInput<span class="token punctuation">(</span><span class="token keyword">new</span> KuduInputFormat<span class="token punctuation">(</span>kuduReaderConfig<span class="token punctuation">,</span> tableInfo<span class="token punctuation">,</span> serDe<span class="token punctuation">,</span> <span class="token keyword">new</span> ArrayList<span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> tableProjections<span class="token punctuation">)</span><span class="token punctuation">,</span> TypeInformation<span class="token punctuation">.</span>of<span class="token punctuation">(</span>Student<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">//2.2 处理(包含输出) </span>
    result<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">//3、执行job(延迟执行) </span>
    env<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>（2）批处理写</strong></p> 
<pre><code class="prism language-scala"><span class="token annotation punctuation">@Test</span> 
public void testBatchWrite<span class="token punctuation">(</span><span class="token punctuation">)</span> throws Exception <span class="token punctuation">{<!-- --></span> 
    <span class="token comment">//1、初始化执行环境 </span>
    ExecutionEnvironment env <span class="token operator">=</span> ExecutionEnvironment<span class="token punctuation">.</span>getExecutionEnvironment<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    env<span class="token punctuation">.</span>setParallelism<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">//2、构建数据处理逻辑(输入--&gt;处理--输出) </span>
    <span class="token comment">//2.1 输入 </span>
    DataSet<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">&gt;</span></span> originData<span class="token operator">=</span> env<span class="token punctuation">.</span>readCsvFile<span class="token punctuation">(</span><span class="token string">"dataset/students100k"</span><span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>fieldDelimiter<span class="token punctuation">(</span><span class="token string">"t"</span><span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>ignoreFirstLine<span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>ignoreInvalidLines<span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>pojoType<span class="token punctuation">(</span>Student<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token string">"sid"</span><span class="token punctuation">,</span><span class="token string">"name"</span><span class="token punctuation">,</span><span class="token string">"gender"</span><span class="token punctuation">,</span><span class="token string">"age"</span><span class="token punctuation">,</span><span class="token string">"height"</span><span class="token punctuation">,</span><span class="token string">"weight"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">//2.2 处理(咱们不处理) </span>
    <span class="token comment">//2.3 输出(kudu 表) </span>
    <span class="token comment">//a、创建KuduWriterConfig </span>
    KuduWriterConfig writerConfig<span class="token operator">=</span>KuduWriterConfig<span class="token punctuation">.</span>Builder 
    <span class="token punctuation">.</span>setMasters<span class="token punctuation">(</span>KUDU_MASTERS<span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>setWriteMode<span class="token punctuation">(</span>KuduWriterMode<span class="token punctuation">.</span>UPSERT<span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>setConsistency<span class="token punctuation">(</span>SessionConfiguration<span class="token punctuation">.</span>FlushMode<span class="token punctuation">.</span>AUTO_FLUSH_BACKGROUND<span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>build<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">//b、创建KuduTableInfo </span>
    KuduTableInfo tableInfo <span class="token operator">=</span> KuduTableInfo<span class="token punctuation">.</span>Builder 
    <span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token string">"students1"</span><span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>replicas<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>addColumn<span class="token punctuation">(</span>KuduColumnInfo<span class="token punctuation">.</span>Builder<span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token string">"sid"</span><span class="token punctuation">,</span> 
                                             Type<span class="token punctuation">.</span>INT32<span class="token punctuation">)</span><span class="token punctuation">.</span>key<span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hashKey<span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span>build<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>addColumn<span class="token punctuation">(</span>KuduColumnInfo<span class="token punctuation">.</span>Builder<span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> Type<span class="token punctuation">.</span>STRING<span class="token punctuation">)</span><span class="token punctuation">.</span>build<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>addColumn<span class="token punctuation">(</span>KuduColumnInfo<span class="token punctuation">.</span>Builder<span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token string">"gender"</span><span class="token punctuation">,</span> Type<span class="token punctuation">.</span>STRING<span class="token punctuation">)</span><span class="token punctuation">.</span>build<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>addColumn<span class="token punctuation">(</span>KuduColumnInfo<span class="token punctuation">.</span>Builder<span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span> Type<span class="token punctuation">.</span>INT32<span class="token punctuation">)</span><span class="token punctuation">.</span>build<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>addColumn<span class="token punctuation">(</span>KuduColumnInfo<span class="token punctuation">.</span>Builder<span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token string">"height"</span><span class="token punctuation">,</span> Type<span class="token punctuation">.</span>FLOAT<span class="token punctuation">)</span><span class="token punctuation">.</span>build<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>addColumn<span class="token punctuation">(</span>KuduColumnInfo<span class="token punctuation">.</span>Builder<span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token string">"weight"</span><span class="token punctuation">,</span> Type<span class="token punctuation">.</span>FLOAT<span class="token punctuation">)</span><span class="token punctuation">.</span>build<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>build<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">//c、创建KuduSerialization </span>
    KuduSerialization serDe<span class="token operator">=</span><span class="token keyword">new</span> PojoSerDe<span class="token punctuation">(</span>Student<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">//d、装配KuduOutputFormat </span>
    originData<span class="token punctuation">.</span>output<span class="token punctuation">(</span><span class="token keyword">new</span> KuduOutputFormat<span class="token punctuation">(</span>writerConfig<span class="token punctuation">,</span> tableInfo<span class="token punctuation">,</span> serDe<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">//3、执行job(延迟执行) </span>
    env<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="_1202"></a>流处理写</h5> 
<p>直接使用KuduSink：</p> 
<pre><code class="prism language-scala"><span class="token annotation punctuation">@Test</span> 
public void testKuduSink<span class="token punctuation">(</span><span class="token punctuation">)</span> throws Exception <span class="token punctuation">{<!-- --></span> 
    List<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> Arrays<span class="token punctuation">.</span>asList<span class="token punctuation">(</span> 
        <span class="token keyword">new</span> Student<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"张三"</span><span class="token punctuation">,</span> <span class="token string">"F"</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">176.3f</span><span class="token punctuation">,</span> <span class="token number">134.4f</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
        <span class="token keyword">new</span> Student<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"李四"</span><span class="token punctuation">,</span> <span class="token string">"F"</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">186.3f</span><span class="token punctuation">,</span> <span class="token number">154.8f</span><span class="token punctuation">)</span> 
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//1、初始化执行环境 </span>
    StreamExecutionEnvironment env <span class="token operator">=</span> StreamExecutionEnvironment<span class="token punctuation">.</span>getExecutionEnvironment<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    env<span class="token punctuation">.</span>setParallelism<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">//2、构建数据处理逻辑(输入--&gt;处理--输出) </span>
    <span class="token comment">//2.1 输入 </span>
    DataStream<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">&gt;</span></span> originData <span class="token operator">=</span> env<span class="token punctuation">.</span>fromCollection<span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">//2.2 处理(咱们不处理) </span>
    <span class="token comment">//2.3 输出(kudu 表) </span>
    <span class="token comment">//a、创建KuduWriterConfig </span>
    KuduWriterConfig writerConfig<span class="token operator">=</span>KuduWriterConfig<span class="token punctuation">.</span>Builder 
    <span class="token punctuation">.</span>setMasters<span class="token punctuation">(</span>KUDU_MASTERS<span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>setWriteMode<span class="token punctuation">(</span>KuduWriterMode<span class="token punctuation">.</span>UPSERT<span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>setConsistency<span class="token punctuation">(</span>SessionConfiguration<span class="token punctuation">.</span>FlushMode<span class="token punctuation">.</span>AUTO_FLUSH_BACKGROUND<span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>build<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">//b、创建KuduTableInfo </span>
    KuduTableInfo tableInfo <span class="token operator">=</span> KuduTableInfo<span class="token punctuation">.</span>Builder 
    <span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token string">"students1"</span><span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>replicas<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>addColumn<span class="token punctuation">(</span>KuduColumnInfo<span class="token punctuation">.</span>Builder<span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token string">"sid"</span><span class="token punctuation">,</span> 
                                             Type<span class="token punctuation">.</span>INT32<span class="token punctuation">)</span><span class="token punctuation">.</span>key<span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hashKey<span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span>build<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>addColumn<span class="token punctuation">(</span>KuduColumnInfo<span class="token punctuation">.</span>Builder<span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> Type<span class="token punctuation">.</span>STRING<span class="token punctuation">)</span><span class="token punctuation">.</span>build<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>addColumn<span class="token punctuation">(</span>KuduColumnInfo<span class="token punctuation">.</span>Builder<span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token string">"gender"</span><span class="token punctuation">,</span> Type<span class="token punctuation">.</span>STRING<span class="token punctuation">)</span><span class="token punctuation">.</span>build<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>addColumn<span class="token punctuation">(</span>KuduColumnInfo<span class="token punctuation">.</span>Builder<span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span> Type<span class="token punctuation">.</span>INT32<span class="token punctuation">)</span><span class="token punctuation">.</span>build<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>addColumn<span class="token punctuation">(</span>KuduColumnInfo<span class="token punctuation">.</span>Builder<span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token string">"height"</span><span class="token punctuation">,</span> Type<span class="token punctuation">.</span>FLOAT<span class="token punctuation">)</span><span class="token punctuation">.</span>build<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>addColumn<span class="token punctuation">(</span>KuduColumnInfo<span class="token punctuation">.</span>Builder<span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token string">"weight"</span><span class="token punctuation">,</span> Type<span class="token punctuation">.</span>FLOAT<span class="token punctuation">)</span><span class="token punctuation">.</span>build<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
    <span class="token punctuation">.</span>build<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">//c、创建KuduSerialization </span>
    KuduSerialization serDe<span class="token operator">=</span><span class="token keyword">new</span> PojoSerDe<span class="token punctuation">(</span>Student<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">//d、装配KuduSink </span>
    originData<span class="token punctuation">.</span>addSink<span class="token punctuation">(</span><span class="token keyword">new</span> KuduSink<span class="token punctuation">(</span>writerConfig<span class="token punctuation">,</span>tableInfo<span class="token punctuation">,</span>serDe<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">//3、执行job(延迟执行) </span>
    env<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
</code></pre> 
<h4><a id="Impala_1252"></a>集成Impala</h4> 
<h5><a id="_1254"></a>各组件之间的关系</h5> 
<p>Kudu整合Impala依赖很多组件，这里有一张组件关系图如下：</p> 
<p><img src="https://images2.imgbox.com/2a/4e/dFDPazix_o.png" alt="MMSIZE"></p> 
<p>通过上图我们分析结论如下：</p> 
<ul><li>impala依赖Hive</li><li>Hive依赖Hadoop</li><li>Hive依赖MySQL存储元数据</li><li>Hadoop依赖Zookeeper</li><li>基本都离不开JDK</li></ul> 
<p>因此，相关组件我们需要先安装。</p> 
<h5><a id="_1270"></a>环境准备</h5> 
<p>部署规划方案是：</p> 
<p><img src="https://images2.imgbox.com/88/94/sE7lpBfh_o.png" alt="MMSIZE"></p> 
<p>具体安装省略。</p> 
<h5><a id="KuduImpala_1282"></a>为什么整合Kudu+Impala</h5> 
<p>Kudu作为高性能的分布式存储同时兼具HDFS和HBase的能力确实能够解决很多业务问题，但是Kudu没有SQL语法支持限制它的使用门槛，因此 Cloudra官方专门把Impala和Kudu做了整合，因此他们的分工是：</p> 
<ul><li>Kudu负责存储</li><li>Impala负责计算（用SQL语法分析存储在Kudu表里的数据）</li></ul> 
<p>Impala对外支持两种场景：</p> 
<ul><li>基于Impala替代Kudu API开发上层应用（可以但不推荐）</li><li>Impala作为中间层提供JDBC/ODBC跟上层BI或者其他框架整合（推荐）</li></ul> 
<h5><a id="KuduImpala_1296"></a>怎么整合Kudu+Impala</h5> 
<p>何为整合？让Impala认识并能操作Kudu中的表（内部表/外部表均可）：</p> 
<p><img src="https://images2.imgbox.com/e9/ac/wLQfimlt_o.png" alt="MMSIZE"></p> 
<p>Kudu跟Impala的整合非常简单，可总结为两点：</p> 
<ul><li> <p><strong>Kudu这边什么配置都不用改，它就等着Impala来访问</strong></p> </li><li> <p><strong>Impala那边有两种方式来访问Kudu</strong></p> <p>方式一：每次在Impala中建内部表/外部表时指定Kudu Master（不推荐）</p> <p>例如：</p> <pre><code class="prism language-bash">CREATE EXTERNAL TABLE <span class="token variable"><span class="token variable">`</span><span class="token function">users</span><span class="token variable">`</span></span> STORED AS KUDU 
TBLPROPERTIES<span class="token punctuation">(</span> 
<span class="token string">'kudu.table_name'</span> <span class="token operator">=</span> <span class="token string">'users'</span>, 
<span class="token string">'kudu.master_addresses'</span> <span class="token operator">=</span> <span class="token string">'node01:7051,node02:7051,node03:7051'</span><span class="token punctuation">)</span> 
</code></pre> <p>方式二：在Impal的默认配置中指定Kudu Master+内部表/外部表：</p> <p>在/etc/default/impala中指定：</p> <pre><code class="prism language-bash"><span class="token parameter variable">--kudu_master_hosts</span><span class="token operator">=</span><span class="token operator">&lt;</span>master<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span><span class="token punctuation">[</span>:port<span class="token punctuation">]</span>,<span class="token operator">&lt;</span>master<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token punctuation">[</span>:port<span class="token punctuation">]</span>,<span class="token operator">&lt;</span>master<span class="token operator"><span class="token file-descriptor important">3</span>&gt;</span><span class="token punctuation">[</span>:port<span class="token punctuation">]</span>
</code></pre> </li></ul> 
<h5><a id="KuduImpala_1329"></a>整合Kudu+Impala</h5> 
<p><strong>（1）配置Kudu Master地址</strong></p> 
<p>在Impala中配置Kudu Master地址（所有节点）：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">vi</span> /etc/default/impala
</code></pre> 
<p>在 IMPALA_SERVER_ARGS 下添加如下配置：</p> 
<pre><code class="prism language-bash"><span class="token parameter variable">--kudu_master_hosts</span><span class="token operator">=</span><span class="token operator">&lt;</span>master<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span><span class="token punctuation">[</span>:port<span class="token punctuation">]</span>,<span class="token operator">&lt;</span>master<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token punctuation">[</span>:port<span class="token punctuation">]</span>,<span class="token operator">&lt;</span>master<span class="token operator"><span class="token file-descriptor important">3</span>&gt;</span><span class="token punctuation">[</span>:port<span class="token punctuation">]</span> 
</code></pre> 
<p><img src="https://images2.imgbox.com/34/3b/geV5KJPb_o.png" alt="MMSIZE"></p> 
<p><strong>（2）重启所有Impala服务</strong></p> 
<p>node01重启state-store和catalog：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">service</span> impala-state-store restart 
<span class="token function">sudo</span> <span class="token function">service</span> impala-catalog restart 
</code></pre> 
<p>node02和node03上重启impala-server：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">service</span> impala-server restart
</code></pre> 
<h5><a id="Impala_ShellKudu_1364"></a>Impala Shell中操作Kudu</h5> 
<p><strong>（1）登录Impala-shell</strong></p> 
<p>我们在node01上安装了impala-shell，因此在node01上执行如下命令：</p> 
<pre><code class="prism language-bash">impala-shell <span class="token parameter variable">-i</span> node02:21000
</code></pre> 
<p>这时就进入了impala-shell：</p> 
<p><img src="https://images2.imgbox.com/af/50/HLibk98C_o.png" alt="MMSIZE"></p> 
<p><strong>（2）表映射</strong></p> 
<p>Impala可以操作很多表：</p> 
<ul><li>Kudu表</li><li>HBase表</li><li>Hive表（各种存储格式：Text、ORC、Parquet等等）</li><li>等等</li></ul> 
<p>Impala要想操作Kudu表，有两种方式：</p> 
<ul><li> <p>外部表</p> <p>所谓外部表是指Kudu那边已经建好表了，我们把Kudu表映射为一张Impal表即可，删除表时只删映射关系，Kudu那边的表还在。以前面创建的表students1为例，只需要在impala-shell中创建一个外部表即可：</p> <pre><code class="prism language-sql"><span class="token keyword">CREATE</span> EXTERNAL <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>students1<span class="token punctuation">`</span></span> STORED <span class="token keyword">AS</span> KUDU 
TBLPROPERTIES<span class="token punctuation">(</span> 
    <span class="token string">'kudu.table_name'</span> <span class="token operator">=</span> <span class="token string">'students1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre> <p>或者在指定数据库下创建外表：</p> <pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> test<span class="token punctuation">;</span> 
<span class="token keyword">CREATE</span> EXTERNAL <span class="token keyword">TABLE</span> test<span class="token punctuation">.</span>users STORED <span class="token keyword">AS</span> KUDU 
TBLPROPERTIES<span class="token punctuation">(</span> 
    <span class="token string">'kudu.table_name'</span> <span class="token operator">=</span> <span class="token string">'users'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre> </li><li> <p>内部表</p> <p>所谓内部表，它跟外部表正好相反，是指在Impala中创建一张表存储为Kudu格式，例如：</p> <pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> my_first_table 
<span class="token punctuation">(</span> 
    id <span class="token keyword">BIGINT</span><span class="token punctuation">,</span> 
    name STRING<span class="token punctuation">,</span> 
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> 
<span class="token punctuation">)</span>
<span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> <span class="token keyword">HASH</span> PARTITIONS <span class="token number">16</span> 
STORED <span class="token keyword">AS</span> KUDU 
TBLPROPERTIES <span class="token punctuation">(</span><span class="token string">'kudu.num_tablet_replicas'</span> <span class="token operator">=</span> <span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre> <p>这时他会自动在Kudu中也创建一个表：</p> <p><img src="https://images2.imgbox.com/22/8c/fQ24dYNw_o.png" alt="MMSIZE"></p> <p>注意：删除内部表，Kudu中的表是会删除的。</p> </li></ul> 
<p><strong>（3）查询</strong></p> 
<p>查询就是SQL语法，大家可以自行尝试，例如：</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> gender<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">max</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span> <span class="token punctuation">,</span><span class="token function">min</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">avg</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span> <span class="token keyword">from</span> students1 <span class="token keyword">where</span> age <span class="token operator">&lt;=</span> <span class="token number">19</span> <span class="token operator">and</span> height <span class="token operator">&gt;</span> <span class="token number">180</span> <span class="token keyword">group</span> <span class="token keyword">by</span> gender<span class="token punctuation">;</span> 
</code></pre> 
<p>查询结果：</p> 
<p><img src="https://images2.imgbox.com/84/a0/3AhL5y6K_o.png" alt="MMSIZE"></p> 
<p><strong>（4）DML</strong></p> 
<p><strong>插入数据：</strong></p> 
<pre><code class="prism language-sql"><span class="token comment">#单行插入 </span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> my_first_table <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"zhangsan"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">select</span>  <span class="token keyword">from</span> my_first_table<span class="token punctuation">;</span> 
</code></pre> 
<p><img src="https://images2.imgbox.com/59/a1/hxQKMwwE_o.png" alt="MMSIZE"></p> 
<pre><code class="prism language-sql"><span class="token comment">#多行插入 </span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> my_first_table <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"lisi"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">"wangwu"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">"zhaoliu"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">select</span>  <span class="token keyword">from</span> my_first_table<span class="token punctuation">;</span> 
</code></pre> 
<p><img src="https://images2.imgbox.com/5b/75/KpixOcpf_o.png" alt="MMSIZE"></p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test2 
<span class="token punctuation">(</span> 
    id <span class="token keyword">BIGINT</span><span class="token punctuation">,</span> 
    name STRING<span class="token punctuation">,</span> 
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> 
<span class="token punctuation">)</span>
<span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> <span class="token keyword">HASH</span> PARTITIONS <span class="token number">6</span>
STORED <span class="token keyword">AS</span> KUDU 
TBLPROPERTIES <span class="token punctuation">(</span><span class="token string">'kudu.num_tablet_replicas'</span> <span class="token operator">=</span> <span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token keyword">select</span>  <span class="token keyword">from</span> test2<span class="token punctuation">;</span> 

<span class="token comment">#从其它表批量导入 </span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test2 <span class="token keyword">SELECT</span>  <span class="token keyword">FROM</span> my_first_table<span class="token punctuation">;</span> 
<span class="token keyword">select</span>  <span class="token keyword">from</span> my_first_table<span class="token punctuation">;</span> 
</code></pre> 
<p><img src="https://images2.imgbox.com/0a/f1/jAlMLVAN_o.png" alt="MMSIZE"></p> 
<p><strong>更新数据：</strong></p> 
<pre><code class="prism language-sql"><span class="token comment">#更新 </span>
<span class="token keyword">UPDATE</span> my_first_table <span class="token keyword">SET</span> name<span class="token operator">=</span><span class="token string">"张三"</span> <span class="token keyword">where</span> id <span class="token operator">=</span><span class="token number">1</span> <span class="token punctuation">;</span> 
<span class="token keyword">select</span>  <span class="token keyword">from</span> my_first_table<span class="token punctuation">;</span> 
</code></pre> 
<p><img src="https://images2.imgbox.com/4b/ac/3BBfDM8q_o.png" alt="MMSIZE"></p> 
<p><strong>删除数据：</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">delete</span> <span class="token keyword">from</span> my_first_table <span class="token keyword">where</span> id <span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span> 
<span class="token keyword">select</span>  <span class="token keyword">from</span> my_first_table<span class="token punctuation">;</span> 
</code></pre> 
<p><img src="https://images2.imgbox.com/45/86/KHsmqPbk_o.png" alt="MMSIZE"></p> 
<p><strong>（5）更改表属性</strong></p> 
<p>1）重命名impala内部表：</p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> my_first_table <span class="token keyword">RENAME</span> <span class="token keyword">TO</span> person<span class="token punctuation">;</span> 
<span class="token keyword">show</span> <span class="token keyword">tables</span><span class="token punctuation">;</span> 
</code></pre> 
<p><img src="https://images2.imgbox.com/c2/45/EfX8JLQ8_o.png" alt="MMSIZE"></p> 
<p>Kudu那边的表也跟着改名了：</p> 
<p><img src="https://images2.imgbox.com/78/b1/jTWUHaqH_o.png" alt="MMSIZE"></p> 
<p>2）重命名impala外部表：</p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> students1 <span class="token keyword">RENAME</span> <span class="token keyword">TO</span> stus<span class="token punctuation">;</span> 
<span class="token keyword">show</span> <span class="token keyword">tables</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/66/43/MN00jvxd_o.png" alt="MMSIZE"></p> 
<p>Kudu那边的表名不会跟着改变（只是改了映射）：</p> 
<p><img src="https://images2.imgbox.com/0b/5d/DFYn03Pe_o.png" alt="MMSIZE"></p> 
<p>3）将外部表重新映射kudu表</p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> external_table 
<span class="token keyword">SET</span> TBLPROPERTIES<span class="token punctuation">(</span><span class="token string">'kudu.table_name'</span> <span class="token operator">=</span> <span class="token string">'xxx'</span><span class="token punctuation">)</span> 
</code></pre> 
<p>4）将内部表改为外部表</p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> my_table <span class="token keyword">SET</span> TBLPROPERTIES<span class="token punctuation">(</span><span class="token string">'EXTERNAL'</span> <span class="token operator">=</span> <span class="token string">'TRUE'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre> 
<h5><a id="_1548"></a>谓词下推</h5> 
<p>所谓谓词简单理解就是SQL的where字句中的条件判断，Impala的原理就是读取Kudu表的数据然后进行计算，如果谓词能够下推到Kudu中去执行则返回给Impala的数据将会很小，性能将大幅提升。目前：</p> 
<ul><li>支持下推的谓词： = , &lt;= , &lt; , &gt; , &gt;= , BETWEEN , IN</li><li>不支持下推的谓词： != , LIKE , 或者Impala中的其他谓词</li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8f4347c11d81fa279805700843e927a5/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">mentor xp 快捷键</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3394152ff640026199fb669eb018478b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Kudu-集群管理、基架感知、透明分层存储管理、性能优化</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>