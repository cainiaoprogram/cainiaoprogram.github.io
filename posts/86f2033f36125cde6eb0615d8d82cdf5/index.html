<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>25-多表查询-练习 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="25-多表查询-练习" />
<meta property="og:description" content="注意这里要会看架构表
-- 部门表 CREATE TABLE dept ( id INT PRIMARY KEY PRIMARY KEY, -- 部门id dname VARCHAR(50), -- 部门名称 loc VARCHAR(50) -- 部门所在地 ); -- 添加4个部门 INSERT INTO dept(id,dname,loc) VALUES (10,&#39;教研部&#39;,&#39;北京&#39;), (20,&#39;学工部&#39;,&#39;上海&#39;), (30,&#39;销售部&#39;,&#39;广州&#39;), (40,&#39;财务部&#39;,&#39;深圳&#39;); -- 职务表，职务名称，职务描述 CREATE TABLE job ( id INT PRIMARY KEY, jname VARCHAR(20), description VARCHAR(50) ); -- 添加4个职务 INSERT INTO job (id, jname, description) VALUES (1, &#39;董事长&#39;, &#39;管理整个公司，接单&#39;), (2, &#39;经理&#39;, &#39;管理部门员工&#39;), (3, &#39;销售员&#39;, &#39;向客人推销产品&#39;), (4, &#39;文员&#39;, &#39;使用办公软件&#39;); -- 员工表 CREATE TABLE emp ( id INT PRIMARY KEY, -- 员工id ename VARCHAR(50), -- 员工姓名 job_id INT, -- 职务id mgr INT , -- 上级领导 joindate DATE, -- 入职日期 salary DECIMAL(7,2), -- 工资 bonus DECIMAL(7,2), -- 奖金 dept_id INT, -- 所在部门编号 CONSTRAINT emp_jobid_ref_job_id_fk FOREIGN KEY (job_id) REFERENCES job (id), CONSTRAINT emp_deptid_ref_dept_id_fk FOREIGN KEY (dept_id) REFERENCES dept (id) ); -- 添加员工 INSERT INTO emp(id,ename,job_id,mgr,joindate,salary,bonus,dept_id) VALUES (1001,&#39;孙悟空&#39;,4,1004,&#39;2000-12-17&#39;,&#39;8000." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/86f2033f36125cde6eb0615d8d82cdf5/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-11-21T09:47:54+08:00" />
<meta property="article:modified_time" content="2021-11-21T09:47:54+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">25-多表查询-练习</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>  注意这里要会看架构表</p> 
<p><img alt="" height="877" src="https://images2.imgbox.com/74/84/VkIm3K9S_o.png" width="640"></p> 
<pre><code class="language-sql">-- 部门表
CREATE TABLE dept (
  id INT PRIMARY KEY PRIMARY KEY, -- 部门id
  dname VARCHAR(50), -- 部门名称
  loc VARCHAR(50) -- 部门所在地
);

-- 添加4个部门
INSERT INTO dept(id,dname,loc) VALUES 
(10,'教研部','北京'),
(20,'学工部','上海'),
(30,'销售部','广州'),
(40,'财务部','深圳');



-- 职务表，职务名称，职务描述
CREATE TABLE job (
  id INT PRIMARY KEY,
  jname VARCHAR(20),
  description VARCHAR(50)
);

-- 添加4个职务
INSERT INTO job (id, jname, description) VALUES
(1, '董事长', '管理整个公司，接单'),
(2, '经理', '管理部门员工'),
(3, '销售员', '向客人推销产品'),
(4, '文员', '使用办公软件');



-- 员工表
CREATE TABLE emp (
  id INT PRIMARY KEY, -- 员工id
  ename VARCHAR(50), -- 员工姓名
  job_id INT, -- 职务id
  mgr INT , -- 上级领导
  joindate DATE, -- 入职日期
  salary DECIMAL(7,2), -- 工资
  bonus DECIMAL(7,2), -- 奖金
  dept_id INT, -- 所在部门编号
  CONSTRAINT emp_jobid_ref_job_id_fk FOREIGN KEY (job_id) REFERENCES job (id),
  CONSTRAINT emp_deptid_ref_dept_id_fk FOREIGN KEY (dept_id) REFERENCES dept (id)
);

-- 添加员工
INSERT INTO emp(id,ename,job_id,mgr,joindate,salary,bonus,dept_id) VALUES 
(1001,'孙悟空',4,1004,'2000-12-17','8000.00',NULL,20),
(1002,'卢俊义',3,1006,'2001-02-20','16000.00','3000.00',30),
(1003,'林冲',3,1006,'2001-02-22','12500.00','5000.00',30),
(1004,'唐僧',2,1009,'2001-04-02','29750.00',NULL,20),
(1005,'李逵',4,1006,'2001-09-28','12500.00','14000.00',30),
(1006,'宋江',2,1009,'2001-05-01','28500.00',NULL,30),
(1007,'刘备',2,1009,'2001-09-01','24500.00',NULL,10),
(1008,'猪八戒',4,1004,'2007-04-19','30000.00',NULL,20),
(1009,'罗贯中',1,NULL,'2001-11-17','50000.00',NULL,10),
(1010,'吴用',3,1006,'2001-09-08','15000.00','0.00',30),
(1011,'沙僧',4,1004,'2007-05-23','11000.00',NULL,20),
(1012,'李逵',4,1006,'2001-12-03','9500.00',NULL,30),
(1013,'小白龙',4,1004,'2001-12-03','30000.00',NULL,20),
(1014,'关羽',4,1007,'2002-01-23','13000.00',NULL,10);



-- 工资等级表
CREATE TABLE salarygrade (
  grade INT PRIMARY KEY,   -- 级别
  losalary INT,  -- 最低工资
  hisalary INT -- 最高工资
);

-- 添加5个工资等级
INSERT INTO salarygrade(grade,losalary,hisalary) VALUES 
(1,7000,12000),
(2,12010,14000),
(3,14010,20000),
(4,20010,30000),
(5,30010,99990);

-- 需求：

-- 1.查询所有员工信息。查询员工编号，员工姓名，工资，职务名称，职务描述
/* 分析：
1.五个列的信息 前三个是emp表中的信息需要查询emp表    职务名称，职务描述需要查询job表
所以第一步是要先看查哪几个表
2.查询条件where  emp.job_id(emp表的job_id)=job.id(job表的主键) 这里有外键*/
SELECT t1.`id`,
t1.`ename`,
t1.`salary`,
t2.`jname`,
t2.`description`
FROM emp t1,job t2 
WHERE  t1.`job_id`=t2.`id`;
-- 2.查询员工编号，员工姓名，工资，职务名称，职务描述，部门名称，部门位置
   -- 分析：
  /* 1.员工编号，员工姓名，工资查的表为emp ，职务描述，部门名称job表
    部门名称，部门位置 dept表
    2.查询条件 emp.job_id =job.id  emp.job_id= job.id;*/
SELECT 
t1.`ename`,
t1.`salary`,
t2.`jname`,
t2.`description`,
t3.`dname`,
t3.`loc`
FROM
emp t1,
job t2,
dept t3
WHERE
t1.`dept_id`=t3.`id` AND
t1.job_id= t2.id;
-- 3.查询员工姓名，工资，工资等级`emp``job``salarygrade`
/*分析：
1.员工姓名，工资查emp表    工资等级查salarygrade表  但是这两个表emp和salarygrade没有关联
2.条件 emp.salary&gt;=salarygrade.losalary and emp.salary&lt;=salarygrade.hisalary
       简化：emp.salary between salarygrade.losalary and emp.salary&lt;=salarygrade.hisalary   
*/
SELECT
t1.`ename`,
t1.`salary`,
t2.`grade`
FROM
emp t1,
salarygrade t2
WHERE
t1.`salary` BETWEEN t2.`losalary` AND t2.`hisalary`;
-- 4.查询员工姓名，工资，职务名称，职务描述，部门名称，部门位置，工资等级
/*
分析：员工姓名，工资 查询emp表; 职务名称，职务描述 查询job表 ；
 部门名称，部门位置查询dept表； 工资等级查询salarygrade表
查询条件：
emp.job_id(emp表的job_id)=job.id(job表的主键) and emp.job_id =job.id 
and emp.salary between salarygrade.losalary and emp.salary&lt;=salarygrade.hisalary   
*/
SELECT 
t1.`ename`,
t1.`salary`,
t2.`jname`,
t2.`description`,
t3.`dname`,
t3.`loc`,
t4.`grade`
FROM 
emp t1,
job t2,
dept t3,
salarygrade t4
WHERE
t1.`job_id`=t2.`id`  -- 员工和职位的关联
AND t1.`dept_id`= t3.`id`   -- 员工和部门的关联
AND t1.`salary` BETWEEN t4.`losalary` AND t4.`hisalary`;
-- 5.查询出部门编号、部门名称、部门位置、部门人数
 /*分析
 1.部门编号、部门名称、部门位置 查询dept表
 部门人数 emp员工表
 2.使用分组查询按照emp.dept.id完成分组 查询count(id)
 3.使用子查询将第二步的查询结果和dept表进行关联查询
 */
 SELECT
 dept_id,
 COUNT(id)
 FROM
 emp
 GROUP BY 
 dept_id;
   -- 上面这个表作为一个虚拟表
   
   SELECT
   t1.`id`,t1.`dname`,t1.`loc`,t2.total
   FROM
   dept t1,
   (SELECT dept_id , COUNT(id) total -- 这里是给count起别名
   FROM emp
   GROUP BY  dept_id) t2 -- 虚拟表要打括号去引号
   WHERE
   t1.`id`= t2.dept_id; -- t1的主键接外键
-- 6.查询所有员工的姓名及其直接上级的姓名,没有领导的员工也需要查询
/*
分析：
1.姓名 查emp表 直接上级姓名mgr查询emp表  所以emp表的id和mgr是自关联
所以我们是在一个emp里查询
2.emp.id=emp.mgr
3.需要查询左表的全部数据 罗贯中没有领导  和交集数据
*/
SELECT
t1.`ename` '员工' ,
t1.`mgr`,
t2.`id`,
t2.`ename` '领导'  -- 这里也能起别名
FROM
emp t1,
emp t2  -- 查询两个emp表的方法就是起别名
WHERE
t1.`mgr`=t2.`id`; -- 注意这个顺序也不能错 
-- 一定是先找mgr=id 否则表内容是反的

SELECT
t1.`ename`,
t1.`mgr`,
t2.`id`,
t2.`ename`
FROM
emp t1
LEFT JOIN emp t2
ON t1.`mgr`=t2.`id`;


</code></pre> 
<p> </p> 
<p><strong><span style="color:#fe2c24;"> 这个连线就是外键  谁对应谁 注意看 1 ∞ 对应的元素位置都是有讲究的 从这里能够得到外键练习和where后面的查询条件</span></strong></p> 
<p><strong><span style="color:#fe2c24;">1.1.查询所有员工信息。查询员工编号，员工姓名，工资，职务名称，职务描述<br> 分析：<br> 1.五个列的信息 前三个是emp表中的信息需要查询emp表    职务名称，职务描述需要查询job表<br> 所以第一步是要先看查哪几个表<br> 2.查询条件where  emp.job_id(emp表的job_id)=job.id(job表的主键) 这里有外键</span></strong></p> 
<pre><code class="language-sql"> 1.查询所有员工信息。查询员工编号，员工姓名，工资，职务名称，职务描述
/* 分析：
1.五个列的信息 前三个是emp表中的信息需要查询emp表    职务名称，职务描述需要查询job表
所以第一步是要先看查哪几个表
2.查询条件where  emp.job_id(emp表的job_id)=job.id(job表的主键) 这里有外键*/
SELECT t1.`id`,t1.`ename`,t1.`salary`,t2.`jname`,t2.`description`
FROM emp t1,job t2 
WHERE  t1.`job_id`=t2.`id`;</code></pre> 
<p><img alt="" height="969" src="https://images2.imgbox.com/1b/61/UoDpycHx_o.png" width="940"></p> 
<p><span style="color:#fe2c24;"> 2.查询员工编号，员工姓名，工资，职务名称，职务描述，部门名称，部门位置<br>    -- 分析：<br>   1.员工编号，员工姓名，工资查的表为emp ，职务描述，部门名称job表<br>     部门名称，部门位置 dept表<br>     2.查询条件 emp.job_id =job.id  emp.job_id= job.id;</span></p> 
<blockquote> 
 <pre><code class="language-sql">-- 2.查询员工编号，员工姓名，工资，职务名称，职务描述，部门名称，部门位置
   -- 分析：
  /* 1.员工编号，员工姓名，工资查的表为emp ，职务描述，部门名称job表
    部门名称，部门位置 dept表
    2.查询条件 emp.job_id =job.id  emp.job_id= job.id;*/
SELECT 
t1.`ename`,
t1.`salary`,
t2.`jname`,
t2.`description`,
t3.`dname`,
t3.`loc`
FROM
emp t1,
job t2,
dept t3
WHERE
t1.`dept_id`=t3.`id` AND
t1.job_id= t2.id;</code></pre> 
 <p> </p> 
</blockquote> 
<p><img alt="" height="926" src="https://images2.imgbox.com/43/de/on55L26C_o.png" width="1115"><span style="color:#fe2c24;">3.查询员工姓名，工资，工资等级`emp``job``salarygrade`</span></p> 
<p><span style="color:#fe2c24;">-- 3.查询员工姓名，工资，工资等级`emp``job``salarygrade`<br> 分析：<br> 1.员工姓名，工资查emp表    工资等级查salarygrade表  但是这两个表emp和salarygrade没有关联<br> 2.条件 </span><span style="color:#4da8ee;"><strong>emp.salary&gt;=salarygrade.losalary and emp.salary&lt;=salarygrade.hisalary<br>      用between and来</strong></span><span style="color:#4da8ee;"><strong>  简化：emp.salary between salarygrade.losalary and emp.salary&lt;=salarygrade.hisalary</strong></span><span style="color:#fe2c24;">   </span><br>  </p> 
<pre><code class="language-sql">-- 3.查询员工姓名，工资，工资等级`emp``job``salarygrade`
/*分析：
1.员工姓名，工资查emp表    工资等级查salarygrade表  但是这两个表emp和salarygrade没有关联
2.条件 emp.salary&gt;=salarygrade.losalary and emp.salary&lt;=salarygrade.hisalary
       简化：emp.salary between salarygrade.losalary and emp.salary&lt;=salarygrade.hisalary   
*/
SELECT
t1.`ename`,
t1.`salary`,
t2.`grade`
FROM
emp t1,
salarygrade t2
WHERE
t1.`salary` BETWEEN t2.`losalary` AND t2.`hisalary`;</code></pre> 
<p><img alt="" height="992" src="https://images2.imgbox.com/73/f1/4xOnBLJ7_o.png" width="1095"></p> 
<p><span style="color:#fe2c24;"> 4.查询员工姓名，工资，职务名称，职务描述，部门名称，部门位置，工资等级<br> 分析：员工姓名，工资 查询emp表; 职务名称，职务描述 查询job表 ；<br>  部门名称，部门位置查询dept表； 工资等级查询salarygrade表<br> 查询条件：<br> emp.job_id(emp表的job_id)=job.id(job表的主键) and emp.job_id =job.id <br> and emp.salary between salarygrade.losalary and emp.salary&lt;=salarygrade.hisalary   </span></p> 
<pre><code class="language-sql">-- 4.查询员工姓名，工资，职务名称，职务描述，部门名称，部门位置，工资等级
/*
分析：员工姓名，工资 查询emp表; 职务名称，职务描述 查询job表 ；
 部门名称，部门位置查询dept表； 工资等级查询salarygrade表
查询条件：
emp.job_id(emp表的job_id)=job.id(job表的主键) and emp.job_id =job.id 
and emp.salary between salarygrade.losalary and emp.salary&lt;=salarygrade.hisalary   
*/
SELECT 
t1.`ename`,
t1.`salary`,
t2.`jname`,
t2.`description`,
t3.`dname`,
t3.`loc`,
t4.`grade`
FROM 
emp t1,
job t2,
dept t3,
salarygrade t4
WHERE
t1.`job_id`=t2.`id`  -- 员工和职位的关联
AND t1.`dept_id`= t3.`id`   -- 员工和部门的关联
AND t1.`salary` BETWEEN t4.`losalary` AND t4.`hisalary`;</code></pre> 
<p><img alt="" height="1065" src="https://images2.imgbox.com/82/c9/ZRT5ehOz_o.png" width="1200"></p> 
<p><span style="color:#fe2c24;"> 5. 查询出部门编号、部门名称、部门位置、部门人数<br> 分析<br>  1.部门编号、部门名称、部门位置 查询dept表<br>  部门人数 emp员工表<br>  2.使用分组查询按照emp.dept.id完成分组 查询count(id)<br>  3.使用子查询将第二步的查询结果和dept表进行关联查询</span></p> 
<pre><code class="language-sql"> 5.查询出部门编号、部门名称、部门位置、部门人数
 /*分析
 1.部门编号、部门名称、部门位置 查询dept表
 部门人数 emp员工表
 2.使用分组查询按照emp.dept.id完成分组 查询count(id)
 3.使用子查询将第二步的查询结果和dept表进行关联查询
 */
 SELECT
 dept_id,
 COUNT(id)
 FROM
 emp
 GROUP BY 
 dept_id;
   -- 上面这个表作为一个虚拟表
   
   SELECT
   t1.`id`,t1.`dname`,t1.`loc`,t2.total
   FROM
   dept t1,
   (SELECT dept_id , COUNT(id) total -- 这里是给count起别名
   FROM emp
   GROUP BY  dept_id) t2 -- 虚拟表要打括号去引号
   WHERE
   t1.`id`= t2.dept_id; -- t1的主键接外键</code></pre> 
<p></p> 
<p><img alt="" height="778" src="https://images2.imgbox.com/ba/80/iY2CwJP4_o.png" width="719"></p> 
<p><span style="color:#fe2c24;"> 6. 查询所有员工的姓名及其直接上级的姓名,没有领导的员工也需要查询<br> 分析：<br> 1.姓名 查emp表 直接上级姓名mgr查询emp表  所以emp表的id和mgr是自关联<br> 所以我们是在一个emp里查询<br> 2.emp.id=emp.mgr<br> 3.需要查询左表的全部数据 罗贯中没有领导  和交集数据</span></p> 
<pre><code class="language-sql">-- 6.查询所有员工的姓名及其直接上级的姓名,没有领导的员工也需要查询
/*
分析：
1.姓名 查emp表 直接上级姓名mgr查询emp表  所以emp表的id和mgr是自关联
所以我们是在一个emp里查询
2.emp.id=emp.mgr
3.需要查询左表的全部数据 罗贯中没有领导  和交集数据
*/
SELECT
t1.`ename` '员工' ,
t1.`mgr`,
t2.`id`,
t2.`ename` '领导'  -- 这里也能起别名
FROM
emp t1,
emp t2  -- 查询两个emp表的方法就是起别名
WHERE
t1.`mgr`=t2.`id`; -- 注意这个顺序也不能错 
-- 一定是先找mgr=id 否则表内容是反的

SELECT
t1.`ename`,
t1.`mgr`,
t2.`id`,
t2.`ename`
FROM
emp t1
LEFT JOIN emp t2
ON t1.`mgr`=t2.`id`;

</code></pre> 
<p></p> 
<p><img alt="" height="1005" src="https://images2.imgbox.com/8c/49/1grBnsmI_o.png" width="843"></p> 
<p>这样查满足不了没有领导的员工也需要查询所以需要左表链接</p> 
<p><img alt="" height="826" src="https://images2.imgbox.com/fc/35/84dVx1Ka_o.png" width="676"></p> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6d255e229e1ca5dd0e32d6870b700583/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">IDEA(最新版)配置servlet</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a66e720f8c0b8f7f60a7579030516171/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">操作系统遇到的问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>