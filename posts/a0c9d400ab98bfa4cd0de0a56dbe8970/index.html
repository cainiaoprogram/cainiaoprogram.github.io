<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Rust 09: 字符串详解（String、&amp;str、内存布局、常用方法） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Rust 09: 字符串详解（String、&amp;str、内存布局、常用方法）" />
<meta property="og:description" content="文章目录 字符串字面量字符串(String)字符串切片(&amp;str）String和&amp;str的内存布局Vec\&lt;u8\&gt;转String（String::from_utf8_lossy()）Vec\&lt;u8\&gt;转String（String::from_utf8()）字符串和数值类型的转换字符数组/列表合并为一个String字符串数组/列表合并(join/concat)为一个String字符串遍历，判断字符是数字还是字母String中追加和删除字符String遍历大小写转换（uppercase/lowercase）find()查找/contains()包含split()分割，返回一个迭代器lines()按行分割split_ascii_whitespace()split_whitespace()starts_with()/ends_with()如何高效修改String中的一个字符？借助remove()和insert()更高效的方式更进一步，自定义SetByIndex trait 字符串字面量 字符串字面量和全局变量、static变量一样位于程序运行之后虚拟地址空间中的代码区。
关于虚拟地址空间，之前有一小节详细分析过：Rust 06: 变量分配在堆还是栈上 &#43; 虚拟地址空间
const g_array: [i32; 5] = [10; 5]; static G_VAR: i32 = 1000; #[test] fn test09_string() { let s: &amp;str = &#34;test string&#34;; //字符串字面量，位于代码区的ROData段 println!(&#34;&amp;str: {:p}&#34;, s);//&amp;str: 0x7ff77e4c6b88 println!(&#34;{:p}&#34;, &amp;g_array);//位于data段:0x7ff6c5fc6bb8 println!(&#34;{:p}&#34;, &amp;G_VAR);//位于data段:0x7ff77e4c6200 } 字符串字面量位于代码区的ROData段，是只读（Read Only）的，在Rust代码中字符串字面量会被处理成字符串切片类型，即&amp;str。如果想要对字符串进行追加等操作，必须先将ROData段的字符串字面量复制一份到堆上，构造一个String类型出来。
字符串(String) String内部其实是一个Vec，是一个可变长度的类型，末尾可以追加字符。String类型和Vec&lt;u8&gt;类型占用24个字节。
pub struct String { vec: Vec&lt;u8&gt;, } println!(&#34;size: {}&#34;, std::mem::size_of::&lt;Vec&lt;u8&gt;&gt;());//24 println!(&#34;size: {}&#34;, std::mem::size_of::&lt;String&gt;());//24 String对象的内存结构，也就是Vec&lt;u8&gt;的内存结构，为 8(ptr) &#43; 8(capacity) &#43; 8(length)。
从字符串字面量构造出一个堆上的String有多种方式：
&#34;xxx&#34;.to_owned()方法内部掉clone()，将字符串字面量从ROData区复制一份到堆上，并返回堆上数据的所有权；String::from(&#34;xxx&#34;)内部实际调用的是&#34;xxx&#34;.to_owned()；&#34;xxx&#34;.to_string()内部实际调用的是String::from(“xxx”)；
也就是说，下面3种方式最终都是调用了clone()： let s1: String = &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/a0c9d400ab98bfa4cd0de0a56dbe8970/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-11-01T10:07:56+08:00" />
<meta property="article:modified_time" content="2022-11-01T10:07:56+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Rust 09: 字符串详解（String、&amp;str、内存布局、常用方法）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><ul><li><a href="#_1" rel="nofollow">字符串字面量</a></li><li><a href="#String_17" rel="nofollow">字符串(String)</a></li><li><a href="#str_55" rel="nofollow">字符串切片(&amp;str）</a></li><li><a href="#Stringstr_68" rel="nofollow">String和&amp;str的内存布局</a></li><li><a href="#Vecu8StringStringfrom_utf8_lossy_93" rel="nofollow">Vec\&lt;u8\&gt;转String（String::from_utf8_lossy()）</a></li><li><a href="#Vecu8StringStringfrom_utf8_113" rel="nofollow">Vec\&lt;u8\&gt;转String（String::from_utf8()）</a></li><li><a href="#_133" rel="nofollow">字符串和数值类型的转换</a></li><li><a href="#String_146" rel="nofollow">字符数组/列表合并为一个String</a></li><li><a href="#joinconcatString_154" rel="nofollow">字符串数组/列表合并(join/concat)为一个String</a></li><li><a href="#_167" rel="nofollow">字符串遍历，判断字符是数字还是字母</a></li><li><a href="#String_180" rel="nofollow">String中追加和删除字符</a></li><li><a href="#String_205" rel="nofollow">String遍历</a></li><li><a href="#uppercaselowercase_219" rel="nofollow">大小写转换（uppercase/lowercase）</a></li><li><a href="#findcontains_226" rel="nofollow">find()查找/contains()包含</a></li><li><a href="#split_233" rel="nofollow">split()分割，返回一个迭代器</a></li><li><a href="#lines_239" rel="nofollow">lines()按行分割</a></li><li><a href="#split_ascii_whitespace_247" rel="nofollow">split_ascii_whitespace()</a></li><li><a href="#split_whitespace_255" rel="nofollow">split_whitespace()</a></li><li><a href="#starts_withends_with_263" rel="nofollow">starts_with()/ends_with()</a></li><li><a href="#String_269" rel="nofollow">如何高效修改String中的一个字符？</a></li><li><ul><li><a href="#removeinsert_270" rel="nofollow">借助remove()和insert()</a></li><li><a href="#_281" rel="nofollow">更高效的方式</a></li><li><a href="#SetByIndex_trait_292" rel="nofollow">更进一步，自定义SetByIndex trait</a></li></ul> 
   </li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h4><a id="_1"></a>字符串字面量</h4> 
<p>字符串字面量和全局变量、static变量一样位于程序运行之后<strong>虚拟地址空间中的代码区</strong>。<br> 关于<strong>虚拟地址空间</strong>，之前有一小节详细分析过：<a href="https://blog.csdn.net/linysuccess/article/details/123765834">Rust 06: 变量分配在堆还是栈上 + 虚拟地址空间</a></p> 
<pre><code class="prism language-rust"><span class="token keyword">const</span> g_array<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token keyword">i32</span><span class="token punctuation">;</span> <span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">;</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token constant">G_VAR</span><span class="token punctuation">:</span> <span class="token keyword">i32</span> <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>
<span class="token attribute attr-name">#[test]</span>
<span class="token keyword">fn</span> <span class="token function-definition function">test09_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">let</span> s<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span> <span class="token operator">=</span> <span class="token string">"test string"</span><span class="token punctuation">;</span>
    <span class="token comment">//字符串字面量，位于代码区的ROData段</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&amp;str: {:p}"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//&amp;str: 0x7ff77e4c6b88</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:p}"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>g_array<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//位于data段:0x7ff6c5fc6bb8</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:p}"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token constant">G_VAR</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//位于data段:0x7ff77e4c6200</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>字符串字面量位于代码区的ROData段，是只读（Read Only）的，在Rust代码中字符串字面量会被处理成<strong>字符串切片</strong>类型，即<code>&amp;str</code>。如果想要对字符串进行追加等操作，必须先将ROData段的字符串字面量复制一份到<strong>堆</strong>上，构造一个<code>String</code>类型出来。</p> 
<h4><a id="String_17"></a>字符串(String)</h4> 
<p>String内部其实是一个Vec，是一个可变长度的类型，末尾可以追加字符。<code>String</code>类型和<code>Vec&lt;u8&gt;</code>类型占用24个字节。</p> 
<pre><code class="prism language-rust"><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">String</span> <span class="token punctuation">{<!-- --></span>
    vec<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-rust"><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"size: {}"</span><span class="token punctuation">,</span> <span class="token namespace">std<span class="token punctuation">::</span>mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//24</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"size: {}"</span><span class="token punctuation">,</span> <span class="token namespace">std<span class="token punctuation">::</span>mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//24</span>
</code></pre> 
<p>String对象的内存结构，也就是<code>Vec&lt;u8&gt;</code>的内存结构，为 <code>8(ptr) + 8(capacity) + 8(length)</code>。</p> 
<hr> 
<p>从字符串字面量构造出一个堆上的String有多种方式：</p> 
<ol><li><code>"xxx".to_owned()</code>方法内部掉clone()，将字符串字面量从ROData区复制一份到堆上，并返回堆上数据的所有权；</li><li><code>String::from("xxx")</code>内部实际调用的是"xxx".to_owned()；</li><li><code>"xxx".to_string()</code>内部实际调用的是String::from(“xxx”)；<br> 也就是说，下面3种方式最终都是调用了<code>clone()</code>：</li></ol> 
<pre><code class="prism language-rust"><span class="token keyword">let</span> s1<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token string">"Hello Rust!"</span><span class="token punctuation">.</span><span class="token function">to_owned</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> s2<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"Hello Rust!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> s3<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token string">"Hello Rust!"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span>s2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>s2<span class="token punctuation">,</span>s3<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span>s3<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"s1: {:p}"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//s1: 0x32a62fec08</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"s2: {:p}"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>s2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//s2: 0x32a62fec20</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"s3: {:p}"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>s3<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//s3: 0x32a62fec38</span>
</code></pre> 
<p>可以看到，&amp;s1、&amp;s2、&amp;s3是3个虚拟地址比较小，互不相同的栈地址。但是，实际上他们最终指向的字符串内容本身是位于堆上。<br> 根据以上信息，我们尝试画一下<code>let s: String = String::from("Hello");</code>的内存布局：<br> <img src="https://images2.imgbox.com/8c/a5/mMyidUjY_o.png" alt="String内存布局"></p> 
<h4><a id="str_55"></a>字符串切片(&amp;str）</h4> 
<pre><code class="prism language-rust"><span class="token keyword">let</span> s1<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token string">"Hello Rust!"</span><span class="token punctuation">.</span><span class="token function">to_owned</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> s2<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">String</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>s1<span class="token punctuation">;</span>
<span class="token keyword">let</span> s3<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span> <span class="token operator">=</span> <span class="token string">"Hello Rust!"</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> slice1<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>s1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">..</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//对String类型进行切片引用</span>
<span class="token keyword">let</span> slice2<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>s2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">..</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//对&amp;String类型进行切片引用</span>
<span class="token keyword">let</span> slice3<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>s3<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">..</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//对&amp;str切片类型，进行切片引用</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> slice1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> slice2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> slice3<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="Stringstr_68"></a>String和&amp;str的内存布局</h4> 
<p>还是先来做个小测试，验证一些想法：</p> 
<pre><code class="prism language-rust"><span class="token comment">// String内部其实是一个Vec&lt;u8&gt;，是一个可变长度的类型，末尾应该可以追加字符。</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"size: {}"</span><span class="token punctuation">,</span> <span class="token namespace">std<span class="token punctuation">::</span>mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//24</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"size: {}"</span><span class="token punctuation">,</span> <span class="token namespace">std<span class="token punctuation">::</span>mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//24</span>

<span class="token keyword">let</span> s1<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token string">"Hello Rust!"</span><span class="token punctuation">.</span><span class="token function">to_owned</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> s2<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"Hello Rust!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> s3<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token string">"Hello Rust!"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 将占用的24个字节，当成3个usize取出</span>
<span class="token keyword">let</span> raw1<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token keyword">usize</span><span class="token punctuation">;</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">unsafe</span> <span class="token punctuation">{<!-- --></span> <span class="token namespace">std<span class="token punctuation">::</span>mem<span class="token punctuation">::</span></span><span class="token function">transmute</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// raw1[0]是一个堆内存地址</span>
<span class="token comment">// ptr: 0x2749d72c2d0, cap: 11, len: 11</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"ptr: 0x{:x}, cap: {}, len: {}"</span><span class="token punctuation">,</span> raw1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> raw1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> raw1<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> raw2<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token keyword">usize</span><span class="token punctuation">;</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">unsafe</span> <span class="token punctuation">{<!-- --></span> <span class="token namespace">std<span class="token punctuation">::</span>mem<span class="token punctuation">::</span></span><span class="token function">transmute</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// ptr: 0x2749d72c190, cap: 11, len: 11</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"ptr: 0x{:x}, cap: {}, len: {}"</span><span class="token punctuation">,</span> raw2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> raw2<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> raw2<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		
<span class="token comment">// ptr: 0x2749d72c1d0, cap: 11, len: 11</span>
<span class="token keyword">let</span> raw3<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token keyword">usize</span><span class="token punctuation">;</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">unsafe</span> <span class="token punctuation">{<!-- --></span> <span class="token namespace">std<span class="token punctuation">::</span>mem<span class="token punctuation">::</span></span><span class="token function">transmute</span><span class="token punctuation">(</span>s3<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"ptr: 0x{:x}, cap: {}, len: {}"</span><span class="token punctuation">,</span> raw3<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> raw3<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> raw3<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>借助<code>unsafe</code>关键字和<code>std::mem::transmute</code>可以将变量对应的值的内存暴露出来。对比虚拟内存地址，我们发现<br> s1、s2、s3实际上是位于堆上不同的位置。也就是说s1、s2、s3分别是从ROData区的"Hello Rust"字面量复制了一份放到堆内存上面。</p> 
<h4><a id="Vecu8StringStringfrom_utf8_lossy_93"></a>Vec&lt;u8&gt;转String（String::from_utf8_lossy()）</h4> 
<p>从<code>&amp;[u8]</code>类型中构造一个<code>str</code>出来。</p> 
<pre><code class="prism language-rust"><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">from_utf8_lossy</span><span class="token punctuation">(</span>v<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Cow</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'_</span><span class="token punctuation">,</span> <span class="token keyword">str</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span> <span class="token punctuation">...</span> <span class="token punctuation">}</span>
</code></pre> 
<p><code>from_utf8_lossy()</code>能够处理输入的<code>u8</code>序列中包含非法<code>utf8字符</code>的情况：</p> 
<ol><li>如果转换过程中遇到非法的序列（不能转成合法的<code>utf8字符</code>），在结果中用<code>U+FFFD</code>（�字符）替代。此时，返回结果是一个具有所有权的<code>str</code>类型。</li><li>如果转换一切顺利，返回的就是对原<code>u8</code>序列（构成的字符）的借用。<br> 因此<code>from_utf8_lossy()</code>的返回结果是一个 <code>Cow&lt;str&gt;</code>（<code>Clone-On-Write</code>）枚举类型。</li></ol> 
<pre><code class="prism language-rust"><span class="token comment">// 转换成功</span>
<span class="token keyword">let</span> list <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token char">b'o'</span><span class="token punctuation">,</span> <span class="token char">b'k'</span><span class="token punctuation">,</span> <span class="token char">b':'</span><span class="token punctuation">,</span> <span class="token char">b'?'</span><span class="token punctuation">,</span> <span class="token number">0x44</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> str1 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from_utf8_lossy</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"str1={:?}"</span><span class="token punctuation">,</span> str1<span class="token punctuation">.</span><span class="token function">into_owned</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//str1="ok:?D"</span>

<span class="token comment">// 部分字符被�替代</span>
<span class="token keyword">let</span> str2 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from_utf8_lossy</span><span class="token punctuation">(</span><span class="token string">b"fail:\xF0\x90\x80"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into_owned</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"str2={:?}"</span><span class="token punctuation">,</span> str2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//str2="fail:�"</span>
</code></pre> 
<h4><a id="Vecu8StringStringfrom_utf8_113"></a>Vec&lt;u8&gt;转String（String::from_utf8()）</h4> 
<p>从<code>Vec&lt;u8&gt;</code>类型中构造一个<code>String</code>出来。</p> 
<pre><code class="prism language-rust"><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">from_utf8</span><span class="token punctuation">(</span>vec<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">FromUtf8Error</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span> <span class="token punctuation">...</span> <span class="token punctuation">}</span>
</code></pre> 
<ol><li>若能转换成合法的<code>utf8字符</code>序列，返回<code>String</code>；</li><li>若不能，返回<code>FromUtf8Error</code>；<br> 即是说，转换结果是一个枚举类型：<code>Result&lt;String, FromUtf8Error&gt;</code>。</li></ol> 
<pre><code class="prism language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>string<span class="token punctuation">::</span></span><span class="token class-name">FromUtf8Error</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> list <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token char">b'a'</span><span class="token punctuation">,</span> <span class="token char">b'b'</span><span class="token punctuation">,</span> <span class="token number">0x3f</span><span class="token punctuation">,</span> <span class="token number">0x44</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> str3<span class="token punctuation">:</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">FromUtf8Error</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from_utf8</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 转换成功，通过unwrap()拿到Result中的合法值</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"str3={:?}"</span><span class="token punctuation">,</span> str3<span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//str3="ab?D"</span>

<span class="token comment">// 转换失败</span>
<span class="token keyword">let</span> str4<span class="token punctuation">:</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">FromUtf8Error</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from_utf8</span><span class="token punctuation">(</span><span class="token macro property">vec!</span><span class="token punctuation">[</span>b'\xF0'<span class="token punctuation">,</span> b'\x90'<span class="token punctuation">,</span> b'\x80'<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"str4 is error: {:?}"</span><span class="token punctuation">,</span> str4<span class="token punctuation">.</span><span class="token function">is_err</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//str4 is error: true</span>
</code></pre> 
<h4><a id="_133"></a>字符串和数值类型的转换</h4> 
<pre><code class="prism language-rust"><span class="token comment">//字符串转i32等数值类型</span>
<span class="token keyword">let</span> x<span class="token punctuation">:</span><span class="token keyword">i32</span> <span class="token operator">=</span> <span class="token string">"123"</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> x<span class="token punctuation">:</span><span class="token keyword">u8</span> <span class="token operator">=</span> <span class="token string">"123"</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 字符串转u8类型的切片</span>
<span class="token keyword">let</span> x<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"123"</span><span class="token punctuation">.</span><span class="token function">as_bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 数值类型转String</span>
<span class="token keyword">let</span> s<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token number">123i32</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> s<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token number">123u8</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="String_146"></a>字符数组/列表合并为一个String</h4> 
<pre><code class="prism language-rust"><span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token char">'a'</span><span class="token punctuation">,</span><span class="token char">'b'</span><span class="token punctuation">,</span><span class="token char">'c'</span><span class="token punctuation">,</span><span class="token char">'d'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{s}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//abcd</span>
<span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token char">'a'</span><span class="token punctuation">,</span><span class="token char">'b'</span><span class="token punctuation">,</span><span class="token char">'c'</span><span class="token punctuation">,</span><span class="token char">'d'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{s}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//abcd</span>
</code></pre> 
<h4><a id="joinconcatString_154"></a>字符串数组/列表合并(join/concat)为一个String</h4> 
<pre><code class="prism language-rust"><span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"ab"</span><span class="token punctuation">,</span><span class="token string">"cd"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{s}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//abcd</span>
<span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token string">"ab"</span><span class="token punctuation">,</span><span class="token string">"cd"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{s}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//abcd</span>

<span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"ab"</span><span class="token punctuation">,</span><span class="token string">"cd"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{s}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ab-cd</span>
<span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token string">"ab"</span><span class="token punctuation">,</span><span class="token string">"cd"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{s}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ab-cd</span>
</code></pre> 
<h4><a id="_167"></a>字符串遍历，判断字符是数字还是字母</h4> 
<p><code>is_alphabetic()</code>，判断字符是否是<code>A-Za-z</code>。<br> <code>is_ascii_digit()</code>，判断字符是否是<code>0-9</code>。</p> 
<pre><code class="prism language-rust"><span class="token keyword">let</span> s<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span> <span class="token operator">=</span> <span class="token string">"abc123"</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> c <span class="token keyword">in</span> s<span class="token punctuation">.</span><span class="token function">chars</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> c<span class="token punctuation">.</span><span class="token function">is_alphabetic</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{} 是字母"</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> c<span class="token punctuation">.</span><span class="token function">is_ascii_digit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{} 是数字"</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="String_180"></a>String中追加和删除字符</h4> 
<pre><code class="prism language-rust"><span class="token comment">// String的追加</span>
<span class="token keyword">let</span> <span class="token keyword">mut</span> s1<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"Hello "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
s1<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">"Rust!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
s1<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token char">'!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
s1<span class="token punctuation">.</span><span class="token function">write_char</span><span class="token punctuation">(</span><span class="token char">'!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
s1 <span class="token operator">+=</span> <span class="token string">" Hello Rust!"</span><span class="token punctuation">;</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Hello Rust!!! Hello Rust!</span>

<span class="token comment">//repeat()</span>
<span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token string">"Hello"</span><span class="token punctuation">.</span><span class="token function">repeat</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//HelloHello</span>

<span class="token comment">// String的insert和remove方法</span>
<span class="token keyword">let</span> <span class="token keyword">mut</span> ss <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">with_capacity</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ss<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token char">'f'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ss<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token char">'o'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ss<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token char">'o'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">assert_eq!</span><span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">,</span> ss<span class="token punctuation">)</span><span class="token punctuation">;</span>
ss<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ss<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token char">'t'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">assert_eq!</span><span class="token punctuation">(</span><span class="token string">"too"</span><span class="token punctuation">,</span> ss<span class="token punctuation">)</span><span class="token punctuation">;</span>
ss<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">assert_eq!</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> ss<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="String_205"></a>String遍历</h4> 
<pre><code class="prism language-rust"><span class="token comment">// Chars是一个u8类型的迭代器，</span>
<span class="token comment">// 遍历String中的u8字符</span>
<span class="token keyword">let</span> chs<span class="token punctuation">:</span> <span class="token class-name">Chars</span> <span class="token operator">=</span> s1<span class="token punctuation">.</span><span class="token function">chars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> ch <span class="token keyword">in</span> chs <span class="token punctuation">{<!-- --></span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> ch<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> byts<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> s1<span class="token punctuation">.</span><span class="token function">as_bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> b <span class="token keyword">in</span> byts <span class="token punctuation">{<!-- --></span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="uppercaselowercase_219"></a>大小写转换（uppercase/lowercase）</h4> 
<pre><code class="prism language-rust"><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token string">"Hello"</span><span class="token punctuation">.</span><span class="token function">to_ascii_lowercase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{x}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//hello</span>
<span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token string">"Hello"</span><span class="token punctuation">.</span><span class="token function">to_ascii_uppercase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{y}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//HELLO</span>
</code></pre> 
<h4><a id="findcontains_226"></a>find()查找/contains()包含</h4> 
<pre><code class="prism language-rust"><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token string">"hello"</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">"ll"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Some(2)</span>
<span class="token keyword">if</span> <span class="token string">"hello kitty"</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"kitty"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"haha kitty"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="split_233"></a>split()分割，返回一个迭代器</h4> 
<pre><code class="prism language-rust"><span class="token keyword">let</span> letters <span class="token operator">=</span> <span class="token string">"a b c d"</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">for_each</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>x<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{<!-- --></span>
    <span class="token macro property">print!</span><span class="token punctuation">(</span><span class="token string">"{x} "</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// a b c d </span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="lines_239"></a>lines()按行分割</h4> 
<p>根据换行符(<code>\n</code>或者<code>\r\n</code>)进行分割。</p> 
<pre><code class="prism language-rust"><span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">"abc\ndef\r\nghi"</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> x <span class="token keyword">in</span> s<span class="token punctuation">.</span><span class="token function">lines</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"${}$"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="split_ascii_whitespace_247"></a>split_ascii_whitespace()</h4> 
<p>根据1到多个<code>ascii</code>空白字符’ ’ \t \n \r进行分割。</p> 
<pre><code class="prism language-rust"><span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">"a b\nc\r\nd\re "</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> x <span class="token keyword">in</span> s<span class="token punctuation">.</span><span class="token function">split_ascii_whitespace</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"${}$"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="split_whitespace_255"></a>split_whitespace()</h4> 
<p>根据1到多个<code>Unicode</code>空白字符’ ’ \t \n \r \u00a0 \u2009进行分割。</p> 
<pre><code class="prism language-rust"><span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">"a b\nc\r\nd\re\u{00a0}f\u{2009}"</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> x <span class="token keyword">in</span> s<span class="token punctuation">.</span><span class="token function">split_whitespace</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"${}$"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="starts_withends_with_263"></a>starts_with()/ends_with()</h4> 
<pre><code class="prism language-rust"><span class="token macro property">assert_eq!</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">"lemon tree"</span><span class="token punctuation">.</span><span class="token function">starts_with</span><span class="token punctuation">(</span><span class="token string">"lemon"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">assert_eq!</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">"lemon tree"</span><span class="token punctuation">.</span><span class="token function">ends_with</span><span class="token punctuation">(</span><span class="token string">"tree"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="String_269"></a>如何高效修改String中的一个字符？</h4> 
<h5><a id="removeinsert_270"></a>借助remove()和insert()</h5> 
<p>可以借助<code>remove()</code>和<code>insert()</code>，但是这2个方法都会导致字符串整体迁移，<strong>是O(n)复杂度的方法</strong>。如果字符串比较长，这样做代价很大。</p> 
<pre><code class="prism language-rust"><span class="token comment">// remove和insert都是O(n)复杂度的</span>
<span class="token comment">// remove会导致删除位置后面的所有字符整体前移1个位置</span>
<span class="token comment">// insert会导致插入位置后面的所有字符整体后移1个位置</span>
<span class="token keyword">let</span> <span class="token keyword">mut</span> s1<span class="token punctuation">:</span><span class="token class-name">String</span> <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
s1<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
s1<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token char">'X'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">assert_eq!</span><span class="token punctuation">(</span><span class="token string">"Xello"</span><span class="token punctuation">,</span> s1<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h5><a id="_281"></a>更高效的方式</h5> 
<p>对于追求极致效率的rust而言，提供了<code>unsafe</code>关键字。这里有一个O(1)复杂度的<code>unsafe</code>方法：</p> 
<pre><code class="prism language-rust"><span class="token comment">// 如何高效修改String中的一个字符</span>
<span class="token keyword">let</span> <span class="token keyword">mut</span> s1<span class="token punctuation">:</span><span class="token class-name">String</span> <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">unsafe</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">let</span> s1_bytes<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> s1<span class="token punctuation">.</span><span class="token function">as_bytes_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    s1_bytes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">b'X'</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"s1 new={}"</span><span class="token punctuation">,</span> s1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//s1 new=Xello</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="SetByIndex_trait_292"></a>更进一步，自定义SetByIndex trait</h5> 
<p>为了调用更加方便，我们完全可以自定义一个根据位置修改字符的<code>trait</code>，并且为<code>String</code>类型实现这个<code>trait</code>。</p> 
<pre><code class="prism language-rust"><span class="token keyword">trait</span> <span class="token type-definition class-name">SetByIndex</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">fn</span> <span class="token function-definition function">set_by_index</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> idx<span class="token punctuation">:</span> <span class="token keyword">usize</span><span class="token punctuation">,</span> c<span class="token punctuation">:</span> <span class="token keyword">u8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">impl</span> <span class="token class-name">SetByIndex</span> <span class="token keyword">for</span> <span class="token class-name">String</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">fn</span> <span class="token function-definition function">set_by_index</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> idx<span class="token punctuation">:</span> <span class="token keyword">usize</span><span class="token punctuation">,</span> c<span class="token punctuation">:</span> <span class="token keyword">u8</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> idx<span class="token operator">&lt;</span><span class="token number">0</span> <span class="token operator">||</span> idx<span class="token operator">&gt;=</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token macro property">panic!</span><span class="token punctuation">(</span><span class="token string">"Index out of bounds: {}, expected: [0,{})"</span><span class="token punctuation">,</span> idx<span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">unsafe</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">let</span> _buf<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">as_bytes_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            _buf<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">=</span> c<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> <span class="token keyword">mut</span> ss <span class="token operator">=</span> <span class="token string">"Hello"</span><span class="token punctuation">.</span><span class="token function">to_owned</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ss<span class="token punctuation">.</span><span class="token function">set_by_index</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token char">b'X'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"ss={}"</span><span class="token punctuation">,</span> ss<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ss=Xello</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/96654d82e07549cd3170ccb413eba2a9/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【Linux】JetsonNano安装CMake</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/70a768bc1b6caa2319f3419f14ee6f75/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">vosviewer保存成PDF文件时没有文字</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>