<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>序列检测器的verilog实现 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="序列检测器的verilog实现" />
<meta property="og:description" content="一、要求 设计一个序列检测同步时序逻辑电路，要实现的功能如下：
当已有输入码流出现序列111000或101110时输出检测信号为1，否则输出为0。在时序上检测到完整序列的下一个时钟周期输出检测结果。输入信号有效为1时表示当前输入有效，否则表示无效。之前输入依旧计入序列中并不清零，即允许序列重叠检测。例如：
输入码流（设输入数据均有效）和输出检测为
[I] 0 0 1 1 1 0 0 0 1 1 0 1 1 1 0 0 0 0
[O] 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 1 0 1
模块输入输出功能定义：
名称
方向
位宽
描述
clk
I
1
系统时钟
rst_n
I
1
异步复位，低电平有效
din_vld
I
1
输入数据有效指示
din
I
1
输入数据
result
O
1
输出检测结果
二、实现 1.移位寄存器比较法 /*模块端口定义*/ module seq_detect( input clk, input	rst_n, input din_vld, input	din, output	reg result ); reg [5:0] tmp = 6&#39;d0; /*移位寄存器*/ always @(posedge clk or negedge rst_n) begin if(!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/4d3ea97bc83133559158d9539ca797b5/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-20T14:22:33+08:00" />
<meta property="article:modified_time" content="2023-10-20T14:22:33+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">序列检测器的verilog实现</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>一、要求</h2> 
<p style="margin-left:.0001pt;text-align:justify;">设计一个序列检测同步时序逻辑电路，要实现的功能如下：</p> 
<p style="margin-left:.0001pt;text-align:justify;">当已有输入码流出现序列<span style="color:#fe2c24;">111000或101110时输出检测信号为1</span>，否则输出为0。在时序上检测到完整序列的<span style="color:#fe2c24;">下一个时钟周期</span>输出检测结果。输入信号有效为1时表示当前输入有效，否则表示无效。之前输入依旧计入序列中并不清零，即允许序列重叠检测。例如：</p> 
<p style="margin-left:.0001pt;text-align:justify;">输入码流（设输入数据均有效）和输出检测为</p> 
<p style="margin-left:.0001pt;text-align:justify;">[I] 0 0 <strong><span style="color:#0070c0;"><strong>1 1 1 0 0 0</strong></span></strong> 1 <strong><span style="color:#0070c0;"><strong>1 0 1 1 1 0 0 0</strong></span></strong> 0</p> 
<p style="margin-left:.0001pt;text-align:justify;">[O] 0 0 0 0 0 0 0 0 <strong><span style="color:#ff0000;"><strong>1</strong></span></strong> 0 0 0 0 0 0 <strong><span style="color:#ff0000;"><strong>1</strong></span></strong> 0 <strong><span style="color:#ff0000;"><strong>1</strong></span></strong></p> 
<p style="margin-left:.0001pt;text-align:justify;">模块输入输出功能定义：</p> 
<table align="center" border="1" cellspacing="0"><tbody><tr><td style="vertical-align:top;width:85.05pt;"> <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>名称</strong></strong></p> </td><td style="vertical-align:top;width:70.9pt;"> <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>方向</strong></strong></p> </td><td style="vertical-align:top;width:70.9pt;"> <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>位宽</strong></strong></p> </td><td style="vertical-align:top;width:141.75pt;"> <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>描述</strong></strong></p> </td></tr><tr><td style="vertical-align:top;width:85.05pt;"> <p style="margin-left:.0001pt;text-align:justify;">clk</p> </td><td style="vertical-align:top;width:70.9pt;"> <p style="margin-left:.0001pt;text-align:justify;">I</p> </td><td style="vertical-align:top;width:70.9pt;"> <p style="margin-left:.0001pt;text-align:justify;">1</p> </td><td style="vertical-align:top;width:141.75pt;"> <p style="margin-left:.0001pt;text-align:justify;">系统时钟</p> </td></tr><tr><td style="vertical-align:top;width:85.05pt;"> <p style="margin-left:.0001pt;text-align:justify;">rst_n</p> </td><td style="vertical-align:top;width:70.9pt;"> <p style="margin-left:.0001pt;text-align:justify;">I</p> </td><td style="vertical-align:top;width:70.9pt;"> <p style="margin-left:.0001pt;text-align:justify;">1</p> </td><td style="vertical-align:top;width:141.75pt;"> <p style="margin-left:.0001pt;text-align:justify;">异步复位，低电平有效</p> </td></tr><tr><td style="vertical-align:top;width:85.05pt;"> <p style="margin-left:.0001pt;text-align:justify;">din_vld</p> </td><td style="vertical-align:top;width:70.9pt;"> <p style="margin-left:.0001pt;text-align:justify;">I</p> </td><td style="vertical-align:top;width:70.9pt;"> <p style="margin-left:.0001pt;text-align:justify;">1</p> </td><td style="vertical-align:top;width:141.75pt;"> <p style="margin-left:.0001pt;text-align:justify;">输入数据有效指示</p> </td></tr><tr><td style="vertical-align:top;width:85.05pt;"> <p style="margin-left:.0001pt;text-align:justify;">din</p> </td><td style="vertical-align:top;width:70.9pt;"> <p style="margin-left:.0001pt;text-align:justify;">I</p> </td><td style="vertical-align:top;width:70.9pt;"> <p style="margin-left:.0001pt;text-align:justify;">1</p> </td><td style="vertical-align:top;width:141.75pt;"> <p style="margin-left:.0001pt;text-align:justify;">输入数据</p> </td></tr><tr><td style="vertical-align:top;width:85.05pt;"> <p style="margin-left:.0001pt;text-align:justify;">result</p> </td><td style="vertical-align:top;width:70.9pt;"> <p style="margin-left:.0001pt;text-align:justify;">O</p> </td><td style="vertical-align:top;width:70.9pt;"> <p style="margin-left:.0001pt;text-align:justify;">1</p> </td><td style="vertical-align:top;width:141.75pt;"> <p style="margin-left:.0001pt;text-align:justify;">输出检测结果</p> </td></tr></tbody></table> 
<p></p> 
<h2>二、实现</h2> 
<h3> 1.移位寄存器比较法</h3> 
<pre><code>/*模块端口定义*/
module seq_detect(

	input 				clk,
	input				rst_n,
	input 				din_vld,
	input		 		din,
	output	reg 		result
    );

reg [5:0] tmp = 6'd0; 

/*移位寄存器*/
always @(posedge clk or negedge rst_n) begin

	if(!rst_n)	tmp &lt;= 6'd0;
	else if(din_vld)	tmp[5:0] &lt;= {tmp[4:0],din};
	
end

/*条件判断产生输出*/
always @(posedge clk or negedge rst_n) begin
	if(!rst_n) result &lt;= 1'b0;
	else if(tmp == 6'b111000 || tmp == 6'b101110)	result &lt;= 1'b1;
	else result &lt;= 1'b0;
end


endmodule
</code></pre> 
<p> testbench:</p> 
<pre><code>`timescale 1ns / 1ps

module tb_seq_detect();
reg			clk;
reg			rst_n;
reg			din_vld;
reg 		din;
wire		result;

initial begin
	clk		 = 1'b0;
	rst_n 	 = 1'b0;
	din_vld	 = 1'b0;
	#10
	din 	 = 1'd0;
	#100
	rst_n 	 = 1'b1;
	din_vld  = 1'b1;	
end

always #50 clk = ~clk; //10MHz
always #2000 din_vld = ~din_vld;

/*产生随机输入*/
always @(posedge clk) begin
	 din &lt;= {$random}%2;	
end

/*实例化测试模块*/
seq_detect u_seq_detect(
	.clk(clk),
	.rst_n(rst_n),
	.din(din),
	.din_vld(din_vld),
	.result(result)
);

endmodule
</code></pre> 
<p>仿真结果：</p> 
<p><img alt="" height="456" src="https://images2.imgbox.com/4a/4f/WNm3aXwS_o.png" width="1200"></p> 
<p>可见对于输入的随机序列，在rst_n = 1且din_vld = 1的条件下，满足连续输入的6bit为111000和101110时，输出result = 1。din_vld = 0时输入无效，tmp保持原状态。</p> 
<h3>2、有限状态机FSM</h3> 
<pre><code>/*
三段式状态机：三个always模块
1.同步时序描述状态转移；
2.组合逻辑判断状态转移条件；
3.描述状态输出
*/

/*模块端口定义*/
module seq_detect(

	input 				clk,
	input				rst_n,
	input 				din_vld,
	input		 		din,
	output	reg 		result
    );
	
reg [3:0] state, next_state;

/*
	分析: 共有12个状态，对应输入如下：
	idle:0	s1:1	s2:11	s3:111	 s4 :1110	s5 :11100	s6:111000
			s7:10	s8:101	s9:1011	 s10:10111	s11:101110

*/

/*状态编码*/
parameter idle = 4'd0, s1 = 4'd1, s2 = 4'd2, s3 = 4'd3, s4  = 4'd4,  s5  = 4'd5,
			s6 = 4'd6, s7 = 4'd7, s8 = 4'd8, s9 = 4'd9, s10 = 4'd10, s11 = 4'd11;

/*状态转移*/
always @(posedge clk or negedge rst_n) begin

	if(!rst_n) state &lt;= idle;
	else if (din_vld) state &lt;= next_state;
	else			  state &lt;= state;
end

/*转移条件判断*/
always @(*) begin
	case(state)
		idle:	 next_state = din ? s1  : idle;
		s1:		 next_state = din ? s2  : s7;
		s2:		 next_state = din ? s3  : s7;
		s3:		 next_state = din ? s3  : s4;
		s4:		 next_state = din ? s8  : s5;
		s5:		 next_state = din ? s1  : s6;
		s6:		 next_state = din ? s1  : idle;
		s7:		 next_state = din ? s8  : idle;
		s8:		 next_state = din ? s9  : s7;
		s9:		 next_state = din ? s10 : s7;
		s10:	 next_state = din ? s3  : s11;
		s11:	 next_state = din ? s8  : s5;
		default: next_state = idle;
	endcase
end

/*输出描述*/
always @(posedge clk or negedge rst_n) begin
	if(!rst_n)	result &lt;= 1'b0;
	else if(state == s6 || state == s11) result &lt;= 1'b1;
	else	result &lt;= 1'b0;
end

endmodule
</code></pre> 
<p>testbench同上。</p> 
<p>仿真结果：</p> 
<p><img alt="" height="264" src="https://images2.imgbox.com/06/f5/UyjSJGNV_o.png" width="1200"></p> 
<p> 可见输入为连续的101110和111000时，在下一个时钟周期有result = 1。</p> 
<p>综合结果：</p> 
<p><img alt="" height="257" src="https://images2.imgbox.com/ac/09/MMEBJVuV_o.png" width="1200"></p> 
<p> 2022/1/17 1:32 </p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/28d04fde62c0252f17e6aa2ad8f8a27f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">docker-启动rancher</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b8be3a78d9332d6e05dd341837ef3de3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Vue2版本的ElementUI的input组件加千分符</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>