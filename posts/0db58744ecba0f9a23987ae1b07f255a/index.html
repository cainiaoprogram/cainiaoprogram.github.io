<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>nmap使用指南 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="nmap使用指南" />
<meta property="og:description" content="基本功能：主机发现，端口扫描，应用程序与版本信息侦测，操作系统侦测
附加功能：规避FW/IDS（防火墙）,NSE脚本定制与使用
命令语法格式 默认方式扫描
nmap &lt;目标地址&gt;
全面扫描
nmap -A -T 4 -v &lt;目标地址&gt;
主机发现 目标：确认目标主机是否在线（Alive 处于开启状态）
原理：与ping命令类似，发送探测包到目标主机，如果收到回复，则说明目标主机是开启得到
探测方式：
ICMP ECHO(ping) /TIMESTAMP /NETMASK(子网掩码) 报文
TCP SYN /ACK 报文
SCTP INIT /COOKIE-ECHO报文
.....
主机发现相关命令选项
实例一：局域网内执行Ping扫描
目标：扫描局域网192.168.40.1-192.168.40.254内哪些IP的主机在线
命令：nmap -sP 192.168.40.1-254或nmap -sP 192.168.40.0/24
说明：在局域网内，无论采用哪一种选项，nmap都是通过ARP包来查询IP地址上的主机是否活动的，如果收到ARP回复包，说明主机在线
实例二：跨网段执行Ping扫描
目标：扫描跨网段目标主机192.168.50.5是否在线
命令:nmap -sP 192.168.50.5
说明:扫描跨网段目标主机时，使用-sp或-sn选项，默认情况下Nmap会依次发送4种不同类型的数据包（ICMP echo request,TCP SYN packet to port 443,TCP ACK packet to port 80,ICMP timestamp request)来探测目标主机是否在线，只要收到其中一个包的回复，就证明目标机在线
实例三：--packet-trace的使用
命令：nmap -sP --packet-trace [目标主机] 或者 nmap -sP [目标主机] --packet-trace" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/0db58744ecba0f9a23987ae1b07f255a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-12-16T16:48:34+08:00" />
<meta property="article:modified_time" content="2021-12-16T16:48:34+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">nmap使用指南</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2></h2> 
<p>基本功能：主机发现，端口扫描，应用程序与版本信息侦测，操作系统侦测</p> 
<p>附加功能：规避FW/IDS（防火墙）,NSE脚本定制与使用</p> 
<h3>命令语法格式</h3> 
<ul><li> <p>默认方式扫描</p> </li></ul> 
<p>nmap &lt;目标地址&gt;</p> 
<ul><li> <p>全面扫描</p> </li></ul> 
<p>nmap -A -T 4 -v &lt;目标地址&gt;</p> 
<h3>主机发现</h3> 
<p>目标：确认目标主机是否在线（Alive 处于开启状态）</p> 
<p>原理：与ping命令类似，发送探测包到目标主机，如果收到回复，则说明目标主机是开启得到</p> 
<p>探测方式：</p> 
<p>ICMP ECHO(ping) /TIMESTAMP /NETMASK(子网掩码) 报文</p> 
<p>TCP SYN /ACK 报文</p> 
<p>SCTP INIT /COOKIE-ECHO报文</p> 
<p>.....</p> 
<p>主机发现相关命令选项</p> 
<p></p> 
<p></p> 
<p>实例一：局域网内执行Ping扫描</p> 
<p>目标：扫描局域网192.168.40.1-192.168.40.254内哪些IP的主机在线</p> 
<p>命令：nmap -sP 192.168.40.1-254或nmap -sP 192.168.40.0/24</p> 
<p>说明：在局域网内，无论采用哪一种选项，nmap都是通过ARP包来查询IP地址上的主机是否活动的，如果收到ARP回复包，说明主机在线</p> 
<p></p> 
<p>实例二：跨网段执行Ping扫描</p> 
<p>目标：扫描跨网段目标主机192.168.50.5是否在线</p> 
<p>命令:nmap -sP 192.168.50.5</p> 
<p>说明:扫描跨网段目标主机时，使用-sp或-sn选项，默认情况下Nmap会依次发送4种不同类型的数据包（ICMP echo request,TCP SYN packet to port 443,TCP ACK packet to port 80,ICMP timestamp request)来探测目标主机是否在线，只要收到其中一个包的回复，就证明目标机在线</p> 
<p></p> 
<p>实例三：--packet-trace的使用</p> 
<p>命令：nmap -sP --packet-trace [目标主机] 或者 nmap -sP [目标主机] --packet-trace</p> 
<h3>端口扫描</h3> 
<p>目标：确定目标主机的TCP/UDP端口的开放情况</p> 
<p>原理：发送TCP，UDP等类型的探测包到目标端口，根据收到的回复包判定端口是否开放</p> 
<p>端口的六个状态：</p> 
<p>open:开放</p> 
<p>closed:关闭</p> 
<p>filtered:端口被防火墙，IDS/IPS屏蔽，无法确定其状态</p> 
<p>unfiltered:端口没有被屏蔽，但是否开放需要进一步确定</p> 
<p>open|filtered:端口是开放的或被屏蔽</p> 
<p>closed|filtered:端口是关闭的或被屏蔽</p> 
<p>端口扫描相关的命令选项：</p> 
<p></p> 
<p></p> 
<p>实例四：-p选项的应用--指定扫描的端口号</p> 
<p><strong>命令：nmap -p 指定端口号 [目的主机]</strong></p> 
<p>关于-p:nmap仅对用-P指定的TCP端口进行扫描，扫描方式为-sS(TCP SYN扫描)。如果既要扫描TCP端口，又要扫描UDP端口，则可以用”T：“ “U：”参数指定目标端口，并指定-sU(UDP扫描方式)和至少一种TCP扫描方式，如：</p> 
<p>nmap -p T:139,U:53 -sS -sU 192.168.40.178</p> 
<h4>TCP SYN 扫描（-sS)原理</h4> 
<p>Nmap向目标端口发送TCP SYN报文，如果目标机返回TCP SYN+ACK报文，则说明目标端口处于开放状态，同时Nmap会紧接着向目标机发送TCP RST报文以重置此连接；如果目标机返回TCP RST+ACK报文，则说明目标端口处于关闭状态</p> 
<p>实例五：-sS选项的应用--TCP SYN扫描</p> 
<p>命令：nmap -p 80 -sS [目标主机] //只能管理员权限才能使用这条命令</p> 
<p></p> 
<h4>TCP connet扫描（-sT)原理</h4> 
<p>nmap向目标端口发送TCP SYN报文，如果目标机返回TCP SYN+ACK报文，则说明目标端口处于开放状态，同时会紧接向目标机依次发送TCP ACK TCP RST+ACK完成三次握手和重置此连接，如果目标机返回TCP RST+ACK报文，则说明目标端口处于关闭状态 //RST是断开连接 任何权限的用户都能使用这条命令</p> 
<p>命令：nmap -p 80 -sT [目标主机]</p> 
<p></p> 
<h4>TCP ACK 扫描（-sA)原理（判断防火墙有没有开启）</h4> 
<p>nmap向目标端口发送TCP ACK报文，无论目标端口是否处于开放状态，目标机都会返回TCP RST报文。如果Nmap主机能收到此TCP RST报文，则说明目标端口未被防火墙屏蔽</p> 
<p>TCP ACK扫描只能用于确定防火墙是否屏蔽某个端口，可以辅助TCP SYN的方式来判断主机防火墙的状况</p> 
<p></p> 
<h4>隐蔽扫描（-sF/-sN/-sX)原理（只对Linux操作系统有用）</h4> 
<p>nmap向目标端口发送TCP FIN （-sF)/NULL(-sN)/FIN+PSH+URG(-sX)报文</p> 
<p>对于Linux系统的目标机，如果目标机未响应，则说明目标端口处于开放状态或被防火墙屏蔽；如果目标机返回TCP RST+ACK报文，则说明目标端口处于关闭状态</p> 
<p>对于Windows系统的目标机，无论目标端口处于开放还是关闭状态，目标机都会返回TCP RST+ACK报文</p> 
<p>因此，隐蔽扫描方式适合于Linux系统的目标主机端口扫描</p> 
<p>命令：nmap -p 80 -sF/-sN/-sX [目标主机]</p> 
<h3>应用程序与版本信息侦测（比端口扫描多了版本信息）</h3> 
<p>目标：识别目标主机开放的TCP/UDP端口上运行的服务及版本信息</p> 
<p>应用程序与版本信息侦测相关的命令选项</p> 
<p></p> 
<p>命令：nmap -sV [目的主机]</p> 
<p>实例：--version-trace选项的应用--跟踪版本扫描活动</p> 
<p>命令：nmap -sV --version-trace [目的主机]</p> 
<h3>操作系统侦测</h3> 
<p>目标：识别目标主机操作系统的类型</p> 
<p>侦测方式：网络协议指纹识别技术</p> 
<p>操作系统数据库文件（nmap-os-db)</p> 
<p>命令选项</p> 
<p>nmap -O [目的主机]</p> 
<p></p> 
<ul><li> <p>TTL（根据不同的操作系统具有不同的TTL值来判断是什么类型的操作系统)</p> </li></ul> 
<p>time to live,即数据报的存活时间，表示一个数据包在被丢弃之前可以通过多少跃点（跳），不同的操作系统的缺省TTL值往往是不一样的</p> 
<blockquote> 
 <p>Windows TTL=128</p> 
 <p>Unix TTL=60</p> 
 <p>Linux TTL=64</p> 
</blockquote> 
<ul><li> <p>DF位</p> </li></ul> 
<p>DF（不分段）位识别：不同OS(操作系统）对DF位有不同的处理方式，有些OS设置DF位，有些不设置DF位，还有一些OS在特定场合设置DF位，在其他场合不设置DF位</p> 
<ul><li> <p>Windows Size (窗口大小)</p> </li></ul> 
<p>Windows Size :TCP接收（发送）窗口大小，他决定了接收信息的机器在收到剁手数据包后发送ACK包</p> 
<ul><li> <p>ACK序号</p> </li></ul> 
<p>不同的操作系统处理ACK序号是不同的，如果发送一个FIN+PSH+URG的数据包到一个关闭的TCP端口，大多数操作系统会把回应ACK包的序号设置成发送的包的初始序号，而Windows和一些打印机则会发送序号为初始序号加1的ACK包</p> 
<ul><li> <p>对FIN包的响应</p> </li></ul> 
<p>发送一个只有FIN标志位的TCP数据包给一个打开的端口，Linux等系统不响应2；有些系统如Windows cisco hp/ux等，发回一个RST</p> 
<ul><li> <p>ISN（初始化序列号）</p> </li><li> <p>主机使用的端口</p> </li></ul> 
<h3>规避FW/IDS技术</h3> 
<p>目标：绕过目标主机的防火墙，入侵检测系统等防护手段</p> 
<p>报文分段：将报文分成一段一段的去过防火墙，当一段一段的报文可能没什么害处，但是当这些防火墙拼接在一起的时候就产生了害处</p> 
<p></p> 
<p>实例：-T选项的应用---------控制扫描速度</p> 
<p>命令：nmap -T (0~5) [目标主机]</p> 
<p>使用=T（0~5)可以启用时序选项，一般来说，数字越大，速度越快，精度越低</p> 
<blockquote> 
 <p>-T0 (偏执的)：非常慢的扫描，用于IDS逃避</p> 
 <p>-T1（鬼祟的）：缓慢的扫描，用于IDS逃避</p> 
 <p>-T2（文雅的）：降低速度以降低对带宽的消耗，此选项一般不常用</p> 
 <p>-T3（普通的）：‘默认，根据目标的反应自动调整时间</p> 
 <p>-T4（0野蛮的）：快速扫描，常用扫描方式，需要在很好的网络环境下使用</p> 
 <p>-T5（疯狂的）：快速扫描，以牺牲准确度来提升扫描速度</p> 
</blockquote> 
<p></p> 
<p>实例：-D选项的应用-------源IP地址的欺骗</p> 
<p>命令：nmap -D RND:2 [目的主机]</p> 
<p>//RND为诱饵，后面的参数为指定诱饵的个数</p> 
<p></p> 
<p>实例：空闲扫描（-sI)的应用</p> 
<p>命令：nmap -sI [僵尸ip地址，例如服务器的IP地址] [目标主机]</p> 
<p></p> 
<p>实例：源MAC地址欺骗</p> 
<p>命令：nmap --spoof-mac 0[目标ip]</p> 
<p>//参数0表示随机分配一个MAC地址，也可以手动指定MAC地址，如：nmap --spoof-mac aa:bb:cc:dd:ee:ff [目标主机]</p> 
<h3>NSE脚本的简单应用</h3> 
<p>NSE和Lua</p> 
<p>除了常规的网络扫描，Nmap还可根据NSE（Nmap scripting Engine)的脚本进行大量渗透工作，这种脚本基于Lua语言编写</p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p>命令：nmap --scipt vuln [目标主机]</p> 
<p>//vuln为一个脚本 扫描主机有什么漏洞</p> 
<p>命令：nmap --script http-enum.use [网站名]</p> 
<p>//扫描网站上的漏洞</p> 
<p></p> 
<p>实例：暴力破解脚本（--script brute)应用</p> 
<p>提供暴力破解的方式，可对数据库，SMB，SNMP等进行简单密码的暴力猜解</p> 
<p>命令：nmap --script brute [目标主机]</p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/46d25fe34e090275acaf0196d7e1d694/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">cv2多图拼接</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8c576da130720914d3e41fe9e1a0d23e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">sql注入过程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>