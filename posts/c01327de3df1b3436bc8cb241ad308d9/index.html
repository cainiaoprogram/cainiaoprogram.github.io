<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>目标检测-yolov50-火灾识别可视化 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="目标检测-yolov50-火灾识别可视化" />
<meta property="og:description" content="使用yolov5模型对利用开源火灾数据集进行训练模型，实现对照片、视频以及摄像头的火焰烟雾的检测。
详细的环境配置见：目标检测-YOLOV5-口罩检测
学习目标： 数据集的准备 预训练权重 训练模型 训练模型路径的修改 模型测试 pyqt可视化 重要的事情，出错请去查看！！！ 目标检测-YOLOV5-口罩检测
一、数据集的准备 1.数据集的下载 链接：https://pan.baidu.com/s/1LLfnSOEBdlgOnL_iEyMIsA
提取码：ghaq
2.划分数据集为训练集和验证集 该数据集的标签是xml格式，训练yolo模型需要txt类型的标签。需要先将xml类型的标签转换为txt类型，再划分数据集。
需要新建几个文件夹，具体如下：
划分数据集的py文件
split_train_val.py
# coding=utf-8 import xml.etree.ElementTree as ET import pickle import os from os import listdir, getcwd from os.path import join import random from shutil import copyfile classes = [&#34;fire&#34;, &#34;smoke&#34;] # classes=[&#34;ball&#34;] TRAIN_RATIO = 80 #训练集和验证集的比例，说明80%的训练集，20%的验证集 def clear_hidden_files(path): dir_list = os.listdir(path) for i in dir_list: abspath = os.path.join(os.path.abspath(path), i) if os." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/c01327de3df1b3436bc8cb241ad308d9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-16T21:12:46+08:00" />
<meta property="article:modified_time" content="2023-04-16T21:12:46+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">目标检测-yolov50-火灾识别可视化</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>使用yolov5模型对利用开源火灾数据集进行训练模型，实现对照片、视频以及摄像头的火焰烟雾的检测。</p> 
<p>详细的环境配置见：<a href="https://blog.csdn.net/weixin_44765471/article/details/130105482">目标检测-YOLOV5-口罩检测</a></p> 
<h2><a id="_5"></a>学习目标：</h2> 
<ul><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled> 数据集的准备</li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled> 预训练权重</li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled> 训练模型</li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled> 训练模型路径的修改</li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled> 模型测试</li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled> pyqt可视化</li></ul> 
<hr> 
<h2><a id="_16"></a>重要的事情，出错请去查看！！！</h2> 
<p><a href="https://blog.csdn.net/weixin_44765471/article/details/130105482">目标检测-YOLOV5-口罩检测</a></p> 
<h2><a id="_18"></a>一、数据集的准备</h2> 
<h3><a id="1_19"></a>1.数据集的下载</h3> 
<p>链接：https://pan.baidu.com/s/1LLfnSOEBdlgOnL_iEyMIsA<br> 提取码：ghaq</p> 
<h3><a id="2_22"></a>2.划分数据集为训练集和验证集</h3> 
<p>该数据集的标签是xml格式，训练yolo模型需要txt类型的标签。需要先将xml类型的标签转换为txt类型，再划分数据集。</p> 
<p>需要新建几个文件夹，具体如下：<br> <img src="https://images2.imgbox.com/9f/04/u3ciZI8m_o.png" alt="在这里插入图片描述"><br> 划分数据集的py文件<br> <img src="https://images2.imgbox.com/45/23/JBeTVNJ9_o.png" alt="在这里插入图片描述"></p> 
<p>split_train_val.py</p> 
<pre><code class="prism language-python">
<span class="token comment"># coding=utf-8</span>
<span class="token keyword">import</span> xml<span class="token punctuation">.</span>etree<span class="token punctuation">.</span>ElementTree <span class="token keyword">as</span> ET
<span class="token keyword">import</span> pickle
<span class="token keyword">import</span> os
<span class="token keyword">from</span> os <span class="token keyword">import</span> listdir<span class="token punctuation">,</span> getcwd
<span class="token keyword">from</span> os<span class="token punctuation">.</span>path <span class="token keyword">import</span> join
<span class="token keyword">import</span> random
<span class="token keyword">from</span> shutil <span class="token keyword">import</span> copyfile

classes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"fire"</span><span class="token punctuation">,</span> <span class="token string">"smoke"</span><span class="token punctuation">]</span>
<span class="token comment"># classes=["ball"]</span>

TRAIN_RATIO <span class="token operator">=</span> <span class="token number">80</span>  <span class="token comment">#训练集和验证集的比例，说明80%的训练集，20%的验证集</span>


<span class="token keyword">def</span> <span class="token function">clear_hidden_files</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">:</span>
    dir_list <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>path<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> dir_list<span class="token punctuation">:</span>
        abspath <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>
        <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isfile<span class="token punctuation">(</span>abspath<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> i<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">"._"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>abspath<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            clear_hidden_files<span class="token punctuation">(</span>abspath<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">convert</span><span class="token punctuation">(</span>size<span class="token punctuation">,</span> box<span class="token punctuation">)</span><span class="token punctuation">:</span>
    dw <span class="token operator">=</span> <span class="token number">1.</span> <span class="token operator">/</span> size<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    dh <span class="token operator">=</span> <span class="token number">1.</span> <span class="token operator">/</span> size<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    x <span class="token operator">=</span> <span class="token punctuation">(</span>box<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> box<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2.0</span>
    y <span class="token operator">=</span> <span class="token punctuation">(</span>box<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> box<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2.0</span>
    w <span class="token operator">=</span> box<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> box<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    h <span class="token operator">=</span> box<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">-</span> box<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
    x <span class="token operator">=</span> x <span class="token operator">*</span> dw
    w <span class="token operator">=</span> w <span class="token operator">*</span> dw
    y <span class="token operator">=</span> y <span class="token operator">*</span> dh
    h <span class="token operator">=</span> h <span class="token operator">*</span> dh
    <span class="token keyword">return</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">convert_annotation</span><span class="token punctuation">(</span>image_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
    in_file <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'data-fire-smoke/fire/Annotation/%s.xml'</span> <span class="token operator">%</span> image_id<span class="token punctuation">,</span><span class="token string">'rb'</span><span class="token punctuation">)</span>
    out_file <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'data-fire-smoke/fire/YOLOLabels/%s.txt'</span> <span class="token operator">%</span> image_id<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>
    tree <span class="token operator">=</span> ET<span class="token punctuation">.</span>parse<span class="token punctuation">(</span>in_file<span class="token punctuation">)</span>
    root <span class="token operator">=</span> tree<span class="token punctuation">.</span>getroot<span class="token punctuation">(</span><span class="token punctuation">)</span>
    size <span class="token operator">=</span> root<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'size'</span><span class="token punctuation">)</span>
    w <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>size<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'width'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    h <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>size<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'height'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span>

    <span class="token keyword">for</span> obj <span class="token keyword">in</span> root<span class="token punctuation">.</span><span class="token builtin">iter</span><span class="token punctuation">(</span><span class="token string">'object'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        difficult <span class="token operator">=</span> obj<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'difficult'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text
        cls <span class="token operator">=</span> obj<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text
        <span class="token keyword">if</span> cls <span class="token keyword">not</span> <span class="token keyword">in</span> classes <span class="token keyword">or</span> <span class="token builtin">int</span><span class="token punctuation">(</span>difficult<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
            <span class="token keyword">continue</span>
        cls_id <span class="token operator">=</span> classes<span class="token punctuation">.</span>index<span class="token punctuation">(</span>cls<span class="token punctuation">)</span>
        xmlbox <span class="token operator">=</span> obj<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'bndbox'</span><span class="token punctuation">)</span>
        b <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>xmlbox<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'xmin'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">(</span>xmlbox<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'xmax'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">(</span>xmlbox<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'ymin'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">,</span>
             <span class="token builtin">float</span><span class="token punctuation">(</span>xmlbox<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'ymax'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span>
        bb <span class="token operator">=</span> convert<span class="token punctuation">(</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span>
        out_file<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>cls_id<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> <span class="token string">" "</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token keyword">for</span> a <span class="token keyword">in</span> bb<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'\n'</span><span class="token punctuation">)</span>
    in_file<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    out_file<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>


wd <span class="token operator">=</span> os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span>
wd <span class="token operator">=</span> os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span>
data_base_dir <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>wd<span class="token punctuation">,</span> <span class="token string">"data-fire-smoke/"</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isdir<span class="token punctuation">(</span>data_base_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>data_base_dir<span class="token punctuation">)</span>
work_sapce_dir <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>data_base_dir<span class="token punctuation">,</span> <span class="token string">"fire/"</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isdir<span class="token punctuation">(</span>work_sapce_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>work_sapce_dir<span class="token punctuation">)</span>
annotation_dir <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>work_sapce_dir<span class="token punctuation">,</span> <span class="token string">"Annotation/"</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isdir<span class="token punctuation">(</span>annotation_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>annotation_dir<span class="token punctuation">)</span>
clear_hidden_files<span class="token punctuation">(</span>annotation_dir<span class="token punctuation">)</span>
image_dir <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>work_sapce_dir<span class="token punctuation">,</span> <span class="token string">"Image/"</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isdir<span class="token punctuation">(</span>image_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>image_dir<span class="token punctuation">)</span>
clear_hidden_files<span class="token punctuation">(</span>image_dir<span class="token punctuation">)</span>
yolo_labels_dir <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>work_sapce_dir<span class="token punctuation">,</span> <span class="token string">"YOLOLabels/"</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isdir<span class="token punctuation">(</span>yolo_labels_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>yolo_labels_dir<span class="token punctuation">)</span>
clear_hidden_files<span class="token punctuation">(</span>yolo_labels_dir<span class="token punctuation">)</span>
yolov5_images_dir <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>data_base_dir<span class="token punctuation">,</span> <span class="token string">"images/"</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isdir<span class="token punctuation">(</span>yolov5_images_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>yolov5_images_dir<span class="token punctuation">)</span>
clear_hidden_files<span class="token punctuation">(</span>yolov5_images_dir<span class="token punctuation">)</span>
yolov5_labels_dir <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>data_base_dir<span class="token punctuation">,</span> <span class="token string">"labels/"</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isdir<span class="token punctuation">(</span>yolov5_labels_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>yolov5_labels_dir<span class="token punctuation">)</span>
clear_hidden_files<span class="token punctuation">(</span>yolov5_labels_dir<span class="token punctuation">)</span>
yolov5_images_train_dir <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>yolov5_images_dir<span class="token punctuation">,</span> <span class="token string">"train/"</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isdir<span class="token punctuation">(</span>yolov5_images_train_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>yolov5_images_train_dir<span class="token punctuation">)</span>
clear_hidden_files<span class="token punctuation">(</span>yolov5_images_train_dir<span class="token punctuation">)</span>
yolov5_images_test_dir <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>yolov5_images_dir<span class="token punctuation">,</span> <span class="token string">"val/"</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isdir<span class="token punctuation">(</span>yolov5_images_test_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>yolov5_images_test_dir<span class="token punctuation">)</span>
clear_hidden_files<span class="token punctuation">(</span>yolov5_images_test_dir<span class="token punctuation">)</span>
yolov5_labels_train_dir <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>yolov5_labels_dir<span class="token punctuation">,</span> <span class="token string">"train/"</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isdir<span class="token punctuation">(</span>yolov5_labels_train_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>yolov5_labels_train_dir<span class="token punctuation">)</span>
clear_hidden_files<span class="token punctuation">(</span>yolov5_labels_train_dir<span class="token punctuation">)</span>
yolov5_labels_test_dir <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>yolov5_labels_dir<span class="token punctuation">,</span> <span class="token string">"val/"</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isdir<span class="token punctuation">(</span>yolov5_labels_test_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>yolov5_labels_test_dir<span class="token punctuation">)</span>
clear_hidden_files<span class="token punctuation">(</span>yolov5_labels_test_dir<span class="token punctuation">)</span>

train_file <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>wd<span class="token punctuation">,</span> <span class="token string">"yolov5_train.txt"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>
test_file <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>wd<span class="token punctuation">,</span> <span class="token string">"yolov5_val.txt"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>
train_file<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
test_file<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
train_file <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>wd<span class="token punctuation">,</span> <span class="token string">"yolov5_train.txt"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">)</span>
test_file <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>wd<span class="token punctuation">,</span> <span class="token string">"yolov5_val.txt"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">)</span>
list_imgs <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>image_dir<span class="token punctuation">)</span>  <span class="token comment"># list image files</span>
prob <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Probability: %d"</span> <span class="token operator">%</span> prob<span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>list_imgs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>image_dir<span class="token punctuation">,</span> list_imgs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isfile<span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        image_path <span class="token operator">=</span> image_dir <span class="token operator">+</span> list_imgs<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        voc_path <span class="token operator">=</span> list_imgs<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        <span class="token punctuation">(</span>nameWithoutExtention<span class="token punctuation">,</span> extention<span class="token punctuation">)</span> <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>splitext<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>basename<span class="token punctuation">(</span>image_path<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">(</span>voc_nameWithoutExtention<span class="token punctuation">,</span> voc_extention<span class="token punctuation">)</span> <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>splitext<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>basename<span class="token punctuation">(</span>voc_path<span class="token punctuation">)</span><span class="token punctuation">)</span>
        annotation_name <span class="token operator">=</span> nameWithoutExtention <span class="token operator">+</span> <span class="token string">'.xml'</span>
        annotation_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>annotation_dir<span class="token punctuation">,</span> annotation_name<span class="token punctuation">)</span>
        label_name <span class="token operator">=</span> nameWithoutExtention <span class="token operator">+</span> <span class="token string">'.txt'</span>
        label_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>yolo_labels_dir<span class="token punctuation">,</span> label_name<span class="token punctuation">)</span>
    prob <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Probability: %d"</span> <span class="token operator">%</span> prob<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>prob <span class="token operator">&lt;</span> TRAIN_RATIO<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># train dataset</span>
        <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>annotation_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
            train_file<span class="token punctuation">.</span>write<span class="token punctuation">(</span>image_path <span class="token operator">+</span> <span class="token string">'\n'</span><span class="token punctuation">)</span>
            convert_annotation<span class="token punctuation">(</span>nameWithoutExtention<span class="token punctuation">)</span>  <span class="token comment"># convert label</span>
            copyfile<span class="token punctuation">(</span>image_path<span class="token punctuation">,</span> yolov5_images_train_dir <span class="token operator">+</span> voc_path<span class="token punctuation">)</span>
            copyfile<span class="token punctuation">(</span>label_path<span class="token punctuation">,</span> yolov5_labels_train_dir <span class="token operator">+</span> label_name<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>  <span class="token comment"># test dataset</span>
        <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>annotation_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
            test_file<span class="token punctuation">.</span>write<span class="token punctuation">(</span>image_path <span class="token operator">+</span> <span class="token string">'\n'</span><span class="token punctuation">)</span>
            convert_annotation<span class="token punctuation">(</span>nameWithoutExtention<span class="token punctuation">)</span>  <span class="token comment"># convert label</span>
            copyfile<span class="token punctuation">(</span>image_path<span class="token punctuation">,</span> yolov5_images_test_dir <span class="token operator">+</span> voc_path<span class="token punctuation">)</span>
            copyfile<span class="token punctuation">(</span>label_path<span class="token punctuation">,</span> yolov5_labels_test_dir <span class="token operator">+</span> label_name<span class="token punctuation">)</span>
train_file<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
test_file<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<p>运行成功后会出现下图的文件夹<br> <img src="https://images2.imgbox.com/52/46/VAKT1VCh_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_183"></a>二、预训练权重</h2> 
<p><a href="https://github.com/ultralytics/yolov5/releases/tag/v5.0">预训练权重下载</a> 本实验使用的是 yolov5s.pt</p> 
<p>预训练权重：预先设置的训练权重，可以缩短训练时间。</p> 
<p>将yolov5s.pt放置到weights文件夹中<br> <img src="https://images2.imgbox.com/84/35/MC1q6p4K_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_192"></a>三、训练模型</h2> 
<p>训练自己的数据集需要更改<strong>数据配置文件（data中的yaml）<strong>和</strong>模型配置文件（midels中的yaml文件）</strong></p> 
<h3><a id="1_194"></a>1.更改数据配置文件</h3> 
<p>复制data中的voc.yaml命名为fire.yaml<br> <img src="https://images2.imgbox.com/cb/35/jJ7K4kUl_o.png" alt="在这里插入图片描述"><br> fire.yaml</p> 
<pre><code class="prism language-python"><span class="token comment"># PASCAL VOC dataset http://host.robots.ox.ac.uk/pascal/VOC/</span>
<span class="token comment"># Train command: python train.py --data voc.yaml</span>
<span class="token comment"># Default dataset location is next to /yolov5:</span>
<span class="token comment">#   /parent_folder</span>
<span class="token comment">#     /VOC</span>
<span class="token comment">#     /yolov5</span>


<span class="token comment"># download command/URL (optional)</span>
download<span class="token punctuation">:</span> bash data<span class="token operator">/</span>scripts<span class="token operator">/</span>get_voc<span class="token punctuation">.</span>sh

<span class="token comment"># train and val data as 1) directory: path/images/, 2) file: path/images.txt, or 3) list: [path1/images/, path2/images/]</span>
train<span class="token punctuation">:</span> data<span class="token operator">-</span>fire<span class="token operator">-</span>smoke<span class="token operator">/</span>images<span class="token operator">/</span>train<span class="token operator">/</span>  <span class="token comment"># 划分后训练集的照片路径</span>
val<span class="token punctuation">:</span> data<span class="token operator">-</span>fire<span class="token operator">-</span>smoke<span class="token operator">/</span>images<span class="token operator">/</span>val<span class="token operator">/</span>  <span class="token comment"># 划分后验证集的照片路径</span>

<span class="token comment"># number of classes</span>
nc<span class="token punctuation">:</span> <span class="token number">2</span>   <span class="token comment">#标签的类别书</span>

<span class="token comment"># class names</span>
names<span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token string">'fire'</span><span class="token punctuation">,</span> <span class="token string">'smoke'</span><span class="token punctuation">]</span>   <span class="token comment">#标签</span>

</code></pre> 
<h3><a id="2_223"></a>2.更改模型的配置文件</h3> 
<p>预训练权重选择的是ylov5s.pt<br> 所以models模型应该选择yolov5s.yaml（不同的与训练权重对应不同的网络层数，用错会报错）</p> 
<p>复制models中的yolov5.yaml命名为fire.yaml</p> 
<p><img src="https://images2.imgbox.com/b7/c9/DHB8YCby_o.png" alt="在这里插入图片描述"><br> 只需要修改一处地方：<br> <img src="https://images2.imgbox.com/5c/4e/naU3D06U_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_233"></a>四、训练模型路径的修改</h2> 
<p>打开train.py文件（train.py是训练自己数据集的函数）<br> <img src="https://images2.imgbox.com/62/fc/6SvGT9Ez_o.png" alt="在这里插入图片描述"><br> 需要修改</p> 
<table><thead><tr><th>需要修改</th><th>配置文件路径</th></tr></thead><tbody><tr><td>预训练权重</td><td>weights/yolov5s.pt</td></tr><tr><td>数据集</td><td>data/fire.yaml</td></tr><tr><td>模型</td><td>models/fire.yaml</td></tr></tbody></table> 
<p><strong>大概在train.py文件的458行左右</strong></p> 
<ul><li>修改预训练权重</li></ul> 
<pre><code class="prism language-python">parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--weights'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">'weights/yolov5s.pt'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'initial weights path'</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li>修改模型路径</li></ul> 
<pre><code class="prism language-python">parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--cfg'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">'models/fire.yaml'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'model.yaml path'</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li>修改数据路径</li></ul> 
<pre><code class="prism language-python">parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--data'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">'data/fire.yaml'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'data.yaml path'</span><span class="token punctuation">)</span>
</code></pre> 
<p>训练结束会出现runs文件夹<br> <img src="https://images2.imgbox.com/62/fe/BkzUYOUk_o.png" alt="f"><br> 在测试的时候我们选取最好的权重</p> 
<h2><a id="_265"></a>五、模型测试</h2> 
<p>将前面训练得到的最好的权重（best.pt）进行测试（detect.py测试文件）</p> 
<h3><a id="1_267"></a>1.换权重文件</h3> 
<p><img src="https://images2.imgbox.com/98/c7/2rNNKBdk_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2_269"></a>2.照片测试</h3> 
<ul><li>输入测试照片的路径</li></ul> 
<p><img src="https://images2.imgbox.com/f2/19/zfsz1ERL_o.png" alt="在这里插入图片描述"></p> 
<ul><li>运行detect.py文件</li></ul> 
<p><img src="https://images2.imgbox.com/e9/3e/JuXlB7A8_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3_278"></a>3.摄像头测试</h3> 
<ul><li>将刚才照片的路径改为0即可<br> <img src="https://images2.imgbox.com/c3/f5/oGt6mfrV_o.png" alt="在这里插入图片描述"><br> 测试完成，下面开始可视化部分！</li></ul> 
<h2><a id="Pyqt_284"></a>六、Pyqt可视化</h2> 
<h3><a id="1Pyqt_285"></a>1.安装Pyqt</h3> 
<pre><code class="prism language-python">pip3 install PyQt5
pip install PyQt5<span class="token operator">-</span>tools 
</code></pre> 
<h3><a id="2_291"></a>2.登录界面</h3> 
<p><img src="https://images2.imgbox.com/0d/7a/86mjjWUK_o.png" alt="在这里插入图片描述"></p> 
<p><strong>新建两个py文件</strong></p> 
<p><img src="https://images2.imgbox.com/e4/bb/jG1Hm3UD_o.png" alt="在这里插入图片描述"></p> 
<p><strong>login.py</strong></p> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>

<span class="token comment"># Form implementation generated from reading ui file 'login.ui'</span>
<span class="token comment">#</span>
<span class="token comment"># Created by: PyQt5 UI code generator 5.15.4</span>
<span class="token comment">#</span>
<span class="token comment"># WARNING: Any manual changes made to this file will be lost when pyuic5 is</span>
<span class="token comment"># run again.  Do not edit this file unless you know what you are doing.</span>


<span class="token keyword">from</span> PyQt5 <span class="token keyword">import</span> QtCore<span class="token punctuation">,</span> QtGui<span class="token punctuation">,</span> QtWidgets


<span class="token keyword">class</span> <span class="token class-name">Ui_login_MainWindow</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">setupUi</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> login_MainWindow<span class="token punctuation">)</span><span class="token punctuation">:</span>
        login_MainWindow<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"login_MainWindow"</span><span class="token punctuation">)</span>
        login_MainWindow<span class="token punctuation">.</span>setEnabled<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        login_MainWindow<span class="token punctuation">.</span>resize<span class="token punctuation">(</span><span class="token number">575</span><span class="token punctuation">,</span> <span class="token number">392</span><span class="token punctuation">)</span>
        login_MainWindow<span class="token punctuation">.</span>setAnimated<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>centralwidget <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QWidget<span class="token punctuation">(</span>login_MainWindow<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>centralwidget<span class="token punctuation">.</span>setEnabled<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>centralwidget<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"centralwidget"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label_3 <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QLabel<span class="token punctuation">(</span>self<span class="token punctuation">.</span>centralwidget<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label_3<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">,</span> <span class="token number">79</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        font <span class="token operator">=</span> QtGui<span class="token punctuation">.</span>QFont<span class="token punctuation">(</span><span class="token punctuation">)</span>
        font<span class="token punctuation">.</span>setPointSize<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span>
        font<span class="token punctuation">.</span>setBold<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        font<span class="token punctuation">.</span>setItalic<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        font<span class="token punctuation">.</span>setWeight<span class="token punctuation">(</span><span class="token number">75</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label_3<span class="token punctuation">.</span>setFont<span class="token punctuation">(</span>font<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label_3<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"label_3"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label_2 <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QLabel<span class="token punctuation">(</span>self<span class="token punctuation">.</span>centralwidget<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label_2<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">71</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        font <span class="token operator">=</span> QtGui<span class="token punctuation">.</span>QFont<span class="token punctuation">(</span><span class="token punctuation">)</span>
        font<span class="token punctuation">.</span>setPointSize<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label_2<span class="token punctuation">.</span>setFont<span class="token punctuation">(</span>font<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label_2<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"label_2"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QLabel<span class="token punctuation">(</span>self<span class="token punctuation">.</span>centralwidget<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        font <span class="token operator">=</span> QtGui<span class="token punctuation">.</span>QFont<span class="token punctuation">(</span><span class="token punctuation">)</span>
        font<span class="token punctuation">.</span>setPointSize<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label<span class="token punctuation">.</span>setFont<span class="token punctuation">(</span>font<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"label"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>lineEdit <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QLineEdit<span class="token punctuation">(</span>self<span class="token punctuation">.</span>centralwidget<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>lineEdit<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">180</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">221</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        font <span class="token operator">=</span> QtGui<span class="token punctuation">.</span>QFont<span class="token punctuation">(</span><span class="token punctuation">)</span>
        font<span class="token punctuation">.</span>setPointSize<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>lineEdit<span class="token punctuation">.</span>setFont<span class="token punctuation">(</span>font<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>lineEdit<span class="token punctuation">.</span>setText<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>lineEdit<span class="token punctuation">.</span>setEchoMode<span class="token punctuation">(</span>QtWidgets<span class="token punctuation">.</span>QLineEdit<span class="token punctuation">.</span>Password<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>lineEdit<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"lineEdit"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>lineEdit_2 <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QLineEdit<span class="token punctuation">(</span>self<span class="token punctuation">.</span>centralwidget<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>lineEdit_2<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">180</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">221</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        font <span class="token operator">=</span> QtGui<span class="token punctuation">.</span>QFont<span class="token punctuation">(</span><span class="token punctuation">)</span>
        font<span class="token punctuation">.</span>setPointSize<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>lineEdit_2<span class="token punctuation">.</span>setFont<span class="token punctuation">(</span>font<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>lineEdit_2<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"lineEdit_2"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButton <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QPushButton<span class="token punctuation">(</span>self<span class="token punctuation">.</span>centralwidget<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButton<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">180</span><span class="token punctuation">,</span> <span class="token number">280</span><span class="token punctuation">,</span> <span class="token number">171</span><span class="token punctuation">,</span> <span class="token number">51</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        font <span class="token operator">=</span> QtGui<span class="token punctuation">.</span>QFont<span class="token punctuation">(</span><span class="token punctuation">)</span>
        font<span class="token punctuation">.</span>setPointSize<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
        font<span class="token punctuation">.</span>setBold<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        font<span class="token punctuation">.</span>setWeight<span class="token punctuation">(</span><span class="token number">75</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButton<span class="token punctuation">.</span>setFont<span class="token punctuation">(</span>font<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButton<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"pushButton"</span><span class="token punctuation">)</span>
        login_MainWindow<span class="token punctuation">.</span>setCentralWidget<span class="token punctuation">(</span>self<span class="token punctuation">.</span>centralwidget<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>menubar <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QMenuBar<span class="token punctuation">(</span>login_MainWindow<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>menubar<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">575</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>menubar<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"menubar"</span><span class="token punctuation">)</span>
        login_MainWindow<span class="token punctuation">.</span>setMenuBar<span class="token punctuation">(</span>self<span class="token punctuation">.</span>menubar<span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>retranslateUi<span class="token punctuation">(</span>login_MainWindow<span class="token punctuation">)</span>
        QtCore<span class="token punctuation">.</span>QMetaObject<span class="token punctuation">.</span>connectSlotsByName<span class="token punctuation">(</span>login_MainWindow<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">retranslateUi</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> login_MainWindow<span class="token punctuation">)</span><span class="token punctuation">:</span>
        _translate <span class="token operator">=</span> QtCore<span class="token punctuation">.</span>QCoreApplication<span class="token punctuation">.</span>translate
        login_MainWindow<span class="token punctuation">.</span>setWindowTitle<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"login_MainWindow"</span><span class="token punctuation">,</span> <span class="token string">"火灾火焰烟雾识别系统"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label_3<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"login_MainWindow"</span><span class="token punctuation">,</span> <span class="token string">"欢迎使用火灾火焰烟雾识别系统"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label_2<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"login_MainWindow"</span><span class="token punctuation">,</span> <span class="token string">"密 码"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"login_MainWindow"</span><span class="token punctuation">,</span> <span class="token string">"管理员"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>lineEdit_2<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"login_MainWindow"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButton<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"login_MainWindow"</span><span class="token punctuation">,</span> <span class="token string">"登录"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># self.pushButton.setShortcut(_translate("login_MainWindow", "Enter"))  # 设置快捷键</span>
</code></pre> 
<p><strong>login_mian.py</strong></p> 
<pre><code class="prism language-python"><span class="token comment"># self.pushButton.setShortcut(_translate("MainWindow", "enter")) #设置快捷键</span>
<span class="token keyword">import</span> sys

<span class="token keyword">from</span> PyQt5 <span class="token keyword">import</span> QtCore<span class="token punctuation">,</span> QtGui<span class="token punctuation">,</span> QtWidgets
<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtWidgets <span class="token keyword">import</span> QApplication<span class="token punctuation">,</span> QMainWindow
<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtCore <span class="token keyword">import</span> QTimer
<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtGui <span class="token keyword">import</span> QImage<span class="token punctuation">,</span> QPixmap<span class="token punctuation">,</span> QKeyEvent

<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtWidgets <span class="token keyword">import</span> QMessageBox
<span class="token keyword">from</span> login <span class="token keyword">import</span> Ui_login_MainWindow
<span class="token keyword">from</span> main <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtCore <span class="token keyword">import</span> Qt


<span class="token keyword">class</span> <span class="token class-name">login_window</span><span class="token punctuation">(</span>QtWidgets<span class="token punctuation">.</span>QMainWindow<span class="token punctuation">,</span> Ui_login_MainWindow<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>login_window<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>setupUi<span class="token punctuation">(</span>self<span class="token punctuation">)</span>  <span class="token comment"># 创建窗体对象</span>
        self<span class="token punctuation">.</span>init<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>admin <span class="token operator">=</span> <span class="token string">"美女"</span>
        self<span class="token punctuation">.</span>Password <span class="token operator">=</span> <span class="token string">"123456"</span>

    <span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>pushButton<span class="token punctuation">.</span>clicked<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>login_button<span class="token punctuation">)</span>  <span class="token comment"># 连接槽</span>

    <span class="token keyword">def</span> <span class="token function">login_button</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>lineEdit<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">:</span>
            QMessageBox<span class="token punctuation">.</span>warning<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">'警告'</span><span class="token punctuation">,</span> <span class="token string">'密码不能为空，请输入！'</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">None</span>

        <span class="token comment"># if  self.password == self.lineEdit.text():</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>lineEdit<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> self<span class="token punctuation">.</span>Password<span class="token punctuation">)</span> <span class="token keyword">and</span> self<span class="token punctuation">.</span>lineEdit_2<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> self<span class="token punctuation">.</span>admin<span class="token punctuation">:</span>
            <span class="token comment"># Ui_Main = Open_Camera()  # 生成主窗口的实例</span>
            <span class="token comment"># 1打开新窗口</span>
            Ui_Main<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment"># 2关闭本窗口</span>
            self<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            QMessageBox<span class="token punctuation">.</span>critical<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">'错误'</span><span class="token punctuation">,</span> <span class="token string">'密码错误！'</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>lineEdit<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">None</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token keyword">from</span> PyQt5 <span class="token keyword">import</span> QtCore

    QtCore<span class="token punctuation">.</span>QCoreApplication<span class="token punctuation">.</span>setAttribute<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>Qt<span class="token punctuation">.</span>AA_EnableHighDpiScaling<span class="token punctuation">)</span>  <span class="token comment"># 自适应分辨率</span>

    app <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QApplication<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span>
    window <span class="token operator">=</span> login_window<span class="token punctuation">(</span><span class="token punctuation">)</span>
    Ui_Main <span class="token operator">=</span> Ui_MainWindow<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 生成主窗口的实例</span>
    window<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span>app<span class="token punctuation">.</span>exec_<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong><strong>运行login_mian.py文件会出现登陆界面，<br> 登录成功会跳转主界面<br> 管理员：美女<br> 密码：123456</strong></strong></p> 
<h3><a id="3_448"></a>3.主界面</h3> 
<p><img src="https://images2.imgbox.com/d8/80/UVdW4bET_o.png" alt="在这里插入图片描述"></p> 
<p><strong>新建main.py文件</strong><br> <img src="https://images2.imgbox.com/37/f6/I3DJ8LjN_o.png" alt="在这里插入图片描述"><br> <strong>main.py</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> sys
<span class="token keyword">import</span> cv2
<span class="token keyword">import</span> argparse
<span class="token keyword">import</span> random
<span class="token keyword">import</span> torch
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>backends<span class="token punctuation">.</span>cudnn <span class="token keyword">as</span> cudnn

<span class="token keyword">from</span> PyQt5 <span class="token keyword">import</span> QtCore<span class="token punctuation">,</span> QtGui<span class="token punctuation">,</span> QtWidgets

<span class="token keyword">from</span> utils<span class="token punctuation">.</span>torch_utils <span class="token keyword">import</span> select_device
<span class="token keyword">from</span> models<span class="token punctuation">.</span>experimental <span class="token keyword">import</span> attempt_load
<span class="token keyword">from</span> utils<span class="token punctuation">.</span>general <span class="token keyword">import</span> check_img_size<span class="token punctuation">,</span> non_max_suppression<span class="token punctuation">,</span> scale_coords
<span class="token keyword">from</span> utils<span class="token punctuation">.</span>datasets <span class="token keyword">import</span> letterbox
<span class="token keyword">from</span> utils<span class="token punctuation">.</span>plots <span class="token keyword">import</span> plot_one_box


<span class="token keyword">class</span> <span class="token class-name">Ui_MainWindow</span><span class="token punctuation">(</span>QtWidgets<span class="token punctuation">.</span>QMainWindow<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> parent<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>Ui_MainWindow<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>parent<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>timer_video <span class="token operator">=</span> QtCore<span class="token punctuation">.</span>QTimer<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>setupUi<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>init_logo<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>init_slots<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>cap <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>out <span class="token operator">=</span> <span class="token boolean">None</span>
        <span class="token comment"># self.out = cv2.VideoWriter('prediction.avi', cv2.VideoWriter_fourcc(*'XVID'), 20.0, (640, 480))</span>

        parser <span class="token operator">=</span> argparse<span class="token punctuation">.</span>ArgumentParser<span class="token punctuation">(</span><span class="token punctuation">)</span>
        parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--weights'</span><span class="token punctuation">,</span> nargs<span class="token operator">=</span><span class="token string">'+'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">'weights/best.pt'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'model.pt path(s)'</span><span class="token punctuation">)</span>
        parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--source'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">'data/images/'</span><span class="token punctuation">,</span>
                            <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'source'</span><span class="token punctuation">)</span>
        parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--img-size'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">640</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'inference size (pixels)'</span><span class="token punctuation">)</span>
        parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--conf-thres'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">float</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">0.25</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'object confidence threshold'</span><span class="token punctuation">)</span>
        parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--iou-thres'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">float</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">0.45</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'IOU threshold for NMS'</span><span class="token punctuation">)</span>
        parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--device'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'cuda device, i.e. 0 or 0,1,2,3 or cpu'</span><span class="token punctuation">)</span>
        parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--view-img'</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'store_true'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'display results'</span><span class="token punctuation">)</span>
        parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--save-txt'</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'store_true'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'save results to *.txt'</span><span class="token punctuation">)</span>
        parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--save-conf'</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'store_true'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'save confidences in --save-txt labels'</span><span class="token punctuation">)</span>
        parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--nosave'</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'store_true'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'do not save images/videos'</span><span class="token punctuation">)</span>
        parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--classes'</span><span class="token punctuation">,</span> nargs<span class="token operator">=</span><span class="token string">'+'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'filter by class: --class 0, or --class 0 2 3'</span><span class="token punctuation">)</span>
        parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--agnostic-nms'</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'store_true'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'class-agnostic NMS'</span><span class="token punctuation">)</span>
        parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--augment'</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'store_true'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'augmented inference'</span><span class="token punctuation">)</span>
        parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--update'</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'store_true'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'update all models'</span><span class="token punctuation">)</span>
        parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--project'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">'runs/detect'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'save results to project/name'</span><span class="token punctuation">)</span>
        parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--name'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">'exp'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'save results to project/name'</span><span class="token punctuation">)</span>
        parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--exist-ok'</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'store_true'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'existing project/name ok, do not increment'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>opt <span class="token operator">=</span> parser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>opt<span class="token punctuation">)</span>

        source<span class="token punctuation">,</span> weights<span class="token punctuation">,</span> view_img<span class="token punctuation">,</span> save_txt<span class="token punctuation">,</span> imgsz <span class="token operator">=</span> self<span class="token punctuation">.</span>opt<span class="token punctuation">.</span>source<span class="token punctuation">,</span> self<span class="token punctuation">.</span>opt<span class="token punctuation">.</span>weights<span class="token punctuation">,</span> self<span class="token punctuation">.</span>opt<span class="token punctuation">.</span>view_img<span class="token punctuation">,</span> self<span class="token punctuation">.</span>opt<span class="token punctuation">.</span>save_txt<span class="token punctuation">,</span> self<span class="token punctuation">.</span>opt<span class="token punctuation">.</span>img_size

        self<span class="token punctuation">.</span>device <span class="token operator">=</span> select_device<span class="token punctuation">(</span>self<span class="token punctuation">.</span>opt<span class="token punctuation">.</span>device<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>half <span class="token operator">=</span> self<span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">!=</span> <span class="token string">'cpu'</span>  <span class="token comment"># half precision only supported on CUDA</span>

        cudnn<span class="token punctuation">.</span>benchmark <span class="token operator">=</span> <span class="token boolean">True</span>

        <span class="token comment"># Load model</span>
        self<span class="token punctuation">.</span>model <span class="token operator">=</span> attempt_load<span class="token punctuation">(</span>
            weights<span class="token punctuation">,</span> map_location<span class="token operator">=</span>self<span class="token punctuation">.</span>device<span class="token punctuation">)</span>  <span class="token comment"># load FP32 model</span>
        stride <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>stride<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># model stride</span>
        self<span class="token punctuation">.</span>imgsz <span class="token operator">=</span> check_img_size<span class="token punctuation">(</span>imgsz<span class="token punctuation">,</span> s<span class="token operator">=</span>stride<span class="token punctuation">)</span>  <span class="token comment"># check img_size</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>half<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>half<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># to FP16</span>

        <span class="token comment"># Get names and colors</span>
        self<span class="token punctuation">.</span>names <span class="token operator">=</span> self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>module<span class="token punctuation">.</span>names <span class="token keyword">if</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>
            self<span class="token punctuation">.</span>model<span class="token punctuation">,</span> <span class="token string">'module'</span><span class="token punctuation">)</span> <span class="token keyword">else</span> self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>names
        self<span class="token punctuation">.</span>colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>
                        <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> self<span class="token punctuation">.</span>names<span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">setupUi</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> MainWindow<span class="token punctuation">)</span><span class="token punctuation">:</span>
        MainWindow<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"MainWindow"</span><span class="token punctuation">)</span>
        MainWindow<span class="token punctuation">.</span>resize<span class="token punctuation">(</span><span class="token number">800</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>centralwidget <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QWidget<span class="token punctuation">(</span>MainWindow<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>centralwidget<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"centralwidget"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>horizontalLayout_2 <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QHBoxLayout<span class="token punctuation">(</span>self<span class="token punctuation">.</span>centralwidget<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>horizontalLayout_2<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"horizontalLayout_2"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>horizontalLayout <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QHBoxLayout<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>horizontalLayout<span class="token punctuation">.</span>setSizeConstraint<span class="token punctuation">(</span>
            QtWidgets<span class="token punctuation">.</span>QLayout<span class="token punctuation">.</span>SetNoConstraint<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>horizontalLayout<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"horizontalLayout"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>verticalLayout <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QVBoxLayout<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>verticalLayout<span class="token punctuation">.</span>setContentsMargins<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>verticalLayout<span class="token punctuation">.</span>setSpacing<span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>verticalLayout<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"verticalLayout"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButton_img <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QPushButton<span class="token punctuation">(</span>self<span class="token punctuation">.</span>centralwidget<span class="token punctuation">)</span>
        sizePolicy <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QSizePolicy<span class="token punctuation">(</span>
            QtWidgets<span class="token punctuation">.</span>QSizePolicy<span class="token punctuation">.</span>Minimum<span class="token punctuation">,</span> QtWidgets<span class="token punctuation">.</span>QSizePolicy<span class="token punctuation">.</span>MinimumExpanding<span class="token punctuation">)</span>
        sizePolicy<span class="token punctuation">.</span>setHorizontalStretch<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        sizePolicy<span class="token punctuation">.</span>setVerticalStretch<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        sizePolicy<span class="token punctuation">.</span>setHeightForWidth<span class="token punctuation">(</span>
            self<span class="token punctuation">.</span>pushButton_img<span class="token punctuation">.</span>sizePolicy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hasHeightForWidth<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButton_img<span class="token punctuation">.</span>setSizePolicy<span class="token punctuation">(</span>sizePolicy<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButton_img<span class="token punctuation">.</span>setMinimumSize<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QSize<span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButton_img<span class="token punctuation">.</span>setMaximumSize<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QSize<span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        font <span class="token operator">=</span> QtGui<span class="token punctuation">.</span>QFont<span class="token punctuation">(</span><span class="token punctuation">)</span>
        font<span class="token punctuation">.</span>setFamily<span class="token punctuation">(</span><span class="token string">"Agency FB"</span><span class="token punctuation">)</span>
        font<span class="token punctuation">.</span>setPointSize<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButton_img<span class="token punctuation">.</span>setFont<span class="token punctuation">(</span>font<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButton_img<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"pushButton_img"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>verticalLayout<span class="token punctuation">.</span>addWidget<span class="token punctuation">(</span>
            self<span class="token punctuation">.</span>pushButton_img<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> QtCore<span class="token punctuation">.</span>Qt<span class="token punctuation">.</span>AlignHCenter<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButton_camera <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QPushButton<span class="token punctuation">(</span>self<span class="token punctuation">.</span>centralwidget<span class="token punctuation">)</span>
        sizePolicy <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QSizePolicy<span class="token punctuation">(</span>
            QtWidgets<span class="token punctuation">.</span>QSizePolicy<span class="token punctuation">.</span>Minimum<span class="token punctuation">,</span> QtWidgets<span class="token punctuation">.</span>QSizePolicy<span class="token punctuation">.</span>Expanding<span class="token punctuation">)</span>
        sizePolicy<span class="token punctuation">.</span>setHorizontalStretch<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        sizePolicy<span class="token punctuation">.</span>setVerticalStretch<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        sizePolicy<span class="token punctuation">.</span>setHeightForWidth<span class="token punctuation">(</span>
            self<span class="token punctuation">.</span>pushButton_camera<span class="token punctuation">.</span>sizePolicy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hasHeightForWidth<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButton_camera<span class="token punctuation">.</span>setSizePolicy<span class="token punctuation">(</span>sizePolicy<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButton_camera<span class="token punctuation">.</span>setMinimumSize<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QSize<span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButton_camera<span class="token punctuation">.</span>setMaximumSize<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QSize<span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        font <span class="token operator">=</span> QtGui<span class="token punctuation">.</span>QFont<span class="token punctuation">(</span><span class="token punctuation">)</span>
        font<span class="token punctuation">.</span>setFamily<span class="token punctuation">(</span><span class="token string">"Agency FB"</span><span class="token punctuation">)</span>
        font<span class="token punctuation">.</span>setPointSize<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButton_camera<span class="token punctuation">.</span>setFont<span class="token punctuation">(</span>font<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButton_camera<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"pushButton_camera"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>verticalLayout<span class="token punctuation">.</span>addWidget<span class="token punctuation">(</span>
            self<span class="token punctuation">.</span>pushButton_camera<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> QtCore<span class="token punctuation">.</span>Qt<span class="token punctuation">.</span>AlignHCenter<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButton_video <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QPushButton<span class="token punctuation">(</span>self<span class="token punctuation">.</span>centralwidget<span class="token punctuation">)</span>
        sizePolicy <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QSizePolicy<span class="token punctuation">(</span>
            QtWidgets<span class="token punctuation">.</span>QSizePolicy<span class="token punctuation">.</span>Minimum<span class="token punctuation">,</span> QtWidgets<span class="token punctuation">.</span>QSizePolicy<span class="token punctuation">.</span>Expanding<span class="token punctuation">)</span>
        sizePolicy<span class="token punctuation">.</span>setHorizontalStretch<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        sizePolicy<span class="token punctuation">.</span>setVerticalStretch<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        sizePolicy<span class="token punctuation">.</span>setHeightForWidth<span class="token punctuation">(</span>
            self<span class="token punctuation">.</span>pushButton_video<span class="token punctuation">.</span>sizePolicy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hasHeightForWidth<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButton_video<span class="token punctuation">.</span>setSizePolicy<span class="token punctuation">(</span>sizePolicy<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButton_video<span class="token punctuation">.</span>setMinimumSize<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QSize<span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButton_video<span class="token punctuation">.</span>setMaximumSize<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QSize<span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        font <span class="token operator">=</span> QtGui<span class="token punctuation">.</span>QFont<span class="token punctuation">(</span><span class="token punctuation">)</span>
        font<span class="token punctuation">.</span>setFamily<span class="token punctuation">(</span><span class="token string">"Agency FB"</span><span class="token punctuation">)</span>
        font<span class="token punctuation">.</span>setPointSize<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButton_video<span class="token punctuation">.</span>setFont<span class="token punctuation">(</span>font<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButton_video<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"pushButton_video"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>verticalLayout<span class="token punctuation">.</span>addWidget<span class="token punctuation">(</span>
            self<span class="token punctuation">.</span>pushButton_video<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> QtCore<span class="token punctuation">.</span>Qt<span class="token punctuation">.</span>AlignHCenter<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>verticalLayout<span class="token punctuation">.</span>setStretch<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>horizontalLayout<span class="token punctuation">.</span>addLayout<span class="token punctuation">(</span>self<span class="token punctuation">.</span>verticalLayout<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QLabel<span class="token punctuation">(</span>self<span class="token punctuation">.</span>centralwidget<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"label"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>horizontalLayout<span class="token punctuation">.</span>addWidget<span class="token punctuation">(</span>self<span class="token punctuation">.</span>label<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>horizontalLayout<span class="token punctuation">.</span>setStretch<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>horizontalLayout<span class="token punctuation">.</span>setStretch<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>horizontalLayout_2<span class="token punctuation">.</span>addLayout<span class="token punctuation">(</span>self<span class="token punctuation">.</span>horizontalLayout<span class="token punctuation">)</span>
        MainWindow<span class="token punctuation">.</span>setCentralWidget<span class="token punctuation">(</span>self<span class="token punctuation">.</span>centralwidget<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>menubar <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QMenuBar<span class="token punctuation">(</span>MainWindow<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>menubar<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>menubar<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"menubar"</span><span class="token punctuation">)</span>
        MainWindow<span class="token punctuation">.</span>setMenuBar<span class="token punctuation">(</span>self<span class="token punctuation">.</span>menubar<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>statusbar <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QStatusBar<span class="token punctuation">(</span>MainWindow<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>statusbar<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"statusbar"</span><span class="token punctuation">)</span>
        MainWindow<span class="token punctuation">.</span>setStatusBar<span class="token punctuation">(</span>self<span class="token punctuation">.</span>statusbar<span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>retranslateUi<span class="token punctuation">(</span>MainWindow<span class="token punctuation">)</span>
        QtCore<span class="token punctuation">.</span>QMetaObject<span class="token punctuation">.</span>connectSlotsByName<span class="token punctuation">(</span>MainWindow<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">retranslateUi</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> MainWindow<span class="token punctuation">)</span><span class="token punctuation">:</span>
        _translate <span class="token operator">=</span> QtCore<span class="token punctuation">.</span>QCoreApplication<span class="token punctuation">.</span>translate
        MainWindow<span class="token punctuation">.</span>setWindowTitle<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"MainWindow"</span><span class="token punctuation">,</span> <span class="token string">"火灾火焰烟雾识别系统"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButton_img<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"MainWindow"</span><span class="token punctuation">,</span> <span class="token string">"图片检测"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButton_camera<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"MainWindow"</span><span class="token punctuation">,</span> <span class="token string">"摄像头检测"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButton_video<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"MainWindow"</span><span class="token punctuation">,</span> <span class="token string">"视频检测"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"MainWindow"</span><span class="token punctuation">,</span> <span class="token string">"TextLabel"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">init_slots</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>pushButton_img<span class="token punctuation">.</span>clicked<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>button_image_open<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButton_video<span class="token punctuation">.</span>clicked<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>button_video_open<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButton_camera<span class="token punctuation">.</span>clicked<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>button_camera_open<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>timer_video<span class="token punctuation">.</span>timeout<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>show_video_frame<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">init_logo</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        pix <span class="token operator">=</span> QtGui<span class="token punctuation">.</span>QPixmap<span class="token punctuation">(</span><span class="token string">'R-C.jpg'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label<span class="token punctuation">.</span>setScaledContents<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label<span class="token punctuation">.</span>setPixmap<span class="token punctuation">(</span>pix<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">button_image_open</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'button_image_open'</span><span class="token punctuation">)</span>
        name_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

        img_name<span class="token punctuation">,</span> _ <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QFileDialog<span class="token punctuation">.</span>getOpenFileName<span class="token punctuation">(</span>
            self<span class="token punctuation">,</span> <span class="token string">"打开图片"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">"*.jpg;;*.png;;All Files(*)"</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> img_name<span class="token punctuation">:</span>
            <span class="token keyword">return</span>

        img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>img_name<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>img_name<span class="token punctuation">)</span>
        showimg <span class="token operator">=</span> img
        <span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            img <span class="token operator">=</span> letterbox<span class="token punctuation">(</span>img<span class="token punctuation">,</span> new_shape<span class="token operator">=</span>self<span class="token punctuation">.</span>opt<span class="token punctuation">.</span>img_size<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            <span class="token comment"># Convert</span>
            <span class="token comment"># BGR to RGB, to 3x416x416</span>
            img <span class="token operator">=</span> img<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
            img <span class="token operator">=</span> np<span class="token punctuation">.</span>ascontiguousarray<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
            img <span class="token operator">=</span> torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>self<span class="token punctuation">.</span>device<span class="token punctuation">)</span>
            img <span class="token operator">=</span> img<span class="token punctuation">.</span>half<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> self<span class="token punctuation">.</span>half <span class="token keyword">else</span> img<span class="token punctuation">.</span><span class="token builtin">float</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># uint8 to fp16/32</span>
            img <span class="token operator">/=</span> <span class="token number">255.0</span>  <span class="token comment"># 0 - 255 to 0.0 - 1.0</span>
            <span class="token keyword">if</span> img<span class="token punctuation">.</span>ndimension<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">:</span>
                img <span class="token operator">=</span> img<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token comment"># Inference</span>
            pred <span class="token operator">=</span> self<span class="token punctuation">.</span>model<span class="token punctuation">(</span>img<span class="token punctuation">,</span> augment<span class="token operator">=</span>self<span class="token punctuation">.</span>opt<span class="token punctuation">.</span>augment<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            <span class="token comment"># Apply NMS</span>
            pred <span class="token operator">=</span> non_max_suppression<span class="token punctuation">(</span>pred<span class="token punctuation">,</span> self<span class="token punctuation">.</span>opt<span class="token punctuation">.</span>conf_thres<span class="token punctuation">,</span> self<span class="token punctuation">.</span>opt<span class="token punctuation">.</span>iou_thres<span class="token punctuation">,</span> classes<span class="token operator">=</span>self<span class="token punctuation">.</span>opt<span class="token punctuation">.</span>classes<span class="token punctuation">,</span>
                                       agnostic<span class="token operator">=</span>self<span class="token punctuation">.</span>opt<span class="token punctuation">.</span>agnostic_nms<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>pred<span class="token punctuation">)</span>
            <span class="token comment"># Process detections</span>
            <span class="token keyword">for</span> i<span class="token punctuation">,</span> det <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>pred<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> det <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span> <span class="token keyword">and</span> <span class="token builtin">len</span><span class="token punctuation">(</span>det<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token comment"># Rescale boxes from img_size to im0 size</span>
                    det<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> scale_coords<span class="token punctuation">(</span>
                        img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> det<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> showimg<span class="token punctuation">.</span>shape<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">round</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

                    <span class="token keyword">for</span> <span class="token operator">*</span>xyxy<span class="token punctuation">,</span> conf<span class="token punctuation">,</span> cls <span class="token keyword">in</span> <span class="token builtin">reversed</span><span class="token punctuation">(</span>det<span class="token punctuation">)</span><span class="token punctuation">:</span>
                        label <span class="token operator">=</span> <span class="token string">'%s %.2f'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>names<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>cls<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> conf<span class="token punctuation">)</span>
                        name_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">.</span>names<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>cls<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                        plot_one_box<span class="token punctuation">(</span>xyxy<span class="token punctuation">,</span> showimg<span class="token punctuation">,</span> label<span class="token operator">=</span>label<span class="token punctuation">,</span>
                                     color<span class="token operator">=</span>self<span class="token punctuation">.</span>colors<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>cls<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> line_thickness<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>

        cv2<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span><span class="token string">'prediction.jpg'</span><span class="token punctuation">,</span> showimg<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>result <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>showimg<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2BGRA<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>result <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>
            self<span class="token punctuation">.</span>result<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">640</span><span class="token punctuation">,</span> <span class="token number">480</span><span class="token punctuation">)</span><span class="token punctuation">,</span> interpolation<span class="token operator">=</span>cv2<span class="token punctuation">.</span>INTER_AREA<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>QtImg <span class="token operator">=</span> QtGui<span class="token punctuation">.</span>QImage<span class="token punctuation">(</span>
            self<span class="token punctuation">.</span>result<span class="token punctuation">.</span>data<span class="token punctuation">,</span> self<span class="token punctuation">.</span>result<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>result<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> QtGui<span class="token punctuation">.</span>QImage<span class="token punctuation">.</span>Format_RGB32<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label<span class="token punctuation">.</span>setPixmap<span class="token punctuation">(</span>QtGui<span class="token punctuation">.</span>QPixmap<span class="token punctuation">.</span>fromImage<span class="token punctuation">(</span>self<span class="token punctuation">.</span>QtImg<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">button_video_open</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        video_name<span class="token punctuation">,</span> _ <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QFileDialog<span class="token punctuation">.</span>getOpenFileName<span class="token punctuation">(</span>
            self<span class="token punctuation">,</span> <span class="token string">"打开视频"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">"*.mp4;;*.avi;;All Files(*)"</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> <span class="token keyword">not</span> video_name<span class="token punctuation">:</span>
            <span class="token keyword">return</span>

        flag <span class="token operator">=</span> self<span class="token punctuation">.</span>cap<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>video_name<span class="token punctuation">)</span>
        <span class="token keyword">if</span> flag <span class="token operator">==</span> <span class="token boolean">False</span><span class="token punctuation">:</span>
            QtWidgets<span class="token punctuation">.</span>QMessageBox<span class="token punctuation">.</span>warning<span class="token punctuation">(</span>
                self<span class="token punctuation">,</span> <span class="token string">u"Warning"</span><span class="token punctuation">,</span> <span class="token string">u"打开视频失败"</span><span class="token punctuation">,</span> buttons<span class="token operator">=</span>QtWidgets<span class="token punctuation">.</span>QMessageBox<span class="token punctuation">.</span>Ok<span class="token punctuation">,</span> defaultButton<span class="token operator">=</span>QtWidgets<span class="token punctuation">.</span>QMessageBox<span class="token punctuation">.</span>Ok<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>out <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoWriter<span class="token punctuation">(</span><span class="token string">'prediction.avi'</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>VideoWriter_fourcc<span class="token punctuation">(</span>
                <span class="token operator">*</span><span class="token string">'MJPG'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>cap<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>cap<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>timer_video<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>pushButton_video<span class="token punctuation">.</span>setDisabled<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>pushButton_img<span class="token punctuation">.</span>setDisabled<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>pushButton_camera<span class="token punctuation">.</span>setDisabled<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">button_camera_open</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>timer_video<span class="token punctuation">.</span>isActive<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># 默认使用第一个本地camera</span>
            flag <span class="token operator">=</span> self<span class="token punctuation">.</span>cap<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> flag <span class="token operator">==</span> <span class="token boolean">False</span><span class="token punctuation">:</span>
                QtWidgets<span class="token punctuation">.</span>QMessageBox<span class="token punctuation">.</span>warning<span class="token punctuation">(</span>
                    self<span class="token punctuation">,</span> <span class="token string">u"Warning"</span><span class="token punctuation">,</span> <span class="token string">u"打开摄像头失败"</span><span class="token punctuation">,</span> buttons<span class="token operator">=</span>QtWidgets<span class="token punctuation">.</span>QMessageBox<span class="token punctuation">.</span>Ok<span class="token punctuation">,</span> defaultButton<span class="token operator">=</span>QtWidgets<span class="token punctuation">.</span>QMessageBox<span class="token punctuation">.</span>Ok<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>out <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoWriter<span class="token punctuation">(</span><span class="token string">'prediction.avi'</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>VideoWriter_fourcc<span class="token punctuation">(</span>
                    <span class="token operator">*</span><span class="token string">'MJPG'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>cap<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>cap<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>timer_video<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>pushButton_video<span class="token punctuation">.</span>setDisabled<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>pushButton_img<span class="token punctuation">.</span>setDisabled<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>pushButton_camera<span class="token punctuation">.</span>setText<span class="token punctuation">(</span><span class="token string">u"关闭摄像头"</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>timer_video<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>cap<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>out<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>label<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>init_logo<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>pushButton_video<span class="token punctuation">.</span>setDisabled<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>pushButton_img<span class="token punctuation">.</span>setDisabled<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>pushButton_camera<span class="token punctuation">.</span>setText<span class="token punctuation">(</span><span class="token string">u"摄像头检测"</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">show_video_frame</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        name_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

        flag<span class="token punctuation">,</span> img <span class="token operator">=</span> self<span class="token punctuation">.</span>cap<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> img <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            showimg <span class="token operator">=</span> img
            <span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                img <span class="token operator">=</span> letterbox<span class="token punctuation">(</span>img<span class="token punctuation">,</span> new_shape<span class="token operator">=</span>self<span class="token punctuation">.</span>opt<span class="token punctuation">.</span>img_size<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                <span class="token comment"># Convert</span>
                <span class="token comment"># BGR to RGB, to 3x416x416</span>
                img <span class="token operator">=</span> img<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
                img <span class="token operator">=</span> np<span class="token punctuation">.</span>ascontiguousarray<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
                img <span class="token operator">=</span> torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>self<span class="token punctuation">.</span>device<span class="token punctuation">)</span>
                img <span class="token operator">=</span> img<span class="token punctuation">.</span>half<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> self<span class="token punctuation">.</span>half <span class="token keyword">else</span> img<span class="token punctuation">.</span><span class="token builtin">float</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># uint8 to fp16/32</span>
                img <span class="token operator">/=</span> <span class="token number">255.0</span>  <span class="token comment"># 0 - 255 to 0.0 - 1.0</span>
                <span class="token keyword">if</span> img<span class="token punctuation">.</span>ndimension<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">:</span>
                    img <span class="token operator">=</span> img<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token comment"># Inference</span>
                pred <span class="token operator">=</span> self<span class="token punctuation">.</span>model<span class="token punctuation">(</span>img<span class="token punctuation">,</span> augment<span class="token operator">=</span>self<span class="token punctuation">.</span>opt<span class="token punctuation">.</span>augment<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

                <span class="token comment"># Apply NMS</span>
                pred <span class="token operator">=</span> non_max_suppression<span class="token punctuation">(</span>pred<span class="token punctuation">,</span> self<span class="token punctuation">.</span>opt<span class="token punctuation">.</span>conf_thres<span class="token punctuation">,</span> self<span class="token punctuation">.</span>opt<span class="token punctuation">.</span>iou_thres<span class="token punctuation">,</span> classes<span class="token operator">=</span>self<span class="token punctuation">.</span>opt<span class="token punctuation">.</span>classes<span class="token punctuation">,</span>
                                           agnostic<span class="token operator">=</span>self<span class="token punctuation">.</span>opt<span class="token punctuation">.</span>agnostic_nms<span class="token punctuation">)</span>
                <span class="token comment"># Process detections</span>
                <span class="token keyword">for</span> i<span class="token punctuation">,</span> det <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>pred<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># detections per image</span>
                    <span class="token keyword">if</span> det <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span> <span class="token keyword">and</span> <span class="token builtin">len</span><span class="token punctuation">(</span>det<span class="token punctuation">)</span><span class="token punctuation">:</span>
                        <span class="token comment"># Rescale boxes from img_size to im0 size</span>
                        det<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> scale_coords<span class="token punctuation">(</span>
                            img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> det<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> showimg<span class="token punctuation">.</span>shape<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">round</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token comment"># Write results</span>
                        <span class="token keyword">for</span> <span class="token operator">*</span>xyxy<span class="token punctuation">,</span> conf<span class="token punctuation">,</span> cls <span class="token keyword">in</span> <span class="token builtin">reversed</span><span class="token punctuation">(</span>det<span class="token punctuation">)</span><span class="token punctuation">:</span>
                            label <span class="token operator">=</span> <span class="token string">'%s %.2f'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>names<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>cls<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> conf<span class="token punctuation">)</span>
                            name_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">.</span>names<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>cls<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                            <span class="token keyword">print</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span>
                            plot_one_box<span class="token punctuation">(</span>
                                xyxy<span class="token punctuation">,</span> showimg<span class="token punctuation">,</span> label<span class="token operator">=</span>label<span class="token punctuation">,</span> color<span class="token operator">=</span>self<span class="token punctuation">.</span>colors<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>cls<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> line_thickness<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>

            self<span class="token punctuation">.</span>out<span class="token punctuation">.</span>write<span class="token punctuation">(</span>showimg<span class="token punctuation">)</span>
            show <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>showimg<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">640</span><span class="token punctuation">,</span> <span class="token number">480</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>result <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>show<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span>
            showImage <span class="token operator">=</span> QtGui<span class="token punctuation">.</span>QImage<span class="token punctuation">(</span>self<span class="token punctuation">.</span>result<span class="token punctuation">.</span>data<span class="token punctuation">,</span> self<span class="token punctuation">.</span>result<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>result<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                     QtGui<span class="token punctuation">.</span>QImage<span class="token punctuation">.</span>Format_RGB888<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>label<span class="token punctuation">.</span>setPixmap<span class="token punctuation">(</span>QtGui<span class="token punctuation">.</span>QPixmap<span class="token punctuation">.</span>fromImage<span class="token punctuation">(</span>showImage<span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>timer_video<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>cap<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>out<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>label<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>pushButton_video<span class="token punctuation">.</span>setDisabled<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>pushButton_img<span class="token punctuation">.</span>setDisabled<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>pushButton_camera<span class="token punctuation">.</span>setDisabled<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>init_logo<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QApplication<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span>
    ui <span class="token operator">=</span> Ui_MainWindow<span class="token punctuation">(</span><span class="token punctuation">)</span>
    ui<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span>app<span class="token punctuation">.</span>exec_<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre> 
<h3><a id="4_789"></a>4.照片检测</h3> 
<p>选择本地图片进行识别<br> <img src="https://images2.imgbox.com/45/d6/06wfEaQA_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/a0/98/dN5Gnjlw_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="5_797"></a>5.视频检测</h3> 
<p>选择本地的视频进行识别<br> <img src="https://images2.imgbox.com/5b/81/6ugrui08_o.png" alt="在这里插入图片描述"><br> 识别结果<br> <img src="https://images2.imgbox.com/76/5c/YP3oD8PA_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="6_802"></a>6.摄像头检测</h3> 
<p>可以成功调用摄像头，这里就不再进行展示！</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/aa2d5cddbcd01f8ac0e0b53089b39a08/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">NX二次开发 UFUN根据图纸视图抽取边2D对象找到对应的3D对象实体边 UF_DRAW_ask_drafting_curve_parents</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b18ab242c5d0f4e77868b8adb470babc/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">多台电脑连接惠普打印机</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>