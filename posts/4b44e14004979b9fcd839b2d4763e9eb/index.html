<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Qt学习3-Qt Creator四则运算计算器（哔站视频学习记录） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Qt学习3-Qt Creator四则运算计算器（哔站视频学习记录）" />
<meta property="og:description" content="计算器中的“=”按钮这部分的代码解释 目录
制作计算器中的“=”按钮这部分的代码解释
一、代码部分
二、解释
三、思路
四、死循环！
一、代码部分
void Widget::on_equalButton_clicked() { QStack&lt;int&gt; s_num,s_opt; //声明两个int类型变量 char opt[128]={0};//char型数组 int i = 0,tmp = 0,num1,num2;//声明变量i，tmp,num1，num2 //把QString 转换成 char* QByteArray ba;//字节数组 ba.append(expression);//把QString转换成QByteArray strcpy(opt,ba.data());//data可以把QByteArray转换成char * while(opt[i]!=&#39;\0&#39;||s_opt.empty()!=true)//在字符串中&#39;\0&#39;用作字符串的结束标志，字符串没结束且不为空的情况下 { if(opt[i]&gt;=&#39;0&#39;&amp;&amp;opt[i]&lt;=&#39;9&#39;)//字符在0-9之间 { tmp=tmp*10&#43;opt[i]-&#39;0&#39;; i&#43;&#43;; if(opt[i]&lt;&#39;0&#39;||opt[i]&gt;&#39;9&#39;)//字符不在0-9之间 { s_num.push(tmp); tmp = 0; } } else //操作符 { if(s_opt.empty() == true || Priority(opt[i]) &gt; Priority(s_opt.top()) || (s_opt.top() == &#39;(&#39; &amp;&amp; opt[i] != &#39;)&#39;)) { s_opt.push(opt[i]); i&#43;&#43;; continue; } if(s_opt.top() == &#39;(&#39; &amp;&amp; opt[i] == &#39;)&#39;) { s_opt." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/4b44e14004979b9fcd839b2d4763e9eb/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-06T15:34:16+08:00" />
<meta property="article:modified_time" content="2023-03-06T15:34:16+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Qt学习3-Qt Creator四则运算计算器（哔站视频学习记录）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2 id="%E5%88%B6%E4%BD%9C%E8%AE%A1%E7%AE%97%E5%99%A8%E4%B8%AD%E7%9A%84%E2%80%9C%3D%E2%80%9D%E6%8C%89%E9%92%AE%E8%BF%99%E9%83%A8%E5%88%86%E7%9A%84%E4%BB%A3%E7%A0%81%E8%A7%A3%E9%87%8A">计算器中的“=”按钮这部分的代码解释</h2> 
<p id="main-toc"><strong>目录</strong></p> 
<p id="%E5%88%B6%E4%BD%9C%E8%AE%A1%E7%AE%97%E5%99%A8%E4%B8%AD%E7%9A%84%E2%80%9C%3D%E2%80%9D%E6%8C%89%E9%92%AE%E8%BF%99%E9%83%A8%E5%88%86%E7%9A%84%E4%BB%A3%E7%A0%81%E8%A7%A3%E9%87%8A-toc" style="margin-left:0px;"><a href="#%E5%88%B6%E4%BD%9C%E8%AE%A1%E7%AE%97%E5%99%A8%E4%B8%AD%E7%9A%84%E2%80%9C%3D%E2%80%9D%E6%8C%89%E9%92%AE%E8%BF%99%E9%83%A8%E5%88%86%E7%9A%84%E4%BB%A3%E7%A0%81%E8%A7%A3%E9%87%8A" rel="nofollow">制作计算器中的“=”按钮这部分的代码解释</a></p> 
<p id="%E4%B8%80%E3%80%81%E4%BB%A3%E7%A0%81%E9%83%A8%E5%88%86-toc" style="margin-left:40px;"><a href="#%E4%B8%80%E3%80%81%E4%BB%A3%E7%A0%81%E9%83%A8%E5%88%86" rel="nofollow">一、代码部分</a></p> 
<p id="%E4%BA%8C%E3%80%81%E8%A7%A3%E9%87%8A-toc" style="margin-left:40px;"><a href="#%E4%BA%8C%E3%80%81%E8%A7%A3%E9%87%8A" rel="nofollow">二、解释</a></p> 
<p id="%E4%B8%89%E3%80%81%E6%80%9D%E8%B7%AF-toc" style="margin-left:40px;"><a href="#%E4%B8%89%E3%80%81%E6%80%9D%E8%B7%AF" rel="nofollow">三、思路</a></p> 
<p id="%E5%9B%9B%E3%80%81%E6%AD%BB%E5%BE%AA%E7%8E%AF%EF%BC%81-toc" style="margin-left:40px;"><a href="#%E5%9B%9B%E3%80%81%E6%AD%BB%E5%BE%AA%E7%8E%AF%EF%BC%81" rel="nofollow">四、死循环！</a></p> 
<hr id="hr-toc"> 
<p>一、代码部分</p> 
<pre><code class="language-cpp">void Widget::on_equalButton_clicked()
{
    QStack&lt;int&gt; s_num,s_opt; //声明两个int类型变量

    char opt[128]={0};//char型数组
    int i = 0,tmp = 0,num1,num2;//声明变量i，tmp,num1，num2

    //把QString 转换成 char*
    QByteArray ba;//字节数组
    ba.append(expression);//把QString转换成QByteArray
    strcpy(opt,ba.data());//data可以把QByteArray转换成char *

    while(opt[i]!='\0'||s_opt.empty()!=true)//在字符串中'\0'用作字符串的结束标志，字符串没结束且不为空的情况下
    {
        if(opt[i]&gt;='0'&amp;&amp;opt[i]&lt;='9')//字符在0-9之间
        {
            tmp=tmp*10+opt[i]-'0';
            i++;
            if(opt[i]&lt;'0'||opt[i]&gt;'9')//字符不在0-9之间
            {
                s_num.push(tmp);
                tmp = 0;
            }
        }
        else  //操作符
        {
            if(s_opt.empty() == true || Priority(opt[i]) &gt; Priority(s_opt.top()) ||
                                                 (s_opt.top() == '(' &amp;&amp; opt[i] != ')'))
            {
                    s_opt.push(opt[i]);
                    i++;
                    continue;
            }

            if(s_opt.top() == '(' &amp;&amp; opt[i] == ')')
            {
                s_opt.pop();
                i++;
                continue;
            }

            if (Priority(opt[i]) &lt;= Priority(s_opt.top() || (opt[i] == ')' &amp;&amp; s_opt.top()) ||
                                             (opt[i]) == '\0' &amp;&amp; s_opt.empty() != true))
            {
                char ch = s_opt.top();
                s_opt.pop();
                switch (ch)
                {
                    case '+':
                        num1 = s_num.top();//取出栈顶元素
                        s_num.pop();//删除栈顶元素
                        num2 = s_num.top();
                        s_num.pop();
                        s_num.push(num2+num1);  //进栈
                        break;
                    case '-':
                        num1 = s_num.top();
                        s_num.pop();
                        num2 = s_num.top();
                        s_num.pop();
                        s_num.push(num2-num1);  //进栈
                        break;
                    case '*':
                        num1 = s_num.top();
                        s_num.pop();
                        num2 = s_num.top();
                        s_num.pop();
                        s_num.push(num2*num1);  //进栈
                        break;
                    case '/':
                        num1 = s_num.top();
                        s_num.pop();
                        num2 = s_num.top();
                        s_num.pop();
                        s_num.push(num2/num1);  //进栈
                        break;
                }
            }
            else  //新增，解决2*3+7死循环时的问题
            {
                s_opt.push(opt[i]);
                i++;
                continue;
            }
        }

    }
    //最后留在栈里的就是结果，将结果显示
    ui-&gt;mainLineEdit-&gt;setText(QString::number(s_num.top()));  //QString中有个静态成员函数number(),可以把数字转换成字符串。
    expression.clear();
}</code></pre> 
<pre><code class="language-cpp">int Widget::Priority(char ch)
{
    switch (ch)
    {
        case '(':
            return 3;
        case '*':
        case '/':
            return 2;
        case '+':
        case '-':
            return 1;
        default:
            return 0;
    }
}
</code></pre> 
<p><strong>pop()删除栈顶元素</strong></p> 
<p><strong>top() 是取出栈顶元素，不会删掉栈里边的元素</strong></p> 
<hr> 
<h3 id="%E4%BA%8C%E3%80%81%E8%A7%A3%E9%87%8A">二、解释</h3> 
<p>这里有个优先级函数不好理解</p> 
<p>三个并列的条件语句：</p> 
<p><strong>条件1：if(s_opt.empty() == true || Priority(opt[i]) &gt; Priority(s_opt.top()) ||<br>                                                  (s_opt.top() == '(' &amp;&amp; opt[i] != ')'))</strong></p> 
<p>//如果操作符s_opt是空，或者当前操作符的优先级Priority大于栈顶的优先级，或者栈顶的操作符   是‘(’ 不是 ')'           然后把操作符入栈</p> 
<p><strong>条件2：if(s_opt.top() == '(' &amp;&amp; opt[i] == ')')</strong></p> 
<p>//如果操作符是 ‘(’  不是 ')'            直接操作符删除</p> 
<p><strong>条件3：if (Priority(opt[i]) &lt;= Priority(s_opt.top() || (opt[i] == ')' &amp;&amp; s_opt.top()) ||<br>                                              (opt[i]) == '\0' &amp;&amp; s_opt.empty() != true))</strong></p> 
<p>//如果当前的操作符小于栈顶操作符，或者操作符是(且位于栈顶，或者操作符不是字符尾和不是空时   计算+-*/</p> 
<p><strong>例如（3-1）+1</strong></p> 
<ul><li>‘(’  <strong>满足条件1</strong>的<strong>s_opt.empty() == true </strong>，刚开始时s_opt未存入任何操作符，<strong>s_opt</strong>现在有‘(’</li><li>‘-’<strong>满足条件1</strong>的<strong>(s_opt.top() == '(' &amp;&amp; opt[i] != ')')，</strong>s_opt.top()=='('且不等于‘)’</li><li>')’<strong>满足条件3</strong>的<strong>(Priority(opt[i]) &lt;= Priority(s_opt.top() ，</strong>Priority(opt[i])是‘）’的优先级0，Priority(s_opt.top())是‘-’号的优先级1，0&lt;1所有满足条件3，计算3-1,结果保存在s_num=2</li><li>')’<strong>满足条件2，删除</strong>s_opt里面的操作符</li><li>‘+’<strong>满足条件1</strong>的<strong>s_opt.empty() == true，</strong>每次计算都会pop删除栈顶的操作符，所有s_opt此时为0，之前存入的操作符已经被删除完</li><li>‘+’<strong>满足条件3</strong>的<strong>(Priority(opt[i]) &lt;= Priority(s_opt.top()，</strong>Priority(opt[i])是当i=7时的第七个字符‘\0’的优先级是0，Priority(s_opt.top())是‘+’号的优先级1，0&lt;1所有满足条件3,计算2+1=3,结果继续入栈存入s_num中</li></ul> 
<h3 id="%E4%B8%89%E3%80%81%E6%80%9D%E8%B7%AF">三、思路</h3> 
<p>思路理解：</p> 
<p>条件1是存入操作符</p> 
<p>条件2在s_opt栈顶是'('和当前操作符是‘)’时删除s_opt栈顶操作符</p> 
<p>条件3判断操作符优先级，当前操作符 优先级  小于  栈顶优先级时进行计算</p> 
<h3 id="%E5%9B%9B%E3%80%81%E6%AD%BB%E5%BE%AA%E7%8E%AF%EF%BC%81">四、死循环！</h3> 
<p>出现问题：运行2*3+7的时候报错！</p> 
<p>产生原因：i无法正常加1，一直在i=3时循环</p> 
<p>解决方法：</p> 
<pre>else  //新增，解决2*3+7死循环时的问题
            {
                s_opt.push(opt[i]);
                i++;
                continue;
            }
</pre> 
<p><strong> 完整代码参考博客和哔站QT基础教程：</strong></p> 
<p><a href="https://blog.csdn.net/OZ__96/article/details/128810119" title="w代码复现|QT快速入门 (课程来自B站)--其二_OZ__96的博客-CSDN博客">w代码复现|QT快速入门 (课程来自B站)--其二_OZ__96的博客-CSDN博客</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/03a0411bc36af9bf500d8a3213af4f34/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">ubuntu error start of central directory not found； zipfile corrupt.问题解决</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a00054c162a9528820e4e26d6c2d0e54/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">使用python selenium实现url不变的情况下，翻页爬取页面数据</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>