<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>最新Snort3和Snort2安装详细教程 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="最新Snort3和Snort2安装详细教程" />
<meta property="og:description" content="也许每个人出生的时候都以为这世界都是为他一个人而存在的，当他发现自己错的时候，他便开始长大
少走了弯路，也就错过了风景，无论如何，感谢经历
转移发布平台通知：将不再在CSDN博客发布新文章，敬请移步知识星球
感谢大家一直以来对我CSDN博客的关注和支持，但是我决定不再在这里发布新文章了。为了给大家提供更好的服务和更深入的交流，我开设了一个知识星球，内部将会提供更深入、更实用的技术文章，这些文章将更有价值，并且能够帮助你更好地解决实际问题。期待你加入我的知识星球，让我们一起成长和进步
网上看到了许多Snort3的安装以及Snort2的安装教程，尤其是Snort3的安装，博主严重怀疑他们有没有真的安装成功... ...，让人真的想扣jio，Snort3按照其它博主给的搭一直出问题，不是搭不上就是报错要么就是写的很乱，没看的欲望。而且Snort3和Snort2的安装区别很大，博主只尝试了Snort3的完整安装，并记录了下来，Snort2的网上很详细，也顺路整理了一下，有需要的自取 0x01 Snort2安装教程 安装Snort2 需要的依赖 apt-get install gcc	: 编译器,如果报错,apt-get install g&#43;&#43; apt-get install flex	: DAQ所需的解析器 apt-get install bison	: DAQ所需的解析器 apt-get install zlib1g-dev	: Snort所需的压缩库 apt-get install libpcap-dev : Snort所需的网络流量捕获头文件库 apt-get install libdnet-dev	: 不是必要的,只是snort为几个网络历程提供了简化的可移植接口 apt-get install luajit : lua的头文件库headers apt-get install liblua5.1-0-dev apt-get install liblua5.1-0-dev liblua50-dev liblualib50-dev apt-get install build-essential	: 提供编译软件的构建工具 apt-get install libpcre3-dev	: Snort所需的pcre3的头文件 apt-get install libdumbnet-dev	: 同libdnet apt-get install openssl libssl-dev	: ssl的加密组件,提供SHA和MD5文件签名 apt-cache search lua sudo apt-get update -y sudo apt-get upgrade -y sudo apt-get install gcc -y sudo apt-get install flex -y sudo apt-get install bison -y sudo apt-get install zlib1g-dev -y sudo apt-get install libpcap-dev -y sudo apt-get install libdnet-dev -y sudo apt-get install luajit -y sudo apt-get install liblua5." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/f71f97869e3a17062eb970881ddb1c9b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-31T10:32:35+08:00" />
<meta property="article:modified_time" content="2023-03-31T10:32:35+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">最新Snort3和Snort2安装详细教程</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <hr> 
<p><strong>也许每个人出生的时候都以为这世界都是为他一个人而存在的，当他发现自己错的时候，他便开始长大</strong></p> 
<p><strong>少走了弯路，也就错过了风景，无论如何，感谢经历</strong></p> 
<hr> 
<p><font color="red"><strong>转移发布平台通知：将不再在CSDN博客发布新文章，敬请移步知识星球</strong></font></p> 
<blockquote> 
 <p>感谢大家一直以来对我CSDN博客的关注和支持，但是我决定不再在这里发布新文章了。为了给大家提供更好的服务和更深入的交流，我开设了一个知识星球，内部将会提供更深入、更实用的技术文章，这些文章将更有价值，并且能够帮助你更好地解决实际问题。期待你加入我的知识星球，让我们一起成长和进步</p> 
</blockquote> 
<blockquote>
  网上看到了许多Snort3的安装以及Snort2的安装教程，尤其是Snort3的安装，博主严重怀疑他们有没有真的安装成功... ...，让人真的想扣jio，Snort3按照其它博主给的搭一直出问题，不是搭不上就是报错要么就是写的很乱，没看的欲望。而且Snort3和Snort2的安装区别很大，博主只尝试了Snort3的完整安装，并记录了下来，Snort2的网上很详细，也顺路整理了一下，有需要的自取 
</blockquote> 
<h2><a id="0x01__Snort2_18"></a>0x01 Snort2安装教程</h2> 
<ul><li>安装Snort2 需要的依赖</li></ul> 
<pre><code class="prism language-c">apt<span class="token operator">-</span>get install gcc					<span class="token operator">:</span> 编译器<span class="token punctuation">,</span>如果报错<span class="token punctuation">,</span>apt<span class="token operator">-</span>get install g<span class="token operator">++</span>
apt<span class="token operator">-</span>get install flex				<span class="token operator">:</span> DAQ所需的解析器
apt<span class="token operator">-</span>get install bison				<span class="token operator">:</span> DAQ所需的解析器
apt<span class="token operator">-</span>get install zlib1g<span class="token operator">-</span>dev			<span class="token operator">:</span> Snort所需的压缩库
apt<span class="token operator">-</span>get install libpcap<span class="token operator">-</span>dev    		<span class="token operator">:</span> Snort所需的网络流量捕获头文件库
apt<span class="token operator">-</span>get install libdnet<span class="token operator">-</span>dev			<span class="token operator">:</span> 不是必要的<span class="token punctuation">,</span>只是snort为几个网络历程提供了简化的可移植接口
apt<span class="token operator">-</span>get install luajit   			<span class="token operator">:</span> lua的头文件库headers
apt<span class="token operator">-</span>get install liblua5<span class="token punctuation">.</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">0</span><span class="token operator">-</span>dev
apt<span class="token operator">-</span>get install liblua5<span class="token punctuation">.</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">0</span><span class="token operator">-</span>dev liblua50<span class="token operator">-</span>dev liblualib50<span class="token operator">-</span>dev
apt<span class="token operator">-</span>get install build<span class="token operator">-</span>essential		<span class="token operator">:</span> 提供编译软件的构建工具
apt<span class="token operator">-</span>get install libpcre3<span class="token operator">-</span>dev		<span class="token operator">:</span> Snort所需的pcre3的头文件
apt<span class="token operator">-</span>get install libdumbnet<span class="token operator">-</span>dev		<span class="token operator">:</span> 同libdnet
apt<span class="token operator">-</span>get install openssl libssl<span class="token operator">-</span>dev	<span class="token operator">:</span> ssl的加密组件<span class="token punctuation">,</span>提供SHA和MD5文件签名
apt<span class="token operator">-</span>cache search lua
</code></pre> 
<pre><code class="prism language-c">sudo apt<span class="token operator">-</span>get update <span class="token operator">-</span>y
sudo apt<span class="token operator">-</span>get upgrade <span class="token operator">-</span>y
sudo apt<span class="token operator">-</span>get install gcc <span class="token operator">-</span>y
sudo apt<span class="token operator">-</span>get install flex <span class="token operator">-</span>y
sudo apt<span class="token operator">-</span>get install bison <span class="token operator">-</span>y
sudo apt<span class="token operator">-</span>get install zlib1g<span class="token operator">-</span>dev <span class="token operator">-</span>y
sudo apt<span class="token operator">-</span>get install libpcap<span class="token operator">-</span>dev <span class="token operator">-</span>y
sudo apt<span class="token operator">-</span>get install libdnet<span class="token operator">-</span>dev <span class="token operator">-</span>y
sudo apt<span class="token operator">-</span>get install luajit <span class="token operator">-</span>y
sudo apt<span class="token operator">-</span>get install liblua5<span class="token punctuation">.</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">0</span><span class="token operator">-</span>dev liblua50<span class="token operator">-</span>dev liblualib50<span class="token operator">-</span>dev <span class="token operator">-</span>y
sudo apt<span class="token operator">-</span>get install build<span class="token operator">-</span>essential <span class="token operator">-</span>y
sudo apt<span class="token operator">-</span>get install libpcre3<span class="token operator">-</span>dev <span class="token operator">-</span>y
sudo apt<span class="token operator">-</span>get install libdumbnet<span class="token operator">-</span>dev <span class="token operator">-</span>y
sudo apt<span class="token operator">-</span>get install openssl libssl<span class="token operator">-</span>dev <span class="token operator">-</span>y
sudo apt<span class="token operator">-</span>cache search lua <span class="token operator">-</span>y
</code></pre> 
<ul><li>下载一些源tarball和其他文件，将它们存储在一个文件夹中，方便管理</li></ul> 
<pre><code class="prism language-c">mkdir <span class="token operator">~</span><span class="token operator">/</span>snort_src
cd <span class="token operator">~</span><span class="token operator">/</span>snort_src
</code></pre> 
<ul><li>安装libpcap</li></ul> 
<pre><code>cd ~/snort_src
wget https://www.tcpdump.org/release/libpcap-1.10.1.tar.gz
tar -zxvf libpcap-1.10.1.tar.gz
cd libpcap-1.10.1
./configure &amp;&amp; make &amp;&amp; make install
</code></pre> 
<ul><li>安装nghttp2</li></ul> 
<pre><code class="prism language-c">cd <span class="token operator">~</span><span class="token operator">/</span>snort_src
wget https<span class="token operator">:</span><span class="token comment">//github.com/nghttp2/nghttp2/releases/download/v1.46.0/nghttp2-1.46.0.tar.gz</span>
tar <span class="token operator">-</span>zxvf nghttp2<span class="token operator">-</span><span class="token number">1.46</span><span class="token number">.0</span><span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz
cd nghttp2<span class="token operator">-</span><span class="token number">1.46</span><span class="token number">.0</span>
<span class="token punctuation">.</span><span class="token operator">/</span>configure <span class="token operator">&amp;&amp;</span> make <span class="token operator">&amp;&amp;</span> make install
</code></pre> 
<ul><li>安装LuaJIT</li></ul> 
<pre><code class="prism language-c">cd <span class="token operator">~</span><span class="token operator">/</span>snort_src
wget https<span class="token operator">:</span><span class="token comment">//luajit.org/download/LuaJIT-2.0.5.tar.gz</span>
tar <span class="token operator">-</span>zxvf LuaJIT<span class="token operator">-</span><span class="token number">2.0</span><span class="token number">.5</span><span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz
cd LuaJIT<span class="token operator">-</span><span class="token number">2.0</span><span class="token number">.5</span>
make <span class="token operator">&amp;&amp;</span> make <span class="token function">install</span> <span class="token punctuation">(</span>ps<span class="token operator">:</span>无<span class="token punctuation">.</span><span class="token operator">/</span>configure<span class="token punctuation">)</span>
</code></pre> 
<ul><li>安装pcre</li></ul> 
<pre><code class="prism language-c">cd <span class="token operator">~</span><span class="token operator">/</span>snort_src
wget https<span class="token operator">:</span><span class="token comment">//sourceforge.net/projects/pcre/files/pcre/8.45/pcre-8.45.tar.gz</span>
tar <span class="token operator">-</span>zxvf pcre<span class="token operator">-</span><span class="token number">8.45</span><span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz
cd pcre<span class="token operator">-</span><span class="token number">8.45</span>
<span class="token punctuation">.</span><span class="token operator">/</span>configure <span class="token operator">&amp;&amp;</span> make <span class="token operator">&amp;&amp;</span> make install
</code></pre> 
<ul><li>安装daq</li></ul> 
<pre><code class="prism language-c">cd <span class="token operator">~</span><span class="token operator">/</span>snort_src
wget https<span class="token operator">:</span><span class="token comment">//www.snort.org/downloads/snort/daq-2.0.7.tar.gz</span>
tar xvzf daq<span class="token operator">-</span><span class="token number">2.0</span><span class="token number">.7</span><span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz              
cd daq<span class="token operator">-</span><span class="token number">2.0</span><span class="token number">.7</span>
<span class="token punctuation">.</span><span class="token operator">/</span>configure <span class="token operator">&amp;&amp;</span> make <span class="token operator">&amp;&amp;</span> sudo make install
</code></pre> 
<ul><li>安装Snort2</li></ul> 
<pre><code class="prism language-c">cd <span class="token operator">~</span><span class="token operator">/</span>snort_src
wget https<span class="token operator">:</span><span class="token comment">//www.snort.org/downloads/snort/snort-2.9.19.tar.gz</span>
tar xvzf snort<span class="token operator">-</span><span class="token number">2.9</span><span class="token number">.19</span><span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz             
cd snort<span class="token operator">-</span><span class="token number">2.9</span><span class="token number">.19</span>
<span class="token punctuation">.</span><span class="token operator">/</span>configure <span class="token operator">--</span>enable<span class="token operator">-</span>sourcefire <span class="token operator">&amp;&amp;</span> make <span class="token operator">&amp;&amp;</span> sudo make install

编译出错请使用如下命令
<span class="token punctuation">.</span><span class="token operator">/</span>configure <span class="token operator">--</span>disable<span class="token operator">-</span>open<span class="token operator">-</span>appid  <span class="token operator">&amp;&amp;</span> make <span class="token operator">&amp;&amp;</span> sudo make install
</code></pre> 
<pre><code class="prism language-c">sudo ldconfig
ln <span class="token operator">-</span>s <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin<span class="token operator">/</span>snort <span class="token operator">/</span>usr<span class="token operator">/</span>sbin<span class="token operator">/</span>snort
snort <span class="token operator">-</span>V
</code></pre> 
<h3><a id="11_snort_132"></a>1.1 配置snort文件</h3> 
<ul><li>创建一些必要的文件</li></ul> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Snort的安装目录</span></span>
sudo mkdir <span class="token operator">/</span>etc<span class="token operator">/</span>snort
sudo mkdir <span class="token operator">/</span>etc<span class="token operator">/</span>snort<span class="token operator">/</span>rules
sudo mkdir <span class="token operator">/</span>etc<span class="token operator">/</span>snort<span class="token operator">/</span>rules<span class="token operator">/</span>iplists
sudo mkdir <span class="token operator">/</span>etc<span class="token operator">/</span>snort<span class="token operator">/</span>preproc_rules
sudo mkdir <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>lib<span class="token operator">/</span>snort_dynamicrules
sudo mkdir <span class="token operator">/</span>etc<span class="token operator">/</span>snort<span class="token operator">/</span>so_rules
			 
# 存储过滤规则和服务器黑白名单
sudo touch <span class="token operator">/</span>etc<span class="token operator">/</span>snort<span class="token operator">/</span>rules<span class="token operator">/</span>iplists<span class="token operator">/</span><span class="token keyword">default</span><span class="token punctuation">.</span>blacklist
sudo touch <span class="token operator">/</span>etc<span class="token operator">/</span>snort<span class="token operator">/</span>rules<span class="token operator">/</span>iplists<span class="token operator">/</span><span class="token keyword">default</span><span class="token punctuation">.</span>whitelist
sudo touch <span class="token operator">/</span>etc<span class="token operator">/</span>snort<span class="token operator">/</span>rules<span class="token operator">/</span>local<span class="token punctuation">.</span>rules
			 
# 创建日志目录
sudo mkdir <span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>snort
sudo mkdir <span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>snort<span class="token operator">/</span>archived_logs
			 
# 调整权限
sudo chmod <span class="token operator">-</span>R <span class="token number">5775</span> <span class="token operator">/</span>etc<span class="token operator">/</span>snort
sudo chmod <span class="token operator">-</span>R <span class="token number">5775</span> <span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>snort
sudo chmod <span class="token operator">-</span>R <span class="token number">5775</span> <span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>snort<span class="token operator">/</span>archived_logs
sudo chmod <span class="token operator">-</span>R <span class="token number">5775</span> <span class="token operator">/</span>etc<span class="token operator">/</span>snort<span class="token operator">/</span>so_rules
sudo chmod <span class="token operator">-</span>R <span class="token number">5775</span> <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>lib<span class="token operator">/</span>snort_dynamicrules
			 
# 改变文件夹属主
sudo chown <span class="token operator">-</span>R snort<span class="token operator">:</span>snort <span class="token operator">/</span>etc<span class="token operator">/</span>snort
sudo chown <span class="token operator">-</span>R snort<span class="token operator">:</span>snort <span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>snort
sudo chown <span class="token operator">-</span>R snort<span class="token operator">:</span>snort <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>lib<span class="token operator">/</span>snort_dynamicrules


			classification<span class="token punctuation">.</span>config	<span class="token operator">:</span> 描述了Snort理解的攻击分类类型（将规则分组为这些类型的分类），例如木马活动或系统调用检测。分类列表可以在Snort手册的第<span class="token number">3.4</span><span class="token number">.6</span>节中找到
			file_magic<span class="token punctuation">.</span>conf			<span class="token operator">:</span> 描述了用于标识文件类型的规则
			reference<span class="token punctuation">.</span>config		<span class="token operator">:</span> 包含提供有关警报的更多信息的规则中引用的URL
			snort<span class="token punctuation">.</span>conf				<span class="token operator">:</span> 是Snort的配置文件，它告诉Snort资源的位置，以及如何输出警报等
			threshold<span class="token punctuation">.</span>conf			<span class="token operator">:</span> 允许您控制生成警报所需的事件数，这有助于抑制噪声警报
			gen<span class="token operator">-</span>msg<span class="token punctuation">.</span>map				<span class="token operator">:</span> 告诉Snort哪个规则使用哪个预处理器<span class="token punctuation">,</span>更多信息在这里。
			unicode<span class="token punctuation">.</span>map				<span class="token operator">:</span> 提供Unicode语言和标识符之间的映<span class="token punctuation">,</span>nSnort需要此文件才能启动。
</code></pre> 
<ul><li>复制文件到我们的/etc/snort，这里的路径一定要确保是你的snort的解压路径</li></ul> 
<pre><code class="prism language-c">sudo cp <span class="token operator">~</span><span class="token operator">/</span>snort_src<span class="token operator">/</span>snort<span class="token operator">-</span><span class="token number">2.9</span><span class="token number">.19</span><span class="token operator">/</span>etc<span class="token comment">/*.conf* /etc/snort
sudo cp ~/snort_src/snort-2.9.19/etc/*.map /etc/snort
sudo cp ~/snort_src/snort-2.9.19/etc/*.dtd /etc/snort
sudo cp ~/snort_src/snort-2.9.19/src/dynamic-preprocessors/build/usr/local/lib/snort_dynamicpreprocessor/* /usr/local/lib/snort_dynamicpreprocessor/					
</span></code></pre> 
<ul><li>修改默认配置</li></ul> 
<pre><code class="prism language-c">	编辑snort<span class="token punctuation">.</span><span class="token function">conf</span> <span class="token punctuation">(</span>ps<span class="token operator">:</span>现在你的snort<span class="token punctuation">.</span>conf在<span class="token operator">/</span>etc<span class="token operator">/</span>snort<span class="token operator">/</span>下<span class="token punctuation">)</span>
			gedit <span class="token operator">/</span>etc<span class="token operator">/</span>snort<span class="token operator">/</span>snort<span class="token punctuation">.</span>conf
			或
			sudo vi <span class="token operator">/</span>etc<span class="token operator">/</span>snort<span class="token operator">/</span>snort<span class="token punctuation">.</span>conf
		<span class="token number">1.</span> 修改一些文件的路径<span class="token punctuation">,</span>你可以搜索RULE_PATH<span class="token punctuation">,</span>然后将下面几个路径改为如下
			var RULE_PATH <span class="token operator">/</span>etc<span class="token operator">/</span>snort<span class="token operator">/</span>rules
			var SO_RULE_PATH <span class="token operator">/</span>etc<span class="token operator">/</span>snort<span class="token operator">/</span>so_rules
			var PREPROC_RULE_PATH <span class="token operator">/</span>etc<span class="token operator">/</span>snort<span class="token operator">/</span>preproc_rules

			<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">If you are using reputation preprocessor set these</span></span>
			var WHITE_LIST_PATH <span class="token operator">/</span>etc<span class="token operator">/</span>snort<span class="token operator">/</span>rules<span class="token operator">/</span>iplists<span class="token operator">/</span>
			var BLACK_LIST_PATH <span class="token operator">/</span>etc<span class="token operator">/</span>snort<span class="token operator">/</span>rules<span class="token operator">/</span>iplists<span class="token operator">/</span>
		<span class="token number">2.</span> 打开文件过滤规则包含<span class="token punctuation">,</span>去掉开头的#号
			include $RULE_PATH<span class="token operator">/</span>local<span class="token punctuation">.</span>rules
		<span class="token number">3.</span> 修改配置文件让黑白名单生效
			whitelist $WHITE_LIST_PATH<span class="token operator">/</span><span class="token keyword">default</span><span class="token punctuation">.</span>whitelist<span class="token punctuation">,</span> \
			blacklist $BLACK_LIST_PATH<span class="token operator">/</span><span class="token keyword">default</span><span class="token punctuation">.</span>blacklist
</code></pre> 
<ul><li>安装rules包</li></ul> 
<pre><code>wget https://www.snort.org/downloads/registered/snortrules-snapshot-29190.tar.gz
tar zxvf snortrules-snapshot-29190.tar.gz -C /etc/snort
cp /etc/snort/so_rules/precompiled/RHEL-6-0/x86-64/2.9.19.0/* /usr/local/lib/snort_dynamicrules/
</code></pre> 
<ul><li>启动测试，请无视WARNING警告，不用担心，这不会影响我们的安装</li></ul> 
<pre><code class="prism language-c">sudo snort <span class="token operator">-</span>T <span class="token operator">-</span>c <span class="token operator">/</span>etc<span class="token operator">/</span>snort<span class="token operator">/</span>snort<span class="token punctuation">.</span>conf 

<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
Snort successfully validated the configuration<span class="token operator">!</span>
Snort exiting
</code></pre> 
<ul><li> <p>Snort2 安装教程<br> https://blog.csdn.net/weixin_46763552/article/details/116350545</p> </li><li> <p>Snort2 规则配置教程<br> https://blog.csdn.net/weixin_46763552/article/details/116350908</p> </li></ul> 
<p><strong>参考链接</strong>：</p> 
<p>https://blog.csdn.net/qq_38990949/article/details/85568020</p> 
<h2><a id="0x02_Snort3_242"></a>0x02 Snort3安装</h2> 
<h3><a id="21__244"></a>2.1 安装依赖以及必备组件</h3> 
<pre><code class="prism language-c">sudo apt<span class="token operator">-</span>get update <span class="token operator">&amp;&amp;</span> sudo apt<span class="token operator">-</span>get dist<span class="token operator">-</span>upgrade <span class="token operator">-</span>y
</code></pre> 
<pre><code class="prism language-c">sudo apt<span class="token operator">-</span>get install <span class="token operator">-</span>y libpcap<span class="token operator">-</span>dev libpcre3<span class="token operator">-</span>dev libdumbnet<span class="token operator">-</span>dev zlib1g<span class="token operator">-</span>dev
</code></pre> 
<pre><code class="prism language-c">sudo apt<span class="token operator">-</span>get install <span class="token operator">-</span>y build<span class="token operator">-</span>essential autotools<span class="token operator">-</span>dev libdumbnet<span class="token operator">-</span>dev libluajit<span class="token operator">-</span><span class="token number">5.1</span><span class="token operator">-</span>dev libpcap<span class="token operator">-</span>dev zlib1g<span class="token operator">-</span>dev pkg<span class="token operator">-</span>config libhwloc<span class="token operator">-</span>dev cmake liblzma<span class="token operator">-</span>dev openssl libssl<span class="token operator">-</span>dev cpputest libsqlite3<span class="token operator">-</span>dev libtool uuid<span class="token operator">-</span>dev git autoconf bison flex libcmocka<span class="token operator">-</span>dev libnetfilter<span class="token operator">-</span>queue<span class="token operator">-</span>dev libunwind<span class="token operator">-</span>dev libmnl<span class="token operator">-</span>dev ethtool
</code></pre> 
<h3><a id="22__258"></a>2.2 调整时间</h3> 
<pre><code class="prism language-c">sudo dpkg<span class="token operator">-</span>reconfigure tzdata
</code></pre> 
<h3><a id="23_tarball_264"></a>2.3 下载一些源tarball和其他文件，将它们存储在一个文件夹中，方便管理</h3> 
<pre><code class="prism language-c">mkdir <span class="token operator">~</span><span class="token operator">/</span>snort_src
cd <span class="token operator">~</span><span class="token operator">/</span>snort_src
</code></pre> 
<h3><a id="24_safecC_271"></a>2.4 下载并安装safec，以便对某些旧式C库调用进行运行时边界检查</h3> 
<pre><code class="prism language-c">cd <span class="token operator">~</span><span class="token operator">/</span>snort_src
wget https<span class="token operator">:</span><span class="token comment">//github.com/rurban/safeclib/releases/download/v02092020/libsafec-02092020.tar.gz</span>
tar <span class="token operator">-</span>xzvf libsafec<span class="token operator">-</span><span class="token number">02092020.</span>tar<span class="token punctuation">.</span>gz
cd libsafec<span class="token operator">-</span><span class="token number">02092020.0</span><span class="token operator">-</span>g6d921f
<span class="token punctuation">.</span><span class="token operator">/</span>configure
make
sudo make install
</code></pre> 
<h3><a id="25_Hyperscan_283"></a>2.5 安装Hyperscan</h3> 
<p>Snort 3使用Hyperscan进行快速模式匹配。可以从Ubuntu存储库安装一个旧版本的Hyperscan，但是Hyperscan对Snort的操作和性能至关重要，最好编译Hyperscan的最新稳定版本。Hyperscan有一个需求数量，包括PCRE、gper工具、ragel和Boost库。</p> 
<ul><li>首先安装PCRE:Perl兼容的正则表达式。不使用Ubuntu存储库，因为它有一个旧版本：</li></ul> 
<pre><code class="prism language-c">cd <span class="token operator">~</span><span class="token operator">/</span>snort_src<span class="token operator">/</span>
wget https<span class="token operator">:</span><span class="token comment">//nchc.dl.sourceforge.net/project/pcre/pcre/8.45/pcre-8.45.tar.gz</span>
tar <span class="token operator">-</span>xzvf pcre<span class="token operator">-</span><span class="token number">8.45</span><span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz
cd pcre<span class="token operator">-</span><span class="token number">8.45</span>
<span class="token punctuation">.</span><span class="token operator">/</span>configure
make
sudo make install
</code></pre> 
<ul><li>安装 gpertools</li></ul> 
<pre><code class="prism language-c">cd <span class="token operator">~</span><span class="token operator">/</span>snort_src
wget https<span class="token operator">:</span><span class="token comment">//github.com/gperftools/gperftools/releases/download/gperftools-2.9.1/gperftools-2.9.1.tar.gz</span>
tar <span class="token operator">-</span>xzvf gperftools<span class="token operator">-</span><span class="token number">2.9</span><span class="token number">.1</span><span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz
cd gperftools<span class="token operator">-</span><span class="token number">2.9</span><span class="token number">.1</span>
<span class="token punctuation">.</span><span class="token operator">/</span>configure
make
sudo make install
</code></pre> 
<ul><li>安装 Ragel</li></ul> 
<pre><code class="prism language-c">cd <span class="token operator">~</span><span class="token operator">/</span>snort_src
wget http<span class="token operator">:</span><span class="token comment">//www.colm.net/files/ragel/ragel-6.10.tar.gz</span>
tar <span class="token operator">-</span>xzvf ragel<span class="token operator">-</span><span class="token number">6.10</span><span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz
cd ragel<span class="token operator">-</span><span class="token number">6.10</span>
<span class="token punctuation">.</span><span class="token operator">/</span>configure
make
sudo make install
</code></pre> 
<ul><li>下载（但不要安装）Boost C++库</li></ul> 
<pre><code class="prism language-c">cd <span class="token operator">~</span><span class="token operator">/</span>snort_src
wget https<span class="token operator">:</span><span class="token comment">//boostorg.jfrog.io/artifactory/main/release/1.78.0/source/boost_1_78_0.tar.gz</span>
tar <span class="token operator">-</span>xvzf boost_1_78_0<span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz
</code></pre> 
<ul><li>从源代码处安装Hyperscan 5.3，参考Boost源目录的位置</li></ul> 
<pre><code class="prism language-c">cd <span class="token operator">~</span><span class="token operator">/</span>snort_src
wget https<span class="token operator">:</span><span class="token comment">//github.com/intel/hyperscan/archive/refs/tags/v5.4.0.tar.gz</span>
tar <span class="token operator">-</span>xvzf v5<span class="token punctuation">.</span><span class="token number">4.0</span><span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz
mkdir <span class="token operator">~</span><span class="token operator">/</span>snort_src<span class="token operator">/</span>hyperscan<span class="token operator">-</span><span class="token number">5.4</span><span class="token number">.0</span><span class="token operator">-</span>build
cd hyperscan<span class="token operator">-</span><span class="token number">5.4</span><span class="token number">.0</span><span class="token operator">-</span>build<span class="token operator">/</span>
cmake <span class="token operator">-</span>DCMAKE_INSTALL_PREFIX<span class="token operator">=</span><span class="token operator">/</span>usr<span class="token operator">/</span>local <span class="token operator">-</span>DBOOST_ROOT<span class="token operator">=</span><span class="token operator">~</span><span class="token operator">/</span>snort_src<span class="token operator">/</span>boost_1_78_0<span class="token operator">/</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>hyperscan<span class="token operator">-</span><span class="token number">5.4</span><span class="token number">.0</span>
make
sudo make install
</code></pre> 
<h3><a id="26_flatbuffers_344"></a>2.6 安装flatbuffers</h3> 
<pre><code class="prism language-c">cd <span class="token operator">~</span><span class="token operator">/</span>snort_src
wget https<span class="token operator">:</span><span class="token comment">//github.com/google/flatbuffers/archive/refs/tags/v2.0.0.tar.gz -O flatbuffers-v2.0.0.tar.gz</span>
tar <span class="token operator">-</span>xzvf flatbuffers<span class="token operator">-</span>v2<span class="token punctuation">.</span><span class="token number">0.0</span><span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz
mkdir flatbuffers<span class="token operator">-</span>build
cd flatbuffers<span class="token operator">-</span>build
cmake <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>flatbuffers<span class="token operator">-</span><span class="token number">2.0</span><span class="token number">.0</span>
make
sudo make install
</code></pre> 
<h3><a id="27_DAQ_357"></a>2.7 安装DAQ</h3> 
<p>安装数据采集库（DAQ），Snort3使用的数据采集卡与Snort 2.9.0系列不同</p> 
<pre><code class="prism language-c">cd <span class="token operator">~</span><span class="token operator">/</span>snort_src
# 可以根据自身下载最新的库
wget https<span class="token operator">:</span><span class="token comment">//github.com/snort3/libdaq/archive/refs/tags/v3.0.5.tar.gz</span>
tar <span class="token operator">-</span>xzvf libdaq<span class="token operator">-</span><span class="token number">3.0</span><span class="token number">.5</span><span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz
cd libdaq<span class="token operator">-</span><span class="token number">3.0</span><span class="token number">.5</span>
<span class="token punctuation">.</span><span class="token operator">/</span>bootstrap
<span class="token punctuation">.</span><span class="token operator">/</span>configure
make
sudo make install
</code></pre> 
<ul><li>更新共享库</li></ul> 
<pre><code class="prism language-c">sudo ldconfig
</code></pre> 
<h3><a id="28_Snort_3_379"></a>2.8 最后源码安装Snort 3</h3> 
<p>如果对启用其他编译时功能感兴趣，例如处理大型（超过2GB）PCAP文件的能力，或者新的命令行shell：运行./configure cmake.sh–帮助列出所有可选功能，并将它们附加到下面的./configure\u cmake.sh命令中。在Snort网站上查看Snort3的更新版本</p> 
<pre><code class="prism language-c">cd <span class="token operator">~</span><span class="token operator">/</span>snort_src
wget https<span class="token operator">:</span><span class="token comment">//github.com/snort3/snort3/archive/refs/tags/3.1.20.0.tar.gz</span>
tar <span class="token operator">-</span>xzvf snort3<span class="token operator">-</span><span class="token number">3.1</span><span class="token number">.20</span><span class="token number">.0</span><span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz
cd snort3<span class="token operator">-</span><span class="token number">3.1</span><span class="token number">.20</span><span class="token number">.0</span>
<span class="token punctuation">.</span><span class="token operator">/</span>configure_cmake<span class="token punctuation">.</span>sh <span class="token operator">--</span>prefix<span class="token operator">=</span><span class="token operator">/</span>usr<span class="token operator">/</span>local <span class="token operator">--</span>enable<span class="token operator">-</span>tcmalloc
cd build
make
sudo make install
</code></pre> 
<ul><li>Snort现安装在/usr/local/下，最后，验证Snort是否正确运行（版本为大写V）</li></ul> 
<pre><code class="prism language-c"><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin<span class="token operator">/</span>snort <span class="token operator">-</span>V
</code></pre> 
<p><img src="https://images2.imgbox.com/59/48/m4Zh71Gz_o.png" alt="在这里插入图片描述"></p> 
<p>如果输出与上图一样，Snort已安装并工作</p> 
<h3><a id="29_Snort_405"></a>2.9 测试Snort规则</h3> 
<ul><li>现在让我们用默认配置文件测试Snort</li></ul> 
<pre><code class="prism language-c">snort <span class="token operator">-</span>c <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>etc<span class="token operator">/</span>snort<span class="token operator">/</span>snort<span class="token punctuation">.</span>lua
</code></pre> 
<p><img src="https://images2.imgbox.com/85/33/kZ33O5j4_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/e4/60/KLKpccZy_o.png" alt="在这里插入图片描述"></p> 
<ul><li>为了减少IDS上截断的数据包，配置如下</li></ul> 
<pre><code># 检查这些接口的large-receive-o load（LRO）和generic-receive-offload（GRO）的状态，使用ethtool检查状态
sudo ethtool -k eth0 | grep receive-offload
</code></pre> 
<pre><code class="prism language-c">##内容，输入以下信息，用接口名称替换ens3：
<span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
Description<span class="token operator">=</span>Ethtool Configration <span class="token keyword">for</span> Network Interface
<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
Requires<span class="token operator">=</span>network<span class="token punctuation">.</span>target
Type<span class="token operator">=</span>oneshot
ExecStart<span class="token operator">=</span><span class="token operator">/</span>sbin<span class="token operator">/</span>ethtool <span class="token operator">-</span>K ens3 gro off
ExecStart<span class="token operator">=</span><span class="token operator">/</span>sbin<span class="token operator">/</span>ethtool <span class="token operator">-</span>K ens3 lro off
<span class="token punctuation">[</span>Install<span class="token punctuation">]</span>
WantedBy<span class="token operator">=</span>multi<span class="token operator">-</span>user<span class="token punctuation">.</span>target
</code></pre> 
<ul><li>创建文件后，运行如下命令启动服务</li></ul> 
<pre><code class="prism language-c">sudo systemctl enable ethtool
sudo service ethtool start
</code></pre> 
<ul><li>再次查看两者是否设置为“off”</li></ul> 
<pre><code class="prism language-c">sudo ethtool <span class="token operator">-</span>k eth0 <span class="token operator">|</span> grep receive<span class="token operator">-</span>offload
</code></pre> 
<p><img src="https://images2.imgbox.com/69/d2/2f4abcgP_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="210__454"></a>2.10 配置规则集</h3> 
<ul><li>创建一些必要的文件</li></ul> 
<pre><code>sudo mkdir /usr/local/etc/rules
sudo mkdir /usr/local/etc/so_rules/
sudo mkdir /usr/local/etc/lists/
sudo touch /usr/local/etc/rules/snort.rules
sudo touch /usr/local/etc/rules/local.rules
sudo touch /usr/local/etc/lists/default.blocklist
sudo mkdir /var/log/snort
</code></pre> 
<ul><li>在上面创建的local.rules文件中创建一个规则</li></ul> 
<pre><code class="prism language-c">sudo vi <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>etc<span class="token operator">/</span>rules<span class="token operator">/</span>local<span class="token punctuation">.</span>rules
</code></pre> 
<ul><li>local.rules文件内容</li></ul> 
<pre><code class="prism language-c">alert icmp any any <span class="token operator">-&gt;</span> any <span class="token function">any</span> <span class="token punctuation">(</span> msg<span class="token operator">:</span><span class="token string">"ICMP Traffic Detected"</span><span class="token punctuation">;</span> sid<span class="token operator">:</span><span class="token number">10000001</span><span class="token punctuation">;</span> metadata<span class="token operator">:</span>policy security<span class="token operator">-</span>ips alert<span class="token punctuation">;</span> <span class="token punctuation">)</span>
</code></pre> 
<p><strong>PS</strong>：此规则将检测ICMP事务，对于测试Snort是否正常工作和生成警报非常有用。将以下行粘贴到local.rules文件中（确保准确复制这行，必须在该文件中的每个分号中有一个空格才能正确解析警报）</p> 
<p><img src="https://images2.imgbox.com/d8/ab/OlnHfsyC_o.png" alt="在这里插入图片描述"></p> 
<ul><li>现在运行Snort并让它加载local.rules文件（带有-R标志），以确保正确加载这些规则（验证规则的格式是否正确）</li></ul> 
<pre><code class="prism language-c">snort <span class="token operator">-</span>c <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>etc<span class="token operator">/</span>snort<span class="token operator">/</span>snort<span class="token punctuation">.</span>lua <span class="token operator">-</span>R <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>etc<span class="token operator">/</span>rules<span class="token operator">/</span>local<span class="token punctuation">.</span>rules
</code></pre> 
<ul><li>现在，在接口上以检测模式运行Snort（将下面的eth0更改为与的接口名称匹配），并将所有警报打印到控制台</li></ul> 
<pre><code class="prism language-c">sudo snort <span class="token operator">-</span>c <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>etc<span class="token operator">/</span>snort<span class="token operator">/</span>snort<span class="token punctuation">.</span>lua <span class="token operator">-</span>R <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>etc<span class="token operator">/</span>rules<span class="token operator">/</span>local<span class="token punctuation">.</span>rules \
<span class="token operator">-</span>i eth0 <span class="token operator">-</span>A alert_fast <span class="token operator">-</span>s <span class="token number">65535</span> <span class="token operator">-</span>k none
</code></pre> 
<p>标志含义</p> 
<table><thead><tr><th>Flag</th><th>描述</th></tr></thead><tbody><tr><td>-c /usr/local/etc/snort/snort.lua</td><td>snort.lua配置文件</td></tr><tr><td>R /usr/local/etc/rules/local.rules</td><td>包含一个ICMP规则的规则文件的路径</td></tr><tr><td>-i eth0</td><td>要监听的接口</td></tr><tr><td>-A alert_fast</td><td>使用alert_fast快速输出插件将警报写入控制台</td></tr><tr><td>-s 65535</td><td>设置snaplen，使Snort不会截断和丢弃过大的数据包</td></tr><tr><td>-k none</td><td>忽略错误的校验和，否则snort将丢弃具有错误校验和的数据包</td></tr></tbody></table> 
<p>这意味着snort当前正在侦听该接口上的所有流量，并将其与加载的规则进行比较。当流量与规则匹配时，Snort将向控制台写入警报。现在，从该计算机上的另一个窗口（打开一个新的终端窗口或第二个ssh会话），使用ping命令生成穿过正在侦听的接口的数据包（如果从另一台计算机连接，则ping到该接口的IP地址；如果在同一台计算机上，则只ping外部IP地址）。看到屏幕上打印的警报：</p> 
<pre><code class="prism language-c">###警报信息
<span class="token number">1</span> <span class="token number">2</span> <span class="token operator">/</span> <span class="token number">15</span> −<span class="token number">2</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token number">2</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token number">6.</span> <span class="token number">97</span> <span class="token number">6</span> <span class="token number">073</span> <span class="token punctuation">[</span> <span class="token operator">*</span> <span class="token operator">*</span> <span class="token punctuation">]</span> <span class="token punctuation">[</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">]</span> <span class="token string">" ICMP T r a f f i c De tec te d "</span> <span class="token punctuation">[</span> <span class="token operator">*</span> <span class="token operator">*</span> <span class="token punctuation">]</span> <span class="token punctuation">[</span> P r i o r i t y <span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">]</span> <span class="token punctuation">{<!-- --></span> ICMP <span class="token punctuation">}</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token punctuation">.</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token punctuation">.</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token punctuation">.</span> <span class="token number">1</span> −<span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token punctuation">.</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token punctuation">.</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token punctuation">.</span> <span class="token number">8</span> <span class="token number">8</span>
<span class="token number">1</span> <span class="token number">2</span> <span class="token operator">/</span> <span class="token number">15</span> −<span class="token number">2</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token number">2</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token number">6.</span> <span class="token number">9</span> <span class="token number">7</span> <span class="token number">6</span> <span class="token number">15</span> <span class="token number">7</span> <span class="token punctuation">[</span> <span class="token operator">*</span> <span class="token operator">*</span> <span class="token punctuation">]</span> <span class="token punctuation">[</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">]</span> <span class="token string">" ICMP T r a f f i c De tec te d "</span> <span class="token punctuation">[</span> <span class="token operator">*</span> <span class="token operator">*</span> <span class="token punctuation">]</span> <span class="token punctuation">[</span> P r i o r i t y <span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">]</span> <span class="token punctuation">{<!-- --></span> ICMP <span class="token punctuation">}</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token punctuation">.</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token punctuation">.</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token punctuation">.</span> <span class="token number">8</span> <span class="token number">8</span> −<span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token punctuation">.</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token punctuation">.</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token punctuation">.</span> <span class="token number">1</span>
</code></pre> 
<p>使用ctrl-c停止Snort，这是测试Snort的一个很好的规则，但是在实际的生产使用过程中可能会有点嘈杂，所以如果愿意的话，可以用hash(#)符号来注释它。</p> 
<ul><li>接下来，编辑snort.lua文件，此文件是我们在启动时传递给Snort的配置文件</li></ul> 
<pre><code class="prism language-c">sudo vi <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>etc<span class="token operator">/</span>snort<span class="token operator">/</span>snort<span class="token punctuation">.</span>lua
</code></pre> 
<p>接下来，我们要启用解码器和检查器警报（Snort检测到的恶意流量，而不是规则，因为格式更复杂），并且我们要告诉ips模块规则文件的位置（PulledPork稍后将为我们创建此文件）</p> 
<p>向下滚动到第169行，并查找标题为ips的部分。在这里，我们从enable_builtin_rules=true中取消注释（删除前面的两个破折号），并启用pulledpork规则。请注意，lua使用四个空格，而不是制表符来缩进这些行（这是必需的）。此部分应如下所示（删除注释,166行左右）：</p> 
<pre><code class="prism language-c">ips <span class="token operator">=</span>
<span class="token punctuation">{<!-- --></span>
    enable_builtin_rules <span class="token operator">=</span> true<span class="token punctuation">,</span>
    include <span class="token operator">=</span> RULE_PATH <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token string">"/local.rules"</span><span class="token punctuation">,</span>
    variables <span class="token operator">=</span> default_variables
 <span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/3b/b9/4B8mMBU0_o.png" alt="在这里插入图片描述"></p> 
<ul><li>测试配置文件</li></ul> 
<pre><code class="prism language-c">snort <span class="token operator">-</span>c <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>etc<span class="token operator">/</span>snort<span class="token operator">/</span>snort<span class="token punctuation">.</span>lua
</code></pre> 
<p><img src="https://images2.imgbox.com/2e/d0/0o7CRLl2_o.png" alt="在这里插入图片描述"></p> 
<p>现在可以如上所述运行snort，但是不会在命令行上明确地传递local.rules文件，因为已经将它包含在snort.lua文件的ips部分中：</p> 
<pre><code class="prism language-c">sudo snort <span class="token operator">-</span>c <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>etc<span class="token operator">/</span>snort<span class="token operator">/</span>snort<span class="token punctuation">.</span>lua <span class="token operator">-</span>i eth0 <span class="token operator">-</span>A alert_fast <span class="token operator">-</span>s <span class="token number">65535</span> <span class="token operator">-</span>k none
</code></pre> 
<p><strong>PS</strong>：﻿﻿﻿按上述方式Ping接口，会再次看到写入控制台的警报</p> 
<h3><a id="211_PulledWork_565"></a>2.11 安装PulledWork</h3> 
<p>PulledWork是我们用来下载和合并Snort规则集的脚本。要从Snort下载主要的免费规则集，需要一个oinkcode。在Snort网站上注册并在继续之前保存的oinkcode，因为最流行的免费规则集需要oinkcode</p> 
<ul><li>依赖安装</li></ul> 
<pre><code class="prism language-c">sudo apt<span class="token operator">-</span>get install <span class="token operator">-</span>y libcrypt<span class="token operator">-</span>ssleay<span class="token operator">-</span>perl liblwp<span class="token operator">-</span>useragent<span class="token operator">-</span>determined<span class="token operator">-</span>perl
</code></pre> 
<ul><li>下载PulledPork的最新版本，并通过将perl文件复制到/usr/local/bin和所需的配置文件复制到/usr/local/etc/PulledPork来安装它</li></ul> 
<pre><code class="prism language-c">cd <span class="token operator">~</span><span class="token operator">/</span>snort_src
wget https<span class="token operator">:</span><span class="token comment">//github.com/shirkdog/pulledpork/archive/refs/tags/v0.7.4.tar.gz -O pulledpork-v0.7.4.tar.gz</span>
tar <span class="token operator">-</span>xzvf pulledpork<span class="token operator">-</span>v0<span class="token punctuation">.</span><span class="token number">7.4</span><span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz
cd pulledpork<span class="token operator">-</span><span class="token number">0.7</span><span class="token number">.4</span>
sudo cp pulledpork<span class="token punctuation">.</span>pl <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin
sudo chmod <span class="token operator">+</span>x <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin<span class="token operator">/</span>pulledpork<span class="token punctuation">.</span>pl
sudo mkdir <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>etc<span class="token operator">/</span>pulledpork
sudo cp etc<span class="token comment">/*.conf /usr/local/etc/pulledpork
</span></code></pre> 
<ul><li>测试是否安装成功</li></ul> 
<pre><code class="prism language-c"><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin<span class="token operator">/</span>pulledpork<span class="token punctuation">.</span>pl <span class="token operator">-</span>V
</code></pre> 
<ul><li>确定PulledWork已运行，对其进行配置：</li></ul> 
<pre><code class="prism language-c">sudo vi <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>etc<span class="token operator">/</span>pulledpork<span class="token operator">/</span>pulledpork<span class="token punctuation">.</span>conf
</code></pre> 
<p><img src="https://images2.imgbox.com/8d/2f/iEgsgFGy_o.png" alt="在这里插入图片描述"></p> 
<blockquote>
  第19行，需要更改URL，然后用在snort.com网站注册时获得的oinkcode替换。这将告诉PulledPork从何处下载规则 
</blockquote> 
<pre><code class="prism language-c">rule_url<span class="token operator">=</span>https<span class="token operator">:</span><span class="token comment">//www.snort.org/rules/|snortrules-snapshot.tar.gz|&lt;oinkcode&gt;</span>
</code></pre> 
<p>第24行：评出社区规则。这些不需要，因为它们包含在我们上面包含的注册规则集中：</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">rule</span><span class="token expression">_url<span class="token operator">=</span>https<span class="token operator">:</span></span><span class="token comment">//snort.org/downloads/community/|community-rules.tar.gz|Community</span></span>
</code></pre> 
<p>第72行：指向正确的snort.rules文件，PulledWork将保存从local.rules文件下载并包含的所有规则：</p> 
<pre><code class="prism language-c">rule_path<span class="token operator">=</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>etc<span class="token operator">/</span>rules<span class="token operator">/</span>snort<span class="token punctuation">.</span>rules
</code></pre> 
<p>第87行：告诉PulledPork local.rules文件从何处复制规则（并复制到snort.rules中）：</p> 
<pre><code class="prism language-c">local_rules<span class="token operator">=</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>etc<span class="token operator">/</span>rules<span class="token operator">/</span>local<span class="token punctuation">.</span>rules
</code></pre> 
<p>第94行：告诉PulledPork以较新的sid_msg格式输出有关规则的元数据：</p> 
<pre><code class="prism language-c">sid_msg_version<span class="token operator">=</span><span class="token number">2</span>
</code></pre> 
<p>第110行：告诉PulledPork在哪里保存已编译的规则：</p> 
<pre><code class="prism language-c">sorule_path<span class="token operator">=</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>etc<span class="token operator">/</span>so_rules<span class="token operator">/</span>
</code></pre> 
<p>第134行，将发行版改为Ubuntu-18-4（即使你运行的是ubuntu20）。这将告诉PulledWork哪个版本的编译规则与我们的系统兼容：</p> 
<pre><code class="prism language-c">distro<span class="token operator">=</span>Ubuntu<span class="token operator">-</span><span class="token number">18</span><span class="token operator">-</span><span class="token number">4</span>
</code></pre> 
<p>第142行：这告诉PulledPork在何处保存阻止列表（已知的恶意IP地址，应该被阻止）：</p> 
<pre><code class="prism language-c">block_list<span class="token operator">=</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>etc<span class="token operator">/</span>lists<span class="token operator">/</span><span class="token keyword">default</span><span class="token punctuation">.</span>blocklist
</code></pre> 
<p>第151行：告诉PulledPork块和允许列表的默认位置</p> 
<pre><code class="prism language-c">IPRVersion<span class="token operator">=</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>etc<span class="token operator">/</span>lists
</code></pre> 
<p>第186行：告诉PulledPork Snort守护进程将当前运行的PID保存在何处，以便PulledPork在安装新规则后可以向Snort发送消息，以便Snort加载新规则：</p> 
<pre><code class="prism language-c">pid_path<span class="token operator">=</span><span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>snort<span class="token operator">/</span>snort<span class="token punctuation">.</span>pid
</code></pre> 
<p>第209行：取消对此行的注释以启用下载的规则文件中的所有规则。这些规则被分为不同的规则集，这取决于想要检测trafic的攻击性。如果在IPS模式下运行（阻止而不是检测传输），可能会考虑使用“ballanted”规则集而不是“security”，因为“security”规则集在检测可能是恶意的或可能是正常的流量方面更具攻击性：</p> 
<pre><code class="prism language-c">ips_policy<span class="token operator">=</span>security
</code></pre> 
<ul><li>运行PulledPork，将配置文件传递给它并执行额外的日志记录。这将下载最新的规则集，将它们与local.rules文件中的任何规则合并，并将所有规则保存到snort.rules中，同时将黑名单条目保存在defautl.blocklist文件中：</li></ul> 
<pre><code class="prism language-c">sudo <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin<span class="token operator">/</span>pulledpork<span class="token punctuation">.</span>pl <span class="token operator">-</span>c <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>etc<span class="token operator">/</span>pulledpork<span class="token operator">/</span>pulledpork<span class="token punctuation">.</span>conf <span class="token operator">-</span>l <span class="token operator">-</span>P <span class="token operator">-</span>E <span class="token operator">-</span>H SIGHUP
</code></pre> 
<p><img src="https://images2.imgbox.com/1a/30/ztUlBmXh_o.png" alt="在这里插入图片描述"></p> 
<p>使用以下标志：</p> 
<table><thead><tr><th>Flag</th><th>描述</th></tr></thead><tbody><tr><td>-c /usr/local/etc/pulledpork/pulledpork.conf</td><td>PulledWork配置文件</td></tr><tr><td>-l</td><td>将重要信息记录到syslog</td></tr><tr><td>-P</td><td>即使未下载新规则，也处理规则</td></tr><tr><td>-E</td><td>仅允许写入排除</td></tr><tr><td>H SIGHUP</td><td>通过传递SIGHUP信号使Snort重新加载配置</td></tr></tbody></table> 
<ul><li>下一步是将此命令转换为计划任务，以便可以每天更新规则集</li></ul> 
<pre><code class="prism language-c">sudo crontab <span class="token operator">-</span>e
</code></pre> 
<ul><li>检查snort.rules文件，应该会看到一些新的规则</li></ul> 
<p>修改snort.lua以加载snort.rules而不是local.rules文件（local.rules中的规则通过PulledPork自动添加到snort.rules文件中，并与所有下载的规则一起使用，可以在snort.rules文件的末尾看到local.rules中的任何规则）</p> 
<pre><code class="prism language-c">#<span class="token number">167</span>行
ips <span class="token operator">=</span>
<span class="token punctuation">{<!-- --></span>
    enable_builtin_rules <span class="token operator">=</span> true<span class="token punctuation">,</span>
    include <span class="token operator">=</span> RULE_PATH <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token string">"/snort.rules"</span><span class="token punctuation">,</span>
    variables <span class="token operator">=</span> default_variables
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>测试Snort以查看这些规则是否正确加载：</li></ul> 
<pre><code class="prism language-c">snort <span class="token operator">-</span>c <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>etc<span class="token operator">/</span>snort<span class="token operator">/</span>snort<span class="token punctuation">.</span>lua
</code></pre> 
<h3><a id="212_Snort__718"></a>2.12 配置Snort 插件</h3> 
<ul><li>在snort.lua文件中启用一些功能：</li></ul> 
<pre><code class="prism language-c">sudo vi <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>etc<span class="token operator">/</span>snort<span class="token operator">/</span>snort<span class="token punctuation">.</span>lua
</code></pre> 
<ul><li>首先，配置HOME\u NET变量。这是指我们正在防御的本地子网（规则使用此信息来确定警报是否匹配）。在此处设置本地子网信息以匹配子网。我下面的子网是带有24位子网掩码的10.0.0.0网络</li></ul> 
<pre><code>HOME_NET = '10.0.0.0/24'
</code></pre> 
<ul><li>启用hyperscan（更快的模式匹配）：更多信息，请将其放在重新命名检查器之后（配置绑定之前（此处我配置后会有警告提示，我就没有配置了，其它人有需要的话可以配置一下））</li></ul> 
<pre><code class="prism language-c">reputation<span class="token operator">=</span>
<span class="token punctuation">{<!-- --></span>
  blacklist <span class="token operator">=</span> BLACK_LIST_PATH <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token string">"/default.blocklist"</span>
  <span class="token operator">--</span>whitelist <span class="token operator">=</span> 'whitelist file name with ip lists'
<span class="token punctuation">}</span>

search_engine <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> search_method <span class="token operator">=</span> <span class="token string">"hyperscan"</span> <span class="token punctuation">}</span>

detection <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  hyperscan_literals <span class="token operator">=</span> true<span class="token punctuation">,</span>
  pcre_to_regex <span class="token operator">=</span> true
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="213__750"></a>2.13 配置输出警告插件</h3> 
<p>为了方便地将Snort 3警报日志文件导入到选择的SIEM中（如Splunk），需要使用alert\u json输出插件将所有警报写入json格式的文本文件。启用json输出插件很简单，只需修改snort.lua文件（在第7节：配置输出中，大约230行）：</p> 
<pre><code class="prism language-c">sudo vi <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>etc<span class="token operator">/</span>snort<span class="token operator">/</span>snort<span class="token punctuation">.</span>lua
</code></pre> 
<pre><code class="prism language-c">alert_json <span class="token operator">=</span>
<span class="token punctuation">{<!-- --></span>
    file <span class="token operator">=</span> true<span class="token punctuation">,</span>
    limit <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span>
    fields <span class="token operator">=</span> 'seconds action class b64_data dir dst_addr dst_ap dst_port eth_dst eth_len \
    eth_src eth_type gid icmp_code icmp_id icmp_seq icmp_type iface ip_id ip_len msg mpls \
    pkt_gen pkt_len pkt_num priority proto rev rule service sid src_addr src_ap src_port \
    target tcp_ack tcp_flags tcp_len tcp_seq tcp_win tos ttl udp_len vlan timestamp'<span class="token punctuation">,</span>

<span class="token punctuation">}</span>
</code></pre> 
<ul><li>在alert_json插件中，我们指定了三个选项： 
  <ul><li>首先，我们使用file选项将警报输出到json格式的文件（而不是控制台）</li><li>接下来，我们指定limit选项来告诉Snort何时滚动到新文件。当输出文件达到10 MB时，将使用文件名中的当前unixtime创建一个新文件。对于测试，我们将其设置为100MB，但是在生产系统上，可能希望增加这个数字，这取决于如何进行日志管理/轮换</li><li>最后，我们指定fields选项，该选项标识json输出中应该包含警报中的哪些特定字段。在这个例子中，我们选择了所有可能的字段作为输出</li></ul> </li></ul> 
<p><strong>PS</strong>：在测试之后，可以选择删除其中的一些字段（vlan和mpls字段是不必要的，b64_data包含整个数据包负载，可以删除这些数据包负载以节省空间，尽管此字段中有很多好的信息）。不要删除“秒”字段，并确保它始终是列出的第一个字段。这将允许Splunk正确处理事件</p> 
<p>现在运行Snort，并生成一些警报。这些警报将写入/var/log/snort。运行下面的命令，然后再次ping接口（就像我们以前所做的那样，生成与local.rules文件中的规则匹配的流量）</p> 
<pre><code class="prism language-c">sudo <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin<span class="token operator">/</span>snort <span class="token operator">-</span>c <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>etc<span class="token operator">/</span>snort<span class="token operator">/</span>snort<span class="token punctuation">.</span>lua <span class="token operator">-</span>s <span class="token number">65535</span> \
<span class="token operator">-</span>k none <span class="token operator">-</span>l <span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>snort <span class="token operator">-</span>i eth0 <span class="token operator">-</span>m <span class="token number">0x1b</span>
</code></pre> 
<p>为此命令添加了几个新标志：</p> 
<table><thead><tr><th>Flag</th><th>描述</th></tr></thead><tbody><tr><td>-l var/log/snort</td><td>应该写入日志文件的目录</td></tr><tr><td>-m 0x1b</td><td>033文件权限的Umask（rw-r–r–）</td></tr></tbody></table> 
<ul><li>在snort启动后，将不会看到任何输出到屏幕上，因为我们已经启用了alert_json输出模块（该模块按照上面命令中的指定写入/var/log/snort）。停止snort（ctrl-c），然后检查/var/log/snort</li></ul> 
<pre><code class="prism language-c">cat <span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>snort<span class="token operator">/</span>alert_json<span class="token punctuation">.</span>txt
</code></pre> 
<h3><a id="213_Snort__801"></a>2.13 Snort 脚本</h3> 
<p>创建一个systemD脚本，以便在启动时自动运行snort，出于安全原因，让snort作为常规（非root）用户在启动时运行</p> 
<ul><li>创建snort用户和组</li></ul> 
<pre><code class="prism language-c">sudo groupadd snort
sudo useradd snort <span class="token operator">-</span>r <span class="token operator">-</span>s <span class="token operator">/</span>sbin<span class="token operator">/</span>nologin <span class="token operator">-</span>c SNORT_IDS <span class="token operator">-</span>g snort
</code></pre> 
<ul><li>删除旧日志文件（如果要保留，请移动它们）：</li></ul> 
<pre><code class="prism language-c">sudo rm <span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>snort<span class="token comment">/*
</span></code></pre> 
<ul><li>需要授予“snort”用户对日志目录的权限</li></ul> 
<pre><code class="prism language-c">sudo chmod <span class="token operator">-</span>R <span class="token number">5775</span> <span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>snort
sudo chown <span class="token operator">-</span>R snort<span class="token operator">:</span>snort <span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>snort
</code></pre> 
<ul><li>创建systemD服务文件</li></ul> 
<pre><code class="prism language-c">sudo vi <span class="token operator">/</span>lib<span class="token operator">/</span>systemd<span class="token operator">/</span>system<span class="token operator">/</span>snort3<span class="token punctuation">.</span>service
</code></pre> 
<ul><li>具有以下内容（更改以太网适配器eth0以匹配适配器）</li></ul> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
Description<span class="token operator">=</span>Snort3 NIDS Daemon
After<span class="token operator">=</span>syslog<span class="token punctuation">.</span>target network<span class="token punctuation">.</span>target
<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
Type<span class="token operator">=</span>simple
ExecStart<span class="token operator">=</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin<span class="token operator">/</span>snort <span class="token operator">-</span>c <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>etc<span class="token operator">/</span>snort<span class="token operator">/</span>snort<span class="token punctuation">.</span>lua <span class="token operator">-</span>s <span class="token number">65535</span> \
<span class="token operator">-</span>k none <span class="token operator">-</span>l <span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>snort <span class="token operator">-</span>D <span class="token operator">-</span>u snort <span class="token operator">-</span>g snort <span class="token operator">-</span>i eth0 <span class="token operator">-</span>m <span class="token number">0x1b</span> <span class="token operator">--</span>create<span class="token operator">-</span>pidfile
<span class="token punctuation">[</span>Install<span class="token punctuation">]</span>
WantedBy<span class="token operator">=</span>multi<span class="token operator">-</span>user<span class="token punctuation">.</span>target
</code></pre> 
<p>Snort中使用的所有标志的分类</p> 
<table><thead><tr><th>Flag</th><th>描述</th></tr></thead><tbody><tr><td>/usr/local/bin/snort</td><td>这是snort二进制文件的路径。这里不使用sudo，因为脚本将以提升的（根）权限启动</td></tr><tr><td>-c /usr/local/etc/snort/snort.lua</td><td>snort.lua配置文件</td></tr><tr><td>-s 65535</td><td>设置snaplen，使Snort不会截断和丢弃过大的数据包</td></tr><tr><td>-k none</td><td>忽略错误的校验和，否则snort将丢弃具有错误校验和的数据包，并且不会对它们进行计算</td></tr><tr><td>-l /var/log/snort</td><td>Snort将存储其输出的所有日志文件的文件夹的路径</td></tr><tr><td>-D</td><td>作为守护进程运行</td></tr><tr><td>-u snort</td><td>启动后（以及执行任何需要提升权限的操作时），切换为以“snort”用户身份运行</td></tr><tr><td>-g snort</td><td>启动后，作为“snort”组运行</td></tr><tr><td>-i eth0</td><td>要监听的接口</td></tr><tr><td>-m 0x1b</td><td>文件权限为033的Umask</td></tr><tr><td>–create-pidfile</td><td>在日志目录中创建一个PID文件（这样pulledpork可以在加载新规则后重新启动snort）</td></tr></tbody></table> 
<ul><li>启用Snort systemD服务并启动它</li></ul> 
<pre><code class="prism language-c">sudo systemctl enable snort3
sudo service snort3 start
</code></pre> 
<ul><li>检查服务的状态：</li></ul> 
<pre><code class="prism language-c">service snort3 status
</code></pre> 
<ul><li>输出应类似于以下内容，显示“active（running）”：</li></ul> 
<pre><code class="prism language-c">service snort3 status
    <span class="token operator">*</span> snort3<span class="token punctuation">.</span>service <span class="token operator">-</span> Snort3 NIDS Daemon
    Loaded<span class="token operator">:</span> <span class="token function">loaded</span> <span class="token punctuation">(</span><span class="token operator">/</span>lib<span class="token operator">/</span>systemd<span class="token operator">/</span>system<span class="token operator">/</span>snort3<span class="token punctuation">.</span>service<span class="token punctuation">;</span> enabled<span class="token punctuation">;</span> vendor preset<span class="token operator">:</span> enabled<span class="token punctuation">)</span>
    Active<span class="token operator">:</span> <span class="token function">active</span> <span class="token punctuation">(</span>running<span class="token punctuation">)</span> since Tue <span class="token number">2018</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">11</span> <span class="token number">16</span><span class="token operator">:</span><span class="token number">48</span><span class="token operator">:</span><span class="token number">44</span> EST<span class="token punctuation">;</span> <span class="token number">2</span>min <span class="token number">57</span>s ago
</code></pre> 
<ul><li>如果有任何问题，可以使用以下命令检查服务的完整输出：</li></ul> 
<pre><code class="prism language-c">sudo journalctl <span class="token operator">-</span>u snort3<span class="token punctuation">.</span>service
</code></pre> 
<h3><a id="214_Splunk_889"></a>2.14 安装Splunk</h3> 
<p>下载：https://www.splunk.com/en_us/download/splunk-enterprise.html</p> 
<p>需要注册账户才能下载，登录后点击Linux选项卡，然后单击.deb旁边的download Now按钮（基于Debian的Ubuntu系统），如果使用wget下载安装程序，然后单击“通过命令行下载”（wget）复制wget字符串以供下载。</p> 
<pre><code class="prism language-C">wget  htps://xxxxx
</code></pre> 
<ul><li>一旦系统上安装了Splunk安装程序，就需要安装它。从保存安装程序的目录：</li></ul> 
<pre><code class="prism language-c">sudo dpkg <span class="token operator">-</span>i splunk<span class="token operator">-</span><span class="token number">8.</span><span class="token operator">*</span><span class="token punctuation">.</span>deb
sudo chown <span class="token operator">-</span>R splunk<span class="token operator">:</span>splunk <span class="token operator">/</span>opt<span class="token operator">/</span>splunk
</code></pre> 
<ul><li>Splunk被安装到/opt/Splunk。请注意，安装的卷Splunk必须有5GB的可用空间，否则Splunk将无法启动。Splunk存储所有收集到的日志数据的索引位于安装位置的子文件夹中，因此请确保此卷上有足够的空间来存储希望收集的所有数据。</li></ul> 
<p>第一次启动Splunk（接受许可证并使用所有默认选项），系统将提示为Splunk创建一个新的管理用户和密码。保存这些凭据，因为稍后将使用它们登录到web界面：</p> 
<pre><code class="prism language-c">sudo <span class="token operator">/</span>opt<span class="token operator">/</span>splunk<span class="token operator">/</span>bin<span class="token operator">/</span>splunk start <span class="token operator">--</span>answer<span class="token operator">-</span>yes <span class="token operator">--</span>accept<span class="token operator">-</span>license
</code></pre> 
<ul><li>然后配置Splunk在引导时自动启动。还将为Splunk启用systemD并启动服务（而不是Splunk systemD服务名称中的大写“S”）。</li></ul> 
<pre><code class="prism language-c">sudo <span class="token operator">/</span>opt<span class="token operator">/</span>splunk<span class="token operator">/</span>bin<span class="token operator">/</span>splunk stop
sudo <span class="token operator">/</span>opt<span class="token operator">/</span>splunk<span class="token operator">/</span>bin<span class="token operator">/</span>splunk enable boot<span class="token operator">-</span>start <span class="token operator">-</span>systemd<span class="token operator">-</span>managed <span class="token number">1</span>
sudo chown <span class="token operator">-</span>R splunk<span class="token operator">:</span>splunk <span class="token operator">/</span>opt<span class="token operator">/</span>splunk
sudo service Splunkd start
</code></pre> 
<p>Splunk服务器现在正在侦听此服务器的端口8000(http://localhost:8000（如果是从本地计算机连接，或从另一台计算机通过此系统的IP地址连接），用户名和密码是安装Splunk时设置的</p> 
<p>Splunk目前使用免费的企业试用许可证运行，提供60天的所有企业功能，并允许每天索引5GB的日志数据。唯一的功能，我们将失去一旦试用许可证到期，将影响这个安装是删除已验证的登录。转换为免费许可证后，将不会提示登录到Splunk web界面</p> 
<p>Splunk Enterprise提供了许多功能，包括自动更新Splunk实例及其自动运行的Splunk应用程序的部署服务器、具有可配置权限的多个用户帐户、负载平衡和其他功能</p> 
<h3><a id="215_Splunk_930"></a>2.15 配置Splunk</h3> 
<p>现在，使用在Splunk安装期间创建的用户名和密码登录到Splunk实例。Splunk服务器正在监听端口8000(http://localhost:8000)</p> 
<p>需要安装一个Splunk插件（称为Add-on），它允许我们轻松地接收（收集）Snort 3创建的日志并对其进行规范化（确保字段命名与NIDS数据一致，这样Splunk应用程序就可以轻松地显示我们的数据）</p> 
<p>要安装此应用程序，请在Splunk实例的主页上，单击Splunk web界面左侧标题为+查找更多应用程序的链接，这将进入Splunkbase，这是一个Splunk插件的在线存储库，它扩展并增强了Splunk安装的功能。在Splunkbase中搜索Snort3，看到一个结果：snort3json警报。单击此加载项旁边的绿色安装按钮</p> 
<p>输入注册下载Splunk时使用Splunk创建的用户名和密码（不是为本地Splunk服务器实例创建的用户名和密码）。接受条款和条件，然后单击“登录并安装”。安装完成后，单击“完成”。</p> 
<p>接下来，要安装CyberChef for Splunk插件，它允许将b64_data字段转换为可读文本。如上所述，在Splunkbase中搜索“cyberchef”，单击cyberchef旁边的green install按钮以获取Splunk，登录，然后安装</p> 
<p>接下来，需要配置Snort 3 JSON Alerts插件，告诉Splunk Snort 3生成的日志文件存储在哪里，以便Splunk能够接收它们，使用配置文件从命令行执行此操作</p> 
<pre><code class="prism language-c">sudo mkdir <span class="token operator">/</span>opt<span class="token operator">/</span>splunk<span class="token operator">/</span>etc<span class="token operator">/</span>apps<span class="token operator">/</span>TA_Snort3_json<span class="token operator">/</span>local
sudo touch <span class="token operator">/</span>opt<span class="token operator">/</span>splunk<span class="token operator">/</span>etc<span class="token operator">/</span>apps<span class="token operator">/</span>TA_Snort3_json<span class="token operator">/</span>local<span class="token operator">/</span>inputs<span class="token punctuation">.</span>conf
sudo vi <span class="token operator">/</span>opt<span class="token operator">/</span>splunk<span class="token operator">/</span>etc<span class="token operator">/</span>apps<span class="token operator">/</span>TA_Snort3_json<span class="token operator">/</span>local<span class="token operator">/</span>inputs<span class="token punctuation">.</span>conf
</code></pre> 
<ul><li>在此inputs.conf文件中输入以下文本</li></ul> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>monitor<span class="token operator">:</span><span class="token comment">///var/log/snort/*alert_json.txt*]</span>
sourcetype <span class="token operator">=</span> snort3<span class="token operator">:</span>alert<span class="token operator">:</span>json
</code></pre> 
<ul><li>重启Splunk</li></ul> 
<pre><code class="prism language-c">sudo service Splunkd restart
</code></pre> 
<p>现在，当Splunk启动时，它将扫描/var/log/snort目录中的json文件，将它们分配给sourcetype of snort3：alert:json把它们记录下去</p> 
<p>从Splunk实例中登录（因为重新启动了服务器），单击左上角的Splunk&gt;Enterprise链接，然后单击左侧的Search and Reporting app链接。在“搜索”字段中，输入以下文本：</p> 
<pre><code class="prism language-c">sourcetype<span class="token operator">=</span><span class="token string">"snort3:alert:json"</span>
</code></pre> 
<p>然后单击绿色放大镜图标开始搜索，这将显示服务器正在收集的所有事件。可能看不到很多事件，特别是如果删除了从pcap文件创建的旧json文件。如果没有看到任何警报，可以使用ping创建一些新警报（请记住，之前创建了该规则）。在生成的事件和Splunk中显示的事件之间有一点延迟。如果仍然看不到任何警报，请将“时间范围”（搜索图标旁边的下拉列表设置为“过去24小时”）更改为“所有时间”，然后重新运行搜索。如果仍然没有看到任何事件，请检查/var/log/snort文件夹中是否有json文件</p> 
<h3><a id="216_Splunk_976"></a>2.16 使用Splunk</h3> 
<p>下面是一些简单的搜索，要在包含时间、源、目标和消息的表中显示所有事件，请运行以下搜索：</p> 
<pre><code class="prism language-c">sourcetype<span class="token operator">=</span><span class="token string">"snort3:alert:json"</span>
<span class="token operator">|</span> table _time src_ap dst_ap msg
</code></pre> 
<ul><li>按目的地显示所有事件的计数</li></ul> 
<pre><code class="prism language-c">sourcetype<span class="token operator">=</span><span class="token string">"snort3:alert:json"</span>
<span class="token operator">|</span> stats count by dest
</code></pre> 
<ul><li>要在地图上显示所有事件源</li></ul> 
<pre><code class="prism language-c">sourcetype<span class="token operator">=</span><span class="token string">"snort3:alert:json"</span>
<span class="token operator">|</span> iplocation src_addr
<span class="token operator">|</span> stats count by Country
<span class="token operator">|</span> geom geo_countries featureIdField<span class="token operator">=</span><span class="token string">"Country"</span>
</code></pre> 
<p>（可能需要单击“可视化”选项卡，然后单击“折线图”并将其更改为Choropleth地图）</p> 
<p>对于许多事件，都会有base64编码的有效负载数据（b64_data）字段（http和SMTP就是一个很好的例子）。为了转换这些数据以便我们可以读取，我们使用“cyberchef”函数为每个事件转换数据（动态），并为每个事件添加一个名为“decrypted”的新字段</p> 
<pre><code class="prism language-c"> sourcetype<span class="token operator">=</span><span class="token string">"snort3:alert:json"</span> dest_port<span class="token operator">=</span><span class="token number">80</span>
<span class="token operator">|</span> cyberchef infield<span class="token operator">=</span><span class="token char">'b64_data'</span> outfield<span class="token operator">=</span>decrypted operation<span class="token operator">=</span><span class="token string">"FromBase64"</span>
<span class="token operator">|</span> table src_addr<span class="token punctuation">,</span> dst_addr<span class="token punctuation">,</span> rule<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> decrypted
</code></pre> 
<ul><li> <p>使用Splunk的一些优秀免费资源包括</p> </li><li> <p>EBook</p> </li></ul> 
<p>https://www.splunk.com/en_us/form/exploring-splunk-search-processing-language-spl-primer-and-cookbook.html</p> 
<ul><li>Free Online Training</li></ul> 
<p>https://www.splunk.com/en_us/training/free-courses/splunk-fundamentals-1.html</p> 
<h3><a id="217_Splunk_1022"></a>2.17 Splunk试用版到期换成免费版</h3> 
<p>Splunk目前运行的是免费企业试用模式只有60天，此时将许可证转换为免费模式，这与企业模式类似，只是删除了一些功能，发现会缺少的功能是使用用户名和密码登录服务器（允许任何人登录），以及失去了一些与集群相关的功能和将Splunk应用程序部署到其他服务器的能力</p> 
<ul><li> <p>要更改许可证，请单击右上栏的“设置”，然后单击“许可证”</p> </li><li> <p>单击更改许可证组。选择“免费许可证”，然后单击“保存”，单击“立即重新启动”，然后单击“确定”</p> </li></ul> 
<p><strong>PS</strong>：此时，无法从远程计算机访问spunkweb界面，我们将通过Splunk Web反向代理解决</p> 
<h3><a id="218_Splunk_Web_1032"></a>2.18 反向代理Splunk Web</h3> 
<p>使用免费许可证的Splunk不会阻止使用用户名和密码进行访问，并且只允许从本地计算机进行访问（取决于切换许可证时是否在本地连接），通过设置一个反向代理，Apache监听该服务器的端口80，需要一个密码，并将重定向到Splunk接口</p> 
<ul><li>安装Apache和代理模块</li></ul> 
<pre><code class="prism language-c">sudo apt<span class="token operator">-</span>get install <span class="token operator">-</span>y apache2 apache2<span class="token operator">-</span>utils
sudo a2enmod proxy
sudo a2enmod proxy_http
sudo systemctl restart apache2
</code></pre> 
<ul><li>创建新用户</li></ul> 
<pre><code class="prism language-c">sudo touch <span class="token operator">/</span>etc<span class="token operator">/</span>apache2<span class="token operator">/</span><span class="token punctuation">.</span>htpasswd
sudo htpasswd <span class="token operator">/</span>etc<span class="token operator">/</span>apache2<span class="token operator">/</span><span class="token punctuation">.</span>htpasswd <span class="token operator">&lt;</span>username<span class="token operator">&gt;</span>
</code></pre> 
<ul><li>编辑apache配置文件，以在端口80上设置代理侦听</li></ul> 
<pre><code class="prism language-c">sudo vi <span class="token operator">/</span>etc<span class="token operator">/</span>apache2<span class="token operator">/</span>sites<span class="token operator">-</span>available<span class="token operator">/</span><span class="token number">000</span><span class="token operator">-</span><span class="token keyword">default</span><span class="token punctuation">.</span>conf
</code></pre> 
<p>在此文件中输入以下信息。如果已经有一个&lt;VirtualHost*：80&gt;部分，请将下面的设置添加到该部分中。告诉apache在端口80上侦听，需要身份验证（htaccess文件中的用户/密码），然后将所有授权的连接转发到端口8000（Splunk正在侦听）</p> 
<pre><code class="prism language-c"><span class="token operator">&lt;</span>VirtualHost <span class="token operator">*</span><span class="token operator">:</span><span class="token number">80</span><span class="token operator">&gt;</span>
ProxyPreserveHost On
ProxyPass <span class="token operator">/</span> http<span class="token operator">:</span><span class="token comment">//127.0.0.1:8000/</span>
ProxyPassReverse <span class="token operator">/</span> http<span class="token operator">:</span><span class="token comment">//127.0.0.1:8000/</span>
<span class="token operator">&lt;</span>Proxy <span class="token operator">*</span><span class="token operator">&gt;</span>
Order deny<span class="token punctuation">,</span>allow
Allow from all
Authtype Basic
Authname <span class="token string">"Password Required"</span>
AuthUserFile <span class="token operator">/</span>etc<span class="token operator">/</span>apache2<span class="token operator">/</span><span class="token punctuation">.</span>htpasswd
Require valid<span class="token operator">-</span>user
<span class="token operator">&lt;</span><span class="token operator">/</span>Proxy<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>VirtualHost<span class="token operator">&gt;</span>
</code></pre> 
<ul><li>验证apache配置</li></ul> 
<pre><code class="prism language-c">sudo apachectl <span class="token operator">-</span>t
</code></pre> 
<p><strong>PS</strong>：可能会得到一个关于服务器FQDN的错误，请忽略</p> 
<ul><li>重新启动apache以加载更改</li></ul> 
<pre><code class="prism language-c">sudo systemctl restart apache2
</code></pre> 
<ul><li>将Splunk配置为仅接受来自本地计算机的连接（通过代理重定向）</li></ul> 
<pre><code class="prism language-c">sudo vi <span class="token operator">/</span>opt<span class="token operator">/</span>splunk<span class="token operator">/</span>etc<span class="token operator">/</span>system<span class="token operator">/</span>local<span class="token operator">/</span>web<span class="token punctuation">.</span>conf
</code></pre> 
<ul><li>在“设置”部分下，添加一行：server.socket_host=localhost（如果文件为空，只需添加以下两行，否则将server.socket添加到“设置”部分）</li></ul> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>settings<span class="token punctuation">]</span>
server<span class="token punctuation">.</span>socket_host <span class="token operator">=</span> localhost
</code></pre> 
<ul><li>重新启动splunk以注册更改</li></ul> 
<pre><code class="prism language-c">sudo service Splunkd restart
</code></pre> 
<p>现在尝试连接到端口80上的splunk服务器，系统会提示输入用户名和密码。如果尝试连接到端口8000，无法连接（除非是从同一台计算机连接）。</p> 
<h3><a id="219_OpenAppID_1111"></a>2.19 OpenAppID(可选)</h3> 
<p>OpenAppID允许识别应用层（第7层）通信量，可以创建对应用程序层流量进行操作的规则（比如阻止facebook），并记录检测到的每种类型流量的流量统计信息。</p> 
<p>OpenAppID是Snort的一个可选功能，如果您想检测或阻止流量类型（facebook、FTP等），或者收集Snort服务器检测到的每种流量的数据量指标，则该启用它</p> 
<p>Snort团队在社区的帮助下组装了一个探测器包，可下载并安装它，称为applicationdetector包</p> 
<ul><li>下载OpenAppID detector包并解压缩文件</li></ul> 
<pre><code class="prism language-c">cd <span class="token operator">~</span><span class="token operator">/</span>snort_src<span class="token operator">/</span>
wget https<span class="token operator">:</span><span class="token comment">//snort.org/downloads/openappid/15607 -O OpenAppId-15607.tgz</span>
tar <span class="token operator">-</span>xzvf OpenAppId<span class="token operator">-</span><span class="token number">15607.</span>tgz
sudo cp <span class="token operator">-</span>R odp <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>lib<span class="token operator">/</span>
</code></pre> 
<p><strong>PS</strong>：如果得到一个文件不存在的错误，那么Snort团队可能更新了规则集。浏览到https://snort.org/downloads#openappid，并下载snort-openappid.tar.gz</p> 
<p>接下来，下载Snort Extras存储库，它包含了额外的检查器和插件，包括appid_listener，它将允许以JSON格式输出appid统计信息</p> 
<pre><code class="prism language-c">cd <span class="token operator">~</span><span class="token operator">/</span>snort_src<span class="token operator">/</span>
git clone https<span class="token operator">:</span><span class="token comment">//github.com/snort3/snort3_extra.git</span>
cd <span class="token punctuation">.</span><span class="token operator">/</span>snort3_extra<span class="token operator">/</span>
export PKG_CONFIG_PATH<span class="token operator">=</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>lib<span class="token operator">/</span>pkgconfig<span class="token operator">/</span>
<span class="token punctuation">.</span><span class="token operator">/</span>configure_cmake<span class="token punctuation">.</span>sh <span class="token operator">--</span>prefix<span class="token operator">=</span><span class="token operator">/</span>usr<span class="token operator">/</span>local
cd build
make
sudo make install
</code></pre> 
<ul><li>接下来编辑Snort配置文件以指向这个odp目录</li></ul> 
<pre><code class="prism language-c">sudo vi <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>etc<span class="token operator">/</span>snort<span class="token operator">/</span>snort<span class="token punctuation">.</span>lua
</code></pre> 
<p>找到以下部分并在configure Inspection部分中进行如下配置（修改appid部分，并添加新的appid\u listener部分）</p> 
<pre><code class="prism language-c">appid <span class="token operator">=</span>
<span class="token punctuation">{<!-- --></span>
    app_detector_dir <span class="token operator">=</span> <span class="token char">'/usr/local/lib'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

appid_listener <span class="token operator">=</span>
<span class="token punctuation">{<!-- --></span>
    json_logging <span class="token operator">=</span> true<span class="token punctuation">,</span>
    file <span class="token operator">=</span> <span class="token string">"/var/log/snort/appid-output.log"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>PS</strong>：既然已经做了更改，请如上所述验证snort.lua文件</p> 
<ul><li>使用新规则修改local.rules文件，该规则将检测facebook流量</li></ul> 
<pre><code class="prism language-c">alert tcp any any <span class="token operator">-&gt;</span> any <span class="token function">any</span> <span class="token punctuation">(</span> msg<span class="token operator">:</span><span class="token string">"Facebook Detected"</span><span class="token punctuation">;</span> appids<span class="token operator">:</span><span class="token string">"Facebook"</span><span class="token punctuation">;</span> sid<span class="token operator">:</span><span class="token number">10000002</span><span class="token punctuation">;</span> metadata<span class="token operator">:</span>policy security<span class="token operator">-</span>ips alert<span class="token punctuation">;</span> <span class="token punctuation">)</span>
</code></pre> 
<ul><li>测试snort_extras插件是否可以加载（这需要额外的命令行opton）以及新规则是否正确格式化</li></ul> 
<pre><code class="prism language-c">snort <span class="token operator">-</span>c <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>etc<span class="token operator">/</span>snort<span class="token operator">/</span>snort<span class="token punctuation">.</span>lua <span class="token operator">-</span>R <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>etc<span class="token operator">/</span>rules<span class="token operator">/</span>local<span class="token punctuation">.</span>rules \
<span class="token operator">--</span>plugin<span class="token operator">-</span>path<span class="token operator">=</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>lib<span class="token operator">/</span>snort_extra
</code></pre> 
<p>在继续之前修复所有错误，-pluginpath参数告诉snort从提取的snort_extra包中加载其他插件，包括appid_listener 插件</p> 
<ul><li>首先，需要pulledpork来重新创建snort.rules文件（包括新规则），该文件还将重新加载snort</li></ul> 
<pre><code class="prism language-c">sudo <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin<span class="token operator">/</span>pulledpork<span class="token punctuation">.</span>pl <span class="token operator">-</span>c <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>etc<span class="token operator">/</span>pulledpork<span class="token operator">/</span>pulledpork<span class="token punctuation">.</span>conf <span class="token operator">-</span>l <span class="token operator">-</span>P <span class="token operator">-</span>H SIGHUP
</code></pre> 
<ul><li>其次，需要修改systemD Snort脚本，让其能够加载appid_listener 目录</li></ul> 
<pre><code class="prism language-c">sudo vi <span class="token operator">/</span>lib<span class="token operator">/</span>systemd<span class="token operator">/</span>system<span class="token operator">/</span>snort3<span class="token punctuation">.</span>service
</code></pre> 
<ul><li>添加 --plugin-path 选项</li></ul> 
<pre><code class="prism language-c">ExecStart<span class="token operator">=</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin<span class="token operator">/</span>snort <span class="token operator">-</span>c <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>etc<span class="token operator">/</span>snort<span class="token operator">/</span>snort<span class="token punctuation">.</span>lua <span class="token operator">-</span>s <span class="token number">65535</span> \
<span class="token operator">-</span>k none <span class="token operator">-</span>l <span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>snort <span class="token operator">-</span>D <span class="token operator">-</span>u snort <span class="token operator">-</span>g snort <span class="token operator">-</span>i ens3 <span class="token operator">-</span>m <span class="token number">0x1b</span> <span class="token operator">--</span>create<span class="token operator">-</span>pidfile \
<span class="token operator">--</span>plugin<span class="token operator">-</span>path<span class="token operator">=</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>lib<span class="token operator">/</span>snort_extra
</code></pre> 
<ul><li>重新加载systemd文件且重新加载snort，并验证服务是否运行</li></ul> 
<pre><code class="prism language-c">sudo systemctl enable snort3
sudo service snort3 restart
service snort3 status
</code></pre> 
<ul><li>生成一些facebook流量（wget facebook.com），将看到写入splunk（和json日志文件）的警报</li></ul> 
<pre><code class="prism language-c">sourcetype<span class="token operator">=</span><span class="token string">"snort3:alert:json"</span> msg<span class="token operator">=</span><span class="token string">"Facebook Detected"</span>
</code></pre> 
<ul><li>还会在日志目录中看到一个新文件：/var/log/snort/appid-output.log，其中包含json格式的trafic统计信息</li></ul> 
<pre><code class="prism language-c"><span class="token punctuation">{<!-- --></span> <span class="token string">"session_num"</span><span class="token operator">:</span> <span class="token string">"0.58"</span><span class="token punctuation">,</span> <span class="token string">"pkt_time"</span><span class="token operator">:</span> <span class="token string">"2020-12-19 09:51:46.540562"</span><span class="token punctuation">,</span> <span class="token string">"pkt_num"</span><span class="token operator">:</span> <span class="token number">1665</span><span class="token punctuation">,</span> <span class="token string">"apps"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token string">"service"</span>
<span class="token operator">:</span> <span class="token string">"HTTPS"</span><span class="token punctuation">,</span> <span class="token string">"client"</span><span class="token operator">:</span> <span class="token string">"SSL client"</span><span class="token punctuation">,</span> <span class="token string">"payload"</span><span class="token operator">:</span> <span class="token string">"Facebook"</span><span class="token punctuation">,</span> <span class="token string">"misc"</span><span class="token operator">:</span> null<span class="token punctuation">,</span> <span class="token string">"referred"</span><span class="token operator">:</span> null <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">"proto"</span>
<span class="token operator">:</span> <span class="token string">"TCP"</span><span class="token punctuation">,</span> <span class="token string">"client_info"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token string">"ip"</span><span class="token operator">:</span> <span class="token string">"10.10.10.88"</span><span class="token punctuation">,</span> <span class="token string">"port"</span><span class="token operator">:</span> <span class="token number">33942</span><span class="token punctuation">,</span> <span class="token string">"version"</span><span class="token operator">:</span> null <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">"service_info"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
<span class="token string">"ip"</span><span class="token operator">:</span> <span class="token string">"185.60.216.35"</span><span class="token punctuation">,</span> <span class="token string">"port"</span><span class="token operator">:</span> <span class="token number">443</span><span class="token punctuation">,</span> <span class="token string">"version"</span><span class="token operator">:</span> null<span class="token punctuation">,</span> <span class="token string">"vendor"</span><span class="token operator">:</span> null <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">"user_info"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token string">"id"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> "
username<span class="token string">": null, "</span>login_status<span class="token string">": "</span>n<span class="token operator">/</span>a<span class="token string">" }, "</span>tls_host<span class="token string">": "</span>www<span class="token punctuation">.</span>facebook<span class="token punctuation">.</span>com<span class="token string">", "</span>dns_host<span class="token string">": null, "</span>http"<span class="token operator">:</span>
<span class="token punctuation">{<!-- --></span> <span class="token string">"http2_stream"</span><span class="token operator">:</span> null<span class="token punctuation">,</span> <span class="token string">"host"</span><span class="token operator">:</span> null<span class="token punctuation">,</span> <span class="token string">"url"</span><span class="token operator">:</span> null<span class="token punctuation">,</span> <span class="token string">"user_agent"</span><span class="token operator">:</span> null<span class="token punctuation">,</span> <span class="token string">"response_code"</span><span class="token operator">:</span> null<span class="token punctuation">,</span> "
referrer"<span class="token operator">:</span> null <span class="token punctuation">}</span> <span class="token punctuation">}</span>
</code></pre> 
<ul><li>服务字段告诉检测到此流量的服务，将splunk配置为读取appid stats：接下来，需要配置Snort3 json警报插件来告诉splunk OpenAppID日志文件的存储位置，使用配置文件从命令行执行此操作</li></ul> 
<pre><code class="prism language-c">sudo vi <span class="token operator">/</span>opt<span class="token operator">/</span>splunk<span class="token operator">/</span>etc<span class="token operator">/</span>apps<span class="token operator">/</span>TA_Snort3_json<span class="token operator">/</span>local<span class="token operator">/</span>inputs<span class="token punctuation">.</span>conf
</code></pre> 
<ul><li>将以下文本添加到此inputs.conf文件中（不要删除指向警报文件的其他部分）</li></ul> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>monitor<span class="token operator">:</span><span class="token comment">///var/log/snort/*appid-output.log*]</span>
sourcetype <span class="token operator">=</span> snort3<span class="token operator">:</span>openappid<span class="token operator">:</span>json
</code></pre> 
<ul><li>重启Splunk</li></ul> 
<pre><code class="prism language-c">sudo service Splunkd restart
</code></pre> 
<ul><li>现在，在splunk中搜索OpenAppID数据</li></ul> 
<pre><code class="prism language-c">search sourcetype<span class="token operator">=</span><span class="token string">"snort3:openappid:json"</span>
</code></pre> 
<p><strong>参考链接</strong>：</p> 
<p>https://www.cnblogs.com/thresh/p/14949405.html</p> 
<p>https://www.itdaan.com/blog/2018/02/08/4fc7764b521e10bb0444c926c5472a27.html</p> 
<hr> 
<p><strong>你以为你有很多路可以选择，其实你只有一条路可以走</strong></p> 
<hr>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f8ed4030b408ab42582954a33f6dc3be/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Windows下手把手教Snort的安装与配置教程</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/67095e992cc19f66ddf9aa91e0bce644/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">[免费专栏] Android安全之Android Xposed插件开发，小白都能看得懂的教程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>