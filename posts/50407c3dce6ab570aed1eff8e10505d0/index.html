<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>pytorch安装与测试 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="pytorch安装与测试" />
<meta property="og:description" content="PyTorch的飞速发展 框架好不好用，看图说话！ 安装PyTorch：使用PIP的方法比较简单
先查看你的cuda版本：
nvidia-smi 我的电脑cudaban版本是11.1的
用下面的网址找到对应的cuda版本，然后复制命令行在miniconda或者Anaconda的环境里安装即可。
https://pytorch.org/get-started/previous-versions/https://pytorch.org/get-started/previous-versions/
我的电脑安装命令就是：
pip install torch==1.9.0&#43;cu111 torchvision==0.10.0&#43;cu111 torchaudio==0.9.0 -f https://download.pytorch.org/whl/torch_stable.html 安装完成后，打开jupyter notebook： import torch torch.__version__ &#39;1.9.0&#43;cu111&#39; 安装成功后会显示你安装的版本号
接下来用一个简单的小例子做GPU训练： 线性回归 构造一组输入数据X和其对应的标签y
import numpy as np x_values = [i for i in range(11)] x_train = np.array(x_values, dtype=np.float32) x_train = x_train.reshape(-1, 1) x_train.shape (11, 1) y_values = [2*i &#43; 1 for i in x_values]#y=2x&#43;1 y_train = np.array(y_values, dtype=np.float32) y_train = y_train.reshape(-1, 1)# reshape把数据转换成矩阵格式 y_train.shape (11, 1)" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/50407c3dce6ab570aed1eff8e10505d0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-04-05T13:05:27+08:00" />
<meta property="article:modified_time" content="2022-04-05T13:05:27+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">pytorch安装与测试</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><img src="https://images2.imgbox.com/2f/ca/VfNQvv7c_o.png" alt="watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6ZW_5rKZ5pyJ6IKl6bG8,size_20,color_FFFFFF,t_70,g_se,x_16"></p> 
<h3>PyTorch的飞速发展</h3> 
<ul><li>框架好不好用，看图说话！</li></ul> 
<p><img src="https://images2.imgbox.com/d9/2f/BdnWJLeg_o.png" alt="watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6ZW_5rKZ5pyJ6IKl6bG8,size_20,color_FFFFFF,t_70,g_se,x_16"></p> 
<p> <img src="https://images2.imgbox.com/47/91/lfDVKQU6_o.png" alt="watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6ZW_5rKZ5pyJ6IKl6bG8,size_20,color_FFFFFF,t_70,g_se,x_16"></p> 
<p> 安装PyTorch：使用PIP的方法比较简单</p> 
<p>先查看你的cuda版本：</p> 
<pre><code>nvidia-smi</code></pre> 
<p> 我的电脑cudaban版本是11.1的<img src="https://images2.imgbox.com/17/0a/41YGg9up_o.png" alt="watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6ZW_5rKZ5pyJ6IKl6bG8,size_20,color_FFFFFF,t_70,g_se,x_16"></p> 
<p> 用下面的网址找到对应的cuda版本，然后复制命令行在miniconda或者Anaconda的环境里安装即可。</p> 
<p><a class="has-card" href="https://pytorch.org/get-started/previous-versions/" rel="nofollow" title="https://pytorch.org/get-started/previous-versions/"><span class="link-card-box"><span class="link-title">https://pytorch.org/get-started/previous-versions/</span><span class="link-link"><img alt="" class="link-link-icon" src="https://images2.imgbox.com/e6/ee/1WIDYQke_o.png">https://pytorch.org/get-started/previous-versions/</span></span></a></p> 
<p>我的电脑安装命令就是：</p> 
<pre><code>pip install torch==1.9.0+cu111 torchvision==0.10.0+cu111 torchaudio==0.9.0 -f https://download.pytorch.org/whl/torch_stable.html</code></pre> 
<h3>安装完成后，打开jupyter notebook：</h3> 
<blockquote> 
 <pre><code class="language-python">import torch
torch.__version__</code></pre> 
 <pre>'1.9.0+cu111'</pre> 
 <p>安装成功后会显示你安装的版本号</p> 
</blockquote> 
<blockquote> 
 <h3><strong> 接下来用一个简单的小例子做GPU训练：</strong></h3> 
 <h4><strong>线性回归</strong></h4> 
 <p>构造一组输入数据X和其对应的标签y</p> 
 <pre><code class="language-python">import numpy as np
x_values = [i for i in range(11)]
x_train = np.array(x_values, dtype=np.float32)
x_train = x_train.reshape(-1, 1)
x_train.shape</code></pre> 
 <pre>(11, 1)</pre> 
 <pre><code class="language-python">y_values = [2*i + 1 for i in x_values]#y=2x+1 
y_train = np.array(y_values, dtype=np.float32)
y_train = y_train.reshape(-1, 1)# reshape把数据转换成矩阵格式
y_train.shape</code></pre> 
 <p> </p> 
 <p>(11, 1)</p> 
 <pre><code class="language-python">import torch
import torch.nn as nn</code></pre> 
 <p> </p> 
 <h4>线性回归模型</h4> 
 <ul><li>其实线性回归就是一个不加激活函数的全连接层</li></ul> 
 <pre><code class="language-python">class LinearRegressionModel(nn.Module):
    def __init__(self, input_dim, output_dim):
        super(LinearRegressionModel, self).__init__()
        self.linear = nn.Linear(input_dim, output_dim)  

    def forward(self, x):
        out = self.linear(x)
        return out</code></pre> 
 <pre><code class="language-python">input_dim = 1
output_dim = 1

model = LinearRegressionModel(input_dim, output_dim)</code></pre> 
 <pre><code>model</code></pre> 
 <pre>LinearRegressionModel(
  (linear): Linear(in_features=1, out_features=1, bias=True)
)</pre> 
 <p>指定好参数和损失函数</p> 
 <pre><code class="language-python">epochs = 1000
learning_rate = 0.01
optimizer = torch.optim.SGD(model.parameters(), lr=learning_rate)
criterion = nn.MSELoss()</code></pre> 
 <p>训练模型</p> 
 <pre><code class="language-python">for epoch in range(epochs):
    epoch += 1
    # 注意转行成tensor
    inputs = torch.from_numpy(x_train)
    labels = torch.from_numpy(y_train)

    # 梯度要清零每一次迭代
    optimizer.zero_grad() 

    # 前向传播
    outputs = model(inputs)

    # 计算损失
    loss = criterion(outputs, labels)

    # 返向传播
    loss.backward()

    # 更新权重参数
    optimizer.step()
    if epoch % 50 == 0:
        print('epoch {}, loss {}'.format(epoch, loss.item()))</code></pre> 
 <pre>epoch 50, loss 0.002772861160337925
epoch 100, loss 0.0015815184451639652
epoch 150, loss 0.0009020335855893791
epoch 200, loss 0.0005145024042576551
epoch 250, loss 0.0002934486838057637
epoch 300, loss 0.00016736680117901415
epoch 350, loss 9.546181536279619e-05
epoch 400, loss 5.444709677249193e-05
epoch 450, loss 3.105417636106722e-05
epoch 500, loss 1.771174902387429e-05
epoch 550, loss 1.0104487046191934e-05
epoch 600, loss 5.762907676398754e-06
epoch 650, loss 3.2866553283383837e-06
epoch 700, loss 1.8745893157756655e-06
epoch 750, loss 1.0692875775930588e-06
epoch 800, loss 6.096717015680042e-07
epoch 850, loss 3.4797531611729937e-07
epoch 900, loss 1.9841668574827054e-07
epoch 950, loss 1.1307743363886402e-07
epoch 1000, loss 6.446471445542556e-08</pre> 
 <h4>测试模型预测结果</h4> 
 <pre><code class="language-python">predicted = model(torch.from_numpy(x_train).requires_grad_()).data.numpy()
predicted</code></pre> 
 <pre>array([[ 0.9995279],
       [ 2.9995959],
       [ 4.999664 ],
       [ 6.999732 ],
       [ 8.9998   ],
       [10.999867 ],
       [12.999936 ],
       [15.000004 ],
       [17.00007  ],
       [19.00014  ],
       [21.000206 ]], dtype=float32)</pre> 
 <h4>模型的保存与读取</h4> 
 <pre><code class="language-python">torch.save(model.state_dict(), 'model.pkl')</code></pre> 
 <pre><code class="language-python">model.load_state_dict(torch.load('model.pkl'))</code></pre> 
 <h4>使用GPU进行训练</h4> 
 <ul><li>只需要把数据和模型传入到cuda里面就可以了</li></ul> 
 <pre><code class="language-python">import torch
import torch.nn as nn
import numpy as np


class LinearRegressionModel(nn.Module):
    def __init__(self, input_dim, output_dim):
        super(LinearRegressionModel, self).__init__()
        self.linear = nn.Linear(input_dim, output_dim)  

    def forward(self, x):
        out = self.linear(x)
        return out

input_dim = 1
output_dim = 1

model = LinearRegressionModel(input_dim, output_dim)


device = torch.device("cuda:0" if torch.cuda.is_available() else "cpu")
model.to(device)


criterion = nn.MSELoss()


learning_rate = 0.01

optimizer = torch.optim.SGD(model.parameters(), lr=learning_rate)

epochs = 1000
for epoch in range(epochs):
    epoch += 1
    inputs = torch.from_numpy(x_train).to(device)
    labels = torch.from_numpy(y_train).to(device)

    optimizer.zero_grad() 

    outputs = model(inputs)

    loss = criterion(outputs, labels)

    loss.backward()

    optimizer.step()

    if epoch % 50 == 0:
        print('epoch {}, loss {}'.format(epoch, loss.item()))</code></pre> 
 <pre>epoch 50, loss 0.16363602876663208
epoch 100, loss 0.09333190321922302
epoch 150, loss 0.053232986479997635
epoch 200, loss 0.03036210499703884
epoch 250, loss 0.01731737330555916
epoch 300, loss 0.00987718254327774
epoch 350, loss 0.005633558612316847
epoch 400, loss 0.0032131734769791365
epoch 450, loss 0.0018326828721910715
epoch 500, loss 0.0010452885180711746
epoch 550, loss 0.0005961966817267239
epoch 600, loss 0.00034004641929641366
epoch 650, loss 0.0001939479261636734
epoch 700, loss 0.00011062397243222222
epoch 750, loss 6.309369928203523e-05
epoch 800, loss 3.5986384318675846e-05
epoch 850, loss 2.052540730801411e-05
epoch 900, loss 1.1706931218213867e-05
epoch 950, loss 6.677555120404577e-06
epoch 1000, loss 3.8078255784057546e-06</pre> 
</blockquote> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6b4e1dbaa4d5f921785a429b0a048ce1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">PVT的理解和以及它们在后仿/功耗仿真中的注意点</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4b27ce7af10d07ee22a70bea7790a3ce/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">蓝桥杯2019年Java C组真题，“人物相关性分析”</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>