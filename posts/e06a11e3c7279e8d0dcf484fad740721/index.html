<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>db2中多种方式备份数据（含db2中clob字段如何使用create table as方式备份） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="db2中多种方式备份数据（含db2中clob字段如何使用create table as方式备份）" />
<meta property="og:description" content="db2中多种方式备份数据（含db2中clob字段如何使用create table as方式备份） 1. 前言——关于DB2的其他操作2. 单表备份（备份数据）2.1 使用create table as ...2.1.1 对于没有clob的字段的备份2.1.2 对于有clob的字段的备份 2.2 使用 export 命令备份ixf文件2.2.1 导出数据命令（export）2.2.1.1 导出到当前路径2.2.1.2 导出到当指定路径 2.2.2 导入数据命令（load）2.2.3 导出表中部分数据（可加where） 2.3 使用 export 命令备份del文件 3. 导出表结构、存储过程、函数等4. 导出数据（多表）5. 导入表结构 1. 前言——关于DB2的其他操作 更多请看下面的文章： 使用docker安装db2.DB2中实现数据字段的拼接（LISTAGG() 与 xml2clob、xmlagg）.DB2—03（DB2中常见基础操作 ➕ DB2实现递归查询 ➕ DB2中自定义递归函数）. 2. 单表备份（备份数据） 2.1 使用create table as … 2.1.1 对于没有clob的字段的备份 语法如下：--1. 创建表my_table_test CREATE TABLE my_table_test AS( SELECT t.DEPT_ID ,t.DEPT_NAME FROM SYS_COMPANY_DEPT t )DATA INITIALLY DEFERRED refresh DEFERRED; --2. refresh 之后，表就可以查询了 refresh TABLE my_table_test; --3." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/e06a11e3c7279e8d0dcf484fad740721/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-27T22:53:19+08:00" />
<meta property="article:modified_time" content="2023-12-27T22:53:19+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">db2中多种方式备份数据（含db2中clob字段如何使用create table as方式备份）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>db2中多种方式备份数据（含db2中clob字段如何使用create table as方式备份）</h4> 
 <ul><li><a href="#1_DB2_1" rel="nofollow">1. 前言——关于DB2的其他操作</a></li><li><a href="#2__6" rel="nofollow">2. 单表备份（备份数据）</a></li><li><ul><li><a href="#21_create_table_as__7" rel="nofollow">2.1 使用create table as ...</a></li><li><ul><li><a href="#211_clob_8" rel="nofollow">2.1.1 对于没有clob的字段的备份</a></li><li><a href="#212_clob_28" rel="nofollow">2.1.2 对于有clob的字段的备份</a></li></ul> 
   </li><li><a href="#22__export_ixf_45" rel="nofollow">2.2 使用 export 命令备份ixf文件</a></li><li><ul><li><a href="#221_export_46" rel="nofollow">2.2.1 导出数据命令（export）</a></li><li><ul><li><a href="#2211__47" rel="nofollow">2.2.1.1 导出到当前路径</a></li><li><a href="#2212__53" rel="nofollow">2.2.1.2 导出到当指定路径</a></li></ul> 
    </li><li><a href="#222_load_59" rel="nofollow">2.2.2 导入数据命令（load）</a></li><li><a href="#223_where_65" rel="nofollow">2.2.3 导出表中部分数据（可加where）</a></li></ul> 
   </li><li><a href="#23__export_del_71" rel="nofollow">2.3 使用 export 命令备份del文件</a></li></ul> 
  </li><li><a href="#3__83" rel="nofollow">3. 导出表结构、存储过程、函数等</a></li><li><a href="#4__96" rel="nofollow">4. 导出数据（多表）</a></li><li><a href="#5__105" rel="nofollow">5. 导入表结构</a></li></ul> 
</div> 
<p></p> 
<h2><a id="1_DB2_1"></a>1. 前言——关于DB2的其他操作</h2> 
<ul><li>更多请看下面的文章： 
  <ul><li><a href="https://susu-math.blog.csdn.net/article/details/133783118?spm=1001.2014.3001.5502" rel="nofollow">使用docker安装db2</a>.</li><li><a href="https://susu-math.blog.csdn.net/article/details/134529340" rel="nofollow">DB2中实现数据字段的拼接（LISTAGG() 与 xml2clob、xmlagg）</a>.</li><li><a href="https://susu-math.blog.csdn.net/article/details/134184274" rel="nofollow">DB2—03（DB2中常见基础操作 ➕ DB2实现递归查询 ➕ DB2中自定义递归函数）</a>.</li></ul> </li></ul> 
<h2><a id="2__6"></a>2. 单表备份（备份数据）</h2> 
<h3><a id="21_create_table_as__7"></a>2.1 使用create table as …</h3> 
<h4><a id="211_clob_8"></a>2.1.1 对于没有clob的字段的备份</h4> 
<ul><li>语法如下：<pre><code class="prism language-sql"><span class="token comment">--1. 创建表my_table_test</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> my_table_test <span class="token keyword">AS</span><span class="token punctuation">(</span>
	<span class="token keyword">SELECT</span> t<span class="token punctuation">.</span>DEPT_ID <span class="token punctuation">,</span>t<span class="token punctuation">.</span>DEPT_NAME <span class="token keyword">FROM</span> SYS_COMPANY_DEPT t 
<span class="token punctuation">)</span><span class="token keyword">DATA</span> INITIALLY DEFERRED
refresh DEFERRED<span class="token punctuation">;</span>

<span class="token comment">--2. refresh 之后，表就可以查询了</span>
refresh <span class="token keyword">TABLE</span> my_table_test<span class="token punctuation">;</span>

<span class="token comment">--3. 使表 my_table_test 可以被操作修改等功能</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> my_table_test <span class="token keyword">DROP</span> materialized query<span class="token punctuation">;</span>

<span class="token comment">--4. 查询检查数据</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> my_table_test<span class="token punctuation">;</span>
</code></pre> </li><li>查看备份数据：<br> <img src="https://images2.imgbox.com/67/60/rhstyrID_o.png" alt="在这里插入图片描述"></li></ul> 
<h4><a id="212_clob_28"></a>2.1.2 对于有clob的字段的备份</h4> 
<ul><li>对于有clob的字段，不能使用上述语句（报错），如果含有clob字段的，可以先备份表结构，然后再insert 数据，步骤如下： 
  <ul><li><mark>先只创建表结构</mark>，如下：<pre><code class="prism language-sql"><span class="token comment">--1. 只建表my_table_test</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> my_table_test_2 <span class="token keyword">AS</span><span class="token punctuation">(</span>
	<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> SYS_COMPANY_DEPT t 
<span class="token punctuation">)</span>definition only<span class="token punctuation">;</span>
</code></pre> </li><li><mark>再往备份表中插入数据</mark>：<pre><code class="prism language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> my_table_test_2 <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> SYS_COMPANY_DEPT<span class="token punctuation">;</span>
</code></pre> </li><li>查询备份数据：<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> my_table_test_2<span class="token punctuation">;</span>
</code></pre> </li></ul> </li></ul> 
<h3><a id="22__export_ixf_45"></a>2.2 使用 export 命令备份ixf文件</h3> 
<h4><a id="221_export_46"></a>2.2.1 导出数据命令（export）</h4> 
<h5><a id="2211__47"></a>2.2.1.1 导出到当前路径</h5> 
<ul><li>进入指定目录（文件导出的目录），执行命令如下（下面命令是备份 my_table_test 表的数据）：<pre><code class="prism language-bash">db2 <span class="token builtin class-name">export</span> to /home/db2inst1/test_export/my_table_test.ixf of ixf <span class="token keyword">select</span> * from my_table_test
</code></pre> <img src="https://images2.imgbox.com/80/cd/y1BFRBPC_o.png" alt="在这里插入图片描述"></li></ul> 
<h5><a id="2212__53"></a>2.2.1.2 导出到当指定路径</h5> 
<ul><li>上面命令如果不修改必须在指定路径下执行才可以，否则报错，那么怎么才能在任何路径下都可执行export命令呢？只需加引号（将export导出命令引住），如下：<pre><code class="prism language-bash">db2 <span class="token string">'export to /home/db2inst1/test_export/SYS_COMPANY_DEPT.ixf of ixf select * from SYS_COMPANY_DEPT'</span>
</code></pre> <img src="https://images2.imgbox.com/54/e8/Pl1ElieI_o.png" alt="在这里插入图片描述"></li></ul> 
<h4><a id="222_load_59"></a>2.2.2 导入数据命令（load）</h4> 
<ul><li>可以把当前 <code>my_table_test</code> 表里的数据给<code>truncate</code>一下，重新导入备份数据，当然也可以新创建一个备份表用来存放备份数据，这里创建一个新表 <code>my_table_test_bak</code>，所以接下来是将备份数据导入到表my_table_test_bak中，如下：<pre><code class="prism language-bash">db2 load from /home/db2inst1/test_export/my_table_test.ixf of ixf replace into my_table_test_bak
</code></pre> <img src="https://images2.imgbox.com/e3/7e/vqhWBy7s_o.png" alt="在这里插入图片描述"></li></ul> 
<h4><a id="223_where_65"></a>2.2.3 导出表中部分数据（可加where）</h4> 
<ul><li>如下：<pre><code class="prism language-bash">db2 <span class="token string">'export to /home/db2inst1/test_export/SYS_USER_1and2.ixf of ixf SELECT * FROM SYS_USER u WHERE u.USER_ID in('</span><span class="token number">1001</span><span class="token string">','</span><span class="token number">1002</span><span class="token string">')'</span>
</code></pre> <img src="https://images2.imgbox.com/90/50/D5pZ6fR1_o.png" alt="在这里插入图片描述"></li></ul> 
<h3><a id="23__export_del_71"></a>2.3 使用 export 命令备份del文件</h3> 
<ul><li>用 export命令可以将数据库表导出成del，ixf， wsf 或者txt格式的文件，命令与备份<code>ixf</code>文件一样，下面是导出的<code>del</code>的文件，如下：<pre><code class="prism language-sql"><span class="token comment">-- 导出 DOG 表数据</span>
db2 <span class="token string">'export to /home/db2inst1/test_export/DOG.del of del select * from DOG'</span>

<span class="token comment">-- 导入 到 dog_2 表</span>
db2 <span class="token string">'load from /home/db2inst1/test_export/DOG.del of del replace into dog_2'</span>
</code></pre> </li><li>问题是，这种方式导入的数据乱码，如下：<br> <img src="https://images2.imgbox.com/4f/b9/moz1JRos_o.png" alt="在这里插入图片描述"><br> 乱码没有解决，最后选择<code>ixf</code>文件导出导入，感兴趣的自己可以试试怎么解决！</li></ul> 
<h2><a id="3__83"></a>3. 导出表结构、存储过程、函数等</h2> 
<ul><li>导出数据库创建表语句、创建函数等语句，命令如下：<pre><code class="prism language-bash"><span class="token comment"># 不需要密码直接导出</span>
db2look <span class="token parameter variable">-d</span> hello <span class="token parameter variable">-a</span> <span class="token parameter variable">-e</span> <span class="token parameter variable">-o</span> /home/db2inst1/test_export/test.sql

<span class="token comment"># 需要密码</span>
<span class="token comment"># db2look -d 数据库名 -i 数据库链接用户 -w 数据库链接密码 -a -e -o 导出sql文件存放路径</span>
db2look <span class="token parameter variable">-d</span> hello <span class="token parameter variable">-i</span> db2inst1 <span class="token parameter variable">-w</span> db2inst1-pwd <span class="token parameter variable">-a</span> <span class="token parameter variable">-e</span> <span class="token parameter variable">-o</span> /home/db2inst1/test_export/test_2.sql
</code></pre> <img src="https://images2.imgbox.com/04/03/pIpinTGq_o.png" alt="在这里插入图片描述"></li><li>查看导出的文件内容，简单查看如下：<br> <img src="https://images2.imgbox.com/fe/44/GL5Off6R_o.png" alt="在这里插入图片描述"></li></ul> 
<h2><a id="4__96"></a>4. 导出数据（多表）</h2> 
<ul><li>命令如下：<pre><code class="prism language-bash"><span class="token comment"># db2move 数据库名 export -u 数据库链接名 -p数据库链接密码</span>
db2move hello <span class="token builtin class-name">export</span> <span class="token parameter variable">-u</span> db2inst1 <span class="token parameter variable">-p</span> db2inst1-pwd
</code></pre> <img src="https://images2.imgbox.com/aa/65/a6mLbtwN_o.png" alt="在这里插入图片描述"></li><li>查看导出数据的文件：<br> <img src="https://images2.imgbox.com/8d/c5/qQ1lGu8x_o.png" alt="在这里插入图片描述"></li></ul> 
<h2><a id="5__105"></a>5. 导入表结构</h2> 
<ul><li>下面的命令，没有尝试，想尝试的自己可以尝试，参考链接如下：<br> <a href="https://blog.csdn.net/qq_30599553/article/details/86028513?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522170347148716800182730864%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&amp;request_id=170347148716800182730864&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-2-86028513-null-null.nonecase&amp;utm_term=db2%E4%B8%AD%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE&amp;spm=1018.2226.3001.4450">DB2数据库数据备份导出导入</a>.</li><li>命令如下：<pre><code class="prism language-bash">db2 <span class="token parameter variable">-tvf</span> test.sql <span class="token operator">&gt;</span> <span class="token number">1</span>.log
</code></pre> </li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e8b1146a441fc6072c5b07c50e529f47/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">redis—Hash哈希</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/be983cdf91a408fd482faa486821fac7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">科研学习|论文解读——融合类目偏好和数据场聚类的协同过滤推荐算法研究</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>