<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Centos7部署torch环境 配合pyCharm远程调试开发 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Centos7部署torch环境 配合pyCharm远程调试开发" />
<meta property="og:description" content="python目标版本3.6，torch目标版本1.8.1
部署环境总是代码开发者离不开的一个问题，通常会有几种解决路线。
1. 每个环境单独部署一套，windows一套，unix一套，需要什么依赖就装什么。
2. 引入conda环境，为每个类型的项目创建一个属于自己的虚拟环境。
3. 引入Docker，直接把代码运行所需要的操作系统以及库依赖全部打包。
4. 服务器-本地结合的开发形式。
本文主要尝试第二点与第四点相结合，利用已有的闲置服务器，配合本地IDE进行开发。
首先在Centos7上部署conda 在CentOS7环境下部署Anaconda，需要进行以下步骤：
在home下创建一个目录，名为miniconda2，我们目标是下载Miniconda
Miniconda是一个轻量级的Python发行版本，它包含了conda、python等180多个科学包及其依赖项，适合空间要求严格的用户。Miniconda相当于conda&#43;python&#43;pip，它的安装包比Anaconda更小，功能也更少，但是仍然能够满足一般用户的需求。
Anaconda是一个完整的Python发行版本，包含了conda、python等所有必要的包，适合需要安装所有包的用户。Anaconda的安装包比Miniconda更大，功能也更多，但是对于需要安装特定包的用户来说，Anaconda可能更适合。
国内镜像源的地址为：Index of /anaconda/miniconda/ | 清华大学开源软件镜像站 | Tsinghua Open Source Mirror
具体的下载指令为：
mkdir /home/miniconda2 cd /home/miniconda2 wget https://mirrors.tuna.tsinghua.edu.cn/anaconda/miniconda/Miniconda2-4.7.12.1-Linux-x86_64.sh 下载完毕后执行安装命令：
cd /home/miniconda2 chmod 777 Miniconda2-4.7.12.1-Linux-x86_64.sh #给执行权限 bash Miniconda3-latest-Linux-x86_64.sh 中间可以根据自己的需要确定安装路径。 如果我们执行conda init，系统提示： conda command not find
那我们需要将安装路径添加到系统的PATH当中，我们需要修改两个文件
sudo vim /etc/profile # 在最后一行加上: export PATH=$PATH:~/anaconda3/bin sudo vim ~/.bashrc # 在最后一行加上: export PATH=$PATH:~/anaconda3/bin 我们再执行一行语句，激活环境
source ~/.bashrc 之后我们再执行版本查看
conda -V 输出结果：即可。 然后创建一个pytorch环境，这里由于服务器性能限制，安装CPU版本即可。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/6643b5c87855130ab340ec6bfc05ac1e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-15T17:18:27+08:00" />
<meta property="article:modified_time" content="2023-04-15T17:18:27+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Centos7部署torch环境 配合pyCharm远程调试开发</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>python目标版本3.6，torch目标版本1.8.1</p> 
<p>部署环境总是代码开发者离不开的一个问题，通常会有几种解决路线。</p> 
<p>1. 每个环境单独部署一套，windows一套，unix一套，需要什么依赖就装什么。</p> 
<p>2. 引入conda环境，为每个类型的项目创建一个属于自己的虚拟环境。</p> 
<p>3. 引入Docker，直接把代码运行所需要的操作系统以及库依赖全部打包。</p> 
<p>4. 服务器-本地结合的开发形式。</p> 
<p><strong><span style="color:#38d8f0;">本文主要尝试第二点与第四点相结合，利用已有的闲置服务器，配合本地IDE进行开发。</span></strong></p> 
<hr> 
<h3>首先在Centos7上部署conda</h3> 
<p>在CentOS7环境下部署Anaconda，需要进行以下步骤：</p> 
<p>在home下创建一个目录，名为miniconda2，我们目标是下载Miniconda</p> 
<blockquote> 
 <p>Miniconda是一个轻量级的Python发行版本，它包含了conda、python等180多个科学包及其依赖项，适合空间要求严格的用户。Miniconda相当于conda+python+pip，它的安装包比Anaconda更小，功能也更少，但是仍然能够满足一般用户的需求。</p> 
 <p>Anaconda是一个完整的Python发行版本，包含了conda、python等所有必要的包，适合需要安装所有包的用户。Anaconda的安装包比Miniconda更大，功能也更多，但是对于需要安装特定包的用户来说，Anaconda可能更适合。</p> 
</blockquote> 
<p>国内镜像源的地址为：<a href="https://mirrors.tuna.tsinghua.edu.cn/anaconda/miniconda/" rel="nofollow" title="Index of /anaconda/miniconda/ | 清华大学开源软件镜像站 | Tsinghua Open Source Mirror">Index of /anaconda/miniconda/ | 清华大学开源软件镜像站 | Tsinghua Open Source Mirror</a></p> 
<p>具体的下载指令为：</p> 
<pre><code class="hljs">mkdir /home/miniconda2
cd /home/miniconda2
wget https://mirrors.tuna.tsinghua.edu.cn/anaconda/miniconda/Miniconda2-4.7.12.1-Linux-x86_64.sh
</code></pre> 
<p> 下载完毕后执行安装命令：</p> 
<pre><code class="hljs">cd /home/miniconda2
chmod 777 Miniconda2-4.7.12.1-Linux-x86_64.sh #给执行权限
bash Miniconda3-latest-Linux-x86_64.sh</code></pre> 
<p>中间可以根据自己的需要确定安装路径。 </p> 
<p>如果我们执行conda init，系统提示： conda command not find</p> 
<p>那我们需要将安装路径添加到系统的PATH当中，我们需要修改两个文件</p> 
<pre><code class="hljs">sudo vim /etc/profile

# 在最后一行加上: 

export PATH=$PATH:~/anaconda3/bin
</code></pre> 
<pre><code class="hljs">sudo vim ~/.bashrc

# 在最后一行加上: 

export PATH=$PATH:~/anaconda3/bin
</code></pre> 
<p>我们再执行一行语句，激活环境</p> 
<pre><code class="hljs">source ~/.bashrc
</code></pre> 
<p> 之后我们再执行版本查看</p> 
<pre><code class="hljs">conda -V
</code></pre> 
<p>输出结果：<img alt="" height="28" src="https://images2.imgbox.com/84/91/MTRFIvqT_o.png" width="118">即可。 </p> 
<hr> 
<p>然后创建一个pytorch环境，这里由于服务器性能限制，安装CPU版本即可。</p> 
<p>我们首先应该明确：troch-torchvision-python版本的对应关系：</p> 
<p><img alt="来自pytorch官网" src="https://images2.imgbox.com/be/4e/VfQRawIj_o.png"></p> 
<p>我们暂定选用Python版本3.6为主环境。</p> 
<p>首先更新镜像源：</p> 
<p>具体的我们最热门的使用清华镜像源：<a href="https://mirrors.tuna.tsinghua.edu.cn/help/anaconda/" rel="nofollow" title="anaconda | 镜像站使用帮助 | 清华大学开源软件镜像站 | Tsinghua Open Source Mirror">anaconda | 镜像站使用帮助 | 清华大学开源软件镜像站 | Tsinghua Open Source Mirror</a></p> 
<p><a href="https://so.csdn.net/so/search?q=Anaconda&amp;spm=1001.2101.3001.7020" title="Anaconda">Anaconda</a>的配置文件叫.condarc，一般会放在用户的home目录，因为前面带有"."，因此是隐藏文件，对用户是隐藏的。我们可以用vim ~/.condarc直接编辑。</p> 
<pre><code class="hljs">channels:
  - defaults
show_channel_urls: true
default_channels:
  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main
  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free
  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/r
  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/Paddle/
custom_channels:
  conda-forge: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
  msys2: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
  bioconda: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
  menpo: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
  pytorch: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
  simpleitk: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
</code></pre> 
<p>或者我们可以直接执行：</p> 
<blockquote> 
 <p>conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/ </p> 
 <p>conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/</p> 
 <p>conda config --set show_channel_urls yes</p> 
</blockquote> 
<p>有需要的话pip也需要配置镜像源：</p> 
<h4>设置pip国内源<br><strong>参考：https://www.jianshu.com/p/091637a926e5</strong></h4> 
<p>Python的包管理工具是pip，用pip下载需要用到的依赖库，默认pip从国外镜像源下载，速度很慢，所以要设计中国内镜像源。</p> 
<p>所以换了一个。在pytorch_cpu环境中，修改pip镜像源：</p> 
<blockquote> 
 <p># 设置pip镜像源<br> conda activate pytorch_cpu<br> pip config set global.index-url https://mirrors.163.com/pypi/simple/</p> 
</blockquote> 
<p>我们创建并进入虚拟环境：</p> 
<pre><code class="hljs">conda create -n pytorch_cpu python=3.6.5</code></pre> 
<p>具体的依赖我们参考这篇文章：</p> 
<p><a href="https://blog.csdn.net/jiangyangll/article/details/121047633?spm=1001.2101.3001.6661.1&amp;utm_medium=distribute.pc_relevant_t0.none-task-blog-2~default~BlogCommendFromBaidu~Rate-1-121047633-blog-107299953.235%5Ev29%5Epc_relevant_default_base&amp;depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2~default~BlogCommendFromBaidu~Rate-1-121047633-blog-107299953.235%5Ev29%5Epc_relevant_default_base&amp;utm_relevant_index=1" title="PyTorch深度学习（13）PyTorch Torch Vision python 版本对应_pytorch版本对应_JYliangliang的博客-CSDN博客">PyTorch深度学习（13）PyTorch Torch Vision python 版本对应_pytorch版本对应_JYliangliang的博客-CSDN博客</a></p> 
<p>安装pytorch1.8.0的CPU版本依赖，我们进入torch官网：<a href="https://pytorch.org/" rel="nofollow" title="PyTorch">PyTorch</a></p> 
<pre></pre> 
<blockquote> 
 <p> 执行：conda install pytorch torchvision torchaudio cpuonly -c pytorch</p> 
</blockquote> 
<p>但是过程中提示报错：</p> 
<p><span style="color:#fe2c24;">CondaMultiError: [Errno 12] Cannot allocate memory()</span></p> 
<p>猜测可能是之前用yum install anaconda，和现在的miniconda产生了冲突？<br> 经过这篇文章的分享：<a href="https://blog.csdn.net/rosefun96/article/details/109300958" title="解决Linux：[Errno 12] Cannot allocate memory问题_rosefunR的博客-CSDN博客">解决Linux：[Errno 12] Cannot allocate memory问题_rosefunR的博客-CSDN博客</a></p> 
<p>发现可能是由于服务器swap区域空间不足。我们配置一个swap区域，我这里分了2G，安装过程顺利进行。</p> 
<p>安装完毕之后，我们执行 conda list # 查看已经安装的包： </p> 
<p><img alt="" height="61" src="https://images2.imgbox.com/27/44/pImbUvKH_o.png" width="326"></p> 
<hr> 
<p>运行一些代码，以确保环境安装顺利，确认好工作目录。</p> 
<p>自建目录之后，我们运行一些测试代码，比如将网络设备信息编码为张量形式</p> 
<pre><code class="language-python">import torch  
import torch.nn as nn  
  
class Net(nn.Module):  
    def __init__(self):  
        super(Net, self).__init__()  
        self.fc1 = nn.Linear(10, 5)  
        self.fc2 = nn.Linear(5, 1)  
  
    def forward(self, x):  
        x = torch.relu(self.fc1(x))  
        x = self.fc2(x)  
        return x  
  
# 创建模型实例  
net = Net()  
  
# 定义输入张量  
x = torch.randn(1, 10)  
  
# 将输入张量编码为张量形式  
x = x.unsqueeze(0)  
x = torch.tensor(x, dtype=torch.float32)  
  
# 将张量形式的输入张量传递给模型  
output = net(x)  
  
# 输出模型的输出张量  
print(output)</code></pre> 
<p>输出结果：</p> 
<p><img alt="" height="88" src="https://images2.imgbox.com/7a/85/OxzmxrLC_o.png" width="598"></p> 
<p> 正常运行。</p> 
<p>我们再测试一组样例：</p> 
<pre><code class="language-python">import torch
from torch_geometric.data import Data

# 定义设备列表和边列表
devices = ['device1', 'device2', 'device3']
edges = [(0, 1), (1, 2)]

# 创建节点特征矩阵
x = torch.eye(len(devices))  # one-hot 编码

# 创建边列表
edge_index = torch.tensor(list(zip(*edges)), dtype=torch.long)

# 创建图数据对象
data = Data(x=x, edge_index=edge_index)

# 输出数据对象
print(data)</code></pre> 
<p>运行之后，程序报错缺少模块：</p> 
<blockquote> 
 <p>Traceback (most recent call last):<br>   File "main2.py", line 2, in &lt;module&gt;<br>     from torch_geometric.data import Data<br> ModuleNotFoundError: No module named 'torch_geometric'</p> 
</blockquote> 
<p>我们调用：</p> 
<p>conda install torch_geometric</p> 
<p>找不到，则我们使用pip进行安装</p> 
<p>pip install torch_geometric</p> 
<p><img alt="" height="248" src="https://images2.imgbox.com/88/fc/c96Hi3lE_o.png" width="716"></p> 
<p>也不行。</p> 
<p>我们直接前往torch_gemetric的wiki:<a href="https://pytorch-geometric.readthedocs.io/en/latest/install/installation.html" rel="nofollow" title="Installation — pytorch_geometric documentation (pytorch-geometric.readthedocs.io)">Installation — pytorch_geometric documentation (pytorch-geometric.readthedocs.io)</a></p> 
<p><img alt="" height="788" src="https://images2.imgbox.com/dd/96/YCKBcZdQ_o.png" width="734">我们发现其支持python3.7的版本，所以我们也面临着更新python版本的需求。</p> 
<p>解决冲突（说实话不如重建一个环境）：</p> 
<p><img alt="" height="89" src="https://images2.imgbox.com/e5/86/XNwjDDdO_o.png" width="1114"></p> 
<p>于是我们再根据python版本直接新建环境即可。</p> 
<p>样例一顺利运行</p> 
<p><img alt="" height="74" src="https://images2.imgbox.com/1c/75/hAf8Gdu7_o.png" width="550"></p> 
<p>我们安装pyg库也很顺利。</p> 
<p>我们运行样例2：</p> 
<p><img alt="" height="42" src="https://images2.imgbox.com/5c/1a/RD46qI5E_o.png" width="544"></p> 
<p> 也顺利完成。</p> 
<hr> 
<p> 本地pyCharm配置sftp连接，与线上编译器结合。</p> 
<blockquote> 
 <p>具体可以参考这个资料：</p> 
 <p><a href="https://blog.csdn.net/qq_36667170/article/details/121716527?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522168154458416800211572684%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=168154458416800211572684&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_click~default-1-121716527-null-null.142%5Ev83%5Einsert_down1,239%5Ev2%5Einsert_chatgpt&amp;utm_term=pycharm%20%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5%E6%9C%8D%E5%8A%A1%E5%99%A8&amp;spm=1018.2226.3001.4187" title="PyCharm连接远程服务器详细教程_pycharm连接服务器_Ann's Blog的博客-CSDN博客">PyCharm连接远程服务器详细教程_pycharm连接服务器_Ann's Blog的博客-CSDN博客</a></p> 
</blockquote> 
<hr> 
<p>本地代码运行成功，调试完毕。</p> 
<p><img alt="" height="955" src="https://images2.imgbox.com/48/13/T30D3950_o.png" width="889"></p> 
<p> 我这里不需要将代码上传到服务器，只是用那个解释器和环境，如果有需要利用服务器的各种资源，可以继续配置deployment。</p> 
<p>以后就可以顺利使用统一的环境进行开发部署与调试了</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b7029ee39c79d5bfbbade4a8fa29cd8d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">open3d（python）读取点云</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e7fce00466b1bf64b47c65f36de9d9a9/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">MyBatis-Plus 还手写 Join 联表查询？一个依赖轻松搞定，真香！</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>