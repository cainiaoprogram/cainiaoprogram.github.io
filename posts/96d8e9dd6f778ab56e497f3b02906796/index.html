<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【VPN-GRE|IPSEC学习】 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【VPN-GRE|IPSEC学习】" />
<meta property="og:description" content="VPN学习--GRE|IPSEC 1、GRE-VPN2、 IPSEC-VPN2.1实验1 1、GRE-VPN 一、R1-R2-R3建立OSPF
GRE步骤：
1.建立tunnel隧道
2.添加ip地址
3.配置隧道协议
4.隧道的源地址（公网）
4.隧道的目的地址（公网）
5.配置路由协议让路由从tunnel口出去。
二、Tunnel接双up条件？
1、tunnel口要ip地址
2、Tunnel口配置目的地可达0
R2:
interface Tunnel0/0/1
ip address 192.168.3.2 255.255.255.0
tunnel-protocol gre
source 192.168.12.2
destination 192.168.13.3
ip route-static 192.168.2.0 24 tunnel 0/0/1
R3:
interface Tunnel0/0/1
ip address 192.168.3.2 255.255.255.0
tunnel-protocol gre
source 192.168.13.3
destination 192.168.12.2
Ip route-static 192.168.1.0 24 tunnel 0/0/1
2、 IPSEC-VPN （1）加密算法：
对称加密：加密方和解密方采用同一个秘钥。
非对称加密：加密方通过对端的公钥加密数据；解密坊通过自己的私钥解密数据。
（2）解密算法：
MD5:哈希输入任意长度的消息，产生一个128比特的消息摘要。
SHA
（3）模式
Transport Mode:传输模式，封装时候不会产生新的IP头部
Tunnel Mode：隧道模式，封装的时候产生新的IP头部
（4）SA安全联盟
安全参数索引号SPI：SPI唯一确定SA，一个32bit
手动指定配置、IKE协商产生SA，SPI随机生成。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/96d8e9dd6f778ab56e497f3b02906796/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-16T23:56:58+08:00" />
<meta property="article:modified_time" content="2023-09-16T23:56:58+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【VPN-GRE|IPSEC学习】</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>VPN学习--GRE|IPSEC</h4> 
 <ul><li><a href="#1GREVPN_2" rel="nofollow">1、GRE-VPN</a></li><li><a href="#2_IPSECVPN_32" rel="nofollow">2、 IPSEC-VPN</a></li><li><ul><li><a href="#211_116" rel="nofollow">2.1实验1</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="1GREVPN_2"></a>1、GRE-VPN</h2> 
<p><img src="https://images2.imgbox.com/a8/e1/vW52mMLs_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>一、R1-R2-R3建立OSPF<br> GRE步骤：<br> 1.建立tunnel隧道<br> 2.添加ip地址<br> 3.配置隧道协议<br> 4.隧道的源地址（公网）<br> 4.隧道的目的地址（公网）<br> 5.配置路由协议让路由从tunnel口出去。</p> 
</blockquote> 
<blockquote> 
 <p>二、Tunnel接双up条件？<br> 1、tunnel口要ip地址<br> 2、Tunnel口配置目的地可达0</p> 
</blockquote> 
<blockquote> 
 <p>R2:<br> interface Tunnel0/0/1<br> ip address 192.168.3.2 255.255.255.0<br> tunnel-protocol gre<br> source 192.168.12.2<br> destination 192.168.13.3<br> ip route-static 192.168.2.0 24 tunnel 0/0/1</p> 
</blockquote> 
<blockquote> 
 <p>R3:<br> interface Tunnel0/0/1<br> ip address 192.168.3.2 255.255.255.0<br> tunnel-protocol gre<br> source 192.168.13.3<br> destination 192.168.12.2<br> Ip route-static 192.168.1.0 24 tunnel 0/0/1</p> 
</blockquote> 
<h2><a id="2_IPSECVPN_32"></a>2、 IPSEC-VPN</h2> 
<blockquote> 
 <p>（1）加密算法：<br> 对称加密：加密方和解密方采用同一个秘钥。<br> 非对称加密：加密方通过对端的公钥加密数据；解密坊通过自己的私钥解密数据。</p> 
</blockquote> 
<blockquote> 
 <p>（2）解密算法：<br> MD5:哈希输入任意长度的消息，产生一个128比特的消息摘要。<br> SHA</p> 
</blockquote> 
<blockquote> 
 <p>（3）模式<br> Transport Mode:传输模式，封装时候不会产生新的IP头部<br> Tunnel Mode：隧道模式，封装的时候产生新的IP头部</p> 
</blockquote> 
<blockquote> 
 <p>（4）SA安全联盟<br> 安全参数索引号SPI：SPI唯一确定SA，一个32bit<br> 手动指定配置、IKE协商产生SA，SPI随机生成。<br> 每个阶段建立安全通道。AH(51),ESP(50)</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/5b/e3/5VzxdH0i_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/aa/cb/K40E1MFu_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p><mark>手动/IKE协商(基本上使用后面一种)</mark><br> 手工方式: 安全联盟所需的全部信息都必须手工配置，比较复杂，适合对等体较少或小型静态环境。<br> IKE动态协商方式:只需要对等体间配置好IKE协商参数，由IKE自动协商来创建和维护SA。相对简单，适合中、大型的动态网络环境中。</p> 
</blockquote> 
<blockquote> 
 <p>（5）工作原理<br> IKE协调过程：分为两个阶段<br> 1、第一阶段：建立一个IKE SA（也称为ISAKMP SA），为第二阶段的协调提供保护。<br> IKE SA建立后对等体件的所有ISAKMP消息都被加密，这条安全通道可以保证阶段2的协调能够安全进行<br> （产生秘钥，保证2阶段的安全性）<br> 两种模式:<br> 主模式：6条ISAKMP消息交互<br> 野蛮模式：3条ISAKMP消息交互<br> <mark>主模式6个报文：</mark><br> 第1、2个报文协商：加密算法、认证算法、认证方式、DH等<br> 第3、4个报文交换DH产生密钥—SKEYID基础密钥、–&gt;SKEYID-a–&gt;SKEYID-e–&gt;SKEYID-d,用于推出ipsec报文加密、验证密钥。<br> 第5、6个报文，验证对端合法性。</p> 
</blockquote> 
<blockquote> 
 <p>第二阶段<br> 目的就是建立用来传输数据的IPsecc SA、IPsec SA是为IP数据提供安全保护的快速模式（Quick Mode）<br> 3条ISAKMP消息交互<br> 第1、2个报文协商加密算法、认证算法、封装协议（ESP、ah、）模式（tunnel、transport）等<br> 第3个报文确认</p> 
</blockquote> 
<blockquote> 
 <p>（6）配置步骤<br> 1、网络可达性（公网通、内网通）<br> 2配置感兴趣流<br> 3配置第一阶段<br> 4配置第二阶段<br> 5关联感兴趣流+第一阶段+第二阶段（配置安全策略）<br> 6应用安全策略到接口上</p> 
</blockquote> 
<pre><code class="prism language--">第一阶段配置：
ike protocol 10					//协议名称
Encryption-algorithm 3des-cbc		//加密算法	
Authentication-alogrithm md5		//认证算法
Authentication-method pre-share		//认证方式预共享

Ike peer huawei1 v1						
Pre-shared-key simple huawei		//预共享秘钥
Remote-address 12.1.1.2				//对端公网ip
Dis ike proposal					//查看配置信息

第二阶段配置
Ipsec proposal huawei2				//配置第二阶段建立IPSEC SA	
Transform esp	协商：				//用户数据封装协议（ESP|AH）AH只封装不加密、ESP是既封装又加密
Encapsulation-mode tunnel			//配置数据报文是否需要添加新头部（tunnel添加新头部、transport不加新头部）
Esp encryption-algorithm 3des		//用户加密算法
Esp authentication-algorithm md5	//用户认证算法，用户进行完整性校验

配置感兴趣流+第一阶段+第二阶段
Ipsec policy vpn 1 isakmp
Security acl 3000
Ike-peer huawei1
Proposal huawei2

应用到接口上：
Interface gigabitethernet 0/0/0
Ipsec policy vpn
</code></pre> 
<p><img src="https://images2.imgbox.com/e0/cb/TpeAf5nn_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="211_116"></a>2.1实验1</h3> 
<p><img src="https://images2.imgbox.com/52/bf/tQbXSFkJ_o.png" alt="在这里插入图片描述"><br> 条件：出口能够配置ipsecvpn</p> 
<blockquote> 
 <p>匹配感兴趣流<br> R1:<br> Acl 3000<br> Rule permit ip source 192.168.1.1 0 destination 192.168.2.1 0.0.0.255<br> 分部的人去访问总部的某一台服务器。<br> R3:<br> Acl 3000<br> Rule permit ip source 192.168.2.0 0.0.0.255 destination 192.168.1.1 0</p> 
</blockquote> 
<p><strong>第一阶段：第一阶段保护第二阶段数据报文交互安全。</strong></p> 
<blockquote> 
 <p>R1:<br> ike proposal 10 //优先级越小越优先<br> encryption-algorithm 3des-cbc //加密算法<br> authentication-algorithm md5 //认证算法<br> Authentication-method pre-share //认证方式 ：预共享<br> 下面是第一阶段的域共享<br> Ike peer wyt v1 <br> Pre-shared-key simple 12345 //配置预共享密钥<br> Remote-address 23.1.1.3</p> 
</blockquote> 
<blockquote> 
 <p>R3:<br> ike proposal 10<br> encryption-algorithm 3des-cbc<br> authentication-algorithm md5<br> Authentication-method pre-share<br> 下面是第一阶段的域共享<br> Ike peer wyt v1<br> Pre-shared-key simple 12345<br> Remote-address 12.1.1.1</p> 
</blockquote> 
<p><strong>第二阶段：</strong></p> 
<blockquote> 
 <p>R1<br> Ipsec proposal wyt2<br> Encapsulation-mode tunnel <br> Transform ah 协商：用户数据封装协议（esp|ah）<br> Esp authentication-algorithm md5</p> 
</blockquote> 
<blockquote> 
 <p>R3:<br> Ipsec proposal wyt2<br> Transform ah<br> Encapsulation-mode tunnel<br> Ah authentication-algorithm md5</p> 
</blockquote> 
<p><strong>配置感兴趣流+第一阶段+第二阶段 +应用到端口</strong></p> 
<blockquote> 
 <p>R1：<br> Ipsec policy vpn 1 isakmp<br> Security acl 3000 //关联感兴趣流<br> Ike-peer wyt //关联第一阶段<br> Proposal wyt2 //关联第二阶段<br> Int g0/0/1<br> Ipsec policy vpn</p> 
</blockquote> 
<blockquote> 
 <p>R3：<br> Ipsec policy vpn 1 isakmp<br> Security acl 3000<br> Ike-peer wyt<br> Proposal wyt2 <br> Int g0/0/0<br> Ipsec policy vpn</p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/aa66a1064cf6fd62676b2751d31fbc33/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">obs-studio程序运行中的一些配置信息存储路径和字段解析</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/311860f29852a7caec843ff4a3d54c62/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">demo0917</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>