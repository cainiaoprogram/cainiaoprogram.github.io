<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Quagga简介、安装、配置说明 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Quagga简介、安装、配置说明" />
<meta property="og:description" content="Quagga软件原名是Zebra是由一个日本开发团队编写的一个以GNU版权方式发布的软件。可以使用Quagga将linux机器打造成一台功能完备的路由器。
模块化设计：Quagga基于模块化方案的设计，即对每一个路由协议使用单独的守护进程。
运行速度快：因为使用了模块化的设计，使得Quagga的运行速度比一般的路由选择程序要快。
可靠性高：在所有软件模块都失败的情况下，路由器可以继续保持连接并且daemons也会继续运行。故障诊断不必离线的状态下被诊断和更正
支持Ipv6：Quagga不仅支持Ipv4，还支持Ipv6。
Quagga的运行机制
由于Quagga采用模块化的设计，因此Quagga运行时要运行多个守护进程，包括ripd ripngd ospfd ospf6d bgpd 和Zebra。
其中，Zebra守护进程用来更新内核的路由表，而其他的守护进程负责进行相应路由选择协议的路由更新.
就是ripd，bgpd,ospfd三个路由协议守护进程，把通过动态路由协议学习到路由信息都要交给zebra守护进程，然后zebra进程与 kernel routed交互，把路由信息给kernel 内核根据路由协议守护进程学习到路由内容更新自己路由表。
每个守护程序都有自己的路由表。zebra守护程序维护内核路由表，并且还负责在各种路由协议守护程序之间重新分配信息。
关系如图：
安装：
安装依赖软件包
yum install readline-devel (--enable-vtysh需要) 解压：
tar -zxvf *.tar.gz
cd *
配置，生成Makefile文件
./configure --enable-vtysh --enable-user=root --enable-group=root --localstatedir=/var/run/quagga --sysconfdir=/etc/quagga
1
--enable-vtysh 生成vtysh，vtysh是一个可以直接配置其他Quagga进程的shell。不使用vtysh的话，需要telnet到每个进程中去配置，比较麻烦。
--enable-user=root --enable-group=root 默认运行用户为quagga，这里修改为root，可以不用改变文件夹的属性，也不用单独增加用户。
--localstatedir=/var/run/quagga 运行时的PID文件位置
--sysconfdir=/etc/quagga 运行时的配置文件目录，默认位置在/usr/local/etc中
执行./configure后会显示所有的配置清单，可以核对一下。
Quagga configuration
--------------------
quagga version : 0.99.22.4
host operating system : linux-gnu
source code location : .
compiler : gcc" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/1016a226a1467507f8cd4edc2fdf79b7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-10-12T17:35:59+08:00" />
<meta property="article:modified_time" content="2019-10-12T17:35:59+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Quagga简介、安装、配置说明</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>    Quagga软件原名是Zebra是由一个日本开发团队编写的一个以GNU版权方式发布的软件。可以使用Quagga将linux机器打造成一台功能完备的路由器。</p> 
<p>模块化设计：Quagga基于模块化方案的设计，即对每一个路由协议使用单独的守护进程。<br> 运行速度快：因为使用了模块化的设计，使得Quagga的运行速度比一般的路由选择程序要快。<br> 可靠性高：在所有软件模块都失败的情况下，路由器可以继续保持连接并且daemons也会继续运行。故障诊断不必离线的状态下被诊断和更正<br> 支持Ipv6：Quagga不仅支持Ipv4，还支持Ipv6。</p> 
<p><br> Quagga的运行机制</p> 
<p>由于Quagga采用模块化的设计，因此Quagga运行时要运行多个守护进程，包括ripd ripngd ospfd ospf6d bgpd 和Zebra。<br> 其中，Zebra守护进程用来<strong>更新内核的路由表</strong>，而其他的守护进程负责进行相应路由选择协议的路由更新.<br> 就是ripd，bgpd,ospfd三个路由协议守护进程，把通过动态路由协议学习到路由信息都要交给zebra守护进程，然后zebra进程与        kernel routed交互，把路由信息给kernel  内核根据路由协议守护进程学习到路由内容更新自己路由表。</p> 
<p>每个守护程序都有自己的路由表。zebra守护程序维护内核路由表，并且还负责在各种路由协议守护程序之间重新分配信息。</p> 
<p>关系如图：</p> 
<p> </p> 
<p>                                                      <img alt="" class="has" height="370" src="https://images2.imgbox.com/83/10/AnTsftWy_o.png" width="322"></p> 
<p>安装：</p> 
<p>安装依赖软件包</p> 
<pre class="has"><code>yum install readline-devel   (--enable-vtysh需要) </code></pre> 
<p>解压：</p> 
<p>tar -zxvf  *.tar.gz</p> 
<p>cd *</p> 
<p>配置，生成Makefile文件<br> ./configure --enable-vtysh --enable-user=root --enable-group=root --localstatedir=/var/run/quagga --sysconfdir=/etc/quagga<br> 1<br> --enable-vtysh 生成vtysh，vtysh是一个可以直接配置其他Quagga进程的shell。不使用vtysh的话，需要telnet到每个进程中去配置，比较麻烦。<br> --enable-user=root --enable-group=root 默认运行用户为quagga，这里修改为root，可以不用改变文件夹的属性，也不用单独增加用户。<br> --localstatedir=/var/run/quagga 运行时的PID文件位置<br> --sysconfdir=/etc/quagga 运行时的配置文件目录，默认位置在/usr/local/etc中<br> 执行./configure后会显示所有的配置清单，可以核对一下。</p> 
<p>Quagga configuration<br> --------------------<br> quagga version          : 0.99.22.4<br> host operating system   : linux-gnu<br> source code location    : .<br> compiler                : gcc<br> compiler flags          : -Os -fno-omit-frame-pointer -g -std=gnu99 -Wall -Wsign-compare -Wpointer-arith -Wbad-function-cast -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wchar-subscripts -Wcast-qual<br> make                    : make<br> includes                : <br> linker flags            :  -lcrypt   -lrt   -lm<br> state file directory    : /var/run/quagga<br> config file directory   : /etc/quagga<br> example directory       : /etc/quagga<br> user to run as          : root<br> group to run as         : root<br> group for vty sockets   : <br> config file mask        : 0600<br> log file mask           : 0600<br><br> 默认的优化选项为-Os，如果需要使用gdb调试的，可以使用参数--with-cflags设置编译优化选项为-O0。</p> 
<p>./configure --enable-vtysh --enable-user=root --enable-group=root --localstatedir=/var/run/quagga --sysconfdir=/etc/quagga --with-cflags="-O0 -fno-omit-frame-pointer -g -std=gnu99 -Wall -Wsign-compare -Wpointer-arith -Wbad-function-cast -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wchar-subscripts -Wcast-qual"<br> 1<br> 编译、安装<br> make<br> make install</p> 
<p>在make之后可能会出现如图的错误<br><img alt="" class="has" height="377" src="https://images2.imgbox.com/e2/ec/XbLXb7DX_o.png" width="629"></p> 
<p>解决办法·：yum install texinfo</p> 
<p>make clean</p> 
<p>make</p> 
<p><br><br> 安装好后，可执行文件在目录<strong>/usr/local/sbin/</strong>，配置文件在<strong>/etc/quagga/</strong>。</p> 
<p>创建Quagga相关目录<br> 运行时的PID文件位置</p> 
<p>mkdir /var/run/quagga<br> chmod 777 /var/run/quagga<br> 1<br> 2<br> 注意：Centos 7的/var/run/目录存放在tmpfs中，也就是内存里，重启后run目录会清空。所以每次启动后需要重新创建quagga目录。</p> 
<p>配置文件目录</p> 
<p>mkdir /etc/quagga<br> chmod 777 /etc/quagga<br> 1<br> 2<br> log目录</p> 
<p>mkdir /var/log/quagga/<br> chmod 777 /var/log/quagga/<br> 1<br> 2<br> 编辑配置文件<br> 以zebra为例</p> 
<p>cp /etc/quagga/zebra.conf.sample /etc/quagga/zebra.conf</p> 
<p>如果要运行ripd\bgpd \ospfd的守护进程（启动rip bgp ospf 协议）也要配置编辑配置文件</p> 
<p>cp /etc/quagga/*.conf.sample /etc/quagga/*.conf</p> 
<p> </p> 
<p><br> 1<br> vim /etc/quagga/zebra.conf 进行修改<br> （添加红框中的部分）</p> 
<p><img alt="" class="has" height="519" src="https://images2.imgbox.com/24/30/AEtgqiID_o.png" width="630"></p> 
<p>这个操作就是把zebra守护进程运行内容写到zerbra.log中。</p> 
<p>ripd\bgpd \ospfd守护进程也要添加，意思一样。</p> 
<p>至此，Quagga安装成功。下面仍然以zebra为例简单介绍Quagga单个模块的运行。<br>  </p> 
<p>运行zebra守护进行<br> /usr/local/sbin/zebra -h // 查看命令行选项<br> /usr/local/sbin/zebra -d // 启动zebra后台程序</p> 
<p>运行其他守护进程<br> /usr/local/sbin/(ospfd|bgpd|ripd) -d</p> 
<p>简单的配置使用</p> 
<p>首先 cat /etc/service 可以看到各种协议所对应的接口</p> 
<p><img alt="" class="has" height="286" src="https://images2.imgbox.com/40/f8/UaI6LgU9_o.png" width="351"></p> 
<p>可以看到zebra的端口是为zebre vty ------2601<br>               ospfd                                         2604</p> 
<p>登录zebra的TTY</p> 
<pre class="has"><code>telnet 127.1 2601        // 默认密码：zebra</code></pre> 
<ul><li>登录zebra后就可以使用zebra的命令进行操作。登录其他的守护进程，都是通过它的端口登录的。</li><li>也可以直接执行 <code>vtysh</code> 进行配置。</li><li>如果不能使用telnet，则安装<br> yum install telnet<br> selinux会影响zebra运行，关闭掉<br> /etc/selinux/config文件中，设置为：disabled<br> # This file controls the state of SELinux on the system.<br> # SELINUX= can take one of these three values:<br> #     enforcing - SELinux security policy is enforced.<br> #     permissive - SELinux prints warnings instead of enforcing.<br> #     disabled - No SELinux policy is loaded.<br> #SELINUX=enforcing<br> SELINUX=disabled<br> # SELINUXTYPE= can take one of these two values:<br> #     targeted - Targeted processes are protected,<br> #     mls - Multi Level Security protection.<br> SELINUXTYPE=targeted</li><li> </li><li><br> 如果路由不能转发<br> 修改/etc/sysctl.conf文件， 启用IPv4转发功能。<br> net.ipv4.ip_forward = 1<br> 如果发生了源路由验证的路由问题<br> 修改/etc/sysctl.conf文件， 禁用源路由验证功能。<br> net.ipv4.conf.default.rp_filter = 1</li><li>为了使用quagga里面的守护进程，配置各种协议开始的开始步骤<br> 1.vtysh 或者 telnet 127.0.0.1 *（守护进程端口）<br> 2.enable 将模式从查看模式更改为启用模式 <br> 3.configure terminal   configure 终端 -用于配置路由器 进入全局配置模式<br> 4.协议配置命令</li><li>5 . do write (保存协议配置命令到conf文件中）<br>  </li></ul> 
<p>这是说明一点</p> 
<p>登录vtysh，写配置动态路由协议命令，最后是保存到*.conf文件中 ，所以也可以直接把动态路由协议配置命令直接写到.conf文件中，不用登录vtysh</p> 
<p><img alt="" class="has" height="548" src="https://images2.imgbox.com/52/16/jOs5VwfN_o.png" width="573"></p> 
<p> </p> 
<pre><code class="language-html hljs">show running-config :查看写进路由器*.conf的内容</code></pre> 
<pre><code class="language-html hljs">show ip ospf  database ：该命令用于show出该路由器所学习到的完成的网络拓扑。</code></pre> 
<p>show ip ospf neighbor：查看ospf的邻居</p> 
<p style="margin-left:0px;"><span style="color:#323e32;"><span style="color:#fa1707;">show ip ospf database router X.X.X.X</span></span></p> 
<p style="margin-left:0px;"><span style="color:#323e32;"><span style="color:#fa1707;">由于该命令show出来的是ospf一类(路由器)LSA,所以show出来的内容永远都是路由器所在Area内的信息;</span></span></p> 
<p style="margin-left:0px;"><span style="color:#323e32;"><span style="color:#fa1707;">就算后面的X.X.X.X是一台ABR,show出来的内容同样只是ABR上属于该路由器所在Area内的信息;</span></span></p> 
<p style="margin-left:0px;"><span style="color:#323e32;"><span style="color:#fa1707;"> </span></span></p> 
<p style="margin-left:0px;"><span style="color:#323e32;"><span style="color:#fa1707;">show ip ospf database network X.X.X.X</span></span></p> 
<p style="margin-left:0px;"><span style="color:#323e32;"><span style="color:#fa1707;">该命令show出来的是ospf二类(网络)LSA,所以show出来的内容同样是属于路由器所在区域内的中转网络信息;</span></span></p> 
<p style="margin-left:0px;"><span style="color:#323e32;"><span style="color:#fa1707;">后面所跟的X.X.X.X是指在广播型LAN中担任DR的路由器上属于该LAN网络的子接口的IP地址信息.即中转网络LSID</span></span></p> 
<p style="margin-left:0px;"><span style="color:#323e32;"><span style="color:#fa1707;">例如Router A的Fa0/1与Router B的Fa0/2以及Router C的Fa0/3过LAN相连,Router B被推举成为DR,</span></span></p> 
<p style="margin-left:0px;"><span style="color:#323e32;"><span style="color:#fa1707;">那么此时该Lan虚拟出来的中转网络的LSID就是X.X.X.X就应该是Router B的Fa0/2接口的接口IP地址.</span></span></p> 
<p style="margin-left:0px;"><span style="color:#323e32;"><span style="color:#fa1707;"> </span></span></p> 
<p style="margin-left:0px;"><span style="color:#323e32;"><span style="color:#fa1707;">show ip ospf database summary X.X.X.X</span></span></p> 
<p style="margin-left:0px;"><span style="color:#323e32;"><span style="color:#fa1707;">该命令show出来的是ospf三类(汇总)LSA,所以show出来的内容是属于其他Area泛洪过来的网络信息.</span></span></p> 
<p style="margin-left:0px;"><span style="color:#323e32;"><span style="color:#fa1707;">这里面是不会存在该路由器所在Area的网络信息的.所以ospf正是使用三类LSA来反映非本Area网络拓扑.</span></span></p> 
<p style="margin-left:0px;"><span style="color:#323e32;"> show ip route :会显示哪些是内核学的 哪些是bgp学的 哪些是ospf学的</span></p> 
<p style="margin-left:0px;"><img alt="" class="has" height="207" src="https://images2.imgbox.com/f8/0d/oUavsJmE_o.png" width="563"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fd551e5d76f34ce1d659c456ad088407/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">IIR递归高斯滤波</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b32e2c347bf6162d129ebff068f51372/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">vue3.0全家桶实战过程中配置出现的问题解决记录</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>