<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>OpenStack七大组件解析 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="OpenStack七大组件解析" />
<meta property="og:description" content="b站视频链接：0-尚硅谷-Linux云计算- 虚拟化技术 - 为何需要云计算这种“新事物”_哔哩哔哩_bilibili
视频、课件、资料：
百度网盘链接：https://pan.baidu.com/s/1DQd0LDJND_MC3XvHxB3WKA 提取码：1234 一、Keystone 1.概念 Keystone是一个负责身份管理与授权的组件，给整个openstack的各个组件（nova、cglance...）提供一个统一的验证方式。主要功能：实现用户的身份认证、基于角色的权限管理、openstack其他组件的访问地址和安全策略管理。
两大管理功能：用户管理（3A认证）、服务目录管理
租户（项目）、用户、角色三者需要区分清楚。
一个用户允许有多个租户
一个用户可以绑定到不同的角色（角色代表权限）
一个角色可以绑定到不同的服务
2.组件间的沟通方式 主要过程：第一次user想访问任何组件会先经过Keystone，用户名&#43;密码，如果用户有效且密码正确返回token1，token1对应的含义和权限会进行记录，但是用户必须有相应的租户（项目）才可以访问openstack的组件。如果user不知道当前有哪些租户（通常情况下是不知道的），user拿着token1访问Keystone当前的租户列表（tenant list）有哪些，user才可以在进行下一步访问。
第二次user确定了想访问nova服务，向Keystone提交用户名密码，Keystone放回token2和endpoint（端点），user拿着token2访问对应的endpoint，endpoint并不知道该user有没有权限，endpoint拿着token2提交给Keyston，如果token2认证成功，Keystone直接通知novatoken2是认证成功，你处理一下，nova处理完成后将结果提交给user。
二、Glance镜像服务 1.概念 openstact镜像服务使用户能够发现、注册并检索虚拟机镜像（.img文件），简而言之，就是镜像文件的存储仓库。
镜像URL：&lt;Glance Server Location&gt;/images/&lt;ID&gt; ,一般这三者组成一个全局唯一的URL。如果有两个glance服务，可以更改ID。
镜像的五种状态：
Queued（镜像ID已被保留，镜像还没有上传）
Saving（镜像正在被上传）
Active（镜像已经可以被使用）
Killed（镜像损坏或不可用）
Deleted（镜像已被删除）
2. 组件间工作流程
暴露接口Glance-api， 两种访问方式，一个是通过编程接口，一般上传的是json格式化存储文件，Glance-api下封装Glance-registry和底层，Glance-registry直接连接数据库，并且Glance-registry接口只暴露给Glance-api，不会直接暴露给用户。另外Glance-api可以直接操作底层S3、Object...
三、Nova 1.概念 Iaas的核心组件，也是openstack的核心组件，提供云计算服务、虚拟化服务，Nova本身不支持虚拟化，而是去管理底层的虚拟化（KVM或redhat）。
Nova-api：用于接收请求，请求的发起方可以是用户user通过命令或者程序编程接口或仪表台的套件。
Scheduler：调度服务，如果接收到的是新建虚拟机请求，Scheduler需要选择一个compute去启动一个虚拟机。
Compute Manager：管理虚拟机的启动、关闭、停止，管理虚拟化的整个生命周期。Compute Manager并不直接管理虚拟机，而是通过编写的底层驱动Compute Driver去控制Libvirt（redhat开发的虚拟机管理平台），Libvirt再而控制KVM、Xen等虚拟化平台。
Libvirt支持多种虚拟化监视器（hypervisor）
nova实质上有两种形式，通常由一个Controller和多个Compute计算节点组成，用户通过命令想nova-api发起创建一个虚拟机请求，nova-api向消息队列（queue）编写数据，随后调度Scheduler、nova-network、nova-volumne。调度成功后也向消息队列写数据，最后Compute接收到消息队列的数据开始响应请求。
虚拟机启动流程：如果创建虚拟机没有指定节点，进行权重计算，计算各个节点的剩余资源，Libvirty会自动检测（一般是1分钟）资源并保存在数据库中，nova-Scheduler可以在数据库拿到节点资源，一旦有新的数据写入Compute 节点，会马上更新资源统计并保存在数据库。
三、Netutron 1.概念 Linux环境下网络设备的虚拟化主要有以下几种形式，Neutron也是基于这些技术来完成项目私有虚拟网络network的构建。
(1) TAP/TUN
TAP/TUN是 Linux内核实现的一对虚拟网络设备， TAP工作在二层，TUN工作在三层，Linux内核通过TAP/TUN设备向绑定该设备的用户空间程序发送数据，反之，用户空间程序也可以像操作硬件网络设备那样，通 过 TAP/TUN设备发送数据。
(2) Linux Bridge/VLAN
Linux Bridge (网桥）是工作于二层的虚拟网络设备，功能类似于物理的交换机。
(3) Open vSwitch
Open vSwitch 是一个具有产品级质量的虚拟交换机，它使用C语言进行开发 。可以区分被桥接的物理网卡上流淌的数据包属于哪个VM 、哪 个 OS 及哪个用户。接入到OpenvSwitch上的各个 VM分配到不同的VLAN中实现网络的隔离。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/0b9369344cca127c7adb313b93f5ecd8/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-11-13T17:56:34+08:00" />
<meta property="article:modified_time" content="2022-11-13T17:56:34+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">OpenStack七大组件解析</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>b站视频链接：<a href="https://www.bilibili.com/video/BV1Qf4y1B7Xb?p=1&amp;vd_source=32381e0e0e72876481e65c5f87469e08" rel="nofollow" title="0-尚硅谷-Linux云计算- 虚拟化技术 - 为何需要云计算这种“新事物”_哔哩哔哩_bilibili">0-尚硅谷-Linux云计算- 虚拟化技术 - 为何需要云计算这种“新事物”_哔哩哔哩_bilibili</a></p> 
<p>视频、课件、资料：</p> 
<p>百度网盘链接：https://pan.baidu.com/s/1DQd0LDJND_MC3XvHxB3WKA <br> 提取码：1234 </p> 
<h2>一、Keystone</h2> 
<h3>1.概念</h3> 
<p>Keystone是一个负责身份管理与授权的组件，给整个openstack的各个组件（nova、cglance...）提供一个统一的验证方式。主要功能：实现用户的身份认证、基于角色的权限管理、openstack其他组件的访问地址和安全策略管理。</p> 
<p>两大管理功能：用户管理（3A认证）、服务目录管理</p> 
<p>租户（项目）、用户、角色三者需要区分清楚。</p> 
<p>一个用户允许有多个租户</p> 
<p> 一个用户可以绑定到不同的角色（角色代表权限）</p> 
<p>一个角色可以绑定到不同的服务</p> 
<p><img alt="" height="644" src="https://images2.imgbox.com/e3/99/PbXWoNrC_o.png" width="923"></p> 
<p><img alt="" height="361" src="https://images2.imgbox.com/43/ef/B5yQYPJe_o.png" width="312"></p> 
<h3>2.组件间的沟通方式</h3> 
<p> <img alt="" height="802" src="https://images2.imgbox.com/0d/ec/mBOtW38J_o.png" width="1200"></p> 
<p>主要过程：第一次user想访问任何组件会先经过Keystone，用户名+密码，如果用户有效且密码正确返回token1，token1对应的含义和权限会进行记录，但是用户必须有相应的租户（项目）才可以访问openstack的组件。如果user不知道当前有哪些租户（通常情况下是不知道的），user拿着token1访问Keystone当前的租户列表（tenant list）有哪些，user才可以在进行下一步访问。</p> 
<p>第二次user确定了想访问nova服务，向Keystone提交用户名密码，Keystone放回token2和endpoint（端点），user拿着token2访问对应的endpoint，endpoint并不知道该user有没有权限，endpoint拿着token2提交给Keyston，如果token2认证成功，Keystone直接通知novatoken2是认证成功，你处理一下，nova处理完成后将结果提交给user。</p> 
<p></p> 
<h2>二、Glance镜像服务</h2> 
<h3> 1.概念</h3> 
<p>openstact镜像服务使用户能够发现、注册并检索虚拟机镜像（.img文件），简而言之，就是镜像文件的存储仓库。</p> 
<p>镜像URL：&lt;Glance Server Location&gt;/images/&lt;ID&gt; ,一般这三者组成一个全局唯一的URL。如果有两个glance服务，可以更改ID。</p> 
<p>镜像的五种状态：<br> Queued（镜像ID已被保留，镜像还没有上传）</p> 
<p>Saving（镜像正在被上传）</p> 
<p>Active（镜像已经可以被使用）</p> 
<p>Killed（镜像损坏或不可用）</p> 
<p>Deleted（镜像已被删除）</p> 
<p>2. 组件间工作流程</p> 
<p><img alt="" height="737" src="https://images2.imgbox.com/10/06/hfbca4tR_o.png" width="1200"></p> 
<p>暴露接口Glance-api， 两种访问方式，一个是通过编程接口，一般上传的是json格式化存储文件，Glance-api下封装Glance-registry和底层，Glance-registry直接连接数据库，并且Glance-registry接口只暴露给Glance-api，不会直接暴露给用户。另外Glance-api可以直接操作底层S3、Object...</p> 
<p></p> 
<h2>三、Nova </h2> 
<h3>1.概念</h3> 
<p>Iaas的核心组件，也是openstack的核心组件，提供云计算服务、虚拟化服务，Nova本身不支持虚拟化，而是去管理底层的虚拟化（KVM或redhat）。</p> 
<p>Nova-api：用于接收请求，请求的发起方可以是用户user通过命令或者程序编程接口或仪表台的套件。</p> 
<p>Scheduler：调度服务，如果接收到的是新建虚拟机请求，Scheduler需要选择一个compute去启动一个虚拟机。</p> 
<p>Compute Manager：管理虚拟机的启动、关闭、停止，管理虚拟化的整个生命周期。Compute Manager并不直接管理虚拟机，而是通过编写的底层驱动Compute Driver去控制Libvirt（redhat开发的虚拟机管理平台），Libvirt再而控制KVM、Xen等虚拟化平台。</p> 
<p><img alt="" height="842" src="https://images2.imgbox.com/97/1f/wsBzhKwp_o.png" width="1158"></p> 
<p>Libvirt支持多种虚拟化监视器（hypervisor）</p> 
<p><img alt="" height="378" src="https://images2.imgbox.com/e9/82/cclBH05X_o.png" width="584"></p> 
<p> nova实质上有两种形式，通常由一个Controller和多个Compute计算节点组成，用户通过命令想nova-api发起创建一个虚拟机请求，nova-api向消息队列（queue）编写数据，随后调度Scheduler、nova-network、nova-volumne。调度成功后也向消息队列写数据，最后Compute接收到消息队列的数据开始响应请求。</p> 
<p><img alt="" height="827" src="https://images2.imgbox.com/d9/42/4SyXKKyK_o.png" width="1200"></p> 
<p><strong><span style="color:#fe2c24;"> 虚拟机启动流程</span></strong>：如果创建虚拟机没有指定节点，进行权重计算，计算各个节点的剩余资源，Libvirty会自动检测（一般是1分钟）资源并保存在数据库中，nova-Scheduler可以在数据库拿到节点资源，一旦有新的数据写入Compute 节点，会马上更新资源统计并保存在数据库。</p> 
<p><img alt="" height="844" src="https://images2.imgbox.com/e5/51/KRTT5nqv_o.png" width="1200"></p> 
<p></p> 
<h2> 三、Netutron</h2> 
<h3>1.概念</h3> 
<p>Linux环境下网络设备的虚拟化主要有以下几种形式，Neutron也是基于这些技术来完成项目私有虚拟网络network的构建。<br> (1) TAP/TUN<br> TAP/TUN是 Linux内核实现的一对虚拟网络设备， TAP工作在二层，TUN工作在三层，Linux内核通过TAP/TUN设备向绑定该设备的用户空间程序发送数据，反之，用户空间程序也可以像操作硬件网络设备那样，通 过 TAP/TUN设备发送数据。</p> 
<p>(2) Linux Bridge/VLAN<br> Linux Bridge (网桥）是工作于二层的虚拟网络设备，功能类似于物理的交换机。<br> (3) Open vSwitch<br> Open vSwitch 是一个具有产品级质量的虚拟交换机，它使用C语言进行开发 。可以区分被桥接的物理网卡上流淌的数据包属于哪个VM 、哪 个 OS 及哪个用户。接入到OpenvSwitch上的各个 VM分配到不同的VLAN中实现网络的隔离。<br> 实现了分布式的虚拟交换机（ Distributed Virtual Switch)，一个物理Server上的vSwtch可以透明地与另一Server上的vSwitch连接在一起。</p> 
<p>L3 agent</p> 
<p>l3 agent可以为project（租户）创建router，提供Neutron subnet之间的路由服务。路由功能默认通过 IPtables 实现。</p> 
<p>neutron agent服务：</p> 
<p>(1)plug-in agent(neutron-*-agent)</p> 
<p>插件代理，需要部署在每一个运行hypervisor的主机上，它提供本地的vSwitch配置，更多的时候得依赖你具体所使用的插件类型。（常用的插件是OpenvSwitch，还包括Big Switch，Floodinght REST Proxy，Brocade， NSX， PLUMgrid， Ryu）</p> 
<p>(2)dhcp agent(neutron-dhcp-agent)</p> 
<p>DHCP代理，给租户网络提供动态主机配置服务，主要用途是为租户网络内的虚拟机动态地分配IP地址。</p> 
<p>(3)l3 agent(neutron-l3-agent)</p> 
<p>L3代理，提供三层网络功能和网络地址转换(NAT)功能，来让租户的虚拟机可以与外部网络通信。</p> 
<p>(4)metering agent(neutron-metering-agent)</p> 
<p>计量代理，为租户网络提供三层网络流量数据计量服务。</p> 
<p>Network---&gt;Vlan</p> 
<p>Subnet---&gt;一段地址段（比Network的范围更小）</p> 
<p>Router---&gt;三层路由</p> 
<p>Port---&gt;虚拟交换机的端口号</p> 
<p>Vif---&gt;主机</p> 
<p><img alt="" height="779" src="https://images2.imgbox.com/10/fa/mHXknJU1_o.png" width="1200"></p> 
<p>流程：</p> 
<p><img alt="" height="844" src="https://images2.imgbox.com/aa/09/KU6ykPOs_o.png" width="1200"> </p> 
<p> 主要组件功能：</p> 
<p><img alt="" height="810" src="https://images2.imgbox.com/98/45/RxkHyJkw_o.png" width="1200"></p> 
<p> ML2 Plugin功能实现以及对应协议：</p> 
<p><img alt="" height="719" src="https://images2.imgbox.com/46/d4/WDANMvqp_o.png" width="1200"></p> 
<p> 拓网络扑</p> 
<p>不同组件上运行的服务是不同的！每台Nova节点都会有ML2-agent代理端，管理端则在Neutron节点上Neutron ML2 plugin。</p> 
<p><img alt="" height="881" src="https://images2.imgbox.com/71/2f/QexUyGHg_o.png" width="1200"></p> 
<p><strong><span style="color:#0d0016;">Per-tenant Routers with Private Network </span></strong></p> 
<p>这是一种最具意义的网络构建方式，不同的租户有各自的路由器，同一个租户可以拥有不同的网段，租户间的通信使用各自的路由器通过浮动网络进行通信，浮动网络后就是物理路由器了，通过物理路由器就可以与外网通信了。</p> 
<p><span style="color:#fe2c24;"><strong>绿色租户，蓝色vlan，每个租户一个路由，一个路由多个vlan。</strong></span></p> 
<p><img alt="" height="434" src="https://images2.imgbox.com/68/ef/2qisX8yR_o.png" width="627"></p> 
<p> </p> 
<h2> 五、Horizon仪表盘套件</h2> 
<p>Horizon安装前必须安装Compute、Keystone组件，必须安装Python2.6或2.7，并支持Django。</p> 
<p>演示：</p> 
<p><img alt="" height="780" src="https://images2.imgbox.com/bb/c7/5OzMrxZH_o.png" width="1200"></p> 
<p> </p> 
<h2>六、 Cinder块存储</h2> 
<p>controller节点运行The Block Storage API服务和Schedule服务，The volume service运行在一个或多个存储节点，存储节点可以是本地磁盘、SAN、NAS等设备，为云主机提供卷存储。</p> 
<p>cinder-api：允许API请求，并路由他们到cinder-volume。</p> 
<p>cinder-volume：直接与块存储服务通信，支持多种存储类型。</p> 
<p>cinder-scheduler daemon：类似于nova-scheduler组件，用于计算节点资源，选择最优的存储节点创建卷。</p> 
<p></p> 
<h3>swift和cinder的区别</h3> 
<p> swift类似于网盘，而cinder类似于移动硬盘，随意格式化，随意存取。swift对象存储通常存储一些不会修改的数据，比如用于存储 VM 镜像、备份和归档以及较小的文件，例如照片和电子邮件消息。更倾向于系统的管理。</p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/080dc9abe0d603085892de134a9410f1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Linux系统后门监测工具chkrootkit安装与使用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fbd396e32c9ff6642538df87c6d72c57/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">[Python]实现短信验证码的发送</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>