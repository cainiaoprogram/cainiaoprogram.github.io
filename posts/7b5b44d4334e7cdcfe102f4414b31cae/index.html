<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>MongoDB分组 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="MongoDB分组" />
<meta property="og:description" content="MongoDB三种分组方式 group(先筛选再分组，不支持分片，对数据量有所限制，效率不高) 【简单分组实测150W 12.5s】mapreduce(基于js引擎，单线程执行，效率较低，适合用做后台统计等) 【简单分组实测150W 28.5s】aggregate(推荐) (性能要高很多，并且使用上要简单些) 【简单分组实测150W 2.6s】 group db.ad_play_log.group({ // https://docs.mongodb.org/manual/reference/method/db.collection.group/ // https://docs.mongodb.org/manual/reference/command/group/#dbcmd.group key: { // 分组的字段 ad_position_id: 1 }, cond: { // WHERE条件 ord_dt: { $gt: new Date(&#39;01/01/2012&#39;) } }, reduce: function (curr, result) { result.count&#43;&#43;; }, initial: { count: 0 }});// SELECT ad_play_log, SUM(material_id) as total// FROM orders// WHERE ord_dt &gt; &#39;01/01/2012&#39;// GROUP BY ad_position_id MapReduce db.runCommand({ mapreduce: &#34;ad_play_log&#34;, map: function Map() { var key = { ad_position_id: this." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/7b5b44d4334e7cdcfe102f4414b31cae/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2016-09-11T15:50:19+08:00" />
<meta property="article:modified_time" content="2016-09-11T15:50:19+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">MongoDB分组</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="font-family:微软雅黑; font-size:14px; line-height:21px"> 
 <span style="background-color:inherit"></span> 
</div> 
<div style="background-color: inherit;"> 
 <span style="background-color: inherit;"><span style="font-size: 16px; background-color: inherit;"><span style="color:#00b050;background-color: inherit;"><span style="font-size: 18px; background-color: inherit;"></span></span></span></span> 
</div> 
<div style="background-color: inherit;"> 
 <span style="background-color: inherit;"><span style="font-size: 16px; background-color: inherit;"><span style="color:#00b050;background-color: inherit;"><span style="font-size: 18px; background-color: inherit;"></span></span></span></span> 
</div> 
<div style="background-color: inherit;"> 
 <div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"> 
  <span style="background-color: inherit;"><span style="font-size: 16px; background-color: inherit;"><span style="color:#00b050;background-color: inherit;"><span style="font-size: 18px; background-color: inherit;">MongoDB三种分组方式</span></span></span></span> 
 </div> 
 <div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"> 
  <span style="line-height: 1.5; background-color: inherit;"><br style="background-color: inherit;"></span> 
 </div> 
 <div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"> 
  <ol style="margin-top: 0px; margin-bottom: 0px; background-color: inherit;"><li style="background-color: inherit;"><span style="line-height: 1.5; background-color: inherit;">group(先筛选再分组，不支持分片，对数据量有所限制，效率不高) </span><span style="line-height: 1.5;">【简单分组实测150W 12.5s】</span></li><li style="background-color: inherit;"><span style="line-height: 1.5; background-color: inherit;">mapreduce(基于js引擎，单线程执行，效率较低，适合用做后台统计等) </span><span style="line-height: 1.5;">【简单分组实测150W 28.5s】</span></li><li style="background-color: inherit;"><span style="line-height: 1.5; background-color: inherit;">aggregate(推荐) (性能要高很多，并且使用上要简单些) 【</span><span style="line-height: 1.5;">简单分组</span><span style="line-height: 1.5; background-color: inherit;">实测150W 2.6s】</span></li></ol> 
  <div style="background-color: inherit;"> 
   <br style="background-color: inherit;"> 
  </div> 
 </div> 
 <div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"> 
  <span style="font-size: 18px; background-color: inherit;"><span style="color:#00b050;background-color: inherit;"><span style="background-color: inherit;">group</span></span></span> 
 </div> 
 <div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"> 
  <pre style="font-family: Consolas; color: rgb(169, 183, 198); font-size: 12pt; background-color: rgb(43, 43, 43);">db.ad_play_log.<span style="color: rgb(255, 198, 109); background-color: inherit;">group</span>({<!-- --><br style="background-color: inherit;"><span style="color: rgb(128, 128, 128); background-color: inherit;">    // https://docs.mongodb.org/manual/reference/method/db.collection.group/<br style="background-color: inherit;"></span><span style="color: rgb(128, 128, 128); background-color: inherit;">    // https://docs.mongodb.org/manual/reference/command/group/#dbcmd.group<br style="background-color: inherit;"></span><span style="color: rgb(128, 128, 128); background-color: inherit;"></span><span style="color: rgb(152, 118, 170); background-color: inherit;">    key</span>: {<!-- --><br style="background-color: inherit;"><span style="color: rgb(128, 128, 128); background-color: inherit;">        // </span><span style="color: rgb(128, 128, 128); font-family: 宋体; background-color: inherit;">分组的字段<br style="background-color: inherit;"></span><span style="color: rgb(128, 128, 128); font-family: 宋体; background-color: inherit;"></span><span style="color: rgb(152, 118, 170); background-color: inherit;">        ad_position_id</span>: <span style="color: rgb(104, 151, 187); background-color: inherit;">1<br style="background-color: inherit;"></span><span style="color: rgb(104, 151, 187); background-color: inherit;"></span>    }<span style="color: rgb(204, 120, 50); background-color: inherit;">,<br style="background-color: inherit;"></span><span style="color: rgb(204, 120, 50); background-color: inherit;"></span><span style="color: rgb(152, 118, 170); background-color: inherit;">    cond</span>: {<!-- --><br style="background-color: inherit;"><span style="color: rgb(128, 128, 128); background-color: inherit;">        // WHERE</span><span style="color: rgb(128, 128, 128); font-family: 宋体; background-color: inherit;">条件<br style="background-color: inherit;"></span><span style="color: rgb(128, 128, 128); font-family: 宋体; background-color: inherit;"></span><span style="color: rgb(152, 118, 170); background-color: inherit;">        ord_dt</span>: {<!-- --><br style="background-color: inherit;"><span style="color: rgb(152, 118, 170); background-color: inherit;">            $gt</span>: <span style="color: rgb(204, 120, 50);  background-color: inherit;"><strong>new </strong></span>Date(<span style="color: rgb(106, 135, 89); background-color: inherit;">'01/01/2012'</span>)<br style="background-color: inherit;">        }<br style="background-color: inherit;">    }<span style="color: rgb(204, 120, 50); background-color: inherit;">,<br style="background-color: inherit;"></span><span style="color: rgb(204, 120, 50); background-color: inherit;"></span><span style="color: rgb(255, 198, 109); background-color: inherit;">    reduce</span>: <span style="color: rgb(204, 120, 50);  background-color: inherit;"><strong>function </strong></span>(curr<span style="color: rgb(204, 120, 50); background-color: inherit;">, </span>result) {<!-- --><br style="background-color: inherit;">        result.<span style="color: rgb(152, 118, 170); background-color: inherit;">count</span>++<span style="color: rgb(204, 120, 50); background-color: inherit;">;<br style="background-color: inherit;"></span><span style="color: rgb(204, 120, 50); background-color: inherit;"></span>    }<span style="color: rgb(204, 120, 50); background-color: inherit;">,<br style="background-color: inherit;"></span><span style="color: rgb(204, 120, 50); background-color: inherit;"></span><span style="color: rgb(152, 118, 170); background-color: inherit;">    initial</span>: {<!-- --><br style="background-color: inherit;"><span style="color: rgb(152, 118, 170); background-color: inherit;">        count</span>: <span style="color: rgb(104, 151, 187); background-color: inherit;">0<br style="background-color: inherit;"></span><span style="color: rgb(104, 151, 187); background-color: inherit;"></span>    }<br style="background-color: inherit;">})<span style="color: rgb(204, 120, 50); background-color: inherit;">;<br style="background-color: inherit;"></span><span style="color: rgb(204, 120, 50); background-color: inherit;"><br style="background-color: inherit;"></span><span style="color: rgb(128, 128, 128); background-color: inherit;">// SELECT ad_play_log, SUM(material_id) as total<br style="background-color: inherit;"></span><span style="color: rgb(128, 128, 128); background-color: inherit;">// FROM orders<br style="background-color: inherit;"></span><span style="color: rgb(128, 128, 128); background-color: inherit;">// WHERE ord_dt &gt; '01/01/2012'<br style="background-color: inherit;"></span><span style="color: rgb(128, 128, 128); background-color: inherit;">// GROUP BY ad_position_id<br style="background-color: inherit;"></span><span style="color: rgb(128, 128, 128); background-color: inherit;"><br style="background-color: inherit;"></span></pre> 
  <div style="background-color: inherit;"> 
   <br style="background-color: inherit;"> 
  </div> 
  <span style="background-color: inherit;"><span style="font-size: 18px; background-color: inherit;"><span style="color:#00b050;background-color: inherit;">MapReduce</span></span></span> 
 </div> 
 <div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"> 
  <pre style="font-family: Monaco, Consolas, Courier, 'Lucida Console', monospace; color: rgb(169, 183, 198); font-size: 12pt; background-color: rgb(43, 43, 43);"><span style="font-family:Consolas;background-color: inherit;">db.runCommand({<!-- --><br style="background-color: inherit;"></span><span style="font-family: Consolas; color: rgb(152, 118, 170); background-color: inherit;">    mapreduce</span><span style="font-family:Consolas;background-color: inherit;">: </span><span style="font-family: Consolas; color: rgb(106, 135, 89); background-color: inherit;">"ad_play_log"</span><span style="font-family: Consolas; color: rgb(204, 120, 50); background-color: inherit;">,<br style="background-color: inherit;"></span><span style="font-family: Consolas; color: rgb(204, 120, 50); background-color: inherit;"></span><span style="font-family: Consolas; color: rgb(255, 198, 109); background-color: inherit;">    map</span><span style="font-family:Consolas;background-color: inherit;">: </span><span style="font-family: Consolas; color: rgb(204, 120, 50);  background-color: inherit;"><strong>function </strong></span><span style="font-family: Consolas; color: rgb(255, 198, 109); background-color: inherit;">Map</span><span style="font-family:Consolas;background-color: inherit;">() {<!-- --><br style="background-color: inherit;"></span><span style="font-family: Consolas; color: rgb(204, 120, 50);  background-color: inherit;"><strong>        var </strong></span><span style="font-family:Consolas;background-color: inherit;">key = {<!-- --><br style="background-color: inherit;"></span><span style="font-family: Consolas; color: rgb(152, 118, 170); background-color: inherit;">            ad_position_id</span><span style="font-family:Consolas;background-color: inherit;">: </span><span style="font-family: Consolas; color: rgb(204, 120, 50);  background-color: inherit;"><strong>this</strong></span><span style="font-family:Consolas;background-color: inherit;">.</span><span style="font-family: Consolas; color: rgb(152, 118, 170); background-color: inherit;">ad_position_id<br style="background-color: inherit;"></span><span style="font-family: Consolas; color: rgb(152, 118, 170); background-color: inherit;"></span><span style="font-family:Consolas;background-color: inherit;">        }</span><span style="font-family: Consolas; color: rgb(204, 120, 50); background-color: inherit;">;<br style="background-color: inherit;"></span><span style="font-family: Consolas; color: rgb(204, 120, 50); background-color: inherit;"></span><span style="font-family: Consolas; color: rgb(204, 120, 50);  background-color: inherit;"><strong>        var </strong></span><span style="font-family:Consolas;background-color: inherit;">value = {<!-- --><br style="background-color: inherit;"></span><span style="font-family: Consolas; color: rgb(152, 118, 170); background-color: inherit;">            count</span><span style="font-family:Consolas;background-color: inherit;">: </span><span style="font-family: Consolas; color: rgb(104, 151, 187); background-color: inherit;">1<br style="background-color: inherit;"></span><span style="font-family: Consolas; color: rgb(104, 151, 187); background-color: inherit;"></span><span style="font-family:Consolas;background-color: inherit;">        }</span><span style="font-family: Consolas; color: rgb(204, 120, 50); background-color: inherit;">;<br style="background-color: inherit;"></span><span style="font-family: Consolas; color: rgb(204, 120, 50); background-color: inherit;"><br style="background-color: inherit;"></span><span style="font-family: Consolas; color: rgb(204, 120, 50); background-color: inherit;"></span><span style="font-family: Consolas; color: rgb(98, 151, 85);  background-color: inherit;"><em>        /**<br style="background-color: inherit;"></em></span><span style="font-family: Consolas; color: rgb(98, 151, 85);  background-color: inherit;"><em>         * key value </em></span><span style="font-family: 宋体; color: rgb(98, 151, 85);  background-color: inherit;"><em>传给</em></span><span style="font-family: Consolas; color: rgb(98, 151, 85);  background-color: inherit;"><em>reduce</em></span><span style="font-family: 宋体; color: rgb(98, 151, 85);  background-color: inherit;"><em>函数处理<br style="background-color: inherit;"></em></span><span style="color: rgb(98, 151, 85);  background-color: inherit;"><em><span style="font-family:宋体;background-color: inherit;"></span><span style="font-family:Consolas;background-color: inherit;">         * </span></em></span><span style="font-family: Consolas; color: rgb(98, 151, 85);   background-color: inherit;"><strong><em>@param </em></strong></span><span style="font-family: Consolas; color: rgb(98, 151, 85);  background-color: inherit;"><em>key<br style="background-color: inherit;"></em></span><span style="font-family: Consolas; color: rgb(98, 151, 85);  background-color: inherit;"><em>         * </em></span><span style="font-family: Consolas; color: rgb(98, 151, 85);   background-color: inherit;"><strong><em>@param </em></strong></span><span style="font-family: Consolas; color: rgb(98, 151, 85);  background-color: inherit;"><em>value<br style="background-color: inherit;"></em></span><span style="font-family: Consolas; color: rgb(98, 151, 85);  background-color: inherit;"><em>         */<br style="background-color: inherit;"></em></span><span style="font-family: Consolas; color: rgb(98, 151, 85);  background-color: inherit;"><em></em></span><span style="font-family:Consolas;background-color: inherit;">        emit(key</span><span style="font-family: Consolas; color: rgb(204, 120, 50); background-color: inherit;">, </span><span style="font-family:Consolas;background-color: inherit;">value)</span><span style="font-family: Consolas; color: rgb(204, 120, 50); background-color: inherit;">;<br style="background-color: inherit;"></span><span style="font-family: Consolas; color: rgb(204, 120, 50); background-color: inherit;"></span><span style="font-family:Consolas;background-color: inherit;">    }</span><span style="font-family: Consolas; color: rgb(204, 120, 50); background-color: inherit;">,<br style="background-color: inherit;"></span><span style="font-family: Consolas; color: rgb(204, 120, 50); background-color: inherit;"></span><span style="font-family: Consolas; color: rgb(255, 198, 109); background-color: inherit;">    reduce</span><span style="font-family:Consolas;background-color: inherit;">: </span><span style="font-family: Consolas; color: rgb(204, 120, 50);  background-color: inherit;"><strong>function </strong></span><span style="font-family: Consolas; color: rgb(255, 198, 109); background-color: inherit;">Reduce</span><span style="font-family:Consolas;background-color: inherit;">(key</span><span style="font-family: Consolas; color: rgb(204, 120, 50); background-color: inherit;">, </span><span style="font-family:Consolas;background-color: inherit;">values) {<!-- --><br style="background-color: inherit;"></span><span style="font-family: Consolas; color: rgb(204, 120, 50);  background-color: inherit;"><strong>        var </strong></span><span style="font-family:Consolas;background-color: inherit;">ret = {<!-- --><br style="background-color: inherit;"></span><span style="font-family: Consolas; color: rgb(152, 118, 170); background-color: inherit;">            count</span><span style="font-family:Consolas;background-color: inherit;">: </span><span style="font-family: Consolas; color: rgb(104, 151, 187); background-color: inherit;">0<br style="background-color: inherit;"></span><span style="font-family: Consolas; color: rgb(104, 151, 187); background-color: inherit;"></span><span style="font-family:Consolas;background-color: inherit;">        }</span><span style="font-family: Consolas; color: rgb(204, 120, 50); background-color: inherit;">;<br style="background-color: inherit;"></span><span style="font-family: Consolas; color: rgb(204, 120, 50); background-color: inherit;"></span><span style="font-family: Consolas; color: rgb(204, 120, 50);  background-color: inherit;"><strong>        for </strong></span><span style="font-family:Consolas;background-color: inherit;">(</span><span style="font-family: Consolas; color: rgb(204, 120, 50);  background-color: inherit;"><strong>var </strong></span><span style="font-family:Consolas;background-color: inherit;">i </span><span style="font-family: Consolas; color: rgb(204, 120, 50);  background-color: inherit;"><strong>in </strong></span><span style="font-family:Consolas;background-color: inherit;">values) {<!-- --><br style="background-color: inherit;">            ret.</span><span style="font-family: Consolas; color: rgb(152, 118, 170); background-color: inherit;">count </span><span style="font-family:Consolas;background-color: inherit;">+= </span><span style="font-family: Consolas; color: rgb(104, 151, 187); background-color: inherit;">1</span><span style="font-family: Consolas; color: rgb(204, 120, 50); background-color: inherit;">;<br style="background-color: inherit;"></span><span style="font-family: Consolas; color: rgb(204, 120, 50); background-color: inherit;"></span><span style="font-family:Consolas;background-color: inherit;">        }<br style="background-color: inherit;"></span><span style="font-family: Consolas; color: rgb(204, 120, 50);  background-color: inherit;"><strong>        return </strong></span><span style="font-family:Consolas;background-color: inherit;">ret</span><span style="font-family: Consolas; color: rgb(204, 120, 50); background-color: inherit;">;<br style="background-color: inherit;"></span><span style="font-family: Consolas; color: rgb(204, 120, 50); background-color: inherit;"></span><span style="font-family:Consolas;background-color: inherit;">    }</span><span style="font-family: Consolas; color: rgb(204, 120, 50); background-color: inherit;">,<br style="background-color: inherit;"></span><span style="font-family: Consolas; color: rgb(204, 120, 50); background-color: inherit;"></span><span style="font-family: Consolas; color: rgb(152, 118, 170); background-color: inherit;">    out</span><span style="font-family:Consolas;background-color: inherit;">: {<!-- --><br style="background-color: inherit;"></span><span style="font-family: Consolas; color: rgb(152, 118, 170); background-color: inherit;">        inline</span><span style="font-family:Consolas;background-color: inherit;">: </span><span style="font-family: Consolas; color: rgb(104, 151, 187); background-color: inherit;">1<br style="background-color: inherit;"></span><span style="font-family: Consolas; color: rgb(104, 151, 187); background-color: inherit;"></span><span style="font-family:Consolas;background-color: inherit;">    }<br style="background-color: inherit;">})</span><span style="font-family: Consolas; color: rgb(204, 120, 50); background-color: inherit;">;<br style="background-color: inherit;"></span></pre> 
  <div style="background-color: inherit;"> 
   <div> 
    <span style="background-color: inherit;">Mongodb官网对MapReduce介绍：</span> 
   </div> 
   <div>
             Map/reduce in MongoDB is useful for batch processing of data and aggregation operations. It is similar in spirit to using something like Hadoop with all input coming from a collection and output going to a collection. Often, in a situation where you would have used GROUP BY in SQL, map/reduce is the right tool in MongoDB. 
   </div> 
   <div> 
    <br style="background-color: inherit;"> 
   </div> 
   <div>
             大致意思是：Mongodb中的Map/reduce主要是用来对数据进行批量处理和聚合操作，有点类似于使用Hadoop对集合数据进行处理，所有输入数据都是从集合中获取，而MapReduce后输出的数据也都会写入到集合中。通常类似于我们在SQL中使用Group By语句一样。 
   </div> 
   <div>
       
   </div> 
   <div>
             使用MapReduce要实现两个函数：Map和Reduce。Map函数调用emit(key,value)遍历集合中所有的记录，将key与value传给Reduce函数进行处理。Map函数和Reduce函数是使用Javascript编写的，并可以通过db.runCommand或mapreduce命令来执行MapReduce操作。 
   </div> 
   <br style="background-color: inherit;"> 
   <span style="line-height: 1.5; background-color: inherit;"><span style="font-size: 18px; background-color: inherit;"><span style="color:#00b050;background-color: inherit;">Aggregate</span></span></span> 
  </div> 
 </div> 
 <div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"> 
  <span style="line-height: 1.5; background-color: inherit;"></span> 
  <pre style="font-family: Consolas; color: rgb(169, 183, 198); font-size: 12pt; background-color: rgb(43, 43, 43);">db.ad_play_log.aggregate(<br style="background-color: inherit;">    {<!-- --><br style="background-color: inherit;"><span style="color: rgb(128, 128, 128); background-color: inherit;">        //https://docs.mongodb.org/manual/reference/method/db.collection.aggregate/<br style="background-color: inherit;"></span><span style="color: rgb(128, 128, 128); background-color: inherit;">        // </span><span style="color: rgb(128, 128, 128); font-family: 宋体; background-color: inherit;">分组<br style="background-color: inherit;"></span><span style="color: rgb(128, 128, 128); font-family: 宋体; background-color: inherit;"></span><span style="color: rgb(152, 118, 170); background-color: inherit;">        $group</span>: {<!-- --><br style="background-color: inherit;"><span style="color: rgb(128, 128, 128); background-color: inherit;">            // </span><span style="color: rgb(128, 128, 128); font-family: 宋体; background-color: inherit;">根据</span><span style="color: rgb(128, 128, 128); background-color: inherit;">ad_position_id</span><span style="color: rgb(128, 128, 128); font-family: 宋体; background-color: inherit;">分组<br style="background-color: inherit;"></span><span style="color: rgb(128, 128, 128); font-family: 宋体; background-color: inherit;"></span><span style="color: rgb(152, 118, 170); background-color: inherit;">            _id</span>: <span style="color: rgb(106, 135, 89); background-color: inherit;">"$ad_position_id"</span><span style="color: rgb(204, 120, 50); background-color: inherit;">,<br style="background-color: inherit;"></span><span style="color: rgb(204, 120, 50); background-color: inherit;"></span><span style="color: rgb(152, 118, 170); background-color: inherit;">            count</span>: {<!-- --><br style="background-color: inherit;"><span style="color: rgb(128, 128, 128); background-color: inherit;">                // </span><span style="color: rgb(128, 128, 128); font-family: 宋体; background-color: inherit;">统计个数</span><span style="color: rgb(128, 128, 128); background-color: inherit;">count<br style="background-color: inherit;"></span><span style="color: rgb(128, 128, 128); background-color: inherit;"></span><span style="color: rgb(152, 118, 170); background-color: inherit;">                $sum</span>: <span style="color: rgb(104, 151, 187); background-color: inherit;">1<br style="background-color: inherit;"></span><span style="color: rgb(104, 151, 187); background-color: inherit;"></span>            }<span style="color: rgb(204, 120, 50); background-color: inherit;">,<br style="background-color: inherit;"></span><span style="color: rgb(204, 120, 50); background-color: inherit;"></span><span style="color: rgb(152, 118, 170); background-color: inherit;">            total</span>: {<!-- --><br style="background-color: inherit;"><span style="color: rgb(128, 128, 128); background-color: inherit;">                // </span><span style="color: rgb(128, 128, 128); font-family: 宋体; background-color: inherit;">对</span><span style="color: rgb(128, 128, 128); background-color: inherit;">material_id</span><span style="color: rgb(128, 128, 128); font-family: 宋体; background-color: inherit;">相加<br style="background-color: inherit;"></span><span style="color: rgb(128, 128, 128); font-family: 宋体; background-color: inherit;"></span><span style="color: rgb(152, 118, 170); background-color: inherit;">                $sum</span>: <span style="color: rgb(106, 135, 89); background-color: inherit;">"$material_id"<br style="background-color: inherit;"></span><span style="color: rgb(106, 135, 89); background-color: inherit;"></span>            }<br style="background-color: inherit;">        }<br style="background-color: inherit;">    }<span style="color: rgb(204, 120, 50); background-color: inherit;">,<br style="background-color: inherit;"></span><span style="color: rgb(204, 120, 50); background-color: inherit;"></span>    {<!-- --><br style="background-color: inherit;"><span style="color: rgb(152, 118, 170); background-color: inherit;">        $sort</span>: {<!-- --><br style="background-color: inherit;"><span style="color: rgb(128, 128, 128); background-color: inherit;">            // </span><span style="color: rgb(128, 128, 128); font-family: 宋体; background-color: inherit;">根据</span><span style="color: rgb(128, 128, 128); background-color: inherit;">ad_position_id</span><span style="color: rgb(128, 128, 128); font-family: 宋体; background-color: inherit;">排序</span><span style="color: rgb(128, 128, 128); background-color: inherit;">,-1</span><span style="color: rgb(128, 128, 128); font-family: 宋体; background-color: inherit;">表示降序<br style="background-color: inherit;"></span><span style="color: rgb(128, 128, 128); font-family: 宋体; background-color: inherit;"></span><span style="color: rgb(152, 118, 170); background-color: inherit;">            _id</span>: -<span style="color: rgb(104, 151, 187); background-color: inherit;">1<br style="background-color: inherit;"></span><span style="color: rgb(104, 151, 187); background-color: inherit;"></span>        }<br style="background-color: inherit;">    }<span style="color: rgb(204, 120, 50); background-color: inherit;">,<br style="background-color: inherit;"></span><span style="color: rgb(204, 120, 50); background-color: inherit;"></span>    {<!-- --><br style="background-color: inherit;"><span style="color: rgb(128, 128, 128); background-color: inherit;">        // </span><span style="color: rgb(128, 128, 128); font-family: 宋体; background-color: inherit;">限制条数</span><span style="color: rgb(128, 128, 128); background-color: inherit;">,</span><span style="color: rgb(128, 128, 128); font-family: 宋体; background-color: inherit;">可选<br style="background-color: inherit;"></span><span style="color: rgb(128, 128, 128); font-family: 宋体; background-color: inherit;"></span><span style="color: rgb(152, 118, 170); background-color: inherit;">        $limit</span>: <span style="color: rgb(104, 151, 187); background-color: inherit;">10<br style="background-color: inherit;"></span><span style="color: rgb(104, 151, 187); background-color: inherit;"></span>    }<span style="color: rgb(204, 120, 50); background-color: inherit;">,<br style="background-color: inherit;"></span><span style="color: rgb(204, 120, 50); background-color: inherit;"></span>    {<!-- --><br style="background-color: inherit;"><span style="color: rgb(128, 128, 128); background-color: inherit;">        // </span><span style="color: rgb(128, 128, 128); font-family: 宋体; background-color: inherit;">匹配条件</span><span style="color: rgb(128, 128, 128); background-color: inherit;">,</span><span style="color: rgb(128, 128, 128); font-family: 宋体; background-color: inherit;">可选</span><span style="color: rgb(128, 128, 128); background-color: inherit;">,放在$group前面就是先匹配在分组,</span><span style="color: rgb(128, 128, 128); font-family: 宋体; background-color: inherit;">等于</span><span style="color: rgb(128, 128, 128); background-color: inherit;">613</span><span style="color: rgb(128, 128, 128); font-family: 宋体; background-color: inherit;">和小于</span><span style="color: rgb(128, 128, 128); background-color: inherit;">700<br style="background-color: inherit;"></span><span style="color: rgb(128, 128, 128); background-color: inherit;"></span><span style="color: rgb(152, 118, 170); background-color: inherit;">        $match</span>: {<!-- --><span style="color: rgb(152, 118, 170); background-color: inherit;">_id</span>: <span style="color: rgb(104, 151, 187); background-color: inherit;">613</span><span style="color: rgb(204, 120, 50); background-color: inherit;">, </span><span style="color: rgb(152, 118, 170); background-color: inherit;">count</span>: {<!-- --><span style="color: rgb(152, 118, 170); background-color: inherit;">$lt</span>: <span style="color: rgb(104, 151, 187); background-color: inherit;">700</span>}}<br style="background-color: inherit;">    }<br style="background-color: inherit;"><span style="color: rgb(128, 128, 128); background-color: inherit;">// == SELECT ad_position_id,count(1) AS count FROM ad_play_log GROUP BY ad_position_id<br style="background-color: inherit;"></span>)<span style="color: rgb(204, 120, 50); background-color: inherit;">;</span></pre> 
  <div style="background-color: inherit;"> 
   <span style="line-height: 1.5; background-color: inherit;"><br style="background-color: inherit;"></span> 
  </div>Java代码实现： 
 </div> 
 <div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"> 
  <table border="1" cellpadding="2" cellspacing="0" style="font-size: 13px; border-collapse: collapse; margin-top: 10px; margin-bottom: 10px; color: rgb(51, 51, 51); font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;"><tbody style="font-size: 1em !important; background-color: inherit;"><tr style="font-size: 1em !important; background-color: inherit;"><td style="word-break: break-all; border: 1px solid rgb(153, 153, 153); padding: 5px 16px 5px 12px; min-height: 25px; min-width: 25px; height: auto !important; color: rgb(175, 175, 175) !important; font-size: 1em !important; width: auto !important; background-color: inherit;"> 
      <div style="min-width: 2px; font-size: 1em !important; text-align: right !important; background-color: inherit;">
        1 
      </div> 
      <div style="min-width: 2px; font-size: 1em !important; text-align: right !important; background-color: inherit;">
        2 
      </div> 
      <div style="min-width: 2px; font-size: 1em !important; text-align: right !important; background-color: inherit;">
        3 
      </div> 
      <div style="min-width: 2px; font-size: 1em !important; text-align: right !important; background-color: inherit;">
        4 
      </div> 
      <div style="min-width: 2px; font-size: 1em !important; text-align: right !important; background-color: inherit;">
        5 
      </div> 
      <div style="min-width: 2px; font-size: 1em !important; text-align: right !important; background-color: inherit;">
        6 
      </div> 
      <div style="min-width: 2px; font-size: 1em !important; text-align: right !important; background-color: inherit;">
        7 
      </div> 
      <div style="min-width: 2px; font-size: 1em !important; text-align: right !important; background-color: inherit;">
        8 
      </div> 
      <div style="min-width: 2px; font-size: 1em !important; text-align: right !important; background-color: inherit;">
        9 
      </div> 
      <div style="min-width: 2px; font-size: 1em !important; text-align: right !important; background-color: inherit;">
        10 
      </div> 
      <div style="min-width: 2px; font-size: 1em !important; text-align: right !important; background-color: inherit;">
        11 
      </div> 
      <div style="min-width: 2px; font-size: 1em !important; text-align: right !important; background-color: inherit;">
        12 
      </div></td><td style="word-break: break-all; border: 1px solid rgb(153, 153, 153); padding: 5px 16px 5px 12px; min-height: 25px; min-width: 25px; height: auto !important; width: 963px; font-size: 1em !important; background-color: inherit;"> 
      <div style="min-width: 2px; font-size: 1em !important; background-color: inherit;"> 
       <div style="font-size: 1em !important; background-color: inherit;"> 
        <code style="font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; color: rgb(0, 102, 153) !important; font-size: 1em !important; font-weight: bold !important; background-color: inherit;">public</code>  
        <code style="font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; color: rgb(0, 102, 153) !important; font-size: 1em !important; font-weight: bold !important; background-color: inherit;">void</code>  
        <code style="font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; color: black !important; font-size: 1em !important; background-color: inherit;">test_aggregate() {<!-- --></code> 
       </div> 
       <div style="font-size: 1em !important; background-color: inherit;"> 
        <code style="color: rgb(221, 17, 68); font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; font-size: 1em !important; background-color: inherit;">        </code> 
        <code style="font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; color: rgb(0, 130, 0) !important; font-size: 1em !important; background-color: inherit;">// <a target="_blank" href="https://docs.mongodb.org/getting-started/java/aggregation/" rel="nofollow noopener noreferrer" style="cursor: pointer; color: rgb(0, 130, 0) !important; font-size: 1em !important; background-color: inherit;">https://docs.mongodb.org/getting-started/java/aggregation/</a></code> 
       </div> 
       <div style="font-size: 1em !important; background-color: inherit;"> 
        <code style="color: rgb(221, 17, 68); font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; font-size: 1em !important; background-color: inherit;">        </code> 
        <code style="font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; color: black !important; font-size: 1em !important; background-color: inherit;">MongoCollection&lt;Document&gt; collection = MongoUtil.getCollection(</code> 
        <code style="font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; color: blue !important; font-size: 1em !important; background-color: inherit;">"ad_play_log"</code> 
        <code style="font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; color: black !important; font-size: 1em !important; background-color: inherit;">);</code> 
       </div> 
       <div style="font-size: 1em !important; background-color: inherit;"> 
        <code style="color: rgb(221, 17, 68); font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; font-size: 1em !important; background-color: inherit;">        </code> 
        <code style="font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; color: black !important; font-size: 1em !important; background-color: inherit;">AggregateIterable&lt;Document&gt; iterable = collection.aggregate(asList(</code> 
        <code style="font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; color: rgb(0, 102, 153) !important; font-size: 1em !important; font-weight: bold !important; background-color: inherit;">new</code>  
        <code style="font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; color: black !important; font-size: 1em !important; background-color: inherit;">Document(</code> 
        <code style="font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; color: blue !important; font-size: 1em !important; background-color: inherit;">"$group"</code> 
        <code style="font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; color: black !important; font-size: 1em !important; background-color: inherit;">,</code> 
       </div> 
       <div style="font-size: 1em !important; background-color: inherit;"> 
        <code style="color: rgb(221, 17, 68); font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; font-size: 1em !important; background-color: inherit;">                </code> 
        <code style="font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; color: rgb(0, 102, 153) !important; font-size: 1em !important; font-weight: bold !important; background-color: inherit;">new</code>  
        <code style="font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; color: black !important; font-size: 1em !important; background-color: inherit;">Document(</code> 
        <code style="font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; color: blue !important; font-size: 1em !important; background-color: inherit;">"_id"</code> 
        <code style="font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; color: black !important; font-size: 1em !important; background-color: inherit;">, </code> 
        <code style="font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; color: blue !important; font-size: 1em !important; background-color: inherit;">"$ad_position_id"</code> 
        <code style="font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; color: black !important; font-size: 1em !important; background-color: inherit;">).append(</code> 
        <code style="font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; color: blue !important; font-size: 1em !important; background-color: inherit;">"count"</code> 
        <code style="font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; color: black !important; font-size: 1em !important; background-color: inherit;">, </code> 
        <code style="font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; color: rgb(0, 102, 153) !important; font-size: 1em !important; font-weight: bold !important; background-color: inherit;">new</code>  
        <code style="font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; color: black !important; font-size: 1em !important; background-color: inherit;">Document(</code> 
        <code style="font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; color: blue !important; font-size: 1em !important; background-color: inherit;">"$sum"</code> 
        <code style="font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; color: black !important; font-size: 1em !important; background-color: inherit;">, </code> 
        <code style="font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; color: rgb(0, 153, 0) !important; font-size: 1em !important; background-color: inherit;">1</code> 
        <code style="font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; color: black !important; font-size: 1em !important; background-color: inherit;">)))));</code> 
       </div> 
       <div style="font-size: 1em !important; background-color: inherit;"> 
        <code style="color: rgb(221, 17, 68); font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; font-size: 1em !important; background-color: inherit;">        </code> 
        <code style="font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; color: black !important; font-size: 1em !important; background-color: inherit;">iterable.forEach(</code> 
        <code style="font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; color: rgb(0, 102, 153) !important; font-size: 1em !important; font-weight: bold !important; background-color: inherit;">new</code>  
        <code style="font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; color: black !important; font-size: 1em !important; background-color: inherit;">Block&lt;Document&gt;() {<!-- --></code> 
       </div> 
       <div style="font-size: 1em !important; background-color: inherit;"> 
        <code style="color: rgb(221, 17, 68); font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; font-size: 1em !important; background-color: inherit;">            </code> 
        <code style="font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; color: gray !important; font-size: 1em !important; background-color: inherit;">@Override</code> 
       </div> 
       <div style="font-size: 1em !important; background-color: inherit;"> 
        <code style="color: rgb(221, 17, 68); font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; font-size: 1em !important; background-color: inherit;">            </code> 
        <code style="font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; color: rgb(0, 102, 153) !important; font-size: 1em !important; font-weight: bold !important; background-color: inherit;">public</code>  
        <code style="font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; color: rgb(0, 102, 153) !important; font-size: 1em !important; font-weight: bold !important; background-color: inherit;">void</code>  
        <code style="font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; color: black !important; font-size: 1em !important; background-color: inherit;">apply(</code> 
        <code style="font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; color: rgb(0, 102, 153) !important; font-size: 1em !important; font-weight: bold !important; background-color: inherit;">final</code>  
        <code style="font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; color: black !important; font-size: 1em !important; background-color: inherit;">Document document) {<!-- --></code> 
       </div> 
       <div style="font-size: 1em !important; background-color: inherit;"> 
        <code style="color: rgb(221, 17, 68); font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; font-size: 1em !important; background-color: inherit;">                </code> 
        <code style="font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; color: black !important; font-size: 1em !important; background-color: inherit;">System.out.println(document.toJson());</code> 
       </div> 
       <div style="font-size: 1em !important; background-color: inherit;"> 
        <code style="color: rgb(221, 17, 68); font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; font-size: 1em !important; background-color: inherit;">            </code> 
        <code style="font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; color: black !important; font-size: 1em !important; background-color: inherit;">}</code> 
       </div> 
       <div style="font-size: 1em !important; background-color: inherit;"> 
        <code style="color: rgb(221, 17, 68); font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; font-size: 1em !important; background-color: inherit;">        </code> 
        <code style="font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; color: black !important; font-size: 1em !important; background-color: inherit;">});</code> 
       </div> 
       <div style="font-size: 1em !important; background-color: inherit;"> 
        <code style="color: rgb(221, 17, 68); font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; font-size: 1em !important; background-color: inherit;">    </code> 
        <code style="font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; color: black !important; font-size: 1em !important; background-color: inherit;">}</code> 
       </div> 
      </div></td></tr></tbody></table> 
 </div> 
 <div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"> 
  <br style="background-color: inherit;"> 
 </div> 
 <span style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><span style="color:#00b050;background-color: inherit;"><span style="font-size: 16px; background-color: inherit;">统计</span><span style="font-size: 16px; background-color: inherit;">aggregate的行数</span></span></span> 
 <div style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"> 
  <span style="color:#00b050;background-color: inherit;"><span style="font-size: 16px; line-height: 24px; background-color: inherit;"><span style="background-color: inherit;"><br style="background-color: inherit;"></span></span></span> 
  <div style="background-color: inherit;"> 
   <div> 
    <span style="background-color: inherit;"><span style="font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; font-size: 13px;"></span></span> 
   </div> 
   <div> 
    <ol style="margin-top: 0px; margin-bottom: 0px; color: rgb(36, 39, 41); font-family: Arial, 'Helvetica Neue', Helvetica, sans-serif; font-size: 15px;"><li style="background-color: inherit;">Use <code style="font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, sans-serif; font-size: 13px; background-color: rgb(239, 240, 241);">$project</code> to save <code style="font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, sans-serif; font-size: 13px; background-color: rgb(239, 240, 241);">tag</code> and <code style="font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, sans-serif; font-size: 13px; background-color: rgb(239, 240, 241);">count</code> into <code style="font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, sans-serif; font-size: 13px; background-color: rgb(239, 240, 241);">tmp</code></li><li style="background-color: inherit;">Use <code style="font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, sans-serif; font-size: 13px; background-color: rgb(239, 240, 241);">$push</code> or <code style="font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, sans-serif; font-size: 13px; background-color: rgb(239, 240, 241);">addToSet</code> to store <code style="font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, sans-serif; font-size: 13px; background-color: rgb(239, 240, 241);">tmp</code> into your <code style="font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, sans-serif; font-size: 13px; background-color: rgb(239, 240, 241);">data</code> list.</li></ol> 
    <p style="margin-top: 5px; margin-bottom: 5px; color: rgb(36, 39, 41); font-family: Arial, 'Helvetica Neue', Helvetica, sans-serif; font-size: 15px;">Code:</p> 
    <pre style="font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, sans-serif; color: rgb(57, 51, 24); font-size: 13px; background-color: rgb(239, 240, 241);"><code style="font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, sans-serif;"><span style="color: rgb(48, 51, 54); background-color: inherit;">db</span><span style="color: rgb(48, 51, 54); background-color: inherit;">.</span><span style="color: rgb(48, 51, 54); background-color: inherit;">test</span><span style="color: rgb(48, 51, 54); background-color: inherit;">.</span><span style="color: rgb(48, 51, 54); background-color: inherit;">aggregate</span><span style="color: rgb(48, 51, 54); background-color: inherit;">(</span><span style="color: rgb(48, 51, 54); background-color: inherit;">{<!-- --></span><span style="color: rgb(48, 51, 54); background-color: inherit;">$unwind</span><span style="color: rgb(48, 51, 54); background-color: inherit;">:</span><span style="color: rgb(125, 39, 39); background-color: inherit;">'$tags'</span><span style="color: rgb(48, 51, 54); background-color: inherit;">},</span><span style="color: rgb(48, 51, 54); background-color: inherit;">{<!-- --></span><span style="color: rgb(48, 51, 54); background-color: inherit;">$group</span><span style="color: rgb(48, 51, 54); background-color: inherit;">:{<!-- --></span><span style="color: rgb(48, 51, 54); background-color: inherit;">_id</span><span style="color: rgb(48, 51, 54); background-color: inherit;">:</span><span style="color: rgb(125, 39, 39); background-color: inherit;">'$tags'</span><span style="color: rgb(48, 51, 54); background-color: inherit;">,</span><span style="color: rgb(48, 51, 54); background-color: inherit;"> count</span><span style="color: rgb(48, 51, 54); background-color: inherit;">:{<!-- --></span><span style="color: rgb(48, 51, 54); background-color: inherit;">$sum</span><span style="color: rgb(48, 51, 54); background-color: inherit;">:</span><span style="color: rgb(125, 39, 39); background-color: inherit;">1</span><span style="color: rgb(48, 51, 54); background-color: inherit;">}}},</span><span style="color: rgb(48, 51, 54); background-color: inherit;">{<!-- --></span><span style="color: rgb(48, 51, 54); background-color: inherit;">$project</span><span style="color: rgb(48, 51, 54); background-color: inherit;">:{<!-- --></span><span style="color: rgb(48, 51, 54); background-color: inherit;">tmp</span><span style="color: rgb(48, 51, 54); background-color: inherit;">:{<!-- --></span><span style="color: rgb(48, 51, 54); background-color: inherit;">tag</span><span style="color: rgb(48, 51, 54); background-color: inherit;">:</span><span style="color: rgb(125, 39, 39); background-color: inherit;">'$_id'</span><span style="color: rgb(48, 51, 54); background-color: inherit;">,</span><span style="color: rgb(48, 51, 54); background-color: inherit;"> count</span><span style="color: rgb(48, 51, 54); background-color: inherit;">:</span><span style="color: rgb(125, 39, 39); background-color: inherit;">'$count'</span><span style="color: rgb(48, 51, 54); background-color: inherit;">}}},</span><span style="color: rgb(48, 51, 54); background-color: inherit;">{<!-- --></span><span style="color: rgb(48, 51, 54); background-color: inherit;">$group</span><span style="color: rgb(48, 51, 54); background-color: inherit;">:{<!-- --></span><span style="color: rgb(48, 51, 54); background-color: inherit;">_id</span><span style="color: rgb(48, 51, 54); background-color: inherit;">:</span><span style="color: rgb(16, 16, 148); background-color: inherit;">null</span><span style="color: rgb(48, 51, 54); background-color: inherit;">,</span><span style="color: rgb(48, 51, 54); background-color: inherit;"> total</span><span style="color: rgb(48, 51, 54); background-color: inherit;">:{<!-- --></span><span style="color: rgb(48, 51, 54); background-color: inherit;">$sum</span><span style="color: rgb(48, 51, 54); background-color: inherit;">:</span><span style="color: rgb(125, 39, 39); background-color: inherit;">1</span><span style="color: rgb(48, 51, 54); background-color: inherit;">},</span><span style="color: rgb(48, 51, 54); background-color: inherit;"> data</span><span style="color: rgb(48, 51, 54); background-color: inherit;">:{<!-- --></span><span style="color: rgb(48, 51, 54); background-color: inherit;">$addToSet</span><span style="color: rgb(48, 51, 54); background-color: inherit;">:</span><span style="color: rgb(125, 39, 39); background-color: inherit;">'$tmp'</span><span style="color: rgb(48, 51, 54); background-color: inherit;">}}}</span><span style="color: rgb(48, 51, 54); background-color: inherit;">)</span></code></pre> 
    <p style="margin-top: 5px; margin-bottom: 5px; color: rgb(36, 39, 41); font-family: Arial, 'Helvetica Neue', Helvetica, sans-serif; font-size: 15px;">Output:</p> 
    <pre style="font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, sans-serif; color: rgb(57, 51, 24); font-size: 13px; background-color: rgb(239, 240, 241);"><code style="font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, sans-serif;"><span style="color: rgb(48, 51, 54); background-color: inherit;">{<!-- --></span><span style="color: rgb(125, 39, 39); background-color: inherit;">"result"</span><span style="color: rgb(48, 51, 54); background-color: inherit;">:</span><span style="color: rgb(48, 51, 54); background-color: inherit;">[</span><span style="color: rgb(48, 51, 54); background-color: inherit;">{<!-- --></span><span style="color: rgb(125, 39, 39); background-color: inherit;">"_id"</span><span style="color: rgb(48, 51, 54); background-color: inherit;">:</span><span style="color: rgb(16, 16, 148); background-color: inherit;">null</span><span style="color: rgb(48, 51, 54); background-color: inherit;">,</span><span style="color: rgb(125, 39, 39); background-color: inherit;">"total"</span><span style="color: rgb(48, 51, 54); background-color: inherit;">:</span><span style="color: rgb(125, 39, 39); background-color: inherit;">5</span><span style="color: rgb(48, 51, 54); background-color: inherit;">,</span><span style="color: rgb(125, 39, 39); background-color: inherit;">"data"</span><span style="color: rgb(48, 51, 54); background-color: inherit;">:</span><span style="color: rgb(48, 51, 54); background-color: inherit;">[</span><span style="color: rgb(48, 51, 54); background-color: inherit;">{<!-- --></span><span style="color: rgb(125, 39, 39); background-color: inherit;">"tag"</span><span style="color: rgb(48, 51, 54); background-color: inherit;">:</span><span style="color: rgb(125, 39, 39); background-color: inherit;">"SOME"</span><span style="color: rgb(48, 51, 54); background-color: inherit;">,</span><span style="color: rgb(125, 39, 39); background-color: inherit;">"count"</span><span style="color: rgb(48, 51, 54); background-color: inherit;">:</span><span style="color: rgb(125, 39, 39); background-color: inherit;">1</span><span style="color: rgb(48, 51, 54); background-color: inherit;">},</span><span style="color: rgb(48, 51, 54); background-color: inherit;">{<!-- --></span><span style="color: rgb(125, 39, 39); background-color: inherit;">"tag"</span><span style="color: rgb(48, 51, 54); background-color: inherit;">:</span><span style="color: rgb(125, 39, 39); background-color: inherit;">"RANDOM"</span><span style="color: rgb(48, 51, 54); background-color: inherit;">,</span><span style="color: rgb(125, 39, 39); background-color: inherit;">"count"</span><span style="color: rgb(48, 51, 54); background-color: inherit;">:</span><span style="color: rgb(125, 39, 39); background-color: inherit;">2</span><span style="color: rgb(48, 51, 54); background-color: inherit;">},</span><span style="color: rgb(48, 51, 54); background-color: inherit;">{<!-- --></span><span style="color: rgb(125, 39, 39); background-color: inherit;">"tag"</span><span style="color: rgb(48, 51, 54); background-color: inherit;">:</span><span style="color: rgb(125, 39, 39); background-color: inherit;">"TAGS1"</span><span style="color: rgb(48, 51, 54); background-color: inherit;">,</span><span style="color: rgb(125, 39, 39); background-color: inherit;">"count"</span><span style="color: rgb(48, 51, 54); background-color: inherit;">:</span><span style="color: rgb(125, 39, 39); background-color: inherit;">1</span><span style="color: rgb(48, 51, 54); background-color: inherit;">},</span><span style="color: rgb(48, 51, 54); background-color: inherit;">{<!-- --></span><span style="color: rgb(125, 39, 39); background-color: inherit;">"tag"</span><span style="color: rgb(48, 51, 54); background-color: inherit;">:</span><span style="color: rgb(125, 39, 39); background-color: inherit;">"TAGS"</span><span style="color: rgb(48, 51, 54); background-color: inherit;">,</span><span style="color: rgb(125, 39, 39); background-color: inherit;">"count"</span><span style="color: rgb(48, 51, 54); background-color: inherit;">:</span><span style="color: rgb(125, 39, 39); background-color: inherit;">1</span><span style="color: rgb(48, 51, 54); background-color: inherit;">},</span><span style="color: rgb(48, 51, 54); background-color: inherit;">{<!-- --></span><span style="color: rgb(125, 39, 39); background-color: inherit;">"tag"</span><span style="color: rgb(48, 51, 54); background-color: inherit;">:</span><span style="color: rgb(125, 39, 39); background-color: inherit;">"SOME1"</span><span style="color: rgb(48, 51, 54); background-color: inherit;">,</span><span style="color: rgb(125, 39, 39); background-color: inherit;">"count"</span><span style="color: rgb(48, 51, 54); background-color: inherit;">:</span><span style="color: rgb(125, 39, 39); background-color: inherit;">1</span><span style="color: rgb(48, 51, 54); background-color: inherit;">}</span><span style="color: rgb(48, 51, 54); background-color: inherit;">]</span><span style="color: rgb(48, 51, 54); background-color: inherit;">}</span><span style="color: rgb(48, 51, 54); background-color: inherit;">],</span><span style="color: rgb(125, 39, 39); background-color: inherit;">"ok"</span><span style="color: rgb(48, 51, 54); background-color: inherit;">:</span><span style="color: rgb(125, 39, 39); background-color: inherit;">1</span><span style="color: rgb(48, 51, 54); background-color: inherit;">}</span></code></pre> 
   </div> 
   <div> 
    <span style="font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; font-size: 13px;"><br style="background-color: inherit;"></span> 
   </div> 
   <div> 
    <hr style="background-color: inherit;">参考 
    <br style="background-color: inherit;"> 
   </div> 
   <div>
              
    <a target="_blank" href="http://stackoverflow.com/questions/13529323/obtaining-group-result-with-group-count" rel="nofollow noopener noreferrer" style="cursor: pointer; line-height: 1.5;">http://stackoverflow.com/questions/13529323/obtaining-group-result-with-group-count</a> 
   </div> 
   <div>
              
    <a target="_blank" href="http://www.cnblogs.com/shanyou/p/3494854.html" rel="nofollow noopener noreferrer" style="cursor: pointer;">http://www.cnblogs.com/shanyou/p/3494854.html</a> 
   </div> 
   <div>
              
    <a target="_blank" href="http://www.cnblogs.com/fx2008/p/3572169.html" rel="nofollow noopener noreferrer" style="cursor: pointer;">http://www.cnblogs.com/fx2008/p/3572169.html</a> 
   </div> 
   <div> 
    <br style="background-color: inherit;"> 
   </div> 
  </div> 
  <div style="background-color: inherit;">
    代码 
  </div> 
  <div style="background-color: inherit;">
             
   <a target="_blank" href="https://github.com/JeromeSuz/demo_nosql" style="cursor: pointer; line-height: 1.5; background-color: inherit;" rel="noopener noreferrer">https://github.com/JeromeSuz/demo_nosql</a> 
  </div> 
 </div> 
</div> 
<div style="top: 0px;"> 
 <ul><li style="font-family: 微软雅黑; font-size: 14px; line-height: 21px;"><span style="line-height: 1.5; background-color: inherit;"></span></li></ul></div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/77daa13b29d7147683bfde631e1efb78/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Cesium学习笔记（2）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/31dc0327eb9bca8016a60c250f941859/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">用OpenCV实现Photoshop算法(三): 曲线调整</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>