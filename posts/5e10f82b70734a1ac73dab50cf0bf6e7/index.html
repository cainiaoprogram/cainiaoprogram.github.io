<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>VRRP 基本配置 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="VRRP 基本配置" />
<meta property="og:description" content="VRRP 基本配置 原理概述 随着Internet 的发展，人们对网络可靠性的要求越来越高。对于用户来说，能够时刻与外部网络保待通信非常重要，但内部网络中的所有主机通常只能设置一个网关IP 地址，通过该出口网关实现主机与外部网络的通信。若此时出口网关设备发生故障，主机与外部网络的通信就会中断，所以配置多个出口网关是提高网络可靠性的常用方法。为此， IETF 组织推出了VRRP 协议， 主机在多个出口网关的情况下，仅需配置一个虚拟网关IP 地址作为出口网关即可，解决了局域网主机访问外部网络的可靠性问题。
VRRP ( Virtual Router Redundancy Protocol ) 全称是虚拟路由器冗余协议，它是一种容错协议。该协议通过把几台路由设备联合组成一台虚拟的路由设备，该虚拟路由器在本地局域网拥有唯一的一个虚拟ID 和虚拟IP 地址。实际上，该虚拟路由器是由一个Master 设备和若干Backup 设备组成。正常情况下，业务全部由Master 承担，所有用户端仅需设置此虚拟IP 为网关地址。当Master 出现故障时， Backup 接替工作，及时将业务切换到备份路由器，从而保持通信的连续性和可靠性。而用户端无需做任何配置更改，对故障无感知。
VRRP的Master 选举基于优先级， 优先级取值范围是0~2 55, 默认情况下，配置优先级为100 。在接口上可以通过配置优先级的大小来手工选择Master 设备。
实验目的 理解VRRP 的应用场景掌握VRRP 虚拟路由器的配置掌握修改VRRP 优先级的方法掌握查看VRRP 主备状态的方法 实验内容 本实验模拟企业网络场景。公司内员工所用电脑，如PC-1 、PC-2, 通过交换机S1连接到公司网络，S1 连接到公司出口网关路由器。为了提高网络的可靠性，公司使用两台路由器R2 与R3 作为双出口连接到外网路由器R1。R1 、R2 、R3 之间运行OSPF协议。在双网关的情况下，如果在PC 上配置R2 或R3 的真实IP 地址作为网关，当其中一台路由器故障时，就需要手动更改PC 的网关IP, 若网络中有大量PC 则需要耗费大量时间和人力去更改配置，且会带来一定时间的断网影响。为了能够使故障所造成的断网影响达到最小化，增强网络的可靠性，网络管理员在R2 与R3 之间部署VRRP 协议，这样当任一网关发生故障时就能自动切换而无需更改PC 的网关IP 地址。
实验拓扑 实验编址 我们配置一下相关信息
设备
接口
IP地址" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/5e10f82b70734a1ac73dab50cf0bf6e7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-04-12T16:17:28+08:00" />
<meta property="article:modified_time" content="2021-04-12T16:17:28+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">VRRP 基本配置</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2 style="margin-left:0cm;">VRRP 基本配置</h2> 
<h3 style="margin-left:0cm;"><strong>原理概述</strong></h3> 
<p style="text-indent:33px;">随着Internet 的发展，人们对网络可靠性的要求越来越高。对于用户来说，能够时刻与外部网络保待通信非常重要，但内部网络中的所有主机通常只能设置一个网关IP 地址，通过该出口网关实现主机与外部网络的通信。若此时出口网关设备发生故障，主机与外部网络的通信就会中断，所以配置多个出口网关是提高网络可靠性的常用方法。为此， IETF 组织推出了VRRP 协议， 主机在多个出口网关的情况下，仅需配置一个虚拟网关IP 地址作为出口网关即可，解决了局域网主机访问外部网络的可靠性问题。</p> 
<p style="text-indent:33px;">VRRP ( Virtual Router Redundancy Protocol ) 全称是虚拟路由器冗余协议，它是一种容错协议。该协议通过把几台路由设备联合组成一台虚拟的路由设备，该虚拟路由器在本地局域网拥有唯一的一个虚拟ID 和虚拟IP 地址。实际上，该虚拟路由器是由一个Master 设备和若干Backup 设备组成。正常情况下，业务全部由Master 承担，所有用户端仅需设置此虚拟IP 为网关地址。当Master 出现故障时， Backup 接替工作，及时将业务切换到备份路由器，从而保持通信的连续性和可靠性。而用户端无需做任何配置更改，对故障无感知。</p> 
<p style="margin-left:0cm;">VRRP的Master 选举基于优先级， 优先级取值范围是0~2 55, 默认情况下，配置优先级为100 。在接口上可以通过配置优先级的大小来手工选择Master 设备。</p> 
<h3 style="margin-left:0cm;"><strong>实验目的</strong></h3> 
<ol><li>理解VRRP 的应用场景</li><li>掌握VRRP 虚拟路由器的配置</li><li>掌握修改VRRP 优先级的方法</li><li>掌握查看VRRP 主备状态的方法</li></ol> 
<h3 style="margin-left:0cm;"><strong>实验内容</strong></h3> 
<p style="text-indent:33px;">本实验模拟企业网络场景。公司内员工所用电脑，如PC-1 、PC-2, 通过交换机S1连接到公司网络，S1 连接到公司出口网关路由器。为了提高网络的可靠性，公司使用两台路由器R2 与R3 作为双出口连接到外网路由器R1。R1 、R2 、R3 之间运行OSPF协议。在双网关的情况下，如果在PC 上配置R2 或R3 的真实IP 地址作为网关，当其中一台路由器故障时，就需要手动更改PC 的网关IP, 若网络中有大量PC 则需要耗费大量时间和人力去更改配置，且会带来一定时间的断网影响。为了能够使故障所造成的断网影响达到最小化，增强网络的可靠性，网络管理员在R2 与R3 之间部署VRRP 协议，这样当任一网关发生故障时就能自动切换而无需更改PC 的网关IP 地址。</p> 
<h3 style="margin-left:0cm;"><strong>实验拓扑</strong></h3> 
<p style="margin-left:0cm;"><img alt="" height="357" src="https://images2.imgbox.com/2c/8a/i6BoUCen_o.png" width="694"><strong> </strong></p> 
<h3 style="margin-left:0cm;"><strong>实验编址</strong></h3> 
<p style="margin-left:0cm;"><span style="color:#333333;">我们配置一下相关信息</span></p> 
<table border="1" cellspacing="0"><tbody><tr><td style="width:83.4pt;"> <p style="margin-left:0cm;">设备</p> </td><td style="width:78.05pt;"> <p style="margin-left:0cm;">接口</p> </td><td style="width:84.45pt;"> <p style="margin-left:0cm;">IP地址</p> </td><td style="width:84.45pt;"> <p style="margin-left:0cm;">子网掩码</p> </td><td style="width:84.45pt;"> <p style="margin-left:0cm;">默认网关</p> </td></tr><tr><td rowspan="2" style="width:83.4pt;"> <p style="margin-left:0cm;">R1（AR1220）</p> </td><td style="width:78.05pt;"> <p style="margin-left:0cm;">GE 0/0/0</p> </td><td style="width:84.45pt;"> <p style="margin-left:0cm;">192.168.2.254</p> </td><td style="width:84.45pt;"> <p style="margin-left:0cm;">255.255.255.0</p> </td><td style="width:84.45pt;"> <p style="margin-left:0cm;">N/A</p> </td></tr><tr><td style="width:78.05pt;"> <p style="margin-left:0cm;">GE 0/0/1</p> </td><td style="width:84.45pt;"> <p style="margin-left:0cm;">192.168.3.254</p> </td><td style="width:84.45pt;"> <p style="margin-left:0cm;">255.255.255.0</p> </td><td style="width:84.45pt;"> <p style="margin-left:0cm;">N/A</p> </td></tr><tr><td rowspan="2" style="width:83.4pt;"> <p style="margin-left:0cm;">R2（AR1220）</p> </td><td style="width:78.05pt;"> <p style="margin-left:0cm;">GE 0/0/0</p> </td><td style="width:84.45pt;"> <p style="margin-left:0cm;">192.168.2.100</p> </td><td style="width:84.45pt;"> <p style="margin-left:0cm;">255.255.255.0</p> </td><td style="width:84.45pt;"> <p style="margin-left:0cm;">N/A</p> </td></tr><tr><td style="width:78.05pt;"> <p style="margin-left:0cm;">GE 0/0/1</p> </td><td style="width:84.45pt;"> <p style="margin-left:0cm;">192.168.1.100</p> </td><td style="width:84.45pt;"> <p style="margin-left:0cm;">255.255.255.0</p> </td><td style="width:84.45pt;"> <p style="margin-left:0cm;">N/A</p> </td></tr><tr><td rowspan="2" style="width:83.4pt;"> <p style="margin-left:0cm;">R3（AR1220）</p> </td><td style="width:78.05pt;"> <p style="margin-left:0cm;">GE 0/0/1</p> </td><td style="width:84.45pt;"> <p style="margin-left:0cm;">192.168.3.200</p> </td><td style="width:84.45pt;"> <p style="margin-left:0cm;">255.255.255.0</p> </td><td style="width:84.45pt;"> <p style="margin-left:0cm;">N/A</p> </td></tr><tr><td style="width:78.05pt;"> <p style="margin-left:0cm;">GE 0/0/0</p> </td><td style="width:84.45pt;"> <p style="margin-left:0cm;">192.168.1.200</p> </td><td style="width:84.45pt;"> <p style="margin-left:0cm;">255.255.255.0</p> </td><td style="width:84.45pt;"> <p style="margin-left:0cm;">N/A</p> </td></tr><tr><td style="width:83.4pt;"> <p style="margin-left:0cm;">PC-1</p> </td><td style="width:78.05pt;"> <p style="margin-left:0cm;">Ethemet0/0/1</p> </td><td style="width:84.45pt;"> <p style="margin-left:0cm;">192.168.1.1</p> </td><td style="width:84.45pt;"> <p style="margin-left:0cm;">255.255.255.0</p> </td><td style="width:84.45pt;"> <p style="margin-left:0cm;">192.168.1.254</p> </td></tr><tr><td style="width:83.4pt;"> <p style="margin-left:0cm;">PC-2</p> </td><td style="width:78.05pt;"> <p style="margin-left:0cm;">Ethemet0/0/1</p> </td><td style="width:84.45pt;"> <p style="margin-left:0cm;">192.168.1.2</p> </td><td style="width:84.45pt;"> <p style="margin-left:0cm;">255.255.255.0</p> </td><td style="width:84.45pt;"> <p style="margin-left:0cm;">192.168.1.254</p> </td></tr></tbody></table> 
<h3 style="margin-left:0cm;"><strong>实验步骤</strong></h3> 
<h4 style="margin-left:0cm;"><strong><span style="color:#333333;">1. </span></strong><strong><span style="color:#333333;">基本配置</span></strong></h4> 
<p style="margin-left:0cm;"><span style="color:#333333;">根据实验编址表进行相应的基本IP 地址配置， 并使用ping 命令检测各直连链路的连通性。</span><img alt="" height="162" src="https://images2.imgbox.com/0d/aa/hSI2H8xU_o.png" width="767"><span style="color:#333333;"> </span></p> 
<p style="margin-left:0cm;"> </p> 
<h4 style="margin-left:0cm;"><strong><span style="color:#333333;">2. </span></strong><strong><span style="color:#333333;">部署OSPF 网络</span></strong></h4> 
<p style="margin-left:0cm;"><span style="color:#333333;">在公司的出口网关路由器R1 、R2 和外网路由器R3 上配置OSPF 协议，使用进程号1, 且所有网段均通告进区域0 中。</span></p> 
<p style="margin-left:0cm;"><img alt="" height="84" src="https://images2.imgbox.com/f6/d0/Wv8W9rk0_o.png" width="717"><span style="color:#333333;"> </span></p> 
<p style="margin-left:0cm;"><img alt="" height="88" src="https://images2.imgbox.com/1c/94/sSGQSoTp_o.png" width="682"><span style="color:#333333;"> </span></p> 
<p style="margin-left:0cm;"><img alt="" height="87" src="https://images2.imgbox.com/0e/4f/LmVTvr6U_o.png" width="662"><span style="color:#333333;"> </span></p> 
<p style="margin-left:0cm;"><span style="color:#333333;">配置完成后，在R1 上检查OSPF 邻居建立情况, 可以观察到，此时R1 已经与R2 、R3 成功建立起了OSPF 邻居关系。</span></p> 
<p style="margin-left:0cm;"><img alt="" height="188" src="https://images2.imgbox.com/76/40/MoPSILZD_o.png" width="808"><span style="color:#333333;"> </span></p> 
<h4 style="margin-left:0cm;"><strong><span style="color:#333333;">3. </span></strong><strong><span style="color:#333333;">配置VRRP协议</span></strong></h4> 
<p style="text-indent:33px;"><span style="color:#333333;">为了提高网络的可靠性，公司采用双出口的方式连接到外网。现网络管理员想针对两台出口网关路由器实现主备备份，即正常情况下，只有主网关工作， 当其发生故障时能够自动切换到备份网关。现在通过配置VRRP 协议来实现这样的需求。</span></p> 
<p style="margin-left:0cm;"><span style="color:#333333;">在R2 和R3 上配置VRRP 协议，使用vrrp vrid 1 virtual-ip 命令创建VRRP 备份组，指定即R1和R2 处千同一个VRRP 备份组内， VRRP 备份组号为1, 配置虚拟IP 为192.168.1.254 。注意虚拟IP 地址必须和当前接口在同一网段。</span></p> 
<p style="margin-left:0cm;"><img alt="" height="47" src="https://images2.imgbox.com/c0/79/acAfOSIB_o.png" width="685"><span style="color:#333333;"> </span></p> 
<p style="margin-left:0cm;"><img alt="" height="46" src="https://images2.imgbox.com/2d/c1/E4N3sMH3_o.png" width="682"><span style="color:#333333;"> </span></p> 
<p style="text-indent:33px;"><span style="color:#333333;">经过配置后， PC 将使用虚拟路由器IP 地址作为默认网关。</span></p> 
<p style="text-indent:33px;"><span style="color:#333333;">在VRRP 协议中，优先级决定路由器在备份组中的角色，优先级高者成为Master.如果优先级相同，比较接口的IP 地址大小，较大的成为Master。优先级值默认为100,0 被系统保留， 255 保留给IP 地址拥有者使用。</span></p> 
<p style="margin-left:0cm;"><span style="color:#333333;">现在配笠R2 的优先级为120, R3 的优先级保持默认100 不变，这将使得R2 成为Master, R3 为Backup 。</span></p> 
<p style="margin-left:0cm;"><img alt="" height="49" src="https://images2.imgbox.com/06/42/vxKE0h1y_o.png" width="640"><span style="color:#333333;"> </span></p> 
<p style="text-indent:33px;"><span style="color:#333333;">配置完成后，在R2 和R3 上使用display vrrp 命令查看VRRP 信息。</span></p> 
<p style="margin-left:0cm;"><img alt="" height="379" src="https://images2.imgbox.com/57/e3/LtYYwwgC_o.png" width="643"><span style="color:#333333;"> </span></p> 
<p style="margin-left:0cm;"><img alt="" height="386" src="https://images2.imgbox.com/be/08/9RWI7o0B_o.png" width="647"><span style="color:#333333;"> </span></p> 
<p style="text-indent:33px;"><span style="color:#333333;">可以观察到现在R2 的VRRP 状态是Master, R3 是Backup 。两者都处在VRRP 备份组1 中，且都是E 1/0/1 接口运行在VRRP 协议中。输出信息中的PriorityRun 表示设备当前的运行优先级； PriorityConfig 表示为该设备配置的优先级； asterPriority 为该备份组中Master 的优先级： 一般配置优先级就是运行优先级，但个别情况下可能运行优先级和配置优先级会不一样，在后续实验中会进行讨论。</span></p> 
<p style="margin-left:0cm;"><span style="color:#333333;">也可以使用display vrrp brief 或display vrrp interface 命令来显示VRRP 的工作状态，以R2 为例。</span></p> 
<p style="margin-left:0cm;"><img alt="" height="107" src="https://images2.imgbox.com/48/eb/TV8fOoba_o.png" width="739"><span style="color:#333333;"> </span></p> 
<p style="margin-left:0cm;"><span style="color:#333333;">测试PC 访间公网时的数据包转发路径。可以观察此时都是通过R2 转发。</span></p> 
<p style="margin-left:0cm;"><img alt="" height="258" src="https://images2.imgbox.com/5d/e1/vdgxVY8u_o.png" width="735"><span style="color:#333333;"> </span></p> 
<h4 style="margin-left:0cm;"><strong><span style="color:#333333;">4. </span></strong><strong><span style="color:#333333;">验证VRRP 主备切换</span></strong></h4> 
<p style="margin-left:0cm;"><span style="color:#333333;">现在手动模拟网络出现故障，将S1的E 0/0/1 接口关闭。</span></p> 
<p style="margin-left:0cm;"><img alt="" height="50" src="https://images2.imgbox.com/ba/46/lDflHQIK_o.png" width="608"><span style="color:#333333;"> </span></p> 
<p style="margin-left:0cm;"><span style="color:#333333;">经过3s 左右，使用display vrrp 查看R3 的VRRP 信息。</span></p> 
<p style="margin-left:0cm;"><img alt="" height="389" src="https://images2.imgbox.com/15/0e/7EQjpPVv_o.png" width="628"><span style="color:#333333;"> </span></p> 
<p style="margin-left:0cm;"><span style="color:#333333;">可以观察到R3 切换成为了Master, 从而能够确保用户对公网的访问，几乎感知不到故障的发生。</span></p> 
<p style="margin-left:0cm;"><span style="color:#333333;">测试PC 访问公网时的数据包转发路径。发现数据包发送路径已经切换到R3 。</span></p> 
<p style="margin-left:0cm;"><img alt="" height="143" src="https://images2.imgbox.com/54/57/zaXrDVvP_o.png" width="612"><span style="color:#333333;"> </span></p> 
<p style="margin-left:0cm;"><span style="color:#333333;">如果R2 从故障中恢复，手动开启S1 的E 0/0/1 接口。</span></p> 
<p style="margin-left:0cm;"><img alt="" height="47" src="https://images2.imgbox.com/75/b4/D57aBC4U_o.png" width="526"><span style="color:#333333;"> </span></p> 
<p style="margin-left:0cm;"><span style="color:#333333;">查看R2 和R3 的VRRP 工作状态。</span></p> 
<p style="margin-left:0cm;"><img alt="" height="109" src="https://images2.imgbox.com/91/4d/JP8qBRrL_o.png" width="734"><span style="color:#333333;"> </span></p> 
<p style="margin-left:0cm;"><img alt="" height="114" src="https://images2.imgbox.com/9b/a6/j85NNiVC_o.png" width="732"><span style="color:#333333;"> </span></p> 
<p style="margin-left:0cm;"><span style="color:#333333;">可以观察到Master 设备又立刻重新切换回至R2 。</span></p> 
<p style="margin-left:0cm;"><span style="color:#333333;">测试PC 访问公网时的数据包转发路径。可以验证也切换回R2 转发。而这整个过程对于用户来说是透明的。</span></p> 
<p style="margin-left:0cm;"><img alt="" height="143" src="https://images2.imgbox.com/e2/82/roZVZkXh_o.png" width="623"><span style="color:#333333;"> </span></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2580e67c5ddd9461889f22919fda146b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C#判断文件是否被占用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5d381aabfd392e399dc1e24d77d33ad2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">概率与排列组合——2017NOIP-pj第19题——一家四口人，至少两个人生日属于同一月份的概率是</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>