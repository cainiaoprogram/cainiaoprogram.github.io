<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>iOS开发之第三方登录QQ -- 史上最全最新第三方登录QQ方式实现 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="iOS开发之第三方登录QQ -- 史上最全最新第三方登录QQ方式实现" />
<meta property="og:description" content="项目地址 ： https://github.com/zhonggaorong/QQLoginDemo/tree/master
最新版本的qq登录实现步骤实现：
1. 首先，你需要去向腾讯申请账号。 地址：点击打开链接 2. 下载最新的SDK 地址： SDK下载 SDK内容如下：
1. doc: 为说明文档， 方法参数说明。
2.sample 这个是简单的demo
3. TencentOpenApi_IOS_Bundle.bundle 资源文件包
4. TencentOpenApi.framework 核心开发框架
接下来就进入正题：
1. 项目配置，手把手教学： 1. 新建一个工程。 2. 把TencentOpenApi.framework 和 TencentOpenApi_IOS_Bundle.bundle 拖入工程。 3. 配置项目。 3.1 添加依赖库： 3.2 在工程配置中的“Build Settings”一栏中找到“Linking”配置区，给“Other Linker Flags”配置项添加属性值“-fobjc-arc” 3.3 URLScheme 配置： 3.4 针对ios9以后，需要添加白名单。 在info.plist文件中加入 LSApplicationQueriesSchemes 对应的info.plist 的source code 为
&lt;key&gt;LSApplicationQueriesSchemes&lt;/key&gt; &lt;array&gt; &lt;string&gt;mqqapi&lt;/string&gt; &lt;string&gt;mqq&lt;/string&gt; &lt;string&gt;mqqOpensdkSSoLogin&lt;/string&gt; &lt;string&gt;mqqconnect&lt;/string&gt; &lt;string&gt;mqqopensdkdataline&lt;/string&gt; &lt;string&gt;mqqopensdkgrouptribeshare&lt;/string&gt; &lt;string&gt;mqqopensdkfriend&lt;/string&gt; &lt;string&gt;mqqopensdkapi&lt;/string&gt; &lt;string&gt;mqqopensdkapiV2&lt;/string&gt; &lt;string&gt;mqqopensdkapiV3&lt;/string&gt; &lt;string&gt;mqzoneopensdk&lt;/string&gt; &lt;string&gt;wtloginmqq&lt;/string&gt; &lt;string&gt;wtloginmqq2&lt;/string&gt; &lt;string&gt;mqqwpa&lt;/string&gt; &lt;string&gt;mqzone&lt;/string&gt; &lt;string&gt;mqzonev2&lt;/string&gt; &lt;string&gt;mqzoneshare&lt;/string&gt; &lt;string&gt;wtloginqzone&lt;/string&gt; &lt;string&gt;mqzonewx&lt;/string&gt; &lt;string&gt;mqzoneopensdkapiV2&lt;/string&gt; &lt;string&gt;mqzoneopensdkapi19&lt;/string&gt; &lt;string&gt;mqzoneopensdkapi&lt;/string&gt; &lt;string&gt;mqzoneopensdk&lt;/string&gt; &lt;/array&gt; 3." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/409e86d39e36d997008358e19272298e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2016-06-17T18:06:01+08:00" />
<meta property="article:modified_time" content="2016-06-17T18:06:01+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">iOS开发之第三方登录QQ -- 史上最全最新第三方登录QQ方式实现</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>项目地址 ：  https://github.com/zhonggaorong/QQLoginDemo/tree/master</p> 
<p>最新版本的qq登录实现步骤实现：<img src="https://images2.imgbox.com/7b/46/GoxNOTzx_o.jpg" alt=""></p> 
<p><br> </p> 
<h3>1. 首先，你需要去向腾讯申请账号。 地址：<a target="_blank" href="http://wiki.open.qq.com/wiki/%E9%A6%96%E9%A1%B5" rel="nofollow noopener noreferrer">点击打开链接</a></h3> 
<h3>2. 下载最新的SDK   地址： <a target="_blank" href="http://wiki.open.qq.com/wiki/mobile/SDK%E4%B8%8B%E8%BD%BD" rel="nofollow noopener noreferrer">SDK下载</a></h3> 
<p>SDK内容如下：</p> 
<p><img src="https://images2.imgbox.com/65/8f/Zg6HK09X_o.jpg" alt=""><br> </p> 
<p>1. doc: 为说明文档， 方法参数说明。</p> 
<p>2.sample 这个是简单的demo</p> 
<p> 3. TencentOpenApi_IOS_Bundle.bundle   资源文件包</p> 
<p>4. TencentOpenApi.framework     核心开发框架</p> 
<p>接下来就进入正题：</p> 
<h4> 1. 项目配置，手把手教学：</h4> 
<h4>   1. 新建一个工程。 <br>    2. 把TencentOpenApi.framework 和  TencentOpenApi_IOS_Bundle.bundle  拖入工程。 <br>    3. 配置项目。</h4> 
<h5>   3.1 添加依赖库：</h5> 
<p><img src="https://images2.imgbox.com/b5/94/1mK6f9dE_o.jpg" alt=""><br> </p> 
<h5>3.2 <span style="font-family:Arial; font-size:14px">在工程配置中的“Build Settings”一栏中找到“Linking”配置区，给“Other Linker Flags”配置项添加属性值“-fobjc-arc”</span></h5> 
<p><span style="font-family:Arial; font-size:14px"><img src="https://images2.imgbox.com/60/a5/a3z5oPdy_o.jpg" alt=""><br> </span></p> 
<p><span style="font-family:Arial; font-size:14px"><br> </span></p> 
<p><span style="font-family:Arial; font-size:14px"><br> </span></p> 
<p><br> </p> 
<p><br> </p> 
<h5>3.3 URLScheme 配置：</h5> 
<p><img src="https://images2.imgbox.com/39/d7/bMB4A2J5_o.jpg" alt=""><br> </p> 
<h5> 3.4 针对ios9以后，需要添加白名单。 </h5> 
<p>在info.plist文件中加入 LSApplicationQueriesSchemes </p> 
<p><img src="https://images2.imgbox.com/22/7c/ug5U4DOv_o.jpg" alt=""><br> </p> 
<p>对应的info.plist 的source code 为</p> 
<p></p> 
<pre><code class="language-objc">&lt;key&gt;LSApplicationQueriesSchemes&lt;/key&gt;
	&lt;array&gt;
		&lt;string&gt;mqqapi&lt;/string&gt;
		&lt;string&gt;mqq&lt;/string&gt;
		&lt;string&gt;mqqOpensdkSSoLogin&lt;/string&gt;
		&lt;string&gt;mqqconnect&lt;/string&gt;
		&lt;string&gt;mqqopensdkdataline&lt;/string&gt;
		&lt;string&gt;mqqopensdkgrouptribeshare&lt;/string&gt;
		&lt;string&gt;mqqopensdkfriend&lt;/string&gt;
		&lt;string&gt;mqqopensdkapi&lt;/string&gt;
		&lt;string&gt;mqqopensdkapiV2&lt;/string&gt;
		&lt;string&gt;mqqopensdkapiV3&lt;/string&gt;
		&lt;string&gt;mqzoneopensdk&lt;/string&gt;
		&lt;string&gt;wtloginmqq&lt;/string&gt;
		&lt;string&gt;wtloginmqq2&lt;/string&gt;
		&lt;string&gt;mqqwpa&lt;/string&gt;
		&lt;string&gt;mqzone&lt;/string&gt;
		&lt;string&gt;mqzonev2&lt;/string&gt;
		&lt;string&gt;mqzoneshare&lt;/string&gt;
		&lt;string&gt;wtloginqzone&lt;/string&gt;
		&lt;string&gt;mqzonewx&lt;/string&gt;
		&lt;string&gt;mqzoneopensdkapiV2&lt;/string&gt;
		&lt;string&gt;mqzoneopensdkapi19&lt;/string&gt;
		&lt;string&gt;mqzoneopensdkapi&lt;/string&gt;
		&lt;string&gt;mqzoneopensdk&lt;/string&gt;
	&lt;/array&gt;</code></pre> 
<p></p> 
<h5> 3.5 <strong> 针对iOS9默认使用https,现在先还原成http请求方式。</strong></h5> 
<p>  <span style="font-family:KaiTi_GB2312; font-size:14px">在Info.plist中添加</span><code style="padding:0px">NSAppTransportSecurity</code><span style="font-family:KaiTi_GB2312; font-size:14px">类型</span><code style="padding:0px">Dictionary</code><span style="font-family:KaiTi_GB2312; font-size:14px">。</span></p> 
<p><span style="font-family:KaiTi_GB2312; font-size:14px"> 在</span><code style="padding:0px">NSAppTransportSecurity</code><span style="font-family:KaiTi_GB2312; font-size:14px">下添加</span><code style="padding:0px">NSAllowsArbitraryLoads</code><span style="font-family:KaiTi_GB2312; font-size:14px">类型</span><code style="padding:0px">Boolean</code><span style="font-family:KaiTi_GB2312; font-size:14px">,值设为</span><code style="padding:0px">YES</code><span style="font-family:KaiTi_GB2312; font-size:14px">    </span></p> 
<p><span style="font-family:KaiTi_GB2312; font-size:14px">      第一步：在plist中添加NSAppTransportSecurity项，此项为NSDictionary</span></p> 
<p><span style="font-family:KaiTi_GB2312; font-size:14px">      第二步：在NSAppTransportSecurity下添加   NSAllowsArbitraryLoads类型为Boolean，value为YES</span></p> 
<p></p> 
<p style="font-family:'Microsoft YaHei'; padding-top:0px; padding-bottom:0px; font-size:14px; color:rgb(63,63,63); line-height:30px"> <br> </p> 
<h4>4. 开始码代码了， 最欢乐的时刻：</h4> 
<p> 1. 在刚刚新建的项目中 appdelegate.m， 添加代码：</p> 
<p>          1.引入头文件 ： </p> 
<p>          </p> 
<pre><code class="language-objc">#import &lt;TencentOpenAPI/QQApiInterface.h&gt;
#import &lt;TencentOpenAPI/TencentOAuth.h&gt;</code></pre> 
<p></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo; color:rgb(255,70,71)"> <span style=""></span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo; color:rgb(255,70,71)"> <span style=""></span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style=""><span style="color:#ff4647">  </span> 2. 并遵循代理</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style=""></span></p> 
<pre><code class="language-objc">@interface AppDelegate ()&lt;QQApiInterfaceDelegate&gt;
@end</code></pre> 
<br> 
<p></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style=""><span style="color:#ff4647">  </span>3. 在添加跳转的请求方法</span></p> 
<p>      </p> 
<pre><code class="language-objc">-(BOOL)application:(UIApplication *)app openURL:(NSURL *)url options:(NSDictionary&lt;NSString *,id&gt; *)options{
    /**
     处理由手Q唤起的跳转请求
     \param url 待处理的url跳转请求
     \param delegate 第三方应用用于处理来至QQ请求及响应的委托对象
     \return 跳转请求处理结果，YES表示成功处理，NO表示不支持的请求协议或处理失败
     */
    [QQApiInterface handleOpenURL:url delegate:self];
    return [TencentOAuth HandleOpenURL:url];
}


/**
 处理来至QQ的请求
 */
- (void)onReq:(QQBaseReq *)req{
    NSLog(@" ----req %@",req);
}

/**
 处理来至QQ的响应
 */
- (void)onResp:(QQBaseResp *)resp{
     NSLog(@" ----resp %@",resp);
}

/**
 处理QQ在线状态的回调
 */
- (void)isOnlineResponse:(NSDictionary *)response{

}
</code></pre> 
<br> 现在就是具体的登录controller.m了。 
<p></p> 
<p><br> </p> 
<p>授权相关的字段</p> 
<p></p> 
<pre><code class="language-objc">/** 发表一条说说到QQ空间(&lt;b&gt;需要申请权限&lt;/b&gt;) */
FOUNDATION_EXTERN NSString *const kOPEN_PERMISSION_ADD_TOPIC;

/** 发表一篇日志到QQ空间(&lt;b&gt;需要申请权限&lt;/b&gt;) */
FOUNDATION_EXTERN NSString *const kOPEN_PERMISSION_ADD_ONE_BLOG;

/** 创建一个QQ空间相册(&lt;b&gt;需要申请权限&lt;/b&gt;) */
FOUNDATION_EXTERN NSString *const kOPEN_PERMISSION_ADD_ALBUM;

/** 上传一张照片到QQ空间相册(&lt;b&gt;需要申请权限&lt;/b&gt;) */
FOUNDATION_EXTERN NSString *const kOPEN_PERMISSION_UPLOAD_PIC;

/** 获取用户QQ空间相册列表(&lt;b&gt;需要申请权限&lt;/b&gt;) */
FOUNDATION_EXTERN NSString *const kOPEN_PERMISSION_LIST_ALBUM;

/** 同步分享到QQ空间、腾讯微博 */
FOUNDATION_EXTERN NSString *const kOPEN_PERMISSION_ADD_SHARE;

/** 验证是否认证空间粉丝 */
FOUNDATION_EXTERN NSString *const kOPEN_PERMISSION_CHECK_PAGE_FANS;

/** 获取登录用户自己的详细信息 */
FOUNDATION_EXTERN NSString *const kOPEN_PERMISSION_GET_INFO;

/** 获取其他用户的详细信息 */
FOUNDATION_EXTERN NSString *const kOPEN_PERMISSION_GET_OTHER_INFO;

/** 获取会员用户基本信息 */
FOUNDATION_EXTERN NSString *const kOPEN_PERMISSION_GET_VIP_INFO;

/** 获取会员用户详细信息 */
FOUNDATION_EXTERN NSString *const kOPEN_PERMISSION_GET_VIP_RICH_INFO;

/** 获取用户信息 */
FOUNDATION_EXTERN NSString *const kOPEN_PERMISSION_GET_USER_INFO;

/** 移动端获取用户信息 */
FOUNDATION_EXTERN NSString *const kOPEN_PERMISSION_GET_SIMPLE_USER_INFO;</code></pre> 
<br> 
<br> 
<p></p> 
<p>直接上源码， 源码里面有注释，一看就明白了</p> 
<p><br> </p> 
<p></p> 
<pre><code class="language-objc">//
//  ViewController.m
//  QQLoginDemo
//
//  Created by 张国荣 on 16/6/17.
//  Copyright © 2016年 BateOrganization. All rights reserved.
//

#import "ViewController.h"

#import &lt;TencentOpenAPI/TencentOAuth.h&gt;
#import &lt;TencentOpenAPI/TencentApiInterface.h&gt;

#define APP_ID @"你的appid"
@interface ViewController ()&lt;TencentSessionDelegate&gt;
{
    TencentOAuth *_tencentOAuth;
    NSMutableArray *_permissionArray;   //权限列表
}
@end

@implementation ViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    
    self.view.backgroundColor = [UIColor whiteColor];
}


- (IBAction)loginAction:(id)sender {
    _tencentOAuth=[[TencentOAuth alloc]initWithAppId:APP_ID andDelegate:self];
    
    //设置权限数据 ， 具体的权限名，在sdkdef.h 文件中查看。
    _permissionArray = [NSMutableArray arrayWithObjects: kOPEN_PERMISSION_GET_SIMPLE_USER_INFO,nil];
    
    //登录操作
    [_tencentOAuth authorize:_permissionArray inSafari:NO];
}

/**
 * 登录成功后的回调
 */
- (void)tencentDidLogin{
    
    /** Access Token凭证，用于后续访问各开放接口 */
    if (_tencentOAuth.accessToken) {
        
        //获取用户信息。 调用这个方法后，qq的sdk会自动调用
        //- (void)getUserInfoResponse:(APIResponse*) response
        //这个方法就是 用户信息的回调方法。
        
        [_tencentOAuth getUserInfo];
    }else{
    
        NSLog(@"accessToken 没有获取成功");
    }
    
}

/**
 * 登录失败后的回调
 * \param cancelled 代表用户是否主动退出登录
 */
- (void)tencentDidNotLogin:(BOOL)cancelled{
    if (cancelled) {
        NSLog(@" 用户点击取消按键,主动退出登录");
    }else{
        NSLog(@"其他原因， 导致登录失败");
    }
}

/**
 * 登录时网络有问题的回调
 */
- (void)tencentDidNotNetWork{
    NSLog(@"没有网络了， 怎么登录成功呢");
}


/**
 * 因用户未授予相应权限而需要执行增量授权。在用户调用某个api接口时，如果服务器返回操作未被授权，则触发该回调协议接口，由第三方决定是否跳转到增量授权页面，让用户重新授权。
 * \param tencentOAuth 登录授权对象。
 * \param permissions 需增量授权的权限列表。
 * \return 是否仍然回调返回原始的api请求结果。
 * \note 不实现该协议接口则默认为不开启增量授权流程。若需要增量授权请调用\ref TencentOAuth#incrAuthWithPermissions: \n注意：增量授权时用户可能会修改登录的帐号
 */
- (BOOL)tencentNeedPerformIncrAuth:(TencentOAuth *)tencentOAuth withPermissions:(NSArray *)permissions{
    
    // incrAuthWithPermissions是增量授权时需要调用的登录接口
    // permissions是需要增量授权的权限列表
    [tencentOAuth incrAuthWithPermissions:permissions];
    return NO; // 返回NO表明不需要再回传未授权API接口的原始请求结果；
    // 否则可以返回YES
}

/**
 * [该逻辑未实现]因token失效而需要执行重新登录授权。在用户调用某个api接口时，如果服务器返回token失效，则触发该回调协议接口，由第三方决定是否跳转到登录授权页面，让用户重新授权。
 * \param tencentOAuth 登录授权对象。
 * \return 是否仍然回调返回原始的api请求结果。
 * \note 不实现该协议接口则默认为不开启重新登录授权流程。若需要重新登录授权请调用\ref TencentOAuth#reauthorizeWithPermissions: \n注意：重新登录授权时用户可能会修改登录的帐号
 */
- (BOOL)tencentNeedPerformReAuth:(TencentOAuth *)tencentOAuth{
    return YES;
}

/**
 * 用户通过增量授权流程重新授权登录，token及有效期限等信息已被更新。
 * \param tencentOAuth token及有效期限等信息更新后的授权实例对象
 * \note 第三方应用需更新已保存的token及有效期限等信息。
 */
- (void)tencentDidUpdate:(TencentOAuth *)tencentOAuth{
    NSLog(@"增量授权完成");
    if (tencentOAuth.accessToken
        &amp;&amp; 0 != [tencentOAuth.accessToken length])
    { // 在这里第三方应用需要更新自己维护的token及有效期限等信息
        // **务必在这里检查用户的openid是否有变更，变更需重新拉取用户的资料等信息** _labelAccessToken.text = tencentOAuth.accessToken;
    }
    else
    {
        NSLog(@"增量授权不成功，没有获取accesstoken");
    }

}

/**
 * 用户增量授权过程中因取消或网络问题导致授权失败
 * \param reason 授权失败原因，具体失败原因参见sdkdef.h文件中\ref UpdateFailType
 */
- (void)tencentFailedUpdate:(UpdateFailType)reason{
    
    switch (reason)
    {
        case kUpdateFailNetwork:
        {
            //            _labelTitle.text=@"增量授权失败，无网络连接，请设置网络";
            NSLog(@"增量授权失败，无网络连接，请设置网络");
            break;
        }
        case kUpdateFailUserCancel:
        {
            //            _labelTitle.text=@"增量授权失败，用户取消授权";
            NSLog(@"增量授权失败，用户取消授权");
            break;
        }
        case kUpdateFailUnknown:
        default:
        {
            NSLog(@"增量授权失败，未知错误");
            break;
        }
    }

    
}

/**
 * 获取用户个人信息回调
 * \param response API返回结果，具体定义参见sdkdef.h文件中\ref APIResponse
 * \remarks 正确返回示例: \snippet example/getUserInfoResponse.exp success
 *          错误返回示例: \snippet example/getUserInfoResponse.exp fail
 */
- (void)getUserInfoResponse:(APIResponse*) response{
    NSLog(@" response %@",response);
}

- (void)didReceiveMemoryWarning {
    [super didReceiveMemoryWarning];
    // Dispose of any resources that can be recreated.
}

@end
</code></pre> 
<br> 
<br> 
<p></p> 
<p><br> </p> 
<p><br> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/49a5ec2717c6d7fc2a7fb6aac1aa00c0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">深入理解LINUX下动态库链接器/加载器ld-linux.so.2</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f74502d4a4e4918b80d545f83d10d8f1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">png图片尺寸大小调整</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>