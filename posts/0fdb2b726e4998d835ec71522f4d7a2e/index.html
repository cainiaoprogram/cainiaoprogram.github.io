<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Filter 过滤器--基本原理--Filter 过滤器生命周期--过滤器链--注意事项和细节--全部应用实例--综合代码示例 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Filter 过滤器--基本原理--Filter 过滤器生命周期--过滤器链--注意事项和细节--全部应用实例--综合代码示例" />
<meta property="og:description" content="目录
Filter 过滤器
Filter 过滤器说明
过滤器介绍
4. 应用场景
Filter 过滤器基本原理
代码示例
login.jsp
LoginCLServlet.java
admin.jsp
ManageFilter.java
xml配置
Filter 过滤器 url-pattern
Filter 过滤器生命周期
● Filter 生命周期图
FilterConfig
● FilterConfig 说明
应用实例
WyxFilterConfig web.xml
FilterChain 过滤器链
基本原理示意图
应用实例 AFilter.java
BFilter.java
hi.jsp
xml
FilterChain 注意事项和细节
6. 小结：
综合代码示例
运行效果图
topic.jsp
TopicServlet.java
配置过滤器
showTopic.jsp
Filter 过滤器 Filter 过滤器说明 为啥要过滤器-需求示意图
过滤器介绍 1. Filter 过滤器它是 JavaWeb 的三大组件之一(Servlet 程序、Listener 监听器、Filter 过滤器)
2. Filter 过滤器是 JavaEE 的规范，是接口
3. Filter 过滤器它的作用是：拦截请求，过滤响应。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/0fdb2b726e4998d835ec71522f4d7a2e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-29T17:18:50+08:00" />
<meta property="article:modified_time" content="2023-04-29T17:18:50+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Filter 过滤器--基本原理--Filter 过滤器生命周期--过滤器链--注意事项和细节--全部应用实例--综合代码示例</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="Filter%20%E8%BF%87%E6%BB%A4%E5%99%A8-toc" style="margin-left:0px;"><a href="#Filter%20%E8%BF%87%E6%BB%A4%E5%99%A8" rel="nofollow">Filter 过滤器</a></p> 
<p id="Filter%20%E8%BF%87%E6%BB%A4%E5%99%A8%E8%AF%B4%E6%98%8E-toc" style="margin-left:80px;"><a href="#Filter%20%E8%BF%87%E6%BB%A4%E5%99%A8%E8%AF%B4%E6%98%8E" rel="nofollow">Filter 过滤器说明</a></p> 
<p id="%E8%BF%87%E6%BB%A4%E5%99%A8%E4%BB%8B%E7%BB%8D-toc" style="margin-left:40px;"><a href="#%E8%BF%87%E6%BB%A4%E5%99%A8%E4%BB%8B%E7%BB%8D" rel="nofollow">过滤器介绍</a></p> 
<p id="4.%20%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-toc" style="margin-left:80px;"><a href="#4.%20%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF" rel="nofollow">4. 应用场景</a></p> 
<p id="Filter%20%E8%BF%87%E6%BB%A4%E5%99%A8%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86-toc" style="margin-left:40px;"><a href="#Filter%20%E8%BF%87%E6%BB%A4%E5%99%A8%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86" rel="nofollow">Filter 过滤器基本原理</a></p> 
<p id="%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B-toc" style="margin-left:40px;"><a href="#%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B" rel="nofollow">代码示例</a></p> 
<p id="login.jsp-toc" style="margin-left:80px;"><a href="#login.jsp" rel="nofollow">login.jsp</a></p> 
<p id="LoginCLServlet.java-toc" style="margin-left:80px;"><a href="#LoginCLServlet.java" rel="nofollow">LoginCLServlet.java</a></p> 
<p id="admin.jsp-toc" style="margin-left:80px;"><a href="#admin.jsp" rel="nofollow">admin.jsp</a></p> 
<p id="ManageFilter.java-toc" style="margin-left:80px;"><a href="#ManageFilter.java" rel="nofollow">ManageFilter.java</a></p> 
<p id="xml%E9%85%8D%E7%BD%AE-toc" style="margin-left:80px;"><a href="#xml%E9%85%8D%E7%BD%AE" rel="nofollow">xml配置</a></p> 
<p id="Filter%20%E8%BF%87%E6%BB%A4%E5%99%A8%20url-pattern-toc" style="margin-left:40px;"><a href="#Filter%20%E8%BF%87%E6%BB%A4%E5%99%A8%20url-pattern" rel="nofollow">Filter 过滤器 url-pattern</a></p> 
<p id="Filter%20%E8%BF%87%E6%BB%A4%E5%99%A8%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F-toc" style="margin-left:40px;"><a href="#Filter%20%E8%BF%87%E6%BB%A4%E5%99%A8%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F" rel="nofollow">Filter 过滤器生命周期</a></p> 
<p id="%E2%97%8F%20Filter%20%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%9B%BE-toc" style="margin-left:80px;"><a href="#%E2%97%8F%20Filter%20%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%9B%BE" rel="nofollow">● Filter 生命周期图</a></p> 
<p id="FilterConfig-toc" style="margin-left:40px;"><a href="#FilterConfig" rel="nofollow">FilterConfig</a></p> 
<p id="%E2%97%8F%20FilterConfig%20%E8%AF%B4%E6%98%8E-toc" style="margin-left:80px;"><a href="#%E2%97%8F%20FilterConfig%20%E8%AF%B4%E6%98%8E" rel="nofollow">● FilterConfig 说明</a></p> 
<p id="%E5%BA%94%E7%94%A8%E5%AE%9E%E4%BE%8B-toc" style="margin-left:40px;"><a href="#%E5%BA%94%E7%94%A8%E5%AE%9E%E4%BE%8B" rel="nofollow">应用实例</a></p> 
<p id="%C2%A0WyxFilterConfig%C2%A0-toc" style="margin-left:80px;"><a href="#%C2%A0WyxFilterConfig%C2%A0" rel="nofollow"> WyxFilterConfig </a></p> 
<p id="%C2%A0web.xml-toc" style="margin-left:80px;"><a href="#%C2%A0web.xml" rel="nofollow"> web.xml</a></p> 
<p id="FilterChain%20%E8%BF%87%E6%BB%A4%E5%99%A8%E9%93%BE-toc" style="margin-left:40px;"><a href="#FilterChain%20%E8%BF%87%E6%BB%A4%E5%99%A8%E9%93%BE" rel="nofollow">FilterChain 过滤器链</a></p> 
<p id="%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86%E7%A4%BA%E6%84%8F%E5%9B%BE-toc" style="margin-left:80px;"><a href="#%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86%E7%A4%BA%E6%84%8F%E5%9B%BE" rel="nofollow">基本原理示意图</a></p> 
<p id="%E5%BA%94%E7%94%A8%E5%AE%9E%E4%BE%8B%C2%A0-toc" style="margin-left:40px;"><a href="#%E5%BA%94%E7%94%A8%E5%AE%9E%E4%BE%8B%C2%A0" rel="nofollow">应用实例 </a></p> 
<p id="%C2%A0AFilter.java-toc" style="margin-left:80px;"><a href="#%C2%A0AFilter.java" rel="nofollow"> AFilter.java</a></p> 
<p id="BFilter.java-toc" style="margin-left:80px;"><a href="#BFilter.java" rel="nofollow">BFilter.java</a></p> 
<p id="hi.jsp-toc" style="margin-left:80px;"><a href="#hi.jsp" rel="nofollow">hi.jsp</a></p> 
<p id="xml-toc" style="margin-left:80px;"><a href="#xml" rel="nofollow">xml</a></p> 
<p id="FilterChain%20%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%E5%92%8C%E7%BB%86%E8%8A%82-toc" style="margin-left:40px;"><a href="#FilterChain%20%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%E5%92%8C%E7%BB%86%E8%8A%82" rel="nofollow">FilterChain 注意事项和细节</a></p> 
<p id="6.%20%E5%B0%8F%E7%BB%93%EF%BC%9A-toc" style="margin-left:80px;"><a href="#6.%20%E5%B0%8F%E7%BB%93%EF%BC%9A" rel="nofollow">6. 小结：</a></p> 
<p id="%E7%BB%BC%E5%90%88%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B-toc" style="margin-left:40px;"><a href="#%E7%BB%BC%E5%90%88%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B" rel="nofollow">综合代码示例</a></p> 
<p id="%E8%BF%90%E8%A1%8C%E6%95%88%E6%9E%9C%E5%9B%BE-toc" style="margin-left:80px;"><a href="#%E8%BF%90%E8%A1%8C%E6%95%88%E6%9E%9C%E5%9B%BE" rel="nofollow">运行效果图</a></p> 
<p id="%C2%A0topic.jsp-toc" style="margin-left:80px;"><a href="#%C2%A0topic.jsp" rel="nofollow"> topic.jsp</a></p> 
<p id="TopicServlet.java-toc" style="margin-left:80px;"><a href="#TopicServlet.java" rel="nofollow">TopicServlet.java</a></p> 
<p id="%E9%85%8D%E7%BD%AE%E8%BF%87%E6%BB%A4%E5%99%A8-toc" style="margin-left:80px;"><a href="#%E9%85%8D%E7%BD%AE%E8%BF%87%E6%BB%A4%E5%99%A8" rel="nofollow">配置过滤器</a></p> 
<p id="showTopic.jsp-toc" style="margin-left:80px;"><a href="#showTopic.jsp" rel="nofollow">showTopic.jsp</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2 id="Filter%20%E8%BF%87%E6%BB%A4%E5%99%A8" style="margin-left:0;text-align:center;">Filter 过滤器</h2> 
<h4 id="Filter%20%E8%BF%87%E6%BB%A4%E5%99%A8%E8%AF%B4%E6%98%8E" style="margin-left:0cm;">Filter 过滤器说明</h4> 
<p style="margin-left:0;text-align:justify;">为啥要过滤器-需求示意图</p> 
<p><img alt="" height="420" src="https://images2.imgbox.com/ce/e6/1JEUWJHm_o.png" width="865"></p> 
<p></p> 
<p style="margin-left:0;text-align:justify;"></p> 
<h3 id="%E8%BF%87%E6%BB%A4%E5%99%A8%E4%BB%8B%E7%BB%8D" style="margin-left:0;text-align:justify;">过滤器介绍</h3> 
<p style="margin-left:0;text-align:justify;">1. Filter 过滤器它是 JavaWeb 的三大组件之一(Servlet 程序、Listener 监听器、Filter 过滤器)</p> 
<p style="margin-left:0;text-align:justify;">2. Filter 过滤器是 JavaEE 的规范，是接口</p> 
<p style="margin-left:0;text-align:justify;">3. Filter 过滤器它的作用是：拦截请求，过滤响应。</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="258" src="https://images2.imgbox.com/6c/2b/rBxtzhjC_o.png" width="865"></p> 
<p></p> 
<h4 id="4.%20%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF" style="margin-left:0cm;">4. 应用场景</h4> 
<p style="margin-left:0;text-align:justify;">● 权限检查</p> 
<p style="margin-left:0;text-align:justify;">● 日记操作</p> 
<p style="margin-left:0;text-align:justify;">● 事务管理</p> 
<h3 id="Filter%20%E8%BF%87%E6%BB%A4%E5%99%A8%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86" style="margin-left:0;text-align:justify;">Filter 过滤器基本原理</h3> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="349" src="https://images2.imgbox.com/70/13/Y6Rzoc3o_o.png" width="865"></p> 
<h3 id="%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B" style="margin-left:0px;text-align:justify;">代码示例</h3> 
<p>需求: 在 web 工程下，有后台管理目录 manage，要求该目录下所有资源（html、图片、jsp 、Servlet 等）用户登录后才能访问 </p> 
<h4 id="login.jsp">login.jsp</h4> 
<pre><code class="language-cpp">&lt;%@ page contentType="text/html;charset=UTF-8" language="java" %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;管理后台登录&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;管理后台登录&lt;/h1&gt;
&lt;%
    System.out.println("request=" + request);
%&gt;
&lt;form action="&lt;%=request.getContextPath() %&gt;/loginCheckServlet" method="post"&gt;
    u：&lt;input type="text" name="username"/&gt; &lt;br/&gt;&lt;br/&gt;
    p：&lt;input type="password" name="password"/&gt; &lt;br/&gt;&lt;br/&gt;
    &lt;input type="submit" value="用户登录"/&gt;&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre> 
<h4 id="LoginCLServlet.java">LoginCLServlet.java</h4> 
<pre><code class="language-java">public class LoginCheckServlet extends HttpServlet {
    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        //获取到用户名和密码-&gt;DB
        //假设密码是123456, 就可以通过
        String username = request.getParameter("username");
        String password = request.getParameter("password");
        System.out.println("request=" + request);
        if("123456".equals(password)) {

            //合法, 讲用户名，加入session
            request.getSession().setAttribute("username", username);
            //请求转发到admin.jsp
            request.getRequestDispatcher("/manage/admin.jsp")
                    .forward(request,response);
        } else {
            //不合法, 返回登录页面
            request.getRequestDispatcher("/login.jsp")
                    .forward(request,response);

        }
    }

    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        doPost(request, response);
    }
}</code></pre> 
<h4 id="admin.jsp">admin.jsp</h4> 
<pre><code class="language-cpp">&lt;%@ page contentType="text/html;charset=UTF-8" language="java" %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;后台管理&lt;/title&gt;
    &lt;base href="&lt;%=request.getContextPath() %&gt;/manage/"/&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;后台管理&lt;/h1&gt;
&lt;%
    //验证request对象是和前面的filter是一个对象
    System.out.println("request=" + request);
%&gt;
&lt;a href="#"&gt;用户列表&lt;/a&gt;||&lt;a href="#"&gt;添加用户&lt;/a&gt;||&lt;a href="#"&gt;删除用户&lt;/a&gt;
&lt;hr/&gt;
&lt;img src="shunping.jpg" height="300"/&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre> 
<h4 id="ManageFilter.java">ManageFilter.java</h4> 
<blockquote> 
 <p>1. filter在web项目启动时, 由tomcat 来创建filter实例, 只会创建一个<br> 2. 会调用filter默认的无参构造器, 同时会调用 init方法, 只会调用一次<br> 3. 在创建filter实例时，同时会创建一个FilterConfig对象,并通过init方法传入<br> 4. 通过FilterConfig对象，程序员可以获取该filter的相关配置信息<br> 5. 当一个http请求和该filter的的url-patter匹配时，就会调用doFilter方法</p> 
 <p>6. 在调用doFilter方法时,tomcat会同时创建ServletRequest 和ServletResponse 和 FilterChain对象, 并通过doFilter传入.<br> 7. 如果后面的请求目标资源(jsp,servlet..) 会使用到request，和 response，那么会继续传递 </p> 
</blockquote> 
<pre><code class="language-java">/**
 * 1. filter在web项目启动时, 由tomcat 来创建filter实例, 只会创建一个
 * 2. 会调用filter默认的无参构造器, 同时会调用 init方法, 只会调用一次
 * 3. 在创建filter实例时，同时会创建一个FilterConfig对象,并通过init方法传入
 * 4. 通过FilterConfig对象，程序员可以获取该filter的相关配置信息
 * 5. 当一个http请求和该filter的的url-patter匹配时，就会调用doFilter方法
 * 6. 在调用doFilter方法时,tomcat会同时创建ServletRequest 和 ServletResponse 和 FilterChain对象
 * , 并通过doFilter传入.
 * 7. 如果后面的请求目标资源(jsp,servlet..) 会使用到request，和 response，那么会继续传递
 */
public class ManageFilter implements Filter {

    private int count = 0;

    @Override
    public void init(FilterConfig filterConfig) throws ServletException {
        //当Tomcat 创建 Filter创建，就会调用该方法，进行初始化
        //提醒：回忆我们自己实现tomcat底层机制+servlet程序
        
        System.out.println("ManageFilter init被调用...");
    }

    @Override
    public void doFilter(ServletRequest servletRequest,
                         ServletResponse servletResponse,
                         FilterChain filterChain) throws IOException, ServletException {

        System.out.println("ManageFilter doFilter() 被调用=" + (++count));

        //到每次调用该filter时，doFilter就会被调用

        //如果这里，没有调用继续请求的方法，则就停止
        //如果继续访问目标资源-&gt; 等价于放行

        //说明：在调用过滤器前，servletRequest对象=request已经被创建并封装
        //所以：我们这里就可以通过servletRequest获取很多信息, 比如访问url , session
        //比如访问的参数 ... 就可以做事务管理，数据获取，日志管理等
        //获取到session
        //可以继续使用 httpServletRequest 方法.
        HttpServletRequest httpServletRequest = (HttpServletRequest) servletRequest;
        System.out.println("输入密码=" + httpServletRequest.getParameter("password"));
        HttpSession session = httpServletRequest.getSession();
        //获取username session对象, 还可以继续使用
        Object username = session.getAttribute("username");
        if (username != null) {
            //filterChain.doFilter(servletRequest, servletResponse)
            //1. 继续访问目标资源url
            //2. servletRequest 和 servletResponse 对象会传递给目标资源/文件
            //3. 一定要理解filter传递的两个对象，再后面的servlet/jsp 是同一个对象(指的是在一次http请求)
            System.out.println("servletRequest=" + servletRequest);
            System.out.println("日志信息==");
            System.out.println("访问的用户名=" + username.toString());
            System.out.println("访问的url=" + httpServletRequest.getRequestURL());
            System.out.println("访问的IP=" + httpServletRequest.getRemoteAddr());
            filterChain.doFilter(servletRequest, servletResponse);
        } else {//说明没有登录过..回到登录页面
            servletRequest.getRequestDispatcher("/login.jsp").
                    forward(servletRequest, servletResponse);
        }
    }

    @Override
    public void destroy() {
        //当filter被销毁时，会调用该方法
        System.out.println("ManageFilter destroy()被调用..");
    }
}</code></pre> 
<h4 id="xml%E9%85%8D%E7%BD%AE">xml配置</h4> 
<blockquote> 
 <p>filter一般写在其它servlet的前面</p> 
 <ul><li>1. 观察我们发现filter 配置和 servlet 非常相似. filter也是被tomcat管理和维护</li><li>2. url-pattern 就是当请求的url 和 匹配的时候，就会调用该filter</li><li>3. /manage/* 第一个 / 解析成 http://ip:port/工程路径</li><li>4. 完整的路径就是 http://ip:port/工程路径/manage/* 当请求的资源url满足该条件时都会调用filter , /manage/admin.jsp </li></ul> 
</blockquote> 
<pre><code class="language-XML">    &lt;!--解读:filter一般写在其它servlet的前面
        1. 观察我们发现filter 配置和 servlet 非常相似. filter也是被tomcat管理和维护
        2. url-pattern 就是当请求的url 和 匹配的时候，就会调用该filter
        3. /manage/* 第一个 / 解析成 http://ip:port/工程路径
        4. 完整的路径就是 http://ip:port/工程路径/manage/* 当请求的资源url满足该条件时
        都会调用filter , /manage/admin.jsp
    --&gt;
    &lt;filter&gt;
        &lt;filter-name&gt;ManageFilter&lt;/filter-name&gt;
        &lt;filter-class&gt;com.filter.ManageFilter&lt;/filter-class&gt;
    &lt;/filter&gt;
    &lt;filter-mapping&gt;
        &lt;filter-name&gt;ManageFilter&lt;/filter-name&gt;
        &lt;url-pattern&gt;/manage/*&lt;/url-pattern&gt;
    &lt;/filter-mapping&gt;</code></pre> 
<h3 id="Filter%20%E8%BF%87%E6%BB%A4%E5%99%A8%20url-pattern" style="margin-left:0;text-align:justify;">Filter 过滤器 url-pattern</h3> 
<p style="margin-left:0;text-align:justify;">1、url-pattern: Filter的拦截路径,即浏览器在请求什么位置的资源时，过滤器会进行拦截过滤</p> 
<p style="margin-left:0;text-align:justify;">2.、精确匹配 &lt;url-pattern&gt;/a.jsp&lt;/url-pattern&gt; 对应的 请求地址 http://ip[域名]:port/工程路径/a.jsp 会拦截</p> 
<p style="margin-left:0;text-align:justify;">3、目录匹配 &lt;url-pattern&gt;/manage/*&lt;/url-pattern&gt;对应的 请求地址 http://ip[域名]:port/工程路径/manage/xx , 即 web 工程 manage 目录下所有资源 会拦截</p> 
<p style="margin-left:0;text-align:justify;">4、后缀名匹配 &lt;url-pattern&gt;*.jsp&lt;/url-pattern&gt; 后缀名可变，比如 *.action *.do 等等对应的 请求地址 http://ip[域名]:port/工程路径/xx.jsp , 后缀名为 .jsp 请求会拦截</p> 
<p style="margin-left:0;text-align:justify;">5、Filter 过滤器它只关心请求的地址是否匹配，不关心请求的资源是否存在</p> 
<h3 id="Filter%20%E8%BF%87%E6%BB%A4%E5%99%A8%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F" style="margin-left:0;text-align:justify;">Filter 过滤器生命周期</h3> 
<h4 id="%E2%97%8F%20Filter%20%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%9B%BE" style="margin-left:0cm;">● Filter 生命周期图</h4> 
<p><img alt="" height="486" src="https://images2.imgbox.com/d3/e0/XQ15Srd9_o.png" width="865"></p> 
<p> </p> 
<p style="margin-left:0;text-align:justify;">1. filter在web项目启动时, 由tomcat 来创建filter实例, 只会创建一个</p> 
<p style="margin-left:0;text-align:justify;">2. 会调用filter默认的无参构造器, 同时会调用 init方法, 只会调用一次</p> 
<p style="margin-left:0;text-align:justify;">3. 在创建filter实例时，同时会创建一个FilterConfig对象,并通过init方法传入</p> 
<p style="margin-left:0;text-align:justify;">4. 通过FilterConfig对象，程序员可以获取该filter的相关配置信息</p> 
<p style="margin-left:0;text-align:justify;">5. 当一个http请求和该filter的的url-patter匹配时，就会调用doFilter方法</p> 
<p style="margin-left:0;text-align:justify;">6. 在调用doFilter方法时,tomcat会同时创建ServletRequest 和 ServletResponse 和 FilterChain对象, 并通过doFilter传入.</p> 
<p style="margin-left:0;text-align:justify;">7. 如果后面的请求目标资源(jsp,servlet..) 会使用到request，和 response，那么会继续传递</p> 
<p> </p> 
<h3 id="FilterConfig" style="margin-left:0;text-align:justify;">FilterConfig</h3> 
<p style="margin-left:0;text-align:justify;">● FilterConfig 接口</p> 
<p><img alt="" height="193" src="https://images2.imgbox.com/97/71/P2aswagW_o.png" width="462"></p> 
<p style="margin-left:0;text-align:justify;"></p> 
<h4 id="%E2%97%8F%20FilterConfig%20%E8%AF%B4%E6%98%8E" style="margin-left:0px;text-align:justify;">● FilterConfig 说明</h4> 
<p style="margin-left:0;text-align:justify;">1. FilterConfig 是 Filter 过滤器的配置类</p> 
<p style="margin-left:0;text-align:justify;">2. Tomcat 每次创建 Filter 的时候，也会创建一个 FilterConfig 对象，这里包含了 Filter 配置文件的配置信息。</p> 
<p style="margin-left:0;text-align:justify;">3. FilterConfig 对象作用是获取 filter 过滤器的配置内容</p> 
<h3 id="%E5%BA%94%E7%94%A8%E5%AE%9E%E4%BE%8B">应用实例</h3> 
<h4 id="%C2%A0WyxFilterConfig%C2%A0"> WyxFilterConfig </h4> 
<pre><code class="language-java">public class WyxFilterConfig implements Filter {

    private String ip; //从配置获取的ip

    @Override
    public void init(FilterConfig filterConfig) throws ServletException {
        System.out.println("WyxFilterConfig init() 被调用..");

        //通过filterConfig 获取相关的参数
        String filterName = filterConfig.getFilterName();
        ip = filterConfig.getInitParameter("ip");

        ServletContext servletContext = filterConfig.getServletContext();

        //可以获取到该filter所有的配置参数名
        Enumeration&lt;String&gt; initParameterNames =
                filterConfig.getInitParameterNames();

        //遍历枚举
        while (initParameterNames.hasMoreElements()) {
            System.out.println("名字=" + initParameterNames.nextElement());
        }

        System.out.println("filterName= " + filterName);
        System.out.println("ip= " + ip);
        System.out.println("servletContext= " + servletContext);


    }

    @Override
    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {

        //通过forbidden ip 来进行控制
        //先获取到访问ip

        String remoteAddr = servletRequest.getRemoteAddr();
        if(remoteAddr.contains(ip)) {

            System.out.println("封杀该网段..");
            servletRequest.getRequestDispatcher("/login.jsp").
                    forward(servletRequest,servletResponse);
            return; //直接返回

        }

        //继续访问目标资源
        filterChain.doFilter(servletRequest,servletResponse);
    }

    @Override
    public void destroy() {

    }
}</code></pre> 
<h4 id="%C2%A0web.xml"> web.xml</h4> 
<pre><code class="language-XML">    &lt;filter&gt;
        &lt;filter-name&gt;WyxFilterConfig&lt;/filter-name&gt;
        &lt;filter-class&gt;com.filter.WyxFilterConfig&lt;/filter-class&gt;
        &lt;!--这里就是给该filter配置的参数-根据业务逻辑来设置--&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;ip&lt;/param-name&gt;
            &lt;param-value&gt;127.0&lt;/param-value&gt;
        &lt;/init-param&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;port&lt;/param-name&gt;
            &lt;param-value&gt;8888&lt;/param-value&gt;
        &lt;/init-param&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;email&lt;/param-name&gt;
            &lt;param-value&gt;123@qq.com&lt;/param-value&gt;
        &lt;/init-param&gt;
    &lt;/filter&gt;
    &lt;filter-mapping&gt;
        &lt;filter-name&gt;WyxFilterConfig&lt;/filter-name&gt;
        &lt;url-pattern&gt;/abc/*&lt;/url-pattern&gt;
    &lt;/filter-mapping&gt;</code></pre> 
<h3 id="FilterChain%20%E8%BF%87%E6%BB%A4%E5%99%A8%E9%93%BE" style="margin-left:0;text-align:justify;">FilterChain 过滤器链</h3> 
<p style="margin-left:0;text-align:justify;">一句话: FilterChain: 在处理某些复杂业务时，一个过滤器不够，可以设计多个过滤器共同完成过滤任务，形成过滤器链。</p> 
<h4 id="%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86%E7%A4%BA%E6%84%8F%E5%9B%BE" style="margin-left:0cm;">基本原理示意图</h4> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="635" src="https://images2.imgbox.com/35/1b/TwRvDAz1_o.png" width="865"></p> 
<h3 id="%E5%BA%94%E7%94%A8%E5%AE%9E%E4%BE%8B%C2%A0">应用实例 </h3> 
<p>需求： 演示过滤器链的使用</p> 
<p><img alt="" height="186" src="https://images2.imgbox.com/26/0e/DTFYSdC8_o.png" width="1200"></p> 
<h4 id="%C2%A0AFilter.java"> AFilter.java</h4> 
<pre><code class="language-java">public class AFilter implements Filter {
    @Override
    public void init(FilterConfig filterConfig) throws ServletException {

    }

    @Override
    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {

        System.out.println("AFilter---&gt; 线程id=" +
                Thread.currentThread().getId());

        System.out.println("AFilter doFilter 的前置代码...");
        System.out.println("执行 AFilter doFilter()");
        filterChain.doFilter(servletRequest, servletResponse);
        System.out.println("AFilter doFilter 的后置代码...");
    }

    @Override
    public void destroy() {

    }
}
</code></pre> 
<h4 id="BFilter.java">BFilter.java</h4> 
<pre><code class="language-java">public class BFilter implements Filter {
    @Override
    public void init(FilterConfig filterConfig) throws ServletException {

    }

    @Override
    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {

        System.out.println("BFilter---&gt; 线程id=" +
                Thread.currentThread().getId());

        System.out.println("BFilter doFilter 的前置代码...");

        System.out.println("执行 BFilter doFilter()");
        filterChain.doFilter(servletRequest, servletResponse);
        System.out.println("BFilter doFilter 的后置代码...");
    }

    @Override
    public void destroy() {

    }
}</code></pre> 
<h4 id="hi.jsp">hi.jsp</h4> 
<pre><code class="language-cpp">&lt;%@ page contentType="text/html;charset=UTF-8" language="java" %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;hi&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;admin目录下的 hi.jsp&lt;/h1&gt;
&lt;h1&gt;后台管理&lt;/h1&gt;
&lt;a href="#"&gt;用户列表&lt;/a&gt;||&lt;a href="#"&gt;添加用户&lt;/a&gt;||&lt;a href="#"&gt;删除用户&lt;/a&gt;
&lt;hr/&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre> 
<h4 id="xml">xml</h4> 
<pre><code class="language-XML"> &lt;filter&gt;
        &lt;filter-name&gt;AFilter&lt;/filter-name&gt;
        &lt;filter-class&gt;com.filter.AFilter&lt;/filter-class&gt;
    &lt;/filter&gt;
    &lt;filter-mapping&gt;
        &lt;filter-name&gt;AFilter&lt;/filter-name&gt;
        &lt;url-pattern&gt;/admin/*&lt;/url-pattern&gt;
    &lt;/filter-mapping&gt;

    &lt;filter&gt;
        &lt;filter-name&gt;BFilter&lt;/filter-name&gt;
        &lt;filter-class&gt;com.filter.BFilter&lt;/filter-class&gt;
    &lt;/filter&gt;
    &lt;filter-mapping&gt;
        &lt;filter-name&gt;BFilter&lt;/filter-name&gt;
        &lt;url-pattern&gt;/admin/*&lt;/url-pattern&gt;
    &lt;/filter-mapping&gt;</code></pre> 
<h3 id="FilterChain%20%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%E5%92%8C%E7%BB%86%E8%8A%82" style="margin-left:0;text-align:justify;">FilterChain 注意事项和细节</h3> 
<p style="margin-left:0;text-align:justify;">1. 多个 filter 和目标资源在一次 http 请求，<span style="background-color:#ffff00;">在同一个线程中</span></p> 
<p style="margin-left:0;text-align:justify;">2. 当一个请求 url 和 filter 的 url-pattern 匹配时, 才会被执行, 如果有多个匹配上，就会<span style="background-color:#ffff00;">顺序</span>执行，形成一个 filter 调用链 (底层可以使用一个数据结构搞定)如<span style="background-color:#ffff00;">LinkedHashMap</span></p> 
<p style="margin-left:0;text-align:justify;">3. 多个 filter 共同执行时,因为是一次 http 请求, 使用同一个 request 对象</p> 
<p style="margin-left:0;text-align:justify;">4. 多个 filter 执行顺序，和 web.xml 配置<span style="background-color:#ffff00;">顺序保持</span>一致.</p> 
<p style="margin-left:0;text-align:justify;">5. chain.doFilter(req, resp)方法 将执行下一个过滤器的 doFilter 方法, 如果后面没有过滤器，则执行目标资源。</p> 
<h4 id="6.%20%E5%B0%8F%E7%BB%93%EF%BC%9A" style="margin-left:0cm;">6. 小结：</h4> 
<p style="margin-left:0;text-align:justify;">  注意执行过滤器链时, 顺序是(用前面的案例分析) Http请求 <span style="background-color:#ffff00;">-&gt;</span> A 过滤器 dofilter()<span style="background-color:#ffff00;">-&gt;</span> A 过滤器前置代码 <span style="background-color:#ffff00;">-&gt;</span> A 过滤器 chain.doFilter() <span style="background-color:#ffff00;">-&gt;</span> B 过滤器 dofilter() <span style="background-color:#ffff00;">-&gt;</span> B 过滤器前置代码 <span style="background-color:#ffff00;">-&gt;</span> B过滤器 chain.doFilter() <span style="background-color:#ffff00;">-&gt;</span> 目标文件 -&gt; B过滤器后置代码 <span style="background-color:#ffff00;">-&gt;</span> A过滤器后置代码 -&gt;返回给浏览器页面/数据</p> 
<h3 id="%E7%BB%BC%E5%90%88%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B">综合代码示例</h3> 
<p>● 需求分析: 使用过滤器, 完成如下要求<br> 1) 点击发表评论页面 topic.jsp, 可以在 showTopic.jsp 显示评论内容<br> 2) 如果发表的评论内容,有关键字比如 "苹果" "香蕉", 就返回 topic.jsp, 并提示有禁用词<br> 3) 要求发表评论到 showTopic.jsp 时，经过过滤器的处理<br> 4) 禁用词, 配置在过滤器, 在启动项目时动态的获取, 注意处理中文</p> 
<h4 id="%E8%BF%90%E8%A1%8C%E6%95%88%E6%9E%9C%E5%9B%BE">运行效果图</h4> 
<p></p> 
<p class="img-center"><img alt="" height="194" src="https://images2.imgbox.com/6e/7d/hT4s31pN_o.png" width="190"></p> 
<p></p> 
<p class="img-center"><img alt="" height="169" src="https://images2.imgbox.com/be/6d/Kf1xE8cJ_o.png" width="413"></p> 
<h4 id="%C2%A0topic.jsp"> topic.jsp</h4> 
<pre><code class="language-html">&lt;%@ page contentType="text/html;charset=UTF-8" language="java"%&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;发表对阿凡达电影评论&lt;/h1&gt;
过滤词: 苹果, 香蕉 ${errorInfo}
&lt;form method="post" action="&lt;%=request.getContextPath()%&gt;/topic/showTopic.jsp"&gt;
    用户: &lt;input type="text" name="username"&gt;&lt;br/&gt;
    评论: &lt;textarea rows="10" name="content" cols="20"&gt;&lt;/textarea&gt;&lt;br/&gt;
    &lt;input type="submit" value="发表评论"&gt;
&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre> 
<h4 id="TopicServlet.java">TopicServlet.java</h4> 
<pre><code class="language-java">public class TopicFilter implements Filter {

    //属性-&gt; 存放禁用词
    private String[] forbiddenWords = null;

    @Override
    public void init(FilterConfig filterConfig) throws ServletException {
        //获取禁用词
        String forbiddenword = filterConfig.getInitParameter("forbiddenword");
        forbiddenWords = forbiddenword.split(",");
    }

    @Override
    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {

        //解决从topic.jsp 提交的中文乱码问题
        servletRequest.setCharacterEncoding("utf-8");

        //判断评论是不是有禁用词
        String content = servletRequest.getParameter("content");
        //循环遍历一把，看看有没有禁用词
        for (String forbiddenWord : forbiddenWords) {//java基础
            if (content.contains(forbiddenWord)) {
                //返回topic.jsp
                servletRequest.setAttribute("errorInfo", "你输入的有禁用词");
                servletRequest.getRequestDispatcher("/topic.jsp")
                        .forward(servletRequest, servletResponse);
                return;//返回
            }
        }

        //继续到目标
        filterChain.doFilter(servletRequest, servletResponse);
    }

    @Override
    public void destroy() {

    }
}
</code></pre> 
<h4 id="%E9%85%8D%E7%BD%AE%E8%BF%87%E6%BB%A4%E5%99%A8">配置过滤器</h4> 
<pre><code class="language-XML">&lt;filter&gt;
        &lt;filter-name&gt;TopicFilter&lt;/filter-name&gt;
        &lt;filter-class&gt;com.filter.TopicFilter&lt;/filter-class&gt;
        &lt;!--配置禁用词--&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;forbiddenword&lt;/param-name&gt;
            &lt;param-value&gt;苹果,香蕉&lt;/param-value&gt;
        &lt;/init-param&gt;
    &lt;/filter&gt;
    &lt;filter-mapping&gt;
        &lt;filter-name&gt;TopicFilter&lt;/filter-name&gt;
        &lt;url-pattern&gt;/topic/*&lt;/url-pattern&gt;
    &lt;/filter-mapping&gt;</code></pre> 
<h4 id="showTopic.jsp">showTopic.jsp</h4> 
<pre><code class="language-html">&lt;%@ page contentType="text/html;charset=UTF-8" language="java" %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;你发表的评论是&lt;/h1&gt;
评论内容: &lt;%=request.getParameter("content")%&gt;
&lt;/body&gt;
&lt;/html&gt;

</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d6b6b74d7626622cb0e430856e4d04ff/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Linux下的压缩解压缩命令详解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1c4e04cdb5ed8506231566126712ce1c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">shell作业</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>