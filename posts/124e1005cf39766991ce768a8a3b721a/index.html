<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>React学习笔记7：React使用注意事项 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="React学习笔记7：React使用注意事项" />
<meta property="og:description" content="1. setState setState更新状态的2种写法 方式一：setState(stateChange, [callback])------对象式的setState stateChange为状态改变对象(该对象可以体现出状态的更改)callback是可选的回调函数, 它在状态更新完毕、界面也更新后(render调用后)才被调用 方式二：setState(updater, [callback])------函数式的setState updater为返回stateChange对象的函数updater可以接收到state和propscallback是可选的回调函数, 它在状态更新、界面也更新后(render调用后)才被调用。 总结 对象式的setState是函数式的setState的简写方式(语法糖)
使用原则 以下原则只是建议性的，不是强制性的要求
如果新状态不依赖于原状态 ===&gt; 使用对象方式如果新状态依赖于原状态 ===&gt; 使用函数方式如果需要在setState()执行后获取最新的状态数据，要在第二个callback函数中读取 setState同步VS异步问题
setState 只在合成事件和钩子函数中是“异步”的，在原生事件和 setTimeout 中都是同步的。
合成事件：就是react 在组件中的onClick等都是属于它自定义的合成事件原生事件：比如通过addeventListener添加的，dom中的原生事件 setState的“异步”并不是说内部由异步代码实现，其实本身执行的过程和代码都是同步的，只是合成事件和钩子函数的调用顺序在更新之前，导致在合成事件和钩子函数中没法立马拿到更新后的值，形式了所谓的“异步”，当然可以通过第二个参数 setState(partialState, callback) 中的callback拿到更新后的结果。
setState 的批量更新优化也是建立在“异步”（合成事件、钩子函数）之上的，在原生事件和setTimeout 中不会批量更新，在“异步”中如果对同一个值进行多次 setState ， setState 的批量更新策略会对其进行覆盖，取最后一次的执行，如果是同时 setState 多个不同的值，在更新时会对其进行合并批量更新。
从上图可知，在react中，setState通过一个队列机制实现state的更新。当执行setState时，会把需要更新的state合并后放入状态队列，而不会立刻更新this.state，当进入组件可更新状态时，这个队列机制就会高效的批量的更新state。 import React, { Component } from &#39;react&#39; export default class Demo extends Component { state = { count: 0 } add = () =&gt; { //方式一：对象式的setState // //1.获取原来的count值 // const { count } = this." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/124e1005cf39766991ce768a8a3b721a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-02-19T05:20:43+08:00" />
<meta property="article:modified_time" content="2021-02-19T05:20:43+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">React学习笔记7：React使用注意事项</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="1_setState_0"></a>1. setState</h3> 
<h4><a id="setState2_2"></a>setState更新状态的2种写法</h4> 
<h5><a id="setStatestateChange_callbacksetState_4"></a>方式一：setState(stateChange, [callback])------对象式的setState</h5> 
<ul><li>stateChange为状态改变对象(该对象可以体现出状态的更改)</li><li>callback是可选的回调函数, 它在状态更新完毕、界面也更新后(render调用后)才被调用</li></ul> 
<h5><a id="setStateupdater_callbacksetState_9"></a>方式二：setState(updater, [callback])------函数式的setState</h5> 
<ul><li>updater为返回stateChange对象的函数</li><li><strong>updater可以接收到state和props</strong></li><li>callback是可选的回调函数, 它在状态更新、界面也更新后(render调用后)才被调用。</li></ul> 
<h5><a id="_15"></a>总结</h5> 
<p>对象式的setState是函数式的setState的简写方式(语法糖)</p> 
<h5><a id="_19"></a>使用原则</h5> 
<p>以下原则只是建议性的，不是强制性的要求</p> 
<ol><li>如果新状态不依赖于原状态 ===&gt; <strong>使用对象方式</strong></li><li>如果新状态依赖于原状态 ===&gt; <strong>使用函数方式</strong></li><li>如果需要在<code>setState()</code>执行后获取最新的状态数据，要在第二个callback函数中读取</li></ol> 
<blockquote> 
 <p><strong>setState同步VS异步问题</strong></p> 
 <ul><li> <p>setState 只在合成事件和钩子函数中是“异步”的，在原生事件和 setTimeout 中都是同步的。</p> 
   <ul><li>合成事件：就是react 在组件中的onClick等都是属于它自定义的合成事件</li><li>原生事件：比如通过addeventListener添加的，dom中的原生事件</li></ul> </li><li> <p>setState的“异步”并不是说内部由异步代码实现，其实本身执行的过程和代码都是同步的，只是合成事件和钩子函数的调用顺序在更新之前，导致在合成事件和钩子函数中没法立马拿到更新后的值，形式了所谓的“异步”，当然可以通过第二个参数 setState(partialState, callback) 中的callback拿到更新后的结果。</p> </li><li> <p>setState 的批量更新优化也是建立在“异步”（合成事件、钩子函数）之上的，在原生事件和setTimeout 中不会批量更新，在“异步”中如果对同一个值进行多次 setState ， setState 的批量更新策略会对其进行覆盖，取最后一次的执行，如果是同时 setState 多个不同的值，在更新时会对其进行合并批量更新。</p> <p><img src="https://images2.imgbox.com/81/fa/1bO3Z3B2_o.png" alt="在这里插入图片描述"></p> </li></ul> 
</blockquote> 
<blockquote> 
 <ul><li>从上图可知，在react中，setState通过一个队列机制实现state的更新。当执行setState时，会把需要更新的state合并后放入状态队列，而不会立刻更新<code>this.state</code>，当进入组件可更新状态时，这个队列机制就会<strong>高效的批量的更新state</strong>。</li></ul> 
</blockquote> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Demo</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{<!-- --></span>

	state <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
		count<span class="token punctuation">:</span> <span class="token number">0</span>
	<span class="token punctuation">}</span>

	<span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">//方式一：对象式的setState</span>
		<span class="token comment">// //1.获取原来的count值</span>
		<span class="token comment">// const { count } = this.state</span>
		<span class="token comment">// //2.更新状态</span>
		<span class="token comment">// this.setState({ count: count + 1 }, () =&gt; {<!-- --></span>
		<span class="token comment">// 	console.log(this.state.count);</span>
		<span class="token comment">// })</span>
		<span class="token comment">// //假如setState更新完数据后，立即使用的话，会出现问题</span>
		<span class="token comment">// //console.log('获取最新的count数据为',this.state.count); //0 </span>

		<span class="token comment">//方式二：函数式的setState</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span>state <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> count<span class="token punctuation">:</span> state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span>
			<span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>当前求和为：<span class="token punctuation">{<!-- --></span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token keyword">this</span><span class="token punctuation">.</span>add<span class="token punctuation">}</span><span class="token operator">&gt;</span>点我呀<span class="token operator">+</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
		<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="2_lazyLoad_82"></a>2. lazyLoad（懒加载组件）</h3> 
<h4><a id="lazyLoad_84"></a>路由组件的lazyLoad</h4> 
<ul><li> <p>步骤一：通过React的<code>lazy</code>函数配合<code>import()</code>函数动态加载路由组件 ===&gt; 路由组件代码会被分开打包</p> <pre><code class="prism language-javascript"><span class="token keyword">const</span> Login <span class="token operator">=</span> <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/pages/Login'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> </li><li> <p>步骤二：通过<code>&lt;Suspense&gt;</code>指定在加载得到路由打包文件前显示一个自定义loading界面</p> <pre><code class="prism language-javascript"><span class="token operator">&lt;</span>Suspense fallback<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>loading<span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Switch<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">"/xxx"</span> component<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>Xxxx<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Redirect to<span class="token operator">=</span><span class="token string">"/login"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>Switch<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Suspense<span class="token operator">&gt;</span>
</code></pre> </li></ul> 
<h3><a id="3_Hooks_105"></a>3. Hooks</h3> 
<h4><a id="1_React_HookHooks_107"></a>1. React Hook/Hooks是什么?</h4> 
<ul><li>Hook是React 16.8.0版本增加的新特性/新语法</li><li>可以在函数组件中使用 state 以及其他的 React 特性</li></ul> 
<h4><a id="2_Hook_112"></a>2. 三个常用的Hook</h4> 
<ul><li>State Hook: <code>React.useState()</code></li><li>Effect Hook: <code>React.useEffect()</code></li><li>Ref Hook: <code>React.useRef()</code></li></ul> 
<h5><a id="21_State_Hook_118"></a>2.1. State Hook</h5> 
<ul><li>State Hook让函数组件也可以有state状态, 并进行状态数据的读写操作</li><li>语法: <code>const [xxx, setXxx] = React.useState(initValue)</code></li><li>useState()说明 
  <ul><li>参数: <strong>第一次初始化指定的值在内部作缓存</strong></li><li>返回值: <strong>包含2个元素的数组, 第1个为内部当前状态值, 第2个为更新状态值的函数</strong></li></ul> </li><li>setXxx()两种写法 
  <ul><li><code>setXxx(newValue)</code>: 参数为非函数值, 直接指定新的状态值, 内部用其覆盖原来的状态值</li><li><code>setXxx(value =&gt; newValue)</code>: 参数为函数, <strong>接收原本的状态值, 返回新的状态值</strong>, 内部用其覆盖原来的状态值</li></ul> </li></ul> 
<h5><a id="22_Effect_Hook_129"></a>2.2. Effect Hook</h5> 
<ul><li> <p><code>Effect Hook</code> 可以让你在函数组件中执行副作用操作(用于模拟类组件中的生命周期钩子)</p> </li><li> <p>React中的副作用操作</p> 
  <ol><li>发ajax请求数据获取</li><li>设置订阅 / 启动定时器</li><li>手动更改真实DOM</li></ol> </li><li> <p>语法和说明</p> <pre><code class="prism language-javascript"><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span> 
          <span class="token comment">// 在此可以执行任何带副作用操作</span>
          <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 在组件卸载前执行</span>
            <span class="token comment">// 在此做一些收尾工作, 比如清除定时器/取消订阅等</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>stateValue<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 如果指定的是[], 回调函数只会在第一次render()后执行</span>
</code></pre> </li><li> <p>说明</p> <p>可以把 <code>useEffect Hook</code>看做如下三个函数的组合</p> 
  <ul><li><code>componentDidMount()</code></li><li><code>componentDidUpdate()</code></li><li><code>componentWillUnmount()</code></li></ul> </li></ul> 
<p>​</p> 
<h5><a id="5_Ref_Hook_160"></a>5. Ref Hook</h5> 
<ul><li> <p><code>Ref Hook</code>可以在函数组件中存储/查找组件内的标签或任意其它数据</p> </li><li> <p>语法</p> <pre><code class="prism language-javascript"><span class="token keyword">const</span> refContainer <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> </li><li> <p>作用</p> <p>保存标签对象，功能与<code>React.createRef()</code>一样</p> </li></ul> 
<h3><a id="4_Fragment_176"></a>4. Fragment（避免额外标记）</h3> 
<ul><li> <p>概述</p> 
  <ul><li>使用 Fragment 减少了包含的额外标记数量，这些标记只是为了满足在 React 组件中具有公共父级的要求。</li><li>在创建新组件时，每个组件应具有单个父标签。父级不能有两个标签，所以顶部要有一个公共标签。所以经常在组件顶部添加额外标签</li><li>以将元素包含在<strong>片段</strong>（fragement）中。片段不会向组件引入任何额外标记，但它仍然为两个相邻标记提供父级，因此满足在组件顶级具有单个父级的条件</li></ul> </li><li> <p>使用方式</p> <pre><code class="prism language-javascript"><span class="token operator">&lt;</span>Fragment<span class="token operator">&gt;</span><span class="token operator">&lt;</span>Fragment<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre> </li><li> <p>作用</p> <p>可以不用必须有一个真实的DOM根标签了</p> </li><li> <p><code>&lt;Fragment&gt;</code>与<code>&lt;&gt;</code>区别</p> 
  <ul><li><code>&lt;&gt;&lt;/&gt;</code> 语法不能接受键值或属性，<code>&lt;Fragment&gt;</code>可以</li><li>使用显式 <code>&lt;Fragment&gt;</code>语法声明的片段可能具有 key。key 是唯一可以传递给 Fragment 的属性</li></ul> </li></ul> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> Component<span class="token punctuation">,</span> Fragment <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Demo</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{<!-- --></span>
	<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span>
			<span class="token operator">&lt;</span>Fragment key<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"text"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"text"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span><span class="token operator">/</span>Fragment<span class="token operator">&gt;</span>
		<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="5_Context_216"></a>5. Context</h3> 
<h4><a id="Context_218"></a>使用Context的原因</h4> 
<ul><li> <p>为了有时候想传递数据通过组件树，但是不想给每一层级的组件手动传递属性，那么 <code>context</code>就能实现<strong>跨级</strong>传递数据到组件树中你想传递到的深层次组件</p> </li><li> <p>有时候 <code>A组件</code> 为了给 <code>B组件</code> 中的 <code>C组件</code> 传递一个 <code>prop</code> ，而需要把参数在组件中传递两次才能最终将 <code>A组件</code> 中的 <code>prop</code> 传递给 <code>C组件</code></p> </li><li> <p>一种组件间通信方式, 常用于【祖组件】与【后代组件】间通信</p> </li></ul> 
<h4><a id="_225"></a>使用方式</h4> 
<ol><li> <p>创建Context容器对象</p> <pre><code class="prism language-javascript"><span class="token keyword">const</span> XxxContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  
</code></pre> </li><li> <p>渲染子组件时，外面包裹<code>xxxContext.Provider</code>，通过<code>value</code>属性给后代组件传递数据</p> <pre><code class="prism language-javascript"><span class="token operator">&lt;</span>xxxContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>数据<span class="token punctuation">}</span><span class="token operator">&gt;</span>
		子组件
<span class="token operator">&lt;</span><span class="token operator">/</span>xxxContext<span class="token punctuation">.</span>Provider<span class="token operator">&gt;</span>
</code></pre> </li><li> <p>后代组件读取数据</p> <pre><code class="prism language-javascript"><span class="token comment">//第一种方式:仅适用于类组件 </span>
<span class="token keyword">static</span> contextType <span class="token operator">=</span> xxxContext  <span class="token comment">// 声明接收context</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>context <span class="token comment">// 读取context中的value数据</span>
	  
<span class="token comment">//第二种方式: 函数组件与类组件都可以</span>
<span class="token operator">&lt;</span>xxxContext<span class="token punctuation">.</span>Consumer<span class="token operator">&gt;</span>
     <span class="token punctuation">{<!-- --></span>
          value <span class="token operator">=&gt;</span> <span class="token punctuation">(</span> <span class="token comment">// value就是context中的value数据</span>
          要显示的内容
          <span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>xxxContext<span class="token punctuation">.</span>Consumer<span class="token operator">&gt;</span>
</code></pre> </li></ol> 
<h4><a id="_258"></a>示例</h4> 
<pre><code class="prism language-css"><span class="token selector">.parent</span><span class="token punctuation">{<!-- --></span>
	<span class="token property">width</span><span class="token punctuation">:</span> 500px<span class="token punctuation">;</span>
	<span class="token property">background-color</span><span class="token punctuation">:</span> orange<span class="token punctuation">;</span>
	<span class="token property">padding</span><span class="token punctuation">:</span> 8px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.child</span><span class="token punctuation">{<!-- --></span>
	<span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
	<span class="token property">background-color</span><span class="token punctuation">:</span> skyblue<span class="token punctuation">;</span>
	<span class="token property">padding</span><span class="token punctuation">:</span> 8px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.grand</span><span class="token punctuation">{<!-- --></span>
	<span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
	<span class="token property">background-color</span><span class="token punctuation">:</span> gray<span class="token punctuation">;</span>
	<span class="token property">padding</span><span class="token punctuation">:</span> 8px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> Component<span class="token punctuation">,</span> createContext<span class="token punctuation">,</span> useContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token string">'./index.css'</span>

<span class="token comment">//创建Context对象</span>
<span class="token keyword">const</span> MyContext <span class="token operator">=</span> <span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> Provider<span class="token punctuation">,</span> Consumer <span class="token punctuation">}</span> <span class="token operator">=</span> MyContext
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{<!-- --></span>

	state <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> username<span class="token punctuation">:</span> <span class="token string">'Jack'</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">18</span> <span class="token punctuation">}</span>

	<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> username<span class="token punctuation">,</span> age <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state
		<span class="token keyword">return</span> <span class="token punctuation">(</span>
			<span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"parent"</span><span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>我是<span class="token constant">A</span>组件<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>h4<span class="token operator">&gt;</span>我的用户名是<span class="token punctuation">:</span><span class="token punctuation">{<!-- --></span>username<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h4<span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>Provider value<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span> username<span class="token punctuation">,</span> age <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
					<span class="token operator">&lt;</span><span class="token constant">B</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span><span class="token operator">/</span>Provider<span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
		<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">B</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{<!-- --></span>
	<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span>
			<span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"child"</span><span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>我是<span class="token constant">B</span>组件<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span><span class="token constant">C</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
		<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 方式一</span>
<span class="token comment">/* class C extends Component {
	//声明接收context
	static contextType = MyContext
	render() {
		const {username,age} = this.context
		return (
			&lt;div className="grand"&gt;
				&lt;h3&gt;我是C组件&lt;/h3&gt;
				&lt;h4&gt;我从A组件接收到的用户名:{username},年龄是{age}&lt;/h4&gt;
			&lt;/div&gt;
		)
	}
} */</span>

<span class="token comment">//方式二</span>
<span class="token comment">/* function C() {
	const contextData = useContext(MyContext)
	const { username, age } = contextData
	return (
		&lt;div className="grand"&gt;
			&lt;h3&gt;我是C组件&lt;/h3&gt;
			&lt;h4&gt;我从A组件接收到的用户名:{username},年龄是=={age}&lt;/h4&gt;
		&lt;/div&gt;
	)
} */</span>

<span class="token comment">//方式三</span>
<span class="token keyword">function</span> <span class="token constant">C</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span>
		<span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"grand"</span><span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>我是<span class="token constant">C</span>组件<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>h4<span class="token operator">&gt;</span>我从<span class="token constant">A</span>组件接收到的用户名<span class="token punctuation">:</span>
			<span class="token operator">&lt;</span>Consumer<span class="token operator">&gt;</span>
					<span class="token punctuation">{<!-- --></span>value <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>value<span class="token punctuation">.</span>username<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,年龄是</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>value<span class="token punctuation">.</span>age<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">}</span>
				<span class="token operator">&lt;</span><span class="token operator">/</span>Consumer<span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span><span class="token operator">/</span>h4<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
	<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="6__360"></a>6. 组件优化</h3> 
<h4><a id="_362"></a>概述</h4> 
<ul><li>浏览器的<code>重绘和重排版(reflows &amp; repaints)</code>（DOM操作都会引起）才是导致网页性能问题的关键。而React<code>虚拟DOM</code>的目的就是为了减少浏览器的<code>重绘和重排版</code></li><li>组件渲染方式有两种<code>初始渲染</code>和<code>更新渲染</code>，而我们需要优化的地方就是<strong>更新渲染</strong></li><li>组件更新生命周期中必调用<code>shouldComponentUpdate</code>(组件是否应该更新)。<code>shouldComponentUpdate</code>默认返回<code>true</code>，必更新。所有当我们判断出组件没必要更新是，<code>shouldComponentUpdate</code>可以返回<code>false</code>，就达到优化效果</li></ul> 
<h4><a id="Component2_368"></a>Component的2个问题</h4> 
<ul><li>只要执行<code>setState()</code>，即使不改变状态数据，组件也会重新<code>render()</code>==&gt; <strong>效率低</strong></li><li>只当前组件重新render()，就会自动重新render<strong>子组件</strong>，纵使子组件没有用到父组件的任何数据 ==&gt; <strong>效率低</strong></li></ul> 
<h4><a id="_373"></a>效率高的做法</h4> 
<ul><li><strong>只有当组件的state或props数据发生改变时才重新render()</strong></li></ul> 
<h4><a id="_377"></a>原因</h4> 
<ul><li>Component中的<code>shouldComponentUpdate()</code>总是返回<code>true</code>。<code>shouldComponentUpdate</code>是决定<code>react</code>组件什么时候能够不重新渲染的函数，但是这个函数默认的实现方式就是简单的返回一个<code>true</code>。也就是说，默认每次更新的时候都要调用所用的生命周期函数，包括<code>render</code>函数，重新渲染。</li></ul> 
<h4><a id="_381"></a>解决</h4> 
<h5><a id="_383"></a>方式一</h5> 
<ul><li>重写<code>shouldComponentUpdate()</code>方法</li><li>比较新旧state或props数据, 如果有变化才返回true, 如果没有返回false</li></ul> 
<h5><a id="_388"></a>方式二</h5> 
<ul><li>使用<code>PureComponent</code></li><li>PureComponent重写了<code>shouldComponentUpdate()</code>, 只有state或props数据有变化才返回true</li><li>注意事项 
  <ul><li>只是进行state和props数据的浅比较, 如果只是数据对象内部数据变了, 返回false</li><li>不要直接修改state数据, 而是要产生新数据</li></ul> </li><li>项目中一般使用PureComponent来优化</li></ul> 
<h5><a id="_397"></a>示例</h5> 
<ul><li> <p>样式</p> <pre><code class="prism language-css"><span class="token selector">.parent</span><span class="token punctuation">{<!-- --></span>
	<span class="token property">background-color</span><span class="token punctuation">:</span> orange<span class="token punctuation">;</span>
	<span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.child</span><span class="token punctuation">{<!-- --></span>
	<span class="token property">background-color</span><span class="token punctuation">:</span> gray<span class="token punctuation">;</span>
	<span class="token property">margin-top</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span>
	<span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> </li><li> <p>js代码</p> <pre><code class="prism language-javascript"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> PureComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token string">'./index.css'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">{<!-- --></span>

	state <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
		carName<span class="token punctuation">:</span> <span class="token string">"奔驰c36"</span><span class="token punctuation">,</span>
		stus<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'小张'</span><span class="token punctuation">,</span> <span class="token string">'小李'</span><span class="token punctuation">,</span> <span class="token string">'小王'</span><span class="token punctuation">]</span>
	<span class="token punctuation">}</span>

	<span class="token function-variable function">addStu</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> stus <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state
		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> stus<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'小刘'</span><span class="token punctuation">,</span> <span class="token operator">...</span>stus<span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token function-variable function">changeCar</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">//this.setState({carName:'迈巴赫'})</span>

		<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state
		obj<span class="token punctuation">.</span>carName <span class="token operator">=</span> <span class="token string">'迈巴赫'</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/* shouldComponentUpdate(nextProps,nextState){
		console.log("目前的props和state===",this.props,this.state); //目前的props和state
		console.log("接下要变化的目标props，目标state===",nextProps,nextState); //接下要变化的目标props，目标state
		return !this.state.carName === nextState.carName
	} */</span>

	<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Parent---render'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> carName<span class="token punctuation">,</span>stus <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state
		<span class="token keyword">return</span> <span class="token punctuation">(</span>
			<span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"parent"</span><span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>我是Parent组件<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span>
				<span class="token punctuation">{<!-- --></span>stus<span class="token punctuation">}</span><span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span>
				<span class="token operator">&lt;</span>span<span class="token operator">&gt;</span>我的车名字是：<span class="token punctuation">{<!-- --></span>carName<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span><span class="token operator">&lt;</span>br <span class="token operator">/</span><span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token keyword">this</span><span class="token punctuation">.</span>changeCar<span class="token punctuation">}</span><span class="token operator">&gt;</span>点我换车<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token keyword">this</span><span class="token punctuation">.</span>addStu<span class="token punctuation">}</span><span class="token operator">&gt;</span>添加一个小刘<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>Child carName<span class="token operator">=</span><span class="token string">"奥拓"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
		<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">{<!-- --></span>

	<span class="token comment">/* shouldComponentUpdate(nextProps,nextState){
		console.log(this.props,this.state); //目前的props和state
		console.log(nextProps,nextState); //接下要变化的目标props，目标state
		return !this.props.carName === nextProps.carName
	} */</span>

	<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Child---render'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span>
			<span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"child"</span><span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>我是Child组件<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>span<span class="token operator">&gt;</span>我接到的车是：<span class="token punctuation">{<!-- --></span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>carName<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
		<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> </li></ul> 
<h3><a id="7_render_props_484"></a>7. render props</h3> 
<h4><a id="_486"></a>如何向组件内部动态传入带内容的结构(标签)?</h4> 
<ul><li>Vue中，使用<code>slot</code>插槽技术，也就是通过组件标签体传入结构 <code>&lt;A&gt;&lt;B/&gt;&lt;/A&gt;</code></li><li>React中，可以通过以下两种方式 
  <ul><li>使用<code>children props</code>：通过组件标签体传入结构</li><li>使用<code>render props</code>：通过组件标签属性传入结构，而且可以携带数据，一般用<code>render</code>函数属性</li></ul> </li></ul> 
<h4><a id="children_props_493"></a>children props</h4> 
<pre><code class="prism language-javascript"><span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token constant">B</span><span class="token operator">&gt;</span>xxxx<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token constant">B</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token constant">A</span><span class="token operator">&gt;</span>
<span class="token punctuation">{<!-- --></span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">}</span>
</code></pre> 
<p>问题: 如果B组件需要A组件内的数据, ==&gt; <strong>以上方式是无法做到的</strong></p> 
<h4><a id="render_props_504"></a>render props</h4> 
<pre><code class="prism language-javascript"><span class="token operator">&lt;</span><span class="token constant">A</span> render<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span><span class="token constant">C</span> data<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>data<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token constant">C</span><span class="token operator">&gt;</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token constant">A</span><span class="token operator">&gt;</span>
</code></pre> 
<ul><li>A组件: {this.props.render(内部state数据)}</li><li>C组件: 读取A组件传入的数据显示 {this.props.data}</li></ul> 
<h3><a id="8__515"></a>8. 错误边界</h3> 
<h4><a id="_517"></a>概述</h4> 
<ul><li> <p>在 UI 部分发生的 JavaScript 异常不应该阻断整个应用。为了解决这一问题，React 16 引入了“错误边界（error boundary）”这一新概念。</p> </li><li> <p>错误边界作为 React 组件，用以<strong>捕获在子组件树中任何地方的 JavaScript 异常，打印这些错误，并展示备用 UI</strong> 而非让组件树崩溃。错误边界会捕获渲染期间，在生命周期方法中以及在其整个树的构造函数中的异常。</p> </li><li> <p>错误边界(<code>Error boundary</code>)：用来捕获后代组件错误，渲染出备用页面</p> </li><li> <p><strong>错误边界仅可以捕获组件树中的后代组件错误</strong>。一个错误边界无法捕获其自身的错误。若错误边界在渲染错误信息时失败，则该错误会传递至上一层最接近的错误边界</p> </li></ul> 
<h4><a id="_525"></a>特点</h4> 
<ul><li>只能捕获后代组件生命周期产生的错误</li><li>不能捕获自己组件产生的错误和其他组件在合成事件、定时器中产生的错误</li></ul> 
<h4><a id="_530"></a>使用方式</h4> 
<p><code>getDerivedStateFromError</code>配合<code>componentDidCatch</code></p> 
<pre><code class="prism language-javascript"><span class="token comment">// 生命周期函数，一旦后台组件报错，就会触发</span>
<span class="token keyword">static</span> <span class="token function">getDerivedStateFromError</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 在render之前触发</span>
    <span class="token comment">// 返回新的state</span>
    <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
        hasError<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">componentDidCatch</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> info<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 统计页面的错误。发送请求发送到后台去</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> info<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="_550"></a>示例</h4> 
<ul><li> <p>子组件代码</p> <pre><code class="prism language-javascript"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{<!-- --></span>
	state <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
		users<span class="token punctuation">:</span> <span class="token punctuation">[</span>
			<span class="token punctuation">{<!-- --></span> id<span class="token punctuation">:</span> <span class="token string">'001'</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'tom'</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">18</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token punctuation">{<!-- --></span> id<span class="token punctuation">:</span> <span class="token string">'002'</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'jack'</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">19</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token punctuation">{<!-- --></span> id<span class="token punctuation">:</span> <span class="token string">'003'</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'peiqi'</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">20</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">]</span>
		<span class="token comment">//错误边界演示数据</span>
		<span class="token comment">// users:'abc'</span>
	<span class="token punctuation">}</span>

	<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span>
			<span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>我是Child组件<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>userObj<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
						<span class="token keyword">return</span> <span class="token operator">&lt;</span>h4 key<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>userObj<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span>userObj<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token operator">--</span><span class="token operator">--</span><span class="token punctuation">{<!-- --></span>userObj<span class="token punctuation">.</span>age<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h4<span class="token operator">&gt;</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span>
			<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
		<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> </li><li> <p>父组件代码</p> <pre><code class="prism language-javascript"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> Child <span class="token keyword">from</span> <span class="token string">'./Child'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{<!-- --></span>

	state <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
		hasError<span class="token punctuation">:</span> <span class="token string">''</span> <span class="token comment">//用于标识子组件是否产生错误</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//当Parent的子组件出现报错时候，会触发getDerivedStateFromError调用，并携带错误信息</span>
	<span class="token keyword">static</span> <span class="token function">getDerivedStateFromError</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'@@@'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span> hasError<span class="token punctuation">:</span> error <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// React 16 将提供一个内置函数 componentDidCatch，如果 render() 函数抛出错误，则会触发该函数</span>
	<span class="token comment">// componentDidCatch 是包含错误堆栈的 info 对象</span>
	<span class="token function">componentDidCatch</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> info<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'此处统计错误，反馈给服务器，用于通知编码人员进行bug的解决'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'object error:&gt;&gt; '</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'object info:&gt;&gt; '</span><span class="token punctuation">,</span> info<span class="token punctuation">)</span><span class="token punctuation">;</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'错误堆栈:&gt;&gt; '</span><span class="token punctuation">,</span> info<span class="token punctuation">.</span>componentStack<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span>
			<span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>我是Parent组件<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
				<span class="token punctuation">{<!-- --></span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>hasError <span class="token operator">?</span> <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>当前网络不稳定，稍后再试<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span> <span class="token punctuation">:</span> <span class="token operator">&lt;</span>Child <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span>
			<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
		<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> </li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d5cadc436b3e98a6f70f982a2afba56f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">A Contesting Decision</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/84ed2339db6ad07a93c1a80db6967aae/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">2020版IDEA 常用设置配置</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>