<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Ubuntu18.04安装Nvidia驱动【全网不坑，超全步骤】（亲测～） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Ubuntu18.04安装Nvidia驱动【全网不坑，超全步骤】（亲测～）" />
<meta property="og:description" content="Ubuntu18.04安装Nvidia驱动【全网不坑，超全步骤】亲测～ 为了方便以后回忆以及给像我一样的菜鸡提供思路，给出具体的步骤：No.1 查看自己的电脑显卡型号（已知麻烦自动略过）No.2 下载电脑对应的Nvidia版本驱动No.3 准备工作，下载依赖No.4 开始安装踩坑第一步（相信很多人都遇到过） 为了方便以后回忆以及给像我一样的菜鸡提供思路，给出具体的步骤： No.1 查看自己的电脑显卡型号（已知麻烦自动略过） 直接上命令：
1）方法一：（可有有些人不适用，就像我）
lshw -c video 结果：
2）方法二：（适用）
lspci | grep -i nvidia 显示：
02:00.0 3D controller: NVIDIA Corporation Device 1d12 (rev a1)
我们要的就是：1d12
然后进入网址：PCI Devices
输入并查找，得到
3）方法三：（说是直接弹出结果，但我没试过）
nvidia-smi -L No.2 下载电脑对应的Nvidia版本驱动 进入官网：https://www.nvidia.cn/Download/index.aspx?lang=cn
PS：这里按照我的电脑选取了驱动程序
然后：
选择下载之后得到一个后缀名为run的文件：
No.3 准备工作，下载依赖 1）禁用BIOS中的安全启动模式secure boot，这是因为此方法使用第三方源安装显卡驱动，不禁止secure boot会导致安装的驱动不能使用，禁用也不会有多大安全隐患。
不禁用后面会导致安装出现error并且fail
具体做法是：
开机进入BIOS，然后选择安全模式，禁止。（图待补充ing…）
2）移除所有以前安装过的nvidia包，并禁用nouveau
移除：
sudo apt-get purge nvidia* 创建文件：
sudo vim /etc/modprobe.d/blacklist-nouveau.conf 一般人很少用vim（vim是a或者i开启编辑，esc退出，输入:wq保存退出），我这里习惯用自带的gedit命令直接打开相当于记事本那样编辑：
sudo gedit /etc/modprobe.d/blacklist-nouveau.conf 插入以下两句代码：
blacklist nouveau options nouveau modeset=0 执行命令禁止nouveau，并重启生效。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/cbcc9e8c9b656e6626cfc763f3fc1e52/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-19T18:10:00+08:00" />
<meta property="article:modified_time" content="2023-08-19T18:10:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Ubuntu18.04安装Nvidia驱动【全网不坑，超全步骤】（亲测～）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atelier-sulphurpool-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>Ubuntu18.04安装Nvidia驱动【全网不坑，超全步骤】亲测～</h4> 
 <ul><li><a href="#_2" rel="nofollow">为了方便以后回忆以及给像我一样的菜鸡提供思路，给出具体的步骤：</a></li><li><ul><li><a href="#No1___4" rel="nofollow">No.1 查看自己的电脑显卡型号（已知麻烦自动略过）</a></li><li><a href="#No2__Nvidia_35" rel="nofollow">No.2 下载电脑对应的Nvidia版本驱动</a></li><li><a href="#No3__46" rel="nofollow">No.3 准备工作，下载依赖</a></li><li><a href="#No4___146" rel="nofollow">No.4 开始安装</a></li><li><a href="#_241" rel="nofollow">踩坑第一步（相信很多人都遇到过）</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_2"></a>为了方便以后回忆以及给像我一样的菜鸡提供思路，给出具体的步骤：</h2> 
<h3><a id="No1___4"></a>No.1 查看自己的电脑显卡型号（已知麻烦自动略过）</h3> 
<p>直接上命令：</p> 
<p>1）方法一：（可有有些人不适用，就像我）</p> 
<pre><code>lshw -c video
</code></pre> 
<p>结果：</p> 
<p><img src="https://images2.imgbox.com/37/ab/pWCvc7b3_o.png" alt="在这里插入图片描述"></p> 
<p>2）方法二：（适用）</p> 
<pre><code>lspci | grep -i nvidia
</code></pre> 
<p>显示：</p> 
<p><img src="https://images2.imgbox.com/f5/27/j5c14zmB_o.png" alt="在这里插入图片描述"><br> 02:00.0 3D controller: NVIDIA Corporation Device 1d12 (rev a1)<br> 我们要的就是：<strong>1d12</strong><br> 然后进入网址：<a href="http://pci-ids.ucw.cz/read/PC/10de/2208" rel="nofollow">PCI Devices</a></p> 
<p><img src="https://images2.imgbox.com/fe/d5/1yjoNaLV_o.png" alt="在这里插入图片描述"><br> 输入并查找，得到</p> 
<p><img src="https://images2.imgbox.com/52/01/FPd5V3EP_o.png" alt="在这里插入图片描述"><br> 3）方法三：（说是直接弹出结果，但我没试过）</p> 
<pre><code>nvidia-smi -L 
</code></pre> 
<p><img src="https://images2.imgbox.com/2b/0c/HZ5lL5KJ_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="No2__Nvidia_35"></a>No.2 下载电脑对应的Nvidia版本驱动</h3> 
<p>进入官网：<a href="https://www.nvidia.cn/Download/index.aspx?lang=cn" rel="nofollow">https://www.nvidia.cn/Download/index.aspx?lang=cn</a></p> 
<p><img src="https://images2.imgbox.com/16/61/dtpIyMhq_o.png" alt="在这里插入图片描述"><br> PS：这里按照我的电脑选取了驱动程序<br> 然后：</p> 
<p><img src="https://images2.imgbox.com/e6/ac/Hv4ycnZI_o.png" alt="在这里插入图片描述"><br> 选择下载之后得到一个后缀名为run的文件：</p> 
<p><img src="https://images2.imgbox.com/d6/43/p1P8PVWw_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="No3__46"></a>No.3 准备工作，下载依赖</h3> 
<p>1）禁用BIOS中的安全启动模式secure boot，这是因为此方法使用第三方源安装显卡驱动，不禁止secure boot会导致安装的驱动不能使用，禁用也不会有多大安全隐患。<br> <strong>不禁用后面会导致安装出现error并且fail</strong><br> 具体做法是：<br> 开机进入BIOS，然后选择安全模式，禁止。<em>（图待补充ing…）</em></p> 
<p>2）移除所有以前安装过的nvidia包，并禁用nouveau<br> 移除：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> purge nvidia*
</code></pre> 
<p>创建文件：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">vim</span> /etc/modprobe.d/blacklist-nouveau.conf
</code></pre> 
<p>一般人很少用vim（vim是a或者i开启编辑，esc退出，输入:wq保存退出），我这里习惯用自带的gedit命令直接打开相当于记事本那样编辑：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> gedit /etc/modprobe.d/blacklist-nouveau.conf
</code></pre> 
<p>插入以下两句代码：</p> 
<pre><code class="prism language-bash"> blacklist nouveau
 options nouveau <span class="token assign-left variable">modeset</span><span class="token operator">=</span><span class="token number">0</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/36/89/r1afKNLk_o.png" alt="在这里插入图片描述"><br> 执行命令禁止nouveau，并重启生效。</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> update-initramfs <span class="token parameter variable">-u</span>
<span class="token function">sudo</span> <span class="token function">reboot</span>
</code></pre> 
<p>重启后，输入：</p> 
<pre><code class="prism language-bash">lsmod <span class="token operator">|</span> <span class="token function">grep</span> nouveau
</code></pre> 
<p>验证。</p> 
<p>3）在安装驱动之前需要安装gcc和相应的依赖：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> build-essential 
</code></pre> 
<p>我也不知道为什么这一行命令就把gcc给安装了，然后安装cmake：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> cmake
</code></pre> 
<p>查看gcc和cmake有没有安装成功：</p> 
<pre><code class="prism language-bash">gcc <span class="token parameter variable">--version</span>
cmake <span class="token parameter variable">--version</span>
</code></pre> 
<p>4）没有lightdm需要安装一下：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> lightdm
</code></pre> 
<p>一直安装不下来，于是换镜像源，更换前最好先备份：</p> 
<pre><code class="prism language-bash"><span class="token function">cp</span> /etc/apt/sources.list /etc/apt/sources_bak.list
</code></pre> 
<p>或者</p> 
<pre><code class="prism language-bash"><span class="token function">mv</span> /etc/apt/sources.list /etc/apt/sources.list.bak
</code></pre> 
<p>打开文件：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> gedit /etc/apt/sources.list
</code></pre> 
<p>替换…一开始换的是<a href="https://mirrors.tuna.tsinghua.edu.cn/help/ubuntu/" rel="nofollow">清华镜像源</a>（有需要的同志也可以访问）<br> 更换了之后需要：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> update
</code></pre> 
<p>出现错误：</p> 
<blockquote> 
 <p>GPG error:<br> http://developer.download.nvidia.com/compute/cuda/repos/ubuntu180</p> 
</blockquote> 
<p>然后这种错误，更换阿里源就好了：</p> 
<pre><code class="prism language-bash">deb http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse

deb http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse

deb http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse

deb http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse

deb http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse
</code></pre> 
<p>更换了之后同样需要：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> update
</code></pre> 
<p>再运行命令：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> lightdm
</code></pre> 
<p>安装。</p> 
<h3><a id="No4___146"></a>No.4 开始安装</h3> 
<p><em>在第三步的基础上</em></p> 
<p>1）进入tty2模式<br> 按ctrl+alt+f1进入命令行界面，此时会要求你输入用户名+密码：<br> PS：ctrl+alt+f7可直接退出来，回归正常～<br> 然后执行：</p> 
<pre><code class="prism language-bash">ubuntu@ubuntu:~$ <span class="token function">sudo</span> <span class="token function">service</span> lightdm stop
</code></pre> 
<p>关闭图形界面，当然你也可以直接关闭，再ctrl+alt+f1进入命令行界面。</p> 
<p>2）然后cd到.run文件所在的文件夹，执行：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token number">777</span> NVIDIA-Linux-x86_64-510.73.05.run
</code></pre> 
<p>修改驱动文件的权限</p> 
<p>3）<strong>重头戏来了</strong> 执行安装：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> ./NVIDIA-Linux-x86_64-510.73.05.run
</code></pre> 
<p>会载入一段时间，然后显示：</p> 
<p><img src="https://images2.imgbox.com/7b/0f/p1Hc0IW9_o.png" alt="在这里插入图片描述"><br> OK，下一步：</p> 
<p><img src="https://images2.imgbox.com/70/15/FnSG4h58_o.png" alt="在这里插入图片描述"><br> 选择继续，然后OK一下，跳到：</p> 
<p><img src="https://images2.imgbox.com/9d/97/1LVIVUsM_o.png" alt="在这里插入图片描述"><br> <strong>敲重点敲重点敲重点</strong></p> 
<p>这里<strong>你如果选择右边的Install without signing</strong>最后会出现：</p> 
<blockquote> 
 <p>You appear to be running an X server; please exit X before</p> 
</blockquote> 
<p>解决方法：<br> <a href="https://blog.csdn.net/cc1949/article/details/78491781?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522165389706816781435474219%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=165389706816781435474219&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~baidu_landing_v2~default-2-78491781-null-null.142%5Ev11%5Econtrol,157%5Ev12%5Econtrol&amp;utm_term=You%20appear%20to%20be%20running%20an%20X%20server;%20please%20exit%20X%20before%20installing&amp;spm=1018.2226.3001.4187">更新NVIDIA显卡的CUDA驱动出错，You appear to be running an X server; please exit X before</a><br> 也就是卸载重来：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> /etc/init.d/lightdm stop
<span class="token function">sudo</span> /etc/init.d/lightdm status
<span class="token function">sudo</span> <span class="token function">apt-get</span> purge nvidia-cuda*
<span class="token function">sudo</span> <span class="token function">apt-get</span> purge nvidia-*
</code></pre> 
<p>选择左边的：Sign the kernel module，OK，往下走：</p> 
<p><img src="https://images2.imgbox.com/30/a6/SMCXaAwQ_o.png" alt="在这里插入图片描述"><br> 选择生成新的密钥Generate a new key pair，这就会在/usr/share/nvidia/下生成一个nvidia*.der文件和nvidia*.key文件，前一个是私钥，后一个是公钥。<br> 然后选择NO：</p> 
<p><img src="https://images2.imgbox.com/90/fe/9Zw3rLHA_o.png" alt="在这里插入图片描述"><br> 不要删除。<br> 接着两次OK后，选择Install signed kernel module：</p> 
<p><img src="https://images2.imgbox.com/22/05/00SRSjsR_o.png" alt="在这里插入图片描述"><br> 完成后，执行：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> mokutil <span class="token parameter variable">--import</span> /usr/share/nvidia/nvidia*.der
</code></pre> 
<p>将密钥加到内核的信任列表中，此时会提示输入两次密码。<br> 重启。<br> 在进入系统前出现蓝色界面，选择Enroll MOK</p> 
<p><img src="https://images2.imgbox.com/67/55/IPBXJZVu_o.jpg" alt="在这里插入图片描述"><br> 选择继续：</p> 
<p><img src="https://images2.imgbox.com/15/5e/E29y11n3_o.png" alt="在这里插入图片描述"><br> 然后Yes输入密码：</p> 
<p><img src="https://images2.imgbox.com/9c/2d/IM3fZezC_o.png" alt="在这里插入图片描述"><br> 选择Reboot重启：</p> 
<p><img src="https://images2.imgbox.com/79/3f/v8uzTgdu_o.png" alt="在这里插入图片描述"><br> 开机后：</p> 
<p><img src="https://images2.imgbox.com/d8/4f/TzQtKXKR_o.jpg" alt="在这里插入图片描述"><br> 输入：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> modprobe nvidia
</code></pre> 
<p>挂载NVIDIA驱动，最后输入：</p> 
<pre><code class="prism language-bash">nvidia-smi 
</code></pre> 
<p>显示：</p> 
<p><img src="https://images2.imgbox.com/a0/e5/hIGiFl44_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/d3/6f/jyCclDKW_o.png" alt="在这里插入图片描述"><br> 完成。</p> 
<p><em>因为是完成之后写的，写得不好还请各位大神多多海量～<br> 制作稍许不易，顺手点赞交谊</em></p> 
<h3><a id="_241"></a>踩坑第一步（相信很多人都遇到过）</h3> 
<p>利用命令：</p> 
<pre><code class="prism language-c">cat <span class="token operator">/</span>etc<span class="token operator">/</span>X11<span class="token operator">/</span><span class="token keyword">default</span><span class="token operator">-</span>display<span class="token operator">-</span>manager
</code></pre> 
<p>查看系统是gdm3还是lightdm图形界面：<br> 如果返回/usr/sbin/gdm3</p> 
<p><img src="https://images2.imgbox.com/02/6c/2LI4yJMv_o.png" alt="在这里插入图片描述"><br> 表示是gdm3界面，而安装的nvidia驱动和gdm3界面之间有冲突Bug（可能导致后续黑屏无法显示。）<br> 参考：<a href="https://blog.csdn.net/weixin_43234290/article/details/118060732">unbutu 18.04 循环登录报错</a><br> 解决方式有：</p> 
<ol><li>卸载nvidia驱动，重新安装gdm3：</li></ol> 
<pre><code class="prism language-c"><span class="token number">1</span>）sudo apt<span class="token operator">-</span>get remove  <span class="token operator">--</span>purge nvidia<span class="token operator">-</span><span class="token operator">*</span>    #卸载nvidia相关组件
<span class="token number">2</span>）sudo apt purge gdm gdm3    #卸载gdm和gdm3
<span class="token number">3</span>）sudo apt install gdm3 ubuntu<span class="token operator">-</span>desktop   #重新安装gdm3
<span class="token number">4</span>）systemctl restart gdm        #重新启动gdm3服务
</code></pre> 
<ol start="2"><li>安装lightdm图形界面，在该文章的“<a href="https://editor.csdn.net/md/?articleId=125049064#No3__46" rel="nofollow">No.3 准备工作，下载依赖</a>”第四小步中有提及：</li></ol> 
<pre><code class="prism language-c">sudo apt<span class="token operator">-</span>get install lightdm
</code></pre> 
<p>资料：<a href="https://www.programbr.com/ubuntu/gdm3-vs-lightdm/" rel="nofollow">gdm3 vs lightdm</a></p> 
<ol start="3"><li>或者像我一样，执行命令：</li></ol> 
<pre><code class="prism language-c">sudo gedit <span class="token operator">/</span>etc<span class="token operator">/</span>gdm3<span class="token operator">/</span>custom<span class="token punctuation">.</span>conf
</code></pre> 
<p><img src="https://images2.imgbox.com/b0/02/8cDS7tVW_o.png" alt="在这里插入图片描述"></p> 
<p>取消<strong>WaylandEnable = False</strong>的注释。（有的人是加上注释，即打开Xorg登录界面）</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/396d510a362dc211c9c353aa4e4583b4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【STL】-- 知识总结</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5adca95d00a0f44456d65cd0b535c84d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Android 源码编译生成framework.jar</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>