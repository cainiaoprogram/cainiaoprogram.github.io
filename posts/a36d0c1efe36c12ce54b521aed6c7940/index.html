<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>关于k8s中ingress、Gateway、nginx之间关系 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="关于k8s中ingress、Gateway、nginx之间关系" />
<meta property="og:description" content="在Kubernetes中，Ingress是一种用于将外部流量路由到集群内部服务的API对象。它通常与Ingress控制器一起使用，Ingress控制器负责根据Ingress规则路由外部流量到不同的服务上。
下面是使用Ingress的一些步骤：
安装Ingress控制器 在Kubernetes中，Ingress控制器是需要安装和配置的。有许多流行的Ingress控制器，如Nginx Ingress Controller、Traefik、Haproxy Ingress等，你需要选择一个适合你的需求的Ingress控制器并安装它。
创建Ingress对象 创建Ingress对象可以通过yaml文件进行定义，例如：
apiVersion: networking.k8s.io/v1 kind: Ingress metadata: name: example-ingress spec: rules: - host: example.com http: paths: - path: /app1 pathType: Prefix backend: service: name: app1-service port: name: http 上述定义的Ingress对象将把example.com上的请求路由到名称为app1-service的Service对象上的http端口。
部署服务并暴露端口 你需要创建一个Deployment和一个Service对象，并暴露Service的端口，使得Ingress控制器可以路由流量到该服务。例如：
apiVersion: apps/v1 kind: Deployment metadata: name: app1-deployment spec: replicas: 3 selector: matchLabels: app: app1 template: metadata: labels: app: app1 spec: containers: - name: app1 image: example/app1:latest ports: - containerPort: 80 --- apiVersion: v1 kind: Service metadata: name: app1-service spec: selector: app: app1 ports: - name: http port: 80 上述定义的Deployment和Service将创建一个名为app1-service的Service对象，并将其暴露在80端口上。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/a36d0c1efe36c12ce54b521aed6c7940/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-24T23:25:41+08:00" />
<meta property="article:modified_time" content="2023-04-24T23:25:41+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">关于k8s中ingress、Gateway、nginx之间关系</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-github-gist">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>在Kubernetes中，Ingress是一种用于将外部流量路由到集群内部服务的API对象。它通常与Ingress控制器一起使用，Ingress控制器负责根据Ingress规则路由外部流量到不同的服务上。</p> 
<p>下面是使用Ingress的一些步骤：</p> 
<ol><li>安装Ingress控制器</li></ol> 
<p>在Kubernetes中，Ingress控制器是需要安装和配置的。有许多流行的Ingress控制器，如Nginx Ingress Controller、Traefik、Haproxy Ingress等，你需要选择一个适合你的需求的Ingress控制器并安装它。</p> 
<ol start="2"><li>创建Ingress对象</li></ol> 
<p>创建Ingress对象可以通过yaml文件进行定义，例如：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> networking.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Ingress
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> example<span class="token punctuation">-</span>ingress
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> example.com
      <span class="token key atrule">http</span><span class="token punctuation">:</span>
        <span class="token key atrule">paths</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">path</span><span class="token punctuation">:</span> /app1
            <span class="token key atrule">pathType</span><span class="token punctuation">:</span> Prefix
            <span class="token key atrule">backend</span><span class="token punctuation">:</span>
              <span class="token key atrule">service</span><span class="token punctuation">:</span>
                <span class="token key atrule">name</span><span class="token punctuation">:</span> app1<span class="token punctuation">-</span>service
                <span class="token key atrule">port</span><span class="token punctuation">:</span>
                  <span class="token key atrule">name</span><span class="token punctuation">:</span> http
</code></pre> 
<p>上述定义的Ingress对象将把example.com上的请求路由到名称为app1-service的Service对象上的http端口。</p> 
<ol start="3"><li>部署服务并暴露端口</li></ol> 
<p>你需要创建一个Deployment和一个Service对象，并暴露Service的端口，使得Ingress控制器可以路由流量到该服务。例如：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> app1<span class="token punctuation">-</span>deployment
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> app1
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> app1
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> app1
        <span class="token key atrule">image</span><span class="token punctuation">:</span> example/app1<span class="token punctuation">:</span>latest
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>

<span class="token punctuation">---</span>

<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> app1<span class="token punctuation">-</span>service
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> app1
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> http
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
</code></pre> 
<p>上述定义的Deployment和Service将创建一个名为app1-service的Service对象，并将其暴露在80端口上。</p> 
<ol start="4"><li>测试Ingress</li></ol> 
<p>在上述步骤完成后，你可以使用浏览器或curl命令向定义的Ingress暴露的域名发送请求，如<code>http://example.com/app1</code>，从而将请求路由到app1-service上。</p> 
<p>综上所述，这是在Kubernetes中使用Ingress的基本步骤，当然在实际使用中可能需要更复杂的配置和规则。</p> 
<p>在Kubernetes中使用Gateway，您可能是指Kubernetes Ingress Gateway。Ingress Gateway是一个Kubernetes资源对象，它充当了外部流量进入集群的入口，并将请求路由到后端服务。以下是在Kubernetes中使用Ingress Gateway的一般步骤：</p> 
<ol><li>安装Ingress Controller</li></ol> 
<p>要使用Ingress Gateway，您需要在Kubernetes集群中安装Ingress Controller。Ingress Controller是一个负责实现Ingress资源对象定义的路由规则的Kubernetes控制器。一些流行的Ingress Controller包括NGINX、Traefik和Envoy等。</p> 
<p>您可以使用kubectl apply命令来安装Ingress Controller。不同的Ingress Controller有不同的安装方式，请参考它们的官方文档以获得详细的安装指南。</p> 
<ol start="2"><li>定义Ingress资源对象</li></ol> 
<p>Ingress资源对象是定义路由规则的Kubernetes资源对象。它指定了要如何将外部流量路由到后端服务，例如，将特定的域名或路径映射到特定的服务和端口。</p> 
<p>以下是一个Ingress资源对象的例子：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> networking.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Ingress
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> example<span class="token punctuation">-</span>ingress
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> example.com
    <span class="token key atrule">http</span><span class="token punctuation">:</span>
      <span class="token key atrule">paths</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">path</span><span class="token punctuation">:</span> /app1
        <span class="token key atrule">pathType</span><span class="token punctuation">:</span> Prefix
        <span class="token key atrule">backend</span><span class="token punctuation">:</span>
          <span class="token key atrule">service</span><span class="token punctuation">:</span>
            <span class="token key atrule">name</span><span class="token punctuation">:</span> app1<span class="token punctuation">-</span>service
            <span class="token key atrule">port</span><span class="token punctuation">:</span>
              <span class="token key atrule">name</span><span class="token punctuation">:</span> http
</code></pre> 
<p>上述例子定义了一个名为example-ingress的Ingress资源对象，它将example.com上的/app1路径映射到app1-service的http端口。</p> 
<ol start="3"><li>创建Ingress资源对象</li></ol> 
<p>要创建Ingress资源对象，您需要使用kubectl apply命令并指定YAML文件的路径：</p> 
<pre><code>kubectl apply -f ingress.yaml
</code></pre> 
<p>其中ingress.yaml是您定义Ingress资源对象的YAML文件路径。</p> 
<ol start="4"><li>测试Ingress Gateway</li></ol> 
<p>在Ingress资源对象定义完成后，您可以使用curl或浏览器等工具来测试Ingress Gateway是否正常工作。例如，如果您的Ingress资源对象将example.com上的/app1路径映射到app1-service的http端口，则可以使用以下命令测试：</p> 
<pre><code>curl http://example.com/app1
</code></pre> 
<p>如果一切正常，您将看到app1-service返回的响应。</p> 
<p>以上是在Kubernetes中使用Ingress Gateway的基本步骤，您可以根据您的实际需求进行进一步的操作和配置。</p> 
<p>不同点</p> 
<p>Gateway和Ingress都是用于将外部流量路由到Kubernetes集群内部服务的技术，但它们有一些不同之处：</p> 
<ol><li>层级不同</li></ol> 
<p>Gateway通常是在应用程序层面的路由，而Ingress是在网络层面的路由。</p> 
<p>Gateway通常用于跨服务的路由，例如在微服务架构中，可以使用Gateway将多个微服务聚合在一起，形成一个单一的API网关。Gateway还可以用于在服务之间进行路由和负载均衡。</p> 
<p>Ingress通常用于在不同的域名和路径之间进行路由，以及在负载均衡和TLS终止等方面进行配置。</p> 
<ol start="2"><li>API对象不同</li></ol> 
<p>Gateway是Kubernetes中的Custom Resource Definition（CRD），而Ingress是Kubernetes的内置API对象。这意味着，使用Gateway需要先安装和配置CRD。</p> 
<ol start="3"><li>路由规则不同</li></ol> 
<p>Gateway通常使用自定义的路由规则，例如Spring Cloud Gateway和Netflix Zuul等网关。这些网关提供了丰富的路由规则，例如基于路径、请求头、查询参数等进行路由。</p> 
<p>Ingress则使用Kubernetes定义的路由规则。这些规则基于Host和Path等属性，并支持TLS终止和基于Cookie的会话粘性等功能。</p> 
<p>总之，Gateway和Ingress都是将外部流量路由到Kubernetes集群内部服务的技术，但是它们在层级、API对象和路由规则等方面有所不同。您可以根据您的实际需求选择适合您的技术。</p> 
<p>相同点<br> Ingress和Gateway都是在云原生环境下用于管理应用程序流量的组件。它们的共同点如下：</p> 
<ol><li> <p>负责流量路由：Ingress和Gateway都可以将外部请求路由到集群内的应用程序，以及将集群内的应用程序路由到不同的服务。它们可以根据不同的条件（例如域名、路径、HTTP方法、请求头等）来选择合适的服务进行请求转发。</p> </li><li> <p>提供安全性保障：Ingress和Gateway都可以提供安全性保障，例如SSL终止、访问控制、认证和授权等。它们可以保护集群中的应用程序不受未经授权的访问或恶意攻击。</p> </li><li> <p>可扩展性：Ingress和Gateway都可以扩展到多个节点，以实现高可用性和负载均衡。它们可以自动检测和路由请求到可用的节点，以确保应用程序始终可用。</p> </li></ol> 
<p>尽管Ingress和Gateway有许多相似之处，但它们的实现方式和用途略有不同。Ingress通常是集群内部的一个组件，用于管理应用程序的流量，而Gateway通常是集群之外的一个组件，用于处理入站和出站流量。Ingress通常运行在应用程序层面，而Gateway通常运行在网络层面。此外，Gateway通常支持更多的协议和功能，例如WebSocket和GRPC。</p> 
<p>具体ingree和nginx使用心得</p> 
<p>在 Kubernetes 中，Ingress 是一个抽象的资源对象，它定义了如何将外部请求路由到 Kubernetes 集群内部的服务。Ingress 的实现方式是通过使用不同的 Ingress 控制器（如 Nginx、Traefik、HAProxy 等）来实现的。</p> 
<p>Nginx 是一个非常流行的 Ingress 控制器，它可以通过 Ingress 规则来管理流量路由。当 Ingress 资源被创建时，Nginx 控制器会根据定义的规则来生成配置文件，从而将流量路由到相应的后端服务。Nginx 还提供了丰富的配置选项，例如负载均衡、缓存、SSL 终止、HTTP/2 支持等等，使得它可以满足各种不同的需求。</p> 
<p>当使用 Ingress 和 Nginx 配合使用时，可以实现 Kubernetes 集群内的流量管理，以及负载均衡、安全性保障和可扩展性等方面的需求。具体而言，可以通过定义 Ingress 规则来配置流量路由和访问控制，同时使用 Nginx 来负责实际的请求转发和处理。由于 Nginx 在性能和稳定性方面的优势，因此与 Ingress 结合使用的方式也是非常常见的。</p> 
<p>具体gateway和nginx实例<br> Gateway 和 Nginx 都是处理网络流量的组件，它们在功能上有所重叠，但它们的目的和实现方式略有不同。</p> 
<p>Gateway 通常是用于管理云原生应用程序的出站流量，它可以帮助应用程序与外部网络进行通信，同时提供安全性保障、负载均衡、流量控制等功能。Gateway 通常支持多种协议，例如 HTTP、WebSocket、GRPC 等，使得它可以适应各种不同的应用场景。</p> 
<p>Nginx 是一款流行的开源 Web 服务器和反向代理服务器，它可以处理 HTTP 和其他 TCP/UDP 协议的流量，同时提供负载均衡、反向代理、SSL 终止等功能。Nginx 也支持高度可扩展的插件机制，使得它可以扩展到许多不同的应用场景中。</p> 
<p>当 Gateway 和 Nginx 配合使用时，通常是将 Nginx 作为 Gateway 的反向代理服务器，以便管理应用程序的出站流量。在这种情况下，Nginx 可以负责请求的转发、流量控制、负载均衡等功能，同时 Gateway 则可以提供更高层次的安全性保障、流量管理等功能。这种方式可以为云原生应用程序提供更全面的流量管理和安全性保障，同时保持高性能和可扩展性。</p> 
<p>在实际应用中，可以使用 Nginx 和 Gateway 进行许多不同的组合方式，以满足不同的需求。例如，可以将 Nginx 作为 Gateway 的负载均衡器，将请求转发到不同的后端服务；也可以将 Nginx 配置为 Gateway 的反向代理服务器，将请求转发到不同的 Upstream 集群中。</p> 
<p>此外，Nginx 还提供了一些高级功能，例如 SSL 加速、请求缓存、静态文件服务等，可以为应用程序提供更高效和可靠的服务。与此同时，Gateway 则提供了更高级别的功能，例如 API 管理、安全性控制、监视和分析等，使得它可以作为应用程序出站流量的中心化管理平台。</p> 
<p>总之，Nginx 和 Gateway 都是非常强大和灵活的工具，它们可以与其他组件集成使用，以构建更加高效、可靠和安全的云原生应用程序。在实际应用中，需要根据具体的需求和场景来选择适当的组合方式，以达到最佳的性能和效果。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/75657c5e32746da9524a5f57bb9daa87/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【openbmc 开发专栏】：openbmc 开发步骤、源码分析、feature 介绍</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fef7932e851b640dc36895de81773829/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">真滴泰裤辣！！！！字节跳动最全Git应用及面试问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>