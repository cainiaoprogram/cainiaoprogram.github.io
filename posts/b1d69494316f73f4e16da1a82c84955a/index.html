<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>（三）正点原子I.MX6ULL kernel6.1挂根文件系统 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="（三）正点原子I.MX6ULL kernel6.1挂根文件系统" />
<meta property="og:description" content="一、概述 移植NXP官方最新的linux kernel（linux-imx-lf-6.1.y）
移植方法基本参照正点原子教程
移植开发板：正点原子阿尔法2.1
二、添加开发板到内核 进入内核目录下，先修改Makefile
打开终端：
cp arch/arm/configs/imx_v7_defconfig arch/arm/configs/imx_alientek_defconfig cp arch/arm/boot/dts/imx6ull-14x14-evk.dts arch/arm/boot/dts/imx6ull-alientek.dts cp arch/arm/boot/dts/imx6ul-14x14-evk.dtsi arch/arm/boot/dts/imx6ull-alientek.dtsi 打开arch/arm/boot/dts/Makefile，在第778行找到：
imx6ull-14x14-evk.dtb \ 在它下一行添加我们的设备树
imx6ull-14x14-evk.dtb \ imx6ull-alientek.dtb \ 三、修改设备树 在imx6ull-alientek.dts里可以改model和compatible：
/ { model = &#34;I.MX6ULL Alientek ALPHA&#34;; compatible = &#34;imx6ull alientek&#34;, &#34;fsl,imx6ull&#34;; }; 把include改成我们的文件：
// #include &#34;imx6ul-14x14-evk.dtsi&#34; #include &#34;imx6ull-alientek.dtsi&#34; 打开imx6ull-alientek.dtsi，这里是移植修改设备树的主阵地
找到fec2，修改后如下：
&amp;fec2 { pinctrl-names = &#34;default&#34;; pinctrl-0 = &lt;&amp;pinctrl_enet2&gt;; phy-mode = &#34;rmii&#34;; phy-handle = &lt;&amp;ethphy1&gt;; phy-supply = &lt;&amp;reg_peri_3v3&gt;; status = &#34;okay&#34;; mdio { #address-cells = &lt;1&gt;; #size-cells = &lt;0&gt;; ethphy0: ethernet-phy@0 { compatible = &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/b1d69494316f73f4e16da1a82c84955a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-12T17:44:22+08:00" />
<meta property="article:modified_time" content="2023-11-12T17:44:22+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">（三）正点原子I.MX6ULL kernel6.1挂根文件系统</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>一、概述</h2> 
<p>        移植NXP官方最新的linux kernel（linux-imx-lf-6.1.y）</p> 
<p>        移植方法基本参照正点原子教程</p> 
<p>        移植开发板：正点原子阿尔法2.1</p> 
<p></p> 
<h2>二、添加开发板到内核</h2> 
<p>        进入内核目录下，先修改Makefile</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/ba/13/246L6ofH_o.png"></p> 
<p>        打开终端：</p> 
<pre><code class="language-bash">cp arch/arm/configs/imx_v7_defconfig arch/arm/configs/imx_alientek_defconfig
cp arch/arm/boot/dts/imx6ull-14x14-evk.dts arch/arm/boot/dts/imx6ull-alientek.dts
cp arch/arm/boot/dts/imx6ul-14x14-evk.dtsi arch/arm/boot/dts/imx6ull-alientek.dtsi</code></pre> 
<p>        打开arch/arm/boot/dts/Makefile，在第778行找到：</p> 
<pre><code class="language-bash">imx6ull-14x14-evk.dtb \</code></pre> 
<p>        在它下一行添加我们的设备树</p> 
<pre><code class="language-bash">	imx6ull-14x14-evk.dtb \
	imx6ull-alientek.dtb \</code></pre> 
<p></p> 
<h2>三、修改设备树</h2> 
<p>        在imx6ull-alientek.dts里可以改model和compatible：</p> 
<pre><code class="language-cpp">/ {
	model = "I.MX6ULL Alientek ALPHA";
	compatible = "imx6ull alientek", "fsl,imx6ull";
};</code></pre> 
<p>        把include改成我们的文件：</p> 
<pre><code class="language-cpp">// #include "imx6ul-14x14-evk.dtsi"
#include "imx6ull-alientek.dtsi"</code></pre> 
<p>        打开imx6ull-alientek.dtsi，这里是移植修改设备树的主阵地</p> 
<p>        找到fec2，修改后如下：</p> 
<pre><code class="language-cpp">&amp;fec2 {
	pinctrl-names = "default";
	pinctrl-0 = &lt;&amp;pinctrl_enet2&gt;;
	phy-mode = "rmii";
	phy-handle = &lt;&amp;ethphy1&gt;;
	phy-supply = &lt;&amp;reg_peri_3v3&gt;;
	status = "okay";

	mdio {
		#address-cells = &lt;1&gt;;
		#size-cells = &lt;0&gt;;

		ethphy0: ethernet-phy@0 {
			compatible = "ethernet-phy-ieee802.3-c22";
			reg = &lt;0&gt;;
			smsc,disable-energy-detect;
			clocks = &lt;&amp;clks IMX6UL_CLK_ENET_REF&gt;;
			clock-names = "rmii-ref";

		};

		ethphy1: ethernet-phy@1 {
			compatible = "ethernet-phy-ieee802.3-c22";
			reg = &lt;1&gt;;
			smsc,disable-energy-detect;
			clocks = &lt;&amp;clks IMX6UL_CLK_ENET2_REF&gt;;
			clock-names = "rmii-ref";
		};
	};
};</code></pre> 
<p> </p> 
<p>把其它无关节点删除，可以得到一个相对精简的设备树：</p> 
<pre><code class="language-cpp">// SPDX-License-Identifier: GPL-2.0
//
// Copyright (C) 2015 Freescale Semiconductor, Inc.

/ {
	chosen {
		stdout-path = &amp;uart1;
	};

	memory@80000000 {
		device_type = "memory";
		reg = &lt;0x80000000 0x20000000&gt;;
	};

	reserved-memory {
		#address-cells = &lt;1&gt;;
		#size-cells = &lt;1&gt;;
		ranges;

		linux,cma {
			compatible = "shared-dma-pool";
			reusable;
			size = &lt;0xa000000&gt;;
			linux,cma-default;
		};
	};


	reg_sd1_vmmc: regulator-sd1-vmmc {
		compatible = "regulator-fixed";
		regulator-name = "VSD_3V3";
		regulator-min-microvolt = &lt;3300000&gt;;
		regulator-max-microvolt = &lt;3300000&gt;;
		gpio = &lt;&amp;gpio1 9 GPIO_ACTIVE_HIGH&gt;;
		off-on-delay-us = &lt;20000&gt;;
		enable-active-high;
	};

	reg_peri_3v3: regulator-peri-3v3 {
		compatible = "regulator-fixed";
		pinctrl-names = "default";
		pinctrl-0 = &lt;&amp;pinctrl_peri_3v3&gt;;
		regulator-name = "VPERI_3V3";
		regulator-min-microvolt = &lt;3300000&gt;;
		regulator-max-microvolt = &lt;3300000&gt;;
		gpio = &lt;&amp;gpio5 2 GPIO_ACTIVE_LOW&gt;;
		/*
		 * If you want to want to make this dynamic please
		 * check schematics and test all affected peripherals:
		 *
		 * - sensors
		 * - ethernet phy
		 * - can
		 * - bluetooth
		 * - wm8960 audio codec
		 * - ov5640 camera
		 */
		regulator-always-on;
	};

	
};

&amp;clks {
	assigned-clocks = &lt;&amp;clks IMX6UL_CLK_PLL4_AUDIO_DIV&gt;;
	assigned-clock-rates = &lt;786432000&gt;;
};


&amp;fec1 {
	pinctrl-names = "default";
	pinctrl-0 = &lt;&amp;pinctrl_enet1&gt;;
	phy-mode = "rmii";
	phy-handle = &lt;&amp;ethphy0&gt;;
	phy-supply = &lt;&amp;reg_peri_3v3&gt;;
	status = "okay";
};

&amp;fec2 {
	pinctrl-names = "default";
	pinctrl-0 = &lt;&amp;pinctrl_enet2&gt;;
	phy-mode = "rmii";
	phy-handle = &lt;&amp;ethphy1&gt;;
	phy-supply = &lt;&amp;reg_peri_3v3&gt;;
	status = "okay";

	mdio {
		#address-cells = &lt;1&gt;;
		#size-cells = &lt;0&gt;;

		ethphy0: ethernet-phy@0 {
			compatible = "ethernet-phy-ieee802.3-c22";
			reg = &lt;0&gt;;
			smsc,disable-energy-detect;
			clocks = &lt;&amp;clks IMX6UL_CLK_ENET_REF&gt;;
			clock-names = "rmii-ref";

		};

		ethphy1: ethernet-phy@1 {
			compatible = "ethernet-phy-ieee802.3-c22";
			reg = &lt;1&gt;;
			smsc,disable-energy-detect;
			clocks = &lt;&amp;clks IMX6UL_CLK_ENET2_REF&gt;;
			clock-names = "rmii-ref";
		};
	};
};





&amp;pxp {
	status = "okay";
};


&amp;snvs_poweroff {
	status = "okay";
};

&amp;snvs_pwrkey {
	status = "okay";
};

&amp;uart1 {
	pinctrl-names = "default";
	pinctrl-0 = &lt;&amp;pinctrl_uart1&gt;;
	status = "okay";
};



&amp;usbotg1 {
	dr_mode = "otg";
	pinctrl-names = "default";
	pinctrl-0 = &lt;&amp;pinctrl_usb_otg1&gt;;
	status = "okay";
};

&amp;usbotg2 {
	dr_mode = "host";
	disable-over-current;
	status = "okay";
};

&amp;usbphy1 {
	fsl,tx-d-cal = &lt;106&gt;;
};

&amp;usbphy2 {
	fsl,tx-d-cal = &lt;106&gt;;
};

&amp;usdhc1 {
	pinctrl-names = "default", "state_100mhz", "state_200mhz";
	pinctrl-0 = &lt;&amp;pinctrl_usdhc1&gt;;
	pinctrl-1 = &lt;&amp;pinctrl_usdhc1_100mhz&gt;;
	pinctrl-2 = &lt;&amp;pinctrl_usdhc1_200mhz&gt;;
	cd-gpios = &lt;&amp;gpio1 19 GPIO_ACTIVE_LOW&gt;;
	keep-power-in-suspend;
	wakeup-source;
	vmmc-supply = &lt;&amp;reg_sd1_vmmc&gt;;
	status = "okay";
};

&amp;usdhc2 {
	pinctrl-names = "default";
	pinctrl-0 = &lt;&amp;pinctrl_usdhc2&gt;;
	non-removable;
	keep-power-in-suspend;
	wakeup-source;
	status = "okay";
};

&amp;wdog1 {
	pinctrl-names = "default";
	pinctrl-0 = &lt;&amp;pinctrl_wdog&gt;;
	fsl,ext-reset-output;
};

&amp;iomuxc {
	pinctrl-names = "default";

	pinctrl_camera_clock: cameraclockgrp {
		fsl,pins = &lt;
			MX6UL_PAD_CSI_MCLK__CSI_MCLK		0x1b088
		&gt;;
	};

	pinctrl_csi1: csi1grp {
		fsl,pins = &lt;
			MX6UL_PAD_CSI_PIXCLK__CSI_PIXCLK	0x1b088
			MX6UL_PAD_CSI_VSYNC__CSI_VSYNC		0x1b088
			MX6UL_PAD_CSI_HSYNC__CSI_HSYNC		0x1b088
			MX6UL_PAD_CSI_DATA00__CSI_DATA02	0x1b088
			MX6UL_PAD_CSI_DATA01__CSI_DATA03	0x1b088
			MX6UL_PAD_CSI_DATA02__CSI_DATA04	0x1b088
			MX6UL_PAD_CSI_DATA03__CSI_DATA05	0x1b088
			MX6UL_PAD_CSI_DATA04__CSI_DATA06	0x1b088
			MX6UL_PAD_CSI_DATA05__CSI_DATA07	0x1b088
			MX6UL_PAD_CSI_DATA06__CSI_DATA08	0x1b088
			MX6UL_PAD_CSI_DATA07__CSI_DATA09	0x1b088
		&gt;;
	};

	pinctrl_enet1: enet1grp {
		fsl,pins = &lt;
			MX6UL_PAD_ENET1_RX_EN__ENET1_RX_EN	0x1b0b0
			MX6UL_PAD_ENET1_RX_ER__ENET1_RX_ER	0x1b0b0
			MX6UL_PAD_ENET1_RX_DATA0__ENET1_RDATA00	0x1b0b0
			MX6UL_PAD_ENET1_RX_DATA1__ENET1_RDATA01	0x1b0b0
			MX6UL_PAD_ENET1_TX_EN__ENET1_TX_EN	0x1b0b0
			MX6UL_PAD_ENET1_TX_DATA0__ENET1_TDATA00	0x1b0b0
			MX6UL_PAD_ENET1_TX_DATA1__ENET1_TDATA01	0x1b0b0
			MX6UL_PAD_ENET1_TX_CLK__ENET1_REF_CLK1	0x4001b031
		&gt;;
	};

	pinctrl_enet2: enet2grp {
		fsl,pins = &lt;
			MX6UL_PAD_GPIO1_IO07__ENET2_MDC		0x1b0b0
			MX6UL_PAD_GPIO1_IO06__ENET2_MDIO	0x1b0b0
			MX6UL_PAD_ENET2_RX_EN__ENET2_RX_EN	0x1b0b0
			MX6UL_PAD_ENET2_RX_ER__ENET2_RX_ER	0x1b0b0
			MX6UL_PAD_ENET2_RX_DATA0__ENET2_RDATA00	0x1b0b0
			MX6UL_PAD_ENET2_RX_DATA1__ENET2_RDATA01	0x1b0b0
			MX6UL_PAD_ENET2_TX_EN__ENET2_TX_EN	0x1b0b0
			MX6UL_PAD_ENET2_TX_DATA0__ENET2_TDATA00	0x1b0b0
			MX6UL_PAD_ENET2_TX_DATA1__ENET2_TDATA01	0x1b0b0
			MX6UL_PAD_ENET2_TX_CLK__ENET2_REF_CLK2	0x4001b031
		&gt;;
	};

	pinctrl_uart1: uart1grp {
		fsl,pins = &lt;
			MX6UL_PAD_UART1_TX_DATA__UART1_DCE_TX 0x1b0b1
			MX6UL_PAD_UART1_RX_DATA__UART1_DCE_RX 0x1b0b1
		&gt;;
	};

	pinctrl_usb_otg1: usbotg1grp {
		fsl,pins = &lt;
			MX6UL_PAD_GPIO1_IO00__ANATOP_OTG1_ID	0x17059
		&gt;;
	};

	pinctrl_usdhc1: usdhc1grp {
		fsl,pins = &lt;
			MX6UL_PAD_SD1_CMD__USDHC1_CMD     	0x17059
			MX6UL_PAD_SD1_CLK__USDHC1_CLK		0x10071
			MX6UL_PAD_SD1_DATA0__USDHC1_DATA0 	0x17059
			MX6UL_PAD_SD1_DATA1__USDHC1_DATA1 	0x17059
			MX6UL_PAD_SD1_DATA2__USDHC1_DATA2 	0x17059
			MX6UL_PAD_SD1_DATA3__USDHC1_DATA3 	0x17059
			MX6UL_PAD_UART1_RTS_B__GPIO1_IO19       0x17059 /* SD1 CD */
			MX6UL_PAD_GPIO1_IO05__USDHC1_VSELECT    0x17059 /* SD1 VSELECT */
			MX6UL_PAD_GPIO1_IO09__GPIO1_IO09        0x17059 /* SD1 RESET */
		&gt;;
	};

	pinctrl_usdhc1_100mhz: usdhc1grp100mhz {
		fsl,pins = &lt;
			MX6UL_PAD_SD1_CMD__USDHC1_CMD     0x170b9
			MX6UL_PAD_SD1_CLK__USDHC1_CLK     0x100b9
			MX6UL_PAD_SD1_DATA0__USDHC1_DATA0 0x170b9
			MX6UL_PAD_SD1_DATA1__USDHC1_DATA1 0x170b9
			MX6UL_PAD_SD1_DATA2__USDHC1_DATA2 0x170b9
			MX6UL_PAD_SD1_DATA3__USDHC1_DATA3 0x170b9

		&gt;;
	};

	pinctrl_usdhc1_200mhz: usdhc1grp200mhz {
		fsl,pins = &lt;
			MX6UL_PAD_SD1_CMD__USDHC1_CMD     0x170f9
			MX6UL_PAD_SD1_CLK__USDHC1_CLK     0x100f9
			MX6UL_PAD_SD1_DATA0__USDHC1_DATA0 0x170f9
			MX6UL_PAD_SD1_DATA1__USDHC1_DATA1 0x170f9
			MX6UL_PAD_SD1_DATA2__USDHC1_DATA2 0x170f9
			MX6UL_PAD_SD1_DATA3__USDHC1_DATA3 0x170f9
		&gt;;
	};

	pinctrl_usdhc2: usdhc2grp {
		fsl,pins = &lt;
			MX6UL_PAD_NAND_RE_B__USDHC2_CLK     0x17059
			MX6UL_PAD_NAND_WE_B__USDHC2_CMD     0x17059
			MX6UL_PAD_NAND_DATA00__USDHC2_DATA0 0x17059
			MX6UL_PAD_NAND_DATA01__USDHC2_DATA1 0x17059
			MX6UL_PAD_NAND_DATA02__USDHC2_DATA2 0x17059
			MX6UL_PAD_NAND_DATA03__USDHC2_DATA3 0x17059
		&gt;;
	};

	pinctrl_usdhc2_8bit: usdhc2grp_8bit {
		fsl,pins = &lt;
			MX6UL_PAD_NAND_RE_B__USDHC2_CLK     0x10069
			MX6UL_PAD_NAND_WE_B__USDHC2_CMD     0x17059
			MX6UL_PAD_NAND_DATA00__USDHC2_DATA0 0x17059
			MX6UL_PAD_NAND_DATA01__USDHC2_DATA1 0x17059
			MX6UL_PAD_NAND_DATA02__USDHC2_DATA2 0x17059
			MX6UL_PAD_NAND_DATA03__USDHC2_DATA3 0x17059
			MX6UL_PAD_NAND_DATA04__USDHC2_DATA4 0x17059
			MX6UL_PAD_NAND_DATA05__USDHC2_DATA5 0x17059
			MX6UL_PAD_NAND_DATA06__USDHC2_DATA6 0x17059
			MX6UL_PAD_NAND_DATA07__USDHC2_DATA7 0x17059
		&gt;;
	};

	pinctrl_usdhc2_8bit_100mhz: usdhc2grp_8bit_100mhz {
		fsl,pins = &lt;
			MX6UL_PAD_NAND_RE_B__USDHC2_CLK     0x100b9
			MX6UL_PAD_NAND_WE_B__USDHC2_CMD     0x170b9
			MX6UL_PAD_NAND_DATA00__USDHC2_DATA0 0x170b9
			MX6UL_PAD_NAND_DATA01__USDHC2_DATA1 0x170b9
			MX6UL_PAD_NAND_DATA02__USDHC2_DATA2 0x170b9
			MX6UL_PAD_NAND_DATA03__USDHC2_DATA3 0x170b9
			MX6UL_PAD_NAND_DATA04__USDHC2_DATA4 0x170b9
			MX6UL_PAD_NAND_DATA05__USDHC2_DATA5 0x170b9
			MX6UL_PAD_NAND_DATA06__USDHC2_DATA6 0x170b9
			MX6UL_PAD_NAND_DATA07__USDHC2_DATA7 0x170b9
		&gt;;
	};

	pinctrl_usdhc2_8bit_200mhz: usdhc2grp_8bit_200mhz {
		fsl,pins = &lt;
			MX6UL_PAD_NAND_RE_B__USDHC2_CLK     0x100f9
			MX6UL_PAD_NAND_WE_B__USDHC2_CMD     0x170f9
			MX6UL_PAD_NAND_DATA00__USDHC2_DATA0 0x170f9
			MX6UL_PAD_NAND_DATA01__USDHC2_DATA1 0x170f9
			MX6UL_PAD_NAND_DATA02__USDHC2_DATA2 0x170f9
			MX6UL_PAD_NAND_DATA03__USDHC2_DATA3 0x170f9
			MX6UL_PAD_NAND_DATA04__USDHC2_DATA4 0x170f9
			MX6UL_PAD_NAND_DATA05__USDHC2_DATA5 0x170f9
			MX6UL_PAD_NAND_DATA06__USDHC2_DATA6 0x170f9
			MX6UL_PAD_NAND_DATA07__USDHC2_DATA7 0x170f9
		&gt;;
	};

	pinctrl_wdog: wdoggrp {
		fsl,pins = &lt;
			MX6UL_PAD_LCD_RESET__WDOG1_WDOG_ANY    0x30b0
		&gt;;
	};
};
</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9915155620116c5d1daff286621bc12f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">ubuntu部署k8s</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ce1f3309360d53994d6d80c2d7182055/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">在使用Vuex时，5个方法让你保证数据的更新及时性</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>