<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Typora自定义上传图片到服务器图床(java实现) - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Typora自定义上传图片到服务器图床(java实现)" />
<meta property="og:description" content="日常使用Typora写博客,遇到图片需要手动上传的服务器映射,Typora软件新版本支持自定义上传到图床本篇记录上传到本人服务器中。
实现步骤(java实现):
1、Typora使用Custom Command,请求到本地jar包main方法中，请求参数为本地图片路径
2、jar包拿到本地图片路径,请求服务器上传文件接口
3、服务器存储,并且返回url映射地址
话不多说,直接撸代码~~~
一、本地jar包 1、idea创建SpringBoot空项目,可以不勾选任何依赖 2、pom.xml配置，导入hutool包。(直接使用我的) &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-logging&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- https://mvnrepository.com/artifact/cn.hutool/hutool-all --&gt; &lt;dependency&gt; &lt;groupId&gt;cn.hutool&lt;/groupId&gt; &lt;artifactId&gt;hutool-all&lt;/artifactId&gt; &lt;version&gt;5.3.10&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.commons&lt;/groupId&gt; &lt;artifactId&gt;commons-lang3&lt;/artifactId&gt; &lt;version&gt;3.12.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; 3、创建类TyporaUploadFile，mian方法使用hutool上传到服务器接口 import cn.hutool.core.io.FileUtil; import cn.hutool.http.HttpUtil; import java.util.Arrays; import java.util.HashMap; /** * @author Chen Shaohua * @date 2023/1/17 15:44 */ public class TyporaUploadFile { public static void main(String[] args) { System." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/53f4567cada04fcd1fda65fe1e6a7ea7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-12T14:44:43+08:00" />
<meta property="article:modified_time" content="2023-07-12T14:44:43+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Typora自定义上传图片到服务器图床(java实现)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>日常使用Typora写博客,遇到图片需要手动上传的服务器映射,Typora软件新版本支持自定义上传到图床本篇记录上传到本人服务器中。</p> 
 
<blockquote> 
 <p>实现步骤(java实现):</p> 
 <p>1、Typora使用Custom Command,请求到本地jar包main方法中，请求参数为本地图片路径</p> 
 <p>2、jar包拿到本地图片路径,请求服务器上传文件接口</p> 
 <p>3、服务器存储,并且返回url映射地址</p> 
 <p>话不多说,直接撸代码~~~</p> 
</blockquote> 
<h4><a id="jar_13"></a>一、本地jar包</h4> 
<h5><a id="1ideaSpringBoot_15"></a>1、idea创建SpringBoot空项目,可以不勾选任何依赖</h5> 
<p><img src="https://images2.imgbox.com/61/24/CrrXzPVP_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="2pomxmlhutool_20"></a>2、pom.xml配置，导入hutool包。(直接使用我的)</h5> 
<pre><code>&lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-logging&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- https://mvnrepository.com/artifact/cn.hutool/hutool-all --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;cn.hutool&lt;/groupId&gt;
            &lt;artifactId&gt;hutool-all&lt;/artifactId&gt;
            &lt;version&gt;5.3.10&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;
            &lt;artifactId&gt;commons-lang3&lt;/artifactId&gt;
            &lt;version&gt;3.12.0&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
</code></pre> 
<h5><a id="3TyporaUploadFilemianhutool_59"></a>3、创建类TyporaUploadFile，mian方法使用hutool上传到服务器接口</h5> 
<pre><code>import cn.hutool.core.io.FileUtil;
import cn.hutool.http.HttpUtil;

import java.util.Arrays;
import java.util.HashMap;

/**
 * @author Chen Shaohua
 * @date 2023/1/17 15:44
 */
public class TyporaUploadFile {
    public static void main(String[] args) {
        System.out.println("本地文件:" + Arrays.toString(args));
        if (args.length == 0) return;
        for (String filePath : args) {
            HashMap&lt;String, Object&gt; paramMap = new HashMap&lt;&gt;();
            paramMap.put("file", FileUtil.file(filePath));
            String post = HttpUtil.post("Http://服务器地址:8090/file/saveFile", paramMap);
            System.out.println(post);
        }
    }
}
</code></pre> 
<h5><a id="4jar_86"></a>4、编译jar包配置</h5> 
<p><strong>右上角File -&gt; Project Structure</strong></p> 
<p><img src="https://images2.imgbox.com/18/e1/BiYv1S4U_o.png" alt="image-20230117184435403"></p> 
<hr> 
<p><strong>Artifacts - &gt; 右边+号 -&gt; 选择第二个</strong></p> 
<p><img src="https://images2.imgbox.com/08/42/BvLr2cp0_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<p><strong>编译设置,选择后点ok</strong></p> 
<p><img src="https://images2.imgbox.com/23/38/N0AKGqH8_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<p><strong>设置完成如下</strong></p> 
<p><img src="https://images2.imgbox.com/d7/18/vOxS7g29_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="5_109"></a>5、编译</h5> 
<p><strong>最上方菜单栏点击,build -&gt; build Artifacts -&gt; 如图下 -&gt; build</strong></p> 
<p><img src="https://images2.imgbox.com/15/d0/ej94lwWp_o.png" alt="image-20230117185427395"></p> 
<h5><a id="6jar_115"></a>6、编辑后jar包,放到自己常用位置</h5> 
<p><img src="https://images2.imgbox.com/c5/e5/IvOtCEjr_o.png" alt="image-20230117185503328"></p> 
<h4><a id="_119"></a>二、服务器上传文件接口</h4> 
<h5><a id="1config_121"></a>1、config配置与本地文件映射</h5> 
<p><strong>地址为需要和本地那个文件夹配置映射,不懂百度有详解</strong></p> 
<p>注:必须以/结尾，否则上传文件完成后,url访问不到,404</p> 
<p><img src="https://images2.imgbox.com/ef/8f/SeLz56Gb_o.png" alt="image-20230117185825760"></p> 
<pre><code>package com.example.aliyuntest.config;

import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.CorsRegistry;
import org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

@Configuration
public class WebConfig implements WebMvcConfigurer {

    //跨域配置，前端和后端端口不一样
    @Override
    public void addCorsMappings(CorsRegistry registry) {
        //8080前端使用的端口号
        registry.addMapping("/**");
    }

    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler("/file/**").addResourceLocations("file:/myData/testPro/fileTemp/");
    }
}
</code></pre> 
<h5><a id="2Controller_156"></a>2、Controller编写上传接口</h5> 
<pre><code>package com.example.aliyuntest.controller;

import cn.hutool.core.date.DatePattern;
import cn.hutool.core.date.DateUtil;
import cn.hutool.core.io.FileUtil;
import cn.hutool.json.JSONObject;
import lombok.extern.slf4j.Slf4j;
import org.apache.commons.lang3.StringUtils;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.web.bind.annotation.CrossOrigin;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.multipart.MultipartFile;

import javax.servlet.http.HttpServletRequest;
import java.io.File;

/**
 * @author Chen Shaohua
 * @date 2022/11/15 16:53
 */
@RestController
@RequestMapping("/file")
@CrossOrigin
@Slf4j
public class FileController {

    @RequestMapping(value = "/saveFile")
    public String paddleOcr(MultipartFile file,  HttpServletRequest request) {
        if (file ==null || file.isEmpty()) {
            return "文件为空!";
        }
        String url = "http://服务器地址:" + request.getLocalPort() + "/file/";
        try {
            String name = file.getOriginalFilename();
            //获取主文件名 文件后缀
            String suffix = FileUtil.getSuffix(name);
            //文件名称为日期时间简写,如:20230117190235  年月日时分秒
            String fileName = DateUtil.format(DateUtil.date(), DatePattern.PURE_DATETIME_PATTERN) + "." + suffix;
            //一般情况为 年 月 项目名
            String fileNamePath = DateUtil.format(DateUtil.date(), "yyyy/MM/")+ fileName;
            //创建父文件夹,不存在创建
            FileUtil.mkdir(filePath + fileNamePath);
            //创建文件
            File newFile = new File(filePath + fileNamePath);
            //写入文件
            file.transferTo(newFile);
            //返回url地址
            return url + fileNamePath;
        } catch (Exception e) {
            log.info("保存文件异常!", e);
            return "保存文件异常!" + e.getMessage();
        }
    }
}
</code></pre> 
<h5><a id="3applicationyml_216"></a>3、application.yml配置</h5> 
<pre><code>server:
  port: 8090

spring:
  servlet:
    multipart:
      enabled: true
      max-file-size: 10240MB   #最大文件size
      max-request-size: 10240MB #每次请求最大size
      
logging:
  file:
    name: ./log/logs.log
</code></pre> 
<h5><a id="4_234"></a>4、完整项目</h5> 
<p><img src="https://images2.imgbox.com/e4/56/WFe1c3Iv_o.png" alt="image-20230117191519076"></p> 
<h4><a id="Typora_238"></a>三、Typora配置</h4> 
<p>打开左上角设置 -&gt; 偏好设置，如图下</p> 
<p>命令行代码执行本地jar包的main方法，本地必须配置环境变量(百度一大堆)</p> 
<pre><code>java -jar jar包放置位置 ...文件路径(可配多个)
</code></pre> 
<p><img src="https://images2.imgbox.com/44/0a/hWB1murS_o.png" alt="image-20230117183350017"></p> 
<hr> 
<p><strong>点击验证图片上传选项测试</strong></p> 
<p><img src="https://images2.imgbox.com/7a/67/sLBXmWDf_o.png" alt="image-20230117191014242"></p> 
<hr> 
<p><strong>编写时上传</strong></p> 
<p>截屏 -&gt; 粘贴图片 -&gt; 右击图片点击上传</p> 
<h4><a id="gitee_262"></a>四、完整项目已上传到gitee中,欢迎大家使用</h4> 
<p>配置文件映射路径已做动态配置</p> 
<p><a href="https://gitee.com/ChenShaoshao/aliyun-test" rel="nofollow">完整代码地址gitee</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a497d2e6c0a9fbec86741b82a6a461a9/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">基于单片机的楼宇水塔水位检测系统设计与实现（设计报告&#43;源代码&#43;proteus仿真&#43;PCB&#43;开题报告&#43;中期报告）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1b71529b698f029ba8c34f37ff0843cb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">XML存在特殊字符导致无法解析，使用CDATA或转译解决难题！！</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>