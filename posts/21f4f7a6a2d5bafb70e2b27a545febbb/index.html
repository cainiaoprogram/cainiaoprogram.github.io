<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>C&#43;&#43;简单的TCP/IP服务端与客户端（附完整代码） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="C&#43;&#43;简单的TCP/IP服务端与客户端（附完整代码）" />
<meta property="og:description" content="一. TCP服务端 （一）创建一个TCP服务端 可大致分为以下5个步骤：
1.初始化环境 2.创建监听套接字 3.监听套接字与IP地址及端口绑定 4.监听套接字 5.等待客户端连接 1. 初始化环境 WSADATA	wsaData; WSAStartup(MAKEWORD(2, 2), &amp;wsaData); WSAStartup()函数的调用指明Windows Sockets API的版本号及获得特定Windows Sockets实现的细节，应用程序或DLL只能在一次成功的WSAStartup()调用之后才能调用进一步的Windows Sockets API函数。
该函数执行成功后返回0。
2. 创建监听套接字 m_listenSocket = socket(AF_INET, SOCK_STREAM, 0)); AF_INET：指定使用IPV4协议簇
SOCK_STREAM：字节流，数据有保障的传输
0：不希望指定协议
该函数执行成功返回一个新的套接字，否则返回：INVALID_SOCKET。
3. 监听套接字与IP地址及端口绑定 sockaddr_in sockadd = { 0, }; sockadd.sin_family = AF_INET;//IPV4协议簇 sockadd.sin_port = htons(m_uPort);//监听端口 sockadd.sin_addr.S_un.S_addr = htonl(INADDR_ANY);//监听本机任意IP bind(m_listenSocket, (struct sockaddr*) &amp; sockadd, sizeof(sockadd)); m_listenSocket：已经创建好的监听套接字
INADDR_ANY：如果机器存在多网卡，客户端连接任意一个IP地址均可建立通信
执行失败时返回： SOCKET_ERROR
4. 监听套接字 listen(m_listenSocket, 1); m_listenSocket：绑定IP地址及端口的监听地址
1：指定最大允许同时连接的客户端数
5. 等待客户端连接 m_clientSocket = accept(m_listenSocket, (struct sockaddr*) &amp; addr, &amp;addrlen); 提取套接字m_listenSocket上挂起连接队列的第一个连接，然后返回新套接字m_clientSocket，如过要与客户端通信就需要通过m_clientSocket来发送或接收数据" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/21f4f7a6a2d5bafb70e2b27a545febbb/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-04-14T23:50:22+08:00" />
<meta property="article:modified_time" content="2020-04-14T23:50:22+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">C&#43;&#43;简单的TCP/IP服务端与客户端（附完整代码）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_TCP_0"></a>一. TCP服务端</h2> 
<h3><a id="TCP_1"></a>（一）创建一个TCP服务端</h3> 
<p>可大致分为以下5个步骤：</p> 
<pre><code> 1.初始化环境
 2.创建监听套接字
 3.监听套接字与IP地址及端口绑定
 4.监听套接字
 5.等待客户端连接
</code></pre> 
<h4><a id="1__9"></a>1. 初始化环境</h4> 
<pre><code class="prism language-cpp">WSADATA	wsaData<span class="token punctuation">;</span>

<span class="token function">WSAStartup</span><span class="token punctuation">(</span><span class="token function">MAKEWORD</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>wsaData<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>WSAStartup()函数的调用指明Windows Sockets API的版本号及获得特定Windows Sockets实现的细节，应用程序或DLL只能在一次成功的WSAStartup()调用之后才能调用进一步的Windows Sockets API函数。<br> 该函数执行成功后返回0。</p> 
<h4><a id="2__17"></a>2. 创建监听套接字</h4> 
<pre><code class="prism language-cpp">m_listenSocket <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> SOCK_STREAM<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>AF_INET</strong>：指定使用IPV4协议簇<br> <strong>SOCK_STREAM</strong>：字节流，数据有保障的传输<br> <strong>0</strong>：不希望指定协议<br> <strong>该函数执行成功返回</strong>一个新的套接字，<strong>否则返回</strong>：INVALID_SOCKET。</p> 
<h4><a id="3_IP_25"></a>3. 监听套接字与IP地址及端口绑定</h4> 
<pre><code class="prism language-cpp">sockaddr_in sockadd <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

sockadd<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span><span class="token comment">//IPV4协议簇</span>
sockadd<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span>m_uPort<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//监听端口</span>
sockadd<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>S_un<span class="token punctuation">.</span>S_addr <span class="token operator">=</span> <span class="token function">htonl</span><span class="token punctuation">(</span>INADDR_ANY<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//监听本机任意IP</span>
<span class="token function">bind</span><span class="token punctuation">(</span>m_listenSocket<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> sockadd<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>sockadd<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>m_listenSocket</strong>：已经创建好的监听套接字<br> <strong>INADDR_ANY</strong>：如果机器存在多网卡，客户端连接任意一个IP地址均可建立通信<br> <strong>执行失败时返回</strong>： SOCKET_ERROR</p> 
<h4><a id="4__37"></a>4. 监听套接字</h4> 
<pre><code class="prism language-cpp"><span class="token function">listen</span><span class="token punctuation">(</span>m_listenSocket<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>m_listenSocket：绑定IP地址及端口的监听地址<br> 1：指定最大允许同时连接的客户端数</p> 
<h4><a id="5__43"></a>5. 等待客户端连接</h4> 
<pre><code class="prism language-cpp">m_clientSocket <span class="token operator">=</span> <span class="token function">accept</span><span class="token punctuation">(</span>m_listenSocket<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> addr<span class="token punctuation">,</span> <span class="token operator">&amp;</span>addrlen<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>提取套接字m_listenSocket上挂起连接队列的第一个连接，然后返回新套接字m_clientSocket，如过要与客户端通信就需要通过m_clientSocket来发送或接收数据<br> <mark>如果暂时没有客户端连接过来，该函数将阻塞在此处，直到新连接到来才会返回。</mark></p> 
<h3><a id="_49"></a>（二）数据收发</h3> 
<h4><a id="1__50"></a>1. 接收数据</h4> 
<pre><code class="prism language-cpp"><span class="token keyword">const</span> <span class="token keyword">int</span> iBufSize <span class="token operator">=</span> <span class="token number">1024</span><span class="token punctuation">;</span>
<span class="token keyword">char</span> recvBuf<span class="token punctuation">[</span>iBufSize<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">auto</span> iRecvSize <span class="token operator">=</span> <span class="token function">recv</span><span class="token punctuation">(</span>m_clientSocket<span class="token punctuation">,</span> recvBuf<span class="token punctuation">,</span> iBufSize<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//若不支持C++11及以上，auto改为int</span>
</code></pre> 
<p><strong>m_clientSocket</strong>：收发数据时，均需要用到accept()返回的客户端套接字<br> <strong>recvBuf</strong>：接收数据缓冲区，收到的数据就保存在该数组中<br> <strong>iBufSize</strong>：recvBuf数组的字节长度，最多接收到的数据长度，该缓冲区也只能接收这么多，否则会溢出，造成程序异常<br> <strong>0</strong>：将数据从TCP从输入队列中剪切到recvBuf，且不做其他操作<br> <strong>返回值</strong>：如果没有发生错误，recv将返回接收到的字节数，recvBuf参数指向的缓冲区将包含接收到的数据。如果连接已经正常关闭，则返回值为零。否则，将返回一个SOCKET_ERROR值<br> <mark>如果套接字m_clientSocket上没有可用的传入数据，则recv调用阻塞并等待数据并不会返回，除非定义了其他阻塞规则，此处并没有指定</mark></p> 
<h4><a id="2__62"></a>2. 发送数据</h4> 
<pre><code class="prism language-cpp">std<span class="token operator">::</span>string strMsg <span class="token operator">=</span> <span class="token string">"hello"</span><span class="token punctuation">;</span>
<span class="token function">send</span><span class="token punctuation">(</span>m_clientSocket<span class="token punctuation">,</span> strMsg<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> strMsg<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>m_clientSocket</strong>：收发数据时，均需要用到accept()返回的客户端套接字<br> <strong>strMsg.c_str()</strong>：发送数据首地址<br> <strong>strMsg.length()</strong>：数据长度<br> <strong>0</strong>：无特别指定调用<br> <strong>返回值</strong>：如果没有发生错误，send返回发送的字节总数，它可能小于len参数中请求发送的字节数。否则，将返回SOCKET_ERROR的值</p> 
<h4><a id="_72"></a>（三）服务端代码</h4> 
<h3><a id="CTcpServerh_73"></a>CTcpServer.h</h3> 
<pre><code class="prism language-cpp"><span class="token comment">//CTcpServer.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;winsock2.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression"><span class="token function">comment</span><span class="token punctuation">(</span>lib<span class="token punctuation">,</span></span><span class="token string">"ws2_32"</span><span class="token expression"><span class="token punctuation">)</span></span><span class="token comment">//Standard socket API.</span></span>

<span class="token keyword">class</span> <span class="token class-name">CTcpServer</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token function">CTcpServer</span><span class="token punctuation">(</span>std<span class="token operator">::</span>string strIp<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> uPort<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">CTcpServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//初始化网络服务端</span>
	<span class="token keyword">bool</span> <span class="token function">InitServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//发送数据</span>
	<span class="token keyword">bool</span> <span class="token function">SendMsg</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> strMsg<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//接收数据并打印</span>
	<span class="token keyword">bool</span> <span class="token function">RecvMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">int</span> m_uPort<span class="token punctuation">;</span><span class="token comment">//监听端口</span>
	std<span class="token operator">::</span>string m_strIp<span class="token punctuation">;</span><span class="token comment">//用于监听本机指定IP地址</span>

	SOCKET m_listenSocket <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span><span class="token comment">//监听套接字</span>
	SOCKET m_clientSocket <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span><span class="token comment">//客户端套接字</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="CTcpServercpp_106"></a>CTcpServer.cpp</h3> 
<pre><code class="prism language-cpp"><span class="token comment">//CTcpServer.cpp</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"CTcpServer.h"</span></span>

<span class="token class-name">CTcpServer</span><span class="token operator">::</span><span class="token function">CTcpServer</span><span class="token punctuation">(</span>std<span class="token operator">::</span>string strIp<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> uPort<span class="token punctuation">)</span> <span class="token operator">:</span>
	<span class="token function">m_strIp</span><span class="token punctuation">(</span>strIp<span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token function">m_uPort</span><span class="token punctuation">(</span>uPort<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span>

<span class="token class-name">CTcpServer</span><span class="token operator">::</span><span class="token operator">~</span><span class="token function">CTcpServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>m_clientSocket<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">closesocket</span><span class="token punctuation">(</span>m_clientSocket<span class="token punctuation">)</span><span class="token punctuation">;</span>
		m_clientSocket <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>m_listenSocket<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">closesocket</span><span class="token punctuation">(</span>m_listenSocket<span class="token punctuation">)</span><span class="token punctuation">;</span>
		m_listenSocket <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">WSACleanup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">bool</span> <span class="token class-name">CTcpServer</span><span class="token operator">::</span><span class="token function">InitServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	WSADATA	wsaData<span class="token punctuation">;</span>

	<span class="token comment">//1. 初始化环境</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">WSAStartup</span><span class="token punctuation">(</span><span class="token function">MAKEWORD</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>wsaData<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Init Windows Socket Failed!\n"</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//2. 创建监听套接字</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>m_listenSocket <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> SOCK_STREAM<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> INVALID_SOCKET<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Create socket failed!\n"</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//协议</span>
	sockaddr_in sockadd <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

	sockadd<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span><span class="token comment">//IPV4协议簇</span>
	sockadd<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span>m_uPort<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//监听端口</span>
	sockadd<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>S_un<span class="token punctuation">.</span>S_addr <span class="token operator">=</span> <span class="token function">htonl</span><span class="token punctuation">(</span>INADDR_ANY<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//监听本机任意IP</span>

	<span class="token comment">//3. 监听套接字与IP地址及端口绑定</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">bind</span><span class="token punctuation">(</span>m_listenSocket<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> sockadd<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>sockadd<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> SOCKET_ERROR<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">closesocket</span><span class="token punctuation">(</span>m_listenSocket<span class="token punctuation">)</span><span class="token punctuation">;</span>
		m_listenSocket <span class="token operator">=</span> INVALID_SOCKET<span class="token punctuation">;</span>
		std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Socket bind failed!\n"</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//4. 监听套接字</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">listen</span><span class="token punctuation">(</span>m_listenSocket<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> SOCKET_ERROR<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">closesocket</span><span class="token punctuation">(</span>m_listenSocket<span class="token punctuation">)</span><span class="token punctuation">;</span>
		m_listenSocket <span class="token operator">=</span> INVALID_SOCKET<span class="token punctuation">;</span>
		std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Socket listen failed!\n"</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	sockaddr_in addr <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> addrlen <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//5. 等待客户端连接</span>
	m_clientSocket <span class="token operator">=</span> <span class="token function">accept</span><span class="token punctuation">(</span>m_listenSocket<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> addr<span class="token punctuation">,</span> <span class="token operator">&amp;</span>addrlen<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>m_clientSocket <span class="token operator">==</span> SOCKET_ERROR<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">closesocket</span><span class="token punctuation">(</span>m_clientSocket<span class="token punctuation">)</span><span class="token punctuation">;</span>
		m_clientSocket <span class="token operator">=</span> INVALID_SOCKET<span class="token punctuation">;</span>
		std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Socket accept failed!\n"</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">bool</span> <span class="token class-name">CTcpServer</span><span class="token operator">::</span><span class="token function">SendMsg</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> strMsg<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>m_clientSocket<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>m_clientSocket<span class="token punctuation">,</span> strMsg<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> strMsg<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">!=</span> INVALID_SOCKET<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"发送成功:"</span> <span class="token operator">&lt;&lt;</span> strMsg <span class="token operator">&lt;&lt;</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span>
	<span class="token punctuation">{<!-- --></span>
		std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"发送失败!\n"</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">bool</span> <span class="token class-name">CTcpServer</span><span class="token operator">::</span><span class="token function">RecvMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>m_clientSocket<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

	<span class="token keyword">const</span> <span class="token keyword">int</span> iBufSize <span class="token operator">=</span> <span class="token number">1024</span><span class="token punctuation">;</span>
	<span class="token keyword">char</span> recvBuf<span class="token punctuation">[</span>iBufSize<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token keyword">auto</span> iRecvSize <span class="token operator">=</span> <span class="token function">recv</span><span class="token punctuation">(</span>m_clientSocket<span class="token punctuation">,</span> recvBuf<span class="token punctuation">,</span> iBufSize<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//若不支持C++11及以上，auto改为int</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>iRecvSize <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"接收失败!\n"</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span>
	<span class="token punctuation">{<!-- --></span>
		std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"接收成功:"</span> <span class="token operator">&lt;&lt;</span> recvBuf <span class="token operator">&lt;&lt;</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"CTcpServer.h"</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">{<!-- --></span>
        CTcpServer <span class="token function">tcpServer</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token number">6005</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>tcpServer<span class="token punctuation">.</span><span class="token function">InitServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">!=</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
        	<span class="token comment">//接收数据成功后，向客户端返回"answer"</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>tcpServer<span class="token punctuation">.</span><span class="token function">RecvMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                std<span class="token operator">::</span>string strAnswerMsg<span class="token punctuation">{<!-- --></span> <span class="token string">"answer"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

                tcpServer<span class="token punctuation">.</span><span class="token function">SendMsg</span><span class="token punctuation">(</span>strAnswerMsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token comment">//接收3次数据后出此大括号，tcpServer对象被析构，客户端连接被关闭</span>
    
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="_TCP_258"></a>二. TCP客户端</h2> 
<h3><a id="TCP_259"></a>创建一个TCP客户端</h3> 
<pre><code>1. 初始化环境
2. 创建一个新的套接字
3. 建立连接
</code></pre> 
<p>客户端的创建比较简单，只需要三步，创建好了之后就可以进行数据的收发了<br> <strong>短链接</strong>：客户端与服务端建立连接之后，进行短暂的收发数据之后即断开连接（closesocket()）称为短链接<br> <strong>长连接</strong>：两者建立连接之后需要长时间保持该连接的成为长连接，在不需要数据交互时可以每隔<mark>一定时间</mark>其中一方发送一个心跳报文（内容可以是约定的任意值，比如字符串“heartBeat”）到另一方，另一方收到心跳报文后立即恢复一个应答（同样是约定的任意值），发送方在一定次数没有收到应答 或者 接收方一定次数没有收到心跳报文时，均可判定对方断线，此时可以关闭套接字或其他业务逻辑</p> 
<p>还是直接上代码吧</p> 
<h4><a id="CTcpClienth_268"></a>CTcpClient.h</h4> 
<pre><code class="prism language-cpp"><span class="token comment">//CTcpClient.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;winsock2.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression"><span class="token function">comment</span><span class="token punctuation">(</span>lib<span class="token punctuation">,</span></span><span class="token string">"ws2_32"</span><span class="token expression"><span class="token punctuation">)</span></span><span class="token comment">//Standard socket API.</span></span>

<span class="token keyword">class</span> <span class="token class-name">CTcpClient</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token function">CTcpClient</span><span class="token punctuation">(</span>std<span class="token operator">::</span>string strServerIp<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> uServerPort<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">CTcpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//建立连接</span>
	<span class="token keyword">bool</span> <span class="token function">InitConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//发送数据</span>
	<span class="token keyword">bool</span> <span class="token function">SendMsg</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> strMsg<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//接收数据并打印</span>
	<span class="token keyword">bool</span> <span class="token function">RecvMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">private</span><span class="token operator">:</span>
	SOCKET m_socket <span class="token operator">=</span> INVALID_SOCKET<span class="token punctuation">;</span>
	std<span class="token operator">::</span>string m_strServerIp<span class="token punctuation">;</span><span class="token comment">//服务端监听IP地址</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">int</span> m_uServerPort <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//服务端监听端口</span>
	<span class="token keyword">struct</span> <span class="token class-name">addrinfo</span><span class="token operator">*</span> m_servAddrInfo <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span><span class="token comment">//服务端地址结构链表</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


</code></pre> 
<h4><a id="CTcpClientcpp_302"></a>CTcpClient.cpp</h4> 
<pre><code class="prism language-cpp"><span class="token comment">//CTcpClient.cpp</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sstream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Ws2tcpip.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;mstcpip.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"CTcpClient.h"</span></span>

<span class="token class-name">CTcpClient</span><span class="token operator">::</span><span class="token function">CTcpClient</span><span class="token punctuation">(</span>std<span class="token operator">::</span>string strServerIp<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> uServerPort<span class="token punctuation">)</span> <span class="token operator">:</span>
	<span class="token function">m_strServerIp</span><span class="token punctuation">(</span>strServerIp<span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token function">m_uServerPort</span><span class="token punctuation">(</span>uServerPort<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span>

<span class="token class-name">CTcpClient</span><span class="token operator">::</span><span class="token operator">~</span><span class="token function">CTcpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>m_socket <span class="token operator">!=</span> INVALID_SOCKET<span class="token punctuation">)</span>
		<span class="token function">closesocket</span><span class="token punctuation">(</span>m_socket<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">WSACleanup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">freeaddrinfo</span><span class="token punctuation">(</span>m_servAddrInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">bool</span> <span class="token class-name">CTcpClient</span><span class="token operator">::</span><span class="token function">InitConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	WSADATA	wsaData<span class="token punctuation">;</span>

	<span class="token comment">//1. 初始化环境</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">WSAStartup</span><span class="token punctuation">(</span><span class="token function">MAKEWORD</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>wsaData<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Init Windows Socket Failed!\n"</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	addrinfo hints <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">//协议无关(IPV4 or IPV6)</span>

	hints<span class="token punctuation">.</span>ai_flags <span class="token operator">=</span> AI_NUMERICHOST<span class="token punctuation">;</span>
	hints<span class="token punctuation">.</span>ai_family <span class="token operator">=</span> AF_UNSPEC<span class="token punctuation">;</span>
	hints<span class="token punctuation">.</span>ai_socktype <span class="token operator">=</span> SOCK_STREAM<span class="token punctuation">;</span>
	hints<span class="token punctuation">.</span>ai_protocol <span class="token operator">=</span> IPPROTO_TCP<span class="token punctuation">;</span>

	std<span class="token operator">::</span>stringstream ssPort<span class="token punctuation">;</span>

	ssPort <span class="token operator">&lt;&lt;</span> m_uServerPort<span class="token punctuation">;</span>

	<span class="token comment">//获取服务端地址结构</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getaddrinfo</span><span class="token punctuation">(</span>m_strServerIp<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ssPort<span class="token punctuation">.</span><span class="token function">str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>hints<span class="token punctuation">,</span> <span class="token operator">&amp;</span>m_servAddrInfo<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Get server addrInfo failed!\n"</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>m_socket <span class="token operator">!=</span> INVALID_SOCKET<span class="token punctuation">)</span>
		<span class="token function">closesocket</span><span class="token punctuation">(</span>m_socket<span class="token punctuation">)</span><span class="token punctuation">;</span>

	m_socket <span class="token operator">=</span> INVALID_SOCKET<span class="token punctuation">;</span>

	<span class="token comment">//2. 创建一个新的套接字</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>m_socket <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>m_servAddrInfo<span class="token operator">-&gt;</span>ai_family<span class="token punctuation">,</span> m_servAddrInfo<span class="token operator">-&gt;</span>ai_socktype<span class="token punctuation">,</span> m_servAddrInfo<span class="token operator">-&gt;</span>ai_protocol<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> SOCKET_ERROR<span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

	<span class="token comment">//3. 建立连接</span>
	<span class="token keyword">int</span> iResult <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span>m_socket<span class="token punctuation">,</span> m_servAddrInfo<span class="token operator">-&gt;</span>ai_addr<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>m_servAddrInfo<span class="token operator">-&gt;</span>ai_addrlen<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>iResult <span class="token operator">==</span> SOCKET_ERROR<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		iResult <span class="token operator">=</span> <span class="token function">WSAGetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token keyword">if</span> <span class="token punctuation">(</span>iResult <span class="token operator">!=</span> WSAEWOULDBLOCK<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Connect server failed!\n"</span><span class="token punctuation">;</span>
			<span class="token function">closesocket</span><span class="token punctuation">(</span>m_socket<span class="token punctuation">)</span><span class="token punctuation">;</span>
			m_socket <span class="token operator">=</span> INVALID_SOCKET<span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Connect Server succeed!\n"</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">bool</span> <span class="token class-name">CTcpClient</span><span class="token operator">::</span><span class="token function">SendMsg</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> strMsg<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>m_socket<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>m_socket<span class="token punctuation">,</span> strMsg<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> strMsg<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">!=</span> INVALID_SOCKET<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"发送成功:"</span> <span class="token operator">&lt;&lt;</span> strMsg <span class="token operator">&lt;&lt;</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span>
	<span class="token punctuation">{<!-- --></span>
		std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"发送失败!\n"</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">bool</span> <span class="token class-name">CTcpClient</span><span class="token operator">::</span><span class="token function">RecvMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>m_socket<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

	<span class="token keyword">const</span> <span class="token keyword">int</span> iBufSize <span class="token operator">=</span> <span class="token number">1024</span><span class="token punctuation">;</span>
	<span class="token keyword">char</span> recvBuf<span class="token punctuation">[</span>iBufSize<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token keyword">auto</span> iRecvSize <span class="token operator">=</span> <span class="token function">recv</span><span class="token punctuation">(</span>m_socket<span class="token punctuation">,</span> recvBuf<span class="token punctuation">,</span> iBufSize<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//若不支持C++11及以上，auto改为int</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>iRecvSize <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"接收失败!\n"</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span>
	<span class="token punctuation">{<!-- --></span>
		std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"接收成功:"</span> <span class="token operator">&lt;&lt;</span> recvBuf <span class="token operator">&lt;&lt;</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"CTcpClient.h"</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">{<!-- --></span>
        CTcpClient <span class="token function">tcpClient</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token number">6005</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>tcpClient<span class="token punctuation">.</span><span class="token function">InitConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        std<span class="token operator">::</span>string strAskMsg<span class="token punctuation">{<!-- --></span> <span class="token string">"ask"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">!=</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>tcpClient<span class="token punctuation">.</span><span class="token function">SendMsg</span><span class="token punctuation">(</span>strAskMsg<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                tcpClient<span class="token punctuation">.</span><span class="token function">RecvMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="_450"></a>运行截图</h4> 
<p><img src="https://images2.imgbox.com/03/24/vK1g8A2C_o.jpg" alt="在这里插入图片描述"><br> <strong>有任何问题，欢迎留言</strong></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e2a681f48ce179e1f97916fd014de94c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">zookeeper之Curator使用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/face85dafdbd89c5e4bb970e52712dae/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">微信小程序配置顶部导航条标题颜色</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>