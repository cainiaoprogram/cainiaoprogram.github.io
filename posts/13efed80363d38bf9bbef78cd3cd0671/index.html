<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Qt事件：自定义事件 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Qt事件：自定义事件" />
<meta property="og:description" content="qt的自定义事件分成两个步骤：
1、注册一个自定义事件的类型值
2、继承QEvent，继承时指定注册的类型值
下面注册一个文本改变事件。
#include &lt;QEvent&gt; #include &lt;QString&gt; extern int TextChangeEvent; class textChangeEvent : public QEvent { public: textChangeEvent(); virtual ~textChangeEvent(); void setString(QString string) { this-&gt;newString = string; } QString getString()const { return this-&gt;newString; } private: QString newString; }; int TextChangeEvent = QEvent::registerEventType();//1、注册自定义事件类型 textChangeEvent::textChangeEvent():QEvent(Type(TextChangeEvent)) //2、指定事件类型 { } textChangeEvent::~textChangeEvent() { } 非常简单的代码，自定义文本改变事件里定义了一个QString用来保存改变之后的文本。
然后来使用这个事件：
界面添加一个编辑框和按钮，当按钮按下时生成一个自定义的文本改变事件：
void Widget::on_pushButton_clicked() { QString text = ui-&gt;lineEdit-&gt;text().trimmed(); textChangeEvent * event = new textChangeEvent; event-&gt;setString(text); qApp-&gt;postEvent(this, event); } 注意事件只能定义在堆上，也不用手动释放，系统会自动释放的。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/13efed80363d38bf9bbef78cd3cd0671/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-11-23T12:44:35+08:00" />
<meta property="article:modified_time" content="2020-11-23T12:44:35+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Qt事件：自定义事件</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>qt的自定义事件分成两个步骤：</p> 
<p>1、注册一个自定义事件的类型值</p> 
<p>2、继承QEvent，继承时指定注册的类型值</p> 
<p>下面注册一个文本改变事件。</p> 
<pre><code class="language-cpp">#include &lt;QEvent&gt;
#include &lt;QString&gt;

extern int TextChangeEvent;

class textChangeEvent : public QEvent
{
public:
    textChangeEvent();

    virtual ~textChangeEvent();

    void setString(QString string)
    {
        this-&gt;newString = string;
    }

    QString getString()const
    {
        return this-&gt;newString;
    }

private:
    QString newString;
};
</code></pre> 
<pre><code class="language-cpp">int TextChangeEvent = QEvent::registerEventType();//1、注册自定义事件类型

textChangeEvent::textChangeEvent():QEvent(Type(TextChangeEvent)) //2、指定事件类型
{
}

textChangeEvent::~textChangeEvent()
{

}
</code></pre> 
<p>非常简单的代码，自定义文本改变事件里定义了一个QString用来保存改变之后的文本。</p> 
<p>然后来使用这个事件：</p> 
<p><img alt="" height="210" src="https://images2.imgbox.com/6c/0d/w0UaCBHK_o.png" width="636"></p> 
<p>界面添加一个编辑框和按钮，当按钮按下时生成一个自定义的文本改变事件：</p> 
<pre><code class="language-cpp">void Widget::on_pushButton_clicked()
{
    QString text = ui-&gt;lineEdit-&gt;text().trimmed();
    textChangeEvent * event = new textChangeEvent;
    event-&gt;setString(text);
    qApp-&gt;postEvent(this, event);
}
</code></pre> 
<p>注意事件只能定义在堆上，也不用手动释放，系统会自动释放的。</p> 
<pre><code class="language-cpp">    qApp-&gt;postEvent(this, event);</code></pre> 
<p>这句的意思是由程序将事件添加到事件队列，此事件分配给this来处理。<a href="https://blog.csdn.net/kenfan1647/article/details/110000334">qApp的本质</a> ，qApp实际上就是main()里的QApplication a,程序开始的时候开启了一个事件循环a.exec()，这里是将此事件添加到QApplication a的事件循环队列中，并指派此事件最终由this来处理</p> 
<p>事件处理：</p> 
<p>事件处理有两种方式。</p> 
<p>1、在自定义事件处理函数customEvent中处理</p> 
<pre><code class="language-cpp">void Widget::customEvent(QEvent *event)
{
    int type = event-&gt;type();
    if (type == TextChangeEvent)
    {
        textChangeEvent * e = dynamic_cast&lt;textChangeEvent*&gt;(event);
        qDebug()&lt;&lt;"从自定义事件获取编辑框的文本："&lt;&lt;e-&gt;getString();
        event-&gt;accept();
    }
}
</code></pre> 
<p>customEvent是重载自QObject的专门处理自定义事件的函数，自定义事件都会被分配到这里处理</p> 
<p>效果：</p> 
<p style="text-align:center;"><img alt="" height="350" src="https://images2.imgbox.com/c1/c7/NImgFk3q_o.gif" width="871"></p> 
<p>2、在事件过滤器中处理</p> 
<p>将本对象添加到程序的事件过滤器</p> 
<pre><code class="language-cpp">    qApp-&gt;installEventFilter(this);
</code></pre> 
<pre><code class="language-cpp">bool Widget::eventFilter(QObject *watched, QEvent *event)
{
    if(event-&gt;type() == TextChangeEvent)
    {
        textChangeEvent * e = dynamic_cast&lt;textChangeEvent*&gt;(event);
        qDebug()&lt;&lt;"事件过滤器--从自定义事件获取编辑框的文本："&lt;&lt;e-&gt;getString();
        event-&gt;accept();
    }
}
</code></pre> 
<p>效果：</p> 
<p style="text-align:center;"><img alt="" height="350" src="https://images2.imgbox.com/e0/e1/6BypNwzi_o.gif" width="871"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/69fddaa4b0d4a5a50357a14c0507cbb9/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">[社招][杭州]阿里菜鸟 P6 可帮内推，期待你的加入～</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6ef7299c45cb9ef8ee489cd8748ecf40/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">[转载] Python中str跟int的转换</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>