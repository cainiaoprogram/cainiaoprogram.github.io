<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>vue elementui前端异步方法转同步记录 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="vue elementui前端异步方法转同步记录" />
<meta property="og:description" content="elementui的表单验证功能
表单验证方法如果传入回调函数时是异步的
// 子组件的方法 validateForm(){ this.$refs.jsonEditor.getRef(&#34;form&#34;).validate((valid, hints) =&gt; { return {valid: valid, hints: hints} }) } // 父组件调用,会发现校验结果,hints为undefine submitAll(){ this.$refs.resourceEditorRef.forEach((item, index) =&gt; { console.log(item.validateForm()) }) } 修改成同步的
// 子组件方法 validateForm(){ // this.$refs.jsonEditor.getRef(&#34;form&#34;).validate((valid, hints) =&gt; { // return {valid: valid, hints: hints} // }) // return new Promise((resolve, reject) =&gt; { // this.$refs.jsonEditor.getRef(&#34;form&#34;).validate((valid, hints) =&gt; { // resolve({valid, hints}) // }) // }) //或者根据官网文档说明可以不传入回调函数,直接validate return this.$refs.jsonEditor.getRef(&#34;form&#34;).validate }, // 父组件调用 submitAll(){ // this." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/9715ddade41f1b944e0e902b54297227/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-12-23T10:33:56+08:00" />
<meta property="article:modified_time" content="2020-12-23T10:33:56+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">vue elementui前端异步方法转同步记录</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>elementui的表单验证功能</p> 
<p><img alt="" height="136" src="https://images2.imgbox.com/4e/a7/sA7yc0AQ_o.png" width="981"></p> 
<p>表单验证方法如果传入回调函数时是异步的</p> 
<pre><code class="language-javascript">// 子组件的方法
validateForm(){
      this.$refs.jsonEditor.getRef("form").validate((valid, hints) =&gt; {
        return {valid: valid, hints: hints}
      })
}

// 父组件调用,会发现校验结果,hints为undefine
submitAll(){
      this.$refs.resourceEditorRef.forEach((item, index) =&gt; {
        console.log(item.validateForm())
      })
}</code></pre> 
<p>修改成同步的</p> 
<pre><code class="language-javascript">// 子组件方法
validateForm(){
      // this.$refs.jsonEditor.getRef("form").validate((valid, hints) =&gt; {
      //   return {valid: valid, hints: hints}
      // })
      // return new Promise((resolve, reject) =&gt; {
      //   this.$refs.jsonEditor.getRef("form").validate((valid, hints) =&gt; {
      //     resolve({valid, hints})
      //   })
      // })
      //或者根据官网文档说明可以不传入回调函数,直接validate
      return this.$refs.jsonEditor.getRef("form").validate
    },

// 父组件调用
submitAll(){
      // this.$refs.resourceEditorRef.forEach((item, index) =&gt; {
      //   console.log("校验结果", item.validateForm())
      // })
      this.$refs.resourceEditorRef.forEach(async (item, index) =&gt; {
        let {valid, hints} = await item.validateForm()
        console.info(valid, hints)
        console.log("校验结果", hints)
      })
}</code></pre> 
<p>但是其实上面 submitAll 的 forEach 是有问题, 需要改成传统的for遍历, 因为 forEach 的入参是一个回调函数 , 简单的说就是执行 forEach 后会马上执行forEach后面的代码</p> 
<p><img alt="" height="148" src="https://images2.imgbox.com/9a/2d/O5SRCi3M_o.png" width="422"></p> 
<p>所以修改成普通的for , 使用普通 for 循环的时候有需要多包一层</p> 
<pre><code class="language-javascript">// 子组件方法
validateForm(){
      //或者根据官网文档说明可以不传入回调函数,直接validate
      return this.$refs.jsonEditor.getRef("form").validate
    }

//父组件调用
submitAll(){
      (async () =&gt; {
        let submitAllForm = {};
        for (let index = 0; index &lt; this.$refs.resourceEditorRef.length; index++) {
          const item = this.$refs.resourceEditorRef[index]
          await item.validateForm().then(res =&gt; {
            console.log("表单校验",res)
          }).catch(res =&gt; {
            console.log("表单校验catch",res)
            if(res == false){
              this.$message({ type: "error", message: "表单校验失败" });
              // 有一个校验失败则直接返回
              return;
            }
          })
        }
        //后续操作
        
      })()
}</code></pre> 
<p>或者</p> 
<pre><code class="language-javascript">// 子组件方法
validateForm(){
      return new Promise((resolve, reject) =&gt; {
        this.$refs.jsonEditor.getRef("form").validate((valid, hints) =&gt; {
          resolve({valid, hints})
        })
      })
}

// 父调用
submitAll(){
      (async () =&gt; {
        let submitAllForm = {};
        for (let index = 0; index &lt; this.$refs.resourceEditorRef.length; index++) {
          const item = this.$refs.resourceEditorRef[index]
          let {valid, hints} = await item.validateForm();
          console.log("表单校验valid",valid)
          console.log("表单校验hints",hints)
          debugger
        }
        //后续操作
        debugger
      })()
}</code></pre> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1094966911dfce5cbe5eddb50b9b7070/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">devtool使用介绍(1)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5fdd4cdcf1ebd2970c1a2cdc18f66a53/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">python 中任务 6.3 构建并评分分类模型(SVM模型)   学习笔记3</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>