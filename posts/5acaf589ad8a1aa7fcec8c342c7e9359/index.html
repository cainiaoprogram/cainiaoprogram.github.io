<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>uniapp推送PUSH1.0的 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="uniapp推送PUSH1.0的" />
<meta property="og:description" content="&lt;template&gt; &lt;view&gt; &lt;view class=&#34;header p-4&#34;&gt; &lt;view class=&#34;status_bar&#34;&gt;&lt;/view&gt; &lt;view class=&#34;d-flex &#34;&gt; &lt;view class=&#34;mr-5 pt-1&#34;&gt; &lt;u-avatar :src=&#34;userInfo.avatar&#34; size=&#39;60&#39;&gt;&lt;/u-avatar&gt; &lt;/view&gt; &lt;view&gt; &lt;view class=&#34;text-white font-20 font-weight&#34;&gt;试验综合管理系统&lt;/view&gt; &lt;view class=&#34;my-1 text-white font-14&#34;&gt;部门: {{userInfo.organizationName}}&lt;/view&gt; &lt;view class=&#34;font-14 text-white&#34;&gt;职务: {{userInfo.dutyName ==&#39;&#39;?&#39;未分配&#39;:userInfo.dutyName}}&lt;/view&gt; &lt;view class=&#34;font-14 text-white mt-1&#34;&gt;位置: {{city}}&lt;/view&gt; &lt;/view&gt; &lt;/view&gt; &lt;/view&gt; &lt;view class=&#34;px-2 pt-2&#34;&gt; &lt;view class=&#34;bg-white p-2 wrapbox d-flex a-center j-sb font-14&#34;&gt; &lt;view class=&#34;d-flex flex-column a-center&#34;&gt; &lt;view class=&#34;font-weight&#34;&gt;{{weekday[new Date().getDay()]}}&lt;/view&gt; &lt;view class=&#34;font-weight&#34;&gt;{{$u.timeFormat(new Date().getTime(), &#39;yyyy-mm-dd&#39;)}}&lt;/view&gt; &lt;/view&gt; &lt;view&gt;天气 : {{weather}}&lt;/view&gt; &lt;view&gt;温度 : {{temperature}}℃&lt;/view&gt; &lt;view&gt;湿度 : {{humidity}}%&lt;/view&gt; &lt;/view&gt; &lt;/view&gt; &lt;view class=&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/5acaf589ad8a1aa7fcec8c342c7e9359/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-14T10:20:46+08:00" />
<meta property="article:modified_time" content="2023-11-14T10:20:46+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">uniapp推送PUSH1.0的</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <pre><code class="language-javascript">&lt;template&gt;
	&lt;view&gt;
		&lt;view class="header p-4"&gt;
			&lt;view class="status_bar"&gt;&lt;/view&gt;
			&lt;view class="d-flex "&gt;
				&lt;view class="mr-5 pt-1"&gt;
					&lt;u-avatar :src="userInfo.avatar" size='60'&gt;&lt;/u-avatar&gt;
				&lt;/view&gt;
				&lt;view&gt;
					&lt;view class="text-white font-20 font-weight"&gt;试验综合管理系统&lt;/view&gt;
					&lt;view class="my-1 text-white font-14"&gt;部门: {<!-- -->{userInfo.organizationName}}&lt;/view&gt;
					&lt;view class="font-14 text-white"&gt;职务: {<!-- -->{userInfo.dutyName ==''?'未分配':userInfo.dutyName}}&lt;/view&gt;
					&lt;view class="font-14 text-white mt-1"&gt;位置: {<!-- -->{city}}&lt;/view&gt;
				&lt;/view&gt;
			&lt;/view&gt;
		&lt;/view&gt;
		&lt;view class="px-2 pt-2"&gt;
			&lt;view class="bg-white p-2 wrapbox d-flex a-center j-sb font-14"&gt;
				&lt;view class="d-flex flex-column a-center"&gt;
					&lt;view class="font-weight"&gt;{<!-- -->{weekday[new Date().getDay()]}}&lt;/view&gt;
					&lt;view class="font-weight"&gt;{<!-- -->{$u.timeFormat(new Date().getTime(), 'yyyy-mm-dd')}}&lt;/view&gt;
				&lt;/view&gt;

				&lt;view&gt;天气 : {<!-- -->{weather}}&lt;/view&gt;
				&lt;view&gt;温度 : {<!-- -->{temperature}}℃&lt;/view&gt;
				&lt;view&gt;湿度 : {<!-- -->{humidity}}%&lt;/view&gt;
			&lt;/view&gt;
		&lt;/view&gt;
		&lt;view class="p-2 d-flex flex-wrap a-center j-sb"&gt;
			&lt;view class="wrap wrapOne mb-2 d-flex a-center j-center flex-column" @tap="navAction(0)"&gt;
				&lt;u-badge class="badge" shape="horn" :type="type" max="99" :value="countNum"&gt;&lt;/u-badge&gt;
				&lt;!-- &lt;u-icon name="file-text-fill" color="#2979ff" size="36"&gt;&lt;/u-icon&gt; --&gt;
				&lt;image style="width: 65rpx;height: 65rpx; margin-bottom: 5rpx;" src="../../static/images/11.png" mode=""&gt;&lt;/image&gt;
				&lt;view class="font-14"&gt;待处理&lt;/view&gt;
			&lt;/view&gt;
			&lt;view class="wrap mb-2 d-flex a-center j-center flex-column" @tap="navAction(1)"&gt;
				&lt;!-- &lt;u-icon name="order" color="#f97aaf" size="36"&gt;&lt;/u-icon&gt; --&gt;
				&lt;image style="width: 65rpx;height: 65rpx; margin-bottom: 5rpx;" src="../../static/images/22.png" mode=""&gt;&lt;/image&gt;
				&lt;view class="font-14"&gt;已处理&lt;/view&gt;
			&lt;/view&gt;
			&lt;view class="wrap mb-2 d-flex a-center j-center flex-column" @tap="navAction(2)"&gt;
				&lt;!-- &lt;u-icon name="edit-pen-fill" color="#19be6b" size="36"&gt;&lt;/u-icon&gt; --&gt;
				&lt;image style="width: 65rpx;height: 65rpx; margin-bottom: 5rpx;" src="../../static/images/33.png" mode=""&gt;&lt;/image&gt;
				&lt;view class="font-14"&gt;抄送我的&lt;/view&gt;
			&lt;/view&gt;
			&lt;view class="wrap mb-2 d-flex a-center j-center flex-column" @tap="navAction(3)"&gt;
				&lt;!-- &lt;u-icon name="plus-people-fill" color="#aec" size="36"&gt;&lt;/u-icon&gt; --&gt;
				&lt;image style="width: 65rpx;height: 65rpx; margin-bottom: 5rpx;" src="../../static/images/44.png" mode=""&gt;&lt;/image&gt;
				&lt;view class="font-14"&gt;我创建的&lt;/view&gt;
			&lt;/view&gt;
			&lt;view class="wrap mb-2 d-flex a-center j-center flex-column" @tap="navAction(4)"&gt;
				&lt;!-- &lt;u-icon name="play-circle-fill" color="#cad" size="36"&gt;&lt;/u-icon&gt; --&gt;
				&lt;image style="width: 65rpx;height: 65rpx; margin-bottom: 5rpx;" src="../../static/images/55.png" mode=""&gt;&lt;/image&gt;
				&lt;view class="font-14"&gt;实时查看&lt;/view&gt;
			&lt;/view&gt;
			&lt;view class="wrap mb-2 d-flex a-center j-center flex-column" @tap="navAction(5)"&gt;
				&lt;!-- &lt;u-icon name="list-dot" color="#ff9900" size="36"&gt;&lt;/u-icon&gt; --&gt;
				&lt;image style="width: 65rpx;height: 65rpx; margin-bottom: 5rpx;" src="../../static/images/66.png" mode=""&gt;&lt;/image&gt;
				&lt;view class="font-14"&gt;查询统计&lt;/view&gt;
			&lt;/view&gt;
			&lt;!-- &lt;view class="wrap mb-2 d-flex a-center j-center flex-column" @tap="navAction(6)"&gt;
				&lt;u-icon name="calendar-fill" color="#a0cfff" size="36"&gt;&lt;/u-icon&gt;
				&lt;image style="width: 65rpx;height: 65rpx; margin-bottom: 5rpx;" src="../../static/images/77.png" mode=""&gt;&lt;/image&gt;
				&lt;view class="font-14"&gt;设备使用记录&lt;/view&gt;
			&lt;/view&gt; --&gt;
		&lt;!-- 	&lt;view class="wrap mb-2 d-flex a-center j-center flex-column" @tap="navAction(7)"&gt;
				&lt;u-icon name="file-text-fill" color="#18b566" size="36"&gt;&lt;/u-icon&gt;
				&lt;image style="width: 65rpx;height: 65rpx; margin-bottom: 5rpx;" src="../../static/images/88.png" mode=""&gt;&lt;/image&gt;
				&lt;view class="font-14"&gt;药品使用记录&lt;/view&gt;
			&lt;/view&gt; --&gt;
		&lt;/view&gt;
	&lt;/view&gt;
&lt;/template&gt;

&lt;script&gt;
	import {
		mapState,
		mapMutations
	} from 'vuex'
	export default {
		computed: mapState(['userInfo']),
		data() {
			return {
				type: "error",
				countNum: 0,
				tableData: {
					page: 1,
					limit: 10,
					total: 0,
					keyword: ''
				},
				city: '',
				weather: '',
				temperature: '',
				humidity: '',
				weekday: ["星期天", "星期一", "星期二", "星期三", "星期四", "星期五", "星期六"],
				clientId: '', // 个推 CID
			}
		},
		onLoad() {
			
			this.initUser()
			this.getAssignment()
			console.log(this.userInfo);
			var that = this
			uni.getLocation({
				type: 'wgs84 ',
				altitude: true,
				geocode: true,
				success: function(res) {
					console.log('当前位置的经度：' + res.longitude);
					console.log('当前位置的纬度：' + res.latitude);
					console.log(res)
					uni.request({
						url: `https://restapi.amap.com/v3/geocode/regeo?output=JSON&amp;location=${res.longitude},${res.latitude}&amp;key=506f1c5c025383c7279b50a25906cf53`,
						success: function(res) {
							console.log('得到的信息是', res);
							that.city = res.data.regeocode.addressComponent.city
							let adcode = res.data.regeocode.addressComponent.adcode
							uni.request({
								url: `https://restapi.amap.com/v3/weather/weatherInfo?city=${adcode}&amp;key=506f1c5c025383c7279b50a25906cf53`,
								success: function(res) {
									console.log('得到的信息是', res);
									that.weather = res.data.lives[0].weather
									that.temperature = res.data.lives[0].temperature,
										that.humidity = res.data.lives[0].humidity
								}
							})

						}
					})
				}
			});
			//#ifdef APP-PLUS
			this.getPushClientID();
			uni.getProvider({
				service: 'push',
				success: function(res) {
					console.log(res.provider)
					console.log('----------' + JSON.stringify(res));
				}
			});
			uni.subscribePush({
				success: function(res) {
					console.log('--22222--------' + JSON.stringify(res));
				}
			});
			//#endif
		},
		onShow() {
			this.noReadData()
		},
		methods: {
			...mapMutations(['initUser']),
			navAction(type) {
				switch (type) {
					case 0:
						uni.navigateTo({
							url: '../assignment/assignment'
						});
						break;
					case 1:
						uni.navigateTo({
							url: '../assignment/accept/accept'
						});
						break;
					case 2:
						uni.navigateTo({
							url: '../assignment/ccInstance/ccInstance'
						});
						break;
					case 3:
						uni.navigateTo({
							url: '../assignment/myCreate/myCreate'
						});
						break;
					case 4:
						uni.showToast({
							icon: 'none',
							title: '敬请期待'
						})
						break;
					case 5:
						uni.showToast({
							icon: 'none',
							title: '敬请期待'
						})
						break;
					// case 6:
					// 	uni.navigateTo({
					// 		url:'/pages/equipmentUsage/equipmentUsage'
					// 	})
					// 	break;
					// case 7:
					// 	uni.navigateTo({
					// 		url:'/pages/drugRecords/drugRecords'
					// 	})
					// 	break;
					default:
				}
			},
			noReadData() {
				this.$http.get('/system/sys-notify/page', {
					isRead: 0
				}).then(res =&gt; {
					if (res.data.count &gt; 0) {
						let count = res.data.count + ''
						uni.setTabBarBadge({ //显示数字
							index: 1, //tabbar下标
							text: count
						})
					} else {
						uni.hideTabBarRedDot({
							index: 1
						})
					}
				})
			},
			getAssignment() {
				this.$http.get('/flow/flow-instance/page', {}).then(res =&gt; {
					console.log(res.data);
					console.log(res.data.list);
					this.countNum = res.data.count
				})
			},
			getPushClientID() {
				//setTimeout(function(){
				var clientObj = plus.push.getClientInfo();
				console.log(JSON.stringify(clientObj));
				console.log("打印clientid：", clientObj.clientid);
				this.clientId = clientObj.clientid;
				var params = {};
				params.userId = this.userInfo.userId;
				params.clientId = clientObj.clientid;
				params.clientObj = JSON.stringify(clientObj)
				console.log(JSON.stringify(params));
				// var params={};
				// params.userId = this.userInfo.userId;
				// params.clientId = '68d3fcf461858efd01731c65f9f24623';
				// params.clientObj = JSON.stringify('{\"id\":\"unipush\",\"token\":\"68d3fcf461858efd01731c65f9f24623\",\"clientid\":\"68d3fcf461858efd01731c65f9f24623\",\"appid\":\"pPyZWvH3Fa6PXba10aJ009\",\"appkey\":\"b7dOGlNPHR7pqwUxDhpTi4\"}')
				// console.log(JSON.stringify(params));

				this.$http.post('/updateClient', params, {
					isToken: 2
				}).then(res =&gt; {
					console.log(res);
				})
				//},2000);
			}
		}
	}
&lt;/script&gt;

&lt;style lang="scss" scoped&gt;
	.status_bar {
		height: var(--status-bar-height);
		width: 100%;
	}

	.header {
		padding-bottom: 40rpx;
		background-color: #02A7F0;
	}

	.wrap {
		width: 49%;
		height: 180rpx;
		// border: 1px solid #000;
		border-radius: 16rpx;
		background-color: #fff;
		box-shadow: 0 5rpx 10rpx rgba(0, 0, 0, .2);
	}

	.wrapbox {
		border-radius: 16rpx;
		background-color: #fff;
		box-shadow: 0 5rpx 10rpx rgba(0, 0, 0, .2);
	}

	.wrapOne {
		position: relative;
	}

	.badge {
		position: absolute;
		top: 24rpx;
		right: 110rpx;

	}
&lt;/style&gt;</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/18c871cf52951aeb799946d9eea30ca4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">uniapp打开第三方</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b9aa07cbbeeaed1883626febd5e97566/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">写二进制显示的文本</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>