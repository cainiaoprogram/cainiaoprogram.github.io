<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Spm12 入门教程 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Spm12 入门教程" />
<meta property="og:description" content="下载MATLAB，以及对应的 SPM 版本。
SPM12 使用一种标准 3D（有些情况下是 4D）图像格式，称为 NIfTI-1.1。每个 NIfTI 格式的图 像是一个扩展名为“.nii”的文件。
“.nii”文件包括：
- 一个包含图像中所有数据的位图；
- 一个将位图套入 3D 坐标体系的变换矩阵（称为仿射变换：如旋转，平移，缩放和/或 裁剪）。
一个时间序列（如 300）的扫描包含 300 个.nii 文件。
若用 SPM 处理这些图像，一般只会改 变 NIfTI 文件中含有仿射变换的矩阵。需要理解的重要一点是：实际数据，即位图，是不变的，除非在处理过程的任何阶段中选用“Reslice”（重新分层）项。图像重新分层（在头动校 正和写入标准化后）时，NIfTI 文件中的仿射变换矩阵会重置，计算出新的位图，生成的新文件重命名时在旧文件名字头加上一个字母（如：OLDFILE.nii 变成 rOLDFILE.nii），故旧文件不 会被覆盖。
注：SPM12 也可像早先版本（SPM5 之前）一样使用 Header（.hdr）和 Image（.img）文件。 在 SPM12 中生成时，这些文件也跟 NIfTI 文件兼容，并包含与“.nii”图像一致的信息。这些文 件与在早先版本 SPM 中使用的旧 img/hdr 文件不同。在 SPM2 或更早版本中生成的 Analysis 7.5 文件可能不能正确导入 SPM12 中，因此在一个项目中不要更换 SPM 版本。
【如何打开 SPM 界面】
Matlab 打开 SPM所在路径。
命令行加载：
&gt;&gt; addpath D:\software\医学图像浏览器\spm12" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/b1c8a4fdd262b067a2a73a24acf72504/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-11-29T10:57:32+08:00" />
<meta property="article:modified_time" content="2018-11-29T10:57:32+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Spm12 入门教程</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="margin-left:0cm;">下载MATLAB，以及对应的 SPM 版本。</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">SPM12 使用一种标准 3D（有些情况下是 4D）图像格式，称为 NIfTI-1.1。每个 NIfTI 格式的图 像是一个扩展名为“.nii”的文件。</p> 
<p style="margin-left:0cm;">“.nii”文件包括：</p> 
<p style="margin-left:0cm;"> - 一个包含图像中所有数据的位图；</p> 
<p style="margin-left:0cm;"> - 一个将位图套入 3D 坐标体系的变换矩阵（称为仿射变换：如旋转，平移，缩放和/或 裁剪）。</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">一个时间序列（如 300）的扫描包含 300 个.nii 文件。</p> 
<p style="margin-left:0cm;">若用 SPM 处理这些图像，一般只会改 变 NIfTI 文件中含有仿射变换的矩阵。需要理解的重要一点是：实际数据，即位图，是不变的，除非在处理过程的任何阶段中选用“<strong>Reslice</strong>”（重新分层）项。图像重新分层（在头动校 正和写入标准化后）时，<strong>NIfTI 文件中的仿射变换矩阵会重置，计算出新的位图</strong>，生成的新文件重命名时在旧文件名字头加上一个字母（如：OLDFILE.nii 变成 rOLDFILE.nii），故旧文件不 会被覆盖。</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">注：SPM12 也可像早先版本（SPM5 之前）一样使用 Header（.hdr）和 Image（.img）文件。 在 SPM12 中生成时，这些文件也跟 NIfTI 文件兼容，并包含与“.nii”图像一致的信息。这些文 件与在早先版本 SPM 中使用的旧 img/hdr 文件不同。在 SPM2 或更早版本中生成的 Analysis 7.5 文件可能不能正确导入 SPM12 中，<span style="color:#FF0000;">因此在一个项目中不要更换 SPM 版本。</span></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><strong><span style="color:#2e75b5;">【如何打开</span></strong><strong><span style="color:#2e75b5;"> SPM </span></strong><strong><span style="color:#2e75b5;">界面】</span></strong></p> 
<p style="margin-left:0cm;">Matlab 打开 SPM所在路径。</p> 
<p style="margin-left:0cm;">命令行加载：</p> 
<p style="margin-left:0cm;"><span style="color:#7030a0;">&gt;&gt; addpath D:\software\</span><span style="color:#7030a0;">医学图像浏览器\spm12</span></p> 
<p style="margin-left:0cm;"><span style="color:#7030a0;">&gt;&gt; spm</span></p> 
<p style="margin-left:0cm;">出现</p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="253" src="https://images2.imgbox.com/8d/c9/bOCkJx4k_o.png" width="409"></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">选择PET：</p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="944" src="https://images2.imgbox.com/c5/9a/s17PEXyq_o.png" width="1032"></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><strong><span style="color:#2e75b5;">【浏览、选中文件】</span></strong></p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="410" src="https://images2.imgbox.com/04/b4/gg3TtFVW_o.png" width="508"></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">SPM12 打开文件的对话框同上， 左侧显示当前路径下的文件夹名，单击选中某个文件夹，右侧显示该文件夹下的文件（只有没有子文件夹的文件夹才可以显示）。</p> 
<p style="margin-left:0cm;">Drive   - 选择盘符</p> 
<p style="margin-left:0cm;">“..”   - 表示上一级路径</p> 
<p style="margin-left:0cm;">“select all”   - 在右侧区域单击鼠标右键，弹出对话框，可以选中当前文件夹下的所有文件</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">选中的文件显示在最下面的显示框， 点击删除（本地文件并未被删除）。</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><strong><span style="color:#2e75b5;">【</span></strong><strong><span style="color:#2e75b5;">SPM12 </span></strong><strong><span style="color:#2e75b5;">主窗口】</span></strong></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="488" src="https://images2.imgbox.com/fb/33/jBClWBpy_o.png" width="416"></p> 
<p style="margin-left:0cm;"> </p> 
<ol><li>空间预处理</li><li>统计</li><li>可视化</li></ol> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><strong><span style="color:#2e75b5;">【可视化】</span></strong></p> 
<p style="margin-left:0cm;"> </p> 
<ul><li>Display</li><li>Check Reg (校验注册)</li></ul> 
<p style="margin-left:0cm;">用于：</p> 
<ul><li>查看图像</li><li>手动处理图像，为空间预处理设置起点</li><li>检查所有空间预处理步骤</li></ul> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><strong><span style="color:#2e75b5;">&lt;Display&gt;</span></strong><br><strong><span style="color:#2e75b5;">查看、处理单次扫描的图像。</span></strong></p> 
<p style="margin-left:0cm;">点击 “Display” 按钮， 选择合适的文件，点击 <span style="color:#FF0000;">“Done”</span>。右侧窗口显示：</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="931" src="https://images2.imgbox.com/d6/f6/y0LDsbQl_o.png" width="624"></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">在显示窗口最重要的按钮或选项有：</p> 
<p style="margin-left:0cm;"><strong><span style="color:#000000;">显示区域：</span></strong></p> 
<p style="margin-left:0cm;"><span style="color:#7030a0;">十字标记：</span>即图中蓝线标记出的位置，以 mm 或像素计。</p> 
<p style="margin-left:0cm;"><strong>操作区：</strong></p> 
<p style="margin-left:0cm;"><span style="color:#7030a0;">右移，前移和上移：</span>可向三个方向移动图像。这些方向只有在当前图像与 MNI标准空间坐标系方向一致时才有意义。</p> 
<p style="margin-left:0cm;"><span style="color:#7030a0;">俯仰、横滚、偏向：</span>分别沿 X，Y，Z 轴转动当前图像。</p> 
<p style="margin-left:0cm;"><span style="color:#7030a0;">图像重定向：</span>点击此处可保存当前处理对图像的修改并将相同修改应用到其他图像中。</p> 
<p style="margin-left:0cm;">在右侧窗口可见当前图像的一些有用信息：<span style="color:#7030a0;">像素尺寸，原点</span>等。</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">点击 ”origin“ 显示默认的原点</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><strong><span style="color:#2e75b5;">【重新设置原点】</span></strong></p> 
<p style="margin-left:0cm;">选择当前的位置作为原点。 当前的位置在 crosshair position 的 panel 中显示。</p> 
<p style="margin-left:0cm;">点击set origin, reorient image（在上图的最下面）-&gt;done-&gt;no</p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="945" src="https://images2.imgbox.com/b5/02/FFYdrlcP_o.png" width="619"></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><strong><span style="color:#2e75b5;">&lt;CheckReg&gt;</span></strong></p> 
<p style="margin-left:0cm;">用于检查 2 个或者更多烧苗的图像是否相互匹配。 该检查应在每一步空间预处理后进行。</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><strong><span style="color:#2e75b5;">导入文件</span></strong><strong><span style="color:#2e75b5;"> DICOM Import:</span></strong></p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="647" src="https://images2.imgbox.com/08/db/TNcgGo8Z_o.png" width="1112"></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">将DICOM 文件转换为合适的文件，保存</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><strong><span style="color:#2e75b5;">【空间预处理】</span></strong></p> 
<p style="margin-left:0cm;">空间预处理的<span style="color:#7030a0;">目的：</span></p> 
<p style="margin-left:0cm;"> 1. 匹配同一受试者的所用扫描图像。</p> 
<p style="margin-left:0cm;"> 2. 在标准空间坐标系中匹配所有受试者的扫描图像。</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">最重要的工具有：realign（头动校正）（和 unwarp 反卷积）， slice timing correction（层间时间校正），coregister（配准）， Normalize（标准化）和 smooth（平滑）。</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><strong><span style="color:#2e75b5;">realign</span></strong><strong><span style="color:#2e75b5;">（头动校正）</span></strong></p> 
<p style="margin-left:0cm;">采用<strong>刚性变换</strong>来处理扫描图像。即只允许<strong>平移</strong>（在 X， Y，Z 轴方向移动）和<strong>旋转</strong>（围绕 X，Y，Z）。</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">通过试错来找到<span style="color:#FF0000;">能使两个图像差异最小化的处理方式</span>。最小化成本函数是两个图像间的方差和。因此，<strong>只能用于相同模态的成像</strong>。</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">如采用相同脉冲序列的成像。常用于在<u>功能成像</u>时校正受试者的头动影响（顾名思义头动校正）。</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">头动校正结果会保存到“.nii”文件的（仿射）变换信息中。也可在新文件中对这些图像进行重新分层，生成的文件会包含修改过的位图（即嵌入）。</p> 
<p style="margin-left:0cm;"><br> 主窗口，在 Realign 项下，用下拉菜 单选择：</p> 
<p style="margin-left:0cm;"> <span style="color:#FF0000;">Estimate</span>（参数估计）：确定刚体变换的参数 并将这些修改嵌入“.nii”文件。</p> 
<p style="margin-left:0cm;"> <span style="color:#FF0000;">Reslice</span>：创建新位图文件（新文件名为旧文件 名前加 r）。</p> 
<p style="margin-left:0cm;"><span style="color:#FF0000;"> Estimate and reslice</span>（参数估计与重分层）：一 次执行上述两个处理。</p> 
<p style="margin-left:0cm;">然后会弹出 SPM12 的<strong>批处理管理器</strong>窗口。</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">每次变换之后进行重分层不是必需的，而且会降低图像质量。</p> 
<p style="margin-left:0cm;">但在开始统计分析前重分层是必要的。</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">-- 示例 选用 Estimate and Reslice, 弹出</p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="627" src="https://images2.imgbox.com/71/63/MmzxJPT6_o.png" width="833"></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">在 “SPM”菜单里面可以选择添加更多的模块。</p> 
<p style="margin-left:0cm;">在 “Data” 条目中显示 “&lt;-X”表示未完成。双击 添加文件。“Ed” 键 修改选中的文件。</p> 
<p style="margin-left:0cm;">可以使用 “ filename prefix” 自定义重分层之后的文件名前缀。</p> 
<p style="margin-left:0cm;"><strong> </strong></p> 
<p style="margin-left:0cm;"><strong> </strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#2e75b5;">coregister</span></strong><strong><span style="color:#2e75b5;">（配准）</span></strong></p> 
<p style="margin-left:0cm;">配准功能用于匹配不同模态扫描所得的图像。如，下图所示两个图像（T1 和 T2 加权）的</p> 
<p style="margin-left:0cm;">匹配。</p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="172" src="https://images2.imgbox.com/b9/cf/Feb26cXN_o.png" width="617"></p> 
<p style="margin-left:0cm;">如此例所示，方差和的最小化不管用，因为不同图像匹配时差异太大。因此采用了成本函数，</p> 
<p style="margin-left:0cm;">称为 Mutual Information（交互信息）。</p> 
<p style="margin-left:0cm;"><strong> </strong></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">在主窗口下拉菜单中的 coregistration 项下，选择：</p> 
<p style="margin-left:0cm;">Estimate：确定刚体变换的参数，并嵌入“.nii”文件而实际上不改变位图。</p> 
<p style="margin-left:0cm;">Reslice：将此变换应用到图像并创建新的位图文件。</p> 
<p style="margin-left:0cm;">Estimate &amp; reslice：一次执行上述两个处理。</p> 
<p style="margin-left:0cm;"><strong> </strong></p> 
<p style="margin-left:0cm;">在 Estimate 中，需定义：</p> 
<p style="margin-left:0cm;">- Reference image（参比图像）：其他图像配准时的对照。</p> 
<p style="margin-left:0cm;">- Source image（源图像）：应基于参比图像进行处理的图像。</p> 
<p style="margin-left:0cm;">- （可选的）Other image（其他图像）：执行与源图像相同处理的图像。</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> 注：其他图像应已注册或已与源图像进行头动校正。</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">SPM 允许修改 Estimate 和 Reslicing 功能的默认设置项。多数情况下，默认设置较好。如果</p> 
<p style="margin-left:0cm;">在此步选择 Reslicing，需考虑设“Interpolation”（嵌入值）项为 4th degree B-Spline（第 4 度 B样条），处理会较慢，但效果比三线性嵌入值更好。在头动校正后未进行重分层处理时尤其推荐。</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">选择 Estimate, 选择了两个合适的文件，点击开始的按钮。</p> 
<p style="margin-left:0cm;"><strong> </strong></p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="898" src="https://images2.imgbox.com/5c/09/KjqKQJOz_o.png" width="1200"></p> 
<p style="margin-left:0cm;"><strong> </strong></p> 
<p style="margin-left:0cm;">Current Item : 显示当前选项的设置</p> 
<p style="margin-left:0cm;"><strong> </strong></p> 
<p style="margin-left:0cm;"><strong> </strong></p> 
<p style="margin-left:0cm;">我使用的示例是一个 PET和一个MRI 图像</p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="474" src="https://images2.imgbox.com/b2/12/6vsls8Zm_o.png" width="538"></p> 
<p style="margin-left:0cm;"><strong> </strong></p> 
<p style="margin-left:0cm;"><strong> </strong></p> 
<p style="margin-left:0cm;">PS： 如果有什么错误会在 matlab 中显示。</p> 
<p style="margin-left:0cm;"><strong> </strong></p> 
<p style="margin-left:0cm;"><strong> </strong></p> 
<p style="margin-left:0cm;"><strong> </strong></p> 
<p style="margin-left:0cm;"><strong> </strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#2e75b5;">Normalize</span></strong><strong><span style="color:#2e75b5;">（标准化）</span></strong></p> 
<p style="margin-left:0cm;"><strong>&lt;&lt;</strong><strong>未完待续</strong><strong>&gt;&gt;</strong></p> 
<p style="margin-left:0cm;"><strong> </strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#2e75b5;">smooth</span></strong><strong><span style="color:#2e75b5;">（平滑）</span></strong></p> 
<p style="margin-left:0cm;"><strong>&lt;&lt;</strong><strong>未完待续</strong><strong>&gt;&gt;</strong></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/dac90d5fdb3d4e8b69d158c25d89fc45/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">用数学归纳法证明二叉树的先序遍历序列和中序遍历序列可以唯一确定一颗二叉树</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ceba7696e4a4117dbba04f411e4d96ee/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">尚学堂第六章作业：异常机制</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>