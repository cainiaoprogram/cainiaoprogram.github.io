<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>GEE批量下载Sentinel2数据 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="GEE批量下载Sentinel2数据" />
<meta property="og:description" content="GEE批量下载数据 Google Earth Engine https://earthengine.google.com网站批量下载数据，需要有谷歌账号和科学上网
界面功能 导入研究区边界 1.学会导入roi的矢量文件，在【Assets】下选择【New】，导入shp文件
2.在弹出的界面可以选择自己的文件进行上传，除了在gee上的新建的数据集文件名需要修改之外，其他保持默认即可，最后点击【Upload】上传
3.创建好之后就可以去copy别人的代码进行批量下载了，有两个数据可以需要自己手动导入，网上的教程有时没讲这部分，通过【Import】导入roi文件和数据集。其中，roi就是刚刚的矢量文件，在旁边的目录中有，点击之后在弹出的界面找到【Import】就可以导入了；数据集在上面的搜索栏中可以找到，比如下载Sentinel-2 L2A数据，就可以直接搜索“Sentinel”，点击搜索，之后找到对应的数据集，点击之后找到【Import】就可以导入
4.在导入这两个之后，就会再代码部分最上面出现如下三行（这三行不算代码，代码行数的计数从这三行之后开始），点击可以将”table”和“imageCollection”直接改名，因此在网上的一些代码中出现了未定义变量的报错，可能就是这两个错误；也可以通过在之后通过定义新变量来指代这两个，如下所示，这样名称就不用改了
var roi = table; var s2_collection = imageCollection; 数据下载 以哨兵数据批量下载为例（无云掩膜）
var roi = table; function filterImageCollection(collection) { // 日期 var startDate = &#39;2021-01-01&#39;; var endDate = &#39;2021-06-30&#39;; var filteredCollection = collection.filterDate(startDate, endDate); filteredCollection = filteredCollection.filterBounds(roi); // 云量 filteredCollection = filteredCollection.filter(ee.Filter.rangeContains(&#34;CLOUDY_PIXEL_PERCENTAGE&#34;, 0, 30)); return filteredCollection; } var s2_collection = ee.ImageCollection(&#39;COPERNICUS/S2_SR&#39;); var filteredCollection = filterImageCollection(s2_collection); // 获取影像列表 var imageList = filteredCollection." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/d5a72ce4094085d0a72e1548e3464943/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-03T00:08:47+08:00" />
<meta property="article:modified_time" content="2023-11-03T00:08:47+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">GEE批量下载Sentinel2数据</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="GEE_2"></a>GEE批量下载数据</h2> 
<p>Google Earth Engine https://earthengine.google.com网站批量下载数据，需要有谷歌账号和科学上网</p> 
<h3><a id="_6"></a>界面功能</h3> 
<p><img src="https://images2.imgbox.com/e6/b1/mvB8rfAC_o.png" alt="image-20230712015903828"></p> 
<h3><a id="_12"></a>导入研究区边界</h3> 
<p>1.学会导入roi的矢量文件，在【Assets】下选择【New】，导入shp文件</p> 
<p><img src="https://images2.imgbox.com/53/82/IojqwGmu_o.png" alt="image-20230712012523506"></p> 
<p><img src="https://images2.imgbox.com/c7/da/pKDPEUEs_o.png" alt="image-20230712012700256"></p> 
<p>2.在弹出的界面可以选择自己的文件进行上传，除了在gee上的新建的数据集文件名需要修改之外，其他保持默认即可，最后点击【Upload】上传</p> 
<p><img src="https://images2.imgbox.com/65/f8/HDRqpeAV_o.png" alt="image-20230712013340325"></p> 
<p>3.创建好之后就可以去copy别人的代码进行批量下载了，有两个数据可以需要自己手动导入，网上的教程有时没讲这部分，通过【Import】导入roi文件和数据集。其中，roi就是刚刚的矢量文件，在旁边的目录中有，点击之后在弹出的界面找到【Import】就可以导入了；数据集在上面的搜索栏中可以找到，比如下载Sentinel-2 L2A数据，就可以直接搜索“Sentinel”，点击搜索，之后找到对应的数据集，点击之后找到【Import】就可以导入</p> 
<p><img src="https://images2.imgbox.com/28/1e/7rmfSE5i_o.png" alt="image-20230712013745575"></p> 
<p><img src="https://images2.imgbox.com/06/f1/Y74bl4p4_o.png" alt="image-20230712014247262"></p> 
<p>4.在导入这两个之后，就会再代码部分最上面出现如下三行（这三行不算代码，代码行数的计数从这三行之后开始），点击可以将”table”和“imageCollection”直接改名，因此在网上的一些代码中出现了未定义变量的报错，可能就是这两个错误；也可以通过在之后通过定义新变量来指代这两个，如下所示，这样名称就不用改了</p> 
<p><img src="https://images2.imgbox.com/d6/e2/OFLCfNzV_o.png" alt="image-20230712014432273"></p> 
<pre><code class="prism language-js"><span class="token keyword">var</span> roi <span class="token operator">=</span> table<span class="token punctuation">;</span>
<span class="token keyword">var</span> s2_collection <span class="token operator">=</span> imageCollection<span class="token punctuation">;</span>
</code></pre> 
<h3><a id="_39"></a>数据下载</h3> 
<p>以哨兵数据批量下载为例（无云掩膜）</p> 
<pre><code class="prism language-js"><span class="token keyword">var</span> roi <span class="token operator">=</span> table<span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">filterImageCollection</span><span class="token punctuation">(</span><span class="token parameter">collection</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 日期 </span>
  <span class="token keyword">var</span> startDate <span class="token operator">=</span> <span class="token string">'2021-01-01'</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> endDate <span class="token operator">=</span> <span class="token string">'2021-06-30'</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> filteredCollection <span class="token operator">=</span> collection<span class="token punctuation">.</span><span class="token function">filterDate</span><span class="token punctuation">(</span>startDate<span class="token punctuation">,</span> endDate<span class="token punctuation">)</span><span class="token punctuation">;</span>
  filteredCollection <span class="token operator">=</span> filteredCollection<span class="token punctuation">.</span><span class="token function">filterBounds</span><span class="token punctuation">(</span>roi<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 云量</span>
  filteredCollection <span class="token operator">=</span> filteredCollection<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>ee<span class="token punctuation">.</span>Filter<span class="token punctuation">.</span><span class="token function">rangeContains</span><span class="token punctuation">(</span><span class="token string">"CLOUDY_PIXEL_PERCENTAGE"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> filteredCollection<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
  <span class="token keyword">var</span> s2_collection <span class="token operator">=</span> ee<span class="token punctuation">.</span><span class="token function">ImageCollection</span><span class="token punctuation">(</span><span class="token string">'COPERNICUS/S2_SR'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> filteredCollection <span class="token operator">=</span> <span class="token function">filterImageCollection</span><span class="token punctuation">(</span>s2_collection<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 获取影像列表</span>
  <span class="token keyword">var</span> imageList <span class="token operator">=</span> filteredCollection<span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span>filteredCollection<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 获取影像数量</span>
  <span class="token keyword">var</span> count <span class="token operator">=</span> imageList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 使用 for 循环进行迭代</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 通过索引获取影像</span>
  <span class="token keyword">var</span> image <span class="token operator">=</span> ee<span class="token punctuation">.</span><span class="token function">Image</span><span class="token punctuation">(</span>imageList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 获取原始影像的文件名</span>
  <span class="token keyword">var</span> originalFilename <span class="token operator">=</span> ee<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span>image<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'system:index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 对影像进行研究区域裁剪和去云处理</span>
  <span class="token keyword">var</span> maskedImage <span class="token operator">=</span> image<span class="token punctuation">.</span><span class="token function">clip</span><span class="token punctuation">(</span>roi<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 选择需要的波段</span>
  <span class="token keyword">var</span> composite <span class="token operator">=</span> maskedImage<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'B2'</span><span class="token punctuation">,</span> <span class="token string">'B3'</span><span class="token punctuation">,</span> <span class="token string">'B4'</span><span class="token punctuation">,</span> <span class="token string">'B8'</span><span class="token punctuation">,</span> <span class="token string">'B11'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 导出波段合成影像</span>
  Export<span class="token punctuation">.</span>image<span class="token punctuation">.</span><span class="token function">toDrive</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">image</span><span class="token operator">:</span> composite<span class="token punctuation">,</span>
    <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">'S2L2A_'</span> <span class="token operator">+</span> originalFilename<span class="token punctuation">,</span>
    <span class="token literal-property property">folder</span><span class="token operator">:</span> <span class="token string">'S2L2A'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">region</span><span class="token operator">:</span> roi<span class="token punctuation">,</span>
    <span class="token literal-property property">scale</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
    <span class="token literal-property property">crs</span><span class="token operator">:</span> <span class="token string">"EPSG:4326"</span><span class="token punctuation">,</span>
    <span class="token literal-property property">maxPixels</span><span class="token operator">:</span> <span class="token number">1e13</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'OK'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="_86"></a>常见问题</h3> 
<p>1.如果代码点击【Run】之后，，没有报错，但是无响应，就是代码导出的数据太多了，因此在测试代码的时候一定要选择少一点的数据</p> 
<p>2.测试代码时，可以加上一些print语句，看看是哪一步的问题</p> 
<p>3.修改代码一定要及时保存</p> 
<p>4.如果代码中波段合成了，但是导出数据仍然有多个类似的，可能是roi涉及到了多个区域，有些可能看似在一个区域，但是会触碰到别的影像的边界（因为有重叠），所有根据需求选择镶嵌或者是只下载需要的部分。</p> 
<p>5.在【Task】中可以看到任务的源码</p> 
<p>6.一次性不要【Run】太多数据，因为谷歌云盘只有15G</p> 
<p>7.有时手速快，一次性【Run】太多数据，可能会在云盘里面给你创建多个同名文件夹</p> 
<p>8.在谷歌云盘中的数据可以多选之后，直接打包成一个压缩包批量下载（如果一次选的数据量太多，系统会自动给你分成多个压缩包）</p> 
<p>9.谷歌云盘的数据在删除掉（放到回收站，只保留30天）后仍然会占用空间，因此需要在回收站中进行【永久删除】</p> 
<p>10…同名文件和同名文件夹在云盘中都一样，没有自动加上后缀区别，只能根据修改时间和其中的数据等信息来区分</p> 
<p>11.下载好的数据有时在ENVI打开是全黑的，在ENVI右下角有一个构建金字塔的进度条，等他加载完再做定夺</p> 
<p>12.一般情况下数据导出后只有1M左右的话，那么大概率是代码存在问题</p> 
<p>时间和其中的数据等信息来区分</p> 
<p>11.下载好的数据有时在ENVI打开是全黑的，在ENVI右下角有一个构建金字塔的进度条，等他加载完再做定夺</p> 
<p>12.一般情况下数据导出后只有1M左右的话，那么大概率是代码存在问题</p> 
<p>13.下载的数据存在少部分不全的情况</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e22783929b74b40254e33a5d3ab43115/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">安装vscode以及vue必备插件</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/631a3c1610c0209dcd069c9710f34301/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">读懂Java中的各种锁，看这一篇就足够了</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>