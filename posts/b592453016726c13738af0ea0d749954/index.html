<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>压测clickhouse性能相关参数 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="压测clickhouse性能相关参数" />
<meta property="og:description" content="背景：压测ck性能一直上不去，但是ck负载不大。尝试调整参数，验证是否有性能提升
1、background_common_pool_size
Sets the number of threads performing background non-specialized operations like cleaning the filesystem etc. for tables with MergeTree engines. Could be increased at runtime and could be applied at server startup from the default profile for backward compatibility.
2 、 max_threads 验证有效
The maximum number of threads to execute the request. By default, it is determined automatically.
3、background_pool_size
Sets the number of threads performing background merges and mutations for tables with MergeTree engines." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/b592453016726c13738af0ea0d749954/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-09T14:59:48+08:00" />
<meta property="article:modified_time" content="2024-01-09T14:59:48+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">压测clickhouse性能相关参数</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>背景：压测ck性能一直上不去，但是ck负载不大。尝试调整参数，验证是否有性能提升</p> 
<p>1、background_common_pool_size</p> 
<p>Sets the number of threads performing background non-specialized operations like cleaning the filesystem etc. for tables with MergeTree engines. Could be increased at runtime and could be applied at server startup from the default profile for backward compatibility.</p> 
<p>2 、 max_threads 验证有效</p> 
<p>The maximum number of threads to execute the request. By default, it is determined automatically.</p> 
<p>3、background_pool_size<br> Sets the number of threads performing background merges and mutations for tables with MergeTree engines. You can only increase the number of threads at runtime. To lower the number of threads you have to restart the server. By adjusting this setting, you manage CPU and disk load. Smaller pool size utilizes less CPU and disk resources, but background processes advance slower which might eventually impact query performance.</p> 
<p>Before changing it, please also take a look at related MergeTree settings, such as number_of_free_entries_in_pool_to_lower_max_size_of_merge and number_of_free_entries_in_pool_to_execute_mutation.</p> 
<p>查看参数；</p> 
<pre><code class="prism language-bash"><span class="token keyword">select</span> * from system.settings where name  like <span class="token string">'%background_common_pool_size%'</span>
</code></pre> 
<pre><code class="prism language-bash">
SHOW <span class="token punctuation">[</span>CHANGED<span class="token punctuation">]</span> SETTINGS LIKE<span class="token operator">|</span>ILIKE <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>

show settings like <span class="token string">'%background_common_pool_size%'</span>
</code></pre> 
<p>4、设置参数</p> 
<pre><code class="prism language-bash">SET param <span class="token operator">=</span> value
<span class="token builtin class-name">set</span>  background_common_pool_size <span class="token operator">=</span> <span class="token number">128</span>

</code></pre> 
<p>加个globa执行也没报错 官方文档上没有global参数。但是阿里云dms 需要加上global 才能全局生效</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">set</span> global background_common_pool_size <span class="token operator">=</span> <span class="token number">128</span>
</code></pre> 
<p>https://help.aliyun.com/zh/clickhouse/user-guide/set-parameters-in-the-user-xml-file?spm=a2c4g.11186623.0.0.6bdc5d7fnAdCqs</p> 
<p>https://clickhouse.com/docs/zh/sql-reference/statements/set</p> 
<p>如果更改配置文件config以后<br> 查询system.settings里面的参数没生效时因为<br> 这里没改是因为system.settings查询的时候值是从user.xml中获取的，所以一直都原来的值，其实生效的是在config.xml里</p> 
<p>https://clickhouse.com/docs/en/operations/server-configuration-parameters/settings#background_pool_size</p> 
<p>https://blog.csdn.net/qq_35423190/article/details/109999576</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4d0c19d61c2c20bff08eb528ec04ef62/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">PDF 文件操作指南</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ea1f22e39cba410e66ef0627f0bc67a6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">团结引擎 | 发布微信小游戏的那些坑</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>