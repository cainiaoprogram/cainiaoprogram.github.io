<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>python flask框架详解 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="python flask框架详解" />
<meta property="og:description" content="Flask是一个Python编写的Web 微框架，让我们可以使用Python语言快速实现一个网站或Web服务。本文参考自Flask官方文档，
英文不好的同学也可以参考中文文档
1.安装flask pip install flask 2.简单上手 一个最小的 Flask 应用如下:
from flask import Flask app = Flask(__name__) @app.route(&#39;/&#39;) def hello_world(): return &#39;Hello World&#39; if __name__ == &#39;__main__&#39;: app.run() 代码解析：
1、首先我们导入了 Flask 类。 该类的实例将会成为我们的 WSGI 应用。
2、接着我们创建一个该类的实例。第一个参数是应用模块或者包的名称。如果你使用 一个单一模块（就像本例），那么应当使用 name ，因为名称会根据这个 模块是按应用方式使用还是作为一个模块导入而发生变化（可能是 ‘main’ ， 也可能是实际导入的名称）。这个参数是必需的，这样 Flask 才能知道在哪里可以 找到模板和静态文件等东西
3、然后我们使用 route() 装饰器来告诉 Flask 触发函数的 URL 。
4、函数名称被用于生成相关联的 URL 。函数最后返回需要在用户浏览器中显示的信息。
运行结果：
* Serving Flask app &#34;flask_demo&#34; (lazy loading) * Environment: production WARNING: This is a development server." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/5d6aa6daaffe1b734a185022e1b43967/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-03-03T23:36:11+08:00" />
<meta property="article:modified_time" content="2021-03-03T23:36:11+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">python flask框架详解</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>Flask是一个Python编写的Web 微框架，让我们可以使用Python语言快速实现一个网站或Web服务。本文参考自<a href="https://flask.palletsprojects.com/en/0.12.x/" rel="nofollow">Flask官方文档</a>，<br> 英文不好的同学也可以参考<a href="https://dormousehole.readthedocs.io/en/latest/" rel="nofollow">中文文档</a></p> 
<h2><a id="1flask_2"></a>1.安装flask</h2> 
<pre><code class="prism language-bash">pip <span class="token function">install</span> flask
</code></pre> 
<h2><a id="2_7"></a>2.简单上手</h2> 
<p>一个最小的 Flask 应用如下:</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask
app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">hello_world</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token keyword">return</span> <span class="token string">'Hello World'</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
   app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>代码解析：<br> 1、首先我们导入了 Flask 类。 该类的实例将会成为我们的 WSGI 应用。<br> 2、接着我们创建一个该类的实例。第一个参数是应用模块或者包的名称。如果你使用 一个单一模块（就像本例），那么应当使用 <strong>name</strong> ，因为名称会根据这个 模块是按应用方式使用还是作为一个模块导入而发生变化（可能是 ‘<strong>main</strong>’ ， 也可能是实际导入的名称）。这个参数是必需的，这样 Flask 才能知道在哪里可以 找到模板和静态文件等东西<br> 3、然后我们使用 route() 装饰器来告诉 Flask 触发函数的 URL 。<br> 4、函数名称被用于生成相关联的 URL 。函数最后返回需要在用户浏览器中显示的信息。</p> 
</blockquote> 
<p>运行结果：</p> 
<pre><code class="prism language-python"><span class="token operator">*</span> Serving Flask app <span class="token string">"flask_demo"</span> <span class="token punctuation">(</span>lazy loading<span class="token punctuation">)</span>
 <span class="token operator">*</span> Environment<span class="token punctuation">:</span> production
   WARNING<span class="token punctuation">:</span> This <span class="token keyword">is</span> a development server<span class="token punctuation">.</span> Do <span class="token operator">not</span> use it <span class="token keyword">in</span> a production deployment<span class="token punctuation">.</span>
   Use a production WSGI server instead<span class="token punctuation">.</span>
 <span class="token operator">*</span> Debug mode<span class="token punctuation">:</span> off
 <span class="token operator">*</span> Running on http<span class="token punctuation">:</span><span class="token operator">//</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">5000</span><span class="token operator">/</span> <span class="token punctuation">(</span>Press CTRL<span class="token operator">+</span>C to quit<span class="token punctuation">)</span>
</code></pre> 
<p>访问：http://127.0.0.1:5000/<br> <img src="https://images2.imgbox.com/76/5c/ZUeZJtL7_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python">app<span class="token punctuation">.</span>route<span class="token punctuation">(</span>rule<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
</code></pre> 
<ul><li>rule 参数表示与该函数的URL绑定。</li><li>options 是要转发给基础Rule对象的参数列表。<br> 在上面的示例中，’/ ’ URL与hello_world()函数绑定。因此，当在浏览器中打开web服务器的主页时，将呈现该函数的输出。<br> 最后，Flask类的run()方法在本地开发服务器上运行应用程序。</li></ul> 
<pre><code class="prism language-python">app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">,</span> debug<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
</code></pre> 
<p>所有参数都是可选的</p> 
<ul><li>host：要监听的主机名。 默认为127.0.0.1（localhost）。设置为“0.0.0.0”以使服务器在外部可用</li><li>port ：默认值为5000</li><li>debug：默认为false。 如果设置为true，则提供调试信息，可以自动重载代码并显示调试信息</li><li>options：要转发到底层的Werkzeug服务器。</li></ul> 
<h3><a id="21__57"></a>2.1 调试模式</h3> 
<p>虽然 flask 命令可以方便地启动一个本地开发服务器，但是每次应用代码 修改之后都需要手动重启服务器。这样不是很方便， Flask 可以做得更好。如果你打开 调试模式，那么服务器会在修改应用代码之后自动重启，并且当应用出错时还会提供一个 有用的调试器。<br> 在命令行中，如果需要打开所有开发功能（包括调试模式），那么要在运行服务器之前导出 FLASK_ENV 环境变量并把其设置为 development:</p> 
<pre><code class="prism language-python">$ export FLASK_ENV<span class="token operator">=</span>development
$ flask run
</code></pre> 
<p>在代码中，在运行或将调试参数传递给run()方法之前，通过将application对象的debug属性设置为True来启用Debug模式。</p> 
<pre><code class="prism language-python">app<span class="token punctuation">.</span>debug <span class="token operator">=</span> <span class="token boolean">True</span>
app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 或者</span>
app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>debug <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="22_IP_74"></a>2.2 绑定IP和端口</h3> 
<p>默认情况下，Flask绑定IP为127.0.0.1，端口为5000。我们也可以通过下面的方式自定义：</p> 
<pre><code class="prism language-python">app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">,</span> debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> 
<p>0.0.0.0代表电脑所有的IP。80是HTTP网站服务的默认端口。什么是默认？比如，我们访问网站http://www.example.com，其实是访问的http://www.example.com:80，只不过:80可以省略不写。</p> 
<h2><a id="3Flask__82"></a>3.Flask 路由</h2> 
<p>现代Web框架使用路由技术来帮助用户记住应用程序URL。可以直接访问所需的页面，而无需从主页导航。</p> 
<p>Flask中的route()装饰器用于将URL绑定到函数。例如：</p> 
<pre><code class="prism language-python">@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">'/hello'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">hello_world</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token keyword">return</span> <span class="token string">'hello world'</span>
</code></pre> 
<p>在这里，URL<code>'/ hello'</code>规则绑定到hello_world()函数。 因此，如果用户访问<code>http://localhost:5000/hello</code> URL，hello_world()函数的输出将在浏览器中呈现。</p> 
<p>application对象的add_url_rule()函数也可用于将URL与函数绑定，如上例所示，使用route()装饰器的目的也由以下表示：</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">hello_world</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token keyword">return</span> <span class="token string">'hello world'</span>
app<span class="token punctuation">.</span>add_url_rule<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token string">'hello'</span><span class="token punctuation">,</span> hello_world<span class="token punctuation">)</span>
</code></pre> 
<h2><a id="4Flask__101"></a>4.Flask 变量规则</h2> 
<p>通过向规则参数添加变量部分，可以动态构建URL。此变量部分标记为<code>&lt;converter:variable_name&gt;</code>。它作为关键字参数传递给与规则相关联的函数。<br> 在以下示例中，route()装饰器的规则参数包含附加到URL<code>'/hello'</code>的<code>&lt;name&gt;</code>。 因此，如果在浏览器中输入http://localhost:5000/hello/chenshifeng作为URL，则’chenshifeng’将作为参数提供给 hello()函数。</p> 
<pre><code class="prism language-python"><span class="token comment">#!/usr/bin/python</span>
<span class="token comment"># -*- coding: UTF-8 -*-</span>
<span class="token triple-quoted-string string">"""
@author:chenshifeng
@file:flask_demo.py
@time:2021/03/01
"""</span>
<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>


@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">'/hello/&lt;name&gt;'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">hello_name</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">'Hello %s!'</span> <span class="token operator">%</span> name


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> 
<p>运行，访问：http://localhost:5000/hello/chenshifeng<br> <img src="https://images2.imgbox.com/45/dc/Ay3Fi5JA_o.png" alt="在这里插入图片描述"><br> 除了默认字符串变量部分之外，还可以使用以下转换器构建规则：</p> 
<table><thead><tr><th>转换器</th><th>描述</th></tr></thead><tbody><tr><td>string</td><td>（缺省值） 接受任何不包含斜杠的文本</td></tr><tr><td>int</td><td>接受正整数</td></tr><tr><td>float</td><td>接受正浮点数</td></tr><tr><td>path</td><td>类似 string ，但可以包含斜杠</td></tr><tr><td>uuid</td><td>接受 UUID 字符串</td></tr></tbody></table> 
<pre><code class="prism language-python"><span class="token comment">#!/usr/bin/python</span>
<span class="token comment"># -*- coding: UTF-8 -*-</span>
<span class="token triple-quoted-string string">"""
@author:chenshifeng
@file:flask_demo.py
@time:2021/03/01
"""</span>
<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>


@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">'/post/&lt;int:post_id&gt;'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">show_post</span><span class="token punctuation">(</span>post_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># show the post with the given id, the id is an integer</span>
    <span class="token keyword">return</span> <span class="token string">'Post %d'</span> <span class="token operator">%</span> post_id


@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">'/path/&lt;path:subpath&gt;'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">show_subpath</span><span class="token punctuation">(</span>subpath<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># show the subpath after /path/</span>
    <span class="token keyword">return</span> <span class="token string">'Subpath %s'</span> <span class="token operator">%</span> subpath


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/2a/43/1TzIoMjJ_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/61/e9/chcOnBi7_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="41_URL___168"></a>4.1唯一的 URL / 重定向行为</h3> 
<p>以下两条规则的不同之处在于是否使用尾部的斜杠。:</p> 
<pre><code class="prism language-python">@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">'/projects/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">projects</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">'The project page'</span>

@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">'/about'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">about</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">'The about page'</span>
</code></pre> 
<p>projects 的 URL 是中规中矩的，尾部有一个斜杠，看起来就如同一个文件夹。 访问一个没有斜杠结尾的 URL 时 Flask 会自动进行重定向，帮你在尾部加上一个斜杠。</p> 
<p>about 的 URL 没有尾部斜杠，因此其行为表现与一个文件类似。如果访问这个 URL 时添加了尾部斜杠就会得到一个 404 错误。这样可以保持 URL 唯一，并帮助 搜索引擎避免重复索引同一页面。</p> 
<h2><a id="5Flask_URL_183"></a>5.Flask URL构建</h2> 
<p>url_for()函数对于动态构建特定函数的URL非常有用。该函数接受函数的名称作为第一个参数，以及一个或多个关键字参数，每个参数对应于URL的变量部分。</p> 
<pre><code class="prism language-python"><span class="token comment">#!/usr/bin/python</span>
<span class="token comment"># -*- coding: UTF-8 -*-</span>
<span class="token triple-quoted-string string">"""
@author:chenshifeng
@file:flask_demo.py
@time:2021/03/01
"""</span>
<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> redirect<span class="token punctuation">,</span> url_for

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>


@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">'/admin'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">hello_admin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">'Hello Admin'</span>


@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">'/guest/&lt;guest&gt;'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">hello_guest</span><span class="token punctuation">(</span>guest<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">'Hello %s as Guest'</span> <span class="token operator">%</span> guest


@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">'/user/&lt;name&gt;'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">hello_user</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> name <span class="token operator">==</span> <span class="token string">'admin'</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'hello_admin'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'hello_guest'</span><span class="token punctuation">,</span> guest<span class="token operator">=</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

</code></pre> 
<blockquote> 
 <p>redirect函数用于重定向，实现机制很简单，就是向客户端（浏览器）发送一个重定向的HTTP报文，浏览器会去访问报文中指定的url。</p> 
</blockquote> 
<p>运行<br> 打开浏览器并输入URL - <a href="http://localhost:5000/user/admin" rel="nofollow">http://localhost:5000/user/admin</a></p> 
<pre><code class="prism language-python">Hello Admin
</code></pre> 
<p>在浏览器中输入以下URL - <a href="http://localhost:5000/user/mvl" rel="nofollow">http://localhost:5000/user/mvl</a></p> 
<pre><code class="prism language-python">Hello mvl <span class="token keyword">as</span> Guest
</code></pre> 
<h2><a id="6Flask_HTTP_234"></a>6.Flask HTTP方法</h2> 
<p>Web 应用使用不同的 HTTP 方法处理 URL 。当你使用 Flask 时，应当熟悉 HTTP 方法。 缺省情况下，一个路由只回应 GET 请求。 可以使用 route() 装饰器的 methods 参数来处理不同的 HTTP 方法:</p> 
<table><thead><tr><th>方法</th><th>描述</th></tr></thead><tbody><tr><td>GET</td><td>以未加密的形式将数据发送到服务器，最常见的方法。</td></tr><tr><td>HEAD</td><td>和GET方法相同，但没有响应体。</td></tr><tr><td>POST</td><td>用于将HTML表单数据发送到服务器，POST方法接收的数据不由服务器缓存。</td></tr><tr><td>PUT</td><td>用上传的内容替换目标资源的所有当前表示。</td></tr><tr><td>DELETE</td><td>删除由URL给出的目标资源的所有当前表示。</td></tr></tbody></table> 
<p>默认情况下，Flask路由响应GET请求。但是，可以通过为route()装饰器提供方法参数来更改此首选项。</p> 
<p>为了演示在URL路由中使用POST方法，首先让我们创建一个HTML表单，并使用POST方法将表单数据发送到URL。<br> 将以下脚本另存为login.html</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
      
      &lt;form action = "http://localhost:5000/login" method = "post"&gt;
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Enter Name:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>&lt;input type = "text" name = "nm" /&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>&lt;input type = "submit" value = "submit" /&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
      
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>运行以下代码</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> redirect<span class="token punctuation">,</span> url_for<span class="token punctuation">,</span> request
app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">'/success/&lt;name&gt;'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">success</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token keyword">return</span> <span class="token string">'welcome %s'</span> <span class="token operator">%</span> name

@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span>methods <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>
      user <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'nm'</span><span class="token punctuation">]</span>
      <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">,</span>name <span class="token operator">=</span> user<span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token keyword">else</span><span class="token punctuation">:</span>
      user <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'nm'</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">,</span>name <span class="token operator">=</span> user<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
   app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>debug <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> 
<p>在浏览器中打开login.html，在文本字段中输入name，然后单击提交。<br> <img src="https://images2.imgbox.com/a9/74/GfWw0zJb_o.png" alt="在这里插入图片描述"><br> 表单数据将POST到表单标签的action子句中的URL。</p> 
<p>http://localhost/login映射到login()函数。由于服务器通过POST方法接收数据，因此通过以下步骤获得从表单数据获得的“nm”参数的值：<br> 表单数据将POST到表单标签的action子句中的URL。</p> 
<pre><code class="prism language-python">user <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'nm'</span><span class="token punctuation">]</span>
</code></pre> 
<p>它作为变量部分传递给’/ success’ URL。浏览器在窗口中显示welcome消息。<br> <img src="https://images2.imgbox.com/ce/22/bLzQvin8_o.png" alt="在这里插入图片描述"><br> 在login.html中将方法参数更改为’GET’，然后在浏览器中再次打开它。服务器上接收的数据是通过GET方法获得的。通过以下的步骤获得’nm’参数的值：</p> 
<pre><code class="prism language-python">User <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'nm'</span><span class="token punctuation">)</span>
</code></pre> 
<p>这里，args是包含表单参数对及其对应值对的列表的字典对象。与’nm’参数对应的值将像之前一样传递到’/ success’ URL。</p> 
<h2><a id="7Flask__306"></a>7.Flask 模板</h2> 
<p>在大型应用中,把业务逻辑和表现内容放在一起,会增加代码的复杂度和维护成本.</p> 
<ul><li>模板其实是一个包含响应文本的文件,其中用占位符(变量)表示动态部分,告诉模板引擎其具体的值需要从使用的数据中获取</li><li>使用真实值替换变量,再返回最终得到的字符串,这个过程称为’渲染’</li><li>Flask 是使用 Jinja2 这个模板引擎来渲染模板</li></ul> 
<p>使用模板的好处</p> 
<ul><li>视图函数只负责业务逻辑和数据处理(业务逻辑方面)</li><li>而模板则取到视图函数的数据结果进行展示(视图展示方面)</li><li>代码结构清晰,耦合度低</li></ul> 
<p>使用 render_template() 方法可以渲染模板，你只要提供模板名称和需要 作为参数传递给模板的变量就行了。<br> Flask 会在 templates 文件夹内寻找模板。因此，如果你的应用是一个模块， 那么模板文件夹应该在模块旁边；如果是一个包，那么就应该在包里面：<br> 情形 1 : 一个模块:</p> 
<pre><code class="prism language-python"><span class="token operator">/</span>application<span class="token punctuation">.</span>py
<span class="token operator">/</span>templates
    <span class="token operator">/</span>hello<span class="token punctuation">.</span>html
</code></pre> 
<p>情形 2 : 一个包:</p> 
<pre><code class="prism language-python"><span class="token operator">/</span>application
    <span class="token operator">/</span>__init__<span class="token punctuation">.</span>py
    <span class="token operator">/</span>templates
        <span class="token operator">/</span>hello<span class="token punctuation">.</span>html
</code></pre> 
<p>示例代码：</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> render_template

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    my_int <span class="token operator">=</span> <span class="token number">18</span>
    my_str <span class="token operator">=</span> <span class="token string">'curry'</span>
    my_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span>
    my_dict <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'durant'</span><span class="token punctuation">,</span>
        <span class="token string">'age'</span><span class="token punctuation">:</span> <span class="token number">28</span>
    <span class="token punctuation">}</span>

    <span class="token comment"># render_template方法:渲染模板</span>
    <span class="token comment"># 参数1: 模板名称  参数n: 传到模板里的数据</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'hello.html'</span><span class="token punctuation">,</span>
                           my_int<span class="token operator">=</span>my_int<span class="token punctuation">,</span>
                           my_str<span class="token operator">=</span>my_str<span class="token punctuation">,</span>
                           my_list<span class="token operator">=</span>my_list<span class="token punctuation">,</span>
                           my_dict<span class="token operator">=</span>my_dict<span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-html"><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>我是模板<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
  {<!-- -->{ my_int }}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
  {<!-- -->{ my_str }}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
  {<!-- -->{ my_list }}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
  {<!-- -->{ my_dict }}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>模板的list数据获取<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">&gt;</span></span>
  {<!-- -->{ my_list[0] }}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
  {<!-- -->{ my_list.1 }}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>字典数据获取<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">&gt;</span></span>
  {<!-- -->{ my_dict['name'] }}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
  {<!-- -->{ my_dict.age }}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>算术运算<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
  {<!-- -->{ my_list.0 + 10 }}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
  {<!-- -->{ my_list[0] + my_list.1 }}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>运行效果：<br> <img src="https://images2.imgbox.com/51/9d/h4hNTTla_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="8Flask__410"></a>8.Flask 静态文件</h2> 
<p>动态的 web 应用也需要静态文件，一般是 CSS 和 JavaScript 文件。理想情况下你的 服务器已经配置好了为你的提供静态文件的服务。但是在开发过程中， Flask 也能做好 这项工作。只要在你的包或模块旁边创建一个名为 static 的文件夹就行了。 静态文件位于应用的 /static 中。<br> 使用特定的 ‘static’ 端点就可以生成相应的 URL</p> 
<pre><code class="prism language-python">url_for<span class="token punctuation">(</span><span class="token string">'static'</span><span class="token punctuation">,</span> filename<span class="token operator">=</span><span class="token string">'style.css'</span><span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>这个静态文件在文件系统中的位置应该是 static/style.css 。</p> 
</blockquote> 
<p>在下面的示例中，在index.html中的HTML按钮的OnClick事件上调用hello.js中定义的javascript函数，该函数在Flask应用程序的“/”URL上呈现。</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> render_template
app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"index.html"</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
   app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>debug <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> 
<p>index.html的HTML脚本如下所示：</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>

   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
      &lt;script type = "text/javascript"
         src = "{<!-- -->{ url_for('static', filename = 'hello.js') }}" &gt;<span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
      &lt;input type = "button" onclick = "sayHello()" value = "Say Hello" /&gt;
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>Hello.js包含sayHello()函数。</p> 
<pre><code class="prism language-javascript"><span class="token keyword">function</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
   <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"Hello World"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>运行效果：<br> <img src="https://images2.imgbox.com/c8/89/21XqTDOH_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="9Flask_Request_457"></a>9.Flask Request对象</h2> 
<p>来自客户端网页的数据作为全局请求对象发送到服务器。为了处理请求数据，应该从Flask模块导入。</p> 
<p>Request对象的重要属性如下所列：</p> 
<ul><li>form - 它是一个字典对象，包含表单参数及其值的键和值对。</li><li>args - 解析查询字符串的内容，它是问号（？）之后的URL的一部分。</li><li>Cookies - 保存Cookie名称和值的字典对象。</li><li>files - 与上传文件有关的数据。</li><li>method - 当前请求方法</li></ul> 
<p>首先，你必须从 flask 模块导入请求对象:</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> request
</code></pre> 
<h3><a id="91_Flask__472"></a>9.1 Flask 将表单数据发送到模板</h3> 
<p>我们已经看到，可以在 URL 规则中指定 http 方法。触发函数接收的 Form 数据可以以字典对象的形式收集它并将其转发到模板以在相应的网页上呈现它。</p> 
<p>在以下示例中，’/’ URL 会呈现具有表单的网页（student.html）。填入的数据会发布到触发 result() 函数的 ‘/result’ URL。</p> 
<p>result() 函数收集字典对象中的 request.form 中存在的表单数据，并将其发送给 result.html。</p> 
<p>该模板动态呈现表单数据的 HTML 表格。</p> 
<p>下面给出的是应用程序的 Python 代码：</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> render_template<span class="token punctuation">,</span> request
app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>
@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">student</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'student.html'</span><span class="token punctuation">)</span>


@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">'/result'</span><span class="token punctuation">,</span>methods <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>
      result <span class="token operator">=</span> request<span class="token punctuation">.</span>form
      <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"result.html"</span><span class="token punctuation">,</span>result <span class="token operator">=</span> result<span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
   app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>debug <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> 
<p>下面给出的是 student.html 的 HTML 脚本。</p> 
<pre><code class="prism language-html"><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://localhost:5000/result<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>POST<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Name &lt;input type = "text" name = "Name" /&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Physics &lt;input type = "text" name = "Physics" /&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Chemistry &lt;input type = "text" name = "chemistry" /&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Maths &lt;input type ="text" name = "Mathematics" /&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>&lt;input type = "submit" value = "submit" /&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>下面给出了模板（ result.html ）的代码：</p> 
<pre><code class="prism language-html"><span class="token doctype">&lt;!doctype html&gt;</span>
  &lt;table border = 1&gt;
     {% for key, value in result.items() %}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span> {<!-- -->{ key }} <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span> {<!-- -->{ value }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
 {% endfor %}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>运行效果：<br> 运行 Python 脚本，并在浏览器中输入 URL http://localhost:5000/。<br> <img src="https://images2.imgbox.com/bc/21/kVts6idn_o.png" alt="在这里插入图片描述">当点击提交按钮时，表单数据以 HTML 表格的形式呈现在 result.html 上。<br> <img src="https://images2.imgbox.com/1a/16/aM2qFrmr_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="92_Flask_Cookies_538"></a>9.2 Flask Cookies</h3> 
<p>Cookie以文本文件的形式存储在客户端的计算机上。其目的是记住和跟踪与客户使用相关的数据，以获得更好的访问者体验和网站统计信息。</p> 
<p>Request对象包含Cookie的属性。它是所有cookie变量及其对应值的字典对象，客户端已传输。除此之外，cookie还存储其网站的到期时间，路径和域名。<br> 在Flask中，对cookie的处理步骤为：</p> 
<ol><li>设置cookie：<br> 设置cookie,默认有效期是临时cookie,浏览器关闭就失效<br> 可以通过 max_age 设置有效期， 单位是秒</li></ol> 
<pre><code class="prism language-python"> resp <span class="token operator">=</span> make_response<span class="token punctuation">(</span><span class="token string">"success"</span><span class="token punctuation">)</span>   <span class="token comment"># 设置响应体</span>
 resp<span class="token punctuation">.</span>set_cookie<span class="token punctuation">(</span><span class="token string">"chenshifeng"</span><span class="token punctuation">,</span> <span class="token string">"shifengboy"</span><span class="token punctuation">,</span> max_age<span class="token operator">=</span><span class="token number">3600</span><span class="token punctuation">)</span>
</code></pre> 
<ol start="2"><li>获取cookie<br> 获取cookie，通过request.cookies的方式， 返回的是一个字典，可以获取字典里的相应的值</li></ol> 
<pre><code class="prism language-python">cookie_1 <span class="token operator">=</span> request<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"chenshifeng"</span><span class="token punctuation">)</span>
</code></pre> 
<ol start="3"><li>删除cookie<br> 这里的删除只是让cookie过期，并不是直接删除cookie<br> 删除cookie，通过delete_cookie()的方式， 里面是cookie的名字</li></ol> 
<pre><code class="prism language-python">resp <span class="token operator">=</span> make_response<span class="token punctuation">(</span><span class="token string">"del success"</span><span class="token punctuation">)</span>  <span class="token comment"># 设置响应体</span>
resp<span class="token punctuation">.</span>delete_cookie<span class="token punctuation">(</span><span class="token string">"chenshifeng"</span><span class="token punctuation">)</span>
</code></pre> 
<p>以下为Flask Cookies的简单示例：</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> make_response<span class="token punctuation">,</span> request

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">"/set_cookies"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">set_cookie</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    resp <span class="token operator">=</span> make_response<span class="token punctuation">(</span><span class="token string">"success"</span><span class="token punctuation">)</span>
    resp<span class="token punctuation">.</span>set_cookie<span class="token punctuation">(</span><span class="token string">"chenshifeng"</span><span class="token punctuation">,</span> <span class="token string">"shifengboy"</span><span class="token punctuation">,</span>max_age<span class="token operator">=</span><span class="token number">3600</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> resp

@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">"/get_cookies"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">get_cookie</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    cookie_1 <span class="token operator">=</span> request<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"chenshifeng"</span><span class="token punctuation">)</span>  <span class="token comment"># 获取名字为Itcast_1对应cookie的值</span>
    <span class="token keyword">return</span> cookie_1

@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">"/delete_cookies"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">delete_cookie</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    resp <span class="token operator">=</span> make_response<span class="token punctuation">(</span><span class="token string">"del success"</span><span class="token punctuation">)</span>
    resp<span class="token punctuation">.</span>delete_cookie<span class="token punctuation">(</span><span class="token string">"chenshifeng"</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> resp

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> 
<p>设置cookies</p> 
<p>运行应用程序，在浏览器中输入 127.0.0.1:5000/set_cookies 来设置cookies，设置 cookies 的输出如下所示：<br> <img src="https://images2.imgbox.com/95/f4/HCrtaelb_o.png" alt="在这里插入图片描述"><br> 获取cookie<br> 根据视图函数中相对应的路径，输入 http://127.0.0.1:5000/get_cookies ，读回 cookies 的输出如下所示：<br> <img src="https://images2.imgbox.com/1a/c3/2wyzKqjl_o.png" alt="在这里插入图片描述"></p> 
<p>删除cookie<br> 根据视图函数中相对应的路径，输入 http://127.0.0.1:5000/delete_cookies ，删除 cookies 的输出如下所示：<br> <img src="https://images2.imgbox.com/91/bb/TIWIyyOb_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>注意删除，只是让 cookie 过期。</p> 
</blockquote> 
<h2><a id="10Flask__603"></a>10.Flask 会话</h2> 
<p>与Cookie不同，Session（会话）数据存储在服务器上。会话是客户端登录到服务器并注销服务器的时间间隔。需要在该会话中保存的数据会存储在服务器上的临时目录中。</p> 
<p>为每个客户端的会话分配会话ID。会话数据存储在cookie的顶部，服务器以加密方式对其进行签名。对于此加密，Flask应用程序需要一个定义的SECRET_KEY。</p> 
<p>Session对象也是一个字典对象，包含会话变量和关联值的键值对。</p> 
<p>例如，要设置一个’username’会话变量，请使用以下语句：</p> 
<pre><code class="prism language-python">Session<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'admin'</span>
</code></pre> 
<p>要释放会话变量，请使用pop()方法。</p> 
<pre><code class="prism language-python">session<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
</code></pre> 
<p>演示代码：</p> 
<pre><code class="prism language-python">
<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> session<span class="token punctuation">,</span> redirect<span class="token punctuation">,</span> url_for<span class="token punctuation">,</span> request

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

app<span class="token punctuation">.</span>secret_key <span class="token operator">=</span> <span class="token string">'fkdjsafjdkfdlkjfadskjfadskljdsfklj'</span>  <span class="token comment"># 确保设置应用程序的secret_key</span>


@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token string">'username'</span> <span class="token keyword">in</span> session<span class="token punctuation">:</span>
        username <span class="token operator">=</span> session<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span>

        <span class="token keyword">return</span> <span class="token string">'登录用户名是:'</span> <span class="token operator">+</span> username <span class="token operator">+</span> <span class="token string">'&lt;br&gt;'</span> <span class="token operator">+</span> \
               <span class="token string">"&lt;b&gt;&lt;a href = '/logout'&gt;点击这里注销&lt;/a&gt;&lt;/b&gt;"</span>

    <span class="token keyword">return</span> <span class="token string">"您暂未登录， &lt;br&gt;&lt;a href = '/login'&gt;&lt;/b&gt;"</span> <span class="token operator">+</span> \
           <span class="token string">"点击这里登录&lt;/b&gt;&lt;/a&gt;"</span>


@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>
        session<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span>

        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token triple-quoted-string string">'''

   &lt;form action = "" method = "post"&gt;

      &lt;p&gt;&lt;input type ="text" name ="username"/&gt;&lt;/p&gt;

      &lt;p&gt;&lt;input type ="submit" value ="登录"/&gt;&lt;/p&gt;

   &lt;/form&gt;

   '''</span>


@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">'/logout'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># remove the username from the session if it is there</span>

    session<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

</code></pre> 
<blockquote> 
 <p>如何生成一个好的密钥<br> 生成随机数的关键在于一个好的随机种子，因此一个好的密钥应当有足够的随机性。 操作系统可以有多种方式基于密码随机生成器来生成随机数据。使用下面的命令 可以快捷的为 Flask.secret_key （ 或者 SECRET_KEY ）生成值:<br> $ python -c ‘import os; print(os.urandom(16))’<br> b’_5#y2L"F4Q8z\n\xec]/’</p> 
</blockquote> 
<p>访问http://127.0.0.1:5000/，只是提示用户登录，因为未设置会话变量’username’。<br> <img src="https://images2.imgbox.com/fc/ce/GdYw1ker_o.png" alt="在这里插入图片描述"><br> 当用户点击登录，浏览到“/login”login()视图函数时，因为它是通过GET方法调用的，所以将打开一个登录表单。<br> <img src="https://images2.imgbox.com/8e/68/lpIaYZji_o.png" alt="在这里插入图片描述"></p> 
<p>点击登录，通过POST方法将表单发送回’/login’，现在会话变量已设置。应用程序重定向到’/’。此时会话变量’username’被找到。<br> <img src="https://images2.imgbox.com/5c/2c/X482Jg8b_o.png" alt="在这里插入图片描述"><br> 应用程序还包含一个logout()视图函数，它会弹出’username’会话变量。因此，’/’ URL再次显示开始页面。<br> <img src="https://images2.imgbox.com/4e/26/4STL8sTH_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="11Flask__690"></a>11.Flask 重定向和错误</h2> 
<p>Flask类有一个redirect()函数。调用时，它返回一个响应对象，并将用户重定向到具有指定状态代码的另一个目标位置。</p> 
<p>redirect()函数的原型如下：</p> 
<pre><code class="prism language-python">Flask<span class="token punctuation">.</span>redirect<span class="token punctuation">(</span>location<span class="token punctuation">,</span> statuscode<span class="token punctuation">,</span> response<span class="token punctuation">)</span>
</code></pre> 
<p>在上述函数中：</p> 
<ul><li>location参数是应该重定向响应的URL。</li><li>statuscode发送到浏览器标头，默认为302。</li><li>response参数用于实例化响应。</li></ul> 
<p>以下状态代码已标准化：</p> 
<ul><li>HTTP_300_MULTIPLE_CHOICES</li><li>HTTP_301_MOVED_PERMANENTLY</li><li>HTTP_302_FOUND</li><li>HTTP_303_SEE_OTHER</li><li>HTTP_304_NOT_MODIFIED</li><li>HTTP_305_USE_PROXY</li><li>HTTP_306_RESERVED</li><li>HTTP_307_TEMPORARY_REDIRECT</li></ul> 
<p>默认状态代码为302，表示’found’。<br> 在以下示例中，redirect()函数用于在登录尝试失败时再次显示登录页面。</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> redirect<span class="token punctuation">,</span> url_for<span class="token punctuation">,</span> render_template<span class="token punctuation">,</span> request

<span class="token comment"># Initialize the Flask application</span>
app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>


@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'log_in.html'</span><span class="token punctuation">)</span>


@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span> <span class="token operator">and</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'admin'</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">'/success'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">'logged in successfully'</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> 
<p>下面给出的是 log_in.html的 HTML 脚本。</p> 
<pre><code class="prism language-html"><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
      &lt;form action = "http://localhost:5000/login" method = "POST"&gt;
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Enter Name:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>&lt;input type = "text" name = "username" /&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>&lt;input type = "submit" value = "submit" /&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>Flask类具有带有错误代码的abort()函数。</p> 
<pre><code class="prism language-python">Flask<span class="token punctuation">.</span>abort<span class="token punctuation">(</span>code<span class="token punctuation">)</span>
</code></pre> 
<p>Code参数采用以下值之一：</p> 
<ul><li>400 - 用于错误请求</li><li>401 - 用于未身份验证的</li><li>403 - Forbidden</li><li>404 - 未找到</li><li>406 - 表示不接受</li><li>415 - 用于不支持的媒体类型</li><li>429 - 请求过多<br> 让我们对上述代码中的login()函数稍作更改。如果要显示’Unauthurized’页面，请将其替换为调用abort(401)，而不是重新显示登录页面。</li></ul> 
<pre><code class="prism language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> redirect<span class="token punctuation">,</span> url_for<span class="token punctuation">,</span> render_template<span class="token punctuation">,</span> request<span class="token punctuation">,</span> abort

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>


@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'log_in.html'</span><span class="token punctuation">)</span>


@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'admin'</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            abort<span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">'/success'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">'logged in successfully'</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> 
<p>运行，输入非admin的用户名，点击提交<br> <img src="https://images2.imgbox.com/e2/63/mCUSbvay_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="12_Flask__808"></a>12. Flask 消息闪现</h2> 
<p>一个好的基于 GUI 的应用程序会向用户提供有关交互的反馈。例如，桌面应用程序使用对话框或消息框，JavaScript 使用警报用于类似目的。</p> 
<p>在 Flask Web 应用程序中生成这样的信息性消息很容易。Flask 框架的闪现系统可以在一个视图中创建消息，并在名为 next 的视图函数中呈现它。</p> 
<p>Flask 模块包含 flash() 方法。它将消息传递给下一个请求，该请求通常是一个模板。</p> 
<pre><code class="prism language-python">flash<span class="token punctuation">(</span>message<span class="token punctuation">,</span> category<span class="token punctuation">)</span>
</code></pre> 
<p>其中，</p> 
<ul><li>message 参数是要闪现的实际消息。</li><li>category 参数是可选的。它可以是“error”，“info”或“warning”。<br> 为了从会话中获取消息，模板调用 get_flashed_messages()。<br> 以下是一个完整的示例:</li></ul> 
<pre><code class="prism language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> flash<span class="token punctuation">,</span> redirect<span class="token punctuation">,</span> render_template<span class="token punctuation">,</span> \
     request<span class="token punctuation">,</span> url_for

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>
app<span class="token punctuation">.</span>secret_key <span class="token operator">=</span> b<span class="token string">'_5#y2L"F4Q8z\n\xec]/'</span>

@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">)</span>

@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    error <span class="token operator">=</span> <span class="token boolean">None</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">'admin'</span> <span class="token operator">or</span> \
           request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">'secret'</span><span class="token punctuation">:</span>
            error <span class="token operator">=</span> <span class="token string">'Invalid credentials'</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            flash<span class="token punctuation">(</span><span class="token string">'You were successfully logged in'</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'login.html'</span><span class="token punctuation">,</span> error<span class="token operator">=</span>error<span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> 
<p>以下是实现闪现的 layout.html 模板：</p> 
<pre><code class="prism language-html"><span class="token doctype">&lt;!doctype html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>My Application<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
{% with messages = get_flashed_messages() %}
  {% if messages %}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span>flashes</span><span class="token punctuation">&gt;</span></span>
    {% for message in messages %}
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>{<!-- -->{ message }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    {% endfor %}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
  {% endif %}
{% endwith %}
{% block body %}{% endblock %}
</code></pre> 
<p>以下是继承自 layout.html 的 index.html 模板：</p> 
<pre><code class="prism language-html">{% block body %}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Overview<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Do you want to <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{<!-- -->{ url_for(<span class="token punctuation">'</span>login<span class="token punctuation">'</span>) }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>log in?<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
{% endblock %}
</code></pre> 
<p>以下是同样继承自 layout.html 的 login.html 模板：</p> 
<pre><code class="prism language-html">{% extends "layout.html" %}
{% block body %}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Login<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
  {% if error %}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span>error</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">&gt;</span></span>Error:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">&gt;</span></span> {<!-- -->{ error }}
  {% endif %}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span>post</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dl</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dt</span><span class="token punctuation">&gt;</span></span>Username:
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dd</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span>text</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span>username</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{<!-- -->{
          request.form.username }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dt</span><span class="token punctuation">&gt;</span></span>Password:
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dd</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span>password</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span>password</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dl</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span>submit</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span>Login</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
{% endblock %}
</code></pre> 
<p>运行<br> 首页<br> <img src="https://images2.imgbox.com/b0/b0/rCuEdqEB_o.png" alt="在这里插入图片描述"><br> 登录报错页<br> <img src="https://images2.imgbox.com/49/72/xtvSJ0KI_o.png" alt="在这里插入图片描述"><br> 登录成功页<br> <img src="https://images2.imgbox.com/7a/88/TfK8aUYn_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="13_Flask__902"></a>13. Flask 文件上传</h2> 
<p>在 Flask 中处理文件上传非常简单。它需要一个 HTML 表单，其 ​<code>enctype​</code>属性设置为<code>'multipart/form-data​'</code>，将文件发布到 URL。URL 处理程序从 ​<code>request.files[]​</code>对象中提取文件，并将其保存到所需的位置。</p> 
<p>每个上传的文件首先会保存在服务器上的临时位置，然后将其实际保存到它的最终位置。目标文件的名称可以是硬编码的，也可以从 ​<code>request.files[file]</code>​对象的​<code>filename</code>​属性中获取。但是，建议使用 ​<code>secure_filename()​</code>函数获取它的安全版本。<br> 可以在 Flask 对象的配置设置中定义默认上传文件夹的路径和上传文件的最大大小。</p> 
<blockquote> 
 <p>app.config[‘UPLOAD_FOLDER’] 定义上传文件夹的路径 app.config[‘MAX_CONTENT_LENGTH’] 指定要上传的文件的最大大小（以字节为单位）</p> 
</blockquote> 
<p>以下代码具有 <code>​'/upload'</code> ​URL 规则，该规则在 templates 文件夹中显示​ <code>'upload.html'​</code>，以及 <code>​'/ upload-file'</code>​URL 规则，用于调用 <code>​uploader() ​</code>函数处理上传过程。<br> <code>​'upload.html'</code> ​有一个文件选择器按钮和一个提交按钮。</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>File Upload<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://localhost:5000/uploader<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>POST<span class="token punctuation">"</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>multipart/form-data<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">accept</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>.jpg,.png<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>以下是 Flask 应用程序的 Python 代码。</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> render_template<span class="token punctuation">,</span> request
<span class="token keyword">from</span> werkzeug<span class="token punctuation">.</span>utils <span class="token keyword">import</span> secure_filename
<span class="token keyword">import</span> os

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>
app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'UPLOAD_FOLDER'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'/Users/chenshifeng/upload/'</span>

@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">'/upload'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">upload_file</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'upload.html'</span><span class="token punctuation">)</span>

@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">'/uploader'</span><span class="token punctuation">,</span> methods <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">uploader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>
      f <span class="token operator">=</span> request<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span>
      f<span class="token punctuation">.</span>save<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'UPLOAD_FOLDER'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>secure_filename<span class="token punctuation">(</span>f<span class="token punctuation">.</span>filename<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token string">'file uploaded successfully'</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
   app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>您将看到如下所示的界面。<br> <img src="https://images2.imgbox.com/cf/7b/eupBcnkh_o.png" alt="在这里插入图片描述"><br> 选择文件后，单击提交。表单的​ post ​方法调用​ <code>'/ upload_file'​</code>URL。底层函数 <code>​uploader()​</code>执行保存操作。<br> 上传成功会显示以下画面：<br> <img src="https://images2.imgbox.com/bd/81/zRvjfJa9_o.png" alt="在这里插入图片描述"><br> 上传文件被放到/Users/chenshifeng/upload文件夹下：<br> <img src="https://images2.imgbox.com/f8/d1/Hr1p24Ou_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="14_Flask__957"></a>14. Flask 扩展</h2> 
<p>Flask通常被称为微框架，因为核心功能包括基于Werkzeug的WSGI和路由以及基于Jinja2的模板引擎。此外，Flask框架还支持cookie和会话，以及JSON，静态文件等Web帮助程序。显然，这不足以开发完整的Web应用程序。而Flask扩展就具备这样的功能。Flask扩展为Flask框架提供了可扩展性。</p> 
<p>有大量的Flask扩展可用。Flask扩展是一个Python模块，它向Flask应用程序添加了特定类型的支持。Flask Extension Registry（Flask扩展注册表）是一个可用的扩展目录。可以通过pip实用程序下载所需的扩展名。</p> 
<p>在本教程中，我们将讨论以下重要的Flask扩展：</p> 
<ul><li>Flask Mail - 为Flask应用程序提供SMTP接口</li><li>Flask WTF - 添加WTForms的渲染和验证</li><li>Flask SQLAlchemy - 为Flask应用程序添加SQLAlchemy支持</li><li>Flask Sijax - Sijax的接口 - Python/jQuery库，使AJAX易于在Web应用程序中使用</li></ul> 
<p>每种类型的扩展通常提供有关其用法的大量文档。由于扩展是一个Python模块，因此需要导入它才能使用它。Flask扩展名通常命名为flask-foo。导入的操作如下：</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> flask_foo <span class="token keyword">import</span> <span class="token punctuation">[</span><span class="token keyword">class</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
</code></pre> 
<p>对于0.7以后的Flask版本，您还可以使用语法：</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> flask<span class="token punctuation">.</span>ext <span class="token keyword">import</span> foo
</code></pre> 
<p>对于此用法，需要激活兼容性模块。它可以通过运行flaskext_compat.py来安装：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> flaskext_compat
flaskext_compat<span class="token punctuation">.</span>activate<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">from</span> flask<span class="token punctuation">.</span>ext <span class="token keyword">import</span> foo
</code></pre> 
<h3><a id="141_Flask__985"></a>14.1 Flask 邮件</h3> 
<p>务器建立简单的接口变得非常容易。</p> 
<p>首先，应该在pip实用程序的帮助下安装Flask-Mail扩展。</p> 
<pre><code class="prism language-python">pip install Flask<span class="token operator">-</span>Mail
</code></pre> 
<p>然后需要通过设置以下应用程序参数的值来配置Flask-Mail。</p> 
<table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>MAIL_SERVER</td><td>电子邮件服务器的名称/IP地址</td></tr><tr><td>MAIL_PORT</td><td>使用的服务器的端口号</td></tr><tr><td>MAIL_USE_TLS</td><td>启用/禁用传输安全层加密</td></tr><tr><td>MAIL_USE_SSL</td><td>启用/禁用安全套接字层加密</td></tr><tr><td>MAIL_DEBUG</td><td>调试支持。默认值是Flask应用程序的调试状态</td></tr><tr><td>MAIL_USERNAME</td><td>发件人的用户名</td></tr><tr><td>MAIL_PASSWORD</td><td>发件人的密码</td></tr><tr><td>MAIL_DEFAULT_SENDER</td><td>设置默认发件人</td></tr><tr><td>MAIL_MAX_EMAILS</td><td>设置要发送的最大邮件数</td></tr><tr><td>MAIL_SUPPRESS_SEND</td><td>如果app.testing设置为true，则发送被抑制</td></tr><tr><td>MAIL_ASCII_ATTACHMENTS</td><td>如果设置为true，则附加的文件名将转换为ASCII</td></tr></tbody></table> 
<p>flask-mail模块包含以下重要类的定义。</p> 
<h4><a id="1411_Mail_1010"></a>14.1.1 Mail类</h4> 
<p>它管理电子邮件消息传递需求。类构造函数采用以下形式：</p> 
<pre><code class="prism language-python">flask<span class="token operator">-</span>mail<span class="token punctuation">.</span>Mail<span class="token punctuation">(</span>app <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
</code></pre> 
<p>构造函数将Flask应用程序对象作为参数。<br> Mail类的方法：</p> 
<table><thead><tr><th>方法</th><th>描述</th></tr></thead><tbody><tr><td>send()</td><td>发送Message类对象的内容</td></tr><tr><td>connect()</td><td>打开与邮件主机的连接</td></tr><tr><td>send_message()</td><td>发送消息对象</td></tr></tbody></table> 
<h4><a id="1412_Message_1023"></a>14.1.2 Message类</h4> 
<p>它封装了一封电子邮件。Message类构造函数有几个参数:</p> 
<pre><code class="prism language-python">flask<span class="token operator">-</span>mail<span class="token punctuation">.</span>Message<span class="token punctuation">(</span>subject<span class="token punctuation">,</span> recipients<span class="token punctuation">,</span> body<span class="token punctuation">,</span> html<span class="token punctuation">,</span> sender<span class="token punctuation">,</span> cc<span class="token punctuation">,</span> bcc<span class="token punctuation">,</span> reply<span class="token operator">-</span>to<span class="token punctuation">,</span> date<span class="token punctuation">,</span> charset<span class="token punctuation">,</span> extra_headers<span class="token punctuation">,</span> mail_options<span class="token punctuation">,</span>rcpt_options<span class="token punctuation">)</span>
</code></pre> 
<p>Message类方法：</p> 
<ul><li> <p>attach() - 为邮件添加附件。此方法采用以下参数：</p> 
  <ul><li>filename - 要附加的文件的名称</li><li>content_type - MIME类型的文件</li><li>data - 原始文件数据</li><li>处置 - 内容处置（如果有的话）。</li></ul> </li><li> <p>add_recipient() - 向邮件添加另一个收件人</p> </li></ul> 
<p>在下面的示例中，使用QQ邮箱服务的SMTP服务器用作Flask-Mail配置的MAIL_SERVER。</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask
<span class="token keyword">from</span> flask_mail <span class="token keyword">import</span> Mail<span class="token punctuation">,</span> Message

app <span class="token operator">=</span>Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>
mail<span class="token operator">=</span>Mail<span class="token punctuation">(</span>app<span class="token punctuation">)</span>

app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'MAIL_SERVER'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'smtp.qq.com'</span>
app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'MAIL_PORT'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">465</span>
app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'MAIL_USERNAME'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'xxxxx@qq.com'</span>
app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'MAIL_PASSWORD'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'xxxxxxxx'</span>
app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'MAIL_USE_TLS'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">False</span>
app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'MAIL_USE_SSL'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">True</span>
mail <span class="token operator">=</span> Mail<span class="token punctuation">(</span>app<span class="token punctuation">)</span>

@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
   msg <span class="token operator">=</span> Message<span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">,</span> sender <span class="token operator">=</span> <span class="token string">'xxxxx@qq.com'</span><span class="token punctuation">,</span> recipients <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'xxxxx@qq.com'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
   msg<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">"Hello Flask message sent from Flask-Mail"</span>
   mail<span class="token punctuation">.</span>send<span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
   <span class="token keyword">return</span> <span class="token string">"Sent"</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
   app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>debug <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/aa/d2/pGzz9ibc_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="15_Flask_SQLAlchemy_1066"></a>15. Flask SQLAlchemy</h2> 
<p>步骤1 - 安装Flask-SQLAlchemy扩展。</p> 
<pre><code class="prism language-python">pip install flask<span class="token operator">-</span>sqlalchemy
</code></pre> 
<p>步骤2 - 您需要从此模块导入SQLAlchemy类。</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> flask_sqlalchemy <span class="token keyword">import</span> SQLAlchemy
</code></pre> 
<p>步骤3 - 现在创建一个Flask应用程序对象并为要使用的数据库设置URI。</p> 
<pre><code class="prism language-python">app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>
app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'SQLALCHEMY_DATABASE_URI'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'sqlite:///students.sqlite3'</span>
</code></pre> 
<p>步骤4 - 然后使用应用程序对象作为参数创建SQLAlchemy类的对象。该对象包含用于ORM操作的辅助函数。它还提供了一个父Model类，使用它来声明用户定义的模型。在下面的代码段中，创建了students模型。</p> 
<pre><code class="prism language-python">db <span class="token operator">=</span> SQLAlchemy<span class="token punctuation">(</span>app<span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">students</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token builtin">id</span> <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span><span class="token string">'student_id'</span><span class="token punctuation">,</span> db<span class="token punctuation">.</span>Integer<span class="token punctuation">,</span> primary_key <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
   name <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>String<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   city <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>String<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
   addr <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>String<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   pin <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>String<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> city<span class="token punctuation">,</span> addr<span class="token punctuation">,</span>pin<span class="token punctuation">)</span><span class="token punctuation">:</span>
   self<span class="token punctuation">.</span>name <span class="token operator">=</span> name
   self<span class="token punctuation">.</span>city <span class="token operator">=</span> city
   self<span class="token punctuation">.</span>addr <span class="token operator">=</span> addr
   self<span class="token punctuation">.</span>pin <span class="token operator">=</span> pin
</code></pre> 
<p>步骤5 - 要创建/使用URI中提及的数据库，请运行create_all()方法。</p> 
<pre><code class="prism language-python">db<span class="token punctuation">.</span>create_all<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>SQLAlchemy的Session对象管理ORM对象的所有持久性操作。<br> 以下session方法执行CRUD操作：</p> 
<ul><li>db.session.add (模型对象) - 将记录插入到映射表中</li><li>db.session.delete (模型对象) - 从表中删除记录</li><li>model.query.all() - 从表中检索所有记录（对应于SELECT查询）。<br> 您可以通过使用filter属性将过滤器应用于检索到的记录集。例如，要在学生表中检索city ='Hyderabad’的记录，请使用以下语句：</li></ul> 
<pre><code class="prism language-python">Students<span class="token punctuation">.</span>query<span class="token punctuation">.</span>filter_by<span class="token punctuation">(</span>city <span class="token operator">=</span> ’Hyderabad’<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>有了这么多的背景，现在我们将为我们的应用程序提供视图函数来添加学生数据。</p> 
<p>应用程序的入口点是绑定到’/’ URL的show_all()函数。学生表的记录集作为参数发送到HTML模板。模板中的服务器端代码以HTML表格形式呈现记录。</p> 
<pre><code class="prism language-python">@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">show_all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'show_all.html'</span><span class="token punctuation">,</span> students <span class="token operator">=</span> students<span class="token punctuation">.</span>query<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
</code></pre> 
<p>模板（‘show_all.html’）的HTML脚本如下：</p> 
<pre><code class="prism language-html"><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
&lt;html lang = "en"&gt;
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
      
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>
         &lt;a href = "{<!-- -->{ url_for('show_all') }}"&gt;Comments - Flask 
            SQLAlchemy example<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
      
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">/&gt;</span></span>
      {%- for message in get_flashed_messages() %}
         {<!-- -->{ message }}
      {%- endfor %}
		
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>Students (&lt;a href = "{<!-- -->{ url_for('new') }}"&gt;Add Student
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>)<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
      
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>thead</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>Name<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>City<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>Address<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>Pin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>thead</span><span class="token punctuation">&gt;</span></span>
         
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tbody</span><span class="token punctuation">&gt;</span></span>
            {% for student in students %}
               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>{<!-- -->{ student.name }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>{<!-- -->{ student.city }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>{<!-- -->{ student.addr }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>{<!-- -->{ student.pin }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
            {% endfor %}
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tbody</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
      
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>上述网页包含指向’/ new’ URL映射new()函数的超链接。单击时，将打开“学生信息”表单。 数据在 POST方法中发布到相同的URL。<br> new.html</p> 
<pre><code class="prism language-html"><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
   
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>Students - Flask SQLAlchemy example<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">/&gt;</span></span>
      
      {%- for category, message in get_flashed_messages(with_categories = true) %}
         &lt;div class = "alert alert-danger"&gt;
            {<!-- -->{ message }}
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      {%- endfor %}
      
      &lt;form action = "{<!-- -->{ request.path }}" method = "post"&gt;
         &lt;label for = "name"&gt;Name<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
         &lt;input type = "text" name = "name" placeholder = "Name" /&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
         &lt;label for = "email"&gt;City<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
         &lt;input type = "text" name = "city" placeholder = "city" /&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
         &lt;label for = "addr"&gt;addr<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
         &lt;textarea name = "addr" placeholder = "addr"&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>textarea</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
         &lt;label for = "PIN"&gt;PINCODE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
         &lt;input type = "text" name = "pin" placeholder = "pin" /&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
         &lt;input type = "submit" value = "Submit" /&gt;
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
      
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>当http方法被检测为POST时，表单数据被添加到学生表中，并且应用返回到显示添加数据的主页。</p> 
<pre><code class="prism language-python">@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">'/new'</span><span class="token punctuation">,</span> methods <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>
      <span class="token keyword">if</span> <span class="token operator">not</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token operator">or</span> <span class="token operator">not</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'city'</span><span class="token punctuation">]</span> <span class="token operator">or</span> <span class="token operator">not</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'addr'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
         flash<span class="token punctuation">(</span><span class="token string">'Please enter all the fields'</span><span class="token punctuation">,</span> <span class="token string">'error'</span><span class="token punctuation">)</span>
      <span class="token keyword">else</span><span class="token punctuation">:</span>
         student <span class="token operator">=</span> students<span class="token punctuation">(</span>request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'city'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'addr'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'pin'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
         
         db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>add<span class="token punctuation">(</span>student<span class="token punctuation">)</span>
         db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
         
         flash<span class="token punctuation">(</span><span class="token string">'Record was successfully added'</span><span class="token punctuation">)</span>
         <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'show_all'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'new.html'</span><span class="token punctuation">)</span>
</code></pre> 
<p>下面给出了应用程序（app.py）的完整代码。</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request<span class="token punctuation">,</span> flash<span class="token punctuation">,</span> url_for<span class="token punctuation">,</span> redirect<span class="token punctuation">,</span> render_template
<span class="token keyword">from</span> flask_sqlalchemy <span class="token keyword">import</span> SQLAlchemy

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>
app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'SQLALCHEMY_DATABASE_URI'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'sqlite:///students.sqlite3'</span>
app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'SECRET_KEY'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"random string"</span>

db <span class="token operator">=</span> SQLAlchemy<span class="token punctuation">(</span>app<span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">students</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token builtin">id</span> <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span><span class="token string">'student_id'</span><span class="token punctuation">,</span> db<span class="token punctuation">.</span>Integer<span class="token punctuation">,</span> primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    name <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>String<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    city <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>String<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    addr <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>String<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    pin <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>String<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> city<span class="token punctuation">,</span> addr<span class="token punctuation">,</span> pin<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name
        self<span class="token punctuation">.</span>city <span class="token operator">=</span> city
        self<span class="token punctuation">.</span>addr <span class="token operator">=</span> addr
        self<span class="token punctuation">.</span>pin <span class="token operator">=</span> pin


@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">show_all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'show_all.html'</span><span class="token punctuation">,</span> students<span class="token operator">=</span>students<span class="token punctuation">.</span>query<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">'/new'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token operator">not</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token operator">or</span> <span class="token operator">not</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'city'</span><span class="token punctuation">]</span> <span class="token operator">or</span> <span class="token operator">not</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'addr'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            flash<span class="token punctuation">(</span><span class="token string">'Please enter all the fields'</span><span class="token punctuation">,</span> <span class="token string">'error'</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            student <span class="token operator">=</span> students<span class="token punctuation">(</span>request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'city'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                               request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'addr'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'pin'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

            db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>add<span class="token punctuation">(</span>student<span class="token punctuation">)</span>
            db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
            flash<span class="token punctuation">(</span><span class="token string">'Record was successfully added'</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'show_all'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'new.html'</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    db<span class="token punctuation">.</span>create_all<span class="token punctuation">(</span><span class="token punctuation">)</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> 
<p>首页<br> <img src="https://images2.imgbox.com/0d/25/8LBBSiaQ_o.png" alt="在这里插入图片描述"><br> 错误页：<br> <img src="https://images2.imgbox.com/28/16/KmJt3eAW_o.png" alt="在这里插入图片描述"><br> 提交成功页：<br> <img src="https://images2.imgbox.com/6e/79/Z2CWFaJg_o.png" alt="在这里插入图片描述"><br> 本文参考：https://www.w3cschool.cn/flask/</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/79143d6457ca77bf527d28b9169b0ddc/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">SpringMVC运行流程图解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ffc0b4ce391463070429dc4467cab9aa/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">4. 寻找两个正序数组的中位数</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>