<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>开源大数据集群部署（二）集群基础环境实施准备 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="开源大数据集群部署（二）集群基础环境实施准备" />
<meta property="og:description" content="作者：櫰木
环境准备 本次使用到的二进制软件包目录为：系统初始化前提是操作系统已完成安装、各个主机之间网络互通，系统常用命令已安装，本默认这些前提条件已具备，不在阐述。
1 主机环境初始化 安装centos系统完成后需要对主机进行初始化配置和验证工作，在所有主机上（hd1.dtstack.com-hd3）均要进行操作，并按照对应hosts修改主机名：
（主机名必须为xxx.xxx.com 匹配freeipa安装需求）
(1) 主机配置映射(操作权限root)
$ cat&gt;&gt;/etc/hosts &lt;&lt;EOF 172.16.104.226 hd1.dtstack.com 172.16.106.252 hd2.dtstack.com 172.16.107.127 hd3.dtstack.com 172.16.106.165 hd.dtstack.com EOF (2)关闭防火墙&amp;selinux(操作权限root)
$ systemctl stop firewalld $ systemctl disable firewalld $ setenforce 0 &amp;&amp; sed -i &#39;s/SELINUX=enforcing/SELINUX=disabled/g&#39; /etc/selinux/config (3) 创建集群系统用户(操作权限root)
系统用户属组用途hadoophadoophadoop集群用户mysqlhadoopmysql数据库用户hdfshadoophadoop集群用户trinohadooppresto集群用户prometheusprometheus监控平台用户grafanagrafana监控平台用户zookeeperzookeeperzk集群用户hivehadoophive组件用户yarnhadoophadoop集群用户 创建hadoop集群所需用的的用户和用户组
创建示例如下：
[root@hd1.dtstack.com ~]$ remote_op.sh &#34;groupadd hadoo p&#34; [root@hd1.dtstack.com ~]$ remote_op.sh &#34;useradd hive -G hadoop&#34; [root@hd1.dtstack.com ~]$ remote_op.sh &#34;echo hive | passwd --stdin hive&#34; (4)安装java环境(操作权限root)
本次中java软件包安装目录在/root/bigdata
$ cd /opt/bigdata $ tar -zvxf zulu11." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/56a9a043389bb03913e9ae9d9130d63d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-08T14:51:15+08:00" />
<meta property="article:modified_time" content="2024-01-08T14:51:15+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">开源大数据集群部署（二）集群基础环境实施准备</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><em>作者：櫰木</em></p> 
<h3><a id="_1"></a>环境准备</h3> 
<p>本次使用到的二进制软件包目录为：系统初始化前提是操作系统已完成安装、各个主机之间网络互通，系统常用命令已安装，本默认这些前提条件已具备，不在阐述。</p> 
<h4><a id="1__3"></a>1 主机环境初始化</h4> 
<p>安装centos系统完成后需要对主机进行初始化配置和验证工作，在所有主机上（hd1.dtstack.com-hd3）均要进行操作，并按照对应hosts修改主机名：<br> （主机名必须为xxx.xxx.com 匹配freeipa安装需求）<br> (1) 主机配置映射(操作权限root)</p> 
<pre><code class="prism language-powershell">$ <span class="token function">cat</span>&gt;&gt;<span class="token operator">/</span>etc/hosts &lt;&lt;EOF
172<span class="token punctuation">.</span>16<span class="token punctuation">.</span>104<span class="token punctuation">.</span>226 hd1<span class="token punctuation">.</span>dtstack<span class="token punctuation">.</span>com
172<span class="token punctuation">.</span>16<span class="token punctuation">.</span>106<span class="token punctuation">.</span>252 hd2<span class="token punctuation">.</span>dtstack<span class="token punctuation">.</span>com
172<span class="token punctuation">.</span>16<span class="token punctuation">.</span>107<span class="token punctuation">.</span>127 hd3<span class="token punctuation">.</span>dtstack<span class="token punctuation">.</span>com
172<span class="token punctuation">.</span>16<span class="token punctuation">.</span>106<span class="token punctuation">.</span>165 hd<span class="token punctuation">.</span>dtstack<span class="token punctuation">.</span>com
EOF
</code></pre> 
<p>(2)关闭防火墙&amp;selinux(操作权限root)</p> 
<pre><code class="prism language-powershell">$ systemctl stop firewalld
$ systemctl disable firewalld
$ setenforce 0 &amp;&amp; sed <span class="token operator">-</span>i <span class="token string">'s/SELINUX=enforcing/SELINUX=disabled/g'</span> <span class="token operator">/</span>etc/selinux/config
</code></pre> 
<p>(3) 创建集群系统用户(操作权限root)</p> 
<table><thead><tr><th>系统用户</th><th>属组</th><th>用途</th></tr></thead><tbody><tr><td>hadoop</td><td>hadoop</td><td>hadoop集群用户</td></tr><tr><td>mysql</td><td>hadoop</td><td>mysql数据库用户</td></tr><tr><td>hdfs</td><td>hadoop</td><td>hadoop集群用户</td></tr><tr><td>trino</td><td>hadoop</td><td>presto集群用户</td></tr><tr><td>prometheus</td><td>prometheus</td><td>监控平台用户</td></tr><tr><td>grafana</td><td>grafana</td><td>监控平台用户</td></tr><tr><td>zookeeper</td><td>zookeeper</td><td>zk集群用户</td></tr><tr><td>hive</td><td>hadoop</td><td>hive组件用户</td></tr><tr><td>yarn</td><td>hadoop</td><td>hadoop集群用户</td></tr></tbody></table> 
<p>创建hadoop集群所需用的的用户和用户组<br> 创建示例如下：</p> 
<pre><code class="prism language-powershell"><span class="token namespace">[root@hd1.dtstack.com ~]</span>$ remote_op<span class="token punctuation">.</span>sh <span class="token string">"groupadd hadoo p"</span>
<span class="token namespace">[root@hd1.dtstack.com ~]</span>$ remote_op<span class="token punctuation">.</span>sh <span class="token string">"useradd hive -G hadoop"</span>
<span class="token namespace">[root@hd1.dtstack.com ~]</span>$ remote_op<span class="token punctuation">.</span>sh <span class="token string">"echo hive | passwd --stdin hive"</span>
</code></pre> 
<p>(4)安装java环境(操作权限root)<br> 本次中java软件包安装目录在/root/bigdata</p> 
<pre><code class="prism language-powershell">$ cd <span class="token operator">/</span>opt/bigdata
$ tar <span class="token operator">-</span>zvxf zulu11<span class="token punctuation">.</span>60<span class="token punctuation">.</span>19-ca-jdk11<span class="token punctuation">.</span>0<span class="token punctuation">.</span>17-linux_x64<span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz <span class="token operator">-</span>C <span class="token operator">/</span>opt
tar <span class="token operator">-</span>zxvf jdk-8u281-linux-x64<span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz
ln <span class="token operator">-</span>s  <span class="token operator">/</span>opt/jdk1<span class="token punctuation">.</span>8<span class="token punctuation">.</span>0_281  <span class="token operator">/</span>opt/java
</code></pre> 
<h4><a id="2_ssh_50"></a>2 配置ssh互信</h4> 
<p>ssh互信配置（操作权限hadoop）<br> 在集群系统 hd1.dtstack.com-hd3.dtstack.com共3台设备上执行如下命令：</p> 
<pre><code class="prism language-powershell">$ cd <span class="token variable">$HOME</span>  <span class="token comment">#在hadoop当前目录下创建ssh互信</span>
$ ssh-keygen <span class="token operator">-</span>t rsa   <span class="token comment">#一路回车，不需要输入任何信息</span>
</code></pre> 
<p>将hd1.dtstack.com公钥添加到认证文件中，在hd1.dtstack.com主机root用户当前家目录下执行如下命令：<br> 生产各自的keytab文件</p> 
<pre><code class="prism language-powershell">ssh-keygen <span class="token operator">-</span>t rsa
</code></pre> 
<p>用ssh-copy-id 把公钥复制到远程主机上,命令也要（以下命令ip需要填写所有节点ip并在每个节点均执行）</p> 
<pre><code class="prism language-powershell">ssh-<span class="token function">copy-id</span> <span class="token operator">-</span>i  <span class="token punctuation">.</span>ssh/id_rsa<span class="token punctuation">.</span>pub root@xxx<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span>xxx
</code></pre> 
<p>以上命令在三个阶段均要执行</p> 
<p><strong>ssh互信验证</strong><br> hd1.dtstack.com-hd3.dtstack.com主机上互相执行ssh登录命令验证，如下：</p> 
<pre><code class="prism language-powershell"><span class="token namespace">[hadoop@hd1.dtstack.com ~]</span>$ ssh hd2<span class="token punctuation">.</span>dtstack<span class="token punctuation">.</span>com
</code></pre> 
<p>验证截图如下：<br> <img src="https://images2.imgbox.com/f8/e8/tZETjWRB_o.png" alt="在这里插入图片描述"><br> ssh命令执行过去，无报错表示ssh互信配置成功。<br> <strong>root和hdfs以及yarn权限ssh互信</strong><br> 同理操作，配置主机root权限和hdfs以及yarn权限全主机互信。</p> 
<h4><a id="3__79"></a>3 统一环境变量配置</h4> 
<p>环境变量分两个文件：/etc/profile和各用户下.bashrc(bash)，建议/etc/profile根据规划好的目录结构，统一设置环境变量。本次设置将hadoop，zookeeper，hive，java环境变量整体设置完成</p> 
<pre><code class="prism language-powershell"><span class="token namespace">[root@hd1.dtstack.com ~]</span><span class="token comment"># cat &gt;&gt;/etc/profile.d/bigdata.sh&lt;&lt;EOF</span>
<span class="token comment">#!/bin/bash</span>
export HADOOP_HOME=<span class="token operator">/</span>opt/hadoop
export HBASE_HOME=<span class="token operator">/</span>opt/hbase
export SPARK_HOME=<span class="token operator">/</span>opt/spark
export SPARK_CONF_DIR=<span class="token operator">/</span>opt/spark/conf
export HBASE_CONF_DIR=<span class="token operator">/</span>opt/hbase/conf
export HBASE_LIB=<span class="token operator">/</span>opt/hbase/lib
export TEZ_HOME=<span class="token operator">/</span>opt/tez
export TEZ_CONF_DIR=<span class="token operator">/</span>opt/tez/conf
export HADOOP_COMMON_LIB_NATIVE_DIR=$<span class="token punctuation">{<!-- --></span>HADOOP_HOME<span class="token punctuation">}</span><span class="token operator">/</span>lib/native
export HADOOP_CLASSPATH=<span class="token variable">$HADOOP_CLASSPATH</span>:<span class="token variable">$TEZ_HOME</span><span class="token operator">/</span><span class="token operator">*</span>:<span class="token variable">$TEZ_HOME</span><span class="token operator">/</span>lib/<span class="token operator">*</span>
export HADOOP_OPTS=<span class="token string">"-Djava.library.path=${HADOOP_HOME}/lib/native"</span>
export LD_LIBRARY_PATH=<span class="token variable">$HADOOP_HOME</span><span class="token operator">/</span>lib/native
export HADOOP_CONF_DIR=<span class="token operator">/</span>opt/hadoop/etc/hadoop
export HIVE_HOME=<span class="token operator">/</span>opt/hive
export HIVE_CONF_DIR=<span class="token operator">/</span>opt/hive/conf
export PATH=<span class="token variable">$PATH</span>:<span class="token variable">$HIVE_HOME</span><span class="token operator">/</span>bin
export ZK_HOME=<span class="token operator">/</span>opt/zookeeper
<span class="token comment">#export YARN_CONF_DIR=/opt/hadoop/etc/hadoop</span>
export JAVA_HOME=<span class="token string">"/opt/java"</span>
export PATH=<span class="token variable">$HADOOP_HOME</span><span class="token operator">/</span>bin:<span class="token variable">$JAVA_HOME</span><span class="token operator">/</span>bin:<span class="token variable">$ZK_HOME</span><span class="token operator">/</span>bin:<span class="token operator">/</span>opt/mysql/bin:<span class="token variable">$PATH</span>
export HADOOP_CLASSPATH=`hadoop classpath`

EOF
</code></pre> 
<h4><a id="4__109"></a>4 系统调优</h4> 
<p>hd1.dtstack.com-hd3.dtstack.com所有机器上都要执行，且以root权限执行<br> <strong>调整swap、内存分配、网络连接参数</strong></p> 
<pre><code class="prism language-powershell">$ <span class="token function">cat</span>&gt;&gt;<span class="token operator">/</span>etc/sysctl<span class="token punctuation">.</span>conf &lt;&lt;EOF
<span class="token comment">#避免使用swap</span>
vm<span class="token punctuation">.</span>swappiness = 1
<span class="token comment">#修改内存分配策略</span>
vm<span class="token punctuation">.</span>overcommit_memory=2
vm<span class="token punctuation">.</span>overcommit_ratio=90
<span class="token comment">#网络连接上限</span>
net<span class="token punctuation">.</span>core<span class="token punctuation">.</span>somaxcomm=32768
EOF
</code></pre> 
<p><strong>增大同时打开文件描述符</strong></p> 
<pre><code class="prism language-powershell">$ <span class="token function">cat</span>&gt;&gt;<span class="token operator">/</span>etc/security/limits<span class="token punctuation">.</span>conf &lt;&lt;EOF
hadoop  soft   nofile   32768
hadoop hard nofile 65536
hadoop soft   nproc   32768
hadoop hard nproc 65536
EOF
</code></pre> 
<p><strong>关闭THP</strong></p> 
<pre><code class="prism language-powershell">$ <span class="token function">cat</span>&gt;&gt;<span class="token operator">/</span>etc/rc<span class="token punctuation">.</span>local &lt;&lt;EOF
<span class="token keyword">if</span> test <span class="token operator">-</span>f <span class="token operator">/</span>sys/kernel/mm/transparent_hugepage/enabled<span class="token punctuation">;</span> then
   <span class="token function">echo</span> never &gt; <span class="token operator">/</span>sys/kernel/mm/transparent_hugepage/enabled
fi
<span class="token keyword">if</span> test <span class="token operator">-</span>f <span class="token operator">/</span>sys/kernel/mm/transparent_hugepage/defrag<span class="token punctuation">;</span> then
   <span class="token function">echo</span> never &gt; <span class="token operator">/</span>sys/kernel/mm/transparent_hugepage/defrag
fi
EOF
</code></pre> 
<h4><a id="5_NTP_146"></a>5 NTP服务配置</h4> 
<p><strong>安装</strong><br> 在hd1.dtstack.com-hd3.dtstack.com各个主机上root权限下执行：</p> 
<pre><code class="prism language-powershell">$ yum install <span class="token operator">-</span>y ntp
</code></pre> 
<p><em>配置时间同步服务端<br> 在hd1.dtstack.com主机root权限下执行</em><br> <strong>ntp配置</strong></p> 
<pre><code class="prism language-powershell">$ <span class="token function">cat</span> <span class="token operator">/</span>etc/ntp<span class="token punctuation">.</span>conf<span class="token punctuation">|</span>grep <span class="token operator">-</span>v <span class="token string">'#'</span><span class="token punctuation">|</span>grep <span class="token operator">-</span>v ^$
driftfile <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib/ntp/drift     <span class="token comment">#存放记录时间误差</span>
restrict default nomodify notrap nopeer noquery   <span class="token comment">#默认拒绝所有来源访问</span>
restrict 127<span class="token punctuation">.</span>0<span class="token punctuation">.</span>0<span class="token punctuation">.</span>1  <span class="token comment">#开放本机的任何访问</span>
restrict ::1
restrict 172<span class="token punctuation">.</span>16<span class="token punctuation">.</span>104<span class="token punctuation">.</span>0 mask 255<span class="token punctuation">.</span>255<span class="token punctuation">.</span>255<span class="token punctuation">.</span>0 nomodify notrap  <span class="token comment">#允许104网段机器参与ntp同步</span>
includefile <span class="token operator">/</span>etc/ntp/crypto/pw    
keys <span class="token operator">/</span>etc/ntp/keys
server  172<span class="token punctuation">.</span>16<span class="token punctuation">.</span>104<span class="token punctuation">.</span>226    <span class="token comment">#时间同步服务器</span>
server  127<span class="token punctuation">.</span>127<span class="token punctuation">.</span>1<span class="token punctuation">.</span>0       <span class="token comment">#当上面时间不可用时，以本地时间作为时间服务</span>
fudge   127<span class="token punctuation">.</span>0<span class="token punctuation">.</span>0<span class="token punctuation">.</span>1 stratum 10
disable monitor
</code></pre> 
<p>说明：</p> 
<ul><li>server 172.16.104.226表示内网时间同步服务器，其余机器都从这台同步时间</li><li>server 172.16.104.226可以替换成其他时间服务中心IP（看生产环境配置）</li></ul> 
<p><strong>ntp服务启动和验证</strong><br> 启动</p> 
<pre><code class="prism language-powershell">service ntpd <span class="token function">start</span>
</code></pre> 
<p>验证</p> 
<pre><code class="prism language-powershell">service ntpd status
</code></pre> 
<p><img src="https://images2.imgbox.com/d7/ad/COLbQ0D3_o.png" alt="在这里插入图片描述"><br> Active状态为running表示服务启动成功</p> 
<p><em>配置时间同步客户端<br> 在hd2.dtstack.com主机root权限下执行</em></p> 
<p><strong>配置时间同步服务源</strong></p> 
<pre><code class="prism language-powershell"><span class="token namespace">[root@hd2.dtstack.com ~]</span><span class="token comment"># cp /etc/ntp.conf /etc/ntp.conf.bak</span>
<span class="token namespace">[root@hd2.dtstack.com ~]</span><span class="token comment"># cat &gt;/etc/ntp.conf&lt;&lt;EOF</span>
driftfile <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib/ntp/drift
restrict 127<span class="token punctuation">.</span>0<span class="token punctuation">.</span>0<span class="token punctuation">.</span>1
restrict ::1
server 172<span class="token punctuation">.</span>16<span class="token punctuation">.</span>104<span class="token punctuation">.</span>226
restrict 172<span class="token punctuation">.</span>16<span class="token punctuation">.</span>104<span class="token punctuation">.</span>226 nomodify notrap noquery
server  127<span class="token punctuation">.</span>127<span class="token punctuation">.</span>1<span class="token punctuation">.</span>0     <span class="token comment"># local clock</span>
fudge   127<span class="token punctuation">.</span>127<span class="token punctuation">.</span>1<span class="token punctuation">.</span>0 stratum 10
includefile <span class="token operator">/</span>etc/ntp/crypto/pw
keys <span class="token operator">/</span>etc/ntp/keys
EOF
</code></pre> 
<p><strong>手动同步时间(建议第一次手动同步)</strong></p> 
<pre><code class="prism language-powershell">$ ntpdate <span class="token operator">-</span>u 172<span class="token punctuation">.</span>16<span class="token punctuation">.</span>104<span class="token punctuation">.</span>226
</code></pre> 
<p><img src="https://images2.imgbox.com/d8/9c/CKDMFE4m_o.png" alt="在这里插入图片描述"><br> <strong>拉起同步服务</strong></p> 
<pre><code class="prism language-powershell">service ntpd <span class="token function">start</span>
</code></pre> 
<p>检查方法同上<br> <strong>同步到其他节点（hd3.dtstack.com、hd2.dtstack.com）</strong></p> 
<pre><code class="prism language-powershell"><span class="token namespace">[root@hd2.dtstack.com ~]</span><span class="token comment"># scp /etc/ntp.conf root@hd2.dtstack.com:/etc/</span>
</code></pre> 
<p><strong>启动其余主机（hd3.dtstack.com）上ntpd服务</strong></p> 
<pre><code class="prism language-powershell"><span class="token namespace">[root@hd2.dtstack.com ~]</span><span class="token comment"># ssh hd3.dtstack.com 'service ntpd start'</span>
<span class="token namespace">[root@hd2.dtstack.com ~]</span><span class="token comment"># ssh hd2.dtstack.com'service ntpd start'</span>
</code></pre> 
<p><strong>检查其余机器（hd3.dtstack.com）上ntpd服务启动状态</strong></p> 
<pre><code class="prism language-powershell"><span class="token namespace">[root@hd2.dtstack.com ~]</span><span class="token comment"># ssh hd3.dtstack.com 'service ntpd status'</span>
<span class="token namespace">[root@hd2.dtstack.com ~]</span><span class="token comment">#ssh hd2.dtstack.com'service ntpd start''</span>
</code></pre> 
<p><strong>检查连接情况</strong></p> 
<pre><code class="prism language-powershell"><span class="token namespace">[root@hd2.dtstack.com ~]</span><span class="token comment"># ntpq -p</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/3c/12/kDVBXs10_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="6__237"></a>6 自动化同步脚本</h4> 
<p><strong>配置文件同步脚本【1】remote_scp.sh</strong></p> 
<pre><code class="prism language-powershell"><span class="token namespace">[root@hd1.dtstack.com software]</span><span class="token comment"># cat /root/bin/remote_scp.sh</span>
<span class="token comment">#!/bin/bash</span>
<span class="token keyword">for</span> i in hd<span class="token punctuation">{<!-- --></span>2<span class="token punctuation">.</span><span class="token punctuation">.</span>3<span class="token punctuation">}</span>
<span class="token keyword">do</span>
 <span class="token comment">#echo $i</span>
 <span class="token keyword">if</span> <span class="token punctuation">[</span>  <span class="token operator">-</span>d <span class="token variable">$1</span>  <span class="token punctuation">]</span>
then
 <span class="token function">echo</span> <span class="token operator">-</span>e <span class="token string">'\033[33m 当前主机为'</span><span class="token variable">$i</span><span class="token string">',传输文件为'</span><span class="token variable">$1</span><span class="token string">'\033[0m'</span>
 scp <span class="token operator">-</span><span class="token function">rp</span> <span class="token variable">$1</span> <span class="token variable">$i</span>:<span class="token variable">$2</span>
<span class="token keyword">else</span>
 <span class="token comment">#echo "当前节点为$,传输文件为$1"</span>
 <span class="token function">echo</span> <span class="token operator">-</span>e <span class="token string">'\033[33m 当前主机为'</span><span class="token variable">$i</span><span class="token string">',传输文件为'</span><span class="token variable">$1</span><span class="token string">'\033[0m'</span>
 scp <span class="token variable">$1</span> <span class="token variable">$i</span>:<span class="token variable">$2</span>
fi
done
status=`<span class="token function">echo</span> $?`
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$status</span> <span class="token operator">-eq</span> 0 <span class="token punctuation">]</span>
then
 <span class="token function">echo</span> <span class="token operator">-</span>e <span class="token string">"<span class="token variable">$1</span>文件传输完成"</span>
<span class="token keyword">else</span>
 <span class="token function">echo</span> <span class="token operator">-</span>e <span class="token string">"请检查传入参数"</span>
fi
</code></pre> 
<p>使用案例：<br> 格式：remote_scp.sh 源目录 目标目录<br> <img src="https://images2.imgbox.com/69/fd/h2ka8RCg_o.png" alt="在这里插入图片描述"><br> 说明：将test.log 分发到hd1.dtstack.com-hd3.dtstack.com/root目录下<br> <strong>配置文件同步脚本【2】remote_op.sh</strong></p> 
<pre><code class="prism language-powershell"><span class="token namespace">[root@hd1.dtstack.com ~]</span><span class="token comment"># cat /root/bin/remote_op.sh</span>
<span class="token comment">#!/bin/bash</span>
<span class="token keyword">for</span> i in hd2<span class="token punctuation">.</span>dtstack<span class="token punctuation">.</span>com hd3<span class="token punctuation">.</span>dtstack<span class="token punctuation">.</span>com
<span class="token keyword">do</span>
  <span class="token function">echo</span>  <span class="token operator">-</span>e <span class="token string">'\033[33m 当前主机为'</span><span class="token variable">$i</span><span class="token string">'\033[0m'</span>
  ssh <span class="token variable">$i</span> <span class="token variable">$1</span>
done
</code></pre> 
<p>使用案例：<br> 格式：remote_op.sh “执行命令内容”<br> <img src="https://images2.imgbox.com/0f/68/Y8h1ijOD_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="7__283"></a>7 软件包仓库</h4> 
<p>建议在安装hadoop集群前，提前将所需安装的二进制软件包，统一存放软件包仓库中。<br> 本次使用的软件包都在主机hd1.dtstack.com上/root/bigdata下</p> 
<h5><a id="8_keytab_286"></a>8 keytab生成脚本</h5> 
<p>在所有节点均需执行此操作<br> /root/bigdata<br> vi getkeytabs.sh</p> 
<pre><code class="prism language-powershell"><span class="token function">set</span> <span class="token operator">-</span>x
 
CMKEYTAB=<span class="token string">"/data/kerberos/apache-user.keytab"</span>
CMUSER=<span class="token string">"apache-user"</span>
REALM=<span class="token string">"DTSTACK.COM"</span>
IPASERVER=<span class="token string">"hd.dtstack.com"</span>
 
hosts=`hostname`
DEST=<span class="token string">"<span class="token variable">$1</span>"</span>
FULLPRINC=<span class="token string">"<span class="token variable">$2</span>"</span><span class="token operator">/</span>$<span class="token punctuation">{<!-- --></span>hosts<span class="token punctuation">}</span>@$<span class="token punctuation">{<!-- --></span>REALM<span class="token punctuation">}</span>
USER=<span class="token variable">$2</span>
<span class="token comment"># Passwd based kinit</span>
<span class="token comment">#echo PASSWORD | kinit $CMUSER@$REALM</span>
 
<span class="token comment"># Or per keytab (keytab needs to be generated before)</span>
kinit <span class="token operator">-</span>k <span class="token operator">-</span>t <span class="token variable">$CMKEYTAB</span> <span class="token variable">$CMUSER</span>@<span class="token variable">$REALM</span>
 
PRINC=$<span class="token punctuation">(</span> <span class="token function">echo</span> <span class="token variable">$FULLPRINC</span> <span class="token punctuation">|</span> sed <span class="token string">"s/\@<span class="token function">$<span class="token punctuation">(</span> <span class="token function">echo</span> <span class="token variable">$REALM</span> <span class="token punctuation">)</span></span>//"</span> <span class="token punctuation">)</span>
 
<span class="token function">echo</span> <span class="token variable">$PRINC</span>

<span class="token function">echo</span> Retrieving keytab <span class="token keyword">for</span> <span class="token variable">$FULLPRINC</span> <span class="token keyword">for</span> <span class="token variable">$DEST</span>
 
<span class="token function">echo</span> Checking <span class="token keyword">for</span> existing service principle
<span class="token keyword">if</span> ipa service-find <span class="token variable">$FULLPRINC</span><span class="token punctuation">;</span> then
<span class="token function">echo</span> Service principle found
<span class="token keyword">else</span>
<span class="token function">echo</span> Service principle not created<span class="token punctuation">,</span> creating
ipa service-add <span class="token variable">$FULLPRINC</span> <span class="token operator">--</span>pac-<span class="token function">type</span>=NONE
fi
 
<span class="token function">echo</span> Ensuring service allows
ipa service-allow-create-keytab <span class="token operator">--</span>users=<span class="token variable">$CMUSER</span> <span class="token variable">$FULLPRINC</span>
ipa service-allow-retrieve-keytab <span class="token operator">--</span>users=<span class="token variable">$CMUSER</span> <span class="token variable">$FULLPRINC</span>
 
<span class="token keyword">if</span> ipa service-show <span class="token variable">$FULLPRINC</span> <span class="token punctuation">|</span> grep <span class="token string">'Keytab'</span> <span class="token punctuation">|</span> grep <span class="token string">'False'</span><span class="token punctuation">;</span> then
<span class="token function">echo</span> Creating keytab <span class="token keyword">for</span> <span class="token variable">$FULLPRINC</span> <span class="token keyword">for</span> <span class="token variable">$DEST</span>
ipa-getkeytab <span class="token operator">-</span>s <span class="token variable">$IPASERVER</span> <span class="token operator">-</span>p <span class="token variable">$PRINC</span> <span class="token operator">-</span>k <span class="token variable">$DEST</span> <span class="token operator">-</span>e rc4-hmac<span class="token punctuation">,</span>aes256-cts<span class="token punctuation">,</span>aes128-cts
<span class="token keyword">else</span>
<span class="token function">echo</span> Retrieving keytab <span class="token keyword">for</span> <span class="token variable">$FULLPRINC</span> <span class="token keyword">for</span> <span class="token variable">$DEST</span>
ipa-getkeytab <span class="token operator">-</span>r <span class="token operator">-</span>s <span class="token variable">$IPASERVER</span> <span class="token operator">-</span>p <span class="token variable">$PRINC</span> <span class="token operator">-</span>k <span class="token variable">$DEST</span>
fi

chmod 644 <span class="token variable">$DEST</span>
chown <span class="token variable">$USER</span>:<span class="token variable">$USER</span> <span class="token variable">$DEST</span>
 
kdestroy
 
<span class="token keyword">exit</span> 0<span class="token punctuation">;</span>
</code></pre> 
<h3><a id="_343"></a>备注</h3> 
<p>上文中$ 表示系统命令解释器开始符号，且表示所有机器都要执行，如出现[hadoop@hd1.dtstack.com ~]$表示，只在hd1.dtstack.com主机hadoop用户下执行</p> 
<p>更多技术信息请查看云掣官网<a href="https://yunche.pro/?t=yrgw" rel="nofollow">https://yunche.pro/?t=yrgw</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d42ad314e0750ce1950764a21972c991/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">软考考试多少分通过？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/090a60aee79291c9c0fa742bc6d67ddc/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">如何查看崩溃日志</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>