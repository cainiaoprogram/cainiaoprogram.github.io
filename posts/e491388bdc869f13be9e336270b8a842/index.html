<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Haproxy搭建Web群集 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Haproxy搭建Web群集" />
<meta property="og:description" content="目录
一、常见的Web群集调度器
二、Haproxy应用分析
三、Haproxy调度算法原理
四、Haproxy的主要特性
五、Haproxy负载均衡策略
六、LVS、Nginx、Haproxy的区别
七、Haproxy搭建 Web 群集
7.1 haproxy服务器部署
7.2 节点服务器部署
7.3 测试 Web群集
八、日志定义
一、常见的Web群集调度器 常见的Web集群的调度器分为软件和硬件软件通常使用开源的LVS、Haproxy. Nginx LVS性能最好，但是搭建相对复杂; Nginx的upstream模块支持群集功能，但是对群集节点健康检查功能不强，高并发性能没有Haproxy好。 硬件一般使用比较多的是F5，也有很多人使用国内的一些产品，如梭子鱼、绿盟等。
二、Haproxy应用分析 LVS在企业应用中抗负载能力很强，但存在不足
LVS不支持正则处理，不能实现动静分离对于大型网站，LVS的实施配置复杂，维护成本相对较高 Haproxy是一 款可提供高可用性、负载均衡、及基于TCP和HTTP应用的代理的软件
适用于负载大的Web站点运行在硬件上可支持数以万计的并发连接的连接请求 三、Haproxy调度算法原理 Haproxy支持多种调度算法，最常用的有三种
1、RR (Round Robin)
RR算法是最简单最常用的一种算法，即轮询调度
理解举例
有三个节点A、B、C第一个用户访问会被指派到节点A第二个用户访问会被指派到节点B第三个用户访问会被指派到节点C第四个用户访问继续指派到节点A,轮询分配访问请求实现负载均衡效果 Haproxy支持多种调度算法，最常用的有三种
2、LC (Least Connections)
最小连接数算法，根据后端的节点连接数大小动态分配前端请求
理解举例
有三个节点A、B、C,各节点的连接数分别为A:4、B:5、 C:6第一个用户连接请求，会被指派到A上，连接数变为A:5、B:5、 C:6第二个用户请求会继续分配到A上，连接数变为A:6、B:5、 C:6; 再有新的请求会分配给B，每次将新的请求指派给连接数最小的客户端由于实际情况下A、B、C的连接数会动态释放,很难会出现一样连接数的情况此算法相比较r算法有很大改进，是目前用到比较多的一种算法 3、SH (Source Hashing)
基于来源访问调度算法，用于-些有Session会话记录在服务器端的场景，可以基于来源的IP、Cookie等做集群调度
理解举例
有三个节点A、B、C,第一个用户第一次访问被指派到了A,第二个用户第一次 访问被指派到了B当第一个用户第二次访问时会被继续指派到A,第二个用户第二次访问时依旧会被指派到B，只要负载均衡调度器不重启，第一个用户访问却会被指派到A,第二双击可隐藏空白个用户访问都会被指派到B，实现集群的调度此调度算法好处是实现会话保持，但某些IP访问量非常大时会引|起负载不均衡,部分节点访问量超大，影响业务使用 四、Haproxy的主要特性 ●可靠性和稳定性非常好，可以与硬件级的F5负载均衡设备相媲美;
●最高可以同时维护40000-50000个并发连接，单位时间内处理的最大请求数为20000个，最大处理能力可达10Git/s;
●支持多达8种负载均衡算法，同时也支持会话保持;
●支持虚机主机功能，从而实现web负载均衡更加灵活;
●支持连接拒绝、全透明代理等独特的功能;
●拥有强大的ACL支持，用于访问控制;
●其独特的弹性二叉树数据结构，使数据结构的复杂性上升到了0(1)，即数据的查寻速度不会随着数据条目的增加而速度有所下降;
●支持客户端的keepalive功能，减少客户端与haproxy的多次三次握手导致资源浪费，让多个请求在一个tcp连接中完成;
●支持TCP加速，零复制功能，类似于mmap机制;
●支持响应池( response buffering) ;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/e491388bdc869f13be9e336270b8a842/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-02-10T14:43:52+08:00" />
<meta property="article:modified_time" content="2022-02-10T14:43:52+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Haproxy搭建Web群集</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="%E4%B8%80%E3%80%81%E5%B8%B8%E8%A7%81%E7%9A%84Web%E7%BE%A4%E9%9B%86%E8%B0%83%E5%BA%A6%E5%99%A8-toc" style="margin-left:0px;"><a href="#%E4%B8%80%E3%80%81%E5%B8%B8%E8%A7%81%E7%9A%84Web%E7%BE%A4%E9%9B%86%E8%B0%83%E5%BA%A6%E5%99%A8" rel="nofollow">一、常见的Web群集调度器</a></p> 
<p id="%E4%BA%8C%E3%80%81Haproxy%E5%BA%94%E7%94%A8%E5%88%86%E6%9E%90-toc" style="margin-left:0px;"><a href="#%E4%BA%8C%E3%80%81Haproxy%E5%BA%94%E7%94%A8%E5%88%86%E6%9E%90" rel="nofollow">二、Haproxy应用分析</a></p> 
<p id="%E4%B8%89%E3%80%81Haproxy%E8%B0%83%E5%BA%A6%E7%AE%97%E6%B3%95%E5%8E%9F%E7%90%86-toc" style="margin-left:0px;"><a href="#%E4%B8%89%E3%80%81Haproxy%E8%B0%83%E5%BA%A6%E7%AE%97%E6%B3%95%E5%8E%9F%E7%90%86" rel="nofollow">三、Haproxy调度算法原理</a></p> 
<p id="%E5%9B%9B%E3%80%81Haproxy%E7%9A%84%E4%B8%BB%E8%A6%81%E7%89%B9%E6%80%A7-toc" style="margin-left:0px;"><a href="#%E5%9B%9B%E3%80%81Haproxy%E7%9A%84%E4%B8%BB%E8%A6%81%E7%89%B9%E6%80%A7" rel="nofollow">四、Haproxy的主要特性</a></p> 
<p id="%E4%BA%94%E3%80%81Haproxy%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%AD%96%E7%95%A5-toc" style="margin-left:0px;"><a href="#%E4%BA%94%E3%80%81Haproxy%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%AD%96%E7%95%A5" rel="nofollow">五、Haproxy负载均衡策略</a></p> 
<p id="%E5%85%AD%E3%80%81LVS%E3%80%81Nginx%E3%80%81Haproxy%E7%9A%84%E5%8C%BA%E5%88%AB-toc" style="margin-left:0px;"><a href="#%E5%85%AD%E3%80%81LVS%E3%80%81Nginx%E3%80%81Haproxy%E7%9A%84%E5%8C%BA%E5%88%AB" rel="nofollow">六、LVS、Nginx、Haproxy的区别</a></p> 
<p id="%E4%B8%83%E3%80%81Haproxy%E6%90%AD%E5%BB%BA%20Web%20%E7%BE%A4%E9%9B%86-toc" style="margin-left:0px;"><a href="#%E4%B8%83%E3%80%81Haproxy%E6%90%AD%E5%BB%BA%20Web%20%E7%BE%A4%E9%9B%86" rel="nofollow">七、Haproxy搭建 Web 群集</a></p> 
<p id="7.1%20haproxy%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2-toc" style="margin-left:40px;"><a href="#7.1%20haproxy%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2" rel="nofollow">7.1 haproxy服务器部署</a></p> 
<p id="7.2%C2%A0%E8%8A%82%E7%82%B9%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2-toc" style="margin-left:40px;"><a href="#7.2%C2%A0%E8%8A%82%E7%82%B9%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2" rel="nofollow">7.2 节点服务器部署</a></p> 
<p id="7.3%20%E6%B5%8B%E8%AF%95%20Web%E7%BE%A4%E9%9B%86-toc" style="margin-left:40px;"><a href="#7.3%20%E6%B5%8B%E8%AF%95%20Web%E7%BE%A4%E9%9B%86" rel="nofollow">7.3 测试 Web群集</a></p> 
<p id="%E5%85%AB%E3%80%81%E6%97%A5%E5%BF%97%E5%AE%9A%E4%B9%89-toc" style="margin-left:0px;"><a href="#%E5%85%AB%E3%80%81%E6%97%A5%E5%BF%97%E5%AE%9A%E4%B9%89" rel="nofollow">八、日志定义</a></p> 
<hr id="hr-toc"> 
<h2 id="%E4%B8%80%E3%80%81%E5%B8%B8%E8%A7%81%E7%9A%84Web%E7%BE%A4%E9%9B%86%E8%B0%83%E5%BA%A6%E5%99%A8">一、常见的Web群集调度器</h2> 
<ol><li>常见的Web集群的调度器分为软件和硬件</li><li>软件通常使用开源的LVS、Haproxy. Nginx</li></ol> 
<ul><li>LVS性能最好，但是搭建相对复杂; Nginx的upstream模块支持群集功能，但是对群集节点健康检查功能不强，高并发性能没有Haproxy好。</li></ul> 
<p><strong>硬件一般使用比较多的是F5，也有很多人使用国内的一些产品，如梭子鱼、绿盟等。</strong></p> 
<h2 id="%E4%BA%8C%E3%80%81Haproxy%E5%BA%94%E7%94%A8%E5%88%86%E6%9E%90">二、Haproxy应用分析</h2> 
<p><strong>LVS在企业应用中抗负载能力很强，但存在不足</strong></p> 
<ul><li>LVS不支持正则处理，不能实现动静分离</li><li>对于大型网站，LVS的实施配置复杂，维护成本相对较高</li></ul> 
<p><strong>Haproxy是一 款可提供高可用性、负载均衡、及基于TCP和HTTP应用的代理的软件</strong></p> 
<ul><li>适用于负载大的Web站点</li><li>运行在硬件上可支持数以万计的并发连接的连接请求</li></ul> 
<h2 id="%E4%B8%89%E3%80%81Haproxy%E8%B0%83%E5%BA%A6%E7%AE%97%E6%B3%95%E5%8E%9F%E7%90%86">三、Haproxy调度算法原理</h2> 
<p><strong>Haproxy支持多种调度算法，最常用的有三种</strong></p> 
<p><strong>1、RR (Round Robin)</strong></p> 
<p>RR算法是最简单最常用的一种算法，即轮询调度</p> 
<p><strong>理解举例</strong></p> 
<ul><li>有三个节点A、B、C</li><li>第一个用户访问会被指派到节点A</li><li>第二个用户访问会被指派到节点B</li><li>第三个用户访问会被指派到节点C</li><li>第四个用户访问继续指派到节点A,轮询分配访问请求实现负载均衡效果</li></ul> 
<p style="margin-left:.0001pt;text-align:left;"><strong>Haproxy支持多种调度算法，最常用的有三种</strong></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong>2、LC (Least Connections)</strong></p> 
<p style="margin-left:.0001pt;text-align:justify;">最小连接数算法，根据后端的节点连接数大小动态分配前端请求</p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong>理解举例</strong></p> 
<ul><li style="text-align:left;">有三个节点A、B、C,各节点的连接数分别为A:4、B:5、 C:6</li><li style="text-align:left;">第一个用户连接请求，会被指派到A上，连接数变为A:5、B:5、 C:6</li><li style="text-align:left;">第二个用户请求会继续分配到A上，连接数变为A:6、B:5、 C:6; 再有新的请求会分配给B，每次将新的请求指派给连接数最小的客户端</li><li style="text-align:left;">由于实际情况下A、B、C的连接数会动态释放,很难会出现一样连接数的情况</li><li style="text-align:left;">此算法相比较r算法有很大改进，是目前用到比较多的一种算法</li></ul> 
<p style="margin-left:.0001pt;text-align:justify;"><strong>3、SH (Source Hashing)</strong></p> 
<p style="margin-left:.0001pt;text-align:left;">基于来源访问调度算法，用于-些有Session会话记录在服务器端的场景，可以基于来源的IP、Cookie等做集群调度</p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong>理解举例</strong></p> 
<ul><li style="text-align:left;">有三个节点A、B、C,第一个用户第一次访问被指派到了A,第二个用户第一次 访问被指派到了B</li><li style="text-align:left;">当第一个用户第二次访问时会被继续指派到A,第二个用户第二次访问时依旧会被指派到B，只要负载均衡调度器不重启，第一个用户访问却会被指派到A,第二双击可隐藏空白个用户访问都会被指派到B，实现集群的调度</li><li style="text-align:left;">此调度算法好处是实现会话保持，但某些IP访问量非常大时会引|起负载不均衡,部分节点访问量超大，影响业务使用</li></ul> 
<h2 id="%E5%9B%9B%E3%80%81Haproxy%E7%9A%84%E4%B8%BB%E8%A6%81%E7%89%B9%E6%80%A7" style="text-align:left;">四、Haproxy的主要特性</h2> 
<p>●可靠性和稳定性非常好，可以与硬件级的F5负载均衡设备相媲美;<br> ●最高可以同时维护40000-50000个并发连接，单位时间内处理的最大请求数为20000个，最大处理能力可达10Git/s;<br> ●支持多达8种负载均衡算法，同时也支持会话保持;<br> ●支持虚机主机功能，从而实现web负载均衡更加灵活;<br> ●支持连接拒绝、全透明代理等独特的功能;<br> ●拥有强大的ACL支持，用于访问控制;<br> ●其独特的弹性二叉树数据结构，使数据结构的复杂性上升到了0(1)，即数据的查寻速度不会随着数据条目的增加而速度有所下降;<br> ●支持客户端的keepalive功能，减少客户端与haproxy的多次三次握手导致资源浪费，让多个请求在一个tcp连接中完成;<br> ●支持TCP加速，零复制功能，类似于mmap机制;<br> ●支持响应池( response buffering) ;<br> ●支持RDP协议;<br> ●基于源的粘性，类似nginx的ip_hash功能，把来自同一客户端的请求在一定时间内始终调度到上游的同一服务器;<br> ●更好统计数据接口，其web接口显示后端集群中各个服务器的接收、发送、拒绝、错误等数据的统计信息;<br> ●详细的健康状态检测，web接口中有关于对上游服务器的健康检测状态，并提供了一定的管理功能;<br> ●基于流量的健康评估机制;<br> ●基于http认证;<br> ●基于命令行的管理接口;<br> ●日志分析器，可对日志进行分析。</p> 
<h2 id="%E4%BA%94%E3%80%81Haproxy%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%AD%96%E7%95%A5">五、Haproxy负载均衡策略</h2> 
<pre><code>(1) roundrobin, 表示简单的轮询
(2) static-rr, 表示根据权重
(3) leastconn，表示最少连接者先处理
(4) source，表示根据请求源IP
(5) uri，表示根据请求的URI,做cdn需使用
(6) url_param， 表示根据请求的URL参数'balance url_param' requires an URL parameter name
(7) hdr(name)，表示根据HTTP请求头来锁定每一次HTTP请求
(8) rdp-cookie(name)，表示根据据cookie(name)来锁定并哈希每一次TCP请求</code></pre> 
<h2 id="%E5%85%AD%E3%80%81LVS%E3%80%81Nginx%E3%80%81Haproxy%E7%9A%84%E5%8C%BA%E5%88%AB">六、LVS、Nginx、Haproxy的区别</h2> 
<p>●LVS基于Linux操作系统实现软负载均衡，而HAProxy 和Nginx是基于第三方应用实现的软负载均衡;<br> ●LVS是可实现4层的IP负载均衡技术，无法实现基于目录、URL的转发。而HAProxy和Nginx都可以实现4层和7层技术，HAProxy可提供TCP和HTTP应用的负载均衡综合解决方案;<br> ●LVs因为工作在ISO模型的第四层，其状态监测功能单一，而HAProxy在状态监测方面功能更丰富、强大，可支持端口、URL、脚本等多种状态检测方式;<br> ●HAProxy功能强大，但整体性能低于4层模式的LVS负载均衡。<br> ●Nginx主要用于Web服务器或缓存服务器。Nginx的upstream模块虽然也支持群集功能，但是对群集节点健康检查功能不强，性能没有Haproxy好。</p> 
<h2 id="%E4%B8%83%E3%80%81Haproxy%E6%90%AD%E5%BB%BA%20Web%20%E7%BE%A4%E9%9B%86">七、Haproxy搭建 Web 群集</h2> 
<pre><code>Haproxy服务器: 192.168.80.10
Nginx服务器1: 192.168.80.100
Nginx服务器2: 192.168.80.101
客户端: 192.168.80.200</code></pre> 
<h3 id="7.1%20haproxy%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2">7.1 haproxy服务器部署</h3> 
<pre><code>1.关闭防火墙，将安装Haproxy所需软件包传到/opt目录下
systemctl stop firewalld .
setenforce 0

haproxy-1.5.19.tar.gz

2.编译安装Haproxy
yum install -y pcre-devel bzip2-devel gcc gcc-c++ make

tar zxvf haproxy-1.5.19.tar.gz
cd haproxy-1.5.19/
make TARGET=linux2628 ARCH=x86_64
make install</code></pre> 
<pre><code>-------------------------------参数说明-----------------------------------
TARGET=1inux26   #内核版本,
#使用uname -r查看内核，如: 2.6.18-371.e15， 此时该参数用TARGET=linux26; kernel大于2.6.28的用TARGET=linux2628

ARCH=x86_64      #系统位数，64位系统</code></pre> 
<pre><code>3. Haproxy服务器配置
mkdir /etc/haproxy
cp examples/haproxy.cfg /etc/haproxy/

cd /etc/haproxy/
vim haproxy.cfg
global       #全局配置，主要用于定义全局参数，属于进程级的配置，通常和操作系统配置有关
--4~5行--修改，定义haproxy日志输出设置和日志级别，local0为日志设备，默认存放到系统日志
        log /dev/log   local0 info      #修改
        log /dev/log   local0 notice    #修改
        #log loghost   local0 info
        maxconn 4096                    #最大连接数，需考虑ulimit -n限制，推荐使用10240
--8行--注释，chroot运行路径，为该服务自设置的根目录，一般需将此行注释掉
        #chroot /usr/ share/haproxy
		uid 99                          #用户UID
        gid 99                          #用户GID
        daemon                          #守护进程模式
        nbproc 1                        #添加，设置并发进程数，建议与当前服务器CPU核数相等或为其2倍
		
defaults      #配置默认参数，这些参数可以被用到Listen，frontend, backend组 件
        log       global                #引入global定义的日志格式
        mode      http                  #模式为http (7层代理http，4层代理tcp)
        option    httplog               #日志类别为http日志格式
        option    dontlognull           #不记录健康检查日志信息
        retries 3                       #检查节点服务器失败次数，连续达到三次失败，则认为节点不可用
        redispatch                      #当服务器负载很高时，自动结束当前队列处理比较久的连接
        maxconn 2000                    #最大连接数，"defaults"中 的值不能超过"global"段中的定义
        #contimeout 5000                #设置连接超时时间，默认单位是亳秒
        #clitimeout 50000               #设置客户端超时时间，默认单位是亳秒
        #srvtimeout 50000               #设置服务器超时时间，默认单位是毫秒
        timeout http-request 10s        #默认http请求超时时间
        timeout queue 1m                #默认队列超时时间
        timeout connect 10s             #默认连接超时时间，新版本中替代contimeout，该参数向后兼容
        timeout client 1m               #默认客户端超时时间，新版本中替代clitimeout，该参数向后兼容
        timeout server 1m               #默认服务器超时时间，新版本中替代srvtimeout，该参数向后兼容
        timeout http-keep-alive 10s     #默认持久连接超时时间
        timeout check 10s               #设置心跳检查超时时间


--删除下面所有listen项--，添加
listen  webcluster 0.0.0.0:80     #haproxy实例状态监控部分配置，定义一个名为webcluster的应用
        option httpchk GET /test.html     #检查服务器的test.html文件
        balance roundrobin                #负载均衡调度算法使用轮询算法roundrobin
        server inst1 192.168.80.100:80 check inter 2000 fall 3         #定义在线节点
        server inst2 192.168.80.101:80 check inter 2000 fall 3</code></pre> 
<pre><code>-------------------------------------------参数说明-----------------------------------------
balance roundrobin       #负载均衡调度算法
#轮询算法: roundrobin; 最小连接数算法: leastconn; 来源访问调度算法: source，类似于nginx的ip_hash

check inter 2000         #表示启用对此后端服务器执行健康检查，设置健康状态检查的时间间隔，单位为毫秒
fall 3                   #表示连续三次检测不到心跳频率则认为该节点失效
若节点配置后带有“backup”表示该节点只是个备份节点，仅在所有在线节点都失效该节点才启用。不携带“backup”，表示为主节点，和其它在线节点共同提供服务。</code></pre> 
<pre><code>4.添加haproxy 系统服务
cp /opt/haproxy-1.5.19/examples /haproxy.init /etc/init.d/haproxy
chmod +x haproxy
chkconfig --add /etc/init.d/haproxy

ln -s /usr/local/sbin/haproxy /usr/sbin/haproxy
service haproxy start   或  /etc/init.d/haproxy start</code></pre> 
<h3 id="7.2%C2%A0%E8%8A%82%E7%82%B9%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2">7.2 节点服务器部署</h3> 
<pre><code>systemctl stop firewalld
setenforce 0

yum install -y pcre-devel zlib-devel gcc gcc-c++ make

useradd -M -s /sbin/nologin nginx

cd /opt
tar zxvf nginx-1.12.0.tar.gz -C /opt/

cd nginx-1.12.0/
./configure --prefix=/usr/local/nginx --user=nginx --group=nginx &amp;&amp; make G&amp; make install

make &amp;&amp; make install

--192.168.80.100---
echo "this is kgc web" &gt; /usr/local/nginx/html/test.html

--192.168.80.101---
echo "this is benet web" &gt; /usr/local/nginx/html/test.html

ln -s /usr/local/nginx/sbin/nginx /usr/local/sbin/

nginx     #启动nginx 服务
</code></pre> 
<h3 id="7.3%20%E6%B5%8B%E8%AF%95%20Web%E7%BE%A4%E9%9B%86">7.3 测试 Web群集</h3> 
<pre><code>在客户端使用浏览器打开 http://192.168.80.10/test.html , 不断刷新浏览器测试负载均衡效果</code></pre> 
<h2 id="%E5%85%AB%E3%80%81%E6%97%A5%E5%BF%97%E5%AE%9A%E4%B9%89">八、日志定义</h2> 
<pre><code>#默认haproxy的日志是输出到系统的syslog中，查看起来不是非常方便，为了更好的管理haproxy的日志，我们在生产环境中一般单独定义出来。需要将haproxy的info及notice日志分别记录到不同的日志文件中。
vim /etc/haproxy/haproxy.cfg
global
    log /dev/log local0 info
    log /dev/1og local0 notice
	
service haproxy restart

#需要修改rsyslog配置，为了便于管理。将haproxy相关的配 置独立定义到haproxy.conf，并放到/etc/rsyslog.d/下，rsyslog启动时会自动加载此目录下的所有配置文件。
vim /etc/rsyslog.d/haproxy.conf
if ($programname == 'haproxy' and $syslogseverity-text == 'info')
then -/var/log/haproxy/haproxy-info.log
&amp;~
if ($programname == 'haproxy' and $syslogseverity-text == 'notice')
then -/var/log/haproxy/haproxy-notice.log
&amp;~

#说明:
这部分配置是将haproxy的info日志记录到/var/log/haproxy/haproxy-info.log下，将notice 日志记录到/var/log/haproxy/haproxy-notice.log下。“&amp;~”表示当日志写入到日志文件后，rsyslog停止处理这个信息。

systemctl restart rsyslog. service

tail -f /var/log/haproxy/haproxy-info.log         #查看haproxy的访问请求日志信息</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c07cdc7144fd8c6fb774c576cf8d99f9/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Simhash算法详解及python实现</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/07fc6d80abef20b137c2bc796b2dcb52/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">MyBatis-Plus 多表查询</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>