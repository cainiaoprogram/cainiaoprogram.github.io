<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>java多线程使用不当造成的问题 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="java多线程使用不当造成的问题" />
<meta property="og:description" content="下面的thread dump是在CPU使用高的情况下采集的jstack的数据。
&#34;pool-19-thread-50&#34; prio=10 tid=0x00007fd1b8001000 nid=0x11bb2 runnable [0x00007fd41f018000]
java.lang.Thread.State: RUNNABLE
at sun.nio.ch.EPollArrayWrapper.epollWait(Native Method)
at sun.nio.ch.EPollArrayWrapper.poll(EPollArrayWrapper.java:269)
at sun.nio.ch.EPollSelectorImpl.doSelect(EPollSelectorImpl.java:79)
at sun.nio.ch.SelectorImpl.lockAndDoSelect(SelectorImpl.java:87)
- locked &lt;0x0000000790724f88&gt; (a sun.nio.ch.Util$2)
- locked &lt;0x0000000790724f98&gt; (a java.util.Collections$UnmodifiableSet)
- locked &lt;0x0000000790724f40&gt; (a sun.nio.ch.EPollSelectorImpl)
at sun.nio.ch.SelectorImpl.select(SelectorImpl.java:98)
at weblogic.socket.NIOSocketMuxer$NIOInputStream.readInternal(NIOSocketMuxer.java:815)
at weblogic.socket.NIOSocketMuxer$NIOInputStream.read(NIOSocketMuxer.java:759)
at weblogic.socket.NIOSocketMuxer$NIOInputStream.read(NIOSocketMuxer.java:742)
at java.io.BufferedInputStream.fill(BufferedInputStream.java:235)
at java.io.BufferedInputStream.read1(BufferedInputStream.java:275)
at java.io.BufferedInputStream.read(BufferedInputStream.java:334)
- locked &lt;0x00000007aac27988&gt; (a java.io.BufferedInputStream)
at weblogic.net.http.MessageHeader.isHTTP(MessageHeader.java:227)
at weblogic.net.http.MessageHeader.parseHeader(MessageHeader.java:149)
at weblogic.net.http.HttpClient.parseHTTP(HttpClient.java:514)
at weblogic.net.http.HttpURLConnection.getInputStream(HttpURLConnection.java:434)
- locked &lt;0x00000007aac23230&gt; (a weblogic.net.http.SOAPHttpURLConnection)
at weblogic.net.http.SOAPHttpURLConnection.getInputStream(SOAPHttpURLConnection.java:37)
at weblogic." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/6d87dffbfb122ac2e06431096f0be114/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2016-06-06T17:52:13+08:00" />
<meta property="article:modified_time" content="2016-06-06T17:52:13+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">java多线程使用不当造成的问题</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><span style="font-family:SimSun">   下面的thread dump是在CPU使用高的情况下采集的jstack的数据。</span></p> 
<p><span style="font-family:SimSun">"pool-19-thread-50" prio=10 tid=0x00007fd1b8001000 nid=0x11bb2 runnable [0x00007fd41f018000]<br>    java.lang.Thread.State: RUNNABLE<br> <span style="white-space:pre"></span>at sun.nio.ch.EPollArrayWrapper.epollWait(Native Method)<br> <span style="white-space:pre"></span>at sun.nio.ch.EPollArrayWrapper.poll(EPollArrayWrapper.java:269)<br> <span style="white-space:pre"></span>at sun.nio.ch.EPollSelectorImpl.doSelect(EPollSelectorImpl.java:79)<br> <span style="white-space:pre"></span>at sun.nio.ch.SelectorImpl.lockAndDoSelect(SelectorImpl.java:87)<br> <span style="white-space:pre"></span>- locked &lt;0x0000000790724f88&gt; (a sun.nio.ch.Util$2)<br> <span style="white-space:pre"></span>- locked &lt;0x0000000790724f98&gt; (a java.util.Collections$UnmodifiableSet)<br> <span style="white-space:pre"></span>- locked &lt;0x0000000790724f40&gt; (a sun.nio.ch.EPollSelectorImpl)<br> <span style="white-space:pre"></span>at sun.nio.ch.SelectorImpl.select(SelectorImpl.java:98)<br> <span style="white-space:pre"></span>at weblogic.socket.NIOSocketMuxer$NIOInputStream.readInternal(NIOSocketMuxer.java:815)<br> <span style="white-space:pre"></span>at weblogic.socket.NIOSocketMuxer$NIOInputStream.read(NIOSocketMuxer.java:759)<br> <span style="white-space:pre"></span>at weblogic.socket.NIOSocketMuxer$NIOInputStream.read(NIOSocketMuxer.java:742)<br> <span style="white-space:pre"></span>at java.io.BufferedInputStream.fill(BufferedInputStream.java:235)<br> <span style="white-space:pre"></span>at java.io.BufferedInputStream.read1(BufferedInputStream.java:275)<br> <span style="white-space:pre"></span>at java.io.BufferedInputStream.read(BufferedInputStream.java:334)<br> <span style="white-space:pre"></span>- locked &lt;0x00000007aac27988&gt; (a java.io.BufferedInputStream)<br> <span style="white-space:pre"></span>at weblogic.net.http.MessageHeader.isHTTP(MessageHeader.java:227)<br> <span style="white-space:pre"></span>at weblogic.net.http.MessageHeader.parseHeader(MessageHeader.java:149)<br> <span style="white-space:pre"></span>at weblogic.net.http.HttpClient.parseHTTP(HttpClient.java:514)<br> <span style="white-space:pre"></span>at weblogic.net.http.HttpURLConnection.getInputStream(HttpURLConnection.java:434)<br> <span style="white-space:pre"></span>- locked &lt;0x00000007aac23230&gt; (a weblogic.net.http.SOAPHttpURLConnection)<br> <span style="white-space:pre"></span>at weblogic.net.http.SOAPHttpURLConnection.getInputStream(SOAPHttpURLConnection.java:37)<br> <span style="white-space:pre"></span>at weblogic.net.http.HttpURLConnection.getResponseCode(HttpURLConnection.java:1078)<br> <span style="white-space:pre"></span>at org.apache.cxf.transport.http.URLConnectionHTTPConduit$URLConnectionWrappedOutputStream.getResponseCode(URLConnectionHTTPConduit.java:260)<br> <span style="white-space:pre"></span>at org.apache.cxf.transport.http.HTTPConduit$WrappedOutputStream.handleResponseInternal(HTTPConduit.java:1513)<br> <span style="white-space:pre"></span>at org.apache.cxf.transport.http.HTTPConduit$WrappedOutputStream.handleResponse(HTTPConduit.java:1486)<br> <span style="white-space:pre"></span>at org.apache.cxf.transport.http.HTTPConduit$WrappedOutputStream.close(HTTPConduit.java:1305)<br> <span style="white-space:pre"></span>at org.apache.cxf.transport.AbstractConduit.close(AbstractConduit.java:56)<br> <span style="white-space:pre"></span>at org.apache.cxf.transport.http.HTTPConduit.close(HTTPConduit.java:623)<br> <span style="white-space:pre"></span>at org.apache.cxf.interceptor.MessageSenderInterceptor$MessageSenderEndingInterceptor.handleMessage(MessageSenderInterceptor.java:62)<br> <span style="white-space:pre"></span>at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:271)<br> <span style="white-space:pre"></span>- locked &lt;0x00000007aac221c0&gt; (a org.apache.cxf.phase.PhaseInterceptorChain)<br> <span style="white-space:pre"></span>at org.apache.cxf.endpoint.ClientImpl.doInvoke(ClientImpl.java:541)<br> <span style="white-space:pre"></span>at org.apache.cxf.endpoint.ClientImpl.invoke(ClientImpl.java:474)<br> <span style="white-space:pre"></span>at org.apache.cxf.endpoint.ClientImpl.invoke(ClientImpl.java:377)<br> <span style="white-space:pre"></span>at org.apache.cxf.endpoint.ClientImpl.invoke(ClientImpl.java:330)<br> <span style="white-space:pre"></span>at org.apache.cxf.frontend.ClientProxy.invokeSync(ClientProxy.java:96)<br> <span style="white-space:pre"></span>at org.apache.cxf.jaxws.JaxWsClientProxy.invoke(JaxWsClientProxy.java:134)<br> <span style="white-space:pre"></span>at com.sun.proxy.$Proxy270.sendWorkList(Unknown Source)<br> <span style="white-space:pre"></span>at com.comtop.soa.tbi.client.csgii.workcalendar.SOAServicePort_SOAService_Client.sendWorkList(SOAServicePort_SOAService_Client.java:67)<br> <span style="white-space:pre"></span>at com.gg.device.prodplan.plan.facade.internal.WorkCalendarFacade.sendWorkPlanDataToCSG(WorkCalendarFacade.java:176)<br> <span style="white-space:pre"></span>at com.gg.device.prodplan.plan.facade.internal.WorkCalendarFacade$$FastClassByCGLIB$$2a1fd51c.invoke(&lt;generated&gt;)<br> <span style="white-space:pre"></span>at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:204)<br> <span style="white-space:pre"></span>at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:698)<br> <span style="white-space:pre"></span>at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:150)<br> <span style="white-space:pre"></span>at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:80)<br> <span style="white-space:pre"></span>at com.gg.monitor.MonitorAspect.aroundAllMethod(MonitorAspect.java:87)<br> <span style="white-space:pre"></span>at sun.reflect.GeneratedMethodAccessor497.invoke(Unknown Source)<br> <span style="white-space:pre"></span>at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)<br> <span style="white-space:pre"></span>at java.lang.reflect.Method.invoke(Method.java:606)<br> <span style="white-space:pre"></span>at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:621)<br> <span style="white-space:pre"></span>at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:610)<br> <span style="white-space:pre"></span>at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:65)<br> <span style="white-space:pre"></span>at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)<br> <span style="white-space:pre"></span>at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:96)<br> <span style="white-space:pre"></span>at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:260)<br> <span style="white-space:pre"></span>at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:94)<br> <span style="white-space:pre"></span>at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)<br> <span style="white-space:pre"></span>at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:80)<br> <span style="white-space:pre"></span>at com.comtop.sproc.core.exceptionhandler.aop.SprocFacadeExceptionAspect.doAround(SprocFacadeExceptionAspect.java:45)<br> <span style="white-space:pre"></span>at sun.reflect.GeneratedMethodAccessor493.invoke(Unknown Source)<br> <span style="white-space:pre"></span>at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)<br> <span style="white-space:pre"></span>at java.lang.reflect.Method.invoke(Method.java:606)<br> <span style="white-space:pre"></span>at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:621)<br> <span style="white-space:pre"></span>at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:610)<br> <span style="white-space:pre"></span>at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:65)<br> <span style="white-space:pre"></span>at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)<br> <span style="white-space:pre"></span>at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:91)<br> <span style="white-space:pre"></span>at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)<br> <span style="white-space:pre"></span>at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:631)<br> <span style="white-space:pre"></span>at com.gg.device.prodplan.plan.facade.internal.WorkCalendarFacade$$EnhancerByCGLIB$$5dfd8226.sendWorkPlanDataToCSG(&lt;generated&gt;)<br> <span style="white-space:pre"></span>at com.gg.device.prodplan.controller.plan.ProdPlanInfoMulController$1.run(ProdPlanInfoMulController.java:1630)<br> <span style="white-space:pre"></span>at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)<br> <span style="white-space:pre"></span>at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)<br> <span style="white-space:pre"></span>at java.lang.Thread.run(Thread.java:745)<br>    Locked ownable synchronizers:<br> <span style="white-space:pre"></span>- &lt;0x000000073808b5f0&gt; (a java.util.concurrent.ThreadPoolExecutor$Worker)<br> </span></p> 
<p><span style="font-family:SimSun"><span style="font-family:SimSun"><strong>Locked ownable synchronizers:这里值为None，说明当前线程没有处于同步块内，反之在。</strong></span><br> </span></p> 
<p><span style="font-family:SimSun"><strong>查看堆栈代码，是业务代码使用了多线程，生成线程的数量的规则是查看服务器CPU空闲数量生成。而部署的规则是一台服务器上部署了10个节点，如果只是部署一个节点是可以这么干。将线程调整为2个，<span style="font-family:SimSun">调整代码后，</span>有137个下列的线程，只有37个了。</strong></span></p> 
<p><span style="font-family:SimSun"></span></p> 
<p><span style="font-family:SimSun">"pool-19-thread-49" prio=10 tid=0x00007fd2d0001800 nid=0x11b4e waiting on condition [0x00007fd41f11b000]</span></p> 
<span style="font-family:SimSun">   java.lang.Thread.State: WAITING (parking)<br> <span style="white-space:pre"></span>at sun.misc.Unsafe.park(Native Method)<br> <span style="white-space:pre"></span>- parking to wait for  &lt;0x00000006f266ed20&gt; (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)<br> <span style="white-space:pre"></span>at java.util.concurrent.locks.LockSupport.park(LockSupport.java:186)<br> <span style="white-space:pre"></span>at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2043)<br> <span style="white-space:pre"></span>at java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:442)<br> <span style="white-space:pre"></span>at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1068)<br> <span style="white-space:pre"></span>at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1130)<br> <span style="white-space:pre"></span>at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)<br> </span> 
<p><span style="font-family:SimSun"><span style="white-space:pre"></span>at java.lang.Thread.run(Thread.java:745)</span></p> 
<p><span style="font-family:SimSun">   Locked ownable synchronizers:<br> <span style="white-space:pre"></span>- None</span></p> 
<br>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/80864453e2fa6fc993b5ef41d0338ab0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">用python处理MS Word</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1c871ff52d4f0504dcca1dddc832beff/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">oracle提示TNS:无监听程序的解决办法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>