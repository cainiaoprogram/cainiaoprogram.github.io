<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>深度学习算法应用实战 | 利用 CLIP 模型进行“零样本图像分类” - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="深度学习算法应用实战 | 利用 CLIP 模型进行“零样本图像分类”" />
<meta property="og:description" content="文章目录 1. 零样本图像分类简介1.1 什么是零样本图像分类?1.2 通俗一点的解释 2. 模型原理图3. 环境配置4. 代码实战5. Gradio前端页面5.1 什么是 Gradio ? 6 进阶操作7. 总结 1. 零样本图像分类简介 1.1 什么是零样本图像分类? “零样本图像分类”（Zero-shot image classification）指的是使用一个模型对图像进行分类，而这个模型并没有在包含那些特定类别的标记样本的数据上进行过显式训练。
传统的图像分类方法需要在一组特定的带标签的图像上训练模型。这个模型通过学习，将图像的某些特征与标签相对应。当需要使用这种模型来处理引入了新标签集的分类任务时，通常需要进行模型的微调，以适应新的标签。
与此相反，零样本或开放词汇的图像分类模型通常是多模态模型，这些模型在包含大量图像及其相关描述的数据集上进行训练。这些模型学习了视觉和语言之间对齐的表示方法，可以应用于包括零样本图像分类在内的许多下游任务。
这是一种更为灵活的图像分类方法，它允许模型在不需要额外训练数据的情况下，泛化到新的和未见过的类别。同时，它也使用户能够用自由形式的文本描述来查询他们目标对象的图像。
1.2 通俗一点的解释 上面的内容如果看不懂没关系，下面我来用通俗的语言解释这段话：
比如我们想让一个熊孩子能认识不同的图片（比如区分猫和狗），我们需要给这个熊孩子看很多标有“这是猫”、“这是狗”的图片来训练它。这就像是在教熊孩子“这些特征意味着猫，那些特征意味着狗”。但如果突然出现一个新的动物种类，比如浣熊，而熊孩子之前没有学习过浣熊的图片，它就不知道怎么识别了。这时，我们通常需要给熊孩子更多的浣熊图片来训练它识别浣熊。这就是我们上面提到的传统的图像分类。
然而，“零样本图像分类”就像是给熊孩子一种超能力，让它能在没有直接学习过某个类别（比如浣熊）的情况下也能识别出来。这种方式是通过训练熊孩子理解图片和文字之间的关系来实现的。比如，熊孩子在学习的时候不仅看图片，还学习这些图片的描述。这样，当它遇到一个新的图片（比如浣熊），即使它之前没有直接学习过，它也可以通过理解图片的特征和之间学到的文字描述来猜测这可能是“浣熊”。
总的来说，这就是一种更聪明的方式，让熊孩子能够在没有被直接训练识别某些东西的情况下，也能识别出这些东西来。
那这篇博客， 我就教大家使用 CLIP 搭建一个零样本的分类模型！不需要任何的训练就可以实现你的分类需求！
教程使用 huggingface 的 transformers 库来完成，这样方便我对整个专栏的代码教程进行维护，也方便我为大家分发模型（这种多模态的模型一般都很大，自己下载一次很麻烦，我会在博客中提供模型网盘地址）。
2. 模型原理图 论文地址：[paper] Learning Transferable Visual Models From Natural Language Supervision (arxiv.org)
论文摘要：最近，在大量数据上进行模型预训练的自然语言处理领域取得的突破为计算机视觉领域的类似基础模型铺平了道路。这些模型可以通过生成通用视觉特征（即，适用于不同图像分布和任务且无需微调的特征）来大大简化任何系统中图像的使用。本研究表明，如果在来自不同来源的足够多的策划数据上训练，现有的预训练方法，特别是自监督方法，可以产生这样的特征。我们重新审视现有方法，并结合不同技术来扩展我们的预训练，包括数据和模型规模方面。大部分技术贡献旨在加速和稳定大规模训练。在数据方面，我们提出了一个自动化管道，用于构建专用的、多样化的、策划的图像数据集，而不是像自监督文献中通常做的那样使用未策划的数据。在模型方面，我们训练了一个拥有10亿参数的ViT模型，并将其蒸馏成一系列较小的模型，这些模型在大多数图像和像素级基准测试中超过了现有最佳的通用特征，即OpenCLIP。
3. 环境配置 后续所有教程都使用conda环境，请大家自行配置好~
conda create --name huggingface-env python==3.8 -y conda activate huggingface-env pip install transformers 4." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/9f45a53c993b090e81c848449b36dc97/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-10T19:48:47+08:00" />
<meta property="article:modified_time" content="2024-01-10T19:48:47+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">深度学习算法应用实战 | 利用 CLIP 模型进行“零样本图像分类”</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#1__3" rel="nofollow">1. 零样本图像分类简介</a></li><li><ul><li><a href="#11__8" rel="nofollow">1.1 什么是零样本图像分类?</a></li><li><a href="#12__20" rel="nofollow">1.2 通俗一点的解释</a></li></ul> 
   </li><li><a href="#2__38" rel="nofollow">2. 模型原理图</a></li><li><a href="#3__48" rel="nofollow">3. 环境配置</a></li><li><a href="#4__60" rel="nofollow">4. 代码实战</a></li><li><a href="#5_Gradio_120" rel="nofollow">5. Gradio前端页面</a></li><li><ul><li><a href="#51__Gradio__124" rel="nofollow">5.1 什么是 Gradio ?</a></li></ul> 
   </li><li><a href="#6__205" rel="nofollow">6 进阶操作</a></li><li><a href="#7__266" rel="nofollow">7. 总结</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<hr> 
<h3><a id="1__3"></a>1. 零样本图像分类简介</h3> 
<p><img src="https://images2.imgbox.com/dc/25/Vl5nIDkk_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="11__8"></a>1.1 什么是零样本图像分类?</h4> 
<p>“零样本图像分类”（<code>Zero-shot image classification</code>）指的是使用一个模型对图像进行分类，而这个模型并没有在包含那些特定类别的标记样本的数据上进行过显式训练。</p> 
<p>传统的图像分类方法需要在一组特定的带标签的图像上训练模型。这个模型通过学习，将图像的某些特征与标签相对应。当需要使用这种模型来处理引入了新标签集的分类任务时，通常需要进行模型的微调，以适应新的标签。</p> 
<p>与此相反，零样本或开放词汇的图像分类模型通常是多模态模型，这些模型在包含大量图像及其相关描述的数据集上进行训练。这些模型学习了视觉和语言之间对齐的表示方法，可以应用于包括零样本图像分类在内的许多下游任务。</p> 
<p>这是一种更为灵活的图像分类方法，它允许模型在不需要额外训练数据的情况下，泛化到新的和未见过的类别。同时，它也使用户能够用自由形式的文本描述来查询他们目标对象的图像。</p> 
<hr> 
<h4><a id="12__20"></a>1.2 通俗一点的解释</h4> 
<p>上面的内容如果看不懂没关系，下面我来用通俗的语言解释这段话：</p> 
<p>比如我们想让一个熊孩子能认识不同的图片（比如区分猫和狗），我们需要给这个熊孩子看很多标有“这是猫”、“这是狗”的图片来训练它。这就像是在教熊孩子“这些特征意味着猫，那些特征意味着狗”。但如果突然出现一个新的动物种类，比如浣熊，而熊孩子之前没有学习过浣熊的图片，它就不知道怎么识别了。这时，我们通常需要给熊孩子更多的浣熊图片来训练它识别浣熊。这就是我们上面提到的<strong>传统的图像分类</strong>。</p> 
<p>然而，“零样本图像分类”就像是给熊孩子一种超能力，让它能在没有直接学习过某个类别（比如浣熊）的情况下也能识别出来。这种方式是通过训练熊孩子理解图片和文字之间的关系来实现的。比如，熊孩子在学习的时候不仅看图片，还学习这些图片的描述。这样，当它遇到一个新的图片（比如浣熊），即使它之前没有直接学习过，它也可以通过理解图片的特征和之间学到的文字描述来猜测这可能是“浣熊”。</p> 
<p>总的来说，这就是一种更聪明的方式，让熊孩子能够在没有被直接训练识别某些东西的情况下，也能识别出这些东西来。</p> 
<hr> 
<p>那这篇博客， 我就教大家使用 <code>CLIP</code> 搭建一个零样本的分类模型！不需要任何的训练就可以实现你的分类需求！</p> 
<p>教程使用 <code>huggingface</code> 的 <code>transformers</code> 库来完成，这样方便我对整个专栏的代码教程进行维护，也方便我为大家分发模型（这种多模态的模型一般都很大，自己下载一次很麻烦，我会在博客中提供模型网盘地址）。</p> 
<hr> 
<h3><a id="2__38"></a>2. 模型原理图</h3> 
<p><strong>论文地址</strong>：<a href="https://arxiv.org/abs/2103.00020" rel="nofollow">[paper] Learning Transferable Visual Models From Natural Language Supervision (arxiv.org)</a></p> 
<p><strong>论文摘要</strong>：<strong>最近，在大量数据上进行模型预训练的自然语言处理领域取得的突破为计算机视觉领域的类似基础模型铺平了道路。这些模型可以通过生成通用视觉特征（即，适用于不同图像分布和任务且无需微调的特征）来大大简化任何系统中图像的使用。本研究表明，如果在来自不同来源的足够多的策划数据上训练，现有的预训练方法，特别是自监督方法，可以产生这样的特征。我们重新审视现有方法，并结合不同技术来扩展我们的预训练，包括数据和模型规模方面。大部分技术贡献旨在加速和稳定大规模训练。在数据方面，我们提出了一个自动化管道，用于构建专用的、多样化的、策划的图像数据集，而不是像自监督文献中通常做的那样使用未策划的数据。在模型方面，我们训练了一个拥有<code>10</code>亿参数的<code>ViT</code>模型，并将其蒸馏成一系列较小的模型，这些模型在大多数图像和像素级基准测试中超过了现有最佳的通用特征，即<code>OpenCLIP</code>。</strong></p> 
<p><img src="https://images2.imgbox.com/94/86/yXLPfAOz_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<h3><a id="3__48"></a>3. 环境配置</h3> 
<p>后续所有教程都使用<code>conda</code>环境，请大家自行配置好~</p> 
<pre><code class="prism language-bash">conda create <span class="token parameter variable">--name</span> huggingface-env <span class="token assign-left variable">python</span><span class="token operator">==</span><span class="token number">3.8</span> <span class="token parameter variable">-y</span>

conda activate huggingface-env

pip <span class="token function">install</span> transformers
</code></pre> 
<hr> 
<h3><a id="4__60"></a>4. 代码实战</h3> 
<p>本次实战我们选择 <code>openai</code> 团队开源的 <code>clip-vit-base-patch32</code> 版本。借助 <code>transformers</code> 库 ，我们可以通过几行代码就完成一个零样本分类任务。</p> 
<p><strong>下载好我提供的模型后，修改以下两处就可以顺利运行代码:</strong></p> 
<ol><li>将<code>model</code>路径和<code>processor</code>路径指定到你下载下来文件的位置。</li><li><code>image_path</code>路径换成本地图片路径。</li></ol> 
<pre><code class="prism language-python"><span class="token comment"># 导入Python图像库PIL和requests库</span>
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image
<span class="token keyword">import</span> requests

<span class="token comment"># 导入transformers库中的CLIP处理器和CLIP模型</span>
<span class="token keyword">from</span> transformers <span class="token keyword">import</span> CLIPProcessor<span class="token punctuation">,</span> CLIPModel

<span class="token comment"># 从预训练路径加载CLIP模型</span>
model <span class="token operator">=</span> CLIPModel<span class="token punctuation">.</span>from_pretrained<span class="token punctuation">(</span><span class="token string">"/home/models/clip-vit-base-patch32"</span><span class="token punctuation">)</span>
<span class="token comment"># 从预训练路径加载CLIP处理器</span>
processor <span class="token operator">=</span> CLIPProcessor<span class="token punctuation">.</span>from_pretrained<span class="token punctuation">(</span><span class="token string">"/home/models/clip-vit-base-patch32"</span><span class="token punctuation">)</span>

<span class="token comment"># 设置一个图像的路径</span>
image_path <span class="token operator">=</span> <span class="token string">"000000039769.jpg"</span>
<span class="token comment"># 使用PIL的Image打开它</span>
image <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>image_path<span class="token punctuation">)</span>

<span class="token comment"># 使用处理器处理文本（这里有两个文本：猫和狗的照片）和图片，将它们转换为模型可以处理的格式</span>
inputs <span class="token operator">=</span> processor<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"a photo of a cat"</span><span class="token punctuation">,</span> <span class="token string">"a photo of a dog"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> images<span class="token operator">=</span>image<span class="token punctuation">,</span> return_tensors<span class="token operator">=</span><span class="token string">"pt"</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token comment"># 将处理好的输入数据传递给模型并得到输出</span>
outputs <span class="token operator">=</span> model<span class="token punctuation">(</span><span class="token operator">**</span>inputs<span class="token punctuation">)</span>
<span class="token comment"># 从输出中获取图像与文本之间的相似性分数</span>
logits_per_image <span class="token operator">=</span> outputs<span class="token punctuation">.</span>logits_per_image 
<span class="token comment"># 使用softmax函数计算标签的概率</span>
probs <span class="token operator">=</span> logits_per_image<span class="token punctuation">.</span>softmax<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> 
<span class="token comment"># 打印出概率</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>probs<span class="token punctuation">)</span>
<span class="token comment"># tensor([[0.9949, 0.0051]], grad_fn=&lt;SoftmaxBackward0&gt;)</span>
</code></pre> 
<p><strong>模型地址</strong>：</p> 
<blockquote> 
 <p>链接：<a href="https://pan.baidu.com/s/1eg95QBmMOx9P0GvX-pshMg" rel="nofollow">https://pan.baidu.com/s/1eg95QBmMOx9P0GvX-pshMg</a><br> 提取码：hhze</p> 
</blockquote> 
<p><strong>小知识</strong>：</p> 
<p>如果你够细心，你就会发现打印出来的概率后面有一个<code>grad_fn</code>标识。</p> 
<p><code>grad_fn=&lt;SoftmaxBackward0&gt;</code> 是一个表示该张量是通过某个操作产生的，并且这个操作在PyTorch的自动微分系统中具有可微性（即可以进行梯度反向传播）的标识。</p> 
<ul><li><code>tensor([[0.9949, 0.0051]]</code>：这是一个包含概率值的张量。在这个例子中，它表示图片被模型识别为第一个类别（<code>"a photo of a cat"</code>）的概率是<code>99.49%</code>，识别为第二个类别（<code>"a photo of a dog"</code>）的概率是<code>0.51%</code>。</li><li><code>grad_fn</code>：这是<code>"gradient function"</code>的缩写，意味着这个张量是作为一个计算结果产生的，而这个计算是可以进行梯度反向传播的。在这种情况下，<code>&lt;SoftmaxBackward0&gt;</code>是一个特定的梯度函数，它指的是这个张量是通过<code>Softmax</code>函数计算得到的，并且如果需要的话，可以通过这个函数来计算梯度。</li></ul> 
<p>我们这篇内容就是那模型进行推理，所以我们不需要关心这个<code>grad_fn</code>属性。</p> 
<hr> 
<h3><a id="5_Gradio_120"></a>5. Gradio前端页面</h3> 
<p>每次都使用黑洞洞的终端推理图片是不是很无聊呢？下面为大家介绍一个工具，它可以快速的为算法实现一个前端页面，方便我们以图形化的方式推理图片。</p> 
<h4><a id="51__Gradio__124"></a>5.1 什么是 Gradio ?</h4> 
<p><strong>项目地址</strong>：<a href="https://github.com/gradio-app/gradio">gradio-app</a></p> 
<p><strong>文档地址</strong>：<a href="https://www.gradio.app/docs/interface" rel="nofollow">Gradio Interface Docs</a></p> 
<p><code>Gradio</code> 是一个开源库，旨在为机器学习模型提供快速且易于使用的网页界面。它允许开发者和研究人员轻松地为他们的模型创建交互式的演示，使得无论技术背景如何的人都可以方便地试用和理解这些模型。使用<code>Gradio</code>，你只需几行代码就可以生成一个网页应用程序，该应用程序可以接收输入（如图片、文本或音频等），并展示模型的输出。这对于测试、展示和获取模型反馈非常有用，特别是在协作、教育或研究的环境中。此外，它还提供了一系列用于增强用户体验的功能，如输入验证、自定义布局和分析工具，这些都使得<code>Gradio</code>成为机器学习领域中展示和共享模型的受欢迎工具。</p> 
<p>安装方式很简单，一行指令搞定。</p> 
<pre><code class="prism language-bash">pip <span class="token function">install</span> gradio <span class="token parameter variable">-i</span> https://pypi.tuna.tsinghua.edu.cn/simple
</code></pre> 
<p>下面是我基于这个库实现的 <code>CLIP</code> 零样本分类模型页面，同时为大家分别准备了一张猫一张狗的图片，以便大家能够更好地体验和使用这个工具。</p> 
<p><img src="https://images2.imgbox.com/5d/91/Ukk4EKYV_o.png" alt="请添加图片描述"><br> <img src="https://images2.imgbox.com/0e/b2/A2Fxsw7k_o.png" alt="请添加图片描述"></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> gradio <span class="token keyword">as</span> gr
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image
<span class="token keyword">from</span> transformers <span class="token keyword">import</span> CLIPProcessor<span class="token punctuation">,</span> CLIPModel
<span class="token keyword">import</span> torch
<span class="token keyword">import</span> requests

<span class="token comment"># 从预训练的路径中加载CLIP模型和处理器</span>
model <span class="token operator">=</span> CLIPModel<span class="token punctuation">.</span>from_pretrained<span class="token punctuation">(</span>
    <span class="token string">"/home/models/clip-vit-base-patch32"</span>
<span class="token punctuation">)</span>
processor <span class="token operator">=</span> CLIPProcessor<span class="token punctuation">.</span>from_pretrained<span class="token punctuation">(</span>
    <span class="token string">"/home/models/clip-vit-base-patch32"</span>
<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">classify_image_with_text</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 根据逗号分割输入文本，以处理多个标签</span>
    labels <span class="token operator">=</span> text<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span>
    <span class="token comment"># 处理输入数据：将文本和图像转换为模型可以处理的格式</span>
    inputs <span class="token operator">=</span> processor<span class="token punctuation">(</span>text<span class="token operator">=</span>labels<span class="token punctuation">,</span> images<span class="token operator">=</span>image<span class="token punctuation">,</span> return_tensors<span class="token operator">=</span><span class="token string">"pt"</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

    <span class="token comment"># 获取模型的输出</span>
    <span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        outputs <span class="token operator">=</span> model<span class="token punctuation">(</span><span class="token operator">**</span>inputs<span class="token punctuation">)</span>

    <span class="token comment"># 计算概率</span>
    logits_per_image <span class="token operator">=</span> outputs<span class="token punctuation">.</span>logits_per_image  <span class="token comment"># 这是图像与文本之间的相似度分数</span>
    probs <span class="token operator">=</span> logits_per_image<span class="token punctuation">.</span>softmax<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  <span class="token comment"># 用softmax获取标签概率</span>

    <span class="token comment"># 创建一个响应字典，用于输出每个标签的概率</span>
    response <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>label<span class="token punctuation">:</span> prob <span class="token keyword">for</span> label<span class="token punctuation">,</span> prob <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>labels<span class="token punctuation">,</span> probs<span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token keyword">return</span> response


<span class="token comment"># 创建Gradio界面</span>
<span class="token comment"># fn指定了要运行的函数，inputs定义了输入类型，outputs定义了输出类型</span>
iface <span class="token operator">=</span> gr<span class="token punctuation">.</span>Interface<span class="token punctuation">(</span>
    fn<span class="token operator">=</span>classify_image_with_text<span class="token punctuation">,</span>
    inputs<span class="token operator">=</span><span class="token punctuation">[</span>gr<span class="token punctuation">.</span>Image<span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">"pil"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> gr<span class="token punctuation">.</span>Textbox<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">"Text Input"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># 图片和文本框输入</span>
    outputs<span class="token operator">=</span><span class="token string">"json"</span><span class="token punctuation">,</span>  <span class="token comment"># 输出为JSON格式</span>
    examples<span class="token operator">=</span><span class="token punctuation">[</span>
        <span class="token punctuation">[</span>
            <span class="token string">"https://gitee.com/diffiehellman/diffiehellman_personal_blog_gallery/raw/master/cdog.jpg"</span><span class="token punctuation">,</span>
            <span class="token string">"dog, cat, tigers, lions, elephants, pandas, giraffes"</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span>
            <span class="token string">"https://gitee.com/diffiehellman/diffiehellman_personal_blog_gallery/raw/master/ccat.jpg"</span><span class="token punctuation">,</span>
            <span class="token string">"dog, cat, tigers, lions, elephants, pandas, giraffes"</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    title<span class="token operator">=</span><span class="token string">"CLIP零样本图像分类"</span><span class="token punctuation">,</span>
    description<span class="token operator">=</span><span class="token string">"上传一张图片获得json格式的零样本分类结果"</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

<span class="token comment"># 启动界面</span>
iface<span class="token punctuation">.</span>launch<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<hr> 
<h3><a id="6__205"></a>6 进阶操作</h3> 
<p>在我们学习了如何使用 <code>CLIP</code> 之后，接下来我们将利用这些知识来实施一个小型项目。这个项目的目的是通过实际操作来加强大家对 <code>Python</code> 中一些常用库的熟悉程度。</p> 
<p>这一次，我们的项目相对简单：我们将从一个包含猫和狗图片的混合文件夹中，使用我们学习的算法自动区分并归类这两种图片。</p> 
<p>这个案例不仅是一个很好的机器学习入门项目，也是一个非常实用的技能，可以应用于各种图片分类任务，用来清洗个数据集什么的非常的方便~</p> 
<p><strong>算法步骤</strong></p> 
<ol><li><strong>加载模型</strong>：使用<code>transformers</code>库加载预训练的 <code>CLIP</code> 模型和处理器。</li><li><strong>读取图片</strong>：使用 <code>PIL</code> 读取图片。</li><li><strong>图像预处理</strong>：使用 <code>CLIP</code> 的处理器对图片进行预处理。</li><li><strong>模型预测</strong>：对每张处理过的图片使用 <code>CLIP</code> 模型，获取其与“猫”和“狗”文本描述的相似度。</li><li><strong>分类和保存</strong>：根据模型的预测将图片分类为猫或狗，并保存到相应的文件夹。</li></ol> 
<p><strong>使用到的Python库</strong></p> 
<ul><li><strong>PIL（Python Imaging Library）</strong>：一个强大的图像处理库，可用于打开、操作和保存多种图像格式。</li><li><strong>OS</strong>：用于与操作系统进行交互。它提供了丰富的方法来处理文件和文件夹。通过<code>os</code>库可以执行诸如创建、删除、移动文件和目录，以及获取文件属性等操作。</li></ul> 
<pre><code class="prism language-python"><span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image
<span class="token keyword">import</span> requests
<span class="token keyword">from</span> transformers <span class="token keyword">import</span> CLIPProcessor<span class="token punctuation">,</span> CLIPModel
<span class="token keyword">import</span> os

<span class="token comment"># 加载预训练的CLIP模型和处理器</span>
model <span class="token operator">=</span> CLIPModel<span class="token punctuation">.</span>from_pretrained<span class="token punctuation">(</span><span class="token string">"openai/clip-vit-base-patch32"</span><span class="token punctuation">)</span>
processor <span class="token operator">=</span> CLIPProcessor<span class="token punctuation">.</span>from_pretrained<span class="token punctuation">(</span><span class="token string">"openai/clip-vit-base-patch32"</span><span class="token punctuation">)</span>

<span class="token comment"># 定义读取图片的文件夹路径</span>
folder_path <span class="token operator">=</span> <span class="token string">"/path/to/your/folder"</span>

<span class="token comment"># 定义保存分类后图片的路径</span>
save_path_cats <span class="token operator">=</span> <span class="token string">"/path/to/save/cats"</span>
save_path_dogs <span class="token operator">=</span> <span class="token string">"/path/to/save/dogs"</span>

<span class="token comment"># 读取文件夹中的所有图片文件</span>
<span class="token keyword">for</span> filename <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>folder_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> filename<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">".jpg"</span><span class="token punctuation">)</span> <span class="token keyword">or</span> filename<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">".png"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 检查文件格式</span>
        <span class="token comment"># 打开图片</span>
        image <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>folder_path<span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token comment"># 使用处理器处理图片和文本</span>
        inputs <span class="token operator">=</span> processor<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"a photo of a cat"</span><span class="token punctuation">,</span> <span class="token string">"a photo of a dog"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> images<span class="token operator">=</span>image<span class="token punctuation">,</span> return_tensors<span class="token operator">=</span><span class="token string">"pt"</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

        <span class="token comment"># 模型预测</span>
        outputs <span class="token operator">=</span> model<span class="token punctuation">(</span><span class="token operator">**</span>inputs<span class="token punctuation">)</span>
        probs <span class="token operator">=</span> outputs<span class="token punctuation">.</span>logits_per_image<span class="token punctuation">.</span>softmax<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

        <span class="token comment"># 根据预测结果分类图片</span>
        <span class="token keyword">if</span> probs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> probs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span>  <span class="token comment"># 如果“猫”的概率高于“狗”</span>
            image<span class="token punctuation">.</span>save<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>save_path_cats<span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 保存到猫的文件夹</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            image<span class="token punctuation">.</span>save<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>save_path_dogs<span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 保存到狗的文件夹</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"分类完成！"</span><span class="token punctuation">)</span>
</code></pre> 
<hr> 
<h3><a id="7__266"></a>7. 总结</h3> 
<p>这篇教程是我们系列文章的开篇之作。虽然内容相对简单，但我们实现的算法 <code>CLIP</code> 是一个在多模态领域极具影响力的模型。这个经典的模型不仅在本教程中发挥了重要作用，而且在后续的博客中，我们还将继续利用它来实施更多的有趣项目。</p> 
<p>这个系列旨在逐步深入，让大家不仅了解算法的基础知识，还能学习如何将这些算法应用于实际的、有意义的项目中。每一篇教程都是精心设计的，以确保即使是初学者也能够跟上节奏，并逐步提升自己的技能。</p> 
<p>我非常欢迎大家在评论区提出自己遇到的实际任务，或者对特定算法的疑问和讨论。</p> 
<p>感谢大家的支持！</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fd5776eeda39a85a3667de4b5b1e4e3b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">11 个 Python全栈开发工具集</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b7c170a1d424b7c09e0ecd2696587eed/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">iOS 取整函数（四舍五入取整，向上向下取整，取最近整数）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>