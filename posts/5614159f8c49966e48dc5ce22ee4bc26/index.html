<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Vue项目吸顶功能实现---@vueusecore的使用 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Vue项目吸顶功能实现---@vueusecore的使用" />
<meta property="og:description" content="Vue项目吸顶功能实现—@vueuse/core的使用 电商网站的首页内容会比较多，页面比较长，为了能让用户在滚动浏览内容的过程中都能够快速的切换到其它分类。需要分类导航一直可见，所以需要一个吸顶导航的效果。
核心步骤：
目标: 完成头部组件吸顶效果的实现
交互要求
滚动距离大于等于 78 的时候，组件会在顶部固定定位滚动距离小于 78 的时候，组件消失隐藏 实现思路
准备一个吸顶组件，准备一个类名，控制显示隐藏监听页面滚动，判断滚动距离，距离大于 78 添加类名 静态结构 核心代码：
在 Layout/components/下，新建 app-header-sticky.vue 组件 &lt;script setup lang=&#34;ts&#34;&gt; import { RouterLink } from &#34;vue-router&#34;; import AppHeaderNav from &#34;./app-header-nav.vue&#34;; &lt;/script&gt; &lt;template&gt; &lt;div class=&#34;app-header-sticky&#34; :class=&#34;{ show: true }&#34;&gt; &lt;div class=&#34;container&#34;&gt; &lt;RouterLink class=&#34;logo&#34; to=&#34;/&#34; /&gt; &lt;AppHeaderNav /&gt; &lt;div class=&#34;right&#34;&gt; &lt;RouterLink to=&#34;/&#34;&gt;品牌&lt;/RouterLink&gt; &lt;RouterLink to=&#34;/&#34;&gt;专题&lt;/RouterLink&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;/template&gt; &lt;style scoped lang=&#34;less&#34;&gt; .app-header-sticky { width: 100%; height: 80px; position: fixed; left: 0; top: 0; z-index: 999; background-color: #fff; border-bottom: 1px solid #e4e4e4; // 此处为关键样式!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/5614159f8c49966e48dc5ce22ee4bc26/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-08-19T21:53:49+08:00" />
<meta property="article:modified_time" content="2022-08-19T21:53:49+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Vue项目吸顶功能实现---@vueusecore的使用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="Vuevueusecore_0"></a>Vue项目吸顶功能实现—<code>@vueuse/core</code>的使用</h2> 
<h3><a id="_2"></a></h3> 
<blockquote> 
 <p>电商网站的首页内容会比较多，页面比较长，为了能让用户在滚动浏览内容的过程中都能够快速的切换到其它分类。需要分类导航一直可见，所以需要一个吸顶导航的效果。</p> 
</blockquote> 
<p><strong>核心步骤：</strong></p> 
<p><strong>目标:</strong> 完成头部组件吸顶效果的实现</p> 
<p><strong>交互要求</strong></p> 
<ol><li>滚动距离大于等于 78 的时候，组件会在顶部固定定位</li><li>滚动距离小于 78 的时候，组件消失隐藏</li></ol> 
<p><strong>实现思路</strong></p> 
<ol><li>准备一个吸顶组件，准备一个类名，控制显示隐藏</li><li>监听页面滚动，判断滚动距离，距离大于 78 添加类名</li></ol> 
<h4><a id="_20"></a>静态结构</h4> 
<p><strong>核心代码：</strong></p> 
<ul><li>在 <code>Layout/components/</code>下，新建 <code>app-header-sticky.vue</code> 组件</li></ul> 
<pre><code class="prism language-tsx">&lt;script setup lang="ts"&gt;
import { RouterLink } from "vue-router";
import AppHeaderNav from "./app-header-nav.vue";
&lt;/script&gt;

&lt;template&gt;
  &lt;div class="app-header-sticky" :class="{ show: true }"&gt;
    &lt;div class="container"&gt;
      &lt;RouterLink class="logo" to="/" /&gt;
      &lt;AppHeaderNav /&gt;
      &lt;div class="right"&gt;
        &lt;RouterLink to="/"&gt;品牌&lt;/RouterLink&gt;
        &lt;RouterLink to="/"&gt;专题&lt;/RouterLink&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;style scoped lang="less"&gt;
.app-header-sticky {
  width: 100%;
  height: 80px;
  position: fixed;
  left: 0;
  top: 0;
  z-index: 999;
  background-color: #fff;
  border-bottom: 1px solid #e4e4e4;
  // 此处为关键样式!!!
  // 默认情况下完全把自己移动到上面
  transform: translateY(-100%);
  // 完全透明
  opacity: 0;
  // 显示出来的类名
  &amp;.show {
    transition: all 0.3s linear;
    transform: none;
    opacity: 1;
  }
  .container {
    display: flex;
    align-items: center;
  }
  .logo {
    width: 200px;
    height: 80px;
    background: url("@/assets/images/logo.png") no-repeat right 2px;
    background-size: 160px auto;
  }
  .right {
    width: 220px;
    display: flex;
    text-align: center;
    padding-left: 40px;
    border-left: 2px solid @xtxColor;
    a {
      width: 38px;
      margin-right: 40px;
      font-size: 16px;
      line-height: 1;
      &amp;:hover {
        color: @xtxColor;
      }
    }
  }
}
&lt;/style&gt;

</code></pre> 
<ul><li>Layout首页引入吸顶导航组件</li></ul> 
<pre><code class="prism language-diff">&lt;script setup lang="ts"&gt;
import AppTopnav from "./components/app-topnav.vue";
import AppHeader from "./components/app-header.vue";
import AppFooter from "./components/app-footer.vue";
+import AppHeaderSticky from "./components/app-header-sticky.vue";
import useStore from "@/store";
const { home } = useStore();
home.getAllCategory();
&lt;/script&gt;

&lt;template&gt;
  &lt;AppTopnav /&gt;
  &lt;AppHeader /&gt;
+  &lt;AppHeaderSticky /&gt;
+  &lt;main class="app-body"&gt;
+    &lt;!-- 路由出口 --&gt;
+  &lt;/main&gt;
  &lt;AppFooter /&gt;
&lt;/template&gt;

&lt;style lang="less" scoped&gt;
+.app-body {
+  min-height: 600px;
+}
&lt;/style&gt;

</code></pre> 
<h4><a id="_128"></a>吸顶实现</h4> 
<ul><li> <p>在滚动到 <code>78px</code> 完成显示效果（添加类名）</p> 
  <blockquote> 
   <p>通过滚动事件的触发，判断当前是否已经滚动了 <code>78px</code>，如果大于则添加类名，否则移除类名</p> 
   <ol><li><code>document.documentElement.scrollTop</code> 获取滚动距离</li><li><code>:class</code> 动态控制类名显示</li></ol> 
  </blockquote> </li></ul> 
<p>组件<code>src/views/Layout/components/app-header-sticky.vue</code></p> 
<pre><code class="prism language-diff">&lt;script setup lang="ts"&gt;
import { RouterLink } from "vue-router";
import AppHeaderNav from "./app-header-nav.vue";
+import { onMounted, onUnmounted, ref } from "vue";
+// 控制是否显示吸顶组件
+const isShow = ref(false);
+// 考虑优化，组件挂载时绑定事件，组件卸载时移除事件
+const handlerScroll = () =&gt; {
+  const y = document.documentElement.scrollTop;
+  if (y &gt;= 78) {
+    isShow.value = true;
+  } else {
+    isShow.value = false;
+  }
+};
+onMounted(() =&gt; {
+  window.addEventListener("scroll", handlerScroll);
+});
+onUnmounted(() =&gt; {
+  window.removeEventListener("scroll", handlerScroll);
+});
&lt;/script&gt;

&lt;template&gt;
+  &lt;div class="app-header-sticky" :class="{ show: isShow }"&gt;
    // ...
  &lt;/div&gt;
&lt;/template&gt;

</code></pre> 
<h3><a id="_171"></a>吸顶功能-重构</h3> 
<p><strong>目标：</strong> 使用 <code>vueuse/core</code> 重构吸顶功能</p> 
<blockquote> 
 <p><code>vueuse/core</code> : 组合式 <code>API</code> 常用复用逻辑的集合</p> 
 <p>https://vueuse.org/core/useWindowScroll/</p> 
</blockquote> 
<p><strong>核心步骤</strong></p> 
<p>1）安装 <code>@vueuse/core</code> 包，它封装了常见的一些交互逻辑</p> 
<pre><code class="prism language-bash"><span class="token function">yarn</span> <span class="token function">add</span> @vueuse/core
</code></pre> 
<p>2）在吸顶导航中使用</p> 
<p><code>src/components/app-header-sticky.vue</code></p> 
<pre><code class="prism language-vue">&lt;script setup lang="ts"&gt;
import AppHeaderNav from './app-header-nav.vue'
import { useWindowScroll } from '@vueuse/core'
// 控制是否显示吸顶组件
const { y } = useWindowScroll()
&lt;/script&gt;

&lt;template&gt;
  &lt;div class="app-header-sticky" :class="{ show: y &gt;= 78 }"&gt;
     // ...
  &lt;/div&gt;
&lt;/template&gt;
</code></pre> 
<p>常见疑问：</p> 
<ul><li><code>vue2</code> 项目中能使用 <code>@vueuse/core</code> 吗？ 
  <ul><li>可以使用，需配合 <code>@vue/composition-api</code> 让 <code>Vue2</code> 老项目支持 <code>组合式API</code>。</li></ul> </li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/422f8a9fd39384f0d0057ab3254d3830/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">PC获取IP地址异常（DHCP排错）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/362ee7b84aca704edc3b61a78c8d81cd/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">3步实现使用Conda安装本地指定路径下requirement.txt 文件中的包</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>