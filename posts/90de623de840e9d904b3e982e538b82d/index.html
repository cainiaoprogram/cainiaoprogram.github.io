<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>华东验证码——待补充 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="华东验证码——待补充" />
<meta property="og:description" content="1 from selenium import webdriver 2 from selenium.webdriver.support.ui import WebDriverWait # 等待元素加载的 3 from selenium.webdriver.common.action_chains import ActionChains # 拖拽 4 from selenium.webdriver.support import expected_conditions as EC 5 from selenium.common.exceptions import TimeoutException, NoSuchElementException 6 from selenium.webdriver.common.by import By 7 from selenium.webdriver.common.keys import Keys 8 from PIL import Image 9 import requests 10 import time 11 import re 12 import random 13 from io import BytesIO 14 15 16 def merge_image(image_file, location_list): 17 &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/90de623de840e9d904b3e982e538b82d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-09-28T22:39:00+08:00" />
<meta property="article:modified_time" content="2019-09-28T22:39:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">华东验证码——待补充</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div id="cnblogs_post_body" class="blogpost-body"> 
 <div class="cnblogs_code"> 
  <pre><span style="color:#008080;">  1</span> <span style="color:#0000ff;">from</span> selenium <span style="color:#0000ff;">import</span><span style="color:#000000;"> webdriver
</span><span style="color:#008080;">  2</span> <span style="color:#0000ff;">from</span> selenium.webdriver.support.ui <span style="color:#0000ff;">import</span> WebDriverWait  <span style="color:#008000;">#</span><span style="color:#008000;"> 等待元素加载的</span>
<span style="color:#008080;">  3</span> <span style="color:#0000ff;">from</span> selenium.webdriver.common.action_chains <span style="color:#0000ff;">import</span> ActionChains  <span style="color:#008000;">#</span><span style="color:#008000;"> 拖拽</span>
<span style="color:#008080;">  4</span> <span style="color:#0000ff;">from</span> selenium.webdriver.support <span style="color:#0000ff;">import</span><span style="color:#000000;"> expected_conditions as EC
</span><span style="color:#008080;">  5</span> <span style="color:#0000ff;">from</span> selenium.common.exceptions <span style="color:#0000ff;">import</span><span style="color:#000000;"> TimeoutException, NoSuchElementException
</span><span style="color:#008080;">  6</span> <span style="color:#0000ff;">from</span> selenium.webdriver.common.by <span style="color:#0000ff;">import</span><span style="color:#000000;"> By
</span><span style="color:#008080;">  7</span> <span style="color:#0000ff;">from</span> selenium.webdriver.common.keys <span style="color:#0000ff;">import</span><span style="color:#000000;"> Keys
</span><span style="color:#008080;">  8</span> <span style="color:#0000ff;">from</span> PIL <span style="color:#0000ff;">import</span><span style="color:#000000;"> Image
</span><span style="color:#008080;">  9</span> <span style="color:#0000ff;">import</span><span style="color:#000000;"> requests
</span><span style="color:#008080;"> 10</span> <span style="color:#0000ff;">import</span><span style="color:#000000;"> time
</span><span style="color:#008080;"> 11</span> <span style="color:#0000ff;">import</span><span style="color:#000000;"> re
</span><span style="color:#008080;"> 12</span> <span style="color:#0000ff;">import</span><span style="color:#000000;"> random
</span><span style="color:#008080;"> 13</span> <span style="color:#0000ff;">from</span> io <span style="color:#0000ff;">import</span><span style="color:#000000;"> BytesIO
</span><span style="color:#008080;"> 14</span> 
<span style="color:#008080;"> 15</span> 
<span style="color:#008080;"> 16</span> <span style="color:#0000ff;">def</span><span style="color:#000000;"> merge_image(image_file, location_list):
</span><span style="color:#008080;"> 17</span>     <span style="color:#800000;">"""</span>
<span style="color:#008080;"> 18</span> <span style="color:#800000;">     拼接图片
</span><span style="color:#008080;"> 19</span> <span style="color:#800000;">    :param image_file:
</span><span style="color:#008080;"> 20</span> <span style="color:#800000;">    :param location_list:
</span><span style="color:#008080;"> 21</span> <span style="color:#800000;">    :return:
</span><span style="color:#008080;"> 22</span>     <span style="color:#800000;">"""</span>
<span style="color:#008080;"> 23</span>     im =<span style="color:#000000;"> Image.open(image_file)
</span><span style="color:#008080;"> 24</span>     im.save(<span style="color:#800000;">'</span><span style="color:#800000;">code.jpg</span><span style="color:#800000;">'</span><span style="color:#000000;">)
</span><span style="color:#008080;"> 25</span>     new_im = Image.new(<span style="color:#800000;">'</span><span style="color:#800000;">RGB</span><span style="color:#800000;">'</span>, (260, 116<span style="color:#000000;">))
</span><span style="color:#008080;"> 26</span>     <span style="color:#008000;">#</span><span style="color:#008000;"> 把无序的图片 切成52张小图片</span>
<span style="color:#008080;"> 27</span>     im_list_upper =<span style="color:#000000;"> []
</span><span style="color:#008080;"> 28</span>     im_list_down =<span style="color:#000000;"> []
</span><span style="color:#008080;"> 29</span>     <span style="color:#008000;">#</span><span style="color:#008000;"> print(location_list)</span>
<span style="color:#008080;"> 30</span>     <span style="color:#0000ff;">for</span> location <span style="color:#0000ff;">in</span><span style="color:#000000;"> location_list:
</span><span style="color:#008080;"> 31</span>         <span style="color:#008000;">#</span><span style="color:#008000;"> print(location['y'])</span>
<span style="color:#008080;"> 32</span>         <span style="color:#0000ff;">if</span> location[<span style="color:#800000;">'</span><span style="color:#800000;">y</span><span style="color:#800000;">'</span>] == -58:  <span style="color:#008000;">#</span><span style="color:#008000;"> 上半边</span>
<span style="color:#008080;"> 33</span>             im_list_upper.append(im.crop((abs(location[<span style="color:#800000;">'</span><span style="color:#800000;">x</span><span style="color:#800000;">'</span>]), 58, abs(location[<span style="color:#800000;">'</span><span style="color:#800000;">x</span><span style="color:#800000;">'</span>]) + 10, 116<span style="color:#000000;">)))
</span><span style="color:#008080;"> 34</span>         <span style="color:#0000ff;">if</span> location[<span style="color:#800000;">'</span><span style="color:#800000;">y</span><span style="color:#800000;">'</span>] == 0:  <span style="color:#008000;">#</span><span style="color:#008000;"> 下半边</span>
<span style="color:#008080;"> 35</span>             im_list_down.append(im.crop((abs(location[<span style="color:#800000;">'</span><span style="color:#800000;">x</span><span style="color:#800000;">'</span>]), 0, abs(location[<span style="color:#800000;">'</span><span style="color:#800000;">x</span><span style="color:#800000;">'</span>]) + 10, 58<span style="color:#000000;">)))
</span><span style="color:#008080;"> 36</span> 
<span style="color:#008080;"> 37</span>     x_offset =<span style="color:#000000;"> 0
</span><span style="color:#008080;"> 38</span>     <span style="color:#0000ff;">for</span> im <span style="color:#0000ff;">in</span><span style="color:#000000;"> im_list_upper:
</span><span style="color:#008080;"> 39</span>         new_im.paste(im, (x_offset, 0))  <span style="color:#008000;">#</span><span style="color:#008000;"> 把小图片放到 新的空白图片上</span>
<span style="color:#008080;"> 40</span>         x_offset +=<span style="color:#000000;"> im.size[0]
</span><span style="color:#008080;"> 41</span> 
<span style="color:#008080;"> 42</span>     x_offset =<span style="color:#000000;"> 0
</span><span style="color:#008080;"> 43</span>     <span style="color:#0000ff;">for</span> im <span style="color:#0000ff;">in</span><span style="color:#000000;"> im_list_down:
</span><span style="color:#008080;"> 44</span>         new_im.paste(im, (x_offset, 58<span style="color:#000000;">))
</span><span style="color:#008080;"> 45</span>         x_offset +=<span style="color:#000000;"> im.size[0]
</span><span style="color:#008080;"> 46</span>     <span style="color:#0000ff;">return</span><span style="color:#000000;"> new_im
</span><span style="color:#008080;"> 47</span> 
<span style="color:#008080;"> 48</span> 
<span style="color:#008080;"> 49</span> <span style="color:#0000ff;">def</span><span style="color:#000000;"> get_image(driver, div_path):
</span><span style="color:#008080;"> 50</span>     <span style="color:#800000;">'''</span>
<span style="color:#008080;"> 51</span> <span style="color:#800000;">    下载无序的图片  然后进行拼接 获得完整的图片
</span><span style="color:#008080;"> 52</span> <span style="color:#800000;">    :param driver:
</span><span style="color:#008080;"> 53</span> <span style="color:#800000;">    :param div_path:
</span><span style="color:#008080;"> 54</span> <span style="color:#800000;">    :return:
</span><span style="color:#008080;"> 55</span>     <span style="color:#800000;">'''</span>
<span style="color:#008080;"> 56</span>     time.sleep(2<span style="color:#000000;">)
</span><span style="color:#008080;"> 57</span>     background_images =<span style="color:#000000;"> driver.find_elements_by_xpath(div_path)
</span><span style="color:#008080;"> 58</span>     location_list =<span style="color:#000000;"> []
</span><span style="color:#008080;"> 59</span>     <span style="color:#008000;">#</span><span style="color:#008000;"> image_url = ''</span>
<span style="color:#008080;"> 60</span>     <span style="color:#0000ff;">for</span> background_image <span style="color:#0000ff;">in</span><span style="color:#000000;"> background_images:
</span><span style="color:#008080;"> 61</span>         location =<span style="color:#000000;"> {}
</span><span style="color:#008080;"> 62</span>         result = re.findall(<span style="color:#800000;">'</span><span style="color:#800000;">background-image: url\("(.*?)"\); background-position: (.*?)px (.*?)px;</span><span style="color:#800000;">'</span><span style="color:#000000;">,
</span><span style="color:#008080;"> 63</span>                             background_image.get_attribute(<span style="color:#800000;">'</span><span style="color:#800000;">style</span><span style="color:#800000;">'</span><span style="color:#000000;">))
</span><span style="color:#008080;"> 64</span>         <span style="color:#008000;">#</span><span style="color:#008000;"> print(result)</span>
<span style="color:#008080;"> 65</span>         location[<span style="color:#800000;">'</span><span style="color:#800000;">x</span><span style="color:#800000;">'</span>] = int(result[0][1<span style="color:#000000;">])
</span><span style="color:#008080;"> 66</span>         location[<span style="color:#800000;">'</span><span style="color:#800000;">y</span><span style="color:#800000;">'</span>] = int(result[0][2<span style="color:#000000;">])
</span><span style="color:#008080;"> 67</span> 
<span style="color:#008080;"> 68</span>         image_url =<span style="color:#000000;"> result[0][0]
</span><span style="color:#008080;"> 69</span> <span style="color:#000000;">        location_list.append(location)
</span><span style="color:#008080;"> 70</span>     image_url = image_url.replace(<span style="color:#800000;">'</span><span style="color:#800000;">webp</span><span style="color:#800000;">'</span>, <span style="color:#800000;">'</span><span style="color:#800000;">jpg</span><span style="color:#800000;">'</span><span style="color:#000000;">)
</span><span style="color:#008080;"> 71</span>     <span style="color:#008000;">#</span><span style="color:#008000;"> '替换url http://static.geetest.com/pictures/gt/579066de6/579066de6.webp'</span>
<span style="color:#008080;"> 72</span>     image_result =<span style="color:#000000;"> requests.get(image_url).content
</span><span style="color:#008080;"> 73</span>     image_file = BytesIO(image_result)  <span style="color:#008000;">#</span><span style="color:#008000;"> 是一张无序的图片</span>
<span style="color:#008080;"> 74</span>     image =<span style="color:#000000;"> merge_image(image_file, location_list)
</span><span style="color:#008080;"> 75</span> 
<span style="color:#008080;"> 76</span>     <span style="color:#0000ff;">return</span><span style="color:#000000;"> image
</span><span style="color:#008080;"> 77</span> 
<span style="color:#008080;"> 78</span> 
<span style="color:#008080;"> 79</span> <span style="color:#0000ff;">def</span><span style="color:#000000;"> get_track(distance):
</span><span style="color:#008080;"> 80</span>     <span style="color:#800000;">'''</span>
<span style="color:#008080;"> 81</span> <span style="color:#800000;">    拿到移动轨迹，模仿人的滑动行为，先匀加速后匀减速
</span><span style="color:#008080;"> 82</span> <span style="color:#800000;">    匀变速运动基本公式：
</span><span style="color:#008080;"> 83</span> <span style="color:#800000;">    ①v=v0+at
</span><span style="color:#008080;"> 84</span> <span style="color:#800000;">    ②s=v0t+(1/2)at²
</span><span style="color:#008080;"> 85</span> <span style="color:#800000;">    ③v²-v0²=2as
</span><span style="color:#008080;"> 86</span> 
<span style="color:#008080;"> 87</span> <span style="color:#800000;">    :param distance: 需要移动的距离
</span><span style="color:#008080;"> 88</span> <span style="color:#800000;">    :return: 存放每0.2秒移动的距离
</span><span style="color:#008080;"> 89</span>     <span style="color:#800000;">'''</span>
<span style="color:#008080;"> 90</span>     <span style="color:#008000;">#</span><span style="color:#008000;"> 初速度</span>
<span style="color:#008080;"> 91</span>     v =<span style="color:#000000;"> 0
</span><span style="color:#008080;"> 92</span>     <span style="color:#008000;">#</span><span style="color:#008000;"> 单位时间为0.2s来统计轨迹，轨迹即0.2内的位移</span>
<span style="color:#008080;"> 93</span>     t = 0.2
<span style="color:#008080;"> 94</span>     <span style="color:#008000;">#</span><span style="color:#008000;"> 位移/轨迹列表，列表内的一个元素代表0.2s的位移</span>
<span style="color:#008080;"> 95</span>     tracks =<span style="color:#000000;"> []
</span><span style="color:#008080;"> 96</span>     <span style="color:#008000;">#</span><span style="color:#008000;"> 当前的位移</span>
<span style="color:#008080;"> 97</span>     current =<span style="color:#000000;"> 0
</span><span style="color:#008080;"> 98</span>     <span style="color:#008000;">#</span><span style="color:#008000;"> 到达mid值开始减速</span>
<span style="color:#008080;"> 99</span>     mid = distance * 7 / 8
<span style="color:#008080;">100</span> 
<span style="color:#008080;">101</span>     distance += 10  <span style="color:#008000;">#</span><span style="color:#008000;"> 先滑过一点，最后再反着滑动回来</span>
<span style="color:#008080;">102</span>     <span style="color:#008000;">#</span><span style="color:#008000;"> a = random.randint(1,3)</span>
<span style="color:#008080;">103</span>     <span style="color:#0000ff;">while</span> current &lt;<span style="color:#000000;"> distance:
</span><span style="color:#008080;">104</span>         <span style="color:#0000ff;">if</span> current &lt;<span style="color:#000000;"> mid:
</span><span style="color:#008080;">105</span>             <span style="color:#008000;">#</span><span style="color:#008000;"> 加速度越小，单位时间的位移越小,模拟的轨迹就越多越详细</span>
<span style="color:#008080;">106</span>             a = random.randint(2, 4)  <span style="color:#008000;">#</span><span style="color:#008000;"> 加速运动</span>
<span style="color:#008080;">107</span>         <span style="color:#0000ff;">else</span><span style="color:#000000;">:
</span><span style="color:#008080;">108</span>             a = -random.randint(3, 5)  <span style="color:#008000;">#</span><span style="color:#008000;"> 减速运动</span>
<span style="color:#008080;">109</span> 
<span style="color:#008080;">110</span>         <span style="color:#008000;">#</span><span style="color:#008000;"> 初速度</span>
<span style="color:#008080;">111</span>         v0 =<span style="color:#000000;"> v
</span><span style="color:#008080;">112</span>         <span style="color:#008000;">#</span><span style="color:#008000;"> 0.2秒时间内的位移</span>
<span style="color:#008080;">113</span>         s = v0 * t + 0.5 * a * (t ** 2<span style="color:#000000;">)
</span><span style="color:#008080;">114</span>         <span style="color:#008000;">#</span><span style="color:#008000;"> 当前的位置</span>
<span style="color:#008080;">115</span>         current +=<span style="color:#000000;"> s
</span><span style="color:#008080;">116</span>         <span style="color:#008000;">#</span><span style="color:#008000;"> 添加到轨迹列表</span>
<span style="color:#008080;">117</span> <span style="color:#000000;">        tracks.append(round(s))
</span><span style="color:#008080;">118</span> 
<span style="color:#008080;">119</span>         <span style="color:#008000;">#</span><span style="color:#008000;"> 速度已经达到v,该速度作为下次的初速度</span>
<span style="color:#008080;">120</span>         v = v0 + a *<span style="color:#000000;"> t
</span><span style="color:#008080;">121</span> 
<span style="color:#008080;">122</span>     <span style="color:#008000;">#</span><span style="color:#008000;"> 反着滑动到大概准确位置</span>
<span style="color:#008080;">123</span>     <span style="color:#0000ff;">for</span> i <span style="color:#0000ff;">in</span> range(4<span style="color:#000000;">):
</span><span style="color:#008080;">124</span>         tracks.append(-random.randint(2, 3<span style="color:#000000;">))
</span><span style="color:#008080;">125</span>     <span style="color:#0000ff;">for</span> i <span style="color:#0000ff;">in</span> range(4<span style="color:#000000;">):
</span><span style="color:#008080;">126</span>         tracks.append(-random.randint(1, 3<span style="color:#000000;">))
</span><span style="color:#008080;">127</span>     <span style="color:#0000ff;">return</span><span style="color:#000000;"> tracks
</span><span style="color:#008080;">128</span> 
<span style="color:#008080;">129</span> 
<span style="color:#008080;">130</span> <span style="color:#0000ff;">def</span><span style="color:#000000;"> get_distance(image1, image2):
</span><span style="color:#008080;">131</span>     <span style="color:#800000;">'''</span>
<span style="color:#008080;">132</span> <span style="color:#800000;">      拿到滑动验证码需要移动的距离
</span><span style="color:#008080;">133</span> <span style="color:#800000;">      :param image1:没有缺口的图片对象
</span><span style="color:#008080;">134</span> <span style="color:#800000;">      :param image2:带缺口的图片对象
</span><span style="color:#008080;">135</span> <span style="color:#800000;">      :return:需要移动的距离
</span><span style="color:#008080;">136</span>       <span style="color:#800000;">'''</span>
<span style="color:#008080;">137</span>     <span style="color:#008000;">#</span><span style="color:#008000;"> print('size', image1.size)</span>
<span style="color:#008080;">138</span> 
<span style="color:#008080;">139</span>     threshold = 50
<span style="color:#008080;">140</span>     <span style="color:#0000ff;">for</span> i <span style="color:#0000ff;">in</span> range(0, image1.size[0]):  <span style="color:#008000;">#</span><span style="color:#008000;"> 260</span>
<span style="color:#008080;">141</span>         <span style="color:#0000ff;">for</span> j <span style="color:#0000ff;">in</span> range(0, image1.size[1]):  <span style="color:#008000;">#</span><span style="color:#008000;"> 160</span>
<span style="color:#008080;">142</span>             pixel1 =<span style="color:#000000;"> image1.getpixel((i, j))
</span><span style="color:#008080;">143</span>             pixel2 =<span style="color:#000000;"> image2.getpixel((i, j))
</span><span style="color:#008080;">144</span>             res_R = abs(pixel1[0] - pixel2[0])  <span style="color:#008000;">#</span><span style="color:#008000;"> 计算RGB差</span>
<span style="color:#008080;">145</span>             res_G = abs(pixel1[1] - pixel2[1])  <span style="color:#008000;">#</span><span style="color:#008000;"> 计算RGB差</span>
<span style="color:#008080;">146</span>             res_B = abs(pixel1[2] - pixel2[2])  <span style="color:#008000;">#</span><span style="color:#008000;"> 计算RGB差</span>
<span style="color:#008080;">147</span>             <span style="color:#0000ff;">if</span> res_R &gt; threshold <span style="color:#0000ff;">and</span> res_G &gt; threshold <span style="color:#0000ff;">and</span> res_B &gt;<span style="color:#000000;"> threshold:
</span><span style="color:#008080;">148</span>                 <span style="color:#0000ff;">return</span> i  <span style="color:#008000;">#</span><span style="color:#008000;"> 需要移动的距离</span>
<span style="color:#008080;">149</span> 
<span style="color:#008080;">150</span> 
<span style="color:#008080;">151</span> <span style="color:#0000ff;">def</span><span style="color:#000000;"> main_check_code(driver, element):
</span><span style="color:#008080;">152</span>     <span style="color:#800000;">"""</span>
<span style="color:#008080;">153</span> <span style="color:#800000;">     拖动识别验证码
</span><span style="color:#008080;">154</span> <span style="color:#800000;">    :param driver:
</span><span style="color:#008080;">155</span> <span style="color:#800000;">    :param element:
</span><span style="color:#008080;">156</span> <span style="color:#800000;">    :return:
</span><span style="color:#008080;">157</span>     <span style="color:#800000;">"""</span>
<span style="color:#008080;">158</span>     image1 = get_image(driver, <span style="color:#800000;">'</span><span style="color:#800000;">//div[@class="gt_cut_bg gt_show"]/div</span><span style="color:#800000;">'</span><span style="color:#000000;">)
</span><span style="color:#008080;">159</span>     image2 = get_image(driver, <span style="color:#800000;">'</span><span style="color:#800000;">//div[@class="gt_cut_fullbg gt_show"]/div</span><span style="color:#800000;">'</span><span style="color:#000000;">)
</span><span style="color:#008080;">160</span>     <span style="color:#008000;">#</span><span style="color:#008000;"> 图片上 缺口的位置的x坐标</span>
<span style="color:#008080;">161</span> 
<span style="color:#008080;">162</span>     <span style="color:#008000;">#</span><span style="color:#008000;"> 2 对比两张图片的所有RBG像素点，得到不一样像素点的x值，即要移动的距离</span>
<span style="color:#008080;">163</span>     l =<span style="color:#000000;"> get_distance(image1, image2)
</span><span style="color:#008080;">164</span>     <span style="color:#008000;">#</span><span style="color:#008000;"> 3 获得移动轨迹</span>
<span style="color:#008080;">165</span>     track_list =<span style="color:#000000;"> get_track(l)
</span><span style="color:#008080;">166</span>     <span style="color:#0000ff;">print</span>(<span style="color:#800000;">'</span><span style="color:#800000;">第一步,点击滑动按钮</span><span style="color:#800000;">'</span><span style="color:#000000;">)
</span><span style="color:#008080;">167</span>     ActionChains(driver).click_and_hold(on_element=element).perform()  <span style="color:#008000;">#</span><span style="color:#008000;"> 点击鼠标左键，按住不放</span>
<span style="color:#008080;">168</span>     <span style="color:#0000ff;">print</span>(<span style="color:#800000;">'</span><span style="color:#800000;">第二步,拖动元素</span><span style="color:#800000;">'</span><span style="color:#000000;">)
</span><span style="color:#008080;">169</span>     <span style="color:#0000ff;">for</span> track <span style="color:#0000ff;">in</span><span style="color:#000000;"> track_list:
</span><span style="color:#008080;">170</span>         ActionChains(driver).move_by_offset(xoffset=track, yoffset=0).perform()  <span style="color:#008000;">#</span><span style="color:#008000;"> 鼠标移动到距离当前位置（x,y）</span>
<span style="color:#008080;">171</span>         time.sleep(0.002<span style="color:#000000;">)
</span><span style="color:#008080;">172</span> 
<span style="color:#008080;">173</span>     ActionChains(driver).move_by_offset(xoffset=-random.randint(2, 5), yoffset=<span style="color:#000000;">0).perform()
</span><span style="color:#008080;">174</span>     <span style="color:#0000ff;">print</span>(<span style="color:#800000;">'</span><span style="color:#800000;">第三步,释放鼠标</span><span style="color:#800000;">'</span><span style="color:#000000;">)
</span><span style="color:#008080;">175</span>     ActionChains(driver).release(on_element=<span style="color:#000000;">element).perform()
</span><span style="color:#008080;">176</span>     time.sleep(1<span style="color:#000000;">)
</span><span style="color:#008080;">177</span> 
<span style="color:#008080;">178</span> 
<span style="color:#008080;">179</span> <span style="color:#0000ff;">def</span><span style="color:#000000;"> main_check_slider(driver):
</span><span style="color:#008080;">180</span>     <span style="color:#800000;">"""</span>
<span style="color:#008080;">181</span> <span style="color:#800000;">    检查滑动按钮是否加载
</span><span style="color:#008080;">182</span> <span style="color:#800000;">    :param driver:
</span><span style="color:#008080;">183</span> <span style="color:#800000;">    :return:
</span><span style="color:#008080;">184</span>     <span style="color:#800000;">"""</span>
<span style="color:#008080;">185</span>     <span style="color:#0000ff;">while</span><span style="color:#000000;"> True:
</span><span style="color:#008080;">186</span>         <span style="color:#0000ff;">try</span><span style="color:#000000;">:
</span><span style="color:#008080;">187</span>             <span style="color:#008000;">#</span><span style="color:#008000;"> driver.get('http://117.71.57.99:9080/online/')</span>
<span style="color:#008080;">188</span>             <span style="color:#008000;">#</span><span style="color:#008000;"> driver.maximize_window()</span>
<span style="color:#008080;">189</span>             <span style="color:#008000;">#</span><span style="color:#008000;"> login_button = WebDriverWait(driver, 10, 0.5).until(</span>
<span style="color:#008080;">190</span>             <span style="color:#008000;">#</span><span style="color:#008000;">     EC.presence_of_element_located((By.XPATH, "//h3[contains(text(),'登录')]")))</span>
<span style="color:#008080;">191</span>             <span style="color:#008000;">#</span><span style="color:#008000;"> login_button.click()</span>
<span style="color:#008080;">192</span>             <span style="color:#008000;">#</span><span style="color:#008000;"> username = driver.find_element_by_id('accountCode')</span>
<span style="color:#008080;">193</span>             <span style="color:#008000;">#</span><span style="color:#008000;"> pwd = driver.find_element_by_id('accountPass')</span>
<span style="color:#008080;">194</span>             <span style="color:#008000;">#</span><span style="color:#008000;"> username.clear()</span>
<span style="color:#008080;">195</span>             <span style="color:#008000;">#</span><span style="color:#008000;"> username.send_keys('ahzy')</span>
<span style="color:#008080;">196</span>             <span style="color:#008000;">#</span><span style="color:#008000;"> time.sleep(1)</span>
<span style="color:#008080;">197</span>             <span style="color:#008000;">#</span><span style="color:#008000;"> pwd.clear()</span>
<span style="color:#008080;">198</span>             <span style="color:#008000;">#</span><span style="color:#008000;"> pwd.send_keys('ahzy3445810')</span>
<span style="color:#008080;">199</span>             <span style="color:#008000;">#</span><span style="color:#008000;"> pwd.send_keys(Keys.ENTER)</span>
<span style="color:#008080;">200</span>             <span style="color:#008000;">#</span><span style="color:#008000;"> time.sleep(2)</span>
<span style="color:#008080;">201</span>             driver.get(<span style="color:#800000;">'</span><span style="color:#800000;">http://117.71.57.99:9080/online/</span><span style="color:#800000;">'</span><span style="color:#000000;">)
</span><span style="color:#008080;">202</span>             driver.implicitly_wait(1<span style="color:#000000;">)
</span><span style="color:#008080;">203</span> <span style="color:#000000;">            driver.maximize_window()
</span><span style="color:#008080;">204</span>             driver.get(<span style="color:#800000;">'</span><span style="color:#800000;">http://117.71.57.99:9080/online/roomResource.xp?action=showResource</span><span style="color:#800000;">'</span><span style="color:#000000;">)
</span><span style="color:#008080;">205</span>             <span style="color:#008000;">#</span><span style="color:#008000;"> 2、点击按钮，得到没有缺口的图片</span>
<span style="color:#008080;">206</span>             element = WebDriverWait(driver, 10, 0.5<span style="color:#000000;">).until(
</span><span style="color:#008080;">207</span>                 EC.presence_of_element_located((By.XPATH, <span style="color:#800000;">'</span><span style="color:#800000;">//div/div[@class="gt_slider_knob gt_show"]</span><span style="color:#800000;">'</span><span style="color:#000000;">)))
</span><span style="color:#008080;">208</span>             <span style="color:#0000ff;">if</span><span style="color:#000000;"> element:
</span><span style="color:#008080;">209</span>                 <span style="color:#0000ff;">return</span><span style="color:#000000;"> element
</span><span style="color:#008080;">210</span>         <span style="color:#0000ff;">except</span><span style="color:#000000;"> TimeoutException as e:
</span><span style="color:#008080;">211</span>             <span style="color:#0000ff;">print</span>(<span style="color:#800000;">'</span><span style="color:#800000;">超时错误，继续</span><span style="color:#800000;">'</span><span style="color:#000000;">)
</span><span style="color:#008080;">212</span>             time.sleep(5<span style="color:#000000;">)
</span><span style="color:#008080;">213</span> 
<span style="color:#008080;">214</span> 
<span style="color:#008080;">215</span> <span style="color:#0000ff;">if</span> <span style="color:#800080;">__name__</span> == <span style="color:#800000;">'</span><span style="color:#800000;">__main__</span><span style="color:#800000;">'</span><span style="color:#000000;">:
</span><span style="color:#008080;">216</span>     <span style="color:#0000ff;">try</span><span style="color:#000000;">:
</span><span style="color:#008080;">217</span>         count = 6  <span style="color:#008000;">#</span><span style="color:#008000;"> 最多识别6次</span>
<span style="color:#008080;">218</span>         driver =<span style="color:#000000;"> webdriver.Chrome()
</span><span style="color:#008080;">219</span>         <span style="color:#008000;">#</span><span style="color:#008000;"> 等待滑动按钮加载完成</span>
<span style="color:#008080;">220</span>         element =<span style="color:#000000;"> main_check_slider(driver)
</span><span style="color:#008080;">221</span>         <span style="color:#0000ff;">while</span> count &gt;<span style="color:#000000;"> 0:
</span><span style="color:#008080;">222</span> <span style="color:#000000;">            main_check_code(driver, element)
</span><span style="color:#008080;">223</span>             <span style="color:#0000ff;">try</span><span style="color:#000000;">:
</span><span style="color:#008080;">224</span>                 success_element = (By.CSS_SELECTOR, <span style="color:#800000;">'</span><span style="color:#800000;">.gt_holder .gt_ajax_tip.gt_success</span><span style="color:#800000;">'</span><span style="color:#000000;">)
</span><span style="color:#008080;">225</span>                 <span style="color:#008000;">#</span><span style="color:#008000;"> 得到成功标志</span>
<span style="color:#008080;">226</span>                 success_images = WebDriverWait(driver, 20<span style="color:#000000;">).until(EC.presence_of_element_located(success_element))
</span><span style="color:#008080;">227</span>                 <span style="color:#0000ff;">if</span><span style="color:#000000;"> success_images:
</span><span style="color:#008080;">228</span>                     <span style="color:#0000ff;">print</span>(<span style="color:#800000;">'</span><span style="color:#800000;">成功识别！！！！！！</span><span style="color:#800000;">'</span><span style="color:#000000;">)
</span><span style="color:#008080;">229</span>                     count =<span style="color:#000000;"> 0
</span><span style="color:#008080;">230</span>                     <span style="color:#0000ff;">break</span>
<span style="color:#008080;">231</span>             <span style="color:#0000ff;">except</span><span style="color:#000000;"> NoSuchElementException as e:
</span><span style="color:#008080;">232</span>                 <span style="color:#0000ff;">print</span>(<span style="color:#800000;">'</span><span style="color:#800000;">识别错误，继续</span><span style="color:#800000;">'</span><span style="color:#000000;">)
</span><span style="color:#008080;">233</span>                 count -= 1
<span style="color:#008080;">234</span>         <span style="color:#0000ff;">else</span><span style="color:#000000;">:
</span><span style="color:#008080;">235</span>             <span style="color:#0000ff;">print</span>(<span style="color:#800000;">'</span><span style="color:#800000;">too many attempt check code </span><span style="color:#800000;">'</span><span style="color:#000000;">)
</span><span style="color:#008080;">236</span>             exit(<span style="color:#800000;">'</span><span style="color:#800000;">退出程序</span><span style="color:#800000;">'</span><span style="color:#000000;">)
</span><span style="color:#008080;">237</span>     <span style="color:#0000ff;">finally</span><span style="color:#000000;">:
</span><span style="color:#008080;">238</span>         driver.close()</pre> 
 </div> 
 <p> </p> 
</div> 
<p>转载于:https://www.cnblogs.com/wjlv/p/11605291.html</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7bacbd7b67d592da70ebd9aa02c7596b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Qt 错误：collect2:ld returned 1 exit status</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f6aabcb58c4b57e6437654c5e4e28c27/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">centos7 安装 bugfree3</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>