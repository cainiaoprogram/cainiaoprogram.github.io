<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>MySql表分区的创建与使用 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="MySql表分区的创建与使用" />
<meta property="og:description" content="一、创建表分区 MySql默认是支持表分区的，可以通过语句查询是否开启表分区功能：show plugins ；
创建表分区只需要在创建表的语句后面加上分区语句就可以，例如：
create table user(id int(11) not null,name varchar(32) not null) --正常的创建语句 partition by range(id) --根据表字段id来创建分区 ( partition p0 values less than(10), --第一个分区p0，范围~-9 partition p1 values less than(20), --第二个分区p1，范围10-19 partition p2 values less than(30), --第三个分区p2，范围20-29 partition p3 values less than maxvalue --第四个分区p2，范围30-~ ) --需要注意的是分区字段“id”的取值范围等于分区取值范围 数据存储文件将根据分区被拆分成多份：*.ibd , .frm文件是表格式文件：
新增几条数据后查询可以看到数据已经分散在不同的分区中：
二、表分区的类型 1、RANGE表分区：范围表分区，按照一定的范围值来确定每个分区包含的数据，如上使用的就是range表分区；
partition by range(id) partition p0 values less than()
分区函数使用的字段必须是整数类型（bit, int ,tinyint,bigint等），分区的定义范围必须是连续的，且不能重叠，使用values less than()来定义分区范围，从小到大定义范围。
给分区字段赋值的时候分区字段取值范围不能超过values less than()的取值范围。使用values less than maxvalue来将未来不确定的值放到这个表分区中。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/2d3bcd300913b2b6b9f4e4f39ebba49f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-11-20T18:08:58+08:00" />
<meta property="article:modified_time" content="2019-11-20T18:08:58+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">MySql表分区的创建与使用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h4>一、创建表分区</h4> 
<p>MySql默认是支持表分区的，可以通过语句查询是否开启表分区功能：show plugins ；</p> 
<p></p> 
<p> </p> 
<p style="text-align:center;"><img alt="" class="has" height="36" src="https://images2.imgbox.com/83/ef/Y1ufsU35_o.png" width="593"></p> 
<p>创建表分区只需要在创建表的语句后面加上分区语句就可以，例如：</p> 
<pre class="has"><code class="language-sql">create table user(id int(11) not null,name varchar(32) not null)  --正常的创建语句
partition by range(id)   --根据表字段id来创建分区
(
  partition p0 values less than(10),       --第一个分区p0，范围~-9
  partition p1 values less than(20),       --第二个分区p1，范围10-19
  partition p2 values less than(30),       --第三个分区p2，范围20-29
  partition p3 values less than maxvalue   --第四个分区p2，范围30-~
) --需要注意的是分区字段“id”的取值范围等于分区取值范围
</code></pre> 
<p> </p> 
<p style="text-align:center;"><img alt="" class="has" src="https://images2.imgbox.com/82/19/yo5kkRfP_o.png"></p> 
<p>数据存储文件将根据分区被拆分成多份：*.ibd , .frm文件是表格式文件：</p> 
<p style="text-align:center;"><img alt="" class="has" height="48" src="https://images2.imgbox.com/d2/d8/LbcpO0Tn_o.png" width="547"></p> 
<p>新增几条数据后查询可以看到数据已经分散在不同的分区中：</p> 
<p style="text-align:center;"><img alt="" class="has" height="338" src="https://images2.imgbox.com/cc/e5/0qg1ISZH_o.png" width="336"></p> 
<h4>二、表分区的类型 </h4> 
<p><strong>1、RANGE表分区：</strong>范围表分区，按照一定的范围值来确定每个分区包含的数据，如上使用的就是range表分区；</p> 
<p style="text-indent:33px;">partition by range(id)          partition p0 values less than()</p> 
<p style="text-indent:33px;">分区函数使用的字段必须是<strong>整数类型</strong>（bit, int ,tinyint,bigint等），分区的定义范围必须是连续的，且不能重叠，使用values less than()来定义分区范围，从小到大定义范围。</p> 
<p style="text-indent:33px;">给分区字段赋值的时候分区字段取值范围不能超过values less than()的取值范围。使用values less than maxvalue来将未来不确定的值放到这个表分区中。</p> 
<p style="text-indent:33px;">按<strong>时间类型(datetime)</strong>来做表分区可以在RANGE()中使用函数来做转换，例如：partition by range(year(create_time)),timestamp可以使用unix_timestamp('2019-11-20 00:00:00')转化。</p> 
<p><strong>2、LIST表分区：</strong>列表表分区，按照一个一个确定的值来确定每个分区包含的数据</p> 
<p style="text-indent:33px;">partition by list(id)         partition p0 values in(1,2,3)</p> 
<p style="text-indent:33px;">分区字段必须是整数类型或者分区函数返回整数，取值范围通过values in()来定义。不能使用maxvalue。</p> 
<p style="text-indent:33px;"> create table user4(sex int(1)) partition by list(sex) (partition p0 values in(1),partition p1 values in(2));</p> 
<p><strong>3、HASH表分区：</strong>哈希表分区，按照一个自定义的函数返回值来确定每个分区包含的数据</p> 
<p style="text-indent:33px;">partition by hash(id)        partitions 4</p> 
<p style="text-indent:33px;">根据hash算法来分配到分区中，以上设置四个分区，并根据id%4进行取模运算，根据余数插入到指定的分区中。</p> 
<p style="text-indent:33px;">create table user7(id int)  partition by hash(id) partitions 3;</p> 
<p><strong>4、KEY表分区：</strong>key表分区，与哈希表分区类似，只是用MySql自己的HASH函数来确定每个分区包含的数据；</p> 
<p style="text-indent:33px;">partition by key()        partitions 4</p> 
<p style="text-indent:33px;">key()括号里面可以包含0个或多个字段（不必是整数类型，可以是普通字段），如果表中有主键或者唯一键，所引用的字段必须是主键或者主键的一部分。如果没有写字段，默认使用主键，如果表中没有主键，则使用唯一键，但唯一键必须设置为not null。</p> 
<p><strong>5、多字段分区(range、list)：</strong>可以指定多个字段作为分区字段；以下以多字段range作为讲解：</p> 
<p style="text-indent:33px;">例如：partition by range columns(id,name) </p> 
<p style="text-indent:33px;">多字段分区可以使用非整数类型来作为分区字段。使用这个特性可以用来创建<strong>单字段的非整数类型</strong>的表分区。</p> 
<p style="text-indent:33px;">对比方式从左到右，第一个字段值小于第一个字段分区值则放在第一个分区，等于或大于第一个字段分区值则对比第二个字段值与第一个字段分区值的大小，以此类推。</p> 
<p style="text-indent:33px;">create table user6(sex varchar(10),name varchar(10),age varchar(10)) partition by range columns(sex,name,age) (partition p0 values less than('d','f','h'),partition p1 values less than('l','n','x'));</p> 
<p style="text-indent:33px;">先比较sex字段，再比较name字段，最后比较age字段。使用select ('a','b')&lt;('b','c')来验证</p> 
<h4>三、创建表分区的约束条件</h4> 
<p>1、如果表有主键（primary key）或者唯一键(unique key)，分区字段必须被包含于主键和唯一键字段的交集部分。</p> 
<p>错误的例子： </p> 
<p style="text-align:center;"><img alt="" class="has" height="66" src="https://images2.imgbox.com/ad/20/0MQncJoA_o.png" width="949"></p> 
<p>正确的例子：</p> 
<p><img alt="" class="has" height="72" src="https://images2.imgbox.com/d6/c6/bVcIhssU_o.png" width="1103"> <img alt="" class="has" height="77" src="https://images2.imgbox.com/2a/50/R7T4iLHn_o.png" width="1127"></p> 
<p> </p> 
<h4>三、表分区的使用</h4> 
<p>1、使用分区字段"id"做查询的时候只查询id所处的分区，否则查询所有分区：</p> 
<p style="text-align:center;"><img alt="" class="has" src="https://images2.imgbox.com/75/a1/Iwrr1R6C_o.png"></p> 
<p></p> 
<h4>四、表分区的主要优点 </h4> 
<p>          1、可以允许在一个表里存储更多的数据，突破磁盘限制和文件系统限制。</p> 
<p>          2、对于从表里删除过期的历史数据比较容易，只需要移除对应的分区。</p> 
<p>          3、对于某些查询或修改语句，可以自动将数据范围缩小到一个至几个分区上，优化语句执行效率。</p> 
<p>          </p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3f29de5bfe41b063c2d4c8b010b8f606/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Python struct使用简介</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6ba23bd6b986c4c54952d6b736728201/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">TensorFlow学习- GPU显存占满而利用率（util）很低原因&amp;提高方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>