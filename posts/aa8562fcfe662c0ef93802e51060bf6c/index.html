<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【游戏开发小技】Unity中实现Dota里的角色技能地面贴花效果（URP | ShaderGraph | Decal） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【游戏开发小技】Unity中实现Dota里的角色技能地面贴花效果（URP | ShaderGraph | Decal）" />
<meta property="og:description" content="本文最终效果
文章目录 一、前言二、环境准备1、URP环境准备2、技能范围图案 二、方案一：写Shader实现1、Shader脚本：UrpDecal.shader2、材质球3、创建Cube4、地面场景5、添加Renderer Feature: Decal6、移动DecalCube，与地面交叉7、运行效果 三、方案二：使用URP Decal Projector1、添加Renderer Feature: Decal2、创建Decal Shader Graph3、材质球4、空物体挂 URPDecalProjector组件4、设置组件参数5、运行效果 四、工程源码五、完毕 一、前言 嗨，大家好，我是新发。
我平时偶尔会打打Dota2，在Dota里面，技能释放前会有一个地面贴花效果来作为范围的显示，比如深渊领主的这个技能，如下
我们可以看到技能范围特效是可以投射到场景地面和物体上（比如树木），这个在Unity中如何去实现呢？本文我以URP渲染管线为例，讲一下这个技能地面贴花效果的制作过程吧~
注：本文我使用的Unity版本为2021.3.1f1c1，Universal RP版本为12.1.6
二、环境准备 1、URP环境准备 首先通过PackageManager安装Universal RP，在Project窗口中右键鼠标，点击菜单Create / Rendering / URP Asset (with Universal Renderer)，
此时会创建出两个文件，如下
打开Project Settings窗口，点击Graphics，把Uinversal Render Pipeline Asset文件拖给Scriptable Render Pipeline Settings，如下
2、技能范围图案 接着我们去找一张技能范围的图案，我找了一张这样的，
接下来就是具体的实现过程了。有两个方案，下面我分别给大家讲解一下。
二、方案一：写Shader实现 1、Shader脚本：UrpDecal.shader 我在GitHub上看到有个外国小哥写了个URP渲染管线的贴花Shader，
GitHub地址：https://github.com/ColinLeung-NiloCat/UnityURPUnlitScreenSpaceDecalShader
我给他的Shader添加了中文注释，方便大家阅读，如下
// see README here: // github.com/ColinLeung-NiloCat/UnityURPUnlitScreenSpaceDecalShader Shader &#34;Universal Render Pipeline/NiloCat Extension/Screen Space Decal/Unlit&#34; { Properties { [Header(Basic)] _MainTex(&#34;Texture&#34;, 2D) = &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/aa8562fcfe662c0ef93802e51060bf6c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-05-05T09:15:22+08:00" />
<meta property="article:modified_time" content="2022-05-05T09:15:22+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【游戏开发小技】Unity中实现Dota里的角色技能地面贴花效果（URP | ShaderGraph | Decal）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night-eighties">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>本文最终效果<br> <img src="https://images2.imgbox.com/e9/63/NosdgmcG_o.gif" alt="请添加图片描述" width="1024"></p> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><ul><li><a href="#_5" rel="nofollow">一、前言</a></li><li><a href="#_13" rel="nofollow">二、环境准备</a></li><li><ul><li><a href="#1URP_14" rel="nofollow">1、URP环境准备</a></li><li><a href="#2_22" rel="nofollow">2、技能范围图案</a></li></ul> 
    </li><li><a href="#Shader_29" rel="nofollow">二、方案一：写Shader实现</a></li><li><ul><li><a href="#1ShaderUrpDecalshader_30" rel="nofollow">1、Shader脚本：UrpDecal.shader</a></li><li><a href="#2_342" rel="nofollow">2、材质球</a></li><li><a href="#3Cube_347" rel="nofollow">3、创建Cube</a></li><li><a href="#4_352" rel="nofollow">4、地面场景</a></li><li><a href="#5Renderer_Feature_Decal_355" rel="nofollow">5、添加Renderer Feature: Decal</a></li><li><a href="#6DecalCube_360" rel="nofollow">6、移动DecalCube，与地面交叉</a></li><li><a href="#7_364" rel="nofollow">7、运行效果</a></li></ul> 
    </li><li><a href="#URP_Decal_Projector_371" rel="nofollow">三、方案二：使用URP Decal Projector</a></li><li><ul><li><a href="#1Renderer_Feature_Decal_374" rel="nofollow">1、添加Renderer Feature: Decal</a></li><li><a href="#2Decal_Shader_Graph_379" rel="nofollow">2、创建Decal Shader Graph</a></li><li><a href="#3_386" rel="nofollow">3、材质球</a></li><li><a href="#4_URPDecalProjector_394" rel="nofollow">4、空物体挂 URPDecalProjector组件</a></li><li><a href="#4_399" rel="nofollow">4、设置组件参数</a></li><li><a href="#5_402" rel="nofollow">5、运行效果</a></li></ul> 
    </li><li><a href="#_416" rel="nofollow">四、工程源码</a></li><li><a href="#_426" rel="nofollow">五、完毕</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h4><a id="_5"></a>一、前言</h4> 
<p>嗨，大家好，我是新发。<br> 我平时偶尔会打打<code>Dota2</code>，在<code>Dota</code>里面，技能释放前会有一个地面贴花效果来作为范围的显示，比如深渊领主的这个技能，如下<br> <img src="https://images2.imgbox.com/b1/3d/M5DraGdS_o.gif" alt="请添加图片描述" width="800"><br> 我们可以看到技能范围特效是可以投射到场景地面和物体上（比如树木），这个在<code>Unity</code>中如何去实现呢？本文我以<code>URP</code>渲染管线为例，讲一下这个技能地面贴花效果的制作过程吧~</p> 
<blockquote> 
 <p>注：本文我使用的<code>Unity</code>版本为<code>2021.3.1f1c1</code>，<code>Universal RP</code>版本为<code>12.1.6</code></p> 
</blockquote> 
<h4><a id="_13"></a>二、环境准备</h4> 
<h5><a id="1URP_14"></a>1、URP环境准备</h5> 
<p>首先通过<code>PackageManager</code>安装<code>Universal RP</code>，在<code>Project</code>窗口中右键鼠标，点击菜单<code>Create / Rendering / URP Asset (with Universal Renderer)</code>，<br> <img src="https://images2.imgbox.com/b4/f1/vZoCHRDZ_o.png" alt="在这里插入图片描述"><br> 此时会创建出两个文件，如下<br> <img src="https://images2.imgbox.com/1d/53/N8sQof6S_o.png" alt="在这里插入图片描述"><br> 打开<code>Project Settings</code>窗口，点击<code>Graphics</code>，把<code>Uinversal Render Pipeline Asset</code>文件拖给<code>Scriptable Render Pipeline Settings</code>，如下<br> <img src="https://images2.imgbox.com/00/2b/GbmyhOUp_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="2_22"></a>2、技能范围图案</h5> 
<p>接着我们去找一张技能范围的图案，我找了一张这样的，<br> <img src="https://images2.imgbox.com/31/ec/Zl6SeFoj_o.png" alt="在这里插入图片描述"></p> 
<p>接下来就是具体的实现过程了。有两个方案，下面我分别给大家讲解一下。</p> 
<h4><a id="Shader_29"></a>二、方案一：写Shader实现</h4> 
<h5><a id="1ShaderUrpDecalshader_30"></a>1、Shader脚本：UrpDecal.shader</h5> 
<p>我在<code>GitHub</code>上看到有个外国小哥写了个<code>URP</code>渲染管线的贴花<code>Shader</code>，<br> <code>GitHub</code>地址：<a href="https://github.com/ColinLeung-NiloCat/UnityURPUnlitScreenSpaceDecalShader">https://github.com/ColinLeung-NiloCat/UnityURPUnlitScreenSpaceDecalShader</a></p> 
<p><img src="https://images2.imgbox.com/09/54/jdtgQHZg_o.png" alt="在这里插入图片描述"><br> 我给他的<code>Shader</code>添加了中文注释，方便大家阅读，如下</p> 
<pre><code class="prism language-c"><span class="token comment">// see README here: </span>
<span class="token comment">// github.com/ColinLeung-NiloCat/UnityURPUnlitScreenSpaceDecalShader</span>

Shader <span class="token string">"Universal Render Pipeline/NiloCat Extension/Screen Space Decal/Unlit"</span>
<span class="token punctuation">{<!-- --></span>
    Properties
    <span class="token punctuation">{<!-- --></span>
        <span class="token punctuation">[</span><span class="token function">Header</span><span class="token punctuation">(</span>Basic<span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token function">_MainTex</span><span class="token punctuation">(</span><span class="token string">"Texture"</span><span class="token punctuation">,</span> <span class="token number">2</span>D<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">"white"</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
        <span class="token punctuation">[</span>HDR<span class="token punctuation">]</span><span class="token function">_Color</span><span class="token punctuation">(</span><span class="token string">"_Color (default = 1,1,1,1)"</span><span class="token punctuation">,</span> color<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>

        <span class="token punctuation">[</span><span class="token function">Header</span><span class="token punctuation">(</span>Blending<span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token comment">// BlendMode官方手册：https://docs.unity3d.com/ScriptReference/Rendering.BlendMode.html</span>
        <span class="token comment">// 混合模式</span>
        <span class="token punctuation">[</span><span class="token function">Enum</span><span class="token punctuation">(</span>UnityEngine<span class="token punctuation">.</span>Rendering<span class="token punctuation">.</span>BlendMode<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token function">_SrcBlend</span><span class="token punctuation">(</span><span class="token string">"_SrcBlend (default = SrcAlpha)"</span><span class="token punctuation">,</span> Float<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">5</span> <span class="token comment">// 5 = SrcAlpha</span>
        <span class="token punctuation">[</span><span class="token function">Enum</span><span class="token punctuation">(</span>UnityEngine<span class="token punctuation">.</span>Rendering<span class="token punctuation">.</span>BlendMode<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token function">_DstBlend</span><span class="token punctuation">(</span><span class="token string">"_DstBlend (default = OneMinusSrcAlpha)"</span><span class="token punctuation">,</span> Float<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">10</span> <span class="token comment">// 10 = OneMinusSrcAlpha</span>

        <span class="token punctuation">[</span><span class="token function">Header</span><span class="token punctuation">(</span>Alpha <span class="token function">remap</span><span class="token punctuation">(</span>extra alpha control<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token function">_AlphaRemap</span><span class="token punctuation">(</span><span class="token string">"_AlphaRemap (default = 1,0,0,0) _____alpha will first mul x, then add y    (zw unused)"</span><span class="token punctuation">,</span> vector<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>

        <span class="token punctuation">[</span><span class="token function">Header</span><span class="token punctuation">(</span>Prevent Side <span class="token function">Stretching</span><span class="token punctuation">(</span>Compare projection direction with scene normal and Discard <span class="token keyword">if</span> needed<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token punctuation">[</span><span class="token function">Toggle</span><span class="token punctuation">(</span>_ProjectionAngleDiscardEnable<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token function">_ProjectionAngleDiscardEnable</span><span class="token punctuation">(</span><span class="token string">"_ProjectionAngleDiscardEnable (default = off)"</span><span class="token punctuation">,</span> <span class="token keyword">float</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token function">_ProjectionAngleDiscardThreshold</span><span class="token punctuation">(</span><span class="token string">"_ProjectionAngleDiscardThreshold (default = 0)"</span><span class="token punctuation">,</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span>

        <span class="token punctuation">[</span><span class="token function">Header</span><span class="token punctuation">(</span>Mul alpha to rgb<span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token punctuation">[</span>Toggle<span class="token punctuation">]</span><span class="token function">_MulAlphaToRGB</span><span class="token punctuation">(</span><span class="token string">"_MulAlphaToRGB (default = off)"</span><span class="token punctuation">,</span> Float<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span>

        <span class="token punctuation">[</span><span class="token function">Header</span><span class="token punctuation">(</span>Ignore texture wrap mode setting<span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token punctuation">[</span><span class="token function">Toggle</span><span class="token punctuation">(</span>_FracUVEnable<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token function">_FracUVEnable</span><span class="token punctuation">(</span><span class="token string">"_FracUVEnable (default = off)"</span><span class="token punctuation">,</span> Float<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span>

        <span class="token comment">//====================================== 在常规的用例中，通常可以忽略下面这些设置 =====================================================================</span>
        <span class="token punctuation">[</span><span class="token function">Header</span><span class="token punctuation">(</span>Stencil Masking<span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token comment">// https://docs.unity3d.com/ScriptReference/Rendering.CompareFunction.html</span>
        <span class="token function">_StencilRef</span><span class="token punctuation">(</span><span class="token string">"_StencilRef"</span><span class="token punctuation">,</span> Float<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token punctuation">[</span><span class="token function">Enum</span><span class="token punctuation">(</span>UnityEngine<span class="token punctuation">.</span>Rendering<span class="token punctuation">.</span>CompareFunction<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token function">_StencilComp</span><span class="token punctuation">(</span><span class="token string">"_StencilComp (default = Disable) _____Set to NotEqual if you want to mask by specific _StencilRef value, else set to Disable"</span><span class="token punctuation">,</span> Float<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">//0 = disable</span>

        <span class="token punctuation">[</span><span class="token function">Header</span><span class="token punctuation">(</span>ZTest<span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token comment">// https://docs.unity3d.com/ScriptReference/Rendering.CompareFunction.html</span>
        <span class="token comment">// 默认Disable, 因为我们需要确保即使相机进入贴花立方体体积，贴花渲染也正确，尽管默认禁用ZTest将阻止EarlyZ(不利于GPU性能)</span>
        <span class="token punctuation">[</span><span class="token function">Enum</span><span class="token punctuation">(</span>UnityEngine<span class="token punctuation">.</span>Rendering<span class="token punctuation">.</span>CompareFunction<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token function">_ZTest</span><span class="token punctuation">(</span><span class="token string">"_ZTest (default = Disable) _____to improve GPU performance, Set to LessEqual if camera never goes into cube volume, else set to Disable"</span><span class="token punctuation">,</span> Float<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">//0 = disable</span>

        <span class="token punctuation">[</span><span class="token function">Header</span><span class="token punctuation">(</span>Cull<span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token comment">// CullMode官方手册: https://docs.unity3d.com/ScriptReference/Rendering.CullMode.html</span>
        <span class="token comment">// 默认为Front, 因为我们需要确保即使相机进入贴花立方体体积，贴花渲染也正确</span>
        <span class="token punctuation">[</span><span class="token function">Enum</span><span class="token punctuation">(</span>UnityEngine<span class="token punctuation">.</span>Rendering<span class="token punctuation">.</span>CullMode<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token function">_Cull</span><span class="token punctuation">(</span><span class="token string">"_Cull (default = Front) _____to improve GPU performance, Set to Back if camera never goes into cube volume, else set to Front"</span><span class="token punctuation">,</span> Float<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token comment">//1 = Front</span>

        <span class="token punctuation">[</span><span class="token function">Header</span><span class="token punctuation">(</span>Unity Fog<span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token punctuation">[</span><span class="token function">Toggle</span><span class="token punctuation">(</span>_UnityFogEnable<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token function">_UnityFogEnable</span><span class="token punctuation">(</span><span class="token string">"_UnityFogEnable (default = on)"</span><span class="token punctuation">,</span> Float<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span>

        <span class="token punctuation">[</span><span class="token function">Header</span><span class="token punctuation">(</span>Support Orthographic camera<span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token punctuation">[</span><span class="token function">Toggle</span><span class="token punctuation">(</span>_SupportOrthographicCamera<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token function">_SupportOrthographicCamera</span><span class="token punctuation">(</span><span class="token string">"_SupportOrthographicCamera (default = off)"</span><span class="token punctuation">,</span> Float<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token punctuation">}</span>

    SubShader
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 关于tags的内容可以查阅官网手册：https://docs.unity3d.com/Manual/SL-SubShaderTags.html</span>
        <span class="token comment">// 为了避免渲染顺序问题, Queue必须 &gt;= 2501, 它位于透明队列中</span>
        <span class="token comment">// 在透明队列中，Unity总是从后到前渲染</span>
        <span class="token comment">// 2500以下是不透明物体队列，会进行渲染优化，比如被遮住的就剔除掉不进行渲染</span>
        <span class="token comment">// 2500以上是透明物体队列，它会根据距离摄像机的距离进行排序</span>
        <span class="token comment">// 从最远的开始渲染，到最近的结束</span>
        <span class="token comment">// 天空盒被渲染在所有不透明和透明物体之间</span>
        <span class="token comment">// "Queue" = "Transparent-499" 即 "Queue" = "2501", 使得它早于所有透明物体进行渲染</span>
        Tags <span class="token punctuation">{<!-- --></span> <span class="token string">"RenderType"</span> <span class="token operator">=</span> <span class="token string">"Overlay"</span> <span class="token string">"Queue"</span> <span class="token operator">=</span> <span class="token string">"Transparent-499"</span> <span class="token string">"DisableBatching"</span> <span class="token operator">=</span> <span class="token string">"True"</span> <span class="token punctuation">}</span>

        Pass
        <span class="token punctuation">{<!-- --></span>
            Stencil
            <span class="token punctuation">{<!-- --></span>
                Ref<span class="token punctuation">[</span>_StencilRef<span class="token punctuation">]</span>
                Comp<span class="token punctuation">[</span>_StencilComp<span class="token punctuation">]</span>
            <span class="token punctuation">}</span>

            Cull<span class="token punctuation">[</span>_Cull<span class="token punctuation">]</span>
            ZTest<span class="token punctuation">[</span>_ZTest<span class="token punctuation">]</span>

            <span class="token comment">// 为了支持透明度混合，关闭深度写入</span>
            ZWrite off
            Blend<span class="token punctuation">[</span>_SrcBlend<span class="token punctuation">]</span><span class="token punctuation">[</span>_DstBlend<span class="token punctuation">]</span>

            HLSLPROGRAM

            <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">vertex vert</span></span>
            <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">fragment frag</span></span>

            <span class="token comment">// 雾效</span>
            <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">multi_compile_fog</span></span>

            <span class="token comment">// 为了使用 ddx() &amp; ddy()</span>
            <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">target <span class="token number">3.0</span></span></span>

            <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">shader_feature_local_fragment _ProjectionAngleDiscardEnable</span></span>
            <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">shader_feature_local _UnityFogEnable</span></span>
            <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">shader_feature_local_fragment _FracUVEnable</span></span>
            <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">shader_feature_local_fragment _SupportOrthographicCamera</span></span>

            <span class="token comment">// 所有URP渲染管线的shader都必须引入这个Core.hlsl</span>
            <span class="token comment">// 它包含内置shader的变量，比如光照相关的变量，文档：https://docs.unity3d.com/Manual/SL-UnityShaderVariables.html</span>
            <span class="token comment">// 同时它也包含很多工具方法</span>
            <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Packages/com.unity.render-pipelines.universal/ShaderLibrary/Core.hlsl"</span></span>

            <span class="token keyword">struct</span> <span class="token class-name">appdata</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 模型空间下的坐标，OS: Object Space</span>
                float3 positionOS <span class="token operator">:</span> POSITION<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>

            <span class="token keyword">struct</span> <span class="token class-name">v2f</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 齐次裁剪空间坐标，CS: Clip Space</span>
                float4 positionCS <span class="token operator">:</span> SV_POSITION<span class="token punctuation">;</span>
                <span class="token comment">// 屏幕坐标</span>
                float4 screenPos <span class="token operator">:</span> TEXCOORD0<span class="token punctuation">;</span>
                <span class="token comment">// xyz分量: 表示viewRayOS, 即模型空间 (Object Space)下的摄像机到顶点的射线</span>
                <span class="token comment">// w分量: 拷贝positionVS.z的值，即观察空间 (View Space) 下的顶点坐标的z分量</span>
                float4 viewRayOS <span class="token operator">:</span> TEXCOORD1<span class="token punctuation">;</span> 
                <span class="token comment">// rgb分量：表示模型空间下的摄像机坐标，</span>
                <span class="token comment">// a分量：表示雾的强度</span>
                float4 cameraPosOSAndFogFactor <span class="token operator">:</span> TEXCOORD2<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>

            sampler2D _MainTex<span class="token punctuation">;</span>
            sampler2D _CameraDepthTexture<span class="token punctuation">;</span>

            <span class="token comment">// 支持SRP Batcher</span>
            <span class="token function">CBUFFER_START</span><span class="token punctuation">(</span>UnityPerMaterial<span class="token punctuation">)</span>               
                float4 _MainTex_ST<span class="token punctuation">;</span>
                <span class="token keyword">float</span> _ProjectionAngleDiscardThreshold<span class="token punctuation">;</span>
                half4 _Color<span class="token punctuation">;</span>
                half2 _AlphaRemap<span class="token punctuation">;</span>
                half _MulAlphaToRGB<span class="token punctuation">;</span>
            CBUFFER_END

            <span class="token comment">// 顶点着色器</span>
            v2f <span class="token function">vert</span><span class="token punctuation">(</span>appdata input<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                v2f o<span class="token punctuation">;</span>

                <span class="token comment">// VertexPositionInputs包含多个空间坐标系中的位置(world, view, homogeneous clip space, ndc)</span>
                <span class="token comment">// Unity编译器将剥离所有未使用的引用 （比如你没有使用view space）</span>
                <span class="token comment">// 因此，这种结构具有更大的灵活性，无需额外的成本</span>
                VertexPositionInputs vertexPositionInput <span class="token operator">=</span> <span class="token function">GetVertexPositionInputs</span><span class="token punctuation">(</span>input<span class="token punctuation">.</span>positionOS<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 得到齐次裁剪空间 (clip space) 下的坐标</span>
                o<span class="token punctuation">.</span>positionCS <span class="token operator">=</span> vertexPositionInput<span class="token punctuation">.</span>positionCS<span class="token punctuation">;</span>

                <span class="token comment">// Unity雾效</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">_UnityFogEnable</span></span>
                o<span class="token punctuation">.</span>cameraPosOSAndFogFactor<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token function">ComputeFogFactor</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>positionCS<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span>
                o<span class="token punctuation">.</span>cameraPosOSAndFogFactor<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

                <span class="token comment">// 准备深度纹理的屏幕空间UV</span>
                o<span class="token punctuation">.</span>screenPos <span class="token operator">=</span> <span class="token function">ComputeScreenPos</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>positionCS<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// 观察空间 (view space) 坐标，即在观察空间中摄像机到顶点的射线向量</span>
                float3 viewRay <span class="token operator">=</span> vertexPositionInput<span class="token punctuation">.</span>positionVS<span class="token punctuation">;</span>

                <span class="token comment">// [注意，这一步很关键]</span>
                <span class="token comment">//=========================================================</span>
                <span class="token comment">// viewRay除以z分量必须在片元着色器中执行，不能在顶点着色器中执行! (由于光栅化变化插值的透视校正)</span>
                <span class="token comment">// 我们先把viewRay.z存到o.viewRayOS.w中，等到片元着色器阶段在进行处理</span>
                o<span class="token punctuation">.</span>viewRayOS<span class="token punctuation">.</span>w <span class="token operator">=</span> viewRay<span class="token punctuation">.</span>z<span class="token punctuation">;</span>
                <span class="token comment">//=========================================================</span>

                <span class="token comment">// unity的相机空间是右手坐标系(z轴负方向指向屏幕)，我们希望片段着色器中z射线是正的，所以取反</span>
                viewRay <span class="token operator">*=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>

                <span class="token comment">// 观察空间到模型空间的变换矩阵</span>
                float4x4 ViewToObjectMatrix <span class="token operator">=</span> <span class="token function">mul</span><span class="token punctuation">(</span>UNITY_MATRIX_I_M<span class="token punctuation">,</span> UNITY_MATRIX_I_V<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// 观察空间 (view space) 转模型空间 (object space) </span>
                o<span class="token punctuation">.</span>viewRayOS<span class="token punctuation">.</span>xyz <span class="token operator">=</span> <span class="token function">mul</span><span class="token punctuation">(</span><span class="token punctuation">(</span>float3x3<span class="token punctuation">)</span>ViewToObjectMatrix<span class="token punctuation">,</span> viewRay<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 模型空间下摄像机的坐标</span>
                o<span class="token punctuation">.</span>cameraPosOSAndFogFactor<span class="token punctuation">.</span>xyz <span class="token operator">=</span> <span class="token function">mul</span><span class="token punctuation">(</span>ViewToObjectMatrix<span class="token punctuation">,</span> <span class="token function">float4</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>xyz<span class="token punctuation">;</span> 

                <span class="token keyword">return</span> o<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            half4 <span class="token function">frag</span><span class="token punctuation">(</span>v2f i<span class="token punctuation">)</span> <span class="token operator">:</span> SV_Target
            <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// [注意，这一步很关键]</span>
                <span class="token comment">//========================================================================</span>
                <span class="token comment">// 去齐次</span>
                i<span class="token punctuation">.</span>viewRayOS<span class="token punctuation">.</span>xyz <span class="token operator">/=</span> i<span class="token punctuation">.</span>viewRayOS<span class="token punctuation">.</span>w<span class="token punctuation">;</span>
                <span class="token comment">//========================================================================</span>

                <span class="token comment">// 深度纹理的UV</span>
                float2 screenSpaceUV <span class="token operator">=</span> i<span class="token punctuation">.</span>screenPos<span class="token punctuation">.</span>xy <span class="token operator">/</span> i<span class="token punctuation">.</span>screenPos<span class="token punctuation">.</span>w<span class="token punctuation">;</span>
                <span class="token comment">// 对深度纹理进行采样，得到深度信息</span>
                <span class="token keyword">float</span> sceneRawDepth <span class="token operator">=</span> <span class="token function">tex2D</span><span class="token punctuation">(</span>_CameraDepthTexture<span class="token punctuation">,</span> screenSpaceUV<span class="token punctuation">)</span><span class="token punctuation">.</span>r<span class="token punctuation">;</span>

                float3 decalSpaceScenePos<span class="token punctuation">;</span>

<span class="token comment">// 正交相机</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">_SupportOrthographicCamera</span></span>
                <span class="token comment">// 我们必须支持正交和透视两种投影</span>
                <span class="token comment">// unity_OrthoParams：</span>
                <span class="token comment">//      unity_OrthoParams是内置着色器遍历，存储的信息如下：</span>
                <span class="token comment">//      x 是正交摄像机的宽度，y 是正交摄像机的高度，z 未使用，w 在摄像机为正交模式时是 1.0，而在摄像机为透视模式时是 0.0。</span>
                <span class="token comment">//      更多的内置着色器遍历可查看官方手册: https://docs.unity.cn/cn/2019.4/Manual/SL-UnityShaderVariables.html</span>
                <span class="token comment">// (这里要放 UNITY_BRANCH 吗?) 我决定不放，原因看这里： https://forum.unity.com/threads/correct-use-of-unity_branch.476804/</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>unity_OrthoParams<span class="token punctuation">.</span>w<span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// 如果是正交摄像机, _CameraDepthTexture在[0,1]内线性存储场景深度</span>
                    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token function">defined</span><span class="token punctuation">(</span>UNITY_REVERSED_Z<span class="token punctuation">)</span></span></span>
                    <span class="token comment">// 如果platform使用反向深度，要使用1-depth</span>
                    <span class="token comment">// https://docs.unity3d.com/Manual/SL-PlatformDifferences.html</span>
                    sceneRawDepth <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">-</span>sceneRawDepth<span class="token punctuation">;</span>
                    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
 
                    <span class="token comment">// 使用简单的lerp插值： lerp(near,far, [0,1] linear depth)， 得到观察空间 (view space)的深度信息               </span>
                    <span class="token keyword">float</span> sceneDepthVS <span class="token operator">=</span> <span class="token function">lerp</span><span class="token punctuation">(</span>_ProjectionParams<span class="token punctuation">.</span>y<span class="token punctuation">,</span> _ProjectionParams<span class="token punctuation">.</span>z<span class="token punctuation">,</span> sceneRawDepth<span class="token punctuation">)</span><span class="token punctuation">;</span>


                    <span class="token comment">// 投影</span>
				    float2 viewRayEndPosVS_xy <span class="token operator">=</span> <span class="token function">float2</span><span class="token punctuation">(</span>unity_OrthoParams<span class="token punctuation">.</span>xy <span class="token operator">*</span> <span class="token punctuation">(</span>i<span class="token punctuation">.</span>screenPos<span class="token punctuation">.</span>xy <span class="token operator">-</span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token comment">/* 裁剪空间 */</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
                    <span class="token comment">// 构建观察空间坐标</span>
				    float4 vposOrtho <span class="token operator">=</span> <span class="token function">float4</span><span class="token punctuation">(</span>viewRayEndPosVS_xy<span class="token punctuation">,</span> <span class="token operator">-</span>sceneDepthVS<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                            
                    <span class="token comment">// 观察空间转世界空间</span>
				    float3 wposOrtho <span class="token operator">=</span> <span class="token function">mul</span><span class="token punctuation">(</span>UNITY_MATRIX_I_V<span class="token punctuation">,</span> vposOrtho<span class="token punctuation">)</span><span class="token punctuation">.</span>xyz<span class="token punctuation">;</span>                                                 
                    <span class="token comment">//----------------------------------------------------------------------------</span>

                    <span class="token comment">// 世界空间转模型空间 (贴花空间)</span>
                    decalSpaceScenePos <span class="token operator">=</span> <span class="token function">mul</span><span class="token punctuation">(</span><span class="token function">GetWorldToObjectMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">float4</span><span class="token punctuation">(</span>wposOrtho<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>xyz<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span>
                <span class="token punctuation">{<!-- --></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
                    <span class="token comment">// 如果是透视相机，LinearEyeDepth将为用户处理一切</span>
                    <span class="token comment">// 记住，我们不能使用LinearEyeDepth处理正交相机!</span>
                    <span class="token comment">// _ZBufferParams: </span>
                    <span class="token comment">//      用于线性化 Z 缓冲区值。x 是 (1-远/近)，y 是 (远/近)，z 是 (x/远)，w 是 (y/远)。</span>
                    <span class="token keyword">float</span> sceneDepthVS <span class="token operator">=</span> <span class="token function">LinearEyeDepth</span><span class="token punctuation">(</span>sceneRawDepth<span class="token punctuation">,</span> _ZBufferParams<span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token comment">// 在任何空间中，场景深度 = rayStartPos + rayDir * rayLength</span>
                    <span class="token comment">// 这里所有的数据在 模型空间 (object space) 或 贴花空间 (decal space)</span>
                    <span class="token comment">// 注意，viewRayOS 不是一个单位向量，所以不要规一化它，它是一个方向向量，视图空间z的长度是1</span>
                    decalSpaceScenePos <span class="token operator">=</span> i<span class="token punctuation">.</span>cameraPosOSAndFogFactor<span class="token punctuation">.</span>xyz <span class="token operator">+</span> i<span class="token punctuation">.</span>viewRayOS<span class="token punctuation">.</span>xyz <span class="token operator">*</span> sceneDepthVS<span class="token punctuation">;</span>
                    
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">_SupportOrthographicCamera</span></span>
                <span class="token punctuation">}</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

                <span class="token comment">// unity 的 cube 的顶点坐标范围是 [-0.5, 0.5,]，我们把它转到 [0,1] 的范围，用于映射UV</span>
                <span class="token comment">// 只有你使用 cube 作为 mesh filter 时才能这么干</span>
                float2 decalSpaceUV <span class="token operator">=</span> decalSpaceScenePos<span class="token punctuation">.</span>xy <span class="token operator">+</span> <span class="token number">0.5</span><span class="token punctuation">;</span>

                <span class="token comment">// 剔除逻辑</span>
                <span class="token comment">//===================================================</span>
                <span class="token comment">// 剔除在 cube 以外的像素信息</span>
                <span class="token keyword">float</span> shouldClip <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">_ProjectionAngleDiscardEnable</span></span>
                <span class="token comment">// 也丢弃 “场景法向不面对贴花投射器方向” 的像素</span>
                <span class="token comment">// 使用 ddx 和 ddy 重建场景法线信息</span>
                <span class="token comment">// ddx 就是右边的像素块的值减去左边像素块的值，而ddy就是下面像素块的值减去上面像素块的值。</span>
                <span class="token comment">// ddx 和 ddy 的结果就是副切线和切线方向，利用右手定理，叉乘 (cross) 后就是法线，最后执行归一化 (normalize) 得到法线单位向量</span>
                float3 decalSpaceHardNormal <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span><span class="token function">cross</span><span class="token punctuation">(</span><span class="token function">ddx</span><span class="token punctuation">(</span>decalSpaceScenePos<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">ddy</span><span class="token punctuation">(</span>decalSpaceScenePos<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// 判断是否进行剔除</span>
                <span class="token comment">// 注：decalSpaceHardNormal.z = dot(decalForwardDir, sceneHardNormalDir)</span>
                shouldClip <span class="token operator">=</span> decalSpaceHardNormal<span class="token punctuation">.</span>z <span class="token operator">&gt;</span> _ProjectionAngleDiscardThreshold <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
                <span class="token comment">// 执行剔除</span>
                <span class="token comment">// 如果 ZWrite 关闭，在移动设备上 clip() 函数是足够效率的，因为它不会写入深度缓冲，所以GPU渲染管线不会卡住（经过ARM官方人员确认过）</span>
                <span class="token function">clip</span><span class="token punctuation">(</span><span class="token number">0.5</span> <span class="token operator">-</span> <span class="token function">abs</span><span class="token punctuation">(</span>decalSpaceScenePos<span class="token punctuation">)</span> <span class="token operator">-</span> shouldClip<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//===================================================</span>

                <span class="token comment">// 贴花UV计算</span>
                <span class="token comment">// _MainTex_ST.xy: 表示uv的tilling</span>
                <span class="token comment">// _MainTex_ST.zw: 表示uv的offset     </span>
                float2 uv <span class="token operator">=</span> decalSpaceUV<span class="token punctuation">.</span>xy <span class="token operator">*</span> _MainTex_ST<span class="token punctuation">.</span>xy <span class="token operator">+</span> _MainTex_ST<span class="token punctuation">.</span>zw<span class="token punctuation">;</span><span class="token comment">//Texture tiling &amp; offset</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">_FracUVEnable</span></span>
                <span class="token comment">// UV裂缝处理</span>
                uv <span class="token operator">=</span> <span class="token function">frac</span><span class="token punctuation">(</span>uv<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
                <span class="token comment">// 贴花纹理采样</span>
                half4 col <span class="token operator">=</span> <span class="token function">tex2D</span><span class="token punctuation">(</span>_MainTex<span class="token punctuation">,</span> uv<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 与颜色相乘</span>
                col <span class="token operator">*=</span> _Color<span class="token punctuation">;</span>
                <span class="token comment">// 透明通道重新映射</span>
                col<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token function">saturate</span><span class="token punctuation">(</span>col<span class="token punctuation">.</span>a <span class="token operator">*</span> _AlphaRemap<span class="token punctuation">.</span>x <span class="token operator">+</span> _AlphaRemap<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 插值</span>
                col<span class="token punctuation">.</span>rgb <span class="token operator">*=</span> <span class="token function">lerp</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> col<span class="token punctuation">.</span>a<span class="token punctuation">,</span> _MulAlphaToRGB<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">_UnityFogEnable</span></span>
                <span class="token comment">// 混合像素颜色与雾色。你可以选择使用MixFogColor来覆盖雾色</span>
                col<span class="token punctuation">.</span>rgb <span class="token operator">=</span> <span class="token function">MixFog</span><span class="token punctuation">(</span>col<span class="token punctuation">.</span>rgb<span class="token punctuation">,</span> i<span class="token punctuation">.</span>cameraPosOSAndFogFactor<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
                <span class="token keyword">return</span> col<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            ENDHLSL
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>首先有一个前提，就是模型必须使用<code>Cube</code>。<br> 最核心的一步就是通过深度信息还原世界空间坐标，再转模型空间坐标（也就是贴花空间坐标），计算出贴花<code>UV</code>，对贴花图案采样输出。</p> 
<p>其中关于如何通过深度纹理重建世界坐标，大家可以阅读 <mark>冯乐乐</mark> 写的 <mark>《Unity Shader 入门精要》</mark> 这本书第13章的<code>13.3.1</code>小结，她讲得很好，建议大家多看书学习</p> 
<p><img src="https://images2.imgbox.com/58/55/HiozYxDz_o.png" alt="请添加图片描述"></p> 
<p>我们把上面的<code>Shader</code>保存为<code>UrpDecal.shader</code>，如下<br> <img src="https://images2.imgbox.com/d6/41/Zyzqo0tJ_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="2_342"></a>2、材质球</h5> 
<p>我们创建一个材质球，重命名为<code>UrpDecal</code>，并使用刚刚的<code>shader</code>，如下<br> <img src="https://images2.imgbox.com/80/df/LbjSvCVQ_o.png" alt="在这里插入图片描述"><br> 设置一下材质球参数，如下<br> <img src="https://images2.imgbox.com/67/04/Fvl88kdh_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="3Cube_347"></a>3、创建Cube</h5> 
<p>创建一个<code>Cube</code>，重命名为<code>DecalCube</code>，<br> <img src="https://images2.imgbox.com/ae/c5/gd2rOSve_o.png" alt="在这里插入图片描述"><br> 把上面的材质球赋给这个<code>Cube</code>，<br> <img src="https://images2.imgbox.com/98/aa/xxe1QQIw_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="4_352"></a>4、地面场景</h5> 
<p>简单搭建一下地面场景，<br> <img src="https://images2.imgbox.com/9b/4e/dTvJIHdT_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="5Renderer_Feature_Decal_355"></a>5、添加Renderer Feature: Decal</h5> 
<p>点击<code>Universal Render Pipeline Asset_Renderer</code>，点击<code>Add Renderer Feature</code>，然后点击<code>Decal</code>，<br> <img src="https://images2.imgbox.com/57/da/uSOh7I1C_o.png" alt="在这里插入图片描述"><br> 如下<br> <img src="https://images2.imgbox.com/8f/02/DIaNnCUy_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="6DecalCube_360"></a>6、移动DecalCube，与地面交叉</h5> 
<p>选中<code>DecalCube</code>，调整下角度和缩放，<br> <img src="https://images2.imgbox.com/7a/fd/T2J8KW2w_o.png" alt="在这里插入图片描述"><br> 然后移动<code>DecalCube</code>，让它与地面交叉，此时我们就可以看到想要的贴花效果了</p> 
<h5><a id="7_364"></a>7、运行效果</h5> 
<p>运行效果如下<br> <img src="https://images2.imgbox.com/d9/8d/MasBQoLN_o.gif" alt="请添加图片描述" width="800"></p> 
<h4><a id="URP_Decal_Projector_371"></a>三、方案二：使用URP Decal Projector</h4> 
<p>在默认渲染管线中，我们可以使用<code>Projector</code>来实现贴花效果，比较常见的是假阴影的实现。<br> 在<code>URP</code>渲染管线中，我们可以使用<code>URP Decal Projector</code>。</p> 
<h5><a id="1Renderer_Feature_Decal_374"></a>1、添加Renderer Feature: Decal</h5> 
<p>跟上面一样，也得添加<code>Decal</code>，</p> 
<p><img src="https://images2.imgbox.com/af/e9/CEXrGWtg_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/c4/70/uQWckljR_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="2Decal_Shader_Graph_379"></a>2、创建Decal Shader Graph</h5> 
<p>点击菜单<code>Create / Shader Graph / URP / Decal Shader Graph</code>，如下<br> <img src="https://images2.imgbox.com/b3/95/BBJFSrKF_o.png" alt="在这里插入图片描述"><br> 双击打开它<code>ShaderGraph</code>，<br> <img src="https://images2.imgbox.com/f6/8f/dyMzQ2II_o.png" alt="在这里插入图片描述"><br> 连线图如下<br> <img src="https://images2.imgbox.com/ca/09/y8ztZLkM_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="3_386"></a>3、材质球</h5> 
<p>我们创建一个材质球并重命名为<code>DecalShaderGraph</code>，把上面的<code>ShaderGraph</code>赋给它，如下<br> <img src="https://images2.imgbox.com/1c/30/SN9vJm3c_o.png" alt="在这里插入图片描述"><br> 设置一下材质球参数<br> <img src="https://images2.imgbox.com/13/fc/TaYAiT0J_o.png" alt="在这里插入图片描述" width="500"></p> 
<h5><a id="4_URPDecalProjector_394"></a>4、空物体挂 URPDecalProjector组件</h5> 
<p>创建一个空物体，重命名为<code>URPDecalProjector</code>，<br> <img src="https://images2.imgbox.com/b2/85/EaqBJwfE_o.png" alt="在这里插入图片描述"><br> 给它挂上<code>URPDecalProjector</code>组件<br> <img src="https://images2.imgbox.com/71/54/fsMy25CA_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="4_399"></a>4、设置组件参数</h5> 
<p>设置一下组件参数，如下<br> <img src="https://images2.imgbox.com/eb/f5/3muknEjz_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="5_402"></a>5、运行效果</h5> 
<p>调整一下<code>URPDecalProjector</code>的角度和缩放，<br> <img src="https://images2.imgbox.com/bb/df/ZgoPASkS_o.png" alt="在这里插入图片描述"><br> 移动<code>URPDecalProjector</code>使其与地面交叉，效果如下<br> <img src="https://images2.imgbox.com/51/b5/M6m3nDMY_o.gif" alt="请添加图片描述" width="800"></p> 
<p>我们还可以在<code>ShaderGraph</code>中给加个<code>UV</code>旋转，让图案转起来，<br> <img src="https://images2.imgbox.com/90/22/df7WgsPO_o.png" alt="在这里插入图片描述"><br> 效果如下<br> <img src="https://images2.imgbox.com/69/c9/q0T4RkHx_o.gif" alt="请添加图片描述" width="800"></p> 
<h4><a id="_416"></a>四、工程源码</h4> 
<p>以上两种方案放在一起，效果如下，</p> 
<p><img src="https://images2.imgbox.com/37/f2/uAn3W2Q6_o.gif" alt="请添加图片描述" width="800"></p> 
<p>本文工程源码我已上传到<code>GitCode</code>，地址：<a href="https://gitcode.net/linxinfa/unityurpdecaldemo" rel="nofollow">https://gitcode.net/linxinfa/unityurpdecaldemo</a><br> 感兴趣的同学可自行下载学习</p> 
<p><img src="https://images2.imgbox.com/a0/79/vHvwC955_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_426"></a>五、完毕</h4> 
<p>好了，夜深了，收工睡觉。<br> 我是林新发，<a href="https://blog.csdn.net/linxinfa">https://blog.csdn.net/linxinfa</a><br> 一个在小公司默默奋斗的<code>Unity</code>开发者，希望可以帮助更多想学<code>Unity</code>的人，共勉~</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f0d2d9a37dde613f4b52dd9226e13623/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">零基础vue.js学习笔记 进阶篇</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0d314ece473b6d4f6b446b3fa5bfbe52/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">linux kernel配置调试方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>