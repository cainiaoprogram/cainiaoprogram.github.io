<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Pandas数据分析实战项目(简单) - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Pandas数据分析实战项目(简单)" />
<meta property="og:description" content="一、项目介绍 项目背景：根据已有数据，对给定车型进行数据分析，得出给定车型近半年每个月在各个城市真实搜索指数
数据来源：数据使用百度指数给出的数据，通过对给定车型关键词进行数据抓取，得到车型的全国搜索指数。省份搜索热度、城市搜索热度。
数据：
链接：https://pan.baidu.com/s/1h5KKVESgRRHaP4DYgM8AaA
提取码：ke0o
二、项目处理 1、处理全国指数趋势表 打开百度指数趋势表，发现有如下问题需要处理：
对于个别车型是近期才有数据，之前没有数据，需要对缺失值进行处理；结果是需要月级数据，但是原始数据是按天的，需要对日期进行处理；对于原始数据关键词keyword字段，为防止合并时出现大小写区别而合并错误，需要对关键词进行统一处理。 代码实现： In [1] :import numpy as np import pandas as pd # 读取百度指数表 In [2] :index = pd.read_excel(&#39;baidu_index_0625.xlsx&#39;) prov_id = pd.read_excel(&#39;prov_id .xlsx&#39;) city_id = pd.read_excel(&#39;city_id.xlsx&#39;) # 处理缺失值 In [3] :index = index.fillna(0) # 对data字段进行格式化处理 In [4] :index[&#39;date&#39;] = pd.to_datetime(index[&#39;date&#39;]) index[&#39;date&#39;] = index[&#39;date&#39;].dt.strftime(&#39;%B&#39;) # 对关键词字段进行统一处理 In [5] :index[&#39;keyword&#39;] = index[&#39;keyword&#39;].apply(lambda x: x.strip(&#39; \r\n\t&#39;).upper()) # 根据keyword，date对搜索指数进行分类汇总求和 In [6] :new_index_mean = index.groupby([&#39;keyword&#39;,&#39;date’])[&#39;_index&#39;].sum() # 展示结果 In [7] :new_index_mean Out[7] : keyword date IX25 April 29144." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/8511727ff9e7d7b90ded4a6b00f6b9ca/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-06-27T11:31:49+08:00" />
<meta property="article:modified_time" content="2019-06-27T11:31:49+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Pandas数据分析实战项目(简单)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>一、项目介绍</h3> 
<p><strong>项目背景</strong>：根据已有数据，对给定车型进行数据分析，得出给定车型近半年每个月在各个城市真实搜索指数<br> <strong>数据来源</strong>：数据使用百度指数给出的数据，通过对给定车型关键词进行数据抓取，得到车型的全国搜索指数。省份搜索热度、城市搜索热度。<br> 数据：<br> 链接：https://pan.baidu.com/s/1h5KKVESgRRHaP4DYgM8AaA<br> 提取码：ke0o<br> <img src="https://images2.imgbox.com/68/33/zQgc2p0q_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/94/47/3CXkv7bU_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/6c/35/sP206SX2_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_9"></a>二、项目处理</h3> 
<h5><a id="1_10"></a>1、处理全国指数趋势表</h5> 
<p>打开百度指数趋势表，发现有如下问题需要处理：</p> 
<ol><li>对于个别车型是近期才有数据，之前没有数据，需要对缺失值进行处理；</li><li>结果是需要月级数据，但是原始数据是按天的，需要对日期进行处理；</li><li>对于原始数据关键词keyword字段，为防止合并时出现大小写区别而合并错误，需要对关键词进行统一处理。</li></ol> 
<h6><a id="_17"></a>代码实现：</h6> 
<pre><code class="prism language-python">In <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">:</span><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
		<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
		
<span class="token comment"># 读取百度指数表</span>
In <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">:</span>index <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span><span class="token string">'baidu_index_0625.xlsx'</span><span class="token punctuation">)</span>
		prov_id <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span><span class="token string">'prov_id .xlsx'</span><span class="token punctuation">)</span>
		city_id <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span><span class="token string">'city_id.xlsx'</span><span class="token punctuation">)</span>

<span class="token comment"># 处理缺失值</span>
In <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token punctuation">:</span>index <span class="token operator">=</span> index<span class="token punctuation">.</span>fillna<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment"># 对data字段进行格式化处理</span>
In <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token punctuation">:</span>index<span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_datetime<span class="token punctuation">(</span>index<span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
		index<span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span> <span class="token operator">=</span> index<span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>dt<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%B'</span><span class="token punctuation">)</span>
		
<span class="token comment"># 对关键词字段进行统一处理</span>
In <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token punctuation">:</span>index<span class="token punctuation">[</span><span class="token string">'keyword'</span><span class="token punctuation">]</span> <span class="token operator">=</span> index<span class="token punctuation">[</span><span class="token string">'keyword'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token string">' \r\n\t'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		
<span class="token comment"># 根据keyword，date对搜索指数进行分类汇总求和</span>
In <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token punctuation">:</span>new_index_mean <span class="token operator">=</span> index<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'keyword'</span><span class="token punctuation">,</span><span class="token string">'date’])['</span>_index'<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 展示结果</span>
In <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token punctuation">:</span>new_index_mean
Out<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token punctuation">:</span>
			keyword     date    
IX25        April        <span class="token number">29144.0</span>
            December     <span class="token number">32422.0</span>
            February     <span class="token number">28511.0</span>
            January      <span class="token number">32204.0</span>
            June           <span class="token number">882.0</span>
            March        <span class="token number">30081.0</span>
            May          <span class="token number">27164.0</span>
            November     <span class="token number">30810.0</span>
            October      <span class="token number">31611.0</span>
T<span class="token operator">-</span>CROSS     April       <span class="token number">150414.0</span>
            December         <span class="token number">0.0</span>
            February         <span class="token number">0.0</span>
            January          <span class="token number">0.0</span>
            June         <span class="token number">29702.0</span>
            March        <span class="token number">77619.0</span>
            May         <span class="token number">120753.0</span>
            November         <span class="token number">0.0</span>
            October          <span class="token number">0.0</span>
XR<span class="token operator">-</span>V        April         <span class="token number">6656.0</span>
            December      <span class="token number">7034.0</span>
            February      <span class="token number">6835.0</span>
            January       <span class="token number">6864.0</span>
            June           <span class="token number">207.0</span>
            March         <span class="token number">7227.0</span>
            May           <span class="token number">7046.0</span>
            November      <span class="token number">6745.0</span>
            October       <span class="token number">7421.0</span>
三菱ASX       April         <span class="token number">7067.0</span>
            December      <span class="token number">6015.0</span>
            February      <span class="token number">7012.0</span>
                          <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>   
长安CS15      May          <span class="token number">28927.0</span>
            November     <span class="token number">26988.0</span>
            October      <span class="token number">28556.0</span>
长安CS35      April        <span class="token number">74132.0</span>
            December    <span class="token number">469865.0</span>
            February    <span class="token number">118634.0</span>
            January     <span class="token number">200485.0</span>
            June          <span class="token number">2167.0</span>
            March       <span class="token number">103712.0</span>
            May          <span class="token number">78706.0</span>
            November    <span class="token number">347321.0</span>
            October      <span class="token number">92131.0</span>
长安CS35PLUS  April        <span class="token number">49649.0</span>
            December    <span class="token number">413372.0</span>
            February     <span class="token number">50194.0</span>
            January      <span class="token number">85418.0</span>
            June          <span class="token number">1444.0</span>
            March        <span class="token number">57344.0</span>
            May          <span class="token number">54125.0</span>
            November    <span class="token number">281566.0</span>
            October      <span class="token number">42239.0</span>
雪铁龙C3<span class="token operator">-</span>XR    April         <span class="token number">7291.0</span>
            December      <span class="token number">6717.0</span>
            February      <span class="token number">7118.0</span>
            January       <span class="token number">6622.0</span>
            June           <span class="token number">184.0</span>
            March         <span class="token number">9967.0</span>
            May           <span class="token number">6419.0</span>
            November      <span class="token number">6346.0</span>
            October       <span class="token number">7757.0</span>
Name<span class="token punctuation">:</span> _index<span class="token punctuation">,</span> Length<span class="token punctuation">:</span> <span class="token number">234</span><span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> float64
</code></pre> 
<h5><a id="2_107"></a>2、读取省份搜索指数数据</h5> 
<p>   通过我们观察省份搜索指数表，发现index最大值为1000，显示它并不是一个真实值，而是根据比例给出的比例值。上面我们已经得出各个车型在近半年每个月真实的搜索指数。那么，对于某一车型，根据某省份在全国的搜索占比，再乘以真的全国搜索指数，那么就能得到该车型在某一省份真实的搜索指数。</p> 
<h6><a id="_109"></a>代码实现</h6> 
<pre><code class="prism language-python"><span class="token comment"># 读取省份搜索指数数据</span>
In <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token punctuation">:</span>prov_index <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span><span class="token string">'province_index_0625.xlsx'</span><span class="token punctuation">)</span> 

<span class="token comment"># 同样对日期进行格式化处理</span>
In <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span> <span class="token punctuation">:</span>prov_index<span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span> <span class="token operator">=</span> prov_index<span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x <span class="token punctuation">:</span>x<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"|"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
		prov_index<span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span><span class="token operator">=</span>pd<span class="token punctuation">.</span>to_datetime<span class="token punctuation">(</span>prov_index<span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 格式化日期</span>
		prov_index<span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span> <span class="token operator">=</span> prov_index<span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>dt<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%B'</span><span class="token punctuation">)</span> <span class="token comment"># 将日期转换成月份</span>
		
<span class="token comment"># 对字段进行统一大写和去空格处理</span>
In <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token punctuation">:</span>prov_index<span class="token punctuation">[</span><span class="token string">'keyword'</span><span class="token punctuation">]</span> <span class="token operator">=</span> prov_index<span class="token punctuation">[</span><span class="token string">'keyword'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token string">' \r\n\t'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
In <span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span> <span class="token punctuation">:</span>prov_index<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
Out<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span> <span class="token punctuation">:</span>
	<span class="token builtin">id</span>	keyword	prov	prov_index	date
<span class="token number">0</span>	<span class="token number">1</span>	缤智		<span class="token number">913</span>			<span class="token number">1000</span>	December
<span class="token number">1</span>	<span class="token number">2</span>	缤智		<span class="token number">901</span>			<span class="token number">272</span>		December
<span class="token number">2</span>	<span class="token number">3</span>	缤智		<span class="token number">917</span>			<span class="token number">246</span>		December
<span class="token number">3</span>	<span class="token number">4</span>	缤智		<span class="token number">916</span>			<span class="token number">234</span>		December
<span class="token number">4</span>	<span class="token number">5</span>	缤智		<span class="token number">920</span>			<span class="token number">203</span>		December

<span class="token comment"># 根据keyword，date对搜索指数进行分类汇总，得出假的全国搜索指数</span>
In <span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> <span class="token punctuation">:</span>prov_index_sum <span class="token operator">=</span> prov_index<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'keyword'</span><span class="token punctuation">,</span><span class="token string">'date'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'prov_index'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 

<span class="token comment"># 分类汇总后得到的是一个Series，因为需要合并DataFrame，所以进行reset_index（）处理</span>
In <span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span> <span class="token punctuation">:</span>prov_index_sum <span class="token operator">=</span> prov_index_sum<span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span><span class="token punctuation">)</span>
		 prov_index_sum<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
Out<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span> <span class="token punctuation">:</span>
  index   keyword	date	prov_index
<span class="token number">0</span>	<span class="token number">0</span>		IX25	April		<span class="token number">7987</span>
<span class="token number">1</span>	<span class="token number">1</span>		IX25	December	<span class="token number">8257</span>
<span class="token number">2</span>	<span class="token number">2</span>		IX25	February	<span class="token number">8778</span>
<span class="token number">3</span>	<span class="token number">3</span>		IX25	January		<span class="token number">9291</span>
<span class="token number">4</span>	<span class="token number">4</span>		IX25	March		<span class="token number">8352</span>

<span class="token comment"># 数据合并，将总和列合并到省份DF</span>
In <span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span> <span class="token punctuation">:</span>prov_index2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>merge<span class="token punctuation">(</span>prov_index<span class="token punctuation">,</span>prov_index_sum<span class="token punctuation">,</span>on<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">"keyword"</span><span class="token punctuation">,</span><span class="token string">"date"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 根据省月份平均搜索指数/全国月份平均搜索指数得出搜索所占比</span>
In <span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span> <span class="token punctuation">:</span>prov_index2<span class="token punctuation">[</span><span class="token string">'pct'</span><span class="token punctuation">]</span> <span class="token operator">=</span> prov_index2<span class="token punctuation">[</span><span class="token string">'prov_index_x'</span><span class="token punctuation">]</span><span class="token operator">/</span>prov_index2<span class="token punctuation">[</span><span class="token string">'prov_index_y'</span><span class="token punctuation">]</span>
In <span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span> <span class="token punctuation">:</span>prov_index2<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
Out<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span> <span class="token punctuation">:</span>
	<span class="token builtin">id</span> keyword	prov	prov_index_x	date	prov_index_y	pct
<span class="token number">0</span>	<span class="token number">1</span>	缤智		<span class="token number">913</span>		<span class="token number">1000</span>		  December		<span class="token number">4116</span>	  <span class="token number">0.242954</span>
<span class="token number">1</span>	<span class="token number">2</span>	缤智		<span class="token number">901</span>		<span class="token number">272</span>			  December		<span class="token number">4116</span>	  <span class="token number">0.066084</span>
<span class="token number">2</span>	<span class="token number">3</span>	缤智		<span class="token number">917</span>		<span class="token number">246</span>			  December		<span class="token number">4116</span>	  <span class="token number">0.059767</span>
<span class="token number">3</span>	<span class="token number">4</span>	缤智		<span class="token number">916</span>		<span class="token number">234</span>			  December		<span class="token number">4116</span>	  <span class="token number">0.056851</span>
<span class="token number">4</span>	<span class="token number">5</span>	缤智		<span class="token number">920</span>		<span class="token number">203</span>			  December		<span class="token number">4116</span>	  <span class="token number">0.049320</span>
In <span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span> <span class="token punctuation">:</span>new_index_mean <span class="token operator">=</span> new_index_mean<span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span><span class="token punctuation">)</span>
In <span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">]</span> <span class="token punctuation">:</span>new_index_mean

<span class="token comment"># 将真实全国搜索指数合并到省份表</span>
In <span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span> <span class="token punctuation">:</span>prov_index_final <span class="token operator">=</span> pd<span class="token punctuation">.</span>merge<span class="token punctuation">(</span>prov_index2<span class="token punctuation">,</span>new_index_mean<span class="token punctuation">,</span>on<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'keyword'</span><span class="token punctuation">,</span><span class="token string">'date'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 省份占比 * 真实搜索指数 = 省份真实搜索指数</span>
In <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span> <span class="token punctuation">:</span>prov_index_final<span class="token punctuation">[</span><span class="token string">'real_prov_index'</span><span class="token punctuation">]</span> <span class="token operator">=</span> prov_index_final<span class="token punctuation">[</span><span class="token string">'pct'</span><span class="token punctuation">]</span> <span class="token operator">*</span>prov_index_final<span class="token punctuation">[</span><span class="token string">'_index'</span><span class="token punctuation">]</span>
		 prov_index_final<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
Out<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span> <span class="token punctuation">:</span>


<span class="token builtin">id</span>	keyword	prov	prov_index_x	date	prov_index_y	pct			index		_index	   real_prov_index
<span class="token number">0</span>	<span class="token number">1</span>	缤智	<span class="token number">913</span>			<span class="token number">1000</span>		December	<span class="token number">4116</span>		<span class="token number">0.242954</span>	<span class="token number">163</span>			<span class="token number">82882.0</span>		<span class="token number">20136.540330</span>
<span class="token number">1</span>	<span class="token number">2</span>	缤智	<span class="token number">901</span>			<span class="token number">272</span>			December	<span class="token number">4116</span>		<span class="token number">0.066084</span>	<span class="token number">163</span>			<span class="token number">82882.0</span>		<span class="token number">5477.138970</span>
<span class="token number">2</span>	<span class="token number">3</span>	缤智	<span class="token number">917</span>			<span class="token number">246</span>			December	<span class="token number">4116</span>		<span class="token number">0.059767</span>	<span class="token number">163</span>			<span class="token number">82882.0</span>		<span class="token number">4953.588921</span>
<span class="token number">3</span>	<span class="token number">4</span>	缤智	<span class="token number">916</span>			<span class="token number">234</span>			December	<span class="token number">4116</span>		<span class="token number">0.056851</span>	<span class="token number">163</span>			<span class="token number">82882.0</span>		<span class="token number">4711.950437</span>
<span class="token number">4</span>	<span class="token number">5</span>	缤智	<span class="token number">920</span>			<span class="token number">203</span>			December	<span class="token number">4116</span>		<span class="token number">0.049320</span>	<span class="token number">163</span>			<span class="token number">82882.0</span>		<span class="token number">4087.717687</span>

<span class="token comment"># 省份在这里是以ID的形式展示出来，需要将其与省份ID对照表合并</span>
In <span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">]</span> <span class="token punctuation">:</span>prov_index_final <span class="token operator">=</span> pd<span class="token punctuation">.</span>merge<span class="token punctuation">(</span>prov_index_final<span class="token punctuation">,</span>prov_id<span class="token punctuation">,</span>left_on<span class="token operator">=</span><span class="token string">"prov"</span><span class="token punctuation">,</span>right_on<span class="token operator">=</span><span class="token string">"id"</span><span class="token punctuation">)</span>

<span class="token comment"># 输出成excel</span>
In <span class="token punctuation">[</span><span class="token number">22</span><span class="token punctuation">]</span> <span class="token punctuation">:</span>prov_index_final<span class="token punctuation">.</span>to_excel<span class="token punctuation">(</span><span class="token string">'prov_index_final.xlsx'</span><span class="token punctuation">)</span>
</code></pre> 
<h5><a id="3_183"></a>3、根据省份处理城市搜索指数</h5> 
<pre><code class="prism language-python">In <span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">]</span> <span class="token punctuation">:</span>city_index <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span><span class="token string">'city_index_0625.xlsx'</span><span class="token punctuation">)</span>
In <span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span> <span class="token punctuation">:</span>city_index<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token builtin">id</span>	keyword	city city_index	prov		date
<span class="token number">0</span>	<span class="token number">1</span>	缤智		<span class="token number">77</span>		<span class="token number">1000</span>	<span class="token number">901</span>		<span class="token number">2018</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">|</span><span class="token number">2018</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">31</span>
<span class="token number">1</span>	<span class="token number">2</span>	缤智		<span class="token number">1</span>		<span class="token number">934</span>		<span class="token number">901</span>		<span class="token number">2018</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">|</span><span class="token number">2018</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">31</span>
<span class="token number">2</span>	<span class="token number">3</span>	缤智		<span class="token number">79</span>		<span class="token number">699</span>		<span class="token number">901</span>		<span class="token number">2018</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">|</span><span class="token number">2018</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">31</span>
<span class="token number">3</span>	<span class="token number">4</span>	缤智		<span class="token number">80</span>		<span class="token number">414</span>		<span class="token number">901</span>		<span class="token number">2018</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">|</span><span class="token number">2018</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">31</span>
<span class="token number">4</span>	<span class="token number">5</span>	缤智		<span class="token number">78</span>		<span class="token number">165</span>		<span class="token number">901</span>		<span class="token number">2018</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">|</span><span class="token number">2018</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">31</span>

<span class="token comment"># 对date进行处理，格式化，并转成月份</span>
Out<span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span> <span class="token punctuation">:</span>city_index<span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span> <span class="token operator">=</span> city_index<span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x <span class="token punctuation">:</span>x<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"|"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
		 city_index<span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span><span class="token operator">=</span>pd<span class="token punctuation">.</span>to_datetime<span class="token punctuation">(</span>city_index<span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
		 city_index<span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span> <span class="token operator">=</span> city_index<span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>dt<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%B'</span><span class="token punctuation">)</span>
		 
<span class="token comment">#根据keyword，date，prov对城市搜索指数进行分类汇总求和</span>
In <span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token punctuation">:</span>city_index_sum <span class="token operator">=</span> city_index<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'keyword'</span><span class="token punctuation">,</span><span class="token string">'date'</span><span class="token punctuation">,</span><span class="token string">'prov'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'city_index'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
In <span class="token punctuation">[</span><span class="token number">26</span><span class="token punctuation">]</span> <span class="token punctuation">:</span>city_index_sum <span class="token operator">=</span> city_index_sum<span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 将求和后的df与原df合并</span>
In <span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">]</span> <span class="token punctuation">:</span>city_index2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>merge<span class="token punctuation">(</span>city_index<span class="token punctuation">,</span>city_index_sum<span class="token punctuation">,</span>on<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">"keyword"</span><span class="token punctuation">,</span><span class="token string">"date"</span><span class="token punctuation">,</span><span class="token string">"prov"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 求出城市在该城市所在省所占比</span>
In <span class="token punctuation">[</span><span class="token number">28</span><span class="token punctuation">]</span> <span class="token punctuation">:</span>city_index2<span class="token punctuation">[</span><span class="token string">'pct'</span><span class="token punctuation">]</span> <span class="token operator">=</span> city_index2<span class="token punctuation">[</span><span class="token string">'city_index_x'</span><span class="token punctuation">]</span><span class="token operator">/</span>city_index2<span class="token punctuation">[</span><span class="token string">'city_index_y'</span><span class="token punctuation">]</span>
In <span class="token punctuation">[</span><span class="token number">29</span><span class="token punctuation">]</span> <span class="token punctuation">:</span>city_index2<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
Out<span class="token punctuation">[</span><span class="token number">29</span><span class="token punctuation">]</span> <span class="token punctuation">:</span>
	<span class="token builtin">id</span>	keyword	city city_index_x	prov	date	city_index_y	pct
<span class="token number">0</span>	<span class="token number">1</span>	缤智		<span class="token number">77</span>		<span class="token number">1000</span>		<span class="token number">901</span>	  December		<span class="token number">4195</span>	<span class="token number">0.238379</span>
<span class="token number">1</span>	<span class="token number">2</span>	缤智		<span class="token number">1</span>		<span class="token number">934</span>			<span class="token number">901</span>	  December		<span class="token number">4195</span>	<span class="token number">0.222646</span>
<span class="token number">2</span>	<span class="token number">3</span>	缤智		<span class="token number">79</span>		<span class="token number">699</span>			<span class="token number">901</span>	  December		<span class="token number">4195</span>	<span class="token number">0.166627</span>
<span class="token number">3</span>	<span class="token number">4</span>	缤智		<span class="token number">80</span>		<span class="token number">414</span>			<span class="token number">901</span>	  December		<span class="token number">4195</span>	<span class="token number">0.098689</span>
<span class="token number">4</span>	<span class="token number">5</span>	缤智		<span class="token number">78</span>		<span class="token number">165</span>			<span class="token number">901</span>	  December		<span class="token number">4195</span>	<span class="token number">0.039333</span>

<span class="token comment"># 对求出的城市搜索占比与真实省份搜索指数进行合并</span>
In <span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">]</span> <span class="token punctuation">:</span>city_index_final <span class="token operator">=</span> pd<span class="token punctuation">.</span>merge<span class="token punctuation">(</span>city_index2<span class="token punctuation">,</span>prov_index_final<span class="token punctuation">,</span>on<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'keyword'</span><span class="token punctuation">,</span><span class="token string">'prov'</span><span class="token punctuation">,</span><span class="token string">'date'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 城市占比 * 省份真实搜索指数 = 城市真实指数</span>
In <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">]</span> <span class="token punctuation">:</span>city_index_final<span class="token punctuation">[</span><span class="token string">"real_city_index"</span><span class="token punctuation">]</span> <span class="token operator">=</span> city_index_final<span class="token punctuation">[</span><span class="token string">'pct_x'</span><span class="token punctuation">]</span><span class="token operator">*</span>city_index_final<span class="token punctuation">[</span><span class="token string">'real_prov_index'</span><span class="token punctuation">]</span>

<span class="token comment"># 与城市ID对照表进行合并并输出</span>
In <span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span> <span class="token punctuation">:</span>city_index_final <span class="token operator">=</span> pd<span class="token punctuation">.</span>merge<span class="token punctuation">(</span>city_index_final<span class="token punctuation">,</span>city_id<span class="token punctuation">,</span>left_on<span class="token operator">=</span><span class="token string">'city'</span><span class="token punctuation">,</span>right_on<span class="token operator">=</span><span class="token string">"id"</span><span class="token punctuation">)</span>
	  	 city_index_final<span class="token punctuation">.</span>to_excel<span class="token punctuation">(</span><span class="token string">'city_index_final_0625.xlsx'</span><span class="token punctuation">)</span>

</code></pre> 
<h3><a id="_228"></a>三、总结</h3> 
<p>  整片代码只是简单的Pandas数据处理练习，主要包含数据字段处理，数据合并，数据计算，整体来说并不是很难。<br>   有时间考虑一下数据可视化QAQ！鼓得拜！！</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ad4d3a791f957fdd9478fdf72162e78a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">并发事务带来哪些问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6be0eb40bdd1010d4ba93274d184d984/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">查看Oracle数据库所有的用户及表空间等</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>