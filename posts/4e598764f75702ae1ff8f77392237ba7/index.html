<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Live2D(Cubism3.x)网页看板娘设置（二） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Live2D(Cubism3.x)网页看板娘设置（二）" />
<meta property="og:description" content="教程已经更新，如果你是第一次看这个系列的请移步下方链接 Live2D(WebSDK 4.X)网页看板娘设置（一）
live2d（Web SDK 4.x）Web看板娘进阶
这篇文章的操作内容已经更新到官方最新的SDK，但视频还未及时更新，由于新版与旧版大多是目录结构上的差异，所以影响并不大
上一期主要讲了官方的Demo的修改方法，导入自己的模型文件并导出编译后的js脚本。
但是由于我们用的是官方Demo，人物的交互方式并不符合我们要求，而且页面布局也有问题。
本期就解决部分交互问题和页面布局。
本期所做的修改请一定要使用官方提供的人物模型进行测试
1. Typescript源文件修改 1.1修改过程中涉及的文件（src内的） 文件名作用Demo\src\lappdefine.ts主要用来改变加载的模型文件Demo\src\lappdelegate.ts这个文件我们修改的比较多，将网页的各种事件传递给模型加载器，负责人机交互的功能Demo\src\lappview.ts主要是将鼠标坐标转为模型核心驱动需要的坐标的，也可以对一些事件进行更有针对性的定制 1.2 去掉Demo中不需要的背景图案和切换模型的按钮 demo中的模型占据了整个网页正中央，而且右上角还带有齿轮切换标志，直接作为看板娘是肯定不行的啦，下面来说一下如何去掉背景图片和齿轮图案。我们找到Sample\TypeScript\Demo\src\lappview.ts文件，定位至以下位置，将我们不需要的功能注释掉。
initializeSprite()函数
/** * 执行图像初始化 */ public initializeSprite(): void { let width: number = canvas.width; let height: number = canvas.height; let textureManager = LAppDelegate.getInstance().getTextureManager(); const resourcesPath = LAppDefine.ResourcesPath; let imageName: string = &#34;&#34;; //注释掉所有图片加载方法 /** // 背景画像初期化 imageName = LAppDefine.BackImageName; // 创建回调函数，因为它是异步的 let initBackGroundTexture = (textureInfo: TextureInfo): void =&gt; { let x: number = width * 0." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/4e598764f75702ae1ff8f77392237ba7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-03-13T13:07:10+08:00" />
<meta property="article:modified_time" content="2020-03-13T13:07:10+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Live2D(Cubism3.x)网页看板娘设置（二）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>教程已经更新，如果你是第一次看这个系列的请移步下方链接</h3> 
<p><strong><a href="https://blog.csdn.net/qq_37735413/article/details/104769280">Live2D(WebSDK 4.X)网页看板娘设置（一）</a></strong><br> <strong><a href="https://blog.csdn.net/qq_37735413/article/details/119413744">live2d（Web SDK 4.x）Web看板娘进阶</a></strong><br> <strong>这篇文章的操作内容已经更新到官方最新的SDK，但视频还未及时更新，由于新版与旧版大多是目录结构上的差异，所以影响并不大</strong></p> 
<p>上一期主要讲了官方的Demo的修改方法，导入自己的模型文件并导出编译后的js脚本。<br> 但是由于我们用的是官方Demo，人物的<strong>交互方式</strong>并不符合我们要求，而且<strong>页面布局</strong>也有问题。<br> 本期就解决部分交互问题和页面布局。</p> 
<p><strong>本期所做的修改请一定要使用官方提供的人物模型进行测试</strong></p> 
<h3><a id="1_Typescript_11"></a>1. Typescript源文件修改</h3> 
<h5><a id="11src_12"></a>1.1修改过程中涉及的文件（src内的）</h5> 
<table><thead><tr><th>文件名</th><th>作用</th></tr></thead><tbody><tr><td>Demo\src\lappdefine.ts</td><td>主要用来改变加载的模型文件</td></tr><tr><td>Demo\src\lappdelegate.ts</td><td>这个文件我们修改的比较多，将网页的各种事件传递给模型加载器，负责人机交互的功能</td></tr><tr><td>Demo\src\lappview.ts</td><td>主要是将鼠标坐标转为模型核心驱动需要的坐标的，也可以对一些事件进行更有针对性的定制</td></tr></tbody></table> 
<h5><a id="12_Demo_18"></a>1.2 去掉Demo中不需要的背景图案和切换模型的按钮</h5> 
<p>demo中的模型占据了整个网页正中央，而且右上角还带有齿轮切换标志，直接作为看板娘是肯定不行的啦，下面来说一下如何去掉背景图片和齿轮图案。我们找到<strong>Sample\TypeScript\Demo\src\lappview.ts</strong>文件，定位至以下位置，将我们不需要的功能注释掉。</p> 
<p><strong>initializeSprite()函数</strong></p> 
<pre><code class="prism language-javascript">  <span class="token comment">/**
     * 执行图像初始化
     */</span>
    <span class="token keyword">public</span> <span class="token function">initializeSprite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">let</span> width<span class="token operator">:</span> number <span class="token operator">=</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
        <span class="token keyword">let</span> height<span class="token operator">:</span> number <span class="token operator">=</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">;</span>

        <span class="token keyword">let</span> textureManager <span class="token operator">=</span> LAppDelegate<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTextureManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> resourcesPath <span class="token operator">=</span> LAppDefine<span class="token punctuation">.</span>ResourcesPath<span class="token punctuation">;</span>
        <span class="token keyword">let</span> imageName<span class="token operator">:</span> string <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
        <span class="token comment">//注释掉所有图片加载方法</span>
    <span class="token comment">/** 
        // 背景画像初期化
        imageName = LAppDefine.BackImageName;
        // 创建回调函数，因为它是异步的
        let initBackGroundTexture = (textureInfo: TextureInfo): void =&gt;
        {
            let x: number = width * 0.5;
            let y: number = height * 0.5;
            let fwidth = textureInfo.width * 2.0;
            let fheight = height * 0.95;
            this._back = new LAppSprite(x, y, fwidth, fheight, textureInfo.id);
        };
         //将背景图片的注释掉
        textureManager.createTextureFromPngFile(resourcesPath + imageName, false, initBackGroundTexture);
        // 歯車画像初期化
        imageName = LAppDefine.GearImageName;
        let initGearTexture = (textureInfo: TextureInfo): void =&gt;
        {
            let x = width - textureInfo.width * 0.5;
            let y = height - textureInfo.height * 0.5;
            let fwidth = textureInfo.width;
            let fheight = textureInfo.height;
            this._gear = new LAppSprite(x, y, fwidth, fheight, textureInfo.id);
        };
        textureManager.createTextureFromPngFile(resourcesPath + imageName, false, initGearTexture);
*/</span>
        <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
        省略其他代码
        <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p><strong>onTouchesEnded函数</strong></p> 
<pre><code class="prism language-javascript"><span class="token keyword">public</span> <span class="token function">onTouchesEnded</span><span class="token punctuation">(</span>pointX<span class="token operator">:</span> number<span class="token punctuation">,</span> pointY<span class="token operator">:</span> number<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 触摸结束</span>
        <span class="token keyword">let</span> live2DManager<span class="token operator">:</span> LAppLive2DManager <span class="token operator">=</span> LAppLive2DManager<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        live2DManager<span class="token punctuation">.</span><span class="token function">onDrag</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">let</span> x<span class="token operator">:</span> number <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_deviceToScreen<span class="token punctuation">.</span><span class="token function">transformX</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_touchManager<span class="token punctuation">.</span><span class="token function">getX</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 論理座標変換した座標を取得。</span>
            <span class="token keyword">let</span> y<span class="token operator">:</span> number <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_deviceToScreen<span class="token punctuation">.</span><span class="token function">transformY</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_touchManager<span class="token punctuation">.</span><span class="token function">getY</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 論理座標変化した座標を取得。</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>LAppDefine<span class="token punctuation">.</span>DebugTouchLogEnable<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                LAppPal<span class="token punctuation">.</span><span class="token function">printLog</span><span class="token punctuation">(</span><span class="token string">"[APP]touchesEnded x: {0} y: {1}"</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            live2DManager<span class="token punctuation">.</span><span class="token function">onTap</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">/*
            // 点击了齿轮，调用live2D管理器切换人物模型
            if(this._gear.isHit(pointX, pointY))
            {
                live2DManager.nextScene();
            }
          */</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>修改完毕后再次编译打开就会发现背景图片和齿轮图案没了，但是整个页面都是黑色的。<br> 接下来把背景调整成透明的。<br> 找到<strong>Sample\TypeScript\Demo\src\lappdelegate.ts</strong>的<strong>run函数</strong></p> 
<pre><code class="prism language-javascript"> <span class="token comment">/**
     * 実行処理。
     */</span>
    <span class="token keyword">public</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// メインループ</span>
        <span class="token keyword">let</span> <span class="token function-variable function">loop</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// インスタンスの有無の確認</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>s_instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
            <span class="token comment">// 時間更新</span>
            LAppPal<span class="token punctuation">.</span><span class="token function">updateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token comment">// 画面の初期化</span>
            <span class="token comment">//这里时初始化背景的，四个参数分别是 r g b a</span>
            <span class="token comment">//原本的参数是0，0，0，1</span>
            <span class="token comment">//我们把它改成0，0，0，0</span>
            gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
                    省略<span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
            <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>再次编译查看应该就修改成功了。修改完背景后，我们修改模型在页面中的布局。<br> 整个布局是复制的大佬Github中的布局文件：<br> <a href="https://github.com/galnetwen/Live2D">适用于旧版模型的Live2D项目</a><br> 我们这里把他的代码抄过来：<br> 项目下载下来后我们首先把<strong>live2d文件夹拷贝</strong>到我们的项目中，并把该文件夹里的<strong>js/live2d.js</strong>（这个其实就是我们编译后的bundle.js，好像还有一个live2d相关的核心js文件，有的话一并删除）文件<strong>删除</strong><br> 接下来用文本编辑器打开**demo.html.**将相关css和js内容引入到我们项目中的html页面内</p> 
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="utf-8"&gt;
	&lt;title&gt;Live2D！把可爱的看板娘扑捉到你的博客去吧！&lt;/title&gt;
    &lt;link rel="stylesheet" href="/live2d/css/live2d.css" /&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;!-- 这一段直接拷贝过去就行，id和class如果要自行修改的话，将刚才复制的live2d内的js和css文件的相关内容也进行修改 --&gt;
&lt;div id="landlord"&gt;
    &lt;div class="message" style="opacity:0"&gt;&lt;/div&gt;
    &lt;canvas id="live2d" width="280" height="250" class="live2d"&gt;&lt;/canvas&gt;
    &lt;div class="hide-button"&gt;隐藏&lt;/div&gt;
&lt;/div&gt;

&lt;!--引入相关js脚本--&gt;
&lt;script type="text/javascript" src="https://cdn.bootcss.com/jquery/2.2.4/jquery.min.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript"&gt;
    var message_Path = '/live2d/'
   
    //这个home_path可要可不要
    var home_Path = 'https://haremu.com/'

&lt;/script&gt;
&lt;!--这个就不要引用了，我们刚才删除了--&gt;
&lt;script type="text/javascript" src="/live2d/js/live2d.js"&gt;&lt;/script&gt;

&lt;script type="text/javascript" src="/live2d/js/message.js"&gt;&lt;/script&gt;

&lt;!--这个也没用，不需要复制过来--&gt;
&lt;script type="text/javascript"&gt;
    loadlive2d("live2d", "/live2d/model/tia/model.json");
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre> 
<p>然后打开【<strong>Samples\TypeScript\Demo\src\lappdelegate.ts</strong>】找到<strong>initialize()</strong> 函数并 <strong>删除</strong>下面的代码：</p> 
<pre><code class="prism language-javascript"> <span class="token comment">// キャンバスの作成</span>
    canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'canvas'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> LAppDefine<span class="token punctuation">.</span>RenderTargetWidth<span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> LAppDefine<span class="token punctuation">.</span>RenderTargetHeight<span class="token punctuation">;</span>
	<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
	<span class="token comment">// キャンバスを DOM に追加</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>删除后加入以下内容：</p> 
<pre><code class="prism language-javascript"><span class="token comment">//这里时获取html页面里的canvas元素的，id值需要根据实际情况变动</span>
canvas <span class="token operator">=</span> <span class="token operator">&lt;</span>HTMLCanvasElement<span class="token operator">&gt;</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"live2d"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这一步做完后再次编译运行，就能在浏览器左下角看到我们的看板娘了，但是这时会发现我们的看板娘太小了。<br> 接下来就来进行放大操作<br> <strong>打开Framework\math\cubismmodelmatrix.ts文件</strong></p> 
<pre><code class="prism language-javascript">  <span class="token comment">/**
         * 横幅を設定
         *
         * @param w 横幅
         */</span>
        <span class="token keyword">public</span> <span class="token function">setWidth</span><span class="token punctuation">(</span>w<span class="token operator">:</span> number<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">const</span> scaleX<span class="token operator">:</span> number <span class="token operator">=</span> w <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_width<span class="token punctuation">;</span>
            <span class="token keyword">const</span> scaleY<span class="token operator">:</span> number <span class="token operator">=</span> scaleX<span class="token punctuation">;</span>
            <span class="token comment">//先放大到二倍试试，想放大多少倍在后面乘以相应倍率就行了</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span>scaleX<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">,</span> scaleY<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">/**
         * 縦幅を設定
         * @param h 縦幅
         */</span>
        <span class="token keyword">public</span> <span class="token function">setHeight</span><span class="token punctuation">(</span>h<span class="token operator">:</span> number<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">const</span> scaleX<span class="token operator">:</span> number <span class="token operator">=</span> h <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_height<span class="token punctuation">;</span>
            <span class="token keyword">const</span> scaleY<span class="token operator">:</span> number <span class="token operator">=</span> scaleX<span class="token punctuation">;</span>
            <span class="token comment">//这里也是</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span>scaleX<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">,</span> scaleY<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

</code></pre> 
<p>进行到这一步，整个看板娘的布局就搞定了。接下来是交互问题，官方的鼠标交互方式是按下鼠标人物才会跟随，而我们要的是一直跟随鼠标移动。<br> 打开<strong>Sample\TypeScript\Demo\src\lappdelegate.ts</strong> 文件的**initialize()**函数内添加以下内容：</p> 
<pre><code class="prism language-javascript"><span class="token keyword">public</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> boolean
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// キャンバスの取得</span>
        
        <span class="token comment">//注意！这里时获取html页面里的canvas元素的，id值需要根据实际情况变动</span>
        canvas <span class="token operator">=</span> <span class="token operator">&lt;</span>HTMLCanvasElement<span class="token operator">&gt;</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"live2d"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       
        <span class="token comment">//添加全局鼠标移动事件监控</span>
         document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"mousemove"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
          
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>LAppDelegate<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>_view<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                LAppPal<span class="token punctuation">.</span><span class="token function">printLog</span><span class="token punctuation">(</span><span class="token string">"view notfound"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          
       		<span class="token comment">//这里id的值与上方的 cavans 变量保持一致</span>
            <span class="token keyword">let</span> rect <span class="token operator">=</span>  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"live2d"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> posX<span class="token operator">:</span> number <span class="token operator">=</span> e<span class="token punctuation">.</span>clientX <span class="token operator">-</span>rect<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
            <span class="token keyword">let</span> posY<span class="token operator">:</span> number <span class="token operator">=</span> e<span class="token punctuation">.</span>clientY <span class="token operator">-</span> rect<span class="token punctuation">.</span>top <span class="token punctuation">;</span>
           <span class="token comment">// console.log("onMouseMoved: gate文件中posY值为： 【"+posY+"】  canvas的top距离为："+rect.top);</span>
            LAppDelegate<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>_view<span class="token punctuation">.</span><span class="token function">onTouchesMoved</span><span class="token punctuation">(</span>posX<span class="token punctuation">,</span> posY<span class="token punctuation">)</span><span class="token punctuation">;</span>
            
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//在这里加上鼠标离开浏览器后，一切归位</span>
        document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"mouseout"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token comment">//鼠标离开document后，将其位置置为（0，0）  </span>
            <span class="token keyword">let</span> live2DManager<span class="token operator">:</span> LAppLive2DManager <span class="token operator">=</span> LAppLive2DManager<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            live2DManager<span class="token punctuation">.</span><span class="token function">onDrag</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">//添加鼠标点击事件</span>
      <span class="token comment">//监听cavas的鼠标点击事件,如果你希望在鼠标点击页面元素后</span>
      <span class="token comment">//看板娘不在看向鼠标，直到你再次移动鼠标，把监听事件对象从canvas换成document</span>
      canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>LAppDelegate<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>_view<span class="token punctuation">)</span>
          <span class="token punctuation">{<!-- --></span>
              LAppPal<span class="token punctuation">.</span><span class="token function">printMessage</span><span class="token punctuation">(</span><span class="token string">"view notfound"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword">return</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">let</span> rect <span class="token operator">=</span>  canvas<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">let</span> posX<span class="token operator">:</span> number <span class="token operator">=</span> e<span class="token punctuation">.</span>clientX <span class="token operator">-</span>rect<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
          <span class="token keyword">let</span> posY<span class="token operator">:</span> number <span class="token operator">=</span> e<span class="token punctuation">.</span>clientY <span class="token operator">-</span> rect<span class="token punctuation">.</span>top <span class="token punctuation">;</span>
         <span class="token comment">// console.log("onMouseMoved: gate文件中posY值为： 【"+posY+"】  canvas的top距离为："+rect.top);</span>
         <span class="token comment">//其实就是照抄上面的，把下面两行代码加上</span>
          LAppDelegate<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>_view<span class="token punctuation">.</span><span class="token function">onTouchesBegan</span><span class="token punctuation">(</span>posX<span class="token punctuation">,</span> posY<span class="token punctuation">)</span><span class="token punctuation">;</span>
          LAppDelegate<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>_view<span class="token punctuation">.</span><span class="token function">onTouchesEnded</span><span class="token punctuation">(</span>posX<span class="token punctuation">,</span> posY<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
		         省略<span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
		<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
    <span class="token punctuation">}</span>

</code></pre> 
<p>好了，至此鼠标的交互事件解决一部分了。</p> 
<h5><a id="_272"></a>附上相关视频：</h5> 
<p>视频是直接录制的，而且是beta2版本的操作演示，目前文章内容已经更新到最新版本，不一样的代码请以文章为准，并未进行后期处理，里面有错字的地方还请多多包涵<br> </p> 
<div class="csdn-video-box"> 
 <iframe id="V3IHU5jp-1584075657867" frameborder="0" src="https://player.bilibili.com/player.html?aid=94956164" allowfullscreen="true" data-mediaembed="bilibili"></iframe> 
 <p>Live2D网页看板娘设置教程(二)</p> 
</div> 
<p></p> 
<p><strong>下一期讲导入的自定义模型无法进行交互的问题的解决方案</strong></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/432b60ef0473591e8607e16fdd890392/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">PointAugment：一种自动增强的点云分类框架</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4493ba55671896f18273b4ac41eb719a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">mysql5.7 索引where和orderby排序问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>