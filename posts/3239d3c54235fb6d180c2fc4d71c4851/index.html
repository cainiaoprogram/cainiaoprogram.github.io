<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Upload-labs（Pass7-8） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Upload-labs（Pass7-8）" />
<meta property="og:description" content="前言
作者简介：不知名白帽，网络安全学习者。
博客主页：https://blog.csdn.net/m0_63127854?type=blog
Upload-labs专栏：https://blog.csdn.net/m0_63127854/category_11850783.html
网络安全交流社区：https://bbs.csdn.net/forums/angluoanquan
练习网站：upload-labs
注意： 能运行&lt;?php phpinfo();?&gt;
就能运行&lt;?php eval($_POST[&#39;cmd&#39;])?&gt;一句话木马
本文使用&lt;?php phpinfo();?&gt;主要是为了简便
知识点 $_FILES[表单提交过来的name]
[name]:获取到的文件名
[type]: 获取到的文件类型(MIMETYPE)
[tmp_name]:文件临时存放的路径
[error]: 上传文件报错信息(为空则上传成功)
[size]:上传文件的大小
Move_uploaded_file(需要移动的文件,要移动到的位置)
Strrchr(指定字符串,匹配的字符) --指针指到指定的字符的位置，取之后的值
Trim() --去除字符串中的前后空格
Rtrim() --去除右空格
Ltrim() --去除左空格
Strtolower() --将字符串转为小写
Str_ireplace --(被转换的字符串，替换成的字符串，需要查找的字符串)
在需要查找的字符串中查找需要被替换的字符串，替换为指定的字符串
Pass-07 代码： $is_upload = false; $msg = null; if (isset($_POST[&#39;submit&#39;])) { if (file_exists(UPLOAD_PATH)) { $deny_ext = array(&#34;.php&#34;,&#34;.php5&#34;,&#34;.php4&#34;,&#34;.php3&#34;,&#34;.php2&#34;,&#34;.html&#34;,&#34;.htm&#34;,&#34;.phtml&#34;,&#34;.pht&#34;,&#34;.pHp&#34;,&#34;.pHp5&#34;,&#34;.pHp4&#34;,&#34;.pHp3&#34;,&#34;.pHp2&#34;,&#34;.Html&#34;,&#34;.Htm&#34;,&#34;.pHtml&#34;,&#34;.jsp&#34;,&#34;.jspa&#34;,&#34;.jspx&#34;,&#34;.jsw&#34;,&#34;.jsv&#34;,&#34;.jspf&#34;,&#34;.jtml&#34;,&#34;.jSp&#34;,&#34;.jSpx&#34;,&#34;.jSpa&#34;,&#34;.jSw&#34;,&#34;.jSv&#34;,&#34;.jSpf&#34;,&#34;.jHtml&#34;,&#34;.asp&#34;,&#34;.aspx&#34;,&#34;.asa&#34;,&#34;.asax&#34;,&#34;.ascx&#34;,&#34;.ashx&#34;,&#34;.asmx&#34;,&#34;.cer&#34;,&#34;.aSp&#34;,&#34;.aSpx&#34;,&#34;.aSa&#34;,&#34;.aSax&#34;,&#34;.aScx&#34;,&#34;.aShx&#34;,&#34;.aSmx&#34;,&#34;.cEr&#34;,&#34;.sWf&#34;,&#34;.swf&#34;,&#34;.htaccess&#34;,&#34;.ini&#34;); $file_name = $_FILES[&#39;upload_file&#39;][&#39;name&#39;]; $file_name = deldot($file_name);//删除文件名末尾的点 $file_ext = strrchr($file_name, &#39;.&#39;); $file_ext = strtolower($file_ext); //转换为小写 $file_ext = str_ireplace(&#39;::$DATA&#39;, &#39;&#39;, $file_ext);//去除字符串::$DATA if (!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/3239d3c54235fb6d180c2fc4d71c4851/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-09-14T17:13:08+08:00" />
<meta property="article:modified_time" content="2022-09-14T17:13:08+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Upload-labs（Pass7-8）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <blockquote> 
 <p><strong><strong>前言</strong></strong></p> 
 <p>作者简介：不知名白帽，网络安全学习者。</p> 
 <p>博客主页：<a href="https://blog.csdn.net/m0_63127854?type=blog" title="https://blog.csdn.net/m0_63127854?type=blog">https://blog.csdn.net/m0_63127854?type=blog</a></p> 
 <p>Upload-labs专栏：<a href="https://blog.csdn.net/m0_63127854/category_11850783.html" title="https://blog.csdn.net/m0_63127854/category_11850783.html">https://blog.csdn.net/m0_63127854/category_11850783.html</a></p> 
 <p>网络安全交流社区：<a href="https://bbs.csdn.net/forums/angluoanquan" title="https://bbs.csdn.net/forums/angluoanquan">https://bbs.csdn.net/forums/angluoanquan</a></p> 
</blockquote> 
<p>练习网站：<a href="http://124.223.167.236:9000/Pass-03/index.php" rel="nofollow" title="upload-labs">upload-labs</a></p> 
<p><img alt="" height="796" src="https://images2.imgbox.com/52/d8/0Cgl5wlL_o.png" width="1200"></p> 
<p></p> 
<h2><a name="t0"></a><span style="color:#ff9900;">注意：</span></h2> 
<p><span style="color:#ff9900;">能运行&lt;?php phpinfo();?&gt;</span></p> 
<p><span style="color:#ff9900;">就能运行&lt;?php eval($_POST['cmd'])?&gt;一句话木马</span></p> 
<p><span style="color:#ff9900;">本文使用&lt;?php phpinfo();?&gt;主要是为了简便</span></p> 
<h2><span style="color:#0d0016;">知识点</span></h2> 
<p></p> 
<p style="margin-left:.0001pt;text-align:justify;">$_FILES[表单提交过来的name]</p> 
<p style="margin-left:.0001pt;text-align:justify;">[name]:获取到的文件名</p> 
<p style="margin-left:.0001pt;text-align:justify;">[type]: 获取到的文件类型(MIMETYPE)</p> 
<p style="margin-left:.0001pt;text-align:justify;">[tmp_name]:文件临时存放的路径</p> 
<p style="margin-left:.0001pt;text-align:justify;">[error]: 上传文件报错信息(为空则上传成功)</p> 
<p style="margin-left:.0001pt;text-align:justify;">[size]:上传文件的大小</p> 
<p style="margin-left:.0001pt;text-align:justify;">Move_uploaded_file(需要移动的文件,要移动到的位置)</p> 
<p style="margin-left:.0001pt;text-align:justify;">Strrchr(指定字符串,匹配的字符) --指针指到指定的字符的位置，取之后的值</p> 
<p style="margin-left:.0001pt;text-align:justify;">Trim() --去除字符串中的前后空格</p> 
<p style="margin-left:.0001pt;text-align:justify;">Rtrim() --去除右空格</p> 
<p style="margin-left:.0001pt;text-align:justify;">Ltrim() --去除左空格</p> 
<p style="margin-left:.0001pt;text-align:justify;">Strtolower() --将字符串转为小写</p> 
<p style="margin-left:.0001pt;text-align:justify;">Str_ireplace --(被转换的字符串，替换成的字符串，需要查找的字符串)</p> 
<p style="margin-left:.0001pt;text-align:justify;">在需要查找的字符串中查找需要被替换的字符串，替换为指定的字符串</p> 
<h2><span style="color:#0d0016;">Pass-07</span></h2> 
<h3>代码：</h3> 
<pre><code class="language-php">$is_upload = false;
$msg = null;
if (isset($_POST['submit'])) {
    if (file_exists(UPLOAD_PATH)) {
        $deny_ext = array(".php",".php5",".php4",".php3",".php2",".html",".htm",".phtml",".pht",".pHp",".pHp5",".pHp4",".pHp3",".pHp2",".Html",".Htm",".pHtml",".jsp",".jspa",".jspx",".jsw",".jsv",".jspf",".jtml",".jSp",".jSpx",".jSpa",".jSw",".jSv",".jSpf",".jHtml",".asp",".aspx",".asa",".asax",".ascx",".ashx",".asmx",".cer",".aSp",".aSpx",".aSa",".aSax",".aScx",".aShx",".aSmx",".cEr",".sWf",".swf",".htaccess",".ini");
        $file_name = $_FILES['upload_file']['name'];
        $file_name = deldot($file_name);//删除文件名末尾的点
        $file_ext = strrchr($file_name, '.');
        $file_ext = strtolower($file_ext); //转换为小写
        $file_ext = str_ireplace('::$DATA', '', $file_ext);//去除字符串::$DATA
        
        if (!in_array($file_ext, $deny_ext)) {
            $temp_file = $_FILES['upload_file']['tmp_name'];
            $img_path = UPLOAD_PATH.'/'.date("YmdHis").rand(1000,9999).$file_ext;
            if (move_uploaded_file($temp_file,$img_path)) {
                $is_upload = true;
            } else {
                $msg = '上传出错！';
            }
        } else {
            $msg = '此文件不允许上传';
        }
    } else {
        $msg = UPLOAD_PATH . '文件夹不存在,请手工创建！';
    }
}</code></pre> 
<p></p> 
<h3>提示：</h3> 
<p>没有进行首尾去空</p> 
<p>缺少代码</p> 
<pre><code>$file_ext = trim($file_ext); //首尾去空</code></pre> 
<p>我们可以进行空格绕过</p> 
<h3>解题思路：</h3> 
<p>上传phpinfo.php进行BP抓包</p> 
<p><img alt="" height="339" src="https://images2.imgbox.com/63/ab/n2aImkF3_o.png" width="614"></p> 
<p>上传成功后右键打开链接</p> 
<p><img alt="" height="339" src="https://images2.imgbox.com/d1/73/uobu9jlU_o.png" width="631"></p> 
<h2>Pass-08</h2> 
<h3>代码：</h3> 
<pre><code class="language-php">$is_upload = false;
$msg = null;
if (isset($_POST['submit'])) {
    if (file_exists(UPLOAD_PATH)) {
        $deny_ext = array(".php",".php5",".php4",".php3",".php2",".html",".htm",".phtml",".pht",".pHp",".pHp5",".pHp4",".pHp3",".pHp2",".Html",".Htm",".pHtml",".jsp",".jspa",".jspx",".jsw",".jsv",".jspf",".jtml",".jSp",".jSpx",".jSpa",".jSw",".jSv",".jSpf",".jHtml",".asp",".aspx",".asa",".asax",".ascx",".ashx",".asmx",".cer",".aSp",".aSpx",".aSa",".aSax",".aScx",".aShx",".aSmx",".cEr",".sWf",".swf",".htaccess",".ini");
        $file_name = trim($_FILES['upload_file']['name']);
        $file_ext = strrchr($file_name, '.');
        $file_ext = strtolower($file_ext); //转换为小写
        $file_ext = str_ireplace('::$DATA', '', $file_ext);//去除字符串::$DATA
        $file_ext = trim($file_ext); //首尾去空
        
        if (!in_array($file_ext, $deny_ext)) {
            $temp_file = $_FILES['upload_file']['tmp_name'];
            $img_path = UPLOAD_PATH.'/'.$file_name;
            if (move_uploaded_file($temp_file, $img_path)) {
                $is_upload = true;
            } else {
                $msg = '上传出错！';
            }
        } else {
            $msg = '此文件类型不允许上传！';
        }
    } else {
        $msg = UPLOAD_PATH . '文件夹不存在,请手工创建！';
    }
}
</code></pre> 
<h3>提示：</h3> 
<p>缺少代码</p> 
<pre><code class="language-php"> $file_name = deldot($file_name)</code></pre> 
<p> 没有删除文件名末尾后的点</p> 
<p>所以进行点绕过</p> 
<h3>解题思路：</h3> 
<p>上传phpinfo.php文件进行BP抓包</p> 
<p><img alt="" height="371" src="https://images2.imgbox.com/1a/0a/Y2SN6ebr_o.png" width="621"></p> 
<p>上传成功后右键打开链接</p> 
<p><img alt="" height="330" src="https://images2.imgbox.com/e3/45/xrx1Mq5V_o.png" width="616"></p> 
<p></p> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0ad9f69c87f6a0449c5c0cca956ad0a3/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">使用 Django 创建项目（入门笔记一）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7bbdfa65d76174ab657d94c53995f9ca/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">typora无法使用的解决方案</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>