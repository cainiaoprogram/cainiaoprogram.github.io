<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ffmpeg安装第三方编码器（encoder）库，ffmpeg编码h264（完） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ffmpeg安装第三方编码器（encoder）库，ffmpeg编码h264（完）" />
<meta property="og:description" content="2019独角兽企业重金招聘Python工程师标准&gt;&gt;&gt; ffmpeg安装第三方编码器（encoder）库 关键词：ffmpeg、编码h264、第三方encoder 安装好了ffmpeg后，如果你使用ffmpeg工具去把某个视频文件转成h264视频编码、mp3音频编码or其他ffmpeg自身不带的xxx编码类型，就会看到报错信息，unknown encoder &#39;xxx&#39;。此刻你需要的只要去安装其他的编码器就行了，本质上其实是把其他的编码器以库的形式安装好，例如，把正确的libx264.so or libx264.a存放在/usr/lib下 or /usr/local/lib下。 举两个例子吧，视频方面的编码器就拿h264来说，音频方面的例子就拿mp3（mp3lame）来说。 扫盲，Linux下安装一个正规的软件，一般都是三部曲，①、【./configure】（加一些可能的参数，比如enable一些功能，disable一些功能，究竟有哪些功能可以开启和关闭呢？一般通过./configure --help命令来查询），②、【make】（编译），③、【sudo make install】（把生成的二进制应用程序文件和.so和.a复制到/usr/local/下） 一、h264 动手搜一下ffmpeg的工程代码库，会发现每个codec都有一下几个成员变量，但是有好几个codec缺少encoder，h264就是其中一个了。先不管什么原因，ffmpeg没有原生的支持h264，但是你可以查看一下avcodec_register_all这个API，会发现一大片的REGISTER_ENCODER(XXX, xxx) REGISTER_DECODER(XXX, xxx) 这里分很多块，例如/* video codecs */，/* audio codecs */，/* external libraries */ 但是你在/* video codecs */这一块却看不到h264的REGISTER_ENDECODER (H264, h264);这句话，如果你坚持往下翻，你会在/* external libraries */这块里面发现REGISTER_ENCODER (LIBX264, libx264);所以ffmpeg是有给h264准备好了接口的，但是需要第三方库来支持。 回到重点，怎么装呢？ 1.先下载x264的工程代码，【git clone git://git.videolan.org/x264.git】。 2.进入x264目录，然后./configure --help看看它的帮助信息，我们这里需要的是x264以.so or .a的形式来支援ffmpeg，所以一般就关注shared和static关键词就可以了。执行./configure --enable-shared --enable-static就行了。 3.完了make &amp;&amp; sudo make install就可以了。 你会发现我们在./configure的时候没有指定前缀--prefix=/usr，很明显，libx264.so和libx264.a就会复制到/usr/local/lib下去，记住这里，等下会因为这里要做一些修改。 二、mp3lame 上面说了h264，相信mp3lame理解起来就简单多了。 1.先下载mp3lame的工程代码，http://sourceforge.net/projects/lame/files/lame/，为什么这里要显得多余的讲一下mp3lame呢，是这样的。大家可以看到x264用的是git，mp3lame是用的sourceforge，不妨再多说一个faac（也是一种原生ffmpeg不支持的音频codec），faac用的是http://sourceforge.net/projects/faac/files/faac-src/，所以每一种codec或者很重要的软件都有一个团队或者社区在维护，所以需要什么东西，尽量去sourceforge或者git上找，其他地方找的可能不够新，可能不完整不正确。 2.然后也是./configure --help先，看看哪些功能是我们需要打开关闭的 3.完了make &amp;&amp; sudo make install就可以了。 很明显，我们又没有指定--prefix-/usr，所以mp3lame的libmp3lame.so和libmp3lame.a就被赋值到了/usr/local/lib下了。 三、重新编译ffmpeg 1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/b1708b9f70077146d609db9b22248a92/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2012-07-23T18:05:00+08:00" />
<meta property="article:modified_time" content="2012-07-23T18:05:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ffmpeg安装第三方编码器（encoder）库，ffmpeg编码h264（完）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="content" id="articleContent"> 
 <div class="ad-wrap"> 
  <p><a style="color:#A00;font-weight:bold;" href="https://my.oschina.net/u/2663968/blog/3061697" rel="nofollow">2019独角兽企业重金招聘Python工程师标准&gt;&gt;&gt; </a> <img src="https://images2.imgbox.com/1f/67/c0VQNY9h_o.png" alt="hot3.png"></p> 
 </div> 
 <div>
   ffmpeg安装第三方编码器（encoder）库 
 </div> 
 <div>
   关键词：ffmpeg、编码h264、第三方encoder 
 </div> 
 <div>
       安装好了ffmpeg后，如果你使用ffmpeg工具去把某个视频文件转成h264视频编码、mp3音频编码or其他ffmpeg自身不带的xxx编码类型，就会看到报错信息，unknown encoder 'xxx'。此刻你需要的只要去安装其他的编码器就行了，本质上其实是把其他的编码器以库的形式安装好，例如，把正确的libx264.so or libx264.a存放在/usr/lib下 or /usr/local/lib下。 
 </div> 
 <div>
       举两个例子吧，视频方面的编码器就拿h264来说，音频方面的例子就拿mp3（mp3lame）来说。 
 </div> 
 <div>
       扫盲，Linux下安装一个正规的软件，一般都是三部曲，①、【./configure】（加一些可能的参数，比如enable一些功能，disable一些功能，究竟有哪些功能可以开启和关闭呢？一般通过./configure --help命令来查询），②、【make】（编译），③、【sudo make install】（把生成的二进制应用程序文件和.so和.a复制到/usr/local/下） 
 </div> 
 <div>
        一、h264 
 </div> 
 <div>
        动手搜一下ffmpeg的工程代码库，会发现每个codec都有一下几个成员变量，但是有好几个codec缺少encoder，h264就是其中一个了。先不管什么原因，ffmpeg没有原生的支持h264，但是你可以查看一下avcodec_register_all这个API，会发现一大片的REGISTER_ENCODER(XXX, xxx) 
 </div> 
 <div>
   REGISTER_DECODER(XXX, xxx) 
 </div> 
 <div>
   这里分很多块，例如/* video codecs */，/* audio codecs */，/* external libraries */ 
 </div> 
 <div>
   但是你在/* video codecs */这一块却看不到h264的REGISTER_ENDECODER (H264, h264);这句话，如果你坚持往下翻，你会在/* external libraries */这块里面发现REGISTER_ENCODER (LIBX264, libx264);所以ffmpeg是有给h264准备好了接口的，但是需要第三方库来支持。 
 </div> 
 <div>
       回到重点，怎么装呢？ 
 </div> 
 <div>
       1.先下载x264的工程代码，【git clone git://git.videolan.org/x264.git】。 
 </div> 
 <div>
       2.进入x264目录，然后./configure --help看看它的帮助信息，我们这里需要的是x264以.so or .a的形式来支援ffmpeg，所以一般就关注shared和static关键词就可以了。执行./configure --enable-shared --enable-static就行了。 
 </div> 
 <div>
       3.完了make &amp;&amp; sudo make install就可以了。 
 </div> 
 <div>
       你会发现我们在./configure的时候没有指定前缀--prefix=/usr，很明显，libx264.so和libx264.a就会复制到/usr/local/lib下去，记住这里，等下会因为这里要做一些修改。 
 </div> 
 <div>
       二、mp3lame 
 </div> 
 <div>
       上面说了h264，相信mp3lame理解起来就简单多了。 
 </div> 
 <div>
       1.先下载mp3lame的工程代码，http://sourceforge.net/projects/lame/files/lame/，为什么这里要显得多余的讲一下mp3lame呢，是这样的。大家可以看到x264用的是git，mp3lame是用的sourceforge，不妨再多说一个faac（也是一种原生ffmpeg不支持的音频codec），faac用的是http://sourceforge.net/projects/faac/files/faac-src/，所以每一种codec或者很重要的软件都有一个团队或者社区在维护，所以需要什么东西，尽量去sourceforge或者git上找，其他地方找的可能不够新，可能不完整不正确。 
 </div> 
 <div>
       2.然后也是./configure --help先，看看哪些功能是我们需要打开关闭的 
 </div> 
 <div>
       3.完了make &amp;&amp; sudo make install就可以了。 
 </div> 
 <div>
       很明显，我们又没有指定--prefix-/usr，所以mp3lame的libmp3lame.so和libmp3lame.a就被赋值到了/usr/local/lib下了。 
 </div> 
 <div>
     
 </div> 
 <div>
       三、重新编译ffmpeg 
 </div> 
 <div>
       1.进入ffmpeg目录，./configure --enable-gpl --enable-libx264 --enable-libmp3lame，然后就生成了新的makefile了。 
 </div> 
 <div>
       2.执行sudo make clean &amp;&amp; make sudo make install。 
 </div> 
 <div>
       3.这样ffmpeg就被重新编译了，完了就可以验证一下，使用ffmpeg工具，把某个视频文件中的视频流转码成h264格式，音频流转码成mp3lame格式，不妨试试。 
 </div> 
 <div>
       4.如果你真的尝试了，你应该会看到类似于“libxxx.so找不到”的错误提示，解决办法如下： 
 </div> 
 <div>
       （1）.表象：ffmpeg运行的时候试图去链接libxxx.so，但是却找不到相应的libxxx.so。 
 </div> 
 <div>
       （2）.疑惑：我之前明明安装了libxxx.so的。 
 </div> 
 <div>
       （3）.原因：程序运行的时候默认是去/usr/lib下找libxxx.so，但是我们之前安装的确实在/usr/local/lib下，所以造成这个报错。 
 </div> 
 <div>
       （4）.解决办法：有很多，我说一种我亲测过的。 
 </div> 
 <div>
       在/etc/ld.so.conf文件中添加一行/etc/ld.so.conf，当然是用root用户啦。然后执行ldconfig命令使得刚才的修改生效，完了再运行ffmpeg的转码命令试试，可以了吧。 
 </div> 
 <div>
        
 </div> 
 <div>
       之前我尝试过用ffplay来播放一个h264编码的视频，结果当然是可以播放，我就天真的以为ffmpeg支持h264了，其实不然，ffmpeg主要还是用来解码，所以部分格式的encoder却没有，所以才会有第三方库支援，为什么原生ffmpeg不支持某些格式呢？原因我暂时不知道。为了解决ffmpeg可以编码h264这个问题，我在网上搜索一些资料，然后总结成上文，在此过程中我还收获了一些Linux的知识，也已经写出。 
 </div> 
 <div>
       2012年5月28日16:05:15 
 </div> 
 <div class="ad-wrap"> 
  <div id="blog-title-ad"> 
   <ins class="adsbygoogle"></ins> 
  </div> 
 </div> 
</div> 
<p>转载于:https://my.oschina.net/michaelyuanyuan/blog/68616</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3f93e0416c50e49bb7f14c107f7af1de/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">oracle资源管理计划</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a4b66a734fa436cb16a67ead4028ef42/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Java8 和 Scala 中的高阶函数</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>