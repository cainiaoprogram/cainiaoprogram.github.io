<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>easyUI 在datagrid中进行单元格编辑，并在单元格加入自定义combobox下拉框 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="easyUI 在datagrid中进行单元格编辑，并在单元格加入自定义combobox下拉框" />
<meta property="og:description" content="最近项目中需要使用easyUI的datagrid表格来展示数据，并允许用户对部分列单元格进行编辑、保存。单元格格式为文本（text）或者下拉框（combobox）。
（1）datagrid的创建使用可以参考easyUI官网。https://www.jeasyui.net/plugins/183.html
（2）datagrid默认是不允许编辑里面的单元格的，需要一些配置才可以进行编辑操作。官网也有例子。https://www.jeasyui.net/demo/332.html
注意：只要你写的代码和官网一致，是可以实现编辑操作的。但是我自己试的时候，是部分copy的，有些部分冲突了，找了半天才找到原因。我在html部分定义了表格的列信息
&lt;table id=&#34;dg&#34; class=&#34;easyui-datagrid&#34; style=&#34;width:1010px;height:auto&#34; data-options=&#34; iconCls: &#39;icon-edit&#39;, singleSelect: true, toolbar: &#39;#tb&#39;, method: &#39;get&#39;, onClickCell: onClickCell&#34;&gt; &lt;thead&gt; &lt;tr&gt; &lt;th data-options=&#34;field:&#39;id&#39;,width:150,hidden:true&#34;&gt;用户需求内部编号&lt;/th&gt; &lt;th data-options=&#34;field:&#39;userReqBocNo&#39;,width:150&#34;&gt;用户需求内部编号&lt;/th&gt; &lt;th data-options=&#34;field:&#39;sysReqBocNo&#39;,width:150&#34;&gt;系统需求需求内部编号&lt;/th&gt; &lt;th data-options=&#34;field:&#39;sysReqName&#39;,width:150&#34;&gt;系统需求名称&lt;/th&gt; &lt;th data-options=&#34;field:&#39;milestone&#39;,width:150,editor:&#39;text&#39;&#34;&gt;当前里程碑点&lt;/th&gt; &lt;th data-options=&#34;field:&#39;startTime&#39;,width:100,editor:&#39;datebox&#39;&#34;&gt;开始时间&lt;/th&gt; &lt;th data-options=&#34;field:&#39;endTime&#39;,width:100,editor:&#39;datebox&#39;&#34;&gt;结束时间&lt;/th&gt; &lt;th data-options=&#34;field:&#39;status&#39;,width:100,editor:&#39;text&#39;&#34;&gt;状态&lt;/th&gt; &lt;th data-options=&#34;field:&#39;percent&#39;,width:100,editor:{type:&#39;combobox&#39;,options: {url:&#39;loadComboxData.action?projectId=&lt;%=projectId %&gt;&amp;comboxKey=enum&amp;enumId=percent&#39;,valueField: &#39;value&#39;, textField: &#39;text&#39;}}&#34;&gt;完成百分比&lt;/th&gt; &lt;/tr&gt; &lt;/thead&gt; &lt;/table&gt; 在js也定义了表格的列信息，但是在js中定义的列数和html中定义的列数不一致（html多出来一个了，没注意到）。导致单元格编辑无效。所以写代码要仔细，慢，切忌赶工。
（3）现在单元格已经可以进行编辑了，看上面的html代码，&lt;th&gt; 中有个属性 editor，这个就是你的单元格进行编辑的时候编辑类型。
editor:&#39;text&#39; 文本类型、editor:&#39;datebox&#39; 日期类型、还有最后一个 editor:{type:&#39;combobox&#39;, ……} 下拉框类型。
主要是combobox
url ： 下拉框数据的地址
valueField : 下拉框内容中每个选项的value
textField: 下拉框内容中每个选项的text（就是你可以看到的选项）
数据演示：
loadComboxData.action?projectId=&lt;%=projectId %&gt;&amp;comboxKey=enum&amp;enumId=percent 下面这个地址获取到的内容如下" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/908969f24980dd75b4d2783c2ca419ce/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-11-11T12:22:13+08:00" />
<meta property="article:modified_time" content="2020-11-11T12:22:13+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">easyUI 在datagrid中进行单元格编辑，并在单元格加入自定义combobox下拉框</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>最近项目中需要使用easyUI的datagrid表格来展示数据，并允许用户对部分列单元格进行编辑、保存。单元格格式为文本（text）或者下拉框（combobox）。</p> 
<p>（1）datagrid的创建使用可以参考easyUI官网。<a href="https://www.jeasyui.net/plugins/183.html" rel="nofollow">https://www.jeasyui.net/plugins/183.html</a></p> 
<p>（2）datagrid默认是不允许编辑里面的单元格的，需要一些配置才可以进行编辑操作。官网也有例子。<a href="https://www.jeasyui.net/demo/332.html" rel="nofollow">https://www.jeasyui.net/demo/332.html</a></p> 
<p>注意：只要你写的代码和官网一致，是可以实现编辑操作的。但是我自己试的时候，是部分copy的，有些部分冲突了，找了半天才找到原因。我在html部分定义了表格的列信息</p> 
<pre><code class="language-html">	&lt;table id="dg" class="easyui-datagrid" style="width:1010px;height:auto" 
		data-options="
			iconCls: 'icon-edit',
			singleSelect: true,
			toolbar: '#tb',
			method: 'get',
			onClickCell: onClickCell"&gt;
			&lt;thead&gt;
			&lt;tr&gt;
				&lt;th data-options="field:'id',width:150,hidden:true"&gt;用户需求内部编号&lt;/th&gt;
				&lt;th data-options="field:'userReqBocNo',width:150"&gt;用户需求内部编号&lt;/th&gt;
				&lt;th data-options="field:'sysReqBocNo',width:150"&gt;系统需求需求内部编号&lt;/th&gt;
				&lt;th data-options="field:'sysReqName',width:150"&gt;系统需求名称&lt;/th&gt;
				&lt;th data-options="field:'milestone',width:150,editor:'text'"&gt;当前里程碑点&lt;/th&gt;
				&lt;th data-options="field:'startTime',width:100,editor:'datebox'"&gt;开始时间&lt;/th&gt;
				&lt;th data-options="field:'endTime',width:100,editor:'datebox'"&gt;结束时间&lt;/th&gt;
				&lt;th data-options="field:'status',width:100,editor:'text'"&gt;状态&lt;/th&gt;
				&lt;th data-options="field:'percent',width:100,editor:{type:'combobox',options:
				{url:'loadComboxData.action?projectId=&lt;%=projectId %&gt;&amp;comboxKey=enum&amp;enumId=percent',valueField: 'value', textField: 'text'}}"&gt;完成百分比&lt;/th&gt;
			&lt;/tr&gt;
		&lt;/thead&gt;
	&lt;/table&gt;</code></pre> 
<p>在js也定义了表格的列信息，但是在js中定义的列数和html中定义的列数不一致（html多出来一个了，没注意到）。导致单元格编辑无效。所以写代码要仔细，慢，切忌赶工。</p> 
<p>（3）现在单元格已经可以进行编辑了，看上面的html代码，&lt;th&gt; 中有个属性 <strong>editor，</strong>这个就是你的单元格进行编辑的时候编辑类型。</p> 
<p><strong>editor:'text'  文本类型</strong>、<strong>editor:'datebox'  日期类型</strong>、还有最后一个<strong> editor:{type:'combobox', ……} 下拉框类型</strong>。</p> 
<p>主要是combobox</p> 
<p>url ： 下拉框数据的地址</p> 
<p>valueField : 下拉框内容中每个选项的value</p> 
<p>textField: 下拉框内容中每个选项的text（就是你可以看到的选项）</p> 
<p><strong>数据演示：</strong></p> 
<pre><code class="language-html">loadComboxData.action?projectId=&lt;%=projectId %&gt;&amp;comboxKey=enum&amp;enumId=percent</code></pre> 
<p>下面这个地址获取到的内容如下</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/cc/b3/YJ4teg3T_o.png"></p> 
<p>最终实现的效果如下</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/57/d2/LInO7w66_o.png"></p> 
<p>下面是完整前端代码</p> 
<pre><code class="language-html">&lt;%@ page import="org.apache.jasper.tagplugins.jstl.core.ForEach"%&gt;
&lt;%@ page contentType='text/html; charset=UTF-8'%&gt;
&lt;%@ page import="java.util.*" %&gt;
&lt;%@ page import="com.google.gson.Gson" %&gt;
&lt;%@ page import="com.google.gson.GsonBuilder" %&gt;
&lt;%@ page import="com.google.gson.reflect.TypeToken" %&gt;
&lt;%@ page import="com.teamlive.intf.IRunnable" %&gt;
&lt;%@ page import="com.polarion.alm.tracker.model.IWorkItem" %&gt;
&lt;%@ page import="com.polarion.alm.tracker.model.IWorkRecord" %&gt;
&lt;%@ page import="com.polarion.platform.persistence.IEnumOption" %&gt;
&lt;%@ page import="com.polarion.alm.projects.model.IUser" %&gt;
&lt;%@ page import="com.polarion.core.util.types.DateOnly" %&gt;
&lt;%@ page import="com.polarion.core.util.types.duration.DurationTime" %&gt;
&lt;%@ page import="com.polarion.alm.tracker.ITrackerService"%&gt;
&lt;%@ page import="com.teamlive.utils.GuiceService" %&gt;
&lt;%@ page import="com.teamlive.utils.ServiceUtil" %&gt;
&lt;%@ page import="com.teamlive.boc.utils.WorkItemUtil" %&gt;
&lt;%@ page import="org.apache.log4j.Logger" %&gt;
&lt;%
final String projectId = request.getParameter("projectId");
final String itemId = request.getParameter("itemId");
ITrackerService trackerService = GuiceService.create(ITrackerService.class);
final IWorkItem item = trackerService.getWorkItem(projectId, itemId);
final String type = item.getType().getId();
final String submitter = WorkItemUtil.getFiledKey(item, "submitter");
final String approver = WorkItemUtil.getFiledKey(item, "approver");
final String reportTime =  WorkItemUtil.getDateField2String(item, "reportTime");
final String status = item.getStatus().getId();
final IUser user = trackerService.getProjectsService().getCurrentUser();
final String userId = user.getId();

%&gt;
&lt;!doctype html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
&lt;meta charset="UTF-8"&gt;
&lt;link rel="stylesheet" type="text/css" href="css/easyui/easyui.css"&gt;
&lt;link rel="stylesheet" type="text/css" href="css/easyui/icon.css"&gt;
&lt;link rel="stylesheet" type="text/css" href="css/easyui/demo.css"&gt;
&lt;script type="text/javascript" src="js/jquery/jquery.min.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="js/easyui/jquery.easyui.min.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="js/easyui/easyui.custom.js?a=1"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="js/easyui/easyui-lang-zh_CN.js"&gt;&lt;/script&gt;
&lt;!-- &lt;script type="text/javascript" src="js/custom/custom.js"&gt;&lt;/script&gt; --&gt;
&lt;style type="text/css"&gt;

&lt;/style&gt;
&lt;script type="text/javascript"&gt;
	var projectId = '&lt;%=projectId %&gt;';
	var userId = '&lt;%=userId%&gt;';
	var type = '&lt;%=type%&gt;';
	var submitter = '&lt;%=submitter%&gt;';
	var itemId = '&lt;%=itemId%&gt;';
	var status = '&lt;%=status%&gt;';
	$(function(){
		$.ajax({
			type:"get",
			url:"getProjectInfoFromProject.action",
			data:{"itemId":itemId,"projectId":projectId},
			success:function(data){
				var dataArray = JSON.parse(data);
				$('#dg').datagrid('loadData', dataArray);
			}
		});	
	});
	
	$.extend($.fn.datagrid.methods, {
		editCell: function(jq,param){
			return jq.each(function(){
				var opts = $(this).datagrid('options');
				var fields = $(this).datagrid('getColumnFields',true).concat($(this).datagrid('getColumnFields'));
				for(var i=0; i&lt;fields.length; i++){
					var col = $(this).datagrid('getColumnOption', fields[i]);
					col.editor1 = col.editor;
					if (fields[i] != param.field){
						col.editor = null;
					}
				}
				$(this).datagrid('beginEdit', param.index);
				for(var i=0; i&lt;fields.length; i++){
					var col = $(this).datagrid('getColumnOption', fields[i]);
					col.editor = col.editor1;
				}
			});
		}
	});
	
	var editIndex = undefined;
	function endEditing(){
		if (editIndex == undefined){return true}
		if ($('#dg').datagrid('validateRow', editIndex)){
			$('#dg').datagrid('endEdit', editIndex);
			editIndex = undefined;
			return true;
		} else {
			return false;
		}
	}
	function onClickCell(index, field){
		if (endEditing()){
			$('#dg').datagrid('selectRow', index).datagrid('editCell', {index:index,field:field});
			editIndex = index;
		}
	}
	
	function saveProjectInfo(){
		endEditing();
		var rows = $('#dg').datagrid('getRows')
		//获取当前页的数据行 
		var percent1 = rows[0]['percent']; 
		var percent2 = rows[1]['percent']; 
		var percent3 = rows[2]['percent']; 
		var percent4 = rows[3]['percent']; 
		var percent5 = rows[4]['percent']; 
		
		$.ajax({
			type:"get",
			url:"updateOverAllPerformance.action",
			data:{"itemId":itemId,"projectId":projectId,"percent1":percent1,"percent2":percent2,"percent3":percent3,
				"percent4":percent4,"percent5":percent5},
			success:function(data){
			}
		});	
		
	}
	
&lt;/script&gt;
&lt;/head&gt;
&lt;body style="height:200px"&gt;
	&lt;table id="dg" class="easyui-datagrid" style="width:910px;height:auto" 
		data-options="
			iconCls: 'icon-edit',
			singleSelect: true,
			toolbar: '#tb',
			method: 'get',
			onClickCell: onClickCell"&gt;
			&lt;thead&gt;
			&lt;tr&gt;
				&lt;th data-options="field:'id',width:50"&gt;序号&lt;/th&gt;
				&lt;th data-options="field:'milePost',width:100"&gt;里程碑点&lt;/th&gt;
				&lt;th data-options="field:'startTime',width:150"&gt;开始时间&lt;/th&gt;
				&lt;th data-options="field:'endTime',width:150"&gt;结束时间&lt;/th&gt;
				&lt;th data-options="field:'sign',width:350"&gt;标志&lt;/th&gt;
				&lt;th data-options="field:'percent',width:100,editor:{type:'combobox',options:
				{url:'loadComboxData.action?projectId=&lt;%=projectId %&gt;&amp;comboxKey=enum&amp;enumId=percent',valueField: 'value', textField: 'text'}}"&gt;完成百分比&lt;/th&gt;
			&lt;/tr&gt;
		&lt;/thead&gt;
	&lt;/table&gt;
	&lt;div id="tb" style="height:auto"&gt;
		&lt;a href="javascript:void(0)"  class="easyui-linkbutton" data-options="iconCls:'icon-save',plain:true" onclick="saveProjectInfo()"&gt;保存并提交&lt;/a&gt;
	&lt;/div&gt;
	
&lt;/body&gt;
&lt;/html&gt;</code></pre> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/506667fcab7a1ea37db14ecf0043ea82/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Photoshop CS6调整界面字体大小</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a30c257acc8930fb773a7713b79d038a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">3_Docker 常用命令</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>