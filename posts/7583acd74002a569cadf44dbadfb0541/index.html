<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>古月居ROS入门21讲笔记 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="古月居ROS入门21讲笔记" />
<meta property="og:description" content="ROS入门21讲笔记——古月居 1 C&#43;&#43;&amp;Python极简基础1.1 安装编译/解析器1.2 for循环1.3 while循环1.4 面向对象 2. ROS基础2.1 ROS概念2.2 创建工作空间与功能包2.3 发布者Publisher的编程实现2.4 订阅者Subscriber的编程实现2.5 话题消息的定义与使用2.6 客户端Client的编程实现2.7 服务端Server的编程实现2.8 服务数据的定义与使用2.9 参数的使用与编程方法2.10 tf坐标系广播与监听的编程实现2.11 launch启动文件的使用方法2.12 常用可视化工具的使用2.12.1 rqt2.12.2 Rviz2.12.3 Gazebo 1 C&#43;&#43;&amp;Python极简基础 1.1 安装编译/解析器 sudo apt-get install g&#43;&#43; sudo apt-get install python 1.2 for循环 Python for a in range(5,10): if a&lt; 10: print &#39;a = &#39;,a a&#43;=1 else: break 使用Python解析器运行py程序
python fileName.py C&#43;&#43;
略 使用g&#43;&#43;编译*.cpp文件
g&#43;&#43; fileName.cpp -o exeFileName 运行编译后的二进制文件
./exeFileName 1.3 while循环 C&#43;&#43;
略" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/7583acd74002a569cadf44dbadfb0541/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-07-18T00:05:05+08:00" />
<meta property="article:modified_time" content="2019-07-18T00:05:05+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">古月居ROS入门21讲笔记</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>ROS入门21讲笔记——古月居</h4> 
 <ul><li><a href="#1_CPython_1" rel="nofollow">1 C++&amp;Python极简基础</a></li><li><ul><li><a href="#11__2" rel="nofollow">1.1 安装编译/解析器</a></li><li><a href="#12_for_8" rel="nofollow">1.2 for循环</a></li><li><a href="#13_while_44" rel="nofollow">1.3 while循环</a></li><li><a href="#14__57" rel="nofollow">1.4 面向对象</a></li></ul> 
  </li><li><a href="#2_ROS_97" rel="nofollow">2. ROS基础</a></li><li><ul><li><a href="#21_ROS_98" rel="nofollow">2.1 ROS概念</a></li><li><a href="#22__107" rel="nofollow">2.2 创建工作空间与功能包</a></li><li><a href="#23_Publisher_115" rel="nofollow">2.3 发布者Publisher的编程实现</a></li><li><a href="#24_Subscriber_209" rel="nofollow">2.4 订阅者Subscriber的编程实现</a></li><li><a href="#25__276" rel="nofollow">2.5 话题消息的定义与使用</a></li><li><a href="#26_Client_431" rel="nofollow">2.6 客户端Client的编程实现</a></li><li><a href="#27_Server_506" rel="nofollow">2.7 服务端Server的编程实现</a></li><li><a href="#28__633" rel="nofollow">2.8 服务数据的定义与使用</a></li><li><a href="#29__791" rel="nofollow">2.9 参数的使用与编程方法</a></li><li><a href="#210_tf_905" rel="nofollow">2.10 tf坐标系广播与监听的编程实现</a></li><li><a href="#211_launch_1113" rel="nofollow">2.11 launch启动文件的使用方法</a></li><li><a href="#212__1217" rel="nofollow">2.12 常用可视化工具的使用</a></li><li><ul><li><a href="#2121_rqt_1219" rel="nofollow">2.12.1 rqt</a></li><li><a href="#2122_Rviz_1224" rel="nofollow">2.12.2 Rviz</a></li><li><a href="#2123_Gazebo_1230" rel="nofollow">2.12.3 Gazebo</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="1_CPython_1"></a>1 C++&amp;Python极简基础</h2> 
<h3><a id="11__2"></a>1.1 安装编译/解析器</h3> 
<pre><code>sudo apt-get install g++
sudo apt-get install python
</code></pre> 
<h3><a id="12_for_8"></a>1.2 for循环</h3> 
<ul><li>Python</li></ul> 
<pre><code class="prism language-py"><span class="token keyword">for</span> a <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">if</span> a<span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">:</span>
		<span class="token keyword">print</span> <span class="token string">'a = '</span><span class="token punctuation">,</span>a
		a<span class="token operator">+=</span><span class="token number">1</span>
	<span class="token keyword">else</span><span class="token punctuation">:</span>
		<span class="token keyword">break</span>
</code></pre> 
<hr> 
<p>使用Python解析器运行py程序</p> 
<pre><code>python fileName.py
</code></pre> 
<hr> 
<ul><li>C++<br> 略</li></ul> 
<hr> 
<p>使用g++编译*.cpp文件</p> 
<pre><code>g++  fileName.cpp  -o  exeFileName
</code></pre> 
<p>运行编译后的二进制文件</p> 
<pre><code>./exeFileName
</code></pre> 
<hr> 
<h3><a id="13_while_44"></a>1.3 while循环</h3> 
<ul><li> <p>C++<br> 略</p> </li><li> <p>Python</p> </li></ul> 
<pre><code class="prism language-py">a <span class="token operator">=</span> <span class="token number">5</span>
<span class="token keyword">while</span> a <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">:</span>
	<span class="token keyword">print</span> <span class="token string">'a = '</span> <span class="token punctuation">,</span> a
	a <span class="token operator">+=</span> <span class="token number">1</span> 

</code></pre> 
<h3><a id="14__57"></a>1.4 面向对象</h3> 
<ul><li>C++</li></ul> 
<pre><code class="prism language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>

<span class="token keyword">class</span> <span class="token class-name">A</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">public</span><span class="token operator">:</span>
		<span class="token keyword">int</span> i<span class="token punctuation">;</span>
		<span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> i <span class="token operator">&lt;&lt;</span>std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	A a<span class="token punctuation">;</span>
	a<span class="token punctuation">.</span>i <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
	a<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>Python</li></ul> 
<pre><code class="prism language-py"><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">:</span>
	i <span class="token operator">=</span> <span class="token number">10</span>
	<span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span>
		<span class="token keyword">print</span> self<span class="token punctuation">.</span>i
a <span class="token operator">=</span> A<span class="token punctuation">(</span><span class="token punctuation">)</span>
a<span class="token punctuation">.</span>test<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<hr> 
<blockquote> 
 <p>配置ROS软件源时,更新软件包容易出现下载失败的情况,跟使用的网络有关.<br> 古月大神总结:使用手机热点可以更新成功.</p> 
</blockquote> 
<hr> 
<h2><a id="2_ROS_97"></a>2. ROS基础</h2> 
<h3><a id="21_ROS_98"></a>2.1 ROS概念</h3> 
<p><img src="https://images2.imgbox.com/70/89/2snn69qN_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/5d/51/yyDdWTm4_o.png" alt="在这里插入图片描述"><br> 查看节点列表:rosnode list<br> 发布话题消息:rostopic pub -r 10 /话题名<br> 发布服务请求:rosservice call /服务文件 “变量:val”<br> 话题记录: rosbag record -a -O fileName<br> 话题复现: rosbag play fileName</p> 
<h3><a id="22__107"></a>2.2 创建工作空间与功能包</h3> 
<p><img src="https://images2.imgbox.com/00/c1/HtpJkRPg_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/8d/ca/Qum1uIkK_o.png" alt="在这里插入图片描述"><br> 建立install空间:catkin_make install</p> 
<p><img src="https://images2.imgbox.com/f7/e3/5hLXudkx_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="23_Publisher_115"></a>2.3 发布者Publisher的编程实现</h3> 
<p><img src="https://images2.imgbox.com/25/82/3ylQgU7z_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<ul><li>C++</li></ul> 
<pre><code class="prism language-cpp"><span class="token comment">/**
 * 该例程将发布turtle1/cmd_vel话题，消息类型geometry_msgs::Twist
 */</span>
 
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;ros/ros.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;geometry_msgs/Twist.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">// ROS节点初始化</span>
	ros<span class="token operator">::</span><span class="token function">init</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">,</span> <span class="token string">"velocity_publisher"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// 创建节点句柄</span>
	ros<span class="token operator">::</span>NodeHandle n<span class="token punctuation">;</span>

	<span class="token comment">// 创建一个Publisher，发布名为/turtle1/cmd_vel的topic，消息类型为geometry_msgs::Twist，队列长度10</span>
	ros<span class="token operator">::</span>Publisher turtle_vel_pub <span class="token operator">=</span> n<span class="token punctuation">.</span>advertise<span class="token operator">&lt;</span>geometry_msgs<span class="token operator">::</span>Twist<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">"/turtle1/cmd_vel"</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// 设置循环的频率</span>
	ros<span class="token operator">::</span>Rate <span class="token function">loop_rate</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span>ros<span class="token operator">::</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
	    <span class="token comment">// 初始化geometry_msgs::Twist类型的消息</span>
		geometry_msgs<span class="token operator">::</span>Twist vel_msg<span class="token punctuation">;</span>
		vel_msg<span class="token punctuation">.</span>linear<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
		vel_msg<span class="token punctuation">.</span>angular<span class="token punctuation">.</span>z <span class="token operator">=</span> <span class="token number">0.2</span><span class="token punctuation">;</span>

	    <span class="token comment">// 发布消息</span>
		turtle_vel_pub<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span>vel_msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">ROS_INFO</span><span class="token punctuation">(</span><span class="token string">"Publsh turtle velocity command[%0.2f m/s, %0.2f rad/s]"</span><span class="token punctuation">,</span> 
				vel_msg<span class="token punctuation">.</span>linear<span class="token punctuation">.</span>x<span class="token punctuation">,</span> vel_msg<span class="token punctuation">.</span>angular<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>

	    <span class="token comment">// 按照循环频率延时</span>
	    loop_rate<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/bb/86/3UWDwqah_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/36/29/4f8uTgA7_o.png" alt="在这里插入图片描述"></p> 
<ul><li>Python</li></ul> 
<pre><code class="prism language-py"><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token comment"># 该例程将发布turtle1/cmd_vel话题，消息类型geometry_msgs::Twist</span>

<span class="token keyword">import</span> rospy
<span class="token keyword">from</span> geometry_msgs<span class="token punctuation">.</span>msg <span class="token keyword">import</span> Twist

<span class="token keyword">def</span> <span class="token function">velocity_publisher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment"># ROS节点初始化</span>
    rospy<span class="token punctuation">.</span>init_node<span class="token punctuation">(</span><span class="token string">'velocity_publisher'</span><span class="token punctuation">,</span> anonymous<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

	<span class="token comment"># 创建一个Publisher，发布名为/turtle1/cmd_vel的topic，消息类型为geometry_msgs::Twist，队列长度10</span>
    turtle_vel_pub <span class="token operator">=</span> rospy<span class="token punctuation">.</span>Publisher<span class="token punctuation">(</span><span class="token string">'/turtle1/cmd_vel'</span><span class="token punctuation">,</span> Twist<span class="token punctuation">,</span> queue_size<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>

	<span class="token comment">#设置循环的频率</span>
    rate <span class="token operator">=</span> rospy<span class="token punctuation">.</span>Rate<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> 

    <span class="token keyword">while</span> <span class="token operator">not</span> rospy<span class="token punctuation">.</span>is_shutdown<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token comment"># 初始化geometry_msgs::Twist类型的消息</span>
        vel_msg <span class="token operator">=</span> Twist<span class="token punctuation">(</span><span class="token punctuation">)</span>
        vel_msg<span class="token punctuation">.</span>linear<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">0.5</span>
        vel_msg<span class="token punctuation">.</span>angular<span class="token punctuation">.</span>z <span class="token operator">=</span> <span class="token number">0.2</span>

		<span class="token comment"># 发布消息</span>
        turtle_vel_pub<span class="token punctuation">.</span>publish<span class="token punctuation">(</span>vel_msg<span class="token punctuation">)</span>
    	rospy<span class="token punctuation">.</span>loginfo<span class="token punctuation">(</span><span class="token string">"Publsh turtle velocity command[%0.2f m/s, %0.2f rad/s]"</span><span class="token punctuation">,</span> 
				vel_msg<span class="token punctuation">.</span>linear<span class="token punctuation">.</span>x<span class="token punctuation">,</span> vel_msg<span class="token punctuation">.</span>angular<span class="token punctuation">.</span>z<span class="token punctuation">)</span>

		<span class="token comment"># 按照循环频率延时</span>
        rate<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        velocity_publisher<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> rospy<span class="token punctuation">.</span>ROSInterruptException<span class="token punctuation">:</span>
        <span class="token keyword">pass</span>


</code></pre> 
<p><img src="https://images2.imgbox.com/7a/d4/n6BHBTDl_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="24_Subscriber_209"></a>2.4 订阅者Subscriber的编程实现</h3> 
<p><img src="https://images2.imgbox.com/d1/3e/dPhn1o4H_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<ul><li>C++</li></ul> 
<pre><code class="prism language-cpp"><span class="token comment">/**
 * 该例程将订阅/turtle1/pose话题，消息类型turtlesim::Pose
 */</span>
 
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;ros/ros.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"turtlesim/Pose.h"</span></span>

<span class="token comment">// 接收到订阅的消息后，会进入消息回调函数</span>
<span class="token keyword">void</span> <span class="token function">poseCallback</span><span class="token punctuation">(</span><span class="token keyword">const</span> turtlesim<span class="token operator">::</span>Pose<span class="token operator">::</span>ConstPtr<span class="token operator">&amp;</span> msg<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 将接收到的消息打印出来</span>
    <span class="token function">ROS_INFO</span><span class="token punctuation">(</span><span class="token string">"Turtle pose: x:%0.6f, y:%0.6f"</span><span class="token punctuation">,</span> msg<span class="token operator">-</span><span class="token operator">&gt;</span>x<span class="token punctuation">,</span> msg<span class="token operator">-</span><span class="token operator">&gt;</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 初始化ROS节点</span>
    ros<span class="token operator">::</span><span class="token function">init</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">,</span> <span class="token string">"pose_subscriber"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 创建节点句柄</span>
    ros<span class="token operator">::</span>NodeHandle n<span class="token punctuation">;</span>

    <span class="token comment">// 创建一个Subscriber，订阅名为/turtle1/pose的topic，注册回调函数poseCallback</span>
    ros<span class="token operator">::</span>Subscriber pose_sub <span class="token operator">=</span> n<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">"/turtle1/pose"</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> poseCallback<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 循环等待回调函数</span>
    ros<span class="token operator">::</span><span class="token function">spin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/20/40/g1W1DUf4_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/a3/72/JtZ6obNh_o.png" alt="在这里插入图片描述"></p> 
<ul><li>Python</li></ul> 
<pre><code class="prism language-py"><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token comment"># 该例程将订阅/turtle1/pose话题，消息类型turtlesim::Pose</span>

<span class="token keyword">import</span> rospy
<span class="token keyword">from</span> turtlesim<span class="token punctuation">.</span>msg <span class="token keyword">import</span> Pose

<span class="token keyword">def</span> <span class="token function">poseCallback</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">:</span>
    rospy<span class="token punctuation">.</span>loginfo<span class="token punctuation">(</span><span class="token string">"Turtle pose: x:%0.6f, y:%0.6f"</span><span class="token punctuation">,</span> msg<span class="token punctuation">.</span>x<span class="token punctuation">,</span> msg<span class="token punctuation">.</span>y<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">pose_subscriber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment"># ROS节点初始化</span>
    rospy<span class="token punctuation">.</span>init_node<span class="token punctuation">(</span><span class="token string">'pose_subscriber'</span><span class="token punctuation">,</span> anonymous<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

	<span class="token comment"># 创建一个Subscriber，订阅名为/turtle1/pose的topic，注册回调函数poseCallback</span>
    rospy<span class="token punctuation">.</span>Subscriber<span class="token punctuation">(</span><span class="token string">"/turtle1/pose"</span><span class="token punctuation">,</span> Pose<span class="token punctuation">,</span> poseCallback<span class="token punctuation">)</span>

	<span class="token comment"># 循环等待回调函数</span>
    rospy<span class="token punctuation">.</span>spin<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    pose_subscriber<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<p><img src="https://images2.imgbox.com/e6/46/NQ0JnSXP_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="25__276"></a>2.5 话题消息的定义与使用</h3> 
<p><img src="https://images2.imgbox.com/83/e1/yWypSEIG_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/5f/b8/arfNRPRM_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<ul><li>C++</li></ul> 
<pre><code class="prism language-c"><span class="token comment">/**
 * 该例程将发布/person_info话题，自定义消息类型learning_topic::Person
 */</span>
 
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;ros/ros.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"learning_topic/Person.h"</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ROS节点初始化</span>
    ros<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">init</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">,</span> <span class="token string">"person_publisher"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 创建节点句柄</span>
    ros<span class="token punctuation">:</span><span class="token punctuation">:</span>NodeHandle n<span class="token punctuation">;</span>

    <span class="token comment">// 创建一个Publisher，发布名为/person_info的topic，消息类型为learning_topic::Person，队列长度10</span>
    ros<span class="token punctuation">:</span><span class="token punctuation">:</span>Publisher person_info_pub <span class="token operator">=</span> n<span class="token punctuation">.</span>advertise<span class="token operator">&lt;</span>learning_topic<span class="token punctuation">:</span><span class="token punctuation">:</span>Person<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">"/person_info"</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 设置循环的频率</span>
    ros<span class="token punctuation">:</span><span class="token punctuation">:</span>Rate <span class="token function">loop_rate</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>ros<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 初始化learning_topic::Person类型的消息</span>
    	learning_topic<span class="token punctuation">:</span><span class="token punctuation">:</span>Person person_msg<span class="token punctuation">;</span>
		person_msg<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"Tom"</span><span class="token punctuation">;</span>
		person_msg<span class="token punctuation">.</span>age  <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">;</span>
		person_msg<span class="token punctuation">.</span>sex  <span class="token operator">=</span> learning_topic<span class="token punctuation">:</span><span class="token punctuation">:</span>Person<span class="token punctuation">:</span><span class="token punctuation">:</span>male<span class="token punctuation">;</span>

        <span class="token comment">// 发布消息</span>
		person_info_pub<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span>person_msg<span class="token punctuation">)</span><span class="token punctuation">;</span>

       	<span class="token function">ROS_INFO</span><span class="token punctuation">(</span><span class="token string">"Publish Person Info: name:%s  age:%d  sex:%d"</span><span class="token punctuation">,</span> 
				  person_msg<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> person_msg<span class="token punctuation">.</span>age<span class="token punctuation">,</span> person_msg<span class="token punctuation">.</span>sex<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 按照循环频率延时</span>
        loop_rate<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-c"><span class="token comment">/**
 * 该例程将订阅/person_info话题，自定义消息类型learning_topic::Person
 */</span>
 
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;ros/ros.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"learning_topic/Person.h"</span></span>

<span class="token comment">// 接收到订阅的消息后，会进入消息回调函数</span>
<span class="token keyword">void</span> <span class="token function">personInfoCallback</span><span class="token punctuation">(</span><span class="token keyword">const</span> learning_topic<span class="token punctuation">:</span><span class="token punctuation">:</span>Person<span class="token punctuation">:</span><span class="token punctuation">:</span>ConstPtr<span class="token operator">&amp;</span> msg<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 将接收到的消息打印出来</span>
    <span class="token function">ROS_INFO</span><span class="token punctuation">(</span><span class="token string">"Subcribe Person Info: name:%s  age:%d  sex:%d"</span><span class="token punctuation">,</span> 
			 msg<span class="token operator">-&gt;</span>name<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> msg<span class="token operator">-&gt;</span>age<span class="token punctuation">,</span> msg<span class="token operator">-&gt;</span>sex<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 初始化ROS节点</span>
    ros<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">init</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">,</span> <span class="token string">"person_subscriber"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 创建节点句柄</span>
    ros<span class="token punctuation">:</span><span class="token punctuation">:</span>NodeHandle n<span class="token punctuation">;</span>

    <span class="token comment">// 创建一个Subscriber，订阅名为/person_info的topic，注册回调函数personInfoCallback</span>
    ros<span class="token punctuation">:</span><span class="token punctuation">:</span>Subscriber person_info_sub <span class="token operator">=</span> n<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">"/person_info"</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> personInfoCallback<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 循环等待回调函数</span>
    ros<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">spin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/dd/55/GisDoyRo_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/ad/5f/15BYTqat_o.png" alt="在这里插入图片描述"></p> 
<ul><li>Python</li></ul> 
<pre><code class="prism language-py"><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token comment"># 该例程将发布/person_info话题，自定义消息类型learning_topic::Person</span>

<span class="token keyword">import</span> rospy
<span class="token keyword">from</span> learning_topic<span class="token punctuation">.</span>msg <span class="token keyword">import</span> Person

<span class="token keyword">def</span> <span class="token function">velocity_publisher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment"># ROS节点初始化</span>
    rospy<span class="token punctuation">.</span>init_node<span class="token punctuation">(</span><span class="token string">'person_publisher'</span><span class="token punctuation">,</span> anonymous<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

	<span class="token comment"># 创建一个Publisher，发布名为/person_info的topic，消息类型为learning_topic::Person，队列长度10</span>
    person_info_pub <span class="token operator">=</span> rospy<span class="token punctuation">.</span>Publisher<span class="token punctuation">(</span><span class="token string">'/person_info'</span><span class="token punctuation">,</span> Person<span class="token punctuation">,</span> queue_size<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>

	<span class="token comment">#设置循环的频率</span>
    rate <span class="token operator">=</span> rospy<span class="token punctuation">.</span>Rate<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> 

    <span class="token keyword">while</span> <span class="token operator">not</span> rospy<span class="token punctuation">.</span>is_shutdown<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token comment"># 初始化learning_topic::Person类型的消息</span>
    	person_msg <span class="token operator">=</span> Person<span class="token punctuation">(</span><span class="token punctuation">)</span>
    	person_msg<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"Tom"</span><span class="token punctuation">;</span>
    	person_msg<span class="token punctuation">.</span>age  <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">;</span>
    	person_msg<span class="token punctuation">.</span>sex  <span class="token operator">=</span> Person<span class="token punctuation">.</span>male<span class="token punctuation">;</span>

		<span class="token comment"># 发布消息</span>
        person_info_pub<span class="token punctuation">.</span>publish<span class="token punctuation">(</span>person_msg<span class="token punctuation">)</span>
    	rospy<span class="token punctuation">.</span>loginfo<span class="token punctuation">(</span><span class="token string">"Publsh person message[%s, %d, %d]"</span><span class="token punctuation">,</span> 
				person_msg<span class="token punctuation">.</span>name<span class="token punctuation">,</span> person_msg<span class="token punctuation">.</span>age<span class="token punctuation">,</span> person_msg<span class="token punctuation">.</span>sex<span class="token punctuation">)</span>

		<span class="token comment"># 按照循环频率延时</span>
        rate<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        velocity_publisher<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> rospy<span class="token punctuation">.</span>ROSInterruptException<span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
</code></pre> 
<pre><code class="prism language-py"><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token comment"># 该例程将订阅/person_info话题，自定义消息类型learning_topic::Person</span>

<span class="token keyword">import</span> rospy
<span class="token keyword">from</span> learning_topic<span class="token punctuation">.</span>msg <span class="token keyword">import</span> Person

<span class="token keyword">def</span> <span class="token function">personInfoCallback</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">:</span>
    rospy<span class="token punctuation">.</span>loginfo<span class="token punctuation">(</span><span class="token string">"Subcribe Person Info: name:%s  age:%d  sex:%d"</span><span class="token punctuation">,</span> 
			 msg<span class="token punctuation">.</span>name<span class="token punctuation">,</span> msg<span class="token punctuation">.</span>age<span class="token punctuation">,</span> msg<span class="token punctuation">.</span>sex<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">person_subscriber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment"># ROS节点初始化</span>
    rospy<span class="token punctuation">.</span>init_node<span class="token punctuation">(</span><span class="token string">'person_subscriber'</span><span class="token punctuation">,</span> anonymous<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

	<span class="token comment"># 创建一个Subscriber，订阅名为/person_info的topic，注册回调函数personInfoCallback</span>
    rospy<span class="token punctuation">.</span>Subscriber<span class="token punctuation">(</span><span class="token string">"/person_info"</span><span class="token punctuation">,</span> Person<span class="token punctuation">,</span> personInfoCallback<span class="token punctuation">)</span>

	<span class="token comment"># 循环等待回调函数</span>
    rospy<span class="token punctuation">.</span>spin<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    person_subscriber<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="26_Client_431"></a>2.6 客户端Client的编程实现</h3> 
<p><img src="https://images2.imgbox.com/b5/8e/VepLKjuf_o.png" alt="在这里插入图片描述"></p> 
<ul><li>C++</li></ul> 
<pre><code class="prism language-c"><span class="token comment">/**
 * 该例程将请求/spawn服务，服务数据类型turtlesim::Spawn
 */</span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;ros/ros.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;turtlesim/Spawn.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span> argv<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 初始化ROS节点</span>
	ros<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">init</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">,</span> <span class="token string">"turtle_spawn"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 创建节点句柄</span>
	ros<span class="token punctuation">:</span><span class="token punctuation">:</span>NodeHandle node<span class="token punctuation">;</span>

    <span class="token comment">// 发现/spawn服务后，创建一个服务客户端，连接名为/spawn的service</span>
	ros<span class="token punctuation">:</span><span class="token punctuation">:</span>service<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">waitForService</span><span class="token punctuation">(</span><span class="token string">"/spawn"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//阻塞型函数</span>
	ros<span class="token punctuation">:</span><span class="token punctuation">:</span>ServiceClient add_turtle <span class="token operator">=</span> node<span class="token punctuation">.</span>serviceClient<span class="token operator">&lt;</span>turtlesim<span class="token punctuation">:</span><span class="token punctuation">:</span>Spawn<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">"/spawn"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 初始化turtlesim::Spawn的请求数据</span>
	turtlesim<span class="token punctuation">:</span><span class="token punctuation">:</span>Spawn srv<span class="token punctuation">;</span>
	srv<span class="token punctuation">.</span>request<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">2.0</span><span class="token punctuation">;</span>
	srv<span class="token punctuation">.</span>request<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">2.0</span><span class="token punctuation">;</span>
	srv<span class="token punctuation">.</span>request<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"turtle2"</span><span class="token punctuation">;</span>

    <span class="token comment">// 请求服务调用</span>
	<span class="token function">ROS_INFO</span><span class="token punctuation">(</span><span class="token string">"Call service to spwan turtle[x:%0.6f, y:%0.6f, name:%s]"</span><span class="token punctuation">,</span> 
			 srv<span class="token punctuation">.</span>request<span class="token punctuation">.</span>x<span class="token punctuation">,</span> srv<span class="token punctuation">.</span>request<span class="token punctuation">.</span>y<span class="token punctuation">,</span> srv<span class="token punctuation">.</span>request<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	add_turtle<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>srv<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//阻塞型函数</span>

	<span class="token comment">// 显示服务调用结果</span>
	<span class="token function">ROS_INFO</span><span class="token punctuation">(</span><span class="token string">"Spwan turtle successfully [name:%s]"</span><span class="token punctuation">,</span> srv<span class="token punctuation">.</span>response<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/57/c1/S3f6zcLL_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/c4/2f/5XO9Fpnf_o.png" alt="在这里插入图片描述"></p> 
<ul><li>Python</li></ul> 
<pre><code class="prism language-py"><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token comment"># 该例程将请求/spawn服务，服务数据类型turtlesim::Spawn</span>

<span class="token keyword">import</span> sys
<span class="token keyword">import</span> rospy
<span class="token keyword">from</span> turtlesim<span class="token punctuation">.</span>srv <span class="token keyword">import</span> Spawn

<span class="token keyword">def</span> <span class="token function">turtle_spawn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment"># ROS节点初始化</span>
    rospy<span class="token punctuation">.</span>init_node<span class="token punctuation">(</span><span class="token string">'turtle_spawn'</span><span class="token punctuation">)</span>

	<span class="token comment"># 发现/spawn服务后，创建一个服务客户端，连接名为/spawn的service</span>
    rospy<span class="token punctuation">.</span>wait_for_service<span class="token punctuation">(</span><span class="token string">'/spawn'</span><span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        add_turtle <span class="token operator">=</span> rospy<span class="token punctuation">.</span>ServiceProxy<span class="token punctuation">(</span><span class="token string">'/spawn'</span><span class="token punctuation">,</span> Spawn<span class="token punctuation">)</span>

		<span class="token comment"># 请求服务调用，输入请求数据</span>
        response <span class="token operator">=</span> add_turtle<span class="token punctuation">(</span><span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token string">"turtle2"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> response<span class="token punctuation">.</span>name
    <span class="token keyword">except</span> rospy<span class="token punctuation">.</span>ServiceException<span class="token punctuation">,</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span> <span class="token string">"Service call failed: %s"</span><span class="token operator">%</span>e

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
	<span class="token comment">#服务调用并显示调用结果</span>
    <span class="token keyword">print</span> <span class="token string">"Spwan turtle successfully [name:%s]"</span> <span class="token operator">%</span><span class="token punctuation">(</span>turtle_spawn<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="27_Server_506"></a>2.7 服务端Server的编程实现</h3> 
<p><img src="https://images2.imgbox.com/a1/8b/FcdeP7gD_o.png" alt="在这里插入图片描述"></p> 
<ul><li>C++</li></ul> 
<pre><code class="prism language-py"><span class="token operator">/</span><span class="token operator">**</span>
 <span class="token operator">*</span> 该例程将执行<span class="token operator">/</span>turtle_command服务，服务数据类型std_srvs<span class="token operator">/</span>Trigger
 <span class="token operator">*</span><span class="token operator">/</span>
 
<span class="token comment">#include &lt;ros/ros.h&gt;</span>
<span class="token comment">#include &lt;geometry_msgs/Twist.h&gt;</span>
<span class="token comment">#include &lt;std_srvs/Trigger.h&gt;</span>

ros<span class="token punctuation">:</span><span class="token punctuation">:</span>Publisher turtle_vel_pub<span class="token punctuation">;</span>
<span class="token builtin">bool</span> pubCommand <span class="token operator">=</span> false<span class="token punctuation">;</span>

<span class="token operator">//</span> service回调函数，输入参数req，输出参数res
<span class="token builtin">bool</span> commandCallback<span class="token punctuation">(</span>std_srvs<span class="token punctuation">:</span><span class="token punctuation">:</span>Trigger<span class="token punctuation">:</span><span class="token punctuation">:</span>Request  <span class="token operator">&amp;</span>req<span class="token punctuation">,</span>
         			std_srvs<span class="token punctuation">:</span><span class="token punctuation">:</span>Trigger<span class="token punctuation">:</span><span class="token punctuation">:</span>Response <span class="token operator">&amp;</span>res<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	pubCommand <span class="token operator">=</span> !pubCommand<span class="token punctuation">;</span>

    <span class="token operator">//</span> 显示请求数据
    ROS_INFO<span class="token punctuation">(</span><span class="token string">"Publish turtle velocity command [%s]"</span><span class="token punctuation">,</span> pubCommand<span class="token operator">==</span>true?<span class="token string">"Yes"</span><span class="token punctuation">:</span><span class="token string">"No"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token operator">//</span> 设置反馈数据
	res<span class="token punctuation">.</span>success <span class="token operator">=</span> true<span class="token punctuation">;</span>
	res<span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token string">"Change turtle command state!"</span>

    <span class="token keyword">return</span> true<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token builtin">int</span> main<span class="token punctuation">(</span><span class="token builtin">int</span> argc<span class="token punctuation">,</span> char <span class="token operator">**</span>argv<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token operator">//</span> ROS节点初始化
    ros<span class="token punctuation">:</span><span class="token punctuation">:</span>init<span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">,</span> <span class="token string">"turtle_command_server"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token operator">//</span> 创建节点句柄
    ros<span class="token punctuation">:</span><span class="token punctuation">:</span>NodeHandle n<span class="token punctuation">;</span>

    <span class="token operator">//</span> 创建一个名为<span class="token operator">/</span>turtle_command的server，注册回调函数commandCallback
    ros<span class="token punctuation">:</span><span class="token punctuation">:</span>ServiceServer command_service <span class="token operator">=</span> n<span class="token punctuation">.</span>advertiseService<span class="token punctuation">(</span><span class="token string">"/turtle_command"</span><span class="token punctuation">,</span> commandCallback<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token operator">//</span> 创建一个Publisher，发布名为<span class="token operator">/</span>turtle1<span class="token operator">/</span>cmd_vel的topic，消息类型为geometry_msgs<span class="token punctuation">:</span><span class="token punctuation">:</span>Twist，队列长度<span class="token number">10</span>
	turtle_vel_pub <span class="token operator">=</span> n<span class="token punctuation">.</span>advertise<span class="token operator">&lt;</span>geometry_msgs<span class="token punctuation">:</span><span class="token punctuation">:</span>Twist<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">"/turtle1/cmd_vel"</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token operator">//</span> 循环等待回调函数
    ROS_INFO<span class="token punctuation">(</span><span class="token string">"Ready to receive turtle command."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token operator">//</span> 设置循环的频率
	ros<span class="token punctuation">:</span><span class="token punctuation">:</span>Rate loop_rate<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">while</span><span class="token punctuation">(</span>ros<span class="token punctuation">:</span><span class="token punctuation">:</span>ok<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token operator">//</span> 查看一次回调函数队列
    	ros<span class="token punctuation">:</span><span class="token punctuation">:</span>spinOnce<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token operator">//</span> 如果标志为true，则发布速度指令
		<span class="token keyword">if</span><span class="token punctuation">(</span>pubCommand<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			geometry_msgs<span class="token punctuation">:</span><span class="token punctuation">:</span>Twist vel_msg<span class="token punctuation">;</span>
			vel_msg<span class="token punctuation">.</span>linear<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
			vel_msg<span class="token punctuation">.</span>angular<span class="token punctuation">.</span>z <span class="token operator">=</span> <span class="token number">0.2</span><span class="token punctuation">;</span>
			turtle_vel_pub<span class="token punctuation">.</span>publish<span class="token punctuation">(</span>vel_msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token operator">//</span>按照循环频率延时
	    loop_rate<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/af/2a/kuubeZqW_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/40/78/FWdSGSSz_o.png" alt="在这里插入图片描述"></p> 
<ul><li>Python</li></ul> 
<blockquote> 
 <p>注意，ros在Python中没有spinonce方法，可通过多线程来实现</p> 
</blockquote> 
<pre><code class="prism language-py"><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token comment"># 该例程将执行/turtle_command服务，服务数据类型std_srvs/Trigger</span>

<span class="token keyword">import</span> rospy
<span class="token keyword">import</span> thread<span class="token punctuation">,</span>time
<span class="token keyword">from</span> geometry_msgs<span class="token punctuation">.</span>msg <span class="token keyword">import</span> Twist
<span class="token keyword">from</span> std_srvs<span class="token punctuation">.</span>srv <span class="token keyword">import</span> Trigger<span class="token punctuation">,</span> TriggerResponse

pubCommand <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">;</span>
turtle_vel_pub <span class="token operator">=</span> rospy<span class="token punctuation">.</span>Publisher<span class="token punctuation">(</span><span class="token string">'/turtle1/cmd_vel'</span><span class="token punctuation">,</span> Twist<span class="token punctuation">,</span> queue_size<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">command_thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>	
	<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
		<span class="token keyword">if</span> pubCommand<span class="token punctuation">:</span>
			vel_msg <span class="token operator">=</span> Twist<span class="token punctuation">(</span><span class="token punctuation">)</span>
			vel_msg<span class="token punctuation">.</span>linear<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">0.5</span>
			vel_msg<span class="token punctuation">.</span>angular<span class="token punctuation">.</span>z <span class="token operator">=</span> <span class="token number">0.2</span>
			turtle_vel_pub<span class="token punctuation">.</span>publish<span class="token punctuation">(</span>vel_msg<span class="token punctuation">)</span>
			
		time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">commandCallback</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">global</span> pubCommand
	pubCommand <span class="token operator">=</span> <span class="token builtin">bool</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span>pubCommand<span class="token punctuation">)</span>

	<span class="token comment"># 显示请求数据</span>
	rospy<span class="token punctuation">.</span>loginfo<span class="token punctuation">(</span><span class="token string">"Publish turtle velocity command![%d]"</span><span class="token punctuation">,</span> pubCommand<span class="token punctuation">)</span>

	<span class="token comment"># 反馈数据</span>
	<span class="token keyword">return</span> TriggerResponse<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"Change turtle command state!"</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">turtle_command_server</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment"># ROS节点初始化</span>
    rospy<span class="token punctuation">.</span>init_node<span class="token punctuation">(</span><span class="token string">'turtle_command_server'</span><span class="token punctuation">)</span>

	<span class="token comment"># 创建一个名为/turtle_command的server，注册回调函数commandCallback</span>
    s <span class="token operator">=</span> rospy<span class="token punctuation">.</span>Service<span class="token punctuation">(</span><span class="token string">'/turtle_command'</span><span class="token punctuation">,</span> Trigger<span class="token punctuation">,</span> commandCallback<span class="token punctuation">)</span>

	<span class="token comment"># 循环等待回调函数</span>
    <span class="token keyword">print</span> <span class="token string">"Ready to receive turtle command."</span>

    thread<span class="token punctuation">.</span>start_new_thread<span class="token punctuation">(</span>command_thread<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    rospy<span class="token punctuation">.</span>spin<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    turtle_command_server<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<h3><a id="28__633"></a>2.8 服务数据的定义与使用</h3> 
<p><img src="https://images2.imgbox.com/92/db/Puit8YAH_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/ea/d9/JjGFGK27_o.png" alt="在这里插入图片描述"></p> 
<ul><li>C++</li></ul> 
<pre><code class="prism language-c"><span class="token comment">//客户端</span>
<span class="token comment">/**
 * 该例程将请求/show_person服务，服务数据类型learning_service::Person
 */</span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;ros/ros.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"learning_service/Person.h"</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span> argv<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 初始化ROS节点</span>
	ros<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">init</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">,</span> <span class="token string">"person_client"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 创建节点句柄</span>
	ros<span class="token punctuation">:</span><span class="token punctuation">:</span>NodeHandle node<span class="token punctuation">;</span>

    <span class="token comment">// 发现/spawn服务后，创建一个服务客户端，连接名为/spawn的service</span>
	ros<span class="token punctuation">:</span><span class="token punctuation">:</span>service<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">waitForService</span><span class="token punctuation">(</span><span class="token string">"/show_person"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	ros<span class="token punctuation">:</span><span class="token punctuation">:</span>ServiceClient person_client <span class="token operator">=</span> node<span class="token punctuation">.</span>serviceClient<span class="token operator">&lt;</span>learning_service<span class="token punctuation">:</span><span class="token punctuation">:</span>Person<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">"/show_person"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 初始化learning_service::Person的请求数据</span>
	learning_service<span class="token punctuation">:</span><span class="token punctuation">:</span>Person srv<span class="token punctuation">;</span> <span class="token comment">//注意要跟srv的文件名相同</span>
	srv<span class="token punctuation">.</span>request<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"Tom"</span><span class="token punctuation">;</span>
	srv<span class="token punctuation">.</span>request<span class="token punctuation">.</span>age  <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
	srv<span class="token punctuation">.</span>request<span class="token punctuation">.</span>sex  <span class="token operator">=</span> learning_service<span class="token punctuation">:</span><span class="token punctuation">:</span>Person<span class="token punctuation">:</span><span class="token punctuation">:</span>Request<span class="token punctuation">:</span><span class="token punctuation">:</span>male<span class="token punctuation">;</span>

    <span class="token comment">// 请求服务调用</span>
	<span class="token function">ROS_INFO</span><span class="token punctuation">(</span><span class="token string">"Call service to show person[name:%s, age:%d, sex:%d]"</span><span class="token punctuation">,</span> 
			 srv<span class="token punctuation">.</span>request<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> srv<span class="token punctuation">.</span>request<span class="token punctuation">.</span>age<span class="token punctuation">,</span> srv<span class="token punctuation">.</span>request<span class="token punctuation">.</span>sex<span class="token punctuation">)</span><span class="token punctuation">;</span>

	person_client<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>srv<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// 显示服务调用结果</span>
	<span class="token function">ROS_INFO</span><span class="token punctuation">(</span><span class="token string">"Show person result : %s"</span><span class="token punctuation">,</span> srv<span class="token punctuation">.</span>response<span class="token punctuation">.</span>result<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>





<span class="token comment">//服务端</span>

<span class="token comment">/**
 * 该例程将执行/show_person服务，服务数据类型learning_service::Person
 */</span>
 
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;ros/ros.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"learning_service/Person.h"</span></span>

<span class="token comment">// service回调函数，输入参数req，输出参数res</span>
bool <span class="token function">personCallback</span><span class="token punctuation">(</span>learning_service<span class="token punctuation">:</span><span class="token punctuation">:</span>Person<span class="token punctuation">:</span><span class="token punctuation">:</span>Request  <span class="token operator">&amp;</span>req<span class="token punctuation">,</span>
         			learning_service<span class="token punctuation">:</span><span class="token punctuation">:</span>Person<span class="token punctuation">:</span><span class="token punctuation">:</span>Response <span class="token operator">&amp;</span>res<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 显示请求数据</span>
    <span class="token function">ROS_INFO</span><span class="token punctuation">(</span><span class="token string">"Person: name:%s  age:%d  sex:%d"</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>age<span class="token punctuation">,</span> req<span class="token punctuation">.</span>sex<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// 设置反馈数据</span>
	res<span class="token punctuation">.</span>result <span class="token operator">=</span> <span class="token string">"OK"</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> true<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ROS节点初始化</span>
    ros<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">init</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">,</span> <span class="token string">"person_server"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 创建节点句柄</span>
    ros<span class="token punctuation">:</span><span class="token punctuation">:</span>NodeHandle n<span class="token punctuation">;</span>

    <span class="token comment">// 创建一个名为/show_person的server，注册回调函数personCallback</span>
    ros<span class="token punctuation">:</span><span class="token punctuation">:</span>ServiceServer person_service <span class="token operator">=</span> n<span class="token punctuation">.</span><span class="token function">advertiseService</span><span class="token punctuation">(</span><span class="token string">"/show_person"</span><span class="token punctuation">,</span> personCallback<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 循环等待回调函数</span>
    <span class="token function">ROS_INFO</span><span class="token punctuation">(</span><span class="token string">"Ready to show person informtion."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ros<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">spin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> 
<ul><li>Python</li></ul> 
<p>客户端</p> 
<pre><code class="prism language-py"><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token comment"># 该例程将请求/show_person服务，服务数据类型learning_service::Person</span>

<span class="token keyword">import</span> sys
<span class="token keyword">import</span> rospy
<span class="token keyword">from</span> learning_service<span class="token punctuation">.</span>srv <span class="token keyword">import</span> Person<span class="token punctuation">,</span> PersonRequest

<span class="token keyword">def</span> <span class="token function">person_client</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment"># ROS节点初始化</span>
    rospy<span class="token punctuation">.</span>init_node<span class="token punctuation">(</span><span class="token string">'person_client'</span><span class="token punctuation">)</span>

	<span class="token comment"># 发现/spawn服务后，创建一个服务客户端，连接名为/spawn的service</span>
    rospy<span class="token punctuation">.</span>wait_for_service<span class="token punctuation">(</span><span class="token string">'/show_person'</span><span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        person_client <span class="token operator">=</span> rospy<span class="token punctuation">.</span>ServiceProxy<span class="token punctuation">(</span><span class="token string">'/show_person'</span><span class="token punctuation">,</span> Person<span class="token punctuation">)</span>

		<span class="token comment"># 请求服务调用，输入请求数据</span>
        response <span class="token operator">=</span> person_client<span class="token punctuation">(</span><span class="token string">"Tom"</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> PersonRequest<span class="token punctuation">.</span>male<span class="token punctuation">)</span>
        <span class="token keyword">return</span> response<span class="token punctuation">.</span>result
    <span class="token keyword">except</span> rospy<span class="token punctuation">.</span>ServiceException<span class="token punctuation">,</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span> <span class="token string">"Service call failed: %s"</span><span class="token operator">%</span>e

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
	<span class="token comment">#服务调用并显示调用结果</span>
    <span class="token keyword">print</span> <span class="token string">"Show person result : %s"</span> <span class="token operator">%</span><span class="token punctuation">(</span>person_client<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>



服务端

<span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token comment"># 该例程将执行/show_person服务，服务数据类型learning_service::Person</span>

<span class="token keyword">import</span> rospy
<span class="token keyword">from</span> learning_service<span class="token punctuation">.</span>srv <span class="token keyword">import</span> Person<span class="token punctuation">,</span> PersonResponse

<span class="token keyword">def</span> <span class="token function">personCallback</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment"># 显示请求数据</span>
    rospy<span class="token punctuation">.</span>loginfo<span class="token punctuation">(</span><span class="token string">"Person: name:%s  age:%d  sex:%d"</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>name<span class="token punctuation">,</span> req<span class="token punctuation">.</span>age<span class="token punctuation">,</span> req<span class="token punctuation">.</span>sex<span class="token punctuation">)</span>

	<span class="token comment"># 反馈数据</span>
    <span class="token keyword">return</span> PersonResponse<span class="token punctuation">(</span><span class="token string">"OK"</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">person_server</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment"># ROS节点初始化</span>
    rospy<span class="token punctuation">.</span>init_node<span class="token punctuation">(</span><span class="token string">'person_server'</span><span class="token punctuation">)</span>

	<span class="token comment"># 创建一个名为/show_person的server，注册回调函数personCallback</span>
    s <span class="token operator">=</span> rospy<span class="token punctuation">.</span>Service<span class="token punctuation">(</span><span class="token string">'/show_person'</span><span class="token punctuation">,</span> Person<span class="token punctuation">,</span> personCallback<span class="token punctuation">)</span>

	<span class="token comment"># 循环等待回调函数</span>
    <span class="token keyword">print</span> <span class="token string">"Ready to show person informtion."</span>
    rospy<span class="token punctuation">.</span>spin<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    person_server<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<h3><a id="29__791"></a>2.9 参数的使用与编程方法</h3> 
<p><img src="https://images2.imgbox.com/78/59/PTHEOJmU_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/09/c9/6h5IQyzt_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/fe/e2/6cPGCzpK_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/44/33/1w4qHZ0d_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/b6/3f/6NRewRuK_o.png" alt="在这里插入图片描述"></p> 
<ul><li>C++</li></ul> 
<pre><code class="prism language-c"><span class="token comment">/**
 * 该例程设置/读取海龟例程中的参数
 */</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;ros/ros.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;std_srvs/Empty.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> red<span class="token punctuation">,</span> green<span class="token punctuation">,</span> blue<span class="token punctuation">;</span>

    <span class="token comment">// ROS节点初始化</span>
    ros<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">init</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">,</span> <span class="token string">"parameter_config"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 创建节点句柄</span>
    ros<span class="token punctuation">:</span><span class="token punctuation">:</span>NodeHandle node<span class="token punctuation">;</span>

    <span class="token comment">// 读取背景颜色参数</span>
	ros<span class="token punctuation">:</span><span class="token punctuation">:</span>param<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/background_r"</span><span class="token punctuation">,</span> red<span class="token punctuation">)</span><span class="token punctuation">;</span>
	ros<span class="token punctuation">:</span><span class="token punctuation">:</span>param<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/background_g"</span><span class="token punctuation">,</span> green<span class="token punctuation">)</span><span class="token punctuation">;</span>
	ros<span class="token punctuation">:</span><span class="token punctuation">:</span>param<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/background_b"</span><span class="token punctuation">,</span> blue<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">ROS_INFO</span><span class="token punctuation">(</span><span class="token string">"Get Backgroud Color[%d, %d, %d]"</span><span class="token punctuation">,</span> red<span class="token punctuation">,</span> green<span class="token punctuation">,</span> blue<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// 设置背景颜色参数</span>
	ros<span class="token punctuation">:</span><span class="token punctuation">:</span>param<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"/background_r"</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	ros<span class="token punctuation">:</span><span class="token punctuation">:</span>param<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"/background_g"</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	ros<span class="token punctuation">:</span><span class="token punctuation">:</span>param<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"/background_b"</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">ROS_INFO</span><span class="token punctuation">(</span><span class="token string">"Set Backgroud Color[255, 255, 255]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 读取背景颜色参数</span>
	ros<span class="token punctuation">:</span><span class="token punctuation">:</span>param<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/background_r"</span><span class="token punctuation">,</span> red<span class="token punctuation">)</span><span class="token punctuation">;</span>
	ros<span class="token punctuation">:</span><span class="token punctuation">:</span>param<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/background_g"</span><span class="token punctuation">,</span> green<span class="token punctuation">)</span><span class="token punctuation">;</span>
	ros<span class="token punctuation">:</span><span class="token punctuation">:</span>param<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/background_b"</span><span class="token punctuation">,</span> blue<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">ROS_INFO</span><span class="token punctuation">(</span><span class="token string">"Re-get Backgroud Color[%d, %d, %d]"</span><span class="token punctuation">,</span> red<span class="token punctuation">,</span> green<span class="token punctuation">,</span> blue<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// 调用服务，刷新背景颜色</span>
	ros<span class="token punctuation">:</span><span class="token punctuation">:</span>service<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">waitForService</span><span class="token punctuation">(</span><span class="token string">"/clear"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	ros<span class="token punctuation">:</span><span class="token punctuation">:</span>ServiceClient clear_background <span class="token operator">=</span> node<span class="token punctuation">.</span>serviceClient<span class="token operator">&lt;</span>std_srvs<span class="token punctuation">:</span><span class="token punctuation">:</span>Empty<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">"/clear"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	std_srvs<span class="token punctuation">:</span><span class="token punctuation">:</span>Empty srv<span class="token punctuation">;</span>
	clear_background<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>srv<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> 
<p><img src="https://images2.imgbox.com/7e/f2/BBL0IPT5_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/4c/62/W7zmntOJ_o.png" alt="在这里插入图片描述"></p> 
<ul><li>Python</li></ul> 
<pre><code class="prism language-py"><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token comment"># 该例程设置/读取海龟例程中的参数</span>

<span class="token keyword">import</span> sys
<span class="token keyword">import</span> rospy
<span class="token keyword">from</span> std_srvs<span class="token punctuation">.</span>srv <span class="token keyword">import</span> Empty

<span class="token keyword">def</span> <span class="token function">parameter_config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment"># ROS节点初始化</span>
    rospy<span class="token punctuation">.</span>init_node<span class="token punctuation">(</span><span class="token string">'parameter_config'</span><span class="token punctuation">,</span> anonymous<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

	<span class="token comment"># 读取背景颜色参数</span>
    red   <span class="token operator">=</span> rospy<span class="token punctuation">.</span>get_param<span class="token punctuation">(</span><span class="token string">'/background_r'</span><span class="token punctuation">)</span>
    green <span class="token operator">=</span> rospy<span class="token punctuation">.</span>get_param<span class="token punctuation">(</span><span class="token string">'/background_g'</span><span class="token punctuation">)</span>
    blue  <span class="token operator">=</span> rospy<span class="token punctuation">.</span>get_param<span class="token punctuation">(</span><span class="token string">'/background_b'</span><span class="token punctuation">)</span>

    rospy<span class="token punctuation">.</span>loginfo<span class="token punctuation">(</span><span class="token string">"Get Backgroud Color[%d, %d, %d]"</span><span class="token punctuation">,</span> red<span class="token punctuation">,</span> green<span class="token punctuation">,</span> blue<span class="token punctuation">)</span>

	<span class="token comment"># 设置背景颜色参数</span>
    rospy<span class="token punctuation">.</span>set_param<span class="token punctuation">(</span><span class="token string">"/background_r"</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    rospy<span class="token punctuation">.</span>set_param<span class="token punctuation">(</span><span class="token string">"/background_g"</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    rospy<span class="token punctuation">.</span>set_param<span class="token punctuation">(</span><span class="token string">"/background_b"</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    rospy<span class="token punctuation">.</span>loginfo<span class="token punctuation">(</span><span class="token string">"Set Backgroud Color[255, 255, 255]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment"># 读取背景颜色参数</span>
    red   <span class="token operator">=</span> rospy<span class="token punctuation">.</span>get_param<span class="token punctuation">(</span><span class="token string">'/background_r'</span><span class="token punctuation">)</span>
    green <span class="token operator">=</span> rospy<span class="token punctuation">.</span>get_param<span class="token punctuation">(</span><span class="token string">'/background_g'</span><span class="token punctuation">)</span>
    blue  <span class="token operator">=</span> rospy<span class="token punctuation">.</span>get_param<span class="token punctuation">(</span><span class="token string">'/background_b'</span><span class="token punctuation">)</span>

    rospy<span class="token punctuation">.</span>loginfo<span class="token punctuation">(</span><span class="token string">"Get Backgroud Color[%d, %d, %d]"</span><span class="token punctuation">,</span> red<span class="token punctuation">,</span> green<span class="token punctuation">,</span> blue<span class="token punctuation">)</span>

	<span class="token comment"># 发现/spawn服务后，创建一个服务客户端，连接名为/spawn的service</span>
    rospy<span class="token punctuation">.</span>wait_for_service<span class="token punctuation">(</span><span class="token string">'/clear'</span><span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        clear_background <span class="token operator">=</span> rospy<span class="token punctuation">.</span>ServiceProxy<span class="token punctuation">(</span><span class="token string">'/clear'</span><span class="token punctuation">,</span> Empty<span class="token punctuation">)</span>

		<span class="token comment"># 请求服务调用，输入请求数据</span>
        response <span class="token operator">=</span> clear_background<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> response
    <span class="token keyword">except</span> rospy<span class="token punctuation">.</span>ServiceException<span class="token punctuation">,</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span> <span class="token string">"Service call failed: %s"</span><span class="token operator">%</span>e

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    parameter_config<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<h3><a id="210_tf_905"></a>2.10 tf坐标系广播与监听的编程实现</h3> 
<p><img src="https://images2.imgbox.com/63/75/3NJkgoX1_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/e5/45/OibtwnEE_o.png" alt="在这里插入图片描述"></p> 
<ul><li>C++<br> 广播器的编写</li></ul> 
<pre><code class="prism language-c"><span class="token comment">/**
 * 该例程产生tf数据，并计算、发布turtle2的速度指令
 */</span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;ros/ros.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;tf/transform_broadcaster.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;turtlesim/Pose.h&gt;</span></span>

std<span class="token punctuation">:</span><span class="token punctuation">:</span>string turtle_name<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">poseCallback</span><span class="token punctuation">(</span><span class="token keyword">const</span> turtlesim<span class="token punctuation">:</span><span class="token punctuation">:</span>PoseConstPtr<span class="token operator">&amp;</span> msg<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 创建tf的广播器</span>
	<span class="token keyword">static</span> tf<span class="token punctuation">:</span><span class="token punctuation">:</span>TransformBroadcaster br<span class="token punctuation">;</span>

	<span class="token comment">// 初始化tf数据</span>
	tf<span class="token punctuation">:</span><span class="token punctuation">:</span>Transform transform<span class="token punctuation">;</span>
	transform<span class="token punctuation">.</span><span class="token function">setOrigin</span><span class="token punctuation">(</span> tf<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">Vector3</span><span class="token punctuation">(</span>msg<span class="token operator">-&gt;</span>x<span class="token punctuation">,</span> msg<span class="token operator">-&gt;</span>y<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
	tf<span class="token punctuation">:</span><span class="token punctuation">:</span>Quaternion q<span class="token punctuation">;</span>
	q<span class="token punctuation">.</span><span class="token function">setRPY</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> msg<span class="token operator">-&gt;</span>theta<span class="token punctuation">)</span><span class="token punctuation">;</span>
	transform<span class="token punctuation">.</span><span class="token function">setRotation</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// 广播world与海龟坐标系之间的tf数据</span>
	br<span class="token punctuation">.</span><span class="token function">sendTransform</span><span class="token punctuation">(</span>tf<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">StampedTransform</span><span class="token punctuation">(</span>transform<span class="token punctuation">,</span> ros<span class="token punctuation">:</span><span class="token punctuation">:</span>Time<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"world"</span><span class="token punctuation">,</span> turtle_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span> argv<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 初始化ROS节点</span>
	ros<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">init</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">,</span> <span class="token string">"my_tf_broadcaster"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// 输入参数作为海龟的名字</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>argc <span class="token operator">!=</span> <span class="token number">2</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">ROS_ERROR</span><span class="token punctuation">(</span><span class="token string">"need turtle name as argument"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	turtle_name <span class="token operator">=</span> argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

	<span class="token comment">// 订阅海龟的位姿话题</span>
	ros<span class="token punctuation">:</span><span class="token punctuation">:</span>NodeHandle node<span class="token punctuation">;</span>
	ros<span class="token punctuation">:</span><span class="token punctuation">:</span>Subscriber sub <span class="token operator">=</span> node<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>turtle_name<span class="token operator">+</span><span class="token string">"/pose"</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>poseCallback<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 循环等待回调函数</span>
	ros<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">spin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>



</code></pre> 
<p>监听器的编写</p> 
<pre><code class="prism language-c"><span class="token comment">/**
 * 该例程监听tf数据，并计算、发布turtle2的速度指令
 */</span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;ros/ros.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;tf/transform_listener.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;geometry_msgs/Twist.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;turtlesim/Spawn.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span> argv<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 初始化ROS节点</span>
	ros<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">init</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">,</span> <span class="token string">"my_tf_listener"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 创建节点句柄</span>
	ros<span class="token punctuation">:</span><span class="token punctuation">:</span>NodeHandle node<span class="token punctuation">;</span>

	<span class="token comment">// 请求产生turtle2</span>
	ros<span class="token punctuation">:</span><span class="token punctuation">:</span>service<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">waitForService</span><span class="token punctuation">(</span><span class="token string">"/spawn"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	ros<span class="token punctuation">:</span><span class="token punctuation">:</span>ServiceClient add_turtle <span class="token operator">=</span> node<span class="token punctuation">.</span>serviceClient<span class="token operator">&lt;</span>turtlesim<span class="token punctuation">:</span><span class="token punctuation">:</span>Spawn<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">"/spawn"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	turtlesim<span class="token punctuation">:</span><span class="token punctuation">:</span>Spawn srv<span class="token punctuation">;</span>
	add_turtle<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>srv<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// 创建发布turtle2速度控制指令的发布者</span>
	ros<span class="token punctuation">:</span><span class="token punctuation">:</span>Publisher turtle_vel <span class="token operator">=</span> node<span class="token punctuation">.</span>advertise<span class="token operator">&lt;</span>geometry_msgs<span class="token punctuation">:</span><span class="token punctuation">:</span>Twist<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">"/turtle2/cmd_vel"</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// 创建tf的监听器</span>
	tf<span class="token punctuation">:</span><span class="token punctuation">:</span>TransformListener listener<span class="token punctuation">;</span>

	ros<span class="token punctuation">:</span><span class="token punctuation">:</span>Rate <span class="token function">rate</span><span class="token punctuation">(</span><span class="token number">10.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token comment">// 获取turtle1与turtle2坐标系之间的tf数据</span>
		tf<span class="token punctuation">:</span><span class="token punctuation">:</span>StampedTransform transform<span class="token punctuation">;</span>
		try
		<span class="token punctuation">{<!-- --></span>
			<span class="token comment">//查询是否有这两个坐标系，查询当前时间，如果超过3s则报错</span>
			listener<span class="token punctuation">.</span><span class="token function">waitForTransform</span><span class="token punctuation">(</span><span class="token string">"/turtle2"</span><span class="token punctuation">,</span> <span class="token string">"/turtle1"</span><span class="token punctuation">,</span> ros<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">Time</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ros<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">Duration</span><span class="token punctuation">(</span><span class="token number">3.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			listener<span class="token punctuation">.</span><span class="token function">lookupTransform</span><span class="token punctuation">(</span><span class="token string">"/turtle2"</span><span class="token punctuation">,</span> <span class="token string">"/turtle1"</span><span class="token punctuation">,</span> ros<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">Time</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> transform<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		catch <span class="token punctuation">(</span>tf<span class="token punctuation">:</span><span class="token punctuation">:</span>TransformException <span class="token operator">&amp;</span>ex<span class="token punctuation">)</span> 
		<span class="token punctuation">{<!-- --></span>
			<span class="token function">ROS_ERROR</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span>ex<span class="token punctuation">.</span><span class="token function">what</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			ros<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">Duration</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">continue</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// 根据turtle1与turtle2坐标系之间的位置关系，发布turtle2的速度控制指令</span>
		geometry_msgs<span class="token punctuation">:</span><span class="token punctuation">:</span>Twist vel_msg<span class="token punctuation">;</span>
		vel_msg<span class="token punctuation">.</span>angular<span class="token punctuation">.</span>z <span class="token operator">=</span> <span class="token number">4.0</span> <span class="token operator">*</span> <span class="token function">atan2</span><span class="token punctuation">(</span>transform<span class="token punctuation">.</span><span class="token function">getOrigin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				                        transform<span class="token punctuation">.</span><span class="token function">getOrigin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		vel_msg<span class="token punctuation">.</span>linear<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">0.5</span> <span class="token operator">*</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span>transform<span class="token punctuation">.</span><span class="token function">getOrigin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span>
				                      <span class="token function">pow</span><span class="token punctuation">(</span>transform<span class="token punctuation">.</span><span class="token function">getOrigin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		turtle_vel<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span>vel_msg<span class="token punctuation">)</span><span class="token punctuation">;</span>

		rate<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre> 
<p><img src="https://images2.imgbox.com/53/c4/qGB7OoEQ_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/ab/93/1RIkIXLa_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/2b/8f/FeSByIyK_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<ul><li>Python</li></ul> 
<p>广播器的编写</p> 
<pre><code class="prism language-py"><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token comment"># 该例程将请求/show_person服务，服务数据类型learning_service::Person</span>

<span class="token keyword">import</span> roslib
roslib<span class="token punctuation">.</span>load_manifest<span class="token punctuation">(</span><span class="token string">'learning_tf'</span><span class="token punctuation">)</span>
<span class="token keyword">import</span> rospy

<span class="token keyword">import</span> tf
<span class="token keyword">import</span> turtlesim<span class="token punctuation">.</span>msg

<span class="token keyword">def</span> <span class="token function">handle_turtle_pose</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> turtlename<span class="token punctuation">)</span><span class="token punctuation">:</span>
    br <span class="token operator">=</span> tf<span class="token punctuation">.</span>TransformBroadcaster<span class="token punctuation">(</span><span class="token punctuation">)</span>
    br<span class="token punctuation">.</span>sendTransform<span class="token punctuation">(</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>x<span class="token punctuation">,</span> msg<span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                     tf<span class="token punctuation">.</span>transformations<span class="token punctuation">.</span>quaternion_from_euler<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> msg<span class="token punctuation">.</span>theta<span class="token punctuation">)</span><span class="token punctuation">,</span>
                     rospy<span class="token punctuation">.</span>Time<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                     turtlename<span class="token punctuation">,</span>
                     <span class="token string">"world"</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    rospy<span class="token punctuation">.</span>init_node<span class="token punctuation">(</span><span class="token string">'turtle_tf_broadcaster'</span><span class="token punctuation">)</span>
    turtlename <span class="token operator">=</span> rospy<span class="token punctuation">.</span>get_param<span class="token punctuation">(</span><span class="token string">'~turtle'</span><span class="token punctuation">)</span>
    rospy<span class="token punctuation">.</span>Subscriber<span class="token punctuation">(</span><span class="token string">'/%s/pose'</span> <span class="token operator">%</span> turtlename<span class="token punctuation">,</span>
                     turtlesim<span class="token punctuation">.</span>msg<span class="token punctuation">.</span>Pose<span class="token punctuation">,</span>
                     handle_turtle_pose<span class="token punctuation">,</span>
                     turtlename<span class="token punctuation">)</span>
    rospy<span class="token punctuation">.</span>spin<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<p>监听器的编写</p> 
<pre><code class="prism language-py"><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token comment"># 该例程将请求/show_person服务，服务数据类型learning_service::Person</span>

<span class="token keyword">import</span> roslib
roslib<span class="token punctuation">.</span>load_manifest<span class="token punctuation">(</span><span class="token string">'learning_tf'</span><span class="token punctuation">)</span>
<span class="token keyword">import</span> rospy
<span class="token keyword">import</span> math
<span class="token keyword">import</span> tf
<span class="token keyword">import</span> geometry_msgs<span class="token punctuation">.</span>msg
<span class="token keyword">import</span> turtlesim<span class="token punctuation">.</span>srv

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    rospy<span class="token punctuation">.</span>init_node<span class="token punctuation">(</span><span class="token string">'turtle_tf_listener'</span><span class="token punctuation">)</span>

    listener <span class="token operator">=</span> tf<span class="token punctuation">.</span>TransformListener<span class="token punctuation">(</span><span class="token punctuation">)</span>

    rospy<span class="token punctuation">.</span>wait_for_service<span class="token punctuation">(</span><span class="token string">'spawn'</span><span class="token punctuation">)</span>
    spawner <span class="token operator">=</span> rospy<span class="token punctuation">.</span>ServiceProxy<span class="token punctuation">(</span><span class="token string">'spawn'</span><span class="token punctuation">,</span> turtlesim<span class="token punctuation">.</span>srv<span class="token punctuation">.</span>Spawn<span class="token punctuation">)</span>
    spawner<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'turtle2'</span><span class="token punctuation">)</span>

    turtle_vel <span class="token operator">=</span> rospy<span class="token punctuation">.</span>Publisher<span class="token punctuation">(</span><span class="token string">'turtle2/cmd_vel'</span><span class="token punctuation">,</span> geometry_msgs<span class="token punctuation">.</span>msg<span class="token punctuation">.</span>Twist<span class="token punctuation">,</span>queue_size<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

    rate <span class="token operator">=</span> rospy<span class="token punctuation">.</span>Rate<span class="token punctuation">(</span><span class="token number">10.0</span><span class="token punctuation">)</span>
    <span class="token keyword">while</span> <span class="token operator">not</span> rospy<span class="token punctuation">.</span>is_shutdown<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token punctuation">(</span>trans<span class="token punctuation">,</span>rot<span class="token punctuation">)</span> <span class="token operator">=</span> listener<span class="token punctuation">.</span>lookupTransform<span class="token punctuation">(</span><span class="token string">'/turtle2'</span><span class="token punctuation">,</span> <span class="token string">'/turtle1'</span><span class="token punctuation">,</span> rospy<span class="token punctuation">.</span>Time<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> <span class="token punctuation">(</span>tf<span class="token punctuation">.</span>LookupException<span class="token punctuation">,</span> tf<span class="token punctuation">.</span>ConnectivityException<span class="token punctuation">,</span> tf<span class="token punctuation">.</span>ExtrapolationException<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">continue</span>

        angular <span class="token operator">=</span> <span class="token number">4</span> <span class="token operator">*</span> math<span class="token punctuation">.</span>atan2<span class="token punctuation">(</span>trans<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> trans<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        linear <span class="token operator">=</span> <span class="token number">0.5</span> <span class="token operator">*</span> math<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>trans<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">**</span> <span class="token number">2</span> <span class="token operator">+</span> trans<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span>
        cmd <span class="token operator">=</span> geometry_msgs<span class="token punctuation">.</span>msg<span class="token punctuation">.</span>Twist<span class="token punctuation">(</span><span class="token punctuation">)</span>
        cmd<span class="token punctuation">.</span>linear<span class="token punctuation">.</span>x <span class="token operator">=</span> linear
        cmd<span class="token punctuation">.</span>angular<span class="token punctuation">.</span>z <span class="token operator">=</span> angular
        turtle_vel<span class="token punctuation">.</span>publish<span class="token punctuation">(</span>cmd<span class="token punctuation">)</span>

        rate<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<h3><a id="211_launch_1113"></a>2.11 launch启动文件的使用方法</h3> 
<p><strong>Launch文件</strong> ：通过XML文件实现多节点的配置和启动（可自动启动ROS Master）<br> Launch文件语法：<br> <img src="https://images2.imgbox.com/2e/f9/1Xj5jNiF_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/ac/bc/1hsG7mWt_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/56/26/9CCN1CmQ_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<p>参数设置<br> <img src="https://images2.imgbox.com/19/33/105PWjO6_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/86/4a/yGlIKQYq_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<p>重映射<br> <img src="https://images2.imgbox.com/0a/d7/o9eCjlYJ_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>注意，映射完后原资源就不复存在了</p> 
</blockquote> 
<hr> 
<p>嵌套<br> <img src="https://images2.imgbox.com/21/8d/XtY7ds7d_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<p>其他：https://wiki.ros.org/roslaunch/XML</p> 
<p>例1：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>launch</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>node</span> <span class="token attr-name">pkg</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>learning_topic<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>person_subscriber<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>talker<span class="token punctuation">"</span></span> <span class="token attr-name">output</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>screen<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>node</span> <span class="token attr-name">pkg</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>learning_topic<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>person_publisher<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>listener<span class="token punctuation">"</span></span> <span class="token attr-name">output</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>screen<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>launch</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>例2：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>launch</span><span class="token punctuation">&gt;</span></span>

	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/turtle_number<span class="token punctuation">"</span></span>   <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>node</span> <span class="token attr-name">pkg</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>turtlesim<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>turtlesim_node<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>turtlesim_node<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>turtle_name1<span class="token punctuation">"</span></span>   <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Tom<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>turtle_name2<span class="token punctuation">"</span></span>   <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Jerry<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>

		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rosparam</span> <span class="token attr-name">file</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>$(find learning_launch)/config/param.yaml<span class="token punctuation">"</span></span> <span class="token attr-name">command</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>load<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>node</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>node</span> <span class="token attr-name">pkg</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>turtlesim<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>turtle_teleop_key<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>turtle_teleop_key<span class="token punctuation">"</span></span> <span class="token attr-name">output</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>screen<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>launch</span><span class="token punctuation">&gt;</span></span>

</code></pre> 
<p>例3：</p> 
<pre><code class="prism language-xml"> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>launch</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!-- Turtlesim Node--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>node</span> <span class="token attr-name">pkg</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>turtlesim<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>turtlesim_node<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sim<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>node</span> <span class="token attr-name">pkg</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>turtlesim<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>turtle_teleop_key<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>teleop<span class="token punctuation">"</span></span> <span class="token attr-name">output</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>screen<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>node</span> <span class="token attr-name">pkg</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>learning_tf<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>turtle_tf_broadcaster<span class="token punctuation">"</span></span> <span class="token attr-name">args</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/turtle1<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>turtle1_tf_broadcaster<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>node</span> <span class="token attr-name">pkg</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>learning_tf<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>turtle_tf_broadcaster<span class="token punctuation">"</span></span> <span class="token attr-name">args</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/turtle2<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>turtle2_tf_broadcaster<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>node</span> <span class="token attr-name">pkg</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>learning_tf<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>turtle_tf_listener<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>listener<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>launch</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>例4：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>launch</span><span class="token punctuation">&gt;</span></span>

	<span class="token comment">&lt;!-- Turtlesim Node--&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>node</span> <span class="token attr-name">pkg</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>turtlesim<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>turtlesim_node<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sim<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>node</span> <span class="token attr-name">pkg</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>turtlesim<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>turtle_teleop_key<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>teleop<span class="token punctuation">"</span></span> <span class="token attr-name">output</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>screen<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>

	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>node</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>turtle1_tf_broadcaster<span class="token punctuation">"</span></span> <span class="token attr-name">pkg</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>learning_tf<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>turtle_tf_broadcaster.py<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
	  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>turtle<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>string<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>turtle1<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>node</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>node</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>turtle2_tf_broadcaster<span class="token punctuation">"</span></span> <span class="token attr-name">pkg</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>learning_tf<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>turtle_tf_broadcaster.py<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
	  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>turtle<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>string<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>turtle2<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span> 
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>node</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>node</span> <span class="token attr-name">pkg</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>learning_tf<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>turtle_tf_listener.py<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>listener<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>launch</span><span class="token punctuation">&gt;</span></span>

</code></pre> 
<p>例5：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>launch</span><span class="token punctuation">&gt;</span></span>

	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span> <span class="token attr-name">file</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>$(find learning_launch)/launch/simple.launch<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>node</span> <span class="token attr-name">pkg</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>turtlesim<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>turtlesim_node<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>turtlesim_node<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>remap</span> <span class="token attr-name">from</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/turtle1/cmd_vel<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/cmd_vel<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>node</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>launch</span><span class="token punctuation">&gt;</span></span>

</code></pre> 
<h3><a id="212__1217"></a>2.12 常用可视化工具的使用</h3> 
<h4><a id="2121_rqt_1219"></a>2.12.1 rqt</h4> 
<p><img src="https://images2.imgbox.com/18/4d/Lx33zjcx_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>rqt 是一个比较综合的工具，集成了rqt_ploat 等一系列的工具，可用于机器人的上位机调试软件</p> 
</blockquote> 
<h4><a id="2122_Rviz_1224"></a>2.12.2 Rviz</h4> 
<p><img src="https://images2.imgbox.com/73/c9/efhrlPLt_o.png" alt="在这里插入图片描述"></p> 
<pre><code>roscore
rosrun rviz rviz
</code></pre> 
<h4><a id="2123_Gazebo_1230"></a>2.12.3 Gazebo</h4> 
<p><img src="https://images2.imgbox.com/2b/34/1TNyRbbF_o.png" alt="在这里插入图片描述"></p> 
<pre><code>roslaunch gazebo_ros
</code></pre> 
<p><img src="https://images2.imgbox.com/08/f5/PRonVvPx_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/86/16/a6cgrxH1_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/63ceae0ad9f816792141c0818473874b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">GN介绍</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/cd81f321c3a84d9aac0882e2fd43f80a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">CSS 中奇数选择器与偶数选择器</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>