<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>tick数据生成K线数据 计算RSI - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="tick数据生成K线数据 计算RSI" />
<meta property="og:description" content="数据来源大富翁期货数据，文件存放示例 F:\share\zc\20180108\ZC805_20180108.csv F:\share\zc\20180109\ZC805_20180109.csv
以下 代码生成1分钟、5分钟、15分钟k线数据，包括RSI
数据示例：
大富翁数据中心_市场代码,合约代码,时间,最新,持仓,增仓,成交额,成交量,开仓,平仓,成交类型,方向,买一价,卖一价,买一量,卖一量
zc,ZC805,2018-01-02 08:59:00.000,605.0000,235386,10,165770.0000,274.0000,142,132,空开,S,605.0000,605.4000,28,33 zc,ZC805,2018-01-02 09:00:00.000,604.2000,235470,84,73810.0000,122.0000,103,19,空开,S,604.2000,605.0000,1,4 zc,ZC805,2018-01-02 09:00:01.000,604.0000,235478,8,44676.0000,74.0000,41,33,空开,S,604.0000,604.4000,2,2 zc,ZC805,2018-01-02 09:00:01.000,603.8000,235508,30,56738.4000,94.0000,62,32,空开,S,603.6000,603.8000,33,10 #coding: utf-8
#!/usr/bin/env python import numpy as np import pandas as pd import os def rsiFunc(prices, n=14): deltas = np.diff(prices) seed = deltas[:n&#43;1] up = (seed[seed&gt;=0].sum())/n&#43;0.000001 down = (-seed[seed&lt;0].sum())/n&#43;0.000001 rs = up/down rsi = np.zeros_like(prices) rsi[:n] = 100. - 100./(1.&#43;rs) for i in range(n, len(prices)): delta = deltas[i-1] # cause the diff is 1 shorter if delta&gt;0: upval = delta downval = 0." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/9f8cd41cf2d74a1f479293788ab9f5ad/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-04-04T17:09:32+08:00" />
<meta property="article:modified_time" content="2018-04-04T17:09:32+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">tick数据生成K线数据 计算RSI</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>数据来源大富翁期货数据，文件存放示例 <br>F:\share\zc\20180108\ZC805_20180108.csv F:\share\zc\20180109\ZC805_20180109.csv<br></p> 
<p> 以下 代码生成1分钟、5分钟、15分钟k线数据，包括RSI</p> 
<p></p> 
<p>数据示例：</p> 
<p>大富翁数据中心_市场代码,合约代码,时间,最新,持仓,增仓,成交额,成交量,开仓,平仓,成交类型,方向,买一价,卖一价,买一量,卖一量</p>zc,ZC805,2018-01-02 08:59:00.000,605.0000,235386,10,165770.0000,274.0000,142,132,空开,S,605.0000,605.4000,28,33 
<br>zc,ZC805,2018-01-02 09:00:00.000,604.2000,235470,84,73810.0000,122.0000,103,19,空开,S,604.2000,605.0000,1,4 
<br>zc,ZC805,2018-01-02 09:00:01.000,604.0000,235478,8,44676.0000,74.0000,41,33,空开,S,604.0000,604.4000,2,2 
<br>zc,ZC805,2018-01-02 09:00:01.000,603.8000,235508,30,56738.4000,94.0000,62,32,空开,S,603.6000,603.8000,33,10 
<p>#coding: utf-8</p>#!/usr/bin/env python 
<br>import numpy as np  
<br>import pandas as pd 
<br>import os 
<br>def rsiFunc(prices, n=14): 
<br>    deltas = np.diff(prices) 
<br>    seed = deltas[:n+1] 
<br>    up = (seed[seed&gt;=0].sum())/n+0.000001 
<br>    down = (-seed[seed&lt;0].sum())/n+0.000001 
<br>    rs = up/down 
<br>    rsi = np.zeros_like(prices) 
<br>    rsi[:n] = 100. - 100./(1.+rs) 
<br> 
<br> 
<br>    for i in range(n, len(prices)): 
<br>        delta = deltas[i-1] # cause the diff is 1 shorter 
<br> 
<br> 
<br>        if delta&gt;0: 
<br>            upval = delta 
<br>            downval = 0. 
<br>        else: 
<br>            upval = 0. 
<br>            downval = -delta 
<br> 
<br> 
<br>        up = (up*(n-1) + upval)/n 
<br>        down = (down*(n-1) + downval)/n 
<br> 
<br> 
<br>        rs = up/down 
<br>        rsi[i] = 100. - 100./(1.+rs) 
<br> 
<br> 
<br>    return rsi 
<br> 
<br> 
<br>def relative_strength(prices, n=14): 
<br>    deltas = np.diff(prices) 
<br>    seed = deltas[:n+1] 
<br>    up = (seed[seed&gt;=0].sum())/n+0.000001 
<br>    down = (-seed[seed&lt;0].sum())/n+0.000001 
<br>    rs = up/down 
<br>    rsi = np.zeros_like(prices) 
<br>    rsi[:n] = 100. - 100./(1.+rs) 
<br>     
<br>    for i in range(n, len(prices)): 
<br>        delta = deltas[i-1] 
<br>        if delta&gt;0: 
<br>            upval = delta 
<br>            downval = 0. 
<br>        else: 
<br>            upval = 0. 
<br>            downval = -delta 
<br>            up = (up*(n-1) + upval)/n 
<br>            down = (down*(n-1) + downval)/n 
<br>        rs = up/down 
<br>        rsi[i] = 100. - 100./(1.+rs) 
<br>     
<br>    return rsi 
<br>def rsi2(price, n=14): 
<br>    ''' rsi indicator ''' 
<br>    gain = (price-price.shift(1)).fillna(0) # calculate price gain with previous day, first row nan is filled with 0 
<br> 
<br> 
<br>    def rsiCalc(p): 
<br>        # subfunction for calculating rsi for one lookback period 
<br>        avgGain = p[p&gt;0].sum()/n 
<br>        avgLoss = -p[p&lt;0].sum()/n  
<br>        rs = avgGain/avgLoss 
<br>        return 100 - 100/(1+rs) 
<br> 
<br> 
<br>    # run for all periods with rolling_apply 
<br>    return pd.rolling_apply(gain,n,rsiCalc) 
<br> 
<br> 
<br>def kline(infile, period,outfile):  
<br>    df = pd.read_csv(infile,skiprows=[0],encoding='GBK')  
<br>    # names=['Symbol', 'Date_Time', 'Price','Volume']  
<br>    abf=df.iloc[:, [1,2,3,7]] 
<br>    abf.columns=[ 'Symbol','Date_Time', 'Price','Volume']  
<br>    abf=abf[abf['Volume']&gt;0] 
<br>    abf.set_index(['Date_Time'], inplace=True) 
<br>    abf.index = pd.to_datetime(abf.index) 
<br>    bars = abf.Price.resample( period).ohlc() 
<br>    Volumes =abf.Volume.resample(period).sum() 
<br>    ohlcv = pd.concat([bars, Volumes], axis=1) 
<br>    ohlcv=ohlcv[ohlcv['Volume']&gt;0].dropna() 
<br>    ohlcv['Symbol']=abf['Symbol'][1]  
<br>    return  ohlcv 
<br>     
<br>     
<br>      
<br> 
<br> 
<br>def batch_gen_kline( period,outfile):  
<br>    basedir="F:\\share\\zc\\"  
<br>    prefix="ZC805_" 
<br>    rng = pd.date_range('20180102', freq='D', periods=30).strftime('%Y%m%d')  
<br>    no=0 
<br>    for row in np.nditer(rng): 
<br>       filename=basedir+str(row)+"\\"+prefix+ str(row)+".csv" 
<br>       if(os.path.isfile(filename)): 
<br>           print(filename) 
<br>           data=kline(filename, period,outfile) 
<br>           no=no+1 
<br>           if( no==1): 
<br>               data.to_csv(outfile, mode='a',  index_label='Date_Time' )   #header=False, 
<br>           else: 
<br>               data.to_csv(outfile, mode='a', header=False, index_label='Date_Time' )   
<br>            
<br>       else: 
<br>            print(" %s is  not  exisits skip it!"  %filename) 
<br>  
<br>period='1T'  
<br>outfile= 'ZC805_201801_' + period +'K.csv'   
<br> 
<p>batch_gen_kline( period,outfile)</p> 
<p><br></p>period='5T'  
<br>outfile= 'ZC805_201801_' + period +'K.csv'   
<br>batch_gen_kline( period,outfile) 
<br> 
<br> 
<br>period='10T'  
<br>outfile= 'ZC805_201801_' + period +'K.csv'  
<br>batch_gen_kline( period,outfile) 
<br> 
<br> 
<br>period='15T'  
<br>outfile= 'ZC805_201801_' + period +'K.csv'  
<br>batch_gen_kline( period,outfile) 
<br>#rsi= rsiFunc(ohlcv['close'],6) 
<br>#rsi= rsi2(ohlcv['close'],6) 
<br>#ohlcv['rsi'] = pd.Series(rsi, index=ohlcv.index) 
<br>  
<br>  
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e8ff7a5a69056c840ed34bcf1a3bf2ae/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Fastjson在项目中使用遇到的问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/617c4ba681df0065bc78c4d4ae2be14d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">移动端性能优化的方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>