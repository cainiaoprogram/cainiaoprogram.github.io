<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>如何使用Albumentations 对目标检测任务做增强 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="如何使用Albumentations 对目标检测任务做增强" />
<meta property="og:description" content="目录
1、导入所需的库
2、定义可视化函数显示图像上的边界框和类标签
3、获取图像和标注
4、使用RandomSizedBBoxSafeCrop保留原始图像中的所有边界框
5、定义增强管道
6、输入用于增强的图像和边框
7、其他不同随机种子的示例
诸如RandomCrop和CenterCrop之类的某些增强功能可能会变换图像，使其不包含所有原始边界框。 本示例说明如何使用名为RandomSizedBBoxSafeCrop的变换来裁剪图像的一部分，但保留原始图像的所有边界框。
1、导入所需的库 import random import cv2 from matplotlib import pyplot as plt import albumentations as A 2、定义可视化函数显示图像上的边界框和类标签 可视化函数参考https://github.com/facebookresearch/Detectron/blob/master/detectron/utils/vis.py
BOX_COLOR = (255, 0, 0) # Red TEXT_COLOR = (255, 255, 255) # White def visualize_bbox(img, bbox, class_name, color=BOX_COLOR, thickness=2): &#34;&#34;&#34;Visualizes a single bounding box on the image&#34;&#34;&#34; x_min, y_min, w, h = bbox x_min, x_max, y_min, y_max = int(x_min), int(x_min &#43; w), int(y_min), int(y_min &#43; h) cv2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/f9e68484af944611e79c5cb61e8ca75e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-05-20T21:56:52+08:00" />
<meta property="article:modified_time" content="2021-05-20T21:56:52+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">如何使用Albumentations 对目标检测任务做增强</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="1%E3%80%81%E5%AF%BC%E5%85%A5%E6%89%80%E9%9C%80%E7%9A%84%E5%BA%93-toc" style="margin-left:0px;"><a href="#1%E3%80%81%E5%AF%BC%E5%85%A5%E6%89%80%E9%9C%80%E7%9A%84%E5%BA%93" rel="nofollow">1、导入所需的库</a></p> 
<p id="2%E3%80%81%E5%AE%9A%E4%B9%89%E5%8F%AF%E8%A7%86%E5%8C%96%E5%87%BD%E6%95%B0%E6%98%BE%E7%A4%BA%E5%9B%BE%E5%83%8F%E4%B8%8A%E7%9A%84%E8%BE%B9%E7%95%8C%E6%A1%86%E5%92%8C%E7%B1%BB%E6%A0%87%E7%AD%BE-toc" style="margin-left:0px;"><a href="#2%E3%80%81%E5%AE%9A%E4%B9%89%E5%8F%AF%E8%A7%86%E5%8C%96%E5%87%BD%E6%95%B0%E6%98%BE%E7%A4%BA%E5%9B%BE%E5%83%8F%E4%B8%8A%E7%9A%84%E8%BE%B9%E7%95%8C%E6%A1%86%E5%92%8C%E7%B1%BB%E6%A0%87%E7%AD%BE" rel="nofollow">2、定义可视化函数显示图像上的边界框和类标签</a></p> 
<p id="3%E3%80%81%E8%8E%B7%E5%8F%96%E5%9B%BE%E5%83%8F%E5%92%8C%E6%A0%87%E6%B3%A8-toc" style="margin-left:0px;"><a href="#3%E3%80%81%E8%8E%B7%E5%8F%96%E5%9B%BE%E5%83%8F%E5%92%8C%E6%A0%87%E6%B3%A8" rel="nofollow">3、获取图像和标注</a></p> 
<p id="4%E3%80%81%E4%BD%BF%E7%94%A8RandomSizedBBoxSafeCrop%E4%BF%9D%E7%95%99%E5%8E%9F%E5%A7%8B%E5%9B%BE%E5%83%8F%E4%B8%AD%E7%9A%84%E6%89%80%E6%9C%89%E8%BE%B9%E7%95%8C%E6%A1%86-toc" style="margin-left:0px;"><a href="#4%E3%80%81%E4%BD%BF%E7%94%A8RandomSizedBBoxSafeCrop%E4%BF%9D%E7%95%99%E5%8E%9F%E5%A7%8B%E5%9B%BE%E5%83%8F%E4%B8%AD%E7%9A%84%E6%89%80%E6%9C%89%E8%BE%B9%E7%95%8C%E6%A1%86" rel="nofollow">4、使用RandomSizedBBoxSafeCrop保留原始图像中的所有边界框</a></p> 
<p id="define-an-augmentation-pipeline-toc" style="margin-left:0px;"><a href="#define-an-augmentation-pipeline" rel="nofollow">5、定义增强管道</a></p> 
<p id="6%E3%80%81%E8%BE%93%E5%85%A5%E7%94%A8%E4%BA%8E%E5%A2%9E%E5%BC%BA%E7%9A%84%E5%9B%BE%E5%83%8F%E5%92%8C%E8%BE%B9%E6%A1%86-toc" style="margin-left:0px;"><a href="#6%E3%80%81%E8%BE%93%E5%85%A5%E7%94%A8%E4%BA%8E%E5%A2%9E%E5%BC%BA%E7%9A%84%E5%9B%BE%E5%83%8F%E5%92%8C%E8%BE%B9%E6%A1%86" rel="nofollow">6、输入用于增强的图像和边框</a></p> 
<p id="7%E3%80%81%E5%85%B6%E4%BB%96%E4%B8%8D%E5%90%8C%E9%9A%8F%E6%9C%BA%E7%A7%8D%E5%AD%90%E7%9A%84%E7%A4%BA%E4%BE%8B-toc" style="margin-left:0px;"><a href="#7%E3%80%81%E5%85%B6%E4%BB%96%E4%B8%8D%E5%90%8C%E9%9A%8F%E6%9C%BA%E7%A7%8D%E5%AD%90%E7%9A%84%E7%A4%BA%E4%BE%8B" rel="nofollow">7、其他不同随机种子的示例</a></p> 
<hr id="hr-toc"> 
<p>诸如RandomCrop和CenterCrop之类的某些增强功能可能会变换图像，使其不包含所有原始边界框。 本示例说明如何使用名为RandomSizedBBoxSafeCrop的变换来裁剪图像的一部分，但保留原始图像的所有边界框。</p> 
<h2 id="1%E3%80%81%E5%AF%BC%E5%85%A5%E6%89%80%E9%9C%80%E7%9A%84%E5%BA%93">1、导入所需的库</h2> 
<pre id="__code_0"><code>import random

import cv2
from matplotlib import pyplot as plt

import albumentations as A
</code></pre> 
<h2 id="2%E3%80%81%E5%AE%9A%E4%B9%89%E5%8F%AF%E8%A7%86%E5%8C%96%E5%87%BD%E6%95%B0%E6%98%BE%E7%A4%BA%E5%9B%BE%E5%83%8F%E4%B8%8A%E7%9A%84%E8%BE%B9%E7%95%8C%E6%A1%86%E5%92%8C%E7%B1%BB%E6%A0%87%E7%AD%BE">2、定义可视化函数显示图像上的边界框和类标签</h2> 
<p>可视化函数参考https://github.com/facebookresearch/Detectron/blob/master/detectron/utils/vis.py</p> 
<pre id="__code_1"><code>BOX_COLOR = (255, 0, 0) # Red
TEXT_COLOR = (255, 255, 255) # White


def visualize_bbox(img, bbox, class_name, color=BOX_COLOR, thickness=2):
    """Visualizes a single bounding box on the image"""
    x_min, y_min, w, h = bbox
    x_min, x_max, y_min, y_max = int(x_min), int(x_min + w), int(y_min), int(y_min + h)

    cv2.rectangle(img, (x_min, y_min), (x_max, y_max), color=color, thickness=thickness)

    ((text_width, text_height), _) = cv2.getTextSize(class_name, cv2.FONT_HERSHEY_SIMPLEX, 0.35, 1)    
    cv2.rectangle(img, (x_min, y_min - int(1.3 * text_height)), (x_min + text_width, y_min), BOX_COLOR, -1)
    cv2.putText(
        img,
        text=class_name,
        org=(x_min, y_min - int(0.3 * text_height)),
        fontFace=cv2.FONT_HERSHEY_SIMPLEX,
        fontScale=0.35, 
        color=TEXT_COLOR, 
        lineType=cv2.LINE_AA,
    )
    return img


def visualize(image, bboxes, category_ids, category_id_to_name):
    img = image.copy()
    for bbox, category_id in zip(bboxes, category_ids):
        class_name = category_id_to_name[category_id]
        img = visualize_bbox(img, bbox, class_name)
    plt.figure(figsize=(12, 12))
    plt.axis('off')
    plt.imshow(img)
</code></pre> 
<h2 id="3%E3%80%81%E8%8E%B7%E5%8F%96%E5%9B%BE%E5%83%8F%E5%92%8C%E6%A0%87%E6%B3%A8">3、获取图像和标注</h2> 
<p>在此示例中，我们将使用来自COCO数据集的图像，该图像具有两个关联的边界框。 该映像位于http://cocodataset.org/#explore?id=386298</p> 
<p>从磁盘加载图像</p> 
<pre id="__code_2"><code>image = cv2.imread('images/000000386298.jpg')
image = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)
</code></pre> 
<p>用坐标和类标签定义两个边界框</p> 
<p>这些边界框的坐标使用coco格式声明。 每个边界框使用四个值<code>[x_min, y_min, width, height]</code>进行描述。 有关边界框坐标的不同格式的详细说明，请参阅有关边界框的文档文章-https://albumentations.ai/docs/getting_started/bounding_boxes_augmentation/。</p> 
<pre id="__code_3"><code>bboxes = [[5.66, 138.95, 147.09, 164.88], [366.7, 80.84, 132.8, 181.84]]
category_ids = [17, 18]

# We will use the mapping from category_id to the class name
# to visualize the class label for the bounding box on the image
category_id_to_name = {17: 'cat', 18: 'dog'}
</code></pre> 
<p>展示图像的边框</p> 
<pre id="__code_4"><code>visualize(image, bboxes, category_ids, category_id_to_name)
</code></pre> 
<p><img alt="" height="516" src="https://images2.imgbox.com/39/9f/WiRKLPHJ_o.png" width="683"></p> 
<h2 id="4%E3%80%81%E4%BD%BF%E7%94%A8RandomSizedBBoxSafeCrop%E4%BF%9D%E7%95%99%E5%8E%9F%E5%A7%8B%E5%9B%BE%E5%83%8F%E4%B8%AD%E7%9A%84%E6%89%80%E6%9C%89%E8%BE%B9%E7%95%8C%E6%A1%86">4、使用RandomSizedBBoxSafeCrop保留原始图像中的所有边界框</h2> 
<p><code>RandomSizedBBoxSafeCrop</code> crops a random part of the image. It ensures that the cropped part will contain all bounding boxes from the original image. Then the transform rescales the crop to height and width specified by the respective parameters. The <code>erosion_rate</code> parameter controls how much area of the original bounding box could be lost after cropping. <code>erosion_rate = 0.2</code> means that the augmented bounding box's area could be up to 20% smaller than the area of the original bounding box.</p> 
<p>RandomSizedBBoxSafeCrop裁剪图像的随机部分。 它确保裁剪的部分将包含原始图像的所有边界框。 然后，变换会将作物重新缩放为相应参数指定的高度和宽度。 erosion_rate参数控制裁剪后可能丢失原始边界框的面积。 frosting_rate = 0.2表示扩充后的边界框的面积可能比原始边界框的面积小20％。</p> 
<h2 id="define-an-augmentation-pipeline">5、定义增强管道</h2> 
<pre id="__code_5"><code>transform = A.Compose(
    [A.RandomSizedBBoxSafeCrop(width=448, height=336, erosion_rate=0.2)],
    bbox_params=A.BboxParams(format='coco', label_fields=['category_ids']),
)
</code></pre> 
<h2 id="6%E3%80%81%E8%BE%93%E5%85%A5%E7%94%A8%E4%BA%8E%E5%A2%9E%E5%BC%BA%E7%9A%84%E5%9B%BE%E5%83%8F%E5%92%8C%E8%BE%B9%E6%A1%86">6、输入用于增强的图像和边框</h2> 
<p>我们固定随机种子是为了可视化目的，因此增强将始终产生相同的结果。 在真实的计算机视觉管道中，您不应该在对图像应用转换之前固定随机种子，因为在这种情况下，管道将始终输出相同的图像。 图像增强的目的是每次使用不同的变换。</p> 
<pre id="__code_6"><code>random.seed(7)
transformed = transform(image=image, bboxes=bboxes, category_ids=category_ids)
visualize(
    transformed['image'],
    transformed['bboxes'],
    transformed['category_ids'],
    category_id_to_name,
)
</code></pre> 
<p><img alt="" height="516" src="https://images2.imgbox.com/85/60/F7asyPFJ_o.png" width="683"></p> 
<h2 id="7%E3%80%81%E5%85%B6%E4%BB%96%E4%B8%8D%E5%90%8C%E9%9A%8F%E6%9C%BA%E7%A7%8D%E5%AD%90%E7%9A%84%E7%A4%BA%E4%BE%8B">7、其他不同随机种子的示例</h2> 
<pre id="__code_7"><code>random.seed(3)
transformed = transform(image=image, bboxes=bboxes, category_ids=category_ids)
visualize(
    transformed['image'],
    transformed['bboxes'],
    transformed['category_ids'],
    category_id_to_name,
)
</code></pre> 
<p><img alt="" height="516" src="https://images2.imgbox.com/79/14/nACCshNa_o.png" width="683"></p> 
<pre id="__code_8"><code>random.seed(444)
transformed = transform(image=image, bboxes=bboxes, category_ids=category_ids)
visualize(
    transformed['image'],
    transformed['bboxes'],
    transformed['category_ids'],
    category_id_to_name,
)
</code></pre> 
<p><img alt="" height="516" src="https://images2.imgbox.com/5e/31/rzQFOjWy_o.png" width="683"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/403f8c655fc62d366e20d9aeff7e678e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">熟悉Grasp，并撰写心得回答设计模式是怎样解决设计问题的，在实际编程中是如何使用的？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/375524a6e19b6796eb1b4cc9a2a9a33c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">c语言 bmp转png 代码,用c语言把bmp格式的彩色图片转换成黑白的</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>