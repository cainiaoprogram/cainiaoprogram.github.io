<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Linux time.h头文件详解 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Linux time.h头文件详解" />
<meta property="og:description" content="1、相关头文件
与时间相关的头文件：time.h sys/time.h sys/times.h sys/timeb.h sys/timex.h；其中time.h是C标准库中的头文件，其余sys开头的都为Linux系统自带的头文件；
在/usr/include/time.h 定义了常用的time函数；
在/usr/include/sys目录下查看这几个文件：
sys/time.h定义了timezone结构体和Linux系统的时间函数；
sys/times.h 定义了进程使用CPU时间的结构体tms；
sys/timeb.h定义了ftime函数的返回值的结构体timeb；
sys/timex.h定义了关于时钟调整算法的结构体timex；
2、常用函数和结构体
time函数原型(time.h中)
参数：time_t (类型变量的指针)
返回值：time_t 相当于一个long类型，time用于取Epoch记年以来到现在经过的秒数(系统当前时间)，Epoch记年从1970年1月1日开始。把取到的时间存在指针指向的变量中。
localtime函数原型(在time.h中)：
struct tm *localtime(const time_t *calptr);
参数：time_t 类型变量的指针；
返回值：指向 tm 结构体的指针类型；作用是将time_t的值转换为tm结构体。然后可以打印输出。
#ifdef	_TIME_H __BEGIN_NAMESPACE_STD /* Used by other time functions. */ struct tm { int tm_sec;	/* Seconds.	[0-60] (1 leap second) */ int tm_min;	/* Minutes.	[0-59] */ int tm_hour;	/* Hours.	[0-23] */ int tm_mday;	/* Day.	[1-31] */ int tm_mon;	/* Month." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/53e9a50f21caaa77b00903fbf964e661/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-06-26T16:08:36+08:00" />
<meta property="article:modified_time" content="2022-06-26T16:08:36+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Linux time.h头文件详解</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>1、相关头文件</p> 
<p>与时间相关的头文件：time.h sys/time.h sys/times.h sys/timeb.h sys/timex.h；其中time.h是C标准库中的头文件，其余sys开头的都为Linux系统自带的头文件；</p> 
<p>在/usr/include/time.h 定义了常用的time函数；</p> 
<p>在/usr/include/sys目录下查看这几个文件：</p> 
<p>sys/time.h定义了timezone结构体和Linux系统的时间函数；</p> 
<p>sys/times.h 定义了进程使用CPU时间的结构体tms；</p> 
<p>sys/timeb.h定义了ftime函数的返回值的结构体timeb；</p> 
<p>sys/timex.h定义了关于时钟调整算法的结构体timex；</p> 
<p>2、常用函数和结构体</p> 
<p>time函数原型(time.h中)</p> 
<p>参数：time_t (类型变量的指针)</p> 
<p>返回值：time_t 相当于一个long类型，time用于取Epoch记年以来到现在经过的秒数(系统当前时间)，Epoch记年从1970年1月1日开始。把取到的时间存在指针指向的变量中。</p> 
<p>localtime函数原型(在time.h中)：</p> 
<p>struct tm *localtime(const time_t *calptr);</p> 
<p>参数：time_t 类型变量的指针；</p> 
<p>返回值：指向 tm 结构体的指针类型；作用是将time_t的值转换为tm结构体。然后可以打印输出。</p> 
<pre><code class="language-cpp">#ifdef	_TIME_H
__BEGIN_NAMESPACE_STD
/* Used by other time functions.  */
struct tm
{
  int tm_sec;			/* Seconds.	[0-60] (1 leap second) */
  int tm_min;			/* Minutes.	[0-59] */
  int tm_hour;			/* Hours.	[0-23] */
  int tm_mday;			/* Day.		[1-31] */
  int tm_mon;			/* Month.	[0-11] */
  int tm_year;			/* Year	- 1900.  */
  int tm_wday;			/* Day of week.	[0-6] */
  int tm_yday;			/* Days in year.[0-365]	*/
  int tm_isdst;			/* DST.		[-1/0/1]*/

# ifdef	__USE_MISC
  long int tm_gmtoff;		/* Seconds east of UTC.  */
  const char *tm_zone;		/* Timezone abbreviation.  */
# else
  long int __tm_gmtoff;		/* Seconds east of UTC.  */
  const char *__tm_zone;	/* Timezone abbreviation.  */
# endif
};
__END_NAMESPACE_STD
#if defined __USE_XOPEN || defined __USE_POSIX
__USING_NAMESPACE_STD(tm)
#endif</code></pre> 
<p>ftime.h函数原型(timeb.h)</p> 
<p>int ftime(struct timeb *tp);</p> 
<p>参数：指向timeb结构体变量的指针；</p> 
<p>返回值：将当前系统时间存入timeb结构体中，包括了秒和毫秒。作用是能获取当前时间精确到毫秒；</p> 
<p>timeb结构体(sys/timeb.h)</p> 
<pre><code class="language-cpp">__BEGIN_DECLS

/* Structure returned by the `ftime' function.  */

struct timeb
  {
    time_t time;		/* Seconds since epoch, as from `time'.  */
    unsigned short int millitm;	/* Additional milliseconds.  */
    short int timezone;		/* Minutes west of GMT.  */
    short int dstflag;		/* Nonzero if Daylight Savings Time used.  */
  };

/* Fill in TIMEBUF with information about the current time.  */

extern int ftime (struct timeb *__timebuf);

__END_DECLS</code></pre> 
<p>times函数原型(sys/times.h)</p> 
<p>clock_t times(struct tms *buf);</p> 
<p>参数：指向tms结构体变量的指针。</p> 
<p>返回值：clock_t类型等同于long类型，用于获得进程运行时的CPU时间。</p> 
<p>tms结构体(sys/times.h中)</p> 
<pre><code class="language-cpp">__BEGIN_DECLS

/* Structure describing CPU time used by a process and its children.  */
struct tms
  {
    clock_t tms_utime;		/* User CPU time.  */
    clock_t tms_stime;		/* System CPU time.  */

    clock_t tms_cutime;		/* User CPU time of dead children.  */
    clock_t tms_cstime;		/* System CPU time of dead children.  */
  };


/* Store the CPU time used by this process and all its
   dead children (and their dead children) in BUFFER.
   Return the elapsed real time, or (clock_t) -1 for errors.
   All times are in CLK_TCKths of a second.  */
extern clock_t times (struct tms *__buffer) __THROW;

__END_DECLS</code></pre> 
<p>示例：</p> 
<pre><code class="language-cpp">#include &lt;stdio.h&gt;
#include &lt;time.h&gt;
#include &lt;sys/time.h&gt;
#include &lt;sys/timeb.h&gt;
#include &lt;sys/times.h&gt;
#include &lt;unistd.h&gt;

int main(int argc, char* argv[])
{
    int i = 0; ///&lt; 循环参数
    long tck = 0; ///&lt; 获取系统时钟
    
    long l_begin_time = 0; ///&lt; 起始时间点
    long l_end_time = 0; ///&lt; 结束时间点

    time_t curr;

    struct tm * t_tm;

    struct tms t_tms;

    struct timeb t_tmb;

    tzset(); ///&lt; 对 UNIX 操作系统的兼容性

    // time函数获得秒数
    time(&amp;curr);
    printf("current time is %ld seconds\n", curr);

    // localtime函数转换time_t
    t_tm = localtime(&amp;curr);
    printf("%4d-%02d-%02d %02d:%02d:%02d\n", t_tm-&gt;tm_year + 1900, t_tm-&gt;tm_mon + 1, t_tm-&gt;tm_mday, t_tm-&gt;tm_hour, t_tm-&gt;tm_min, t_tm-&gt;tm_sec);

    // ftime函数获得时间包括毫秒
    ftime(&amp;t_tmb);
    t_tm = localtime(&amp;t_tmb.time);
    printf("%4d-%02d-%02d %02d:%02d:%02d :%3d\n", t_tm-&gt;tm_year + 1900, t_tm-&gt;tm_mon + 1, t_tm-&gt;tm_mday, t_tm-&gt;tm_hour, t_tm-&gt;tm_min, t_tm-&gt;tm_sec, t_tmb.millitm);

    // 用times函数计算以下循环运行花费的时间
    l_begin_time = times(&amp;t_tms);
    printf("l_begin_time = %ld\n", l_begin_time);
    while (1)
    {
        i = i + 1;
        if (i == 0)
        {
            break;
        }
    }
    l_end_time = times(&amp;t_tms);
    printf("l_end_time = %ld\n", l_end_time);
    printf("used CPU time: %ld\n", l_end_time - l_begin_time);
    tck = sysconf(_SC_CLK_TCK); ///&lt; 获取系统时钟(1秒里有多少个)
    printf("transform minutes: %f\n", ((l_end_time - l_begin_time) / (double)tck));

    return 0;
}</code></pre> 
<p>执行结果：</p> 
<p><img alt="" height="157" src="https://images2.imgbox.com/01/6d/8m5haQIN_o.png" width="577"></p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b520898beb800ef30a7ed50c34e6887c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">SR-GNN:Session-based Recommendation with Graph Neural Networks 论文阅读笔记</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2a622dab86c575423fb27e1acd896c3e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Mqtt安装及部署手册（包含与WebSocket通信配置）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>