<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>flink oracle cdc实时同步（超详细） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="flink oracle cdc实时同步（超详细）" />
<meta property="og:description" content="文章目录 01 引言02 前提条件03 配置3.1 启用日志归档3.2 用户赋权3.3 表或数据库上启用增量日志记录（supplemental log）3.3.1 Oracle 逻辑结构3.3.2 创建表3.3.3 启用增量日志 04 flink sql05 其它问题06 文末 01 引言 官方文档：https://github.com/ververica/flink-cdc-connectors/blob/release-master/docs/content/connectors/oracle-cdc.md
本文参照官方文档来记录Oracle CDC 的配置。
在本文开始前，需要先安装Oracle，有兴趣的同学可以参考博主之前写的《docker下安装oracle11g（一次安装成功）》。
02 前提条件 如果要做oracle的实时同步，Oracle数据库配置必须满足如下：
Oracle数据库启用日志归档；定义具有适当权限的Oracle用户；被捕获的表或数据库上必须启用增量日志记录； 在官网的安装教程中，可以看到有两种数据库类型的配置，分别是：
类型描述版本独立的数据库架构（Non-CDB database）是传统的独立数据库架构，每个数据库实例包含所有的对象和数据Oracle 11g以及之前的版本中使用多租户数据库架构（CDB database）多租户架构的数据库，包含一个根容器和多个子容器（PDB），每个PDB可以看作是一个独立的数据库Oracle 12c开始 因为 之前安装 的是Oracle11g，所以本文以独立的数据库架构（Non-CDB database）的配置来讲解。
03 配置 注意：以下执行的条件是基于之前安装好的oracle环境来执行的，详情参阅：《docker下安装oracle11g（一次安装成功）》。
3.1 启用日志归档 Step1：进入容器：
docker exec -it oracle_11g bash Step2：以DBA的权限登录数据库：
sqlplus /nolog CONNECT sys/system AS SYSDBA Step3：启用日志归档：
-- 设置数据库恢复文件目标大小为10G alter system set db_recovery_file_dest_size = 10G; -- 设置数据库恢复文件目标路径 alter system set db_recovery_file_dest = &#39;/home/oracle/app/oracle/product/11." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/16c9ec81f8bdd61e6f226beb4642e847/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-27T14:24:14+08:00" />
<meta property="article:modified_time" content="2023-07-27T14:24:14+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">flink oracle cdc实时同步（超详细）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#font_colorpurple01_font_1" rel="nofollow"><font color="purple">01 引言</font></a></li><li><a href="#font_colorpurple02_font_8" rel="nofollow"><font color="purple">02 前提条件</font></a></li><li><a href="#font_colorpurple03_font_23" rel="nofollow"><font color="purple">03 配置</font></a></li><li><ul><li><a href="#font_colorpurple31_font_25" rel="nofollow"><font color="purple">3.1 启用日志归档</font></a></li><li><a href="#font_colorpurple32_font_73" rel="nofollow"><font color="purple">3.2 用户赋权</font></a></li><li><a href="#font_colorpurple33_supplemental_logfont_168" rel="nofollow"><font color="purple">3.3 表或数据库上启用增量日志记录（supplemental log）</font></a></li><li><ul><li><a href="#font_colorpurple331_Oracle_font_171" rel="nofollow"><font color="purple">3.3.1 Oracle 逻辑结构</font></a></li><li><a href="#font_colorpurple332_font_196" rel="nofollow"><font color="purple">3.3.2 创建表</font></a></li><li><a href="#font_colorpurple333_font_222" rel="nofollow"><font color="purple">3.3.3 启用增量日志</font></a></li></ul> 
  </li></ul> 
  </li><li><a href="#font_colorpurple04_flink_sqlfont_237" rel="nofollow"><font color="purple">04 flink sql</font></a></li><li><a href="#font_colorpurple05_font_297" rel="nofollow"><font color="purple">05 其它问题</font></a></li><li><a href="#font_colorpurple06_font_361" rel="nofollow"><font color="purple">06 文末</font></a></li></ul> 
</div> 
<p></p> 
<h2><a id="font_colorpurple01_font_1"></a><font color="purple">01 引言</font></h2> 
<blockquote> 
 <p>官方文档：<a href="https://github.com/ververica/flink-cdc-connectors/blob/release-master/docs/content/connectors/oracle-cdc.md">https://github.com/ververica/flink-cdc-connectors/blob/release-master/docs/content/connectors/oracle-cdc.md</a></p> 
</blockquote> 
<p>本文参照官方文档来记录Oracle CDC 的配置。</p> 
<p>在本文开始前，需要先安装Oracle，有兴趣的同学可以参考博主之前写的<a href="https://blog.csdn.net/qq_20042935/article/details/131913296">《docker下安装oracle11g（一次安装成功）》</a>。</p> 
<h2><a id="font_colorpurple02_font_8"></a><font color="purple">02 前提条件</font></h2> 
<p>如果要做oracle的实时同步，<strong>Oracle数据库配置必须满足如下：</strong></p> 
<ol><li><font color="red">Oracle数据库启用日志归档</font>；</li><li><font color="red">定义具有适当权限的Oracle用户</font>；</li><li><font color="red">被捕获的表或数据库上必须启用增量日志记录</font>；</li></ol> 
<p><strong>在官网的安装教程中，可以看到有两种数据库类型的配置，分别是：</strong></p> 
<table><thead><tr><th align="left">类型</th><th align="left">描述</th><th align="left">版本</th></tr></thead><tbody><tr><td align="left"><font color="green">独立的数据库架构（Non-CDB database）</font></td><td align="left">是传统的独立数据库架构，每个数据库实例包含所有的对象和数据</td><td align="left">Oracle 11g以及之前的版本中使用</td></tr><tr><td align="left"><font color="green">多租户数据库架构（CDB database）</font></td><td align="left">多租户架构的数据库，包含一个根容器和多个子容器（PDB），每个PDB可以看作是一个独立的数据库</td><td align="left">Oracle 12c开始</td></tr></tbody></table> 
<p>因为 <a href="https://blog.csdn.net/qq_20042935/article/details/131913296">之前安装</a> 的是Oracle11g，所以本文以独立的数据库架构（Non-CDB database）的配置来讲解。</p> 
<h2><a id="font_colorpurple03_font_23"></a><font color="purple">03 配置</font></h2> 
<blockquote> 
 <p><strong>注意</strong>：<font color="red">以下执行的条件是基于之前安装好的oracle环境来执行的</font>，详情参阅：<a href="https://blog.csdn.net/qq_20042935/article/details/131913296">《docker下安装oracle11g（一次安装成功）》</a>。</p> 
</blockquote> 
<h3><a id="font_colorpurple31_font_25"></a><font color="purple">3.1 启用日志归档</font></h3> 
<p><font color="red">Step1</font>：进入容器：</p> 
<pre><code class="prism language-shell"><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> oracle_11g <span class="token function">bash</span>
</code></pre> 
<p><font color="red">Step2</font>：以DBA的权限登录数据库：</p> 
<pre><code class="prism language-sql">sqlplus <span class="token operator">/</span>nolog
<span class="token keyword">CONNECT</span> sys<span class="token operator">/</span>system <span class="token keyword">AS</span> SYSDBA
</code></pre> 
<p><font color="red">Step3</font>：启用日志归档：</p> 
<pre><code class="prism language-sql"><span class="token comment">-- 设置数据库恢复文件目标大小为10G</span>
<span class="token keyword">alter</span> system <span class="token keyword">set</span> db_recovery_file_dest_size <span class="token operator">=</span> <span class="token number">10</span>G<span class="token punctuation">;</span>

<span class="token comment">-- 设置数据库恢复文件目标路径</span>
<span class="token keyword">alter</span> system <span class="token keyword">set</span> db_recovery_file_dest <span class="token operator">=</span> <span class="token string">'/home/oracle/app/oracle/product/11.2.0'</span> scope<span class="token operator">=</span>spfile<span class="token punctuation">;</span>

<span class="token comment">-- 立即关闭数据库</span>
<span class="token keyword">shutdown</span> immediate<span class="token punctuation">;</span>

<span class="token comment">-- 以mount模式启动数据库</span>
startup mount<span class="token punctuation">;</span>

<span class="token comment">-- 启用数据库归档日志模式</span>
<span class="token keyword">alter</span> <span class="token keyword">database</span> archivelog<span class="token punctuation">;</span>

<span class="token comment">-- 打开数据库，允许用户访问</span>
<span class="token keyword">alter</span> <span class="token keyword">database</span> <span class="token keyword">open</span><span class="token punctuation">;</span>
</code></pre> 
<p>操作记录如下：<br> <img src="https://images2.imgbox.com/3a/72/VEciFTia_o.png" alt="在这里插入图片描述"><br> <font color="red">Step4</font>：查看日志归档是否启用（如果显示“Archive Mode”表示已经启用）</p> 
<pre><code class="prism language-sql">archive log list<span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/73/d2/C9sAl4pG_o.png" alt="在这里插入图片描述"><br> 在<code>/home/oracle/app/oracle/product/11.2.0</code>目录也能看到数据库恢复文件（按日期分目录）：<br> <img src="https://images2.imgbox.com/84/f7/C8a4QFmz_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<p>备注：</p> 
<ul><li>启用日志归档需要重启数据库。</li><li>归档日志将占用大量的磁盘空间，因此需要定期清理过期的日志。</li></ul> 
<h3><a id="font_colorpurple32_font_73"></a><font color="purple">3.2 用户赋权</font></h3> 
<p><font color="red"><strong>Step1</strong></font>：<strong>创建表空间</strong>（创建表空间是为了提供一个独立、可控、可扩展的存储区域，以供CDC工具捕获和管理数据库的<font color="orange"><u><strong>增量数据</strong></u></font>，这对于实时同步和数据变更追踪非常重要，并为数据流和数据仓库等应用提供可靠的数据源。）</p> 
<pre><code class="prism language-sql"><span class="token comment">-- 以DBA的权限登录数据库</span>
sqlplus <span class="token operator">/</span>nolog
<span class="token keyword">CONNECT</span> sys<span class="token operator">/</span>system <span class="token keyword">AS</span> SYSDBA
<span class="token comment">-- 创建一个名为"logminer_tbs"的表空间</span>
<span class="token comment">-- 指定表空间的数据文件路径为"/home/oracle/app/oracle/product/11.2.0/logminer_tbs.dbf"，其中"/home/oracle/app/oracle/product/11.2.0"是数据文件存储的目录，"logminer_tbs.dbf"是数据文件的文件名</span>
<span class="token comment">-- 设置表空间的初始大小为25MB</span>
<span class="token comment">-- 如果数据文件已经存在且可重用，将其重用，否则创建一个新的数据文件</span>
<span class="token comment">-- 启用表空间的自动扩展功能，即当表空间空间不足时，自动增加数据文件的大小</span>
<span class="token comment">-- 设置表空间的最大允许大小为无限，即表空间可以无限制地自动扩展</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLESPACE</span> logminer_tbs DATAFILE <span class="token string">'/home/oracle/app/oracle/product/11.2.0/logminer_tbs.dbf'</span> SIZE <span class="token number">25</span>M REUSE AUTOEXTEND <span class="token keyword">ON</span> MAXSIZE UNLIMITED<span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/33/65/cxt89zFv_o.png" alt="在这里插入图片描述"><br> 可以看到在“<code>/home/oracle/app/oracle/product/11.2.0</code>”目录里已经创建了<code>logminer_tbs.dbf</code>文件：<br> <img src="https://images2.imgbox.com/3f/23/aPIUCV7o_o.png" alt="在这里插入图片描述"></p> 
<p><font color="red"><strong>Step2</strong></font>：创建用户并赋予权限</p> 
<pre><code class="prism language-sql"><span class="token comment">-- 创建一个名为"flinkuser"的用户，密码为"flinkpw"，将其默认表空间设置为"LOGMINER_TBS"，并在该表空间上设置无限配额。</span>
<span class="token keyword">CREATE</span> <span class="token keyword">USER</span> flinkuser IDENTIFIED <span class="token keyword">BY</span> flinkpw <span class="token keyword">DEFAULT</span> <span class="token keyword">TABLESPACE</span> LOGMINER_TBS QUOTA UNLIMITED <span class="token keyword">ON</span> LOGMINER_TBS<span class="token punctuation">;</span>

<span class="token comment">-- 允许"flinkuser"用户创建会话，即允许该用户连接到数据库。</span>
<span class="token keyword">GRANT</span> <span class="token keyword">CREATE</span> <span class="token keyword">SESSION</span> <span class="token keyword">TO</span> flinkuser<span class="token punctuation">;</span>

<span class="token comment">-- （不支持Oracle 11g）允许"flinkuser"用户在多租户数据库（CDB）中设置容器。</span>
<span class="token comment">-- GRANT SET CONTAINER TO flinkuser;</span>

<span class="token comment">-- 允许"flinkuser"用户查询V_$DATABASE视图，该视图包含有关数据库实例的信息。</span>
<span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span> <span class="token keyword">ON</span> V_$<span class="token keyword">DATABASE</span> <span class="token keyword">TO</span> flinkuser<span class="token punctuation">;</span>

<span class="token comment">-- 允许"flinkuser"用户执行任何表的闪回操作。</span>
<span class="token keyword">GRANT</span> FLASHBACK <span class="token keyword">ANY</span> <span class="token keyword">TABLE</span> <span class="token keyword">TO</span> flinkuser<span class="token punctuation">;</span>

<span class="token comment">-- 允许"flinkuser"用户查询任何表的数据。</span>
<span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span> <span class="token keyword">ANY</span> <span class="token keyword">TABLE</span> <span class="token keyword">TO</span> flinkuser<span class="token punctuation">;</span>

<span class="token comment">-- 允许"flinkuser"用户拥有SELECT_CATALOG_ROLE角色，该角色允许查询数据字典和元数据。</span>
<span class="token keyword">GRANT</span> SELECT_CATALOG_ROLE <span class="token keyword">TO</span> flinkuser<span class="token punctuation">;</span>

<span class="token comment">-- 允许"flinkuser"用户拥有EXECUTE_CATALOG_ROLE角色，该角色允许执行一些数据字典中的过程和函数。</span>
<span class="token keyword">GRANT</span> EXECUTE_CATALOG_ROLE <span class="token keyword">TO</span> flinkuser<span class="token punctuation">;</span>

<span class="token comment">-- 允许"flinkuser"用户查询任何事务。</span>
<span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span> <span class="token keyword">ANY</span> <span class="token keyword">TRANSACTION</span> <span class="token keyword">TO</span> flinkuser<span class="token punctuation">;</span>

<span class="token comment">-- （不支持Oracle 11g）允许"flinkuser"用户进行数据变更追踪（LogMiner）。</span>
<span class="token comment">-- GRANT LOGMINING TO flinkuser;</span>

<span class="token comment">-- 允许"flinkuser"用户创建表。</span>
<span class="token keyword">GRANT</span> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">TO</span> flinkuser<span class="token punctuation">;</span>

<span class="token comment">-- 允许"flinkuser"用户锁定任何表。</span>
<span class="token keyword">GRANT</span> <span class="token keyword">LOCK</span> <span class="token keyword">ANY</span> <span class="token keyword">TABLE</span> <span class="token keyword">TO</span> flinkuser<span class="token punctuation">;</span>

<span class="token comment">-- 允许"flinkuser"用户修改任何表。</span>
<span class="token keyword">GRANT</span> <span class="token keyword">ALTER</span> <span class="token keyword">ANY</span> <span class="token keyword">TABLE</span> <span class="token keyword">TO</span> flinkuser<span class="token punctuation">;</span>

<span class="token comment">-- 允许"flinkuser"用户创建序列。</span>
<span class="token keyword">GRANT</span> <span class="token keyword">CREATE</span> SEQUENCE <span class="token keyword">TO</span> flinkuser<span class="token punctuation">;</span>

<span class="token comment">-- 允许"flinkuser"用户执行DBMS_LOGMNR包中的过程。</span>
<span class="token keyword">GRANT</span> <span class="token keyword">EXECUTE</span> <span class="token keyword">ON</span> DBMS_LOGMNR <span class="token keyword">TO</span> flinkuser<span class="token punctuation">;</span>

<span class="token comment">-- 允许"flinkuser"用户执行DBMS_LOGMNR_D包中的过程。</span>
<span class="token keyword">GRANT</span> <span class="token keyword">EXECUTE</span> <span class="token keyword">ON</span> DBMS_LOGMNR_D <span class="token keyword">TO</span> flinkuser<span class="token punctuation">;</span>

<span class="token comment">-- 允许"flinkuser"用户查询V_$LOG视图，该视图包含有关数据库日志文件的信息。</span>
<span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span> <span class="token keyword">ON</span> V_$LOG <span class="token keyword">TO</span> flinkuser<span class="token punctuation">;</span>

<span class="token comment">-- 允许"flinkuser"用户查询V_$LOG_HISTORY视图，该视图包含有关数据库历史日志文件的信息。</span>
<span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span> <span class="token keyword">ON</span> V_$LOG_HISTORY <span class="token keyword">TO</span> flinkuser<span class="token punctuation">;</span>

<span class="token comment">-- 允许"flinkuser"用户查询V_$LOGMNR_LOGS视图，该视图包含有关LogMiner日志文件的信息。</span>
<span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span> <span class="token keyword">ON</span> V_$LOGMNR_LOGS <span class="token keyword">TO</span> flinkuser<span class="token punctuation">;</span>

<span class="token comment">-- 允许"flinkuser"用户查询V_$LOGMNR_CONTENTS视图，该视图包含LogMiner日志文件的内容。</span>
<span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span> <span class="token keyword">ON</span> V_$LOGMNR_CONTENTS <span class="token keyword">TO</span> flinkuser<span class="token punctuation">;</span>

<span class="token comment">-- 允许"flinkuser"用户查询V_$LOGMNR_PARAMETERS视图，该视图包含有关LogMiner的参数信息。</span>
<span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span> <span class="token keyword">ON</span> V_$LOGMNR_PARAMETERS <span class="token keyword">TO</span> flinkuser<span class="token punctuation">;</span>

<span class="token comment">-- 允许"flinkuser"用户查询V_$LOGFILE视图，该视图包含有关数据库日志文件的信息。</span>
<span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span> <span class="token keyword">ON</span> V_$LOGFILE <span class="token keyword">TO</span> flinkuser<span class="token punctuation">;</span>

<span class="token comment">-- 允许"flinkuser"用户查询V_$ARCHIVED_LOG视图，该视图包含已归档的数据库日志文件的信息。</span>
<span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span> <span class="token keyword">ON</span> V_$ARCHIVED_LOG <span class="token keyword">TO</span> flinkuser<span class="token punctuation">;</span>

<span class="token comment">-- 允许"flinkuser"用户查询V_$ARCHIVE_DEST_STATUS视图，该视图包含有关归档目标状态的信息。</span>
<span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span> <span class="token keyword">ON</span> V_$ARCHIVE_DEST_STATUS <span class="token keyword">TO</span> flinkuser<span class="token punctuation">;</span>

</code></pre> 
<h3><a id="font_colorpurple33_supplemental_logfont_168"></a><font color="purple">3.3 表或数据库上启用增量日志记录（supplemental log）</font></h3> 
<p>在讲解Oracle之前，很有必要先了解Oracle的逻辑结构。</p> 
<h4><a id="font_colorpurple331_Oracle_font_171"></a><font color="purple">3.3.1 Oracle 逻辑结构</font></h4> 
<blockquote> 
 <p><strong>Oracle</strong>数据库的物理结构与<code>MySQL</code>以及<code>SQLServer</code>有着很大的不同，在使用MySQL或SQLServer时，我们不需要去关心它们的逻辑结构和物理结构。</p> 
</blockquote> 
<p><strong>Oracle</strong>在逻辑结构中，分别是如下的结构：<font color="red"><strong>数据库实例 =&gt; 表空间 =&gt; 数据段（表） =&gt; 区 =&gt; 块</strong></font>。</p> 
<ul><li><font color="orange"><strong>数据库实例</strong></font>：前面的<a href="https://blog.csdn.net/qq_20042935/article/details/131913296">《docker下安装oracle11g（一次安装成功）》</a>，在启动容器时，已经指定了Oracle的数据库实例的唯一ID，每个Oracle数据库实例都有一个唯一的SID，也就是说，安装的时候，已经创建好了一个“helowin”数据库实例了。<img src="https://images2.imgbox.com/08/2a/iK4RwpKH_o.png" alt="在这里插入图片描述"></li><li><font color="orange"><strong>表空间</strong></font>：在 “用户赋权”的第1步骤，可以看出已经创建了“logminer_tbs”表空间（CREATE TABLESPACE logminer_tbs…）</li></ul> 
<p>相关的查询SQL：</p> 
<pre><code class="prism language-sql"><span class="token comment">-- 以DBA的权限登录数据库</span>
sqlplus <span class="token operator">/</span>nolog
<span class="token keyword">CONNECT</span> sys<span class="token operator">/</span>system <span class="token keyword">AS</span> SYSDBA

<span class="token comment">-- 查询数据库实例名称</span>
<span class="token keyword">SELECT</span> NAME <span class="token keyword">FROM</span> V$<span class="token keyword">DATABASE</span><span class="token punctuation">;</span>

<span class="token comment">-- 查询所有表空间名称</span>
<span class="token keyword">SELECT</span> TABLESPACE_NAME <span class="token keyword">FROM</span> DBA_TABLESPACES<span class="token punctuation">;</span>
</code></pre> 
<p>结果如下：<br> <img src="https://images2.imgbox.com/cb/9f/lSoP8Qzk_o.png" alt="在这里插入图片描述"><br> ok，接下来就可以进入“LOGMINER_TBS”表空间去创建表了。</p> 
<h4><a id="font_colorpurple332_font_196"></a><font color="purple">3.3.2 创建表</font></h4> 
<p>在<code>LOGMINER_TBS</code>表空间下的<code>flinkuser用户</code>下创建<code>customers</code>表：</p> 
<pre><code class="prism language-sql"><span class="token comment">-- 切换至flinkuser用户</span>
sqlplus <span class="token operator">/</span>nolog
<span class="token keyword">CONNECT</span> flinkuser<span class="token operator">/</span>flinkpw

<span class="token comment">-- 创建customers表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> customers <span class="token punctuation">(</span>
    customer_id NUMBER <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
    customer_name VARCHAR2<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    email VARCHAR2<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    phone VARCHAR2<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">TABLESPACE</span> LOGMINER_TBS<span class="token punctuation">;</span>
</code></pre> 
<p>查看表是否创建成功：</p> 
<pre><code class="prism language-sql"><span class="token comment">-- 查看LOGMINER_TBS表空间下的所有表</span>
<span class="token keyword">select</span> tablespace_name<span class="token punctuation">,</span> table_name <span class="token keyword">from</span> user_tables
<span class="token keyword">where</span> tablespace_name <span class="token operator">=</span> <span class="token string">'LOGMINER_TBS'</span><span class="token punctuation">;</span>
</code></pre> 
<p>可以看到表创建成功：<br> <img src="https://images2.imgbox.com/9b/25/ZR1BDCuh_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="font_colorpurple333_font_222"></a><font color="purple">3.3.3 启用增量日志</font></h4> 
<p>切换至SYS用户，以DBA的权限登录数据库，为表和数据库启用增量日志：</p> 
<pre><code class="prism language-sql"><span class="token comment">-- 以DBA的权限登录数据库</span>
sqlplus <span class="token operator">/</span>nolog
<span class="token keyword">CONNECT</span> sys<span class="token operator">/</span>system <span class="token keyword">AS</span> SYSDBA

<span class="token comment">-- 为LOGMINER_TBS表空间下的customers表启用增强日志记录</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> FLINKUSER<span class="token punctuation">.</span>CUSTOMERS <span class="token keyword">ADD</span> SUPPLEMENTAL LOG <span class="token keyword">DATA</span> <span class="token punctuation">(</span><span class="token keyword">ALL</span><span class="token punctuation">)</span> <span class="token keyword">COLUMNS</span>

<span class="token comment">-- 为数据库启用增强日志记录：</span>
<span class="token keyword">ALTER</span> <span class="token keyword">DATABASE</span> <span class="token keyword">ADD</span> SUPPLEMENTAL LOG <span class="token keyword">DATA</span><span class="token punctuation">;</span>
</code></pre> 
<p>操作成功：<br> <img src="https://images2.imgbox.com/9b/7a/81M3FUOo_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="font_colorpurple04_flink_sqlfont_237"></a><font color="purple">04 flink sql</font></h2> 
<p>注意：<font color="red">源表的字段定义、schema-name以及table-name都要大写，否则无法同步</font>。</p> 
<pre><code class="prism language-sql"><span class="token comment">-- 创建Oracle CDC源表table_source_oracle，从Oracle数据库中读取数据</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> table_source_oracle <span class="token punctuation">(</span>
        CUSTOMER_ID <span class="token keyword">INT</span><span class="token punctuation">,</span>
        CUSTOMER_NAME STRING<span class="token punctuation">,</span>
        EMAIL STRING<span class="token punctuation">,</span>
        PHONE STRING<span class="token punctuation">,</span>
        <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>CUSTOMER_ID<span class="token punctuation">)</span> <span class="token operator">NOT</span> ENFORCED
        <span class="token punctuation">)</span>
<span class="token keyword">WITH</span> <span class="token punctuation">(</span>
		<span class="token string">'connector'</span> <span class="token operator">=</span> <span class="token string">'oracle-cdc'</span><span class="token punctuation">,</span>
		<span class="token string">'hostname'</span> <span class="token operator">=</span> <span class="token string">'10.194.183.120'</span><span class="token punctuation">,</span>
		<span class="token string">'port'</span> <span class="token operator">=</span> <span class="token string">'30026'</span><span class="token punctuation">,</span>
		<span class="token string">'username'</span> <span class="token operator">=</span> <span class="token string">'flinkuser'</span><span class="token punctuation">,</span>
		<span class="token string">'password'</span> <span class="token operator">=</span> <span class="token string">'flinkpw'</span><span class="token punctuation">,</span>
		<span class="token string">'database-name'</span> <span class="token operator">=</span> <span class="token string">'helowin'</span><span class="token punctuation">,</span>
		<span class="token string">'schema-name'</span> <span class="token operator">=</span> <span class="token string">'FLINKUSER'</span><span class="token punctuation">,</span>
		<span class="token string">'table-name'</span> <span class="token operator">=</span> <span class="token string">'CUSTOMERS'</span>
<span class="token punctuation">)</span>

<span class="token comment">-- 创建MySQL JDBC接收表table_sink_mysql，将数据写入到MySQL数据库</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> table_sink_mysql <span class="token punctuation">(</span>
    customer_id <span class="token keyword">INT</span><span class="token punctuation">,</span>
    customer_name STRING<span class="token punctuation">,</span>
    email STRING<span class="token punctuation">,</span>
    phone STRING<span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>customer_id<span class="token punctuation">)</span> <span class="token operator">NOT</span> ENFORCED
<span class="token punctuation">)</span>
<span class="token keyword">WITH</span> <span class="token punctuation">(</span>
    <span class="token string">'connector'</span> <span class="token operator">=</span> <span class="token string">'jdbc'</span><span class="token punctuation">,</span>
    <span class="token string">'url'</span> <span class="token operator">=</span> <span class="token string">'jdbc:mysql://10.194.183.120:30025/test'</span><span class="token punctuation">,</span>
    <span class="token string">'username'</span> <span class="token operator">=</span> <span class="token string">'root'</span><span class="token punctuation">,</span>
    <span class="token string">'password'</span> <span class="token operator">=</span> <span class="token string">'root'</span><span class="token punctuation">,</span>
    <span class="token string">'table-name'</span> <span class="token operator">=</span> <span class="token string">'customers'</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 将table_source_oracle表的数据插入到table_sink_mysql表中</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> table_sink_mysql <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> table_source_oracle<span class="token punctuation">;</span>
</code></pre> 
<p>执行flinksql后，可以看到控制台没有报错，程序已经正常启动：<br> <img src="https://images2.imgbox.com/a5/e5/cJzR9Rly_o.png" alt="在这里插入图片描述"></p> 
<p>往customers插入一条数据：</p> 
<pre><code class="prism language-sql"><span class="token comment">-- 切换至flinkuser用户</span>
sqlplus <span class="token operator">/</span>nolog
<span class="token keyword">CONNECT</span> flinkuser<span class="token operator">/</span>flinkpw

<span class="token comment">-- 插入数据</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> customers <span class="token punctuation">(</span>customer_id<span class="token punctuation">,</span> customer_name<span class="token punctuation">,</span> email<span class="token punctuation">,</span> phone<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'Dumas'</span><span class="token punctuation">,</span> <span class="token string">'Dumas@example.com'</span><span class="token punctuation">,</span> <span class="token string">'123-456-7890'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/be/3e/WhJ3P5sI_o.png" alt="在这里插入图片描述"></p> 
<p>可以看到，已经写入成功了：<br> <img src="https://images2.imgbox.com/77/ad/YmcPbNDC_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="font_colorpurple05_font_297"></a><font color="purple">05 其它问题</font></h2> 
<blockquote> 
 <p>问题解决参考：<a href="https://flink-learning.org.cn/article/detail/bf01dd4ff3ed8a11d6d38f365bc2a15d" rel="nofollow">https://flink-learning.org.cn/article/detail/bf01dd4ff3ed8a11d6d38f365bc2a15d</a></p> 
</blockquote> 
<p>虽然能做同步了，但是感觉还是有很多坑的，比如控制台会报错：<br> <img src="https://images2.imgbox.com/8a/07/zaTkMYfT_o.png" alt="在这里插入图片描述"><br> <strong>解决方式</strong>：在 create 语句中加上</p> 
<pre><code class="prism language-shell"><span class="token string">'debezium.database.tablename.case.insensitive'</span><span class="token operator">=</span><span class="token string">'false'</span>
</code></pre> 
<p>还有数据延迟较大，也是在create语句加上：</p> 
<pre><code class="prism language-shell"><span class="token string">'debezium.log.mining.strategy'</span><span class="token operator">=</span><span class="token string">'online_catalog'</span>,
<span class="token string">'debezium.log.mining.continuous.mine'</span><span class="token operator">=</span><span class="token string">'true'</span>
</code></pre> 
<p>所以，最终的Flink SQL如下：</p> 
<pre><code class="prism language-sql"><span class="token comment">-- 创建Oracle CDC源表table_source_oracle，从Oracle数据库中读取数据</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> table_source_oracle <span class="token punctuation">(</span>
        CUSTOMER_ID <span class="token keyword">INT</span><span class="token punctuation">,</span>
        CUSTOMER_NAME STRING<span class="token punctuation">,</span>
        EMAIL STRING<span class="token punctuation">,</span>
        PHONE STRING<span class="token punctuation">,</span>
        <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>CUSTOMER_ID<span class="token punctuation">)</span> <span class="token operator">NOT</span> ENFORCED
        <span class="token punctuation">)</span>
<span class="token keyword">WITH</span> <span class="token punctuation">(</span>
        <span class="token string">'connector'</span> <span class="token operator">=</span> <span class="token string">'oracle-cdc'</span><span class="token punctuation">,</span>
        <span class="token string">'hostname'</span> <span class="token operator">=</span> <span class="token string">'10.194.183.120'</span><span class="token punctuation">,</span>
        <span class="token string">'port'</span> <span class="token operator">=</span> <span class="token string">'30026'</span><span class="token punctuation">,</span>
        <span class="token string">'username'</span> <span class="token operator">=</span> <span class="token string">'flinkuser'</span><span class="token punctuation">,</span>
        <span class="token string">'password'</span> <span class="token operator">=</span> <span class="token string">'flinkpw'</span><span class="token punctuation">,</span>
        <span class="token string">'database-name'</span> <span class="token operator">=</span> <span class="token string">'HELOWIN'</span><span class="token punctuation">,</span>
        <span class="token string">'schema-name'</span> <span class="token operator">=</span> <span class="token string">'FLINKUSER'</span><span class="token punctuation">,</span>
        <span class="token string">'table-name'</span> <span class="token operator">=</span> <span class="token string">'CUSTOMERS'</span><span class="token punctuation">,</span>
        <span class="token string">'debezium.database.tablename.case.insensitive'</span><span class="token operator">=</span><span class="token string">'false'</span><span class="token punctuation">,</span>
        <span class="token string">'debezium.log.mining.strategy'</span><span class="token operator">=</span><span class="token string">'online_catalog'</span><span class="token punctuation">,</span>
        <span class="token string">'debezium.log.mining.continuous.mine'</span><span class="token operator">=</span><span class="token string">'true'</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 创建MySQL JDBC接收表table_sink_mysql，将数据写入到MySQL数据库</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> table_sink_mysql <span class="token punctuation">(</span>
    customer_id <span class="token keyword">INT</span><span class="token punctuation">,</span>
    customer_name STRING<span class="token punctuation">,</span>
    email STRING<span class="token punctuation">,</span>
    phone STRING<span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>customer_id<span class="token punctuation">)</span> <span class="token operator">NOT</span> ENFORCED
<span class="token punctuation">)</span>
<span class="token keyword">WITH</span> <span class="token punctuation">(</span>
    <span class="token string">'connector'</span> <span class="token operator">=</span> <span class="token string">'jdbc'</span><span class="token punctuation">,</span>
    <span class="token string">'url'</span> <span class="token operator">=</span> <span class="token string">'jdbc:mysql://10.194.183.120:30025/test'</span><span class="token punctuation">,</span>
    <span class="token string">'username'</span> <span class="token operator">=</span> <span class="token string">'root'</span><span class="token punctuation">,</span>
    <span class="token string">'password'</span> <span class="token operator">=</span> <span class="token string">'root'</span><span class="token punctuation">,</span>
    <span class="token string">'table-name'</span> <span class="token operator">=</span> <span class="token string">'customers'</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 将table_source_oracle表的数据插入到table_sink_mysql表中</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> table_sink_mysql <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> table_source_oracle<span class="token punctuation">;</span>
</code></pre> 
<h2><a id="font_colorpurple06_font_361"></a><font color="purple">06 文末</font></h2> 
<p>本文主要讲解了<code>Flink Oracle CDC</code>实时同步的所有步骤，希望能帮助到大家，谢谢大家的阅读，本文完！</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b62efd24aa7704d47383623c05c2b162/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">vue组件缓存之keep-alive正确使用姿势</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5eeb546a2c834674827b0b7cf882ceaf/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">2024百度校招内推码</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>