<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>自定义CalendarView - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="自定义CalendarView" />
<meta property="og:description" content="因为项目原因，不多说上代码
public class CommonCalendarView extends FrameLayout implements View.OnClickListener { private ViewPager mViewPager; private TextView mMonthTv; private Context mContext; private ImageButton mLeftMonthBtn; private ImageButton mRightMonthBtn; private SparseArray&lt;GridView&gt; mViewMap = new SparseArray&lt;&gt;(); private Map&lt;String, List&gt; mYearMonthMap; private DatePickerController mController; private CalendarAdapter adapter; private Date maxDate; private Date minDate; public void setMaxDate(Date maxDate) { this.maxDate = maxDate; } public void setMinDate(Date minDate) { this.minDate = minDate; } public CommonCalendarView(Context context) { this(context,null); } public CommonCalendarView(Context context, AttributeSet attrs) { this(context, attrs,0); } public CommonCalendarView(Context context, AttributeSet attrs, int defStyleAttr) { super(context, attrs, defStyleAttr); mContext = context; } public void init(DatePickerController controller){ if (controller==null){ mController = new DatePickerController() { @Override public int getMaxYear() { return DateUtils." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/c43f64cb78c93a76bb72605b63df9ac8/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-05-08T17:43:23+08:00" />
<meta property="article:modified_time" content="2018-05-08T17:43:23+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">自定义CalendarView</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>因为项目原因，不多说上代码</p> 
<p></p> 
<pre style="background-color:#2b2b2b;color:#a9b7c6;font-family:'宋体';font-size:13.5pt;"><span style="color:#cc7832;">public class </span>CommonCalendarView <span style="color:#cc7832;">extends </span>FrameLayout <span style="color:#cc7832;">implements </span>View.OnClickListener {

    <span style="color:#cc7832;">private </span>ViewPager <span style="color:#9876aa;">mViewPager</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">    private </span>TextView <span style="color:#9876aa;">mMonthTv</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">    private </span>Context <span style="color:#9876aa;">mContext</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">    private </span>ImageButton <span style="color:#9876aa;">mLeftMonthBtn</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">    private </span>ImageButton <span style="color:#9876aa;">mRightMonthBtn</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">    private </span>SparseArray&lt;GridView&gt; <span style="color:#9876aa;">mViewMap </span>= <span style="color:#cc7832;">new </span>SparseArray&lt;&gt;()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">    private </span>Map&lt;String<span style="color:#cc7832;">, </span>List&gt; <span style="color:#9876aa;">mYearMonthMap</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">    private </span>DatePickerController <span style="color:#9876aa;">mController</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">    private </span>CalendarAdapter <span style="color:#9876aa;">adapter</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">    private </span>Date <span style="color:#9876aa;">maxDate</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">    private </span>Date <span style="color:#9876aa;">minDate</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">    public void </span><span style="color:#ffc66d;">setMaxDate</span>(Date maxDate) {
        <span style="color:#cc7832;">this</span>.<span style="color:#9876aa;">maxDate </span>= maxDate<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">    </span>}

    <span style="color:#cc7832;">public void </span><span style="color:#ffc66d;">setMinDate</span>(Date minDate) {
        <span style="color:#cc7832;">this</span>.<span style="color:#9876aa;">minDate </span>= minDate<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">    </span>}

    <span style="color:#cc7832;">public </span><span style="color:#ffc66d;">CommonCalendarView</span>(Context context) {
        <span style="color:#cc7832;">this</span>(context<span style="color:#cc7832;">,null</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">    </span>}

    <span style="color:#cc7832;">public </span><span style="color:#ffc66d;">CommonCalendarView</span>(Context context<span style="color:#cc7832;">, </span>AttributeSet attrs) {
        <span style="color:#cc7832;">this</span>(context<span style="color:#cc7832;">, </span>attrs<span style="color:#cc7832;">,</span><span style="color:#6897bb;">0</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">    </span>}

    <span style="color:#cc7832;">public </span><span style="color:#ffc66d;">CommonCalendarView</span>(Context context<span style="color:#cc7832;">, </span>AttributeSet attrs<span style="color:#cc7832;">, int </span>defStyleAttr) {
        <span style="color:#cc7832;">super</span>(context<span style="color:#cc7832;">, </span>attrs<span style="color:#cc7832;">, </span>defStyleAttr)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span><span style="color:#9876aa;">mContext </span>= context<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">    </span>}




    <span style="color:#cc7832;">public void </span><span style="color:#ffc66d;">init</span>(DatePickerController controller){
        <span style="color:#cc7832;">if </span>(controller==<span style="color:#cc7832;">null</span>){
             <span style="color:#9876aa;">mController </span>= <span style="color:#cc7832;">new </span>DatePickerController() {
                 <span style="color:#bbb529;">@Override
</span><span style="color:#bbb529;">                 </span><span style="color:#cc7832;">public int </span><span style="color:#ffc66d;">getMaxYear</span>() {
                     <span style="color:#cc7832;">return </span>DateUtils.<span style="font-style:italic;">getToYear</span>()+<span style="color:#6897bb;">1</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                 </span>}

                 <span style="color:#bbb529;">@Override
</span><span style="color:#bbb529;">                 </span><span style="color:#cc7832;">public void </span><span style="color:#ffc66d;">onDayOfMonthSelected</span>(<span style="color:#cc7832;">int </span>year<span style="color:#cc7832;">, int </span>month<span style="color:#cc7832;">, int </span>day) {
                     Toast.<span style="font-style:italic;">makeText</span>(<span style="color:#9876aa;">mContext</span><span style="color:#cc7832;">, </span>String.<span style="font-style:italic;">format</span>(<span style="color:#6a8759;">"%s-%s-%s"</span><span style="color:#cc7832;">, </span>year<span style="color:#cc7832;">,</span>StringUtils.<span style="font-style:italic;">leftPad</span>(String.<span style="font-style:italic;">valueOf</span>(month)<span style="color:#cc7832;">,</span><span style="color:#6897bb;">2</span><span style="color:#cc7832;">,</span><span style="color:#6a8759;">"0"</span>)<span style="color:#cc7832;">,
</span><span style="color:#cc7832;">                             </span>StringUtils.<span style="font-style:italic;">leftPad</span>(String.<span style="font-style:italic;">valueOf</span>(day)<span style="color:#cc7832;">,</span><span style="color:#6897bb;">2</span><span style="color:#cc7832;">,</span><span style="color:#6a8759;">"0"</span>))<span style="color:#cc7832;">, </span>Toast.<span style="color:#9876aa;"><em>LENGTH_SHORT</em></span>).show()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                 </span>}

                 <span style="color:#bbb529;">@Override
</span><span style="color:#bbb529;">                 </span><span style="color:#cc7832;">public void </span><span style="color:#ffc66d;">onDayOfMonthAndDataSelected</span>(<span style="color:#cc7832;">int </span>year<span style="color:#cc7832;">, int </span>month<span style="color:#cc7832;">, int </span>day<span style="color:#cc7832;">, </span>List obj) {

                 }

                 <span style="color:#bbb529;">@Override
</span><span style="color:#bbb529;">                 </span><span style="color:#cc7832;">public void </span><span style="color:#ffc66d;">showOtherFields</span>(Object obj<span style="color:#cc7832;">, </span>View view<span style="color:#cc7832;">, int </span>gridItemYear<span style="color:#cc7832;">, int </span>gridItemMonth<span style="color:#cc7832;">, int </span>gridItemDay<span style="color:#cc7832;">,int </span>postion) {

                 }

                 <span style="color:#bbb529;">@Override
</span><span style="color:#bbb529;">                 </span><span style="color:#cc7832;">public </span>Map&lt;String<span style="color:#cc7832;">, </span>List&gt; <span style="color:#ffc66d;">getDataSource</span>() {
                     <span style="color:#cc7832;">return null;
</span><span style="color:#cc7832;">                 </span>}

             }<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span>}<span style="color:#cc7832;">else</span>{
            <span style="color:#9876aa;">mController </span>= controller<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span>}
        <span style="color:#cc7832;">this</span>.<span style="color:#9876aa;">mYearMonthMap </span>= <span style="color:#9876aa;">mController</span>.getDataSource()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span><span style="color:#9876aa;">adapter </span>= <span style="color:#cc7832;">new </span>CalendarAdapter(<span style="color:#9876aa;">mContext</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span><span style="color:#9876aa;">mViewPager</span>.setPageTransformer(<span style="color:#cc7832;">true,new </span>DepthPageTransformer())<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span><span style="color:#9876aa;">mViewPager</span>.setAdapter(<span style="color:#9876aa;">adapter</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">        if </span>(<span style="color:#9876aa;">minDate</span>!=<span style="color:#cc7832;">null</span>){
            <span style="color:#9876aa;">mMonthTv</span>.setText(String.<span style="font-style:italic;">format</span>(<span style="color:#6a8759;">"%s年%s月"</span><span style="color:#cc7832;">,</span>DateUtils.<span style="font-style:italic;">getYear</span>(<span style="color:#9876aa;">minDate</span>)<span style="color:#cc7832;">, </span>StringUtils.<span style="font-style:italic;">leftPad</span>(String.<span style="font-style:italic;">valueOf</span>(DateUtils.<span style="font-style:italic;">getMonth</span>(<span style="color:#9876aa;">minDate</span>))<span style="color:#cc7832;">,</span><span style="color:#6897bb;">2</span><span style="color:#cc7832;">,</span><span style="color:#6a8759;">"0"</span>)))<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span>}<span style="color:#cc7832;">else</span>{
            <span style="color:#9876aa;">mMonthTv</span>.setText(String.<span style="font-style:italic;">format</span>(<span style="color:#6a8759;">"%s年%s月"</span><span style="color:#cc7832;">,</span>DateUtils.<span style="font-style:italic;">getToYear</span>()<span style="color:#cc7832;">, </span>StringUtils.<span style="font-style:italic;">leftPad</span>(String.<span style="font-style:italic;">valueOf</span>(DateUtils.<span style="font-style:italic;">getToMonth</span>())<span style="color:#cc7832;">,</span><span style="color:#6897bb;">2</span><span style="color:#cc7832;">,</span><span style="color:#6a8759;">"0"</span>)))<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span>}

        <span style="color:#9876aa;">mViewPager</span>.addOnPageChangeListener(<span style="color:#cc7832;">new </span>ViewPager.OnPageChangeListener() {
            <span style="color:#bbb529;">@Override
</span><span style="color:#bbb529;">            </span><span style="color:#cc7832;">public void </span><span style="color:#ffc66d;">onPageScrolled</span>(<span style="color:#cc7832;">int </span>position<span style="color:#cc7832;">, float </span>positionOffset<span style="color:#cc7832;">, int </span>positionOffsetPixels) {

            }

            <span style="color:#bbb529;">@Override
</span><span style="color:#bbb529;">            </span><span style="color:#cc7832;">public void </span><span style="color:#ffc66d;">onPageSelected</span>(<span style="color:#cc7832;">int </span>position) {
                <span style="color:#9876aa;">mMonthTv</span>.setText(<span style="color:#9876aa;">adapter</span>.getPageTitle(position))<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            </span>}

            <span style="color:#bbb529;">@Override
</span><span style="color:#bbb529;">            </span><span style="color:#cc7832;">public void </span><span style="color:#ffc66d;">onPageScrollStateChanged</span>(<span style="color:#cc7832;">int </span>state) {

            }
        })<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">    </span>}

    <span style="color:#bbb529;">@Override
</span><span style="color:#bbb529;">    </span><span style="color:#cc7832;">protected void </span><span style="color:#ffc66d;">onFinishInflate</span>() {
        <span style="color:#cc7832;">super</span>.onFinishInflate()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span>View view = LayoutInflater.<span style="font-style:italic;">from</span>(<span style="color:#9876aa;">mContext</span>).inflate(R.layout.<span style="color:#9876aa;"><em>activity_page_calendar_price</em></span><span style="color:#cc7832;">,this,true</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        this</span>.<span style="color:#9876aa;">mViewPager </span>= (ViewPager) view.findViewById(R.id.<span style="color:#9876aa;"><em>viewPager</em></span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        this</span>.<span style="color:#9876aa;">mRightMonthBtn </span>= (ImageButton) view.findViewById(R.id.<span style="color:#9876aa;"><em>right_month_btn</em></span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        this</span>.<span style="color:#9876aa;">mMonthTv </span>= (TextView) view.findViewById(R.id.<span style="color:#9876aa;"><em>month_tv</em></span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        this</span>.<span style="color:#9876aa;">mLeftMonthBtn </span>= (ImageButton) view.findViewById(R.id.<span style="color:#9876aa;"><em>left_month_btn</em></span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        this</span>.<span style="color:#9876aa;">mLeftMonthBtn</span>.setOnClickListener(<span style="color:#cc7832;">this</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        this</span>.<span style="color:#9876aa;">mRightMonthBtn</span>.setOnClickListener(<span style="color:#cc7832;">this</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">    </span>}

    <span style="color:#bbb529;">@Override
</span><span style="color:#bbb529;">    </span><span style="color:#cc7832;">public void </span><span style="color:#ffc66d;">onClick</span>(View v) {
        <span style="color:#cc7832;">switch </span>(v.getId()){
            <span style="color:#cc7832;">case </span>R.id.<span style="color:#9876aa;"><em>left_month_btn</em></span>:
                <span style="color:#9876aa;">mViewPager</span>.setCurrentItem(<span style="color:#9876aa;">mViewPager</span>.getCurrentItem()-<span style="color:#6897bb;">1</span><span style="color:#cc7832;">,true</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                break;
</span><span style="color:#cc7832;">            case </span>R.id.<span style="color:#9876aa;"><em>right_month_btn</em></span>:
                <span style="color:#9876aa;">mViewPager</span>.setCurrentItem(<span style="color:#9876aa;">mViewPager</span>.getCurrentItem()+<span style="color:#6897bb;">1</span><span style="color:#cc7832;">,true</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                break;
</span><span style="color:#cc7832;">        </span>}
    }


    <span style="color:#cc7832;">class </span>CalendarAdapter <span style="color:#cc7832;">extends </span>PagerAdapter <span style="color:#cc7832;">implements </span>AdapterView.OnItemClickListener {

        <span style="color:#cc7832;">protected static final int </span><span style="color:#9876aa;"><em>MONTHS_IN_YEAR </em></span>= <span style="color:#6897bb;">12</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        private final </span>Calendar <span style="color:#9876aa;">calendar </span>= Calendar.<span style="font-style:italic;">getInstance</span>()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        private </span>Integer <span style="color:#9876aa;">firstMonth </span>= <span style="color:#9876aa;">calendar</span>.get(Calendar.<span style="color:#9876aa;"><em>MONTH</em></span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        private </span>LayoutInflater <span style="color:#9876aa;">inflater</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        private </span>Integer <span style="color:#9876aa;">lastMonth </span>= (<span style="color:#9876aa;">calendar</span>.get(Calendar.<span style="color:#9876aa;"><em>MONTH</em></span>) - <span style="color:#6897bb;">1</span>) % <span style="color:#9876aa;"><em>MONTHS_IN_YEAR</em></span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        private </span>Integer <span style="color:#9876aa;">startYear </span>= <span style="color:#9876aa;">calendar</span>.get(Calendar.<span style="color:#9876aa;"><em>YEAR</em></span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">        public </span><span style="color:#ffc66d;">CalendarAdapter</span>(Context context) {
            <span style="color:#9876aa;">inflater </span>= LayoutInflater.<span style="font-style:italic;">from</span>(context)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            </span><span style="color:#9876aa;">mContext </span>= context<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            if </span>(<span style="color:#9876aa;">maxDate</span>!=<span style="color:#cc7832;">null</span>){
                <span style="color:#9876aa;">lastMonth </span>= DateUtils.<span style="font-style:italic;">getMonth</span>(<span style="color:#9876aa;">maxDate</span>)-<span style="color:#6897bb;">1</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            </span>}
            <span style="color:#cc7832;">if </span>(<span style="color:#9876aa;">minDate</span>!=<span style="color:#cc7832;">null</span>){
                <span style="color:#9876aa;">startYear </span>= DateUtils.<span style="font-style:italic;">getYear</span>(<span style="color:#9876aa;">minDate</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                </span><span style="color:#9876aa;">firstMonth </span>= DateUtils.<span style="font-style:italic;">getMonth</span>(<span style="color:#9876aa;">minDate</span>)-<span style="color:#6897bb;">1</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            </span>}
        }


        <span style="color:#bbb529;">@Override
</span><span style="color:#bbb529;">        </span><span style="color:#cc7832;">public </span>CharSequence <span style="color:#ffc66d;">getPageTitle</span>(<span style="color:#cc7832;">int </span>position) {
            <span style="color:#cc7832;">int </span>year = position / <span style="color:#9876aa;"><em>MONTHS_IN_YEAR </em></span>+ <span style="color:#9876aa;">startYear </span>+ ((<span style="color:#9876aa;">firstMonth </span>+ (position % <span style="color:#9876aa;"><em>MONTHS_IN_YEAR</em></span>)) / <span style="color:#9876aa;"><em>MONTHS_IN_YEAR</em></span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            int </span>month = (<span style="color:#9876aa;">firstMonth </span>+ (position % <span style="color:#9876aa;"><em>MONTHS_IN_YEAR</em></span>)) % <span style="color:#9876aa;"><em>MONTHS_IN_YEAR</em></span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            return </span>String.<span style="font-style:italic;">format</span>(<span style="color:#6a8759;">"%s年%s月"</span><span style="color:#cc7832;">,</span>year<span style="color:#cc7832;">, </span>StringUtils.<span style="font-style:italic;">leftPad</span>(String.<span style="font-style:italic;">valueOf</span>(month+<span style="color:#6897bb;">1</span>)<span style="color:#cc7832;">,</span><span style="color:#6897bb;">2</span><span style="color:#cc7832;">,</span><span style="color:#6a8759;">"0"</span>))<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span>}

        <span style="color:#bbb529;">@Override
</span><span style="color:#bbb529;">        </span><span style="color:#cc7832;">public int </span><span style="color:#ffc66d;">getCount</span>() {
            <span style="color:#cc7832;">int </span>maxYear = <span style="color:#9876aa;">mController</span>.getMaxYear()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            int </span>minYear = <span style="color:#9876aa;">calendar</span>.get(Calendar.<span style="color:#9876aa;"><em>YEAR</em></span>) <span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            if </span>(<span style="color:#9876aa;">maxDate</span>!=<span style="color:#cc7832;">null</span>){
                maxYear = DateUtils.<span style="font-style:italic;">getYear</span>(<span style="color:#9876aa;">maxDate</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            </span>}
            <span style="color:#cc7832;">if </span>(<span style="color:#9876aa;">minDate</span>!=<span style="color:#cc7832;">null</span>){
                minYear = DateUtils.<span style="font-style:italic;">getYear</span>(<span style="color:#9876aa;">minDate</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            </span>}

            <span style="color:#cc7832;">int </span>itemCount = (maxYear-minYear+<span style="color:#6897bb;">1</span>) * <span style="color:#9876aa;"><em>MONTHS_IN_YEAR</em></span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">            if </span>(<span style="color:#9876aa;">firstMonth </span>!= -<span style="color:#6897bb;">1</span>)
                itemCount -= <span style="color:#9876aa;">firstMonth</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">            if </span>(<span style="color:#9876aa;">lastMonth </span>!= -<span style="color:#6897bb;">1</span>)
                itemCount -= (<span style="color:#9876aa;"><em>MONTHS_IN_YEAR </em></span>- <span style="color:#9876aa;">lastMonth</span>) - <span style="color:#6897bb;">1</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            return </span>itemCount<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span>}


        <span style="color:#bbb529;">@Override
</span><span style="color:#bbb529;">        </span><span style="color:#cc7832;">public </span>Object <span style="color:#ffc66d;">instantiateItem</span>(ViewGroup container<span style="color:#cc7832;">, int </span>position) {
            GridView mGridView = <span style="color:#9876aa;">mViewMap</span>.get(position)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            if </span>(mGridView ==<span style="color:#cc7832;">null</span>){
                mGridView = (GridView) <span style="color:#9876aa;">inflater</span>.inflate(R.layout.<span style="color:#9876aa;"><em>item_page_month_day</em></span><span style="color:#cc7832;">, </span>container<span style="color:#cc7832;">, false</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                </span><span style="color:#9876aa;">mViewMap</span>.put(position<span style="color:#cc7832;">,</span>mGridView)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            </span>}
            <span style="color:#cc7832;">int </span>year = position / <span style="color:#9876aa;"><em>MONTHS_IN_YEAR </em></span>+  <span style="color:#9876aa;">startYear </span>+ ((<span style="color:#9876aa;">firstMonth </span>+ (position % <span style="color:#9876aa;"><em>MONTHS_IN_YEAR</em></span>)) / <span style="color:#9876aa;"><em>MONTHS_IN_YEAR</em></span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            int </span>month = (<span style="color:#9876aa;">firstMonth </span>+ (position % <span style="color:#9876aa;"><em>MONTHS_IN_YEAR</em></span>)) % <span style="color:#9876aa;"><em>MONTHS_IN_YEAR</em></span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            </span>DateBean dateBean = <span style="color:#cc7832;">new </span>DateBean(year<span style="color:#cc7832;">, </span>month + <span style="color:#6897bb;">1</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            </span>mGridView.setOnItemClickListener(<span style="color:#cc7832;">this</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">            </span>mGridView.setAdapter(<span style="color:#cc7832;">new </span>MyGridAdapter(dateBean))<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            </span>container.addView(mGridView)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            return </span>mGridView<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span>}

        <span style="color:#bbb529;">@Override
</span><span style="color:#bbb529;">        </span><span style="color:#cc7832;">public void </span><span style="color:#ffc66d;">destroyItem</span>(ViewGroup container<span style="color:#cc7832;">, int </span>position<span style="color:#cc7832;">, </span>Object object) {
            container.removeView((View) object)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span>}

        <span style="color:#bbb529;">@Override
</span><span style="color:#bbb529;">        </span><span style="color:#cc7832;">public boolean </span><span style="color:#ffc66d;">isViewFromObject</span>(View view<span style="color:#cc7832;">, </span>Object object) {
            <span style="color:#cc7832;">return </span>view == object<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span>}

        <span style="color:#bbb529;">@Override
</span><span style="color:#bbb529;">        </span><span style="color:#cc7832;">public void </span><span style="color:#ffc66d;">onItemClick</span>(AdapterView&lt;?&gt; parent<span style="color:#cc7832;">, </span>View view<span style="color:#cc7832;">, int </span>position<span style="color:#cc7832;">, long </span>id) {
            MyGridAdapter gridAdapter = (MyGridAdapter) parent.getAdapter()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            int </span>day = (<span style="color:#cc7832;">int</span>) gridAdapter.getItem(position)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            if </span>(day == -<span style="color:#6897bb;">1</span>) {
                <span style="color:#cc7832;">return;
</span><span style="color:#cc7832;">            </span>}
            DateBean bean = gridAdapter.getDateBean()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            </span>List&lt;ProductDatePrice&gt; list = gridAdapter.getProductDatePriceList()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            if </span>(<span style="color:#9876aa;">mController</span>!=<span style="color:#cc7832;">null</span>){
                <span style="color:#cc7832;">if </span>(list!=<span style="color:#cc7832;">null</span>&amp;&amp;!list.isEmpty()){
                    <span style="color:#9876aa;">mController</span>.onDayOfMonthAndDataSelected(bean.<span style="color:#9876aa;">currentYear</span><span style="color:#cc7832;">,</span>bean.<span style="color:#9876aa;">currentMonth</span><span style="color:#cc7832;">,</span>day+<span style="color:#6897bb;">1</span><span style="color:#cc7832;">,</span>list)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                </span>}<span style="color:#cc7832;">else</span>{
                    <span style="color:#9876aa;">mController</span>.onDayOfMonthSelected(bean.<span style="color:#9876aa;">currentYear</span><span style="color:#cc7832;">,</span>bean.<span style="color:#9876aa;">currentMonth</span><span style="color:#cc7832;">,</span>day+<span style="color:#6897bb;">1</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                </span>}
            }
        }

    }


    <span style="color:#cc7832;">class </span>MyGridAdapter <span style="color:#cc7832;">extends </span>BaseAdapter {


        <span style="color:#cc7832;">private </span>DateBean <span style="color:#9876aa;">mDateBean</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        private int </span><span style="color:#9876aa;">days</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        private int </span><span style="color:#9876aa;">dayOfWeeks</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        private </span>List <span style="color:#9876aa;">mProductDatePriceList</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">        public </span>DateBean <span style="color:#ffc66d;">getDateBean</span>() {
            <span style="color:#cc7832;">return </span><span style="color:#9876aa;">mDateBean</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span>}

        <span style="color:#cc7832;">public </span><span style="color:#ffc66d;">MyGridAdapter</span>(DateBean dateBean) {
            <span style="color:#cc7832;">this</span>.<span style="color:#9876aa;">mDateBean </span>= dateBean<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            if </span>(<span style="color:#9876aa;">mYearMonthMap</span>!=<span style="color:#cc7832;">null</span>){
                <span style="color:#cc7832;">this</span>.<span style="color:#9876aa;">mProductDatePriceList </span>= <span style="color:#9876aa;">mYearMonthMap</span>.get(String.<span style="font-style:italic;">format</span>(<span style="color:#6a8759;">"%s-%s"</span><span style="color:#cc7832;">, </span>dateBean.<span style="color:#9876aa;">currentYear</span><span style="color:#cc7832;">, </span>StringUtils.<span style="font-style:italic;">leftPad</span>(dateBean.<span style="color:#9876aa;">currentMonth </span>+ <span style="color:#6a8759;">""</span><span style="color:#cc7832;">, </span><span style="color:#6897bb;">2</span><span style="color:#cc7832;">, </span><span style="color:#6a8759;">"0"</span>)))<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            </span>}
            GregorianCalendar c = <span style="color:#cc7832;">new </span>GregorianCalendar(dateBean.<span style="color:#9876aa;">currentYear</span><span style="color:#cc7832;">, </span>dateBean.<span style="color:#9876aa;">currentMonth </span>- <span style="color:#6897bb;">1</span><span style="color:#cc7832;">, </span><span style="color:#6897bb;">0</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            </span><span style="color:#9876aa;">days </span>= DateUtils.<span style="font-style:italic;">getDaysOfMonth</span>(dateBean.<span style="color:#9876aa;">currentYear</span><span style="color:#cc7832;">, </span>dateBean.<span style="color:#9876aa;">currentMonth</span>)<span style="color:#cc7832;">; </span><span style="color:#808080;">//返回当前月的总天数。
</span><span style="color:#808080;">            </span><span style="color:#9876aa;">dayOfWeeks </span>= c.get(Calendar.<span style="color:#9876aa;"><em>DAY_OF_WEEK</em></span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            if </span>(<span style="color:#9876aa;">dayOfWeeks </span>== <span style="color:#6897bb;">7</span>) {
                <span style="color:#9876aa;">dayOfWeeks </span>= <span style="color:#6897bb;">0</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            </span>}
        }

        <span style="color:#cc7832;">public </span>List <span style="color:#ffc66d;">getProductDatePriceList</span>() {
            <span style="color:#cc7832;">return </span><span style="color:#9876aa;">mProductDatePriceList</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span>}

        <span style="color:#bbb529;">@Override
</span><span style="color:#bbb529;">        </span><span style="color:#cc7832;">public int </span><span style="color:#ffc66d;">getCount</span>() {
            <span style="color:#cc7832;">return </span><span style="color:#9876aa;">days </span>+ <span style="color:#9876aa;">dayOfWeeks</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span>}

        <span style="color:#bbb529;">@Override
</span><span style="color:#bbb529;">        </span><span style="color:#cc7832;">public </span>Object <span style="color:#ffc66d;">getItem</span>(<span style="color:#cc7832;">int </span>i) {
            <span style="color:#cc7832;">if </span>(i &lt; <span style="color:#9876aa;">dayOfWeeks</span>) {
                <span style="color:#cc7832;">return </span>-<span style="color:#6897bb;">1</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            </span>} <span style="color:#cc7832;">else </span>{
                <span style="color:#cc7832;">return </span>i - <span style="color:#9876aa;">dayOfWeeks</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            </span>}
        }

        <span style="color:#bbb529;">@Override
</span><span style="color:#bbb529;">        </span><span style="color:#cc7832;">public long </span><span style="color:#ffc66d;">getItemId</span>(<span style="color:#cc7832;">int </span>i) {
            <span style="color:#cc7832;">return </span><span style="color:#6897bb;">0</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span>}

        <span style="color:#bbb529;">@Override
</span><span style="color:#bbb529;">        </span><span style="color:#cc7832;">public </span>View <span style="color:#ffc66d;">getView</span>(<span style="color:#cc7832;">int </span>i<span style="color:#cc7832;">, </span>View view<span style="color:#cc7832;">, </span>ViewGroup viewGroup) {
            GridViewHolder viewHolder <span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            if </span>(view == <span style="color:#cc7832;">null</span>) {
                view = LayoutInflater.<span style="font-style:italic;">from</span>(<span style="color:#9876aa;">mContext</span>).inflate(R.layout.<span style="color:#9876aa;"><em>item_day</em></span><span style="color:#cc7832;">, </span>viewGroup<span style="color:#cc7832;">, false</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                </span>viewHolder = <span style="color:#cc7832;">new </span>GridViewHolder()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                </span>viewHolder.<span style="color:#9876aa;">mTextView </span>= (TextView) view.findViewById(R.id.<span style="color:#9876aa;"><em>day_tv</em></span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                </span>viewHolder.<span style="color:#9876aa;">mPriceTv </span>= (TextView) view.findViewById(R.id.<span style="color:#9876aa;"><em>price_tv</em></span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                </span>viewHolder.<span style="color:#9876aa;">mLineView </span>= view.findViewById(R.id.<span style="color:#9876aa;"><em>line_view</em></span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                </span>view.setTag(viewHolder)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            </span>} <span style="color:#cc7832;">else </span>{
                viewHolder = (GridViewHolder) view.getTag()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            </span>}
            <span style="color:#cc7832;">int </span>item = (<span style="color:#cc7832;">int</span>) getItem(i)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            if </span>(item == -<span style="color:#6897bb;">1</span>) {
                viewHolder.<span style="color:#9876aa;">mTextView</span>.setText(<span style="color:#6a8759;">""</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                </span>viewHolder.<span style="color:#9876aa;">mPriceTv</span>.setText(<span style="color:#6a8759;">""</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            </span>} <span style="color:#cc7832;">else </span>{
                viewHolder.<span style="color:#9876aa;">mTextView</span>.setText(String.<span style="font-style:italic;">valueOf</span>(item + <span style="color:#6897bb;">1</span>))<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                </span>viewHolder.<span style="color:#9876aa;">mPriceTv</span>.setText(<span style="color:#6a8759;">""</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                if </span>(i%<span style="color:#6897bb;">7</span>==<span style="color:#6897bb;">0</span>||i%<span style="color:#6897bb;">7</span>==<span style="color:#6897bb;">6</span>){
                    viewHolder.<span style="color:#9876aa;">mTextView</span>.setActivated(<span style="color:#cc7832;">true</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                </span>}<span style="color:#cc7832;">else</span>{
                    viewHolder.<span style="color:#9876aa;">mTextView</span>.setActivated(<span style="color:#cc7832;">false</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                </span>}
                <span style="color:#cc7832;">if </span>(<span style="color:#9876aa;">mProductDatePriceList </span>!= <span style="color:#cc7832;">null</span>) {
                    viewHolder.<span style="color:#9876aa;">mTextView</span>.setEnabled(<span style="color:#cc7832;">false</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                    </span>view.setEnabled(<span style="color:#cc7832;">false</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                    for </span>(Object obj : <span style="color:#9876aa;">mProductDatePriceList</span>) {<!-- --><span style="color:#808080;">//用于展示价格等额外的属性
</span><span style="color:#808080;">                        </span><span style="color:#cc7832;">if </span>(<span style="color:#9876aa;">mController</span>!=<span style="color:#cc7832;">null</span>){
                            <span style="color:#9876aa;">mController</span>.showOtherFields(obj<span style="color:#cc7832;">,</span>view<span style="color:#cc7832;">,</span><span style="color:#9876aa;">mDateBean</span>.<span style="color:#9876aa;">currentYear</span><span style="color:#cc7832;">,</span><span style="color:#9876aa;">mDateBean</span>.<span style="color:#9876aa;">currentMonth</span><span style="color:#cc7832;">,</span>item+<span style="color:#6897bb;">1</span><span style="color:#cc7832;">,</span>i)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                        </span>}
                    }
                }
            }
            <span style="color:#cc7832;">return </span>view<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span>}
    }

    <span style="color:#cc7832;">static class </span>DateBean {
        <span style="color:#cc7832;">private int </span><span style="color:#9876aa;">currentYear</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        private int </span><span style="color:#9876aa;">currentMonth</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">        public </span><span style="color:#ffc66d;">DateBean</span>(<span style="color:#cc7832;">int </span>currentYear<span style="color:#cc7832;">, int </span>currentMonth) {
            <span style="color:#cc7832;">this</span>.<span style="color:#9876aa;">currentYear </span>= currentYear<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            this</span>.<span style="color:#9876aa;">currentMonth </span>= currentMonth<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span>}
    }

    <span style="color:#cc7832;">public static class </span>GridViewHolder {
        <span style="color:#cc7832;">public </span>TextView <span style="color:#9876aa;">mTextView</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        public </span>View <span style="color:#9876aa;">mLineView</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        public </span>TextView <span style="color:#9876aa;">mPriceTv</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">    </span>}

    <span style="color:#cc7832;">class </span>DepthPageTransformer <span style="color:#cc7832;">implements </span>ViewPager.PageTransformer {
        <span style="color:#cc7832;">private static final float </span><span style="color:#9876aa;"><em>MIN_SCALE </em></span>= <span style="color:#6897bb;">0.75f</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">        </span><span style="color:#bbb529;">@Override
</span><span style="color:#bbb529;">        </span><span style="color:#cc7832;">public void </span><span style="color:#ffc66d;">transformPage</span>(View view<span style="color:#cc7832;">, float </span>position) {
            <span style="color:#cc7832;">int </span>pageWidth = view.getWidth()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">            if </span>(position &lt; -<span style="color:#6897bb;">1</span>) { <span style="color:#808080;">// [-Infinity,-1)
</span><span style="color:#808080;">                // This page is way off-screen to the left.
</span><span style="color:#808080;">                </span>view.setAlpha(<span style="color:#6897bb;">0</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">            </span>} <span style="color:#cc7832;">else if </span>(position &lt;= <span style="color:#6897bb;">0</span>) { <span style="color:#808080;">// [-1,0]
</span><span style="color:#808080;">                // Use the default slide transition when moving to the left page
</span><span style="color:#808080;">                </span>view.setAlpha(<span style="color:#6897bb;">1</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                </span>view.setTranslationX(<span style="color:#6897bb;">0</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                </span>view.setScaleX(<span style="color:#6897bb;">1</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                </span>view.setScaleY(<span style="color:#6897bb;">1</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">            </span>} <span style="color:#cc7832;">else if </span>(position &lt;= <span style="color:#6897bb;">1</span>) { <span style="color:#808080;">// (0,1]
</span><span style="color:#808080;">                // Fade the page out.
</span><span style="color:#808080;">                </span>view.setAlpha(<span style="color:#6897bb;">1 </span>- position)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">                </span><span style="color:#808080;">// Counteract the default slide transition
</span><span style="color:#808080;">                </span>view.setTranslationX(pageWidth * -position)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">                </span><span style="color:#808080;">// Scale the page down (between MIN_SCALE and 1)
</span><span style="color:#808080;">                </span><span style="color:#cc7832;">float </span>scaleFactor = <span style="color:#9876aa;"><em>MIN_SCALE
</em></span><span style="color:#9876aa;"><em>                        </em></span>+ (<span style="color:#6897bb;">1 </span>- <span style="color:#9876aa;"><em>MIN_SCALE</em></span>) * (<span style="color:#6897bb;">1 </span>- Math.<span style="font-style:italic;">abs</span>(position))<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                </span>view.setScaleX(scaleFactor)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                </span>view.setScaleY(scaleFactor)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">            </span>} <span style="color:#cc7832;">else </span>{ <span style="color:#808080;">// (1,+Infinity]
</span><span style="color:#808080;">                // This page is way off-screen to the right.
</span><span style="color:#808080;">                </span>view.setAlpha(<span style="color:#6897bb;">0</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            </span>}
        }
    }

    <span style="color:#cc7832;">public interface </span>DatePickerController {


        <span style="color:#cc7832;">int </span><span style="color:#ffc66d;">getMaxYear</span>()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">        void </span><span style="color:#ffc66d;">onDayOfMonthSelected</span>(<span style="color:#cc7832;">int </span>year<span style="color:#cc7832;">, int </span>month<span style="color:#cc7832;">, int </span>day)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">        void </span><span style="color:#ffc66d;">onDayOfMonthAndDataSelected</span>(<span style="color:#cc7832;">int </span>year<span style="color:#cc7832;">, int </span>month<span style="color:#cc7832;">, int </span>day<span style="color:#cc7832;">, </span>List obj)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">        </span><span style="color:#808080;">//展示其它属性(用于扩展数据  日期相等时设置显示效果)
</span><span style="color:#808080;">        </span><span style="color:#cc7832;">void </span><span style="color:#ffc66d;">showOtherFields</span>(Object obj<span style="color:#cc7832;">, </span>View view<span style="color:#cc7832;">, int </span>gridItemYear<span style="color:#cc7832;">, int </span>gridItemMonth<span style="color:#cc7832;">, int </span>gridItemDay<span style="color:#cc7832;">,int </span>position)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">        </span>Map&lt;String<span style="color:#cc7832;">,</span>List&gt; <span style="color:#ffc66d;">getDataSource</span>()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">    </span>}

}</pre> 
<p>调用时</p> 
<p></p> 
<pre style="background-color:#2b2b2b;color:#a9b7c6;font-family:'宋体';font-size:13.5pt;"><span style="color:#cc7832;">public class </span>MoreInfoCalendarActivity <span style="color:#cc7832;">extends </span>AppCompatActivity {

    <span style="color:#cc7832;">private  </span>CommonCalendarView <span style="color:#9876aa;">calendarView</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">    private </span>Map&lt;String<span style="color:#cc7832;">,</span>List&gt; <span style="color:#9876aa;">mYearMonthMap </span>= <span style="color:#cc7832;">new </span>HashMap&lt;&gt;()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">    </span><span style="color:#bbb529;">@Override
</span><span style="color:#bbb529;">    </span><span style="color:#cc7832;">protected void </span><span style="color:#ffc66d;">onCreate</span>(Bundle savedInstanceState) {
        <span style="color:#cc7832;">super</span>.onCreate(savedInstanceState)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span>setContentView(R.layout.<span style="color:#9876aa;"><em>activity_more_info_calendar</em></span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">        </span>List&lt;ProductDatePrice&gt; mDatePriceList = <span style="color:#cc7832;">new </span>ArrayList&lt;&gt;()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        for </span>(<span style="color:#cc7832;">int </span>i = <span style="color:#6897bb;">1</span><span style="color:#cc7832;">; </span>i &lt;= <span style="color:#6897bb;">12</span><span style="color:#cc7832;">; </span>i++) {<!-- --><span style="color:#808080;">//构造12个月每天的价格数据
</span><span style="color:#808080;">            </span><span style="color:#cc7832;">for </span>(<span style="color:#cc7832;">int </span>j = <span style="color:#6897bb;">1</span><span style="color:#cc7832;">; </span>j &lt;= <span style="color:#6897bb;">28</span><span style="color:#cc7832;">; </span>j++) {
                ProductDatePrice price = <span style="color:#cc7832;">new </span>ProductDatePrice()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                </span>price.setPriceDate(String.<span style="font-style:italic;">format</span>(<span style="color:#6a8759;">"2018-%s-%s"</span><span style="color:#cc7832;">, </span>StringUtils.<span style="font-style:italic;">leftPad</span>(String.<span style="font-style:italic;">valueOf</span>(i)<span style="color:#cc7832;">, </span><span style="color:#6897bb;">2</span><span style="color:#cc7832;">, </span><span style="color:#6a8759;">"0"</span>)<span style="color:#cc7832;">, </span>StringUtils.<span style="font-style:italic;">leftPad</span>(String.<span style="font-style:italic;">valueOf</span>(j)<span style="color:#cc7832;">, </span><span style="color:#6897bb;">2</span><span style="color:#cc7832;">, </span><span style="color:#6a8759;">"0"</span>)))<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                </span>price.setPrice(RandomUtils.<span style="font-style:italic;">nextInt</span>(<span style="color:#6897bb;">1000</span>))<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                </span>mDatePriceList.add(price)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            </span>}
        }

        <span style="color:#cc7832;">for </span>(ProductDatePrice productDatePrice : mDatePriceList) {<!-- --><span style="color:#808080;">//把价格数据改为同一个月的list 在一个key value里，减少渲染界面时循环判断数量
</span><span style="color:#808080;">            </span>productDatePrice.getPriceDate()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            </span>String yearMonth = TextUtils.<span style="font-style:italic;">substring</span>(productDatePrice.getPriceDate()<span style="color:#cc7832;">, </span><span style="color:#6897bb;">0</span><span style="color:#cc7832;">, </span>TextUtils.<span style="font-style:italic;">lastIndexOf</span>(productDatePrice.getPriceDate()<span style="color:#cc7832;">, </span><span style="color:#6a8759;">'-'</span>))<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            </span>List list = <span style="color:#9876aa;">mYearMonthMap</span>.get(yearMonth)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            if </span>(list == <span style="color:#cc7832;">null</span>) {
                list = <span style="color:#cc7832;">new </span>ArrayList()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                </span>list.add(productDatePrice)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                </span><span style="color:#9876aa;">mYearMonthMap</span>.put(yearMonth<span style="color:#cc7832;">, </span>list)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            </span>} <span style="color:#cc7832;">else </span>{
                list.add(productDatePrice)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            </span>}
        }

        <span style="color:#cc7832;">this</span>.<span style="color:#9876aa;">calendarView </span>= (CommonCalendarView) findViewById(R.id.<span style="color:#9876aa;"><em>calendarView</em></span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        this</span>.<span style="color:#9876aa;">calendarView</span>.init(<span style="color:#cc7832;">new </span>CommonCalendarView.DatePickerController() {
            <span style="color:#bbb529;">@Override
</span><span style="color:#bbb529;">            </span><span style="color:#cc7832;">public int </span><span style="color:#ffc66d;">getMaxYear</span>() {
                <span style="color:#cc7832;">return </span><span style="color:#6897bb;">2020</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            </span>}

            <span style="color:#bbb529;">@Override
</span><span style="color:#bbb529;">            </span><span style="color:#cc7832;">public void </span><span style="color:#ffc66d;">onDayOfMonthSelected</span>(<span style="color:#cc7832;">int </span>year<span style="color:#cc7832;">, int </span>month<span style="color:#cc7832;">, int </span>day) {
                Toast.<span style="font-style:italic;">makeText</span>(MoreInfoCalendarActivity.<span style="color:#cc7832;">this, </span>String.<span style="font-style:italic;">format</span>(<span style="color:#6a8759;">"%s-%s-%s"</span><span style="color:#cc7832;">, </span>year<span style="color:#cc7832;">,</span>StringUtils.<span style="font-style:italic;">leftPad</span>(String.<span style="font-style:italic;">valueOf</span>(month)<span style="color:#cc7832;">,</span><span style="color:#6897bb;">2</span><span style="color:#cc7832;">,</span><span style="color:#6a8759;">"0"</span>)<span style="color:#cc7832;">,
</span><span style="color:#cc7832;">                        </span>StringUtils.<span style="font-style:italic;">leftPad</span>(String.<span style="font-style:italic;">valueOf</span>(day)<span style="color:#cc7832;">,</span><span style="color:#6897bb;">2</span><span style="color:#cc7832;">,</span><span style="color:#6a8759;">"0"</span>))<span style="color:#cc7832;">, </span>Toast.<span style="color:#9876aa;"><em>LENGTH_SHORT</em></span>).show()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            </span>}

            <span style="color:#bbb529;">@Override
</span><span style="color:#bbb529;">            </span><span style="color:#cc7832;">public void </span><span style="color:#ffc66d;">onDayOfMonthAndDataSelected</span>(<span style="color:#cc7832;">int </span>year<span style="color:#cc7832;">, int </span>month<span style="color:#cc7832;">, int </span>day<span style="color:#cc7832;">, </span>List obj) {
                <span style="color:#cc7832;">if </span>(obj==<span style="color:#cc7832;">null</span>){
                    <span style="color:#cc7832;">return;
</span><span style="color:#cc7832;">                </span>}
                String priceDate = String.<span style="font-style:italic;">format</span>(<span style="color:#6a8759;">"%s-%s-%s"</span><span style="color:#cc7832;">, </span>year<span style="color:#cc7832;">,
</span><span style="color:#cc7832;">                        </span>StringUtils.<span style="font-style:italic;">leftPad</span>(month + <span style="color:#6a8759;">""</span><span style="color:#cc7832;">, </span><span style="color:#6897bb;">2</span><span style="color:#cc7832;">, </span><span style="color:#6a8759;">"0"</span>)<span style="color:#cc7832;">, </span>StringUtils.<span style="font-style:italic;">leftPad</span>(String.<span style="font-style:italic;">valueOf</span>(day)<span style="color:#cc7832;">, </span><span style="color:#6897bb;">2</span><span style="color:#cc7832;">, </span><span style="color:#6a8759;">"0"</span>))<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                for </span>(<span style="color:#cc7832;">int </span>i = <span style="color:#6897bb;">0</span><span style="color:#cc7832;">; </span>i &lt; obj.size()<span style="color:#cc7832;">; </span>i++) {
                    ProductDatePrice datePrice = (ProductDatePrice) obj.get(i)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                    if </span>(datePrice==<span style="color:#cc7832;">null</span>){
                        <span style="color:#cc7832;">continue;
</span><span style="color:#cc7832;">                    </span>}
                    <span style="color:#cc7832;">if </span>(TextUtils.<span style="font-style:italic;">equals</span>(datePrice.getPriceDate()<span style="color:#cc7832;">,</span>priceDate)){
                        Toast.<span style="font-style:italic;">makeText</span>(MoreInfoCalendarActivity.<span style="color:#cc7832;">this, </span>datePrice.toString()<span style="color:#cc7832;">, </span>Toast.<span style="color:#9876aa;"><em>LENGTH_SHORT</em></span>).show()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                    </span>}
                }
            }

            <span style="color:#bbb529;">@Override
</span><span style="color:#bbb529;">            </span><span style="color:#cc7832;">public void </span><span style="color:#ffc66d;">showOtherFields</span>(Object obj<span style="color:#cc7832;">, </span>View view<span style="color:#cc7832;">, int </span>gridItemYear<span style="color:#cc7832;">, int </span>gridItemMonth<span style="color:#cc7832;">, int </span>gridItemDay) {
                <span style="color:#808080;">//当你设置了数据源之后，界面渲染会循环调用showOtherFields方法，在该方法中实现同一日期设置界面显示效果。
</span><span style="color:#808080;">//                ProductDatePrice productDatePrice  = (ProductDatePrice) obj;
</span><span style="color:#808080;">//                if (TextUtils.equals(productDatePrice.getPriceDate(), String.format("%s-%s-%s", gridItemYear,
</span><span style="color:#808080;">//                        StringUtils.leftPad(gridItemMonth + "", 2, "0"), StringUtils.leftPad(String.valueOf(gridItemDay), 2, "0")))) {
</span><span style="color:#808080;">                    </span>CommonCalendarView.GridViewHolder viewHolder = (CommonCalendarView.GridViewHolder) view.getTag()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                    if</span>(gridItemYear == <span style="color:#6897bb;">2018 </span>&amp;&amp; gridItemMonth == <span style="color:#6897bb;">5 </span>&amp;&amp; gridItemDay == <span style="color:#6897bb;">8</span>){
                        viewHolder.<span style="color:#9876aa;">mPriceTv</span>.setText(<span style="color:#6a8759;">"填写显示"</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                    </span>}
<span style="color:#808080;">//                    viewHolder.mPriceTv.setText(String.format("¥ %s", productDatePrice.getPrice()));
</span><span style="color:#808080;">                    </span>view.setEnabled(<span style="color:#cc7832;">true</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                    </span>viewHolder.<span style="color:#9876aa;">mTextView</span>.setEnabled(<span style="color:#cc7832;">true</span>)<span style="color:#cc7832;">;
</span><span style="color:#808080;">//                }
</span><span style="color:#808080;">            </span>}

            <span style="color:#bbb529;">@Override
</span><span style="color:#bbb529;">            </span><span style="color:#cc7832;">public </span>Map&lt;String<span style="color:#cc7832;">, </span>List&gt; <span style="color:#ffc66d;">getDataSource</span>() {
                <span style="color:#cc7832;">return </span><span style="color:#9876aa;">mYearMonthMap</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            </span>}
        })<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">    </span>}
}</pre> 
<p>可以在日期里设置界面</p> 
<p>项目地址：https://download.csdn.net/download/qq_35711467/10400978</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ff9c1e1086a748cbf76e71aa88b50b10/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">leetcode 155：最小栈</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/859313a30d50ef004f3152f44efa25ae/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">android studio混淆打包之transformClassesAndResourcesWithProguardForRelease 错误</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>