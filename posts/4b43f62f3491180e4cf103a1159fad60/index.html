<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>python处理保存富文本内容到数据库中报语法错误的问题 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="python处理保存富文本内容到数据库中报语法错误的问题" />
<meta property="og:description" content="当我们使用mysql执行保存富文本数据到mysql中时，由于富文本内容中，包含单引号、双引号以及其他字符，从而导致保存时，mysql报语法错误。
譬如：
remark = &#34;\&#34;&lt;p&gt;oct图片进行amd四分类算法&lt;/p&gt;\\n&lt;pre class=\\\&#34;language-python\\\&#34;&gt;&lt;code&gt;# 调用算法获取单张图片预测结果\\ndef predict_one_image(img_path):\\n\\turl = \\\&#34;http://106.52.171.21:8325/api/oct_4_amd\\\&#34;\\n\\tfiles = {&#39;file&#39;: open(img_path, &#39;rb&#39;)}\\n\\ttry:\\n\\t\\tresult = requests.post(url, files=files).json() # {&#39;code&#39;: &#39;0&#39;, &#39;data&#39;: &#39;GA&#39;, &#39;msg&#39;: &#39;succeed&#39;}\\n\\texcept Exception:\\n\\t\\traise Exception&lt;/code&gt;&lt;/pre&gt;\&#34;&#34; 当我们执行sql语句譬如：
UPDATE runoob_tbl SET runoob_remark=xxx WHERE runoob_id=3 由于xxx这里单双引号等，就会触发sql语法错误。
解决思路：我们把富文本内容进行转码：
# 编码 def encode(s): return &#39; &#39;.join([bin(ord(c)).replace(&#39;0b&#39;, &#39;&#39;) for c in s]) # 解码 def decode(s): return &#39;&#39;.join([chr(i) for i in [int(b, 2) for b in s.split(&#39; &#39;)]]) 当我们使用
res = encode(remark)
来编码上面富文本内容时：
会得到如下的二进制字符串：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/4b43f62f3491180e4cf103a1159fad60/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-11-23T17:05:37+08:00" />
<meta property="article:modified_time" content="2022-11-23T17:05:37+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">python处理保存富文本内容到数据库中报语法错误的问题</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night-eighties">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>当我们使用mysql执行保存富文本数据到mysql中时，由于富文本内容中，包含单引号、双引号以及其他字符，从而导致保存时，mysql报语法错误。</p> 
<p>譬如：</p> 
<pre><code class="prism language-python">remark <span class="token operator">=</span> <span class="token string">"\"&lt;p&gt;oct图片进行amd四分类算法&lt;/p&gt;\\n&lt;pre class=\\\"language-python\\\"&gt;&lt;code&gt;# 调用算法获取单张图片预测结果\\ndef predict_one_image(img_path):\\n\\turl = \\\"http://106.52.171.21:8325/api/oct_4_amd\\\"\\n\\tfiles = {'file': open(img_path, 'rb')}\\n\\ttry:\\n\\t\\tresult = requests.post(url, files=files).json()  # {'code': '0', 'data': 'GA', 'msg': 'succeed'}\\n\\texcept Exception:\\n\\t\\traise Exception&lt;/code&gt;&lt;/pre&gt;\""</span>
</code></pre> 
<p>当我们执行sql语句譬如：</p> 
<pre><code class="prism language-sql"><span class="token keyword">UPDATE</span> runoob_tbl <span class="token keyword">SET</span> runoob_remark<span class="token operator">=</span>xxx <span class="token keyword">WHERE</span> runoob_id<span class="token operator">=</span><span class="token number">3</span>
</code></pre> 
<p>由于xxx这里单双引号等，就会触发sql语法错误。</p> 
<p>解决思路：我们把富文本内容进行转码：</p> 
<pre><code class="prism language-python"><span class="token comment"># 编码</span>
<span class="token keyword">def</span> <span class="token function">encode</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
 <span class="token keyword">return</span> <span class="token string">' '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">bin</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'0b'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> s<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 解码</span>
<span class="token keyword">def</span> <span class="token function">decode</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
 <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">chr</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">for</span> b <span class="token keyword">in</span> s<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

</code></pre> 
<p>当我们使用<br> res = encode(remark)<br> 来编码上面富文本内容时：<br> 会得到如下的二进制字符串：</p> 
<pre><code>100010 111100 1110000 111110 1101111 1100011 1110100 101011011111110 111001001000111 1000111111011011 1000100001001100 1100001 1101101 1100100 101011011011011 101001000000110 111110001111011 111101110010111 110110011010101 111100 101111 1110000 ......

</code></pre> 
<p>这个时候，再执行sql语句，就不会报错了。</p> 
<p>当我们需要转码的时候，只需要使用<code>decode</code>函数，执行一下，就会转码回来。</p> 
<p>参考文章：https://www.zhangshengrong.com/p/wradZeRkXB/</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d6f4c49f6f643f17507e1bd4e76f2400/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">(BV11b)基于标准LWE假设的加密方案初学</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6915efa30718601ce0c403e3b59c710c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Power Pivot入门（Excel2021专业加强版）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>