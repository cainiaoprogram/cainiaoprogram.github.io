<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>数通基础-二层交换原理 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="数通基础-二层交换原理" />
<meta property="og:description" content="MAC地址 MAC地址有48bit，通常被表示为十六进制格式。
MAC地址分为单播、组播及广播MAC地址三类。
单播MAC地址全球唯一，由 IEEE对这些地址进行管理和分配。
每个单播MAC地址由两部分组成，其中前24bit代表OUI（组织唯一标识），剩下的24位由厂商自己分配。
以太网二层交换机 主要功能 使得终端用户能够接入网络；
维护MAC地址表；
数据帧的转发及过滤；
二层环路避免及链路冗余性。
交换机转发数据帧
收到单播数据帧（mac地址表存在记录），根据mac地址表指定接口转发。收到单播数据帧（mac地址表不存在记录），复制数据帧，在除收到数据帧以外的接口进行泛洪。收到广播数据帧，在除收到数据帧以外的接口进行泛洪。 工作原理 PC1、PC2连接在同一台二层交换机上。
以太网中基于MAC地址通信。
初始情况下，交换机的MAC地址表是空的。
PC1发送数据帧给PC2（假设PC1已经知道了PC2的MAC地址）。
交换机在GE0/0/1口接收帧后，在MAC地址表中查询该帧的目的MAC地址。
MAC地址表中没有任何表项匹配该目的MAC地址，于是交换机将这个数据帧进行泛洪（将数据帧的拷贝从所有接口发送出去，除了接收该帧的接口）。
同时，交换机学习该帧的源MAC地址并创建MAC地址表项，将该MAC地址与接收该帧的GE0/0/1接口进行关联。
连接在交换机其他接口的PC都会收到这个数据帧，但是它们会丢弃该数据帧，因为这并不是发送给它们的，PC2接收并处理这个帧。
现在PC2向PC1回复数据，数据帧发往交换机。
交换机收到数据帧后，首先在MAC地址表中查询该帧的目的MAC地址，发现有一个匹配的表项，于是将数据帧从GE0/0/1接口转发出去。
VLAN VLAN（Virtual Local Area Network）即虚拟局域网，是将一个物理的LAN在逻辑上划分成多个广播域的通信技术。VLAN内的主机间可以直接通信，而VLAN间不能直接互通，从而将广播报文限制在一个VLAN内。
不同的VLAN是不同的广播域，通常使用不同的IP网段。
可根据业务需求灵活的进行VLAN的规划。
不同的VLAN之间无法进行二层互访。
VLAN知识点小结 一个VLAN中所有设备都是在同一广播域内，不同的VLAN为不同的广播域。
VLAN之间互相隔离，广播不能跨越VLAN传播，因此不同VLAN之间的设备一般无法直接互访（二层互访），不同VLAN间需通过三层设备实现相互通信。
一个VLAN一般为一个逻辑子网。
VLAN中成员多基于交换机的端口分配，所谓的VLAN划分，通常指的是将交换机的接口添加到特定的VLAN中，从而该接口所连接的设备也即加入到了该VLAN。
VLAN是二层交换机的一个非常基本的工作机制。
交换机接口类型（Link-type） Access Access接口只能加入一个VLAN，该VLAN又被称为Access接口的缺省VLAN。
Access接口只发送无标记帧，且只接收无标记帧或打了缺省VLAN Tag的标记帧。
Access接口常用于连接PC、服务器或其他终端，或路由器等设备。
Access接口只能加入一个VLAN，该种类型的接口通常用于连接PC、服务器及路由器等设备。
Trunk 当一条链路需要承载多VLAN数据的时候，可将该链路配置为Trunk链路。
Trunk链路两端的接口是Trunk类型的接口。两端交换机需采用相同的干道协议。
Trunk链路一般见于交换机之间或交换机与路由器之间。
Trunk接口可以加入多个VLAN，可以收发多个VLAN的报文。一般用于交换机之间的互联接口，也用于交换机与以太网子接口对接。
Hybrid Hybrid接口也可以收发多个VLAN的报文，而且可以指定该接口在发送特定VLAN的报文时是否携带Tag。
802.1q IEEE 802.1q以及VLAN Tagging属于互联网下IEEE 802.1的标准规范，允许多个网桥(Bridge)在信息不被外泄的情况下公开的共享同一个实体网上。IEEE 802.1q-英文缩写写为dot1q，经常在实现以太网封装协议的架构下被提及。以下是打上VLAN Tag的数据帧
端口的缺省ID（PVID） 每个Access、Trunk及Hybrid的接口都有一个接口缺省VLAN-ID，称为PVID（Port Default VLAN ID），当接口接收到无标记帧时，为数据帧打上PVID。
对于Access类型的接口，PVID缺省为1，由于Access接口只能加入一个VLAN，因此PVID也即该接口所属的VLAN。
对于Trunk及Hybrid类型端口，PVID缺省也为1，这两种接口都允许多个VLAN数据帧通过，当接口收到无标记帧时，为数据帧打上PVID。
原始的以太网数据帧（或无标记帧、Untagged帧）：指的是采用以太网封装的数据帧，例如普通PC或服务器网卡收发的数据帧。
802.1Q数据帧（或标记帧、携带VLAN Tag的数据帧、Tagged帧）：指的是插入了802." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/7c13ec80747ef3bbbb79d80ffb83a171/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-12-10T22:22:39+08:00" />
<meta property="article:modified_time" content="2020-12-10T22:22:39+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">数通基础-二层交换原理</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="MAC_1"></a>MAC地址</h2> 
<p><img src="https://images2.imgbox.com/3c/1a/06bNefN4_o.png" alt="在这里插入图片描述"></p> 
<ol><li> <p>MAC地址有48bit，通常被表示为十六进制格式。</p> </li><li> <p>MAC地址分为单播、组播及广播MAC地址三类。</p> </li><li> <p>单播MAC地址全球唯一，由 IEEE对这些地址进行管理和分配。</p> </li><li> <p>每个单播MAC地址由两部分组成，其中前24bit代表OUI（组织唯一标识），剩下的24位由厂商自己分配。</p> </li></ol> 
<h2><a id="_14"></a>以太网二层交换机</h2> 
<h3><a id="_16"></a>主要功能</h3> 
<ul><li> <p>使得终端用户能够接入网络；</p> </li><li> <p>维护MAC地址表；</p> </li><li> <p>数据帧的转发及过滤；</p> </li><li> <p>二层环路避免及链路冗余性。</p> </li></ul> 
<p><strong>交换机转发数据帧</strong></p> 
<ul><li>收到单播数据帧（mac地址表存在记录），根据mac地址表指定接口转发。</li><li>收到单播数据帧（mac地址表不存在记录），复制数据帧，在除收到数据帧以外的接口进行泛洪。</li><li>收到广播数据帧，在除收到数据帧以外的接口进行泛洪。</li></ul> 
<h3><a id="_31"></a>工作原理</h3> 
<ul><li> <p>PC1、PC2连接在同一台二层交换机上。</p> </li><li> <p>以太网中基于MAC地址通信。</p> </li><li> <p>初始情况下，交换机的MAC地址表是空的。</p> </li></ul> 
<ol><li> <p>PC1发送数据帧给PC2（假设PC1已经知道了PC2的MAC地址）。</p> </li><li> <p>交换机在GE0/0/1口接收帧后，在MAC地址表中查询该帧的目的MAC地址。</p> </li><li> <p>MAC地址表中没有任何表项匹配该目的MAC地址，于是交换机将这个数据帧进行泛洪（将数据帧的拷贝从所有接口发送出去，除了接收该帧的接口）。<br> 同时，交换机学习该帧的源MAC地址并创建MAC地址表项，将该MAC地址与接收该帧的GE0/0/1接口进行关联。</p> </li><li> <p>连接在交换机其他接口的PC都会收到这个数据帧，但是它们会丢弃该数据帧，因为这并不是发送给它们的，PC2接收并处理这个帧。<br> 现在PC2向PC1回复数据，数据帧发往交换机。</p> </li><li> <p>交换机收到数据帧后，首先在MAC地址表中查询该帧的目的MAC地址，发现有一个匹配的表项，于是将数据帧从GE0/0/1接口转发出去。</p> </li></ol> 
<p><img src="https://images2.imgbox.com/44/7d/p6rmPxPI_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="VLAN_52"></a>VLAN</h2> 
<p>VLAN（Virtual Local Area Network）即虚拟局域网，是将一个物理的LAN在逻辑上划分成多个广播域的通信技术。VLAN内的主机间可以直接通信，而VLAN间不能直接互通，从而将广播报文限制在一个VLAN内。</p> 
<p><img src="https://images2.imgbox.com/99/a7/6UbkpwAd_o.png" alt="在这里插入图片描述"></p> 
<ul><li> <p>不同的VLAN是不同的广播域，通常使用不同的IP网段。</p> </li><li> <p>可根据业务需求灵活的进行VLAN的规划。</p> </li><li> <p>不同的VLAN之间无法进行二层互访。</p> </li></ul> 
<h3><a id="VLAN_65"></a>VLAN知识点小结</h3> 
<ol><li> <p>一个VLAN中所有设备都是在同一广播域内，不同的VLAN为不同的广播域。</p> </li><li> <p>VLAN之间互相隔离，广播不能跨越VLAN传播，因此不同VLAN之间的设备一般无法直接互访（二层互访），不同VLAN间需通过三层设备实现相互通信。</p> </li><li> <p>一个VLAN一般为一个逻辑子网。</p> </li><li> <p>VLAN中成员多基于交换机的端口分配，所谓的VLAN划分，通常指的是将交换机的接口添加到特定的VLAN中，从而该接口所连接的设备也即加入到了该VLAN。</p> </li><li> <p>VLAN是二层交换机的一个非常基本的工作机制。</p> </li></ol> 
<h3><a id="Linktype_77"></a>交换机接口类型（Link-type）</h3> 
<h4><a id="Access_79"></a>Access</h4> 
<ul><li> <p>Access接口只能加入一个VLAN，该VLAN又被称为Access接口的缺省VLAN。</p> </li><li> <p>Access接口只发送无标记帧，且只接收无标记帧或打了缺省VLAN Tag的标记帧。</p> </li><li> <p>Access接口常用于连接PC、服务器或其他终端，或路由器等设备。</p> </li></ul> 
<p><img src="https://images2.imgbox.com/d6/a8/STK4qWMi_o.png" alt="在这里插入图片描述"></p> 
<p>Access接口只能加入一个VLAN，该种类型的接口通常用于连接PC、服务器及路由器等设备。</p> 
<h4><a id="Trunk_94"></a>Trunk</h4> 
<ul><li> <p>当一条链路需要承载多VLAN数据的时候，可将该链路配置为Trunk链路。</p> </li><li> <p>Trunk链路两端的接口是Trunk类型的接口。两端交换机需采用相同的干道协议。</p> </li><li> <p>Trunk链路一般见于交换机之间或交换机与路由器之间。</p> </li></ul> 
<p><img src="https://images2.imgbox.com/07/06/pDrFQOnr_o.png" alt="在这里插入图片描述"></p> 
<p>Trunk接口可以加入多个VLAN，可以收发多个VLAN的报文。一般用于交换机之间的互联接口，也用于交换机与以太网子接口对接。</p> 
<h4><a id="Hybrid_107"></a>Hybrid</h4> 
<p>Hybrid接口也可以收发多个VLAN的报文，而且可以指定该接口在发送特定VLAN的报文时是否携带Tag。</p> 
<h3><a id="8021q_113"></a>802.1q</h3> 
<p><strong>IEEE 802.1q</strong>以及<strong>VLAN Tagging</strong>属于互联网下IEEE 802.1的标准规范，允许多个网桥(Bridge)在信息不被外泄的情况下公开的共享同一个实体网上。IEEE 802.1q-英文缩写写为dot1q，经常在实现以太网封装协议的架构下被提及。以下是打上VLAN Tag的数据帧</p> 
<p><img src="https://images2.imgbox.com/12/87/JLgTpbad_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="IDPVID_120"></a>端口的缺省ID（PVID）</h3> 
<ul><li> <p>每个Access、Trunk及Hybrid的接口都有一个接口缺省VLAN-ID，称为PVID（Port Default VLAN ID），当接口接收到无标记帧时，为数据帧打上PVID。</p> </li><li> <p>对于Access类型的接口，PVID缺省为1，由于Access接口只能加入一个VLAN，因此PVID也即该接口所属的VLAN。</p> </li><li> <p>对于Trunk及Hybrid类型端口，PVID缺省也为1，这两种接口都允许多个VLAN数据帧通过，当接口收到无标记帧时，为数据帧打上PVID。</p> </li><li> <p><em><strong>原始的以太网数据帧（或无标记帧、Untagged帧）：指的是采用以太网封装的数据帧，例如普通PC或服务器网卡收发的数据帧。</strong></em></p> </li><li> <p><em><strong>802.1Q数据帧（或标记帧、携带VLAN Tag的数据帧、Tagged帧）：指的是插入了802.1Q头部的以太网数据帧。</strong></em></p> </li></ul> 
<ol><li> <p>交换机的接口“接收帧”：</p> <p>指的是数据帧从外部到达交换机的接口，并进入到交换机内部的过程。</p> </li><li> <p>交换机的接口“发送帧”：</p> <p>指的是数据帧被交换机从其内部往接口外发送的过程。</p> </li></ol> 
<h4><a id="Access_146"></a>Access接口</h4> 
<p><strong>Access接口接收帧</strong>：</p> 
<ul><li>如果该帧不带tag，则接收帧并打上端口的PVID；</li><li>•如果该帧携带tag，则当VLAN-ID与PVID相同时，接收该报文，否则丢弃。</li></ul> 
<p><img src="https://images2.imgbox.com/be/42/bORwp30Y_o.png" alt="在这里插入图片描述"></p> 
<p><strong>Access接口发送帧：</strong></p> 
<ul><li>剥离Tag，发出的帧为普通以太网帧（也即无标记帧）。</li></ul> 
<p><img src="https://images2.imgbox.com/5b/82/0xhO8DLg_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="Trunk_163"></a><strong>Trunk接口</strong></h4> 
<p><strong>Trunk接口接收帧：</strong></p> 
<ul><li>若数据帧不带tag，则打上接口PVID，此时若PVID在允许通过的VLAN列表里，则接收该帧，否则丢弃。缺省时Trunk端口的PVID为1，而且VLAN1缺省就已经在allow-pass VLAN列表中。</li><li>若数据帧带tag，且其VLAN-ID在接口允许通过的VLAN-ID列表里，则接收该帧，否则丢弃。</li></ul> 
<p><img src="https://images2.imgbox.com/37/46/vVDpJ1HO_o.png" alt="在这里插入图片描述"></p> 
<p><strong>Trunk接口发送帧：</strong></p> 
<ul><li> <p>若VLAN-ID与接口PVID<strong>相同</strong>，且该VLAN-ID在allow-pass VLAN列表中，则<strong>去掉</strong>Tag，发送数据帧。</p> </li><li> <p>若VLAN-ID与接口PVID<strong>不同</strong>，且该VLAN-ID在allow-pass VLAN列表中，则<strong>保持原有</strong>Tag，发送该带tag的数据帧（标记帧）。</p> </li></ul> 
<p><img src="https://images2.imgbox.com/16/21/HQ6AJKEX_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="Hybrid_184"></a>Hybrid接口</h4> 
<p><strong>Hybrid接口接收帧：</strong></p> 
<ul><li>若数据帧不带tag，打上接口PVID，若PVID在允许通过的VLAN列表里，则接收该帧，否则丢弃。</li><li>若数据帧带tag，且VLAN-ID在接口允许通过的VLAN列表里，则接收该报文。否则丢弃该报文。</li></ul> 
<p><img src="https://images2.imgbox.com/46/63/NGSjbebw_o.png" alt="在这里插入图片描述"></p> 
<p><strong>Hybrid接口发送帧：</strong></p> 
<ul><li>若VLAN-ID在接口允许通过的VLAN列表里，则发送该帧。可以通过命令设置发送时是否携带Tag。</li></ul> 
<p><img src="https://images2.imgbox.com/bd/c1/7FecY3xa_o.png" alt="在这里插入图片描述"></p> 
<p>以下图表也可直观看出</p> 
<p><img src="https://images2.imgbox.com/d7/7a/rXUdTjue_o.jpg" alt="在这里插入图片描述"></p> 
<h3><a id="VLAN_208"></a>VLAN基本配置</h3> 
<p><img src="https://images2.imgbox.com/74/fd/BQ7DD2gF_o.png" alt="在这里插入图片描述"></p> 
<p>•在两台交换机上创建VLAN10及20。</p> 
<p>•将连接PC的接口划入如图所示的VLAN。</p> 
<p>•配置SW1-SW2之间的链路为trunk，使得相同VLAN内的用户能够跨交换机实现通信。</p> 
<pre><code># 创建VLAN10及VLAN20：
[SW1] vlan batch 10 20
# 将GE0/0/1配置为access类型，并加入VLAN10：
[SW1]interface GigabitEthernet 0/0/1
[SW1-GigabitEthernet0/0/1] port link-type access
[SW1-GigabitEthernet0/0/2] port default vlan 10
# 将GE0/0/2配置为access类型，并加入VLAN20：
[SW1]interface GigabitEthernet 0/0/2
[SW1-GigabitEthernet0/0/2] port link-type access
[SW1-GigabitEthernet0/0/2]port default vlan 20

# 创建VLAN10及VLAN20：
[SW2]vlan batch 10 20
# 将GE0/0/1配置为access类型，并加入VLAN10：
[SW2]interface GigabitEthernet 0/0/1
[SW2-GigabitEthernet0/0/1] port link-type access
[SW2-GigabitEthernet0/0/1] port default vlan 10
# 将GE0/0/2配置为access类型，并加入VLAN20：
[SW1]interface GigabitEthernet 0/0/2
[SW2-GigabitEthernet0/0/2] port link-type access
[SW2-GigabitEthernet0/0/2] port default vlan 20
</code></pre> 
<p>配置Trunk链路，允许vlan10和vlan20流量通过</p> 
<pre><code>[SW1]interface GigabitEthernet 0/0/24
[SW1-GigabitEthernet0/0/24]port link-type trunk
[SW1-GigabitEthernet0/0/24]port trunk allow-pass vlan 10 20
[SW2]interface GigabitEthernet 0/0/24
[SW2-GigabitEthernet0/0/24]port link-type trunk
[SW2-GigabitEthernet0/0/24]port trunk allow-pass vlan 10 20
</code></pre> 
<p>相同vlan间可通信，不同vlan不可通信</p> 
<p><img src="https://images2.imgbox.com/02/e7/wzEAc3Qs_o.png" alt="在这里插入图片描述"></p> 
<p>查看vlan信息</p> 
<p><img src="https://images2.imgbox.com/c0/77/UTwVhKQ4_o.png" alt="在这里插入图片描述"></p> 
<p>完成上述配置后，同属VLAN10的PC1及PC3即可相互通信；同属VLAN20的PC2及PC4亦可相互通信，我们将这种通信行为成为“二层通信”。然而不同VLAN的用户无法进行直接通信。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1f7ee14ab16e8c8164755f0735e58932/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">excel中如何运用新建格式规则比较两个表格中的数值_Excel表格里面常用的5个技巧，越早知道越好！...</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fc9be6c0751161e15045a6063489e58a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">mysql 一次插入多条数据和一次一条数据效率对比</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>