<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>LinuxCrontab（定时任务） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="LinuxCrontab（定时任务）" />
<meta property="og:description" content="一、crontab定时任务 通过crontab 命令，我们可以在固定的间隔时间执行指定的系统指令或 shell script脚本。时间间隔的单位可以是分钟、小时、日、月、周及以上的任意组合。
Linux任务调度的工作主要分为以下两类： 1、系统执行的工作：系统周期性所要执行的工作，如备份系统数据、清理缓存、日志分析 2、个人执行的工作：某个用户定期要做的工作，例如每隔10分钟检查邮件服务器是否有新邮件，这些工作可由每个用户自行设置
文件介绍： 系统调度的任务一般存放在/etc/crontab 这个文件下，里面存放了一些系统运行的调度程序，通过命令我们可以看一下里面的内容：
cat /etc/crontab 这些任务都会是系统在运行起来后自动进行调度的。同时在/etc目录下还存放了/etc/cron.deny 和 /etc/cron.allow 文件
/etc/cron.deny 表示不能使用crontab 命令的用户
/etc/cron.allow 表示能使用crontab的用户。
如果两个文件同时存在，那么/etc/cron.allow 优先。
如果两个文件都不存在，那么只有root用户可以安排作业。
二、命令格式 crontab [-u user] file crontab [-u user] [ -e | -l | -r ] crontab [-e [UserName]|-l [UserName]|-r [UserName]|-v [UserName]|File ] 参数说明：
-u user：用来设定某个用户的crontab服务；
file：file是命令文件的名字,表示将file做为crontab的任务列表文件并载入crontab。如果在命令行中没有指定这个文件，crontab命令将接受标准输入（键盘）上键入的命令，并将它们载入crontab。
-e：编辑某个用户的crontab文件内容。如果不指定用户，则表示编辑当前用户的crontab文件。
-l：显示某个用户的crontab文件内容，如果不指定用户，则表示显示当前用户的crontab文件内容。
-r：从/var/spool/cron目录中删除某个用户的crontab文件，如果不指定用户，则默认删除当前用户的crontab文件。
-i：在删除用户的crontab文件时给确认提示。
三、crontab文件格式 如果要创建自己的一个任务调度，可以使用 crontab -e 这个命令，如：
crontab -e 此时会进入到vi编辑界面，来编写我们要调度的任务，crontab调度命令的格式如下：
* * * * * command path 前五个字段可以取整数值，指定何时开始工作，第六个域是字符串，即命令字段，其中包括了crontab调度执行的命令。 各个字段之间用spaces和tabs分割。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/d9611fe9181d6377fa8eacc4abcc37ab/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-01T10:23:28+08:00" />
<meta property="article:modified_time" content="2023-12-01T10:23:28+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">LinuxCrontab（定时任务）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3>一、crontab定时任务</h3> 
<p>通过crontab 命令，我们可以在固定的间隔时间执行指定的系统指令或 shell script脚本。时间间隔的单位可以是分钟、小时、日、月、周及以上的任意组合。</p> 
<p>Linux任务调度的工作主要分为以下两类： 1、系统执行的工作：系统周期性所要执行的工作，如备份系统数据、清理缓存、日志分析 2、个人执行的工作：某个用户定期要做的工作，例如每隔10分钟检查邮件服务器是否有新邮件，这些工作可由每个用户自行设置</p> 
<h4><strong>文件介绍：</strong></h4> 
<p>系统调度的任务一般存放在<strong>/etc/crontab</strong> 这个文件下，里面存放了一些系统运行的调度程序，通过命令我们可以看一下里面的内容：</p> 
<pre>cat /etc/crontab</pre> 
<p>这些任务都会是系统在运行起来后自动进行调度的。同时在/etc目录下还存放了/etc/cron.deny 和 /etc/cron.allow 文件</p> 
<p>/etc/cron.deny 表示不能使用crontab 命令的用户</p> 
<p>/etc/cron.allow 表示能使用crontab的用户。</p> 
<p>如果两个文件同时存在，那么/etc/cron.allow 优先。</p> 
<p>如果两个文件都不存在，那么只有root用户可以安排作业。</p> 
<h3>二、命令格式</h3> 
<pre>crontab [-u user] file crontab [-u user] [ -e | -l | -r ]
crontab [-e [UserName]|-l [UserName]|-r [UserName]|-v [UserName]|File ]</pre> 
<p>参数说明：</p> 
<ul><li> <p>-u user：用来设定某个用户的crontab服务；</p> </li><li> <p>file：file是命令文件的名字,表示将file做为crontab的任务列表文件并载入crontab。如果在命令行中没有指定这个文件，crontab命令将接受标准输入（键盘）上键入的命令，并将它们载入crontab。</p> </li><li> <p>-e：编辑某个用户的crontab文件内容。如果不指定用户，则表示编辑当前用户的crontab文件。</p> </li><li> <p>-l：显示某个用户的crontab文件内容，如果不指定用户，则表示显示当前用户的crontab文件内容。</p> </li><li> <p>-r：从/var/spool/cron目录中删除某个用户的crontab文件，如果不指定用户，则默认删除当前用户的crontab文件。</p> </li><li> <p>-i：在删除用户的crontab文件时给确认提示。</p> </li></ul> 
<h3>三、crontab文件格式</h3> 
<p><img alt="" height="610" src="https://images2.imgbox.com/65/9a/3rcUYpG9_o.png" width="746"></p> 
<p>如果要创建自己的一个任务调度，可以使用 crontab -e 这个命令，如：</p> 
<pre>crontab -e</pre> 
<p>此时会进入到vi编辑界面，来编写我们要调度的任务，crontab调度命令的格式如下：</p> 
<pre>* * * * * command path</pre> 
<p>前五个字段可以取整数值，指定何时开始工作，第六个域是字符串，即命令字段，其中包括了crontab调度执行的命令。 各个字段之间用spaces和tabs分割。</p> 
<p>调度命令的规则：</p> 
<table><thead><tr><th>字段名称</th><th>说明</th><th>取值范围</th></tr></thead><tbody><tr><td>分钟</td><td>每小时的第几分钟执行</td><td>0-59</td></tr><tr><td>小时</td><td>每日的第几个小时执行</td><td>0-23</td></tr><tr><td>日期</td><td>每月的第几天执行</td><td>1-31</td></tr><tr><td>月历</td><td>每年的第几月执行</td><td>1-12</td></tr><tr><td>星期</td><td>每周的第几天执行</td><td>0-6</td></tr><tr><td>命令名称</td><td>欲执行的命令及参数</td><td></td></tr></tbody></table> 
<p>常用特殊符号：</p> 
<table><thead><tr><th>符号</th><th>说明</th></tr></thead><tbody><tr><td>*</td><td>表示任何时刻</td></tr><tr><td>,</td><td>表示分割</td></tr><tr><td>－</td><td>表示一个段，如第二段里： 1-5，就表示1到5点</td></tr><tr><td>/n</td><td>表示每个n的单位执行一次，如第二段里，*/1, 就表示每隔1个小时执行一次命令。也可以写成1-23/1.</td></tr></tbody></table> 
<h3>四、创建crontab命令</h3> 
<p>① 实例一：如果我希望每隔一分钟，就将系统的时间写入到/home目录下的date1.txt文件里面，则输入下面的命令</p> 
<pre>crontab -e</pre> 
<p>在crontab命令编辑界面输入crontab命令：</p> 
<pre>* * * * * date &gt;&gt; /home/date1.txt</pre> 
<p>保存以后如果出现 crontab: installing new crontab 这句话，则表示该调度命令已经成功。</p> 
<p>我们可以到/home目录下看是否已经存在了该文本文件，并查看里面的信息：</p> 
<pre>cat date1.txt</pre> 
<p>此时我们发现，我们刚才编写的那个crontab命令已经正常在运行了，只要没有执行终止命令或者系统关机，这个命令就会一直执行下去</p> 
<p>② 实例二：如果我们需要同时完成两个命令，即每隔一分钟就将系统时间写入到/home目录下的date1.txt文件里面，同时再每隔一分钟将该date1.txt文件拷贝到根目录下（/）生成一个date2.txt的文件。这时我们通常该怎么做呢？方法有两种：</p> 
<p>a) 最简单最直接的方法(<strong>不推荐</strong>)：直接输入crontab -e 命令，在后面再追加一个命令即可，如：</p> 
<pre>[root@xiaoluo ~]# crontab -e
​
* * * * * date &gt;&gt; /home/date1.txt
* * * * * cp /home/date1.txt /date2.txt</pre> 
<p>最后我们退出保存即可，此时我们可以发现/目录下已经有了date2.txt这个文件了，打开后可以看到其内容和date1.txt一样。</p> 
<p>虽然这种方法比较简单，但是并不推荐这种，因为如果命令一多的话，并且如果我需要不同用户执行不同的命令时，这种方法在维护起来不方便，所以这里介绍另外一种方法。</p> 
<p>b) 首先编写一个可执行的sh文件，然后将我们要执行的任务写在sh文件里面，最后通过crontab来执行我们的sh文件即可(<strong>推荐</strong>)</p> 
<p>首先我们在/目录下编写一个task.sh的文件，里面的内容就是我们刚要执行的两条命令：</p> 
<pre>vi task.sh</pre> 
<p>task.sh里面的命令</p> 
<pre>date &gt;&gt; /home/date1.txt
cp /home/date1.txt /date3.txt</pre> 
<p>此时我们的task.sh还不是可执行文件，通过ls -l命令我们可以看到</p> 
<pre>-rw-r--r--.   1 root root    54 4月   6 16:27 task.sh　　//tash.sh是不可执行的，我们要修改其权限</pre> 
<p>所以我们需要通过chmod命令来修改task.sh的权限：</p> 
<pre>chmod 744 task.sh</pre> 
<p>此时再查看，就发现task.sh已经是可执行文件了：</p> 
<pre>-rwxr--r--.   1 root root    54 4月   6 16:27 task.sh</pre> 
<p>然后我们输入crontab -e 命令，将之前的两条命令删除掉，或者在前面加 # 号注释掉：</p> 
<pre>#* * * * * date &gt;&gt; /home/date1.txt
#* * * * * cp /home/date1.txt /date2.txt
​
* * * * * /task.sh</pre> 
<p>这时我们发现根目录下面已经存在了date3.txt文件了，打开就可以发现里面的内容为：</p> 
<pre>cat date3.txt</pre> 
<h3><strong>五、其他命令</strong></h3> 
<p>如果我们需要列出自己创建的任务调度都有哪些命令，可以使用 crontab -l 命令来查看</p> 
<pre>crontab -l</pre> 
<p>如果我们需要终止自己刚创建的任务调度，则使用 crontab -r 命令即可</p> 
<pre>crontab -r</pre> 
<p>此时我们可以发现，crontab里面的任务都已经没有了</p> 
<p></p> 
<h3>六、使用实例</h3> 
<h4>实例1</h4> 
<p>每1分钟执行一次myCommand</p> 
<pre>* * * * * myCommand</pre> 
<h4>实例2</h4> 
<p>每小时的第3和第15分钟执行</p> 
<pre>3,15 * * * * myCommand</pre> 
<h4>实例3</h4> 
<p>在上午8点到11点的第3和第15分钟执行</p> 
<pre>3,15 8-11 * * * myCommand</pre> 
<h4>实例4</h4> 
<p>每隔两天的上午8点到11点的第3和第15分钟执行</p> 
<pre>3,15 8-11 */2  *  * myCommand</pre> 
<h4>实例5</h4> 
<p>每周一上午8点到11点的第3和第15分钟执行</p> 
<pre>3,15 8-11 * * 1 myCommand</pre> 
<h4>实例6</h4> 
<p>每晚的21:30重启smb</p> 
<pre>30 21 * * * /etc/init.d/smb restart</pre> 
<h4>实例7</h4> 
<p>每月1、10、22日的4 : 45重启smb</p> 
<pre>45 4 1,10,22 * * /etc/init.d/smb restart</pre> 
<h4>实例8</h4> 
<p>每周六、周日的1 : 10重启smb</p> 
<pre>10 1 * * 6,0 /etc/init.d/smb restart</pre> 
<h4>实例9</h4> 
<p>每天18 : 00至23 : 00之间每隔30分钟重启smb</p> 
<pre>0,30 18-23 * * * /etc/init.d/smb restart</pre> 
<h4>实例10</h4> 
<p>每星期六的晚上11 : 00 pm重启smb</p> 
<pre>0 23 * * 6 /etc/init.d/smb restart</pre> 
<h4>实例11</h4> 
<p>每一小时重启smb</p> 
<pre>* */1 * * * /etc/init.d/smb restart</pre> 
<h4>实例12</h4> 
<p>晚上11点到早上7点之间，每隔一小时重启smb</p> 
<pre>0 23-7 * * * /etc/init.d/smb restart</pre> 
<h4>实例13</h4> 
<p>定时备份MySQL数据库</p> 
<pre>vi /usr/local/bin/mysql-local-backup.sh</pre> 
<p><code>test</code>为要备份的数据库，<code>test-"$DATE".sql</code>为保存的备份文件</p> 
<ol><li> <p>脚本内容</p> </li></ol> 
<pre>DATE=$(date +%Y%m%d%H%M%S)
mysqldump -uroot -p数据库密码 test &gt; /var/lib/mysql/backup/test-"$DATE".sql;</pre> 
<ol><li> <p>修改脚本权限</p> </li></ol> 
<pre>chmod +x /usr/local/bin/mysql-local-backup.sh</pre> 
<ol><li> <p>添加/编辑命令</p> </li></ol> 
<pre>crontab -e</pre> 
<ol><li> <p>比如每天凌晨3点备份数据库，添加如下内容，按<code>:wq</code>保存</p> </li></ol> 
<pre>0 3 * * * /usr/local/bin/mysql-local-backup.sh</pre> 
<ol><li> <p>查看运行中的定时任务</p> </li></ol> 
<pre>crontab -l</pre> 
<ol><li> <p>注意</p> </li></ol> 
<p>在第1步脚本内容中，mysqldump很有可能路径错误，所以最好改为全局路径：</p> 
<p><strong>/usr/local/mysql/bin/mysqldump</strong></p> 
<p></p> 
<p>其他：</p> 
<p>下面给出一些crontab命令的实例：</p> 
<pre>00 8,12,16 * * * /data/app/scripts/monitor/df.sh
​
30 2 * * * /data/app/scripts/hotbackup/hot_database_backup.sh
​
10 8,12,16 * * * /data/app/scripts/monitor/check_ind_unusable.sh
​
10 8,12,16 * * * /data/app/scripts/monitor/check_maxfilesize.sh
​
10 8,12,16 * * * /data/app/scripts/monitor/check_objectsize.sh
​
 
​
43 21 * * *  每天的21:43 执行
​
15 05 * * * 　　 每天的05:15 执行
​
0 17 * * * 每天的17:00 执行
​
0 17 * * 1 每周一的 17:00 执行
​
0,10 17 * * 0,2,3 每周日,周二,周三的 17:00和 17:10 执行
​
0-10 17 1 * * 毎月1日从 17:00到7:10 毎隔1分钟 执行
​
0 0 1,15 * 1 毎月1日和 15日和 一日的 0:00 执行
​
42 4 1 * * 　 　 毎月1日的 4:42分 执行
​
0 21 * * 1-6　　 周一到周六 21:00 执行
​
0,10,20,30,40,50 * * * *　每隔10分 执行
​
*/10 * * * * 　　　　　　 每隔10分 执行
​
* 1 * * *　　　　　　　　 从1:0到1:59 每隔1分钟 执行
​
0 1 * * *　　　　　　　　 1:00 执行
​
0 */1 * * *　　　　　　　 毎时0分 每隔1小时 执行
​
0 * * * *　　　　　　　　 毎时0分 每隔1小时 执行
​
2 8-20/3 * * *　　　　　　8:02,11:02,14:02,17:02,20:02 执行
​
30 5 1,15 * *　　　　　　 1日 和 15日的 5:30 执行</pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/711a1d67890dce62c3a91de772c15ec3/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Linux（Shell命令脚本）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9c2ae13bc02d4c41e7247ae40a25f49c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Linux初始化脚本</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>