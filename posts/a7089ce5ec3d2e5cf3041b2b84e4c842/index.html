<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>HCIA——第六天 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="HCIA——第六天" />
<meta property="og:description" content="选取路由协议考虑到的几点要求：
1.占用资源少
2.收敛速度快
3.选路是否合理
RIP
1.以跳数作为开销值进行选路，本身存在不合理性
2.由于RIP本身计时器时间较长，收敛速度慢
3.RIP单个数据包占用资源并不算大，但是，因为RIP存在30s一次的周期更新，所以，整体看来，RIP的资源占用很大。
由于RIP三个维度的表现都不算太好，所以，只适用于中小型网络环境中
OSPF — 开放式最短路径优先协议 — 链路状态型
传递的是LSA — 链路状态信息
1.OSPF因为是链路状态型协议，所以计算出的路径不会出现环路，并且，OSPF以带宽作为开销值进行选路，相较于跳数更加合理。所以，从选路的角度看，OSPF由于RIP。
2.由于OSPF的计时器时间短于RIP的计时器，所以从收敛角度比较，OSPF优于RIP。
3.从单个数据包携带的数据来看，因为OSPF携带的是拓扑信息（LSA），所以数据量较RIP大很多，但是由于RIP存在30s一次的周期更新，并且OSPF本身存在很多减少更新量的措施，所以。从整体的角度看，OSPF小优于RIP。
OSPF版本：
OSPFV1（在实验室阶段夭折）、OSPFV2 — IPV4
OSPFV3 — IPV6
RIPV2和OSPFV2区别
相同点：
1.OSPFV2和RIPV2都是无类别的路由协议，都支持VLSM、CIDR
2.OSPFV2和RIPV2都以组播的形式发送信息 — RIP组播地址（224.0.0.9）、 OSPF组播地址（224.0.0.5和224.0.0.6）
3.OSPFV2和RIPV2都支持等开销负载均衡
不同点：
RIP只能适用于中小型网络，OSPF可以应用在大型网络当中（OSPF为了适应中大型网络环境，需要进行结构化部署 — 区域划分 — 减少更新量的手段之一）
如果只有一个区域的OSPF网络，我们将这样的网络称为单区域OSPF网络
如果只有一个区域的OSPF网络，我们将这样的网络称为多区域OSPF网络
区域划分的主要目的：
区域内部传递拓扑信息，区域之间传递路由信息。区域边界路由器 — ABR — 同时属于两个区域，并且一个接口对应一个区域。 区域划分的要求：
区域之间必须存在ABR区域划分必须按照星型拓扑结构划分星型拓扑中间区域叫做骨干区域 OSPF区域存在区域编号 — 区域ID —由32为二进制构成，用点分十进制进行表达。骨干区域的ID为0。 OSPF的数据包
hello包 — 可以用来周期发现，建立和保活邻居关系
周期：OSPF的hello包默认10s为周期进行周期发送
死亡时间（dead time）— 4倍的hello时间
RID — 用来标定和区分OSPF网络中不同的路由器
RID的要求：
全网（OSPF网络）唯一格式统一 — RID要求必须符合IP地址（由32位二进制构成，并且使用点分十进制进行表达） RID的获取方式：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/a7089ce5ec3d2e5cf3041b2b84e4c842/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-09-13T15:37:55+08:00" />
<meta property="article:modified_time" content="2021-09-13T15:37:55+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">HCIA——第六天</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><strong>选取路由协议考虑到的几点要求</strong>：<br> 1.占用资源少<br> 2.收敛速度快<br> 3.选路是否合理</p> 
<p><strong>RIP</strong><br> 1.以跳数作为开销值进行选路，本身存在不合理性<br> 2.由于RIP本身计时器时间较长，收敛速度慢<br> 3.RIP单个数据包占用资源并不算大，但是，因为RIP存在30s一次的周期更新，所以，整体看来，RIP的资源占用很大。<br> 由于RIP三个维度的表现都不算太好，所以，只适用于中小型网络环境中</p> 
<p><strong>OSPF — 开放式最短路径优先协议 — 链路状态型</strong><br> 传递的是LSA — 链路状态信息<br> 1.OSPF因为是链路状态型协议，所以计算出的路径不会出现环路，并且，OSPF以带宽作为开销值进行选路，相较于跳数更加合理。所以，从选路的角度看，OSPF由于RIP。</p> 
<p>2.由于OSPF的计时器时间短于RIP的计时器，所以从收敛角度比较，OSPF优于RIP。</p> 
<p>3.从单个数据包携带的数据来看，因为OSPF携带的是拓扑信息（LSA），所以数据量较RIP大很多，但是由于RIP存在30s一次的周期更新，并且OSPF本身存在很多减少更新量的措施，所以。从整体的角度看，OSPF小优于RIP。</p> 
<p><strong>OSPF版本</strong>：<br> OSPFV1（在实验室阶段夭折）、OSPFV2 — IPV4<br> OSPFV3 — IPV6</p> 
<p><strong>RIPV2和OSPFV2区别</strong><br> <strong>相同点</strong>：<br> 1.OSPFV2和RIPV2都是无类别的路由协议，都支持VLSM、CIDR<br> 2.OSPFV2和RIPV2都以组播的形式发送信息 — RIP组播地址（224.0.0.9）、 OSPF组播地址（224.0.0.5和224.0.0.6）<br> 3.OSPFV2和RIPV2都支持等开销负载均衡</p> 
<p><strong>不同点</strong>：<br> RIP只能适用于中小型网络，OSPF可以应用在大型网络当中（OSPF为了适应中大型网络环境，需要进行<strong>结构化部署 — 区域划分 — 减少更新量的手段之一）</strong></p> 
<p>如果只有一个区域的OSPF网络，我们将这样的网络称为单区域OSPF网络<br> 如果只有一个区域的OSPF网络，我们将这样的网络称为多区域OSPF网络</p> 
<p><strong>区域划分的主要目的</strong>：</p> 
<ul><li>区域内部传递拓扑信息，区域之间传递路由信息。</li><li>区域边界路由器 — ABR — 同时属于两个区域，并且一个接口对应一个区域。</li></ul> 
<p><strong>区域划分的要求</strong>：</p> 
<ul><li>区域之间必须存在ABR</li><li>区域划分必须按照星型拓扑结构划分星型拓扑中间区域叫做骨干区域 OSPF区域存在区域编号 — 区域ID —由32为二进制构成，用点分十进制进行表达。骨干区域的ID为0。</li></ul> 
<p><strong>OSPF的数据包</strong><br> <strong>hello包</strong> — 可以用来周期发现，建立和保活邻居关系<br> 周期：OSPF的hello包默认10s为周期进行周期发送<br> 死亡时间（dead time）— 4倍的hello时间</p> 
<p><strong>RID</strong> — 用来标定和区分OSPF网络中不同的路由器<br> <strong>RID的要求</strong>：</p> 
<ul><li>全网（OSPF网络）唯一</li><li>格式统一 — RID要求必须符合IP地址（由32位二进制构成，并且使用点分十进制进行表达）</li></ul> 
<p><strong>RID的获取方式</strong>：</p> 
<ul><li>手工配置 — 仅需要满足以上两点要求即可</li><li>自动获取 — 路由器先从环回地址中选取数值最大的IP地址作 为RID。若路由器不存在环回地址，则将从本地的物理接口对应的 IP地址中选取数值最大的作为RID。</li></ul> 
<p><strong>DBD包</strong> — 数据库描述报文 — LSD（数据链路状态数据库 — 存储LSA信息）—减少更新量手段之一</p> 
<p><strong>LSR包</strong> — 链路状态请求报文 — 基于DBD包请求未知的LSA信息<br> <strong>LSU包</strong> — 链路状态更新报文 — 真正携带LSA信息的数据包<br> <strong>LSAck包</strong> — 链路状态确认报文 — 确认包</p> 
<p><strong>OSPF的状态机</strong><br> <img src="https://images2.imgbox.com/c5/d3/Odl9RkJS_o.png" alt="在这里插入图片描述"><br> Two-way — 双向通信 — 标志着邻居关系的建立</p> 
<p>（条件匹配）<br> <img src="https://images2.imgbox.com/5b/11/5vGcAuQM_o.png" alt="在这里插入图片描述"><br> 主从关系选举：使用未携带数据的DBD包（主要目的是为了和之前的邻居关系进行区分）进行主从关系选举，通过对比RID，RID大的为主，主可以优先进入下一个状态。<br> <img src="https://images2.imgbox.com/f4/8f/KCyXxXMo_o.png" alt="在这里插入图片描述"><br> FULL — 标志着邻接关系的建立</p> 
<p><strong>Down状态</strong> — 启动OSPF，发送hello包后，进入下一个状态</p> 
<p><strong>Init（初始化状态）状态</strong>—当你收到一个hello包中包含本地的RID信息时，进入下一个状态</p> 
<p><strong>Two-way（双向通讯）状态</strong> — 标志着邻居关系建立<br> （条件匹配）— 如果条件匹配失败，则停留在邻居关系，仅10s一次，使用hello包进行保活<br> 条件匹配成功，则进入下一个状态</p> 
<p><strong>Exstart（预启动）状态</strong> — 使用未携带数据的DBD包进行主从关系选举，RID大的为主，主可以优先进入下一个状态</p> 
<p><strong>Exchange（准交换）状态</strong> — 使用携带目录信息的DBD包进行目录信息的共享，需要ACK确认。</p> 
<p><strong>Loading（加载）状态</strong> —查看对端的DBD包与本端LSA信息进行对比，基于未知的LSA信息发送LSR包进行请求。对端使用LSU进行恢复，需要ACK确认。</p> 
<p><strong>FULL（转发）状态</strong> — 标志着邻接关系的建立</p> 
<p><strong>OSPF的工作过程</strong><br> 启动配置完成后，OSPF向本地所有运行OSPF协议的接口以组播224.0.0.5的形式发hello包。hello包中需要携带自身本地的RID及自身已知邻居的RID。之后，将收集到的邻居关系记录在一张表中 — 邻居表。</p> 
<p>邻居表建立完成后需要进行条件匹配，失败则停留在邻居关系，仅使用hello包进行周期保活。</p> 
<p>匹配成功后，则开始建立邻接关系。首先需要使用未携带数据的DBD包进行主从关系选举。之后使用携带数据的DBD包共享数据库目录。之后使用LSR/LSU/LSACK数据包来获取未知网段的LSA信息；完成本地数据库表的建立。 — LSDB — 链路状态数据库。</p> 
<p>最后，基于本地的链路状态数据库，生成有向图及最短路径树，之后，计算本地到达未知网段的路由信息，生成的路由信息加载到路由表中。</p> 
<p>收敛完成后，OSPF需要10s一次使用hello包进行周期保活。</p> 
<p><strong>结构突变</strong></p> 
<ul><li>突然增加一个网段：触发更新，立即发送携带LSA信息的LSU包，需要ACK确认</li><li>突然断开一个网段</li><li>无法联系 — 40s死亡时间</li></ul> 
<p><strong>OSPF的基本配置</strong><br> <img src="https://images2.imgbox.com/78/26/FOLXWGYx_o.png" alt="在这里插入图片描述"><br> (1).启动OSPF进程<br> <code>[R1]ospf 1 router-id 1.1.1.1</code></p> 
<p>(2).创建区域</p> 
<pre><code>[R1-ospf-1]area 0
[R1-ospf-1-area-0.0.0.0]
</code></pre> 
<p>(2).宣告<br> <code>[R1-ospf-1-area-0.0.0.0]network 1.1.1.1 0.0.0.0</code> — 反掩码—由连续的0和1组成，其中0代表不可变位，1代表可变位</p> 
<p>查看邻居表<code>[R1]display ospf peer</code><br> 查看邻居关系间表<code>[R1]display ospf peer brief</code><br> 查看数据库表<code>[R1]display ospf lsdb</code><br> 查看一条LSA数据信息<code>[R1]display ospf lsdb router 2.2.2.2</code><br> 查看路由表<code>[R1]display ip routing-table protocol ospf</code></p> 
<p>OSPF在华为体系中默认优先级为10<br> OSPF是以带宽作为开销值的度量标准<br> COST == 参考带宽/真实带宽 — 华为默认的参考带宽是：100Mbps<br> 修改参考带宽：[R1-ospf-1]bandwidth-reference 1000<br> 参考带宽一旦修改，必须OSPF网络内所有设备均修改成相同的参考带宽</p> 
<p><strong>条件匹配</strong><br> 指定路由器 — DR<br> 备份指定路由器 — BDR<br> 一个广播域中，在DR和BDR都存在的情况下，至少需要四台路由器才能看到邻居关系。<br> 条件匹配：在一个广播域中，若所有设备均为邻接关系，将出现大量的重复更新；故需要进行DR/BDR选举；所有非DR/BDR的设备之间仅维持邻居关系。</p> 
<p><strong>DR/BDR的选举规则</strong>：<br> 1.先比较优先级，优先级最大的是DR，次大的是BDR<br> 优先级初始的默认值为1</p> 
<pre><code>[R1-GigabitEthernet0/0/0]ospf dr-priority ?
  INTEGER&lt;0-255&gt;  Router priority value
</code></pre> 
<p>优先级取值范围0-255，若优先级设置为0，则代表放弃DR/BDR选举<br> 2.如果优先级相同，则比较RID。RID大的路由器对应接口为DR，次大的为BDR。<br> DR/BDR的选举模式为非抢占模式，选举时间为40s.</p> 
<p>5.扩展配置<br> 1.手工认证<br> 2.手工汇总<br> 3.沉默接口<br> 4.加快收敛 — 减少计时器时间<br> 5.缺省路由<br> <img src="https://images2.imgbox.com/53/4f/qOrWFsQz_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e45ca6a3e58767bd73891877ed1d7485/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">phthon入门必备知识</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3f9a95f91ebae67b9d41d1e273be5de6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">IDEA tomcat 控制台中文乱码</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>