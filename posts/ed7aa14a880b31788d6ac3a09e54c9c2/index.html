<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>人脸识别-Java实现刷脸登录 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="人脸识别-Java实现刷脸登录" />
<meta property="og:description" content="人脸识别 一、相关概念 人脸人脸库人脸特征标识（face_token）并发 (QPS)API KeyAPI Secretconfidencethresholds人脸比对/人脸搜索（控制台分析） 人脸检测人脸搜索人脸对比 二、Web API face&#43;&#43;里注册账号 创建API Key postman调用API接口 人脸检测人脸对比 使用face_token参数进行对比 人脸搜索创建人脸库添加人脸获取人脸信息：删除人脸 三、刷脸登录 代码 一、相关概念 人脸 人脸（Face）在人脸识别技术中特指图像中发现的人脸，当对一张图片进行人脸检测时，会将检测到的人脸记录下来，包括人脸在图片中的位置，用一个系统标识 face_token 来表示。注意：对同一张图片进行多次人脸检测，对同一个人脸会得到不同的 face_token。
人脸库 人脸库（FaceSet）是用来存储检测到人脸的存储对象。一个 FaceSet 内的 face_token 是不重复的。
人脸特征标识（face_token） Face_token 是系统为人脸分配的唯一标识。当对一张图片进行人脸检测后，检测到的人脸以及人脸在图片中的位置会用一个用一个人脸特征标识 face_token 来表示。在进行人脸比对或人脸关键点检测时必须指定 face_token。针对同一张图片进行多次人脸检测，同一个人脸会得到不同的人脸特征标识 (face_token) 。 并发 (QPS) 并发 (QPS) 指每秒可以发起的 API 请求次数。调用同一个功能模块下的各个 API ，会统一计算 QPS。例如人脸识别并发 (QPS) 为 10 个，人脸识别包括人脸检测 API、人脸比对 API、人脸搜索API、人脸库管理 API 组、获取人脸信息 API 和自定义人脸信息 API，则每秒可以发起 10 次 API 调用请求，不限制具体调用了哪一个 API。超过 10 次请求，将返回 403 并发超限错误码 (CONCURRENCY_LIMIT_EXCEEDED)。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/ed7aa14a880b31788d6ac3a09e54c9c2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-25T13:36:01+08:00" />
<meta property="article:modified_time" content="2023-04-25T13:36:01+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">人脸识别-Java实现刷脸登录</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <div id="article_content" class="article_content clearfix"> 
 <div id="content_views" class="markdown_views prism-atelier-sulphurpool-light"> 
 </div> 
</div> 
<div class="toc"> 
 <h4><a href="https://so.csdn.net/so/search?q=%E4%BA%BA%E8%84%B8%E8%AF%86%E5%88%AB&amp;spm=1001.2101.3001.7020" target="_blank" class="hl hl-1" rel="noopener noreferrer">人脸识别</a></h4> 
 <ul><li><a href="#_2" rel="nofollow noopener noreferrer" target="_self">一、相关概念</a></li><li> 
   <ul><li><a href="#_3" rel="nofollow noopener noreferrer" target="_self">人脸</a></li><li><a href="#_6" rel="nofollow noopener noreferrer" target="_self">人脸库</a></li><li><a href="#face_token_9" rel="nofollow noopener noreferrer" target="_self">人脸特征标识（face_token）</a></li><li><a href="#_QPS_12" rel="nofollow noopener noreferrer" target="_self">并发 (QPS)</a></li><li><a href="#API_Key_14" rel="nofollow noopener noreferrer" target="_self">API Key</a></li><li><a href="#API_Secret_18" rel="nofollow noopener noreferrer" target="_self">API Secret</a></li><li><a href="#confidence_21" rel="nofollow noopener noreferrer" target="_self">confidence</a></li><li><a href="#thresholds_23" rel="nofollow noopener noreferrer" target="_self">thresholds</a></li><li><a href="#_35" rel="nofollow noopener noreferrer" target="_self">人脸比对/人脸搜索（控制台分析）</a></li><li> 
     <ul><li><a href="#_42" rel="nofollow noopener noreferrer" target="_self">人脸检测</a></li><li><a href="#_53" rel="nofollow noopener noreferrer" target="_self">人脸搜索</a></li><li><a href="#_58" rel="nofollow noopener noreferrer" target="_self">人脸对比</a></li></ul> </li></ul> </li><li><a href="#Web_API_75" rel="nofollow noopener noreferrer" target="_self">二、Web API</a></li><li> 
   <ul><li><a href="#face_76" rel="nofollow noopener noreferrer" target="_self">face++里注册账号</a></li><li> 
     <ul><li><a href="#API_Key_86" rel="nofollow noopener noreferrer" target="_self">创建API Key</a></li></ul> </li><li><a href="#postmanAPI_96" rel="nofollow noopener noreferrer" target="_self">postman调用API接口</a></li><li> 
     <ul><li><a href="#_97" rel="nofollow noopener noreferrer" target="_self">人脸检测</a></li><li><a href="#_171" rel="nofollow noopener noreferrer" target="_self">人脸对比</a></li><li> 
       <ul><li><a href="#face_token_232" rel="nofollow noopener noreferrer" target="_self">使用face_token参数进行对比</a></li></ul> </li><li><a href="#_260" rel="nofollow noopener noreferrer" target="_self">人脸搜索</a></li><li><a href="#_314" rel="nofollow noopener noreferrer" target="_self">创建人脸库</a></li><li><a href="#_365" rel="nofollow noopener noreferrer" target="_self">添加人脸</a></li><li><a href="#_431" rel="nofollow noopener noreferrer" target="_self">获取人脸信息：</a></li><li><a href="#_487" rel="nofollow noopener noreferrer" target="_self">删除人脸</a></li></ul> </li></ul> </li><li><a href="#_549" rel="nofollow noopener noreferrer" target="_self">三、刷脸登录</a></li><li> 
   <ul><li><a href="#_553" rel="nofollow noopener noreferrer" target="_self">代码</a></li></ul> </li></ul> 
</div> 
<p></p> 
<h2><a id="_2"></a>一、相关概念</h2> 
<h3><a id="_3"></a>人脸</h3> 
<p>人脸（Face）在人脸识别技术中特指图像中发现的人脸，当对一张图片进行<a href="https://so.csdn.net/so/search?q=%E4%BA%BA%E8%84%B8%E6%A3%80%E6%B5%8B&amp;spm=1001.2101.3001.7020" target="_blank" class="hl hl-1" rel="noopener noreferrer">人脸检测</a>时，会将检测到的人脸记录下来，包括人脸在图片中的位置，用一个系统标识 face_token 来表示。注意：对同一张图片进行多次人脸检测，对同一个人脸会得到不同的 face_token。</p> 
<h3><a id="_6"></a>人脸库</h3> 
<p>人脸库（FaceSet）是用来存储检测到人脸的存储对象。一个 FaceSet 内的 face_token 是不重复的。</p> 
<h3><a id="face_token_9"></a>人脸特征标识（face_token）</h3> 
<ul><li>Face_token 是系统为人脸分配的唯一标识。当对一张图片进行人脸检测后，检测到的人脸以及人脸在图片中的位置会用一个用一个人脸特征标识 face_token 来表示。在进行人脸比对或人脸关键点检测时必须指定 face_token。</li><li>针对同一张图片进行多次人脸检测，同一个人脸会得到不同的人脸特征标识 (face_token) 。</li></ul> 
<h3><a id="_QPS_12"></a>并发 (<a href="https://so.csdn.net/so/search?q=QPS&amp;spm=1001.2101.3001.7020" target="_blank" class="hl hl-1" rel="noopener noreferrer">QPS</a>)</h3> 
<p>并发 (QPS) 指每秒可以发起的 API 请求次数。调用同一个功能模块下的各个 API ，会统一计算 QPS。例如人脸识别并发 (QPS) 为 10 个，人脸识别包括人脸检测 API、人脸比对 API、人脸搜索API、人脸库管理 API 组、获取人脸信息 API 和自定义人脸信息 API，则每秒可以发起 10 次 API 调用请求，不限制具体调用了哪一个 API。超过 10 次请求，将返回 403 并发超限错误码 (CONCURRENCY_LIMIT_EXCEEDED)。</p> 
<h3><a id="API_Key_14"></a>API Key</h3> 
<ul><li>API Key 是使用公有云 API 和联网授权 SDK 服务的凭证。注册账号后，需要先创建一个 API Key，才能进行接口调用服务。</li><li>API Key 分为试用（免费）与正式（服务）两种类型，试用 API Key 在创建数量、使用的服务类型和并发 (QPS) 保障上均有限制。</li></ul> 
<h3><a id="API_Secret_18"></a>API Secret</h3> 
<p>API Secret 是在创建 API Key 时随机生成的一串密钥，需要和 API Key 搭配，获取使用 API 的权限，请您妥善保管记录。</p> 
<h3><a id="confidence_21"></a>confidence</h3> 
<p>比对结果置信度，范围 [0,100]，小数点后3位有效数字，数字越大表示两个人脸越可能是同一个人</p> 
<h3><a id="thresholds_23"></a>thresholds</h3> 
<ul><li> <p>一组用于参考的置信度阈值，包含以下三个字段。每个字段的值为一个 [0,100] 的浮点数，小数点后 3 位有效数字。</p> 
  <ul><li>1e-3：误识率为千分之一的置信度阈值；</li><li>1e-4：误识率为万分之一的置信度阈值；</li><li>1e-5：误识率为十万分之一的置信度阈值；</li></ul> </li><li> <p>如果置信值低于“千分之一”阈值则不建议认为是同一个人；如果置信值超过“十万分之一”阈值，则是同一个人的几率非常高。</p> </li><li> <p>阈值不是静态的，每次比对返回的阈值不保证相同，所以没有持久化保存阈值的必要，更不要将当前调用返回的 confidence 与之前调用返回的阈值比较。</p> </li><li> <p>如果传入图片但图片中未检测到人脸，则无法进行比对，本字段不返回。</p> </li></ul> 
<h3><a id="_35"></a>人脸比对/人脸搜索（控制台分析）</h3> 
<ul><li> <p>计算机检测到图片中一个人脸之后，通过人脸判断人身份的过程被称为人脸比对/人脸搜索。</p> </li><li> <p>人脸比对指采集新的人脸，与一个已知身份用户的人脸进行比对，判断新的人脸是否属于该已知身份用户。人脸比对需要调用人脸比对 API。</p> </li><li> <p>人脸搜索是指采集用户新的人脸，在多个已知身份用户的人脸集合中进行搜索，找出新的人脸属于哪一个已知身份用户。人脸搜索需要调用人脸搜索API。</p> </li></ul> 
<h4><a id="_42"></a>人脸检测</h4> 
<p>检测到了人脸会产生一个"face_token"<br> <img src="https://images2.imgbox.com/dd/7d/82u2OjQ1_o.png" alt="请添加图片描述"></p> 
<p>并且产生"face_num",这里有两个人脸，因此为2</p> 
<p><img src="https://images2.imgbox.com/96/71/iQ3zSekD_o.png" alt="请添加图片描述"></p> 
<p>如图：人脸数为3，小狗不会被识别到</p> 
<p><img src="https://images2.imgbox.com/84/01/wsZ6HvG0_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_53"></a>人脸搜索</h4> 
<p><img src="https://images2.imgbox.com/8d/94/bBVHliIe_o.png" alt="在这里插入图片描述"><br> 搜索结果：<br> <img src="https://images2.imgbox.com/56/42/gXuFdR0P_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_58"></a>人脸对比</h4> 
<p>如图：<br> <img src="https://images2.imgbox.com/29/7c/AhbFj1mT_o.png" alt="请添加图片描述"></p> 
<p>产生了"confidence"和"le-5"<br> 因为此时"confidence"的值大于"le-5"的值，所以分析结果如下图：</p> 
<p><img src="https://images2.imgbox.com/f7/0b/zbnRZtIu_o.png" alt="在这里插入图片描述"></p> 
<p>再比如：<br> <img src="https://images2.imgbox.com/8b/96/wFeFYO9N_o.png" alt="请添加图片描述"></p> 
<p>因为此时"confidence"的值小于"le-5"的值，所以分析结果如下图：</p> 
<p><img src="https://images2.imgbox.com/44/12/dcEGBbWp_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="Web_API_75"></a>二、Web API</h2> 
<h3><a id="face_76"></a>face++里注册账号</h3> 
<ul><li>首先：搜索face++</li><li>官网： <a href="https://www.faceplusplus.com.cn/" rel="nofollow">face++</a><br> <img src="https://images2.imgbox.com/a7/c7/LYkjk1Gl_o.png" alt="请添加图片描述"></li><li>登录或注册<br> <img src="https://images2.imgbox.com/9d/24/JWs4xpJQ_o.png" alt="请添加图片描述"></li><li>点击进入控制台<br> <img src="https://images2.imgbox.com/fe/b7/Sk350YSJ_o.png" alt="请添加图片描述"><br> 如图：<br> <img src="https://images2.imgbox.com/b3/a5/l6rHk1gd_o.png" alt="请添加图片描述"></li></ul> 
<h4><a id="API_Key_86"></a>创建API Key</h4> 
<ul><li>要调用 API，需要先创建一个 API Key（API 密钥），它是使用 API 和 SDK 的凭证注册验证成功后，可以在欢迎页面点击“创建我的第一个应用”，一个免费API Key会被自动生成，可以直接使用</li><li>免费API key 可依据免费规则调用API，如果希望使用付费版服务，需创建正式API Key</li></ul> 
<p><img src="https://images2.imgbox.com/8e/7d/J2X0Rl52_o.png" alt="在这里插入图片描述"></p> 
<ul><li>如图：创建完成</li><li>后续代码要用到这两个值<br> <img src="https://images2.imgbox.com/c1/90/bLHm6CEC_o.png" alt="请添加图片描述"></li></ul> 
<h3><a id="postmanAPI_96"></a>postman调用API接口</h3> 
<h4><a id="_97"></a>人脸检测</h4> 
<ul><li> <p>概述：<br> 传入图片进行人脸检测和人脸分析。<br> 可以检测图片内的所有人脸，对于每个检测出的人脸，会给出其唯一标识 face_token，可用于后续的人脸分析、人脸比对等操作。对于正式 API Key，支持指定图片的某一区域进行人脸检测。</p> </li><li> <p>本 API 支持对检测到的人脸直接进行分析，获得人脸的关键点和各类属性信息。对于试用 API Key，最多只对人脸框面积最大的 5 个人脸进行分析，其他检测到的人脸可以使用 Face Analyze API 进行分析。对于正式 API Key，支持分析所有检测到的人脸。</p> </li><li> <p>关于 face_token<br> 如果需要将检测出的人脸用于后续的分析、比对等操作，建议将对应的 face_token 添加到 FaceSet 中。如果一个 face_token 在 72 小时内没有存放在任一 FaceSet 中，则该 face_token 将会失效。如果对同一张图片进行多次人脸检测，同一个人脸得到的 face_token 是不同的。</p> </li><li> <p>调用URL<br> https://api-cn.faceplusplus.com/facepp/v3/detect</p> </li><li> <p>调用方法<br> POST</p> </li><li> <p>请求体格式<br> multipart/form-data</p> </li></ul> 
<p>请求参数（必选）：</p> 
<div class="table-box"> 
 <table><thead><tr><th>参数名</th><th>参数说明</th></tr></thead><tbody><tr><td>api_key</td><td>调用此API的API Key</td></tr><tr><td>api_secret</td><td>调用此API的API Secret</td></tr></tbody></table> 
</div> 
<p>以下参数三选一（必选）：</p> 
<div class="table-box"> 
 <table><thead><tr><th>参数名</th><th>参数说明</th></tr></thead><tbody><tr><td>image_url</td><td>图片的 URL</td></tr><tr><td>image_file</td><td>一个图片，二进制文件，需要用post multipart/form-data的方式上传</td></tr><tr><td>image_base64</td><td>base64 编码的二进制图片数据如果同时传入了 image_url、image_file 和 image_base64 参数，本API使用顺序为 image_file 优先，image_url 最低</td></tr></tbody></table> 
</div> 
<p>如下图：</p> 
<pre class="prettyprint"><code class="has-numbering">选择的参数为:
api_key  
api_secret 
image_file
</code></pre> 
<p>产生了face_token，face_num等…</p> 
<div class="hljs-button {2}"></div> 
<ul class="pre-numbering"></ul> 
<p>选择的图片参数为：<br> <img src="https://images2.imgbox.com/b1/b7/MnzHejI4_o.jpg" alt="请添加图片描述"><br> 结果：<br> 检测到一张人脸<br> <img src="https://images2.imgbox.com/34/b0/XDGhf7Ca_o.png" alt="在这里插入图片描述"></p> 
<p>再换张图：</p> 
<p><img src="https://images2.imgbox.com/1c/d8/pUvNkOdD_o.jpg" alt="请添加图片描述"><br> 结果检测到3张脸：<br> <img src="https://images2.imgbox.com/ab/42/LZCTktvs_o.png" alt="在这里插入图片描述"></p> 
<p>返回值说明</p> 
<div class="table-box"> 
 <table><thead><tr><th>字段</th><th>说明</th></tr></thead><tbody><tr><td>request_id</td><td>用于区分每一次请求的唯一的字符串。</td></tr><tr><td>faces</td><td>被检测出的人脸数组</td></tr><tr><td>image_id</td><td>被检测的图片在系统中的标识。</td></tr><tr><td>time_used</td><td>整个请求所花费的时间，单位为毫秒。</td></tr><tr><td>error_message</td><td>当请求失败时才会返回此字符串，具体返回内容见后续错误信息章节。否则此字段不存在</td></tr><tr><td>face_num</td><td>检测出的人脸个数</td></tr></tbody></table> 
</div> 
<p>faces 数组中单个元素的结构</p> 
<div class="table-box"> 
 <table><thead><tr><th>字段</th><th>说明</th></tr></thead><tbody><tr><td>face_token</td><td>人脸的标识</td></tr><tr><td>face_rectangle</td><td>人脸矩形框的位置，包括以下属性。每个属性的值都是整数：1.top：矩形框左上角像素点的纵坐标 2.left：矩形框左上角像素点的横坐标 3.width：矩形框的宽度 4.height：矩形框的高度</td></tr><tr><td>landmark</td><td>人脸的关键点坐标数组。当传入的 landmark 参数值为 1 时，返回 83 个关键点坐标数组。当传入的 landmark 参数值为 2 时，返回 106 个关键点坐标数组。</td></tr></tbody></table> 
</div> 
<h4><a id="_171"></a>人脸对比</h4> 
<ul><li> <p>描述：<br> 将两个人脸进行比对，来判断是否为同一个人，返回比对结果置信度和不同误识率下的阈值。</p> </li><li> <p>支持传入图片或 face_token 进行比对。使用图片时会自动选取图片中检测到人脸尺寸最大的一个人脸。</p> </li><li> <p>调用 URL<br> https://api-cn.faceplusplus.com/facepp/v3/compare</p> </li><li> <p>调用方法<br> POST</p> </li><li> <p>请求体格式<br> multipart/form-data</p> </li></ul> 
<p>请求参数（必选）：</p> 
<div class="table-box"> 
 <table><thead><tr><th>参数名</th><th>参数说明</th></tr></thead><tbody><tr><td>api_key</td><td>调用此API的API Key</td></tr><tr><td>api_secret</td><td>调用此API的API Secret</td></tr></tbody></table> 
</div> 
<p>以下参数四选一（必选）：</p> 
<div class="table-box"> 
 <table><thead><tr><th>参数名</th><th>参数说明</th></tr></thead><tbody><tr><td>face_token1</td><td>第一个人脸标识 face_token，优先使用该参数</td></tr><tr><td>image_url1</td><td>第一张图片的 URL</td></tr><tr><td>image_file1</td><td>第一张图片，二进制文件，需要用 post multipart/form-data 的方式上传。</td></tr><tr><td>image_base64_1</td><td>base64 编码的二进制图片数据如果同时传入了 image_url1、image_file1 和 image_base64_1 参数，本 API 使用顺序为image_file1 优先，image_url1 最低。</td></tr></tbody></table> 
</div> 
<p>以下参数四选一（必选）：</p> 
<div class="table-box"> 
 <table><thead><tr><th>参数名</th><th>参数说明</th></tr></thead><tbody><tr><td>face_token2</td><td>第二个人脸标识 face_token，优先使用该参数</td></tr><tr><td>image_url2</td><td>第二张图片的 URL</td></tr><tr><td>image_file2</td><td>第二张图片，二进制文件，需要用 post multipart/form-data 的方式上传。</td></tr><tr><td>image_base64_2</td><td>base64 编码的二进制图片数据如果同时传入了 image_url2、image_file2 和 image_base64_2 参数，本API 使用顺序为 image_file2优先，image_url2 最低。</td></tr></tbody></table> 
</div> 
<p>如图：对比这两张图：<br> <img src="https://images2.imgbox.com/fd/c6/G9tNLXtj_o.png" alt="在这里插入图片描述"></p> 
<pre class="prettyprint"><code class="has-numbering">选择的参数为:
api_key  
api_secret 
image_file1
image_file2
</code></pre> 
<p>产生了confidence，thresholds等…</p> 
<div class="hljs-button {2}"></div> 
<ul class="pre-numbering"></ul> 
<p>结果：<br> 因为此时"confidence"的值小于"le-5"的值，所以分析结果很大概率为不是同一个人：<br> <img src="https://images2.imgbox.com/58/5e/RQCOsPH0_o.png" alt="在这里插入图片描述"></p> 
<p>再比如这两张图：</p> 
<p><img src="https://images2.imgbox.com/ca/96/wJT86S1a_o.png" alt="在这里插入图片描述"><br> 结果：<br> 因为此时"confidence"的值大于"le-5"的值，所以分析结果很大概率为同一个人：<br> <img src="https://images2.imgbox.com/b3/d5/YfdROtSm_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="face_token_232"></a>使用face_token参数进行对比</h5> 
<ul><li>对比上两张人脸<br> 先检索需对比的第一张人脸得到face_token：</li></ul> 
<p><img src="https://images2.imgbox.com/f9/eb/dJOR6qX3_o.png" alt="在这里插入图片描述"></p> 
<ul><li>再检索需对比的第二张人脸得到face_token：</li></ul> 
<p><img src="https://images2.imgbox.com/9d/a9/i93PnBii_o.png" alt="在这里插入图片描述"></p> 
<ul><li>结果：<br> 因为此时"confidence"的值大于"le-5"的值，所以分析结果很大概率为同一个人：</li></ul> 
<p><img src="https://images2.imgbox.com/77/82/tImpduJ8_o.png" alt="在这里插入图片描述"></p> 
<p>返回值说明</p> 
<div class="table-box"> 
 <table><thead><tr><th>字段</th><th>说明</th></tr></thead><tbody><tr><td>request_id</td><td>用于区分每一次请求的唯一的字符串。</td></tr><tr><td>confidence</td><td>比对结果置信度，范围 [0,100]，小数点后3位有效数字，数字越大表示两个人脸越可能是同一个人。注：如果传入图片但图片中未检测到人脸，则无法进行比对，本字段不返回。</td></tr><tr><td>thresholds</td><td>一组用于参考的置信度阈值，包含以下三个字段。每个字段的值为一个 [0,100] 的浮点数，小数点后 3 位有效数字。1e-3：误识率为千分之一的置信度阈值；1e-4：误识率为万分之一的置信度阈值；1e-5：误识率为十万分之一的置信度阈值；如果置信值低于“千分之一”阈值则不建议认为是同一个人；如果置信值超过“十万分之一”阈值，则是同一个人的几率非常高。请注意：阈值不是静态的，每次比对返回的阈值不保证相同，所以没有持久化保存阈值的必要，更不要将当前调用返回的 confidence 与之前调用返回的阈值比较。注：如果传入图片但图片中未检测到人脸，则无法进行比对，本字段不返回。</td></tr><tr><td>image_id1</td><td>通过 image_url1、image_file1 或 image_base64_1 传入的图片在系统中的标识。注：如果未传入图片，本字段不返回。</td></tr><tr><td>image_id2</td><td>通过 image_url2、image_file2 或 image_base64_2 传入的图片在系统中的标识。注：如果未传入图片，本字段不返回。</td></tr><tr><td>faces1</td><td>通过 image_url1、image_file1 或 image_base64_1 传入的图片中检测出的人脸数组，采用数组中的第一个人脸进行人脸比对。注：如果未传入图片，本字段不返回。如果没有检测出人脸则为空数组</td></tr><tr><td>faces2</td><td>通过 image_url2、image_file2 或 image_base64_2 传入的图片中检测出的人脸数组，采用数组中的第一个人脸进行人脸比对。注：如果未传入图片，本字段不返回。如果没有检测出人脸则为空数组</td></tr><tr><td>time_used</td><td>整个请求所花费的时间，单位为毫秒。</td></tr><tr><td>error_message</td><td>当请求失败时才会返回此字符串，具体返回内容见后续错误信息章节。否则此字段不存在</td></tr></tbody></table> 
</div> 
<h4><a id="_260"></a>人脸搜索</h4> 
<ul><li> <p>描述：<br> 在一个已有的 FaceSet 中找出与目标人脸最相似的一张或多张人脸，返回置信度和不同误识率下的阈值。</p> </li><li> <p>支持传入图片或 face_token 进行人脸搜索。使用图片进行搜索时会选取图片中检测到人脸尺寸最大的一个人脸。</p> </li><li> <p>调用URL<br> https://api-cn.faceplusplus.com/facepp/v3/search</p> </li><li> <p>调用方法<br> POST</p> </li><li> <p>请求体格式<br> multipart/form-data</p> </li></ul> 
<p>请求参数（必选）：</p> 
<div class="table-box"> 
 <table><thead><tr><th>参数名</th><th>参数说明</th></tr></thead><tbody><tr><td>api_key</td><td>调用此API的API Key</td></tr><tr><td>api_secret</td><td>调用此API的API Secret</td></tr></tbody></table> 
</div> 
<p>以下参数四选一（必选）：</p> 
<div class="table-box"> 
 <table><thead><tr><th>参数名</th><th>参数说明</th></tr></thead><tbody><tr><td>face_token</td><td>进行搜索的目标人脸的 face_token，优先使用该参数</td></tr><tr><td>image_url</td><td>图片的 URL</td></tr><tr><td>image_file</td><td>一个图片，二进制文件，需要用post multipart/form-data的方式上传</td></tr><tr><td>image_base64</td><td>base64 编码的二进制图片数据如果同时传入了 image_url、image_file 和 image_base64 参数，本API使用顺序为 image_file 优先，image_url 最低</td></tr></tbody></table> 
</div> 
<p>以下参数二选一（必选）：</p> 
<div class="table-box"> 
 <table><thead><tr><th>参数名</th><th>参数说明</th></tr></thead><tbody><tr><td>faceset_token</td><td>用来搜索的 FaceSet 的标识</td></tr><tr><td>outer_id</td><td>用户自定义的 FaceSet 标识</td></tr></tbody></table> 
</div> 
<p>返回值说明</p> 
<div class="table-box"> 
 <table><thead><tr><th>字段</th><th>说明</th></tr></thead><tbody><tr><td>request_id</td><td>用于区分每一次请求的唯一的字符串。</td></tr><tr><td>results</td><td>搜索结果对象数组 注：如果传入图片但图片中未检测到人脸，则无法进行人脸搜索，本字段不返回。</td></tr><tr><td>thresholds</td><td>一组用于参考的置信度阈值，包含以下三个字段。每个字段的值为一个 [0,100] 的浮点数，小数点后 3 位有效数字。1e-3：误识率为千分之一的置信度阈值；1e-4：误识率为万分之一的置信度阈值；1e-5：误识率为十万分之一的置信度阈值；如果置信值低于“千分之一”阈值则不建议认为是同一个人；如果置信值超过“十万分之一”阈值，则是同一个人的几率非常高。请注意：阈值不是静态的，每次比对返回的阈值不保证相同，所以没有持久化保存阈值的必要，更不要将当前调用返回的 confidence 与之前调用返回的阈值比较。注：如果传入图片但图片中未检测到人脸，则无法进行比对，本字段不返回。</td></tr><tr><td>image_id</td><td>传入的图片在系统中的标识。注：如果未传入图片，本字段不返回。</td></tr><tr><td>faces</td><td>传入的图片中检测出的人脸数组，采用数组中的第一个人脸进行人脸搜索。注：如果未传入图片，本字段不返回。如果没有检测出人脸则为空数组</td></tr><tr><td>time_used</td><td>整个请求所花费的时间，单位为毫秒。</td></tr><tr><td>error_message</td><td>当请求失败时才会返回此字符串，具体返回内容见后续错误信息章节。否则此字段不存在</td></tr></tbody></table> 
</div> 
<p>results 数组中单个元素的结构</p> 
<div class="table-box"> 
 <table><thead><tr><th>字段</th><th>说明</th></tr></thead><tbody><tr><td>face_token</td><td>从 FaceSet 中搜索出的一个人脸标识 face_token。</td></tr><tr><td>confidence</td><td>比对结果置信度，范围 [0,100]，小数点后3位有效数字，数字越大表示两个人脸越可能是同一个人。</td></tr><tr><td>user_id</td><td>用户提供的人脸标识，如果未提供则为空。</td></tr></tbody></table> 
</div> 
<h4><a id="_314"></a>创建人脸库</h4> 
<ul><li> <p>描述:<br> 创建一个人脸的集合 FaceSet，用于存储人脸标识 face_token。一个 FaceSet 能够存储10000个 face_token。</p> </li><li> <p>试用API Key可以创建1000个FaceSet，正式API Key可以创建10000个FaceSet。</p> </li><li> <p>调用URL<br> https://api-cn.faceplusplus.com/facepp/v3/faceset/create</p> </li><li> <p>调用方法<br> POST</p> </li></ul> 
<p>请求参数（必选）：</p> 
<div class="table-box"> 
 <table><thead><tr><th>参数名</th><th>参数说明</th></tr></thead><tbody><tr><td>api_key</td><td>调用此API的API Key</td></tr><tr><td>api_secret</td><td>调用此API的API Secret</td></tr></tbody></table> 
</div> 
<p>请求参数（非必选）：</p> 
<div class="table-box"> 
 <table><thead><tr><th>参数名</th><th>参数说明</th></tr></thead><tbody><tr><td>outer_id</td><td>账号下全局唯一的 FaceSet 自定义标识，可以用来管理 FaceSet 对象。最长255个字符，不能包括字符^@,&amp;=*'"</td></tr></tbody></table> 
</div> 
<pre class="prettyprint"><code class="has-numbering">选择的参数为:
api_key  
api_secret 
outer_id
</code></pre> 
<p>产生了outer_id等…</p> 
<div class="hljs-button {2}"></div> 
<ul class="pre-numbering"></ul> 
<p>如图：<br> <img src="https://images2.imgbox.com/b8/86/Ou4kY0QI_o.png" alt="在这里插入图片描述"></p> 
<p>返回值说明</p> 
<div class="table-box"> 
 <table><thead><tr><th>字段</th><th>说明</th></tr></thead><tbody><tr><td>request_id</td><td>用于区分每一次请求的唯一的字符串。除非发生404（API_NOT_FOUND ) 或403 （AUTHORIZATION_ERROR）错误，此字段必定返回。</td></tr><tr><td>faceset_token</td><td>FaceSet 的标识</td></tr><tr><td>outer_id</td><td>用户自定义的 FaceSet 标识，如果未定义则返回值为空</td></tr><tr><td>face_added</td><td>本次操作成功加入 FaceSet的face_token 数量</td></tr><tr><td>face_count</td><td>操作结束后 FaceSet 中的 face_token 总数量</td></tr><tr><td>failure_detail</td><td>无法被加入 FaceSet 的 face_token 以及原因face_token：人脸标识reason：不能被添加的原因，包括 INVALID_FACE_TOKEN 人脸表示不存在 ，QUOTA_EXCEEDED 已达到 FaceSet 存储上限</td></tr><tr><td>time_used</td><td>整个请求所花费的时间，单位为毫秒。</td></tr><tr><td>error_message</td><td>当请求失败时才会返回此字符串，具体返回内容见后续错误信息章节。否则此字段不存在</td></tr></tbody></table> 
</div> 
<h4><a id="_365"></a>添加人脸</h4> 
<ul><li> <p>描述<br> 为一个已经创建的 FaceSet 添加人脸标识 face_token。一个 FaceSet 最多存储1,000个 face_token。</p> </li><li> <p>调用 URL<br> https://api-cn.faceplusplus.com/facepp/v3/faceset/addface</p> </li><li> <p>调用方法<br> POST</p> </li></ul> 
<p>请求参数（必选）：</p> 
<div class="table-box"> 
 <table><thead><tr><th>参数名</th><th>参数说明</th></tr></thead><tbody><tr><td>api_key</td><td>调用此API的API Key</td></tr><tr><td>api_secret</td><td>调用此API的API Secret</td></tr></tbody></table> 
</div> 
<p>以下参数二选一（必选）：</p> 
<div class="table-box"> 
 <table><thead><tr><th>参数名</th><th>参数说明</th></tr></thead><tbody><tr><td>faceset_token</td><td>用来搜索的 FaceSet 的标识</td></tr><tr><td>outer_id</td><td>用户自定义的 FaceSet 标识</td></tr></tbody></table> 
</div> 
<p>请求参数（必选）：</p> 
<div class="table-box"> 
 <table><thead><tr><th>参数名</th><th>参数说明</th></tr></thead><tbody><tr><td>face_tokens</td><td>人脸标识 face_token 组成的字符串，可以是一个或者多个，用逗号分隔。最多不超过5个face_token</td></tr></tbody></table> 
</div> 
<pre class="prettyprint"><code class="has-numbering">1.先进行人脸检测
选择的参数为:
api_key  
api_secret 
image_file
</code></pre> 
<p>产生了face_token，face_num等…</p> 
<div class="hljs-button {2}"></div> 
<ul class="pre-numbering"></ul> 
<p>如图：<br> <img src="https://images2.imgbox.com/4f/57/H3BHz2uN_o.png" alt="在这里插入图片描述"></p> 
<pre class="prettyprint"><code class="has-numbering">2.将人脸检测后的face_token存储到faceset
选择的参数为:
api_key  
api_secret 
outer_id
face_token
</code></pre> 
<p>产生了face_count等…</p> 
<div class="hljs-button {2}"></div> 
<ul class="pre-numbering"></ul> 
<p>如图：<br> <img src="https://images2.imgbox.com/5b/4d/R2Cod1gA_o.png" alt="在这里插入图片描述"></p> 
<p>返回值说明</p> 
<div class="table-box"> 
 <table><thead><tr><th>字段</th><th>说明</th></tr></thead><tbody><tr><td>request_id</td><td>用于区分每一次请求的唯一的字符串。除非发生404（API_NOT_FOUND ) 或403 （AUTHORIZATION_ERROR）错误，此字段必定返回。</td></tr><tr><td>faceset_token</td><td>FaceSet 的标识</td></tr><tr><td>outer_id</td><td>用户自定义的 FaceSet 标识，如果未定义则返回值为空</td></tr><tr><td>face_added</td><td>本次操作成功加入 FaceSet的face_token 数量</td></tr><tr><td>face_count</td><td>操作结束后 FaceSet 中的 face_token 总数量</td></tr><tr><td>failure_detail</td><td>无法被加入 FaceSet 的 face_token 以及原因face_token：人脸标识reason：不能被添加的原因，包括 INVALID_FACE_TOKEN 人脸表示不存在 ，QUOTA_EXCEEDED 已达到 FaceSet 存储上限</td></tr><tr><td>time_used</td><td>整个请求所花费的时间，单位为毫秒。</td></tr><tr><td>error_message</td><td>当请求失败时才会返回此字符串，具体返回内容见后续错误信息章节。否则此字段不存在</td></tr></tbody></table> 
</div> 
<h4><a id="_431"></a>获取人脸信息：</h4> 
<p>描述<br> 获取一个 FaceSet 的所有信息，包括此 FaceSet 的 faceset_token, outer_id, display_name 的信息，以及此 FaceSet 中存放的 face_token 数量与列表。</p> 
<p>调用URL<br> https://api-cn.faceplusplus.com/facepp/v3/faceset/getdetail</p> 
<p>调用方法<br> POST<br> 请求参数（必选）：</p> 
<div class="table-box"> 
 <table><thead><tr><th>参数名</th><th>参数说明</th></tr></thead><tbody><tr><td>api_key</td><td>调用此API的API Key</td></tr><tr><td>api_secret</td><td>调用此API的API Secret</td></tr></tbody></table> 
</div> 
<p>以下参数二选一（必选）：</p> 
<div class="table-box"> 
 <table><thead><tr><th>参数名</th><th>参数说明</th></tr></thead><tbody><tr><td>faceset_token</td><td>用来搜索的 FaceSet 的标识</td></tr><tr><td>outer_id</td><td>用户自定义的 FaceSet 标识</td></tr></tbody></table> 
</div> 
<pre class="prettyprint"><code class="has-numbering">选择的参数为:
api_key  
api_secret 
outer_id
</code></pre> 
<p>产生了face_tokens等…</p> 
<p>face_tokens是一个数组，里面装了faceset里的face_token</p> 
<div class="hljs-button {2}"></div> 
<ul class="pre-numbering"></ul> 
<ul><li>如图：<br> <img src="https://images2.imgbox.com/ad/86/paIEcFtx_o.png" alt="在这里插入图片描述"></li><li>再往faceset里存一张人脸：<br> <img src="https://images2.imgbox.com/26/45/IXh6AjkA_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/a5/a4/yunVCVxa_o.png" alt="在这里插入图片描述"></li><li>如图：检测到了两张人脸<br> <img src="https://images2.imgbox.com/75/48/J1Z5Q4Qy_o.png" alt="在这里插入图片描述"></li></ul> 
<p>返回值说明</p> 
<div class="table-box"> 
 <table><thead><tr><th>字段</th><th>说明</th></tr></thead><tbody><tr><td>request_id</td><td>用于区分每一次请求的唯一的字符串。除非发生404（API_NOT_FOUND ) 或403 （AUTHORIZATION_ERROR）错误，此字段必定返回。</td></tr><tr><td>faceset_token</td><td>FaceSet 的标识</td></tr><tr><td>outer_id</td><td>用户自定义的 FaceSet 标识，如果未定义则返回值为空</td></tr><tr><td>display_name</td><td>人脸集合的名字</td></tr><tr><td>user_data</td><td>自定义用户信息</td></tr><tr><td>tags</td><td>自定义标签</td></tr><tr><td>face_count</td><td>操作结束后 FaceSet 中的 face_token 总数量</td></tr><tr><td>face_tokens</td><td>face_token的数组 注：如果该 FaceSet 下没有 face_token，则返回空数组。</td></tr><tr><td>next</td><td>用于进行下一次请求。返回值表示排在此次返回的所有 face_token 之后的下一个 face_token 的序号。如果返回此字段，则说明未返回完此 FaceSet 下的所有 face_token。可以将此字段的返回值，在下一次调用时传入 start 字段中，获取接下来的 face_token。如果没有返回该字段，则说明已经返回此 FaceSet 下的所有 face_token。</td></tr><tr><td>time_used</td><td>整个请求所花费的时间，单位为毫秒。</td></tr><tr><td>error_message</td><td>当请求失败时才会返回此字符串，具体返回内容见后续错误信息章节。否则此字段不存在</td></tr></tbody></table> 
</div> 
<h4><a id="_487"></a>删除人脸</h4> 
<ul><li> <p>描述<br> 移除一个FaceSet中的某些或者全部face_token</p> </li><li> <p>调用URL<br> https://api-cn.faceplusplus.com/facepp/v3/faceset/removeface</p> </li><li> <p>调用方法<br> POST</p> </li></ul> 
<p>请求参数（必选）：</p> 
<div class="table-box"> 
 <table><thead><tr><th>参数名</th><th>参数说明</th></tr></thead><tbody><tr><td>api_key</td><td>调用此API的API Key</td></tr><tr><td>api_secret</td><td>调用此API的API Secret</td></tr></tbody></table> 
</div> 
<p>以下参数二选一（必选）：</p> 
<div class="table-box"> 
 <table><thead><tr><th>参数名</th><th>参数说明</th></tr></thead><tbody><tr><td>faceset_token</td><td>用来搜索的 FaceSet 的标识</td></tr><tr><td>outer_id</td><td>用户自定义的 FaceSet 标识</td></tr></tbody></table> 
</div> 
<p>请求参数（必选）：</p> 
<div class="table-box"> 
 <table><thead><tr><th>参数名</th><th>参数说明</th></tr></thead><tbody><tr><td>face_tokens</td><td>需要移除的人脸标识字符串，可以是一个或者多个face_token组成，用逗号分隔。最多不能超过1,000个face_token注：face_tokens字符串传入“RemoveAllFaceTokens”则会移除FaceSet内所有的face_token</td></tr></tbody></table> 
</div> 
<p>如图：<br> 此时搜索到有两张人脸<br> <img src="https://images2.imgbox.com/fd/12/qUUakbeH_o.png" alt="在这里插入图片描述"></p> 
<p>删除人脸</p> 
<pre class="prettyprint"><code class="has-numbering">
选择的参数为:
api_key  
api_secret 
outer_id
face_tokens
</code></pre> 
<p>face_tokens可以在获取人脸里得到<br> 产生了face_count等…</p> 
<div class="hljs-button {2}"></div> 
<ul class="pre-numbering"></ul> 
<p><img src="https://images2.imgbox.com/ee/cf/hZWmVVOC_o.png" alt="在这里插入图片描述"><br> 结果：<br> 删除一张人脸后再获取一次<br> 只剩一张人脸了<br> <img src="https://images2.imgbox.com/2a/4b/T4c3UWVC_o.png" alt="在这里插入图片描述"></p> 
<p>返回值说明</p> 
<div class="table-box"> 
 <table><thead><tr><th>字段</th><th>说明</th></tr></thead><tbody><tr><td>request_id</td><td>用于区分每一次请求的唯一的字符串。除非发生404（API_NOT_FOUND ) 或403 （AUTHORIZATION_ERROR）错误，此字段必定返回。</td></tr><tr><td>faceset_token</td><td>FaceSet 的标识</td></tr><tr><td>outer_id</td><td>用户自定义的 FaceSet 标识，如果未定义则返回值为空</td></tr><tr><td>face_removed</td><td>成功从FaceSet中移除的face_token数量</td></tr><tr><td>face_count</td><td>操作结束后 FaceSet 中的 face_token 总数量</td></tr><tr><td>failure_detail</td><td>无法从FaceSet中移除的face_token以及原因face_token：人脸标识reason：不能被移除的原因，包括 INVALID_FACE_TOKEN 人脸标识不存在</td></tr><tr><td>time_used</td><td>整个请求所花费的时间，单位为毫秒。除非发生404（API_NOT_FOUND )或403 （AUTHORIZATION_ERROR）错误，此字段必定返回。</td></tr><tr><td>error_message</td><td>当请求失败时才会返回此字符串，具体返回内容见后续错误信息章节。否则此字段不存在</td></tr></tbody></table> 
</div> 
<h2><a id="_549"></a>三、刷脸登录</h2> 
<ul><li>录入人脸信息，通过人脸检测接口得到face_token，存入outer_id=travel_faceset的faceset中当用户在登录的时候，得到用户当前登录图片，然后用人脸比对接口用当前登录图片和之前在<br> faceset中保存的人脸信息进行比对。</li><li>比对后的返回信息有我们设置的阈值(thresholds)，可以根据自身的需求选择其中一个阈值，当相似度（confidence）高于这个阈值时就可以认为是同一个人，即可以登录成功，反之，不能登录成功。</li></ul> 
<h3><a id="_553"></a>代码</h3> 
<ul><li>添加依赖：</li></ul> 
<pre class="prettyprint"><code class="prism language-java has-numbering"><span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
	<span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>reactivestreams<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
	<span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>reactive<span class="token operator">-</span>streams<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
	<span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">1.0</span><span class="token number">.3</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"></ul> 
<ul><li>yml配置文件：</li></ul> 
<pre class="prettyprint"><code class="prism language-java has-numbering">face<span class="token operator">:</span>
  config<span class="token operator">:</span>
    api<span class="token operator">-</span>key<span class="token operator">:</span> jlTzV7I<span class="token operator">-</span>pWQoqHFXWUUgv312jTpS17FC
    api<span class="token operator">-</span>secret<span class="token operator">:</span> eDULPcfETWuoRT9I4q51mvhlVpj_ECBp
    outer<span class="token operator">-</span>id<span class="token operator">:</span> link_faceset
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"></ul> 
<ul><li>配置启动类：</li></ul> 
<pre class="set-code-hide prettyprint"><code class="prism language-java has-numbering">
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">MapperScan</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">RestTemplate</span><span class="token punctuation">;</span>
</code></pre> 
<p><span class="token annotation punctuation">@SpringBootApplication</span><br> <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TravelApplication</span> <span class="token punctuation">{ 
  </span><br> <span class="token annotation punctuation">@Bean</span><br> <span class="token keyword">public</span> <span class="token class-name">RestTemplate</span> <span class="token function">restTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{ 
  </span><br> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br> <span class="token punctuation">}</span><br> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{ 
  </span><br> <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">TravelApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span><br> <span class="token punctuation">}</span><br> <span class="token punctuation">}</span></p> 
<div class="hljs-button {2}"></div> 
<div class="hide-preCode-box"> 
 <span class="hide-preCode-bt"><img class="look-more-preCode contentImg-no-view" src="https://images2.imgbox.com/71/81/dXL6nSg3_o.png" alt="" title=""></span> 
</div> 
<ul class="pre-numbering"></ul> 
<ul><li>FaceDao</li></ul> 
<pre class="set-code-hide prettyprint"><code class="prism language-java has-numbering">
</code></pre> 
<p><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">JsonProperty</span></span><span class="token punctuation">;</span><br> <span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span><br> <span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Getter</span></span><span class="token punctuation">;</span><br> <span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Setter</span></span><span class="token punctuation">;</span></p> 
<p><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span><br> <span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>context<span class="token punctuation">.</span>properties<span class="token punctuation">.</span></span><span class="token class-name">ConfigurationProperties</span></span><span class="token punctuation">;</span><br> <span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileSystemResource</span></span><span class="token punctuation">;</span><br> <span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpEntity</span></span><span class="token punctuation">;</span><br> <span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpHeaders</span></span><span class="token punctuation">;</span><br> <span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">MediaType</span></span><span class="token punctuation">;</span><br> <span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">ResponseEntity</span></span><span class="token punctuation">;</span><br> <span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">MultipartBodyBuilder</span></span><span class="token punctuation">;</span><br> <span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span><br> <span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">LinkedMultiValueMap</span></span><span class="token punctuation">;</span><br> <span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">MultiValueMap</span></span><span class="token punctuation">;</span><br> <span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">RestTemplate</span></span><span class="token punctuation">;</span></p> 
<p><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span></span><span class="token class-name">Paths</span></span><span class="token punctuation">;</span><br> <span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span></p> 
<p><span class="token comment">/**</span></p> 
<ul><li> <p>用于访问face++人脸系统<br> <em>/<br> <span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span><span class="token string">“face.config”</span><span class="token punctuation">)</span><br> <span class="token annotation punctuation">@Component</span><br> <span class="token annotation punctuation">@Getter</span><br> <span class="token annotation punctuation">@Setter</span><br> <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FaceDao</span> <span class="token punctuation">{ 
     </span><br> <span class="token annotation punctuation">@Autowired</span><br> <span class="token keyword">private</span> <span class="token class-name">RestTemplate</span> restTemplate<span class="token punctuation">;</span><br> <span class="token keyword">private</span> <span class="token class-name">String</span> apiKey<span class="token punctuation">;</span><br> <span class="token keyword">private</span> <span class="token class-name">String</span> apiSecret<span class="token punctuation">;</span><br> <span class="token keyword">private</span> <span class="token class-name">String</span> outerId<span class="token punctuation">;</span><br> <span class="token comment">/</span></em>*</p> 
  <ul><li>人脸检测<br> */<br> <span class="token keyword">public</span> <span class="token class-name">DetectResponseEntity</span> <span class="token function">detect</span><span class="token punctuation">(</span><span class="token class-name">String</span> filePath<span class="token punctuation">)</span> <span class="token punctuation">{ 
     </span><br> <span class="token class-name">HttpHeaders</span> headers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br> headers<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span>MULTIPART_FORM_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 多部件表单体</span><br> <span class="token class-name">MultipartBodyBuilder</span> multipartBodyBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MultipartBodyBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br> <span class="token comment">// ----------------- 表单 part</span><br> multipartBodyBuilder<span class="token punctuation">.</span><span class="token function">part</span><span class="token punctuation">(</span><span class="token string">“api_key”</span><span class="token punctuation">,</span> apiKey<span class="token punctuation">)</span><span class="token punctuation">;</span><br> multipartBodyBuilder<span class="token punctuation">.</span><span class="token function">part</span><span class="token punctuation">(</span><span class="token string">“api_secret”</span><span class="token punctuation">,</span> apiSecret<span class="token punctuation">)</span><span class="token punctuation">;</span><br> <span class="token comment">// ----------------- 文件 part</span><br> <span class="token comment">// 从磁盘读取文件</span><br> multipartBodyBuilder<span class="token punctuation">.</span><span class="token function">part</span><span class="token punctuation">(</span><span class="token string">“image_file”</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">FileSystemResource</span><span class="token punctuation">(</span><span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">MediaType</span><span class="token punctuation">.</span>IMAGE_PNG<span class="token punctuation">)</span><span class="token punctuation">;</span><br> <span class="token comment">// build完整的消息体</span><br> <span class="token class-name">MultiValueMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">HttpEntity</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> multipartBody <span class="token operator">=</span> multipartBodyBuilder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DetectResponseEntity</span><span class="token punctuation">&gt;</span></span> responseEntity <span class="token operator">=</span> restTemplate<span class="token punctuation">.</span><span class="token function">postForEntity</span><span class="token punctuation">(</span><span class="token string">“https://api-cn.faceplusplus.com/facepp/v3/detect”</span><span class="token punctuation">,</span> multipartBody<span class="token punctuation">,</span> <span class="token class-name">DetectResponseEntity</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br> <span class="token keyword">return</span> responseEntity<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br> <span class="token punctuation">}</span></li></ul> <p><span class="token comment">/**</span></p> 
  <ul><li>创建faceset<br> <em>/<br> <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">faceSetCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{ 
      </span><br> <span class="token class-name">HttpHeaders</span> headers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br> headers<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span>APPLICATION_FORM_URLENCODED<span class="token punctuation">)</span><span class="token punctuation">;</span><br> <span class="token class-name">MultiValueMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map<span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedMultiValueMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br> map<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">“api_key”</span><span class="token punctuation">,</span> apiKey<span class="token punctuation">)</span><span class="token punctuation">;</span><br> map<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">“api_secret”</span><span class="token punctuation">,</span> apiSecret<span class="token punctuation">)</span><span class="token punctuation">;</span><br> map<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">“outer_id”</span><span class="token punctuation">,</span> outerId<span class="token punctuation">)</span><span class="token punctuation">;</span><br> <span class="token class-name">HttpEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MultiValueMap</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><br> <span class="token punctuation">(</span>map<span class="token punctuation">,</span> headers<span class="token punctuation">)</span><span class="token punctuation">;</span><br> restTemplate<span class="token punctuation">.</span><span class="token function">postForEntity</span><span class="token punctuation">(</span><span class="token string">“https://apicn.faceplusplus.com/facepp/v3/faceset/create”</span><span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br> <span class="token punctuation">}</span><br> <span class="token comment">/</span></em>*</li><li>得到outer_id=trave_faceset的信息<br> <em>/<br> <span class="token keyword">public</span> <span class="token class-name">FaceSetResponseEntity</span> <span class="token function">getFaceSetDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{ 
      </span><br> <span class="token class-name">HttpHeaders</span> headers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br> headers<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span>APPLICATION_FORM_URLENCODED<span class="token punctuation">)</span><span class="token punctuation">;</span><br> <span class="token class-name">MultiValueMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map<span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedMultiValueMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br> map<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">“api_key”</span><span class="token punctuation">,</span> apiKey<span class="token punctuation">)</span><span class="token punctuation">;</span><br> map<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">“api_secret”</span><span class="token punctuation">,</span> apiSecret<span class="token punctuation">)</span><span class="token punctuation">;</span><br> map<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">“outer_id”</span><span class="token punctuation">,</span> outerId<span class="token punctuation">)</span><span class="token punctuation">;</span><br> <span class="token class-name">HttpEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MultiValueMap</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>map<span class="token punctuation">,</span> headers<span class="token punctuation">)</span><span class="token punctuation">;</span><br> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FaceSetResponseEntity</span><span class="token punctuation">&gt;</span></span> responseEntity <span class="token operator">=</span> restTemplate<span class="token punctuation">.</span><span class="token function">postForEntity</span><span class="token punctuation">(</span><span class="token string">“https://apicn.faceplusplus.com/facepp/v3/faceset/getdetail”</span><span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token class-name">FaceSetResponseEntity</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br> <span class="token keyword">return</span> responseEntity<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br> <span class="token punctuation">}</span><br> <span class="token comment">/</span></em>*</li><li>添加faceToken到FaceSet</li><li>人脸标识 faceTokens 组成的字符串，可以是一个或者多个，用逗号分隔。最多不超过5个<br> face_token</li><li>@param faceTokens<br> <em>/<br> <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addFaceToFaceSet</span><span class="token punctuation">(</span><span class="token class-name">String</span> faceTokens<span class="token punctuation">)</span> <span class="token punctuation">{ 
      </span><br> <span class="token class-name">HttpHeaders</span> headers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br> headers<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span>APPLICATION_FORM_URLENCODED<span class="token punctuation">)</span><span class="token punctuation">;</span><br> <span class="token class-name">MultiValueMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map<span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedMultiValueMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br> map<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">“api_key”</span><span class="token punctuation">,</span> apiKey<span class="token punctuation">)</span><span class="token punctuation">;</span><br> map<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">“api_secret”</span><span class="token punctuation">,</span> apiSecret<span class="token punctuation">)</span><span class="token punctuation">;</span><br> map<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">“outer_id”</span><span class="token punctuation">,</span> outerId<span class="token punctuation">)</span><span class="token punctuation">;</span><br> map<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">“face_tokens”</span><span class="token punctuation">,</span> faceTokens<span class="token punctuation">)</span><span class="token punctuation">;</span><br> <span class="token class-name">HttpEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MultiValueMap</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><br> <span class="token punctuation">(</span>map<span class="token punctuation">,</span> headers<span class="token punctuation">)</span><span class="token punctuation">;</span><br> restTemplate<span class="token punctuation">.</span><span class="token function">postForEntity</span><span class="token punctuation">(</span><span class="token string">“https://apicn.faceplusplus.com/facepp/v3/faceset/addface”</span><span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br> <span class="token punctuation">}</span><br> <span class="token comment">/</span></em>*</li><li>人脸比对</li><li>@param faceToken1</li><li>@param faceToken2</li><li>@return<br> <em>/<br> <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">compareFace</span><span class="token punctuation">(</span><span class="token class-name">String</span> faceToken1<span class="token punctuation">,</span> <span class="token class-name">String</span> faceToken2<span class="token punctuation">)</span> <span class="token punctuation">{ 
      </span><br> <span class="token class-name">HttpHeaders</span> headers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br> headers<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span>MULTIPART_FORM_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 多部件表单体</span><br> <span class="token class-name">MultipartBodyBuilder</span> multipartBodyBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MultipartBodyBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br> <span class="token comment">// ----------------- 表单 part</span><br> multipartBodyBuilder<span class="token punctuation">.</span><span class="token function">part</span><span class="token punctuation">(</span><span class="token string">“api_key”</span><span class="token punctuation">,</span> apiKey<span class="token punctuation">)</span><span class="token punctuation">;</span><br> multipartBodyBuilder<span class="token punctuation">.</span><span class="token function">part</span><span class="token punctuation">(</span><span class="token string">“api_secret”</span><span class="token punctuation">,</span> apiSecret<span class="token punctuation">)</span><span class="token punctuation">;</span><br> multipartBodyBuilder<span class="token punctuation">.</span><span class="token function">part</span><span class="token punctuation">(</span><span class="token string">“face_token1”</span><span class="token punctuation">,</span> faceToken1<span class="token punctuation">)</span><span class="token punctuation">;</span><br> multipartBodyBuilder<span class="token punctuation">.</span><span class="token function">part</span><span class="token punctuation">(</span><span class="token string">“face_token2”</span><span class="token punctuation">,</span> faceToken2<span class="token punctuation">)</span><span class="token punctuation">;</span><br> <span class="token comment">// ----------------- 文件 part</span><br> <span class="token comment">// 从磁盘读取文件</span><br> <span class="token comment">// multipartBodyBuilder.part(“image_file”, new FileSystemResource(Paths.get(filePath)), MediaType.IMAGE_PNG);</span><br> <span class="token comment">// build完整的消息体</span><br> <span class="token class-name">MultiValueMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">HttpEntity</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> multipartBody <span class="token operator">=</span> multipartBodyBuilder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CompareResponseEntity</span><span class="token punctuation">&gt;</span></span> responseEntity <span class="token operator">=</span> restTemplate<span class="token punctuation">.</span><span class="token function">postForEntity</span><span class="token punctuation">(</span><span class="token string">“https://api-cn.faceplusplus.com/facepp/v3/compare”</span><span class="token punctuation">,</span> multipartBody<span class="token punctuation">,</span> <span class="token class-name">CompareResponseEntity</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>responseEntity<span class="token punctuation">)</span><span class="token punctuation">;</span><br> <span class="token class-name">CompareResponseEntity</span> e <span class="token operator">=</span> responseEntity<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br> <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getConfidence</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> e<span class="token punctuation">.</span><span class="token function">getThresholds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>e5<span class="token punctuation">)</span> <span class="token punctuation">{ 
      </span><br> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span><br> <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{ 
      </span><br> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span><br> <span class="token punctuation">}</span><br> <span class="token punctuation">}</span><br> <span class="token comment">/</span></em>*</li><li>人脸比对返回实体类<br> <em>/<br> <span class="token annotation punctuation">@Data</span><br> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">CompareResponseEntity</span> <span class="token punctuation">{ 
      </span><br> <span class="token keyword">private</span> <span class="token class-name">Double</span> confidence<span class="token punctuation">;</span><br> <span class="token keyword">private</span> <span class="token class-name">ThresholdsResponseEntity</span> thresholds<span class="token punctuation">;</span><br> <span class="token punctuation">}</span><br> <span class="token comment">/</span></em>*</li><li>人脸对比置信度阈值返回实体类<br> */<br> <span class="token annotation punctuation">@Data</span><br> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ThresholdsResponseEntity</span> <span class="token punctuation">{ 
     </span><br> <span class="token annotation punctuation">@JsonProperty</span><span class="token punctuation">(</span><span class="token string">“1e-5”</span><span class="token punctuation">)</span><br> <span class="token keyword">private</span> <span class="token class-name">Double</span> e5<span class="token punctuation">;</span><br> <span class="token punctuation">}</span></li></ul> <p><span class="token comment">/**</span></p> 
  <ul><li>FaceSet返回实体类<br> <em>/<br> <span class="token annotation punctuation">@Data</span><br> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">FaceSetResponseEntity</span><span class="token punctuation">{ 
      </span><br> <span class="token keyword">private</span> <span class="token class-name">String</span> faceset_token<span class="token punctuation">;</span><br> <span class="token keyword">private</span> <span class="token class-name">String</span> outer_id<span class="token punctuation">;</span><br> <span class="token keyword">private</span> <span class="token class-name">Integer</span> face_count<span class="token punctuation">;</span><br> <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> face_tokens<span class="token punctuation">;</span><br> <span class="token punctuation">}</span><br> <span class="token annotation punctuation">@Data</span><br> <span class="token comment">/</span></em>*</li></ul> </li><li> <p>人脸检测返回数据实体类<br> <em>/<br> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">DetectResponseEntity</span> <span class="token punctuation">{ 
     </span><br> <span class="token keyword">private</span> <span class="token class-name">String</span> request_id<span class="token punctuation">;</span><br> <span class="token keyword">private</span> <span class="token class-name">Integer</span> face_num<span class="token punctuation">;</span><br> <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FaceEntity</span><span class="token punctuation">&gt;</span></span> faces<span class="token punctuation">;</span><br> <span class="token punctuation">}</span><br> <span class="token annotation punctuation">@Data</span><br> <span class="token comment">/</span></em>*</p> 
  <ul><li>人脸实体类<br> */<br> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">FaceEntity</span> <span class="token punctuation">{ 
     </span><br> <span class="token keyword">private</span> <span class="token class-name">String</span> face_token<span class="token punctuation">;</span><br> <span class="token punctuation">}</span><br> <span class="token punctuation">}</span></li></ul> </li></ul> 
<div class="hljs-button {2}"></div> 
<div class="hide-preCode-box"> 
 <span class="hide-preCode-bt"><img class="look-more-preCode contentImg-no-view" src="https://images2.imgbox.com/a3/d6/J9d8vibs_o.png" alt="" title=""></span> 
</div> 
<ul class="pre-numbering"></ul> 
<ul><li>FaceDaoTest</li></ul> 
<pre class="set-code-hide prettyprint"><code class="prism language-java has-numbering">
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner<span class="token punctuation">.</span></span><span class="token class-name">RunWith</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SpringBootTest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4<span class="token punctuation">.</span></span><span class="token class-name">SpringRunner</span><span class="token punctuation">;</span>
</code></pre> 
<p><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span><br> <span class="token annotation punctuation">@SpringBootTest</span><br> <span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><br> <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FaceDaoTest</span> <span class="token punctuation">{ 
  </span></p> 
<pre><code>&lt;span class="token annotation punctuation"&gt;@Autowired&lt;/span&gt;
&lt;span class="token keyword"&gt;private&lt;/span&gt; &lt;span class="token class-name"&gt;FaceDao&lt;/span&gt; faceDao&lt;span class="token punctuation"&gt;;&lt;/span&gt;

&lt;span class="token annotation punctuation"&gt;@Test&lt;/span&gt;
&lt;span class="token keyword"&gt;public&lt;/span&gt; &lt;span class="token keyword"&gt;void&lt;/span&gt; &lt;span class="token function"&gt;detect&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt; &lt;span class="token punctuation"&gt;{&lt;!-- --&gt;&lt;/span&gt;
    &lt;span class="token class-name"&gt;FaceDao&lt;span class="token punctuation"&gt;.&lt;/span&gt;DetectResponseEntity&lt;/span&gt; e &lt;span class="token operator"&gt;=&lt;/span&gt; faceDao&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token function"&gt;detect&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token string"&gt;"C:\\Users\\Administrator\\Desktop\\29.jpg"&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;;&lt;/span&gt;
    &lt;span class="token class-name"&gt;System&lt;/span&gt;&lt;span class="token punctuation"&gt;.&lt;/span&gt;out&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token function"&gt;println&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;e&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;;&lt;/span&gt;
&lt;span class="token punctuation"&gt;}&lt;/span&gt;
&lt;span class="token annotation punctuation"&gt;@Test&lt;/span&gt;
&lt;span class="token keyword"&gt;public&lt;/span&gt; &lt;span class="token keyword"&gt;void&lt;/span&gt; &lt;span class="token function"&gt;getFaceSetDetail&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt; &lt;span class="token punctuation"&gt;{&lt;!-- --&gt;&lt;/span&gt;
    &lt;span class="token class-name"&gt;FaceDao&lt;span class="token punctuation"&gt;.&lt;/span&gt;FaceSetResponseEntity&lt;/span&gt; e &lt;span class="token operator"&gt;=&lt;/span&gt; faceDao&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token function"&gt;getFaceSetDetail&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;;&lt;/span&gt;
    &lt;span class="token class-name"&gt;System&lt;/span&gt;&lt;span class="token punctuation"&gt;.&lt;/span&gt;out&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token function"&gt;println&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;e&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;;&lt;/span&gt;
&lt;span class="token punctuation"&gt;}&lt;/span&gt;
&lt;span class="token annotation punctuation"&gt;@Test&lt;/span&gt;
&lt;span class="token keyword"&gt;public&lt;/span&gt; &lt;span class="token keyword"&gt;void&lt;/span&gt; &lt;span class="token function"&gt;createFaceSet&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt; &lt;span class="token punctuation"&gt;{&lt;!-- --&gt;&lt;/span&gt;
    faceDao&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token function"&gt;faceSetCreate&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;;&lt;/span&gt;
&lt;span class="token punctuation"&gt;}&lt;/span&gt;
&lt;span class="token annotation punctuation"&gt;@Test&lt;/span&gt;
&lt;span class="token keyword"&gt;public&lt;/span&gt; &lt;span class="token keyword"&gt;void&lt;/span&gt; &lt;span class="token function"&gt;addFaceToFaceSet&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt; &lt;span class="token punctuation"&gt;{&lt;!-- --&gt;&lt;/span&gt;
    faceDao&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token function"&gt;addFaceToFaceSet&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token string"&gt;"fb9929c6da2f035f6cf647cc78ab7675"&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;;&lt;/span&gt;
&lt;span class="token punctuation"&gt;}&lt;/span&gt;
&lt;span class="token annotation punctuation"&gt;@Test&lt;/span&gt;
&lt;span class="token keyword"&gt;public&lt;/span&gt; &lt;span class="token keyword"&gt;void&lt;/span&gt; &lt;span class="token function"&gt;campareFace&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt; &lt;span class="token punctuation"&gt;{&lt;!-- --&gt;&lt;/span&gt;
    &lt;span class="token keyword"&gt;boolean&lt;/span&gt; b &lt;span class="token operator"&gt;=&lt;/span&gt; faceDao&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token function"&gt;compareFace&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token string"&gt;"d64dc956a6be7c07ebaa3093923a66fa"&lt;/span&gt;&lt;span class="token punctuation"&gt;,&lt;/span&gt; &lt;span class="token string"&gt;"10447d93dd700e3f98c0a981c879c99d"&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;;&lt;/span&gt;
    &lt;span class="token class-name"&gt;System&lt;/span&gt;&lt;span class="token punctuation"&gt;.&lt;/span&gt;out&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token function"&gt;println&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;b&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;;&lt;/span&gt;
&lt;span class="token punctuation"&gt;}&lt;/span&gt;
</code></pre> 
<p><span class="token punctuation">}</span></p> 
<div class="hljs-button {2}"></div> 
<div class="hide-preCode-box"> 
 <span class="hide-preCode-bt"><img class="look-more-preCode contentImg-no-view" src="https://images2.imgbox.com/21/e5/2yP0qQEP_o.png" alt="" title=""></span> 
</div> 
<ul class="pre-numbering"></ul> 
<ul><li>FaceService</li></ul> 
<pre class="prettyprint"><code class="prism language-java has-numbering"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">FaceService</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addFace</span><span class="token punctuation">(</span><span class="token class-name">String</span> filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">loginByFace</span><span class="token punctuation">(</span><span class="token class-name">String</span> filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<div class="hljs-button {2}"></div> 
<ul class="pre-numbering"></ul> 
<ul><li>FaceServiceImpl</li></ul> 
<pre class="set-code-hide prettyprint"><code class="prism language-java has-numbering">
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>lrk<span class="token punctuation">.</span>travel<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">FaceDao</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>lrk<span class="token punctuation">.</span>travel<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">FaceService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span><span class="token punctuation">;</span>
</code></pre> 
<p><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span></span><span class="token punctuation">;</span><br> <span class="token annotation punctuation">@Service</span><br> <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FaceServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">FaceService</span> <span class="token punctuation">{ 
  </span><br> <span class="token annotation punctuation">@Autowired</span><br> <span class="token keyword">private</span> <span class="token class-name">FaceDao</span> faceDao<span class="token punctuation">;</span></p> 
<pre><code>&lt;span class="token annotation punctuation"&gt;@Override&lt;/span&gt;
&lt;span class="token keyword"&gt;public&lt;/span&gt; &lt;span class="token keyword"&gt;void&lt;/span&gt; &lt;span class="token function"&gt;addFace&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token class-name"&gt;String&lt;/span&gt; filePath&lt;span class="token punctuation"&gt;)&lt;/span&gt; &lt;span class="token punctuation"&gt;{&lt;!-- --&gt;&lt;/span&gt;
        &lt;span class="token class-name"&gt;FaceDao&lt;span class="token punctuation"&gt;.&lt;/span&gt;FaceSetResponseEntity&lt;/span&gt; fs &lt;span class="token operator"&gt;=&lt;/span&gt; &lt;span class="token keyword"&gt;null&lt;/span&gt;&lt;span class="token punctuation"&gt;;&lt;/span&gt;
        &lt;span class="token keyword"&gt;try&lt;/span&gt; &lt;span class="token punctuation"&gt;{&lt;!-- --&gt;&lt;/span&gt;
            fs &lt;span class="token operator"&gt;=&lt;/span&gt; faceDao&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token function"&gt;getFaceSetDetail&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;;&lt;/span&gt;
        &lt;span class="token punctuation"&gt;}&lt;/span&gt; &lt;span class="token keyword"&gt;catch&lt;/span&gt; &lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token class-name"&gt;Exception&lt;/span&gt; e&lt;span class="token punctuation"&gt;)&lt;/span&gt; &lt;span class="token punctuation"&gt;{&lt;!-- --&gt;&lt;/span&gt;
        &lt;span class="token punctuation"&gt;}&lt;/span&gt;
        &lt;span class="token keyword"&gt;if&lt;/span&gt; &lt;span class="token punctuation"&gt;(&lt;/span&gt;fs &lt;span class="token operator"&gt;==&lt;/span&gt; &lt;span class="token keyword"&gt;null&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt; &lt;span class="token punctuation"&gt;{&lt;!-- --&gt;&lt;/span&gt; &lt;span class="token comment"&gt;//faceset不存在&lt;/span&gt;
            faceDao&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token function"&gt;faceSetCreate&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;;&lt;/span&gt;
        &lt;span class="token punctuation"&gt;}&lt;/span&gt;
        &lt;span class="token class-name"&gt;FaceDao&lt;span class="token punctuation"&gt;.&lt;/span&gt;DetectResponseEntity&lt;/span&gt; dr &lt;span class="token operator"&gt;=&lt;/span&gt; faceDao&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token function"&gt;detect&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;filePath&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;;&lt;/span&gt; &lt;span class="token comment"&gt;//检视人脸&lt;/span&gt;
        &lt;span class="token keyword"&gt;for&lt;/span&gt; &lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token class-name"&gt;FaceDao&lt;span class="token punctuation"&gt;.&lt;/span&gt;FaceEntity&lt;/span&gt; f &lt;span class="token operator"&gt;:&lt;/span&gt; dr&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token function"&gt;getFaces&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt; &lt;span class="token punctuation"&gt;{&lt;!-- --&gt;&lt;/span&gt;
            faceDao&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token function"&gt;addFaceToFaceSet&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;f&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token function"&gt;getFace_token&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;;&lt;/span&gt;
        &lt;span class="token punctuation"&gt;}&lt;/span&gt;
&lt;span class="token punctuation"&gt;}&lt;/span&gt;

&lt;span class="token annotation punctuation"&gt;@Override&lt;/span&gt;
&lt;span class="token keyword"&gt;public&lt;/span&gt; &lt;span class="token keyword"&gt;boolean&lt;/span&gt; &lt;span class="token function"&gt;loginByFace&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token class-name"&gt;String&lt;/span&gt; filePath&lt;span class="token punctuation"&gt;)&lt;/span&gt; &lt;span class="token punctuation"&gt;{&lt;!-- --&gt;&lt;/span&gt;
    &lt;span class="token keyword"&gt;boolean&lt;/span&gt; result &lt;span class="token operator"&gt;=&lt;/span&gt; &lt;span class="token boolean"&gt;false&lt;/span&gt;&lt;span class="token punctuation"&gt;;&lt;/span&gt;
    &lt;span class="token class-name"&gt;FaceDao&lt;span class="token punctuation"&gt;.&lt;/span&gt;FaceSetResponseEntity&lt;/span&gt; fs &lt;span class="token operator"&gt;=&lt;/span&gt; &lt;span class="token keyword"&gt;null&lt;/span&gt;&lt;span class="token punctuation"&gt;;&lt;/span&gt;
    &lt;span class="token keyword"&gt;try&lt;/span&gt; &lt;span class="token punctuation"&gt;{&lt;!-- --&gt;&lt;/span&gt;
        fs &lt;span class="token operator"&gt;=&lt;/span&gt; faceDao&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token function"&gt;getFaceSetDetail&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;;&lt;/span&gt;
    &lt;span class="token punctuation"&gt;}&lt;/span&gt; &lt;span class="token keyword"&gt;catch&lt;/span&gt; &lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token class-name"&gt;Exception&lt;/span&gt; e&lt;span class="token punctuation"&gt;)&lt;/span&gt; &lt;span class="token punctuation"&gt;{&lt;!-- --&gt;&lt;/span&gt;
    &lt;span class="token punctuation"&gt;}&lt;/span&gt;
    &lt;span class="token keyword"&gt;if&lt;/span&gt; &lt;span class="token punctuation"&gt;(&lt;/span&gt;fs &lt;span class="token operator"&gt;==&lt;/span&gt; &lt;span class="token keyword"&gt;null&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt; &lt;span class="token punctuation"&gt;{&lt;!-- --&gt;&lt;/span&gt; &lt;span class="token comment"&gt;//faceset不存在&lt;/span&gt;
        faceDao&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token function"&gt;faceSetCreate&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;;&lt;/span&gt;
        fs &lt;span class="token operator"&gt;=&lt;/span&gt; faceDao&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token function"&gt;getFaceSetDetail&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;;&lt;/span&gt;
    &lt;span class="token punctuation"&gt;}&lt;/span&gt;
    &lt;span class="token class-name"&gt;FaceDao&lt;span class="token punctuation"&gt;.&lt;/span&gt;DetectResponseEntity&lt;/span&gt; dr &lt;span class="token operator"&gt;=&lt;/span&gt; faceDao&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token function"&gt;detect&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;filePath&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;;&lt;/span&gt; &lt;span class="token comment"&gt;//检视人脸&lt;/span&gt;
    &lt;span class="token class-name"&gt;String&lt;/span&gt; ft1 &lt;span class="token operator"&gt;=&lt;/span&gt; &lt;span class="token keyword"&gt;null&lt;/span&gt;&lt;span class="token punctuation"&gt;;&lt;/span&gt;
    &lt;span class="token keyword"&gt;if&lt;/span&gt; &lt;span class="token punctuation"&gt;(&lt;/span&gt;dr&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token function"&gt;getFace_num&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt; &lt;span class="token operator"&gt;&amp;gt;=&lt;/span&gt;&lt;span class="token number"&gt;1&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt; &lt;span class="token punctuation"&gt;{&lt;!-- --&gt;&lt;/span&gt;
        ft1 &lt;span class="token operator"&gt;=&lt;/span&gt; dr&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token function"&gt;getFaces&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token function"&gt;get&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token number"&gt;0&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token function"&gt;getFace_token&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;;&lt;/span&gt;
    &lt;span class="token punctuation"&gt;}&lt;/span&gt; &lt;span class="token keyword"&gt;else&lt;/span&gt; &lt;span class="token punctuation"&gt;{&lt;!-- --&gt;&lt;/span&gt;
        &lt;span class="token keyword"&gt;return&lt;/span&gt; &lt;span class="token boolean"&gt;false&lt;/span&gt;&lt;span class="token punctuation"&gt;;&lt;/span&gt;
    &lt;span class="token punctuation"&gt;}&lt;/span&gt;
    &lt;span class="token keyword"&gt;for&lt;/span&gt; &lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token class-name"&gt;String&lt;/span&gt; ft2&lt;span class="token operator"&gt;:&lt;/span&gt; fs&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token function"&gt;getFace_tokens&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt; &lt;span class="token punctuation"&gt;{&lt;!-- --&gt;&lt;/span&gt;
        &lt;span class="token keyword"&gt;if&lt;/span&gt; &lt;span class="token punctuation"&gt;(&lt;/span&gt;faceDao&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token function"&gt;compareFace&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;ft1&lt;span class="token punctuation"&gt;,&lt;/span&gt; ft2&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt; &lt;span class="token punctuation"&gt;{&lt;!-- --&gt;&lt;/span&gt;
            result &lt;span class="token operator"&gt;=&lt;/span&gt; &lt;span class="token boolean"&gt;true&lt;/span&gt;&lt;span class="token punctuation"&gt;;&lt;/span&gt;
        &lt;span class="token punctuation"&gt;}&lt;/span&gt;
    &lt;span class="token punctuation"&gt;}&lt;/span&gt;
    &lt;span class="token keyword"&gt;new&lt;/span&gt; &lt;span class="token class-name"&gt;File&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;filePath&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token function"&gt;delete&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;;&lt;/span&gt; &lt;span class="token comment"&gt;//删除登录人脸&lt;/span&gt;
    &lt;span class="token keyword"&gt;return&lt;/span&gt; result&lt;span class="token punctuation"&gt;;&lt;/span&gt;
&lt;span class="token punctuation"&gt;}&lt;/span&gt;
</code></pre> 
<p><span class="token punctuation">}</span></p> 
<div class="hljs-button {2}"></div> 
<div class="hide-preCode-box"> 
 <span class="hide-preCode-bt"><img class="look-more-preCode contentImg-no-view" src="https://images2.imgbox.com/a3/c6/MUOsQWDy_o.png" alt="" title=""></span> 
</div> 
<ul class="pre-numbering"></ul> 
<ul><li>FaceController</li></ul> 
<pre class="set-code-hide prettyprint"><code class="prism language-java has-numbering">
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>lrk<span class="token punctuation">.</span>travel<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">FaceService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>lrk<span class="token punctuation">.</span>travel<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">ImageUtils</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">ResponseEntity</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Controller</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestParam</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ResponseBody</span><span class="token punctuation">;</span>
</code></pre> 
<p><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span></span><span class="token punctuation">;</span><br> <span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span><br> <span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">UUID</span></span><span class="token punctuation">;</span><br> <span class="token annotation punctuation">@Controller</span><br> <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">“/admin/face”</span><span class="token punctuation">)</span><br> <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FaceController</span> <span class="token punctuation">{ 
  </span></p> 
<pre><code>&lt;span class="token annotation punctuation"&gt;@Autowired&lt;/span&gt;
&lt;span class="token keyword"&gt;private&lt;/span&gt; &lt;span class="token class-name"&gt;FaceService&lt;/span&gt; faceService&lt;span class="token punctuation"&gt;;&lt;/span&gt;
&lt;span class="token comment"&gt;/**
 * 调到录入人脸页面
 * @return
 */&lt;/span&gt;
&lt;span class="token annotation punctuation"&gt;@RequestMapping&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token string"&gt;"/toinput"&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt;
&lt;span class="token keyword"&gt;public&lt;/span&gt; &lt;span class="token class-name"&gt;String&lt;/span&gt; &lt;span class="token function"&gt;toInput&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt; &lt;span class="token punctuation"&gt;{&lt;!-- --&gt;&lt;/span&gt;
    &lt;span class="token keyword"&gt;return&lt;/span&gt; &lt;span class="token string"&gt;"/face/input"&lt;/span&gt;&lt;span class="token punctuation"&gt;;&lt;/span&gt;
&lt;span class="token punctuation"&gt;}&lt;/span&gt;
&lt;span class="token annotation punctuation"&gt;@RequestMapping&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token string"&gt;"/tologin"&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt;
&lt;span class="token keyword"&gt;public&lt;/span&gt; &lt;span class="token class-name"&gt;String&lt;/span&gt; &lt;span class="token function"&gt;toLogin&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt; &lt;span class="token punctuation"&gt;{&lt;!-- --&gt;&lt;/span&gt;
    &lt;span class="token keyword"&gt;return&lt;/span&gt; &lt;span class="token string"&gt;"/face/login"&lt;/span&gt;&lt;span class="token punctuation"&gt;;&lt;/span&gt;
&lt;span class="token punctuation"&gt;}&lt;/span&gt;
&lt;span class="token comment"&gt;/**
 * 录入人脸
 * @param imgData
 * @param request
 * @return
 * @throws IOException
 */&lt;/span&gt;
&lt;span class="token annotation punctuation"&gt;@ResponseBody&lt;/span&gt;
&lt;span class="token annotation punctuation"&gt;@RequestMapping&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token string"&gt;"/upload"&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt;
&lt;span class="token keyword"&gt;public&lt;/span&gt; &lt;span class="token class-name"&gt;ResponseEntity&lt;/span&gt; &lt;span class="token function"&gt;doAdd&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token annotation punctuation"&gt;@RequestParam&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token string"&gt;"imgData"&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt; &lt;span class="token class-name"&gt;String&lt;/span&gt; imgData&lt;span class="token punctuation"&gt;,&lt;/span&gt; &lt;span class="token class-name"&gt;HttpServletRequest&lt;/span&gt; request&lt;span class="token punctuation"&gt;)&lt;/span&gt; &lt;span class="token keyword"&gt;throws&lt;/span&gt; &lt;span class="token class-name"&gt;IOException&lt;/span&gt; &lt;span class="token punctuation"&gt;{&lt;!-- --&gt;&lt;/span&gt;
    &lt;span class="token class-name"&gt;String&lt;/span&gt; savePath &lt;span class="token operator"&gt;=&lt;/span&gt; request&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token function"&gt;getServletContext&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token function"&gt;getRealPath&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token string"&gt;"img/face/"&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;;&lt;/span&gt;
    &lt;span class="token class-name"&gt;String&lt;/span&gt; fileName &lt;span class="token operator"&gt;=&lt;/span&gt; UUID&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token function"&gt;randomUUID&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token function"&gt;toString&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token function"&gt;replaceAll&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token string"&gt;"-"&lt;/span&gt;&lt;span class="token punctuation"&gt;,&lt;/span&gt; &lt;span class="token string"&gt;""&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt; &lt;span class="token operator"&gt;+&lt;/span&gt; &lt;span class="token string"&gt;".png"&lt;/span&gt;&lt;span class="token punctuation"&gt;;&lt;/span&gt;
    &lt;span class="token class-name"&gt;System&lt;/span&gt;&lt;span class="token punctuation"&gt;.&lt;/span&gt;out&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token function"&gt;println&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;savePath&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;;&lt;/span&gt;
    &lt;span class="token class-name"&gt;ImageUtils&lt;/span&gt;&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token function"&gt;generateImage&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;imgData&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token function"&gt;substring&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token number"&gt;22&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;,&lt;/span&gt; savePath&lt;span class="token punctuation"&gt;,&lt;/span&gt; fileName&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;;&lt;/span&gt;
    faceService&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token function"&gt;addFace&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;savePath &lt;span class="token operator"&gt;+&lt;/span&gt; fileName&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;;&lt;/span&gt;
    &lt;span class="token keyword"&gt;return&lt;/span&gt; &lt;span class="token class-name"&gt;ResponseEntity&lt;/span&gt;&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token function"&gt;ok&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token string"&gt;"{\"success\": \"true\"}"&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;;&lt;/span&gt;
&lt;span class="token punctuation"&gt;}&lt;/span&gt;
&lt;span class="token comment"&gt;/**
 * 人脸识别登录
 * @param imgData
 * @param request
 * @return
 * @throws IOException
 */&lt;/span&gt;
&lt;span class="token annotation punctuation"&gt;@ResponseBody&lt;/span&gt;
&lt;span class="token annotation punctuation"&gt;@RequestMapping&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token string"&gt;"/login"&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt;
&lt;span class="token keyword"&gt;public&lt;/span&gt; &lt;span class="token class-name"&gt;ResponseEntity&lt;/span&gt; &lt;span class="token function"&gt;login&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token annotation punctuation"&gt;@RequestParam&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token string"&gt;"imgData"&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt; &lt;span class="token class-name"&gt;String&lt;/span&gt; imgData&lt;span class="token punctuation"&gt;,&lt;/span&gt;
                            &lt;span class="token class-name"&gt;HttpServletRequest&lt;/span&gt; request&lt;span class="token punctuation"&gt;)&lt;/span&gt; &lt;span class="token keyword"&gt;throws&lt;/span&gt; &lt;span class="token class-name"&gt;IOException&lt;/span&gt; &lt;span class="token punctuation"&gt;{&lt;!-- --&gt;&lt;/span&gt;
    &lt;span class="token class-name"&gt;String&lt;/span&gt; savePath &lt;span class="token operator"&gt;=&lt;/span&gt;
            request&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token function"&gt;getServletContext&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token function"&gt;getRealPath&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token string"&gt;"img/face/login/"&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;;&lt;/span&gt;
    &lt;span class="token class-name"&gt;String&lt;/span&gt; fileName &lt;span class="token operator"&gt;=&lt;/span&gt; UUID&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token function"&gt;randomUUID&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token function"&gt;toString&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token function"&gt;replaceAll&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token string"&gt;"-"&lt;/span&gt;&lt;span class="token punctuation"&gt;,&lt;/span&gt; &lt;span class="token string"&gt;""&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt; &lt;span class="token operator"&gt;+&lt;/span&gt;
            &lt;span class="token string"&gt;".png"&lt;/span&gt;&lt;span class="token punctuation"&gt;;&lt;/span&gt;
    &lt;span class="token class-name"&gt;System&lt;/span&gt;&lt;span class="token punctuation"&gt;.&lt;/span&gt;out&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token function"&gt;println&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;savePath&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;;&lt;/span&gt;
    &lt;span class="token class-name"&gt;ImageUtils&lt;/span&gt;&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token function"&gt;generateImage&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;imgData&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token function"&gt;substring&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token number"&gt;22&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;,&lt;/span&gt; savePath&lt;span class="token punctuation"&gt;,&lt;/span&gt; fileName&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;;&lt;/span&gt;
    &lt;span class="token keyword"&gt;boolean&lt;/span&gt; b &lt;span class="token operator"&gt;=&lt;/span&gt; faceService&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token function"&gt;loginByFace&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;savePath &lt;span class="token operator"&gt;+&lt;/span&gt; fileName&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;;&lt;/span&gt;
    &lt;span class="token keyword"&gt;if&lt;/span&gt; &lt;span class="token punctuation"&gt;(&lt;/span&gt;b&lt;span class="token punctuation"&gt;)&lt;/span&gt; &lt;span class="token punctuation"&gt;{&lt;!-- --&gt;&lt;/span&gt;
        &lt;span class="token class-name"&gt;System&lt;/span&gt;&lt;span class="token punctuation"&gt;.&lt;/span&gt;out&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token function"&gt;println&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token string"&gt;"登录成功"&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;;&lt;/span&gt;
        &lt;span class="token keyword"&gt;return&lt;/span&gt; &lt;span class="token class-name"&gt;ResponseEntity&lt;/span&gt;&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token function"&gt;ok&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token string"&gt;"{\"success\": true}"&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;;&lt;/span&gt;
    &lt;span class="token punctuation"&gt;}&lt;/span&gt; &lt;span class="token keyword"&gt;else&lt;/span&gt; &lt;span class="token punctuation"&gt;{&lt;!-- --&gt;&lt;/span&gt;
        &lt;span class="token class-name"&gt;System&lt;/span&gt;&lt;span class="token punctuation"&gt;.&lt;/span&gt;out&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token function"&gt;println&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token string"&gt;"登录失败"&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;;&lt;/span&gt;
        &lt;span class="token keyword"&gt;return&lt;/span&gt; &lt;span class="token class-name"&gt;ResponseEntity&lt;/span&gt;&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token function"&gt;ok&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;&lt;span class="token string"&gt;"{\"success\": false}"&lt;/span&gt;&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;;&lt;/span&gt;
    &lt;span class="token punctuation"&gt;}&lt;/span&gt;
&lt;span class="token punctuation"&gt;}&lt;/span&gt;
</code></pre> 
<p><span class="token punctuation">}</span></p> 
<div class="hljs-button {2}"></div> 
<div class="hide-preCode-box"> 
 <span class="hide-preCode-bt"><img class="look-more-preCode contentImg-no-view" src="https://images2.imgbox.com/28/58/t5xQY12I_o.png" alt="" title=""></span> 
</div> 
<ul class="pre-numbering"></ul> 
<div> 
 <div></div> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4092d60f9c6de8e72d5bb11ca0ad9c2e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">python爬取视频</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1e34bdbd0c568284a65243129bc556f6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">csv文件的读与写</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>