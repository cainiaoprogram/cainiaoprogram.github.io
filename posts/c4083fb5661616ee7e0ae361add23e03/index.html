<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>华为BGP协议基础配置 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="华为BGP协议基础配置" />
<meta property="og:description" content="目录
一、原理概述
二、实验目的
三、实验拓扑
四、实验步骤
五、查看代码：
一、原理概述 1、自治系统（AS）是由一个技术管理机构管理，使用统一选路策略的一组路由器集合,自治系统编号范围：1-65535，其中1-64511是互联网上注册公有AS号，类似公网IP地址。64512-65535是私有AS号，类似私网IP地址
2、IGP：自治系统内部路由协议，主要：RIP1/RIP2、OSPF、ISIS、EIGRP（思科私有协议.
3、IGP是运行在AS内部的路由协议，主要解决AS内部的选路问题，发现、计算路由EGP：自治系统之间的路由协议，通常：BGP
4、EGP是运行在AS与AS之间的路由协议，他解决AS之间问题。
5、BGP是边界网关协议，版本BGP4，是一种增强的距离矢量路由协议。该协议运行在不同的AS的路由器之间，用于选择AS之间花费最小的协议。BGP协议基于TCP协议端口为179,使用面向连接的TCP可以进行身份认证，可靠地交换路由信息。BGP4&#43;支持IPv6。
特点：
1）、不用周期性发送路由信息。
2）、路由变化，发送增量路由（变化的路由信息）。
3）、周期性发送Keepalive报文效验TCP的连通性。
6、对等体（Peer）
在BGP中，两个路由器之间的相邻连接称为对等体连接，两个路由器互为对等体。如果路由器对等体在同一个AS中，就称为IBGP对等体，否则称为EBGP对等体。BGP4网关向对等实体发布可以到达的AS列表。
7、BGP消息，BGP常见四种报文：OPEN报文、KEEPLIVE报文、UPDATE报文和NOTIFICTION报文。
1）、OPEN报文：建立邻居关系。
2）、KEEPLIVE报文：保持活动状态，周期性确认邻居关系，对OPEN报文回应。
3）、UPDATE报文：发送新的路由信息。
4）、NOTIFICATION报文：报告检测到的错误。
8、BGP工作流程
1）、BGP路由器直接进行TCP三次握手，建立TCP会话连接。
2）、交换OPEN信息，确定版本等参数，建立邻居关系。
3）、路由器交换所有BGP路由，直到平衡，之后只交换变化了的路由信息。
4）、路由更新由UPDATE完成
5）、通过KEEPALIVE难路由器是否可用。
6）、出现问题，发送NOTIFICATION消息通知错误。
二、实验目的 BGP基本配置AR2、AR3、AR4间配置IBGPAR1、AR2间配置EBGP 三、实验拓扑 四、实验步骤 1、各路由器及PC配置IP地址：
//AR1
[Huawei]sysname AR1
[AR1]int g0/0/0
[AR1-GigabitEthernet0/0/0]ip add 172.16.1.1 24
[AR1-GigabitEthernet0/0/0]int g0/0/01
[AR1-GigabitEthernet0/0/1]ip add 192.168.1.1
[AR1-GigabitEthernet0/0/1]ip add 192.168.1.1 24
[AR1-GigabitEthernet0/0/1]q
[AR1]q
&lt;AR1&gt;sa
//AR2
&lt;Huawei&gt;sys
[Huawei]sysname AR2
[AR2]int g0/0/0
[AR2-GigabitEthernet0/0/0]ip add 172.16.1.2 24
[AR2-GigabitEthernet0/0/0]int g0/0/1
[AR2-GigabitEthernet0/0/1]ip add 172." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/c4083fb5661616ee7e0ae361add23e03/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-12-20T18:14:47+08:00" />
<meta property="article:modified_time" content="2022-12-20T18:14:47+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">华为BGP协议基础配置</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="%E4%B8%80%E3%80%81%E5%8E%9F%E7%90%86%E6%A6%82%E8%BF%B0-toc" style="margin-left:0px;"><a href="#%E4%B8%80%E3%80%81%E5%8E%9F%E7%90%86%E6%A6%82%E8%BF%B0" rel="nofollow">一、原理概述</a></p> 
<p id="%E4%BA%8C%E3%80%81%E5%AE%9E%E9%AA%8C%E7%9B%AE%E7%9A%84-toc" style="margin-left:0px;"><a href="#%E4%BA%8C%E3%80%81%E5%AE%9E%E9%AA%8C%E7%9B%AE%E7%9A%84" rel="nofollow">二、实验目的</a></p> 
<p id="%E4%B8%89%E3%80%81%E5%AE%9E%E9%AA%8C%E6%8B%93%E6%89%91-toc" style="margin-left:0px;"><a href="#%E4%B8%89%E3%80%81%E5%AE%9E%E9%AA%8C%E6%8B%93%E6%89%91" rel="nofollow">三、实验拓扑</a></p> 
<p id="%E5%9B%9B%E3%80%81%E5%AE%9E%E9%AA%8C%E6%AD%A5%E9%AA%A4-toc" style="margin-left:0px;"><a href="#%E5%9B%9B%E3%80%81%E5%AE%9E%E9%AA%8C%E6%AD%A5%E9%AA%A4" rel="nofollow">四、实验步骤</a></p> 
<p id="%E4%BA%94%E3%80%81%E6%9F%A5%E7%9C%8B%E4%BB%A3%E7%A0%81%EF%BC%9A-toc" style="margin-left:0px;"><a href="#%E4%BA%94%E3%80%81%E6%9F%A5%E7%9C%8B%E4%BB%A3%E7%A0%81%EF%BC%9A" rel="nofollow">五、查看代码：</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2 id="%E4%B8%80%E3%80%81%E5%8E%9F%E7%90%86%E6%A6%82%E8%BF%B0" style="text-align:left;"><strong>一、原理概述</strong></h2> 
<p style="margin-left:.0001pt;text-align:left;">1、自治系统（AS）是由一个技术管理机构管理，使用统一选路策略的一组路由器集合,自治系统编号范围：1-65535，其中1-64511是互联网上注册公有AS号，类似公网IP地址。64512-65535是私有AS号，类似私网IP地址</p> 
<p style="margin-left:.0001pt;text-align:left;">2、IGP：自治系统内部路由协议，主要：RIP1/RIP2、OSPF、ISIS、EIGRP（思科私有协议.</p> 
<p style="margin-left:.0001pt;text-align:left;">3、IGP是运行在AS内部的路由协议，主要解决AS内部的选路问题，发现、计算路由EGP：自治系统之间的路由协议，通常：BGP</p> 
<p style="margin-left:.0001pt;text-align:left;">4、EGP是运行在AS与AS之间的路由协议，他解决AS之间问题。</p> 
<p style="margin-left:.0001pt;text-align:left;">5、BGP是边界网关协议，版本BGP4，是一种增强的距离矢量路由协议。该协议运行在不同的AS的路由器之间，用于选择AS之间花费最小的协议。<strong>BGP协议基于TCP协议端口为179,使用面向连接的TCP可以进行身份认证，可靠地交换路由信息。BGP4+支持IPv6。</strong></p> 
<p style="margin-left:.0001pt;text-align:left;">特点：</p> 
<p style="margin-left:.0001pt;text-align:left;">        1）、不用周期性发送路由信息。</p> 
<p style="margin-left:.0001pt;text-align:left;">        2）、路由变化，发送增量路由（变化的路由信息）。</p> 
<p style="margin-left:.0001pt;text-align:left;">        3）、周期性发送Keepalive报文效验TCP的连通性。</p> 
<p style="margin-left:.0001pt;text-align:left;">6、对等体（Peer）</p> 
<p style="margin-left:.0001pt;text-align:left;">在BGP中，两个路由器之间的相邻连接称为对等体连接，两个路由器互为对等体。如果路由器对等体在同一个AS中，就称为IBGP对等体，否则称为EBGP对等体。BGP4网关向对等实体发布可以到达的AS列表。</p> 
<p style="margin-left:.0001pt;text-align:left;">7、BGP消息，BGP常见四种报文：OPEN报文、KEEPLIVE报文、UPDATE报文和NOTIFICTION报文。</p> 
<p style="margin-left:.0001pt;text-align:left;">        1）、OPEN报文：建立邻居关系。</p> 
<p style="margin-left:.0001pt;text-align:left;">        2）、KEEPLIVE报文：保持活动状态，周期性确认邻居关系，对OPEN报文回应。</p> 
<p style="margin-left:.0001pt;text-align:left;">        3）、UPDATE报文：发送新的路由信息。</p> 
<p style="margin-left:.0001pt;text-align:left;">         4）、NOTIFICATION报文：报告检测到的错误。</p> 
<p style="margin-left:.0001pt;text-align:left;"><img alt="" height="402" src="https://images2.imgbox.com/0c/f9/G6W6SA2i_o.png" width="515"></p> 
<p style="margin-left:.0001pt;text-align:left;">8、BGP工作流程</p> 
<p style="margin-left:.0001pt;text-align:left;">        1）、BGP路由器直接进行TCP三次握手，建立TCP会话连接。</p> 
<p style="margin-left:.0001pt;text-align:left;">        2）、交换OPEN信息，确定版本等参数，建立邻居关系。</p> 
<p style="margin-left:.0001pt;text-align:left;">        3）、路由器交换所有BGP路由，直到平衡，之后只交换变化了的路由信息。</p> 
<p style="margin-left:.0001pt;text-align:left;">        4）、路由更新由UPDATE完成</p> 
<p style="margin-left:.0001pt;text-align:left;">        5）、通过KEEPALIVE难路由器是否可用。</p> 
<p style="margin-left:.0001pt;text-align:left;">        6）、出现问题，发送NOTIFICATION消息通知错误。</p> 
<h2 id="%E4%BA%8C%E3%80%81%E5%AE%9E%E9%AA%8C%E7%9B%AE%E7%9A%84" style="text-align:left;"><strong>二、实验目的</strong></h2> 
<ol><li>BGP基本配置</li><li>AR2、AR3、AR4间配置IBGP</li><li>AR1、AR2间配置EBGP</li></ol> 
<h2 style="text-align:left;"></h2> 
<h2 id="%E4%B8%89%E3%80%81%E5%AE%9E%E9%AA%8C%E6%8B%93%E6%89%91" style="text-align:left;"><strong>三、实验拓扑</strong></h2> 
<p><img alt="" height="229" src="https://images2.imgbox.com/c6/71/JCkTqTwd_o.png" width="430"></p> 
<h2 style="text-align:left;"></h2> 
<h2 id="%E5%9B%9B%E3%80%81%E5%AE%9E%E9%AA%8C%E6%AD%A5%E9%AA%A4" style="text-align:left;"><strong>四、实验步骤</strong></h2> 
<p>        1、各路由器及PC配置IP地址：</p> 
<blockquote> 
 <p style="margin-left:.0001pt;text-align:left;">//AR1</p> 
 <p style="margin-left:.0001pt;text-align:left;">[Huawei]sysname AR1</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR1]int g0/0/0</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR1-GigabitEthernet0/0/0]ip add 172.16.1.1 24</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR1-GigabitEthernet0/0/0]int g0/0/01</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR1-GigabitEthernet0/0/1]ip add 192.168.1.1</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR1-GigabitEthernet0/0/1]ip add 192.168.1.1 24</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR1-GigabitEthernet0/0/1]q</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR1]q</p> 
 <p style="margin-left:.0001pt;text-align:left;">&lt;AR1&gt;sa</p> 
 <p style="margin-left:.0001pt;text-align:left;">    //AR2</p> 
 <p style="margin-left:.0001pt;text-align:left;">&lt;Huawei&gt;sys</p> 
 <p style="margin-left:.0001pt;text-align:left;">[Huawei]sysname AR2</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR2]int g0/0/0</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR2-GigabitEthernet0/0/0]ip add 172.16.1.2 24</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR2-GigabitEthernet0/0/0]int g0/0/1</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR2-GigabitEthernet0/0/1]ip add 172.16.2.1 24</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR2-GigabitEthernet0/0/1]int g0/0/2</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR2-GigabitEthernet0/0/2]ip add 172.16.3.1 24</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR2-GigabitEthernet0/0/2]q</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR2]q</p> 
 <p style="margin-left:.0001pt;text-align:left;">&lt;AR2&gt;sa</p> 
 <p style="margin-left:.0001pt;text-align:left;">    //AR3</p> 
 <p style="margin-left:.0001pt;text-align:left;">&lt;Huawei&gt;sys</p> 
 <p style="margin-left:.0001pt;text-align:left;">[Huawei]sysname AR3</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR3]int g0/0/1</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR3-GigabitEthernet0/0/1]ip add 172.16.2.2 24</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR3-GigabitEthernet0/0/1]int g0/0/0</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR3-GigabitEthernet0/0/0]ip add 172.16.4.1 24</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR3-GigabitEthernet0/0/0]q</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR3]q</p> 
 <p style="margin-left:.0001pt;text-align:left;">&lt;AR3&gt;sa</p> 
 <p style="margin-left:.0001pt;text-align:left;">    //AR4</p> 
 <p style="margin-left:.0001pt;text-align:left;">&lt;Huawei&gt;sys</p> 
 <p style="margin-left:.0001pt;text-align:left;">[Huawei]sysname AR4</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR4]int g0/0/2</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR4-GigabitEthernet0/0/2]ip add 172.16.3.2 24</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR4-GigabitEthernet0/0/2]int g0/0/0</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR4-GigabitEthernet0/0/0]ip add 172.16.4.2 24</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR4-GigabitEthernet0/0/0]q</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR4]q</p> 
 <p style="margin-left:.0001pt;text-align:left;">&lt;AR4&gt;sa</p> 
</blockquote> 
<p>2、配置IBGP</p> 
<blockquote> 
 <p style="margin-left:.0001pt;text-align:left;">//AR2</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR2]bgp 65009</p> 
 <p style="margin-left:.0001pt;text-align:left;">##开启编号为65009的BGP服务</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR2-bgp]router-id 2.2.2.2</p> 
 <p style="margin-left:.0001pt;text-align:left;">##用IPV4格式指定路由器标识符，2.2.2.2必须唯一</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR2-bgp]peer 172.16.2.2 as-number 65009</p> 
 <p style="margin-left:.0001pt;text-align:left;">##指定对等体，包括IP地址和自治系统号</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR2-bgp]peer 172.16.3.2 as-number 65009</p> 
 <p style="margin-left:.0001pt;text-align:left;">//AR3</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR3]bgp 65009</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR3-bgp]router-id 3.3.3.3</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR3-bgp]peer 172.16.2.1 as-number 65009</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR3-bgp]peer 172.16.4.2 as-number 65009</p> 
 <p style="margin-left:.0001pt;text-align:left;">//AR4</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR4]bgp 65009</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR4-bgp]router-id 4.4.4.4</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR4-bgp]peer 172.16.4.1 as-number 65009</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR4-bgp]peer 172.16.3.1 as-number 65009</p> 
</blockquote> 
<p>3、配置EBGP</p> 
<blockquote> 
 <p style="margin-left:.0001pt;text-align:left;">//AR1</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR1]BGP 65008</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR1-bgp]router-id 1.1.1.1</p> 
 <p style="margin-left:.0001pt;text-align:left;"> [AR1-bgp]peer 172.16.1.2 as-number 65009</p> 
 <p style="margin-left:.0001pt;text-align:left;">//AR2</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR2]BGP 65009</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR2-bgp]peer 172.16.1.1 as-number 65008</p> 
</blockquote> 
<p>4、配置R1发布路由192.168.1.0/24</p> 
<blockquote> 
 <p style="margin-left:.0001pt;text-align:left;">//AR1</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR1]bgp 65008</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR1-bgp]ipv4-family unicast</p> 
 <p style="margin-left:.0001pt;text-align:left;">##启用IPV4的单播地址</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR1-bgp-af-ipv4]network 192.168.1.0 24</p> 
</blockquote> 
<p> 查看AR3的路由信息（dis bgp routing-table）</p> 
<p><img alt="" height="175" src="https://images2.imgbox.com/80/e1/N3oLd4pq_o.png" width="554"></p> 
<p> AR3虽然学习到192.168.1.0/24路由，但因为下一跳172.16.1.1不可达，所以不是有效路由</p> 
<p>5、配置BGP引入直接路由。</p> 
<blockquote> 
 <p style="margin-left:.0001pt;text-align:left;">//AR2</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR2]bgp 65009</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR2-bgp]ipv4-family unicast</p> 
 <p style="margin-left:.0001pt;text-align:left;">[AR2-bgp-af-ipv4]import-route direct</p> 
</blockquote> 
<h2 id="%E4%BA%94%E3%80%81%E6%9F%A5%E7%9C%8B%E4%BB%A3%E7%A0%81%EF%BC%9A" style="text-align:left;"><strong>五、查看代码：</strong></h2> 
<p style="margin-left:.0001pt;text-align:left;">##查看BGP邻居</p> 
<p style="margin-left:.0001pt;text-align:left;">dis  bgp peer</p> 
<p style="margin-left:.0001pt;text-align:left;">##查看BGP路由表</p> 
<p style="margin-left:.0001pt;text-align:left;">dis routing-table</p> 
<p style="margin-left:.0001pt;text-align:left;">资源下载：<a class="link-info" href="https://download.csdn.net/download/weixin_44712781/87323167" title="华为BGP协议基础配置">华为BGP协议基础配置</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/22f9944b28bc55dc5d68f9ac65bbe209/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">HFSS使用经验</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/08d107488b0445409c1eea089ea7430c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">注意力机制与外部记忆</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>