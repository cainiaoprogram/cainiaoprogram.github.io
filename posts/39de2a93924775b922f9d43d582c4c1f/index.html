<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Qualcomm® AI Engine Direct 使用手册（3） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Qualcomm® AI Engine Direct 使用手册（3）" />
<meta property="og:description" content="Qualcomm® AI Engine Direct 使用手册（3） 3.3 环境设置 4. 后端4.1 后端特定页面4.1.1 数字信号处理器4.1.2 HTP 3.3 环境设置 Linux
满足 Linux 平台依赖性后，可以使用提供的 envsetup 设置用户环境.sh 脚本。
在 Linux 主机上打开命令 shell 并运行：
$ source ${QNN_SDK_ROOT}/bin/envsetup.sh 这将设置/更新以下环境变量：
QNN_SDK_ROOT
Python路径
小路
LD_LIBRARY_PATH
${QNN_SDK_ROOT} 代表 Qualcomm® 的完整路径AI Engine Direct SDK 根目录。
QNN API 标头位于 ${QNN_SDK_ROOT}/include/QNN 中。
工具位于${QNN_SDK_ROOT}/bin/x86_64-linux-clang中。
目标特定后端和其他库位于${QNN_SDK_ROOT}/lib/*/中。
TensorFlow 设置
请使用 https://pypi.org/project/tensorflow/2.10.1/ 将 TensorFlow 安装为独立的 Python 模块 如果安装 tf-1.15.0 请参阅上面的 python3.6 安装部分。确保TensorFlow
在你的 PYTHONPATH 中使用这个测试代码：
$ python3 -c &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/39de2a93924775b922f9d43d582c4c1f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-21T15:58:25+08:00" />
<meta property="article:modified_time" content="2023-12-21T15:58:25+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Qualcomm® AI Engine Direct 使用手册（3）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>Qualcomm® AI Engine Direct 使用手册（3）</h4> 
 <ul><li><ul><li><a href="#33__6" rel="nofollow">3.3 环境设置</a></li></ul> 
  </li><li><a href="#4__108" rel="nofollow">4. 后端</a></li><li><ul><li><a href="#41__122" rel="nofollow">4.1 后端特定页面</a></li><li><ul><li><a href="#411__123" rel="nofollow">4.1.1 数字信号处理器</a></li><li><a href="#412_HTP_153" rel="nofollow">4.1.2 HTP</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<hr> 
<h3><a id="33__6"></a>3.3 环境设置</h3> 
<p>Linux<br> 满足 Linux 平台依赖性后，可以使用提供的 envsetup 设置用户环境.sh 脚本。</p> 
<p>在 Linux 主机上打开命令 shell 并运行：</p> 
<pre><code class="prism language-c">$ source $<span class="token punctuation">{<!-- --></span>QNN_SDK_ROOT<span class="token punctuation">}</span><span class="token operator">/</span>bin<span class="token operator">/</span>envsetup<span class="token punctuation">.</span>sh

</code></pre> 
<p>这将设置/更新以下环境变量：</p> 
<ul><li> <p>QNN_SDK_ROOT</p> </li><li> <p>Python路径</p> </li><li> <p>小路</p> </li><li> <p>LD_LIBRARY_PATH</p> </li></ul> 
<p>${QNN_SDK_ROOT} 代表 Qualcomm® 的完整路径AI Engine Direct SDK 根目录。</p> 
<p>QNN API 标头位于 ${QNN_SDK_ROOT}/include/QNN 中。</p> 
<p>工具位于${QNN_SDK_ROOT}/bin/x86_64-linux-clang中。</p> 
<p>目标特定后端和其他库位于${QNN_SDK_ROOT}/lib/*/中。</p> 
<p>TensorFlow 设置<br> 请使用 https://pypi.org/project/tensorflow/2.10.1/ 将 TensorFlow 安装为独立的 Python 模块 如果安装 tf-1.15.0 请参阅上面的 python3.6 安装部分。确保TensorFlow</p> 
<p>在你的 PYTHONPATH 中使用这个测试代码：</p> 
<pre><code class="prism language-c">$ python3 <span class="token operator">-</span>c <span class="token string">"import tensorflow"</span>

</code></pre> 
<p>请参阅机器学习框架了解有关 Qualcomm® 版本的信息AI Engine Direct SDK已通过验证。请注意<br> 安装 1.15.0 或 2.10.1 之外的 TensorFlow 版本可能会更新依赖项（例如 numpy）。</p> 
<p>ONNX 设置<br> 请使用 将 ONNX 作为独立的 Python 模块安装https://pypi.org/project/onnx/1.11.0/ 并使用以下测试代码确保 ONNX 位于您的 PYTHONPATH 中：</p> 
<pre><code class="prism language-c">$ python3 <span class="token operator">-</span>c <span class="token string">"import onnx"</span>

</code></pre> 
<p>请参阅机器学习框架了解有关 Qualcomm® 版本的信息AI Engine Direct SDK已通过验证。</p> 
<p>TFLite 设置<br> 请使用 https://pypi.org/project/tflite/2.3.0/ 将 TFLite 作为独立的 Python 模块安装 并使用以下测试代码确保 TFLite 位于您的 PYTHONPATH 中：</p> 
<pre><code class="prism language-c">$ python3 <span class="token operator">-</span>c <span class="token string">"import tflite"</span>
</code></pre> 
<p>请参阅机器学习框架了解有关 Qualcomm® 版本的信息AI Engine Direct SDK已通过验证。</p> 
<p>PyTorch 设置<br> 请使用 将 PyTorch v1.13.1 安装为独立的 Python 模块https://pytorch.org/get-started/previous-versions/#v1131 并使用以下测试代码确保 PyTorch 位于您的 PYTHONPATH 中：</p> 
<pre><code class="prism language-c">$ python3 <span class="token operator">-</span>c <span class="token string">"import torch"</span>
</code></pre> 
<p>请参阅机器学习框架了解有关 Qualcomm® 版本的信息AI Engine Direct SDK已通过验证。</p> 
<p>视窗<br> 满足 Windows 平台依赖关系后，可以使用提供的 envsetup 设置用户环境.ps1 脚本。</p> 
<p>首先，以管理员身份打开。Developer PowerShell for VS2022</p> 
<pre><code class="prism language-c">$ Set<span class="token operator">-</span>ExecutionPolicy RemoteSigned
</code></pre> 
<p>然后，执行以下脚本。</p> 
<pre><code class="prism language-c">$ <span class="token operator">&amp;</span> <span class="token string">"&lt;QNN_SDK_ROOT&gt;\bin\envsetup.ps1"</span>
</code></pre> 
<p>这将设置/更新以下环境变量：</p> 
<ul><li>QNN_SDK_ROOT</li></ul> 
<p>${QNN_SDK_ROOT} 代表 Qualcomm® 的完整路径AI Engine Direct SDK 根目录。</p> 
<p>QNN API 标头位于 ${QNN_SDK_ROOT}/include/QNN 中。</p> 
<p>工具位于${QNN_SDK_ROOT}/bin/x86_64-linux-clang中。</p> 
<p>目标特定后端和其他库位于${QNN_SDK_ROOT}/lib/*/中。</p> 
<blockquote> 
 <p>笔记<br> envsetup.ps1只需要在 Windows 主机上执行。</p> 
</blockquote> 
<h2><a id="4__108"></a>4. 后端</h2> 
<p>客户端通过后端与 Qualcomm® 交互AI Engine Direct。一般来说，Qualcomm® AI Engine Direct 后端是一个软件实体 它实现了QNN API，并且通常以 共享库。术语“QNN 后端”和“QNN 后端库”经常互换使用。</p> 
<p>QNN 后端库为每个硬件加速器核心提供集成模块化（如概述部分所述）。</p> 
<p>QNN SDK 提供了多个后端库。这些库可以在 &lt;QNN_SDK_ROOT&gt;/lib/ 文件夹中找到。 QNN 后端库遵循与平台相关的命名规则（有关更多详细信息，请参阅平台差异）。 在可用后端库表库描述中，我们通过与平台无关的名称来引用后端库。</p> 
<center>
  可用的 QNN SDK 后端库 
</center> 
<p><img src="https://images2.imgbox.com/1e/e8/3qcTlACi_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/b8/cf/MK0ZjHX4_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/f9/3c/tWmRUV84_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="41__122"></a>4.1 后端特定页面</h3> 
<h4><a id="411__123"></a>4.1.1 数字信号处理器</h4> 
<p>本节提供特定于 QNN DSP 后端的信息。</p> 
<p><strong>API 专业化</strong></p> 
<p>本节包含与 DSP 后端 API 专业化相关的信息。所有QNN DSP 后端专业化可在 &lt;QNN_SDK_ROOT&gt;/include/QNN/DSP/ 目录下找到。</p> 
<p>QNN DSP 后端 API 的当前版本是：</p> 
<p>QNN_DSP_API_VERSION_MAJOR 5</p> 
<p>QNN_DSP_API_VERSION_MINOR 0</p> 
<p>QNN_DSP_API_VERSION_PATCH 1</p> 
<p>QNN DSP 性能基础架构 API<br> 客户端可以调用 QnnBackend_getPerfInfrastruct 加载 QNN DSP 库后，然后调用可用的方法 文件 QnnDspPerfInfrastruct.h。这些 API 允许客户端控制 DSP 加速器的系统设置，从而对加速器进行细粒度控制。 一些用例是：</p> 
<ol><li> <p>通过控制电压角点来设置投票策略。</p> </li><li> <p>设置 DCVS 模式以实现适用于用例的不同性能设置。</p> </li><li> <p>设置加速器的线程数。</p> </li></ol> 
<p>笔记：</p> 
<ol><li> <p>如果 dcvsEnableConfig 为 DCVS 参与标志，则 DCVS 参与标志将设置为 FALSE QnnDspPerfInfrastruct_DcvsEnable_t 未提供。</p> </li><li> <p>在电源设置调用中，如果未指定电源模式，则电源模式将设置为省电模式 配置的一部分。</p> </li></ol> 
<h4><a id="412_HTP_153"></a>4.1.2 HTP</h4> 
<p>本节提供特定于 QNN HTP 后端的信息。</p> 
<ul><li> <p>API 专业化</p> </li><li> <p>使用预期</p> </li><li> <p>QNN HTP 支持的操作</p> </li><li> <p>QNN HTP 后端 API</p> </li><li> <p>QNN HTP 性能基础架构 API</p> </li><li> <p>QNN HTP精密</p> </li><li> <p>QNN HTP FP16 SM8550 和 SM8650 输出差异</p> </li><li> <p>QNN HTP 深度学习带宽压缩 (DLBC)</p> </li><li> <p>QNN HTP - 设置 HVX 线程数</p> </li><li> <p>QNN HTP 后端扩展</p> </li><li> <p>QNN HTP 分析</p> </li><li> <p>QNN 上下文二进制大小</p> </li><li> <p>Op写作指南</p> </li><li> <p>网络设计建议</p> </li><li> <p>VTCM分享</p> </li><li> <p>子系统重启 (SSR)</p> </li><li> <p>Qmem 图（仅共享缓冲区图）</p> </li><li> <p>批量推理和多线程推理的好处</p> </li></ul> 
<p><strong>API 专业化</strong></p> 
<p>本部分包含与 HTP 后端 API 专业化相关的信息。所有 QNN HTP 后端专业化可在 &lt;QNN_SDK_ROOT&gt;/include/QNN/HTP/ 目录下找到。</p> 
<p>QNN HTP 后端 API 的当前版本是：</p> 
<p>QNN_HTP_API_VERSION_MAJOR 5<br> QNN_HTP_API_VERSION_MINOR 17<br> QNN_HTP_API_VERSION_PATCH 0</p> 
<p><strong>使用预期</strong></p> 
<ol><li> <p>调用 QnnGraph_addNode() 的顺序 构建QNN模型应该按照节点依赖顺序完成。</p> </li><li> <p>QnnBackend_registerOpPackage() 接受一个名为“target”的可选参数。</p> <p>下面给出的是“目标”的可接受值</p> 
  <ul><li> <p>“CPU” - 适用于 linux x86 和 ARM op 软件包</p> </li><li> <p>“HTP” - 用于加载到 HTP 上的 op 包。</p> </li><li> <p>空指针</p> 
    <ul><li> <p>用于在 ARM 上加载上下文二进制文件 - 加载已注册的 HTP op 包</p> </li><li> <p>对于 linux x86 - 注册 linux x86 op 包</p> </li></ul> </li></ul> </li><li> <p>加载为不同 HTP 架构生成的上下文二进制文件可能会给出不确定的结果。</p> </li></ol> 
<p><strong>QNN HTP 支持的操作</strong></p> 
<p>QNN HTP 支持在所有 Qualcomm SoC 上运行量化 8 位和量化 16 位网络。 QNN HTP Quant 运行时支持的操作列表可以在后端支持 HTP 列下查看 支持的操作</p> 
<p>QNN HTP 支持在选定的 Qualcomm SoC 上使用 float16 数学运行 float32 网络。 如果 QNN SDK 支持 QNN HTP Float，则 HTP Float 运行时支持的操作列表 可以在支持的操作中的后端支持 HTP_FP16 列中看到</p> 
<p>对于支持 QNN HTP Float 的 QNN SDK，请注意，即使 HTP 和 HTP_FP16 在支持的操作的单独列下列出，它们是 单一“逻辑”后端。在选定的 SoC 上，QNN HTP 后端库支持量化和浮点网络。 单独的列是为了区分不同支持的操作列表 量化和浮动 QNN HTP 运行时。</p> 
<p><strong>QNN HTP 可变批次</strong></p> 
<p>QNN HTP 以有限的方式支持可变批量维度。图执行时的批量维度可以是 图表准备中提供的相应维度的整数倍。所有输入和输出张量必须具有 同一批次的多个。例如，如果图准备中提供的张量维度为 [b,h,w,d]，则 可以使用维度为 [n*b,h,w,d] 的张量来执行图，其中 n 是正整数。</p> 
<p><strong>QNN HTP 后端 API</strong><br> File QnnHtpDevice.h 是与 文件 QnnDevice.h。该头文件允许客户端将 QnnDevice 配置为 满足特定的用例。</p> 
<p>结构体 QnnHtpGraph_CustomConfig_t 在 文件 QnnHtpGraph.h 中定义 是与 File QnnGraph.h 一起使用的后端专业化标头</p> 
<center>
  QNN HTP 设备配置选项 (QnnHtpDevice_CustomConfig_t) 
</center> 
<table><thead><tr><th>选项名称</th><th>选项 说明</th><th>默认</th><th>何时使用</th></tr></thead><tbody><tr><td>QNN_HTP_DEVICE_CONFIG_OPTION_SOC</td><td>用于识别 SoC 型号的整数值</td><td>QNN_SOC_MODEL_SM8350</td><td>客户端可以提供 socModel 来指示目标 SoC</td></tr><tr><td>QNN_HTP_DEVICE_CONFIG_OPTION_ARCH</td><td>用于配置设备以设置 HTP Arch 的数据结构。驱动程序将使用ops 与此 HTP Arch 兼容</td><td>QNN_HTP_DEVICE_ARCH_NONE</td><td>当使用多个设备时，客户端可以作为自定义配置的一部分提供</td></tr><tr><td>QNN_HTP_DEVICE_CONFIG_OPTION_SIGNEDPD</td><td>启用签名的进程域。为了使用这个标志，客户端还需要推送一个签名的 dsp 图像到目标</td><td>False（未签名的进程域）</td><td>客户端使用签名的进程域。查看 Hexagon SDK 文档了解更多详细信息。</td></tr></tbody></table> 
<p>客户端可以设置SocModel如下： 参考Qnn_SocModel_t设置Soc Model。</p> 
<pre><code class="prism language-c">QnnHtpDevice_CustomConfig_t customConfig<span class="token punctuation">;</span>
customConfig<span class="token punctuation">.</span>option   <span class="token operator">=</span> QNN_HTP_DEVICE_CONFIG_OPTION_SOC<span class="token punctuation">;</span>
customConfig<span class="token punctuation">.</span>socModel <span class="token operator">=</span> QNN_SOC_MODEL_SM8550<span class="token punctuation">;</span>
QnnDevice_Config_t devConfig<span class="token punctuation">;</span>
devConfig<span class="token punctuation">.</span>option <span class="token operator">=</span> QNN_DEVICE_CONFIG_OPTION_CUSTOM<span class="token punctuation">;</span>
devConfig<span class="token punctuation">.</span>customConfig <span class="token operator">=</span> <span class="token operator">&amp;</span>customConfig<span class="token punctuation">;</span>
<span class="token keyword">const</span> QnnDevice_Config_t<span class="token operator">*</span> pDeviceConfig<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token operator">&amp;</span>devConfig<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>客户端可以设置Htp架构如下： 请参考QnnHtpDevice_Arch_t设置Htp Arch。</p> 
<pre><code class="prism language-c">QnnHtpDevice_CustomConfig_t customConfig<span class="token punctuation">;</span>
customConfig<span class="token punctuation">.</span>option    <span class="token operator">=</span> QNN_HTP_DEVICE_CONFIG_OPTION_ARCH<span class="token punctuation">;</span>
customConfig<span class="token punctuation">.</span>arch<span class="token punctuation">.</span>arch <span class="token operator">=</span> QNN_HTP_DEVICE_ARCH_V73<span class="token punctuation">;</span>
customConfig<span class="token punctuation">.</span>arch<span class="token punctuation">.</span>deviceId <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">// Id of device to be used. If single device is used by default 0.</span>
QnnDevice_Config_t devConfig<span class="token punctuation">;</span>
devConfig<span class="token punctuation">.</span>option <span class="token operator">=</span> QNN_DEVICE_CONFIG_OPTION_CUSTOM<span class="token punctuation">;</span>
devConfig<span class="token punctuation">.</span>customConfig <span class="token operator">=</span> <span class="token operator">&amp;</span>customConfig<span class="token punctuation">;</span>
<span class="token keyword">const</span> QnnDevice_Config_t<span class="token operator">*</span> pDeviceConfig<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token operator">&amp;</span>devConfig<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>客户可以设置签名PD如下：</p> 
<pre><code class="prism language-c">QnnHtpDevice_CustomConfig_t customConfig<span class="token punctuation">;</span>
customConfig<span class="token punctuation">.</span>option    <span class="token operator">=</span> QNN_HTP_DEVICE_CONFIG_OPTION_SIGNEDPD<span class="token punctuation">;</span>
customConfig<span class="token punctuation">.</span>useSignedProcessDomain<span class="token punctuation">.</span>useSignedProcessDomain <span class="token operator">=</span> true<span class="token punctuation">;</span>
customConfig<span class="token punctuation">.</span>useSignedProcessDomain<span class="token punctuation">.</span>deviceId <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>   <span class="token comment">// Id of device to be used. If single device is used by default 0.</span>
QnnDevice_Config_t devConfig<span class="token punctuation">;</span>
devConfig<span class="token punctuation">.</span>option <span class="token operator">=</span> QNN_DEVICE_CONFIG_OPTION_CUSTOM<span class="token punctuation">;</span>
devConfig<span class="token punctuation">.</span>customConfig <span class="token operator">=</span> <span class="token operator">&amp;</span>customConfig<span class="token punctuation">;</span>
<span class="token keyword">const</span> QnnDevice_Config_t<span class="token operator">*</span> pDeviceConfig<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token operator">&amp;</span>devConfig<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<center>
  QNN HTP 上下文配置选项 (QnnHtpContext_CustomConfig_t) 
</center> 
<p><img src="https://images2.imgbox.com/36/f5/0qGk6TSJ_o.png" alt="在这里插入图片描述"><br> 客户端可以按如下方式启用权重共享：</p> 
<pre><code class="prism language-c">QnnHtpContext_CustomConfig_t customConfig<span class="token punctuation">;</span>
customConfig<span class="token punctuation">.</span>option  <span class="token operator">=</span> QNN_HTP_CONTEXT_CONFIG_OPTION_WEIGHT_SHARING_ENABLED<span class="token punctuation">;</span>
customConfig<span class="token punctuation">.</span>weightSharingEnabled <span class="token operator">=</span> true<span class="token punctuation">;</span>  <span class="token comment">// set to false to disable weight sharing</span>
QnnContext_Config_t contextConfig<span class="token punctuation">;</span>
contextConfig<span class="token punctuation">.</span>option       <span class="token operator">=</span> QNN_CONTEXT_CONFIG_OPTION_CUSTOM<span class="token punctuation">;</span>
contextConfig<span class="token punctuation">.</span>customConfig <span class="token operator">=</span> <span class="token operator">&amp;</span>customConfig<span class="token punctuation">;</span>
<span class="token keyword">const</span> QnnContext_Config_t<span class="token operator">*</span> pContextConfig<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token operator">&amp;</span>contextConfig<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre> 
<blockquote> 
 <p>笔记<br> 权重共享功能有一定的要求和限制：<br> 仅支持离线准备。不支持在线准备和ARM离线准备。<br> 仅支持 Hexagon V75 架构。<br> 仅在单个 PD 内支持。跨 PD 或跨不同 VTCM 尺寸和 SoC 共享 不支持。<br> 任何以前生成的二进制文件都不会自动受益于权重共享。用户是 需要重新生成新的序列化二进制文件才能从权重共享中受益。旧的序列化二进制文件 在没有重量共享功能的情况下仍然可以工作。</p> 
</blockquote> 
<p>客户端可以为多个上下文设置共享溢出填充缓冲区详细信息，如下所示：</p> 
<blockquote> 
 <p>笔记<br> 此功能仅针对离线准备用例启用。在创建期间 二进制 blob (qnn-context-binary-generator)，每个图的溢出填充缓冲区信息 在 x86 上准备时打印如下：</p> 
</blockquote> 
<pre><code class="prism language-c"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token string">"====== Prepared Graph's Summary ======"</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token string">"Spill fill buffer size = 30081024"</span>
</code></pre> 
<pre><code class="prism language-c"> <span class="token comment">// ===== FIRST CONTEXT =====</span>
 QnnHtpContext_CustomConfig_t customConfig<span class="token punctuation">;</span>
customConfig<span class="token punctuation">.</span>option <span class="token operator">=</span> QNN_HTP_CONTEXT_CONFIG_OPTION_REGISTER_MULTI_CONTEXTS<span class="token punctuation">;</span> QnnHtpContext_GroupRegistration_t groupInfo<span class="token punctuation">;</span>
groupInfo<span class="token punctuation">.</span>firstGroupHandle      <span class="token operator">=</span> <span class="token number">0x0</span><span class="token punctuation">;</span>      <span class="token comment">// New group</span>
groupInfo<span class="token punctuation">.</span>maxSpillFillBuffer    <span class="token operator">=</span> <span class="token number">30081024</span><span class="token punctuation">;</span> <span class="token comment">// Max spill-fill buffer across contexts. Must be &gt;0</span>
customConfig<span class="token punctuation">.</span>groupRegistration  <span class="token operator">=</span> groupInfo<span class="token punctuation">;</span>
QnnContext_Config_t<span class="token operator">*</span> cfgs<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token operator">&amp;</span>customConfig<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">QnnContext_createFromBinary</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> cfgs<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>contextHandle<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ===== SECOND CONTEXT =====</span>
QnnHtpContext_CustomConfig_t customConfig2<span class="token punctuation">;</span>
customConfig2<span class="token punctuation">.</span>option <span class="token operator">=</span> QNN_HTP_CONTEXT_CONFIG_OPTION_REGISTER_MULTI_CONTEXTS<span class="token punctuation">;</span>
QnnHtpContext_GroupRegistration_t groupInfo2<span class="token punctuation">;</span>
groupInfo2<span class="token punctuation">.</span>firstGroupHandle      <span class="token operator">=</span> contextHandle<span class="token punctuation">;</span>  <span class="token comment">// associated to above contextHandle</span>
groupInfo2<span class="token punctuation">.</span>maxSpillFillBuffer    <span class="token operator">=</span> <span class="token number">30081024</span><span class="token punctuation">;</span>       <span class="token comment">// same value as above OR don't set this now</span>
customConfig2<span class="token punctuation">.</span>groupRegistration  <span class="token operator">=</span> groupInfo2<span class="token punctuation">;</span>
QnnContext_Config_t<span class="token operator">*</span> cfgs2<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token operator">&amp;</span>customConfig2<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">QnnContext_createFromBinary</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> cfgs2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>contextHandle2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ===== THIRD CONTEXT =====</span>
QnnHtpContext_CustomConfig_t customConfig3<span class="token punctuation">;</span>
customConfig3<span class="token punctuation">.</span>option <span class="token operator">=</span> QNN_HTP_CONTEXT_CONFIG_OPTION_REGISTER_MULTI_CONTEXTS<span class="token punctuation">;</span>
QnnHtpContext_GroupRegistration_t groupInfo3<span class="token punctuation">;</span>
groupInfo3<span class="token punctuation">.</span>firstGroupHandle      <span class="token operator">=</span> contextHandle<span class="token punctuation">;</span>  <span class="token comment">// associated to above contextHandle</span>
groupInfo3<span class="token punctuation">.</span>maxSpillFillBuffer    <span class="token operator">=</span> <span class="token number">30081024</span><span class="token punctuation">;</span>       <span class="token comment">// same value as above or don't set this</span>
customConfig3<span class="token punctuation">.</span>groupRegistration  <span class="token operator">=</span> groupInfo3<span class="token punctuation">;</span>
QnnContext_Config_t<span class="token operator">*</span> cfgs3<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token operator">&amp;</span>customConfig3<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">QnnContext_createFromBinary</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> cfgs3<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>contextHandle3<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> 
<center>
  QNN HTP 图形配置选项 (QnnHtpGraph_CustomConfig_t) 
</center> 
<p><img src="https://images2.imgbox.com/17/5a/ozi76zh0_o.png" alt="在这里插入图片描述"><br> QNN_HTP_GRAPH_OPTIMIZATION_TYPE_FINALIZE_OPTIMIZATION_FLAG = 3 配置将考虑在内 QNN_HTP_DEVICE_CONFIG_OPTION_SOC 配置（如果可能）。当考虑SOC信息时 帐户，O3配置预计在大多数情况下提供更优化的图，但可能会导致 在某些情况下不太理想的图。此外，它可能会产生可能更大的上下文二进制大小，因此 图表加载时间可能会降低。</p> 
<blockquote> 
 <p>笔记<br> 建议在以下部分之前参考 Hexagon SDK 文档，因为这很重要 此处描述的功能本质上使用 Hexagon SDK API。</p> 
</blockquote> 
<p>如果用户同时指定 QNN_HTP_DEVICE_CONFIG_OPTION_SOC 和 QNN_HTP_DEVICE_CONFIG_OPTION_ARCH ，HTP后端驱动程序使用QNN_HTP_DEVICE_CONFIG_OPTION_SOC配置并忽略 QNN_HTP_DEVICE_CONFIG_OPTION_ARCH 配置。我们建议使用 QNN_HTP_DEVICE_CONFIG_OPTION_SOC 而不是 QNN_HTP_DEVICE_CONFIG_OPTION_ARCH。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ef3f028eb4b152a04b419ecd8732e248/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">论文阅读之《Underwater scene prior inspired deep underwater image and video Enhancement (UWCNN)》</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c03efde37cc77decac7dab70e65a76fd/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">PyTorch模型部署流程(ONNX Runtime)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>