<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>redis部署 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="redis部署" />
<meta property="og:description" content="redis安装部署 文章目录 redis安装部署一、Redis介绍二、Redis的安装三、Redis的部署四、Redis 操作常用命令五、redis配置文件常用配置 一、Redis介绍 Redis是当前比较热门的NOSQL系统之一，它是一个key-value存储系统。和Memcache类似，但很大程度补偿了Memcache的不足，它支持存储的value类型相对更多，包括string、list、set、zset和hash。这些数据类型都支持push/pop、add/remove及取交集并集和差集及更丰富的操作。在此基础上，Redis支持各种不同方式的排序。
和Memcache一样，Redis数据都是缓存在计算机内存中，不同的是，Memcache只能将数据缓存到内存中，无法自动定期写入硬盘，这就表示，一断电或重启，内存清空，数据丢失。所以Memcache的应用场景适用于缓存无需持久化的数据。而Redis不同的是它会周期性的把更新的数据写入磁盘或者把修改操作写入追加的记录文件，实现数据的持久化。
二、Redis的安装 redis下载请往http://download.redis.io/releases/
# 下载redis的安装包并解压至/usr/local [root@localhost ~]# cd /usr/src/ [root@localhost src]# wget http://download.redis.io/releases/redis-4.0.14.tar.gz [root@localhost src]# ls debug kernels redis-4.0.14.tar.gz [root@localhost src]# tar xf redis-4.0.14.tar.gz -C /usr/local/ # 编译redis [root@localhost src]# cd /usr/local/redis-4.0.14/ [root@localhost redis-4.0.14]# make # 编译完成之后，可以看到解压文件redis-3.0.7 中会有对应的src、conf等文件夹 [root@localhost redis-4.0.14]# ls 00-RELEASENOTES CONTRIBUTING deps Makefile README.md runtest runtest-sentinel src utils BUGS COPYING INSTALL MANIFESTO redis.conf runtest-cluster sentinel.conf tests # 进入到src 目录，执行 make install ; 通过这个命令，会把src目录下便宜生成的6个命令安装到/usr/local/bin下 [root@localhost redis-4." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/11d84eb27e57502232e2c288c6e0a7fe/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-09-08T09:10:32+08:00" />
<meta property="article:modified_time" content="2019-09-08T09:10:32+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">redis部署</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-github-gist">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="redis_0"></a>redis安装部署</h2> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#redis_0" rel="nofollow">redis安装部署</a></li><li><ul><li><a href="#Redis_2" rel="nofollow">一、Redis介绍</a></li><li><a href="#Redis_5" rel="nofollow">二、Redis的安装</a></li><li><a href="#Redis_31" rel="nofollow">三、Redis的部署</a></li><li><a href="#Redis__93" rel="nofollow">四、Redis 操作常用命令</a></li><li><a href="#redis_101" rel="nofollow">五、redis配置文件常用配置</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="Redis_2"></a>一、Redis介绍</h3> 
<p>Redis是当前比较热门的NOSQL系统之一，它是一个key-value存储系统。和Memcache类似，但很大程度补偿了Memcache的不足，它支持存储的value类型相对更多，包括string、list、set、zset和hash。这些数据类型都支持push/pop、add/remove及取交集并集和差集及更丰富的操作。在此基础上，Redis支持各种不同方式的排序。<br> 和Memcache一样，Redis数据都是缓存在计算机内存中，不同的是，Memcache只能将数据缓存到内存中，无法自动定期写入硬盘，这就表示，一断电或重启，内存清空，数据丢失。所以Memcache的应用场景适用于缓存无需持久化的数据。而Redis不同的是它会周期性的把更新的数据写入磁盘或者把修改操作写入追加的记录文件，实现数据的持久化。</p> 
<h3><a id="Redis_5"></a>二、Redis的安装</h3> 
<p>redis下载请往http://download.redis.io/releases/</p> 
<pre><code># 下载redis的安装包并解压至/usr/local
[root@localhost ~]# cd /usr/src/
[root@localhost src]# wget http://download.redis.io/releases/redis-4.0.14.tar.gz
[root@localhost src]# ls
debug  kernels  redis-4.0.14.tar.gz
[root@localhost src]# tar xf redis-4.0.14.tar.gz -C /usr/local/

# 编译redis
[root@localhost src]# cd /usr/local/redis-4.0.14/
[root@localhost redis-4.0.14]# make

# 编译完成之后，可以看到解压文件redis-3.0.7 中会有对应的src、conf等文件夹
[root@localhost redis-4.0.14]# ls
00-RELEASENOTES  CONTRIBUTING  deps     Makefile   README.md   runtest          runtest-sentinel  src    utils
BUGS             COPYING       INSTALL  MANIFESTO  redis.conf  runtest-cluster  sentinel.conf     tests

# 进入到src 目录，执行 make install ; 通过这个命令，会把src目录下便宜生成的6个命令安装到/usr/local/bin下
[root@localhost redis-4.0.14]# cd src/
[root@localhost src]# make install
过程略...
[root@localhost ~]# ls /usr/local/bin/
redis-benchmark  redis-check-aof  redis-check-rdb  redis-cli  redis-sentinel  redis-server
</code></pre> 
<h3><a id="Redis_31"></a>三、Redis的部署</h3> 
<pre><code># 把参数文件，拷贝到 /usr/local/etc/redis 目录下，这个目录需要自己手工创建
[root@localhost ~]# mkdir /usr/local/etc/redis
[root@localhost ~]# cp /usr/local/redis-4.0.14/redis.conf /usr/local/etc/redis/
[root@localhost ~]# ls /usr/local/etc/redis/
redis.conf

# 可以which 命令，看是否找到，能找到，就可以执行
[root@localhost ~]# which redis-server
/usr/local/bin/redis-server

# 直接启动界面如下
[root@localhost ~]# redis-server
5640:C 05 Sep 21:27:23.314 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo
5640:C 05 Sep 21:27:23.314 # Redis version=4.0.14, bits=64, commit=00000000, modified=0, pid=5640, just started
5640:C 05 Sep 21:27:23.314 # Warning: no config file specified, using the default config. In order to specify a config file use redis-server /path/to/redis.conf
5640:M 05 Sep 21:27:23.315 * Increased maximum number of open files to 10032 (it was originally set to 1024).
                _._                                                  
           _.-``__ ''-._                                             
      _.-``    `.  `_.  ''-._           Redis 4.0.14 (00000000/0) 64 bit
  .-`` .-```.  ```\/    _.,_ ''-._                                   
 (    '      ,       .-`  | `,    )     Running in standalone mode
 |`-._`-...-` __...-.``-._|'` _.-'|     Port: 6379
 |    `-._   `._    /     _.-'    |     PID: 5640
  `-._    `-._  `-./  _.-'    _.-'                                   
 |`-._`-._    `-.__.-'    _.-'_.-'|                                  
 |    `-._`-._        _.-'_.-'    |           http://redis.io        
  `-._    `-._`-.__.-'_.-'    _.-'                                   
 |`-._`-._    `-.__.-'    _.-'_.-'|                                  
 |    `-._`-._        _.-'_.-'    |                                  
  `-._    `-._`-.__.-'_.-'    _.-'                                   
      `-._    `-.__.-'    _.-'                                       
          `-._        _.-'                                           
              `-.__.-'                                               

5640:M 05 Sep 21:27:23.315 # WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.
5640:M 05 Sep 21:27:23.315 # Server initialized
5640:M 05 Sep 21:27:23.315 # WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add 'vm.overcommit_memory = 1' to /etc/sysctl.conf and then reboot or run the command 'sysctl vm.overcommit_memory=1' for this to take effect.
5640:M 05 Sep 21:27:23.316 # WARNING you have Transparent Huge Pages (THP) support enabled in your kernel. This will create latency and memory usage issues with Redis. To fix this issue run the command 'echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled' as root, and add it to your /etc/rc.local in order to retain the setting after a reboot. Redis must be restarted after THP is disabled.
5640:M 05 Sep 21:27:23.316 * Ready to accept connections

# 注意：这里直接执行Redis-server 启动的Redis服务，是在前台直接运行的(效果如上图)，也就是说，执行完该命令后，如果Lunix关闭当前会话，则Redis服务也随即关闭。正常情况下，启动Redis服务需要从后台启动，并且指定启动配置文件。

#  后台启动redis服务
## 首先编辑conf文件，将daemonize属性改为yes（表明需要在后台运行）
[root@localhost ~]# vim /usr/local/etc/redis/redis.conf
daemonize yes     ## 修改为yes

# 再次启动redis服务，并指定启动服务配置文件
[root@localhost ~]# redis-server /usr/local/etc/redis/redis.conf
5652:C 05 Sep 21:33:13.053 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo
5652:C 05 Sep 21:33:13.053 # Redis version=4.0.14, bits=64, commit=00000000, modified=0, pid=5652, just started
5652:C 05 Sep 21:33:13.053 # Configuration loaded


# 服务端启动成功后，执行redis-cli启动Redis 客户端，查看端口号。
[root@localhost ~]# redis-cli
127.0.0.1:6379&gt; exit
[root@localhost ~]# ss -antl |grep 6379
LISTEN     0      128    127.0.0.1:6379                     *:*   
</code></pre> 
<h3><a id="Redis__93"></a>四、Redis 操作常用命令</h3> 
<pre><code>Redis-server /usr..../redis.conf   启动redis服务，并指定配置文件
Redis-cli 	 启动redis 客户端
Pkill redis-server  关闭redis服务
Redis-cli shutdown  关闭redis客户端
Netstat -tunpl|grep 6379  查看redis 默认端口号6379占用情况
</code></pre> 
<h3><a id="redis_101"></a>五、redis配置文件常用配置</h3> 
<pre><code>1. Redis默认不是以守护进程的方式运行，可以通过该配置项修改，使用yes启用守护进程
   
    daemonize no

2. 当Redis以守护进程方式运行时，Redis默认会把pid写入/var/run/redis.pid文件，可以通过pidfile指定

pidfile /var/run/redis.pid

3. 指定Redis监听端口，默认端口为6379

    port 6379

4. 绑定的主机地址

    bind 127.0.0.1

5.当客户端闲置多长时间后关闭连接，如果指定为0，表示关闭该功能

    timeout 300

6. 指定日志记录级别，Redis总共支持四个级别：debug、verbose、notice、warning，默认为verbose

    loglevel verbose

7. 日志记录方式，默认为标准输出，如果配置Redis为守护进程方式运行，而这里又配置为日志记录方式为标准输出，则日志将会发送给/dev/null

    logfile stdout

8. 设置数据库的数量，默认数据库为0，可以使用SELECT &lt;dbid&gt;命令在连接上指定数据库id

    databases 16

9. 指定在多长时间内，有多少次更新操作，就将数据同步到数据文件，可以多个条件配合

    save &lt;seconds&gt; &lt;changes&gt;

    Redis默认配置文件中提供了三个条件：

    save 900 1

    save 300 10

    save 60 10000

    分别表示900秒（15分钟）内有1个更改，300秒（5分钟）内有10个更改以及60秒内有10000个更改。

 

10. 指定存储至本地数据库时是否压缩数据，默认为yes，Redis采用LZF压缩，如果为了节省CPU时间，可以关闭该选项，但会导致数据库文件变的巨大

    rdbcompression yes

11. 指定本地数据库文件名，默认值为dump.rdb

    dbfilename dump.rdb

12. 指定本地数据库存放目录

    dir ./

13. 设置当本机为slav服务时，设置master服务的IP地址及端口，在Redis启动时，它会自动从master进行数据同步

    slaveof &lt;masterip&gt; &lt;masterport&gt;

14. 当master服务设置了密码保护时，slav服务连接master的密码

    masterauth &lt;master-password&gt;

15. 设置Redis连接密码，如果配置了连接密码，客户端在连接Redis时需要通过AUTH &lt;password&gt;命令提供密码，默认关闭

    requirepass foobared

16. 设置同一时间最大客户端连接数，默认无限制，Redis可以同时打开的客户端连接数为Redis进程可以打开的最大文件描述符数，如果设置 maxclients 0，表示不作限制。当客户端连接数到达限制时，Redis会关闭新的连接并向客户端返回max number of clients reached错误信息

    maxclients 128

17. 指定Redis最大内存限制，Redis在启动时会把数据加载到内存中，达到最大内存后，Redis会先尝试清除已到期或即将到期的Key，当此方法处理 后，仍然到达最大内存设置，将无法再进行写入操作，但仍然可以进行读取操作。Redis新的vm机制，会把Key存放内存，Value会存放在swap区

    maxmemory &lt;bytes&gt;

18. 指定是否在每次更新操作后进行日志记录，Redis在默认情况下是异步的把数据写入磁盘，如果不开启，可能会在断电时导致一段时间内的数据丢失。因为 redis本身同步数据文件是按上面save条件来同步的，所以有的数据会在一段时间内只存在于内存中。默认为no

    appendonly no

19. 指定更新日志文件名，默认为appendonly.aof

     appendfilename appendonly.aof

20. 指定更新日志条件，共有3个可选值： 
    no：表示等操作系统进行数据缓存同步到磁盘（快） 
    always：表示每次更新操作后手动调用fsync()将数据写到磁盘（慢，安全） 
    everysec：表示每秒同步一次（折衷，默认值）

    appendfsync everysec

 

21. 指定是否启用虚拟内存机制，默认值为no，简单的介绍一下，VM机制将数据分页存放，由Redis将访问量较少的页即冷数据swap到磁盘上，访问多的页面由磁盘自动换出到内存中（在后面的文章我会仔细分析Redis的VM机制）

     vm-enabled no

22. 虚拟内存文件路径，默认值为/tmp/redis.swap，不可多个Redis实例共享

     vm-swap-file /tmp/redis.swap

23. 将所有大于vm-max-memory的数据存入虚拟内存,无论vm-max-memory设置多小,所有索引数据都是内存存储的(Redis的索引数据 就是keys),也就是说,当vm-max-memory设置为0的时候,其实是所有value都存在于磁盘。默认值为0

     vm-max-memory 0

24. Redis swap文件分成了很多的page，一个对象可以保存在多个page上面，但一个page上不能被多个对象共享，vm-page-size是要根据存储的 数据大小来设定的，作者建议如果存储很多小对象，page大小最好设置为32或者64bytes；如果存储很大大对象，则可以使用更大的page，如果不 确定，就使用默认值

     vm-page-size 32

25. 设置swap文件中的page数量，由于页表（一种表示页面空闲或使用的bitmap）是在放在内存中的，，在磁盘上每8个pages将消耗1byte的内存。

     vm-pages 134217728

26. 设置访问swap文件的线程数,最好不要超过机器的核数,如果设置为0,那么所有对swap文件的操作都是串行的，可能会造成比较长时间的延迟。默认值为4

     vm-max-threads 4

27. 设置在向客户端应答时，是否把较小的包合并为一个包发送，默认为开启

    glueoutputbuf yes

28. 指定在超过一定的数量或者最大的元素超过某一临界值时，采用一种特殊的哈希算法

    hash-max-zipmap-entries 64

    hash-max-zipmap-value 512

29. 指定是否激活重置哈希，默认为开启（后面在介绍Redis的哈希算法时具体介绍）

    activerehashing yes

30. 指定包含其它的配置文件，可以在同一主机上多个Redis实例之间使用同一份配置文件，而同时各个实例又拥有自己的特定配置文件
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/babd908ae886b37c3ca838956e912668/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">LaTeX公式转MathType公式</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/478ea7ad440b995f183bdc23aee79ba8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">使用Python &#43; fitz &#43; PIL&#43; pytesseract 解析PDF</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>