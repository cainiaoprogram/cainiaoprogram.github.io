<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ã€Rcodeã€‘ç”Ÿå­˜åˆ†æï¼š KM &amp; COXå›å½’&amp; éšæœºæ£®æ—&amp; nomogram - èœé¸Ÿç¨‹åºå‘˜åšå®¢</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ã€Rcodeã€‘ç”Ÿå­˜åˆ†æï¼š KM &amp; COXå›å½’&amp; éšæœºæ£®æ—&amp; nomogram" />
<meta property="og:description" content="æœ¬æ–‡ä½¿ç”¨äº†Râ€”â€”survivalåŒ…ä¸‹çš„lungæ•°æ®è¿›è¡Œæ–¹æ³•æµ‹è¯•ï¼š
1ï¼‰KM 2) Coxå›å½’ï¼šå¤šå› ç´  3ï¼‰éšæœºæ£®æ—å› å­ï¼ˆæ ¹æ®coxå›å½’ç»“æœï¼‰ 4ï¼‰nomogram ï¼ˆ æ ¹æ®coxå›å½’ç»“æœï¼Œå»ºç«‹äº†ä¸­ä½ç”Ÿå­˜æ—¶é—´ï¼Œ1å¹´5å¹´ç”Ÿå­˜ç‡çš„æ¦‚ç‡è®¡ç®—ï¼‰
-----ğŸ§šğŸ½â€â™€ï¸æœ¬æ–‡åªæœ‰å¹²è´§ï¼Œéå¸¸å¹²ï¼ğŸ¤£-----
ä¸€ã€æ•°æ®åŠ è½½ #ç”Ÿå­˜åˆ†æ
library(&#34;survival&#34;) library(&#34;survminer&#34;) data(&#34;lung&#34;) head(lung) ç»“æœï¼š &lt;head(lung) inst time status age sex ph.ecog ph.karno pat.karno meal.cal wt.loss 1 3 306 2 74 1 1 90 100 1175 NA 2 3 455 2 68 1 0 90 90 1225 15 3 3 1010 1 56 1 0 90 90 NA 15 4 5 210 2 57 1 1 90 60 1150 11 5 1 883 2 60 1 0 100 90 NA 0 6 12 1022 1 74 1 1 50 80 513 0 äºŒã€KMæ–¹æ³•å’Œéå‚æ•°æ£€éªŒ #---------------KMæ–¹æ³•-------------------------" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/6d9b3cf698f00ab81c0213a7f815f282/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-01-29T12:11:54+08:00" />
<meta property="article:modified_time" content="2021-01-29T12:11:54+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="èœé¸Ÿç¨‹åºå‘˜åšå®¢" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">èœé¸Ÿç¨‹åºå‘˜åšå®¢</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ã€Rcodeã€‘ç”Ÿå­˜åˆ†æï¼š KM &amp; COXå›å½’&amp; éšæœºæ£®æ—&amp; nomogram</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><em><strong>æœ¬æ–‡ä½¿ç”¨äº†Râ€”â€”survivalåŒ…ä¸‹çš„lungæ•°æ®è¿›è¡Œæ–¹æ³•æµ‹è¯•</strong></em>ï¼š</p> 
<h5><a id="1KM_2"></a>1ï¼‰KM</h5> 
<h5><a id="2___Cox_3"></a>2) Coxå›å½’ï¼šå¤šå› ç´ </h5> 
<h5><a id="3cox_4"></a>3ï¼‰éšæœºæ£®æ—å› å­ï¼ˆæ ¹æ®coxå›å½’ç»“æœï¼‰</h5> 
<h5><a id="4nomogram_5"></a>4ï¼‰nomogram</h5> 
<p>ï¼ˆ æ ¹æ®coxå›å½’ç»“æœï¼Œå»ºç«‹äº†ä¸­ä½ç”Ÿå­˜æ—¶é—´ï¼Œ1å¹´5å¹´ç”Ÿå­˜ç‡çš„æ¦‚ç‡è®¡ç®—ï¼‰</p> 
<p>-----<strong>ğŸ§šğŸ½â€â™€ï¸æœ¬æ–‡åªæœ‰å¹²è´§ï¼Œéå¸¸å¹²ï¼ğŸ¤£</strong>-----</p> 
<h4><a id="_10"></a>ä¸€ã€æ•°æ®åŠ è½½</h4> 
<p>#ç”Ÿå­˜åˆ†æ</p> 
<pre><code>library("survival")
library("survminer")

data("lung")
head(lung)
</code></pre> 
<pre><code>ç»“æœï¼š
&lt;head(lung)
  inst time status age sex ph.ecog ph.karno pat.karno meal.cal wt.loss
1    3  306      2  74   1       1       90       100     1175      NA
2    3  455      2  68   1       0       90        90     1225      15
3    3 1010      1  56   1       0       90        90       NA      15
4    5  210      2  57   1       1       90        60     1150      11
5    1  883      2  60   1       0      100        90       NA       0
6   12 1022      1  74   1       1       50        80      513       0
</code></pre> 
<h4><a id="KM_35"></a>äºŒã€KMæ–¹æ³•å’Œéå‚æ•°æ£€éªŒ</h4> 
<p>#---------------KMæ–¹æ³•-------------------------</p> 
<pre><code>fit&lt;-survfit(Surv(time,status)~sex,data=lung)  #æ‹Ÿåˆç”Ÿå­˜å‡½æ•°
print(fit)
res.sum&lt;-surv_summary(fit)#çœ‹æ•´ä½“ç»“æœ
head(res.sum)
#ç»˜åˆ¶KMæ›²çº¿
ggsurvplot(fit,
           pval=TRUE,#æ·»åŠ På€¼
           conf.int = TRUE,#å¢åŠ ç½®ä¿¡åŒºé—´
           risk.tabel.col="strata",  #change risk tabel color by groups
           linetype = "strata",      #change line type by groups
           surv.median.line = "hv",   #specify median survival å¢åŠ ä¸­ä½ç”Ÿå­˜æ—¶é—´
           ggtheme = theme_bw(),      #change ggplots theme
           palette = c("hue"),
           #palette = c("#E7B800","#2E9FDF"),#è‡ªå®šä¹‰è°ƒè‰²æ¿
           risk.table = TRUE,#add risk tabelç»˜åˆ¶ç´¯è®¡é£é™©æ›²çº¿
           xlab = "Follow up time(d)", # æŒ‡å®šxè½´æ ‡ç­¾
           legend = c(0.8,0.75), # æŒ‡å®šå›¾ä¾‹ä½ç½®
           legend.title = "", # è®¾ç½®å›¾ä¾‹æ ‡é¢˜
           legend.labs = c("Male", "Female"), # æŒ‡å®šå›¾ä¾‹åˆ†ç»„æ ‡ç­¾
           break.x.by = 100
           #fun="event"
           )

</code></pre> 
<p><img src="https://images2.imgbox.com/57/8e/LPNIk9D0_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<pre><code>ç»“æœï¼š
Call: survfit(formula = Surv(time, status) ~ sex, data = lung)

        n events median 0.95LCL 0.95UCL
sex=1 138    112    270     212     310
sex=2  90     53    426     348     550
&gt; res.sum&lt;-surv_summary(fit)#çœ‹æ•´ä½“ç»“æœ
</code></pre> 
<h4><a id="cox_77"></a>ä¸‰ã€coxæ–¹æ³•å’Œç»“æœ</h4> 
<p>#----------------coxæ–¹æ³•-------------------------</p> 
<pre><code>data("lung")
head(lung)

res.cox&lt;-coxph(Surv(time,status)~age+sex+ph.ecog,data=lung) #å¤šå› ç´ COXå›å½’ï¼šage+sex+ph.ecogå¯¹ç”Ÿå­˜ç»“å±€çš„å½±å“
#è¿™é‡Œå…ˆåšå•å› ç´ åˆ†æçº³å…¥P&lt;0.05çš„ï¼Œæˆ–è€…ä¸´åºŠè®¤ä¸ºæ˜¾è‘—ç›¸å…³çš„
summary(res.cox)

ggsurvplot(survfit(res.cox),
           data=lung,
           palette = "#2E9FDF",
           ggtheme = theme_minimal(),
           legend="none"
           )
</code></pre> 
<p><img src="https://images2.imgbox.com/bb/c6/rdbJU65U_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<pre><code>ç»“æœï¼š
Call:
coxph(formula = Surv(time, status) ~ age + sex + ph.ecog, data = lung)

  n= 227, number of events= 164 
   (1 observation deleted due to missingness)

             coef exp(coef)  se(coef)      z Pr(&gt;|z|)    
age      0.011067  1.011128  0.009267  1.194 0.232416    
sex     -0.552612  0.575445  0.167739 -3.294 0.000986 ***
ph.ecog  0.463728  1.589991  0.113577  4.083 4.45e-05 ***
---
Signif. codes:  0 â€˜***â€™ 0.001 â€˜**â€™ 0.01 â€˜*â€™ 0.05 â€˜.â€™ 0.1 â€˜ â€™ 1

        exp(coef) exp(-coef) lower .95 upper .95
age        1.0111     0.9890    0.9929    1.0297
sex        0.5754     1.7378    0.4142    0.7994
ph.ecog    1.5900     0.6289    1.2727    1.9864

Concordance= 0.637  (se = 0.025 )
Likelihood ratio test= 30.5  on 3 df,   p=1e-06
Wald test            = 29.93  on 3 df,   p=1e-06
Score (logrank) test = 30.5  on 3 df,   p=1e-06
</code></pre> 
<p>#æ ¹æ®coxå›å½’ç»“æœï¼Œç»˜åˆ¶åŸºç¡€æ£®æ—å›¾</p> 
<pre><code>ggforest(res.cox, data = lung,
         main = 'Hazard ratio of LIHC',  #æ ‡é¢˜
         cpositions = c(0.05, 0.15, 0.35),  #å‰ä¸‰åˆ—è·ç¦»
         fontsize = 1, #å­—ä½“å¤§å°
         refLabel = 'reference', #ç›¸å¯¹å˜é‡çš„æ•°å€¼æ ‡ç­¾ï¼Œä¹Ÿå¯æ”¹ä¸º1
         noDigits = 3 #ä¿ç•™HRå€¼ä»¥åŠ95%CIçš„å°æ•°ä½æ•°
         )

</code></pre> 
<p><img src="https://images2.imgbox.com/cf/84/wrZ6IoaS_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h4><a id="cox_142"></a>å››ã€è¯ºè«å›¾ï¼šæ ¹æ®coxæ–¹æ³•</h4> 
<p>å…ˆå®‰è£…å’ŒåŠ è½½åŒ…</p> 
<pre><code>#install.packages("rms")
library(rms)
</code></pre> 
<h3><a id="COX_149"></a>æ„å»ºCOXæ¯”ä¾‹é£é™©æ¨¡å‹</h3> 
<pre><code>dd=datadist(lung)
options(datadist="dd")

f2 &lt;- psm(Surv(time,status) ~ age+sex+ph.ecog,data =  lung, dist='lognormal')

med &lt;- Quantile(f2) # è®¡ç®—ä¸­ä½ç”Ÿå­˜æ—¶é—´
surv &lt;- Survival(f2) # æ„å»ºç”Ÿå­˜æ¦‚ç‡å‡½æ•°
</code></pre> 
<h3><a id="COXNomogram_161"></a>ç»˜åˆ¶COXå›å½’ä¸­ä½ç”Ÿå­˜æ—¶é—´çš„Nomogramå›¾</h3> 
<pre><code>nom &lt;- nomogram(f2, fun=function(x) med(lp=x),funlabel="Median Survival Time")
plot(nom)
</code></pre> 
<p><img src="https://images2.imgbox.com/fe/0b/mNhbTc1z_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="COXNomogram_171"></a>ç»˜åˆ¶COXå›å½’ç”Ÿå­˜æ¦‚ç‡çš„Nomogramå›¾</h3> 
<pre><code>nom2 &lt;- nomogram(f2, fun=list(function(x) surv(365, x),
                             function(x) surv(1825, x),
                             function(x) med(lp=x)),
                funlabel=c("1-year Survival Probability", "5-year Survival Probability","Median Survival Time"))
plot(nom2, xfrac=.2)
</code></pre> 
<p><img src="https://images2.imgbox.com/26/86/wcuMMsy6_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4bcab6bcfe4a254aefba532720792a6e/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">RTSPåè®®è§†é¢‘æ™ºèƒ½åˆ†æ/æ™ºèƒ½è¯†åˆ«ç³»ç»ŸEasyNVRè¿è¡Œä¸€æ®µæ—¶é—´åè‡ªåŠ¨æ‰çº¿å¦‚ä½•æ’æŸ¥ï¼Ÿ</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/22a5e6a361ce5d9601bc4126f6b37a87/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">Javaæ³¨è§£@Mockå’Œ@InjectMocksåŠ@Mockå’Œ@Spyä¹‹é—´çš„åŒºåˆ«</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 èœé¸Ÿç¨‹åºå‘˜åšå®¢.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>