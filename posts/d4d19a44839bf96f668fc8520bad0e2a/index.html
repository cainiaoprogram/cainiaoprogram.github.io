<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>制作自己的 Docker 容器 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="制作自己的 Docker 容器" />
<meta property="og:description" content="软件开发最大的麻烦事之一，就是环境配置。用户必须保证操作系统的设置，各种库和组件的安装，只有它们都正确，软件才能运行。docker从根本上解决问题，软件安装的时候，把原始环境一模一样地复制过来。
以 koa-demos 项目为例，介绍怎么写 Dockerfile 文件，实现让用户在 Docker 容器里面运行 Koa 框架。准备工作，下载源码：git clone https://github.com/ruanyf/koa-demos.git cd koa-demos
1、编写 Dockerfile 文件
首先，在项目的根目录下，新建一个文本文件.dockerignore，写入下面的内容。
.git node_modules npm-debug.log 上面代码表示，这三个路径要排除，不要打包进入image文件。如果你没有路径要排除，这个文件可以不新建。
然后，在项目的根目录下，新建一个文本文件 Dockerfile，写入下面的内容。
FROM node:8.4 COPY . /app WORKDIR /app RUN npm install --registry=https://registry.npm.taobao.org EXPOSE 3000 上面代码一共五行，含义如下。
FROM node:8.4：该 image 文件继承官方的 node image，冒号表示标签，这里标签是8.4，即8.4版本的 node。
COPY . /app：将当前目录下的所有文件（除了.dockerignore排除的路径），都拷贝进入 image 文件的/app目录。
WORKDIR /app：指定接下来的工作路径为/app。
RUN npm install：在/app目录下，运行npm install命令安装依赖。注意，安装后所有的依赖，都将打包进入 image 文件。
EXPOSE 3000：将容器 3000 端口暴露出来， 允许外部连接这个端口。
2、创建 image 文件
有了 Dockerfile 文件以后，就可以使用docker image build命令创建 image 文件了。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/d4d19a44839bf96f668fc8520bad0e2a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-24T16:29:52+08:00" />
<meta property="article:modified_time" content="2023-12-24T16:29:52+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">制作自己的 Docker 容器</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>        软件开发最大的麻烦事之一，就是环境配置。用户必须保证操作系统的设置，各种库和组件的安装，只有它们都正确，软件才能运行。docker从根本上解决问题，软件安装的时候，把原始环境一模一样地复制过来。</p> 
<p>        以 koa-demos 项目为例，介绍怎么写 Dockerfile 文件，实现让用户在 Docker 容器里面运行 Koa 框架。准备工作，下载源码：git clone https://github.com/ruanyf/koa-demos.git cd koa-demos</p> 
<p><strong>1、编写 Dockerfile 文件</strong></p> 
<p>        首先，在项目的根目录下，新建一个文本文件.dockerignore，写入下面的内容。</p> 
<pre><code class="hljs">.git node_modules npm-debug.log</code></pre> 
<p>        上面代码表示，这三个路径要排除，不要打包进入image文件。如果你没有路径要排除，这个文件可以不新建。</p> 
<p>        然后，在项目的根目录下，新建一个文本文件 Dockerfile，写入下面的内容。</p> 
<pre><code class="hljs">FROM node:8.4 
COPY . /app WORKDIR /app 
RUN npm install --registry=https://registry.npm.taobao.org 
EXPOSE 3000</code></pre> 
<p>        上面代码一共五行，含义如下。</p> 
<p>        FROM node:8.4：该 image 文件继承官方的 node image，冒号表示标签，这里标签是8.4，即8.4版本的 node。</p> 
<p>        COPY . /app：将当前目录下的所有文件（除了.dockerignore排除的路径），都拷贝进入 image 文件的/app目录。</p> 
<p>        WORKDIR /app：指定接下来的工作路径为/app。</p> 
<p>        RUN npm install：在/app目录下，运行npm install命令安装依赖。注意，安装后所有的依赖，都将打包进入 image 文件。</p> 
<p>        EXPOSE 3000：将容器 3000 端口暴露出来， 允许外部连接这个端口。</p> 
<p><strong>2、创建 image 文件</strong></p> 
<p>        有了 Dockerfile 文件以后，就可以使用docker image build命令创建 image 文件了。</p> 
<pre><code class="hljs">docker image build -t koa-demo . 
# 或者 
docker image build -t koa-demo:0.0.1 .</code></pre> 
<p>        终端打印执行过程：</p> 
<p class="img-center"><img alt="" height="153" src="https://images2.imgbox.com/a3/6e/Aa9v3tSR_o.png" width="640"></p> 
<p>        上面代码中，-t参数用来指定 image 文件的名字，后面还可以用冒号指定标签。如果不指定，默认的标签就是latest。最后的那个点表示 Dockerfile 文件所在的路径，上例是当前路径，所以是一个点。</p> 
<p>        如果运行成功，就可以看到新生成的 image 文件koa-demo了。</p> 
<pre><code class="hljs">docker image ls</code></pre> 
<p><strong>3、生成容器</strong></p> 
<p>        docker container run命令会从 image 文件生成容器。</p> 
<pre><code class="hljs">docker container run -p 8000:3000 -it koa-demo /bin/bash 
# 或者 
docker container run -p 8000:3000 -it koa-demo:0.0.1 /bin/bash</code></pre> 
<p>        如果一切正常，运行上面的命令以后，就会返回一个命令行提示符。</p> 
<pre><code class="hljs">root@66d80f4aaf1e:/app#</code></pre> 
<p>        这表示你已经在容器里面了，返回的提示符就是容器内部的 Shell 提示符。执行下面的命令。</p> 
<pre><code class="hljs">root@66d80f4aaf1e:/app# node demos/01.js</code></pre> 
<p>        这时，Koa 框架已经运行起来了。打开本机的浏览器，访问 http://127.0.0.1:8000，网页显示"Not Found"，这是因为这个 demo 没有写路由。</p> 
<p><strong>4、CMD 命令</strong></p> 
<p>        上一节的例子里面，容器启动以后，需要手动输入命令node demos/01.js。我们可以把这个命令写在 Dockerfile 里面，这样容器启动以后，这个命令就已经执行了，不用再手动输入了。</p> 
<pre><code class="hljs">FROM node:8.4 
COPY . /app WORKDIR /app 
RUN npm install --registry=https://registry.npm.taobao.org 
EXPOSE 3000 
CMD node demos/01.js # 容器启动后执行命令，一个容器只能有一个CMD命令.</code></pre> 
<p>        上面的 Dockerfile 里面，多了最后一行CMD node demos/01.js，它表示容器启动后自动执行node demos/01.js。</p> 
<p>        注意，指定了CMD命令以后，docker container run命令就不能附加命令了（比如前面的/bin/bash），否则它会覆盖CMD命令。现在，启动容器可以使用下面的命令。</p> 
<pre><code class="hljs">docker container run --rm -p 8000:3000 -it koa-demo:0.0.1</code></pre> 
<p><strong>5、测试demo</strong></p> 
<p>        在ubuntu 21.04最小系统上，运行hello.sh文件，运行方式./hello.sh，文件内容：</p> 
<pre><code class="hljs">#hello.sh 
echo "hello docker"        </code></pre> 
<p>        Dockerfile基本结构：</p> 
<pre><code class="hljs">FROM ubuntu:21.04 
ADD hello.sh / 
CMD ["./hello.sh"]</code></pre> 
<p>        镜像的构建，-t：tag指定镜像名称和版本：</p> 
<pre><code class="hljs">docker image build -t hello.sh:1.0 .</code></pre> 
<p>        构建过程截图：</p> 
<p class="img-center"><img alt="" height="291" src="https://images2.imgbox.com/a9/18/tGe7TlRC_o.png" width="640"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a2b48a0b156a1aaf561552ca3cb44293/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Nacos和Eureka的区别</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/354f0002633c883d6f4a588452170b22/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">刷课必备！用Python实现网上自动做题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>