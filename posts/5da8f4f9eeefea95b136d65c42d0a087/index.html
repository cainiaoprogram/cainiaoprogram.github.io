<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>实现Http请求的工具类(HttpClient) - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="实现Http请求的工具类(HttpClient)" />
<meta property="og:description" content="用到的jar包有：commons-logging.jar fastjson-1.2.58.jar JSONObject等用到
httpclient-4.5.9.jar org.apache.http.impl.client.*用到
httpcore-4.4.11.jar org.apache.http.client.* 用到
​ package com.httpUtil.cn; import com.alibaba.fastjson.JSON; import com.alibaba.fastjson.JSONObject; import org.apache.http.HttpEntity; import org.apache.http.HttpResponse; import org.apache.http.NameValuePair; import org.apache.http.client.HttpClient; import org.apache.http.client.entity.UrlEncodedFormEntity; import org.apache.http.client.methods.HttpPost; import org.apache.http.entity.StringEntity; import org.apache.http.impl.client.CloseableHttpClient; import org.apache.http.impl.client.DefaultHttpClient; import org.apache.http.impl.client.HttpClientBuilder; import org.apache.http.impl.client.HttpClients; import org.apache.http.message.BasicNameValuePair; import org.apache.http.util.EntityUtils; import java.io.BufferedReader; import java.io.InputStream; import java.io.InputStreamReader; import java.net.HttpURLConnection; import java.net.URL; import java.util.*; /** * DefaultHttpClient clients = new DefaultHttpClient(); HttpClient client = HttpClientBuilder.create().build();//获取DefaultHttpClient请求 */ /** * @author wangwei * @version v1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/5da8f4f9eeefea95b136d65c42d0a087/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-12-05T11:18:43+08:00" />
<meta property="article:modified_time" content="2019-12-05T11:18:43+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">实现Http请求的工具类(HttpClient)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>用到的jar包有：commons-logging.jar   </p> 
<p>                          fastjson-1.2.58.jar      JSONObject等用到</p> 
<p>                          httpclient-4.5.9.jar       org.apache.http.impl.client.*用到</p> 
<p>                          httpcore-4.4.11.jar       org.apache.http.client.* 用到</p> 
<p> </p> 
<pre class="has"><code class="language-java">​
package com.httpUtil.cn;

import com.alibaba.fastjson.JSON;
import com.alibaba.fastjson.JSONObject;
import org.apache.http.HttpEntity;
import org.apache.http.HttpResponse;
import org.apache.http.NameValuePair;
import org.apache.http.client.HttpClient;
import org.apache.http.client.entity.UrlEncodedFormEntity;
import org.apache.http.client.methods.HttpPost;
import org.apache.http.entity.StringEntity;
import org.apache.http.impl.client.CloseableHttpClient;
import org.apache.http.impl.client.DefaultHttpClient;
import org.apache.http.impl.client.HttpClientBuilder;
import org.apache.http.impl.client.HttpClients;
import org.apache.http.message.BasicNameValuePair;
import org.apache.http.util.EntityUtils;

import java.io.BufferedReader;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.net.HttpURLConnection;
import java.net.URL;
import java.util.*;


/**
 * DefaultHttpClient clients = new DefaultHttpClient();
 HttpClient client = HttpClientBuilder.create().build();//获取DefaultHttpClient请求
 */

/**
 * @author wangwei
 * @version v1.0.0
 * @description HTTP工具类
 * @date 2019-01-12
 */
public class HttpConnectUtil {

    public static void main(String[] args) {
        String p  = "{\"type\":\"queryAll\",\"cityName\":\"广州市\",\"channelId\":7,\"channelCode\":\"J0005\",\"memberId\":3350077}";
        String url = "http://www.jycinema.com/frontUIWebapp/appserver/cinCinemaMessageService/findCinema";
        JSONObject json = JSONObject.parseObject(p);
        System.out.println(json.toJSONString());
        try {
            Map&lt;String, String&gt; reqParams = new HashMap&lt;&gt;();
            reqParams.put("params", p);
            String result = post(url, reqParams);
            System.out.println(result);
        }catch(Exception e) {
            System.out.println("失败"+e);
        }

    }

    public static JSONObject postJson(String reqUrl, JSONObject jsonParam) throws Exception {

       // DefaultHttpClient htClient = new DefaultHttpClient(); 已经不存在了
        HttpClient htClient = HttpClientBuilder.create().build();

        HttpPost method = new HttpPost(reqUrl);

        StringEntity entity = new StringEntity(jsonParam.toString(), "utf-8");
        entity.setContentEncoding("UTF-8");
        entity.setContentType("application/json");
        method.setEntity(entity);
        HttpResponse result = htClient.execute(method);
        String resData = EntityUtils.toString(result.getEntity());
        JSONObject resJson = JSONObject.parseObject(resData);
        return resJson;
    }

    public static String post(String reqUrl, Map&lt;String, String&gt; reqParams) throws Exception {
        if (reqParams == null) {
            reqParams = new HashMap&lt;&gt;();
        }
        System.out.println("请求地址：" + reqUrl);
        System.out.println("请求参数：" + JSON.toJSONString(reqParams));
        CloseableHttpClient client = HttpClients.createDefault();
        HttpPost post = new HttpPost(reqUrl);
        try {
            List&lt;NameValuePair&gt; params = new ArrayList&lt;NameValuePair&gt;();
            for (String key : reqParams.keySet()) {
                params.add(new BasicNameValuePair(key, reqParams.get(key)));
            }
            UrlEncodedFormEntity urlEncodedFormEntity = new UrlEncodedFormEntity(params, "UTF-8");
            /* 设置参数 */
            post.setEntity(urlEncodedFormEntity);
            HttpResponse response = client.execute(post);
            HttpEntity entity = response.getEntity();
            String returnMsg = EntityUtils.toString(entity, "UTF-8");
            return returnMsg;
        } catch (Exception e) {
            e.printStackTrace();
            return null;
        } finally {
            /* 释放链接 */
            post.releaseConnection();
        }
    }

    public static String get(String reqUrl, Map&lt;String, String&gt; reqParams) throws Exception {
        System.out.println("请求地址：" + reqUrl);
        System.out.println("请求参数：" + JSON.toJSONString(reqParams));
        return execute(reqUrl, reqParams, "GET");
    }

    public static String execute(String reqUrl, Map&lt;String, String&gt; reqParams, String method) throws Exception {
        return execute(reqUrl, reqParams, method, "application/x-www-form-urlencoded");
    }

    public static String execute(String reqUrl, Map&lt;String, String&gt; reqParams, String method, String contentType)
            throws Exception {
        String response = "";
        String invokeUrl = reqUrl;
        URL serverUrl = new URL(invokeUrl);
        HttpURLConnection conn = (HttpURLConnection) serverUrl.openConnection();

        conn.setReadTimeout(5000);
        conn.setRequestMethod(method);
        conn.setDoInput(true);
        conn.setDoOutput(true);
        conn.setUseCaches(false);

        if (reqParams != null &amp;&amp; reqParams.size() &gt; 0) {
            conn.setRequestProperty("Cookie", reqParams.get("Cookie") + "");
            reqParams.remove("Cookie");
        }
        conn.setRequestProperty("connection", "keep-alive");
        conn.setRequestProperty("Charsert", "UTF-8");
        conn.setRequestProperty("Accept", "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8");
        conn.setRequestProperty("Content-Type", contentType);
        // 传递参数
        String content = getStringData(reqParams);
        byte[] bypes = content.toString().getBytes();
        conn.getOutputStream().write(bypes);
        conn.connect();

        InputStream is = conn.getInputStream();
        BufferedReader in = new BufferedReader(new InputStreamReader(is, "utf-8"));
        StringBuffer buffer = new StringBuffer();
        String line = "";
        while ((line = in.readLine()) != null) {
            buffer.append(line);
        }
        response = buffer.toString();
        conn.disconnect();
        return response;
    }

    public static String getStringData(Map&lt;String, String&gt; params) {
        StringBuffer content = new StringBuffer();
        List&lt;String&gt; keys = new ArrayList&lt;String&gt;(params.keySet());
        Collections.sort(keys);

        for (int i = 0; i &lt; keys.size(); i++) {
            String key = (String) keys.get(i);
            String value = params.get(key);
            if (value != null) {
                content.append((i == 0 ? "" : "&amp;") + key + "=" + value);
            } else {
                content.append((i == 0 ? "" : "&amp;") + key + "=");
            }
        }
        return content.toString();
    }


}


​</code></pre> 
<pre class="has"><code class="language-html"> </code></pre> 
<pre class="has"><code class="language-html"> </code></pre> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/305ac5277959eb0cf4a6e09702e014a4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">spring mvc绑定对象String转Date 问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2f6834f36445f4e21382e135a6982c78/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">我的心酸求职之路：如果可以，去学Java、C，不要搞Python</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>