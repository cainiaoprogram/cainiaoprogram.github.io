<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>一起学docker（六）| Dockerfile自定义镜像 &#43; 微服务模块实战 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="一起学docker（六）| Dockerfile自定义镜像 &#43; 微服务模块实战" />
<meta property="og:description" content="DockerFile 是什么 Dockerfile是用来构建Docker镜像的文本文件，是由一条条构建镜像所需的指令和参数构成的脚本。
构建步骤 编写Dockerfile文件docker build命令构建镜像docker run运行镜像 Dockerfile构建过程 基础知识 每个保留字指令都必须为大写字母且后面要跟随至少一个参数指令从上到下，顺序执行#号表示注释每条指令都会创建一个新的镜像层，并对镜像进行提交 Docker执行Dockerfile的大致流程 docker从基础镜像运行一个容器执行一条指令并对容器做出修改执行类似docker commit的操作提交一个新的镜像层docker再基于刚提交的镜像运行一个新容器执行Dockerfile中下一条指令直到所有指令都执行完成 总结 从应用软件的角度来看，Dockerfile、Docker镜像与Docker容器分别代表软件的三个不同阶段，
Dockerfile是软件的原材料Docker镜像是软件的交付品Docker容器则可以认为是软件镜像的运行态，也即依照镜像运行的容器实例 Dockerfile面向开发，Docker镜像成为交付标准，Docker容器则涉及部署与运维，三者缺一不可，合力充当Docker体系的基石。
Dockerfile，需要定义一个Dockerfile，Dockerfile定义了进程需要的一切东西。Dockerfile涉及的内容包括执行代码或者是文件、环境变量、依赖包、运行时环境、动态链接库、操作系统的发行版、服务进程和内核进程(当应用进程需要和系统服务和内核进程打交道，这时需要考虑如何设计namespace的权限控制)等等;
Docker镜像，在用Dockerfile定义一个文件之后，docker build时会产生一个Docker镜像，当运行 Docker镜像时会真正开始提供服务;
Docker容器，容器是直接提供服务的。
常用保留字指令 关键字作用备注FROM指定基础镜像指定一个已经存在的镜像作为父镜像，第一条指令必须是FROMWAINTAINER指定作者信息一般是姓名&#43;邮箱（name&lt;mail&gt;)LABEL标明dockerfile的标签可以使用Label代替Maintainer，最终都是在docker image基本信息中可以查看RUN构建镜像时运行的命令容器构建时需要运行的命令；有两种格式：shell格式、exec格式；RUN是在docker build时运行shell格式exec格式EXPOSE暴露端口定义容器运行的时候监听的端口，启动容器的使用-p来绑定暴露端口，格式: EXPOSE 8080 或者 EXPOSE 8080/udpWORKDIR指定工作目录指定在创建容器后，终端默认登陆的进来工作目录，一个落脚点USER指定执行用户指定build或者启动的时候 用户 在RUN CMD ENTRYPONT执行的时候的用户ENV设置环境变量指定build时候的环境变量 可以在启动的容器的时候 通过-e覆盖 格式ENV name=valueADD添加文件将宿主机目录下的文件拷贝进镜像且会自动处理URL和解压tar压缩包COPY复制文件类似ADD，拷贝文件和目录到镜像中。
将从构建上下文目录中 &lt;源路径&gt; 的文件/目录复制到新的一层的镜像内的 &lt;目标路径&gt; 位置VOLUME定义外部可以挂载的数据卷用于数据保存和持久化；
指定build的image哪些目录可以启动的时候挂载到文件系统中 启动容器的时候使用 -v 绑定 格式 VOLUME [“目录”]CMD指定容器启动后的要干的事情Dockerfile 中可以有多个 CMD 指令，但只有最后一个生效，CMD 会被 docker run 之后的参数替换ENTRYPOINT也是用来指定一个容器启动时要运行的命令类似于 CMD 指令，但是ENTRYPOINT不会被docker run后面的命令覆盖，而且这些命令行参数会被当作参数送给 ENTRYPOINT 指令指定的程序 RUN和CMD的区别
CMD是在docker run时运行RUN是在docker build时运行 ENTRYPOINT
命令格式：ENTRYPOINT [&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/75d2db33b69bc80a107e8d93f0739c49/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-03T23:45:05+08:00" />
<meta property="article:modified_time" content="2024-01-03T23:45:05+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">一起学docker（六）| Dockerfile自定义镜像 &#43; 微服务模块实战</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h4><a id="DockerFile_0"></a>DockerFile</h4> 
<h5><a id="_2"></a>是什么</h5> 
<p><strong>Dockerfile是用来构建Docker镜像的文本文件</strong>，是由一条条构建镜像所需的指令和参数构成的脚本。</p> 
<p><img src="https://images2.imgbox.com/db/0b/lb5g1M7B_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="_11"></a>构建步骤</h5> 
<ol><li>编写Dockerfile文件</li><li>docker build命令构建镜像</li><li>docker run运行镜像</li></ol> 
<h5><a id="Dockerfile_19"></a>Dockerfile构建过程</h5> 
<h6><a id="_21"></a>基础知识</h6> 
<ul><li>每个保留字指令都必须为大写字母且后面要跟随至少一个参数</li><li>指令从上到下，顺序执行</li><li><code>#</code>号表示注释</li><li>每条指令都会创建一个新的镜像层，并对镜像进行提交</li></ul> 
<h6><a id="DockerDockerfile_30"></a>Docker执行Dockerfile的大致流程</h6> 
<ol><li>docker从基础镜像运行一个容器</li><li>执行一条指令并对容器做出修改</li><li>执行类似docker commit的操作提交一个新的镜像层</li><li>docker再基于刚提交的镜像运行一个新容器</li><li>执行Dockerfile中下一条指令直到所有指令都执行完成</li></ol> 
<h6><a id="_40"></a>总结</h6> 
<p>从应用软件的角度来看，Dockerfile、Docker镜像与Docker容器分别代表软件的三个不同阶段，</p> 
<ul><li>Dockerfile是软件的原材料</li><li>Docker镜像是软件的交付品</li><li>Docker容器则可以认为是软件镜像的运行态，也即依照镜像运行的容器实例</li></ul> 
<p>Dockerfile面向开发，Docker镜像成为交付标准，Docker容器则涉及部署与运维，三者缺一不可，合力充当Docker体系的基石。</p> 
<p><img src="https://images2.imgbox.com/92/5b/6Sj7DTuc_o.png" alt="在这里插入图片描述"></p> 
<ol><li> <p>Dockerfile，需要定义一个Dockerfile，Dockerfile定义了进程需要的一切东西。Dockerfile涉及的内容包括执行代码或者是文件、环境变量、依赖包、运行时环境、动态链接库、操作系统的发行版、服务进程和内核进程(当应用进程需要和系统服务和内核进程打交道，这时需要考虑如何设计namespace的权限控制)等等;</p> </li><li> <p>Docker镜像，在用Dockerfile定义一个文件之后，docker build时会产生一个Docker镜像，当运行 Docker镜像时会真正开始提供服务;</p> </li><li> <p>Docker容器，容器是直接提供服务的。</p> </li></ol> 
<h5><a id="_65"></a>常用保留字指令</h5> 
<table><thead><tr><th align="center">关键字</th><th align="center">作用</th><th align="center">备注</th></tr></thead><tbody><tr><td align="center">FROM</td><td align="center">指定基础镜像</td><td align="center">指定一个已经存在的镜像作为父镜像，第一条指令必须是FROM</td></tr><tr><td align="center">WAINTAINER</td><td align="center">指定作者信息</td><td align="center">一般是姓名+邮箱（<code>name&lt;mail&gt;</code>)</td></tr><tr><td align="center">LABEL</td><td align="center">标明dockerfile的标签</td><td align="center">可以使用Label代替Maintainer，最终都是在docker image基本信息中可以查看</td></tr><tr><td align="center">RUN</td><td align="center">构建镜像时运行的命令</td><td align="center">容器构建时需要运行的命令；有两种格式：shell格式、exec格式；RUN是在docker build时运行</td></tr><tr><td align="center"></td><td align="center">shell格式</td><td align="center"><img src="https://images2.imgbox.com/2d/33/pbXT9acc_o.png" alt="在这里插入图片描述"></td></tr><tr><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="center"></td><td align="center">exec格式</td><td align="center"><img src="https://images2.imgbox.com/78/4c/f2rYalNJ_o.png" alt="在这里插入图片描述"></td></tr><tr><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="center">EXPOSE</td><td align="center">暴露端口</td><td align="center">定义容器运行的时候监听的端口，启动容器的使用-p来绑定暴露端口，格式: EXPOSE 8080 或者 EXPOSE 8080/udp</td></tr><tr><td align="center">WORKDIR</td><td align="center">指定工作目录</td><td align="center">指定在创建容器后，终端默认登陆的进来工作目录，一个落脚点</td></tr><tr><td align="center">USER</td><td align="center">指定执行用户</td><td align="center">指定build或者启动的时候 用户 在RUN CMD ENTRYPONT执行的时候的用户</td></tr><tr><td align="center">ENV</td><td align="center">设置环境变量</td><td align="center">指定build时候的环境变量 可以在启动的容器的时候 通过-e覆盖 格式ENV name=value</td></tr><tr><td align="center">ADD</td><td align="center">添加文件</td><td align="center">将宿主机目录下的文件拷贝进镜像且会自动处理URL和解压tar压缩包</td></tr><tr><td align="center">COPY</td><td align="center">复制文件</td><td align="center">类似ADD，拷贝文件和目录到镜像中。<br>将从构建上下文目录中 &lt;源路径&gt; 的文件/目录复制到新的一层的镜像内的 &lt;目标路径&gt; 位置</td></tr><tr><td align="center">VOLUME</td><td align="center">定义外部可以挂载的数据卷</td><td align="center">用于数据保存和持久化；<br>指定build的image哪些目录可以启动的时候挂载到文件系统中 启动容器的时候使用 -v 绑定 格式 VOLUME [“目录”]</td></tr><tr><td align="center">CMD</td><td align="center">指定容器启动后的要干的事情</td><td align="center"><img src="https://images2.imgbox.com/eb/9f/Msmjsq9g_o.png" alt="在这里插入图片描述">Dockerfile 中可以有多个 CMD 指令，但<strong>只有最后一个生效，CMD 会被 docker run 之后的参数替换</strong></td></tr><tr><td align="center">ENTRYPOINT</td><td align="center">也是用来指定一个容器启动时要运行的命令</td><td align="center">类似于 CMD 指令，但是ENTRYPOINT<strong>不会被docker run后面的命令覆盖</strong>，而且这些命令行参数<strong>会被当作参数送给 ENTRYPOINT 指令指定的程序</strong></td></tr><tr><td align="center"></td><td align="center"></td><td align="center"></td></tr></tbody></table> 
<ul><li> <p>RUN和CMD的区别</p> 
  <ul><li>CMD是在docker run时运行</li><li>RUN是在docker build时运行</li></ul> </li><li> <p>ENTRYPOINT</p> 
  <ul><li> <p>命令格式：<code>ENTRYPOINT ["&lt;executeable&gt;", "&lt;param1&gt;", "&lt;param2&gt;",...]</code></p> </li><li> <p>ENTRYPOINT可以和CMD一起用，一般是<strong>变参</strong>才会使用 CMD ，这里的 CMD 等于是在给 ENTRYPOINT 传参。当指定了ENTRYPOINT后，CMD的含义就发生了变化，不再是直接运行其命令而是将CMD的内容作为参数传递给ENTRYPOINT指令，他两个组合会变成<code>&lt;ENTRYPOINT&gt;"&lt;CMD&gt;"</code></p> </li><li> <p>案例：</p> <p>假设已通过 Dockerfile 构建了 nginx:test 镜像：</p> 
    <ul><li> <pre><code class="prism language-shell">FROM nginx

ENTRYPOINT <span class="token punctuation">[</span><span class="token string">"nginx"</span>, <span class="token string">"-c"</span><span class="token punctuation">]</span>  <span class="token comment"># 定参</span>
CMD <span class="token punctuation">[</span><span class="token string">"/etc/nginx/nginx.conf"</span><span class="token punctuation">]</span>  <span class="token comment"># 变参</span>
</code></pre> </li><li> 
      <table><thead><tr><th align="center">是否传参</th><th align="center">Docker命令</th><th align="center">衍生出的实际命令</th></tr></thead><tbody><tr><td align="center">按照dockerfile编写执行</td><td align="center">docker run nginx:test</td><td align="center">nginx -c /etc/nginx/nginx.conf</td></tr><tr><td align="center">传参运行</td><td align="center">docker run nginx:test -c /etc/nginx/new.conf</td><td align="center">nginx -c /etc/nginx/new.conf</td></tr></tbody></table></li></ul> </li></ul> </li></ul> 
<p><strong>总结：</strong></p> 
<p><img src="https://images2.imgbox.com/92/01/zCsSGxDl_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="centos_127"></a>自定义centos镜像</h5> 
<ol><li> <p>编写dockerfile文件</p> <pre><code class="prism language-dockerfile">FROM centos:7
MAINTAINER jiang&lt;2790810983@qq.com&gt;

ENV MYPATH /usr/local
WORKDIR $MYPATH

#安装vim编辑器
RUN yum -y install vim
#安装ifconfig命令查看网络IP
RUN yum -y install net-tools

EXPOSE 80

CMD echo $MYPATH
CMD echo "------ok--------"

CMD /bin/bash
</code></pre> <pre><code class="prism language-shell"><span class="token punctuation">[</span>root@VM-4-9-centos dockerfile<span class="token punctuation">]</span><span class="token comment"># pwd</span>
/dockerfile
<span class="token punctuation">[</span>root@VM-4-9-centos dockerfile<span class="token punctuation">]</span><span class="token comment"># cat mydockerfile-centos </span>
FROM centos:7
MAINTAINER jiang<span class="token operator">&lt;</span><span class="token number">2790810983</span>@qq.com<span class="token operator">&gt;</span>

ENV MYPATH /usr/local
WORKDIR <span class="token variable">$MYPATH</span>

<span class="token comment">#安装vim编辑器</span>
RUN yum <span class="token parameter variable">-y</span> <span class="token function">install</span> <span class="token function">vim</span>
<span class="token comment">#安装ifconfig命令查看网络IP</span>
RUN yum <span class="token parameter variable">-y</span> <span class="token function">install</span> net-tools

EXPOSE <span class="token number">80</span>

CMD <span class="token builtin class-name">echo</span> <span class="token variable">$MYPATH</span>
CMD <span class="token builtin class-name">echo</span> <span class="token string">"------ok--------"</span>

CMD /bin/bash
</code></pre> </li><li> <p>构建<code>docker build -f mydockerfile-centos -t mycentos:1.0 .</code>（注意：<strong>. 前面有空格</strong>；官方命名<mark>Dockerfile</mark>，使用其编写文件，build时不需要-f指定文件）</p> <pre><code class="prism language-shell"><span class="token punctuation">[</span>root@VM-4-9-centos dockerfile<span class="token punctuation">]</span><span class="token comment"># docker build -f mydockerfile-centos -t mycentos:1.0 .</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Building <span class="token number">76</span>.7s <span class="token punctuation">(</span><span class="token number">8</span>/8<span class="token punctuation">)</span> FINISHED                                                                                                                                           docker:default
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>internal<span class="token punctuation">]</span> load build definition from mydockerfile-centos                                                                                                                         <span class="token number">0</span>.0s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> transferring dockerfile: 318B                                                                                                                                                  <span class="token number">0</span>.0s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>internal<span class="token punctuation">]</span> load .dockerignore                                                                                                                                                     <span class="token number">0</span>.0s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> transferring context: 2B                                                                                                                                                       <span class="token number">0</span>.0s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>internal<span class="token punctuation">]</span> load metadata <span class="token keyword">for</span> docker.io/library/centos:7                                                                                                                          <span class="token number">16</span>.9s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token number">1</span>/4<span class="token punctuation">]</span> FROM docker.io/library/centos:7@sha256:9d4bcbbb213dfd745b58be38b13b996ebb5ac315fe75711bd618426a630e0987                                                                    <span class="token number">11</span>.8s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> resolve docker.io/library/centos:7@sha256:9d4bcbbb213dfd745b58be38b13b996ebb5ac315fe75711bd618426a630e0987                                                                     <span class="token number">0</span>.0s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> sha256:9d4bcbbb213dfd745b58be38b13b996ebb5ac315fe75711bd618426a630e0987 <span class="token number">1</span>.20kB / <span class="token number">1</span>.20kB                                                                                        <span class="token number">0</span>.0s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> sha256:dead07b4d8ed7e29e98de0f4504d87e8880d4347859d839686a31da35a3b532f 529B / 529B                                                                                            <span class="token number">0</span>.0s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> sha256:eeb6ee3f44bd0b5103bb561b4c16bcb82328cfe5809ab675bb17ab3a16c517c9 <span class="token number">2</span>.75kB / <span class="token number">2</span>.75kB                                                                                        <span class="token number">0</span>.0s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> sha256:2d473b07cdd5f0912cd6f1a703352c82b512407db6b05b43f2553732b55df3bc <span class="token number">76</span>.10MB / <span class="token number">76</span>.10MB                                                                                      <span class="token number">6</span>.6s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> extracting sha256:2d473b07cdd5f0912cd6f1a703352c82b512407db6b05b43f2553732b55df3bc                                                                                             <span class="token number">4</span>.8s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token number">2</span>/4<span class="token punctuation">]</span> WORKDIR /usr/local                                                                                                                                                          <span class="token number">0</span>.1s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token number">3</span>/4<span class="token punctuation">]</span> RUN yum <span class="token parameter variable">-y</span> <span class="token function">install</span> <span class="token function">vim</span>                                                                                                                                                     <span class="token number">40</span>.6s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token number">4</span>/4<span class="token punctuation">]</span> RUN yum <span class="token parameter variable">-y</span> <span class="token function">install</span> net-tools                                                                                                                                                <span class="token number">4</span>.3s
 <span class="token operator">=</span><span class="token operator">&gt;</span> exporting to image                                                                                                                                                                <span class="token number">2</span>.8s 
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> exporting layers                                                                                                                                                               <span class="token number">2</span>.7s 
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> writing image sha256:b7a758d3704aa39b122ac1684fd8555406a5ea213ae5907308b96a9be53cd38d                                                                                          <span class="token number">0</span>.0s 
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> naming to docker.io/library/mycentos:1.0                                                                                                                                       <span class="token number">0</span>.0s 
<span class="token punctuation">[</span>root@VM-4-9-centos dockerfile<span class="token punctuation">]</span><span class="token comment"># docker images                                                                                                                                             </span>
REPOSITORY                    TAG                 IMAGE ID       CREATED          SIZE                                                                                                     
mycentos                      <span class="token number">1.0</span>                 b7a758d3704a   <span class="token number">27</span> seconds ago   666MB
</code></pre> </li><li> <p>运行（可以看到<strong>在基础的镜像上增加了vim和查看ip的功能</strong>）</p> <pre><code class="prism language-shell"><span class="token punctuation">[</span>root@VM-4-9-centos dockerfile<span class="token punctuation">]</span><span class="token comment"># docker run -it b7a758d3704a /bin/bash</span>
<span class="token punctuation">[</span>root@4f4c909635fe local<span class="token punctuation">]</span><span class="token comment"># vim a.txt</span>
<span class="token punctuation">[</span>root@4f4c909635fe local<span class="token punctuation">]</span><span class="token comment"># cat a.txt </span>
aaa
<span class="token punctuation">[</span>root@4f4c909635fe local<span class="token punctuation">]</span><span class="token comment"># ifconfig</span>
eth0: <span class="token assign-left variable">flags</span><span class="token operator">=</span><span class="token number">416</span><span class="token operator"><span class="token file-descriptor important">3</span>&lt;</span>UP,BROADCAST,RUNNING,MULTICAST<span class="token operator">&gt;</span>  mtu <span class="token number">1500</span>
        inet <span class="token number">172.17</span>.0.5  netmask <span class="token number">255.255</span>.0.0  broadcast <span class="token number">172.17</span>.255.255
        ether 02:42:ac:11:00:05  txqueuelen <span class="token number">0</span>  <span class="token punctuation">(</span>Ethernet<span class="token punctuation">)</span>
        RX packets <span class="token number">8</span>  bytes <span class="token number">656</span> <span class="token punctuation">(</span><span class="token number">656.0</span> B<span class="token punctuation">)</span>
        RX errors <span class="token number">0</span>  dropped <span class="token number">0</span>  overruns <span class="token number">0</span>  frame <span class="token number">0</span>
        TX packets <span class="token number">0</span>  bytes <span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">0.0</span> B<span class="token punctuation">)</span>
        TX errors <span class="token number">0</span>  dropped <span class="token number">0</span> overruns <span class="token number">0</span>  carrier <span class="token number">0</span>  collisions <span class="token number">0</span>

lo: <span class="token assign-left variable">flags</span><span class="token operator">=</span><span class="token number">7</span><span class="token operator"><span class="token file-descriptor important">3</span>&lt;</span>UP,LOOPBACK,RUNNING<span class="token operator">&gt;</span>  mtu <span class="token number">65536</span>
        inet <span class="token number">127.0</span>.0.1  netmask <span class="token number">255.0</span>.0.0
        loop  txqueuelen <span class="token number">1000</span>  <span class="token punctuation">(</span>Local Loopback<span class="token punctuation">)</span>
        RX packets <span class="token number">0</span>  bytes <span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">0.0</span> B<span class="token punctuation">)</span>
        RX errors <span class="token number">0</span>  dropped <span class="token number">0</span>  overruns <span class="token number">0</span>  frame <span class="token number">0</span>
        TX packets <span class="token number">0</span>  bytes <span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">0.0</span> B<span class="token punctuation">)</span>
        TX errors <span class="token number">0</span>  dropped <span class="token number">0</span> overruns <span class="token number">0</span>  carrier <span class="token number">0</span>  collisions <span class="token number">0</span>
</code></pre> </li><li> <p>查看镜像生成过程<code>docker history 镜像ID</code></p> <pre><code class="prism language-shell"><span class="token punctuation">[</span>root@VM-4-9-centos dockerfile<span class="token punctuation">]</span><span class="token comment"># docker history b7a758d3704a</span>
IMAGE          CREATED          CREATED BY                                      SIZE      COMMENT
b7a758d3704a   <span class="token number">28</span> minutes ago   CMD <span class="token punctuation">[</span><span class="token string">"/bin/sh"</span> <span class="token string">"-c"</span> <span class="token string">"/bin/bash"</span><span class="token punctuation">]</span>                0B        buildkit.dockerfile.v0
<span class="token operator">&lt;</span>missing<span class="token operator">&gt;</span>      <span class="token number">28</span> minutes ago   CMD <span class="token punctuation">[</span><span class="token string">"/bin/sh"</span> <span class="token string">"-c"</span> <span class="token string">"echo <span class="token entity" title='\"'>\"</span>------ok--------…   0B        buildkit.dockerfile.v0
&lt;missing&gt;      28 minutes ago   CMD ["</span>/bin/sh<span class="token string">" "</span>-c<span class="token string">" "</span><span class="token builtin class-name">echo</span> <span class="token variable">$MYPATH</span><span class="token string">"]             0B        buildkit.dockerfile.v0
&lt;missing&gt;      28 minutes ago   EXPOSE map[80/tcp:{}]                           0B        buildkit.dockerfile.v0
&lt;missing&gt;      28 minutes ago   RUN /bin/sh -c yum -y install net-tools # bu…   189MB     buildkit.dockerfile.v0
&lt;missing&gt;      28 minutes ago   RUN /bin/sh -c yum -y install vim # buildkit    274MB     buildkit.dockerfile.v0
&lt;missing&gt;      29 minutes ago   WORKDIR /usr/local                              0B        buildkit.dockerfile.v0
&lt;missing&gt;      29 minutes ago   ENV MYPATH=/usr/local                           0B        buildkit.dockerfile.v0
&lt;missing&gt;      29 minutes ago   MAINTAINER jiang&lt;2790810983@qq.com&gt;             0B        buildkit.dockerfile.v0
&lt;missing&gt;      23 months ago    /bin/sh -c #(nop)  CMD ["</span>/bin/bash"<span class="token punctuation">]</span>            0B        
<span class="token operator">&lt;</span>missing<span class="token operator">&gt;</span>      <span class="token number">23</span> months ago    /bin/sh <span class="token parameter variable">-c</span> <span class="token comment">#(nop)  LABEL org.label-schema.sc…   0B        </span>
<span class="token operator">&lt;</span>missing<span class="token operator">&gt;</span>      <span class="token number">23</span> months ago    /bin/sh <span class="token parameter variable">-c</span> <span class="token comment">#(nop) ADD file:b3ebbe8bd304723d4…   204MB     </span>
<span class="token punctuation">[</span>root@VM-4-9-centos dockerfile<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> </li></ol> 
<h5><a id="tomcat_250"></a>自定义tomcat镜像</h5> 
<ol><li> <p>编写Dockerfile文件</p> <pre><code class="prism language-dockerfile">FROM centos:7

MAINTAINER jiang&lt;2790810983@qq.com&gt;

ADD jdk-8u381-linux-x64.tar.gz /usr/local
ADD apache-tomcat-9.0.78.tar.gz /usr/local

RUN yum -y install vim

ENV MYPATH /usr/local

WORKDIR $MYPATH

ENV JAVA_HOME /usr/local/jdk1.8.0_381
ENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar

ENV CATALINA_HOME /usr/local/apache-tomcat-9.0.78
ENV CATALINA_BASH /usr/local/apache-tomcat-9.0.78
ENV PATH $PATH:$JAVA_HOME/bin:$CATALINA_HOME/lib:$CATALINA_HOME/bin

EXPOSE 8080

CMD /usr/local/apache-tomcat-9.0.78/bin/startup.sh &amp;&amp; tail -F /usr/local/apache-tomcat-9.0.78/bin/logs/catalina.out
</code></pre> </li><li> <p>构建镜像<code>docker build -t tomcat-jiang:1.0 .</code></p> <pre><code class="prism language-shell"><span class="token punctuation">[</span>root@VM-4-9-centos dockerfile<span class="token punctuation">]</span><span class="token comment"># docker build -t tomcat-jiang:1.0 .</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Building <span class="token number">0</span>.2s <span class="token punctuation">(</span><span class="token number">10</span>/10<span class="token punctuation">)</span> FINISHED                                                                                                                                          docker:default
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>internal<span class="token punctuation">]</span> load build definition from Dockerfile                                                                                                                                  <span class="token number">0</span>.0s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> transferring dockerfile: 639B                                                                                                                                                  <span class="token number">0</span>.0s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>internal<span class="token punctuation">]</span> load .dockerignore                                                                                                                                                     <span class="token number">0</span>.0s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> transferring context: 2B                                                                                                                                                       <span class="token number">0</span>.0s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>internal<span class="token punctuation">]</span> load metadata <span class="token keyword">for</span> docker.io/library/centos:7                                                                                                                           <span class="token number">0</span>.0s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token number">1</span>/5<span class="token punctuation">]</span> FROM docker.io/library/centos:7                                                                                                                                             <span class="token number">0</span>.0s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>internal<span class="token punctuation">]</span> load build context                                                                                                                                                     <span class="token number">0</span>.0s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> transferring context: 99B                                                                                                                                                      <span class="token number">0</span>.0s
 <span class="token operator">=</span><span class="token operator">&gt;</span> CACHED <span class="token punctuation">[</span><span class="token number">2</span>/5<span class="token punctuation">]</span> ADD jdk-8u381-linux-x64.tar.gz /usr/local                                                                                                                            <span class="token number">0</span>.0s
 <span class="token operator">=</span><span class="token operator">&gt;</span> CACHED <span class="token punctuation">[</span><span class="token number">3</span>/5<span class="token punctuation">]</span> ADD apache-tomcat-9.0.78.tar.gz /usr/local                                                                                                                           <span class="token number">0</span>.0s
 <span class="token operator">=</span><span class="token operator">&gt;</span> CACHED <span class="token punctuation">[</span><span class="token number">4</span>/5<span class="token punctuation">]</span> RUN yum <span class="token parameter variable">-y</span> <span class="token function">install</span> <span class="token function">vim</span>                                                                                                                                               <span class="token number">0</span>.0s
 <span class="token operator">=</span><span class="token operator">&gt;</span> CACHED <span class="token punctuation">[</span><span class="token number">5</span>/5<span class="token punctuation">]</span> WORKDIR /usr/local                                                                                                                                                   <span class="token number">0</span>.0s
 <span class="token operator">=</span><span class="token operator">&gt;</span> exporting to image                                                                                                                                                                <span class="token number">0</span>.0s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> exporting layers                                                                                                                                                               <span class="token number">0</span>.0s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> writing image sha256:a955df44eb4b65dee47a3dabdec2df4dd3af83e467d9bc6734ea9da5ebbfaf06                                                                                          <span class="token number">0</span>.0s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> naming to docker.io/library/tomcat-jiang:1.0 
<span class="token punctuation">[</span>root@VM-4-9-centos dockerfile<span class="token punctuation">]</span><span class="token comment"># docker images</span>
REPOSITORY                    TAG                 IMAGE ID       CREATED         SIZE
tomcat-jiang                  <span class="token number">1.0</span>                 a955df44eb4b   <span class="token number">2</span> hours ago     837MB
mycentos                      <span class="token number">1.0</span>                 b7a758d3704a   <span class="token number">5</span> hours ago     666MB
</code></pre> </li><li> <p>运行即可访问到主页<code>docker run -id --name=tomcat-jiang -p 8080:8080 -v /home/tomcat-jiang/webapps/test:/usr/local/apache-tomcat-9.0.78/webapps/test -v /home/tomcat-jiang/tomcatlogs/:/usr/local/apache-tomcat-9.0.78/logs tomcat-jiang:1.0</code></p> </li></ol> 
<h5><a id="_311"></a>虚悬镜像</h5> 
<blockquote> 
 <p>仓库名、标签信息都是<code>&lt;none&gt;</code>的镜像，俗称dangling image</p> 
</blockquote> 
<ul><li><code>docker image ls -f dangling=true</code> 查看虚悬镜像</li><li><code>docker image prune</code> 删除</li></ul> 
<p>自定义一个虚悬镜像：</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@VM-4-9-centos dockerfile<span class="token punctuation">]</span><span class="token comment"># vim danglingdockerfile</span>
<span class="token punctuation">[</span>root@VM-4-9-centos dockerfile<span class="token punctuation">]</span><span class="token comment"># cat danglingdockerfile </span>
FROM ubuntu

CMD <span class="token builtin class-name">echo</span><span class="token string">'--------ok--------'</span>

<span class="token punctuation">[</span>root@VM-4-9-centos dockerfile<span class="token punctuation">]</span><span class="token comment"># docker build -f danglingdockerfile .</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Building <span class="token number">17</span>.0s <span class="token punctuation">(</span><span class="token number">5</span>/5<span class="token punctuation">)</span> FINISHED                                                                                                                                           docker:default
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>internal<span class="token punctuation">]</span> load build definition from danglingdockerfile                                                                                                                          <span class="token number">0</span>.0s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> transferring dockerfile: 88B                                                                                                                                                   <span class="token number">0</span>.0s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>internal<span class="token punctuation">]</span> load .dockerignore                                                                                                                                                     <span class="token number">0</span>.0s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> transferring context: 2B                                                                                                                                                       <span class="token number">0</span>.0s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>internal<span class="token punctuation">]</span> load metadata <span class="token keyword">for</span> docker.io/library/ubuntu:latest                                                                                                                     <span class="token number">16</span>.8s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token number">1</span>/1<span class="token punctuation">]</span> FROM docker.io/library/ubuntu@sha256:626ffe58f6e7566e00254b638eb7e0f3b11d4da9675088f4781a50ae288f3322                                                                       <span class="token number">0</span>.1s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> resolve docker.io/library/ubuntu@sha256:626ffe58f6e7566e00254b638eb7e0f3b11d4da9675088f4781a50ae288f3322                                                                       <span class="token number">0</span>.0s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> sha256:626ffe58f6e7566e00254b638eb7e0f3b11d4da9675088f4781a50ae288f3322 <span class="token number">1</span>.42kB / <span class="token number">1</span>.42kB                                                                                        <span class="token number">0</span>.0s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> sha256:7cc0576c7c0ec2384de5cbf245f41567e922aab1b075f3e8ad565f508032df17 529B / 529B                                                                                            <span class="token number">0</span>.0s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> sha256:ba6acccedd2923aee4c2acc6a23780b14ed4b8a5fa4e14e252a23b846df9b6c1 <span class="token number">1</span>.46kB / <span class="token number">1</span>.46kB                                                                                        <span class="token number">0</span>.0s
 <span class="token operator">=</span><span class="token operator">&gt;</span> exporting to image                                                                                                                                                                <span class="token number">0</span>.0s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> exporting layers                                                                                                                                                               <span class="token number">0</span>.0s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> writing image sha256:bceab7bc196f17008c0ef5c5333dc29217c84ab0e4669b0a66021e1481eb5a86                                                                                          <span class="token number">0</span>.0s
<span class="token punctuation">[</span>root@VM-4-9-centos dockerfile<span class="token punctuation">]</span><span class="token comment"># docker images</span>
REPOSITORY                    TAG                 IMAGE ID       CREATED          SIZE
mytomcat                      <span class="token number">1.0</span>                 85a142640f0d   <span class="token number">33</span> minutes ago   837MB
mingdajiang/mytomcat          <span class="token number">1.0</span>                 85a142640f0d   <span class="token number">33</span> minutes ago   837MB
mycentos                      <span class="token number">1.0</span>                 b7a758d3704a   <span class="token number">3</span> hours ago      666MB
<span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>                        <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>              bceab7bc196f   <span class="token number">22</span> months ago    <span class="token number">72</span>.8MB
<span class="token punctuation">[</span>root@VM-4-9-centos dockerfile<span class="token punctuation">]</span><span class="token comment"># docker image ls -f dangling=true</span>
REPOSITORY   TAG       IMAGE ID       CREATED         SIZE
<span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>       <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>    bceab7bc196f   <span class="token number">22</span> months ago   <span class="token number">72</span>.8MB
<span class="token punctuation">[</span>root@VM-4-9-centos dockerfile<span class="token punctuation">]</span><span class="token comment"># docker image prune</span>
WARNING<span class="token operator">!</span> This will remove all dangling images.
Are you sure you want to continue? <span class="token punctuation">[</span>y/N<span class="token punctuation">]</span> y
Deleted Images:
deleted: sha256:bceab7bc196f17008c0ef5c5333dc29217c84ab0e4669b0a66021e1481eb5a86

Total reclaimed space: 0B
<span class="token punctuation">[</span>root@VM-4-9-centos dockerfile<span class="token punctuation">]</span><span class="token comment"># docker image ls -f dangling=true</span>
REPOSITORY   TAG       IMAGE ID   CREATED   SIZE
<span class="token punctuation">[</span>root@VM-4-9-centos dockerfile<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> 
<h4><a id="Docker_369"></a>Docker微服务实战</h4> 
<ol><li> <p>新建微服务模块</p> </li><li> <p>生成jar包</p> </li><li> <p>编写Dockerfile <code>vim Dockerfile</code></p> <pre><code class="prism language-dockerfile"># 基础镜像
FROM openjdk:8u102
# 作者
MAINTAINER jiang&lt;2790810983@qq.com&gt;
# 将jar包放到容器中
COPY finance.jar finance.jar
# 运行jar包
ENTRYPOINT ["java", "-jar", "finance.jar"]
# 暴露端口
EXPOSE 8080
</code></pre> </li><li> <p>将微服务jar包上传到和Dockerfile同一目录</p> <pre><code class="prism language-shell"><span class="token punctuation">[</span>root@VM-4-9-centos finance<span class="token punctuation">]</span><span class="token comment"># ls</span>
Dockerfile  finance.jar
<span class="token punctuation">[</span>root@VM-4-9-centos finance<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> </li><li> <p>构建镜像 <code>docker build -t finance:1.0 .</code></p> </li><li> <p>运行容器 <code>docker run -id -p 9000:8080 --name financeapp -v /home/finance/log:/var/applogs finance:1.0</code></p> </li><li> <p>访问测试</p> <p><img src="https://images2.imgbox.com/6e/5b/i1DV1vGc_o.png" alt="在这里插入图片描述"></p> </li></ol>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9d7d47cb7479e32501ffcdfac92f1af2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">django学习:ORM实现数据库的连接、表的创建与增删改查</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e389b852e7223347b18f583c5f809e64/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">NLP基础——中文分词</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>