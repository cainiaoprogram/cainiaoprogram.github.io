<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Node学习六 —— 文件操作（fs模块，打开关闭读写文件） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Node学习六 —— 文件操作（fs模块，打开关闭读写文件）" />
<meta property="og:description" content="文件操作-fs模块 const fs = require(&#39;fs&#39;); 引入fs模块之后，可以利用其中的接口进行文件操作。
查询文件的统计信息 可以使用 fs.stat函数查询，第一个参数为文件路径，第二个参数为查询完成之后的回调函数，回调函数接受一个参数，为查询的返回值。
返回值有文件的基本信息，具体就不列了，看文档即可。
该函数会将stats类的一个实例作为返回值传给回调，通过这个实例，我们可以调用以下函数：
isFile() ：如果是标准文件而不是目录、套接字、符号链接或者设备的话，返回true。isDirectory() ：如果是目录返回trueisBlockDevice ：是块设备返回trueisCharacterDevice() ：如果是字符设备返回true…多得就不举例了，各种格式都能查，看文档即可。 打开文件 在进行文件操作前，需使用 fs.open函数打开文件，然后使用文件描述符调用回调。然后可以在回调函数中读写。
文件描述符按照我的理解，就是相当于把某一路径下的文件打开后，让一个变量指向他，这个变量是一个特殊对象，可以使用很多文件接口。
第一个参数为文件路径；第二个是一个标志位，表明文件以何种模式打开，例如有r、r&#43;、w、w&#43;等等，表示读取、读写等以及数据流的位置在何处；第三个参数就是回调函数了，回调第一个参数为错误捕获，第二个参数为文件描述符。
读取文件 读取之前，请保证文件被打开，并且有一个缓冲区存放数据。（不知道缓冲区的可以参考此系列的第二篇博客）
fs.open(&#39;./x.text&#39;,&#39;r&#39;,function y(err,fd){ if(err) {throw err} // throw会自动return let bf = new Buffer(1024); let bfOffset = 0; let bfLength = bf.length; let filePosition = 100; fs.read(fd,bfOffset,bfLength,filePosition,function read(err,readBytes){ if(err) {throw err}; // readBytes为读入缓存区的字节数，如果为0代表到达文件末尾 if(readBytes &gt; 0) { console.log(bf.slice(0,readBytes)); } }) }) 上述代码在打开文件之后，从缓冲区的第100个字节（filePosition）开始，读取随后的1024个字节的数据。仔细读一下代码，在对应看变量，大家应该很好理解每个参数是什么作用了。
注意：一旦将缓冲区传递给fs.open，缓冲区的控制权就移交给read命令，在没有返还控制权到你手上的时候，也就是回调函数没有被调用的时候，不应该对该缓冲区进行操作，不然会乱套，你在读或者写我也在读或者写，这就会造成想象得到和想象不到的很多问题。
写入文件 使用 fs.write，通过向其传递一个包含数据的缓冲区，可以实现写入。
fs.open(&#39;./x.text&#39;,&#34;a&#34;,function w(err,fd){ let bf = new Buffer(&#39;writing this string&#39;), bfPosition = 0, bfLength = bf." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/c834fa0174cd06a81b45710dc1d8d442/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-09-10T17:02:46+08:00" />
<meta property="article:modified_time" content="2022-09-10T17:02:46+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Node学习六 —— 文件操作（fs模块，打开关闭读写文件）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="fs_0"></a>文件操作-fs模块</h2> 
<pre><code class="prism language-js"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>引入fs模块之后，可以利用其中的接口进行文件操作。</p> 
<h3><a id="_8"></a>查询文件的统计信息</h3> 
<p>可以使用 <code>fs.stat</code>函数查询，第一个参数为文件路径，第二个参数为查询完成之后的回调函数，回调函数接受一个参数，为查询的返回值。</p> 
<p>返回值有文件的基本信息，具体就不列了，看文档即可。</p> 
<p>该函数会将stats类的一个实例作为返回值传给回调，通过这个实例，我们可以调用以下函数：</p> 
<ul><li>isFile() ：如果是标准文件而不是目录、套接字、符号链接或者设备的话，返回true。</li><li>isDirectory() ：如果是目录返回true</li><li>isBlockDevice ：是块设备返回true</li><li>isCharacterDevice() ：如果是字符设备返回true</li><li>…多得就不举例了，各种格式都能查，看文档即可。</li></ul> 
<h3><a id="_22"></a>打开文件</h3> 
<p>在进行文件操作前，需使用 <code>fs.open</code>函数打开文件，然后使用文件描述符调用回调。然后可以在回调函数中读写。</p> 
<p>文件描述符按照我的理解，就是相当于把某一路径下的文件打开后，让一个变量指向他，这个变量是一个特殊对象，可以使用很多文件接口。</p> 
<p>第一个参数为文件路径；第二个是一个标志位，表明文件以何种模式打开，例如有r、r+、w、w+等等，表示读取、读写等以及数据流的位置在何处；第三个参数就是回调函数了，回调第一个参数为错误捕获，第二个参数为文件描述符。</p> 
<h3><a id="_30"></a>读取文件</h3> 
<p>读取之前，请保证文件被打开，并且有一个缓冲区存放数据。（不知道缓冲区的可以参考此系列的第二篇博客）</p> 
<pre><code class="prism language-js">fs<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'./x.text'</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token function">y</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>fd</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token keyword">throw</span> err<span class="token punctuation">}</span> <span class="token comment">// throw会自动return</span>
    <span class="token keyword">let</span> bf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> bfOffset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> bfLength <span class="token operator">=</span> bf<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token keyword">let</span> filePosition <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
    fs<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span>bfOffset<span class="token punctuation">,</span>bfLength<span class="token punctuation">,</span>filePosition<span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>readBytes</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token keyword">throw</span> err<span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// readBytes为读入缓存区的字节数，如果为0代表到达文件末尾</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>readBytes <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bf<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>readBytes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p>上述代码在打开文件之后，从缓冲区的第100个字节（filePosition）开始，读取随后的1024个字节的数据。仔细读一下代码，在对应看变量，大家应该很好理解每个参数是什么作用了。</p> 
<blockquote> 
 <p>注意：一旦将缓冲区传递给fs.open，缓冲区的控制权就移交给read命令，在没有返还控制权到你手上的时候，也就是回调函数没有被调用的时候，不应该对该缓冲区进行操作，不然会乱套，你在读或者写我也在读或者写，这就会造成想象得到和想象不到的很多问题。</p> 
</blockquote> 
<h3><a id="_57"></a>写入文件</h3> 
<p>使用 <code>fs.write</code>，通过向其传递一个包含数据的缓冲区，可以实现写入。</p> 
<pre><code class="prism language-js">fs<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'./x.text'</span><span class="token punctuation">,</span><span class="token string">"a"</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token function">w</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>fd</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">let</span> bf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span><span class="token string">'writing this string'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        bfPosition <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
        bfLength <span class="token operator">=</span> bf<span class="token punctuation">.</span>length<span class="token punctuation">,</span>
        filePosition <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    fs<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span>bf<span class="token punctuation">,</span>bfPosition<span class="token punctuation">,</span>bfLength<span class="token punctuation">,</span>filePosition<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>writen</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>writen<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p>上面的代码中，第一行用追加模式打开一个文件，然后在第六行向文件写入，传递的缓冲区包含以下信息：</p> 
<ul><li>准备写入缓冲区的数据</li><li>待写入数据在缓冲区中的起始位</li><li>写入数据的长度</li><li>从文件中的什么位置开始写入数据</li><li>写入完成后的回调</li></ul> 
<p>filePosition的初值为null，表示从当前文件的游标处开始。</p> 
<blockquote> 
 <p>注意：和读取操作一样，不要随便操作缓冲区</p> 
</blockquote> 
<h3><a id="_88"></a>关闭文件</h3> 
<p>上述所有例子中，都没有关闭文件，因为上面的代码只需要运行一次，运行完毕之后，程序退出，文件自动被关闭。但是实际代码中，一个文件被打开，那么就一定要被关闭。</p> 
<p>如果想要关闭，那么就需要用到文件描述符（一个指向文件的对象）。</p> 
<p>简单使用：</p> 
<pre><code class="prism language-js">fs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	<span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="_104"></a>后续</h3> 
<p>到目前为止，我们学习了用底层的基础语句来操作文件，而Node还有一种更高级的方式，就是使用 <code>Stream</code>。这个会在后面讲到，很快就要讲到了。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/42f60da59ab3c6ce7e7466a8f0f5dc32/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C语言经典算法实例5：验证哥德巴赫猜想</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9f36a90a2797f5989e99aaa75f605f2c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Ubuntu:gcc编译报错 fatal error: stdio.h 没有那个文件或目录解决方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>