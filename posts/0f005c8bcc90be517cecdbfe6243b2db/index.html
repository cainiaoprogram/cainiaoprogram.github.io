<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>编写Dockerfile制作自己的镜像并推送到私有仓库 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="编写Dockerfile制作自己的镜像并推送到私有仓库" />
<meta property="og:description" content="说明：我将用到的私有仓库是Harbor，安装教程参考我的这一篇文章：
安装搭建私有仓库Harbor_Word_Smith_的博客-CSDN博客
一、案例1 1、要求 编写Dockerfile制作Web应用系统nginx镜像，生成镜像nginx:v1.1，并推送其到私有仓库。具体要求如下：
（1）基于centos基础镜像
（2）指定作者信息
（3）安装nginx服务，将提供的dest目录（提供默认主页index.html）传到镜像内，并将dest目录内的前端文件复制到nginx的工作目录
（4）暴露80端口
（5）设置服务自启动
（6）验证镜像
2、实现步骤 （1）编写Dockerfile文件 #创建index.html前端文件 [root@node2 demo01]# cat index.html welcome to demo01 #创建demo01目录用来创建Dockerfile [root@node2 ~]# mkdir -p docker_demo/demo01 [root@node2 ~]# cd docker_demo/demo01/ [root@node2 demo01]# vim Dockerfile #写入以下内容 FROM centos MAINTAINER &#34;benjm &lt;benjm@163.com&gt;&#34; ADD http://nginx.org/download/nginx-1.24.0.tar.gz /usr/local/src/ COPY index.html /usr/share/nginx/ EXPOSE 80 CMD [&#34;/usr/sbin/nginx&#34;,&#34;-g&#34;,&#34;daemon off;&#34;] Dockerfile内容如下
（2）构建镜像 [root@node2 demo01]# docker build -t nginx:v1.1 ./ 查看
（3） 推送到私有仓库 在harbor上创建项目demo01 #首先登录到私有仓库 [root@node2 demo01]# docker login -u admin -p Harbor12345 192." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/0f005c8bcc90be517cecdbfe6243b2db/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-20T16:11:05+08:00" />
<meta property="article:modified_time" content="2023-08-20T16:11:05+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">编写Dockerfile制作自己的镜像并推送到私有仓库</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>说明：我将用到的私有仓库是Harbor，安装教程参考我的这一篇文章：</p> 
<p><a href="https://blog.csdn.net/Word_Smith_/article/details/132383734?spm=1001.2014.3001.5502" title="安装搭建私有仓库Harbor_Word_Smith_的博客-CSDN博客">安装搭建私有仓库Harbor_Word_Smith_的博客-CSDN博客</a></p> 
<h2>一、案例1</h2> 
<h3>1、要求</h3> 
<p>编写Dockerfile制作Web应用系统nginx镜像，生成镜像nginx:v1.1，并推送其到私有仓库。具体要求如下：</p> 
<p>（1）基于centos基础镜像</p> 
<p>（2）指定作者信息</p> 
<p>（3）安装nginx服务，将提供的dest目录（提供默认主页index.html）传到镜像内，并将dest目录内的前端文件复制到nginx的工作目录</p> 
<p>（4）暴露80端口</p> 
<p>（5）设置服务自启动</p> 
<p>（6）验证镜像</p> 
<h3>2、实现步骤</h3> 
<h4>（1）编写Dockerfile文件</h4> 
<pre><code class="language-bash">#创建index.html前端文件
[root@node2 demo01]# cat index.html 
welcome to demo01

#创建demo01目录用来创建Dockerfile
[root@node2 ~]# mkdir -p docker_demo/demo01
[root@node2 ~]# cd docker_demo/demo01/
[root@node2 demo01]# vim Dockerfile
#写入以下内容
FROM centos
MAINTAINER "benjm &lt;benjm@163.com&gt;"
ADD http://nginx.org/download/nginx-1.24.0.tar.gz /usr/local/src/
COPY index.html /usr/share/nginx/
EXPOSE 80
CMD ["/usr/sbin/nginx","-g","daemon off;"]</code></pre> 
<p> Dockerfile内容如下</p> 
<p><img alt="" height="164" src="https://images2.imgbox.com/99/5f/lvzkZuCo_o.png" width="660"></p> 
<h4>（2）构建镜像 </h4> 
<pre><code class="language-bash">[root@node2 demo01]# docker build -t nginx:v1.1 ./
</code></pre> 
<p>查看</p> 
<p><img alt="" height="52" src="https://images2.imgbox.com/b1/4f/tfiRPTDg_o.png" width="678"> </p> 
<h4>（3） 推送到私有仓库</h4> 
<p>在harbor上创建项目demo01 </p> 
<p><img alt="" height="735" src="https://images2.imgbox.com/48/4a/zasI5BPo_o.png" width="1200"></p> 
<pre><code class="language-bash">#首先登录到私有仓库
[root@node2 demo01]# docker login -u admin -p Harbor12345 192.168.198.200:80
WARNING! Using --password via the CLI is insecure. Use --password-stdin.
WARNING! Your password will be stored unencrypted in /root/.docker/config.json.
Configure a credential helper to remove this warning. See
https://docs.docker.com/engine/reference/commandline/login/#credentials-store

Login Succeeded

#给镜像打上合适的标签
[root@node2 demo01]# docker tag nginx:v1.1 192.168.198.200:80/demo01/nginx:v1.1
[root@node2 demo01]# docker images | grep demo01
192.168.198.200:80/demo01/nginx   v1.1      b4887857b526   8 minutes ago   231MB

#推送镜像到私有仓库
[root@node2 demo01]# docker push 192.168.198.200:80/demo01/nginx:v1.1
The push refers to repository [192.168.198.200:80/demo01/nginx]
02dfab95c1be: Pushed 
74ddd0ec08fa: Pushed 
v1.1: digest: sha256:888ed81c26b452ff94686c7709f1a6b668aeb2f2f7f80e4225eb83257428a8a7 size: 736
[root@node2 demo01]#</code></pre> 
<p> 然后就能在harbor上看到推送的镜像了</p> 
<p><img alt="" height="660" src="https://images2.imgbox.com/09/6e/RZb2zUQS_o.png" width="1200"> </p> 
<h2>二、案例2 </h2> 
<h3>1、要求</h3> 
<p>编写Dockerfile快速搭建自己专属的LAMP环境，生成镜像lamp:v1.1，并推送到私有仓库。具体要求如下：</p> 
<p>（1）基于centos:6基础镜像</p> 
<p>（2）指定作者信息</p> 
<p>（3）安装httpd、mysql、mysql-server、php、php-mysql、php-gd</p> 
<p>（4）暴露80和3306端口</p> 
<p>（5）设置服务自启动</p> 
<p>（6）验证镜像</p> 
<h3>2、实现步骤</h3> 
<h4>（1）编写Dockerfile文件</h4> 
<pre><code class="language-bash">[root@node2 ~]# mkdir -p docker_demo/demo02
[root@node2 ~]# cd docker_demo/demo02
[root@node2 demo02]# vim Dockerfile
#写入以下内容
FROM centos:6
MAINTAINER "benjm &lt;benjm@163.com&gt;"
ENV WEB_DOC_ROOT="/data/web/html"
RUN yum install httpd mysql mysql-server php php-mysql php-gd -y
EXPOSE 80/tcp
EXPOSE 3306/tcp
CMD /bin/httpd -f -h ${WEB_DOC_ROOT}</code></pre> 
<p> Dockerfile内容如下 </p> 
<p><img alt="" height="165" src="https://images2.imgbox.com/36/31/vCszfGhC_o.png" width="637"> </p> 
<h4>（2）构建镜像</h4> 
<pre><code class="language-bash">[root@node2 demo02]# docker build -t lamp:v1.1 ./
</code></pre> 
<p>查看</p> 
<p> <img alt="" height="51" src="https://images2.imgbox.com/da/37/OD8ElSSG_o.png" width="671"></p> 
<h4>（3）推送到私有仓库</h4> 
<p>在harbot上创建项目demo02</p> 
<p><img alt="" height="746" src="https://images2.imgbox.com/3b/c7/jaWlKKu6_o.png" width="1200"></p> 
<pre><code class="language-bash">#给镜像打上合适的标签
[root@node2 demo02]# docker tag lamp:v1.1 192.168.198.200:80/demo02/lamp:v1.1

#推送镜像到私有仓库
[root@node2 demo02]# docker push 192.168.198.200:80/demo02/lamp:v1.1
The push refers to repository [192.168.198.200:80/demo02/lamp]
74ddd0ec08fa: Mounted from demo01/nginx 
v1.1: digest: sha256:396c671a6ab30d329ec504736d1a5d37025360e98c68896c70f9ddfadc845eba size: 529
[root@node2 demo02]#</code></pre> 
<p>然后就能在harbor上看到推送的镜像了 </p> 
<p><img alt="" height="534" src="https://images2.imgbox.com/61/22/T6inuGNN_o.png" width="1200"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/171eeb9e7002e26b564ccb2dad5f7eb8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">解决npm安装错误:No matching version found for XXX@3.3.6</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6edf0e00f627d9af107326b47006478e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">google插件开发流程和示例，google插件开发过程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>