<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>MyBtais的SQL映射文件(元素,查询,映射,动态SQL) - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="MyBtais的SQL映射文件(元素,查询,映射,动态SQL)" />
<meta property="og:description" content="目录
1.概述
2.SQL映射文件元素
3.Mybatis框架的条件查询
3.1 单参数查询(模糊查询)
3.2 多参数查询
3.2.1 JavaBean 对象参数
3.2.2 Map 参数
3.2.3 @Param 注解 参数
3.2.4 底层顺序[param1,param2] 4.Mybatis框架的结果映射
4.1 resultMap自定义映射
4.1.1 ResultMap元素实现自定义结果映射
4.1.2 association 嵌套结果映射
4.1.3 collection 嵌套结果映射
4.1.4 resultType 和resultMap小结
4.1.5 自动映射配置
5.Mybtais框架的增删改操作
6.实现动态SQL
6.1 where &#43; if 组合标签
6.2 choose 标签
6.3 foreach 标签
6.3.1foreach 元素
6.4 set 标签
6.5 trim 标签
6.5.1 trim标签中的元素
1.概述 在SQL映射文件中，只需根据MyBatis提供的标签写入SQL语句操作， 将SQL语句从程序的代码中分离出来，对JDBC访问数据库的代码进行封装,只需关注sql事务操作。
2.SQL映射文件元素 以下是SQL映射文件中的部分常用元素
&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt; &lt;!DOCTYPE mapper PUBLIC &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/c3905d04e75e1c73eb4439623edebb00/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-11-30T20:47:27+08:00" />
<meta property="article:modified_time" content="2022-11-30T20:47:27+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">MyBtais的SQL映射文件(元素,查询,映射,动态SQL)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="1.%E6%A6%82%E8%BF%B0-toc" style="margin-left:0px;"><a href="#1.%E6%A6%82%E8%BF%B0" rel="nofollow">1.概述</a></p> 
<p id="2.SQL%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6%E5%85%83%E7%B4%A0-toc" style="margin-left:0px;"><a href="#2.SQL%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6%E5%85%83%E7%B4%A0" rel="nofollow">2.SQL映射文件元素</a></p> 
<p id="3.Mybatis%E6%A1%86%E6%9E%B6%E7%9A%84%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2-toc" style="margin-left:0px;"><a href="#3.Mybatis%E6%A1%86%E6%9E%B6%E7%9A%84%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2" rel="nofollow">3.Mybatis框架的条件查询</a></p> 
<p id="3.1%20%E5%8D%95%E5%8F%82%E6%95%B0%E6%9F%A5%E8%AF%A2(%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2)-toc" style="margin-left:40px;"><a href="#3.1%20%E5%8D%95%E5%8F%82%E6%95%B0%E6%9F%A5%E8%AF%A2%28%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2%29" rel="nofollow">3.1 单参数查询(模糊查询)</a></p> 
<p id="3.2%20%E5%A4%9A%E5%8F%82%E6%95%B0%E6%9F%A5%E8%AF%A2-toc" style="margin-left:40px;"><a href="#3.2%20%E5%A4%9A%E5%8F%82%E6%95%B0%E6%9F%A5%E8%AF%A2" rel="nofollow">3.2 多参数查询</a></p> 
<p id="3.2.1%20JavaBean%20%E5%AF%B9%E8%B1%A1%E5%8F%82%E6%95%B0-toc" style="margin-left:80px;"><a href="#3.2.1%20JavaBean%20%E5%AF%B9%E8%B1%A1%E5%8F%82%E6%95%B0" rel="nofollow">3.2.1 JavaBean 对象参数</a></p> 
<p id="3.2.2%20Map%20%E5%8F%82%E6%95%B0-toc" style="margin-left:80px;"><a href="#3.2.2%20Map%20%E5%8F%82%E6%95%B0" rel="nofollow">3.2.2 Map 参数</a></p> 
<p id="3.2.3%20%40Param%20%E6%B3%A8%E8%A7%A3%20%E5%8F%82%E6%95%B0-toc" style="margin-left:80px;"><a href="#3.2.3%20%40Param%20%E6%B3%A8%E8%A7%A3%20%E5%8F%82%E6%95%B0" rel="nofollow">3.2.3 @Param 注解 参数</a></p> 
<p id="3.2.4%20%E5%BA%95%E5%B1%82%E9%A1%BA%E5%BA%8F%5Bparam1%2Cparam2%5D%C2%A0%C2%A0-toc" style="margin-left:80px;"><a href="#3.2.4%20%E5%BA%95%E5%B1%82%E9%A1%BA%E5%BA%8F%5Bparam1%2Cparam2%5D%C2%A0%C2%A0" rel="nofollow">3.2.4 底层顺序[param1,param2]  </a></p> 
<p id="4.Mybatis%E6%A1%86%E6%9E%B6%E7%9A%84%E7%BB%93%E6%9E%9C%E6%98%A0%E5%B0%84-toc" style="margin-left:0px;"><a href="#4.Mybatis%E6%A1%86%E6%9E%B6%E7%9A%84%E7%BB%93%E6%9E%9C%E6%98%A0%E5%B0%84" rel="nofollow">4.Mybatis框架的结果映射</a></p> 
<p id="4.1%20resultMap%E8%87%AA%E5%AE%9A%E4%B9%89%E6%98%A0%E5%B0%84-toc" style="margin-left:40px;"><a href="#4.1%20resultMap%E8%87%AA%E5%AE%9A%E4%B9%89%E6%98%A0%E5%B0%84" rel="nofollow">4.1 resultMap自定义映射</a></p> 
<p id="4.1.1%C2%A0ResultMap%E5%85%83%E7%B4%A0%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%93%E6%9E%9C%E6%98%A0%E5%B0%84-toc" style="margin-left:80px;"><a href="#4.1.1%C2%A0ResultMap%E5%85%83%E7%B4%A0%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%93%E6%9E%9C%E6%98%A0%E5%B0%84" rel="nofollow">4.1.1 ResultMap元素实现自定义结果映射</a></p> 
<p id="4.1.2%C2%A0association%20%E5%B5%8C%E5%A5%97%E7%BB%93%E6%9E%9C%E6%98%A0%E5%B0%84-toc" style="margin-left:80px;"><a href="#4.1.2%C2%A0association%20%E5%B5%8C%E5%A5%97%E7%BB%93%E6%9E%9C%E6%98%A0%E5%B0%84" rel="nofollow">4.1.2 association 嵌套结果映射</a></p> 
<p id="4.1.3%C2%A0collection%20%E5%B5%8C%E5%A5%97%E7%BB%93%E6%9E%9C%E6%98%A0%E5%B0%84-toc" style="margin-left:80px;"><a href="#4.1.3%C2%A0collection%20%E5%B5%8C%E5%A5%97%E7%BB%93%E6%9E%9C%E6%98%A0%E5%B0%84" rel="nofollow">4.1.3 collection 嵌套结果映射</a></p> 
<p id="4.1.4%20resultType%20%E5%92%8CresultMap%E5%B0%8F%E7%BB%93-toc" style="margin-left:80px;"><a href="#4.1.4%20resultType%20%E5%92%8CresultMap%E5%B0%8F%E7%BB%93" rel="nofollow">4.1.4 resultType 和resultMap小结</a></p> 
<p id="4.1.5%20%E8%87%AA%E5%8A%A8%E6%98%A0%E5%B0%84%E9%85%8D%E7%BD%AE-toc" style="margin-left:80px;"><a href="#4.1.5%20%E8%87%AA%E5%8A%A8%E6%98%A0%E5%B0%84%E9%85%8D%E7%BD%AE" rel="nofollow">4.1.5 自动映射配置</a></p> 
<p id="5.Mybtais%E6%A1%86%E6%9E%B6%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9%E6%93%8D%E4%BD%9C-toc" style="margin-left:0px;"><a href="#5.Mybtais%E6%A1%86%E6%9E%B6%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9%E6%93%8D%E4%BD%9C" rel="nofollow">5.Mybtais框架的增删改操作</a></p> 
<p id="6.%E5%AE%9E%E7%8E%B0%E5%8A%A8%E6%80%81SQL-toc" style="margin-left:0px;"><a href="#6.%E5%AE%9E%E7%8E%B0%E5%8A%A8%E6%80%81SQL" rel="nofollow">6.实现动态SQL</a></p> 
<p id="6.1%20where%20%2B%20if%20%E7%BB%84%E5%90%88%E6%A0%87%E7%AD%BE-toc" style="margin-left:40px;"><a href="#6.1%20where%20%2B%20if%20%E7%BB%84%E5%90%88%E6%A0%87%E7%AD%BE" rel="nofollow">6.1 where + if 组合标签</a></p> 
<p id="6.2%20choose%20%E6%A0%87%E7%AD%BE-toc" style="margin-left:40px;"><a href="#6.2%20choose%20%E6%A0%87%E7%AD%BE" rel="nofollow">6.2 choose 标签</a></p> 
<p id="6.3%20foreach%20%E6%A0%87%E7%AD%BE-toc" style="margin-left:40px;"><a href="#6.3%20foreach%20%E6%A0%87%E7%AD%BE" rel="nofollow">6.3 foreach 标签</a></p> 
<p id="6.3.1foreach%20%E5%85%83%E7%B4%A0-toc" style="margin-left:80px;"><a href="#6.3.1foreach%20%E5%85%83%E7%B4%A0" rel="nofollow">6.3.1foreach 元素</a></p> 
<p id="6.4%20set%20%E6%A0%87%E7%AD%BE-toc" style="margin-left:40px;"><a href="#6.4%20set%20%E6%A0%87%E7%AD%BE" rel="nofollow">6.4 set 标签</a></p> 
<p id="6.5%C2%A0trim%20%E6%A0%87%E7%AD%BE-toc" style="margin-left:40px;"><a href="#6.5%C2%A0trim%20%E6%A0%87%E7%AD%BE" rel="nofollow">6.5 trim 标签</a></p> 
<p id="6.5.1%20trim%E6%A0%87%E7%AD%BE%E4%B8%AD%E7%9A%84%E5%85%83%E7%B4%A0-toc" style="margin-left:80px;"><a href="#6.5.1%20trim%E6%A0%87%E7%AD%BE%E4%B8%AD%E7%9A%84%E5%85%83%E7%B4%A0" rel="nofollow">6.5.1 trim标签中的元素</a></p> 
<h2 id="1.%E6%A6%82%E8%BF%B0">1.概述</h2> 
<p>     在SQL映射文件中，只需根据MyBatis提供的标签写入SQL语句操作， <strong>将SQL语句从程序的代码中分离出来，对JDBC访问数据库的代码进行封装,只需关注sql事务操作</strong>。</p> 
<h2 id="2.SQL%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6%E5%85%83%E7%B4%A0">2.SQL映射文件元素</h2> 
<p> 以下是SQL映射文件中的部分常用元素</p> 
<pre><code class="language-XML">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;
&lt;!--命名空间，所对应的mapper接口的完全限定路径--&gt;
&lt;mapper namespace="dao.SysUserMapper"&gt;
    &lt;!--配置二级缓存--&gt;
    &lt;cache eviction="FIFO" flushInterval="60000" size="512" readOnly="true"/&gt;
    &lt;!--插入标签--&gt;
    &lt;insert&gt;&lt;/insert&gt;
    &lt;!--更改标签--&gt;
    &lt;update&gt;&lt;/update&gt;
    &lt;!--查询标签--&gt;
    &lt;select&gt;&lt;/select&gt;
    &lt;!--删除标签--&gt;
    &lt;delete&gt;&lt;/delete&gt;
    &lt;!--自定义映射标签--&gt;
    &lt;resultMap&gt;&lt;/resultMap&gt;
    ......
&lt;/mapper&gt;</code></pre> 
<h2 id="3.Mybatis%E6%A1%86%E6%9E%B6%E7%9A%84%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2">3.Mybatis框架的条件查询</h2> 
<p> -  sql语句中的#{} 代表一个占位符，可根据key 找到值</p> 
<h3 id="3.1%20%E5%8D%95%E5%8F%82%E6%95%B0%E6%9F%A5%E8%AF%A2(%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2)">3.1 单参数查询(模糊查询)</h3> 
<p>- 查询一个条件的值时，不需写key 标识对应 如: Param, 一个参数时MyBtais会自动找到。</p> 
<p>-<span style="color:#ad720d;"> Mapper 接口</span></p> 
<pre><code class="language-java">    /**
     * 模糊查询用户姓名
     */
    List&lt;User&gt; getLikeAllUser(String name);</code></pre> 
<p>- <span style="color:#ad720d;">Mapper.xml 映射文件</span></p> 
<pre><code class="language-XML">&lt;!--id 必须跟接口的方法一致--&gt;
&lt;!--resultType 返回结果类型--&gt;
&lt;select id="getLikeAllUser" resultType="user"&gt;
 --模糊查询用户表里的名称
  select * from user where username like CONCAT("%",#{username},"%")
&lt;/select&gt;</code></pre> 
<h3 id="3.2%20%E5%A4%9A%E5%8F%82%E6%95%B0%E6%9F%A5%E8%AF%A2">3.2 多参数查询</h3> 
<h4 id="3.2.1%20JavaBean%20%E5%AF%B9%E8%B1%A1%E5%8F%82%E6%95%B0">3.2.1 JavaBean 对象参数</h4> 
<p><span style="color:#ad720d;">- Mapper 接口</span></p> 
<pre><code class="language-java">    /**
     * 多条件模糊查询用户姓名
     */
    List&lt;User&gt; getLikesAllUser(User user);</code></pre> 
<p>- <span style="color:#ad720d;">Mapper.xml 映射文件</span></p> 
<pre><code class="language-XML">&lt;select id="getLikesAllUser" resultType="user" parameterType="user"&gt;
   select id,name,password from user where name like CONCAT("%",#{name},"%") and id=#{id}
 &lt;/select&gt;</code></pre> 
<h4 id="3.2.2%20Map%20%E5%8F%82%E6%95%B0">3.2.2 Map 参数</h4> 
<p>- 直接根据map 的key 来找值</p> 
<pre><code class="language-java">/**
  * 根据Map 来查询用户信息
 */
 List&lt;User&gt; getLikeUserByMap(Map&lt;String,Object&gt; map);</code></pre> 
<pre><code class="language-XML">  &lt;select id="getLikeUserByMap" resultType="cn.bdqn.entity.User"&gt;
        select id,name,password from user where name like CONCAT(#{name},"%") and password=#{password}
    &lt;/select&gt;</code></pre> 
<h4 id="3.2.3%20%40Param%20%E6%B3%A8%E8%A7%A3%20%E5%8F%82%E6%95%B0">3.2.3 @Param 注解 参数</h4> 
<p>- 没使用@Param注解<strong>多参数查询</strong>前，<span style="color:#be191c;">遇到的问题</span>：</p> 
<pre><code class="language-java">/**
  * 根据两个参数条件查询用户信息
  */
List&lt;User&gt; getLikeUsersNoByParam(String name,String password);</code></pre> 
<pre><code class="language-XML"> &lt;select id="getLikeUsersNoByParam" resultType="user"&gt;
    select id,name,password from user where name like CONCAT(#{name},"%") and password=#{password}
  &lt;/select&gt;</code></pre> 
<p>-<span style="color:#ad720d;"> 上述代码执行结果:</span></p> 
<p><span style="color:#ad720d;"> 该代码出现异常，指定没有找到key .</span></p> 
<p style="text-align:center;"><img alt="" class="left" src="https://images2.imgbox.com/30/3e/dQXQuXrD_o.png"></p> 
<p><span style="color:#be191c;"> 报错原因：由于是多个参数传值，底层是key-value形式，而java编译时会将sql里的name,password转译成 [arg1,arg0,param1,param2],只限于JDK1.8中。如果不将key设置成底层格式，如param1,他就会找不到参数的顺序，所以会报错。</span></p> 
<p>- <span style="color:#ad720d;">使用@param注解设置key 会自动跟sql里的key 进行匹配，顺序更好查找。</span></p> 
<pre><code class="language-java">/**
  * @param注解来查找用户信息
  */ 
List&lt;User&gt; getLikeUsersByParam(@Param("name") String name,@Param("password") String password);


/**
 * 将@Param作为实体类的key查找
 */
List&lt;User&gt; getLikeUsersByJOUO(@Param("user") User user);
</code></pre> 
<p>- @Param将实体类作为key时，sql中要通过它的key . 出来值</p> 
<pre><code class="language-XML">&lt;!--sql语句中的值必须跟Param注解里的key一致--&gt;
&lt;select id="getLikeUsersByParam" resultType="cn.bdqn.entity.User"&gt;
      select id,name,password from user where name like CONCAT(#{name},"%") and password=#{password}
  &lt;/select&gt;

&lt;select id="getLikeUsersByJOUO" resultType="cn.bdqn.entity.User"&gt;
   select id,name,password from user where name like CONCAT(#{user.name},"%") and password=#{user.password}

&lt;/select&gt;</code></pre> 
<h4 id="3.2.4%20%E5%BA%95%E5%B1%82%E9%A1%BA%E5%BA%8F%5Bparam1%2Cparam2%5D%C2%A0%C2%A0">3.2.4 底层顺序[param1,param2]  </h4> 
<p>-  实现多参数时，也可以使用底层顺序，但是sql中的值必须跟底层名称一样，如: param1,param2,一定要注意参数顺序。</p> 
<pre><code class="language-XML"> &lt;select id="getLikeUsers" resultType="cn.bdqn.entity.User"&gt;
   select id,name,password from user where name like CONCAT(#{param1},"%") and password=#{param2}
&lt;/select&gt;</code></pre> 
<h2 id="4.Mybatis%E6%A1%86%E6%9E%B6%E7%9A%84%E7%BB%93%E6%9E%9C%E6%98%A0%E5%B0%84">4.Mybatis框架的结果映射</h2> 
<p> -  MyBtais SQL映射文件查找时，必须返回一个resultType的类型去接收，最后自动映射，但是自动映射的<strong>前提为： 实体类属性与数据库字段名称一致。<span style="color:#be191c;">但是</span></strong>，按照<span style="color:#be191c;">阿里巴巴开发规约的规定</span>，数据库<span style="color:#be191c;">不允许出现大写字母</span>，两个字母中间使用_连接这种情况下<strong>建议使用resultMap进行自定义映射。</strong></p> 
<h3 id="4.1%20resultMap%E8%87%AA%E5%AE%9A%E4%B9%89%E6%98%A0%E5%B0%84"><strong>4.1 resultMap自定义映射</strong></h3> 
<p><strong>- 当数据库字段和实体类属性名称不一致时或返回多个实体类时，可以使用resultMap自定义结果映射。</strong></p> 
<h4 id="4.1.1%C2%A0ResultMap%E5%85%83%E7%B4%A0%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%93%E6%9E%9C%E6%98%A0%E5%B0%84"><strong>4.1.1 </strong>ResultMap元素实现自定义结果映射</h4> 
<p>- 当没有设置剩下的属性时，他们可以自动映射,前提是名称一致。</p> 
<pre><code class="language-XML">&lt;resultMap id="userIdCard" type="user"&gt;
    &lt;id property="id" column="id"&gt;&lt;/id&gt;
    &lt;result property="idCard" column="id_card"&gt;&lt;/result&gt;
&lt;/resultMap&gt;
&lt;select id="getResultMapTest" resultMap="userIdCard"&gt;
        select * from user
&lt;/select&gt;</code></pre> 
<p><strong>注意：</strong></p> 
<ol><li><strong> </strong>select标签中的resultMap必须和定义好的resultMap标签中的id保持一致。</li><li>resultMap标签中的id必须唯一。</li></ol> 
<h4 id="4.1.2%C2%A0association%20%E5%B5%8C%E5%A5%97%E7%BB%93%E6%9E%9C%E6%98%A0%E5%B0%84">4.1.2 <strong style="color:#4f4f4f;font-size:18px;font-weight:bold;">association 嵌套结果映射</strong></h4> 
<p> -  association 嵌套结果映射<strong>适用于多个实体类查询时</strong>，并且实体类对应的关系是,一对一，多对一。</p> 
<p>-   一对一: 如: 一个学生只属于一个班级</p> 
<p>-   多对一: 多个学生都属于一个班级</p> 
<p>- <strong><span style="color:#ad720d;">Student 实体类中定义Class班级</span></strong></p> 
<pre><code class="language-java">
public class User implements Serializable {
    private Integer id;
    private String  name;
    private String password;
    //将班级类定义为成员变量(一个实体对象)
    private ClassInfo classInfo; 

    //...省略get set 方法...

 }</code></pre> 
<p><strong> -</strong> <strong><span style="color:#ad720d;">resultMap 写法</span></strong></p> 
<pre><code class="language-XML">&lt;resultMap id="getStudentsByClassInfo" type="student"&gt;
     &lt;id property="id" column="id"&gt;&lt;/id&gt;
     &lt;result property="name" column="name"&gt;&lt;/result&gt;
     &lt;!--嵌套从表并返回实体类类型--&gt;
     &lt;association property="classInfo" javaType="classInfo"&gt;
          &lt;id property="classId" column="class_id"&gt;&lt;/id&gt;
          &lt;result property="calssName" column="class_name"&gt;&lt;/result&gt;
     &lt;/association&gt;
    &lt;/resultMap&gt;
&lt;!--使用多表查询，查出每个学生所在的班级--&gt;
&lt;select id="getStudentsByClassInfo" resultMap="getStudentsByClassInfo"&gt;
   select u.name,c.class_name from student u left join classinfo c on u.class_id=c.class_id
&lt;/select&gt;
</code></pre> 
<h4 id="4.1.3%C2%A0collection%20%E5%B5%8C%E5%A5%97%E7%BB%93%E6%9E%9C%E6%98%A0%E5%B0%84"><strong style="color:#4f4f4f;font-size:18px;font-weight:bold;">4.1.3 </strong>collection 嵌套结果映射</h4> 
<p>-  collection 嵌套结果映射 适用于 实体类是一对多的关系。</p> 
<p>- 一对多： 如: 一个班里有多个学生，对应实体类中也就是一个班级类里有多个学生实体对象（使用集合）。</p> 
<p>- <span style="color:#ad720d;"><strong>ClassInfo实体类中定义studentList集合</strong></span></p> 
<pre><code class="language-java">/**
 * 班级实体类
 */
public class ClassInfo {

    private Integer classId;
    private String calssName;
    //定义学生集合
    private List&lt;User&gt; userList;

    //...get set 方法已省略

}</code></pre> 
<p>- <span style="color:#ad720d;"><strong>resultMap 写法</strong></span></p> 
<pre><code class="language-XML">&lt;resultMap id="getStudentsByClassInfo" type="classInfo"&gt;
    &lt;id property="classId" column="class_Id"&gt;&lt;/id&gt;
    &lt;id property="calssName" column="class_Name"&gt;&lt;/id&gt;
    &lt;!--多表查询,嵌套查询一个班级中的多个学生--&gt;
    &lt;collection property="studentList" ofType="student"&gt;
         &lt;id property="id" column="id"&gt;&lt;/id&gt;
         &lt;id property="name" column="name"&gt;&lt;/id&gt;
    &lt;/collection&gt;
&lt;/resultMap&gt;
&lt;select id="getAllStudentsByClassInfo" resultMap="getStudentsByClassInfo"&gt;
  select u.name,c.class_name from classinfo c left join student u on c.class_id=u.class_id
        where c.class_id=#{calssId}
&lt;/select&gt;</code></pre> 
<p><strong>注意：</strong>association 和 collction 的写法差别 : collction 需要设置一个 <strong>ofType</strong> 集合对象的属性类型。</p> 
<h4 id="4.1.4%20resultType%20%E5%92%8CresultMap%E5%B0%8F%E7%BB%93">4.1.4 resultType 和resultMap小结</h4> 
<ol><li>resultType 适用于查询<strong>返回一个实体</strong>对象时并且实体类属性和数据库字段<strong>一致</strong>的情况下。</li><li>resultMap 适用于多表查询<strong>返回多个实体</strong>对象，或实体类属性和数据库字段<strong>不一致</strong>的情况下。</li><li>resultType 和resultMap不能同时出现 </li><li>以上两个只用于select查询</li></ol> 
<p><strong>两者的映射行为：</strong></p> 
<p><strong>Mybtais中是开启自动映射的，默认为 PARTIAL。</strong></p> 
<pre><code class="language-XML">&lt;!--默认开启自动映射: 只针对于 resultType 和没有嵌套的resultMap--&gt;
&lt;setting name="autoMappingBehavior" value="RARTIAL"/&gt;  </code></pre> 
<h4 id="4.1.5%20%E8%87%AA%E5%8A%A8%E6%98%A0%E5%B0%84%E9%85%8D%E7%BD%AE">4.1.5 自动映射配置</h4> 
<ol><li><strong>PARTIAL 默认，只自动映射没有嵌套的resultMap和resultType。</strong></li><li>NONE 所有自动映射都失效，只能手工映射。</li><li>FULL 嵌套的resultMap和resultType都开启自动映射。</li></ol> 
<h2 id="5.Mybtais%E6%A1%86%E6%9E%B6%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9%E6%93%8D%E4%BD%9C">5.Mybtais框架的增删改操作</h2> 
<pre><code class="language-XML">## insert 
  parameterType 参数类型: 实体类或map或其他(可使用别名)
  &lt;insert id="add" parameterType="user"&gt; &lt;/insert&gt;
## update
  &lt;update id="update" parameterType="user"&gt; &lt;/update&gt;
## delete
 &lt;delete id="delete" parameterType="user"&gt; &lt;/delete&gt;</code></pre> 
<p><strong>注意：</strong>增删改（insert、update、delete)这类操作通常返回影响行数，这三种元素均没有resultType/resultMap属性。</p> 
<h2 id="6.%E5%AE%9E%E7%8E%B0%E5%8A%A8%E6%80%81SQL">6.实现动态SQL</h2> 
<p>-  当处理SQL与语句时，当一个字段出现为null的情况，也会影响另一个条件的查询，可以使用动态处理SQL语句,让sql语句更加的灵活。</p> 
<h3 id="6.1%20where%20%2B%20if%20%E7%BB%84%E5%90%88%E6%A0%87%E7%AD%BE">6.1 where + if 组合标签</h3> 
<p>  - where 标签的主要作用是对sql 语句中的where 关键字进行简化处理，并可以智能处理其内部and,or 关键字，避免多余的语法错误。</p> 
<p>- 当where 里的条件语句都为false时，where 标签就不会进行一个拼接。</p> 
<pre><code class="language-XML">&lt;select id="getUsers" resultType="cn.bdqn.entity.User"&gt;
     select id,name,password from user 
      &lt;where&gt;
             &lt;if test="user.name!=null"&gt;
                 name like CONCAT(#{user.name},"%")
             &lt;/if&gt;
             &lt;if test="password!=null"&gt;
                 and password=#{user.password}
             &lt;/if&gt;                   
      &lt;/where&gt;
&lt;/select&gt;</code></pre> 
<p>     <span style="color:#ad720d;">如果没加where 标签，当其中一个条件字段为null时，sql 语法就会出现错误，当加上where 标签之后，即使有一个字段为null也会自动把多余关键字给去掉。</span></p> 
<h3 id="6.2%20choose%20%E6%A0%87%E7%AD%BE">6.2 choose 标签</h3> 
<p>- choose标签其实就是java中的switch, choose 标签里有when,otherwise这两个子标签,而choose就相当于switch,when==case+break,otherwise==default。</p> 
<p>-  <span style="color:#ad720d;">该标签的条件是唯一的，只要一个条件满足就会终止</span>。</p> 
<pre><code class="language-XML">&lt;select id="selectUsers" resultType="user"&gt;
        select id,name,password from t_supplier
        &lt;where&gt;
        &lt;choose&gt;
            &lt;when test="name!=null and name!=''"&gt;
                name=#{name}
            &lt;/when&gt;
            &lt;when test="password!=null and password!=''"&gt;
                supCode=#{supCode}
            &lt;/when&gt;
            &lt;otherwise&gt;
                id=#{id}
            &lt;/otherwise&gt;

        &lt;/choose&gt;
        &lt;where&gt; 
&lt;/select&gt;</code></pre> 
<h3 id="6.3%20foreach%20%E6%A0%87%E7%AD%BE">6.3 foreach 标签</h3> 
<p>- 该标签一般用于循环某个多条件的sql语句，提高效率。</p> 
<p>- <span style="color:#ad720d;">sql中可以遍历的类型参数: List,Map,array</span></p> 
<pre><code class="language-java">   /**
     * 根据角色ID集合查询用户列表新信息
     * @param roleList
     * @return
     */
    List&lt;SysUser&gt; getUserByRoleIdList(List&lt;Integer&gt; roleList);</code></pre> 
<pre><code class="language-XML">&lt;select id="getUserByRoleIdList" resultType="entity.SysUser"&gt;
        select * from t_sys_user where roleId in
       &lt;foreach collection="list" item="item" open="(" separator="," close=")"&gt;
           #{item}
       &lt;/foreach&gt;
&lt;/select&gt;</code></pre> 
<h4 id="6.3.1foreach%20%E5%85%83%E7%B4%A0">6.3.1foreach 元素</h4> 
<ol><li> <p>collection=“” 引号中一般为入参@Param引号中的值 或默认值</p> </li><li> <p>item=“” 相当于给集合中每个元素都起了一个别名</p> </li><li> <p>open=“” 循环开始需要放一个什么字符串</p> </li><li> <p>separator=“” 第一次循环结束后需要用什么分割符拼接第二次循环结果</p> </li><li> <p>close=“” 全部循环完之后需要加什么</p> </li></ol> 
<h3 id="6.4%20set%20%E6%A0%87%E7%AD%BE">6.4 set 标签</h3> 
<p>- set 标签出现在update标签的修改语句中,它会动态在sql语句中添加set关键字,并添加一些属性。</p> 
<pre><code class="language-XML">&lt;update id="update"&gt;
   update user
       &lt;set&gt;
            &lt;if test="name!=null and name!=''"&gt;
                 supName=#{supName},
            &lt;/if&gt;
            &lt;if test="password!=null and password!=''"&gt;
                supDesc=#{supDesc},
            &lt;/if&gt;
       &lt;/set&gt;
       &lt;where&gt;
         id=#{id}
       &lt;/where&gt;
&lt;/update&gt;</code></pre> 
<p><strong>注意</strong></p> 
<p><strong>- </strong>修改时需要根据业务判断使用set标签就可以还是需要set+if标签。</p> 
<p>- 如果使用set 那么当其中某一个字段为null时也会随之更改。</p> 
<h3 id="6.5%C2%A0trim%20%E6%A0%87%E7%AD%BE">6.5 trim 标签</h3> 
<p>-   使用trim 标签一样可以实现 where 和 set 标签的动态忽略前后缀,但trim标签比set 标签范围更广，它可以给各种标签添加和忽略前后缀。</p> 
<pre><code class="language-XML">&lt;update id="update"&gt;
    update user
  &lt;trim prefix="set" suffix="where id=#{id}" suffixOverrides="," &gt;
            &lt;if test="name!=null and name!=''"&gt;
                 name=#{name},
            &lt;/if&gt;
            &lt;if test="password!=null and password!=''"&gt;
                password=#{password},
            &lt;/if&gt;
   &lt;/trim&gt;
&lt;/update&gt;</code></pre> 
<h4 id="6.5.1%20trim%E6%A0%87%E7%AD%BE%E4%B8%AD%E7%9A%84%E5%85%83%E7%B4%A0">6.5.1 trim标签中的元素</h4> 
<p>1.prefix :如果trim标签中有一个条件成立的话 就会在最前面添加prefix里面配置的关键字。</p> 
<p>2.prefixOverrides :如果前面没有条件成立的话，会动态去掉前面的and关键字或者or关键字或其他，如果前面又条件成立的话，不会去掉所配置的关键字。</p> 
<p>3.suffixOverrides 如果后面没有条件成立的话会动态去掉每个条件后面跟着的该关键字</p> 
<p>4.suffix 如果trim标签中有一个条件成立的话，就会在所有成立的条件最后加上suffix配置的关键字，如果没有一个条件成立则不会加上所配置的关键字。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a0db520722bd50e24bfa115909b1ba07/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Linux基础第五章：添加磁盘及如何使用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/77d00f8a0ccc6607a8a38a1dd6a2b170/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【springboot进阶】springboot集成fastjson（一）配置消息解析器</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>