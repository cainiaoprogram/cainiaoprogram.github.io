<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【数据库运维】MYSQL备份恢复管理（下） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【数据库运维】MYSQL备份恢复管理（下）" />
<meta property="og:description" content="目录
五，mysql备份策略
3，策略三：mydumper备份数据库
案例一：备份数据库sc的信息
4，策略四：lvm快照从物理角度实现几乎热备的完全备份，配合二进制日志备份实现增量备份
案例：lvm备份
5，策略五：xtrabackup 备份数据库，实现完全热备份与增量热备份
案例一：完全备份
案例二：增量备份
五，mysql备份策略 3，策略三：mydumper备份数据库 （1）Mydumper安装
[root@node1 ~]# rz -E rz waiting to receive. [root@node1 ~]# ll [root@node1 ~]# yum localinstall mydumper-0.10.5-1.el7.x86_64.rpm （2）安装完后，查看产生了哪些文件
[root@node1 ~]# rpm -ql mydumper /usr/bin/mydumper 备份
/usr/bin/myloader 恢复
案例一：备份数据库sc的信息 （1）查看数据库sc的详细信息
mysql8.0.30 [it]&gt;select * from sc; 备份
（1）备份数据库sc的信息
-B 指定数据路
-S 套接字
-o 指定备份的路径
[root@node1 ~]# mydumper -u root -p 123456 -B it -S /tmp/mysql.sock -o /backup/db/it （2）上述命令备份的为目录，查询目录结构
[root@node1 ~]# tree /backup/db/it （3）查看文件metadata;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/abfcc57a9c7b6e16f9e002b060a1f1cc/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-06T20:45:00+08:00" />
<meta property="article:modified_time" content="2023-04-06T20:45:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【数据库运维】MYSQL备份恢复管理（下）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="margin-left:0in;"> 
 <div style="margin-left:0in;"> 
  <p style="margin-left:0;"></p> 
  <p id="main-toc"><strong>目录</strong></p> 
  <p id="-toc" style="margin-left:0px;"></p> 
  <p id="%E4%BA%94%EF%BC%8Cmysql%E5%A4%87%E4%BB%BD%E7%AD%96%E7%95%A5-toc" style="margin-left:0px;"><a href="#%E4%BA%94%EF%BC%8Cmysql%E5%A4%87%E4%BB%BD%E7%AD%96%E7%95%A5" rel="nofollow">五，mysql备份策略</a></p> 
  <p id="3%EF%BC%8C%E7%AD%96%E7%95%A5%E4%B8%89%EF%BC%9Amydumper%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE%E5%BA%93-toc" style="margin-left:40px;"><a href="#3%EF%BC%8C%E7%AD%96%E7%95%A5%E4%B8%89%EF%BC%9Amydumper%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE%E5%BA%93" rel="nofollow">3，策略三：mydumper备份数据库</a></p> 
  <p id="%E6%A1%88%E4%BE%8B%E4%B8%80%EF%BC%9A%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE%E5%BA%93sc%E7%9A%84%E4%BF%A1%E6%81%AF-toc" style="margin-left:80px;"><a href="#%E6%A1%88%E4%BE%8B%E4%B8%80%EF%BC%9A%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE%E5%BA%93sc%E7%9A%84%E4%BF%A1%E6%81%AF" rel="nofollow">案例一：备份数据库sc的信息</a></p> 
  <p id="4%EF%BC%8C%E7%AD%96%E7%95%A5%E5%9B%9B%EF%BC%9Alvm%E5%BF%AB%E7%85%A7%E4%BB%8E%E7%89%A9%E7%90%86%E8%A7%92%E5%BA%A6%E5%AE%9E%E7%8E%B0%E5%87%A0%E4%B9%8E%E7%83%AD%E5%A4%87%E7%9A%84%E5%AE%8C%E5%85%A8%E5%A4%87%E4%BB%BD%EF%BC%8C%E9%85%8D%E5%90%88%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%97%A5%E5%BF%97%E5%A4%87%E4%BB%BD%E5%AE%9E%E7%8E%B0%E5%A2%9E%E9%87%8F%E5%A4%87%E4%BB%BD-toc" style="margin-left:40px;"><a href="#4%EF%BC%8C%E7%AD%96%E7%95%A5%E5%9B%9B%EF%BC%9Alvm%E5%BF%AB%E7%85%A7%E4%BB%8E%E7%89%A9%E7%90%86%E8%A7%92%E5%BA%A6%E5%AE%9E%E7%8E%B0%E5%87%A0%E4%B9%8E%E7%83%AD%E5%A4%87%E7%9A%84%E5%AE%8C%E5%85%A8%E5%A4%87%E4%BB%BD%EF%BC%8C%E9%85%8D%E5%90%88%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%97%A5%E5%BF%97%E5%A4%87%E4%BB%BD%E5%AE%9E%E7%8E%B0%E5%A2%9E%E9%87%8F%E5%A4%87%E4%BB%BD" rel="nofollow">4，策略四：lvm快照从物理角度实现几乎热备的完全备份，配合二进制日志备份实现增量备份</a></p> 
  <p id="%E6%A1%88%E4%BE%8B%EF%BC%9Alvm%E5%A4%87%E4%BB%BD-toc" style="margin-left:80px;"><a href="#%E6%A1%88%E4%BE%8B%EF%BC%9Alvm%E5%A4%87%E4%BB%BD" rel="nofollow">案例：lvm备份</a></p> 
  <p id="5%EF%BC%8C%E7%AD%96%E7%95%A5%E4%BA%94%EF%BC%9Axtrabackup%20%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%8C%E5%AE%9E%E7%8E%B0%E5%AE%8C%E5%85%A8%E7%83%AD%E5%A4%87%E4%BB%BD%E4%B8%8E%E5%A2%9E%E9%87%8F%E7%83%AD%E5%A4%87%E4%BB%BD-toc" style="margin-left:40px;"><a href="#5%EF%BC%8C%E7%AD%96%E7%95%A5%E4%BA%94%EF%BC%9Axtrabackup%20%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%8C%E5%AE%9E%E7%8E%B0%E5%AE%8C%E5%85%A8%E7%83%AD%E5%A4%87%E4%BB%BD%E4%B8%8E%E5%A2%9E%E9%87%8F%E7%83%AD%E5%A4%87%E4%BB%BD" rel="nofollow">5，策略五：xtrabackup 备份数据库，实现完全热备份与增量热备份</a></p> 
  <p id="%E6%A1%88%E4%BE%8B%E4%B8%80%EF%BC%9A%E5%AE%8C%E5%85%A8%E5%A4%87%E4%BB%BD-toc" style="margin-left:80px;"><a href="#%E6%A1%88%E4%BE%8B%E4%B8%80%EF%BC%9A%E5%AE%8C%E5%85%A8%E5%A4%87%E4%BB%BD" rel="nofollow">案例一：完全备份</a></p> 
  <p id="%E6%A1%88%E4%BE%8B%E4%BA%8C%EF%BC%9A%E5%A2%9E%E9%87%8F%E5%A4%87%E4%BB%BD-toc" style="margin-left:80px;"><a href="#%E6%A1%88%E4%BE%8B%E4%BA%8C%EF%BC%9A%E5%A2%9E%E9%87%8F%E5%A4%87%E4%BB%BD" rel="nofollow">案例二：增量备份</a></p> 
  <hr id="hr-toc"> 
  <p></p> 
  <h2 id="%E4%BA%94%EF%BC%8Cmysql%E5%A4%87%E4%BB%BD%E7%AD%96%E7%95%A5" style="margin-left:0;"><span style="color:#0d0016;">五，mysql备份策略</span></h2> 
  <h3 id="3%EF%BC%8C%E7%AD%96%E7%95%A5%E4%B8%89%EF%BC%9Amydumper%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE%E5%BA%93" style="margin-left:0;"><span style="color:#0d0016;">3，策略三：mydumper备份数据库 </span></h3> 
  <h4 style="margin-left:0;"></h4> 
  <p style="margin-left:0px;">（1）Mydumper安装</p> 
  <pre><code class="hljs">[root@node1 ~]# rz -E
rz waiting to receive.
[root@node1 ~]# ll</code></pre> 
  <p style="margin-left:0;"><img alt="" height="323" src="https://images2.imgbox.com/9b/d9/4pnu8w4R_o.png" width="1200"></p> 
  <p style="margin-left:0;"></p> 
  <pre><code class="hljs">[root@node1 ~]# yum localinstall mydumper-0.10.5-1.el7.x86_64.rpm</code></pre> 
  <p style="margin-left:0;"><img alt="" height="417" src="https://images2.imgbox.com/c2/33/vIK1MIzB_o.png" width="1200"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">（2）安装完后，查看产生了哪些文件</p> 
  <pre><code class="hljs">[root@node1 ~]# rpm -ql mydumper</code></pre> 
  <blockquote> 
   <p style="margin-left:0;">/usr/bin/mydumper              备份</p> 
   <p style="margin-left:0;">/usr/bin/myloader                 恢复</p> 
  </blockquote> 
  <p style="margin-left:0;"><img alt="" height="366" src="https://images2.imgbox.com/2c/c3/cIA3WiiX_o.png" width="1200"></p> 
  <p style="margin-left:0;"></p> 
  <h4 style="margin-left:0px;"></h4> 
  <h4 id="%E6%A1%88%E4%BE%8B%E4%B8%80%EF%BC%9A%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE%E5%BA%93sc%E7%9A%84%E4%BF%A1%E6%81%AF" style="margin-left:0px;">案例一：备份数据库sc的信息</h4> 
  <p style="margin-left:0;">（1）查看数据库sc的详细信息</p> 
  <pre><code class="hljs">mysql8.0.30 [it]&gt;select * from sc;</code></pre> 
  <p style="margin-left:0;"><img alt="" height="302" src="https://images2.imgbox.com/d4/ef/QToQB7m1_o.png" width="842"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"><strong>备份</strong></p> 
  <p style="margin-left:0;">（1）备份数据库sc的信息</p> 
  <blockquote> 
   <p style="margin-left:0;">-B   指定数据路</p> 
   <p style="margin-left:0;">-S    套接字</p> 
   <p style="margin-left:0;">-o    指定备份的路径</p> 
  </blockquote> 
  <pre><code class="hljs">[root@node1 ~]# mydumper -u root -p 123456 -B it -S /tmp/mysql.sock -o /backup/db/it</code></pre> 
  <p style="margin-left:0;"><img alt="" height="88" src="https://images2.imgbox.com/d4/4a/uHpm8v2c_o.png" width="1200"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">（2）上述命令备份的为目录，查询目录结构</p> 
  <pre><code class="hljs">[root@node1 ~]# tree /backup/db/it</code></pre> 
  <p style="margin-left:0;"><img alt="" height="363" src="https://images2.imgbox.com/63/70/nFnHc28k_o.png" width="883"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">（3）查看文件metadata;</p> 
  <blockquote> 
   <p style="margin-left:0;">metadata:元数据 记录备份开始和结束时间，以及binlog日志文件位置</p> 
  </blockquote> 
  <pre><code class="hljs">[root@node1 ~]# more /backup/db/it/metadata</code></pre> 
  <p style="margin-left:0;"><img alt="" height="371" src="https://images2.imgbox.com/f8/15/A6sdC0g3_o.png" width="1127"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"><strong>破坏数据库</strong><strong>it</strong></p> 
  <pre><code class="hljs">mysql8.0.30 [it]&gt;drop database it;
mysql8.0.30 [(none)]&gt;show databases;</code></pre> 
  <p style="margin-left:0;"><img alt="" height="619" src="https://images2.imgbox.com/23/66/MWokuCCG_o.png" width="1011"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"><strong>恢复</strong></p> 
  <p style="margin-left:0;">（1）恢复数据库it</p> 
  <pre><code class="hljs">[root@node1 ~]# myloader -u root -p 123456 -S /tmp/mysql.sock -d /backup/db/it -B it</code></pre> 
  <p style="margin-left:0;"><img alt="" height="87" src="https://images2.imgbox.com/b8/06/mk5J04EN_o.png" width="1200"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">（2）此时查看数据库it，发现已经恢复</p> 
  <pre><code class="hljs">mysql8.0.30 [(none)]&gt;show databases;</code></pre> 
  <p style="margin-left:0;"><img alt="" height="553" src="https://images2.imgbox.com/06/42/zJPI0AL2_o.png" width="947"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">（3）查看it数据库中的信息，也已经被恢复</p> 
  <pre><code class="hljs">mysql8.0.30 [it]&gt;select * from it;</code></pre> 
  <p style="margin-left:0;"><img alt="" height="357" src="https://images2.imgbox.com/28/df/FMbj2bAW_o.png" width="909"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"></p> 
  <h3 id="4%EF%BC%8C%E7%AD%96%E7%95%A5%E5%9B%9B%EF%BC%9Alvm%E5%BF%AB%E7%85%A7%E4%BB%8E%E7%89%A9%E7%90%86%E8%A7%92%E5%BA%A6%E5%AE%9E%E7%8E%B0%E5%87%A0%E4%B9%8E%E7%83%AD%E5%A4%87%E7%9A%84%E5%AE%8C%E5%85%A8%E5%A4%87%E4%BB%BD%EF%BC%8C%E9%85%8D%E5%90%88%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%97%A5%E5%BF%97%E5%A4%87%E4%BB%BD%E5%AE%9E%E7%8E%B0%E5%A2%9E%E9%87%8F%E5%A4%87%E4%BB%BD" style="margin-left:0px;"><strong>4，策略四：lvm快照从物理角度实现几乎热备的完全备份，配合二进制日志备份实现增量备份</strong></h3> 
  <p style="margin-left:0;">速度快适<strong> </strong>合比较烦忙的数据库</p> 
  <blockquote> 
   <p style="margin-left:0;"><strong>前提：</strong></p> 
   <p style="margin-left:0;">数据文件要在逻辑卷上；</p> 
   <p style="margin-left:0;">此逻辑卷所在卷组必须有足够空间使用快照卷；</p> 
   <p style="margin-left:0;">数据文件和事务日志要在同一个逻辑卷上；</p> 
   <p style="margin-left:0;">前提：MySQL数据lv和将要创建的快照要在同一vg，vg要有足够的空间存储</p> 
  </blockquote> 
  <blockquote> 
   <p style="margin-left:0;"><strong>优点</strong></p> 
   <p style="margin-left:0;">几乎是热备（创建快照前把表上锁，创建完毕后立即释放）</p> 
   <p style="margin-left:0;">支持所有的存储引擎</p> 
   <p style="margin-left:0;">备份速度快</p> 
   <p style="margin-left:0;">无需使用昂贵的商业软件（操作系统级别的）</p> 
  </blockquote> 
  <blockquote> 
   <p style="margin-left:0;"><strong>缺点</strong></p> 
   <p style="margin-left:0;">可能需要部门协调（使用操作系统级别的命令，DBA一般没有权限）</p> 
   <p style="margin-left:0;">无法预计服务停止时间</p> 
   <p style="margin-left:0;">数据如果分布在多个卷上比较麻烦</p> 
  </blockquote> 
  <blockquote> 
   <p style="margin-left:0;"><strong>操作流程</strong></p> 
   <p style="margin-left:0;">1）锁表 flush table with read lock</p> 
   <p style="margin-left:0;">2）查看position号并记录，便于后期恢复 show master status</p> 
   <p style="margin-left:0;">3）创建snapshot快照 create snapshop</p> 
   <p style="margin-left:0;">4）解表 unlock tables</p> 
   <p style="margin-left:0;">5）挂载snapshot</p> 
   <p style="margin-left:0;">6）拷贝snapshot数据，进行备份。备份整个数据库之前，要关闭mysql服务（保护ibdata1文件）</p> 
   <p style="margin-left:0;">7）卸载</p> 
   <p style="margin-left:0;">8）移除快照</p> 
  </blockquote> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"></p> 
  <h4 id="%E6%A1%88%E4%BE%8B%EF%BC%9Alvm%E5%A4%87%E4%BB%BD" style="margin-left:0px;">案例：lvm备份</h4> 
  <p style="margin-left:0;">准备工作如下：</p> 
  <p style="margin-left:0;">（1）添加一块新的硬盘，大小为12G</p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"><img alt="" height="847" src="https://images2.imgbox.com/8c/7a/BUudf1aS_o.png" width="963"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">（2）查看是否识别</p> 
  <pre><code class="hljs">[root@node1 ~]# lsdlk</code></pre> 
  <p style="margin-left:0;"><img alt="" height="477" src="https://images2.imgbox.com/a5/d9/g2xsDJE8_o.png" width="1052"></p> 
  <p style="margin-left:0;">把这5G做成逻辑卷，并把数据迁移</p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"><strong>一、数据迁移到逻辑卷上</strong></p> 
  <p style="margin-left:0;">环境：数据文件不在逻辑卷上，那么需要将数据文件迁移到逻辑卷上</p> 
  <p style="margin-left:0;"><strong>1、创建一个逻辑卷</strong></p> 
  <p style="margin-left:0;">（1）创建卷组名为msyql的逻辑卷</p> 
  <pre><code class="hljs">[root@node1 ~]# vgcreate mysql /dev/sdc</code></pre> 
  <p style="margin-left:0;"><img alt="" height="171" src="https://images2.imgbox.com/dd/24/bq6goGqt_o.png" width="1071"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">（2）从mysql中创建6G的逻辑卷</p> 
  <pre><code class="hljs">[root@node1 ~]# lvcreate -n mysql_lv -L 6G mysql</code></pre> 
  <p style="margin-left:0;"><img alt="" height="145" src="https://images2.imgbox.com/d7/49/elan20Gy_o.png" width="1032"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">（3）格式化为ext4格式</p> 
  <pre><code class="hljs">[root@node1 ~]# mkfs.ext4 /dev/mysql/mysql_lv</code></pre> 
  <p style="margin-left:0;"><img alt="" height="906" src="https://images2.imgbox.com/ec/03/rU08Z5gw_o.png" width="1200"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"><strong>2、将当前的mysql数据库迁移到逻辑卷上</strong></p> 
  <p style="margin-left:0;">（1）停止mysql服务</p> 
  <pre><code class="hljs">[root@node1 ~]# systemctl stop mysqld</code></pre> 
  <p style="margin-left:0;"><img alt="" height="92" src="https://images2.imgbox.com/4f/c2/KLcHBujW_o.png" width="1020"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">（2）备份/usr/local/mysql所有的数据文件到指定的地方 (需要短暂的等待)</p> 
  <pre><code class="hljs">[root@node1 mysql]# tar czf /backup/db/all_db.tar.gz *</code></pre> 
  <p style="margin-left:0;"><img alt="" height="93" src="https://images2.imgbox.com/d9/05/GYKteoGr_o.png" width="1065"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">（3）挂载逻辑卷到当前mysql的数据目录里</p> 
  <pre><code class="hljs">[root@node1 mysql]# mount /dev/mysql/mysql_lv /usr/local/mysql</code></pre> 
  <p style="margin-left:0;"><img alt="" height="77" src="https://images2.imgbox.com/d7/70/Bv7bsU6M_o.png" width="1200"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">（4）挂载后，此目录下为空，所以需要提前备份</p> 
  <pre><code class="hljs">[root@node1 data]# ls /usr/local/mysql</code></pre> 
  <p style="margin-left:0;"><img alt="" height="120" src="https://images2.imgbox.com/54/ca/6kG7sjiL_o.png" width="900"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">（5）将刚刚备份的数据解压到数据目录里</p> 
  <pre><code class="hljs">[root@node1 ~]# tar xf /backup/db/all_db.tar.gz -C /usr/local/mysql/</code></pre> 
  <p style="margin-left:0;"><img alt="" height="90" src="https://images2.imgbox.com/18/7b/UHWJ88SN_o.png" width="1200"></p> 
  <p style="margin-left:0;">查看解压后的数据</p> 
  <pre><code class="hljs">[root@node1 ~]# ll /usr/local/mysql/</code></pre> 
  <p style="margin-left:0;"><img alt="" height="551" src="https://images2.imgbox.com/f7/64/kgEEYfdI_o.png" width="1169"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">（6）启动数据库</p> 
  <pre><code class="hljs">[root@node1 ~]# systemctl start mysqld</code></pre> 
  <p style="margin-left:0;"><img alt="" height="95" src="https://images2.imgbox.com/b1/5f/jCa0GBaw_o.png" width="879"></p> 
  <p style="margin-left:0;">此处如果启动失败，原因/data/DB/数据目录的权限变成了root，需要更改权限重新启动</p> 
  <p style="margin-left:0;">[root@Admin ~]# chown mysql. -R /data/DB/ &amp;&amp; service mysqld start</p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"><strong>二、快照备份数据库</strong></p> 
  <p style="margin-left:0;">1、给数据库加读锁 ，保证了数据的一致性</p> 
  <p style="margin-left:0;">2、给mysql的数据库所在的逻辑卷创建快照</p> 
  <p style="margin-left:0;">3、解锁数据库</p> 
  <p style="margin-left:0;">以上1-3需要在一个会话完成</p> 
  <pre><code class="hljs">[root@node1 ~]# echo "flush tables with read lock; system  lvcreate -n mysql_s -L 2G -s /dev/mysql/mysql_lv;unlock tables;" |mysql -uroot -p123456</code></pre> 
  <p style="margin-left:0;"><img alt="" height="252" src="https://images2.imgbox.com/4b/6b/XjcFYzxD_o.png" width="1200"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"></p> 
  <pre><code class="hljs">[root@node1 ~]# lvs</code></pre> 
  <p style="margin-left:0;"><img alt="" height="320" src="https://images2.imgbox.com/d1/09/Z3zkHqDM_o.png" width="1200"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">4、将快照挂载到临时目录里</p> 
  <p style="margin-left:0;">（1）创建临时目录</p> 
  <pre><code class="hljs">[root@node1 ~]# mkdir /mnt/mysql</code></pre> 
  <p style="margin-left:0;"><img alt="" height="95" src="https://images2.imgbox.com/4d/29/RvC7wuPa_o.png" width="840"></p> 
  <p style="margin-left:0;">（2）将快照挂载到临时目录里</p> 
  <pre><code class="hljs">[root@node1 ~]# mount -o nouuid /dev/mysql/mysql_lv /mnt/mysql</code></pre> 
  <p style="margin-left:0;"><img alt="" height="94" src="https://images2.imgbox.com/a1/80/B5AbKp24_o.png" width="1200"></p> 
  <p style="margin-left:0;">（3）查看挂载目录/mnt/mysql</p> 
  <pre><code class="hljs">[root@node1 ~]# ll /mnt/mysql</code></pre> 
  <p style="margin-left:0;"><img alt="" height="556" src="https://images2.imgbox.com/68/ca/LQ1IQKwA_o.png" width="1200"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">5、备份数据</p> 
  <p style="margin-left:0;">（1）安装rsync</p> 
  <pre><code class="hljs">[root@node1 ~]# yum install rsync -y</code></pre> 
  <p style="margin-left:0;"><img alt="" height="241" src="https://images2.imgbox.com/fb/8e/WjKCMrde_o.png" width="1200"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">（2）创建/dbbackup目录</p> 
  <pre><code class="hljs">[root@node1 ~]# mkdir /dbbackup</code></pre> 
  <p style="margin-left:0;"><img alt="" height="84" src="https://images2.imgbox.com/61/19/slvD4Qu4_o.png" width="813"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"><strong>（3）验证备份是否可用</strong></p> 
  <pre><code class="hljs">[root@node1 ~]# rsync -av /mnt/mysql/ /dbbackup/</code></pre> 
  <p style="margin-left:0;"><img alt="" height="498" src="https://images2.imgbox.com/b9/9d/tju6zBc1_o.png" width="1113"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">修改配置文件</p> 
  <blockquote> 
   <p style="margin-left:0;">[mysqld]</p> 
   <p style="margin-left:0;">#datadir=/usr/local/mysql/data     </p> 
   <p style="margin-left:0;">#socket=/tmp/mysql.sock</p> 
   <p style="margin-left:0;">basedir=/dbbackup</p> 
   <p style="margin-left:0;">datadir=/dbbackup/data</p> 
  </blockquote> 
  <p style="margin-left:0;"><img alt="" height="225" src="https://images2.imgbox.com/7d/3b/PSCiT5Z0_o.png" width="830"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">重启服务</p> 
  <pre><code class="hljs">[root@node1 ~]# systemctl restart mysqld</code></pre> 
  <p style="margin-left:0;"><img alt="" height="88" src="https://images2.imgbox.com/0d/5e/rCPUElHT_o.png" width="996"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">登录数据库查看是否能够看到数据库的信息</p> 
  <pre><code class="hljs">mysql [(none)]&gt;select * from it.sc;</code></pre> 
  <p style="margin-left:0;"><img alt="" height="371" src="https://images2.imgbox.com/96/33/SxmPs7dU_o.png" width="1059"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">将配置文件改回去</p> 
  <blockquote> 
   <p style="margin-left:0;">[mysqld]</p> 
   <p style="margin-left:0;">datadir=/usr/local/mysql/data     </p> 
   <p style="margin-left:0;">socket=/tmp/mysql.sock</p> 
   <p style="margin-left:0;">#basedir=/dbbackup</p> 
   <p style="margin-left:0;">#datadir=/dbbackup/data</p> 
  </blockquote> 
  <p style="margin-left:0;"><img alt="" height="223" src="https://images2.imgbox.com/3b/c4/EpVFXcaa_o.png" width="910"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">并重启服务</p> 
  <pre><code class="hljs">[root@node1 data]# systemctl restart mysqld</code></pre> 
  <p style="margin-left:0;"><img alt="" height="87" src="https://images2.imgbox.com/7b/86/Zsj3Ov7y_o.png" width="1102"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">6、卸载快照并删除</p> 
  <pre><code class="hljs">[root@node1 data]# umount /mnt/mysql
[root@node1 data]# ll /mnt/mysql</code></pre> 
  <p style="margin-left:0;"><img alt="" height="194" src="https://images2.imgbox.com/47/25/PCDVC6bP_o.png" width="965"></p> 
  <pre><code class="hljs">[root@node1 data]# lvremove /dev/mysql/mysql_lv</code></pre> 
  <p style="margin-left:0;"><img alt="" height="254" src="https://images2.imgbox.com/f4/1f/Mymr038i_o.png" width="1200"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"></p> 
  <h3 id="5%EF%BC%8C%E7%AD%96%E7%95%A5%E4%BA%94%EF%BC%9Axtrabackup%20%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%8C%E5%AE%9E%E7%8E%B0%E5%AE%8C%E5%85%A8%E7%83%AD%E5%A4%87%E4%BB%BD%E4%B8%8E%E5%A2%9E%E9%87%8F%E7%83%AD%E5%A4%87%E4%BB%BD" style="margin-left:0px;"><strong>5，策略五：xtrabackup 备份数据库，实现完全热备份与增量热备份</strong></h3> 
  <p style="margin-left:0;">（MyISAM是温备份，InnoDB是热备 份）Xtrabackup是一个对InnoDB做数据备份的工具，支持在线热备份（备份时不影响数据读写），是商业备份工具InnoDB Hotbackup的一个很好的替代品。</p> 
  <p style="margin-left:0;">Xtrabackup有两个主要的工具：xtrabackup、innobackupex</p> 
  <p style="margin-left:0;">xtrabackup 只能备份InnoDB和XtraDB两种数据表，而不能备份MyISAM数据表。</p> 
  <p style="margin-left:0;">innobackupex 是参考了InnoDB Hotbackup的innoback脚本修改而来的.innobackupex是一个perl脚</p> 
  <p style="margin-left:0;">本封装，封装了xtrabackup。主要是为了方便的同时备份InnoDB和MyISAM引擎的表，但在处理myisam时需要加一个读锁。并且加入了一些使用的选项。如slave-info可以记录备份恢复后作为slave需要的一些信息，根据这些信息，可以很方便的利用备份来重做slave。</p> 
  <p style="margin-left:0;">支持完全备份和增量备份</p> 
  <p style="margin-left:0;">备份过程快速、可靠；</p> 
  <p style="margin-left:0;">备份过程不会打断正在执行的事务；</p> 
  <p style="margin-left:0;">能够基于压缩等功能节约磁盘空间和流量；</p> 
  <p style="margin-left:0;">自动实现备份检验；</p> 
  <p style="margin-left:0;">还原速度快；</p> 
  <p style="margin-left:0;">使用innobakupex备份时，其会调用xtrabackup备份所有的InnoDB表，复制所有关于表结构定义的相关文件(.frm)、以及MyISAM、MERGE、CSV和ARCHIVE表的相关文件，同时还会备份触发器和数据库配置信息相关的文件。这些文件会被保存至一个以时间命令的目录中。</p> 
  <p style="margin-left:0;">(1)xtrabackup_checkpoints —— 备份类型（如完全或增量）、备份状态（如是否已经为prepared状态）和LSN(日志序列号)范围信息；每个InnoDB页(通常为16k大小)都会包含一个日志序列号，即LSN。LSN是整个数据库系统的系统版本号，每个页面相关的LSN能够表明此页面最近是如何发生改变的。</p> 
  <p style="margin-left:0;">(2)xtrabackup_binlog_info —— mysql服务器当前正在使用的二进制日志文件及至备份这一刻为止二进制日志事件的位置。</p> 
  <p style="margin-left:0;">(3)xtrabackup_binlog_pos_innodb —— 二进制日志文件及用于InnoDB或XtraDB表的二进制日志文件的当前position。</p> 
  <p style="margin-left:0;">(4)xtrabackup_binary —— 备份中用到的xtrabackup的可执行文件；</p> 
  <p style="margin-left:0;">(5)backup-my.cnf —— 备份命令用到的配置选项信息；</p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">下载percona-xtrabackup-24-2.4.26-1.el7.x86_64.rpm安装包</p> 
  <p style="margin-left:0;"><img alt="" height="282" src="https://images2.imgbox.com/d8/60/5t7sARBi_o.png" width="1200"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">安装percona-xtrabackup-24-2.4.26-1.el7.x86_64.rpm</p> 
  <pre><code class="hljs">[root@node1 ~]# yum localinstall percona-xtrabackup-24-2.4.26-1.el7.x86_64.rpm</code></pre> 
  <p style="margin-left:0;"><img alt="" height="363" src="https://images2.imgbox.com/3f/84/nILoaXK6_o.png" width="1200"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"></p> 
  <h4 id="%E6%A1%88%E4%BE%8B%E4%B8%80%EF%BC%9A%E5%AE%8C%E5%85%A8%E5%A4%87%E4%BB%BD" style="margin-left:0px;"><strong>案例一：完全备份 </strong></h4> 
  <p style="margin-left:0;">（1）查看当前所有的数据库信息</p> 
  <pre><code class="hljs">mysql [(none)]&gt;show databases;</code></pre> 
  <p style="margin-left:0;"><img alt="" height="704" src="https://images2.imgbox.com/ea/67/YzQLGYgV_o.png" width="1165"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">（2）创建目录/server/bakcup</p> 
  <pre><code class="hljs">[root@node1 ~]# mkdir -p /server/backup</code></pre> 
  <p style="margin-left:0;"><img alt="" height="96" src="https://images2.imgbox.com/bf/31/nJPLz3wL_o.png" width="977"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">（3）将所有的数据库信息备份到目录/server/backup/下</p> 
  <pre><code class="hljs">[root@node1 ~]# innobackupex --user=root --password=123456 --socket=/tmp/mysql.sock /server/backup/</code></pre> 
  <p style="margin-left:0;"><img alt="" height="369" src="https://images2.imgbox.com/46/07/QBAjowKB_o.png" width="1200"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">（4）查看备份的结果，备份到了/server/backup/2023-04-06_11-02-29文件中</p> 
  <pre><code class="hljs">[root@node1 ~]# ll /server/backup</code></pre> 
  <p style="margin-left:0;"><img alt="" height="162" src="https://images2.imgbox.com/62/87/Wj2ZwNDT_o.png" width="1200"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">（5）查看文件/server/backup/2023-04-06_11-02-29，能看l到备份的数据库，gtid，日志文件等</p> 
  <pre><code class="hljs">[root@node1 ~]# ll /server/backup/2023-04-06_11-02-29</code></pre> 
  <p style="margin-left:0;"><img alt="" height="743" src="https://images2.imgbox.com/13/9e/eRmWZJdY_o.png" width="1200"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">（6）完全备份中恢复数据</p> 
  <blockquote> 
   <p style="margin-left:0;">--apply-log  应用日志</p> 
  </blockquote> 
  <pre><code class="hljs">[root@node1 ~]# innobackupex --apply-log /server/backup/2023-04-06_11-02-29</code></pre> 
  <p style="margin-left:0;"><img alt="" height="306" src="https://images2.imgbox.com/79/b7/JsU9qSYC_o.png" width="1200"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">（7）停止数据库</p> 
  <pre><code class="hljs">[root@node1 ~]# systemctl stop mysqld</code></pre> 
  <p style="margin-left:0;"><img alt="" height="93" src="https://images2.imgbox.com/c6/f6/OS4aaMKg_o.png" width="1009"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">（8）清空目录/usr/local/mysql/data/*</p> 
  <pre><code class="hljs">[root@node1 ~]# rm -rf /usr/local/mysql/data/*</code></pre> 
  <p style="margin-left:0;"><img alt="" height="239" src="https://images2.imgbox.com/df/c2/Xx83sa3d_o.png" width="1198"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">（9）还原数据库到默认目录</p> 
  <blockquote> 
   <p style="margin-left:0;">--copy-back  还原</p> 
  </blockquote> 
  <pre><code class="hljs">[root@node1 ~]# innobackupex --copy-back /server/backup/2023-04-06_11-02-29</code></pre> 
  <p style="margin-left:0;"><img alt="" height="315" src="https://images2.imgbox.com/b2/d4/JVDqH1Cb_o.png" width="1200"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">（10）恢复后的权限变为root，此时无法启动mysqld服务，需要修改权限为mysqld</p> 
  <pre><code class="hljs">[root@node1 ~]# ll /usr/local/mysql/data</code></pre> 
  <p style="margin-left:0;"><img alt="" height="786" src="https://images2.imgbox.com/c6/c1/FQa21mPe_o.png" width="1200"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">（11）修改数据文件属主属组</p> 
  <pre><code class="hljs">[root@node1 ~]# chown -R mysql.mysql /usr/local/mysql/data/</code></pre> 
  <p style="margin-left:0;"><img alt="" height="93" src="https://images2.imgbox.com/7d/15/QsURAH2p_o.png" width="1200"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">（12）启动数据库</p> 
  <pre><code class="hljs">[root@node1 ~]# systemctl restart mysqld</code></pre> 
  <p style="margin-left:0;"><img alt="" height="92" src="https://images2.imgbox.com/bb/64/EHAeDHEQ_o.png" width="948"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">（13）此时查看数据库的所有信息如下所示：</p> 
  <pre><code class="hljs">[root@node1 ~]# mysql -uroot -p123456 -e 'show databases'</code></pre> 
  <p style="margin-left:0;"><img alt="" height="674" src="https://images2.imgbox.com/67/c6/uo8CZsXq_o.png" width="1200"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">（14）去掉时间戳，用自己给定的名称备份到目录/server/backup/下</p> 
  <blockquote> 
   <p style="margin-left:0;">--no-timestamp</p> 
  </blockquote> 
  <pre><code class="hljs">[root@node1 backup]# innobackupex --user=root --password=123456 --socket=/tmp/mysql.sock  --no-timestamp /server/backup/full_`date +%F`</code></pre> 
  <p style="margin-left:0;"><img alt="" height="371" src="https://images2.imgbox.com/85/e6/9wRjSDFI_o.png" width="1200"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">（15）在目录/server/backup下面查看备份好的文件</p> 
  <pre><code class="hljs">[root@node1 backup]# ll</code></pre> 
  <p style="margin-left:0;"><img alt="" height="202" src="https://images2.imgbox.com/4d/41/JfBNeOz4_o.png" width="1200"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"></p> 
  <h4 id="%E6%A1%88%E4%BE%8B%E4%BA%8C%EF%BC%9A%E5%A2%9E%E9%87%8F%E5%A4%87%E4%BB%BD" style="margin-left:0px;"><strong>案例二：增量备份 </strong></h4> 
  <p style="margin-left:0;">必须要有未压缩的全量备份文件目录，先全量再增量，此次使用前面全量备份</p> 
  <p style="margin-left:0;">插入数据，增量备份</p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">（1）此时的数据库it中的表sc的信息如下图所示：</p> 
  <pre><code class="hljs">mysql [it]&gt;select * from sc;</code></pre> 
  <p style="margin-left:0;"><img alt="" height="359" src="https://images2.imgbox.com/1d/a6/VDwfylRV_o.png" width="793"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">（2）给数据库it 中的表增加数据</p> 
  <pre><code class="hljs">mysql [it]&gt;insert into sc values(2),(3),(4);
mysql [it]&gt;select * from sc;</code></pre> 
  <p style="margin-left:0;"><img alt="" height="631" src="https://images2.imgbox.com/01/9d/qUrxstKg_o.png" width="1065"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"><strong>（3）备份第一次的增量</strong></p> 
  <blockquote> 
   <p style="margin-left:0;">指定备份类型的增量</p> 
   <p style="margin-left:0;">--incremental</p> 
   <p style="margin-left:0;">--incremental-basedir 指定完全备份的路径</p> 
  </blockquote> 
  <pre><code class="hljs">[root@node1 backup]# innobackupex --incremental --user=root --password=123456 --socket=/tmp/mysql.sock /server/backup/incr_1 --no-timestamp --incremental-basedir=/server/backup/full_2023-04-06/</code></pre> 
  <p style="margin-left:0;"><img alt="" height="229" src="https://images2.imgbox.com/94/d1/FbuYfO0F_o.png" width="1200"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">（4）此时在目录/server/back下面查看创建的增量备份文件incr_1</p> 
  <pre><code class="hljs">[root@node1 backup]# ll</code></pre> 
  <p style="margin-left:0;"><img alt="" height="243" src="https://images2.imgbox.com/1a/e4/5SeuwrAC_o.png" width="1200"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">（5）再次插入数据，第二次增量备份</p> 
  <pre><code class="hljs">mysql [it]&gt;insert into sc values(5),(6),(7);
mysql [it]&gt;select * from sc;</code></pre> 
  <p style="margin-left:0;"><img alt="" height="753" src="https://images2.imgbox.com/18/21/QXjyjOmF_o.png" width="1097"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"><strong>（6）在目录</strong><strong>/server/backup</strong><strong>下面备份第二次增量文件</strong><strong>/incr_2</strong></p> 
  <pre><code class="hljs">[root@node1 backup]# innobackupex --incremental --user=root --password=123456 --socket=/tmp/mysql.sock /server/backup/incr_2 --no-timestamp --incremental-basedir=/server/backup/incr_1/</code></pre> 
  <p style="margin-left:0;"><img alt="" height="382" src="https://images2.imgbox.com/94/53/mvNP20KO_o.png" width="1200"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">（7）查看第二次的增量文件</p> 
  <pre><code class="hljs">[root@node1 backup]# ll</code></pre> 
  <p style="margin-left:0;"><img alt="" height="280" src="https://images2.imgbox.com/97/2e/5poiwEZE_o.png" width="1200"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"><strong>恢复数据 </strong></p> 
  <p style="margin-left:0;">（1）首先恢复全备</p> 
  <pre><code class="hljs">[root@node1 backup]# innobackupex --apply-log --redo-only /server/backup/full_2023-04-06/</code></pre> 
  <p style="margin-left:0;"><img alt="" height="440" src="https://images2.imgbox.com/89/db/CfSWws0Q_o.png" width="1200"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">（2）恢复第一次增量备份</p> 
  <pre><code class="hljs">[root@node1 backup]# innobackupex --apply-log --redo-only /server/backup/full_2023-04-06 --incremental-dir=/server/backup/incr_1</code></pre> 
  <p style="margin-left:0;"><img alt="" height="350" src="https://images2.imgbox.com/58/b4/Gb3CP2Ry_o.png" width="1200"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">（3）恢复第二次增量备份</p> 
  <pre><code class="hljs">[root@node1 backup]# innobackupex --apply-log --redo-only /server/backup/full_2023-04-06 --incremental-dir=/server/backup/incr_2</code></pre> 
  <p style="margin-left:0;"><img alt="" height="348" src="https://images2.imgbox.com/e5/c6/U03yhrD9_o.png" width="1200"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">（4）停止数据库</p> 
  <pre><code class="hljs">[root@node1 backup]# systemctl stop mysqld</code></pre> 
  <p style="margin-left:0;"><img alt="" height="90" src="https://images2.imgbox.com/d0/82/GvKy4JjK_o.png" width="1002"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">（5）模拟数据丢失</p> 
  <pre><code class="hljs">[root@node1 backup]# rm -rf /usr/local/mysql/data/*</code></pre> 
  <p style="margin-left:0;"><img alt="" height="89" src="https://images2.imgbox.com/1b/24/Ep1HQJWA_o.png" width="1175"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">（6）还原数据库到默认目录</p> 
  <pre><code class="hljs">[root@node1 backup]# innobackupex --copy-back /server/backup/full_2023-04-06</code></pre> 
  <p style="margin-left:0;"><img alt="" height="330" src="https://images2.imgbox.com/0d/32/VmKvxmXo_o.png" width="1200"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">（7）修改数据文件属主属组</p> 
  <pre><code class="hljs">[root@node1 backup]# chown -R mysql.mysql /usr/local/mysql/data/*</code></pre> 
  <p style="margin-left:0;"><img alt="" height="89" src="https://images2.imgbox.com/4e/31/sLUC2TM0_o.png" width="1200"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">（8）启动数据库</p> 
  <pre><code class="hljs">[root@node1 backup]# systemctl restart mysqld</code></pre> 
  <p style="margin-left:0;"><img alt="" height="110" src="https://images2.imgbox.com/6a/23/TQdEsvga_o.png" width="1149"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;">（9）查看数据是否恢复</p> 
  <pre><code class="hljs">[root@node1 backup]# mysql -uroot -p123456 -e 'use it;show tables;select * from sc'</code></pre> 
  <p style="margin-left:0;"><img alt="" height="795" src="https://images2.imgbox.com/fd/fc/ErqG80pl_o.png" width="1200"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"></p> 
  <blockquote> 
   <p style="margin-left:0;">--stream=tar  压缩</p> 
   <p style="margin-left:0;">--stream=tar  指定路径 | gzip    &gt;  压缩路径</p> 
  </blockquote> 
  <p style="margin-left:0;"><strong>完全备份</strong><strong>full_1</strong><strong>并压缩到</strong><strong>/server/backup/full_1.tar.gz</strong></p> 
  <pre><code class="hljs">[root@node1 backup]# innobackupex --user=root --password=123456 --socket=/tmp/mysql.sock  --no-timestamp /server/backup/full_1 | gzip - &gt; /server/backup/full_1.tar.gz</code></pre> 
  <p style="margin-left:0;"><img alt="" height="417" src="https://images2.imgbox.com/01/be/LCbRe5Ur_o.png" width="1200"></p> 
  <p style="margin-left:0;"></p> 
  <pre><code class="hljs">[root@node1 backup]# ll</code></pre> 
  <p style="margin-left:0;"><img alt="" height="355" src="https://images2.imgbox.com/9c/f2/DMmn5NAh_o.png" width="1200"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"></p> 
  <p style="margin-left:0;"></p> 
 </div> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5184c1b4591c213a00c2f01b13b86cf2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">高频小信号谐振放大器【Multisim】【高频电子线路】</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3f0f2e82e581e67629579dbefb642fa3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">软考中级——计算机网络与信息安全基础概要</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>