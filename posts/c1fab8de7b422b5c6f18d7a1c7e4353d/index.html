<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【学习笔记】大数据技术之Kafka3.x（生产调优手册） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【学习笔记】大数据技术之Kafka3.x（生产调优手册）" />
<meta property="og:description" content="生产调优手册 第 1 章 Kafka 硬件配置选择1.1 场景说明1.2 服务器台数选择1.3 磁盘选择1.4 内存选择1.5 CPU 选择1.6 网络选择 第 2 章 Kafka 生产者2.1 Kafka 生产者核心参数配置2.2 生产者如何提高吞吐量2.3 数据可靠性2.4 数据去重2.5 数据有序2.6 数据乱序 第 3 章 Kafka Broker3.1 Broker 核心参数配置3.2 服役新节点/退役旧节点3.3 增加分区3.4 增加副本因子3.5 手动调整分区副本存储3.6 Leader Partition 负载平衡3.7 自动创建主题 第 4 章 Kafka 消费者4.1 Kafka 消费者核心参数配置4.2 消费者再平衡4.3 指定 Offset 消费4.4 指定时间消费4.5 消费者事务4.6 消费者如何提高吞吐量 第 5 章 Kafka 总体5.1 如何提升吞吐量5.2 数据精准一次5.3 合理设置分区数5.4 单条日志大于 1m5.5 服务器挂了5.6 集群压力测试1）Kafka 压测2）Kafka Producer 压力测试3）Kafka Consumer 压力测试 【尚硅谷】2022版Kafka3." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/c1fab8de7b422b5c6f18d7a1c7e4353d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-04-05T17:42:35+08:00" />
<meta property="article:modified_time" content="2022-04-05T17:42:35+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【学习笔记】大数据技术之Kafka3.x（生产调优手册）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>生产调优手册</h4> 
 <ul><li><a href="#_1__Kafka__5" rel="nofollow">第 1 章 Kafka 硬件配置选择</a></li><li><ul><li><a href="#11__6" rel="nofollow">1.1 场景说明</a></li><li><a href="#12__19" rel="nofollow">1.2 服务器台数选择</a></li><li><a href="#13__25" rel="nofollow">1.3 磁盘选择</a></li><li><a href="#14__31" rel="nofollow">1.4 内存选择</a></li><li><a href="#15_CPU__136" rel="nofollow">1.5 CPU 选择</a></li><li><a href="#16__143" rel="nofollow">1.6 网络选择</a></li></ul> 
  </li><li><a href="#_2__Kafka__147" rel="nofollow">第 2 章 Kafka 生产者</a></li><li><ul><li><a href="#21_Kafka__157" rel="nofollow">2.1 Kafka 生产者核心参数配置</a></li><li><a href="#22__179" rel="nofollow">2.2 生产者如何提高吞吐量</a></li><li><a href="#23__185" rel="nofollow">2.3 数据可靠性</a></li><li><a href="#24__196" rel="nofollow">2.4 数据去重</a></li><li><a href="#25__218" rel="nofollow">2.5 数据有序</a></li><li><a href="#26__221" rel="nofollow">2.6 数据乱序</a></li></ul> 
  </li><li><a href="#_3__Kafka_Broker_228" rel="nofollow">第 3 章 Kafka Broker</a></li><li><ul><li><a href="#31_Broker__231" rel="nofollow">3.1 Broker 核心参数配置</a></li><li><a href="#32__253" rel="nofollow">3.2 服役新节点/退役旧节点</a></li><li><a href="#33__295" rel="nofollow">3.3 增加分区</a></li><li><a href="#34__304" rel="nofollow">3.4 增加副本因子</a></li><li><a href="#35__336" rel="nofollow">3.5 手动调整分区副本存储</a></li><li><a href="#36_Leader_Partition__370" rel="nofollow">3.6 Leader Partition 负载平衡</a></li><li><a href="#37__376" rel="nofollow">3.7 自动创建主题</a></li></ul> 
  </li><li><a href="#_4__Kafka__391" rel="nofollow">第 4 章 Kafka 消费者</a></li><li><ul><li><a href="#41_Kafka__392" rel="nofollow">4.1 Kafka 消费者核心参数配置</a></li><li><a href="#42__426" rel="nofollow">4.2 消费者再平衡</a></li><li><a href="#43__Offset__436" rel="nofollow">4.3 指定 Offset 消费</a></li><li><a href="#44__443" rel="nofollow">4.4 指定时间消费</a></li><li><a href="#45__453" rel="nofollow">4.5 消费者事务</a></li><li><a href="#46__455" rel="nofollow">4.6 消费者如何提高吞吐量</a></li></ul> 
  </li><li><a href="#_5__Kafka__467" rel="nofollow">第 5 章 Kafka 总体</a></li><li><ul><li><a href="#51__468" rel="nofollow">5.1 如何提升吞吐量</a></li><li><a href="#52__480" rel="nofollow">5.2 数据精准一次</a></li><li><a href="#53__493" rel="nofollow">5.3 合理设置分区数</a></li><li><a href="#54__1m_503" rel="nofollow">5.4 单条日志大于 1m</a></li><li><a href="#55__510" rel="nofollow">5.5 服务器挂了</a></li><li><a href="#56__517" rel="nofollow">5.6 集群压力测试</a></li><li><ul><li><a href="#1Kafka__518" rel="nofollow">1）Kafka 压测</a></li><li><a href="#2Kafka_Producer__526" rel="nofollow">2）Kafka Producer 压力测试</a></li><li><a href="#3Kafka_Consumer__795" rel="nofollow">3）Kafka Consumer 压力测试</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<p><a href="https://www.bilibili.com/video/BV1vr4y1677k?p=59&amp;spm_id_from=333.880.my_history.page.click" rel="nofollow">【尚硅谷】2022版Kafka3.x教程（从入门到调优，深入全面）</a></p> 
<h2><a id="_1__Kafka__5"></a>第 1 章 Kafka 硬件配置选择</h2> 
<h3><a id="11__6"></a>1.1 场景说明</h3> 
<p>100 万日活，每人每天 100 条日志，每天总共的日志条数是 100 万 * 100 条 = 1 亿条。</p> 
<p>1 亿/24 小时/60 分/60 秒 = 1150 条/每秒钟。</p> 
<p>每条日志大小：0.5k - 2k（取 1k）。</p> 
<p>1150 条/每秒钟 * 1k ≈ 1m/s 。</p> 
<p>高峰期每秒钟：1150 条 * 20 倍 = 23000 条。</p> 
<p>每秒多少数据量：20MB/s。</p> 
<h3><a id="12__19"></a>1.2 服务器台数选择</h3> 
<blockquote> 
 <p>服务器台数= 2 * （生产者峰值生产速率 * 副本 / 100） + 1<br> = 2 * （20m/s * 2 / 100） + 1<br> = 3 台</p> 
</blockquote> 
<p>建议 3 台服务器。</p> 
<h3><a id="13__25"></a>1.3 磁盘选择</h3> 
<p>kafka 底层主要是顺序写，固态硬盘和机械硬盘的顺序写速度差不多。<br> 建议选择普通的机械硬盘。<br> 每天总数据量：1 亿条 * 1k ≈ 100g<br> 100g * 副本 2 * 保存时间 3 天 / 0.7 ≈ 1T<br> 建议三台服务器硬盘总大小，大于等于 1T。</p> 
<h3><a id="14__31"></a>1.4 内存选择</h3> 
<p>Kafka 内存组成：堆内存(kafka内部配置) + 页缓存（服务器内存）</p> 
<p>1）Kafka 堆内存建议每个节点：10g ~ 15g<br> 在 kafka-server-start.sh 中修改</p> 
<pre><code class="prism language-bash"><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">"x<span class="token variable">$KAFKA_HEAP_OPTS</span>"</span> <span class="token operator">=</span> <span class="token string">"x"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
 <span class="token builtin class-name">export</span> <span class="token assign-left variable">KAFKA_HEAP_OPTS</span><span class="token operator">=</span><span class="token string">"-Xmx10G -Xms10G"</span>
<span class="token keyword">fi</span>
</code></pre> 
<p>（1）查看 Kafka 进程号</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span>atguigu<span class="token annotation punctuation">@hadoop102</span> kafka<span class="token punctuation">]</span>$ jps
<span class="token number">2321</span> <span class="token class-name">Kafka</span>
<span class="token number">5255</span> <span class="token class-name">Jps</span>
<span class="token number">1931</span> <span class="token class-name">QuorumPeerMain</span>
</code></pre> 
<p>（2）根据 Kafka 进程号，查看 Kafka 的 GC 情况</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span>atguigu<span class="token annotation punctuation">@hadoop102</span> kafka<span class="token punctuation">]</span>$ jstat <span class="token operator">-</span>gc <span class="token number">2321</span> <span class="token number">1</span>s <span class="token number">10</span>
S0C S1C S0U S1U EC EU OC OU MC MU CCSC CCSU YGC YGCT FGC FGCT GCT 
<span class="token number">0.0</span> <span class="token number">7168.0</span> <span class="token number">0.0</span> <span class="token number">7168.0</span> <span class="token number">103424.0</span> <span class="token number">60416.0</span> <span class="token number">1986560.0</span> <span class="token number">148433.5</span> <span class="token number">52092.0</span> <span class="token number">46656.1</span> <span class="token number">6780.0</span> <span class="token number">6202.2</span> <span class="token number">13</span> <span class="token number">0.531</span> <span class="token number">0</span> <span class="token number">0.000</span> <span class="token number">0.531</span>
<span class="token number">0.0</span> <span class="token number">7168.0</span> <span class="token number">0.0</span> <span class="token number">7168.0</span> <span class="token number">103424.0</span> <span class="token number">60416.0</span> <span class="token number">1986560.0</span> <span class="token number">148433.5</span> <span class="token number">52092.0</span> <span class="token number">46656.1</span> <span class="token number">6780.0</span> <span class="token number">6202.2</span> <span class="token number">13</span> <span class="token number">0.531</span> <span class="token number">0</span> <span class="token number">0.000</span> <span class="token number">0.531</span>
<span class="token number">0.0</span> <span class="token number">7168.0</span> <span class="token number">0.0</span> <span class="token number">7168.0</span> <span class="token number">103424.0</span> <span class="token number">60416.0</span> <span class="token number">1986560.0</span> <span class="token number">148433.5</span> <span class="token number">52092.0</span> <span class="token number">46656.1</span> <span class="token number">6780.0</span> <span class="token number">6202.2</span> <span class="token number">13</span> <span class="token number">0.531</span> <span class="token number">0</span> <span class="token number">0.000</span> <span class="token number">0.531</span>
<span class="token number">0.0</span> <span class="token number">7168.0</span> <span class="token number">0.0</span> <span class="token number">7168.0</span> <span class="token number">103424.0</span> <span class="token number">60416.0</span> <span class="token number">1986560.0</span> <span class="token number">148433.5</span> <span class="token number">52092.0</span> <span class="token number">46656.1</span> <span class="token number">6780.0</span> <span class="token number">6202.2</span> <span class="token number">13</span> <span class="token number">0.531</span> <span class="token number">0</span> <span class="token number">0.000</span> <span class="token number">0.531</span>
<span class="token number">0.0</span> <span class="token number">7168.0</span> <span class="token number">0.0</span> <span class="token number">7168.0</span> <span class="token number">103424.0</span> <span class="token number">60416.0</span> <span class="token number">1986560.0</span> <span class="token number">148433.5</span> <span class="token number">52092.0</span> <span class="token number">46656.1</span> <span class="token number">6780.0</span> <span class="token number">6202.2</span> <span class="token number">13</span> <span class="token number">0.531</span> <span class="token number">0</span> <span class="token number">0.000</span> <span class="token number">0.531</span>
<span class="token number">0.0</span> <span class="token number">7168.0</span> <span class="token number">0.0</span> <span class="token number">7168.0</span> <span class="token number">103424.0</span> <span class="token number">61440.0</span> <span class="token number">1986560.0</span> <span class="token number">148433.5</span> <span class="token number">52092.0</span> <span class="token number">46656.1</span> <span class="token number">6780.0</span> <span class="token number">6202.2</span> <span class="token number">13</span> <span class="token number">0.531</span> <span class="token number">0</span> <span class="token number">0.000</span> <span class="token number">0.531</span>
<span class="token number">0.0</span> <span class="token number">7168.0</span> <span class="token number">0.0</span> <span class="token number">7168.0</span> <span class="token number">103424.0</span> <span class="token number">61440.0</span> <span class="token number">1986560.0</span> <span class="token number">148433.5</span> <span class="token number">52092.0</span> <span class="token number">46656.1</span> <span class="token number">6780.0</span> <span class="token number">6202.2</span> <span class="token number">13</span> <span class="token number">0.531</span> <span class="token number">0</span> <span class="token number">0.000</span> <span class="token number">0.531</span>
<span class="token number">0.0</span> <span class="token number">7168.0</span> <span class="token number">0.0</span> <span class="token number">7168.0</span> <span class="token number">103424.0</span> <span class="token number">61440.0</span> <span class="token number">1986560.0</span> <span class="token number">148433.5</span> <span class="token number">52092.0</span> <span class="token number">46656.1</span> <span class="token number">6780.0</span> <span class="token number">6202.2</span> <span class="token number">13</span> <span class="token number">0.531</span> <span class="token number">0</span> <span class="token number">0.000</span> <span class="token number">0.531</span>
<span class="token number">0.0</span> <span class="token number">7168.0</span> <span class="token number">0.0</span> <span class="token number">7168.0</span> <span class="token number">103424.0</span> <span class="token number">61440.0</span> <span class="token number">1986560.0</span> <span class="token number">148433.5</span> <span class="token number">52092.0</span> <span class="token number">46656.1</span> <span class="token number">6780.0</span> <span class="token number">6202.2</span> <span class="token number">13</span> <span class="token number">0.531</span> <span class="token number">0</span> <span class="token number">0.000</span> <span class="token number">0.531</span>
<span class="token number">0.0</span> <span class="token number">7168.0</span> <span class="token number">0.0</span> <span class="token number">7168.0</span> <span class="token number">103424.0</span> <span class="token number">61440.0</span> <span class="token number">1986560.0</span> <span class="token number">148433.5</span> <span class="token number">52092.0</span> <span class="token number">46656.1</span> <span class="token number">6780.0</span> <span class="token number">6202.2</span> <span class="token number">13</span> <span class="token number">0.531</span> <span class="token number">0</span> <span class="token number">0.000</span> <span class="token number">0.531</span>
</code></pre> 
<p>参数说明：<br> S0C：第一个幸存区的大小； S1C：第二个幸存区的大小<br> S0U：第一个幸存区的使用大小； S1U：第二个幸存区的使用大小<br> EC：伊甸园区的大小； EU：伊甸园区的使用大小<br> OC：老年代大小； OU：老年代使用大小<br> MC：方法区大小； MU：方法区使用大小<br> CCSC:压缩类空间大小； CCSU:压缩类空间使用大小<br> <mark>YGC：年轻代垃圾回收次数</mark>； YGCT：年轻代垃圾回收消耗时间<br> FGC：老年代垃圾回收次数； FGCT：老年代垃圾回收消耗时间<br> GCT：垃圾回收消耗总时间；</p> 
<p>（3）根据 Kafka 进程号，查看 Kafka 的堆内存</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span>atguigu<span class="token annotation punctuation">@hadoop102</span> kafka<span class="token punctuation">]</span>$ jmap <span class="token operator">-</span>heap <span class="token number">2321</span>
<span class="token class-name">Attaching</span> <span class="token keyword">to</span> <span class="token namespace">process</span> <span class="token class-name">ID</span> <span class="token number">2321</span><span class="token punctuation">,</span> please wait<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token class-name">Debugger</span> attached <span class="token class-name"><span class="token namespace">successfully<span class="token punctuation">.</span></span>
Server</span> compiler detected<span class="token punctuation">.</span>
JVM version is <span class="token number">25.212</span><span class="token operator">-</span>b10
using thread<span class="token operator">-</span>local object <span class="token class-name"><span class="token namespace">allocation<span class="token punctuation">.</span></span>
Garbage</span><span class="token operator">-</span><span class="token class-name">First</span> <span class="token punctuation">(</span>G1<span class="token punctuation">)</span> GC <span class="token keyword">with</span> <span class="token number">8</span> <span class="token function">thread</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token class-name">Heap</span> <span class="token class-name">Configuration</span><span class="token operator">:</span>
 
 <span class="token class-name">MinHeapFreeRatio</span> <span class="token operator">=</span> <span class="token number">40</span>
 <span class="token class-name">MaxHeapFreeRatio</span> <span class="token operator">=</span> <span class="token number">70</span>
 <span class="token class-name">MaxHeapSize</span> <span class="token operator">=</span> <span class="token number">2147483648</span> <span class="token punctuation">(</span><span class="token number">2048.0</span>MB<span class="token punctuation">)</span>
 <span class="token class-name">NewSize</span> <span class="token operator">=</span> <span class="token number">1363144</span> <span class="token punctuation">(</span><span class="token number">1.2999954223632812</span>MB<span class="token punctuation">)</span>
 <span class="token class-name">MaxNewSize</span> <span class="token operator">=</span> <span class="token number">1287651328</span> <span class="token punctuation">(</span><span class="token number">1228.0</span>MB<span class="token punctuation">)</span>
 <span class="token class-name">OldSize</span> <span class="token operator">=</span> <span class="token number">5452592</span> <span class="token punctuation">(</span><span class="token number">5.1999969482421875</span>MB<span class="token punctuation">)</span>
 <span class="token class-name">NewRatio</span> <span class="token operator">=</span> <span class="token number">2</span>
 <span class="token class-name">SurvivorRatio</span> <span class="token operator">=</span> <span class="token number">8</span>
 <span class="token class-name">MetaspaceSize</span> <span class="token operator">=</span> <span class="token number">21807104</span> <span class="token punctuation">(</span><span class="token number">20.796875</span>MB<span class="token punctuation">)</span>
 <span class="token class-name">CompressedClassSpaceSize</span> <span class="token operator">=</span> <span class="token number">1073741824</span> <span class="token punctuation">(</span><span class="token number">1024.0</span>MB<span class="token punctuation">)</span>
 <span class="token class-name">MaxMetaspaceSize</span> <span class="token operator">=</span> <span class="token number">17592186044415</span> MB
 <span class="token class-name">G1HeapRegionSize</span> <span class="token operator">=</span> <span class="token number">1048576</span> <span class="token punctuation">(</span><span class="token number">1.0</span>MB<span class="token punctuation">)</span>
<span class="token class-name">Heap</span> <span class="token class-name">Usage</span><span class="token operator">:</span>
G1 <span class="token class-name">Heap</span><span class="token operator">:</span>
 regions <span class="token operator">=</span> <span class="token number">2048</span>
 capacity <span class="token operator">=</span> <span class="token number">2147483648</span> <span class="token punctuation">(</span><span class="token number">2048.0</span>MB<span class="token punctuation">)</span>
 used <span class="token operator">=</span> <span class="token number">246367744</span> <span class="token punctuation">(</span><span class="token number">234.95458984375</span>MB<span class="token punctuation">)</span>
 free <span class="token operator">=</span> <span class="token number">1901115904</span> <span class="token punctuation">(</span><span class="token number">1813.04541015625</span>MB<span class="token punctuation">)</span>
 <span class="token number">11.472392082214355</span><span class="token operator">%</span> used
G1 <span class="token class-name">Young</span> <span class="token class-name">Generation</span><span class="token operator">:</span>
<span class="token class-name">Eden</span> <span class="token class-name">Space</span><span class="token operator">:</span>
 regions <span class="token operator">=</span> <span class="token number">83</span>
 capacity <span class="token operator">=</span> <span class="token number">105906176</span> <span class="token punctuation">(</span><span class="token number">101.0</span>MB<span class="token punctuation">)</span>
 used <span class="token operator">=</span> <span class="token number">87031808</span> <span class="token punctuation">(</span><span class="token number">83.0</span>MB<span class="token punctuation">)</span>
 free <span class="token operator">=</span> <span class="token number">18874368</span> <span class="token punctuation">(</span><span class="token number">18.0</span>MB<span class="token punctuation">)</span>
 <span class="token number">82.17821782178218</span><span class="token operator">%</span> used
<span class="token class-name">Survivor</span> <span class="token class-name">Space</span><span class="token operator">:</span>
 regions <span class="token operator">=</span> <span class="token number">7</span>
 capacity <span class="token operator">=</span> <span class="token number">7340032</span> <span class="token punctuation">(</span><span class="token number">7.0</span>MB<span class="token punctuation">)</span>
 used <span class="token operator">=</span> <span class="token number">7340032</span> <span class="token punctuation">(</span><span class="token number">7.0</span>MB<span class="token punctuation">)</span>
 free <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">0.0</span>MB<span class="token punctuation">)</span>
 <span class="token number">100.0</span><span class="token operator">%</span> used
G1 <span class="token class-name">Old</span> <span class="token class-name">Generation</span><span class="token operator">:</span>
 regions <span class="token operator">=</span> <span class="token number">147</span>
 capacity <span class="token operator">=</span> <span class="token number">2034237440</span> <span class="token punctuation">(</span><span class="token number">1940.0</span>MB<span class="token punctuation">)</span>
 used <span class="token operator">=</span> <span class="token number">151995904</span> <span class="token punctuation">(</span><span class="token number">144.95458984375</span>MB<span class="token punctuation">)</span>
 free <span class="token operator">=</span> <span class="token number">1882241536</span> <span class="token punctuation">(</span><span class="token number">1795.04541015625</span>MB<span class="token punctuation">)</span>
 <span class="token number">7.471886074420103</span><span class="token operator">%</span> used
<span class="token number">13364</span> interned <span class="token class-name">Strings</span> occupying <span class="token number">1449608</span> bytes<span class="token punctuation">.</span>
</code></pre> 
<p>2）页缓存：页缓存是 Linux 系统服务器的内存。我们只需要保证 1 个 segment（1g）中25%的数据在内存中就好。<br> 每个节点页缓存大小 =（分区数 * 1g * 25%）/ 节点数。例如 10 个分区leader，页缓存大小=（10 * 1g * 25%）/ 3 ≈ 1g<br> 建议服务器内存大于等于 11G。</p> 
<h3><a id="15_CPU__136"></a>1.5 CPU 选择</h3> 
<p><code>num.io.threads = 8</code> 负责写磁盘的线程数，整个参数值要占总核数的 50%。<br> <code>num.replica.fetchers = 1</code> 副本拉取线程数，这个参数占总核数的 50%的 1/3。</p> 
<p><code>num.network.threads = 3</code> 数据传输线程数，这个参数占总核数的 50%的 2/3。<br> 建议 32 个 cpu core。<br> 24(12,4,8)+ 8</p> 
<h3><a id="16__143"></a>1.6 网络选择</h3> 
<p>网络带宽 = 峰值吞吐量 ≈ 20MB/s 选择千兆网卡即可。<br> 100Mbps 单位是 bit；10M/s 单位是 byte ; 1byte = 8bit，100Mbps/8 = 12.5M/s。<br> 一般百兆的网卡（100Mbps ）、千兆的网卡（1000Mbps）、万兆的网卡（10000Mbps）。</p> 
<h2><a id="_2__Kafka__147"></a>第 2 章 Kafka 生产者</h2> 
<blockquote> 
 <p>3.1.1 Updating Broker Configs<br> From Kafka version 1.1 onwards, some of the broker configs can be<br> updated without restarting the broker. See the Dynamic Update Mode<br> column in Broker Configs for the update mode of each broker config.<br> <mark>read-only</mark>: Requires a broker restart for update<br> <mark>per-broker</mark>: May be updated dynamically for each broker<br> <mark>cluster-wide</mark>: May be updated dynamically as a cluster-wide default.<br> May also be updated as a per-broker value for testing.</p> 
</blockquote> 
<h3><a id="21_Kafka__157"></a>2.1 Kafka 生产者核心参数配置</h3> 
<p><img src="https://images2.imgbox.com/fb/f1/AO6onNxK_o.png" alt="在这里插入图片描述"></p> 
<p>参数名称 描述<br> <code>bootstrap.servers</code> 生 产 者 连 接 集 群 所 需 的 broker 地 址 清 单 。 例 如hadoop102:9092,hadoop103:9092,hadoop104:9092，可以设置 1 个或者多个，中间用逗号隔开。注意这里并非需要所有的 broker 地址，因为生产者从给定的 broker 里查找到其他 broker 信息。</p> 
<p><code>key.serializer</code> 和<code> value.serializer</code> 指定发送消息的 key 和 value 的序列化类型。一定要写全类名。<br> <code>buffer.memory</code> RecordAccumulator 缓冲区总大小，默认 <mark>32m</mark>。<br> <code>batch.size</code> 缓冲区一批数据最大值，默认 <mark>16k</mark>。适当增加该值，可以提高吞吐量，但是如果该值设置太大，会导致数据传输延迟增加。<br> <code>linger.ms</code> 如果数据迟迟未达到 batch.size，sender 等待 linger.time之后就会发送数据。单位 ms，默认值是 0ms，表示没有延迟。生产环境建议该值大小为 5-100ms 之间。<br> <code>acks</code><br> 0：生产者发送过来的数据，不需要等数据落盘应答。<br> 1：生产者发送过来的数据，Leader 收到数据后应答。<br> -1（all）：生产者发送过来的数据，Leader+和 isr 队列里面的所有节点收齐数据后应答。<mark>默认值是-1，-1 和 all是等价的</mark>。</p> 
<p><code>max.in.flight.requests.per.connection</code> 允许最多没有返回 ack 的次数，<mark>默认为 5</mark>，开启幂等性要保证该值是 1-5 的数字。retries 当消息发送出现错误的时候，系统会重发消息。<br> <code>retries</code> 表示重试次数。<mark>默认是 int 最大值，2147483647</mark>。<br> 如果设置了重试，还想保证消息的有序性，需要设置MAX_IN_FLIGHT_REQUESTS_PER_CONNECTION=1否则在重试此失败消息的时候，其他的消息可能发送成功了。</p> 
<p><code>retry.backoff.ms</code> 两次重试之间的时间间隔，默认是 100ms。<br> <code>enable.idempotence</code> 是否开启幂等性，<mark>默认 true</mark>，开启幂等性。<br> <code>compression.type</code> 生产者发送的所有数据的压缩方式。<mark>默认是 none</mark>，也就是不压缩。支持压缩类型：<mark>none、gzip、snappy、lz4 和 zstd</mark>。</p> 
<h3><a id="22__179"></a>2.2 生产者如何提高吞吐量</h3> 
<p>参数名称 描述<br> <code>buffer.memory RecordAccumulator</code> 缓冲区总大小，<mark>默认 32m</mark>。<br> <code>batch.size</code> 缓冲区一批数据最大值，<mark>默认 16k</mark>。适当增加该值，可以提高吞吐量，但是如果该值设置太大，会导致数据传输延迟增加。<br> <code>linger.ms </code>如果数据迟迟未达到 batch.size，sender 等待 linger.time之后就会发送数据。单位 ms，<mark>默认值是 0ms</mark>，表示没有延迟。生产环境建议该值大小为 5-100ms 之间。<br> <code>compression.type</code> 生产者发送的所有数据的压缩方式。<mark>默认是 none</mark>，也就是不压缩。支持压缩类型：none、gzip、snappy、lz4 和 zstd。</p> 
<h3><a id="23__185"></a>2.3 数据可靠性</h3> 
<p>详见，尚硅谷大数据技术之 Kafka3.0.0<br> 参数名称 描述<br> <code>acks</code> 0：生产者发送过来的数据，不需要等数据落盘应答。<br> 1：生产者发送过来的数据，Leader 收到数据后应答。<br> -1（all）：生产者发送过来的数据，Leader+和 isr 队列里面的所有节点收齐数据后应答。<br> <mark>默认值是-1，-1 和 all是等价的</mark>。</p> 
<ul><li>至少一次（At Least Once）= ACK 级别设置为-1 + 分区副本大于等于 2 + ISR 里应答的最小副本数量大于等于 2</li></ul> 
<h3><a id="24__196"></a>2.4 数据去重</h3> 
<p>详见，尚硅谷大数据技术之 Kafka3.0.0<br> 1）配置参数<br> <code>enable.idempotence</code> 是否开启幂等性，<mark>默认 true</mark>，表示开启幂等性。只能保证单分区单会话内数据不重</p> 
<p>2）Kafka 的事务一共有如下 5 个 API</p> 
<pre><code class="prism language-java"><span class="token comment">// 1 初始化事务</span>
<span class="token keyword">void</span> <span class="token function">initTransactions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 2 开启事务</span>
<span class="token keyword">void</span> <span class="token function">beginTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ProducerFencedException</span><span class="token punctuation">;</span>
<span class="token comment">// 3 在事务内提交已经消费的偏移量（主要用于消费者）</span>
<span class="token keyword">void</span> <span class="token function">sendOffsetsToTransaction</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TopicPartition</span><span class="token punctuation">,</span> <span class="token class-name">OffsetAndMetadata</span><span class="token punctuation">&gt;</span></span> offsets<span class="token punctuation">,</span>
 <span class="token class-name">String</span> consumerGroupId<span class="token punctuation">)</span> <span class="token keyword">throws</span> 
<span class="token class-name">ProducerFencedException</span><span class="token punctuation">;</span>
<span class="token comment">// 4 提交事务</span>
<span class="token keyword">void</span> <span class="token function">commitTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ProducerFencedException</span><span class="token punctuation">;</span>
<span class="token comment">// 5 放弃事务（类似于回滚事务的操作）</span>
<span class="token keyword">void</span> <span class="token function">abortTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ProducerFencedException</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="25__218"></a>2.5 数据有序</h3> 
<p>详见，尚硅谷大数据技术之 Kafka3.0.0<br> <mark>单分区内，有序（有条件的，不能乱序）；多分区，分区与分区间无序</mark>；</p> 
<h3><a id="26__221"></a>2.6 数据乱序</h3> 
<p>详见，尚硅谷大数据技术之 Kafka3.0.0<br> 参数名称 描述<br> <code>enable.idempotence</code> 是否开启幂等性，<mark>默认 true</mark>，表示开启幂等性。<br> <code>max.in.flight.requests.per.connection</code> 允许最多没有返回 ack 的次数，<mark>默认为 5</mark>，开启幂等性<br> 要保证该值是 1-5 的数字。</p> 
<h2><a id="_3__Kafka_Broker_228"></a>第 3 章 Kafka Broker</h2> 
<p><img src="https://images2.imgbox.com/7a/cc/djXJy3Up_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="31_Broker__231"></a>3.1 Broker 核心参数配置</h3> 
<p>参数名称 描述<br> <code>replica.lag.time.max.ms</code> ISR 中，如果 Follower 长时间未向 Leader 发送通信请求或同步数据，则该 Follower 将被踢出 ISR。该时间阈值，<mark>默认 30s</mark>。<br> <code>auto.leader.rebalance.enable</code> <mark>默认是 true</mark>。 自动 Leader Partition 平衡。建议关闭。<br> <code>leader.imbalance.per.broker.percentage</code> 默认是 <mark>10%</mark>。每个 broker 允许的不平衡的 leader的比率。如果每个 broker 超过了这个值，控制器会触发 leader 的平衡。<br> <code>leader.imbalance.check.interval.seconds</code> 默认值 <mark>300 秒</mark>。检查 leader 负载是否平衡的间隔时间。<br> <code>log.segment.bytes</code> Kafka 中 log 日志是分成一块块存储的，此配置是指 log 日志划分 成块的大小，默认值 <mark>1G</mark>。<br> <code>log.index.interval.bytes</code> 默认<mark>4kb</mark>，kafka 里面每当写入了 4kb 大小的日志（.log），然后就往 index 文件里面记录一个索引。<br> <code>log.retention.hours</code> Kafka 中数据保存的时间，默认 <mark>7 天</mark>。</p> 
<p><code>log.retention.minutes</code> Kafka 中数据保存的时间，<mark>分钟级别</mark>，默认关闭。<br> <code>log.retention.ms</code> Kafka 中数据保存的时间，<mark>毫秒级别</mark>，默认关闭。<br> <code>log.retention.check.interval.ms</code> 检查数据是否保存超时的间隔，<mark>默认是 5 分钟</mark>。<br> <code>log.retention.bytes</code> 默认等于-1，表示无穷大。超过设置的所有日志总大小，删除最早的 segment。<br> <code>log.cleanup.policy</code> 默认是<mark>delete</mark>，表示所有数据启用删除策略；如果设置值为 compact，表示所有数据启用压缩策略。<br> <code>num.io.threads</code> 默认是 <mark>8</mark>。负责写磁盘的线程数。整个参数值要占总核数的 50%。<br> <code>num.replica.fetchers</code> 默认是 <mark>1</mark>。副本拉取线程数，这个参数占总核数的 50%的 1/3<br> <code>num.network.threads</code> 默认是 <mark>3</mark>。数据传输线程数，这个参数占总核数的 50%的 2/3 。<br> <code>log.flush.interval.messages</code> 强制页缓存刷写到磁盘的条数，默认是 long 的最大值，9223372036854775807。一般不建议修改，交给系统自己管理。<br> <code>log.flush.interval.ms</code> 每隔多久，刷数据到磁盘，默认是 null。一般不建议修改，交给系统自己管理。</p> 
<h3><a id="32__253"></a>3.2 服役新节点/退役旧节点</h3> 
<p>详见，尚硅谷大数据技术之 Kafka3.0.0<br> （1）创建一个要均衡的主题。</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span>atguigu<span class="token annotation punctuation">@hadoop102</span> kafka<span class="token punctuation">]</span>$ vim topics<span class="token operator">-</span><span class="token keyword">to</span><span class="token operator">-</span>move<span class="token punctuation">.</span>json 
<span class="token punctuation">{<!-- --></span>
 <span class="token string">"topics"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
 <span class="token punctuation">{<!-- --></span><span class="token string">"topic"</span><span class="token operator">:</span> <span class="token string">"first"</span><span class="token punctuation">}</span>
 <span class="token punctuation">]</span><span class="token punctuation">,</span>
 <span class="token string">"version"</span><span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>（2）生成一个负载均衡的计划。</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span>atguigu<span class="token annotation punctuation">@hadoop102</span> kafka<span class="token punctuation">]</span>$ bin<span class="token operator">/</span>kafka<span class="token operator">-</span>reassign<span class="token operator">-</span>partitions<span class="token punctuation">.</span>sh <span class="token operator">--</span>
bootstrap<span class="token operator">-</span>server hadoop102<span class="token operator">:</span><span class="token number">9092</span> <span class="token operator">--</span>topics<span class="token operator">-</span><span class="token keyword">to</span><span class="token operator">-</span>move<span class="token operator">-</span>json<span class="token operator">-</span>file 
topics<span class="token operator">-</span><span class="token keyword">to</span><span class="token operator">-</span>move<span class="token punctuation">.</span>json <span class="token operator">--</span>broker<span class="token operator">-</span>list <span class="token string">"0,1,2,3"</span> <span class="token operator">--</span>generate
</code></pre> 
<p>（3）创建副本存储计划（所有副本存储在 broker0、broker1、broker2、broker3 中）。</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span>atguigu<span class="token annotation punctuation">@hadoop102</span> kafka<span class="token punctuation">]</span>$ vim increase<span class="token operator">-</span>replication<span class="token operator">-</span>factor<span class="token punctuation">.</span>json
</code></pre> 
<p>（4）执行副本存储计划。</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span>atguigu<span class="token annotation punctuation">@hadoop102</span> kafka<span class="token punctuation">]</span>$ bin<span class="token operator">/</span>kafka<span class="token operator">-</span>reassign<span class="token operator">-</span>partitions<span class="token punctuation">.</span>sh <span class="token operator">--</span>
bootstrap<span class="token operator">-</span>server hadoop102<span class="token operator">:</span><span class="token number">9092</span> <span class="token operator">--</span>reassignment<span class="token operator">-</span>json<span class="token operator">-</span>file increasereplication<span class="token operator">-</span>factor<span class="token punctuation">.</span>json <span class="token operator">--</span>execute
</code></pre> 
<p>（5）验证副本存储计划。</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span>atguigu<span class="token annotation punctuation">@hadoop102</span> kafka<span class="token punctuation">]</span>$ bin<span class="token operator">/</span>kafka<span class="token operator">-</span>reassign<span class="token operator">-</span>partitions<span class="token punctuation">.</span>sh <span class="token operator">--</span>
bootstrap<span class="token operator">-</span>server hadoop102<span class="token operator">:</span><span class="token number">9092</span> <span class="token operator">--</span>reassignment<span class="token operator">-</span>json<span class="token operator">-</span>file increasereplication<span class="token operator">-</span>factor<span class="token punctuation">.</span>json <span class="token operator">--</span>verify
</code></pre> 
<h3><a id="33__295"></a>3.3 增加分区</h3> 
<p>详见，尚硅谷大数据技术之 Kafka3.0.0<br> 1）修改分区数（<mark>注意：分区数只能增加，不能减少</mark>）</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span>atguigu<span class="token annotation punctuation">@hadoop102</span> kafka<span class="token punctuation">]</span>$ bin<span class="token operator">/</span>kafka<span class="token operator">-</span>topics<span class="token punctuation">.</span>sh <span class="token operator">--</span>bootstrap<span class="token operator">-</span>server 
hadoop102<span class="token operator">:</span><span class="token number">9092</span> <span class="token operator">--</span>alter <span class="token operator">--</span>topic first <span class="token operator">--</span>partitions <span class="token number">3</span>
</code></pre> 
<h3><a id="34__304"></a>3.4 增加副本因子</h3> 
<p>详见，尚硅谷大数据技术之 Kafka3.0.0<br> 1）创建 topic</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span>atguigu<span class="token annotation punctuation">@hadoop102</span> kafka<span class="token punctuation">]</span>$ bin<span class="token operator">/</span>kafka<span class="token operator">-</span>topics<span class="token punctuation">.</span>sh <span class="token operator">--</span>bootstrap<span class="token operator">-</span>server 
hadoop102<span class="token operator">:</span><span class="token number">9092</span> <span class="token operator">--</span>create <span class="token operator">--</span>partitions <span class="token number">3</span> <span class="token operator">--</span>replication<span class="token operator">-</span>factor <span class="token number">1</span> <span class="token operator">--</span>
topic four
</code></pre> 
<p>2）手动增加副本存储<br> （1）创建副本存储计划（所有副本都指定存储在 broker0、broker1、broker2 中）。</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span>atguigu<span class="token annotation punctuation">@hadoop102</span> kafka<span class="token punctuation">]</span>$ vim increase<span class="token operator">-</span>replication<span class="token operator">-</span>factor<span class="token punctuation">.</span>json
</code></pre> 
<p>输入如下内容：</p> 
<pre><code class="prism language-java"><span class="token punctuation">{<!-- --></span><span class="token string">"version"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"partitions"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"topic"</span><span class="token operator">:</span><span class="token string">"four"</span><span class="token punctuation">,</span><span class="token string">"partition"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>"replica
s<span class="token string">":[0,1,2]},{"</span>topic<span class="token string">":"</span>four<span class="token string">","</span>partition<span class="token string">":1,"</span>replicas<span class="token string">":[0,1,2]},{"</span>t
opic<span class="token string">":"</span>four<span class="token string">","</span>partition<span class="token string">":2,"</span>replicas"<span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
</code></pre> 
<p>（2）执行副本存储计划。</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span>atguigu<span class="token annotation punctuation">@hadoop102</span> kafka<span class="token punctuation">]</span>$ bin<span class="token operator">/</span>kafka<span class="token operator">-</span>reassign<span class="token operator">-</span>partitions<span class="token punctuation">.</span>sh <span class="token operator">--</span>
bootstrap<span class="token operator">-</span>server hadoop102<span class="token operator">:</span><span class="token number">9092</span> <span class="token operator">--</span>reassignment<span class="token operator">-</span>json<span class="token operator">-</span>file increasereplication<span class="token operator">-</span>factor<span class="token punctuation">.</span>json <span class="token operator">--</span>execute
</code></pre> 
<h3><a id="35__336"></a>3.5 手动调整分区副本存储</h3> 
<p>详见，尚硅谷大数据技术之 Kafka3.0.0<br> （1）创建副本存储计划（所有副本都指定存储在 broker0、broker1 中）。</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span>atguigu<span class="token annotation punctuation">@hadoop102</span> kafka<span class="token punctuation">]</span>$ vim increase<span class="token operator">-</span>replication<span class="token operator">-</span>factor<span class="token punctuation">.</span>json
</code></pre> 
<p>输入如下内容：</p> 
<pre><code class="prism language-java"><span class="token punctuation">{<!-- --></span>
<span class="token string">"version"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>
<span class="token string">"partitions"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"topic"</span><span class="token operator">:</span><span class="token string">"three"</span><span class="token punctuation">,</span><span class="token string">"partition"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">"replicas"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">{<!-- --></span><span class="token string">"topic"</span><span class="token operator">:</span><span class="token string">"three"</span><span class="token punctuation">,</span><span class="token string">"partition"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"replicas"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">{<!-- --></span><span class="token string">"topic"</span><span class="token operator">:</span><span class="token string">"three"</span><span class="token punctuation">,</span><span class="token string">"partition"</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">"replicas"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">{<!-- --></span><span class="token string">"topic"</span><span class="token operator">:</span><span class="token string">"three"</span><span class="token punctuation">,</span><span class="token string">"partition"</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"replicas"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>（2）执行副本存储计划。</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span>atguigu<span class="token annotation punctuation">@hadoop102</span> kafka<span class="token punctuation">]</span>$ bin<span class="token operator">/</span>kafka<span class="token operator">-</span>reassign<span class="token operator">-</span>partitions<span class="token punctuation">.</span>sh <span class="token operator">--</span>
bootstrap<span class="token operator">-</span>server hadoop102<span class="token operator">:</span><span class="token number">9092</span> <span class="token operator">--</span>reassignment<span class="token operator">-</span>json<span class="token operator">-</span>file increasereplication<span class="token operator">-</span>factor<span class="token punctuation">.</span>json <span class="token operator">--</span>execute
</code></pre> 
<p>（3）验证副本存储计划。</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span>atguigu<span class="token annotation punctuation">@hadoop102</span> kafka<span class="token punctuation">]</span>$ bin<span class="token operator">/</span>kafka<span class="token operator">-</span>reassign<span class="token operator">-</span>partitions<span class="token punctuation">.</span>sh <span class="token operator">--</span>
bootstrap<span class="token operator">-</span>server hadoop102<span class="token operator">:</span><span class="token number">9092</span> <span class="token operator">--</span>reassignment<span class="token operator">-</span>json<span class="token operator">-</span>file increase<span class="token operator">-</span>replication<span class="token operator">-</span>factor<span class="token punctuation">.</span>json <span class="token operator">--</span>verify
</code></pre> 
<h3><a id="36_Leader_Partition__370"></a>3.6 Leader Partition 负载平衡</h3> 
<p>详见，尚硅谷大数据技术之 Kafka3.0.0<br> 参数名称 描述<br> <code>auto.leader.rebalance.enable </code>默认是 true。自动 Leader Partition 平衡。生产环境中，leader 重选举的代价比较大，可能会带来性能影响，建议设置为 <mark>false 关闭</mark>。<br> <code>leader.imbalance.per.broker.percentage</code> 默认是 10%。每个 broker 允许的不平衡的 leader的比率。如果每个 broker 超过了这个值，控制器会触发 leader 的平衡。<br> <code>leader.imbalance.check.interval.seconds</code> 默认值 300 秒。检查 leader 负载是否平衡的间隔时间。</p> 
<h3><a id="37__376"></a>3.7 自动创建主题</h3> 
<p>如果 broker 端配置参数 <code>auto.create.topics.enable</code> 设置为 true（默认值是 true），那么当生产者向一个未创建的主题发送消息时，会自动创建一个分区数为 num.partitions（默认值为1）、副本因子为default.replication.factor（默认值为 1）的主题。除此之外，当一个消费者开始从未知主题中读取消息时，或者当任意一个客户端向未知主题发送元数据请求时，都会自动创建一个相应主题。这种创建主题的方式是非预期的，增加了主题管理和维护的难度。<mark>生产环境建议将该参数设置为 false</mark>。<br> 1）向一个没有提前创建 five 主题发送数据</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span>atguigu<span class="token annotation punctuation">@hadoop102</span> kafka<span class="token punctuation">]</span>$ bin<span class="token operator">/</span>kafka<span class="token operator">-</span>console<span class="token operator">-</span>producer<span class="token punctuation">.</span>sh <span class="token operator">--</span>bootstrap<span class="token operator">-</span>server hadoop102<span class="token operator">:</span><span class="token number">9092</span> <span class="token operator">--</span>topic five
<span class="token operator">&gt;</span>hello world
</code></pre> 
<p>2）查看 five 主题的详情</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span>atguigu<span class="token annotation punctuation">@hadoop102</span> kafka<span class="token punctuation">]</span>$ bin<span class="token operator">/</span>kafka<span class="token operator">-</span>topics<span class="token punctuation">.</span>sh <span class="token operator">--</span>bootstrap<span class="token operator">-</span>server hadoop102<span class="token operator">:</span><span class="token number">9092</span> <span class="token operator">--</span>describe <span class="token operator">--</span>topic five
</code></pre> 
<h2><a id="_4__Kafka__391"></a>第 4 章 Kafka 消费者</h2> 
<h3><a id="41_Kafka__392"></a>4.1 Kafka 消费者核心参数配置</h3> 
<p><img src="https://images2.imgbox.com/bd/fd/pb38kWBp_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/96/58/dQoQA8oI_o.png" alt="在这里插入图片描述"></p> 
<p>参数名称 描述<br> <code>bootstrap.servers</code> 向 Kafka 集群建立初始连接用到的 host/port 列表。</p> 
<p><code>key.deserializer</code> 和<code>value.deserializer</code> 指定接收消息的 key 和 value 的反序列化类型。一定要写全类名。</p> 
<p><code>group.id</code> 标记消费者所属的消费者组。</p> 
<p><code>enable.auto.commit</code> <mark>默认值为 true</mark>，消费者会自动周期性地向服务器提交偏移量。</p> 
<p><code>auto.commit.interval.ms</code> 如果设置了 enable.auto.commit 的值为 true， 则该值定义了消费者偏移量向 Kafka 提交的频率，<mark>默认 5s</mark>。</p> 
<p><code>auto.offset.reset</code> 当 Kafka 中没有初始偏移量或当前偏移量在服务器中不存在（如，数据被删除了），该如何处理？ earliest：自动重置偏移量到最早的偏移量。 <mark>latest：默认，自动重置偏移量为最新的偏移量</mark>。 none：如果消费组原来的（previous）偏移量不存在，则向消费者抛异常。 anything：向消费者抛异常。</p> 
<p><code>offsets.topic.num.partitions __consumer_offsets</code> 的分区数，<mark>默认是 50 个分区。不建议修改</mark>。</p> 
<p><code>heartbeat.interval.ms</code> Kafka 消费者和 coordinator 之间的心跳时间，<mark>默认 3s</mark>。该条目的值必须小于 session.timeout.ms ，也不应该高于session.timeout.ms 的 1/3。<mark>不建议修改</mark>。</p> 
<p><code>session.timeout.ms</code> Kafka 消费者和 coordinator 之间连接超时时间，<mark>默认 45s</mark>。超过该值，该消费者被移除，消费者组执行再平衡。</p> 
<p><code>max.poll.interval.ms</code> 消费者处理消息的最大时长，<mark>默认是 5 分钟</mark>。超过该值，该消费者被移除，消费者组执行再平衡。</p> 
<p><code>fetch.min.bytes</code> 默认 1 个字节。消费者获取服务器端一批消息最小的字节数。</p> 
<p><code>fetch.max.wait.ms</code> 默认 500ms。如果没有从服务器端获取到一批数据的最小字节数。该时间到，仍然会返回数据。</p> 
<p><code>fetch.max.bytes</code> 默认<mark>Default: 52428800（50 m</mark>）。消费者获取服务器端一批消息最大的字节数。如果服务器端一批次的数据大于该值（50m）仍然可以拉取回来这批数据，因此，这不是一个绝对最大值。一批次的大小受 message.max.bytes （broker config）or max.message.bytes （topic config）影响。</p> 
<p><code>max.poll.records</code>一次 poll 拉取数据返回消息的最大条数，<mark>默认是 500 条</mark>。</p> 
<h3><a id="42__426"></a>4.2 消费者再平衡</h3> 
<p>详见，尚硅谷大数据技术之 Kafka3.0.0<br> 参数名称 描述<br> <code>heartbeat.interval.ms</code> Kafka 消费者和 coordinator 之间的心跳时间，<mark>默认 3s</mark>。该条目的值必须小于 session.timeout.ms，也不应该高于session.timeout.ms 的 1/3。</p> 
<p><code>session.timeout.ms</code> Kafka 消费者和 coordinator 之间连接超时时间，==默认 45s。超过该值，该消费者被移除，消费者组执行再平衡。</p> 
<p><code>max.poll.interval.ms</code> 消费者处理消息的最大时长，<mark>默认是 5 分钟</mark>。超过该值，该消费者被移除，消费者组执行再平衡。</p> 
<p><code>partition.assignment.strategy</code> 消 费 者 分 区 分 配 策 略 ， 默 认 策 略 是 Range + CooperativeSticky。Kafka 可以同时使用多个分区分配策略。可以选择的策略包括：<mark>Range、RoundRobin、Sticky、CooperativeSticky</mark></p> 
<h3><a id="43__Offset__436"></a>4.3 指定 Offset 消费</h3> 
<p>详见，尚硅谷大数据技术之 Kafka3.0.0</p> 
<pre><code class="prism language-java">kafkaConsumer<span class="token punctuation">.</span><span class="token function">seek</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="44__443"></a>4.4 指定时间消费</h3> 
<p>详见，尚硅谷大数据技术之 Kafka3.0.0</p> 
<pre><code class="prism language-java"><span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TopicPartition</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> timestampToSearch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
timestampToSearch<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>topicPartition<span class="token punctuation">,</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span>
<span class="token number">1</span> <span class="token operator">*</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">3600</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
kafkaConsumer<span class="token punctuation">.</span><span class="token function">offsetsForTimes</span><span class="token punctuation">(</span>timestampToSearch<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="45__453"></a>4.5 消费者事务</h3> 
<p>详见，尚硅谷大数据技术之 Kafka3.0.0</p> 
<h3><a id="46__455"></a>4.6 消费者如何提高吞吐量</h3> 
<p>详见，尚硅谷大数据技术之 Kafka3.0.0<br> <strong>增加分区数；</strong></p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span>atguigu<span class="token annotation punctuation">@hadoop102</span> kafka<span class="token punctuation">]</span>$ bin<span class="token operator">/</span>kafka<span class="token operator">-</span>topics<span class="token punctuation">.</span>sh <span class="token operator">--</span>bootstrap<span class="token operator">-</span>server hadoop102<span class="token operator">:</span><span class="token number">9092</span> <span class="token operator">--</span>alter <span class="token operator">--</span>topic first <span class="token operator">--</span>partitions <span class="token number">3</span>
</code></pre> 
<p>参数名称 描述<br> <code>fetch.max.bytes</code> 默认 Default: 52428800（<mark>50 m</mark>）。消费者获取服务器端一批消息最大的字节数。如果服务器端一批次的数据大于该值（50m）仍然可以拉取回来这批数据，因此，这不是一个绝对最大值。一批次的大小受 message.max.bytes （broker config）or max.message.bytes （topic config）影响。</p> 
<p><code>max.poll.records</code> 一次 poll 拉取数据返回消息的最大条数，<mark>默认是 500 条</mark></p> 
<h2><a id="_5__Kafka__467"></a>第 5 章 Kafka 总体</h2> 
<h3><a id="51__468"></a>5.1 如何提升吞吐量</h3> 
<p>如何提升吞吐量？<br> <strong>1）提升生产吞吐量</strong><br> （1）buffer.memory：发送消息的缓冲区大小，默认值是 32m，可以增加到 64m。<br> （2）batch.size：默认是 16k。如果 batch 设置太小，会导致频繁网络请求，吞吐量下降；如果 batch 太大，会导致一条消息需要等待很久才能被发送出去，增加网络延时。<br> （3）linger.ms，这个值默认是 0，意思就是消息必须立即被发送。一般设置一个 5-100毫秒。如果 linger.ms 设置的太小，会导致频繁网络请求，吞吐量下降；如果 linger.ms 太长，会导致一条消息需要等待很久才能被发送出去，增加网络延时。<br> （4）compression.type：默认是 none，不压缩，但是也可以使用 lz4 压缩，效率还是不错的，压缩之后可以减小数据量，提升吞吐量，但是会加大 producer 端的 CPU 开销。<br> <strong>2）增加分区</strong><br> <strong>3）消费者提高吞吐量</strong><br> （1）调整 fetch.max.bytes 大小，默认是 50m。<br> （2）调整 max.poll.records 大小，默认是 500 条。<br> <strong>4）增加下游消费者处理能力</strong></p> 
<h3><a id="52__480"></a>5.2 数据精准一次</h3> 
<p>1）生产者角度</p> 
<ul><li>acks 设置为-1 （acks=-1）。</li><li>幂等性（enable.idempotence = true） + 事务 。</li></ul> 
<p>2）broker 服务端角度</p> 
<ul><li>分区副本大于等于 2 （–replication-factor 2）。</li><li>ISR 里应答的最小副本数量大于等于 2 （min.insync.replicas = 2）。</li></ul> 
<p>3）消费者</p> 
<ul><li><mark>事务 + 手动提交 offset</mark> （enable.auto.commit = false）。</li><li>消费者输出的目的地必须支持事务（MySQL、Kafka）。</li></ul> 
<h3><a id="53__493"></a>5.3 合理设置分区数</h3> 
<p>（1）创建一个只有 1 个分区的 topic。<br> （2）测试这个 topic 的 producer 吞吐量和 consumer 吞吐量。<br> （3）假设他们的值分别是 Tp 和 Tc，单位可以是 MB/s。<br> （4）然后假设总的目标吞吐量是 Tt，那么分区数 = Tt / min（Tp，Tc）。<br> 例如：producer 吞吐量 = 20m/s；consumer 吞吐量 = 50m/s，期望吞吐量 100m/s；<br> 分区数 = 100 / 20 = 5 分区<br> 分区数一般设置为：3-10 个<br> 分区数不是越多越好，也不是越少越好，需要搭建完集群，进行压测，再灵活调整分区<br> 个数。</p> 
<h3><a id="54__1m_503"></a>5.4 单条日志大于 1m</h3> 
<p>参数名称 描述<br> <code>message.max.bytes</code> 默认 1m，broker 端接收每个批次消息最大值。<br> <code>max.request.size</code> 默认 1m，生产者发往 broker 每个请求消息最大值。针对 topic级别设置消息体的大小。<br> <code>replica.fetch.max.bytes</code> 默认 1m，副本同步数据，每个批次消息最大值。<br> <code>fetch.max.bytes</code> 默认 Default: 52428800（50 m）。消费者获取服务器端一批消息最大的字节数。如果服务器端一批次的数据大于该值（50m）仍然可以拉取回来这批数据，因此，这不是一个绝对最大值。一批次的大小受 <code>message.max.bytes</code> （broker config）or <code>max.message.bytes</code> （topic config）影响。</p> 
<h3><a id="55__510"></a>5.5 服务器挂了</h3> 
<p>在生产环境中，如果某个 Kafka 节点挂掉。<br> 正常处理办法：<br> （1）先尝试重新启动一下，如果能启动正常，那直接解决。<br> （2）如果重启不行，考虑增加内存、增加 CPU、网络带宽。<br> （3）如果将 kafka 整个节点误删除，如果副本数大于等于 2，可以按照服役新节点的方式重新服役一个新节点，并执行负载均衡。</p> 
<h3><a id="56__517"></a>5.6 集群压力测试</h3> 
<h4><a id="1Kafka__518"></a>1）Kafka 压测</h4> 
<p>用 Kafka 官方自带的脚本，对 Kafka 进行压测。</p> 
<ul><li>生产者压测：<code>kafka-producer-perf-test.sh</code></li><li>消费者压测：<code>kafka-consumer-perf-test.sh</code></li></ul> 
<p><img src="https://images2.imgbox.com/03/91/Ca6rM3lQ_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="2Kafka_Producer__526"></a>2）Kafka Producer 压力测试</h4> 
<p>（1）创建一个 test topic，设置为 3 个分区 3 个副本</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span>atguigu<span class="token annotation punctuation">@hadoop102</span> kafka<span class="token punctuation">]</span>$ bin<span class="token operator">/</span>kafka<span class="token operator">-</span>topics<span class="token punctuation">.</span>sh <span class="token operator">--</span>bootstrapserver hadoop102<span class="token operator">:</span><span class="token number">9092</span> <span class="token operator">--</span>create <span class="token operator">--</span>replication<span class="token operator">-</span>factor <span class="token number">3</span> <span class="token operator">--</span>partitions <span class="token number">3</span> <span class="token operator">--</span>topic test
</code></pre> 
<p>（2）在/opt/module/kafka/bin 目录下面有这两个文件。我们来测试一下</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span>atguigu<span class="token annotation punctuation">@hadoop105</span> kafka<span class="token punctuation">]</span>$ bin<span class="token operator">/</span>kafka<span class="token operator">-</span>producer<span class="token operator">-</span>perf<span class="token operator">-</span>test<span class="token punctuation">.</span>sh <span class="token operator">--</span>topic test <span class="token operator">--</span><span class="token keyword">record</span><span class="token operator">-</span>size <span class="token number">1024</span> <span class="token operator">--</span>num<span class="token operator">-</span>records <span class="token number">1000000</span> <span class="token operator">--</span>throughput <span class="token number">10000</span> <span class="token operator">--</span>producer<span class="token operator">-</span>props bootstrap<span class="token punctuation">.</span>servers<span class="token operator">=</span>hadoop102<span class="token operator">:</span><span class="token number">9092</span><span class="token punctuation">,</span>hadoop103<span class="token operator">:</span><span class="token number">9092</span><span class="token punctuation">,</span>hadoop104<span class="token operator">:</span><span class="token number">9092</span> batch<span class="token punctuation">.</span>size<span class="token operator">=</span><span class="token number">16384</span> linger<span class="token punctuation">.</span>ms<span class="token operator">=</span><span class="token number">0</span>
</code></pre> 
<p>参数说明：</p> 
<p><code>record-size</code> 是一条信息有多大，单位是字节，本次测试设置为 1k。<br> <code>num-records</code> 是总共发送多少条信息，本次测试设置为 100 万条。<br> <code>throughput</code> 是每秒多少条信息，设成-1，表示不限流，尽可能快的生产数据，可测出生产者最大吞吐量。本次实验设置为每秒钟 1 万条。<br> <code>producer-props</code> 后面可以配置生产者相关参数，<mark>batch.size 配置为 16k</mark>。<br> 输出结果：</p> 
<pre><code class="prism language-java">ap<span class="token punctuation">.</span>servers<span class="token operator">=</span>hadoop102<span class="token operator">:</span><span class="token number">9092</span><span class="token punctuation">,</span>hadoop103<span class="token operator">:</span><span class="token number">9092</span><span class="token punctuation">,</span>hadoop104<span class="token operator">:</span><span class="token number">9092</span> batch<span class="token punctuation">.</span>size<span class="token operator">=</span><span class="token number">16384</span> 
linger<span class="token punctuation">.</span>ms<span class="token operator">=</span><span class="token number">0</span>
<span class="token number">37021</span> records sent<span class="token punctuation">,</span> <span class="token number">7401.2</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">7.23</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1136.0</span> ms avg latency<span class="token punctuation">,</span> <span class="token number">1453.0</span> ms max latency<span class="token punctuation">.</span>
<span class="token number">50535</span> records sent<span class="token punctuation">,</span> <span class="token number">10107.0</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">9.87</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1199.5</span> ms avg latency<span class="token punctuation">,</span> <span class="token number">1404.0</span> ms max latency<span class="token punctuation">.</span>
<span class="token number">47835</span> records sent<span class="token punctuation">,</span> <span class="token number">9567.0</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">9.34</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1350.8</span> ms avg latency<span class="token punctuation">,</span> <span class="token number">1570.0</span> ms max latency<span class="token punctuation">.</span>
。。。 。。。
<span class="token number">42390</span> records sent<span class="token punctuation">,</span> <span class="token number">8444.2</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">8.25</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3372.6</span> ms avg latency<span class="token punctuation">,</span> <span class="token number">4008.0</span> ms max latency<span class="token punctuation">.</span>
<span class="token number">37800</span> records sent<span class="token punctuation">,</span> <span class="token number">7558.5</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">7.38</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4079.7</span> ms avg latency<span class="token punctuation">,</span> <span class="token number">4758.0</span> ms max latency<span class="token punctuation">.</span>
<span class="token number">33570</span> records sent<span class="token punctuation">,</span> <span class="token number">6714.0</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">6.56</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4549.0</span> ms avg latency<span class="token punctuation">,</span> <span class="token number">5049.0</span> ms max latency<span class="token punctuation">.</span>
<span class="token number">1000000</span> records sent<span class="token punctuation">,</span> <span class="token number">9180.713158</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">8.97</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1894.78</span> ms avg latency<span class="token punctuation">,</span> <span class="token number">5049.00</span> ms max latency<span class="token punctuation">,</span> <span class="token number">1335</span> ms <span class="token number">50</span>th<span class="token punctuation">,</span> <span class="token number">4128</span> ms <span class="token number">95</span>th<span class="token punctuation">,</span> <span class="token number">4719</span> ms <span class="token number">99</span>th<span class="token punctuation">,</span> <span class="token number">5030</span> ms <span class="token number">99.9</span>th<span class="token punctuation">.</span>
</code></pre> 
<p>（3）调整 batch.size 大小<br> ①batch.size 默认值是 16k。本次实验 batch.size 设置为 32k。</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span>atguigu<span class="token annotation punctuation">@hadoop105</span> kafka<span class="token punctuation">]</span>$ bin<span class="token operator">/</span>kafka<span class="token operator">-</span>producer<span class="token operator">-</span>perf<span class="token operator">-</span>test<span class="token punctuation">.</span>sh <span class="token operator">--</span>
topic test <span class="token operator">--</span><span class="token keyword">record</span><span class="token operator">-</span>size <span class="token number">1024</span> <span class="token operator">--</span>num<span class="token operator">-</span>records <span class="token number">1000000</span> <span class="token operator">--</span>throughput 
<span class="token number">10000</span> <span class="token operator">--</span>producer<span class="token operator">-</span>props 
bootstrap<span class="token punctuation">.</span>servers<span class="token operator">=</span>hadoop102<span class="token operator">:</span><span class="token number">9092</span><span class="token punctuation">,</span>hadoop103<span class="token operator">:</span><span class="token number">9092</span><span class="token punctuation">,</span>hadoop104<span class="token operator">:</span><span class="token number">9092</span> 
batch<span class="token punctuation">.</span>size<span class="token operator">=</span><span class="token number">32768</span> linger<span class="token punctuation">.</span>ms<span class="token operator">=</span><span class="token number">0</span>
</code></pre> 
<p>输出结果：</p> 
<pre><code class="prism language-java"><span class="token number">49922</span> records sent<span class="token punctuation">,</span> <span class="token number">9978.4</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">9.74</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">64.2</span> ms avg latency<span class="token punctuation">,</span> <span class="token number">340.0</span> ms max latency<span class="token punctuation">.</span>
<span class="token number">49940</span> records sent<span class="token punctuation">,</span> <span class="token number">9988.0</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">9.75</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">15.3</span> ms avg latency<span class="token punctuation">,</span> <span class="token number">31.0</span> ms max latency<span class="token punctuation">.</span>
<span class="token number">50018</span> records sent<span class="token punctuation">,</span> <span class="token number">10003.6</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">9.77</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16.4</span> ms avg latency<span class="token punctuation">,</span> <span class="token number">52.0</span> ms max latency<span class="token punctuation">.</span>
。。。 。。。
<span class="token number">49960</span> records sent<span class="token punctuation">,</span> <span class="token number">9992.0</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">9.76</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">17.2</span> ms avg latency<span class="token punctuation">,</span> <span class="token number">40.0</span> ms max latency<span class="token punctuation">.</span>
<span class="token number">50090</span> records sent<span class="token punctuation">,</span> <span class="token number">10016.0</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">9.78</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16.9</span> ms avg latency<span class="token punctuation">,</span> <span class="token number">47.0</span> ms max latency<span class="token punctuation">.</span>
<span class="token number">1000000</span> records sent<span class="token punctuation">,</span> <span class="token number">9997.600576</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">9.76</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">20.20</span> ms avg latency<span class="token punctuation">,</span> <span class="token number">340.00</span> ms max latency<span class="token punctuation">,</span> <span class="token number">16</span> ms <span class="token number">50</span>th<span class="token punctuation">,</span> <span class="token number">30</span> ms <span class="token number">95</span>th<span class="token punctuation">,</span> <span class="token number">168</span> ms <span class="token number">99</span>th<span class="token punctuation">,</span> <span class="token number">249</span> ms <span class="token number">99.9</span>th<span class="token punctuation">.</span>
</code></pre> 
<p>②batch.size 默认值是 16k。本次实验 batch.size 设置为 4k。</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span>atguigu<span class="token annotation punctuation">@hadoop105</span> kafka<span class="token punctuation">]</span>$ bin<span class="token operator">/</span>kafka<span class="token operator">-</span>producer<span class="token operator">-</span>perf<span class="token operator">-</span>test<span class="token punctuation">.</span>sh <span class="token operator">--</span>
topic test <span class="token operator">--</span><span class="token keyword">record</span><span class="token operator">-</span>size <span class="token number">1024</span> <span class="token operator">--</span>num<span class="token operator">-</span>records <span class="token number">1000000</span> <span class="token operator">--</span>throughput 
<span class="token number">10000</span> <span class="token operator">--</span>producer<span class="token operator">-</span>props 

bootstrap<span class="token punctuation">.</span>servers<span class="token operator">=</span>hadoop102<span class="token operator">:</span><span class="token number">9092</span><span class="token punctuation">,</span>hadoop103<span class="token operator">:</span><span class="token number">9092</span><span class="token punctuation">,</span>hadoop104<span class="token operator">:</span><span class="token number">9092</span> 
batch<span class="token punctuation">.</span>size<span class="token operator">=</span><span class="token number">4096</span> linger<span class="token punctuation">.</span>ms<span class="token operator">=</span><span class="token number">0</span>
</code></pre> 
<p>输出结果：</p> 
<pre><code class="prism language-java"><span class="token number">15598</span> records sent<span class="token punctuation">,</span> <span class="token number">3117.1</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">3.04</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1878.3</span> ms avg latency<span class="token punctuation">,</span> 
<span class="token number">3458.0</span> ms max latency<span class="token punctuation">.</span>
<span class="token number">17748</span> records sent<span class="token punctuation">,</span> <span class="token number">3549.6</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">3.47</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5072.5</span> ms avg latency<span class="token punctuation">,</span> 
<span class="token number">6705.0</span> ms max latency<span class="token punctuation">.</span>
<span class="token number">18675</span> records sent<span class="token punctuation">,</span> <span class="token number">3733.5</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">3.65</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">6800.9</span> ms avg latency<span class="token punctuation">,</span> 
<span class="token number">7052.0</span> ms max latency<span class="token punctuation">.</span>
。。。 。。。
<span class="token number">19125</span> records sent<span class="token punctuation">,</span> <span class="token number">3825.0</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">3.74</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">6416.5</span> ms avg latency<span class="token punctuation">,</span> 
<span class="token number">7023.0</span> ms max latency<span class="token punctuation">.</span>
<span class="token number">1000000</span> records sent<span class="token punctuation">,</span> <span class="token number">3660.201531</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">3.57</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">6576.68</span> ms 
avg latency<span class="token punctuation">,</span> <span class="token number">7677.00</span> ms max latency<span class="token punctuation">,</span> <span class="token number">6745</span> ms <span class="token number">50</span>th<span class="token punctuation">,</span> <span class="token number">7298</span> ms <span class="token number">95</span>th<span class="token punctuation">,</span> <span class="token number">7507</span> ms 
<span class="token number">99</span>th<span class="token punctuation">,</span> <span class="token number">7633</span> ms <span class="token number">99.9</span>th<span class="token punctuation">.</span>
</code></pre> 
<p>（4）调整 linger.ms 时间<br> linger.ms 默认是 0ms。本次实验 linger.ms 设置为 50ms。</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span>atguigu<span class="token annotation punctuation">@hadoop105</span> kafka<span class="token punctuation">]</span>$ bin<span class="token operator">/</span>kafka<span class="token operator">-</span>producer<span class="token operator">-</span>perf<span class="token operator">-</span>test<span class="token punctuation">.</span>sh <span class="token operator">--</span>
topic test <span class="token operator">--</span><span class="token keyword">record</span><span class="token operator">-</span>size <span class="token number">1024</span> <span class="token operator">--</span>num<span class="token operator">-</span>records <span class="token number">1000000</span> <span class="token operator">--</span>throughput 
<span class="token number">10000</span> <span class="token operator">--</span>producer<span class="token operator">-</span>props 
bootstrap<span class="token punctuation">.</span>servers<span class="token operator">=</span>hadoop102<span class="token operator">:</span><span class="token number">9092</span><span class="token punctuation">,</span>hadoop103<span class="token operator">:</span><span class="token number">9092</span><span class="token punctuation">,</span>hadoop104<span class="token operator">:</span><span class="token number">9092</span> 
batch<span class="token punctuation">.</span>size<span class="token operator">=</span><span class="token number">4096</span> linger<span class="token punctuation">.</span>ms<span class="token operator">=</span><span class="token number">50</span>
</code></pre> 
<p>输出结果：</p> 
<pre><code class="prism language-java"><span class="token number">16804</span> records sent<span class="token punctuation">,</span> <span class="token number">3360.1</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">3.28</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1841.6</span> ms avg latency<span class="token punctuation">,</span> 
<span class="token number">3338.0</span> ms max latency<span class="token punctuation">.</span>
<span class="token number">18972</span> records sent<span class="token punctuation">,</span> <span class="token number">3793.6</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">3.70</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4877.7</span> ms avg latency<span class="token punctuation">,</span> 
<span class="token number">6453.0</span> ms max latency<span class="token punctuation">.</span>
<span class="token number">19269</span> records sent<span class="token punctuation">,</span> <span class="token number">3852.3</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">3.76</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">6477.9</span> ms avg latency<span class="token punctuation">,</span> 
<span class="token number">6686.0</span> ms max latency<span class="token punctuation">.</span>
。。。 。。。
<span class="token number">17073</span> records sent<span class="token punctuation">,</span> <span class="token number">3414.6</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">3.33</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">6987.7</span> ms avg latency<span class="token punctuation">,</span> 
<span class="token number">7353.0</span> ms max latency<span class="token punctuation">.</span>
<span class="token number">19326</span> records sent<span class="token punctuation">,</span> <span class="token number">3865.2</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">3.77</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">6756.5</span> ms avg latency<span class="token punctuation">,</span> 
<span class="token number">7357.0</span> ms max latency<span class="token punctuation">.</span>
<span class="token number">1000000</span> records sent<span class="token punctuation">,</span> <span class="token number">3842.754486</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">3.75</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">6272.49</span> ms 
avg latency<span class="token punctuation">,</span> <span class="token number">7437.00</span> ms max latency<span class="token punctuation">,</span> <span class="token number">6308</span> ms <span class="token number">50</span>th<span class="token punctuation">,</span> <span class="token number">6880</span> ms <span class="token number">95</span>th<span class="token punctuation">,</span> <span class="token number">7289</span> ms 
<span class="token number">99</span>th<span class="token punctuation">,</span> <span class="token number">7387</span> ms <span class="token number">99.9</span>th<span class="token punctuation">.</span>
</code></pre> 
<p>（5）调整压缩方式<br> ①默认的压缩方式是 none。本次实验 compression.type 设置为 snappy。</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span>atguigu<span class="token annotation punctuation">@hadoop105</span> kafka<span class="token punctuation">]</span>$ bin<span class="token operator">/</span>kafka<span class="token operator">-</span>producer<span class="token operator">-</span>perf<span class="token operator">-</span>test<span class="token punctuation">.</span>sh <span class="token operator">--</span>
topic test <span class="token operator">--</span><span class="token keyword">record</span><span class="token operator">-</span>size <span class="token number">1024</span> <span class="token operator">--</span>num<span class="token operator">-</span>records <span class="token number">1000000</span> <span class="token operator">--</span>throughput 
<span class="token number">10000</span> <span class="token operator">--</span>producer<span class="token operator">-</span>props 
bootstrap<span class="token punctuation">.</span>servers<span class="token operator">=</span>hadoop102<span class="token operator">:</span><span class="token number">9092</span><span class="token punctuation">,</span>hadoop103<span class="token operator">:</span><span class="token number">9092</span><span class="token punctuation">,</span>hadoop104<span class="token operator">:</span><span class="token number">9092</span> 
batch<span class="token punctuation">.</span>size<span class="token operator">=</span><span class="token number">4096</span> linger<span class="token punctuation">.</span>ms<span class="token operator">=</span><span class="token number">50</span> compression<span class="token punctuation">.</span>type<span class="token operator">=</span>snappy
</code></pre> 
<p>输出结果：</p> 
<pre><code class="prism language-java"><span class="token number">17244</span> records sent<span class="token punctuation">,</span> <span class="token number">3446.0</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">3.37</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5207.0</span> ms avg latency<span class="token punctuation">,</span> 
<span class="token number">6861.0</span> ms max latency<span class="token punctuation">.</span>
<span class="token number">18873</span> records sent<span class="token punctuation">,</span> <span class="token number">3774.6</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">3.69</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">6865.0</span> ms avg latency<span class="token punctuation">,</span> 
<span class="token number">7094.0</span> ms max latency<span class="token punctuation">.</span>
<span class="token number">18378</span> records sent<span class="token punctuation">,</span> <span class="token number">3674.1</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">3.59</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">6579.2</span> ms avg latency<span class="token punctuation">,</span> 
<span class="token number">6738.0</span> ms max latency<span class="token punctuation">.</span>
。。。 。。。

<span class="token number">17631</span> records sent<span class="token punctuation">,</span> <span class="token number">3526.2</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">3.44</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">6671.3</span> ms avg latency<span class="token punctuation">,</span> 
<span class="token number">7566.0</span> ms max latency<span class="token punctuation">.</span>
<span class="token number">19116</span> records sent<span class="token punctuation">,</span> <span class="token number">3823.2</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">3.73</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">6739.4</span> ms avg latency<span class="token punctuation">,</span> 
<span class="token number">7630.0</span> ms max latency<span class="token punctuation">.</span>
<span class="token number">1000000</span> records sent<span class="token punctuation">,</span> <span class="token number">3722.925028</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">3.64</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">6467.75</span> ms 
avg latency<span class="token punctuation">,</span> <span class="token number">7727.00</span> ms max latency<span class="token punctuation">,</span> <span class="token number">6440</span> ms <span class="token number">50</span>th<span class="token punctuation">,</span> <span class="token number">7308</span> ms <span class="token number">95</span>th<span class="token punctuation">,</span> <span class="token number">7553</span> ms 
<span class="token number">99</span>th<span class="token punctuation">,</span> <span class="token number">7665</span> ms <span class="token number">99.9</span>th<span class="token punctuation">.</span>
</code></pre> 
<p>②默认的压缩方式是 none。本次实验 compression.type 设置为 zstd。</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span>atguigu<span class="token annotation punctuation">@hadoop105</span> kafka<span class="token punctuation">]</span>$ bin<span class="token operator">/</span>kafka<span class="token operator">-</span>producer<span class="token operator">-</span>perf<span class="token operator">-</span>test<span class="token punctuation">.</span>sh <span class="token operator">--</span>
topic test <span class="token operator">--</span><span class="token keyword">record</span><span class="token operator">-</span>size <span class="token number">1024</span> <span class="token operator">--</span>num<span class="token operator">-</span>records <span class="token number">1000000</span> <span class="token operator">--</span>throughput 
<span class="token number">10000</span> <span class="token operator">--</span>producer<span class="token operator">-</span>props 
bootstrap<span class="token punctuation">.</span>servers<span class="token operator">=</span>hadoop102<span class="token operator">:</span><span class="token number">9092</span><span class="token punctuation">,</span>hadoop103<span class="token operator">:</span><span class="token number">9092</span><span class="token punctuation">,</span>hadoop104<span class="token operator">:</span><span class="token number">9092</span> 
batch<span class="token punctuation">.</span>size<span class="token operator">=</span><span class="token number">4096</span> linger<span class="token punctuation">.</span>ms<span class="token operator">=</span><span class="token number">50</span> compression<span class="token punctuation">.</span>type<span class="token operator">=</span>zstd
</code></pre> 
<p>输出结果：</p> 
<pre><code class="prism language-java"><span class="token number">23820</span> records sent<span class="token punctuation">,</span> <span class="token number">4763.0</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">4.65</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1580.2</span> ms avg latency<span class="token punctuation">,</span> 
<span class="token number">2651.0</span> ms max latency<span class="token punctuation">.</span>
<span class="token number">29340</span> records sent<span class="token punctuation">,</span> <span class="token number">5868.0</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">5.73</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3666.0</span> ms avg latency<span class="token punctuation">,</span> 
<span class="token number">4752.0</span> ms max latency<span class="token punctuation">.</span>
<span class="token number">28950</span> records sent<span class="token punctuation">,</span> <span class="token number">5788.8</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">5.65</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5785.2</span> ms avg latency<span class="token punctuation">,</span> 
<span class="token number">6865.0</span> ms max latency<span class="token punctuation">.</span>
。。。 。。。
<span class="token number">29580</span> records sent<span class="token punctuation">,</span> <span class="token number">5916.0</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">5.78</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">6907.6</span> ms avg latency<span class="token punctuation">,</span> 
<span class="token number">7432.0</span> ms max latency<span class="token punctuation">.</span>
<span class="token number">29925</span> records sent<span class="token punctuation">,</span> <span class="token number">5981.4</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">5.84</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">6948.9</span> ms avg latency<span class="token punctuation">,</span> 
<span class="token number">7541.0</span> ms max latency<span class="token punctuation">.</span>
<span class="token number">1000000</span> records sent<span class="token punctuation">,</span> <span class="token number">5733.583318</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">5.60</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">6824.75</span> ms 
avg latency<span class="token punctuation">,</span> <span class="token number">7595.00</span> ms max latency<span class="token punctuation">,</span> <span class="token number">7067</span> ms <span class="token number">50</span>th<span class="token punctuation">,</span> <span class="token number">7400</span> ms <span class="token number">95</span>th<span class="token punctuation">,</span> <span class="token number">7500</span> ms 
<span class="token number">99</span>th<span class="token punctuation">,</span> <span class="token number">7552</span> ms <span class="token number">99.9</span>th<span class="token punctuation">.</span>
</code></pre> 
<p>③默认的压缩方式是 none。本次实验 compression.type 设置为 gzip。</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span>atguigu<span class="token annotation punctuation">@hadoop105</span> kafka<span class="token punctuation">]</span>$ bin<span class="token operator">/</span>kafka<span class="token operator">-</span>producer<span class="token operator">-</span>perf<span class="token operator">-</span>test<span class="token punctuation">.</span>sh <span class="token operator">--</span>
topic test <span class="token operator">--</span><span class="token keyword">record</span><span class="token operator">-</span>size <span class="token number">1024</span> <span class="token operator">--</span>num<span class="token operator">-</span>records <span class="token number">1000000</span> <span class="token operator">--</span>throughput 
<span class="token number">10000</span> <span class="token operator">--</span>producer<span class="token operator">-</span>props 
bootstrap<span class="token punctuation">.</span>servers<span class="token operator">=</span>hadoop102<span class="token operator">:</span><span class="token number">9092</span><span class="token punctuation">,</span>hadoop103<span class="token operator">:</span><span class="token number">9092</span><span class="token punctuation">,</span>hadoop104<span class="token operator">:</span><span class="token number">9092</span> 
batch<span class="token punctuation">.</span>size<span class="token operator">=</span><span class="token number">4096</span> linger<span class="token punctuation">.</span>ms<span class="token operator">=</span><span class="token number">50</span> compression<span class="token punctuation">.</span>type<span class="token operator">=</span>gzip
</code></pre> 
<p>输出结果：</p> 
<pre><code class="prism language-java"><span class="token number">27170</span> records sent<span class="token punctuation">,</span> <span class="token number">5428.6</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">5.30</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1374.0</span> ms avg latency<span class="token punctuation">,</span> 
<span class="token number">2311.0</span> ms max latency<span class="token punctuation">.</span>
<span class="token number">31050</span> records sent<span class="token punctuation">,</span> <span class="token number">6210.0</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">6.06</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3183.8</span> ms avg latency<span class="token punctuation">,</span> 
<span class="token number">4228.0</span> ms max latency<span class="token punctuation">.</span>
<span class="token number">32145</span> records sent<span class="token punctuation">,</span> <span class="token number">6427.7</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">6.28</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5028.1</span> ms avg latency<span class="token punctuation">,</span> 
<span class="token number">6042.0</span> ms max latency<span class="token punctuation">.</span>
。。。 。。。
<span class="token number">31710</span> records sent<span class="token punctuation">,</span> <span class="token number">6342.0</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">6.19</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">6457.1</span> ms avg latency<span class="token punctuation">,</span> 
<span class="token number">6777.0</span> ms max latency<span class="token punctuation">.</span>
<span class="token number">31755</span> records sent<span class="token punctuation">,</span> <span class="token number">6348.5</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">6.20</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">6498.7</span> ms avg latency<span class="token punctuation">,</span> 
<span class="token number">6780.0</span> ms max latency<span class="token punctuation">.</span>
<span class="token number">32760</span> records sent<span class="token punctuation">,</span> <span class="token number">6548.1</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">6.39</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">6375.7</span> ms avg latency<span class="token punctuation">,</span> 
<span class="token number">6822.0</span> ms max latency<span class="token punctuation">.</span>
<span class="token number">1000000</span> records sent<span class="token punctuation">,</span> <span class="token number">6320.153706</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">6.17</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">6155.42</span> ms 
avg latency<span class="token punctuation">,</span> <span class="token number">6943.00</span> ms max latency<span class="token punctuation">,</span> <span class="token number">6437</span> ms <span class="token number">50</span>th<span class="token punctuation">,</span> <span class="token number">6774</span> ms <span class="token number">95</span>th<span class="token punctuation">,</span> <span class="token number">6863</span> ms 
<span class="token number">99</span>th<span class="token punctuation">,</span> <span class="token number">6912</span> ms <span class="token number">99.9</span>th<span class="token punctuation">.</span>
</code></pre> 
<p>④默认的压缩方式是 none。本次实验 compression.type 设置为 lz4。</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span>atguigu<span class="token annotation punctuation">@hadoop105</span> kafka<span class="token punctuation">]</span>$ bin<span class="token operator">/</span>kafka<span class="token operator">-</span>producer<span class="token operator">-</span>perf<span class="token operator">-</span>test<span class="token punctuation">.</span>sh <span class="token operator">--</span>
topic test <span class="token operator">--</span><span class="token keyword">record</span><span class="token operator">-</span>size <span class="token number">1024</span> <span class="token operator">--</span>num<span class="token operator">-</span>records <span class="token number">1000000</span> <span class="token operator">--</span>throughput 
<span class="token number">10000</span> <span class="token operator">--</span>producer<span class="token operator">-</span>props 
bootstrap<span class="token punctuation">.</span>servers<span class="token operator">=</span>hadoop102<span class="token operator">:</span><span class="token number">9092</span><span class="token punctuation">,</span>hadoop103<span class="token operator">:</span><span class="token number">9092</span><span class="token punctuation">,</span>hadoop104<span class="token operator">:</span><span class="token number">9092</span> 
batch<span class="token punctuation">.</span>size<span class="token operator">=</span><span class="token number">4096</span> linger<span class="token punctuation">.</span>ms<span class="token operator">=</span><span class="token number">50</span> compression<span class="token punctuation">.</span>type<span class="token operator">=</span>lz4
</code></pre> 
<p>输出结果：</p> 
<pre><code class="prism language-java"><span class="token number">16696</span> records sent<span class="token punctuation">,</span> <span class="token number">3339.2</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">3.26</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1924.5</span> ms avg latency<span class="token punctuation">,</span> 
<span class="token number">3355.0</span> ms max latency<span class="token punctuation">.</span>
<span class="token number">19647</span> records sent<span class="token punctuation">,</span> <span class="token number">3928.6</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">3.84</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4841.5</span> ms avg latency<span class="token punctuation">,</span> 
<span class="token number">6320.0</span> ms max latency<span class="token punctuation">.</span>
<span class="token number">20142</span> records sent<span class="token punctuation">,</span> <span class="token number">4028.4</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">3.93</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">6203.2</span> ms avg latency<span class="token punctuation">,</span> 
<span class="token number">6378.0</span> ms max latency<span class="token punctuation">.</span>
。。。 。。。
<span class="token number">20130</span> records sent<span class="token punctuation">,</span> <span class="token number">4024.4</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">3.93</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">6073.6</span> ms avg latency<span class="token punctuation">,</span> 
<span class="token number">6396.0</span> ms max latency<span class="token punctuation">.</span>
<span class="token number">19449</span> records sent<span class="token punctuation">,</span> <span class="token number">3889.8</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">3.80</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">6195.6</span> ms avg latency<span class="token punctuation">,</span> 
<span class="token number">6500.0</span> ms max latency<span class="token punctuation">.</span>
<span class="token number">19872</span> records sent<span class="token punctuation">,</span> <span class="token number">3972.8</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">3.88</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">6274.5</span> ms avg latency<span class="token punctuation">,</span> 
<span class="token number">6565.0</span> ms max latency<span class="token punctuation">.</span>
<span class="token number">1000000</span> records sent<span class="token punctuation">,</span> <span class="token number">3956.087430</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">3.86</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">6085.62</span> ms 
avg latency<span class="token punctuation">,</span> <span class="token number">6745.00</span> ms max latency<span class="token punctuation">,</span> <span class="token number">6212</span> ms <span class="token number">50</span>th<span class="token punctuation">,</span> <span class="token number">6524</span> ms <span class="token number">95</span>th<span class="token punctuation">,</span> <span class="token number">6610</span> ms 
<span class="token number">99</span>th<span class="token punctuation">,</span> <span class="token number">6695</span> ms <span class="token number">99.9</span>th<span class="token punctuation">.</span>
</code></pre> 
<p>（6）调整缓存大小<br> 默认生产者端缓存大小 32m。本次实验 buffer.memory 设置为 64m。</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span>atguigu<span class="token annotation punctuation">@hadoop105</span> kafka<span class="token punctuation">]</span>$ bin<span class="token operator">/</span>kafka<span class="token operator">-</span>producer<span class="token operator">-</span>perf<span class="token operator">-</span>test<span class="token punctuation">.</span>sh <span class="token operator">--</span>
topic test <span class="token operator">--</span><span class="token keyword">record</span><span class="token operator">-</span>size <span class="token number">1024</span> <span class="token operator">--</span>num<span class="token operator">-</span>records <span class="token number">1000000</span> <span class="token operator">--</span>throughput 
<span class="token number">10000</span> <span class="token operator">--</span>producer<span class="token operator">-</span>props 
bootstrap<span class="token punctuation">.</span>servers<span class="token operator">=</span>hadoop102<span class="token operator">:</span><span class="token number">9092</span><span class="token punctuation">,</span>hadoop103<span class="token operator">:</span><span class="token number">9092</span><span class="token punctuation">,</span>hadoop104<span class="token operator">:</span><span class="token number">9092</span> 
batch<span class="token punctuation">.</span>size<span class="token operator">=</span><span class="token number">4096</span> linger<span class="token punctuation">.</span>ms<span class="token operator">=</span><span class="token number">50</span> buffer<span class="token punctuation">.</span>memory<span class="token operator">=</span><span class="token number">67108864</span>
</code></pre> 
<p>输出结果：</p> 
<pre><code class="prism language-java"><span class="token number">20170</span> records sent<span class="token punctuation">,</span> <span class="token number">4034.0</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">3.94</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1669.5</span> ms avg latency<span class="token punctuation">,</span> 
<span class="token number">3040.0</span> ms max latency<span class="token punctuation">.</span>
<span class="token number">21996</span> records sent<span class="token punctuation">,</span> <span class="token number">4399.2</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">4.30</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4407.9</span> ms avg latency<span class="token punctuation">,</span> 
<span class="token number">5806.0</span> ms max latency<span class="token punctuation">.</span>
<span class="token number">22113</span> records sent<span class="token punctuation">,</span> <span class="token number">4422.6</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">4.32</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">7189.0</span> ms avg latency<span class="token punctuation">,</span> 
<span class="token number">8623.0</span> ms max latency<span class="token punctuation">.</span>
。。。 。。。
<span class="token number">19818</span> records sent<span class="token punctuation">,</span> <span class="token number">3963.6</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">3.87</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">12416.0</span> ms avg 
latency<span class="token punctuation">,</span> <span class="token number">12847.0</span> ms max latency<span class="token punctuation">.</span>
<span class="token number">20331</span> records sent<span class="token punctuation">,</span> <span class="token number">4062.9</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">3.97</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">12400.4</span> ms avg 
latency<span class="token punctuation">,</span> <span class="token number">12874.0</span> ms max latency<span class="token punctuation">.</span>
<span class="token number">19665</span> records sent<span class="token punctuation">,</span> <span class="token number">3933.0</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">3.84</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">12303.9</span> ms avg 
latency<span class="token punctuation">,</span> <span class="token number">12838.0</span> ms max latency<span class="token punctuation">.</span>
<span class="token number">1000000</span> records sent<span class="token punctuation">,</span> <span class="token number">4020.100503</span> records<span class="token operator">/</span>sec <span class="token punctuation">(</span><span class="token number">3.93</span> MB<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">11692.17</span> ms 
avg latency<span class="token punctuation">,</span> <span class="token number">13796.00</span> ms max latency<span class="token punctuation">,</span> <span class="token number">12238</span> ms <span class="token number">50</span>th<span class="token punctuation">,</span> <span class="token number">12949</span> ms <span class="token number">95</span>th<span class="token punctuation">,</span> <span class="token number">13691</span> 
ms <span class="token number">99</span>th<span class="token punctuation">,</span> <span class="token number">13766</span> ms <span class="token number">99.9</span>th<span class="token punctuation">.</span>
</code></pre> 
<h4><a id="3Kafka_Consumer__795"></a>3）Kafka Consumer 压力测试</h4> 
<p>（1）修改/opt/module/kafka/config/consumer.properties 文件中的一次拉取条数为 500max.poll.records=500<br> （2）消费 100 万条日志进行压测</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span>atguigu<span class="token annotation punctuation">@hadoop105</span> kafka<span class="token punctuation">]</span>$ bin<span class="token operator">/</span>kafka<span class="token operator">-</span>consumer<span class="token operator">-</span>perf<span class="token operator">-</span>test<span class="token punctuation">.</span>sh <span class="token operator">--</span>
bootstrap<span class="token operator">-</span>server hadoop102<span class="token operator">:</span><span class="token number">9092</span><span class="token punctuation">,</span>hadoop103<span class="token operator">:</span><span class="token number">9092</span><span class="token punctuation">,</span>hadoop104<span class="token operator">:</span><span class="token number">9092</span> <span class="token operator">-</span>
<span class="token operator">-</span>topic test <span class="token operator">--</span>messages <span class="token number">1000000</span> <span class="token operator">--</span>consumer<span class="token punctuation">.</span>config 
config<span class="token operator">/</span>consumer<span class="token punctuation">.</span>properties
</code></pre> 
<p>参数说明：<br> <code> --bootstrap-server</code> 指定 Kafka 集群地址<br> <code> --topic</code> 指定 topic 的名称<br> <code>--messages</code> 总共要消费的消息个数。本次实验 100 万条。</p> 
<p>输出结果：</p> 
<pre><code class="prism language-java">start<span class="token punctuation">.</span>time<span class="token punctuation">,</span> end<span class="token punctuation">.</span>time<span class="token punctuation">,</span> data<span class="token punctuation">.</span>consumed<span class="token punctuation">.</span>in<span class="token punctuation">.</span>MB<span class="token punctuation">,</span> MB<span class="token punctuation">.</span>sec<span class="token punctuation">,</span> data<span class="token punctuation">.</span>consumed<span class="token punctuation">.</span>in<span class="token punctuation">.</span>nMsg<span class="token punctuation">,</span> 
nMsg<span class="token punctuation">.</span>sec<span class="token punctuation">,</span> rebalance<span class="token punctuation">.</span>time<span class="token punctuation">.</span>ms<span class="token punctuation">,</span> fetch<span class="token punctuation">.</span>time<span class="token punctuation">.</span>ms<span class="token punctuation">,</span> fetch<span class="token punctuation">.</span>MB<span class="token punctuation">.</span>sec<span class="token punctuation">,</span> fetch<span class="token punctuation">.</span>nMsg<span class="token punctuation">.</span>sec
<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">20</span> <span class="token number">09</span><span class="token operator">:</span><span class="token number">58</span><span class="token operator">:</span><span class="token number">26</span><span class="token operator">:</span><span class="token number">171</span><span class="token punctuation">,</span> <span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">20</span> <span class="token number">09</span><span class="token operator">:</span><span class="token number">58</span><span class="token operator">:</span><span class="token number">33</span><span class="token operator">:</span><span class="token number">321</span><span class="token punctuation">,</span> <span class="token number">977.0166</span><span class="token punctuation">,</span> <span class="token number">136.6457</span><span class="token punctuation">,</span> 
<span class="token number">1000465</span><span class="token punctuation">,</span> <span class="token number">139925.1748</span><span class="token punctuation">,</span> <span class="token number">415</span><span class="token punctuation">,</span> <span class="token number">6735</span><span class="token punctuation">,</span> <span class="token number">145.0656</span><span class="token punctuation">,</span> <span class="token number">148547.1418</span>
</code></pre> 
<p>（3）一次拉取条数为 2000<br> ①修改/opt/module/kafka/config/consumer.properties 文件中的一次拉取条数为 2000</p> 
<pre><code class="prism language-java">max<span class="token punctuation">.</span>poll<span class="token punctuation">.</span>records<span class="token operator">=</span><span class="token number">2000</span>
</code></pre> 
<p>②再次执行</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span>atguigu<span class="token annotation punctuation">@hadoop105</span> kafka<span class="token punctuation">]</span>$ bin<span class="token operator">/</span>kafka<span class="token operator">-</span>consumer<span class="token operator">-</span>perf<span class="token operator">-</span>test<span class="token punctuation">.</span>sh <span class="token operator">--</span>
broker<span class="token operator">-</span>list hadoop102<span class="token operator">:</span><span class="token number">9092</span><span class="token punctuation">,</span>hadoop103<span class="token operator">:</span><span class="token number">9092</span><span class="token punctuation">,</span>hadoop104<span class="token operator">:</span><span class="token number">9092</span> <span class="token operator">--</span>
topic test <span class="token operator">--</span>messages <span class="token number">1000000</span> <span class="token operator">--</span>consumer<span class="token punctuation">.</span>config 
config<span class="token operator">/</span>consumer<span class="token punctuation">.</span>properties
</code></pre> 
<p>输出结果：</p> 
<pre><code class="prism language-java">start<span class="token punctuation">.</span>time<span class="token punctuation">,</span> end<span class="token punctuation">.</span>time<span class="token punctuation">,</span> data<span class="token punctuation">.</span>consumed<span class="token punctuation">.</span>in<span class="token punctuation">.</span>MB<span class="token punctuation">,</span> MB<span class="token punctuation">.</span>sec<span class="token punctuation">,</span> data<span class="token punctuation">.</span>consumed<span class="token punctuation">.</span>in<span class="token punctuation">.</span>nMsg<span class="token punctuation">,</span> 
nMsg<span class="token punctuation">.</span>sec<span class="token punctuation">,</span> rebalance<span class="token punctuation">.</span>time<span class="token punctuation">.</span>ms<span class="token punctuation">,</span> fetch<span class="token punctuation">.</span>time<span class="token punctuation">.</span>ms<span class="token punctuation">,</span> fetch<span class="token punctuation">.</span>MB<span class="token punctuation">.</span>sec<span class="token punctuation">,</span> fetch<span class="token punctuation">.</span>nMsg<span class="token punctuation">.</span>sec
<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">20</span> <span class="token number">10</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">06</span><span class="token operator">:</span><span class="token number">268</span><span class="token punctuation">,</span> <span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">20</span> <span class="token number">10</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">12</span><span class="token operator">:</span><span class="token number">863</span><span class="token punctuation">,</span> <span class="token number">977.5146</span><span class="token punctuation">,</span> <span class="token number">148.2206</span><span class="token punctuation">,</span> 
<span class="token number">1000975</span><span class="token punctuation">,</span> <span class="token number">151777.8620</span><span class="token punctuation">,</span> <span class="token number">358</span><span class="token punctuation">,</span> <span class="token number">6237</span><span class="token punctuation">,</span> <span class="token number">156.7283</span><span class="token punctuation">,</span> <span class="token number">160489.8188</span>
</code></pre> 
<p><strong>（4）调整 fetch.max.bytes 大小为 100m</strong><br> ①修改/opt/module/kafka/config/consumer.properties 文件中的拉取一批数据大小 100m</p> 
<pre><code class="prism language-java">fetch<span class="token punctuation">.</span>max<span class="token punctuation">.</span>bytes<span class="token operator">=</span><span class="token number">104857600</span>
</code></pre> 
<p>②再次执行</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span>atguigu<span class="token annotation punctuation">@hadoop105</span> kafka<span class="token punctuation">]</span>$ bin<span class="token operator">/</span>kafka<span class="token operator">-</span>consumer<span class="token operator">-</span>perf<span class="token operator">-</span>test<span class="token punctuation">.</span>sh <span class="token operator">--</span>
broker<span class="token operator">-</span>list hadoop102<span class="token operator">:</span><span class="token number">9092</span><span class="token punctuation">,</span>hadoop103<span class="token operator">:</span><span class="token number">9092</span><span class="token punctuation">,</span>hadoop104<span class="token operator">:</span><span class="token number">9092</span> <span class="token operator">--</span>
topic test <span class="token operator">--</span>messages <span class="token number">1000000</span> <span class="token operator">--</span>consumer<span class="token punctuation">.</span>config 
config<span class="token operator">/</span>consumer<span class="token punctuation">.</span>properties
</code></pre> 
<p>输出结果：</p> 
<pre><code class="prism language-java">start<span class="token punctuation">.</span>time<span class="token punctuation">,</span> end<span class="token punctuation">.</span>time<span class="token punctuation">,</span> data<span class="token punctuation">.</span>consumed<span class="token punctuation">.</span>in<span class="token punctuation">.</span>MB<span class="token punctuation">,</span> MB<span class="token punctuation">.</span>sec<span class="token punctuation">,</span> 
data<span class="token punctuation">.</span>consumed<span class="token punctuation">.</span>in<span class="token punctuation">.</span>nMsg<span class="token punctuation">,</span> nMsg<span class="token punctuation">.</span>sec<span class="token punctuation">,</span> rebalance<span class="token punctuation">.</span>time<span class="token punctuation">.</span>ms<span class="token punctuation">,</span> 
fetch<span class="token punctuation">.</span>time<span class="token punctuation">.</span>ms<span class="token punctuation">,</span> fetch<span class="token punctuation">.</span>MB<span class="token punctuation">.</span>sec<span class="token punctuation">,</span> fetch<span class="token punctuation">.</span>nMsg<span class="token punctuation">.</span>sec
<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">20</span> <span class="token number">10</span><span class="token operator">:</span><span class="token number">26</span><span class="token operator">:</span><span class="token number">13</span><span class="token operator">:</span><span class="token number">203</span><span class="token punctuation">,</span> <span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">20</span> <span class="token number">10</span><span class="token operator">:</span><span class="token number">26</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">662</span><span class="token punctuation">,</span> <span class="token number">977.5146</span><span class="token punctuation">,</span> 
<span class="token number">151.3415</span><span class="token punctuation">,</span> <span class="token number">1000975</span><span class="token punctuation">,</span> <span class="token number">154973.6801</span><span class="token punctuation">,</span> <span class="token number">362</span><span class="token punctuation">,</span> <span class="token number">6097</span><span class="token punctuation">,</span> <span class="token number">160.3272</span><span class="token punctuation">,</span> <span class="token number">164175.004</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e61adee47e2958ec9c49e55cdc8e169b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">SkeyeARS 全景AR增强监视系统之cuda(cuvid)视频硬解码</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b1fb47efacee5d337150a7370f939a15/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">34个数据库练习题 带你打开思路</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>