<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>chatglm docker镜像，一键部署chatglm本地知识库 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="chatglm docker镜像，一键部署chatglm本地知识库" />
<meta property="og:description" content="好久没有写文章了，今天有空，记录一下chatglm本地知识库的docker镜像制作过程。
核心程序是基于“闻达”开源项目，稍作改动。镜像可以直接启动运行，大家感兴趣可以进入镜像内部查看，代码位于 /app 目录下。
一、制作镜像： docker tag chatglm:v1 ch1949/chatglm:latest docker push ch1949/chatglm:latest 1) Tag 这里注意： tag的名字斜线前面部分ch1949需要是本人docker的用户名，才能push成功。
本人的docker用户名，可以进入docker hub网站查看。
2) 通用化总结一下： 上传自己的镜像到 Docker Hub 上可以分为以下几个步骤：
注册 Docker Hub 账号并登录。在 Docker Hub 的官方网站上注册账号后，使用 docker login 命令登录到 Docker Hub。
$ docker login 构建 Docker 镜像。在本地使用 Dockerfile 构建出需要上传的镜像，
FROM python:3.9 WORKDIR /app COPY . /app RUN pip install -r requirements.txt CMD [&#34;python&#34;, &#34;app.py&#34;] 通过 docker build 命令进行构建。
$ docker build -t myusername/myapp:1.0 . 给镜像打标签。使用 docker tag 命令给构建出的镜像打上标签，格式为 &lt;用户名&gt;/&lt;镜像名&gt;:&lt;标签&gt;，其中 &lt;用户名&gt; 是在 Docker Hub 上注册的用户名，&lt;镜像名&gt; 是自己给镜像起的名字，&lt;标签&gt; 是版本号或者其他标识符。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/74f22b7f73aceb83d329ad4fd3ec4e92/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-05T11:33:50+08:00" />
<meta property="article:modified_time" content="2023-07-05T11:33:50+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">chatglm docker镜像，一键部署chatglm本地知识库</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>好久没有写文章了，今天有空，记录一下chatglm本地知识库的docker镜像制作过程。</p> 
<p>核心程序是基于“闻达”开源项目，稍作改动。镜像可以直接启动运行，大家感兴趣可以进入镜像内部查看，代码位于 /app 目录下。</p> 
<p></p> 
<h2>一、制作镜像：</h2> 
<pre><code>docker tag chatglm:v1 ch1949/chatglm:latest
docker push ch1949/chatglm:latest</code></pre> 
<h3>1) Tag 这里注意：</h3> 
<p>tag的名字斜线前面部分ch1949需要是本人docker的用户名，才能push成功。</p> 
<p>本人的docker用户名，可以进入docker hub网站查看。</p> 
<p></p> 
<h3>2) 通用化总结一下：</h3> 
<p>上传自己的镜像到 Docker Hub 上可以分为以下几个步骤：</p> 
<ol><li> <p>注册 Docker Hub 账号并登录。在 Docker Hub 的官方网站上注册账号后，使用 <code>docker login</code> 命令登录到 Docker Hub。</p> <pre><code class="language-bash">$ docker login</code></pre> <p></p> </li><li> <p>构建 Docker 镜像。在本地使用 Dockerfile 构建出需要上传的镜像，</p> <pre><code class="language-bash">FROM python:3.9
WORKDIR /app
COPY . /app
RUN pip install -r requirements.txt
CMD ["python", "app.py"]</code></pre> <p>通过 <code>docker build</code> 命令进行构建。</p> <pre><code class="language-bash">$ docker build -t myusername/myapp:1.0 .</code></pre> <p></p> </li><li> <p>给镜像打标签。使用 <code>docker tag</code> 命令给构建出的镜像打上标签，格式为 <code>&lt;用户名&gt;/&lt;镜像名&gt;:&lt;标签&gt;</code>，其中 <code>&lt;用户名&gt;</code> 是在 Docker Hub 上注册的用户名，<code>&lt;镜像名&gt;</code> 是自己给镜像起的名字，<code>&lt;标签&gt;</code> 是版本号或者其他标识符。</p> <pre><code class="language-bash">$ docker tag myusername/myapp:1.0 myusername/myapp:latest</code></pre> <p></p> </li><li> <p>上传镜像到 Docker Hub。使用 <code>docker push</code> 命令将打好标签的镜像上传到 Docker Hub 上，格式为 <code>docker push &lt;用户名&gt;/&lt;镜像名&gt;:&lt;标签&gt;</code>。</p> <pre><code class="language-bash">$ docker push myusername/myapp:1.0
$ docker push myusername/myapp:latest</code></pre> <p></p> </li></ol> 
<h2>二、使用</h2> 
<h3>1) 拉取镜像</h3> 
<p>（目前书库中只有一本《三国演义》）</p> 
<pre><code>docker pull docker.io/ch1949/chatglm</code></pre> 
<h3>2) 创建容器</h3> 
<pre><code>创建容器
# docker run --gpus all -p 17860:17860 --name chatglm -it ch1949/chatglm:latest

后面可以通过start/stop来开关容器
# docker start chatglm
# docker stop chatglm</code></pre> 
<h4>3) 然后直接浏览器访问  </h4> 
<p>这里记得打开你服务器机器的防火墙17860端口。</p> 
<pre><code>http://你机器的ip地址:17860</code></pre> 
<h3>4) 看下效果</h3> 
<p class="img-center"><img alt="" height="537" src="https://images2.imgbox.com/66/35/IQB9ckZx_o.png" width="428"></p> 
<p></p> 
<h2>三、Dockerfile文件</h2> 
<pre><code>FROM pytorch/pytorch:2.0.1-cuda11.7-cudnn8-runtime
LABEL maintainer="cc &lt;ch1949@126.com&gt;"
WORKDIR /app

RUN conda install cudatoolkit=11.7 -c nvidia -y

COPY / ./

RUN pip install -r requirements.txt

CMD ["python", "main.py"]</code></pre> 
<p>关于dockerfile的一些说明：</p> 
<p>这里有一个坑：pytorch/pytorch:2.0.1-cuda11.7-cudnn8-runtime 镜像里没有 libcudart11.0 libcublaslt11 库，需要单独安装。</p> 
<p><strong>否则会报错：<span style="color:#fe2c24;">Library cudart is not initialized</span></strong></p> 
<p>当然，也可以自行安装：</p> 
<pre><code>conda install cudatoolkit=11.7 -c nvidia -y</code></pre> 
<p>或者通过apt命令，比如在Ubuntu 22.04 下执行如下命令效果一样：</p> 
<pre><code>sudo apt install libcudart11.0 libcublaslt11</code></pre> 
<p></p> 
<p></p> 
<p>（未完待续）</p> 
<p>20230704</p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fc148b335e42ebccda364d6eb5d23e12/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">单元测试使用mybatis从数据库查询信息报错(不适合所有人)org.mybatis.spring.MyBatisSystemException: nested exception is org</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fa51624f7162eb57b6762de5222fd849/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">JAVA如何连接redis以及Springboot整合redis详解</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>