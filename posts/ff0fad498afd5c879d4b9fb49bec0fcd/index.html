<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>uniapp微信小程序投票系统实战 (SpringBoot2&#43;vue3.2&#43;element plus ) -用户投票实现 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="uniapp微信小程序投票系统实战 (SpringBoot2&#43;vue3.2&#43;element plus ) -用户投票实现" />
<meta property="og:description" content="锋哥原创的uniapp微信小程序投票系统实战：
uniapp微信小程序投票系统实战课程 (SpringBoot2&#43;vue3.2&#43;element plus ) ( 火爆连载更新中... )_哔哩哔哩_bilibiliuniapp微信小程序投票系统实战课程 (SpringBoot2&#43;vue3.2&#43;element plus ) ( 火爆连载更新中... )共计21条视频，包括：uniapp微信小程序投票系统实战课程 (SpringBoot2&#43;vue3.2&#43;element plus ) ( 火爆连载更新中... )、第2讲 投票项目后端架构搭建、第3讲 小程序端 TabBar搭建等，UP主更多精彩视频，请关注UP账号。https://www.bilibili.com/video/BV1ea4y137xf/新建用户投票详情表t_vote_detail:
create table `t_vote_detail` ( `id` int (11), `vote_id` int (11), `vote_item_id` int (11), `vote_date` datetime , `openid` varchar (600) ); 新建VoteDetail实体：
package com.java1234.entity; import com.baomidou.mybatisplus.annotation.TableField; import com.baomidou.mybatisplus.annotation.TableName; import com.fasterxml.jackson.databind.annotation.JsonSerialize; import lombok.Data; import java.util.Date; /**投票详情 * @author java1234_小锋 （公众号：java1234） * @site www.java1234.vip * @company 南通小锋网络科技有限公司 */ @TableName(&#34;t_vote_detail&#34;) @Data public class VoteDetail { private Integer id; // 编号 private Integer voteId; // 投票ID private Integer voteItemId; // 投票选项ID private String openid; // 投票人openid @TableField(select=false,exist = false) private WxUserInfo wxUserInfo; @JsonSerialize(using=CustomDateTimeSerializer." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/ff0fad498afd5c879d4b9fb49bec0fcd/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-11T09:30:13+08:00" />
<meta property="article:modified_time" content="2024-01-11T09:30:13+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">uniapp微信小程序投票系统实战 (SpringBoot2&#43;vue3.2&#43;element plus ) -用户投票实现</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>锋哥原创的uniapp微信小程序投票系统实战：</p> 
<p><a class="has-card" href="https://www.bilibili.com/video/BV1ea4y137xf/" rel="nofollow" title="uniapp微信小程序投票系统实战课程 (SpringBoot2+vue3.2+element plus ) ( 火爆连载更新中... )_哔哩哔哩_bilibili"><span class="link-card-box"><span class="link-title">uniapp微信小程序投票系统实战课程 (SpringBoot2+vue3.2+element plus ) ( 火爆连载更新中... )_哔哩哔哩_bilibili</span><span class="link-desc">uniapp微信小程序投票系统实战课程 (SpringBoot2+vue3.2+element plus ) ( 火爆连载更新中... )共计21条视频，包括：uniapp微信小程序投票系统实战课程 (SpringBoot2+vue3.2+element plus ) ( 火爆连载更新中... )、第2讲 投票项目后端架构搭建、第3讲 小程序端 TabBar搭建等，UP主更多精彩视频，请关注UP账号。</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/47/9e/7gb1gtAI_o.png" alt="icon-default.png?t=N7T8">https://www.bilibili.com/video/BV1ea4y137xf/</span></span></a>新建用户投票详情表t_vote_detail:</p> 
<pre><code class="language-sql">create table `t_vote_detail` (
	`id` int (11),
	`vote_id` int (11),
	`vote_item_id` int (11),
	`vote_date` datetime ,
	`openid` varchar (600)
); </code></pre> 
<p>新建VoteDetail实体：</p> 
<pre><code class="language-java">package com.java1234.entity;

import com.baomidou.mybatisplus.annotation.TableField;
import com.baomidou.mybatisplus.annotation.TableName;
import com.fasterxml.jackson.databind.annotation.JsonSerialize;
import lombok.Data;

import java.util.Date;

/**投票详情
 * @author java1234_小锋 （公众号：java1234）
 * @site www.java1234.vip
 * @company 南通小锋网络科技有限公司
 */
@TableName("t_vote_detail")
@Data
public class VoteDetail {

    private Integer id; // 编号

    private Integer voteId; // 投票ID

    private Integer voteItemId; // 投票选项ID

    private String openid; // 投票人openid

    @TableField(select=false,exist = false)
    private WxUserInfo wxUserInfo;

    @JsonSerialize(using=CustomDateTimeSerializer.class)
    private Date voteDate;  // 投票时间

}
</code></pre> 
<p>新建VoteDetailMapper</p> 
<pre><code class="language-java">package com.java1234.mapper;

import com.baomidou.mybatisplus.core.mapper.BaseMapper;
import com.java1234.entity.VoteDetail;

/**
 * 投票详情Mapper接口
 * @author java1234_小锋
 * @site www.java1234.com
 * @company 南通小锋网络科技有限公司
 * @create 2022-02-23 22:00
 */
public interface VoteDetailMapper extends BaseMapper&lt;VoteDetail&gt;{


}</code></pre> 
<p>新建IVoteDetailService</p> 
<pre><code class="language-java">package com.java1234.service;

import com.baomidou.mybatisplus.extension.service.IService;
import com.java1234.entity.VoteDetail;

/**
 * 投票详情Service接口
 * @author java1234_小锋
 * @site www.java1234.com
 * @company 南通小锋网络科技有限公司
 * @create 2022-02-23 22:01
 */
public interface IVoteDetailService extends IService&lt;VoteDetail&gt; {
}</code></pre> 
<p>新建IVoteDetailServiceImpl</p> 
<pre><code class="language-java">package com.java1234.service.impl;

import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;
import com.java1234.entity.VoteDetail;
import com.java1234.mapper.VoteDetailMapper;
import com.java1234.service.IVoteDetailService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

/**
 * 投票详情Service实现类
 * @author java1234_小锋
 * @site www.java1234.com
 * @company 南通小锋网络科技有限公司
 * @create 2022-02-23 22:02
 */
@Service("voteDetailService")
public class IVoteDetailServiceImpl extends ServiceImpl&lt;VoteDetailMapper, VoteDetail&gt; implements IVoteDetailService {

    @Autowired
    private VoteDetailMapper voteDetailMapper;
}</code></pre> 
<p>新建VoteDetailController</p> 
<pre><code class="language-java">package com.java1234.controller;

import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;
import com.baomidou.mybatisplus.core.conditions.update.UpdateWrapper;
import com.java1234.entity.R;
import com.java1234.entity.VoteDetail;
import com.java1234.entity.VoteItem;
import com.java1234.service.IVoteDetailService;
import com.java1234.service.IVoteItemService;
import com.java1234.util.JwtUtils;
import io.jsonwebtoken.Claims;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.transaction.annotation.Transactional;
import org.springframework.web.bind.annotation.*;

import java.util.Date;
import java.util.HashMap;
import java.util.Map;

/**
 * 投票详情Controller控制器
 * @author java1234_小锋 （公众号：java1234）
 * @site www.java1234.vip
 * @company 南通小锋网络科技有限公司
 */
@RestController
@RequestMapping("/voteDetail")
public class VoteDetailController {

    @Autowired
    private IVoteDetailService voteDetailService;

    @Autowired
    private IVoteItemService voteItemService;



    /**
     * 添加投票
     * @param voteDetail
     * @param token
     * @return
     */
    @RequestMapping("/add")
    @Transactional
    public R add(@RequestBody VoteDetail voteDetail, @RequestHeader String token){
        System.out.println("token="+token);
        Claims claims = JwtUtils.validateJWT(token).getClaims();
        System.out.println("openid="+claims.getId());
        String openid=claims.getId();
        int count = voteDetailService.count(new QueryWrapper&lt;VoteDetail&gt;().eq("openid", openid).eq("vote_id", voteDetail.getVoteId()));
        Map&lt;String,Object&gt; resultMap=new HashMap&lt;&gt;();
        if(count&gt;0){
            resultMap.put("info","您已经投票过，不能重复投票！");
        }else {
            resultMap.put("info", "投票成功！");
            voteDetail.setOpenid(openid);
            voteDetail.setVoteDate(new Date());
            // 对指定投票项的number+1操作
            VoteItem voteItem=new VoteItem();
            voteItem.setId(voteDetail.getVoteItemId());

            voteItemService.update(new UpdateWrapper&lt;VoteItem&gt;().setSql("number=number+1").eq("id",voteDetail.getVoteItemId()));
            voteDetailService.save(voteDetail);
        }
        return R.ok(resultMap);
    }



}</code></pre> 
<p>前端投票提交：</p> 
<pre><code class="language-java">submitVote:async function(e){
				let form={
					voteItemId:this.sItem,
					voteId:this.vote.id
				}
				const result=await requestUtil({url:"/voteDetail/add",data:form,method:"post"});
				if(result.code==0){
					uni.showToast({
						icon:"success",
						title:result.info
					})
				}
			}</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0927387be32cf121328aa713a180c009/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Memory Controller Unit (MCU)内存控制器介绍</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/07be12141a12827872f55e11e41fab8f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Android Gradle Plugin、Gradle、Android Studio版本关系</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>