<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>20240107 SQL基础50题打卡 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="20240107 SQL基础50题打卡" />
<meta property="og:description" content="20240107 SQL基础50题打卡 1978. 上级经理已离职的公司员工 表: Employees
&#43;-------------&#43;----------&#43; | Column Name | Type | &#43;-------------&#43;----------&#43; | employee_id | int | | name | varchar | | manager_id | int | | salary | int | &#43;-------------&#43;----------&#43; 在 SQL 中，employee_id 是这个表的主键。 这个表包含了员工，他们的薪水和上级经理的id。 有一些员工没有上级经理（其 manager_id 是空值）。 查找这些员工的id，他们的薪水严格少于$30000 并且他们的上级经理已离职。当一个经理离开公司时，他们的信息需要从员工表中删除掉，但是表中的员工的manager_id 这一列还是设置的离职经理的id 。
返回的结果按照employee_id 从小到大排序。
查询结果如下所示：
示例：
输入： Employees table: &#43;-------------&#43;-----------&#43;------------&#43;--------&#43; | employee_id | name | manager_id | salary | &#43;-------------&#43;-----------&#43;------------&#43;--------&#43; | 3 | Mila | 9 | 60301 | | 12 | Antonella | null | 31000 | | 13 | Emery | null | 67084 | | 1 | Kalel | 11 | 21241 | | 9 | Mikaela | null | 50937 | | 11 | Joziah | 6 | 28485 | &#43;-------------&#43;-----------&#43;------------&#43;--------&#43; 输出： &#43;-------------&#43; | employee_id | &#43;-------------&#43; | 11 | &#43;-------------&#43; 解释： 薪水少于 30000 美元的员工有 1 号(Kalel) 和 11号 (Joziah)。 Kalel 的上级经理是 11 号员工，他还在公司上班(他是 Joziah )。 Joziah 的上级经理是 6 号员工，他已经离职，因为员工表里面已经没有 6 号员工的信息了，它被删除了。 题解： # Write your MySQL query statement below select employee_id from Employees where manager_id not in (select employee_id from Employees) and salary &lt; 30000 order by employee_id; 626." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/aff9988c118244e5c9089d7ac33580ed/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-07T14:28:01+08:00" />
<meta property="article:modified_time" content="2024-01-07T14:28:01+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">20240107 SQL基础50题打卡</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="20240107_SQL50_0"></a>20240107 SQL基础50题打卡</h2> 
<h3><a id="1978_httpsleetcodecnproblemsemployeeswhosemanagerleftthecompany_2"></a><a href="https://leetcode.cn/problems/employees-whose-manager-left-the-company/" rel="nofollow">1978. 上级经理已离职的公司员工</a></h3> 
<hr> 
<p>表: <code>Employees</code></p> 
<pre><code>+-------------+----------+
| Column Name | Type     |
+-------------+----------+
| employee_id | int      |
| name        | varchar  |
| manager_id  | int      |
| salary      | int      |
+-------------+----------+
在 SQL 中，employee_id 是这个表的主键。
这个表包含了员工，他们的薪水和上级经理的id。
有一些员工没有上级经理（其 manager_id 是空值）。
</code></pre> 
<p>查找这些员工的id，他们的薪水严格少于<code>$30000</code> 并且他们的上级经理已离职。当一个经理离开公司时，他们的信息需要从员工表中删除掉，但是表中的员工的<code>manager_id</code> 这一列还是设置的离职经理的id 。</p> 
<p>返回的结果按照<code>employee_id </code>从小到大排序。</p> 
<p>查询结果如下所示：</p> 
<p><strong>示例：</strong></p> 
<pre><code>输入：
Employees table:
+-------------+-----------+------------+--------+
| employee_id | name      | manager_id | salary |
+-------------+-----------+------------+--------+
| 3           | Mila      | 9          | 60301  |
| 12          | Antonella | null       | 31000  |
| 13          | Emery     | null       | 67084  |
| 1           | Kalel     | 11         | 21241  |
| 9           | Mikaela   | null       | 50937  |
| 11          | Joziah    | 6          | 28485  |
+-------------+-----------+------------+--------+
输出：
+-------------+
| employee_id |
+-------------+
| 11          |
+-------------+

解释：
薪水少于 30000 美元的员工有 1 号(Kalel) 和 11号 (Joziah)。
Kalel 的上级经理是 11 号员工，他还在公司上班(他是 Joziah )。
Joziah 的上级经理是 6 号员工，他已经离职，因为员工表里面已经没有 6 号员工的信息了，它被删除了。
</code></pre> 
<h4><a id="_62"></a>题解：</h4> 
<pre><code class="prism language-sql"><span class="token comment"># Write your MySQL query statement below</span>
<span class="token keyword">select</span> 
    employee_id 
<span class="token keyword">from</span> Employees
<span class="token keyword">where</span> 
    manager_id <span class="token operator">not</span> <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">select</span> employee_id <span class="token keyword">from</span> Employees<span class="token punctuation">)</span>
    <span class="token operator">and</span> 
    salary <span class="token operator">&lt;</span> <span class="token number">30000</span>
<span class="token keyword">order</span> <span class="token keyword">by</span> employee_id<span class="token punctuation">;</span>
</code></pre> 
<h3><a id="626_httpsleetcodecnproblemsexchangeseats_78"></a><a href="https://leetcode.cn/problems/exchange-seats/" rel="nofollow">626. 换座位</a></h3> 
<hr> 
<p>表: <code>Seat</code></p> 
<pre><code>+-------------+---------+
| Column Name | Type    |
+-------------+---------+
| id          | int     |
| student     | varchar |
+-------------+---------+
id 是该表的主键（唯一值）列。
该表的每一行都表示学生的姓名和 ID。
id 是一个连续的增量。
</code></pre> 
<p>编写解决方案来交换每两个连续的学生的座位号。如果学生的数量是奇数，则最后一个学生的id不交换。</p> 
<p>按 <code>id</code> <strong>升序</strong> 返回结果表。</p> 
<p>查询结果格式如下所示。</p> 
<p><strong>示例 1:</strong></p> 
<pre><code>输入: 
Seat 表:
+----+---------+
| id | student |
+----+---------+
| 1  | Abbot   |
| 2  | Doris   |
| 3  | Emerson |
| 4  | Green   |
| 5  | Jeames  |
+----+---------+
输出: 
+----+---------+
| id | student |
+----+---------+
| 1  | Doris   |
| 2  | Abbot   |
| 3  | Green   |
| 4  | Emerson |
| 5  | Jeames  |
+----+---------+
解释:
请注意，如果学生人数为奇数，则不需要更换最后一名学生的座位。
</code></pre> 
<h4><a id="_134"></a>题解：</h4> 
<pre><code class="prism language-sql"><span class="token comment"># method 1</span>
<span class="token comment"># Write your MySQL query statement below</span>
<span class="token keyword">select</span> id<span class="token punctuation">,</span> <span class="token keyword">if</span><span class="token punctuation">(</span>student2 <span class="token operator">is</span> <span class="token boolean">null</span><span class="token punctuation">,</span>student<span class="token punctuation">,</span>student2<span class="token punctuation">)</span> <span class="token keyword">as</span> student
<span class="token keyword">from</span> <span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token keyword">select</span> 
    s1<span class="token punctuation">.</span>id<span class="token punctuation">,</span>s1<span class="token punctuation">.</span>student<span class="token punctuation">,</span>s2<span class="token punctuation">.</span>id <span class="token keyword">as</span> id2<span class="token punctuation">,</span> s2<span class="token punctuation">.</span>student <span class="token keyword">as</span> student2
    <span class="token keyword">from</span> Seat <span class="token keyword">as</span> s1
    <span class="token keyword">left</span> <span class="token keyword">join</span> Seat <span class="token keyword">as</span> s2
    <span class="token keyword">on</span> s2<span class="token punctuation">.</span>id <span class="token operator">-</span> s1<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">where</span> s1<span class="token punctuation">.</span>id <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> 
    <span class="token keyword">union</span>
    <span class="token punctuation">(</span><span class="token keyword">select</span> 
        s1<span class="token punctuation">.</span>id<span class="token punctuation">,</span>s1<span class="token punctuation">.</span>student<span class="token punctuation">,</span>s2<span class="token punctuation">.</span>id <span class="token keyword">as</span> id2<span class="token punctuation">,</span> s2<span class="token punctuation">.</span>student <span class="token keyword">as</span> student2
    <span class="token keyword">from</span> Seat <span class="token keyword">as</span> s1
    <span class="token keyword">left</span> <span class="token keyword">join</span> Seat <span class="token keyword">as</span> s2
    <span class="token keyword">on</span> s2<span class="token punctuation">.</span>id <span class="token operator">-</span> s1<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token keyword">where</span> s1<span class="token punctuation">.</span>id <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">order</span> <span class="token keyword">by</span> id
<span class="token punctuation">)</span> <span class="token keyword">as</span> result

<span class="token comment"># method 2</span>
<span class="token keyword">SELECT</span>
    <span class="token punctuation">(</span><span class="token keyword">CASE</span>
        <span class="token keyword">WHEN</span> <span class="token function">MOD</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">AND</span> counts <span class="token operator">!=</span> id <span class="token keyword">THEN</span> id <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token keyword">WHEN</span> <span class="token function">MOD</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">AND</span> counts <span class="token operator">=</span> id <span class="token keyword">THEN</span> id
        <span class="token keyword">ELSE</span> id <span class="token operator">-</span> <span class="token number">1</span>
    <span class="token keyword">END</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> id<span class="token punctuation">,</span>
    student
<span class="token keyword">FROM</span>
    seat<span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token keyword">SELECT</span>
        <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> counts
    <span class="token keyword">FROM</span>
        seat<span class="token punctuation">)</span> <span class="token keyword">AS</span> seat_counts
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> id <span class="token keyword">ASC</span><span class="token punctuation">;</span>

<span class="token comment">#method 3</span>
<span class="token keyword">SELECT</span>
    <span class="token operator">*</span>
<span class="token keyword">FROM</span>
    seat s1
        <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span>
    seat s2 <span class="token keyword">ON</span> <span class="token punctuation">(</span>s1<span class="token punctuation">.</span>id<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">^</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">=</span> s2<span class="token punctuation">.</span>id
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> s1<span class="token punctuation">.</span>id<span class="token punctuation">;</span>

</code></pre> 
<h4><a id="_184"></a>知识点：</h4> 
<p>在 MySQL 中，COALESCE 是一种函数，用于返回参数列表中的第一个非 NULL 值。如果参数列表中的所有值都是 NULL，则 COALESCE 返回 NULL。</p> 
<p>COALESCE 函数的语法如下：</p> 
<pre><code class="prism language-sql"><span class="token keyword">COALESCE</span><span class="token punctuation">(</span>value1<span class="token punctuation">,</span> value2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
</code></pre> 
<p>其中，value1、value2 等为要检查的值，可以有多个参数，但至少需要有一个参数。COALESCE 会逐个检查参数，返回第一个非 NULL 的值。</p> 
<p>下面是 COALESCE 函数的使用示例：</p> 
<p>假设有一个包含订单信息的表 orders，其中有两个字段 order_id 和 shipping_date。如果某些订单尚未发货，shipping_date 列可能包含 NULL 值。我们可以使用 COALESCE 函数来提供一个备用日期，以便在 shipping_date 为 NULL 时提供默认值。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> order_id<span class="token punctuation">,</span> <span class="token keyword">COALESCE</span><span class="token punctuation">(</span>shipping_date<span class="token punctuation">,</span> <span class="token string">'2023-12-31'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> actual_shipping_date
<span class="token keyword">FROM</span> orders<span class="token punctuation">;</span>
</code></pre> 
<p>在这个示例中，如果 shipping_date 列中的值为 NULL，COALESCE 函数将返回 ‘2023-12-31’ 作为 actual_shipping_date 的值，否则将返回实际的 shipping_date 值。</p> 
<p>总之，COALESCE 函数在 MySQL 中是一个很有用的工具，可以帮助处理 NULL 值，提供默认值或选择非 NULL 值。</p> 
<h3><a id="1341_httpsleetcodecnproblemsmovierating_213"></a><a href="https://leetcode.cn/problems/movie-rating/" rel="nofollow">1341. 电影评分</a></h3> 
<hr> 
<p>表：<code>Movies</code></p> 
<pre><code>+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| movie_id      | int     |
| title         | varchar |
+---------------+---------+
movie_id 是这个表的主键(具有唯一值的列)。
title 是电影的名字。
</code></pre> 
<p>表：<code>Users</code></p> 
<pre><code>+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| user_id       | int     |
| name          | varchar |
+---------------+---------+
user_id 是表的主键(具有唯一值的列)。
</code></pre> 
<p>表：<code>MovieRating</code></p> 
<pre><code>+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| movie_id      | int     |
| user_id       | int     |
| rating        | int     |
| created_at    | date    |
+---------------+---------+
(movie_id, user_id) 是这个表的主键(具有唯一值的列的组合)。
这个表包含用户在其评论中对电影的评分 rating 。
created_at 是用户的点评日期。 
</code></pre> 
<p>请你编写一个解决方案：</p> 
<ul><li>查找评论电影数量最多的用户名。如果出现平局，返回字典序较小的用户名。</li><li>查找在 <code>February 2020</code> <strong>平均评分最高</strong> 的电影名称。如果出现平局，返回字典序较小的电影名称。</li></ul> 
<p><strong>字典序</strong> ，即按字母在字典中出现顺序对字符串排序，字典序较小则意味着排序靠前。</p> 
<p>返回结果格式如下例所示。</p> 
<p><strong>示例 1：</strong></p> 
<pre><code>输入：
Movies 表：
+-------------+--------------+
| movie_id    |  title       |
+-------------+--------------+
| 1           | Avengers     |
| 2           | Frozen 2     |
| 3           | Joker        |
+-------------+--------------+
Users 表：
+-------------+--------------+
| user_id     |  name        |
+-------------+--------------+
| 1           | Daniel       |
| 2           | Monica       |
| 3           | Maria        |
| 4           | James        |
+-------------+--------------+
MovieRating 表：
+-------------+--------------+--------------+-------------+
| movie_id    | user_id      | rating       | created_at  |
+-------------+--------------+--------------+-------------+
| 1           | 1            | 3            | 2020-01-12  |
| 1           | 2            | 4            | 2020-02-11  |
| 1           | 3            | 2            | 2020-02-12  |
| 1           | 4            | 1            | 2020-01-01  |
| 2           | 1            | 5            | 2020-02-17  | 
| 2           | 2            | 2            | 2020-02-01  | 
| 2           | 3            | 2            | 2020-03-01  |
| 3           | 1            | 3            | 2020-02-22  | 
| 3           | 2            | 4            | 2020-02-25  | 
+-------------+--------------+--------------+-------------+
输出：
Result 表：
+--------------+
| results      |
+--------------+
| Daniel       |
| Frozen 2     |
+--------------+
解释：
Daniel 和 Monica 都点评了 3 部电影（"Avengers", "Frozen 2" 和 "Joker"） 但是 Daniel 字典序比较小。
Frozen 2 和 Joker 在 2 月的评分都是 3.5，但是 Frozen 2 的字典序比较小。
</code></pre> 
<h4><a id="_319"></a>题解：</h4> 
<pre><code class="prism language-sql"><span class="token comment"># Write your MySQL query statement below</span>
<span class="token comment"># 评论电影数量最多且字典序较小的用户名</span>
<span class="token punctuation">(</span>
    <span class="token keyword">select</span> Users<span class="token punctuation">.</span>name <span class="token keyword">as</span> results
    <span class="token keyword">FROM</span> MovieRating
        <span class="token keyword">JOIN</span> Users <span class="token keyword">ON</span> MovieRating<span class="token punctuation">.</span>user_id <span class="token operator">=</span> Users<span class="token punctuation">.</span>user_id
    <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> MovieRating<span class="token punctuation">.</span>user_id
    <span class="token keyword">ORDER</span> <span class="token keyword">BY</span>
        <span class="token function">count</span><span class="token punctuation">(</span>MovieRating<span class="token punctuation">.</span>user_id<span class="token punctuation">)</span> <span class="token keyword">desc</span><span class="token punctuation">,</span>
        Users<span class="token punctuation">.</span>name
    <span class="token keyword">LIMIT</span> <span class="token number">1</span>
<span class="token punctuation">)</span>
<span class="token keyword">UNION</span> <span class="token keyword">all</span> <span class="token punctuation">(</span>
<span class="token comment"># 2020年2月份平均评分最高且字典序较小的电影名</span>
    <span class="token keyword">select</span>
        Movies<span class="token punctuation">.</span>title <span class="token keyword">as</span> results
    <span class="token keyword">FROM</span> MovieRating
        <span class="token keyword">JOIN</span> Movies <span class="token keyword">ON</span> MovieRating<span class="token punctuation">.</span>movie_id <span class="token operator">=</span> Movies<span class="token punctuation">.</span>movie_id
    <span class="token keyword">WHERE</span>
        MovieRating<span class="token punctuation">.</span>created_at <span class="token operator">&gt;=</span> <span class="token string">'2020-02-01'</span>
        <span class="token operator">AND</span> MovieRating<span class="token punctuation">.</span>created_at <span class="token operator">&lt;</span> <span class="token string">'2020-03-01'</span>
    <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> MovieRating<span class="token punctuation">.</span>movie_id
    <span class="token keyword">ORDER</span> <span class="token keyword">BY</span>
        <span class="token function">avg</span><span class="token punctuation">(</span>MovieRating<span class="token punctuation">.</span>rating<span class="token punctuation">)</span> <span class="token keyword">desc</span><span class="token punctuation">,</span>
        Movies<span class="token punctuation">.</span>title
    <span class="token keyword">LIMIT</span> <span class="token number">1</span>
<span class="token punctuation">)</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9785f238a192f015f5e158bd4210d37b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">数据结构之堆——学习笔记</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e6c9e50f07328d0f024cd9dcac66cd52/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【C&#43;&#43;核心编程(四)】</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>