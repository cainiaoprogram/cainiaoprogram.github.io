<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>小H靶场笔记：DC-5 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="小H靶场笔记：DC-5" />
<meta property="og:description" content=" DC-5 January 5, 2024 10:44 AM
Tags：screen提权
Owner：只惠摸鱼
信息收集 探测靶机ip，大概率为192.168.199.135，且开放端口为80和111
扫描端口80，111相关服务、版本、操作系统、漏洞信息
sudo nmap -sS -O -sV 192.168.199.135 --script=vuln 发现有CSRF漏洞和RPCbind， 百度rpcbind后 发现是ddos漏洞，一般不采用 查看80端口的页面，发现有可能有用的就是contact页面，但XSS没反应。
扫一下目录，看有没有其他有用的
发现有一些php页面，大部分是主页里面可见的功能，有一个奇怪的是footer.php 页面刷新或重新进入时，数字会变。
猜想每个页面下方都有copyriht 即footer.php页面的内容，有可能是使用了include()等方式引入需要包含的文件，载入页面，因此有可能有文件包含漏洞。访问其他页面刷新发现不会动，只有thankyou.php页面会变动，从此页面下手。 漏洞利用 bp抓包，然后进行传参使其等于其中任意页面的php（我是用了index.php)，导入Intruder模块准备爆破变量名，找到能够改变页面脚注的变量，从而执行下一步渗透操作。【我的字典是用的别人的英文字母字典，数量还比较大，不是很好用，有大佬有变量名爆破的字典的话跪求分享一下】
根据返回内容的长度，找到传参的变量名是file
使用参数传入/etc/passwd，可以查看用户，/etc/shadow查看用户密码不行，应该是设置了权限
有文件包含漏洞，然后抓包传入一句话木马，一句话木马需要存储在文件才能连接，所以想到nginx的日志进行写入。
访问nginx的日志目录**/var/log/nginx/access.log或/var/log/nginx/error.log**【一开始我始终进不去，怎么搞都没数据，重启靶机后还是一样，发现爆500，搜了搜感觉应该是我爆破时没有设置线程，打崩了nginx服务器，或者扫目录时扫太多了，内容太多错误了。不得以重新安装一遍。0～0】
nginx日志默认字典路径为/var/log/nginx/access.logaccess.log：指的是访问日志，我们通过访问日志可以获取用户的 IP、请求处理的时间、浏览器信息等error.log：错误日志记录了访问出错的信息，可以用于定位错误的原因 写入马后访问error.log，发现马已写入，尝试蚁剑连接（当然也可以访问url写马，然后看access.log即/&lt;?php @eval($_REQUEST[cmd]);?&gt;
蚁剑连接
反弹shell，进行提权操作
第一种不通，使用nc反弹成功 生成交互性shell
python -c &#39;import pty;pty.spawn(“/bin/bash”)’
提权 www-data权限较低，尝试寻找suid文件进行提权
发现有一个screen，搜索一下screen提权
千万不要手动编译，手动复现或分步骤复现，就一次性运行sh脚本文件就好【折磨了我一下午，因为手动复现会出现编译版本问题导致无法执行，从而GLIBC版本报错提权失败。除非你再装一个比较老的版本的系统进行编译，我嫌太麻烦，不如直接run】* searchsploit 搜索screen 4.5提权漏洞
下载到本地，之后拖到桌面备用
通过蚁剑上传到/tmp/文件夹
修改文件权限 chmod 777 41154.sh
直接本地反弹shell处运行脚本，一气呵成拿到root
msf反弹shell也可以
生成后门文件
蚁剑上传
msf模块进行监听
给予权限并运行
拿到后上传脚本，修改文件权限并运行
读取/root目录下的flag。GG！
screen提权 Screen是一款由GNU计划开发的用于命令行终端切换的自由软件。用户可以通过该软件同时连接多个本地或远程的命令行会话，并在其间自由切换。GNU Screen可以看作是窗口管理器的命令行界面版本。它提供了统一的管理多个会话的界面和相应的功能。在Screen环境下，所有的会话都独立的运行，并拥有各自的编号、输入、输出和窗口缓存。用户可以通过快捷键在不同的窗口下切换，并可以自由的重定向各个窗口的输入和输出。一般利用searchsploit搜搜screen中的漏洞，查看相关信息进行利用 " />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/fbdd350535c977ee20db578c1e863b3b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-05T23:49:08+08:00" />
<meta property="article:modified_time" content="2024-01-05T23:49:08+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">小H靶场笔记：DC-5</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="DC5_0"></a>DC-5</h2> 
<p>January 5, 2024 10:44 AM<br> Tags：screen提权<br> Owner：只惠摸鱼</p> 
<h2><a id="_5"></a>信息收集</h2> 
<ul><li> <p>探测靶机ip，大概率为192.168.199.135，且开放端口为80和111</p> <p><img src="https://images2.imgbox.com/e2/34/ZFdD3Brh_o.png" alt="在这里插入图片描述"></p> </li><li> <p>扫描端口80，111相关服务、版本、操作系统、漏洞信息</p> 
  <ul><li>sudo nmap -sS -O -sV 192.168.199.135 --script=vuln</li></ul> <p><img src="https://images2.imgbox.com/cb/11/J2ZTlgb0_o.png" alt="在这里插入图片描述"></p> 
  <ul><li>发现有CSRF漏洞和RPCbind， 百度rpcbind后 发现是ddos漏洞，一般不采用</li></ul> </li><li> <p>查看80端口的页面，发现有可能有用的就是contact页面，但XSS没反应。</p> <p><img src="https://images2.imgbox.com/f4/0c/xKUgEjcW_o.png" alt="在这里插入图片描述"></p> </li><li> <p>扫一下目录，看有没有其他有用的</p> <p><img src="https://images2.imgbox.com/dd/ce/nzY5fjUz_o.png" alt="在这里插入图片描述"></p> </li><li> <p>发现有一些php页面，大部分是主页里面可见的功能，有一个奇怪的是footer.php 页面刷新或重新进入时，数字会变。</p> <p><img src="https://images2.imgbox.com/8c/b3/1ENyu2Df_o.png" alt="在这里插入图片描述"></p> <p><img src="https://images2.imgbox.com/b0/86/aZADWLr7_o.png" alt="在这里插入图片描述"></p> 
  <ul><li>猜想每个页面下方都有copyriht 即footer.php页面的内容，有可能是使用了include()等方式引入需要包含的文件，载入页面，因此有可能有文件包含漏洞。</li><li>访问其他页面刷新发现不会动，只有thankyou.php页面会变动，从此页面下手。</li></ul> <p><img src="https://images2.imgbox.com/75/f5/mwLn1zxa_o.png" alt="在这里插入图片描述"></p> <p><img src="https://images2.imgbox.com/c4/e8/hed0ia3C_o.png" alt="在这里插入图片描述"></p> </li></ul> 
<h2><a id="_50"></a>漏洞利用</h2> 
<ul><li> <p>bp抓包，然后进行传参使其等于其中任意页面的php（我是用了index.php)，导入Intruder模块准备爆破变量名，找到能够改变页面脚注的变量，从而执行下一步渗透操作。【我的字典是用的别人的英文字母字典，数量还比较大，不是很好用，有大佬有变量名爆破的字典的话跪求分享一下】</p> <p><img src="https://images2.imgbox.com/41/78/dRezahZj_o.png" alt="在这里插入图片描述"></p> </li><li> <p>根据返回内容的长度，找到传参的变量名是file</p> <p><img src="https://images2.imgbox.com/d0/b3/3h2De0lb_o.png" alt="在这里插入图片描述"></p> </li><li> <p>使用参数传入/etc/passwd，可以查看用户，/etc/shadow查看用户密码不行，应该是设置了权限</p> <p><img src="https://images2.imgbox.com/0c/0d/pqO1ATx6_o.png" alt="在这里插入图片描述"></p> </li><li> <p>有文件包含漏洞，然后抓包传入一句话木马，一句话木马需要存储在文件才能连接，所以想到nginx的日志进行写入。</p> <p><img src="https://images2.imgbox.com/ea/45/RQWkmv54_o.png" alt="在这里插入图片描述"></p> </li><li> <p>访问nginx的日志目录**/var/log/nginx/access.log<strong>或</strong>/var/log/nginx/error.log**【一开始我始终进不去，怎么搞都没数据，重启靶机后还是一样，发现爆500，搜了搜感觉应该是我爆破时没有设置线程，打崩了nginx服务器，或者扫目录时扫太多了，内容太多错误了。不得以重新安装一遍。0～0】</p> <p><img src="https://images2.imgbox.com/c5/5b/L99qpuyU_o.png" alt="在这里插入图片描述"></p> 
  <ul><li><strong>nginx日志默认字典路径</strong>为/var/log/nginx/access.log</li><li>access.log：指的是访问日志，我们通过访问日志可以获取用户的 IP、请求处理的时间、浏览器信息等</li><li>error.log：错误日志记录了访问出错的信息，可以用于定位错误的原因</li></ul> </li><li> <p>写入马后访问error.log，发现马已写入，尝试蚁剑连接（当然也可以访问url写马，然后看access.log即/&lt;?php @eval($_REQUEST[cmd]);?&gt;</p> <p><img src="https://images2.imgbox.com/50/ab/LHS9skNL_o.png" alt="在这里插入图片描述"></p> </li><li> <p>蚁剑连接</p> <p><img src="https://images2.imgbox.com/89/e4/rh3WLifI_o.png" alt="在这里插入图片描述"></p> </li><li> <p>反弹shell，进行提权操作</p> 
  <ul><li>第一种不通，使用nc反弹成功</li></ul> <p><img src="https://images2.imgbox.com/42/03/RHUTpL69_o.png" alt="在这里插入图片描述"></p> <p><img src="https://images2.imgbox.com/5e/c2/vIt2awyI_o.png" alt="在这里插入图片描述"></p> </li><li> <p>生成交互性shell</p> 
  <ul><li> <p>python -c 'import pty;pty.spawn(“/bin/bash”)’</p> <p><img src="https://images2.imgbox.com/cf/7c/oE1Y7LIv_o.png" alt="在这里插入图片描述"></p> </li></ul> </li></ul> 
<h2><a id="_106"></a>提权</h2> 
<ul><li> <p>www-data权限较低，尝试寻找suid文件进行提权</p> <p><img src="https://images2.imgbox.com/ed/cf/aIKZHz0W_o.png" alt="在这里插入图片描述"></p> </li><li> <p>发现有一个screen，搜索一下screen提权</p> 
  <ul><li>千万不要手动编译，手动复现或分步骤复现，就一次性运行sh脚本文件就好【折磨了我一下午，因为手动复现会出现编译版本问题导致无法执行，从而GLIBC版本报错提权失败。除非你再装一个比较老的版本的系统进行编译，我嫌太麻烦，不如直接run】*</li></ul> </li><li> <p>searchsploit 搜索screen 4.5提权漏洞</p> <p><img src="https://images2.imgbox.com/51/f5/ss4iKLYp_o.png" alt="在这里插入图片描述"></p> </li><li> <p>下载到本地，之后拖到桌面备用</p> <p><img src="https://images2.imgbox.com/dc/6a/vmrEUh3M_o.png" alt="在这里插入图片描述"></p> </li><li> <p>通过蚁剑上传到/tmp/文件夹</p> <p><img src="https://images2.imgbox.com/82/b3/9ayZGC4P_o.png" alt="在这里插入图片描述"></p> </li><li> <p>修改文件权限 chmod 777 41154.sh</p> </li><li> <p>直接本地反弹shell处运行脚本，一气呵成拿到root</p> <p><img src="https://images2.imgbox.com/1b/f7/yBVumZI0_o.png" alt="在这里插入图片描述"></p> </li><li> <p>msf反弹shell也可以</p> 
  <ul><li> <p>生成后门文件</p> <p><img src="https://images2.imgbox.com/a9/11/00Gqigdk_o.png" alt="在这里插入图片描述"></p> </li><li> <p>蚁剑上传</p> <p><img src="https://images2.imgbox.com/a0/c1/LQ7IbXG6_o.png" alt="在这里插入图片描述"></p> </li><li> <p>msf模块进行监听</p> <p><img src="https://images2.imgbox.com/05/90/LHPdDEYt_o.png" alt="在这里插入图片描述"></p> </li><li> <p>给予权限并运行</p> <p><img src="https://images2.imgbox.com/82/9d/0WfEeeJr_o.png" alt="在这里插入图片描述"></p> </li><li> <p>拿到后上传脚本，修改文件权限并运行</p> <p><img src="https://images2.imgbox.com/0f/9c/k1NrhxQz_o.png" alt="在这里插入图片描述"></p> <p><img src="https://images2.imgbox.com/f6/fa/Cc9DKvTY_o.png" alt="在这里插入图片描述"></p> </li></ul> </li><li> <p>读取/root目录下的flag。GG！</p> <p><img src="https://images2.imgbox.com/80/8a/xvAATxIp_o.png" alt="在这里插入图片描述"></p> </li></ul> 
<h2><a id="screen_171"></a>screen提权</h2> 
<ul><li>Screen是一款由GNU计划开发的用于命令行终端切换的自由软件。用户可以通过该软件同时连接多个本地或远程的命令行会话，并在其间自由切换。GNU Screen可以看作是窗口管理器的命令行界面版本。它提供了统一的管理多个会话的界面和相应的功能。</li><li>在Screen环境下，所有的会话都独立的运行，并拥有各自的编号、输入、输出和窗口缓存。用户可以通过快捷键在不同的窗口下切换，并可以自由的重定向各个窗口的输入和输出。</li><li>一<strong>般利用searchsploit搜搜screen中的漏洞，查看相关信息进行利用</strong></li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cd4ba483f07b74c5e0c28bdbb6af2801/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">CLion - Back - Forward</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0fc49eae9fba7a5d97249a4e9d57d899/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">UE5.1_UMG序列帧动画制作</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>