<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Yocto - bb脚本中使用的SRC_URI、SRCREV和S - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Yocto - bb脚本中使用的SRC_URI、SRCREV和S" />
<meta property="og:description" content="我们遇到的各种自己不了解的技术或产品时，都需要阅读用户手册。用户手册里的内容很多时，除了由目录组织文档结构外，通常还有有一个词汇表，一般作为附录放在文档最后。
通过这个按照字母排序的词汇表，可以在对整个文档还不够了解的情况下，快速的定位到自己需要的内容。
比如，我们打开Yocto的manual：Welcome to the Yocto Project Documentation — The Yocto Project ® 4.3.999 documentation
在左侧列表中找到“Reference Manual”，点开，在展开的列表中，继续选择“12 Variables Glossary”，上方点击首字母S，在下方页面中搜索到SRI_URI。
然后就可以得到关于SRI_URI的有用介绍：
See the BitBake manual for the initial description for this variable: SRC_URI.
有关该变量的初始描述，请参阅 BitBake 手册： SRC_URI。
所以，这个变量是用于BitBake的，它会识别和使用这个变量。你在bb脚本中设置这个变量，bitbake在构建时使用。
Bitbake关于此变量的说明的链接：
5 Variables Glossary — Bitbake dev documentation
SRC_URI
源文件列表 - 本地或远程。这个变量告诉 BitBake 在编译时要提取哪些文件，以及如何提取。例如，如果配方或附加文件需要从互联网上获取一个 tar 包，配方或附加文件就会使用 SRC_URI 条目指定该 tar 包。另一方面，如果配方或附加文件需要获取一个压缩包、应用两个补丁并包含一个自定义文件，则配方或附加文件需要一个 SRC_URI 变量来指定所有这些来源。
The list of source files — local or remote. This variable tells BitBake which bits to pull for the build and how to pull them." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/afe12d9d13e4dfc834ef4f486444b57a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-02T08:00:00+08:00" />
<meta property="article:modified_time" content="2023-12-02T08:00:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Yocto - bb脚本中使用的SRC_URI、SRCREV和S</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p></p> 
<p>我们遇到的各种自己不了解的技术或产品时，都需要阅读用户手册。用户手册里的内容很多时，除了由目录组织文档结构外，通常还有有一个词汇表，一般作为附录放在文档最后。</p> 
<p></p> 
<p>通过这个按照字母排序的词汇表，可以在对整个文档还不够了解的情况下，快速的定位到自己需要的内容。</p> 
<p></p> 
<p>比如，我们打开Yocto的manual：<a href="https://docs.yoctoproject.org/" rel="nofollow" title="Welcome to the Yocto Project Documentation — The Yocto Project ® 4.3.999 documentation">Welcome to the Yocto Project Documentation — The Yocto Project ® 4.3.999 documentation</a></p> 
<p>在左侧列表中找到“Reference Manual”，点开，在展开的列表中，继续选择“12 Variables Glossary”，上方点击首字母S，在下方页面中搜索到SRI_URI。</p> 
<p></p> 
<p>然后就可以得到关于SRI_URI的有用介绍：</p> 
<p></p> 
<p>See the BitBake manual for the initial description for this variable: SRC_URI.</p> 
<p></p> 
<p>有关该变量的初始描述，请参阅 BitBake 手册： SRC_URI。</p> 
<p></p> 
<p>所以，这个变量是用于BitBake的，它会识别和使用这个变量。你在bb脚本中设置这个变量，bitbake在构建时使用。</p> 
<p></p> 
<p><strong>Bitbake关于此变量的说明的链接：</strong></p> 
<p><a href="https://docs.yoctoproject.org/bitbake/2.6/bitbake-user-manual/bitbake-user-manual-ref-variables.html#term-SRC_URI" rel="nofollow" title="5 Variables Glossary — Bitbake dev documentation">5 Variables Glossary — Bitbake dev documentation</a></p> 
<p></p> 
<p><strong>SRC_URI</strong></p> 
<p>源文件列表 - 本地或远程。这个变量告诉 BitBake 在编译时要提取哪些文件，以及如何提取。例如，如果配方或附加文件需要从互联网上获取一个 tar 包，配方或附加文件就会使用 SRC_URI 条目指定该 tar 包。另一方面，如果配方或附加文件需要获取一个压缩包、应用两个补丁并包含一个自定义文件，则配方或附加文件需要一个 SRC_URI 变量来指定所有这些来源。</p> 
<p></p> 
<p>The list of source files — local or remote. This variable tells BitBake which bits to pull for the build and how to pull them. For example, if the recipe or append file needs to fetch a single tarball from the Internet, the recipe or append file uses a SRC_URI entry that specifies that tarball. On the other hand, if the recipe or append file needs to fetch a tarball, apply two patches, and include a custom file, the recipe or append file needs an SRC_URI variable that specifies all those sources.</p> 
<p></p> 
<p>下面的列表解释了可用的 URI 协议。URI 协议高度依赖于特定的 BitBake Fetcher 子模块。根据 BitBake 使用的撷取器，会使用不同的 URL 参数。有关所支持的提取器的详细信息，请参阅提取器部分。</p> 
<p></p> 
<p>The following list explains the available URI protocols. URI protocols are highly dependent on particular BitBake Fetcher submodules. Depending on the fetcher BitBake uses, various URL parameters are employed. For specifics on the supported Fetchers, see the Fetchers section.</p> 
<p></p> 
<p></p> 
<p>* az://: Fetches files from an Azure Storage account using HTTPS.</p> 
<p>* bzr://: Fetches files from a Bazaar revision control repository.</p> 
<p>* ccrc://: Fetches files from a ClearCase repository.</p> 
<p>* cvs://: Fetches files from a CVS revision control repository.</p> 
<p>* file://: Fetches files, which are usually files shipped with the Metadata, from the local machine. The path is relative to the FILESPATH variable. Thus, the build system searches, in order, from the following directories, which are assumed to be a subdirectories of the directory in which the recipe file (.bb) or append file (.bbappend) resides:</p> 
<p>    * ${BPN}: the base recipe name without any special suffix or version numbers.</p> 
<p>    * ${BP} - ${BPN}-${PV}: the base recipe name and version but without any special package name suffix.</p> 
<p>    * files: files within a directory, which is named files and is also alongside the recipe or append file.</p> 
<p>* ftp://: Fetches files from the Internet using FTP.</p> 
<p>* git://: Fetches files from a Git revision control repository.</p> 
<p>* gitsm://: Fetches submodules from a Git revision control repository.</p> 
<p>* hg://: Fetches files from a Mercurial (hg) revision control repository.</p> 
<p>* http://: Fetches files from the Internet using HTTP.</p> 
<p>* https://: Fetches files from the Internet using HTTPS.</p> 
<p>* npm://: Fetches JavaScript modules from a registry.</p> 
<p>* osc://: Fetches files from an OSC (OpenSUSE Build service) revision control repository.</p> 
<p>* p4://: Fetches files from a Perforce (p4) revision control repository.</p> 
<p>* repo://: Fetches files from a repo (Git) repository.</p> 
<p>* ssh://: Fetches files from a secure shell.</p> 
<p>* svn://: Fetches files from a Subversion (svn) revision control repository.</p> 
<p></p> 
<p></p> 
<p>这里还有一些值得一提的选项：</p> 
<p>Here are some additional options worth mentioning:</p> 
<p></p> 
<ul><li> <p>downloadfilename：指定存储下载文件时使用的文件名。</p> </li><li> <p>name：在 SRC_URI 中指定多个文件或 git 仓库时，用于识别与 SRC_URI 校验和或 SRCREV 关联的名称。例如</p> </li></ul> 
<p>SRC_URI = "git://example.com/foo.git;branch=main;name=first \</p> 
<p>           git://example.com/bar.git;branch=main;name=second \</p> 
<p>           <a href="http://example.com/file.tar.gz;name=third" rel="nofollow" title="http://example.com/file.tar.gz;name=third">http://example.com/file.tar.gz;name=third</a>"</p> 
<p></p> 
<p>SRCREV_first = "f1d2d2f924e986ac86fdf7b36c94bcdf32beec15"</p> 
<p>SRCREV_second = "e242ed3bffccdf271b7fbaf34ed72d089537b42f"</p> 
<p>SRC_URI[third.sha256sum] = "13550350a8681c84c861aac2e5b440161c2b33a3e4f302ac680ca5b686de48de"</p> 
<ul><li> <p>subdir： 将文件（或提取其内容）放入指定的子目录。该选项对于不常见的 tar 包或其他存档文件很有用，因为这些存档中的文件可能没预先放在一个子目录中。</p> </li><li> <p>subpath： 在使用 Git fetcher 时，将checkout代码仓库的树状文件结构的一部分。如果不设置subpath，也可以在设置S变量时指定使用git代码仓库的某个子目录。</p> </li><li> <p>unpack： 如果文件是存档格式，控制是否解压缩。默认操作是解压文件。=1是解压，=0是不解压。</p> </li></ul> 
<p></p> 
<p></p> 
<p><strong>SRCREV</strong></p> 
<p><a href="https://docs.yoctoproject.org/ref-manual/variables.html#term-SRCREV" rel="nofollow" title="12 Variables Glossary — The Yocto Project ® 4.3.999 documentation">12 Variables Glossary — The Yocto Project ® 4.3.999 documentation</a></p> 
<p>用于构建软件包的源代码的修订版本。此变量仅适用于 Subversion、Git、Mercurial 和 Bazaar。如果你想构建一个固定的修订版本，又想避免每次 BitBake 解析你的配方时都在远程版本库中执行查询，你应该指定一个完整修订版本标识符的 SRCREV，而不仅仅是一个标签。</p> 
<p></p> 
<p>The revision of the source code used to build the package. This variable applies only when using Subversion, Git, Mercurial and Bazaar. If you want to build a fixed revision and you want to avoid performing a query on the remote repository every time BitBake parses your recipe, you should specify a SRCREV that is a full revision identifier and not just a tag.</p> 
<p></p> 
<p><strong>S</strong></p> 
<p><a href="https://docs.yoctoproject.org/ref-manual/variables.html#term-S" rel="nofollow" title="12 Variables Glossary — The Yocto Project ® 4.3.999 documentation">12 Variables Glossary — The Yocto Project ® 4.3.999 documentation</a></p> 
<p>已解压缩的配方要用的源代码，其所在构建目录中的位置。默认情况下，该目录为 ${WORKDIR}/${BPN}-${PV}，其中 ${BPN} 是基本配方名称，${PV} 是配方版本。如果源代码压缩包将代码提取到 ${BPN}-${PV} 以外的目录，或者源代码是从 Git 或 Subversion 等 SCM 获取的，则必须在配方中设置 S，以便 OpenEmbedded 构建系统知道在哪里可以找到已解压的源代码。</p> 
<p></p> 
<p>The location in the Build Directory where unpacked recipe source code resides. By default, this directory is ${WORKDIR}/${BPN}-${PV}, where ${BPN} is the base recipe name and ${PV} is the recipe version. If the source tarball extracts the code to a directory named anything other than ${BPN}-${PV}, or if the source code is fetched from an SCM such as Git or Subversion, then you must set S in the recipe so that the OpenEmbedded build system knows where to find the unpacked source.</p> 
<p></p> 
<p>举例来说，假设源代码目录的顶级文件夹名为 poky，默认的编译目录为 poky/build。在这种情况下，构建系统用来保存名为db的配方的解压文件的工作目录如下：</p> 
<p>As an example, assume a Source Directory top-level folder named poky and a default Build Directory at poky/build. In this case, the work directory the build system uses to keep the unpacked recipe for db is the following:</p> 
<p></p> 
<p>poky/build/tmp/work/qemux86-poky-linux/db/5.1.19-r3/db-5.1.19</p> 
<p></p> 
<p>解压后的源代码位于 db-5.1.19 文件夹中。</p> 
<p>下一个示例假设有一个 Git 仓库。默认情况下，Git 仓库会在 do_fetch 过程中克隆到 ${WORKDIR}/git。由于该路径与默认值 S 不同，因此必须特别设置，以便找到源代码：</p> 
<p></p> 
<p>The unpacked source code resides in the db-5.1.19 folder.</p> 
<p>This next example assumes a Git repository. By default, Git repositories are cloned to ${WORKDIR}/git during do_fetch. Since this path is different from the default value of S, you must set it specifically so the source can be located:</p> 
<p></p> 
<p>SRC_URI = "git://path/to/repo.git;branch=main"</p> 
<p>S = "${WORKDIR}/git"</p> 
<p></p> 
<p></p> 
<p><strong>FETCHERS</strong></p> 
<p><a href="https://docs.yoctoproject.org/bitbake/2.6/bitbake-user-manual/bitbake-user-manual-fetching.html#fetchers" rel="nofollow" title="4 File Download Support — Bitbake dev documentation">4 File Download Support — Bitbake dev documentation</a></p> 
<p></p> 
<p>4.3 Fetchers</p> 
<p>如前所述，URL 前缀决定了 BitBake 使用哪个提取子模块。每个子模块可以支持不同的 URL 参数，下面将对此进行介绍。</p> 
<p>As mentioned earlier, the URL prefix determines which fetcher submodule BitBake uses. Each submodule can support different URL parameters, which are described in the following sections.</p> 
<p></p> 
<p>4.3.1 Local file fetcher (file://)   #本地文件提取器</p> 
<p></p> 
<p>该子模块处理以 file:// 开头的 URL。在 URL 中指定的文件名可以是文件的绝对路径，也可以是相对路径。如果文件名是相对路径，则使用 FILESPATH 变量的内容，与 PATH 用于查找可执行文件的方式相同。如果找不到文件，则假定在调用download()方法时，文件在 DL_DIR 中可用。</p> 
<p>This submodule handles URLs that begin with file://. The filename you specify within the URL can be either an absolute or relative path to a file. If the filename is relative, the contents of the FILESPATH variable is used in the same way PATH is used to find executables. If the file cannot be found, it is assumed that it is available in DL_DIR by the time the download() method is called.</p> 
<p></p> 
<p></p> 
<p>如果指定一个目录，则整个目录都会被解压缩。</p> 
<p>下面是几个 URL 示例，第一个是相对 URL，第二个是绝对 URL：</p> 
<p>If you specify a directory, the entire directory is unpacked.</p> 
<p>Here are a couple of example URLs, the first relative and the second absolute:</p> 
<p></p> 
<p>SRC_URI = "file://relativefile.patch"</p> 
<p>SRC_URI = "file:///Users/ich/very_important_software"</p> 
<p></p> 
<p></p> 
<p>4.3.5 Git Fetcher (git://)   #Git仓库提取器</p> 
<p></p> 
<p>这个提取子模块从 Git 源代码控制系统中取回代码。提取器的工作原理是在 GITDIR（通常是 DL_DIR/git2）中创建一个远程的裸克隆。然后从裸克隆中再clone到工作目录，也就是checkout一个特定的tree，解压到工作目录。这样做是为了尽量减少磁盘上的重复数据量，并使解包过程更快。使用的可执行文件可通过 FETCHCMD_git 设置。</p> 
<p>This fetcher submodule fetches code from the Git source control system. The fetcher works by creating a bare clone of the remote into GITDIR, which is usually DL_DIR/git2. This bare clone is then cloned into the work directory during the unpack stage when a specific tree is checked out. This is done using alternates and by reference to minimize the amount of duplicate data on the disk and make the unpack process fast. The executable used can be set with FETCHCMD_git.</p> 
<p></p> 
<p>此提取器支持的参数如下：</p> 
<p></p> 
<ul><li> <p>“protocol”: The protocol used to fetch the files. The default is “git” when a hostname is set. If a hostname is not set, the Git protocol is “file”. You can also use “http”, “https”, “ssh” and “rsync”.</p> </li><li> <p>“nocheckout”: Tells the fetcher to not checkout source code when unpacking when set to “1”. Set this option for the URL where there is a custom routine to checkout code. The default is “0”.</p> </li><li> <p>“rebaseable”: Indicates that the upstream Git repository can be rebased. You should set this parameter to “1” if revisions can become detached from branches. In this case, the source mirror tarball is done per revision, which has a loss of efficiency. Rebasing the upstream Git repository could cause the current revision to disappear from the upstream repository. This option reminds the fetcher to preserve the local cache carefully for future use. The default value for this parameter is “0”.</p> </li><li> <p>“nobranch”: Tells the fetcher to not check the SHA validation for the branch when set to “1”. The default is “0”. Set this option for the recipe that refers to the commit that is valid for any namespace (branch, tag, …) instead of the branch.</p> </li><li> <p>“bareclone”: Tells the fetcher to clone a bare clone into the destination directory without checking out a working tree. Only the raw Git metadata is provided. This parameter implies the “nocheckout” parameter as well.</p> </li><li> <p>“branch”: The branch(es) of the Git tree to clone. Unless “nobranch” is set to “1”, this is a mandatory parameter. The number of branch parameters must match the number of name parameters.</p> </li><li> <p>“rev”: The revision to use for the checkout. The default is “master”.</p> </li><li> <p>“tag”: Specifies a tag to use for the checkout. To correctly resolve tags, BitBake must access the network. For that reason, tags are often not used. As far as Git is concerned, the “tag” parameter behaves effectively the same as the “rev” parameter.</p> </li><li> <p>“subpath”: Limits the checkout to a specific subpath of the tree. By default, the whole tree is checked out.</p> </li><li> <p>“destsuffix”: The name of the path in which to place the checkout. By default, the path is git/.</p> </li><li> <p>“usehead”: Enables local git:// URLs to use the current branch HEAD as the revision for use with AUTOREV. The “usehead” parameter implies no branch and only works when the transfer protocol is file://.</p> </li></ul> 
<p></p> 
<p>注意：</p> 
<p>在使用protocol参数时，当协议为 "ssh "时，SRC_URI中的预期URL 与通常传递给 git clone 命令的不同，后者是由 Git 服务器提供的URL来提取内容的。例如，通过 SSH 克隆时，GitLab 服务器返回的 mesa 的 URL 是 <a href="mailto:git@gitlab.freedesktop.org" rel="nofollow">git@gitlab.freedesktop.org</a>:mesa/mesa.git，但 SRC_URI 中的预期 URL 却如下：</p> 
<p></p> 
<p>SRC_URI = "git://git@gitlab.freedesktop.org/mesa/mesa.git;branch=main;protocol=ssh;..."</p> 
<p></p> 
<p>注意项目路径前的:字符改为/。</p> 
<p></p> 
<p>一些URL的例子如下：</p> 
<p>SRC_URI = "git://github.com/fronteed/icheck.git;protocol=https;branch=${PV};tag=${PV}"</p> 
<p>SRC_URI = "git://github.com/asciidoc/asciidoc-py;protocol=https;branch=main"</p> 
<p>SRC_URI = "git://git@gitlab.freedesktop.org/mesa/mesa.git;branch=main;protocol=ssh;..."</p> 
<p></p> 
<p>当使用 git 作为软件主源代码的获取器时，应相应地设置 S：</p> 
<p>S = "${WORKDIR}/git"</p> 
<p></p> 
<p>注意：</p> 
<p>不支持在 git:// urls 中直接指定密码。原因有几个： SRC_URI 通常会被写入日志或其他地方，这很容易泄露密码；而且不删除密码的话，会导致元数据共享太容易。可以使用 SSH 密钥、~/.netrc 和 ~/.ssh/config 文件作为替代。</p> 
<p></p> 
<p>在 git fetcher 中使用标签可能会导致令人惊讶的行为。Bitbake 需要将标签解析到特定版本，为此必须连接并使用上游版本库(upstream repository)。这是因为标签(tag)指向的版本(revision)可能会发生变化，我们曾在著名的公共软件源中看到过这种情况。这可能意味着网络连接比预期的要多得多，而且每次构建时都要重新解析配方。源镜像(Source mirrors)也会被绕过，因为上游版本库是准确解析版本的唯一真实来源。出于这些原因，虽然提取器可以支持标签，但我们还是建议在配方中具体指定修订版本。</p> 
<p></p> 
<p><strong>联合起来使用</strong></p> 
<p>通过上面的介绍，在bb文件中通过这些变量来获取需要构建的目标文件的源代码。</p> 
<p></p> 
<p>比如，项目里通常会使用git协议来获取源代码。而在本地调试时，可以修改称本地路径。</p> 
<p></p> 
<p>第一种：</p> 
<p>SRC_URI = "git://git@github.com:7999/platform/projectname.git;protocol=ssh;nobranch=1"</p> 
<p>SRCREV = "c3f56703e58af33dbf808f903de694bcde3269cd"</p> 
<p>S = "${WORKDIR}/git"</p> 
<p></p> 
<p>第二种：</p> 
<p>SRC_URI = "file://${TOPDIR}/../../projectname"</p> 
<p>S = "${WORKDIR}/${TOPDIR}/../../projectname"</p> 
<p></p> 
<p>这里用到了${TOPDIR}。</p> 
<p></p> 
<p>(结束)</p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a3946c42c080cb398ed67f981073acbf/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">scrapy爬虫中间件和下载中间件的使用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3fd823c61d72b0a1f2c52dbf0443850f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【硬核HeyGen平替】在window平台上使用MyHeyGen</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>