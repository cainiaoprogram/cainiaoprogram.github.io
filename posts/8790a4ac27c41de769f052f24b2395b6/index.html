<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>pm2基本使用 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="pm2基本使用" />
<meta property="og:description" content="1.pm2的基本介绍 pm2是node的进程管理器，利用它可以简化node任务的管理,且内置了许多功能,常用于后台脚本管理。
pm2特性 自带热部署 - - - 当源文件更新 线上项目也会自动重启后台运行 - - - 不会占用实时窗口 会在后台运行服务信息查看 - - - 查看运行中程序的各项信息日志系统 - - - 可以随时查看程序的运行日志内置负载均衡 - - - 在cluster模式会自动使用轮询的方式达到负载均衡的效果多平台支持 - - - 在linux windows macOS 上都可以稳定的运行最大内存重启 - - - 可以设置最大内存限制超过限制则会自动重启；
还有很多的特性 咱就不一一举例了感兴趣的朋友可以去官网查看学习 小的这就献上官网地址 官网地址 2.pm2的安装 // 这里我使用npm进行pm2的全局安装 $ npm install -g pm2 // 安装完成后可以使用 -v 参数 查看pm2的版本 检测是否安装成功 $ pm2 -v 3.pm2的基本使用 // 第一条要介绍的是pm2的启动命令 $ pm2 start [项目入口文件名] 这里我使用一个 node.js内置的http模块搭建的一个简单服务器程序来演示
// serve.js var http = require(&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/8790a4ac27c41de769f052f24b2395b6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-09-20T08:51:42+08:00" />
<meta property="article:modified_time" content="2022-09-20T08:51:42+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">pm2基本使用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="1pm2_0"></a>1.pm2的基本介绍</h2> 
<p>pm2是node的进程管理器，利用它可以简化node任务的管理,且内置了许多功能,常用于后台脚本管理。</p> 
<h4><a id="pm2_2"></a>pm2特性</h4> 
<ul><li>自带热部署 - - - 当源文件更新 线上项目也会自动重启</li><li>后台运行 - - - 不会占用实时窗口 会在后台运行</li><li>服务信息查看 - - - 查看运行中程序的各项信息</li><li>日志系统 - - - 可以随时查看程序的运行日志</li><li>内置负载均衡 - - - 在cluster模式会自动使用轮询的方式达到负载均衡的效果</li><li>多平台支持 - - - 在linux windows macOS 上都可以稳定的运行</li><li>最大内存重启 - - - 可以设置最大内存限制超过限制则会自动重启；<br> 还有很多的特性 咱就不一一举例了感兴趣的朋友可以去官网查看学习 小的这就献上官网地址 <a href="https://pm2.keymetrics.io/" rel="nofollow">官网地址</a></li></ul> 
<h2><a id="2pm2_12"></a>2.pm2的安装</h2> 
<pre><code class="prism language-javascript"><span class="token comment">// 这里我使用npm进行pm2的全局安装</span>
$ npm install <span class="token operator">-</span>g pm2

<span class="token comment">// 安装完成后可以使用  -v 参数 查看pm2的版本 检测是否安装成功</span>
$ pm2 <span class="token operator">-</span>v
</code></pre> 
<h2><a id="3pm2_21"></a>3.pm2的基本使用</h2> 
<pre><code class="prism language-javascript"><span class="token comment">// 第一条要介绍的是pm2的启动命令</span>
$ pm2 start <span class="token punctuation">[</span>项目入口文件名<span class="token punctuation">]</span>
</code></pre> 
<p>这里我使用一个 node.js内置的http模块搭建的一个简单服务器程序来演示</p> 
<pre><code class="prism language-javascript"><span class="token comment">// serve.js</span>
<span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"http"</span><span class="token punctuation">)</span>
<span class="token comment">//创建服务器</span>
http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> <span class="token string-property property">"Content-Type"</span><span class="token operator">:</span> <span class="token string">"text/html;charset=utf-8"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">//设置响应头</span>
    res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
      &lt;html&gt;
          &lt;div&gt;hello pm2&lt;/div&gt;
      &lt;/html&gt;
    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"server start"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p>在项目根路径打开cmd运行下面的命令</p> 
<pre><code class="prism language-javascript"><span class="token comment">// 使用npm2启动这个简单的服务器程序</span>
$ pm2 start serve<span class="token punctuation">.</span>js

<span class="token comment">// 也可以在后面添加一些参数 来附加一些效果</span>
<span class="token operator">--</span>watch  <span class="token comment">// --watch 监听程序源文件的变化 一旦发生变化自动重启 (热启动效果)</span>
<span class="token operator">--</span>ignore<span class="token operator">-</span>watch <span class="token comment">// 排除监听的目录或者文件  支持正则表达式</span>
<span class="token operator">-</span>n <span class="token operator">--</span>name <span class="token comment">// 设置程序的名称</span>
<span class="token operator">--</span>log <span class="token comment">// 指定日志文件</span>
<span class="token operator">--</span>max<span class="token operator">-</span>memory<span class="token operator">-</span>restart <span class="token punctuation">[</span>100MB<span class="token punctuation">]</span> <span class="token comment">// 设置最大占用内存</span>
<span class="token operator">--</span>no<span class="token operator">-</span>daemon <span class="token comment">// 非进程守护模式启动</span>
<span class="token operator">--</span>no<span class="token operator">-</span>autorestart <span class="token comment">// 关闭自动重启</span>
<span class="token operator">--</span>time <span class="token comment">// 日志添加时间前缀</span>
<span class="token operator">-</span>e <span class="token operator">--</span>error <span class="token punctuation">[</span>path<span class="token punctuation">]</span> <span class="token comment">// 错误日志输出路径</span>
<span class="token operator">-</span>i <span class="token punctuation">[</span>n<span class="token punctuation">]</span>  <span class="token comment">//cluster mode 模式启动n个进程实例 </span>
<span class="token operator">-</span>i max  <span class="token comment">//集群模式  将会检测cpu的数量并运行尽可能多的进程  自动开启负载均衡的效果</span>
<span class="token comment">// 还有很多参数可以使用 详细可以查看官网  这些也可以通过pm2配置文件配置</span>
</code></pre> 
<p>可以看到命令行输出了以下信息 这是这个简单服务器程序的一些基础运行信息,这时即使关闭终端,这个程序仍然会在后套继续运行<br> <img src="https://images2.imgbox.com/75/79/wcTQ5xUd_o.jpg" alt="在这里插入图片描述"></p> 
<h3><a id="_67"></a>各项参数详解</h3> 
<pre><code class="prism language-javascript">id <span class="token comment">// 进程id 标识作用 用于其他命令的指向</span>
name <span class="token comment">// 进程标识 用于其他命令的指向</span>
namespace <span class="token comment">// 环境名称 </span>
version <span class="token comment">// 版本</span>
mode <span class="token comment">//进程模式，cluster或fork。cluster有多个进程，而fork只有一个</span>
pid <span class="token comment">// 进程id  标识作用</span>
uptime <span class="token comment">// 运行时间</span>
↺  <span class="token comment">// 重启次数</span>
status <span class="token comment">// 进程是否在线</span>
cpu <span class="token comment">// cpu的占用率</span>
mem <span class="token comment">// 内存占用大小</span>
user <span class="token comment">// 启动用户名 </span>
</code></pre> 
<p>可以启动多个这样的任务 可以通过以下命令查看所有的运行程序信息</p> 
<pre><code class="prism language-javascript"><span class="token comment">// 查看所有使用pm2运行的程序信息</span>
$ pm2 list
</code></pre> 
<h2><a id="4pm2_89"></a>4.pm2常用命令</h2> 
<h4><a id="1_90"></a>1.停止进程</h4> 
<pre><code class="prism language-javascript"><span class="token comment">// 停止指定的进程</span>
$ pm2 stop <span class="token punctuation">[</span>进程名<span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token punctuation">[</span>进程id<span class="token punctuation">]</span>
<span class="token comment">// 停止所有的进程</span>
$ pm2 stop all # 停止所有的应用程序
</code></pre> 
<h4><a id="2_98"></a>2.删除进程</h4> 
<pre><code class="prism language-javascript"><span class="token comment">// 删除指定的进程</span>
$ pm2 <span class="token keyword">delete</span> <span class="token punctuation">[</span>进程名<span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token punctuation">[</span>进程id<span class="token punctuation">]</span>
<span class="token comment">// 删除所有进程</span>
$ pm2 <span class="token keyword">delete</span> all
<span class="token comment">// 杀死pm2的守护进程 同时也会杀死所有进程</span>
$ pm2 kill
</code></pre> 
<h4><a id="3_107"></a>3.重启进程</h4> 
<pre><code class="prism language-javascript"><span class="token comment">// 以下两个命令都可以达到重启进程的效果</span>
$ pm2 restart <span class="token punctuation">[</span>进程名<span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token punctuation">[</span>进程id<span class="token punctuation">]</span>  <span class="token comment">// 重启效果 短时间内进程无效</span>
$ pm2 reload <span class="token punctuation">[</span>进程名<span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token punctuation">[</span>进程id<span class="token punctuation">]</span> <span class="token comment">// 重载效果 会保持进程在线 </span>

<span class="token comment">// 重启所有进程</span>
$ pm2 reload all
<span class="token comment">// 重置重启数量</span>
$ pm2 reset <span class="token punctuation">[</span>进程名<span class="token punctuation">]</span>
</code></pre> 
<h4><a id="4_118"></a>4.查看所有进程</h4> 
<pre><code class="prism language-javascript"><span class="token comment">// 以下三个命令都可以查看所有进程</span>
$ pm2 list
$ pm2 ls
$ pm2 status
</code></pre> 
<h4><a id="5_125"></a>5.查看某一个进程的信息</h4> 
<pre><code class="prism language-javascript">$ pm2 show <span class="token punctuation">[</span>进程名<span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token punctuation">[</span>进程id<span class="token punctuation">]</span>
</code></pre> 
<h4><a id="6_129"></a>6.查看日志</h4> 
<pre><code class="prism language-javascript"><span class="token comment">// 查看所有的日志</span>
$ pm2 logs
<span class="token comment">// 查看指定的进程日志</span>
$ pm2 logs <span class="token punctuation">[</span>进程名<span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token punctuation">[</span>进程id<span class="token punctuation">]</span>
<span class="token comment">// 清空所有日志</span>
$ pm2 flush

<span class="token comment">// 还可以附加一些参数 附加功能</span>
<span class="token operator">--</span>line <span class="token punctuation">[</span>数字<span class="token punctuation">]</span>  <span class="token comment">// 查看最后多少条日志 默认是15条</span>
<span class="token operator">--</span>err <span class="token comment">// 只查看错误日志</span>
<span class="token operator">--</span>timestamp <span class="token comment">// 时实日志附带时间前缀</span>
</code></pre> 
<h4><a id="6_143"></a>6.监控所有的进程</h4> 
<pre><code class="prism language-javascript"><span class="token comment">// 会进入一个信息面板</span>
$ pm2 monit
</code></pre> 
<h4><a id="7_148"></a>7.静态服务器</h4> 
<pre><code class="prism language-javascript">$ pm2 serve <span class="token punctuation">[</span>静态文件夹路径<span class="token punctuation">]</span> <span class="token punctuation">[</span>端口<span class="token punctuation">]</span>
</code></pre> 
<h4><a id="8_152"></a>8.扩展实例</h4> 
<pre><code class="prism language-javascript"><span class="token comment">// 将指定的进程扩展到n个</span>
$ pm2 scale <span class="token punctuation">[</span>服务名<span class="token punctuation">]</span> <span class="token punctuation">[</span>n<span class="token punctuation">]</span>
</code></pre> 
<h2><a id="5pm2_157"></a>5.pm2配置文件</h2> 
<pre><code class="prism language-javascript">$ pm2 ecosystem  <span class="token comment">// 当前目录下自动生成pm2的配置文件</span>

<span class="token comment">// 以配置文件启动</span>
$ pm2 start ecosystem<span class="token punctuation">.</span>config<span class="token punctuation">.</span>js <span class="token operator">--</span>env production
</code></pre> 
<p>apps是一个数组 可以同时配置多个进程服务 还有很多的配置项 如果想要了解的更详细还请参照官网<br> 同时日志文件还支持 yml 格式配置 小编这里就不多演示了 详情请参照官网</p> 
<pre><code class="prism language-javascript"><span class="token comment">// ecosystem.config.js 配置演示</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">apps</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">name</span>      <span class="token operator">:</span> <span class="token string">'demo'</span><span class="token punctuation">,</span>      <span class="token comment">// 应用的名称</span>
  <span class="token literal-property property">script</span>    <span class="token operator">:</span> <span class="token string">'app.js'</span><span class="token punctuation">,</span>   <span class="token comment">// 应用文件路径</span>
  <span class="token literal-property property">env</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token constant">PM2_SERVE_PATH</span><span class="token operator">:</span> <span class="token string">"."</span><span class="token punctuation">,</span>    <span class="token comment">// 静态服务的路径</span>
    <span class="token constant">PM2_SERVE_PORT</span><span class="token operator">:</span> <span class="token number">8080</span><span class="token punctuation">,</span>   <span class="token comment">// 静态服务器访问的端口</span>
    <span class="token constant">NODE_ENV</span><span class="token operator">:</span> <span class="token string">'development'</span> <span class="token comment">// 设置开发环境运行时</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">env_production</span> <span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token constant">NODE_ENV</span><span class="token operator">:</span> <span class="token string">'production'</span>  <span class="token comment">// 设置生产环境运行时</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">instances</span><span class="token operator">:</span> <span class="token string">"max"</span><span class="token punctuation">,</span>         <span class="token comment">// 将应用程序分布在所有CPU核心上 也可以指定多少个</span>
  <span class="token literal-property property">watch</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>              <span class="token comment">// 热启动模式</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token string">'./out.log'</span><span class="token punctuation">,</span>      <span class="token comment">// 指定日志标准输出文件及位置</span>
  <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">'./error.log'</span><span class="token punctuation">,</span>     <span class="token comment">// 错误输出日志文件及位置</span>
  <span class="token literal-property property">merge_logs</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>         <span class="token comment">// 是否可以合并日志</span>
  <span class="token literal-property property">log_type</span><span class="token operator">:</span> <span class="token string">"json"</span><span class="token punctuation">,</span>         <span class="token comment">// 日志类型</span>
  <span class="token literal-property property">log_date_format</span><span class="token operator">:</span> <span class="token string">"DD-MM-YYYY"</span><span class="token punctuation">,</span>  <span class="token comment">// 日志的日期格式</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">deploy</span> <span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">production</span> <span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">user</span> <span class="token operator">:</span> <span class="token string">'SSH_USERNAME'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">host</span> <span class="token operator">:</span> <span class="token string">'SSH_HOSTMACHINE'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">ref</span>  <span class="token operator">:</span> <span class="token string">'origin/master'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">repo</span> <span class="token operator">:</span> <span class="token string">'GIT_REPOSITORY'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">path</span> <span class="token operator">:</span> <span class="token string">'DESTINATION_PATH'</span><span class="token punctuation">,</span>
      <span class="token string-property property">'pre-deploy-local'</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
      <span class="token string-property property">'post-deploy'</span> <span class="token operator">:</span> <span class="token string">'npm install &amp;&amp; pm2 reload ecosystem.config.js --env production'</span><span class="token punctuation">,</span>
      <span class="token string-property property">'pre-setup'</span><span class="token operator">:</span> <span class="token string">''</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="6_203"></a>6.结尾</h2> 
<p>这是小编的第二篇博客,励志每周更新一篇,感觉写到这里还有很多pm2的技术点没有写出来,后面可能还会更新一篇关于pm2的博客,专门讲解一下 pm2的一些插件 还有 keymetrics监控 和fork与cluster这两种启动模式,想听的朋友不妨点个关注或者订阅吧,哈哈哈，瑞思拜!<img src="https://images2.imgbox.com/0a/e8/PbEb1fhB_o.jpg" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4451a255233da60fccfd30cedbd20efa/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">计算机网络:TCP三次握手可能出现的问题及攻击手段</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/781823924ad0bcc71e9b901136ebcec6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">程序员 40 岁之后的出路在哪里？</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>