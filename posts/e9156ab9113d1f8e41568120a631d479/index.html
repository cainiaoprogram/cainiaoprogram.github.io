<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SELinux 相关学习资料 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="SELinux 相关学习资料" />
<meta property="og:description" content="http://linux.vbird.org/linux_basic/0440processcontrol.php
http://www.ibm.com/developerworks/cn/linux/l-selinux/
正文来源：http://wiki.eri.ucsb.edu/sysadm/SELinux
Introduction SELinux is a set of extra security restrictions on top of the normal Linux security tools. It gives the systems administrator a finer grain of control than what the kernel typically provides. But SELinux can sometimes get in your way.
install the policy utils:
yum install policycoreutils Install the management GUI:
yum install policycoreutils-gui Then run it with:
ssh -Y root@host.name.edu /usr/bin/system-config-selinux &amp; and then under the Boolean tab, add what you need, like &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/e9156ab9113d1f8e41568120a631d479/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2011-11-20T15:39:00+08:00" />
<meta property="article:modified_time" content="2011-11-20T15:39:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SELinux 相关学习资料</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><a href="http://linux.vbird.org/linux_basic/0440processcontrol.php" rel="nofollow">http://linux.vbird.org/linux_basic/0440processcontrol.php</a></p> 
<p><a href="http://www.ibm.com/developerworks/cn/linux/l-selinux/" rel="nofollow">http://www.ibm.com/developerworks/cn/linux/l-selinux/</a><br> </p> 
<p><br> </p> 
<p>正文来源：<a href="http://wiki.eri.ucsb.edu/sysadm/SELinux" rel="nofollow">http://wiki.eri.ucsb.edu/sysadm/SELinux</a><br> </p> 
<p><span style="font-family:sans-serif; font-size:13px; line-height:19px"></span></p> 
<h2 style="color:black; background-color:initial; font-weight:bold; margin-top:0px; margin-right:0px; margin-bottom:0.6em; margin-left:0px; padding-top:0.3em; padding-bottom:0.15em; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:rgb(170,170,170); font-size:19px"> <span class="mw-headline">Introduction</span></h2> 
<p></p> 
<p style="margin-top:0.4em; margin-bottom:0.5em; line-height:1.5em">SELinux is a set of extra security restrictions on top of the normal Linux security tools. It gives the systems administrator a finer grain of control than what the kernel typically provides. But SELinux can sometimes get in your way.</p> 
<p style="margin-top:0.4em; margin-bottom:0.5em; line-height:1.5em">install the policy utils:</p> 
<pre style="padding-top:1em; padding-right:1em; padding-bottom:1em; padding-left:1em; border-top-width:1px; border-right-width:1px; border-bottom-width:1px; border-left-width:1px; border-top-style:dashed; border-right-style:dashed; border-bottom-style:dashed; border-left-style:dashed; border-top-color:rgb(47,111,171); border-right-color:rgb(47,111,171); border-bottom-color:rgb(47,111,171); border-left-color:rgb(47,111,171); color:black; background-color:rgb(249,249,249); line-height:1.1em">yum install policycoreutils
</pre> 
<p style="margin-top:0.4em; margin-bottom:0.5em; line-height:1.5em">Install the management GUI:</p> 
<pre style="padding-top:1em; padding-right:1em; padding-bottom:1em; padding-left:1em; border-top-width:1px; border-right-width:1px; border-bottom-width:1px; border-left-width:1px; border-top-style:dashed; border-right-style:dashed; border-bottom-style:dashed; border-left-style:dashed; border-top-color:rgb(47,111,171); border-right-color:rgb(47,111,171); border-bottom-color:rgb(47,111,171); border-left-color:rgb(47,111,171); color:black; background-color:rgb(249,249,249); line-height:1.1em">yum install policycoreutils-gui
</pre> 
<p style="margin-top:0.4em; margin-bottom:0.5em; line-height:1.5em">Then run it with:</p> 
<pre style="padding-top:1em; padding-right:1em; padding-bottom:1em; padding-left:1em; border-top-width:1px; border-right-width:1px; border-bottom-width:1px; border-left-width:1px; border-top-style:dashed; border-right-style:dashed; border-bottom-style:dashed; border-left-style:dashed; border-top-color:rgb(47,111,171); border-right-color:rgb(47,111,171); border-bottom-color:rgb(47,111,171); border-left-color:rgb(47,111,171); color:black; background-color:rgb(249,249,249); line-height:1.1em">ssh -Y root@host.name.edu
/usr/bin/system-config-selinux &amp;
</pre> 
<p style="margin-top:0.4em; margin-bottom:0.5em; line-height:1.5em">and then under the Boolean tab, add what you need, like "Allow httpd to access NFS directories".</p> 
<a name="audit2allow" id="audit2allow" style="text-decoration:none; color:rgb(0,43,184); background-color:initial"></a> 
<h3 style="color:black; background-color:initial; font-weight:bold; margin-top:0px; margin-right:0px; margin-bottom:0.6em; margin-left:0px; padding-top:0.3em; padding-bottom:0.15em; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:rgb(170,170,170); font-size:15px"> <span class="mw-headline">audit2allow</span></h3> 
<p style="margin-top:0.4em; margin-bottom:0.5em; line-height:1.5em">in CentOS 5.x audit2allow is part of the policycoreutils package.. As of CentOS-6.x its now in: policycoreutils-python</p> 
<a name="Logging" id="Logging" style="text-decoration:none; color:rgb(0,43,184); background-color:initial"></a> 
<h2 style="color:black; background-color:initial; font-weight:bold; margin-top:0px; margin-right:0px; margin-bottom:0.6em; margin-left:0px; padding-top:0.3em; padding-bottom:0.15em; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:rgb(170,170,170); font-size:19px"> <span class="mw-headline">Logging</span></h2> 
<p style="margin-top:0.4em; margin-bottom:0.5em; line-height:1.5em">Logging is done primarily to the /var/log/audit/audit.log file, but sometimes /var/log/messages sees them as well.</p> 
<a name="Some_Issues_caused_by_SELinux" id="Some_Issues_caused_by_SELinux" style="text-decoration:none; color:rgb(0,43,184); background-color:initial"></a> 
<h2 style="color:black; background-color:initial; font-weight:bold; margin-top:0px; margin-right:0px; margin-bottom:0.6em; margin-left:0px; padding-top:0.3em; padding-bottom:0.15em; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:rgb(170,170,170); font-size:19px"> <span class="mw-headline">Some Issues caused by SELinux</span></h2> 
<ul style="line-height:1.3em; list-style-type:square; margin-top:0.3em; margin-right:0px; margin-bottom:0px; margin-left:1.5em; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><li style="margin-bottom:0.08em">postfix - switching to permissive mode gets around the following errors (seen on trying to install on post)</li></ul> 
<pre style="padding-top:1em; padding-right:1em; padding-bottom:1em; padding-left:1em; border-top-width:1px; border-right-width:1px; border-bottom-width:1px; border-left-width:1px; border-top-style:dashed; border-right-style:dashed; border-bottom-style:dashed; border-left-style:dashed; border-top-color:rgb(47,111,171); border-right-color:rgb(47,111,171); border-bottom-color:rgb(47,111,171); border-left-color:rgb(47,111,171); color:black; background-color:rgb(249,249,249); line-height:1.1em">sendmail -t &lt; /tmp/tt
sendmail: warning: premature end-of-input on /usr/sbin/postdrop -r while reading input attribute name
sendmail: fatal: root(0): unable to execute /usr/sbin/postdrop -r: Success
</pre> 
<ul style="line-height:1.3em; list-style-type:square; margin-top:0.3em; margin-right:0px; margin-bottom:0px; margin-left:1.5em; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><li style="margin-bottom:0.08em">various issues with named - zone transfers - DDNS</li></ul> 
<a name="Related_Docs" id="Related_Docs" style="text-decoration:none; color:rgb(0,43,184); background-color:initial"></a> 
<h2 style="color:black; background-color:initial; font-weight:bold; margin-top:0px; margin-right:0px; margin-bottom:0.6em; margin-left:0px; padding-top:0.3em; padding-bottom:0.15em; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:rgb(170,170,170); font-size:19px"> <span class="mw-headline">Related Docs</span></h2> 
<ul style="line-height:1.3em; list-style-type:square; margin-top:0.3em; margin-right:0px; margin-bottom:0px; margin-left:1.5em; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><li style="margin-bottom:0.08em"><a href="http://wiki.centos.org/HowTos/SELinux" rel="nofollow" class="external free" title="http://wiki.centos.org/HowTos/SELinux" style="text-decoration:none; color:rgb(51,102,187); background-color:initial; padding-top:0px; padding-right:13px; padding-bottom:0px; padding-left:0px">http://wiki.centos.org/HowTos/SELinux</a> - CentOS Wiki HowTo.</li><li style="margin-bottom:0.08em"><a href="http://www.revsys.com/writings/quicktips/turn-off-selinux.html" rel="nofollow" class="external free" title="http://www.revsys.com/writings/quicktips/turn-off-selinux.html" style="text-decoration:none; color:rgb(51,102,187); background-color:initial; padding-top:0px; padding-right:13px; padding-bottom:0px; padding-left:0px">http://www.revsys.com/writings/quicktips/turn-off-selinux.html</a> - how to disable or change levels</li><li style="margin-bottom:0.08em"><a href="http://centos.org/docs/5/html/Deployment_Guide-en-US/ch-selinux.html" rel="nofollow" class="external free" title="http://centos.org/docs/5/html/Deployment_Guide-en-US/ch-selinux.html" style="text-decoration:none; color:rgb(51,102,187); background-color:initial; padding-top:0px; padding-right:13px; padding-bottom:0px; padding-left:0px">http://centos.org/docs/5/html/Deployment_Guide-en-US/ch-selinux.html</a> - CentOS docs</li><li style="margin-bottom:0.08em"><a href="http://www.nsa.gov/research/selinux/index.shtml" rel="nofollow" class="external free" title="http://www.nsa.gov/research/selinux/index.shtml" style="text-decoration:none; color:rgb(51,102,187); background-color:initial; padding-top:0px; padding-right:13px; padding-bottom:0px; padding-left:0px">http://www.nsa.gov/research/selinux/index.shtml</a> - NSA's page</li><li style="margin-bottom:0.08em"><a href="http://selinux.sourceforge.net/" rel="nofollow" class="external free" title="http://selinux.sourceforge.net/" style="text-decoration:none; color:rgb(51,102,187); background-color:initial; padding-top:0px; padding-right:13px; padding-bottom:0px; padding-left:0px">http://selinux.sourceforge.net/</a> - Sourceforge page</li><li style="margin-bottom:0.08em"><a href="http://docs.fedoraproject.org/selinux-faq/" rel="nofollow" class="external free" title="http://docs.fedoraproject.org/selinux-faq/" style="text-decoration:none; color:rgb(51,102,187); background-color:initial; padding-top:0px; padding-right:13px; padding-bottom:0px; padding-left:0px">http://docs.fedoraproject.org/selinux-faq/</a> - Fedora SElinux faq</li><li style="margin-bottom:0.08em"><a href="http://www.crypt.gen.nz/selinux/faq.html" rel="nofollow" class="external free" title="http://www.crypt.gen.nz/selinux/faq.html" style="text-decoration:none; color:rgb(51,102,187); background-color:initial; padding-top:0px; padding-right:13px; padding-bottom:0px; padding-left:0px">http://www.crypt.gen.nz/selinux/faq.html</a> - Unofficial SELinux faq</li><li style="margin-bottom:0.08em"><a href="http://www.yolinux.com/TUTORIALS/LinuxTutorialWebSiteConfig.html" rel="nofollow" class="external free" title="http://www.yolinux.com/TUTORIALS/LinuxTutorialWebSiteConfig.html" style="text-decoration:none; color:rgb(51,102,187); background-color:initial; padding-top:0px; padding-right:13px; padding-bottom:0px; padding-left:0px">http://www.yolinux.com/TUTORIALS/LinuxTutorialWebSiteConfig.html</a> - shows some common selinux context variables</li><li style="margin-bottom:0.08em"><a href="http://www.linuxtopia.org/online_books/rhel6/rhel_6_selinux/rhel_6_selinux_sect-Security-Enhanced_Linux-SELinux_Contexts_Labeling_Files-Persistent_Changes_semanage_fcontext.html" rel="nofollow" class="external free" title="http://www.linuxtopia.org/online_books/rhel6/rhel_6_selinux/rhel_6_selinux_sect-Security-Enhanced_Linux-SELinux_Contexts_Labeling_Files-Persistent_Changes_semanage_fcontext.html" style="text-decoration:none; color:rgb(51,102,187); background-color:initial; padding-top:0px; padding-right:13px; padding-bottom:0px; padding-left:0px">http://www.linuxtopia.org/online_books/rhel6/rhel_6_selinux/rhel_6_selinux_sect-Security-Enhanced_Linux-SELinux_Contexts_Labeling_Files-Persistent_Changes_semanage_fcontext.html</a> - SELinux on RHEL 6</li></ul> 
<a name="Enabling.2FDisabling" id="Enabling.2FDisabling" style="text-decoration:none; color:rgb(0,43,184); background-color:initial"></a> 
<h2 style="color:black; background-color:initial; font-weight:bold; margin-top:0px; margin-right:0px; margin-bottom:0.6em; margin-left:0px; padding-top:0.3em; padding-bottom:0.15em; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:rgb(170,170,170); font-size:19px"> <span class="mw-headline">Enabling/Disabling</span></h2> 
<p style="margin-top:0.4em; margin-bottom:0.5em; line-height:1.5em">Temporarily turn selinux off:</p> 
<pre style="padding-top:1em; padding-right:1em; padding-bottom:1em; padding-left:1em; border-top-width:1px; border-right-width:1px; border-bottom-width:1px; border-left-width:1px; border-top-style:dashed; border-right-style:dashed; border-bottom-style:dashed; border-left-style:dashed; border-top-color:rgb(47,111,171); border-right-color:rgb(47,111,171); border-bottom-color:rgb(47,111,171); border-left-color:rgb(47,111,171); color:black; background-color:rgb(249,249,249); line-height:1.1em">echo 0 &gt; /selinux/enforce
</pre> 
<p style="margin-top:0.4em; margin-bottom:0.5em; line-height:1.5em">Temporarily turn selinux on:</p> 
<pre style="padding-top:1em; padding-right:1em; padding-bottom:1em; padding-left:1em; border-top-width:1px; border-right-width:1px; border-bottom-width:1px; border-left-width:1px; border-top-style:dashed; border-right-style:dashed; border-bottom-style:dashed; border-left-style:dashed; border-top-color:rgb(47,111,171); border-right-color:rgb(47,111,171); border-bottom-color:rgb(47,111,171); border-left-color:rgb(47,111,171); color:black; background-color:rgb(249,249,249); line-height:1.1em">echo 1 &gt; /selinux/enforce
</pre> 
<p style="margin-top:0.4em; margin-bottom:0.5em; line-height:1.5em">Edit /etc/sysconfig/selinux - look for a line like</p> 
<pre style="padding-top:1em; padding-right:1em; padding-bottom:1em; padding-left:1em; border-top-width:1px; border-right-width:1px; border-bottom-width:1px; border-left-width:1px; border-top-style:dashed; border-right-style:dashed; border-bottom-style:dashed; border-left-style:dashed; border-top-color:rgb(47,111,171); border-right-color:rgb(47,111,171); border-bottom-color:rgb(47,111,171); border-left-color:rgb(47,111,171); color:black; background-color:rgb(249,249,249); line-height:1.1em"> SELINUX=enforcing
</pre> 
<p style="margin-top:0.4em; margin-bottom:0.5em; line-height:1.5em">And change to</p> 
<pre style="padding-top:1em; padding-right:1em; padding-bottom:1em; padding-left:1em; border-top-width:1px; border-right-width:1px; border-bottom-width:1px; border-left-width:1px; border-top-style:dashed; border-right-style:dashed; border-bottom-style:dashed; border-left-style:dashed; border-top-color:rgb(47,111,171); border-right-color:rgb(47,111,171); border-bottom-color:rgb(47,111,171); border-left-color:rgb(47,111,171); color:black; background-color:rgb(249,249,249); line-height:1.1em">SELINUX=disabled
</pre> 
<a name="Configuration" id="Configuration" style="text-decoration:none; color:rgb(0,43,184); background-color:initial"></a> 
<h2 style="color:black; background-color:initial; font-weight:bold; margin-top:0px; margin-right:0px; margin-bottom:0.6em; margin-left:0px; padding-top:0.3em; padding-bottom:0.15em; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:rgb(170,170,170); font-size:19px"> <span class="mw-headline">Configuration</span></h2> 
<p style="margin-top:0.4em; margin-bottom:0.5em; line-height:1.5em">Looks like much of the SELinux config in CentOS is in /etc/selinux.</p> 
<p style="margin-top:0.4em; margin-bottom:0.5em; line-height:1.5em">Found a neat util audit2allow from the <a href="http://www.crypt.gen.nz/selinux/faq.html#BSP.1" rel="nofollow" class="external free" title="http://www.crypt.gen.nz/selinux/faq.html#BSP.1" style="text-decoration:none; color:rgb(51,102,187); background-color:initial; padding-top:0px; padding-right:13px; padding-bottom:0px; padding-left:0px">http://www.crypt.gen.nz/selinux/faq.html#BSP.1</a> website.</p> 
<p style="margin-top:0.4em; margin-bottom:0.5em; line-height:1.5em">Make the errors occur and then:</p> 
<pre style="padding-top:1em; padding-right:1em; padding-bottom:1em; padding-left:1em; border-top-width:1px; border-right-width:1px; border-bottom-width:1px; border-left-width:1px; border-top-style:dashed; border-right-style:dashed; border-bottom-style:dashed; border-left-style:dashed; border-top-color:rgb(47,111,171); border-right-color:rgb(47,111,171); border-bottom-color:rgb(47,111,171); border-left-color:rgb(47,111,171); color:black; background-color:rgb(249,249,249); line-height:1.1em">% cd /var/log
% tail messages | audit2allow

#============= httpd_t ==============
allow httpd_t nfs_t:dir search;
allow httpd_t nfs_t:file read;
%
</pre> 
<p style="margin-top:0.4em; margin-bottom:0.5em; line-height:1.5em">Still trying to figure out what to do with the output (what file to put that in).</p> 
<p style="margin-top:0.4em; margin-bottom:0.5em; line-height:1.5em"><br> </p> 
<a name="FTP" id="FTP" style="text-decoration:none; color:rgb(0,43,184); background-color:initial"></a> 
<h2 style="color:black; background-color:initial; font-weight:bold; margin-top:0px; margin-right:0px; margin-bottom:0.6em; margin-left:0px; padding-top:0.3em; padding-bottom:0.15em; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:rgb(170,170,170); font-size:19px"> <span class="mw-headline">FTP</span></h2> 
<pre style="padding-top:1em; padding-right:1em; padding-bottom:1em; padding-left:1em; border-top-width:1px; border-right-width:1px; border-bottom-width:1px; border-left-width:1px; border-top-style:dashed; border-right-style:dashed; border-bottom-style:dashed; border-left-style:dashed; border-top-color:rgb(47,111,171); border-right-color:rgb(47,111,171); border-bottom-color:rgb(47,111,171); border-left-color:rgb(47,111,171); color:black; background-color:rgb(249,249,249); line-height:1.1em">setsebool -P allow_ftpd_use_nfs 1
</pre> 
<p style="margin-top:0.4em; margin-bottom:0.5em; line-height:1.5em">and to allow anon incoming writes:</p> 
<pre style="padding-top:1em; padding-right:1em; padding-bottom:1em; padding-left:1em; border-top-width:1px; border-right-width:1px; border-bottom-width:1px; border-left-width:1px; border-top-style:dashed; border-right-style:dashed; border-bottom-style:dashed; border-left-style:dashed; border-top-color:rgb(47,111,171); border-right-color:rgb(47,111,171); border-bottom-color:rgb(47,111,171); border-left-color:rgb(47,111,171); color:black; background-color:rgb(249,249,249); line-height:1.1em">setsebool -P allow_ftpd_anon_write 1
</pre> 
<a name="HTTPD" id="HTTPD" style="text-decoration:none; color:rgb(0,43,184); background-color:initial"></a> 
<h2 style="color:black; background-color:initial; font-weight:bold; margin-top:0px; margin-right:0px; margin-bottom:0.6em; margin-left:0px; padding-top:0.3em; padding-bottom:0.15em; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:rgb(170,170,170); font-size:19px"> <span class="mw-headline">HTTPD</span></h2> 
<p style="margin-top:0.4em; margin-bottom:0.5em; line-height:1.5em">This resolved access to the nfs mounted icess pages.... Not sure if I need to do this again or what.</p> 
<pre style="padding-top:1em; padding-right:1em; padding-bottom:1em; padding-left:1em; border-top-width:1px; border-right-width:1px; border-bottom-width:1px; border-left-width:1px; border-top-style:dashed; border-right-style:dashed; border-bottom-style:dashed; border-left-style:dashed; border-top-color:rgb(47,111,171); border-right-color:rgb(47,111,171); border-bottom-color:rgb(47,111,171); border-left-color:rgb(47,111,171); color:black; background-color:rgb(249,249,249); line-height:1.1em">setsebool -P httpd_use_nfs on
</pre> 
<p style="margin-top:0.4em; margin-bottom:0.5em; line-height:1.5em">Issues with regular httpd on local filesys good info at <a href="http://beginlinux.com/server_training/web-server/976-apache-and-selinux" rel="nofollow" class="external free" title="http://beginlinux.com/server_training/web-server/976-apache-and-selinux" style="text-decoration:none; color:rgb(51,102,187); background-color:initial; padding-top:0px; padding-right:13px; padding-bottom:0px; padding-left:0px">http://beginlinux.com/server_training/web-server/976-apache-and-selinux</a> But still no obvious, simple solution and no luck with google yet. I wouldn't mind creating the correct module to make it work, but its not clear how to do that or where to put it as the man pages reflect a different directory structure.</p> 
<pre style="padding-top:1em; padding-right:1em; padding-bottom:1em; padding-left:1em; border-top-width:1px; border-right-width:1px; border-bottom-width:1px; border-left-width:1px; border-top-style:dashed; border-right-style:dashed; border-bottom-style:dashed; border-left-style:dashed; border-top-color:rgb(47,111,171); border-right-color:rgb(47,111,171); border-bottom-color:rgb(47,111,171); border-left-color:rgb(47,111,171); color:black; background-color:rgb(249,249,249); line-height:1.1em">getsebool -a | grep httpd
</pre> 
<p style="margin-top:0.4em; margin-bottom:0.5em; line-height:1.5em">tried this in /var/www/vhosts/d6</p> 
<pre style="padding-top:1em; padding-right:1em; padding-bottom:1em; padding-left:1em; border-top-width:1px; border-right-width:1px; border-bottom-width:1px; border-left-width:1px; border-top-style:dashed; border-right-style:dashed; border-bottom-style:dashed; border-left-style:dashed; border-top-color:rgb(47,111,171); border-right-color:rgb(47,111,171); border-bottom-color:rgb(47,111,171); border-left-color:rgb(47,111,171); color:black; background-color:rgb(249,249,249); line-height:1.1em">  chcon -t httpd_sys_script_exec_t *.php
</pre> 
<a name="HTTPD_on_CentOS-6" id="HTTPD_on_CentOS-6" style="text-decoration:none; color:rgb(0,43,184); background-color:initial"></a> 
<h3 style="color:black; background-color:initial; font-weight:bold; margin-top:0px; margin-right:0px; margin-bottom:0.6em; margin-left:0px; padding-top:0.3em; padding-bottom:0.15em; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:rgb(170,170,170); font-size:15px"> <span class="mw-headline">HTTPD on CentOS-6</span></h3> 
<p style="margin-top:0.4em; margin-bottom:0.5em; line-height:1.5em">CentOS 6 seems to be a little more rigid about selinux stuff... Manually set this way...</p> 
<pre style="padding-top:1em; padding-right:1em; padding-bottom:1em; padding-left:1em; border-top-width:1px; border-right-width:1px; border-bottom-width:1px; border-left-width:1px; border-top-style:dashed; border-right-style:dashed; border-bottom-style:dashed; border-left-style:dashed; border-top-color:rgb(47,111,171); border-right-color:rgb(47,111,171); border-bottom-color:rgb(47,111,171); border-left-color:rgb(47,111,171); color:black; background-color:rgb(249,249,249); line-height:1.1em">chcon -v -u system_u drupa*
chown root:root drupal-7.7
chcon -R -v -u system_u drupal-7.7
chcon -v -R -t httpd_sys_content_t drupal-7.7
</pre> 
<p style="margin-top:0.4em; margin-bottom:0.5em; line-height:1.5em">I think the better approach is to do the following:</p> 
<pre style="padding-top:1em; padding-right:1em; padding-bottom:1em; padding-left:1em; border-top-width:1px; border-right-width:1px; border-bottom-width:1px; border-left-width:1px; border-top-style:dashed; border-right-style:dashed; border-bottom-style:dashed; border-left-style:dashed; border-top-color:rgb(47,111,171); border-right-color:rgb(47,111,171); border-bottom-color:rgb(47,111,171); border-left-color:rgb(47,111,171); color:black; background-color:rgb(249,249,249); line-height:1.1em">semanage fcontext -a -t httpd_sys_content_t  "/var/www/vhosts(/.*)?"    # specifies a rule for the /var/www/vhosts directory hierarchy
restorecon -Rv /var/www/vhosts    # to update the entire tree
restorecon -v /var/www/vhosts/drupal-7.7/index.html       # change one specific file
restorecon -Rv -n /var/www/vhosts     # examine without making changes
</pre> 
<a name="SAMBA.2FSMB" id="SAMBA.2FSMB" style="text-decoration:none; color:rgb(0,43,184); background-color:initial"></a> 
<h2 style="color:black; background-color:initial; font-weight:bold; margin-top:0px; margin-right:0px; margin-bottom:0.6em; margin-left:0px; padding-top:0.3em; padding-bottom:0.15em; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:rgb(170,170,170); font-size:19px"> <span class="mw-headline">SAMBA/SMB</span></h2> 
<pre style="padding-top:1em; padding-right:1em; padding-bottom:1em; padding-left:1em; border-top-width:1px; border-right-width:1px; border-bottom-width:1px; border-left-width:1px; border-top-style:dashed; border-right-style:dashed; border-bottom-style:dashed; border-left-style:dashed; border-top-color:rgb(47,111,171); border-right-color:rgb(47,111,171); border-bottom-color:rgb(47,111,171); border-left-color:rgb(47,111,171); color:black; background-color:rgb(249,249,249); line-height:1.1em">for i in samba_enable_home_dirs samba_export_all_ro samba_export_all_rw samba_share_nfs use_samba_home_dirs ; do setsebool -P $i on ; done
</pre> 
<a name="Utilities" id="Utilities" style="text-decoration:none; color:rgb(0,43,184); background-color:initial"></a> 
<h2 style="color:black; background-color:initial; font-weight:bold; margin-top:0px; margin-right:0px; margin-bottom:0.6em; margin-left:0px; padding-top:0.3em; padding-bottom:0.15em; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:rgb(170,170,170); font-size:19px"> <span class="mw-headline">Utilities</span></h2> 
<p style="margin-top:0.4em; margin-bottom:0.5em; line-height:1.5em"><a href="http://www.webhostingbuzz.com/wiki/How_to_find_the_correct_SELinux_Boolean_for_your_problem_on_CentOS_5" rel="nofollow" class="external text" title="http://www.webhostingbuzz.com/wiki/How_to_find_the_correct_SELinux_Boolean_for_your_problem_on_CentOS_5" style="text-decoration:none; color:rgb(51,102,187); background-color:initial; padding-top:0px; padding-right:13px; padding-bottom:0px; padding-left:0px">http://www.webhostingbuzz.com/wiki/How_to_find_the_correct_SELinux_Boolean_for_your_problem_on_CentOS_5 </a>- Managing settings</p> 
<pre style="padding-top:1em; padding-right:1em; padding-bottom:1em; padding-left:1em; border-top-width:1px; border-right-width:1px; border-bottom-width:1px; border-left-width:1px; border-top-style:dashed; border-right-style:dashed; border-bottom-style:dashed; border-left-style:dashed; border-top-color:rgb(47,111,171); border-right-color:rgb(47,111,171); border-bottom-color:rgb(47,111,171); border-left-color:rgb(47,111,171); color:black; background-color:rgb(249,249,249); line-height:1.1em">[root@ldap ~]# getsebool -a | grep slapd
slapd_disable_trans --&gt; off
[root@ldap ~]# setsebool -P slapd_disable_trans on
[root@ldap ~]# getsebool -a | grep slapd
slapd_disable_trans --&gt; on
[root@ldap ~]# setsebool -P slapd_disable_trans off
</pre> 
<a name="audit2allow_2" id="audit2allow_2" style="text-decoration:none; color:rgb(0,43,184); background-color:initial"></a> 
<h3 style="color:black; background-color:initial; font-weight:bold; margin-top:0px; margin-right:0px; margin-bottom:0.6em; margin-left:0px; padding-top:0.3em; padding-bottom:0.15em; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:rgb(170,170,170); font-size:15px"> <span class="mw-headline">audit2allow</span></h3> 
<p style="margin-top:0.4em; margin-bottom:0.5em; line-height:1.5em">As of CentOS-6 audit to allow is part of a new package (noted above as well)</p> 
<pre style="padding-top:1em; padding-right:1em; padding-bottom:1em; padding-left:1em; border-top-width:1px; border-right-width:1px; border-bottom-width:1px; border-left-width:1px; border-top-style:dashed; border-right-style:dashed; border-bottom-style:dashed; border-left-style:dashed; border-top-color:rgb(47,111,171); border-right-color:rgb(47,111,171); border-bottom-color:rgb(47,111,171); border-left-color:rgb(47,111,171); color:black; background-color:rgb(249,249,249); line-height:1.1em">yum install policycoreutils-python
</pre> 
<p style="margin-top:0.4em; margin-bottom:0.5em; line-height:1.5em">The -w flag is very nice as it provides a usable description of the error and possible solutions...</p> 
<pre style="padding-top:1em; padding-right:1em; padding-bottom:1em; padding-left:1em; border-top-width:1px; border-right-width:1px; border-bottom-width:1px; border-left-width:1px; border-top-style:dashed; border-right-style:dashed; border-bottom-style:dashed; border-left-style:dashed; border-top-color:rgb(47,111,171); border-right-color:rgb(47,111,171); border-bottom-color:rgb(47,111,171); border-left-color:rgb(47,111,171); color:black; background-color:rgb(249,249,249); line-height:1.1em">audit2allow -a -w
</pre> 
<a name="To_allow_httpd_to_use_nfs_dirs_in_CentOS-6" id="To_allow_httpd_to_use_nfs_dirs_in_CentOS-6" style="text-decoration:none; color:rgb(0,43,184); background-color:initial"></a> 
<h4 style="color:black; background-color:initial; font-weight:bold; margin-top:0px; margin-right:0px; margin-bottom:0.3em; margin-left:0px; padding-top:0.3em; padding-bottom:0.15em; border-bottom-width:initial; border-bottom-style:none; border-bottom-color:initial; font-size:13px"> <span class="mw-headline">To allow httpd to use nfs dirs in CentOS-6</span></h4> 
<pre style="padding-top:1em; padding-right:1em; padding-bottom:1em; padding-left:1em; border-top-width:1px; border-right-width:1px; border-bottom-width:1px; border-left-width:1px; border-top-style:dashed; border-right-style:dashed; border-bottom-style:dashed; border-left-style:dashed; border-top-color:rgb(47,111,171); border-right-color:rgb(47,111,171); border-bottom-color:rgb(47,111,171); border-left-color:rgb(47,111,171); color:black; background-color:rgb(249,249,249); line-height:1.1em">setsebool -P httpd_use_nfs 1
setsebool -P httpd_enable_homedirs 1
</pre> 
<a name="semanage" id="semanage" style="text-decoration:none; color:rgb(0,43,184); background-color:initial"></a> 
<h3 style="color:black; background-color:initial; font-weight:bold; margin-top:0px; margin-right:0px; margin-bottom:0.6em; margin-left:0px; padding-top:0.3em; padding-bottom:0.15em; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:rgb(170,170,170); font-size:15px"> <span class="mw-headline">semanage</span></h3> 
<p style="margin-top:0.4em; margin-bottom:0.5em; line-height:1.5em">Looks like semanage allows adjustments to policies without recompiling them. Manage users etc...</p> 
<pre style="padding-top:1em; padding-right:1em; padding-bottom:1em; padding-left:1em; border-top-width:1px; border-right-width:1px; border-bottom-width:1px; border-left-width:1px; border-top-style:dashed; border-right-style:dashed; border-bottom-style:dashed; border-left-style:dashed; border-top-color:rgb(47,111,171); border-right-color:rgb(47,111,171); border-bottom-color:rgb(47,111,171); border-left-color:rgb(47,111,171); color:black; background-color:rgb(249,249,249); line-height:1.1em">semanage user -l   # show list of SElinux users
</pre> 
<a name="Creating_SELinux_configuration_modules" id="Creating_SELinux_configuration_modules" style="text-decoration:none; color:rgb(0,43,184); background-color:initial"></a> 
<h2 style="color:black; background-color:initial; font-weight:bold; margin-top:0px; margin-right:0px; margin-bottom:0.6em; margin-left:0px; padding-top:0.3em; padding-bottom:0.15em; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:rgb(170,170,170); font-size:19px"> <span class="mw-headline">Creating SELinux configuration modules</span></h2> 
<p style="margin-top:0.4em; margin-bottom:0.5em; line-height:1.5em">Discovered the following link: <a href="http://permalink.gmane.org/gmane.linux.redhat.fedora.selinux/8690" rel="nofollow" class="external free" title="http://permalink.gmane.org/gmane.linux.redhat.fedora.selinux/8690" style="text-decoration:none; color:rgb(51,102,187); background-color:initial; padding-top:0px; padding-right:13px; padding-bottom:0px; padding-left:0px">http://permalink.gmane.org/gmane.linux.redhat.fedora.selinux/8690</a> trying to resolve an selinux issue with our named server. It might provide some interesting fixes to some of our other issues.j</p> 
<a name="Creating_a_module_from_syslog_avc_entries" id="Creating_a_module_from_syslog_avc_entries" style="text-decoration:none; color:rgb(0,43,184); background-color:initial"></a> 
<h3 style="color:black; background-color:initial; font-weight:bold; margin-top:0px; margin-right:0px; margin-bottom:0.6em; margin-left:0px; padding-top:0.3em; padding-bottom:0.15em; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:rgb(170,170,170); font-size:15px"> <span class="mw-headline">Creating a module from syslog avc entries</span></h3> 
<ul style="line-height:1.3em; list-style-type:square; margin-top:0.3em; margin-right:0px; margin-bottom:0px; margin-left:1.5em; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><li style="margin-bottom:0.08em">get the avc messages in question into a single location</li><li style="margin-bottom:0.08em">run audit2allow on just the avc lines in question 
  <ul style="line-height:1.3em; list-style-type:square; margin-top:0.3em; margin-right:0px; margin-bottom:0px; margin-left:1.5em; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><li style="margin-bottom:0.08em">The -M argument seems to create a module</li></ul> </li><li style="margin-bottom:0.08em">run semodule -i to activate 
  <ul style="line-height:1.3em; list-style-type:square; margin-top:0.3em; margin-right:0px; margin-bottom:0px; margin-left:1.5em; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><li style="margin-bottom:0.08em">The -i flag is to install/replace a module</li></ul> </li></ul> 
<p style="margin-top:0.4em; margin-bottom:0.5em; line-height:1.5em"><br> </p> 
<pre style="padding-top:1em; padding-right:1em; padding-bottom:1em; padding-left:1em; border-top-width:1px; border-right-width:1px; border-bottom-width:1px; border-left-width:1px; border-top-style:dashed; border-right-style:dashed; border-bottom-style:dashed; border-left-style:dashed; border-top-color:rgb(47,111,171); border-right-color:rgb(47,111,171); border-bottom-color:rgb(47,111,171); border-left-color:rgb(47,111,171); color:black; background-color:rgb(249,249,249); line-height:1.1em"># tail -1000 /var/log/messages | grep avc | audit2allow -M mypol
# semodule -i mypol.pp
</pre> 
<p style="margin-top:0.4em; margin-bottom:0.5em; line-height:1.5em">Just checked a new entry... Looks like the audit2allow -M mypol creates a plain text file mypol.te in the current directory as well as a binary mypol.pp file. So it looks like the mypol.te file coult be modified (it has a version number as well as the rules required).... Need a bit more research on that</p> 
<a name="Location" id="Location" style="text-decoration:none; color:rgb(0,43,184); background-color:initial"></a> 
<h3 style="color:black; background-color:initial; font-weight:bold; margin-top:0px; margin-right:0px; margin-bottom:0.6em; margin-left:0px; padding-top:0.3em; padding-bottom:0.15em; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:rgb(170,170,170); font-size:15px"> <span class="mw-headline">Location</span></h3> 
<p style="margin-top:0.4em; margin-bottom:0.5em; line-height:1.5em">Looks like modules are maintained here.</p> 
<pre style="padding-top:1em; padding-right:1em; padding-bottom:1em; padding-left:1em; border-top-width:1px; border-right-width:1px; border-bottom-width:1px; border-left-width:1px; border-top-style:dashed; border-right-style:dashed; border-bottom-style:dashed; border-left-style:dashed; border-top-color:rgb(47,111,171); border-right-color:rgb(47,111,171); border-bottom-color:rgb(47,111,171); border-left-color:rgb(47,111,171); color:black; background-color:rgb(249,249,249); line-height:1.1em">/etc/selinux/targeted/modules/active/modules/
</pre> 
<a name="New_tidbits" id="New_tidbits" style="text-decoration:none; color:rgb(0,43,184); background-color:initial"></a> 
<h3 style="color:black; background-color:initial; font-weight:bold; margin-top:0px; margin-right:0px; margin-bottom:0.6em; margin-left:0px; padding-top:0.3em; padding-bottom:0.15em; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:rgb(170,170,170); font-size:15px"> <span class="mw-headline">New tidbits</span></h3> 
<pre style="padding-top:1em; padding-right:1em; padding-bottom:1em; padding-left:1em; border-top-width:1px; border-right-width:1px; border-bottom-width:1px; border-left-width:1px; border-top-style:dashed; border-right-style:dashed; border-bottom-style:dashed; border-left-style:dashed; border-top-color:rgb(47,111,171); border-right-color:rgb(47,111,171); border-bottom-color:rgb(47,111,171); border-left-color:rgb(47,111,171); color:black; background-color:rgb(249,249,249); line-height:1.1em">Use checkmodule to recompile a .te file (but I had issues with magic numbers on this, got close though)...
 checkmodule -M -m erinsmarpwatch.te -o erinsmarpwatch.pp
</pre> 
<p style="margin-top:0.4em; margin-bottom:0.5em; line-height:1.5em">Use -r on semodule to unload</p> 
<pre style="padding-top:1em; padding-right:1em; padding-bottom:1em; padding-left:1em; border-top-width:1px; border-right-width:1px; border-bottom-width:1px; border-left-width:1px; border-top-style:dashed; border-right-style:dashed; border-bottom-style:dashed; border-left-style:dashed; border-top-color:rgb(47,111,171); border-right-color:rgb(47,111,171); border-bottom-color:rgb(47,111,171); border-left-color:rgb(47,111,171); color:black; background-color:rgb(249,249,249); line-height:1.1em"> semodule -r erinsmarpwatch
</pre> 
<p style="margin-top:0.4em; margin-bottom:0.5em; line-height:1.5em">Use -l on semodule to list</p> 
<pre style="padding-top:1em; padding-right:1em; padding-bottom:1em; padding-left:1em; border-top-width:1px; border-right-width:1px; border-bottom-width:1px; border-left-width:1px; border-top-style:dashed; border-right-style:dashed; border-bottom-style:dashed; border-left-style:dashed; border-top-color:rgb(47,111,171); border-right-color:rgb(47,111,171); border-bottom-color:rgb(47,111,171); border-left-color:rgb(47,111,171); color:black; background-color:rgb(249,249,249); line-height:1.1em"> semodule -l
</pre> 
<p style="margin-top:0.4em; margin-bottom:0.5em; line-height:1.5em">Have seen ssh login issues with CentOS-6.x (could not set up DSA key autologin). After adding a loadable module, PAM would complain and kick me out of the system entirely. Resolved with this tip to get a system to relabel its security contexts (requires reboot):</p> 
<pre style="padding-top:1em; padding-right:1em; padding-bottom:1em; padding-left:1em; border-top-width:1px; border-right-width:1px; border-bottom-width:1px; border-left-width:1px; border-top-style:dashed; border-right-style:dashed; border-bottom-style:dashed; border-left-style:dashed; border-top-color:rgb(47,111,171); border-right-color:rgb(47,111,171); border-bottom-color:rgb(47,111,171); border-left-color:rgb(47,111,171); color:black; background-color:rgb(249,249,249); line-height:1.1em">touch /.autorelabel
shutdown -r now
</pre> 
<a name="Example_script_for_semi_automation_of_building_a_module" id="Example_script_for_semi_automation_of_building_a_module" style="text-decoration:none; color:rgb(0,43,184); background-color:initial"></a> 
<h3 style="color:black; background-color:initial; font-weight:bold; margin-top:0px; margin-right:0px; margin-bottom:0.6em; margin-left:0px; padding-top:0.3em; padding-bottom:0.15em; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:rgb(170,170,170); font-size:15px"> <span class="mw-headline">Example script for semi automation of building a module</span></h3> 
<p style="margin-top:0.4em; margin-bottom:0.5em; line-height:1.5em">Below is the script I built at nsm://opt/local/sbin/avccollect. This is hardwired for erins3 module as a name. I will likely modify it to make the module name an argument or flag of some type.</p> 
<pre style="padding-top:1em; padding-right:1em; padding-bottom:1em; padding-left:1em; border-top-width:1px; border-right-width:1px; border-bottom-width:1px; border-left-width:1px; border-top-style:dashed; border-right-style:dashed; border-bottom-style:dashed; border-left-style:dashed; border-top-color:rgb(47,111,171); border-right-color:rgb(47,111,171); border-bottom-color:rgb(47,111,171); border-left-color:rgb(47,111,171); color:black; background-color:rgb(249,249,249); line-height:1.1em">#!/bin/sh

t=/tmp/avccollect-temp
d=/tmp/avccollect-diff
u=/tmp/avccollect-un
mod=erins3
e=/tmp/$mod

tail -500 /var/log/messages | grep avc | grep -v ' received policyload notice' &gt; $t
if [ -f $e ]; then
  cat $e $t | sort | uniq &gt; $u
else 
  cat $t | sort | uniq &gt; $u
fi

diff $u $e &gt; $d
cp $u $e

echo "###################################"
echo "log messages used to create the module $mod:"
cat $e

echo ""
echo "###################################"
echo "diff of output of last two passes:"

cat $e | audit2allow -M $mod
semodule -i $mod.pp
</pre> 
<p style="margin-top:0.4em; margin-bottom:0.5em; line-height:1.5em">Then looped through the following sequence until things were working... Could fix this up to check for when changes stop happening...</p> 
<pre style="padding-top:1em; padding-right:1em; padding-bottom:1em; padding-left:1em; border-top-width:1px; border-right-width:1px; border-bottom-width:1px; border-left-width:1px; border-top-style:dashed; border-right-style:dashed; border-bottom-style:dashed; border-left-style:dashed; border-top-color:rgb(47,111,171); border-right-color:rgb(47,111,171); border-bottom-color:rgb(47,111,171); border-left-color:rgb(47,111,171); color:black; background-color:rgb(249,249,249); line-height:1.1em">sendmail -t &lt; /tmp/ti       # submit an email as if from arpwatch
/opt/local/sbin/avccollect    # run script
</pre> 
<a name="Audit2allow_entries" id="Audit2allow_entries" style="text-decoration:none; color:rgb(0,43,184); background-color:initial"></a> 
<h2 style="color:black; background-color:initial; font-weight:bold; margin-top:0px; margin-right:0px; margin-bottom:0.6em; margin-left:0px; padding-top:0.3em; padding-bottom:0.15em; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:rgb(170,170,170); font-size:19px"> <span class="mw-headline">Audit2allow entries</span></h2> 
<a name="dub-icess_2011-01-12" id="dub-icess_2011-01-12" style="text-decoration:none; color:rgb(0,43,184); background-color:initial"></a> 
<h3 style="color:black; background-color:initial; font-weight:bold; margin-top:0px; margin-right:0px; margin-bottom:0.6em; margin-left:0px; padding-top:0.3em; padding-bottom:0.15em; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:rgb(170,170,170); font-size:15px"> <span class="mw-headline">dub-icess 2011-01-12</span></h3> 
<pre style="padding-top:1em; padding-right:1em; padding-bottom:1em; padding-left:1em; border-top-width:1px; border-right-width:1px; border-bottom-width:1px; border-left-width:1px; border-top-style:dashed; border-right-style:dashed; border-bottom-style:dashed; border-left-style:dashed; border-top-color:rgb(47,111,171); border-right-color:rgb(47,111,171); border-bottom-color:rgb(47,111,171); border-left-color:rgb(47,111,171); color:black; background-color:rgb(249,249,249); line-height:1.1em">Jan 12 13:45:09 dub-icess kernel: type=1400 audit(1294868709.069:90): avc:  denied  { read } for  pid=27505 comm="automount" name="hosts" dev=dm-0 ino=2488004 scontext=system_u:system_r:automount_t:s0 tcontext=root:object_r:tmp_t:s0 tclass=file
Jan 12 13:45:15 dub-icess automount[1085]: key "biogeog" not found in map source(s).
Jan 12 14:19:15 dub-icess kernel: type=1400 audit(1294870755.878:91): avc:  denied  { read } for  pid=27682 comm="automount" name="hosts" dev=dm-0 ino=2488004 scontext=system_u:system_r:automount_t:s0 tcontext=root:object_r:tmp_t:s0 tclass=file
Jan 12 14:20:13 dub-icess automount[27741]: lookup_read_master: lookup(nisplus): couldn't locate nis+ table auto.master
Jan 12 14:20:17 dub-icess kernel: type=1400 audit(1294870817.451:92): avc:  denied  { read } for  pid=27752 comm="automount" name="hosts" dev=dm-0 ino=2488004 scontext=root:system_r:automount_t:s0 tcontext=root:object_r:tmp_t:s0 tclass=file
Jan 12 14:21:32 dub-icess kernel: type=1400 audit(1294870892.970:93): avc:  denied  { getattr } for  pid=27780 comm="httpd" path="/etc/httpd/conf.d/vhost-ccber.ucsb.edu.conf" dev=dm-0 ino=4386800 scontext=root:system_r:httpd_t:s0 tcontext=root:object_r:tmp_t:s0 tclass=file
Jan 12 14:21:32 dub-icess kernel: type=1400 audit(1294870892.970:94): avc:  denied  { read } for  pid=27780 comm="httpd" name="vhost-ccber.ucsb.edu.conf" dev=dm-0 ino=4386800 scontext=root:system_r:httpd_t:s0 tcontext=root:object_r:tmp_t:s0 tclass=file
Jan 12 14:21:32 dub-icess kernel: type=1400 audit(1294870892.982:95): avc:  denied  { read } for  pid=27781 comm="automount" name="hosts" dev=dm-0 ino=2488004 scontext=root:system_r:automount_t:s0 tcontext=root:object_r:tmp_t:s0 tclass=file
Jan 12 14:35:58 dub-icess kernel: type=1400 audit(1294871758.116:96): avc:  denied  { getattr } for  pid=27897 comm="httpd" path="/etc/httpd/conf.d/vhost-biogeog.ucsb.edu.conf" dev=dm-0 ino=2488012 scontext=root:system_r:httpd_t:s0 tcontext=root:object_r:tmp_t:s0 tclass=file
Jan 12 14:35:58 dub-icess kernel: type=1400 audit(1294871758.116:97): avc:  denied  { read } for  pid=27897 comm="httpd" name="vhost-biogeog.ucsb.edu.conf" dev=dm-0 ino=2488012 scontext=root:system_r:httpd_t:s0 tcontext=root:object_r:tmp_t:s0 tclass=file
[
</pre> 
<a name="Tracking_.te_files" id="Tracking_.te_files" style="text-decoration:none; color:rgb(0,43,184); background-color:initial"></a> 
<h2 style="color:black; background-color:initial; font-weight:bold; margin-top:0px; margin-right:0px; margin-bottom:0.6em; margin-left:0px; padding-top:0.3em; padding-bottom:0.15em; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:rgb(170,170,170); font-size:19px"> <span class="mw-headline">Tracking .te files</span></h2> 
<a name="zanj:_arpwatch" id="zanj:_arpwatch" style="text-decoration:none; color:rgb(0,43,184); background-color:initial"></a> 
<h3 style="color:black; background-color:initial; font-weight:bold; margin-top:0px; margin-right:0px; margin-bottom:0.6em; margin-left:0px; padding-top:0.3em; padding-bottom:0.15em; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:rgb(170,170,170); font-size:15px"> <span class="mw-headline">zanj: arpwatch</span></h3> 
<pre style="padding-top:1em; padding-right:1em; padding-bottom:1em; padding-left:1em; border-top-width:1px; border-right-width:1px; border-bottom-width:1px; border-left-width:1px; border-top-style:dashed; border-right-style:dashed; border-bottom-style:dashed; border-left-style:dashed; border-top-color:rgb(47,111,171); border-right-color:rgb(47,111,171); border-bottom-color:rgb(47,111,171); border-left-color:rgb(47,111,171); color:black; background-color:rgb(249,249,249); line-height:1.1em">[root@zanj tmp]# cat eriarpwatch.te

module eriarpwatch 1.0;

require {
        type user_tmp_t;
        type arpwatch_t;
        class file { rename unlink };
}

#============= arpwatch_t ==============
allow arpwatch_t user_tmp_t:file { rename unlink };
</pre> 
<a name="nsm:_arpwatch" id="nsm:_arpwatch" style="text-decoration:none; color:rgb(0,43,184); background-color:initial"></a> 
<h3 style="color:black; background-color:initial; font-weight:bold; margin-top:0px; margin-right:0px; margin-bottom:0.6em; margin-left:0px; padding-top:0.3em; padding-bottom:0.15em; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:rgb(170,170,170); font-size:15px"> <span class="mw-headline">nsm: arpwatch</span></h3> 
<pre style="padding-top:1em; padding-right:1em; padding-bottom:1em; padding-left:1em; border-top-width:1px; border-right-width:1px; border-bottom-width:1px; border-left-width:1px; border-top-style:dashed; border-right-style:dashed; border-bottom-style:dashed; border-left-style:dashed; border-top-color:rgb(47,111,171); border-right-color:rgb(47,111,171); border-bottom-color:rgb(47,111,171); border-left-color:rgb(47,111,171); color:black; background-color:rgb(249,249,249); line-height:1.1em">[root@nsm tmp]# cat erinsmarpwatch.te

module erinsmarpwatch 1.0;

require {
        type postfix_local_t;
        type usr_t;
        class file getattr;
}

#============= postfix_local_t ==============
allow postfix_local_t usr_t:file getattr;
</pre> 
<p style="margin-top:0.4em; margin-bottom:0.5em; line-height:1.5em">still had problems after using above... got the next error combined in same file and generated new module... Possibly better ways to handle this, by setting the selinux attributes to allow postfix to deal with it, but not sure how to do that yet.</p> 
<pre style="padding-top:1em; padding-right:1em; padding-bottom:1em; padding-left:1em; border-top-width:1px; border-right-width:1px; border-bottom-width:1px; border-left-width:1px; border-top-style:dashed; border-right-style:dashed; border-bottom-style:dashed; border-left-style:dashed; border-top-color:rgb(47,111,171); border-right-color:rgb(47,111,171); border-bottom-color:rgb(47,111,171); border-left-color:rgb(47,111,171); color:black; background-color:rgb(249,249,249); line-height:1.1em">Jan 21 17:56:13 nsm kernel: type=1400 audit(1295661373.741:1565961): avc:  denied  { getattr } for  pid=23857 comm="local" path="/opt/local/home/arpwatch/.forward" dev=dm-0 ino=1930179 scontext=system_u:system_r:postfix_local_t:s0 tcontext=root:object_r:usr_t:s0 tclass=file
Jan 21 18:56:20 nsm kernel: type=1400 audit(1295664980.193:1565965): avc:  denied  { read } for  pid=24127 comm="local" name=".forward" dev=dm-0 ino=1930179 scontext=system_u:system_r:postfix_local_t:s0 tcontext=root:object_r:usr_t:s0 tclass=file
</pre> 
<pre style="padding-top:1em; padding-right:1em; padding-bottom:1em; padding-left:1em; border-top-width:1px; border-right-width:1px; border-bottom-width:1px; border-left-width:1px; border-top-style:dashed; border-right-style:dashed; border-bottom-style:dashed; border-left-style:dashed; border-top-color:rgb(47,111,171); border-right-color:rgb(47,111,171); border-bottom-color:rgb(47,111,171); border-left-color:rgb(47,111,171); color:black; background-color:rgb(249,249,249); line-height:1.1em">[root@nsm tmp]# cat eriarp | audit2allow -M erinsmarpwatch
******************** IMPORTANT ***********************
To make this policy package active, execute:

semodule -i erinsmarpwatch.pp

[root@nsm tmp]# cat erinsmarpwatch.te

module erinsmarpwatch 1.0;

require {
        type postfix_local_t;
        type usr_t;
        class file { read getattr };
}

#============= postfix_local_t ==============
allow postfix_local_t usr_t:file { read getattr };

</pre> 
<p style="margin-top:0.4em; margin-bottom:0.5em; line-height:1.5em">So, this got me further, but then I had issues with the the ~arpwatch procmail stuff. Set /selinux/enforce to 0 to see if things worked and then gathered up the avc messages and did this. Again... There should be a way to set the files I am concerned about to some other value using chcon or chcat...</p> 
<pre style="padding-top:1em; padding-right:1em; padding-bottom:1em; padding-left:1em; border-top-width:1px; border-right-width:1px; border-bottom-width:1px; border-left-width:1px; border-top-style:dashed; border-right-style:dashed; border-bottom-style:dashed; border-left-style:dashed; border-top-color:rgb(47,111,171); border-right-color:rgb(47,111,171); border-bottom-color:rgb(47,111,171); border-left-color:rgb(47,111,171); color:black; background-color:rgb(249,249,249); line-height:1.1em">[root@nsm tmp]# cat  erinsmarpwatch.te

module erinsmarpwatch 1.0;

require {
        type unconfined_t;
        type var_log_t;
        type tmp_t;
        type usr_t;
        type arpwatch_data_t;
        type var_t;
        type arpwatch_t;
        type postfix_master_t;
        type procmail_t;
        type postfix_local_t;
        class dir { write relabelto search add_name remove_name };
        class file { execute read create execute_no_trans write getattr link relabelto unlink append };
}

#============= arpwatch_t ==============
allow arpwatch_t var_t:file read;

#============= postfix_local_t ==============
allow postfix_local_t usr_t:file { read getattr };

#============= procmail_t ==============
allow procmail_t arpwatch_data_t:dir search;
allow procmail_t tmp_t:file getattr;
allow procmail_t usr_t:dir { write remove_name add_name };
allow procmail_t usr_t:file { write execute link append create unlink execute_no_trans };
allow procmail_t var_log_t:file { getattr append };

#============= unconfined_t ==============
allow unconfined_t postfix_master_t:dir relabelto;
allow unconfined_t postfix_master_t:file relabelto;
</pre> 
<p style="margin-top:0.4em; margin-bottom:0.5em; line-height:1.5em">This got me further, but then started seeing avc issues with running snmpwalk and other stuff associated with the switch search... Yeeeshhhhh.</p> 
<a name="Home_Directories" id="Home_Directories" style="text-decoration:none; color:rgb(0,43,184); background-color:initial"></a> 
<h2 style="color:black; background-color:initial; font-weight:bold; margin-top:0px; margin-right:0px; margin-bottom:0.6em; margin-left:0px; padding-top:0.3em; padding-bottom:0.15em; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:rgb(170,170,170); font-size:19px"> <span class="mw-headline">Home Directories</span></h2> 
<p style="margin-top:0.4em; margin-bottom:0.5em; line-height:1.5em">Was having some issue with local home directories on CentOS 6. Fudged the results by using an autofs_t, but the proper setting seems to be the one below.</p> 
<pre style="padding-top:1em; padding-right:1em; padding-bottom:1em; padding-left:1em; border-top-width:1px; border-right-width:1px; border-bottom-width:1px; border-left-width:1px; border-top-style:dashed; border-right-style:dashed; border-bottom-style:dashed; border-left-style:dashed; border-top-color:rgb(47,111,171); border-right-color:rgb(47,111,171); border-bottom-color:rgb(47,111,171); border-left-color:rgb(47,111,171); color:black; background-color:rgb(249,249,249); line-height:1.1em">chcon  -t user_home_dir_t &lt;homedir&gt;
</pre> 
<a name="Mounting_NFS_with_selinux_options" id="Mounting_NFS_with_selinux_options" style="text-decoration:none; color:rgb(0,43,184); background-color:initial"></a> 
<h2 style="color:black; background-color:initial; font-weight:bold; margin-top:0px; margin-right:0px; margin-bottom:0.6em; margin-left:0px; padding-top:0.3em; padding-bottom:0.15em; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:rgb(170,170,170); font-size:19px"> <span class="mw-headline">Mounting NFS with selinux options</span></h2> 
<pre style="padding-top:1em; padding-right:1em; padding-bottom:1em; padding-left:1em; border-top-width:1px; border-right-width:1px; border-bottom-width:1px; border-left-width:1px; border-top-style:dashed; border-right-style:dashed; border-bottom-style:dashed; border-left-style:dashed; border-top-color:rgb(47,111,171); border-right-color:rgb(47,111,171); border-bottom-color:rgb(47,111,171); border-left-color:rgb(47,111,171); color:black; background-color:rgb(249,249,249); line-height:1.1em">cat /etc/auto.direct
/krust/projects   -rw,context=system_u:object_r:httpd_sys_content_t     krust:/raid/crustal/mirrors/shale/web/projects/
</pre> 
<a name="HTTPD_issues_with_NFS_mounts" id="HTTPD_issues_with_NFS_mounts" style="text-decoration:none; color:rgb(0,43,184); background-color:initial"></a> 
<h2 style="color:black; background-color:initial; font-weight:bold; margin-top:0px; margin-right:0px; margin-bottom:0.6em; margin-left:0px; padding-top:0.3em; padding-bottom:0.15em; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:rgb(170,170,170); font-size:19px"> <span class="mw-headline">HTTPD issues with NFS mounts</span></h2> 
<p style="margin-top:0.4em; margin-bottom:0.5em; line-height:1.5em">On CentOS-6, I have not yet figured out how to get a direct autofs mount to work with httpd. Have had to resort to creating an auto.home entry to do that. Interestingly, dont need an actual account, just a map key and a place to mount from.</p> 
<br>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0e8543ed98d4b1e7a075938fb104883b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">博客搬家</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1683159c9274704c6434fb7612c7e391/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">在objc项目中使用常量</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>