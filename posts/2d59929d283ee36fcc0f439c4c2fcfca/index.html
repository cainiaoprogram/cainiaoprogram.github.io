<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>计算机网络总结：第四章 网络层 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="计算机网络总结：第四章 网络层" />
<meta property="og:description" content="第四章 网络层 4.1 概述 4.1.1 转发和路由选择 转发（forwarding）：当一个分组到达路由器的一条输入链路时，路由器必须将该分组移动到适当的输出链路路由选择（routing）：当分组从发送方流向接收方时，网络层必须决定这些分组所采用的路由或路径连接建立：网络层第三个重要的网络功能
–网络层的连接：一对节点之间的连接，所有属于这个连接的数据包遵循同一条路径
–传输层的连接：进程之间的连接，同一个数据包可能在网络层经不同路径 4.1.2 网络服务模型：定义了分组在发送与接收端系统之间的端到端运输特性 提供的服务
–确保交付
–具有时延上界的确保交付
–有序分组交付
–确保最小带宽
–确保最大时延抖动
–安全性服务两个最重要的ATM服务模型
–恒定比特率
–可用比特率 4.2 虚电路和数据报网络 网络层能在两台主机之间提供无连接服务或连接服务，连接服务以源和目的主机间的握手开始，无连接服务则没有任何握手预备步骤网络层和运输层在面向连接和无连接服务的差异
–在网络层，这些服务是由网络层向运输层提供的主机到主机的服务。在运输层中，这些服务则是运输层向应用层提供的进程到进程的服务
–网络层不能同时提供两种服务（面向连接的、无连接的）。仅在网络层提供连接服务的计算机网络称为虚电路（Virtual-Circuit，VC）网络；仅在网络层提供无连接五福的计算机网络称为数据报（datagram network）网络
–网络层连接服务除了在端系统中，也在位于网络核心的路由器中实现；运输层面向连接服务是在位于网络边缘 4.2.1 虚电路网络 虚电路的组成
–源和目的主机之间的路径
–VC号，沿着该路径的每段链路的一个号码
–沿着该路径的每台路由器的转发表表项虚电路中有3个明显不同的阶段
–虚电路建立
–数据传送
–虚电路拆除 4.2.2 数据报网络 每当一个端系统要发送分组，它就为该分组加上目的端系统的地址，然后将分组推进网络中。当分组从源到目的地传输，它通过一系列路由器传递。这些路由器中的每台都使用分组的目的地址来转发该分组 4.3 路由器工作原理 组成成分：输入端口，交换结构，输出端口，路由选择处理器关键功能：运行路由算法/协议（RIP，OSPF，BGP），将数据报从入链路传到出链路
4.3.1 输入端口 4.3.2 交换结构 经内存交换
–最简单、最早的路由器是传统的计算机，交换是在CPU的直接控制下完成的
–数据包被复制到系统的内存中
–速度受内存带宽限制（2个总线交叉/数据报）经总线交换
–输入端口经一根共享总线将分组直接传送到输出端口
–交换带宽受总线速率的限制经互联网络交换
–克服总线带宽限制
–将数据报分段为固定长度的单元，通过结构切换单元。 4.3.3 输出端口 4.3.4 何处出现排队 4.4 网际协议（IP） 4.4.1 数据包格式 IP数据报分片
–链路层协议能承受的网络层分组长度不同，一个链路层帧能承载的最大数据量叫做最大传送单元（Maximum Transmission Unit，MTU）
–过大的IP数据报会被分成多个较小的数据报（称为fragment，片）
说明：
–ID是初始数据报的标识号" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/2d59929d283ee36fcc0f439c4c2fcfca/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-09-22T00:34:50+08:00" />
<meta property="article:modified_time" content="2019-09-22T00:34:50+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">计算机网络总结：第四章 网络层</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="__0"></a>第四章 网络层</h3> 
<h4><a id="41__1"></a>4.1 概述</h4> 
<h5><a id="411__2"></a>4.1.1 转发和路由选择</h5> 
<ul><li>转发（forwarding）：当一个分组到达路由器的一条输入链路时，路由器必须将该分组移动到适当的输出链路</li><li>路由选择（routing）：当分组从发送方流向接收方时，网络层必须决定这些分组所采用的路由或路径</li><li>连接建立：网络层第三个重要的网络功能<br> –网络层的连接：一对节点之间的连接，所有属于这个连接的数据包遵循同一条路径<br> –传输层的连接：进程之间的连接，同一个数据包可能在网络层经不同路径</li></ul> 
<h5><a id="412__8"></a>4.1.2 网络服务模型：定义了分组在发送与接收端系统之间的端到端运输特性</h5> 
<ul><li>提供的服务<br> –确保交付<br> –具有时延上界的确保交付<br> –有序分组交付<br> –确保最小带宽<br> –确保最大时延抖动<br> –安全性服务</li><li>两个最重要的ATM服务模型<br> –恒定比特率<br> –可用比特率</li></ul> 
<h4><a id="42__19"></a>4.2 虚电路和数据报网络</h4> 
<ul><li>网络层能在两台主机之间提供无连接服务或连接服务，连接服务以源和目的主机间的握手开始，无连接服务则没有任何握手预备步骤</li><li>网络层和运输层在面向连接和无连接服务的差异<br> –在网络层，这些服务是由网络层向运输层提供的主机到主机的服务。在运输层中，这些服务则是运输层向应用层提供的进程到进程的服务<br> –网络层不能同时提供两种服务（面向连接的、无连接的）。仅在网络层提供连接服务的计算机网络称为虚电路（Virtual-Circuit，VC）网络；仅在网络层提供无连接五福的计算机网络称为数据报（datagram network）网络<br> –网络层连接服务除了在端系统中，也在位于网络核心的路由器中实现；运输层面向连接服务是在位于网络边缘</li></ul> 
<h5><a id="421__25"></a>4.2.1 虚电路网络</h5> 
<ul><li>虚电路的组成<br> –源和目的主机之间的路径<br> –VC号，沿着该路径的每段链路的一个号码<br> –沿着该路径的每台路由器的转发表表项</li><li>虚电路中有3个明显不同的阶段<br> –虚电路建立<br> –数据传送<br> –虚电路拆除</li></ul> 
<h5><a id="422__34"></a>4.2.2 数据报网络</h5> 
<ul><li>每当一个端系统要发送分组，它就为该分组加上目的端系统的地址，然后将分组推进网络中。当分组从源到目的地传输，它通过一系列路由器传递。这些路由器中的每台都使用分组的目的地址来转发该分组</li></ul> 
<h4><a id="43__36"></a>4.3 路由器工作原理</h4> 
<ul><li>组成成分：输入端口，交换结构，输出端口，路由选择处理器</li><li>关键功能：运行路由算法/协议（RIP，OSPF，BGP），将数据报从入链路传到出链路<br> <img src="https://images2.imgbox.com/c0/c7/x8HGkOC4_o.png" alt="在这里插入图片描述"></li></ul> 
<h5><a id="431__40"></a>4.3.1 输入端口</h5> 
<p><img src="https://images2.imgbox.com/79/52/wfcQ5R8R_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="432__42"></a>4.3.2 交换结构</h5> 
<p><img src="https://images2.imgbox.com/30/7c/C24yRLhZ_o.png" alt="在这里插入图片描述"></p> 
<ul><li>经内存交换<br> –最简单、最早的路由器是传统的计算机，交换是在CPU的直接控制下完成的<br> –数据包被复制到系统的内存中<br> –速度受内存带宽限制（2个总线交叉/数据报）</li><li>经总线交换<br> –输入端口经一根共享总线将分组直接传送到输出端口<br> –交换带宽受总线速率的限制</li><li>经互联网络交换<br> –克服总线带宽限制<br> –将数据报分段为固定长度的单元，通过结构切换单元。</li></ul> 
<h5><a id="433__54"></a>4.3.3 输出端口</h5> 
<p><img src="https://images2.imgbox.com/da/b5/KWPd4CLA_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="434__56"></a>4.3.4 何处出现排队</h5> 
<p><img src="https://images2.imgbox.com/26/6c/uUTr2ajg_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/c4/cd/SQNaJIXQ_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/91/5e/qR0DPVFY_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="44_IP_59"></a>4.4 网际协议（IP）</h4> 
<h5><a id="441__60"></a>4.4.1 数据包格式</h5> 
<p><img src="https://images2.imgbox.com/66/58/qH5xwcDA_o.png" alt="在这里插入图片描述"></p> 
<ul><li>IP数据报分片<br> –链路层协议能承受的网络层分组长度不同，一个链路层帧能承载的最大数据量叫做最大传送单元（Maximum Transmission Unit，MTU）<br> –过大的IP数据报会被分成多个较小的数据报（称为fragment，片）<br> <img src="https://images2.imgbox.com/f5/ea/MajZHLmK_o.png" alt="在这里插入图片描述"></li><li>说明：<br> –ID是初始数据报的标识号<br> –fragflag=1说明后面还有别的数据报，fragflag=0说明这是最后一个数据报<br> –offset指定该片应放在初始IP数据报的哪个位置</li></ul> 
<h5><a id="442_IPv4_70"></a>4.4.2 IPv4编址</h5> 
<ul><li>概念<br> –IP地址：主机的32位标识符，路由器接口<br> –接口（interface）：主机/路由器与物理链路之间的连接<br> A）路由器通常有多个接口<br> B）主机通常有一个接口<br> –IP地址与每个接口关联</li><li>子网<br> <img src="https://images2.imgbox.com/4e/e6/fb5uzAJJ_o.png" alt="在这里插入图片描述"></li><li>子网掩码（例子）：233.1.1.0/24，其中的/24记法有时称为子网掩码，它指示了32比特中的最左侧24比特定义了子网地址</li><li>因特网的地址分配策略：无类别域间路由选择（Classless Interdomain Routing，CIDR），对于子网寻址，32比特的IP地址被划分为两个部分，并且也具有点分十进制数形式a.b.c.d/x，其中x指示了地址的第一部分中的比特数，32-x比特用于区分该组织的内部设备<br> <img src="https://images2.imgbox.com/27/e2/ns2bWJ69_o.png" alt="在这里插入图片描述"></li><li>获取一块地址<br> –因特网名字和编号分配机构<br> 即ICANN（Internet Corporation for Assigned Names and Numbers）<br> A）分配地址<br> B）管理DNS<br> C）分配域名，解决争议</li><li>获取主机地址：动态主机配置协议（分配公网IP）<br> –动态主机配置协议，即DHCP（Dynamic Host Configuration Protocol）<br> A）允许主机自动获取（被分配）一个IP地址<br> B）也被称为即插即用协议（plug-and-play protocol）<br> –它是客户端 - 服务器协议<br> <img src="https://images2.imgbox.com/99/3b/d4KoVfIb_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/36/29/qu6lEVKt_o.png" alt="在这里插入图片描述"></li><li>网络地址转换（Network Address Translation，NAT）（分配私网IP）<br> –所有离开本地的数据报有着相同的源NAT IP地址，不同的端口号<br> –不同内部主机由NAT转发表来区分<br> –本地网内的设备无法明确地寻址，外界看不到<br> –16位端口号字段，即单个LAN端地址同时连接60,000个<br> <img src="https://images2.imgbox.com/8e/6b/esu1njWM_o.png" alt="在这里插入图片描述"></li><li>UPnP：是一种允许主机发现并配置邻近NAT的协议</li></ul> 
<h5><a id="443_ICMP_101"></a>4.4.3 因特网控制报文协议（ICMP）</h5> 
<ul><li>被主机和路由器用来彼此沟通网络层的信息<br> A）错误报文：无法访问的主机，网络，端口，协议<br> B）echo请求/回复（由ping使用）</li></ul> 
<h5><a id="444_IPv6_106"></a>4.4.4 IPv6</h5> 
<ul><li>实现动机：IPv4的32位地址空间将耗尽</li><li>IPv6数据报格式<br> <img src="https://images2.imgbox.com/2f/fe/4okxSSAq_o.png" alt="在这里插入图片描述"><br> –首部仅有40字节<br> –有效载荷长度：16比特，给出IPv6数据报中跟在首部后面的字节数量<br> –跳限制：转发数据报的每台路由器将对该字段的内容减1。如果跳限制计数到达0，则该数据报将被丢弃<br> –删除了分片重新组装、首部校验和，选项功能</li><li>从IPv4到IPv6的迁移<br> –建隧道（tunneling）<br> <img src="https://images2.imgbox.com/35/e8/UbVe4nPY_o.png" alt="在这里插入图片描述"></li></ul> 
<h4><a id="45__117"></a>4.5 路由选择算法</h4> 
<ul><li>根据算法是全局式还是分散式区分<br> –全局式路由选择算法（global routing algorithm）：用完整的、全局的网络知识计算出源到目的地之间的最低费用路径。该算法常被称作链路状态算法，它必须知道网络中每条链路的费用<br> –分散式路由选择算法（decentralized routing algorithm）：以迭代式、分布式的方式计算出最低费用路径。例子：距离向量算法（Distance-Vector，DV），每个节点维护到网络中所有其他节点的费用估计的向量</li><li>根据算法是静态还是动态区分<br> –静态路由选择算法（static routing algorithm）：路由的变化非常缓慢<br> –动态路由选择算法（dynamic routing algorithm）：周期性地运行或直接响应拓扑或链路费用的变化而运行</li><li>根据算法是负载敏感的还是负载迟钝的<br> –负载敏感算法（load-sensitive algorithm）：链路费用会动态地变化以反映出底层链路的当前拥塞水平<br> –负载迟钝算法（load-insensitive algorithm）：链路的费用不明显的反映当前（最近）的拥塞水平【当前因特网路由选择算法都是负载迟钝的】</li></ul> 
<h5><a id="451_LS_127"></a>4.5.1 链路状态路由选择算法（LS）</h5> 
<ul><li>Dijkstra算法（最短路径）<br> <img src="https://images2.imgbox.com/62/bb/T0lc2k5l_o.png" alt="在这里插入图片描述"><br> –D(v)：到算法的本次迭代，从源结点到目的结点v的最低费用路径的费用<br> –p(v)：从源到v沿着当前最低费用路径的前一结点（v的邻居）<br> –N’：结点子集；如果从源到v的最低费用路径已确知，v在N’中</li></ul> 
<h5><a id="452_DV_133"></a>4.5.2 距离向量路由选择算法（DV）</h5> 
<p><img src="https://images2.imgbox.com/11/e4/rK1NR76k_o.png" alt="在这里插入图片描述"></p> 
<ul><li>它是分布式的、迭代的、异步的<br> <img src="https://images2.imgbox.com/09/19/yZulGZEH_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/7e/8a/j3VHeUii_o.png" alt="在这里插入图片描述"></li><li>LS和DV的对比<br> <img src="https://images2.imgbox.com/35/54/80ZtI1P1_o.png" alt="在这里插入图片描述"></li></ul> 
<h5><a id="453__139"></a>4.5.3 层次路由选择</h5> 
<ul><li>问题：规模（路由器数目很大），管理自治</li><li>解决方案：自治系统（Autonomous System，AS）<br> –在相同的AS中的路由器全部运行相同的路由选择算法<br> –在一个自治系统内运行的路由选择算法叫做自治系统内部路由选择协议（“intra-AS” routing protocol）<br> –负责向本AS之外的目的地转发分组的路由器叫做网关路由器（gateway router）<br> –实践中，AS之间转发分组采用热土豆路由选择方法，即将分组转发给具有最小的最低费用的网关</li></ul> 
<h4><a id="46__146"></a>4.6 因特网中的路由选择</h4> 
<h5><a id="461_RIP_147"></a>4.6.1 因特网中自治系统内部的路由选择：RIP</h5> 
<ul><li>AS内部路由选择协议也被称为内部网关协议</li><li>路由选择协议（Routing Information Protocol，RIP）<br> –RIP路由器大约每30秒互相交互通告<br> –如果一台路由器一旦超过180秒没有从邻居听到报文，则该邻居不再被认为是可到达的<br> <img src="https://images2.imgbox.com/f3/62/U0b9z5ZA_o.png" alt="在这里插入图片描述"></li></ul> 
<h5><a id="462_OSPF_154"></a>4.6.2 因特网中自治系统内部的路由选择：OSPF</h5> 
<ul><li>开放最短路优先（Open Shortest Path First，OSPF）<br> –简介<br> <img src="https://images2.imgbox.com/b4/30/c9KhsBSK_o.png" alt="在这里插入图片描述"><br> –优点<br> <img src="https://images2.imgbox.com/80/72/BUx4c4ZK_o.png" alt="在这里插入图片描述"></li></ul> 
<h5><a id="463_BGPBorder_Gateway_Protocol_160"></a>4.6.3 自治系统间的路由选择：BGP（Border Gateway Protocol）</h5> 
<ul><li>为每个AS提供进行以下工作的手段：<br> –从相邻AS处获得子网可达性信息<br> –向本AS内部的所有路由器传播这些可达性信息<br> –基于可达性信息和AS策略，决定到达子网的“好”路由</li><li>基础<br> –对于每条TCP连接，位于该连接端点的两台路由器称为BGP对等方（BGP peers）<br> –沿着该连接发送的所有BGP报文的TCP连接称为BGP会话（BGP session）<br> –跨越两个AS的BGP会话称为外部BGP（eBGP）会话<br> –在同一个AS中的两台路由器之间的BGP会话称为内部BGP（iBGP）会话<br> –CDIR化的前缀（prefix）使得每个AS知道其相邻AS可到达哪个目的地</li><li>路径属性和BGP路由<br> –每个AS都有其全局唯一的自治系统号（ASN）【除了桩（stub）AS】<br> –当一台路由器通过BGP会话通告一个前缀时，它在前缀中包含一些BGP属性。带有属性的前缀称为一条路由（router）<br> –AS-PATH：包含前缀通告已经通过的AS<br> –NEXT-HOP：表示下一跳AS的特定内部AS路由器。（可以是从当前AS到下一跳AS的多条链路）<br> –网关路由器接收一台路由器通告时，它使用输入策略（import policy）</li><li>BGP路由选择<br> <img src="https://images2.imgbox.com/ce/4d/Esmsdm9i_o.png" alt="在这里插入图片描述"></li><li>路由选择策略<br> <img src="https://images2.imgbox.com/d2/34/KJPzsAHQ_o.png" alt="在这里插入图片描述"></li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a68e19730c9de2cea1448bdc40d5e905/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">java中某个类实例.getClass().getName()取得的类名字，用split(&#34;.&#34;)分割后，获取不到分割后的数组</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2fbc41a25b0fa71f00feb1f7aad5f2b4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">一条超级简单的故意让linux死机/宕机的命令</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>