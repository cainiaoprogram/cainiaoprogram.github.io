<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>docker k8s 命令总结 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="docker k8s 命令总结" />
<meta property="og:description" content="学习文档 云原生实战笔记
欢迎关注 迪答数据 公众号 ，更多技术、数据学习资源点击链接扫码关注！！！
数据分析从入门到进阶的必看书单！文末附所有200本书籍的PDF下载https://mp.weixin.qq.com/s?__biz=Mzk0NDEwNTE4OQ==&amp;mid=2247485504&amp;idx=3&amp;sn=883a57602a9051079b34752a75d7d027&amp;chksm=c328fbcaf45f72dc293ef3d47e8dd4b7ffc7c0fde70ccf5404f5b0d629d78cab43c52d631069&amp;token=118918614&amp;lang=zh_CN#rd
一 、 docker 常用基础命令 1.进入容器内部的系统，修改容器内容
docker exec -it 容器id /bin/bash 2.提交修改好的镜像
//提交镜像修改 docker commit -a &#34;用户名&#34; -m &#34;提交注释&#34; -m 容器id 3. 查看当前的镜像
docker images 4.将镜像保存为压缩包 可以供其他机器加载
docker save -o abc.tar didamysql:v1.0 //在别的机器加载 docker load -i abc.tar 5.推送远程仓库
docker tag 本地镜像:v1.0 远程仓库名:镜像名:v1.2 //类似于将本地镜像名改为远程指定名字，因为需要带有远程仓库的类似于用户标识，才能被远程镜像仓库识别 docker login 登录远程仓库 docker logout （推送完成后退出） docker push 远程仓库名:镜像名:v1.2(也就是新改的名字) 6.拉取镜像 到本地
docker pull 远程仓库认证路径:镜像名:v1.2 docker pull dida/my-repo:mysql:v1.2 7.运行镜像 docker run -d(后台运行) -p80:80(端口映射，端口暴露，机器的端口映射到容器端口) 镜像名:版本号 #es docker启动步骤 # 创建数据目录 mkdir -p /mydata/es-01 &amp;&amp; chmod 777 -R /mydata/es-01 # 容器启动 docker run --restart=always -d -p 9200:9200 -p 9300:9300 \ -e &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/c65ae411cd030b89ddc78106a22ab477/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-25T16:03:46+08:00" />
<meta property="article:modified_time" content="2023-07-25T16:03:46+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">docker k8s 命令总结</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>学习文档</h2> 
<p><a class="link-info" href="https://www.yuque.com/leifengyang/oncloud/mbvigg" rel="nofollow" title="云原生实战笔记">云原生实战笔记</a></p> 
<p></p> 
<p><strong> 欢迎关注 <span style="color:#ed7976;">迪答数据 </span>公众号 ，更多技术、数据学习资源点击链接扫码关注！！！</strong></p> 
<p><strong><strong><a class="link-info has-card" href="https://mp.weixin.qq.com/s?__biz=Mzk0NDEwNTE4OQ==&amp;mid=2247485504&amp;idx=3&amp;sn=883a57602a9051079b34752a75d7d027&amp;chksm=c328fbcaf45f72dc293ef3d47e8dd4b7ffc7c0fde70ccf5404f5b0d629d78cab43c52d631069&amp;token=118918614&amp;lang=zh_CN#rd" rel="nofollow" title="数据分析从入门到进阶的必看书单！文末附所有200本书籍的PDF下载"><span class="link-card-box"><span class="link-title">数据分析从入门到进阶的必看书单！文末附所有200本书籍的PDF下载</span><span class="link-link"><img alt="" class="link-link-icon" src="https://images2.imgbox.com/15/95/q84bWADG_o.png">https://mp.weixin.qq.com/s?__biz=Mzk0NDEwNTE4OQ==&amp;mid=2247485504&amp;idx=3&amp;sn=883a57602a9051079b34752a75d7d027&amp;chksm=c328fbcaf45f72dc293ef3d47e8dd4b7ffc7c0fde70ccf5404f5b0d629d78cab43c52d631069&amp;token=118918614&amp;lang=zh_CN#rd</span></span></a></strong></strong></p> 
<p></p> 
<h2>一 、 docker 常用基础命令</h2> 
<p>1.进入容器内部的系统，修改容器内容</p> 
<pre><code class="language-bash">docker exec -it 容器id /bin/bash</code></pre> 
<p>2.提交修改好的镜像</p> 
<pre><code class="language-bash">//提交镜像修改
docker commit -a "用户名" -m "提交注释" -m  容器id </code></pre> 
<p>3. 查看当前的镜像</p> 
<pre><code class="language-bash">docker images</code></pre> 
<p>4.将镜像保存为压缩包 可以供其他机器加载</p> 
<pre><code class="language-bash">docker  save -o abc.tar didamysql:v1.0

//在别的机器加载 

docker load -i abc.tar</code></pre> 
<p>5.推送远程仓库</p> 
<pre><code class="language-bash">
docker tag 本地镜像:v1.0 远程仓库名:镜像名:v1.2  //类似于将本地镜像名改为远程指定名字，因为需要带有远程仓库的类似于用户标识，才能被远程镜像仓库识别


docker login 登录远程仓库 

docker logout （推送完成后退出）

docker push  远程仓库名:镜像名:v1.2(也就是新改的名字)

</code></pre> 
<p>6.拉取镜像 到本地</p> 
<pre><code class="language-bash">docker pull  远程仓库认证路径:镜像名:v1.2

docker pull  dida/my-repo:mysql:v1.2</code></pre> 
<p>7.运行镜像 </p> 
<pre><code class="language-bash">docker run -d(后台运行) -p80:80(端口映射，端口暴露，机器的端口映射到容器端口) 镜像名:版本号</code></pre> 
<pre><code class="language-bash">#es docker启动步骤

# 创建数据目录
mkdir -p /mydata/es-01 &amp;&amp; chmod 777 -R /mydata/es-01

# 容器启动
docker run --restart=always -d -p 9200:9200 -p 9300:9300 \
-e "discovery.type=single-node" \
-e ES_JAVA_OPTS="-Xms512m -Xmx512m" \
-v es-config:/usr/share/elasticsearch/config \
-v /mydata/es-01/data:/usr/share/elasticsearch/data \
--name es-01 \
elasticsearch:7.13.4


//其中 -e 为要指定的变量</code></pre> 
<p>8.挂载数据</p> 
<pre><code class="language-bash">docker run --name mysqlsql -v 本地路径:容器中文件:ro（只读模式） -d 镜像名称</code></pre> 
<p>9.查看当前运行的容器</p> 
<pre><code class="language-bash">docker ps
</code></pre> 
<p>10.查看容器运行的日志</p> 
<pre><code class="language-bash">docker logs -f(监听着)  容器id</code></pre> 
<p>11.指定容器中文件复制出来</p> 
<pre><code class="language-bash">docker  cp 容器id:容器文件路径 /data/conf/config.conf(本地路径)

//反过来写就是将本地的文件复制到容器中
docker cp  /data/conf/config.conf(本地路径) 容器id:容器文件路径 

</code></pre> 
<p> 一般运行的时候都是挂载配置文件，数据库则另外挂载数据，保证持久化</p> 
<p>12.docker 启动命令且要开机启动</p> 
<pre><code class="language-bash">systemctl enable docker --now
</code></pre> 
<h2></h2> 
<h2>二 、 构建镜像相关</h2> 
<p>1.dockerfile  模板</p> 
<pre><code class="language-html">FROM openjdk:8-jdk-slim
LABLE maintainer=dida

COPY 本地文件.jar  /test.jar

ENTRYPOINT ["java","-jar","/test.jar"]</code></pre> 
<p>2.docker 镜像构建</p> 
<pre><code class="language-bash">docker build -t java-test:v1.0 [Dockerfile]（如果文件名就是dockerfile可以不写） .(需要有点 当前目录下)</code></pre> 
<p></p> 
<h2>三、k8s</h2> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/de/f9/1ce4kfKM_o.jpg"></p> 
<p></p> 
<p>1.启动一个应用</p> 
<pre><code class="language-bash">kubectl create deploy myapp --image==nginx

kubectl create deployment mynginx --image=nginx -- replicas=3</code></pre> 
<p>2.执行yaml 创建应用</p> 
<pre><code class="language-bash">kubectl apply -f calico.yaml

kubectl  delete -f  calico.yaml 删除指定的应用</code></pre> 
<p>k8s中对于资源的创建，可以通过命令行的方式进行，也可以都通过执行yaml文件的方式。</p> 
<p></p> 
<p>3.查看集群中有多少应用</p> 
<pre><code class="language-bash">kubectl  get pods -A (查看所有的)

kubectl  get pods -A (查看所有的) -w(阻塞住，可以一直监听着状态的变化)

watch -n 1 kubectl get pod (每秒都打印一下pod信息)</code></pre> 
<p>4.获取指定用户的访问令牌 token</p> 
<pre><code class="language-bash">token 获取脚本  kubectl -n kube-system describe secret $(kubectl -n kube-system get secret | grep admin | awk '{print $1}')</code></pre> 
<p><img alt="" height="162" src="https://images2.imgbox.com/d3/e1/olMHt08d_o.png" width="802"></p> 
<p> 5.查看pod的详细信息</p> 
<pre><code class="language-bash">kubectl describe pod pod-name

//查看pod日志
kubectl logs pod-name</code></pre> 
<p>6.查看 pod 信息</p> 
<pre><code class="language-bash">kubectl get pod -0wide</code></pre> 
<p>7.进入到pod中</p> 
<pre><code class="language-bash">kubectl exec -it pod-name -- /bin/bash</code></pre> 
<p>8.一个pod两个容器多个容器 yaml 编写</p> 
<pre><code class="language-html">apiVersion: v1
kind: Pod
metadata:
  labels:
    run: myapp
  name: myapp
spec:
  containers:
  - image: nginx
    name: nginx
  - image: tomcat:8.5.68
    name: tomcat</code></pre> 
<p>9.扩缩容</p> 
<pre><code class="language-bash">kubectl scale deploy/my-dep -- replicas = 5

//缩容
kubectl scale deploy/my-dep -- replicas =1</code></pre> 
<p>10.修改pod运行的镜像</p> 
<pre><code class="language-bash">kubectl set image deploy/my-dep nginx=nginx:1.16.1  --record</code></pre> 
<p>11.工作负载，几种部署模式</p> 
<p><img alt="" height="609" src="https://images2.imgbox.com/e6/9a/F8cw7PeN_o.png" width="1080"></p> 
<h3> service</h3> 
<p>12.创建service 暴露映射端口</p> 
<pre><code class="language-bash">kubectl expose deploy my-dep --port=8000(service 暴露的端口) --target-port = pod映射的端口 --type = Nodeport 这样集群外也可以访问了，默认是 cluster-ip只能在集群内访问

默认service 暴露的端口范围 30000~32767之间</code></pre> 
<p><img alt="" height="107" src="https://images2.imgbox.com/4f/b6/vSoSAKqM_o.png" width="832"></p> 
<p></p> 
<p> 每一组pod都有对应的标签，根据标签暴露对应的pod端口；</p> 
<p>域名可以在pod内访问，但是在节点就不太行需要绑定；</p> 
<p>service 就是实现了负载均衡</p> 
<h3>ingress</h3> 
<p> 13. ingress网络作用</p> 
<p><img alt="" height="847" src="https://images2.imgbox.com/44/4e/NfTnLVvC_o.png" width="1200"></p> 
<p> 14.ingress 绑定服务端口，yaml配置</p> 
<pre><code class="language-bash">apiVersion: networking.k8s.io/v1
kind: Ingress  
metadata:
  name: ingress-host-bar
spec:
  ingressClassName: nginx
  rules:
  - host: "hello.atguigu.com"
    http:
      paths:
      - pathType: Prefix
        path: "/"
        backend:
          service:
            name: hello-server
            port:
              number: 8000
  - host: "demo.atguigu.com"
    http:
      paths:
      - pathType: Prefix
        path: "/nginx"  # 把请求会转给下面的服务，下面的服务一定要能处理这个路径，不能处理就是404
        backend:
          service:
            name: nginx-demo  ## java，比如使用路径重写，去掉前缀nginx
            port:
              number: 8000</code></pre> 
<h3>存储 nfs 挂载pv/pvc</h3> 
<p> 14.原生方式挂载 nfs 的yaml配置</p> 
<pre><code class="language-TypeScript">apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: nginx-pv-demo
  name: nginx-pv-demo
spec:
  replicas: 2
  selector:
    matchLabels:
      app: nginx-pv-demo
  template:
    metadata:
      labels:
        app: nginx-pv-demo
    spec:
      containers:
      - image: nginx
        name: nginx
        volumeMounts:
        - name: html
          mountPath: /usr/share/nginx/html
      volumes:
        - name: html
          nfs:
            server: 172.31.0.4
            path: /nfs/data/nginx-pv</code></pre> 
<p>15.pv/pvc</p> 
<p><img alt="" height="670" src="https://images2.imgbox.com/e6/fd/Eco2AgNA_o.png" width="1200"></p> 
<p>14.创建pv yaml</p> 
<pre><code class="language-TypeScript">apiVersion: v1
kind: PersistentVolume
metadata:
  name: pv01-10m
spec:
  capacity:
    storage: 10M
  accessModes:
    - ReadWriteMany
  storageClassName: nfs
  nfs:
    path: /nfs/data/01
    server: 172.31.0.4
---
apiVersion: v1
kind: PersistentVolume
metadata:
  name: pv02-1gi
spec:
  capacity:
    storage: 1Gi
  accessModes:
    - ReadWriteMany
  storageClassName: nfs
  nfs:
    path: /nfs/data/02
    server: 172.31.0.4
---
apiVersion: v1
kind: PersistentVolume
metadata:
  name: pv03-3gi
spec:
  capacity:
    storage: 3Gi
  accessModes:
    - ReadWriteMany
  storageClassName: nfs
  nfs:
    path: /nfs/data/03
    server: 172.31.0.4</code></pre> 
<p> 15.获取当前的pv 情况</p> 
<pre><code class="language-bash">kubectl get persistentvolume</code></pre> 
<p> 16.pod绑定pvc</p> 
<pre><code class="language-TypeScript">apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: nginx-deploy-pvc
  name: nginx-deploy-pvc
spec:
  replicas: 2
  selector:
    matchLabels:
      app: nginx-deploy-pvc
  template:
    metadata:
      labels:
        app: nginx-deploy-pvc
    spec:
      containers:
      - image: nginx
        name: nginx
        volumeMounts:
        - name: html
          mountPath: /usr/share/nginx/html
      volumes:
        - name: html
          persistentVolumeClaim:
            claimName: nginx-pvc</code></pre> 
<p>17.创建配置集yaml文件</p> 
<pre><code class="language-bash">kubectl cm redis-conf --from=redis.conf</code></pre> 
<p><img alt="" height="204" src="https://images2.imgbox.com/1c/c1/6cYB2zqF_o.png" width="852"></p> 
<p>17.config yaml</p> 
<pre><code class="language-bash">apiVersion: v1
data:    #data是所有真正的数据，key：默认是文件名   value：配置文件的内容
  redis.conf: |
    appendonly yes
kind: ConfigMap
metadata:
  name: redis-conf
  namespace: default</code></pre> 
<p>18. pod yaml 和对应的config绑定</p> 
<pre><code class="language-bash">apiVersion: v1
kind: Pod
metadata:
  name: redis
spec:
  containers:
  - name: redis
    image: redis
    command:
      - redis-server
      - "/redis-master/redis.conf"  #指的是redis容器内部的位置
    ports:
    - containerPort: 6379
    volumeMounts:
    - mountPath: /data
      name: data
    - mountPath: /redis-master
      name: config
  volumes:
    - name: data
      emptyDir: {}
    - name: config
      configMap:
        name: redis-conf
        items:
        - key: redis.conf
          path: redis.conf</code></pre> 
<p><img alt="" height="532" src="https://images2.imgbox.com/01/0f/4BVNHCYD_o.png" width="1047"></p> 
<p></p> 
<p>19.导出对应应用的yaml 文件</p> 
<pre><code class="language-bash">kubectl get service serviceName -o yaml &gt; backup.yaml</code></pre> 
<p></p> 
<h2>四、maven</h2> 
<p>1.maven 打包命令</p> 
<pre><code class="hljs">mvn clean package -Dmaven.test.skip = true</code></pre> 
<p> </p> 
<p></p> 
<p></p> 
<p><strong>k8s笔记：</strong></p> 
<p>1.<a class="link-info" href="https://blog.csdn.net/HD0do/article/details/128001437?spm=1001.2014.3001.5501" title="k8s 资源管理及查看命令">k8s 资源管理及查看命令</a></p> 
<p>2.<a class="link-info" href="https://blog.csdn.net/HD0do/article/details/127969788?spm=1001.2014.3001.5501" title="python 通过k8s API采集k8s 集群信息">python 通过k8s API采集k8s 集群信息</a></p> 
<p><br>  </p> 
<p><strong>  欢迎关注 <span style="color:#ed7976;">迪答数据 </span>公众号 ，更多技术、数据学习资源点击链接扫码关注！！！</strong></p> 
<p><strong><strong><strong><strong><a class="link-info has-card" href="https://mp.weixin.qq.com/s?__biz=Mzk0NDEwNTE4OQ==&amp;mid=2247485504&amp;idx=3&amp;sn=883a57602a9051079b34752a75d7d027&amp;chksm=c328fbcaf45f72dc293ef3d47e8dd4b7ffc7c0fde70ccf5404f5b0d629d78cab43c52d631069&amp;token=118918614&amp;lang=zh_CN#rd" rel="nofollow" title="数据分析从入门到进阶的必看书单！文末附所有200本书籍的PDF下载"><span class="link-card-box"><span class="link-title">数据分析从入门到进阶的必看书单！文末附所有200本书籍的PDF下载</span><span class="link-link"><img alt="" class="link-link-icon" src="https://images2.imgbox.com/aa/59/hEzMYzvL_o.png">https://mp.weixin.qq.com/s?__biz=Mzk0NDEwNTE4OQ==&amp;mid=2247485504&amp;idx=3&amp;sn=883a57602a9051079b34752a75d7d027&amp;chksm=c328fbcaf45f72dc293ef3d47e8dd4b7ffc7c0fde70ccf5404f5b0d629d78cab43c52d631069&amp;token=118918614&amp;lang=zh_CN#rd</span></span></a></strong></strong></strong></strong></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5b49a57d19994ecd4086b893842973ab/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Halcon 最大内接圆检测</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3ab4b4ef1d4ad5f4a34a17aec53da107/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">软件测试面试题及答案【史上最全】</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>