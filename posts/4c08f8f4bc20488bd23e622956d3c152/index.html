<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android 某个应用缺少特殊权限导致系统一直重启解决 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Android 某个应用缺少特殊权限导致系统一直重启解决" />
<meta property="og:description" content="Android 某个应用缺少特殊权限导致系统一直重启解决 文章目录 Android 某个应用缺少特殊权限导致系统一直重启解决一、前言二、错误日志三、分析解决四、其他1、对 privapp-permissions 称呼的误解2、系统特殊权限有哪些2、系统其他权限介绍（1）普通权限（normal）（2）运行时权限（dangerous）（3）签名权限（signature）（4）特殊权限（privileged） 3、系统framework权限文件 AndroidManifest.xml4、其他查看源码地址： 一、前言 系统一些应用会使用到特殊权限，这时候要在系统配置一下否则系统会一直重启。
出现该问题的时候，系统一直显示开机Log界面，无法正常进入Android系统界面。
下面一起分析总结一下吧。
本文不仅正文有学习价值，后续的延伸介绍内容也是有学习价值的。
二、错误日志 系统会有如下 AndroidRuntime 日志：
01-02 21:16:05.037 1766 1766 D AndroidRuntime: Shutting down VM 01-02 21:16:05.038 1766 1766 E AndroidRuntime: *** FATAL EXCEPTION IN SYSTEM PROCESS: main 01-02 21:16:05.038 1766 1766 E AndroidRuntime: java.lang.IllegalStateException: Signature|privileged permissions not in privapp-permissions allowlist: {com.android.documentsui (/system/priv-app/DocumentsUI): android.permission.MODIFY_QUIET_MODE, com.android.documentsui (/system/priv-app/DocumentsUI): android.permission.INTERACT_ACROSS_USERS, com.android.documentsui (/system/priv-app/DocumentsUI): android.permission.START_FOREGROUND_SERVICES_FROM_BACKGROUND, com.android.documentsui (/system/priv-app/DocumentsUI): android.permission.CHANGE_OVERLAY_PACKAGES, com.android.documentsui (/system/priv-app/DocumentsUI): android.permission.READ_COMPAT_CHANGE_CONFIG, com.android.documentsui (/system/priv-app/DocumentsUI): android." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/4c08f8f4bc20488bd23e622956d3c152/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-06T14:36:40+08:00" />
<meta property="article:modified_time" content="2024-01-06T14:36:40+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android 某个应用缺少特殊权限导致系统一直重启解决</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="Android__0"></a>Android 某个应用缺少特殊权限导致系统一直重启解决</h2> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#Android__0" rel="nofollow">Android 某个应用缺少特殊权限导致系统一直重启解决</a></li><li><ul><li><a href="#_3" rel="nofollow">一、前言</a></li><li><a href="#_13" rel="nofollow">二、错误日志</a></li><li><a href="#_43" rel="nofollow">三、分析解决</a></li><li><a href="#_77" rel="nofollow">四、其他</a></li><li><ul><li><a href="#1_privapppermissions__81" rel="nofollow">1、对 privapp-permissions 称呼的误解</a></li><li><a href="#2_91" rel="nofollow">2、系统特殊权限有哪些</a></li><li><a href="#2_121" rel="nofollow">2、系统其他权限介绍</a></li><li><ul><li><a href="#1normal_125" rel="nofollow">（1）普通权限（normal）</a></li><li><a href="#2dangerous_131" rel="nofollow">（2）运行时权限（dangerous）</a></li><li><a href="#3signature_137" rel="nofollow">（3）签名权限（signature）</a></li><li><a href="#4privileged_145" rel="nofollow">（4）特殊权限（privileged）</a></li></ul> 
    </li><li><a href="#3framework_AndroidManifestxml_161" rel="nofollow">3、系统framework权限文件 AndroidManifest.xml</a></li><li><a href="#4_179" rel="nofollow">4、其他查看源码地址：</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="_3"></a>一、前言</h3> 
<p>系统一些应用会使用到特殊权限，这时候要在系统配置一下否则系统会一直重启。</p> 
<p>出现该问题的时候，系统一直显示开机Log界面，无法正常进入Android系统界面。</p> 
<p>下面一起分析总结一下吧。</p> 
<p>本文不仅正文有学习价值，后续的延伸介绍内容也是有学习价值的。</p> 
<h3><a id="_13"></a>二、错误日志</h3> 
<p>系统会有如下 AndroidRuntime 日志：</p> 
<pre><code>01-02 21:16:05.037  1766  1766 D AndroidRuntime: Shutting down VM
01-02 21:16:05.038  1766  1766 E AndroidRuntime: *** FATAL EXCEPTION IN SYSTEM PROCESS: main
01-02 21:16:05.038  1766  1766 E AndroidRuntime: java.lang.IllegalStateException: Signature|privileged permissions not in privapp-permissions allowlist: {com.android.documentsui (/system/priv-app/DocumentsUI): android.permission.MODIFY_QUIET_MODE, com.android.documentsui (/system/priv-app/DocumentsUI): android.permission.INTERACT_ACROSS_USERS, com.android.documentsui (/system/priv-app/DocumentsUI): android.permission.START_FOREGROUND_SERVICES_FROM_BACKGROUND, com.android.documentsui (/system/priv-app/DocumentsUI): android.permission.CHANGE_OVERLAY_PACKAGES, com.android.documentsui (/system/priv-app/DocumentsUI): android.permission.READ_COMPAT_CHANGE_CONFIG, com.android.documentsui (/system/priv-app/DocumentsUI): android.permission.LOG_COMPAT_CHANGE}
01-02 21:16:05.038  1766  1766 E AndroidRuntime:        at com.android.server.pm.permission.PermissionManagerServiceImpl.onSystemReady(PermissionManagerServiceImpl.java:4410)
01-02 21:16:05.038  1766  1766 E AndroidRuntime:        at com.android.server.pm.permission.PermissionManagerService$PermissionManagerServiceInternalImpl.onSystemReady(PermissionManagerService.java:739)
01-02 21:16:05.038  1766  1766 E AndroidRuntime:        at com.android.server.pm.PackageManagerService.systemReady(PackageManagerService.java:4094)
01-02 21:16:05.038  1766  1766 E AndroidRuntime:        at com.android.server.SystemServer.startOtherServices(SystemServer.java:2720)
01-02 21:16:05.038  1766  1766 E AndroidRuntime:        at com.android.server.SystemServer.run(SystemServer.java:941)
01-02 21:16:05.038  1766  1766 E AndroidRuntime:        at com.android.server.SystemServer.main(SystemServer.java:651)
01-02 21:16:05.038  1766  1766 E AndroidRuntime:        at java.lang.reflect.Method.invoke(Native Method)
01-02 21:16:05.038  1766  1766 E AndroidRuntime:        at com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:548)
01-02 21:16:05.038  1766  1766 E AndroidRuntime:        at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:921)
01-02 21:16:06.635  1993  1993 D AndroidRuntime: &gt;&gt;&gt;&gt;&gt;&gt; START com.android.internal.os.ZygoteInit uid 0 &lt;&lt;&lt;&lt;&lt;&lt;
01-02 21:16:06.652  1992  1992 D AndroidRuntime: &gt;&gt;&gt;&gt;&gt;&gt; START com.android.internal.os.ZygoteInit uid 0 &lt;&lt;&lt;&lt;&lt;&lt;
</code></pre> 
<p>这个日志会一直循环打印，因为异常后，Zygote一直在重启。</p> 
<h3><a id="_43"></a>三、分析解决</h3> 
<p>从上面日志找到关键信息：</p> 
<pre><code>allowlist: {com.android.documentsui (/system/priv-app/DocumentsUI): android.permission.MODIFY_QUIET_MODE, 
com.android.documentsui (/system/priv-app/DocumentsUI): android.permission.INTERACT_ACROSS_USERS, 
com.android.documentsui (/system/priv-app/DocumentsUI): android.permission.START_FOREGROUND_SERVICES_FROM_BACKGROUND, 
com.android.documentsui (/system/priv-app/DocumentsUI): android.permission.CHANGE_OVERLAY_PACKAGES, 
com.android.documentsui (/system/priv-app/DocumentsUI): android.permission.READ_COMPAT_CHANGE_CONFIG, 
com.android.documentsui (/system/priv-app/DocumentsUI): android.permission.LOG_COMPAT_CHANGE}
</code></pre> 
<p>所以只要配置上面几个私有权限，系统就可以正常启动的。</p> 
<p>frameworks\base\data\etc\privapp-permissions-platform.xml</p> 
<p>在末尾添加权限：</p> 
<pre><code>    &lt;privapp-permissions package="com.android.documentsui"&gt;
        &lt;permission name="android.permission.INTERACT_ACROSS_USERS"/&gt;
        &lt;permission name="android.permission.START_FOREGROUND_SERVICES_FROM_BACKGROUND"/&gt;
        &lt;permi ssion name="android.permission.CHANGE_OVERLAY_PACKAGES"/&gt;
        &lt;permission name="android.permission.READ_COMPAT_CHANGE_CONFIG"/&gt;
        &lt;permission name="android.permission.LOG_COMPAT_CHANGE"/&gt;
    &lt;/privapp-permissions&gt;

</code></pre> 
<p>重新编译烧录，系统即可启动。</p> 
<h3><a id="_77"></a>四、其他</h3> 
<p>再学点有用的相关知识。</p> 
<h4><a id="1_privapppermissions__81"></a>1、对 privapp-permissions 称呼的误解</h4> 
<p>以前我一直都是叫这些缺少的权限叫私有权限。</p> 
<p>但是今天查了一下 "privileged"是“有特权的”意思，所以以前的说法是不对的。<br> 这些权限正确叫法是特殊权限。</p> 
<p>以前看“priv-app” 一直以为全称是 “private-application”,<br> 今天才知道正确应该是 privileged-application，简称“系统特殊应用”。</p> 
<h4><a id="2_91"></a>2、系统特殊权限有哪些</h4> 
<p>太多了，大概有三百多个！具体的可以看 framework\base\core\res\AndroidManifest.xml 的定义</p> 
<p>部分私有权限如下：</p> 
<pre><code>    &lt;permission android:name="android.permission.READ_WIFI_CREDENTIAL"
        android:protectionLevel="signature|privileged" /&gt;

    &lt;permission android:name="android.permission.TETHER_PRIVILEGED"
        android:protectionLevel="signature|privileged" /&gt;

    &lt;permission android:name="android.permission.RECEIVE_WIFI_CREDENTIAL_CHANGE"
        android:protectionLevel="signature|privileged" /&gt;

    &lt;permission android:name="android.permission.OVERRIDE_WIFI_CONFIG"
                android:protectionLevel="signature|privileged|knownSigner"
                android:knownCerts="@array/wifi_known_signers" /&gt;
                。。。
</code></pre> 
<p>从上面的特殊权限定义可以看到，protectionLevel 是包含等级是 privileged，</p> 
<p>一般还需要 signature ，就是系统签名应用，所以有特殊权限的应用基本都是系统签名应用，</p> 
<p>但是也有个别除外，具体还是要看定义的地方。</p> 
<h4><a id="2_121"></a>2、系统其他权限介绍</h4> 
<p>framework 定义的所有 权限都是有定义包含 protectionLevel 等级的，主要权限等级有：普通，运行时，系统签名，特殊 。</p> 
<h5><a id="1normal_125"></a>（1）普通权限（normal）</h5> 
<p>此类权限允许访问超出应用沙盒的数据和执行超出应用沙盒的操作。但这些数据和操作对用户隐私及对其他应用的操作带来的风险非常小。</p> 
<p>比如，上网权限，wifi 状态监听，蓝牙，获取后台任务等待，大概有一百多个。</p> 
<h5><a id="2dangerous_131"></a>（2）运行时权限（dangerous）</h5> 
<p>运行时权限也称为危险权限，此类权限授予应用对受限数据的额外访问权限，并允许应用执行对系统和其他应用具有更严重影响的受限操作。因此需要先在应用中请求运行时权限，然后才能访问受限数据或执行受限操作。当应用请求运行时权限时，系统会显示运行时权限弹窗提示。</p> 
<p>比如，文件读写权限，日历读取和设置权限等待，总共不到一百个。</p> 
<h5><a id="3signature_137"></a>（3）签名权限（signature）</h5> 
<p>当应用声明了其他应用已定义的签名权限时，如果两个应用使用同一证书进行签名，系统会在安装时向前者授予该权限。否则，系统无法向前者授予该权限。（注意：有些签名权限不适合第三方应用使用。）</p> 
<p>该权限只需要在manifest中声明使用，同时应用和这类权限定义者拥有一样的签名系统就会默认授予应用这类权限；系统授予这类权限后应用无需像运行时权限一样动态申请。</p> 
<p>比如，Android11 新增的文件管理权限，对wifi，热点，Camera一些特殊操作权限，比较多，大概有五百多个。</p> 
<h5><a id="4privileged_145"></a>（4）特殊权限（privileged）</h5> 
<p>特殊权限与特定的应用操作相对应。只有平台和原始设备制造商 (OEM) 可以定义特殊权限。此外，如果平台和 OEM 想要防止有人执行功能特别强大的操作（例如通过其他应用绘图），通常会定义特殊权限。系统设置中的特殊应用访问权限页面包含一组用户可切换的操作。其中的许多操作都以特殊权限的形式实现。每项特殊权限都有自己的实现细节。系统会为特殊权限分配“appop”保护级别。</p> 
<p>比如本文的： 允许应用程序在所有用户之间进行交互 权限，启动前台服务权限，可通过overlay形式覆盖属性权限，应用主题更改监听等等，大概有三百多个。</p> 
<p>特殊权限大部分与系统签名文件同时使用。</p> 
<p>也可以看看别人具体的介绍： https://blog.csdn.net/qq_25804863/article/details/123483643</p> 
<p>具体某些权限有哪些，可以看看下面的 framework 中的定义，有一些权限是网上没有介绍的，可以看看权限签名的注解也能大概知道含义。</p> 
<h4><a id="3framework_AndroidManifestxml_161"></a>3、系统framework权限文件 AndroidManifest.xml</h4> 
<p>我们常用的广播都定义在里面，如果要新增可以在里面新增</p> 
<p>Android13 中的 framework\base\core\res\AndroidManifest.xml , 具体内容如下：</p> 
<p>上面的是 Android13 上比较新的权限定义，有兴趣的可以看看。</p> 
<p>在线查看网址：</p> 
<p><a href="http://aospxref.com/android-13.0.0_r3/xref/frameworks/base/core/res/AndroidManifest.xml" rel="nofollow">http://aospxref.com/android-13.0.0_r3/xref/frameworks/base/core/res/AndroidManifest.xml</a></p> 
<h4><a id="4_179"></a>4、其他查看源码地址：</h4> 
<p><a href="https://blog.csdn.net/qq_31939617/article/details/131399612">https://blog.csdn.net/qq_31939617/article/details/131399612</a></p> 
<p>上面介绍了六种方式，试了一下，目前国内能正常使用的只有下面两种：</p> 
<p><a href="https://www.androidos.net.cn/sourcecode" rel="nofollow">https://www.androidos.net.cn/sourcecode</a></p> 
<p><a href="http://aospxref.com/" rel="nofollow">http://aospxref.com/</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/726478c0c641dfba53b23ef791c73e2b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Shape-IoU: More Accurate Metric considering Bounding Box Shape and Scale</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/be94abe4d6fcf499d0ab6559b693620f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Ubuntu配置Yolov8环境并训练自己的数据集 &#43; ROS实时运行</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>