<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>npm 本地部署及发布包 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="npm 本地部署及发布包" />
<meta property="og:description" content="选择对应部署方式
npm install -g verdaccio 执行查看相关配置 verdaccio 创建项目
cnpm create vite，单元测试，eslint可以根据需要调整
新建packages文件夹，新建所需组件
新建组件导出文件index.ts
import type { App, Plugin } from &#39;vue&#39; import FormDesign from &#34;./formdesign.vue&#34; export const formDesignPlugin: Plugin = { install(app: App) { app.component(&#39;formDesign&#39;, FormDesign) }, } export { FormDesign, } 设置组件名称
导出需要用到的组件 及方法
import type { App, Plugin } from &#39;vue&#39; import { formDesignPlugin } from &#39;./form/formdesign&#39;; import { formBuildPlugin } from &#39;./form/formbuild&#39; import { flowDesignPlugin } from &#39;." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/192759d6492b94fde295e2069aec1970/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-11T11:19:59+08:00" />
<meta property="article:modified_time" content="2024-01-11T11:19:59+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">npm 本地部署及发布包</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p></p> 
<p>选择对应部署方式</p> 
<pre><code>npm install -g verdaccio</code></pre> 
<p>执行查看相关配置 </p> 
<pre><code class="language-TypeScript">verdaccio</code></pre> 
<p>创建项目</p> 
<p> cnpm create vite，单元测试，eslint可以根据需要调整</p> 
<p><img alt="" height="768" src="https://images2.imgbox.com/6e/7b/H8VUZSqp_o.png" width="1109"></p> 
<p>新建packages文件夹，新建所需组件</p> 
<p><img alt="" height="853" src="https://images2.imgbox.com/94/12/JbaRbPwx_o.png" width="1008"></p> 
<p> 新建组件导出文件index.ts</p> 
<pre><code class="language-TypeScript">
import type { App, Plugin } from 'vue'
import FormDesign from "./formdesign.vue"

export const formDesignPlugin: Plugin = {
    install(app: App) {
        app.component('formDesign', FormDesign)
    },
}

export {
    FormDesign,
}


</code></pre> 
<p>设置组件名称</p> 
<p><img alt="" height="458" src="https://images2.imgbox.com/3f/1e/7fFB16kV_o.png" width="1102"> </p> 
<p> </p> 
<p>导出需要用到的组件 及方法</p> 
<pre><code class="language-TypeScript">
import type { App, Plugin } from 'vue'

import { formDesignPlugin } from './form/formdesign';
import { formBuildPlugin } from './form/formbuild'
import { flowDesignPlugin } from './flow';
import Antd from 'ant-design-vue';
const VueFormFlowPlugin: Plugin = {
    install(app: App) {
        formDesignPlugin.install?.(app)
        formBuildPlugin.install?.(app)
        flowDesignPlugin.install?.(app)
        app.use(Antd);

    },
}
export default VueFormFlowPlugin

export * from './form/formdesign'
export * from './form/formbuild'
export * from './flow'
</code></pre> 
<p>package.json相关配置修改 </p> 
<pre><code class="language-TypeScript">{
  "name": "vue-form-flow", // 设置插件名称
  "author": "XX", 作者信息
  "type": "module",
  "files": [
    "dist"
  ],
  // 打包配置相关
  "main": "./dist/vue-form-flow.umd.cjs", 
  "module": "./dist/vue-form-flow.js",
  "exports": {
    ".": {
      "import": "./dist/vue-form-flow.js",
      "require": "./dist/vue-form-flow.umd.cjs"
    }
  },
  "version": "1.0.6", // 包版本，需唯一才可发布成功
  "private": false, // 是否私有发布，FALSE可以成功，true需要npm付费账号
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "build:lib": "vue-tsc --noEmit &amp;&amp; vite build --config ./build/lib.js",
    "preview": "vite preview",
  },

  "dependencies": {
    "ant-design-vue": "^4.0.8",
    "axios": "^1.6.3",
    "lodash.clonedeep": "^4.5.0",
    "unplugin-vue-components": "^0.26.0",
    "vue": "^3.3.4",
    "vue-draggable-next": "^2.1.1"
  },
  "devDependencies": {
   
  },
// 插件所需依赖
  "peerDependencies": {
    "ant-design-vue": "^4.0.8",
    "vue": "^2.0.0 || &gt;=3.0.0"
  },
  "peerDependenciesMeta": {
    "@vue/composition-api": {
      "optional": true
    }
  },
// 发布配置地址
  "publishConfig": {
    "registry": "http://localhost:4873"
  },
  "__npminstall_done": false
}
</code></pre> 
<p>设置 vite.config.ts</p> 
<pre><code class="language-TypeScript">import path from 'path'
import {defineConfig} from 'vite'
import vue from '@vitejs/plugin-vue'
import vueJsx from '@vitejs/plugin-vue-jsx'
import libCss from 'vite-plugin-libcss'; // 该插件可将样式打包后自动引入使用时不用单独引入css文件

import Components from 'unplugin-vue-components/vite' 
import {AntDesignVueResolver} from 'unplugin-vue-components/resolvers'
// https://vitejs.dev/config/
export default defineConfig({
    plugins: [
        vue(),
        vueJsx(),
        /**
         * @description ant-design-vue 组件自动按需引入可根据需要删除
         */
        Components({
            dts: 'src/types/components.d.ts',
            include: [/\.vue$/, /\.tsx$/],
            resolvers: [AntDesignVueResolver({
                // 参数配置可参考：https://github.com/antfu/unplugin-vue-components/blob/main/src/core/resolvers/antdv.ts
                // 自动引入 ant-design/icons-vue中的图标，需要安装@ant-design/icons-vue
                // importStyle: 'less',
                importStyle: false,
                resolveIcons: true,
            })]
        }),
        libCss()
    ],
    cacheDir: 'node_modules/.vite',
    resolve: {
        alias: {
            '@': path.resolve(__dirname, './src'), 
            // 'vue': 'vue/dist/vue.esm-bundler.js',
            // 'assets': path.resolve(__dirname, 'src/assets/'),
            // vue: '@vue/compat',
            // preserveSymlinks: false, // 启用此选项会使 Vite 通过原始文件路径确定文件身份
        },
        dedupe: [
            'vue'
        ],
        extensions: ['.js', '.ts', '.jsx', '.tsx', '.json', '.vue', '.mjs']
    },
    build: {
        cssCodeSplit: true,
        // 插件相关配置，打包后插件名称
        lib: {
            // Could also be a dictionary or array of multiple entry points
            entry: path.resolve(__dirname, 'packages/index.ts'),
            name: 'vueFormFlow',
            // the proper extensions will be added
            fileName: 'vue-form-flow',
        },

        rollupOptions: {
            // 确保外部化处理那些你不想打包进库的依赖
            external: ['vue', 'ant-design-vue'],
            output: {
                // format: 'es', // 默认es，可选 'amd' 'cjs' 'es' 'iife' 'umd' 'system'
                exports: 'named',
                globals: { //在UMD构建模式下为这些外部化的依赖提供一个全局变量
                    vue: 'Vue',
                    'ant-design-vue': 'AntDesignVue',
                }
            }
         
        },
    },

})
</code></pre> 
<p> </p> 
<p> </p> 
<p> npm run build</p> 
<p>发布<a href="http://localhost:4873/" rel="nofollow" title="http://localhost:4873/">http://localhost:4873/</a>为verdaccio默认地址。可在配置文件修改</p> 
<pre><code class="language-TypeScript">npm publish --registry http://localhost:4873/ </code></pre> 
<p>修改配置文件路径"C:\Users\IT002\AppData\Roaming\verdaccio\config.yaml"</p> 
<p>下载对应已发布包@1.0.0为对应版本，可以不设置为最新</p> 
<pre><code class="language-TypeScript">npm install vue-form-flow@1.0.0 --registry http://localhost:4873</code></pre> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/afae4d9838c015e7a3aa3c4476f43beb/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">c JPEG 中MCU 的理解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/36ed42d41ce9f02de4ee120dfa7306d7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">html常用类名</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>