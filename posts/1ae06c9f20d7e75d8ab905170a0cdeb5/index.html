<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ffmpeg最简单方式支持nvidia硬编解码 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ffmpeg最简单方式支持nvidia硬编解码" />
<meta property="og:description" content="提示：文章写完后，目录可以自动生成，如何生成可参考右边的帮助文档
文章目录 前言一、nvidia硬编解码是什么？二、使用步骤1.安装2.确认1.硬件解码器2.硬件编码器 3.测试 总结 前言 因为工作内容的需要，之前写过一篇文章关于ffmpeg支持英伟达的硬编解码，那个方法比较适合定制化的ffmpeg编译，如果你仅仅使用ffmpeg进行硬件编解码的话，其实不需要这么麻烦。
ffmpeg定制化编译支持cuda编解码
一、nvidia硬编解码是什么？ 这个之前的文章已经说过，这里不再多做叙述。可以理解为一种专门的硬件，处理视频解码和编码。
二、使用步骤 首先你需要一张nvidia的卡，最好是GTX以上级别的，因为有些显卡没有硬件编解码器，比如GT920M这种早期笔记本显卡。
AV1在RTX30系列显卡上获得了硬件支持，因为手上没有30系显卡，所以今天只说H264和H265。
今天的比较简单，得益于ffmpeg-3.4功能，让我们在不用编译的情况下就可以直接安装这个版本。
1.安装 确保你的分发版默认的ffmpeg版本支持3.4以上的版本，Ubuntu需要&gt;=18.04，Debian需要&gt;=9。其他的分发版请自行查看。
安装方法也比较简单，使用官方源安装即可。
Ubuntu&amp;Debian:
sudo apt update sudo apt install ffmpeg 2.确认 确认需要用到两个options，一个是-decoders，一个是-encoders
这里输出太长了，我只截取一部分。
1.硬件解码器 ffmpeg -decoders V..... h264_cuvid Nvidia CUVID H264 decoder (codec h264) VFS..D hap Vidvox Hap VFS..D hevc HEVC (High Efficiency Video Coding) V..... hevc_v4l2m2m V4L2 mem2mem HEVC decoder wrapper (codec hevc) V..... hevc_cuvid Nvidia CUVID HEVC decoder (codec hevc) V....D hnm4video HNM 4 video V." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/1ae06c9f20d7e75d8ab905170a0cdeb5/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-25T11:11:48+08:00" />
<meta property="article:modified_time" content="2023-07-25T11:11:48+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ffmpeg最简单方式支持nvidia硬编解码</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>提示：文章写完后，目录可以自动生成，如何生成可参考右边的帮助文档</p> 
</blockquote> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_7" rel="nofollow">前言</a></li><li><a href="#nvidia_15" rel="nofollow">一、nvidia硬编解码是什么？</a></li><li><a href="#_17" rel="nofollow">二、使用步骤</a></li><li><ul><li><a href="#1_24" rel="nofollow">1.安装</a></li><li><a href="#2_35" rel="nofollow">2.确认</a></li><li><ul><li><a href="#1_40" rel="nofollow">1.硬件解码器</a></li><li><a href="#2_95" rel="nofollow">2.硬件编码器</a></li></ul> 
   </li><li><a href="#3_115" rel="nofollow">3.测试</a></li></ul> 
  </li><li><a href="#_128" rel="nofollow">总结</a></li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="_7"></a>前言</h2> 
<p>因为工作内容的需要，之前写过一篇文章关于ffmpeg支持英伟达的硬编解码，那个方法比较适合定制化的ffmpeg编译，如果你仅仅使用ffmpeg进行硬件编解码的话，其实不需要这么麻烦。<br> <a href="https://blog.csdn.net/jiexijihe945/article/details/125577520">ffmpeg定制化编译支持cuda编解码</a></p> 
<hr> 
<h2><a id="nvidia_15"></a>一、nvidia硬编解码是什么？</h2> 
<p>这个之前的文章已经说过，这里不再多做叙述。可以理解为一种专门的硬件，处理视频解码和编码。</p> 
<h2><a id="_17"></a>二、使用步骤</h2> 
<p><code>首先你需要一张nvidia的卡，最好是GTX以上级别的，因为有些显卡没有硬件编解码器，比如GT920M这种早期笔记本显卡。</code></p> 
<p>AV1在RTX30系列显卡上获得了硬件支持，因为手上没有30系显卡，所以今天只说H264和H265。</p> 
<p>今天的比较简单，得益于<code>ffmpeg-3.4</code>功能，让我们在不用编译的情况下就可以直接安装这个版本。</p> 
<h3><a id="1_24"></a>1.安装</h3> 
<p>确保你的分发版默认的ffmpeg版本支持3.4以上的版本，Ubuntu需要&gt;=<code>18.04</code>，Debian需要&gt;=<code>9</code>。其他的分发版请自行查看。</p> 
<p>安装方法也比较简单，使用官方源安装即可。<br> Ubuntu&amp;Debian:</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> update
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> ffmpeg
</code></pre> 
<h3><a id="2_35"></a>2.确认</h3> 
<p>确认需要用到两个<code>options</code>，一个是<code>-decoders</code>，一个是<code>-encoders</code></p> 
<p>这里输出太长了，我只截取一部分。</p> 
<h4><a id="1_40"></a>1.硬件解码器</h4> 
<pre><code class="prism language-bash">ffmpeg <span class="token parameter variable">-decoders</span>
 V<span class="token punctuation">..</span><span class="token punctuation">..</span>. h264_cuvid           Nvidia CUVID H264 decoder <span class="token punctuation">(</span>codec h264<span class="token punctuation">)</span>
 VFS<span class="token punctuation">..</span>D hap                  Vidvox Hap
 VFS<span class="token punctuation">..</span>D hevc                 HEVC <span class="token punctuation">(</span>High Efficiency Video Coding<span class="token punctuation">)</span>
 V<span class="token punctuation">..</span><span class="token punctuation">..</span>. hevc_v4l2m2m         V4L2 mem2mem HEVC decoder wrapper <span class="token punctuation">(</span>codec hevc<span class="token punctuation">)</span>
 V<span class="token punctuation">..</span><span class="token punctuation">..</span>. hevc_cuvid           Nvidia CUVID HEVC decoder <span class="token punctuation">(</span>codec hevc<span class="token punctuation">)</span>
 V<span class="token punctuation">..</span><span class="token punctuation">..</span>D hnm4video            HNM <span class="token number">4</span> video
 V<span class="token punctuation">..</span><span class="token punctuation">..</span>D hq_hqa               Canopus HQ/HQA
 VFS<span class="token punctuation">..</span>D hqx                  Canopus HQX
 VF<span class="token punctuation">..</span>BD huffyuv              Huffyuv / HuffYUV
 VF<span class="token punctuation">..</span>BD hymt                 HuffYUV MT
 V<span class="token punctuation">..</span><span class="token punctuation">..</span>D idcinvideo           <span class="token function">id</span> Quake II CIN video <span class="token punctuation">(</span>codec idcin<span class="token punctuation">)</span>
 V<span class="token punctuation">..</span><span class="token punctuation">..</span>D idf                  iCEDraw text
 V<span class="token punctuation">..</span><span class="token punctuation">..</span>D iff                  IFF ACBM/ANIM/DEEP/ILBM/PBM/RGB8/RGBN <span class="token punctuation">(</span>codec iff_ilbm<span class="token punctuation">)</span>
 V<span class="token punctuation">..</span><span class="token punctuation">..</span>D imm4                 Infinity IMM4
 V<span class="token punctuation">..</span><span class="token punctuation">..</span>D indeo2               Intel Indeo <span class="token number">2</span>
 V<span class="token punctuation">..</span><span class="token punctuation">..</span>D indeo3               Intel Indeo <span class="token number">3</span>
 V<span class="token punctuation">..</span><span class="token punctuation">..</span>D indeo4               Intel Indeo Video Interactive <span class="token number">4</span>
 V<span class="token punctuation">..</span><span class="token punctuation">..</span>D indeo5               Intel Indeo Video Interactive <span class="token number">5</span>
 V<span class="token punctuation">..</span><span class="token punctuation">..</span>D interplayvideo       Interplay MVE video
 VFS<span class="token punctuation">..</span>D jpeg2000             JPEG <span class="token number">2000</span>
 VF<span class="token punctuation">..</span>.D libopenjpeg          OpenJPEG JPEG <span class="token number">2000</span> <span class="token punctuation">(</span>codec jpeg2000<span class="token punctuation">)</span>
 V<span class="token punctuation">..</span><span class="token punctuation">..</span>D jpegls               JPEG-LS
 V<span class="token punctuation">..</span><span class="token punctuation">..</span>D jv                   Bitmap Brothers JV video
 V<span class="token punctuation">..</span><span class="token punctuation">..</span>D kgv1                 Kega Game Video
 V<span class="token punctuation">..</span><span class="token punctuation">..</span>D kmvc                 Karl Morton's video codec
 VF<span class="token punctuation">..</span>.D lagarith             Lagarith lossless
 V<span class="token punctuation">..</span><span class="token punctuation">..</span>D loco                 LOCO
 V<span class="token punctuation">..</span><span class="token punctuation">..</span>D lscr                 LEAD Screen Capture
 V<span class="token punctuation">..</span><span class="token punctuation">..</span>D m101                 Matrox Uncompressed SD
 V<span class="token punctuation">..</span><span class="token punctuation">..</span>D eamad                Electronic Arts Madcow Video <span class="token punctuation">(</span>codec mad<span class="token punctuation">)</span>
 VFS<span class="token punctuation">..</span>D magicyuv             MagicYUV video
 VF<span class="token punctuation">..</span>.D mdec                 Sony PlayStation MDEC <span class="token punctuation">(</span>Motion DECoder<span class="token punctuation">)</span>
 VF<span class="token punctuation">..</span>.D mimic                Mimic
 V<span class="token punctuation">..</span><span class="token punctuation">..</span>D mjpeg                MJPEG <span class="token punctuation">(</span>Motion JPEG<span class="token punctuation">)</span>
 V<span class="token punctuation">..</span><span class="token punctuation">..</span>. mjpeg_cuvid          Nvidia CUVID MJPEG decoder <span class="token punctuation">(</span>codec mjpeg<span class="token punctuation">)</span>
 V<span class="token punctuation">..</span><span class="token punctuation">..</span>D mjpegb               Apple MJPEG-B
 V<span class="token punctuation">..</span><span class="token punctuation">..</span>D mmvideo              American Laser Games MM Video
 V<span class="token punctuation">..</span><span class="token punctuation">..</span>D motionpixels         Motion Pixels video
 V.S.BD mpeg1video           MPEG-1 video
 V<span class="token punctuation">..</span><span class="token punctuation">..</span>. mpeg1_v4l2m2m        V4L2 mem2mem MPEG1 decoder wrapper <span class="token punctuation">(</span>codec mpeg1video<span class="token punctuation">)</span>
 V<span class="token punctuation">..</span><span class="token punctuation">..</span>. mpeg1_cuvid          Nvidia CUVID MPEG1VIDEO decoder <span class="token punctuation">(</span>codec mpeg1video<span class="token punctuation">)</span>
 V.S.BD mpeg2video           MPEG-2 video
 V.S.BD mpegvideo            MPEG-1 video <span class="token punctuation">(</span>codec mpeg2video<span class="token punctuation">)</span>
 V<span class="token punctuation">..</span><span class="token punctuation">..</span>. mpeg2_v4l2m2m        V4L2 mem2mem MPEG2 decoder wrapper <span class="token punctuation">(</span>codec mpeg2video<span class="token punctuation">)</span>
 V<span class="token punctuation">..</span><span class="token punctuation">..</span>. mpeg2_cuvid          Nvidia CUVID MPEG2VIDEO decoder <span class="token punctuation">(</span>codec mpeg2video<span class="token punctuation">)</span>
 VF<span class="token punctuation">..</span>BD mpeg4                MPEG-4 part <span class="token number">2</span>
 V<span class="token punctuation">..</span><span class="token punctuation">..</span>. mpeg4_v4l2m2m        V4L2 mem2mem MPEG4 decoder wrapper <span class="token punctuation">(</span>codec mpeg4<span class="token punctuation">)</span>
 V<span class="token punctuation">..</span><span class="token punctuation">..</span>. mpeg4_cuvid          Nvidia CUVID MPEG4 decoder <span class="token punctuation">(</span>codec mpeg4<span class="token punctuation">)</span>
</code></pre> 
<p>所有支持的解码器中后缀带_cuvid的都是英伟达的硬件解码格式，按照自己的需要选择。</p> 
<h4><a id="2_95"></a>2.硬件编码器</h4> 
<p>一般硬件差不多都是解码能力强过编码能力，英伟达也不例外，可能支持的编码格式没有解码那么多。</p> 
<pre><code class="prism language-bash">ffmpeg <span class="token parameter variable">-encoders</span>
 V<span class="token punctuation">..</span><span class="token punctuation">..</span>. h264_nvenc           NVIDIA NVENC H.264 encoder <span class="token punctuation">(</span>codec h264<span class="token punctuation">)</span>
 V<span class="token punctuation">..</span><span class="token punctuation">..</span>. h264_omx             OpenMAX IL H.264 video encoder <span class="token punctuation">(</span>codec h264<span class="token punctuation">)</span>
 V<span class="token punctuation">..</span><span class="token punctuation">..</span>. h264_v4l2m2m         V4L2 mem2mem H.264 encoder wrapper <span class="token punctuation">(</span>codec h264<span class="token punctuation">)</span>
 V<span class="token punctuation">..</span><span class="token punctuation">..</span>. h264_vaapi           H.264/AVC <span class="token punctuation">(</span>VAAPI<span class="token punctuation">)</span> <span class="token punctuation">(</span>codec h264<span class="token punctuation">)</span>
 V<span class="token punctuation">..</span><span class="token punctuation">..</span>. nvenc                NVIDIA NVENC H.264 encoder <span class="token punctuation">(</span>codec h264<span class="token punctuation">)</span>
 V<span class="token punctuation">..</span><span class="token punctuation">..</span>. nvenc_h264           NVIDIA NVENC H.264 encoder <span class="token punctuation">(</span>codec h264<span class="token punctuation">)</span>
 V<span class="token punctuation">..</span><span class="token punctuation">..</span>. hap                  Vidvox Hap
 V<span class="token punctuation">..</span><span class="token punctuation">..</span>. libx265              libx265 H.265 / HEVC <span class="token punctuation">(</span>codec hevc<span class="token punctuation">)</span>
 V<span class="token punctuation">..</span><span class="token punctuation">..</span>. nvenc_hevc           NVIDIA NVENC hevc encoder <span class="token punctuation">(</span>codec hevc<span class="token punctuation">)</span>
 V<span class="token punctuation">..</span><span class="token punctuation">..</span>. hevc_nvenc           NVIDIA NVENC hevc encoder <span class="token punctuation">(</span>codec hevc<span class="token punctuation">)</span>
</code></pre> 
<p>后缀或前缀带nvenc的都是硬件编码器，我的显卡只支持h264和hevc，也就是俗称的H264和H265，只是不同的组织叫法不一样。</p> 
<h3><a id="3_115"></a>3.测试</h3> 
<p>测试也很简单，只要使用h264解码+h265编码就行了，正常的话不会报错。</p> 
<pre><code class="prism language-bash">ffmpeg <span class="token parameter variable">-rtsp_transport</span> tcp <span class="token parameter variable">-vcodec</span> h264_cuvid <span class="token parameter variable">-an</span> <span class="token parameter variable">-i</span> <span class="token operator">&lt;</span>H264视频文件<span class="token operator">&gt;</span> <span class="token parameter variable">-vcodec</span> hevc_nvenc <span class="token parameter variable">-an</span> <span class="token parameter variable">-t</span> <span class="token number">100</span> <span class="token parameter variable">-f</span> mp4 <span class="token parameter variable">-y</span> output.mp4
</code></pre> 
<p><code>特别说明：-an的意思是不要音频，因为只测试视频，要不然还要单独指定音频编码器</code></p> 
<p>也可以用H265文件解码+H264文件编码，你需要把操作反过来。</p> 
<hr> 
<h2><a id="_128"></a>总结</h2> 
<p>1、同时需要ffmpeg和nvidia的支持，不同的版本可能效果不一样。<br> 2、也有可能ffmpeg早期版本就已经支持nvidia了，只不过我用的最低Ubuntu版本是18.04，所以没法确认。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e5b911b7739b523f9debba575e6d3b42/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">自动化运维工具--saltstack部署及使用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ee340218d9c080ee648847435e872ef3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Java设计模式之代理（Proxy）模式</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>