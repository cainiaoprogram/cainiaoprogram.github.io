<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Windows 下的MySQL安装keyring_file插件 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Windows 下的MySQL安装keyring_file插件" />
<meta property="og:description" content="文章目录
前言
一、配置my.ini
二、安装keyring插件
三、查看插件状态
四、加解密数据表
五、卸载keyring插件
前言 从5.7.11开始，mysql开始支持物理表空间的加密，它使用两层加密架构。
包括：主密钥（master key） 和 表空间加密密钥（tablespace key）
主密钥用于加密加密密钥，加密后的加密密钥存储在表空间文件的header中。加密密钥用于加密数据
当用户想访问加密的表时，innoDB会先用 主密钥 对之前存储在表空间header中被加密的加密密钥进行解密，得到明文的加密密钥。
再用 加密密钥 解密数据信息。加密密钥是不会被改变的（除非进行alter table testt encrytion=NO/YES）。
而 主密钥 可以通过以下命令随时改变
查看变更前keyring文件
执行主密钥变更命令
mysql&gt; ALTER INSTANCE ROTATE INNODB MASTER KEY; Query OK, 0 rows affected (0.01 sec) mysql&gt; 再次查看变更后keyring文件 一、配置my.ini 如没有该文件，可在创建一个在MySQL安装目录或C:\下，文件添加如下内容，目录以实际为准，然后重启MySQL。
[mysqld] 。。。其他配置。。 early-plugin-load=keyring_file.dll keyring_file_data=&#39;D:\mysql-8.0.22\mysql-8.0.22-winx64\keyring&#39; # 其中keyring文件MySQL会自动创建，无需手动创建 二、安装keyring插件 登录MySQL，然后执行以下语句安装
mysql&gt; install plugin keyring_file soname &#39;keyring_file.dll&#39;; Query OK, 0 rows affected (0.01 sec) 三、查看插件状态 mysql&gt; SELECT PLUGIN_NAME, PLUGIN_STATUS -&gt; FROM INFORMATION_SCHEMA." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/7cccfe56a2f977a1d1dbb008731f7a8e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-12-08T22:46:58+08:00" />
<meta property="article:modified_time" content="2020-12-08T22:46:58+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Windows 下的MySQL安装keyring_file插件</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><a href="#%E6%96%87%E7%AB%A0%E7%9B%AE%E5%BD%95" rel="nofollow">文章目录</a></p> 
<div> 
 <p id="%E5%89%8D%E8%A8%80-toc" style="margin-left:0px;"><a href="#%E5%89%8D%E8%A8%80" rel="nofollow">前言</a></p> 
 <p id="%E4%B8%80%E3%80%81%E9%85%8D%E7%BD%AEmy.ini-toc" style="margin-left:0px;"><a href="#%E4%B8%80%E3%80%81%E9%85%8D%E7%BD%AEmy.ini" rel="nofollow">一、配置my.ini</a></p> 
 <p id="%E4%BA%8C%E3%80%81%E5%AE%89%E8%A3%85keyring%E6%8F%92%E4%BB%B6-toc" style="margin-left:0px;"><a href="#%E4%BA%8C%E3%80%81%E5%AE%89%E8%A3%85keyring%E6%8F%92%E4%BB%B6" rel="nofollow">二、安装keyring插件</a></p> 
 <p style="margin-left:0px;"><a href="#%E4%B8%89%E3%80%81%E6%9F%A5%E7%9C%8B%E6%8F%92%E4%BB%B6%E7%8A%B6%E6%80%81" rel="nofollow">三、查看插件状态</a></p> 
 <p style="margin-left:0px;"><a href="#%E5%9B%9B%E3%80%81%E5%8A%A0%E8%A7%A3%E5%AF%86%E6%95%B0%E6%8D%AE%E8%A1%A8" rel="nofollow">四、加解密数据表</a></p> 
 <p style="margin-left:0px;"><a href="#%E4%BA%94%E3%80%81%E5%8D%B8%E8%BD%BDkeyring%E6%8F%92%E4%BB%B6" rel="nofollow">五、卸载keyring插件</a></p> 
 <hr id="hr-toc"> 
 <p> </p> 
</div> 
<p> </p> 
<h2 id="%E5%89%8D%E8%A8%80"><a id="_10"></a>前言</h2> 
<p>从5.7.11开始，mysql开始支持物理表空间的加密，它使用两层加密架构。<br> 包括：主密钥（master key） 和 表空间加密密钥（tablespace key）</p> 
<p>主密钥用于加密加密密钥，加密后的加密密钥存储在表空间文件的header中。加密密钥用于加密数据<br> 当用户想访问加密的表时，innoDB会先用 主密钥 对之前存储在表空间header中被加密的加密密钥进行解密，得到明文的加密密钥。</p> 
<p>再用 加密密钥 解密数据信息。加密密钥是不会被改变的（除非进行alter table testt encrytion=NO/YES）。</p> 
<p>而 主密钥 可以通过以下命令随时改变</p> 
<p>查看变更前keyring文件</p> 
<p><img alt="" height="85" src="https://images2.imgbox.com/7a/70/swxfA27x_o.png" width="565"></p> 
<p>执行主密钥变更命令</p> 
<pre><code class="language-sql">mysql&gt; ALTER INSTANCE ROTATE INNODB MASTER KEY;
Query OK, 0 rows affected (0.01 sec)

mysql&gt;</code></pre> 
<p>再次查看变更后keyring文件 </p> 
<p><img alt="" height="110" src="https://images2.imgbox.com/80/04/BXg9w7PA_o.png" width="552"></p> 
<hr> 
<p> </p> 
<h2 id="%E4%B8%80%E3%80%81%E9%85%8D%E7%BD%AEmy.ini"><a id="pandas_19"></a>一、配置my.ini</h2> 
<p><span style="color:#999aaa;">如没有该文件，可在创建一个在MySQL安装目录或C:\下，文件添加如下内容，目录以实际为准，然后重启MySQL。</span></p> 
<pre><code class="language-bash">[mysqld]
。。。其他配置。。
early-plugin-load=keyring_file.dll
keyring_file_data='D:\mysql-8.0.22\mysql-8.0.22-winx64\keyring'

# 其中keyring文件MySQL会自动创建，无需手动创建</code></pre> 
<h2 id="%E4%BA%8C%E3%80%81%E5%AE%89%E8%A3%85keyring%E6%8F%92%E4%BB%B6"><a id="_26"></a>二、安装keyring插件</h2> 
<p>登录MySQL，然后执行以下语句安装</p> 
<pre><code class="language-sql">mysql&gt; install plugin keyring_file soname 'keyring_file.dll';
Query OK, 0 rows affected (0.01 sec)

</code></pre> 
<h3 id="%E4%B8%89%E3%80%81%E6%9F%A5%E7%9C%8B%E6%8F%92%E4%BB%B6%E7%8A%B6%E6%80%81"><a id="1_27"></a>三、查看插件状态</h3> 
<pre><code class="language-sql">
mysql&gt; SELECT PLUGIN_NAME, PLUGIN_STATUS
    -&gt; FROM INFORMATION_SCHEMA.PLUGINS
    -&gt; WHERE PLUGIN_NAME LIKE 'keyring%';
+--------------+---------------+
| PLUGIN_NAME  | PLUGIN_STATUS |
+--------------+---------------+
| keyring_file | ACTIVE        |
+--------------+---------------+
1 row in set (0.00 sec)

mysql&gt;</code></pre> 
<h3 id="%E5%9B%9B%E3%80%81%E5%8A%A0%E8%A7%A3%E5%AF%86%E6%95%B0%E6%8D%AE%E8%A1%A8">四、加解密数据表</h3> 
<pre><code class="language-sql">mysql&gt; use testdb;
Database changed
mysql&gt; alter table testt encryption='Y';
Query OK, 3 rows affected (0.04 sec)
Records: 3  Duplicates: 0  Warnings: 0

mysql&gt; SELECT TABLE_SCHEMA, TABLE_NAME, CREATE_OPTIONS
    -&gt; FROM INFORMATION_SCHEMA.TABLES
    -&gt; WHERE CREATE_OPTIONS LIKE '%ENCRYPTION=''Y''%';

+--------------+------------+----------------+
| TABLE_SCHEMA | TABLE_NAME | CREATE_OPTIONS |
+--------------+------------+----------------+
| testdb       | testt      | ENCRYPTION='Y' |
+--------------+------------+----------------+
1 row in set (0.01 sec)

mysql&gt;

mysql&gt; alter table testt encryption='N';
Query OK, 3 rows affected (0.03 sec)
Records: 3  Duplicates: 0  Warnings: 0

mysql&gt;</code></pre> 
<h3 id="%E4%BA%94%E3%80%81%E5%8D%B8%E8%BD%BDkeyring%E6%8F%92%E4%BB%B6">五、卸载keyring插件</h3> 
<pre><code class="language-sql">mysql&gt; UNINSTALL PLUGIN keyring_file;
Query OK, 0 rows affected (0.01 sec)

mysql&gt; SELECT PLUGIN_NAME, PLUGIN_STATUS
    -&gt; FROM INFORMATION_SCHEMA.PLUGINS
    -&gt; WHERE PLUGIN_NAME LIKE 'keyring%';

Empty set (0.00 sec)

mysql&gt;</code></pre> 
<h2><a id="_63"></a></h2>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cf2c9209d6fddce7224295d8a8d24834/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">python与pycharm链接_Python（Pycharm）连接Oracle数据库之cx_Oracle的使用（cx_Oracle在pyCharm中报错）-Go语言中文社区...</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7642e903cef38ea0b835758330285902/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">python中ix用法_在python的pandas模块中，DataFrame对象，如何选择一行？索引、loc、iloc、ix的用法及区别...</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>