<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>linux后台运行命令 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="linux后台运行命令" />
<meta property="og:description" content="后台运行脚本 monitor.sh &amp; --shell终端断掉脚本就停止运行了
nohup command &amp; --不挂断的执行程序
setsid command &amp; --关闭shell终端，命令继续后台运行 (monitor.sh &amp;) --关闭shell终端，命令继续后台运行
disown -h %1
开机执行脚本
方案一： 1.因为其中的rc.local是在完成所有初始化之后执行，因此我们可以把启动脚本写到里面 2.用root账号登陆Linux，vi /etc/rc.d/rc.local编辑文件，在最后加入两行需要执行的脚本程序
cd /home/test1 --该步不可少，否则会提示没有权限打开&#39;test.log&#39;文件 su test1 -c &#34;python /home/test1/test.py&#34; --把要执行的命令作为一个参数传递级su 方案二： 1.init.d目录下都为可执行程序，他们其实是服务脚本，按照一定格式编写，Linux 在启动时会自动执行，类似Windows下
的服务 2.用root帐号登录，vi /etc/rc.d/init.d/mystart，追加如下内容： #!/bin/bash #chkconfig:2345 80 05 --指定在哪几个级别执行，0一般指关机， 6指的是重启，其他为正常启动。80为启动的优先级，05为关闭的优先机 #description:mystart service RETVAL=0 start(){ --启动服务的入口函数 echo -n &#34;mystart serive ...&#34; cd /home/test1 su test1 -c &#34;python /home/test1/test.py&#34; } stop(){ --关闭服务的入口函数 echo &#34;mystart service is stoped...&#34; } case $1 in --使用case，可以进行交互式操作 start) start ;; stop) stop ;; esac exit $RETVAL 3." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/3d779e7cff8e10e1e3170def3f12ea4a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2012-10-12T15:02:12+08:00" />
<meta property="article:modified_time" content="2012-10-12T15:02:12+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">linux后台运行命令</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>后台运行脚本  </p> 
<p>monitor.sh &amp;            --shell终端断掉脚本就停止运行了</p> 
<p>nohup command &amp;         --不挂断的执行程序</p> 
<p>setsid command &amp;        --关闭shell终端，命令继续后台运行      </p> 
<p>(monitor.sh &amp;)          --关闭shell终端，命令继续后台运行</p> 
<p>disown -h %1</p> 
<p>开机执行脚本</p> 
<p>方案一： </p> 
<p>　1.因为其中的rc.local是在完成所有初始化之后执行，因此我们可以把启动脚本写到里面 </p> 
<p>　2.用root账号登陆Linux，vi /etc/rc.d/rc.local编辑文件，在最后加入两行需要执行的脚本程序</p> 
<p>　　cd /home/test1 --该步不可少，否则会提示没有权限打开'test.log'文件 </p> 
<p>　　su test1 -c "python /home/test1/test.py" --把要执行的命令作为一个参数传递级su <br> 方案二： </p> 
<p>　　1.init.d目录下都为可执行程序，他们其实是服务脚本，按照一定格式编写，Linux 在启动时会自动执行，类似Windows下</p> 
<p>的服务 </p> 
<p>　　2.用root帐号登录，vi /etc/rc.d/init.d/mystart，追加如下内容： </p> 
<p>　　#!/bin/bash </p> 
<p>　　#chkconfig:2345 80 05 --指定在哪几个级别执行，0一般指关机， </p> 
<p>　　6指的是重启，其他为正常启动。80为启动的优先级，05为关闭的优先机 </p> 
<p>　　#description:mystart service </p> 
<p>　　RETVAL=0 </p> 
<p>　　start(){ --启动服务的入口函数 </p> 
<p>　　echo -n "mystart serive ..." </p> 
<p>　　cd /home/test1 </p> 
<p>　　su test1 -c "python /home/test1/test.py" </p> 
<p>　　} </p> 
<p>　　stop(){ --关闭服务的入口函数 </p> 
<p>　　echo "mystart service is stoped..." </p> 
<p>　　} </p> 
<p>　　case $1 in --使用case，可以进行交互式操作 </p> 
<p>　　start) </p> 
<p>　　start </p> 
<p>　　;; </p> 
<p>　　stop) </p> 
<p>　　stop </p> 
<p>　　;; </p> 
<p>　　esac </p> 
<p>　　exit $RETVAL </p> 
<p>　　3.运行chmod +r /etc/rc.d/init.d/mystart,使之可直接执行 </p> 
<p>　　4.运行chkconfig --add mystart,把该服务添加到配置当中 </p> 
<p>　　5.运行chkconfig --list mystart,可以查看该服务进程的状态</p> 
<p>总结： </p> 
<p>　　两种方案的的核心都是切换用户到test1,然后执行命令启动Python程序，做成服务的好处是可以定义多个交互命令，比如</p> 
<p>：start,stop,restart,reset...，在服务运行的过程中还可以做相应操作。最开始的时候，我按照一般的思路写了如下脚本，</p> 
<p>却怎么也执行不了：</p> 
<p>　　su test1 --切换到test1用户 </p> 
<p>　　cd /home/test1 --切换到根目录 </p> 
<p>　　python test.py --执行python程序 </p> 
<p>　　exit --退出test1帐号 </p> 
<p>　　看起来好象一切都没错，但是发现只运行了第一行的命令，后面的都没有运行，直到退出test1用户后才发现好象执行完毕</p> 
<p>。分析原因，是因为Linux启动的时候是在root帐号下，执行su test1等于打开了一个新的shell脚本，因此下面的代码都在等</p> 
<p>着新的Shell脚本结束才能运行，就象在主程序里调用了一个子程序，而子程序是个死循环，一下出来来结果下面的要等死了。</p> 
<p>知道了发生的原因，那么解决的办法就相对简单了，就是在执行上述脚本程序时，不要离开本身的Shell。我们可以把执行命令</p> 
<p>做为su的一个参数传递进去，因为没有涉及到打开新的Shell，因此可以正常执行你期望的脚本程序，顺利实现开机自动启动指</p> 
<p>定的脚本程序。</p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e114fa2245d341938bba1bc704578f91/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">数组 按行，列存储</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b0991421e86c4f32e99dc8644de6cde3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">FML32 API</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>