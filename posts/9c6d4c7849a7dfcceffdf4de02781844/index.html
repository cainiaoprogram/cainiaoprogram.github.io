<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>精讲23种设计模式-006：深入研究单例底层实现原理 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="精讲23种设计模式-006：深入研究单例底层实现原理" />
<meta property="og:description" content="006：深入研究单例底层实现原理 1 深入研究单例底层实现原理课程安排2 单例模式基本概念与优缺点3 手写单例模式4 使用反射机制破解单例&amp;如何防御5 使用序列化破坏单例&amp;如何防御6 序列化如何生成一个新的对象7 枚举是最安全的单例 1 深入研究单例底层实现原理课程安排 课程内容
单例模式基本与设计思想概念单例模式的应用场景单例模式多种写法懒汉式为什么需要双重检验锁Java创建对象有哪些方式如何防止单例被反射、序列化破解反序列化创建对象底层实现原理 2 单例模式基本概念与优缺点 单例基本概念
在Jvm中只会存在一个实例
单例优缺点
优点：
不会频繁创建对象，节约服务器内存；只有一个实例实现复用，不需要再创建对象，访问速度比较快； 缺点：
因为该对象只有一个实例，多个线程同时共享同一个单例对象的时候，可能存在线程安全问题；单例对象一般创建加static存放在永久区，不会被垃圾回收机制回收，会一直占用服务器内存，如果创建过多可能导致服务器内存溢出； 单例应用场景
项目中定义的配置文件都是单例；SpringIOC容器创建对象默认单例（复用）；线程池和数据库连接池；Servlet对象默认单例，线程不安全、SpringMVC基于Servlet封装也不安全；Jvm内置缓存框架，底层基于HashMap封装&#43;淘汰策略，hashMap对象单例；枚举、常量网站计数器 3 手写单例模式 懒汉式概念：当真正需要该对象的时候才会创建该对象。
注意：需要将构造函数私有化
手写懒汉式(线程不安全)
public class Singleton01 { private static Singleton01 singleton01 = null; /** * 私有化 */ private Singleton01() { System.out.println(&#34;singleton01&#34;); } public static Singleton01 getInstance() { if (singleton01 == null) { singleton01 = new Singleton01(); } return singleton01; } public static void main(String[] args) { Singleton01 instance1 = Singleton01." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/9c6d4c7849a7dfcceffdf4de02781844/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-10-11T08:14:53+08:00" />
<meta property="article:modified_time" content="2021-10-11T08:14:53+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">精讲23种设计模式-006：深入研究单例底层实现原理</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>006：深入研究单例底层实现原理</h4> 
 <ul><li><ul><li><a href="#1__1" rel="nofollow">1 深入研究单例底层实现原理课程安排</a></li><li><a href="#2__11" rel="nofollow">2 单例模式基本概念与优缺点</a></li><li><a href="#3__33" rel="nofollow">3 手写单例模式</a></li><li><a href="#4__186" rel="nofollow">4 使用反射机制破解单例&amp;如何防御</a></li><li><a href="#5__242" rel="nofollow">5 使用序列化破坏单例&amp;如何防御</a></li><li><a href="#6__315" rel="nofollow">6 序列化如何生成一个新的对象</a></li><li><a href="#7__370" rel="nofollow">7 枚举是最安全的单例</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="1__1"></a>1 深入研究单例底层实现原理课程安排</h3> 
<p><strong>课程内容</strong></p> 
<ol><li>单例模式基本与设计思想概念</li><li>单例模式的应用场景</li><li>单例模式多种写法</li><li>懒汉式为什么需要双重检验锁</li><li>Java创建对象有哪些方式</li><li>如何防止单例被反射、序列化破解</li><li>反序列化创建对象底层实现原理</li></ol> 
<h3><a id="2__11"></a>2 单例模式基本概念与优缺点</h3> 
<p><strong>单例基本概念</strong><br> 在Jvm中只会存在一个实例</p> 
<p><strong>单例优缺点</strong><br> <strong>优点：</strong></p> 
<ol><li>不会频繁创建对象，节约服务器内存；</li><li>只有一个实例实现复用，不需要再创建对象，访问速度比较快；</li></ol> 
<p><strong>缺点：</strong></p> 
<ol><li>因为该对象只有一个实例，多个线程同时共享同一个单例对象的时候，可能存在线程安全问题；</li><li>单例对象一般创建加static存放在永久区，不会被垃圾回收机制回收，会一直占用服务器内存，如果创建过多可能导致服务器内存溢出；</li></ol> 
<p><strong>单例应用场景</strong></p> 
<ol><li>项目中定义的配置文件都是单例；</li><li>SpringIOC容器创建对象默认单例（复用）；</li><li>线程池和数据库连接池；</li><li>Servlet对象默认单例，线程不安全、SpringMVC基于Servlet封装也不安全；</li><li>Jvm内置缓存框架，底层基于HashMap封装+淘汰策略，hashMap对象单例；</li><li>枚举、常量</li><li>网站计数器</li></ol> 
<h3><a id="3__33"></a>3 手写单例模式</h3> 
<p><strong>懒汉式概念</strong>：当真正需要该对象的时候才会创建该对象。<br> 注意：需要将构造函数私有化</p> 
<p><strong>手写懒汉式(线程不安全)</strong></p> 
<pre><code class="prism language-javascript"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton01</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> Singleton01 singleton01 <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 私有化
     */</span>
    <span class="token keyword">private</span> <span class="token function">Singleton01</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"singleton01"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> Singleton01 <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>singleton01 <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            singleton01 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton01</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> singleton01<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token parameter">String<span class="token punctuation">[</span><span class="token punctuation">]</span> args</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        Singleton01 instance1 <span class="token operator">=</span> Singleton01<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Singleton01 instance2 <span class="token operator">=</span> Singleton01<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>instance1 <span class="token operator">==</span> instance2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>运行结果：</strong><br> <img src="https://images2.imgbox.com/dd/64/H8cqzkMg_o.png" alt="请添加图片描述"><br> <strong>该写法</strong>：如果多个线程同时访问，有可能会造成线程不安全，创建多个对象，违背单例唯一原则。<br> <strong>线程安全问题</strong>：多个线程同时共享同一个全局变量，做写的操作的时候，可能会产生线程安全问题。</p> 
<p><strong>手写懒汉式(线程安全)</strong></p> 
<pre><code class="prism language-javascript"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton02</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> Singleton02 singleton02<span class="token punctuation">;</span>
    
    <span class="token keyword">private</span> <span class="token function">Singleton02</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        
    <span class="token punctuation">}</span>

    <span class="token comment">// synchronized加在方法上，读取的时候也会上锁，效率低</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> synchronized Singleton02 <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>singleton02 <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            singleton02 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton02</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> singleton02<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token parameter">String<span class="token punctuation">[</span><span class="token punctuation">]</span> args</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        Singleton02 instance1 <span class="token operator">=</span> Singleton02<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Singleton02 instance2 <span class="token operator">=</span> Singleton02<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>instance1 <span class="token operator">==</span> instance2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>该写法</strong>：虽然能保证线程安全问题，但只要该对象创建以后，后期获取对象的时候都需要获取锁，效率非常低。</p> 
<p><strong>懒汉式双重检验锁</strong></p> 
<pre><code class="prism language-javascript"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton03</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> Singleton03 singleton03<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token function">Singleton03</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> Singleton03 <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 第一次判断 上锁 作用是保证仅在创建对象的时候会上锁，获取对象不会上锁</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>singleton03 <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">synchronized</span> <span class="token punctuation">(</span><span class="token parameter">Singleton03<span class="token punctuation">.</span>class</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 第二次判断 保证后面代码处理逻辑单线程，防止创建多个对象</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>singleton03 <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    singleton03 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton03</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> singleton03<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token parameter">String<span class="token punctuation">[</span><span class="token punctuation">]</span> args</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        Singleton03 instance1 <span class="token operator">=</span> Singleton03<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Singleton03 instance2 <span class="token operator">=</span> Singleton03<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>instance1 <span class="token operator">==</span> instance2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>该写法</strong>：既能解决线程安全问题（两次判断保证创建对象唯一），效率也比较高（获取对象的时候不会进入锁）</p> 
<p><strong>懒汉式与饿汉式区别</strong><br> 懒汉式：当真正需要该对象才会创建，相对节约内存空间使用。缺点：先天性线程不安全，需要后期通过代码保证线程安全问题；<br> 饿汉式：在class文件被加载的时候就会创建该对象，先天性线程安全（只会加载一次），缺点是比较浪费内存空间。</p> 
<p><strong>饿汉式实现单例（线程安全）</strong></p> 
<pre><code class="prism language-javascript"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton04</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">// 当class文件被加载的时候就会创建该对象</span>
<span class="token comment">//    private static Singleton04 singleton04 = new Singleton04();</span>
    <span class="token comment">// 创建常量写法</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> final Singleton04 singleton04 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton04</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token function">Singleton04</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"singleton04"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> Singleton04 <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> singleton04<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token parameter">String<span class="token punctuation">[</span><span class="token punctuation">]</span> args</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token comment">//        Singleton04 instance1 = Singleton04.getInstance();</span>
<span class="token comment">//        Singleton04 instance2 = Singleton04.getInstance();</span>
<span class="token comment">//        System.out.println(instance1 == instance2);</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Singleton04<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> Singleton04<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>项目中定义的常量都是饿汉式形式，如果定义常量过多，可能导致内存溢出。</p> 
<p><strong>基于静态代码块实现单例</strong></p> 
<pre><code class="prism language-javascript"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton05</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> Singleton05 singleton05 <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token function">Singleton05</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token punctuation">{<!-- --></span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"当前class被加载"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        singleton05 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton05</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> Singleton05 <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> singleton05<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token parameter">String<span class="token punctuation">[</span><span class="token punctuation">]</span> args</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token comment">//        Singleton05 instance1 = Singleton05.getInstance();</span>
<span class="token comment">//        Singleton05 instance2 = Singleton05.getInstance();</span>
<span class="token comment">//        System.out.println(instance1 == instance2);</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>饿汉式写法，当class被加载即初始化。<br> <img src="https://images2.imgbox.com/80/66/m64bfQ5b_o.png" alt="请添加图片描述"></p> 
<h3><a id="4__186"></a>4 使用反射机制破解单例&amp;如何防御</h3> 
<p><strong>Jvm中可以通过哪些方式创建对象？</strong><br> 反射机制、序列化、new、克隆技术</p> 
<pre><code class="prism language-javascript"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test001</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> throws Exception <span class="token punctuation">{<!-- --></span>
        Singleton01 instance1 <span class="token operator">=</span> Singleton01<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 使用反射机制创建对象</span>
        Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">&gt;</span> aClass <span class="token operator">=</span> Class<span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.mayikt.Singleton01"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        Constructor&lt;?&gt; constructor = aClass.getConstructor(); // 获取所有的构造函数，包括父类Object的，报错</span>
        Constructor<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">&gt;</span> constructor <span class="token operator">=</span> aClass<span class="token punctuation">.</span><span class="token function">getDeclaredConstructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 获取当前类的无参构造函数，不包含父类</span>
        constructor<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Singleton01 instance2 <span class="token operator">=</span> <span class="token punctuation">(</span>Singleton01<span class="token punctuation">)</span> constructor<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>instance1 <span class="token operator">==</span> instance2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>运行结果：</strong><br> <img src="https://images2.imgbox.com/ae/9c/nBG7yeAi_o.png" alt="请添加图片描述"><br> <strong>如何防御反射破解单例</strong></p> 
<pre><code class="prism language-javascript"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton01</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> Singleton01 singleton01 <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 私有化
     */</span>
    <span class="token keyword">private</span> <span class="token function">Singleton01</span><span class="token punctuation">(</span><span class="token punctuation">)</span> throws Exception <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>singleton01 <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span><span class="token string">"该对象已经创建过，不能重复创建"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            singleton01 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"singleton01"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> Singleton01 <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> throws Exception <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>singleton01 <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            singleton01 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton01</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> singleton01<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> throws Exception <span class="token punctuation">{<!-- --></span>
        Singleton01 instance1 <span class="token operator">=</span> Singleton01<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Singleton01 instance2 <span class="token operator">=</span> Singleton01<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>instance1 <span class="token operator">==</span> instance2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>运行结果：</strong><br> <img src="https://images2.imgbox.com/1e/dd/se7P6T9Z_o.png" alt="请添加图片描述"><br> 如果没有else部分，则当反射创建对象在getInstance()创建对象之前调用，防御无效。</p> 
<h3><a id="5__242"></a>5 使用序列化破坏单例&amp;如何防御</h3> 
<p><strong>序列化</strong>：将对象转换成二进制形式直接存放在硬盘持久化；<br> <strong>反序列化</strong>：从本地文件读取二进制文件转换成对象；</p> 
<pre><code class="prism language-javascript"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test003</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> throws Exception <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 1.需要将该对象序列化到本地存放</span>
        FileOutputStream fos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">"d:/code/singleton.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ObjectOutputStream oos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectOutputStream</span><span class="token punctuation">(</span>fos<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Singleton01 instance1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton01</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        oos<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>instance1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        oos<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fos<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//2.从硬盘中反序列化对象到内存中</span>
        ObjectInputStream ois <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">"d:/code/singleton.txt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Singleton01 instance2 <span class="token operator">=</span> <span class="token punctuation">(</span>Singleton01<span class="token punctuation">)</span> ois<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>instance1 <span class="token operator">==</span> instance2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>运行结果：</strong><br> <img src="https://images2.imgbox.com/b6/9d/D4Uw2U5F_o.png" alt="请添加图片描述"><br> 序列化创建对象违背单例设计原则</p> 
<p><strong>疑问：</strong></p> 
<ol><li>序列化创建对象为什么没有走无参构造函数却创建新对象？</li><li>如何防御序列化创建新的对象</li></ol> 
<p><strong>如何防御序列化创建新的对象</strong></p> 
<pre><code class="prism language-javascript"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton01</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> Singleton01 singleton01 <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 私有化
     */</span>
    <span class="token function">Singleton01</span><span class="token punctuation">(</span><span class="token punctuation">)</span> throws Exception <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>singleton01 <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span><span class="token string">"该对象已经创建过，不能重复创建"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            singleton01 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"singleton01"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> Singleton01 <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> throws Exception <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>singleton01 <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            singleton01 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton01</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> singleton01<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> throws Exception <span class="token punctuation">{<!-- --></span>
        Singleton01 instance1 <span class="token operator">=</span> Singleton01<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Singleton01 instance2 <span class="token operator">=</span> Singleton01<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>instance1 <span class="token operator">==</span> instance2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 序列号生成回调方法，通过该方法实现反序列化生成单例对象
     * 方法名称一定是固定写死的 readResolve
     * @return
     */</span>
    <span class="token keyword">public</span> Object <span class="token function">readResolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> singleton01<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>运行结果：</strong><br> <img src="https://images2.imgbox.com/e9/20/9evioCzr_o.png" alt="请添加图片描述"></p> 
<h3><a id="6__315"></a>6 序列化如何生成一个新的对象</h3> 
<p><strong>序列化如何生成一个新的对象</strong><br> 通过序列化的形式创建对象不会走序列化类无参构造函数，判断序列化类是否有实现Serializable接口，如果实现该接口的情况下，则调动该类的父类(没有实现Serializable接口)无参构造函数，通过父类实例化该对象。如果父类也实现了Serializable接口，通过Object类初始化该对象。</p> 
<pre><code class="prism language-javascript"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton01</span> <span class="token keyword">extends</span> <span class="token class-name">UserEntity</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> Singleton01 singleton01 <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 私有化
     */</span>
    <span class="token function">Singleton01</span><span class="token punctuation">(</span><span class="token punctuation">)</span> throws Exception <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>singleton01 <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span><span class="token string">"该对象已经创建过，不能重复创建"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            singleton01 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"singleton01"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> Singleton01 <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> throws Exception <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>singleton01 <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            singleton01 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton01</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> singleton01<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> throws Exception <span class="token punctuation">{<!-- --></span>
        Singleton01 instance1 <span class="token operator">=</span> Singleton01<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Singleton01 instance2 <span class="token operator">=</span> Singleton01<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>instance1 <span class="token operator">==</span> instance2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 序列号生成回调方法，通过该方法实现反序列化生成单例对象
     * 方法名称一定是固定写死的 readResolve
     * @return
     */</span>
    <span class="token keyword">public</span> Object <span class="token function">readResolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> singleton01<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-javascript"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserEntity</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token function">UserEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"父类开始初始化"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>运行结果：</strong><br> <img src="https://images2.imgbox.com/15/1e/ap9TZNaV_o.png" alt="请添加图片描述"><br> <strong>readResolve方法执行的原理</strong><br> 序列化在创建对象的时候，判断序列化类中是否存在readResolve方法，如果存在的情况下，则直接走反射调用序列化类中的readResolve方法返回单例对象。</p> 
<h3><a id="7__370"></a>7 枚举是最安全的单例</h3> 
<p>序列化、反射破解单例不能在根本底层上解决<br> 枚举 最安全的单例：</p> 
<ol><li>先天性 通过序列化生成的对象默认保证单例</li><li>反射无法初始化到枚举</li></ol> 
<pre><code class="prism language-javascript"><span class="token keyword">public</span> <span class="token keyword">enum</span> Singleton06 <span class="token punctuation">{<!-- --></span>

    <span class="token constant">INSTANCE</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"枚举类，先天性安全"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">Singleton06</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&gt;&gt;无参构造函数执行"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-javascript"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test004</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> throws Exception <span class="token punctuation">{<!-- --></span>
<span class="token comment">//        Singleton06 instance1 = Singleton06.INSTANCE;</span>
<span class="token comment">//        Singleton06 instance2 = Singleton06.INSTANCE;</span>
<span class="token comment">//        System.out.println(instance1 == instance2);</span>
<span class="token comment">//</span>
<span class="token comment">//        Class&lt;?&gt; aClass = Class.forName("com.mayikt.Singleton06");</span>
<span class="token comment">//        aClass.newInstance();  // 报错</span>

        <span class="token comment">// 1.需要将该对象序列化到本地存放</span>
        FileOutputStream fos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">"d:/code/enum.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ObjectOutputStream oos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectOutputStream</span><span class="token punctuation">(</span>fos<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Singleton06 instance1 <span class="token operator">=</span> Singleton06<span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">;</span>
        oos<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>instance1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        oos<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fos<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//2.从硬盘中反序列化对象到内存中</span>
        ObjectInputStream ois <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">"d:/code/enum.txt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Singleton06 instance2 <span class="token operator">=</span> <span class="token punctuation">(</span>Singleton06<span class="token punctuation">)</span> ois<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>instance1 <span class="token operator">==</span> instance2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>运行结果：</strong><br> <img src="https://images2.imgbox.com/1e/fa/VpLwF1mI_o.png" alt="请添加图片描述"><br> 源码下载地址（mayikt_designPattern_6.zip）：<br> 链接：https://pan.baidu.com/s/1wWKZN1MbXICZVW1Vxtwe6A<br> 提取码：fire</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/027ff13dbf2298d2df0d7a70ad9157f3/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">基于阿里巴巴（cluster data v2018）数据集对表格machine_mate进行简单处理</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3edcd6418c1d59f81d6a92f8722badc1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">java一个接口可以继承另外一个接口吗</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>