<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>yolov5转onnx，c&#43;&#43;调用完美复现 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="yolov5转onnx，c&#43;&#43;调用完美复现" />
<meta property="og:description" content="YOLOV5s 5.0 c&#43;&#43;调用模型onnx（超精华） 介绍训练模型.pt转onnxc&#43;&#43;代码解析main函数部分推理部分讲解darpred部分sigmod部分结尾 介绍 现在很多开发都是需要用c&#43;&#43;做最后一步的移植部署，手写吧，先不说你会不会浪费时间，网上找吧，问题千奇百怪，所以给大家出这篇文章，做雷锋教学，话不多说，开始
后面会贴出我的微信联系方式，有需要源码&#43;opencv文件的自行添加我
训练模型.pt转onnx 训练部分根据呼声再决定要不要写一份博客吧！！
注意事项：
1.训练代码一定要选择yolov5 5.0版本
2. 进入models/exprort.py；
3.将红框区域换成你自己的训练完的模型
4.将版本换成12；
5.直接运行即可，会生成出onnx的模型出来。
c&#43;&#43;代码解析 博主使用的是opencv4.5.3版本，已经编译好的，需要直接扫码加我发你 main函数部分 读取模型利用的是dnn::readNet，opencv其实挺强大的博主已经读过tf模型，torch模型后续都会出对应博客，这里总共有三点改，输入图片path,输入类别名class_names,net部分改成自己的模型
net.set这些参数都固定就好，有兴趣的同学可以研究研究DNN_TARGET_CPU这个地方，是可以使用gpu和cuda的，但是博主还没复现过
推理部分讲解 void postprocess(cv::Mat&amp; cv_src, std::vector&lt;cv::Mat&gt;&amp; outs, const std::vector&lt;std::string&gt;&amp; classes, int net_size) { float confThreshold = 0.1f; float nmsThreshold = 0.1f; std::vector&lt;int&gt; classIds; std::vector&lt;float&gt; confidences; std::vector&lt;cv::Rect&gt; boxes; int strides[] = { 8, 16, 32 }; std::vector&lt;std::vector&lt;int&gt; &gt; anchors = { { 10,13, 16,30, 33,23 }, { 30,61, 62,45, 59,119 }, { 116,90, 156,198, 373,326 } }; for (size_t k = 0; k &lt; outs." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/facb417875ed7398acd763c7fced211f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-12-21T18:10:54+08:00" />
<meta property="article:modified_time" content="2021-12-21T18:10:54+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">yolov5转onnx，c&#43;&#43;调用完美复现</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>YOLOV5s 5.0 c++调用模型onnx（超精华）</h4> 
 <ul><li><a href="#_2" rel="nofollow">介绍</a></li><li><ul><li><a href="#ptonnx_7" rel="nofollow">训练模型.pt转onnx</a></li><li><a href="#c_21" rel="nofollow">c++代码解析</a></li><li><a href="#main_24" rel="nofollow">main函数部分</a></li><li><a href="#_28" rel="nofollow">推理部分讲解</a></li><li><a href="#darpred_95" rel="nofollow">darpred部分</a></li><li><a href="#sigmod_116" rel="nofollow">sigmod部分</a></li><li><a href="#_127" rel="nofollow">结尾</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_2"></a>介绍</h2> 
<p>现在很多开发都是需要用c++做最后一步的移植部署，手写吧，先不说你会不会浪费时间，网上找吧，问题千奇百怪，所以给大家出这篇文章，做雷锋教学，话不多说，开始<br> <strong>后面会贴出我的微信联系方式，有需要源码+opencv文件的自行添加我</strong></p> 
<h3><a id="ptonnx_7"></a>训练模型.pt转onnx</h3> 
<p>训练部分根据呼声再决定要不要写一份博客吧！！<br> 注意事项：<br> 1.训练代码一定要选择<strong>yolov5 5.0</strong>版本<br> 2. 进入models/exprort.py；<br> <img src="https://images2.imgbox.com/2a/e4/Ih5vULv8_o.png" alt="请添加图片描述"><br> 3.将红框区域换成你自己的训练完的模型<br> <img src="https://images2.imgbox.com/b0/e1/iaJHoysz_o.png" alt="请添加图片描述"></p> 
<p>4.将版本换成12；<br> <img src="https://images2.imgbox.com/f0/34/Q3SuHeYw_o.png" alt="请添加图片描述"></p> 
<p>5.直接运行即可，会生成出onnx的模型出来。</p> 
<h3><a id="c_21"></a>c++代码解析</h3> 
<ul><li>博主使用的是opencv4.5.3版本，已经编译好的，需要直接扫码加我发你</li></ul> 
<h3><a id="main_24"></a>main函数部分</h3> 
<p><img src="https://images2.imgbox.com/c4/c6/rVU7BswU_o.png" alt="请添加图片描述"><br> 读取模型利用的是dnn::readNet，opencv其实挺强大的博主已经读过tf模型，torch模型后续都会出对应博客，这里总共有三点改，<strong>输入图片path,输入类别名class_names,net部分改成自己的模型</strong><br> net.set这些参数都固定就好，有兴趣的同学可以研究研究DNN_TARGET_CPU这个地方，是可以使用gpu和cuda的，但是博主还没复现过</p> 
<h3><a id="_28"></a>推理部分讲解</h3> 
<pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token function">postprocess</span><span class="token punctuation">(</span>cv<span class="token operator">::</span>Mat<span class="token operator">&amp;</span> cv_src<span class="token punctuation">,</span> std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>cv<span class="token operator">::</span>Mat<span class="token operator">&gt;</span><span class="token operator">&amp;</span> outs<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>std<span class="token operator">::</span>string<span class="token operator">&gt;</span><span class="token operator">&amp;</span> classes<span class="token punctuation">,</span> <span class="token keyword">int</span> net_size<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">float</span> confThreshold <span class="token operator">=</span> <span class="token number">0.1f</span><span class="token punctuation">;</span>
	<span class="token keyword">float</span> nmsThreshold <span class="token operator">=</span> <span class="token number">0.1f</span><span class="token punctuation">;</span>
	std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> classIds<span class="token punctuation">;</span>
	std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span> confidences<span class="token punctuation">;</span>
	std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>cv<span class="token operator">::</span>Rect<span class="token operator">&gt;</span> boxes<span class="token punctuation">;</span>
	<span class="token keyword">int</span> strides<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">32</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
	std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token operator">&gt;</span> anchors <span class="token operator">=</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token punctuation">{<!-- --></span> <span class="token number">10</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span><span class="token number">23</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">{<!-- --></span> <span class="token number">30</span><span class="token punctuation">,</span><span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">,</span><span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">,</span><span class="token number">119</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">{<!-- --></span> <span class="token number">116</span><span class="token punctuation">,</span><span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">156</span><span class="token punctuation">,</span><span class="token number">198</span><span class="token punctuation">,</span> <span class="token number">373</span><span class="token punctuation">,</span><span class="token number">326</span> <span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>size_t k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> outs<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">float</span><span class="token operator">*</span> data <span class="token operator">=</span> outs<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>ptr<span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">int</span> stride <span class="token operator">=</span> strides<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token keyword">int</span> num_classes <span class="token operator">=</span> outs<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>size<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> outs<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>size<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> outs<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>size<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> a <span class="token operator">&lt;</span> outs<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>size<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">++</span>a<span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token keyword">float</span><span class="token operator">*</span> record <span class="token operator">=</span> data <span class="token operator">+</span> a <span class="token operator">*</span> outs<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>size<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">*</span> outs<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>size<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">*</span> outs<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>size<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">+</span>
						i <span class="token operator">*</span> outs<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>size<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">*</span> outs<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>size<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">+</span> j <span class="token operator">*</span> outs<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>size<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
					<span class="token keyword">float</span><span class="token operator">*</span> cls_ptr <span class="token operator">=</span> record <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">;</span>
					<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> cls <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> cls <span class="token operator">&lt;</span> num_classes<span class="token punctuation">;</span> cls<span class="token operator">++</span><span class="token punctuation">)</span>
					<span class="token punctuation">{<!-- --></span>
						<span class="token keyword">float</span> score <span class="token operator">=</span> <span class="token function">sigmoid</span><span class="token punctuation">(</span>cls_ptr<span class="token punctuation">[</span>cls<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">sigmoid</span><span class="token punctuation">(</span>record<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span>score <span class="token operator">&gt;</span> confThreshold<span class="token punctuation">)</span>
						<span class="token punctuation">{<!-- --></span>
							<span class="token keyword">float</span> cx <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">sigmoid</span><span class="token punctuation">(</span>record<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2.f</span> <span class="token operator">-</span> <span class="token number">0.5f</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>j<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>stride<span class="token punctuation">;</span>
							<span class="token keyword">float</span> cy <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">sigmoid</span><span class="token punctuation">(</span>record<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2.f</span> <span class="token operator">-</span> <span class="token number">0.5f</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>i<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>stride<span class="token punctuation">;</span>
							<span class="token keyword">float</span> w <span class="token operator">=</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token function">sigmoid</span><span class="token punctuation">(</span>record<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2.f</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span> anchors<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> a<span class="token punctuation">]</span><span class="token punctuation">;</span>
							<span class="token keyword">float</span> h <span class="token operator">=</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token function">sigmoid</span><span class="token punctuation">(</span>record<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2.f</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span> anchors<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> a <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
							<span class="token keyword">float</span> x1 <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> std<span class="token operator">::</span><span class="token function">min</span><span class="token punctuation">(</span>cv_src<span class="token punctuation">.</span>cols<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>cx <span class="token operator">-</span> w <span class="token operator">/</span> <span class="token number">2.f</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>cv_src<span class="token punctuation">.</span>cols <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>net_size<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token keyword">float</span> y1 <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> std<span class="token operator">::</span><span class="token function">min</span><span class="token punctuation">(</span>cv_src<span class="token punctuation">.</span>rows<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>cy <span class="token operator">-</span> h <span class="token operator">/</span> <span class="token number">2.f</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>cv_src<span class="token punctuation">.</span>rows <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>net_size<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token keyword">float</span> x2 <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> std<span class="token operator">::</span><span class="token function">min</span><span class="token punctuation">(</span>cv_src<span class="token punctuation">.</span>cols<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>cx <span class="token operator">+</span> w <span class="token operator">/</span> <span class="token number">2.f</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>cv_src<span class="token punctuation">.</span>cols <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>net_size<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token keyword">float</span> y2 <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> std<span class="token operator">::</span><span class="token function">min</span><span class="token punctuation">(</span>cv_src<span class="token punctuation">.</span>rows<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>cy <span class="token operator">+</span> h <span class="token operator">/</span> <span class="token number">2.f</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>cv_src<span class="token punctuation">.</span>rows <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>net_size<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
							classIds<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>cls<span class="token punctuation">)</span><span class="token punctuation">;</span>
							confidences<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>score<span class="token punctuation">)</span><span class="token punctuation">;</span>
							boxes<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>cv<span class="token operator">::</span><span class="token function">Rect</span><span class="token punctuation">(</span>cv<span class="token operator">::</span><span class="token function">Point</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">)</span><span class="token punctuation">,</span> cv<span class="token operator">::</span><span class="token function">Point</span><span class="token punctuation">(</span>x2<span class="token punctuation">,</span> y2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> indices<span class="token punctuation">;</span>
	cv<span class="token operator">::</span>dnn<span class="token operator">::</span><span class="token function">NMSBoxes</span><span class="token punctuation">(</span>boxes<span class="token punctuation">,</span> confidences<span class="token punctuation">,</span> confThreshold<span class="token punctuation">,</span> nmsThreshold<span class="token punctuation">,</span> indices<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> indices<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">int</span> idx <span class="token operator">=</span> indices<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
		cv<span class="token operator">::</span>Rect box <span class="token operator">=</span> boxes<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token function">drawPred</span><span class="token punctuation">(</span>classIds<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">,</span> confidences<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">,</span> box<span class="token punctuation">.</span>x<span class="token punctuation">,</span> box<span class="token punctuation">.</span>y<span class="token punctuation">,</span>
			box<span class="token punctuation">.</span>x <span class="token operator">+</span> box<span class="token punctuation">.</span>width<span class="token punctuation">,</span> box<span class="token punctuation">.</span>y <span class="token operator">+</span> box<span class="token punctuation">.</span>height<span class="token punctuation">,</span> cv_src<span class="token punctuation">,</span> classes<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>抬头部分是两大目标检测的阈值设置，然后anchors这些都不建议动，除非你在训练的时候用了你自己生成的anchors的话，就改成你自己的，然后根据训练推理后，会生成我们所对应的坐标框以及分数，将分数和狂送到容器中，dnn中有nms等底层函数哦<br> cv::dnn::NMSBoxes(boxes, confidences, confThreshold, nmsThreshold, indices);<br> 对应输入就可以了，然后得到我们的Box,index,和置信度，接下来就到了我们的画图环节。</p> 
<h3><a id="darpred_95"></a>darpred部分</h3> 
<pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token function">drawPred</span><span class="token punctuation">(</span><span class="token keyword">int</span> classId<span class="token punctuation">,</span> <span class="token keyword">float</span> conf<span class="token punctuation">,</span> <span class="token keyword">int</span> left<span class="token punctuation">,</span> <span class="token keyword">int</span> top<span class="token punctuation">,</span> <span class="token keyword">int</span> right<span class="token punctuation">,</span> <span class="token keyword">int</span> bottom<span class="token punctuation">,</span> cv<span class="token operator">::</span>Mat<span class="token operator">&amp;</span> frame<span class="token punctuation">,</span>
	<span class="token keyword">const</span> std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>std<span class="token operator">::</span>string<span class="token operator">&gt;</span><span class="token operator">&amp;</span> classes<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	cv<span class="token operator">::</span><span class="token function">rectangle</span><span class="token punctuation">(</span>frame<span class="token punctuation">,</span> cv<span class="token operator">::</span><span class="token function">Point</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> top<span class="token punctuation">)</span><span class="token punctuation">,</span> cv<span class="token operator">::</span><span class="token function">Point</span><span class="token punctuation">(</span>right<span class="token punctuation">,</span> bottom<span class="token punctuation">)</span><span class="token punctuation">,</span> cv<span class="token operator">::</span><span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	std<span class="token operator">::</span>string label <span class="token operator">=</span> cv<span class="token operator">::</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%.2f"</span><span class="token punctuation">,</span> conf<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>classes<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">CV_Assert</span><span class="token punctuation">(</span>classId <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>classes<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		label <span class="token operator">=</span> classes<span class="token punctuation">[</span>classId<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">": "</span> <span class="token operator">+</span> label<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">int</span> baseLine<span class="token punctuation">;</span>
	cv<span class="token operator">::</span>Size labelSize <span class="token operator">=</span> cv<span class="token operator">::</span><span class="token function">getTextSize</span><span class="token punctuation">(</span>label<span class="token punctuation">,</span> cv<span class="token operator">::</span>FONT_HERSHEY_SIMPLEX<span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>baseLine<span class="token punctuation">)</span><span class="token punctuation">;</span>
	top <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">max</span><span class="token punctuation">(</span>top<span class="token punctuation">,</span> labelSize<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
	cv<span class="token operator">::</span><span class="token function">rectangle</span><span class="token punctuation">(</span>frame<span class="token punctuation">,</span> cv<span class="token operator">::</span><span class="token function">Point</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> top <span class="token operator">-</span> <span class="token function">round</span><span class="token punctuation">(</span><span class="token number">1.5</span> <span class="token operator">*</span> labelSize<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv<span class="token operator">::</span><span class="token function">Point</span><span class="token punctuation">(</span>left <span class="token operator">+</span> <span class="token function">round</span><span class="token punctuation">(</span><span class="token number">1.5</span> <span class="token operator">*</span> labelSize<span class="token punctuation">.</span>width<span class="token punctuation">)</span><span class="token punctuation">,</span> top <span class="token operator">+</span> baseLine<span class="token punctuation">)</span><span class="token punctuation">,</span> cv<span class="token operator">::</span><span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv<span class="token operator">::</span>FILLED<span class="token punctuation">)</span><span class="token punctuation">;</span>
	cv<span class="token operator">::</span><span class="token function">putText</span><span class="token punctuation">(</span>frame<span class="token punctuation">,</span> label<span class="token punctuation">,</span> cv<span class="token operator">::</span><span class="token function">Point</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> top<span class="token punctuation">)</span><span class="token punctuation">,</span> cv<span class="token operator">::</span>FONT_HERSHEY_SIMPLEX<span class="token punctuation">,</span> <span class="token number">0.75</span><span class="token punctuation">,</span> cv<span class="token operator">::</span><span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> 
<h3><a id="sigmod_116"></a>sigmod部分</h3> 
<pre><code class="prism language-cpp"><span class="token keyword">inline</span> <span class="token keyword">float</span> <span class="token function">sigmoid</span><span class="token punctuation">(</span><span class="token keyword">float</span> x<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token number">1.f</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1.f</span> <span class="token operator">+</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token operator">-</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_127"></a>结尾</h3> 
<p>虽然看代码部分还是挺简单的，但是在做出这些代码才是最艰难的部分，这个代码目前适用5.0版本是完全没问题的，如果遇到问题可以加下方微信，我可以帮你解决喔，欢迎评论意见，一起学习一起进步。<br> 至于理论知识或者专业知识，日后请多多关注博客，会分享很多有用的知识。<br> <img src="https://images2.imgbox.com/59/82/hgyuBu6a_o.png" alt="请添加图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3c641118796ed6668d53476efca079e8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">vagrant简介 (在virtualBox上安装虚拟机centos7) 创建和部署虚拟化开发环境</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fddf55fc821c3dc0d7ba628a1e5eb76b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">03-微服务架构及解决方案</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>