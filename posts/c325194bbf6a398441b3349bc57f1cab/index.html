<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>videojs-player视频播放技术学习 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="videojs-player视频播放技术学习" />
<meta property="og:description" content="介绍：
videojs是一个开源的HTML5视频播放器，它可以在各种设备和浏览器上播放视频。videojs提供了丰富的API和插件，可以实现自定义的视频播放功能。
使用videojs实现视频播放的步骤：
1. 引入videojs库 在HTML文件中引入videojs库的CSS和JS文件。
```html &lt;link href=&#34;https://vjs.zencdn.net/7.11.4/video-js.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;script src=&#34;https://vjs.zencdn.net/7.11.4/video.min.js&#34;&gt;&lt;/script&gt; ```
2. 创建video标签 在HTML文件中创建一个video标签，并设置视频的URL和封面图。
```html &lt;video id=&#34;my-video&#34; class=&#34;video-js&#34; controls preload=&#34;auto&#34; width=&#34;640&#34; height=&#34;264&#34; poster=&#34;poster.jpg&#34; data-setup=&#34;{}&#34;&gt;
&lt;source src=&#34;my-video.mp4&#34; type=&#39;video/mp4&#39;&gt;
&lt;p class=&#34;vjs-no-js&#34;&gt;
To view this video please enable JavaScript, and consider upgrading to a web browser that
&lt;a href=&#34;https://videojs.com/html5-video-support/&#34; target=&#34;_blank&#34;&gt;supports HTML5 video&lt;/a&gt; &lt;/p&gt;
&lt;/video&gt; ```
3. 初始化videojs 在JS文件中初始化videojs，并设置视频的配置选项。
```javascript var player = videojs(&#39;my-video&#39;, { autoplay: true, controls: true, sources: [{ src: &#39;my-video." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/c325194bbf6a398441b3349bc57f1cab/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-19T23:51:40+08:00" />
<meta property="article:modified_time" content="2023-06-19T23:51:40+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">videojs-player视频播放技术学习</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><strong>介绍：</strong></p> 
<p>videojs是一个开源的HTML5视频播放器，它可以在各种设备和浏览器上播放视频。videojs提供了丰富的API和插件，可以实现自定义的视频播放功能。</p> 
<p><strong>使用videojs实现视频播放的步骤：</strong></p> 
<p>1. 引入videojs库 在HTML文件中引入videojs库的CSS和JS文件。</p> 
<p>```html &lt;link href="https://vjs.zencdn.net/7.11.4/video-js.css" rel="stylesheet" /&gt;</p> 
<p>&lt;script src="https://vjs.zencdn.net/7.11.4/video.min.js"&gt;&lt;/script&gt; ```</p> 
<p>2. 创建video标签 在HTML文件中创建一个video标签，并设置视频的URL和封面图。</p> 
<p>```html &lt;video id="my-video" class="video-js" controls preload="auto" width="640" height="264" poster="poster.jpg" data-setup="{}"&gt;</p> 
<p>&lt;source src="my-video.mp4" type='video/mp4'&gt;</p> 
<p>&lt;p class="vjs-no-js"&gt;</p> 
<p>To view this video please enable JavaScript, and consider upgrading to a web browser that</p> 
<p>&lt;a href="https://videojs.com/html5-video-support/" target="_blank"&gt;supports HTML5 video&lt;/a&gt; &lt;/p&gt;</p> 
<p>&lt;/video&gt; ```</p> 
<p>3. 初始化videojs 在JS文件中初始化videojs，并设置视频的配置选项。</p> 
<p>```javascript var player = videojs('my-video', { autoplay: true, controls: true, sources: [{ src: 'my-video.mp4', type: 'video/mp4' }] }); ```</p> 
<p>4. 添加事件监听器 可以通过添加事件监听器来实现自定义的视频播放功能，例如：</p> 
<p>```javascript</p> 
<p>player.on('play', function()</p> 
<p>{ console.log('视频开始播放'); });</p> 
<p>player.on('pause', function()</p> 
<p>{ console.log('视频暂停播放'); });</p> 
<p>player.on('ended', function()</p> 
<p>{ console.log('视频播放结束'); }); ```</p> 
<p>通过以上步骤，就可以使用videojs实现视频播放功能了。</p> 
<p><strong>调试参考代码：</strong></p> 
<pre><code class="hljs">&lt;template&gt;
  &lt;video-player
    class="video-player vjs-big-play-centered"
    src="https://vjs.zencdn.net/v/oceans.mp4"
    poster="https://vjs.zencdn.net/v/oceans.png"
    crossorigin="anonymous"
    playsinline
    controls
    :volume="0.6"        
    :height="320"        
    :playback-rates="[0.7, 1.0, 1.5, 2.0]"        
    @mounted="handleMounted"
    @ready="handleEvent($event)"
    @play="handleEvent($event)"
    @pause="handleEvent($event)"
    @ended="handleEvent($event)"
    @loadeddata="handleEvent($event)"
    @waiting="handleEvent($event)"
    @playing="handleEvent($event)"
    @canplay="handleEvent($event)"
    @canplaythrough="handleEvent($event)"
    @timeupdate="handleEvent(player?.currentTime())"
  /&gt;
&lt;/template&gt;
 
&lt;script&gt;
  import { defineComponent, shallowRef } from 'vue'
  import { VideoJsPlayer } from 'video.js'
  import { VideoPlayer } from '@videojs-player/vue'
  import 'video.js/dist/video-js.css'
 
  export default {
    name: 'vue-basic-player-example',
    title: 'Basic player (Vue)',
    components: {
      VideoPlayer
    },
    setup() {
      //可打印出当前所触发的事件
      const handleEvent = (log) =&gt; {
        console.log('Basic player event', log)
      }
 
      return { handleEvent }
    }
  }
&lt;/script&gt;
 
&lt;style scoped&gt;
  .video-player {
    background-color: black;
    width: 100%;
  }
&lt;/style&gt;</code></pre> 
<p><strong>目标实现效果：</strong></p> 
<p><strong><img alt="" height="358" src="https://images2.imgbox.com/3e/88/0wKvWMUU_o.png" width="1134"></strong></p> 
<p><strong>另外的参考学习资料：</strong></p> 
<p>Vue3视频播放（Video组件）</p> 
<p>可自定义设置以下属性：  </p> 
<p>视频文件地址（src），类型：string，必传，默认 ''，支持网络地址 https 和相对地址</p> 
<p>视频封面地址（poster），类型：string，默认 ''，支持网络地址 https 和相对地址</p> 
<p>在未设置封面时，自动获取视频第 second 秒指定帧作为封面图（second），类型：number，单位 s，默认 0.5s，由于不少视频第一帧为黑屏，故设置视频开始播放时间为0.5s，即取该时刻帧作为封面图</p> 
<p>视频播放器宽度（width），类型：number，单位px，默认 800</p> 
<p>视频播放器高度（height），类型：number，单位px，默认 450</p> 
<p>视频就绪后是否马上播放（autoplay），优先级高于preload，类型：boolean，默认 false</p> 
<p>是否向用户显示控件，比如是否向用户显示控件，比如进度条，全屏等（controls），类型：boolean，默认 true</p> 
<p>视频播放完成后，是否循环播放（loop），类型：boolean，默认 false</p> 
<p>是否静音（muted），类型：boolean，默认 false</p> 
<p>是否在页面加载后载入视频（preload）如果设置了autoplay属性，则preload将被忽略，类型：'auto'|'metadata'|'none'，默认 auto // auto:一旦页面加载，则开始加载视频; metadata:当页面加载后仅加载视频的元数据 none:页面加载后不应加载视频</p> 
<p>播放暂停时是否显示播放器中间的暂停图标（showPlay），类型：boolean，默认 true</p> 
<p>video的poster默认图片和视频内容的缩放规则（fit），类型：'none'|'fill'|'contain'|'cover'，默认 'contain' // none:(默认)保存原有内容，不进行缩放; fill:不保持原有比例，内容拉伸填充整个内容容器; contain:保存原有比例，内容以包含方式缩放; cover:保存原有比例，内容以覆盖方式缩放</p> 
<p>注：为避免与 HTML5 原生标签 &lt;video&gt; 冲突，使用组件时必须使用大写组件名：&lt;Video&gt;！<br> 创建视频播放组件Video.vue： </p> 
<pre><code class="hljs">&lt;script setup lang="ts"&gt;
import { ref, onMounted } from 'vue'
interface Props {
  src: string // 视频文件地址，支持网络地址 https 和相对地址
  poster?: string // 视频封面地址，支持网络地址 https 和相对地址
  second?: number // 在未设置封面时，自动截取视频第 second 秒对应帧作为视频封面
  width?: number // 视频播放器宽度，单位px
  height?: number // 视频播放器高度，单位px
  autoplay?: boolean // 视频就绪后是否马上播放，优先级高于preload
  controls?: boolean // 是否向用户显示控件，比如进度条，全屏等
  loop?: boolean // 视频播放完成后，是否循环播放
  muted?: boolean // 是否静音
  preload?: 'auto'|'metadata'|'none' // 是否在页面加载后载入视频，如果设置了autoplay属性，则preload将被忽略
  showPlay?: boolean // 播放暂停时是否显示播放器中间的暂停图标
  fit?: 'none'|'fill'|'contain'|'cover' // video的poster默认图片和视频内容缩放规则
}
const props = withDefaults(defineProps&lt;Props&gt;(), {
  src: '',
  poster: '',
  second: 0.5,
  width: 800,
  height: 450,
  /*
    参考 MDN 自动播放指南：https://developer.mozilla.org/zh-CN/docs/Web/Media/Autoplay_guide
    Autoplay 功能
    据新政策，媒体内容将在满足以下至少一个的条件下自动播放：
    1.音频被静音或其音量设置为 0
    2.用户和网页已有交互行为（包括点击、触摸、按下某个键等等）
    3.网站已被列入白名单；如果浏览器确定用户经常与媒体互动，这可能会自动发生，也可能通过首选项或其他用户界面功能手动发生
    4.自动播放策略应用到&lt;iframe&gt;或者其文档上
    autoplay：由于目前在最新版的Chrome浏览器（以及所有以Chromium为内核的浏览器）中，
    已不再允许自动播放音频和视频。就算你为video或audio标签设置了autoplay属性也一样不能自动播放！
    解决方法：设置视频 autoplay 时，视频必须设置为静音 muted: true 即可实现自动播放，
    然后用户可以使用控制栏开启声音，类似某宝商品自动播放的宣传视频逻辑
  */
  autoplay: false,
  controls: true,
  loop: false,
  muted: false,
  /*
    preload可选属性：
    auto: 一旦页面加载，则开始加载视频;
    metadata: 当页面加载后仅加载视频的元数据（例如长度），建议使用metadata，以便视频自动获取第一帧作为封面poster
    none: 页面加载后不应加载视频
  */
  preload: 'auto',
  showPlay: true,
  /*
    fit可选属性：
    none: 保存原有内容，不进行缩放;
    fill: 不保持原有比例，内容拉伸填充整个内容容器;
    contain: 保存原有比例，内容以包含方式缩放;
    cover: 保存原有比例，内容以覆盖方式缩放
  */
  fit: 'contain'
})
// 参考文档：https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/video
const veoPoster = ref(props.poster)
const originPlay = ref(true)
const hidden = ref(false) // 是否隐藏播放器中间的播放按钮
// 为模板引用标注类型
const veo = ref()
// const veo = ref&lt;HTMLVideoElement | null&gt;(null) // 声明一个同名的模板引用
 
/*
  loadeddata 事件在媒体当前播放位置的视频帧（通常是第一帧）加载完成后触发
  preload为none时不会触发
*/
function getPoster () { // 在未设置封面时，自动截取视频0.5s对应帧作为视频封面
  // 由于不少视频第一帧为黑屏，故设置视频开始播放时间为0.5s，即取该时刻帧作为封面图
  veo.value.currentTime = props.second
  // 创建canvas元素
  const canvas = document.createElement('canvas')
  const ctx = canvas.getContext('2d')
  // canvas画图
  canvas.width = veo.value.videoWidth
  canvas.height = veo.value.videoHeight
  ctx?.drawImage(veo.value, 0, 0, canvas.width, canvas.height)
  // 把canvas转成base64编码格式
  veoPoster.value = canvas.toDataURL('image/png')
}
function onPlay () {
  if (originPlay.value) {
    veo.value.currentTime = 0
    originPlay.value = false
  }
  if (props.autoplay) {
    veo.value?.pause()
  } else {
    hidden.value = true
    veo.value?.play()
  }
}
function onPause () {
  hidden.value = false
}
function onPlaying () {
  hidden.value = true
}
onMounted(() =&gt; {
  if (props.autoplay) {
    hidden.value = true
    originPlay.value = false
  }
  /*
    自定义设置播放速度，经测试：
    在vue2中需设置：this.$refs.veo.playbackRate = 2
    在vue3中需设置：veo.value.defaultPlaybackRate = 2
  */
  // veo.value.defaultPlaybackRate = 2
})
&lt;/script&gt;
&lt;template&gt;
  &lt;div class="m-video" :class="{'u-video-hover': !hidden}" :style="`width: ${width}px; height: ${height}px;`"&gt;
    &lt;video
      ref="veo"
      :style="`object-fit: ${fit};`"
      :src="src"
      :poster="veoPoster"
      :width="width"
      :height="height"
      :autoplay="autoplay"
      :controls="!originPlay&amp;&amp;controls"
      :loop="loop"
      :muted="autoplay || muted"
      :preload="preload"
      crossorigin="anonymous"
      @loadeddata="poster ? () =&gt; false : getPoster()"
      @pause="showPlay ? onPause() : () =&gt; false"
      @playing="showPlay ? onPlaying() : () =&gt; false"
      @click.prevent.once="onPlay"
      v-bind="$attrs"&gt;
      您的浏览器不支持video标签。
    &lt;/video&gt;
    &lt;span v-show="originPlay || showPlay" class="m-icon-play" :class="{'hidden': hidden}"&gt;
      &lt;svg class="u-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 34 34"&gt;
      &lt;path d="M28.26,11.961L11.035,0.813C7.464-1.498,3,1.391,3,6.013v21.974c0,4.622,4.464,7.511,8.035,5.2L28.26,22.039
          C31.913,19.675,31.913,14.325,28.26,11.961z"&gt;&lt;/path&gt;
      &lt;/svg&gt;        
    &lt;/span&gt;
  &lt;/div&gt;
&lt;/template&gt;
&lt;style lang="less" scoped&gt;
.m-video {
  display: inline-block;
  position: relative;
  background: #000;
  cursor: pointer;
  .m-icon-play {
    display: inline-block;
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    margin: auto;
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: rgba(0,0,0,.7);
    pointer-events: none;
    opacity: 0.8;
    transition: opacity .3s;
    .u-svg {
      display: inline-block;
      fill: #FFF;
      width: 29px;
      height: 34px;
      margin-top: 23px;
      margin-left: 27px;
    }
  }
  .hidden {
    opacity: 0;
  }
}
.u-video-hover {
  &amp;:hover {
    .m-icon-play {
      opacity: 1;
    }
  }
}
&lt;/style&gt;</code></pre> 
<p>在要使用的页面引入：</p> 
<pre><code class="hljs">&lt;script setup lang="ts"&gt;
import Video from './Video.vue'
import { ref } from 'vue'
 
const src = ref('https://cdn.jsdelivr.net/gh/themusecatcher/resources@0.0.3/Bao.mp4')
const poster = ref('https://cdn.jsdelivr.net/gh/themusecatcher/resources@0.0.3/bao.jpg')
&lt;/script&gt;
 
&lt;template&gt;
  &lt;div&gt;
    &lt;h2 class="mb10"&gt;Video 播放器基本使用&lt;/h2&gt;
    &lt;Video :src="src" :poster="poster" /&gt;
    &lt;h2 class="mt30 mb10"&gt;自动播放&lt;/h2&gt;
    &lt;Video autoplay :src="src" :poster="poster" /&gt;
    &lt;h2 class="mt30 mb10"&gt;自动截取视频指定帧作为视频封面&lt;/h2&gt;
    &lt;Video :src="src" :second="3" /&gt;
  &lt;/div&gt;
&lt;/template&gt;</code></pre> 
<p> </p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3bc09b08f6da130410de3dde1164c185/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C语言深度解析-fibonacci斐波那契数列数列的几种解法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4ae2b8bd86b6f1d004e66a4f51ec968a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">SpringCloudStream整合RabbitMQ用ttl&#43;死信实现延迟队列的实践</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>