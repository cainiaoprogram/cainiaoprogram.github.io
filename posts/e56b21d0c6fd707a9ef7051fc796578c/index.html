<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ToolLLM：能够使用 16000 种真实 API 的 LLM - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ToolLLM：能够使用 16000 种真实 API 的 LLM" />
<meta property="og:description" content="随着对 LLM（大语言模型）的了解与使用越来越多，大家开始偏向于探索 LLM 的 agent 能力。尤其是让 LLM 学习理解 API，使用工具进行对用户的 instruction（指令）进行处理。然而，目前的开源大模型并不擅长使用工具，最善于使用工具的 ChatGPT 是闭源的模型。研究人员设计了一个评测 LLM 使用工具能力的 Benchmark（基准）—— LLMBench，以及一个针对该场景的数据构建、模型训练、评测的框架—— ToolLLM。
这张图展示了构建ToolBench的三个阶段，以及如何训练API检索器和ToolLLaMA。在执行指令时，API检索器会向ToolLLaMA推荐相关的API，ToolLLaMA通过多轮API调用得出最终答案。整个推理过程由ToolEval评估。 研究人员主要是从RapidAPI来收集API，所有的API都可以分为49个粗粒度类别，例如体育、金融和天气。研究人员评测了这些API，最后经过筛选，留下了16,464个API。LLM的prompt(提示)中包括了这些API相关的文档和使用用例。
作者根据API，使用ChatGPT生成可能用到的指令，利用 {INST，API} 的格式训练API retriever。最后得到的prompt包含了任务的描述、API的文档、3个API的使用例。
作者通过序列来对执行路径进行探索{a1,r1,a2,r2.....}a为采取的function call，r为返回的response，为了避免一直错误的路径上探索，作者设计了一个基于深度优先的决策树，并将放弃执行也作为一个节点，返回到之前的路径重新选择，从而节省了对于chatgpt的调用。最后收集到了12, 657 个instruction solution pairs用来训练ToolLLaMA。
首先训练API检索器的目标是与指令检索相关的API，采用了Sentence-BERT 训练基于BERT-BASE的密集检索器。该模型分别将指令和API文档编码为两个嵌入向量，并通过这两个向量的相似性确定它们之间的相关性。在训练过程中，作者将之前生成的每个指令的相关API视为正样本，并采样一些其他API作为负样本进行对比学习。
然后，作者使用了指令-解决方案对对LLaMA 7B模型进行微调。因为工具的响应通常会非常长，原始的LLaMA模型的序列长度2048 或许不能够满足本次场景。为此，作者使用positional interpolation将上下文长度扩展到8192，最后以多轮对话模式训练模型。在训练数据格式方面，作者保持输入和输出与ChatGPT的相同。
ToolLLM 介绍了如何在LLMs中引入使用工具的能力，提出了一个指令调优的数据集ToolBench，涵盖了16k&#43;真实世界的API和各种实际的用例场景，包括单一工具和多工具任务。ToolBench的构建只使用ChatGPT，并且最小限度的使用人工监督。此外，ToolLLM还提出了DFSDT来加强LLMs的规划和推理能力，使它们能够有策略地在推理路径中导航。并且实验结果也显示出了使用经过训练的开源模型ToolLLaMA极大的提高了使用工具能力。
相关资料：
论文： https://arxiv.org/pdf/2304.01662.pdf Github: https://github.com/OpenBMB/ToolBench 本文由 mdnice 多平台发布" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/e56b21d0c6fd707a9ef7051fc796578c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-10T20:23:00+08:00" />
<meta property="article:modified_time" content="2023-08-10T20:23:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ToolLLM：能够使用 16000 种真实 API 的 LLM</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <section id="nice" style="font-size: 16px; padding: 0 10px; line-height: 1.6; word-spacing: 0px; letter-spacing: 0px; word-break: break-word; word-wrap: break-word; text-align: left; color: #3E3E3E; font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, 'PingFang SC', Cambria, Cochin, Georgia, Times, 'Times New Roman', serif;"> 
 <p style="padding-top: 8px; padding-bottom: 8px; margin: 0; font-family: system-ui, Pingfang-SC, sans-serif; font-style: normal; font-weight: 400; font-size: 15px; line-height: 200%; text-align: justify; letter-spacing: 0px; color: #3E3E3E;">随着对 LLM（大语言模型）的了解与使用越来越多，大家开始偏向于探索 LLM 的 agent 能力。尤其是让 LLM 学习理解 API，使用工具进行对用户的 instruction（指令）进行处理。然而，目前的开源大模型并不擅长使用工具，最善于使用工具的 ChatGPT 是闭源的模型。研究人员设计了一个评测 LLM 使用工具能力的 Benchmark（基准）—— LLMBench，以及一个针对该场景的数据构建、模型训练、评测的框架—— ToolLLM。</p> 
 <figure style="margin: 0; margin-top: 10px; margin-bottom: 10px; display: flex; flex-direction: column; justify-content: center; align-items: center;"> 
  <img src="https://images2.imgbox.com/46/0c/vQqqE7Wt_o.png" alt="alt" style="max-width: 100%; border-radius: 5px; display: block; margin: 28px auto; width: 100%; height: 100%; object-fit: contain;"> 
 </figure> 
 <p style="padding-top: 8px; padding-bottom: 8px; margin: 0; font-family: system-ui, Pingfang-SC, sans-serif; font-style: normal; font-weight: 400; font-size: 15px; line-height: 200%; text-align: justify; letter-spacing: 0px; color: #3E3E3E;">这张图展示了构建ToolBench的三个阶段，以及如何训练API检索器和ToolLLaMA。在执行指令时，API检索器会向ToolLLaMA推荐相关的API，ToolLLaMA通过多轮API调用得出最终答案。整个推理过程由ToolEval评估。 研究人员主要是从RapidAPI来收集API，所有的API都可以分为49个粗粒度类别，例如体育、金融和天气。研究人员评测了这些API，最后经过筛选，留下了16,464个API。LLM的prompt(提示)中包括了这些API相关的文档和使用用例。</p> 
 <p style="padding-top: 8px; padding-bottom: 8px; margin: 0; font-family: system-ui, Pingfang-SC, sans-serif; font-style: normal; font-weight: 400; font-size: 15px; line-height: 200%; text-align: justify; letter-spacing: 0px; color: #3E3E3E;">作者根据API，使用ChatGPT生成可能用到的指令，利用 {INST，API} 的格式训练API retriever。最后得到的prompt包含了任务的描述、API的文档、3个API的使用例。</p> 
 <figure style="margin: 0; margin-top: 10px; margin-bottom: 10px; display: flex; flex-direction: column; justify-content: center; align-items: center;"> 
  <img src="https://images2.imgbox.com/a9/ea/9JqWkuQf_o.png" alt="alt" style="max-width: 100%; border-radius: 5px; display: block; margin: 28px auto; width: 100%; height: 100%; object-fit: contain;"> 
 </figure> 
 <p style="padding-top: 8px; padding-bottom: 8px; margin: 0; font-family: system-ui, Pingfang-SC, sans-serif; font-style: normal; font-weight: 400; font-size: 15px; line-height: 200%; text-align: justify; letter-spacing: 0px; color: #3E3E3E;">作者通过序列来对执行路径进行探索{a1,r1,a2,r2.....}a为采取的function call，r为返回的response，为了避免一直错误的路径上探索，作者设计了一个基于深度优先的决策树，并将放弃执行也作为一个节点，返回到之前的路径重新选择，从而节省了对于chatgpt的调用。最后收集到了12, 657 个instruction solution pairs用来训练ToolLLaMA。</p> 
 <p style="padding-top: 8px; padding-bottom: 8px; margin: 0; font-family: system-ui, Pingfang-SC, sans-serif; font-style: normal; font-weight: 400; font-size: 15px; line-height: 200%; text-align: justify; letter-spacing: 0px; color: #3E3E3E;">首先训练API检索器的目标是与指令检索相关的API，采用了Sentence-BERT 训练基于BERT-BASE的密集检索器。该模型分别将指令和API文档编码为两个嵌入向量，并通过这两个向量的相似性确定它们之间的相关性。在训练过程中，作者将之前生成的每个指令的相关API视为正样本，并采样一些其他API作为负样本进行对比学习。</p> 
 <p style="padding-top: 8px; padding-bottom: 8px; margin: 0; font-family: system-ui, Pingfang-SC, sans-serif; font-style: normal; font-weight: 400; font-size: 15px; line-height: 200%; text-align: justify; letter-spacing: 0px; color: #3E3E3E;">然后，作者使用了指令-解决方案对对LLaMA 7B模型进行微调。因为工具的响应通常会非常长，原始的LLaMA模型的序列长度2048 或许不能够满足本次场景。为此，作者使用positional interpolation将上下文长度扩展到8192，最后以多轮对话模式训练模型。在训练数据格式方面，作者保持输入和输出与ChatGPT的相同。</p> 
 <figure style="margin: 0; margin-top: 10px; margin-bottom: 10px; display: flex; flex-direction: column; justify-content: center; align-items: center;"> 
  <img src="https://images2.imgbox.com/98/69/5zHyktNv_o.png" alt="alt" style="max-width: 100%; border-radius: 5px; display: block; margin: 28px auto; width: 100%; height: 100%; object-fit: contain;"> 
 </figure> 
 <p style="padding-top: 8px; padding-bottom: 8px; margin: 0; font-family: system-ui, Pingfang-SC, sans-serif; font-style: normal; font-weight: 400; font-size: 15px; line-height: 200%; text-align: justify; letter-spacing: 0px; color: #3E3E3E;">ToolLLM 介绍了如何在LLMs中引入使用工具的能力，提出了一个指令调优的数据集ToolBench，涵盖了16k+真实世界的API和各种实际的用例场景，包括单一工具和多工具任务。ToolBench的构建只使用ChatGPT，并且最小限度的使用人工监督。此外，ToolLLM还提出了DFSDT来加强LLMs的规划和推理能力，使它们能够有策略地在推理路径中导航。并且实验结果也显示出了使用经过训练的开源模型ToolLLaMA极大的提高了使用工具能力。</p> 
 <p style="padding-top: 8px; padding-bottom: 8px; margin: 0; font-family: system-ui, Pingfang-SC, sans-serif; font-style: normal; font-weight: 400; font-size: 15px; line-height: 200%; text-align: justify; letter-spacing: 0px; color: #3E3E3E;">相关资料：</p> 
 <ul style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;"><li> 
   <section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; font-family: system-ui, sans-serif; font-size: 15px; font-weight: 400; color: #3e3e3e;">
     论文： 
    <a href="https://arxiv.org/pdf/2304.01662.pdf" rel="nofollow" style="text-decoration: none; word-wrap: break-word; font-weight: bold; border-bottom: 1px solid #3e3e3e; color: #2237B8; font-size: 15px; letter-spacing: 0.5px; margin: 0 2px;">https://arxiv.org/pdf/2304.01662.pdf</a> 
   </section></li><li> 
   <section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; font-family: system-ui, sans-serif; font-size: 15px; font-weight: 400; color: #3e3e3e;">
     Github: 
    <a href="https://github.com/OpenBMB/ToolBench" style="text-decoration: none; word-wrap: break-word; font-weight: bold; border-bottom: 1px solid #3e3e3e; color: #2237B8; font-size: 15px; letter-spacing: 0.5px; margin: 0 2px;">https://github.com/OpenBMB/ToolBench</a> 
   </section></li></ul> 
</section> 
<p>本文由<a href="https://mdnice.com/?platform=4" rel="nofollow"> mdnice </a>多平台发布</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e48ac845cc604bdd87b2054461edd950/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Oracle 使用 CONNECT_BY_ROOT 解锁层次结构洞察：在 SQL 中导航数据关系</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6f551b6fae38ca7ac1380cdec4484fd6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【博弈论】从Nim游戏到SG函数</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>