<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Nginx快速入门：nginx实现正向代理｜反向代理和正向代理的区别（八） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Nginx快速入门：nginx实现正向代理｜反向代理和正向代理的区别（八）" />
<meta property="og:description" content="0. 引言 我们之前讲解的一直是nginx的反向代理配置，关于正向代理的实现一直没有涉及，但在实际生产中正向代理也有非常广泛的应用场景，因此，今天我们将针对正向代理来深入学习。
1. 相关概念 1.1 什么是反向代理 所谓反向代理，就是用一个代理服务器，来接收客户端的各种请求，而客户端并不知道各类后台实际服务的地址，统一通过代理服务器来实现转发，这样的核心目的是为了保护后台服务对客户端不可见。我们之前演示的配置都基于反向代理的模式，实现各类服务的转发。
这样对于客户端来说，不需要知道各种后台服务，只需要向代理服务器发送请求即可，由代理服务器发出请求。
一般来说反向代理中代理服务器和后台服务是一伙儿的，绑定在一起。
一句话：客户端不知道自己实际请求的到底是谁
1.2 什么是正向代理 正向代理与反向代理相反，目的是为了隐藏客户端，也就是请求的发起者，让服务提供者感知到的是一个代理服务器，这样可以保护客户端的安全。一些对安全性要求较高的企业，可以基于正向代理实现安全隔离环境。
同时正向代理，也可以帮我们实现一种特殊的主备机制，这也是我们后续主要演示的。
一句话：服务器不知道实际请求自己的到底是谁
1.3 正向代理的应用场景 1、安全隔离 客户端服务器无法访问外网或者针对部分网络有限制，可以使用代理服务器进行访问
2、隐藏客户端ip 某些情况，客户端为了安全考虑，不想暴露自己的真实ip，就可以通过代理服务器来访问
3、加快访问速度 可以在代理服务器上部署缓存，比如利用nginx缓存静态资源等，这样可以加快客户端对于部分自资源的访问速度
2. Nginx正向代理实现步骤 1、配置nginx，设置转发通过 $scheme://$http_host$request_uri;三个参数来拼接转发地址。注意一定要声明DNS服务器，否则会报错502
server { listen 80; resolver 223.5.5.5 8.8.8.8; # 指定DNS服务器IP地址 location / { proxy_set_header HOST $host; proxy_http_version 1.1; proxy_pass $scheme://$http_host$request_uri; } } 上述配置仅能实现转发http的请求，如果实际要请求的地址是https的就不能实现了，会报错400
，这是因为正向代理转发默认不支持https的，我们需要安装ngx_http_proxy_connect_module插件来实现，该插件是国人开发的，非官方支持，所以会出现部分版本不支持，具体下文说明。
github地址：https://github.com/chobits/ngx_http_proxy_connect_module
2、如果是用yum安装的nginx，则下载一个与当前nginx同版本的nginx源码包，保证nginx安装目录下有configure文件，如果之前是编译安装的则不用了
cd /data wget http://nginx.org/download/nginx-1.18.0.tar.gz # 解压 tar -zxvf nginx-1.18.0.tar.gz 3、下载ngx_http_proxy_connect_module插件
yum install git cd /data git clone # 访问github慢的，就使用这里的gitee地址 https://gitee." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/cc7ce0d9972634d66e0ddcf0e7b57be3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-07T01:44:08+08:00" />
<meta property="article:modified_time" content="2024-01-07T01:44:08+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Nginx快速入门：nginx实现正向代理｜反向代理和正向代理的区别（八）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="0__0"></a>0. 引言</h2> 
<p>我们之前讲解的一直是nginx的反向代理配置，关于正向代理的实现一直没有涉及，但在实际生产中正向代理也有非常广泛的应用场景，因此，今天我们将针对正向代理来深入学习。</p> 
<h2><a id="1__3"></a>1. 相关概念</h2> 
<h3><a id="11__4"></a>1.1 什么是反向代理</h3> 
<p>所谓反向代理，就是用一个代理服务器，来接收客户端的各种请求，而客户端并不知道各类后台实际服务的地址，统一通过代理服务器来实现转发，这样的核心目的是为了保护后台服务对客户端不可见。我们之前演示的配置都基于反向代理的模式，实现各类服务的转发。</p> 
<p>这样对于客户端来说，不需要知道各种后台服务，只需要向代理服务器发送请求即可，由代理服务器发出请求。</p> 
<p>一般来说反向代理中代理服务器和后台服务是一伙儿的，绑定在一起。</p> 
<p>一句话：客户端不知道自己实际请求的到底是谁<br> <img src="https://images2.imgbox.com/3c/83/uGXjivKw_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="12__13"></a>1.2 什么是正向代理</h3> 
<p>正向代理与反向代理相反，目的是为了隐藏客户端，也就是请求的发起者，让服务提供者感知到的是一个代理服务器，这样可以保护客户端的安全。一些对安全性要求较高的企业，可以基于正向代理实现安全隔离环境。</p> 
<p>同时正向代理，也可以帮我们实现一种特殊的主备机制，这也是我们后续主要演示的。</p> 
<p>一句话：服务器不知道实际请求自己的到底是谁<br> <img src="https://images2.imgbox.com/b7/4c/Iv55aHn6_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="13__21"></a>1.3 正向代理的应用场景</h3> 
<ul><li>1、安全隔离</li></ul> 
<blockquote> 
 <p>客户端服务器无法访问外网或者针对部分网络有限制，可以使用代理服务器进行访问</p> 
</blockquote> 
<ul><li>2、隐藏客户端ip</li></ul> 
<blockquote> 
 <p>某些情况，客户端为了安全考虑，不想暴露自己的真实ip，就可以通过代理服务器来访问</p> 
</blockquote> 
<ul><li>3、加快访问速度</li></ul> 
<blockquote> 
 <p>可以在代理服务器上部署缓存，比如利用nginx缓存静态资源等，这样可以加快客户端对于部分自资源的访问速度</p> 
</blockquote> 
<h2><a id="2_Nginx_30"></a>2. Nginx正向代理实现步骤</h2> 
<p>1、配置nginx，设置转发通过<code> $scheme://$http_host$request_uri;</code>三个参数来拼接转发地址。注意一定要声明DNS服务器，否则会报错<code>502</code></p> 
<pre><code>server {
    listen 80;
    resolver 223.5.5.5 8.8.8.8; # 指定DNS服务器IP地址
    location / {
       proxy_set_header HOST $host;
       proxy_http_version 1.1;
       proxy_pass $scheme://$http_host$request_uri;
    }
}
</code></pre> 
<p>上述配置仅能实现转发http的请求，如果实际要请求的地址是https的就不能实现了，会报错<code>400</code><br> ，这是因为正向代理转发默认不支持https的，我们需要安装<code>ngx_http_proxy_connect_module</code>插件来实现，该插件是国人开发的，非官方支持，所以会出现部分版本不支持，具体下文说明。<br> github地址：<a href="https://github.com/chobits/ngx_http_proxy_connect_module">https://github.com/chobits/ngx_http_proxy_connect_module</a></p> 
<p>2、如果是用yum安装的nginx，则下载一个与当前nginx同版本的nginx源码包，保证nginx安装目录下有<code>configure</code>文件，如果之前是编译安装的则不用了</p> 
<pre><code class="prism language-shell"><span class="token builtin class-name">cd</span> /data
<span class="token function">wget</span> http://nginx.org/download/nginx-1.18.0.tar.gz
<span class="token comment"># 解压</span>
<span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> nginx-1.18.0.tar.gz
</code></pre> 
<p>3、下载<code>ngx_http_proxy_connect_module</code>插件</p> 
<pre><code class="prism language-shell">yum <span class="token function">install</span> <span class="token function">git</span>
<span class="token builtin class-name">cd</span> /data
<span class="token function">git</span> clone 
<span class="token comment"># 访问github慢的，就使用这里的gitee地址</span>
https://gitee.com/web_design_of_web_frontend/ngx_http_proxy_connect_module.git
</code></pre> 
<p>4、安装patch工具，如下图选择对应版本的patch文件</p> 
<pre><code class="prism language-shell">yum <span class="token function">install</span> patch
<span class="token comment"># 进入下载的nginx目录</span>
<span class="token builtin class-name">cd</span> /data/nginx-1.18.0
<span class="token comment"># 注意这里选择你上述下载ngx_http_proxy_connect_module插件的位置</span>
patch <span class="token parameter variable">-p1</span> <span class="token operator">&lt;</span> /data/ngx_http_proxy_connect_module/patch/proxy_connect_rewrite_1018.patch 
</code></pre> 
<p>如下图为作者声明的nginx版本与patch版本的对应关系，选择对应版本执行，如我这里是nginx1.18，则用<code>proxy_connect_rewrite_1018.patch</code><br> 如果你是安装的1.24，则应该执行</p> 
<pre><code class="prism language-shell">patch <span class="token parameter variable">-p1</span> <span class="token operator">&lt;</span> /data/ngx_http_proxy_connect_module/patch/proxy_connect_rewrite_102101.patch 
</code></pre> 
<p><img src="https://images2.imgbox.com/be/1c/O8ULUt9G_o.png" alt="在这里插入图片描述"></p> 
<p>5、如果出现<code>src/http/ngx_http_core_module.c</code>文件找不到的情况，这是因为没有到nginx源码包的路径下执行导致的，进入该目录再执行patch指令即可。<br> <img src="https://images2.imgbox.com/45/b2/vazM8obe_o.png" alt="在这里插入图片描述"></p> 
<p>正常执行显示如下：</p> 
<p><img src="https://images2.imgbox.com/dc/c5/PrSGnUK6_o.png" alt="在这里插入图片描述"></p> 
<p>6、添加上<code>ngx_http_proxy_connect_module</code>插件</p> 
<pre><code class="prism language-shell"><span class="token comment"># 进入下载的源码包路径</span>
<span class="token builtin class-name">cd</span> /data/nginx-1.18.0
<span class="token comment"># 配置nginx相关设置，这里指定了nginx安装目录，执行文件路径、配置文件、日志路径等</span>
<span class="token comment"># 同时因为要配置https,所以添加了http_ssl_module模块</span>
./configure --with-http_ssl_module --add-module<span class="token operator">=</span>/data/ngx_http_proxy_connect_module 
</code></pre> 
<p><strong>注</strong>：如果之前安装了nginx，请提前关闭nginx服务</p> 
<pre><code>nginx -s stop
</code></pre> 
<p>并且想要保留之前添加的模块，那么就在安装前通过<code>nginx -V</code>查看，并在执行<code>configure</code>指令时将其通过<code>--with</code>添加上<br> <img src="https://images2.imgbox.com/3b/68/SIfb7mRd_o.png" alt="在这里插入图片描述"><br> 于是变成了执行</p> 
<pre><code class="prism language-shell">./configure --add-module<span class="token operator">=</span>/data/ngx_http_proxy_connect_module <span class="token parameter variable">--prefix</span><span class="token operator">=</span>/etc/nginx --sbin-path<span class="token operator">=</span>/usr/sbin/nginx --modules-path<span class="token operator">=</span>/usr/lib64/nginx/modules --conf-path<span class="token operator">=</span>/etc/nginx/nginx.conf --error-log-path<span class="token operator">=</span>/var/log/nginx/error.log --http-log-path<span class="token operator">=</span>/var/log/nginx/access.log --pid-path<span class="token operator">=</span>/var/run/nginx.pid --lock-path<span class="token operator">=</span>/var/run/nginx.lock --http-client-body-temp-path<span class="token operator">=</span>/var/cache/nginx/client_temp --http-proxy-temp-path<span class="token operator">=</span>/var/cache/nginx/proxy_temp --http-fastcgi-temp-path<span class="token operator">=</span>/var/cache/nginx/fastcgi_temp --http-uwsgi-temp-path<span class="token operator">=</span>/var/cache/nginx/uwsgi_temp --http-scgi-temp-path<span class="token operator">=</span>/var/cache/nginx/scgi_temp <span class="token parameter variable">--user</span><span class="token operator">=</span>nginx <span class="token parameter variable">--group</span><span class="token operator">=</span>nginx --with-compat --with-file-aio --with-threads --with-http_addition_module --with-http_auth_request_module --with-http_dav_module --with-http_flv_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_mp4_module --with-http_random_index_module --with-http_realip_module --with-http_secure_link_module --with-http_slice_module --with-http_ssl_module --with-http_stub_status_module --with-http_sub_module --with-http_v2_module --with-mail --with-mail_ssl_module --with-stream --with-stream_realip_module --with-stream_ssl_module --with-stream_ssl_preread_module --with-cc-opt<span class="token operator">=</span><span class="token string">'-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches -fPIC'</span> --with-ld-opt<span class="token operator">=</span><span class="token string">'-Wl,-z,relro -Wl,-z,now -pie'</span> 
</code></pre> 
<p>执行结果：<br> <img src="https://images2.imgbox.com/c0/0c/4P8Rvnvx_o.png" alt="在这里插入图片描述"></p> 
<p>如果出现<code>./configure: error: C compiler cc is not found</code>，需要先安装相关依赖环境，然后再重新添加插件，以下列举了基本所需的环境，可以都安装看看：</p> 
<pre><code class="prism language-shell">yum <span class="token parameter variable">-y</span> <span class="token function">install</span> libxml2 libxml2-dev libxslt-devel 
yum <span class="token parameter variable">-y</span> <span class="token function">install</span> gd-devel 
yum <span class="token parameter variable">-y</span> <span class="token function">install</span> perl-devel perl-ExtUtils-Embed 
yum <span class="token parameter variable">-y</span> <span class="token function">install</span> GeoIP GeoIP-devel GeoIP-data
yum <span class="token parameter variable">-y</span> <span class="token function">install</span> pcre-devel
yum <span class="token parameter variable">-y</span> <span class="token function">install</span> openssl openssl-devel
</code></pre> 
<p><img src="https://images2.imgbox.com/f0/b7/PS4YdQYZ_o.png" alt="在这里插入图片描述"></p> 
<p>7、编译nginx服务</p> 
<pre><code class="prism language-shell"><span class="token function">make</span>
</code></pre> 
<p>执行报错：</p> 
<p>In file included from src/http/ngx_http.h:32:0,<br> from src/http/ngx_http.c:10:<br> src/http/ngx_http_request.h:47:0: error: “NGX_HTTP_CONNECT” redefined [-Werror]<br> #define NGX_HTTP_CONNECT 0x10000<br> ^<br> src/http/ngx_http_request.h:44:0: note: this is the location of the previous definition<br> #define NGX_HTTP_CONNECT 0x00010000</p> 
<p><img src="https://images2.imgbox.com/23/ca/7i4fzxa9_o.png" alt="在这里插入图片描述"></p> 
<p>该报错是因为对应版本的nginx，不支持该插件。本次验证中使用了<code>Nginx1.18.0</code>可以正常安装。或者是没有使用对应的patch文件，按照上文示图用作者声明的nginx版本和对应的patch文件</p> 
<p>正常安装结果如下<br> <img src="https://images2.imgbox.com/e7/03/c2U2AQ7r_o.png" alt="在这里插入图片描述"></p> 
<p>【选择步骤：如果没有安装过nginx的，执行安装指令】<br> 8、安装nginx，如果之前通过yum安装了nginx的，可跳过这步，不要重复安装</p> 
<pre><code class="prism language-shell"><span class="token function">make</span> <span class="token function">install</span>
</code></pre> 
<p>【选择步骤：如果通过yum或者编译安装了nginx的，执行替换nginx执行文件指令】</p> 
<pre><code class="prism language-shell"><span class="token function">cp</span> /data/nginx-1.24.0/objs/nginx /usr/sbin/
</code></pre> 
<p>9、查看版本，可以看到<code>ngx_http_proxy_connect_module</code>模块已经添加进去了，如果这里没有，说明没有添加成功，检查上述步骤，特别是如果是已经安装了的nginx，有没有成功用<code>objs/nginx</code>替换原有的nginx执行文件</p> 
<pre><code class="prism language-shell">nginx <span class="token parameter variable">-V</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/72/5c/bjLWzqRp_o.png" alt="在这里插入图片描述"></p> 
<p>10、启动项目</p> 
<pre><code class="prism language-shell">nginx
</code></pre> 
<p>12、调整一下配置文件，修改转发配置（编译安装的nginx的默认路径在<code>/usr/local/nginx</code>下）</p> 
<pre><code>server {
        listen       80; # 监听端口
        resolver 223.5.5.5 8.8.8.8; # 指定DNS服务器IP地址
        proxy_connect;                          #启用 CONNECT HTTP方法
        proxy_connect_allow            443 80;  #指定代理CONNECT方法可以连接的端口号或范围的列表
        proxy_connect_connect_timeout  20s;     #定义客户端与代理服务器建立连接的超时时间
        proxy_connect_read_timeout     20s;     #定义客户端从代理服务器读取响应的超时时间
        proxy_connect_send_timeout     20s;     #设置客户端将请求传输到代理服务器的超时时间
        location / {
           proxy_pass $scheme://$http_host$request_uri;
        }
 }
</code></pre> 
<p>该配置项在<a href="https://github.com/chobits/ngx_http_proxy_connect_module">github</a>中也有示例<br> <img src="https://images2.imgbox.com/d6/b6/NCwjzKBN_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="3_java_182"></a>3. java实现请求代理</h2> 
<p>我们这里用java 来模拟客户端请求，在java httpClient中，可以通过设置<code>setProxy</code>方法来设置代理服务器地址和端口以及协议，需要注意的是代理服务器只能是http的，真实服务器可以是http或https。</p> 
<p>这里我们测试使用的是GET来请求模拟接口，如果需要POST请求，大家自己调整请求代码即可</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">jar<span class="token punctuation">.</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpHost</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">jar<span class="token punctuation">.</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpStatus</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">jar<span class="token punctuation">.</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>client<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">RequestConfig</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">jar<span class="token punctuation">.</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>client<span class="token punctuation">.</span>methods<span class="token punctuation">.</span></span><span class="token class-name">CloseableHttpResponse</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">jar<span class="token punctuation">.</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>client<span class="token punctuation">.</span>methods<span class="token punctuation">.</span></span><span class="token class-name">HttpGet</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">jar<span class="token punctuation">.</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">CloseableHttpClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">jar<span class="token punctuation">.</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">HttpClients</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">jar<span class="token punctuation">.</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">EntityUtils</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author benjamin_5
 * @Description
 * @date 2023/12/29
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProxyTest</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 接口地址</span>
        <span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token string">"/xx/xx/xx"</span><span class="token punctuation">;</span>
        <span class="token comment">// post请求返回结果</span>
        <span class="token class-name">CloseableHttpClient</span> httpClient <span class="token operator">=</span> <span class="token class-name">HttpClients</span><span class="token punctuation">.</span><span class="token function">createDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">HttpGet</span> http <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpGet</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 实际请求服务地址，如果自测的话，可以自己模拟一个接口或者访问</span>
        <span class="token class-name">HttpHost</span> target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpHost</span><span class="token punctuation">(</span><span class="token string">"api.xxx.com"</span><span class="token punctuation">,</span> <span class="token number">443</span><span class="token punctuation">,</span> <span class="token string">"https"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 代理服务地址</span>
        <span class="token class-name">HttpHost</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpHost</span><span class="token punctuation">(</span><span class="token string">"192.168.244.41"</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token string">"http"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置请求和传输超时时间</span>
        <span class="token class-name">RequestConfig</span> requestConfig <span class="token operator">=</span> <span class="token class-name">RequestConfig</span><span class="token punctuation">.</span><span class="token function">custom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setSocketTimeout</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setConnectTimeout</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setProxy</span><span class="token punctuation">(</span>proxy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        http<span class="token punctuation">.</span><span class="token function">setConfig</span><span class="token punctuation">(</span>requestConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">CloseableHttpResponse</span> result <span class="token operator">=</span> httpClient<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>http<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 请求发送成功，并得到响应</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">getStatusLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getStatusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">SC_OK</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// 读取服务器返回过来的json字符串数据</span>
                    str <span class="token operator">=</span> <span class="token class-name">EntityUtils</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">getEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"返回数据: "</span> <span class="token operator">+</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"post请求提交失败:"</span> <span class="token operator">+</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"调用错误："</span><span class="token operator">+</span>result<span class="token punctuation">.</span><span class="token function">getStatusLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getStatusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"post请求提交失败:"</span> <span class="token operator">+</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
            http<span class="token punctuation">.</span><span class="token function">releaseConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>请求结果正常返回了，说明代理配置正确<br> <img src="https://images2.imgbox.com/98/62/v2nl4XJs_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="4__250"></a>4. 总结</h2> 
<p>综上，我们就完成了对nginx正向代理的解读和实操，希望大家可以通过这样一个案例，来加深对正向代理的理解</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8c5f70f85d5a691a5f1dc7be5473736b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">深度学习</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2120ac669a8a228e865f7a393a35eb91/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">STM32F103C8T6制作简易示波器</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>