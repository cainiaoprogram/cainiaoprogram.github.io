<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>MySQL进阶知识 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="MySQL进阶知识" />
<meta property="og:description" content="1 存储引擎 1.1 MySQL体系结构 1.2 存储引擎简介 存储引擎就是存储数据、建立索引、更新/查询数据等技术的实现方式。存储引擎是基于表的，而不是基于库的，同一个库的多个表可以采用不同的存储引擎，所以存储引擎也经常称为表类型。创建表时可以指定存储引擎，如果不指定默认存储引擎是InnoDB。
查询建表语句：
show create table tb_brand;
CREATE TABLE `tb_brand` ( `id` int NOT NULL AUTO_INCREMENT, `brand_name` varchar(20) DEFAULT NULL, `company_name` varchar(20) DEFAULT NULL, `ordered` int DEFAULT NULL, `description` varchar(100) DEFAULT NULL, `status` int DEFAULT NULL, PRIMARY KEY (`id`) ) ENGINE=InnoDB AUTO_INCREMENT=8 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci //主键是自增长的，下一条记录ID是8 在创建表时指定存储引擎：
ENGINE=XXX，例如ENGINE=InnoDB
查看当前数据库支持的存储引擎：
show engines;
1.2.1 InnoDB innodb_file_per_table开关，控制着每张innodb表都创建一个表空间文件，还是所有的innodb表共用一个表空间文件。查看系统变量:
1.2.2 InnoDB的逻辑存储结构 Row（一行）中包含，最后一次操作事务的ID（Trx id）、指针、各个字段
page是磁盘操作的最小单元。一个Extent大小固定是1M，一个page大小固定是16K，一个Extent包含64个page
1.2.3 MyISAM和Memory Memory数据存放到内存当中，访问速度很快
Memory在磁盘上只有.sdi文件
Memory支持hash索引" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/1f302eb506ebef8457518bd0f1d4f2a1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-02T11:23:59+08:00" />
<meta property="article:modified_time" content="2023-03-02T11:23:59+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">MySQL进阶知识</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="kdocs-document"> 
 <h2 style="">1 存储引擎</h2> 
 <h3 style="">1.1 MySQL体系结构</h3> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:655px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:52.21374%;height:0;"> 
    <img src="https://images2.imgbox.com/b6/ec/RqJxbLt5_o.png" style="margin-left:;display:block;width:655px;margin-top:-52.21374%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:720px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:43.055557%;height:0;"> 
    <img src="https://images2.imgbox.com/9f/08/p3Z10qeA_o.png" style="margin-left:;display:block;width:720px;margin-top:-43.055557%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h3 style="">1.2 存储引擎简介</h3> 
 <p style="text-indent:1.4em;">存储引擎就是存储数据、建立索引、更新/查询数据等技术的实现方式。存储引擎是基于表的，而不是基于库的，同一个库的多个表可以采用不同的存储引擎，所以存储引擎也经常称为表类型。创建表时可以指定存储引擎，如果不指定默认存储引擎是InnoDB。</p> 
 <p style="text-indent:1.4em;">查询建表语句：</p> 
 <p style="">show create table tb_brand;</p> 
 <pre class="kdocs-java"><code class="language-java">CREATE TABLE `tb_brand` (
  `id` int NOT NULL AUTO_INCREMENT,
  `brand_name` varchar(20) DEFAULT NULL,
  `company_name` varchar(20) DEFAULT NULL,
  `ordered` int DEFAULT NULL,
  `description` varchar(100) DEFAULT NULL,
  `status` int DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=8 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
//主键是自增长的，下一条记录ID是8</code></pre> 
 <p style="text-indent:1.4em;">在创建表时指定存储引擎：</p> 
 <p style="text-indent:1.4em;"> ENGINE=XXX，例如ENGINE=InnoDB</p> 
 <p style="text-indent:1.4em;">查看当前数据库支持的存储引擎：</p> 
 <p style="text-indent:1.4em;">show engines;</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:1878px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:22.044727%;height:0;"> 
    <img src="https://images2.imgbox.com/dc/d5/5NHIzbhp_o.png" style="margin-left:;display:block;width:1878px;margin-top:-22.044727%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="">1.2.1 InnoDB</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:673px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:43.536404%;height:0;"> 
    <img src="https://images2.imgbox.com/01/ce/OmozEEQp_o.png" style="margin-left:;display:block;width:673px;margin-top:-43.536404%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">innodb_file_per_table开关，控制着每张innodb表都创建一个表空间文件，还是所有的innodb表共用一个表空间文件。查看系统变量:</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:538px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:27.881042%;height:0;"> 
    <img src="https://images2.imgbox.com/0c/c2/hXuhP3iK_o.png" style="margin-left:;display:block;width:538px;margin-top:-27.881042%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="">1.2.2 InnoDB的逻辑存储结构</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:1658px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:42.21954%;height:0;"> 
    <img src="https://images2.imgbox.com/f2/ae/wnr52k0K_o.png" style="margin-left:;display:block;width:1658px;margin-top:-42.21954%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <ol start="1"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;"><p>Row（一行）中包含，最后一次操作事务的ID（Trx id）、指针、各个字段</p></li></ol> 
 <ol start="2"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;"><p>page是磁盘操作的最小单元。一个Extent大小固定是1M，一个page大小固定是16K，一个Extent包含64个page</p></li></ol> 
 <h4 style="">1.2.3 MyISAM和Memory</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:481px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:44.074844%;height:0;"> 
    <img src="https://images2.imgbox.com/c1/26/YgJEyrmc_o.png" style="margin-left:;display:block;width:481px;margin-top:-44.074844%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""></p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:579px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:36.269432%;height:0;"> 
    <img src="https://images2.imgbox.com/3e/12/JShyob3Z_o.png" style="margin-left:;display:block;width:579px;margin-top:-36.269432%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""></p> 
 <ol start="1"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;"><p>Memory数据存放到内存当中，访问速度很快</p></li></ol> 
 <ol start="2"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;"><p>Memory在磁盘上只有.sdi文件</p></li></ol> 
 <ol start="3"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;"><p>Memory支持hash索引</p></li></ol> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:641px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:40.561623%;height:0;"> 
    <img src="https://images2.imgbox.com/24/4b/wwYqWDL5_o.png" style="margin-left:;display:block;width:641px;margin-top:-40.561623%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:645px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:35.813953%;height:0;"> 
    <img src="https://images2.imgbox.com/63/9b/rqCvJqbQ_o.png" style="margin-left:;display:block;width:645px;margin-top:-35.813953%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">绝大多数场景都是用InnodDB引擎。MyISAM可使用mangodb替代，Memory可使用redis替代。</p> 
 <h2 style="">2 索引</h2> 
 <h3 style="">2.1 索引概述</h3> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:1590px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:7.2955976%;height:0;"> 
    <img src="https://images2.imgbox.com/fc/08/moWjiB5L_o.png" style="margin-left:;display:block;width:1590px;margin-top:-7.2955976%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">没有索引的话，查询数据时需要全表扫描，查询效率极低；</p> 
 <p style="">有索引的话，需要建立一种数据结构维护数据和数据所在的内存地址关系，查询效率可大大提高；</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:632px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:46.044304%;height:0;"> 
    <img src="https://images2.imgbox.com/1c/c3/p71VdH3Z_o.png" style="margin-left:;display:block;width:632px;margin-top:-46.044304%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:662px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:21.903322%;height:0;"> 
    <img src="https://images2.imgbox.com/36/0e/IFqUCLUa_o.png" style="margin-left:;display:block;width:662px;margin-top:-21.903322%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <ol start="1"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;"><p>磁盘很便宜，索引占点磁盘空间也没事</p></li></ol> 
 <ol start="2"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;"><p>实际应用上，查询比例远远多余插入、更新、删除比例，因此降低更新表的速度这个劣势可以不考虑。</p></li></ol> 
 <h3 style="">2.2 索引结构</h3> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:585px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:35.384613%;height:0;"> 
    <img src="https://images2.imgbox.com/d5/15/J0NAt1cu_o.png" style="margin-left:;display:block;width:585px;margin-top:-35.384613%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:576px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:36.458332%;height:0;"> 
    <img src="https://images2.imgbox.com/53/41/GlN3vSBU_o.png" style="margin-left:;display:block;width:576px;margin-top:-36.458332%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="">2.2.1 二叉树和红黑树</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:652px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:44.785275%;height:0;"> 
    <img src="https://images2.imgbox.com/49/68/5vNaPzpM_o.png" style="margin-left:;display:block;width:652px;margin-top:-44.785275%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="text-align:left;">二叉树缺点：</p> 
 <ol start="1"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;text-align:left;"><p>顺序插入时，会形成一个链表，查询性能大大降低，如图2</p></li></ol> 
 <ol start="2"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;text-align:left;"><p>每个节点只有两个叶子节点，在数据量很大时，二叉树的层级会很深，检索速度很慢</p></li></ol> 
 <p style="text-align:left;">二叉树的1缺点，可通过红黑树解决，如图3；但是红黑树也是二叉树，无法解决缺点2</p> 
 <h4 style="">2.2.2 Btree</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:692px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:42.774563%;height:0;"> 
    <img src="https://images2.imgbox.com/e5/c1/UoYSwVl0_o.png" style="margin-left:;display:block;width:692px;margin-top:-42.774563%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:687px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:35.6623%;height:0;"> 
    <img src="https://images2.imgbox.com/1f/43/Mq5KERGi_o.png" style="margin-left:;display:block;width:687px;margin-top:-35.6623%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="">2.2.3 B+tree索引</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:651px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:40.860214%;height:0;"> 
    <img src="https://images2.imgbox.com/3f/52/6WhwRb4x_o.png" style="margin-left:;display:block;width:651px;margin-top:-40.860214%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">想较于B树，B+树有如下特点：</p> 
 <p style="">1、所有的元素都出现在叶子节点，叶子节点用来存放数据；非叶子节点只起到索引的作用</p> 
 <p style="">2、叶子节点形成了一个单向链表</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:617px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:33.87358%;height:0;"> 
    <img src="https://images2.imgbox.com/c4/4f/uml7vM36_o.png" style="margin-left:;display:block;width:617px;margin-top:-33.87358%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:690px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:37.826088%;height:0;"> 
    <img src="https://images2.imgbox.com/59/38/WZVw4i8I_o.png" style="margin-left:;display:block;width:690px;margin-top:-37.826088%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="">2.2.4 Hash索引</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:594px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:49.158245%;height:0;"> 
    <img src="https://images2.imgbox.com/7a/d6/qaKu3bus_o.png" style="margin-left:;display:block;width:594px;margin-top:-49.158245%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:582px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:26.116838%;height:0;"> 
    <img src="https://images2.imgbox.com/38/fd/6KE0gOyC_o.png" style="margin-left:;display:block;width:582px;margin-top:-26.116838%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="">2.2.5 InnoDB为什么选择B+树作为索引</h4> 
 <p style="">二叉树缺点：</p> 
 <p style="">1、顺序插入时，会形成一个链表，查询性能大大降低，如图2</p> 
 <p style="">2、每个节点只有两个叶子节点，在数据量很大时，二叉树的层级会很深，检索速度很慢</p> 
 <p style="">红黑树缺点：</p> 
 <p style="">1、二叉树的1缺点，可通过红黑树解决；但是红黑树也是二叉树，无法解决缺点2</p> 
 <p style="">B树缺点：</p> 
 <p style="">1、B树叶子节点或者非叶子节点都存储数据和指针，B+树只有叶子节点存储数据，非叶子节点存储指针。</p> 
 <p style="">2、每页大小只有16K，相较于B树，B+树一页当中能存储更多的Key和指针，相同数据量的话B+树层级会少一些，检索速度也会更快。</p> 
 <p style="">Hash索引缺点</p> 
 <p style="">1、Hash索引只能等值匹配，=、in；不支持范围匹配，beteen and、 &gt;、&lt;。B+树支持范围匹配。</p> 
 <p style="">2、Hash所以不支持排序操作。B+树支持排序操作；</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:434px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:69.81567%;height:0;"> 
    <img src="https://images2.imgbox.com/44/3a/1RQHfzIt_o.png" style="margin-left:;display:block;width:434px;margin-top:-69.81567%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h3 style="">2.3 索引分类</h3> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:565px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:27.256638%;height:0;"> 
    <img src="https://images2.imgbox.com/b9/e7/2q1OV2Lk_o.png" style="margin-left:;display:block;width:565px;margin-top:-27.256638%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="">2.3.1 聚集索引和二级索引</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:558px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:38.351254%;height:0;"> 
    <img src="https://images2.imgbox.com/a5/7a/8shcTB2q_o.png" style="margin-left:;display:block;width:558px;margin-top:-38.351254%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">在一个表中，聚集索引必须得有，并且只能有一个；聚集索引叶子节点下面挂的这一行的行数据，比如5下面挂的就是id是5的这一行数据。</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:661px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:46.747353%;height:0;"> 
    <img src="https://images2.imgbox.com/0c/d9/tpXb7nRw_o.png" style="margin-left:;display:block;width:661px;margin-top:-46.747353%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">如果针对name这一列建立索引，建立的索引是二级索引。二级索引叶子节点挂的是这一行数据的id值。</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:719px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:51.46036%;height:0;"> 
    <img src="https://images2.imgbox.com/d2/22/rpfkl2g1_o.png" style="margin-left:;display:block;width:719px;margin-top:-51.46036%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="">2.3.1 回表查询</h4> 
 <p style="">举例select * from user where name=‘Arm’，MySQL的查询流程如下：</p> 
 <p style="">1、从对name列建立的二级索引中查找，Lee-&gt;Geek-&gt;Arm，找到Arm节点；</p> 
 <p style="">2、取出Arm节点下挂的id值10，返回聚集索引继续查找；15,30-&gt;10,20-&gt;10，找到id值为10的节点；</p> 
 <p style="">3、取出10这个节点下面挂的行数据返回</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:740px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:50.810814%;height:0;"> 
    <img src="https://images2.imgbox.com/7a/e9/kJkiJBPL_o.png" style="margin-left:;display:block;width:740px;margin-top:-50.810814%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">先走二级索引找到对应的主键值，再到聚集索引中根据主键值拿到行数据</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:393px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:37.150127%;height:0;"> 
    <img src="https://images2.imgbox.com/18/a9/xasyVYmV_o.png" style="margin-left:;display:block;width:393px;margin-top:-37.150127%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">答：1高于2。1扫描一遍聚集索引即可；2需要先扫描name字段的二级索引，然后再回表查询聚集索引，两遍扫描。</p> 
 <h3 style="">2.4 索引语法</h3> 
 <h4 style="">2.4.1 创建索引</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:595px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:6.722689%;height:0;"> 
    <img src="https://images2.imgbox.com/7a/36/CxojkJVq_o.png" style="margin-left:;display:block;width:595px;margin-top:-6.722689%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">UNIQUE：唯一索引</p> 
 <p style="">FULLTEXT：全文索引</p> 
 <p style="">什么都不加：常规索引</p> 
 <p style="">table_name：表名</p> 
 <p style="">index_col_name:字段名，一个索引可以关联多个字段，用,隔开。如果一个索引只关联一个字段，称为单列索引，关联多个字段的索引叫作联合索引。</p> 
 <p style="">为哪一张表的哪一/多个字段创建索引。</p> 
 <h4 style="">2.4.2 查看索引</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:198px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:12.626263%;height:0;"> 
    <img src="https://images2.imgbox.com/71/71/2tQ0o0rQ_o.png" style="margin-left:;display:block;width:198px;margin-top:-12.626263%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">查看指定表中的所有的索引。</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:2694px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:8.092056%;height:0;"> 
    <img src="https://images2.imgbox.com/0a/31/cW2Wfnes_o.png" style="margin-left:;display:block;width:2694px;margin-top:-8.092056%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="">2.4.3 删除索引</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:299px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:9.364549%;height:0;"> 
    <img src="https://images2.imgbox.com/da/b0/PU0R0fb4_o.png" style="margin-left:;display:block;width:299px;margin-top:-9.364549%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">删除哪一张表中的哪一个索引。</p> 
 <h4 style="">2.4.4 索引操作案例</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:2850px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:52.2807%;height:0;"> 
    <img src="https://images2.imgbox.com/5f/22/D5DfpHBE_o.png" style="margin-left:;display:block;width:2850px;margin-top:-52.2807%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:367px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:41.961853%;height:0;"> 
    <img src="https://images2.imgbox.com/3f/46/zRtennql_o.png" style="margin-left:;display:block;width:367px;margin-top:-41.961853%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">1、常规索引</p> 
 <p style="">create index name_index on tb_user(name);</p> 
 <p style="">2、唯一索引</p> 
 <p style="">create unique index phone_index on tb_user(phone);</p> 
 <p style="">3 create index union_index on tb_user(profession,age,status)</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:2694px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:14.773571%;height:0;"> 
    <img src="https://images2.imgbox.com/c2/ba/KR2tR1y2_o.png" style="margin-left:;display:block;width:2694px;margin-top:-14.773571%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">4 唯一索引</p> 
 <p style="">create unique index email_index on tb_user(email);</p> 
 <h3 style="">2.5 SQL性能分析</h3> 
 <h4 style="">2.5.1 查看SQL执行频率</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:658px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:11.2462015%;height:0;"> 
    <img src="https://images2.imgbox.com/bf/91/XeVvAWWk_o.png" style="margin-left:;display:block;width:658px;margin-top:-11.2462015%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">show global status like 'Com_______';</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:357px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:68.06723%;height:0;"> 
    <img src="https://images2.imgbox.com/74/d1/NGS8FvZz_o.png" style="margin-left:;display:block;width:357px;margin-top:-68.06723%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="">2.5.2 慢查询日志</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:541px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:29.390018%;height:0;"> 
    <img src="https://images2.imgbox.com/a5/7e/UlRtbKNh_o.png" style="margin-left:;display:block;width:541px;margin-top:-29.390018%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">查询慢查询日志是否开启：</p> 
 <p style="">show variables like 'slow_query_log';</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:491px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:31.771894%;height:0;"> 
    <img src="https://images2.imgbox.com/df/ba/2Lv0yDgL_o.png" style="margin-left:;display:block;width:491px;margin-top:-31.771894%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="">2.5.3 profile查询SQL耗时</h4> 
 <p style="">select @@have_profiling;查看当前数据库是否支持profile操作</p> 
 <p style="">select @@profiling;查看当前数据库profiling是否开启</p> 
 <p style="">set profiling=1/0;开启/关闭profiling</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:321px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:80.37383%;height:0;"> 
    <img src="https://images2.imgbox.com/28/ed/eFEfCX5b_o.png" style="margin-left:;display:block;width:321px;margin-top:-80.37383%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:271px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:63.09963%;height:0;"> 
    <img src="https://images2.imgbox.com/45/66/KNQtmajC_o.png" style="margin-left:;display:block;width:271px;margin-top:-63.09963%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:447px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:47.87472%;height:0;"> 
    <img src="https://images2.imgbox.com/0c/15/CMRSVhZN_o.png" style="margin-left:;display:block;width:447px;margin-top:-47.87472%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="">2.5.4 explain查看SQL语句执行计划</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:582px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:21.305843%;height:0;"> 
    <img src="https://images2.imgbox.com/32/fa/tj0HK6h4_o.png" style="margin-left:;display:block;width:582px;margin-top:-21.305843%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:720px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:13.888889%;height:0;"> 
    <img src="https://images2.imgbox.com/a8/ad/z36zu5zc_o.png" style="margin-left:;display:block;width:720px;margin-top:-13.888889%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:626px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:47.284348%;height:0;"> 
    <img src="https://images2.imgbox.com/c8/fb/1KfGYo6h_o.png" style="margin-left:;display:block;width:626px;margin-top:-47.284348%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:609px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:44.49918%;height:0;"> 
    <img src="https://images2.imgbox.com/8e/e2/zcn059C9_o.png" style="margin-left:;display:block;width:609px;margin-top:-44.49918%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h3 style="">2.6 使用索引</h3> 
 <h4 style="">2.6.1 验证索引效率</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:339px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:63.716816%;height:0;"> 
    <img src="https://images2.imgbox.com/a9/6e/mwfKNgJ4_o.png" style="margin-left:;display:block;width:339px;margin-top:-63.716816%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">tb_brand库中总共50万条数据，给company_name建立索引后，查询时间从0.23s缩短到0.00s</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:2842px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:28.430681%;height:0;"> 
    <img src="https://images2.imgbox.com/a4/ca/YWYR76zH_o.png" style="margin-left:;display:block;width:2842px;margin-top:-28.430681%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">注意创建索引需要建立B+Tree数据结构，这个过程耗费了1.04s。</p> 
 <h4 style="">2.6.2 联合索引</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:628px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:13.21656%;height:0;"> 
    <img src="https://images2.imgbox.com/c4/81/FszgBlsw_o.png" style="margin-left:;display:block;width:628px;margin-top:-13.21656%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">给brand_name、company_name、ordered建立联合索引index_union。brand_name是第一个字段，company_name是第二个字段，ordered是第三个字段。</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:3340px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:15.568862%;height:0;"> 
    <img src="https://images2.imgbox.com/b0/e3/BMC3kqD2_o.png" style="margin-left:;display:block;width:3340px;margin-top:-15.568862%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""></p> 
 <p style="">如果要想用到index_union这个联合索引，select时brand_name这个字段必须存在（放置位置无所谓）。如果select时中间跳过了某一列（比如company_name），后面的索引(ordered)会失效。</p> 
 <p style="">case1:</p> 
 <p style="">三个字段的索引全部用上了。</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:2502px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:11.430855%;height:0;"> 
    <img src="https://images2.imgbox.com/36/23/hEuZaMmD_o.png" style="margin-left:;display:block;width:2502px;margin-top:-11.430855%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">可能用到的索引、实际用到的索引：index_union</p> 
 <p style="">索引长度：171</p> 
 <p style="">case2:</p> 
 <p style="">用到了brand_name、company_name两个字段的索引，ordered字段的索引长度=171-166=5；</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:2388px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:11.055276%;height:0;"> 
    <img src="https://images2.imgbox.com/5a/b5/Q1YcrHdS_o.png" style="margin-left:;display:block;width:2388px;margin-top:-11.055276%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">可能用到的索引、实际用到的索引：index_union</p> 
 <p style="">索引长度：166</p> 
 <p style="">case3:</p> 
 <p style="">用到了brand_name字段的索引，company_name字段的索引长度=166-83=83；</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:2314px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:13.310285%;height:0;"> 
    <img src="https://images2.imgbox.com/24/e9/YgZZVgMl_o.png" style="margin-left:;display:block;width:2314px;margin-top:-13.310285%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="text-align:left;">可能用到的索引、实际用到的索引：index_union</p> 
 <p style="text-align:left;">索引长度：83</p> 
 <p style="">case4:</p> 
 <p style="">并未用到index_union索引，因为SQL语句中brand_name字段不存在</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:2282px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:12.007011%;height:0;"> 
    <img src="https://images2.imgbox.com/f8/66/w0dscWtV_o.png" style="margin-left:;display:block;width:2282px;margin-top:-12.007011%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">可能用到的索引、实际用到的索引：null</p> 
 <p style="">type:all，全表扫描</p> 
 <p style="">case5:</p> 
 <p style="">只用到了brand_name字段的索引，因为跳过了company_name，所以ordered字段的索引失效了</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:2564px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:10.764431%;height:0;"> 
    <img src="https://images2.imgbox.com/e2/93/V4dHsGcT_o.png" style="margin-left:;display:block;width:2564px;margin-top:-10.764431%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="text-align:left;">可能用到的索引、实际用到的索引：index_union</p> 
 <p style="text-align:left;">索引长度：83</p> 
 <p style="">case6:</p> 
 <p style="">效果完全和case1相同，三个字段的索引都用到了。注意最左前缀法则说的是，select语句中brand_name这个字段必须存在，对放置位置没有要求。</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:2484px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:11.191626%;height:0;"> 
    <img src="https://images2.imgbox.com/e6/31/pwF3cYRZ_o.png" style="margin-left:;display:block;width:2484px;margin-top:-11.191626%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="">2.6.3 索引失效情况</h4> 
 <p style="">1、不要在索引列上进行运算操作，否则索引将失效</p> 
 <p style="">2、字符串类型字段使用时 ，不加引号，索引将失效</p> 
 <p style="">3、like模糊匹配。如果仅仅是尾部模糊匹配，索引不会失效。只要有头部模糊匹配（不论尾部是否模糊匹配），索引就会失效，type是全表扫描；</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:2712px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:8.259587%;height:0;"> 
    <img src="https://images2.imgbox.com/fa/9e/o3nhu8Jn_o.png" style="margin-left:;display:block;width:2712px;margin-top:-8.259587%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:2274px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:12.84081%;height:0;"> 
    <img src="https://images2.imgbox.com/e4/5c/msg4VTyY_o.png" style="margin-left:;display:block;width:2274px;margin-top:-12.84081%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">4、or连接条件。用or分隔开的条件，如果or前的条件中的列有索引，而后面的列中没有索引，那么前面的列索引会失效。只有or前、or后两个字段都存在索引，两个索引才会用到。</p> 
 <p style="">brand_name有索引，company_name没有索引时，type为全表扫描。</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:2330px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:12.017168%;height:0;"> 
    <img src="https://images2.imgbox.com/f5/9f/9RY1yONm_o.png" style="margin-left:;display:block;width:2330px;margin-top:-12.017168%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">Id和brand_name都有索引，因此下面的SQL用到了两个索引。</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:2366px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:20.287405%;height:0;"> 
    <img src="https://images2.imgbox.com/83/42/SwdoTOqN_o.png" style="margin-left:;display:block;width:2366px;margin-top:-20.287405%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">5、数据分布影响。如果MySQL评估使用索引比全表扫描更慢，则不使用索引。</p> 
 <h4 style="">2.6.4 SQL提示-选择索引</h4> 
 <p style="">如果某个字段上存在多个索引，可以通过SQL提示告诉数据库使用哪个索引，如果不指定使用哪个索引，数据库会自己选择一个。</p> 
 <p style="text-align:left;">use index(index_name)：建议数据库用哪个索引，MySQL可以选择接受 or不接受。</p> 
 <p style="text-align:left;">Ignore index(index_name):告诉数据库不要用哪个索引</p> 
 <p style="text-align:left;">force index(index_name):强制数据库必须使用哪个索引</p> 
 <p style=""></p> 
 <p style="">如下所示，brand_name存在一个单独的索引，brand_name和ordered共建了一个联合索引；</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:3538px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:10.401357%;height:0;"> 
    <img src="https://images2.imgbox.com/46/7f/tTV9gBlt_o.png" style="margin-left:;display:block;width:3538px;margin-top:-10.401357%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">数据库自己选择了index_brand_name的这个单独索引：</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:2850px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:10.245614%;height:0;"> 
    <img src="https://images2.imgbox.com/70/85/RzerGA0t_o.png" style="margin-left:;display:block;width:2850px;margin-top:-10.245614%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">建议数据库使用联合索引，并且MySQL接受了建议：</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:2640px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:10.833333%;height:0;"> 
    <img src="https://images2.imgbox.com/42/1c/MrCArF1g_o.png" style="margin-left:;display:block;width:2640px;margin-top:-10.833333%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="">2.6.5 覆盖索引以及回表查询</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:542px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:41.512917%;height:0;"> 
    <img src="https://images2.imgbox.com/87/3f/pJC7up2M_o.png" style="margin-left:;display:block;width:542px;margin-top:-41.512917%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">case1：select * from tb_user where id=2</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:553px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:43.7613%;height:0;"> 
    <img src="https://images2.imgbox.com/69/18/ayxJZYBR_o.png" style="margin-left:;display:block;width:553px;margin-top:-43.7613%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">使用聚集索引（主键索引），只扫描一遍聚集索引的B+树。</p> 
 <p style="">id为5-&gt;id为2-&gt;返回叶子节点2下面挂的row行数据(*就是row行数据)</p> 
 <p style="">case2：select id,name from tb_user where name=‘Arm’</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:453px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:43.92936%;height:0;"> 
    <img src="https://images2.imgbox.com/f9/ee/kqWTPJ04_o.png" style="margin-left:;display:block;width:453px;margin-top:-43.92936%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">使用二级索引，name为Lee-&gt;name为Arm-&gt;返回Arm和Arm下面挂的id 2，扫描一遍二级索引即可返回Arm和2。二级索引的叶子节点下面挂的就是ID。</p> 
 <p style="">case3：select id,name,gender from tb_user where name=‘Arm’</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:484px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:44.008263%;height:0;"> 
    <img src="https://images2.imgbox.com/b6/3b/5RJ64yHT_o.png" style="margin-left:;display:block;width:484px;margin-top:-44.008263%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">使用二级索引和聚集索引，name为Lee-&gt;name为Arm-&gt;找到Arm节点下挂的id 2-&gt;回表查询-&gt;id为5-&gt;id为2-&gt;找到叶子节点2下面挂的row行数据-&gt;找到gender。扫描两遍，效率低。</p> 
 <p style="">思考题1：</p> 
 <p style="">select * from tb_user where id=2;//扫描一遍聚集索引，即可返回行数据</p> 
 <p style="">select * from tbz_user where name=‘Arm’//先遍历二级索引，找到id为2；再回表查询聚集索引，找到id为2的节点下面挂的行数据。效率低。</p> 
 <p style="">思考题2：</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:366px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:24.863388%;height:0;"> 
    <img src="https://images2.imgbox.com/b2/f7/7QNVqTVJ_o.png" style="margin-left:;display:block;width:366px;margin-top:-24.863388%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">select id,username,password from tb_user where username=‘xiaoming’</p> 
 <p style="">1、给username单独建立索引不可取，查询password还需要回表查询聚集索引（主键索引），效率低；</p> 
 <p style="">2、可以给username和password建立联合索引，二级索引叶子节点下面挂的就是id，所以扫描一遍二级索引就能拿到三个字段的值</p> 
 <h4 style="">2.6.6 前缀索引</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:596px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:38.25503%;height:0;"> 
    <img src="https://images2.imgbox.com/09/3c/m1xHNhee_o.png" style="margin-left:;display:block;width:596px;margin-top:-38.25503%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">前缀索引用来解决长字符或者大文本在创建索引时浪费大量磁盘IO的情况。</p> 
 <p style="">前缀索引：提取字符串的前面n个字符构建索引</p> 
 <p style="">选择性：不重复的字段数据总数/数据表的记录总数，最大为1</p> 
 <p style="">查看brand_name字段的选择性：</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:601px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:21.297836%;height:0;"> 
    <img src="https://images2.imgbox.com/b8/41/LK6DW4o7_o.png" style="margin-left:;display:block;width:601px;margin-top:-21.297836%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">brand_name字段中有重复的数据，因此选择性到不了1</p> 
 <p style="">选择brand_name的前n个字节，再查看选择性：</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:495px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:76.36363%;height:0;"> 
    <img src="https://images2.imgbox.com/bd/12/rara4TXB_o.png" style="margin-left:;display:block;width:495px;margin-top:-76.36363%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">截取brand_name的前15，10，8个字符，去重后，计算相关性，没有变化，都是0.9677，因此选择截取brand_name的前8个字符创建前缀索引,降低索引占据的内存空间。</p> 
 <p style="">create index index_brand_name_8 on tb_brand(brand_name(8));</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:3466px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:9.751876%;height:0;"> 
    <img src="https://images2.imgbox.com/52/1b/ZJZVEROr_o.png" style="margin-left:;display:block;width:3466px;margin-top:-9.751876%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">sub_part:8，截取前8个字符创建的索引。</p> 
 <p style="">前缀索引查询流程如下，以email截取前5个字符创建索引为例：</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:641px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:50.70203%;height:0;"> 
    <img src="https://images2.imgbox.com/90/6a/cqg26UBi_o.png" style="margin-left:;display:block;width:641px;margin-top:-50.70203%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="">2.6.7 索引设计原则</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:545px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:33.394497%;height:0;"> 
    <img src="https://images2.imgbox.com/f1/3f/l18ASw2I_o.png" style="margin-left:;display:block;width:545px;margin-top:-33.394497%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h2 style="">3 SQL优化</h2> 
 <p style="">select语句可以通过第2章中建立合适的索引提高查询效率。</p> 
 <h3 style="">3.1 插入数据优化</h3> 
 <p style="">插入数据可以通过insert语句或者MySQL的load指令来实现。</p> 
 <h4 style="">3.1.1 insert优化</h4> 
 <p style="">插入多条数据的优化点如下：</p> 
 <ol start="1"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;"><p>批量插入</p></li></ol> 
 <p style="">一条insert语句插入多条记录，而不是每条insert语句只插入一条记录；</p> 
 <p style="">insert into tb_user values(1,'xiaoming'),(2,'xiaohong'),(3,'xiaoli');//适合插入几百至一千条记录</p> 
 <p style="">如果数据量很大，比如百万，可以执行多次批量插入，每次批量插入1000条；</p> 
 <ol start="2"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;"><p>手动提交事务</p></li></ol> 
 <p style="">MySQL执行SQL语句默认是自动提交事务的，多条insert语句就意味着多次开启事务-提交事务，可优化为手动提交事务，降低多次开启/提交事务的耗时。</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:289px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:36.33218%;height:0;"> 
    <img src="https://images2.imgbox.com/4e/05/7lkmXddH_o.png" style="margin-left:;display:block;width:289px;margin-top:-36.33218%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">3 主键顺序插入</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:325px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:10.153846%;height:0;"> 
    <img src="https://images2.imgbox.com/75/5e/cUXinp4B_o.png" style="margin-left:;display:block;width:325px;margin-top:-10.153846%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">主键顺序插入效率要高于主键乱序插入</p> 
 <h4 style="">3.1.2 load指令大批量插入</h4> 
 <p style="">如果想一次性加载500万/1000万条数据insert语句性能就很低了，使用MySQL提供的load指令</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:2794px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:20.615604%;height:0;"> 
    <img src="https://images2.imgbox.com/23/13/f7R9ZvOK_o.png" style="margin-left:;display:block;width:2794px;margin-top:-20.615604%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:606px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:20.79208%;height:0;"> 
    <img src="https://images2.imgbox.com/7d/be/N0ywc6mg_o.png" style="margin-left:;display:block;width:606px;margin-top:-20.79208%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h3 style="">3.2 主键优化</h3> 
 <p style="">1、尽量降低主键的长度。</p> 
 <p style="">二级索引的叶子节点下面挂的就是主键的值，如果二级索引过多，主键又很长，会占用大量的磁盘空间，搜索时磁盘IO也会增加。</p> 
 <p style="">2、掺入数据时，尽量选择顺序插入，选择使用auto_increment自增主键，逐渐乱序插入可能出现页分裂现象。</p> 
 <p style="">3、UUID和身份证号是无序的，并且长度过长，不适宜做主键</p> 
 <h4 style="">3.2.1 InnoDB引擎中数据的组织方式</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:486px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:39.917694%;height:0;"> 
    <img src="https://images2.imgbox.com/38/6d/bpSPgffR_o.png" style="margin-left:;display:block;width:486px;margin-top:-39.917694%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">表中的数据是根据主键顺序存放的，叶子节点/非叶子节点存放在page中。</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:2608px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:41.56442%;height:0;"> 
    <img src="https://images2.imgbox.com/ad/c4/di3OveGp_o.png" style="margin-left:;display:block;width:2608px;margin-top:-41.56442%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="">3.2.2 页分裂</h4> 
 <p style="text-indent:1.4em;">页可以为空，也可以填充一半，也可以填充100%。每个页至少包含2行数据，这些行数据是根据主键排列的。</p> 
 <p style="text-indent:1.4em;">主键顺序插入时如下图所示，先申请第一页，第一页存满，申请第二页继续存储，页与页之间会维护一个双向指针。</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:1600px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:9.75%;height:0;"> 
    <img src="https://images2.imgbox.com/10/29/HCs31ow2_o.png" style="margin-left:;display:block;width:1600px;margin-top:-9.75%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="text-indent:1.4em;">主键乱序插入时，可能存在页分裂现象，页分裂流程如下：</p> 
 <ol start="1"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;"><p>现状，当前已经存在两个页，现在要插入主键为50这个叶子节点</p></li></ol> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:450px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:38.666668%;height:0;"> 
    <img src="https://images2.imgbox.com/ce/7d/Gb0kMRU1_o.png" style="margin-left:;display:block;width:450px;margin-top:-38.666668%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">2 开启新的数据页3，把数据页1在中间进行分割，把数据分成两部分1,5,9和23,47，将23,47移动到page3中</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:519px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:25.626205%;height:0;"> 
    <img src="https://images2.imgbox.com/fd/5a/Nl9dChXl_o.png" style="margin-left:;display:block;width:519px;margin-top:-25.626205%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">3 50叶子节点插入到数据页3中</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:553px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:9.403255%;height:0;"> 
    <img src="https://images2.imgbox.com/18/57/k8EzZ6GW_o.png" style="margin-left:;display:block;width:553px;margin-top:-9.403255%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">4 重新设置页指针，1和3维护双向指针；2和3维护双向指针</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:522px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:10.72797%;height:0;"> 
    <img src="https://images2.imgbox.com/74/ee/cMuWEpMQ_o.png" style="margin-left:;display:block;width:522px;margin-top:-10.72797%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="">3.2.3 页合并</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:1640px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:22.682926%;height:0;"> 
    <img src="https://images2.imgbox.com/4b/f2/cYCN1178_o.png" style="margin-left:;display:block;width:1640px;margin-top:-22.682926%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:724px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:9.668509%;height:0;"> 
    <img src="https://images2.imgbox.com/0c/68/2u7oy60b_o.png" style="margin-left:;display:block;width:724px;margin-top:-9.668509%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:512px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:9.9609375%;height:0;"> 
    <img src="https://images2.imgbox.com/6f/fa/fjCVLJxq_o.png" style="margin-left:;display:block;width:512px;margin-top:-9.9609375%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h3 style="">3.3 order by优化</h3> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:614px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:41.530945%;height:0;"> 
    <img src="https://images2.imgbox.com/71/25/Ata1i26h_o.png" style="margin-left:;display:block;width:614px;margin-top:-41.530945%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">Using index的排序效率要高于Using filesort。排序字段没有索引时，排序是Using filesort排序，给排序字段创建索引后，排序是Using index排序。</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:2684px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:39.195232%;height:0;"> 
    <img src="https://images2.imgbox.com/ef/51/pnJsOrUc_o.png" style="margin-left:;display:block;width:2684px;margin-top:-39.195232%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">按照brand_name升序，ordered降序创建索引：</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:2728px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:42.961876%;height:0;"> 
    <img src="https://images2.imgbox.com/a0/73/RadZMeOm_o.png" style="margin-left:;display:block;width:2728px;margin-top:-42.961876%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">在按照brand_name升序，ordered降序select时，也是Using index方式。</p> 
 <p style="">Collation：代表升序（A），降序（D）方式</p> 
 <p style="">order by优化点如下：</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:491px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:19.959267%;height:0;"> 
    <img src="https://images2.imgbox.com/c9/6d/FJlCLAlE_o.png" style="margin-left:;display:block;width:491px;margin-top:-19.959267%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:431px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:32.946636%;height:0;"> 
    <img src="https://images2.imgbox.com/68/c0/KLsK9yxM_o.png" style="margin-left:;display:block;width:431px;margin-top:-32.946636%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h3 style="">3.4 group by优化</h3> 
 <p style="">对分组字段建立适当的索引，提高分组效率。</p> 
 <p style="">未建立索引时分组：</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:421px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:78.384796%;height:0;"> 
    <img src="https://images2.imgbox.com/49/83/iAYGQiGq_o.png" style="margin-left:;display:block;width:421px;margin-top:-78.384796%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:716px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:13.128492%;height:0;"> 
    <img src="https://images2.imgbox.com/b8/49/HBp0XT4x_o.png" style="margin-left:;display:block;width:716px;margin-top:-13.128492%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">type:ALL，全表扫描</p> 
 <p style="">建立联合索引后的分组：</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:3120px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:19.871796%;height:0;"> 
    <img src="https://images2.imgbox.com/69/26/0AdWWwQA_o.png" style="margin-left:;display:block;width:3120px;margin-top:-19.871796%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">type:index</p> 
 <p style="">根据age分组，未满足最左前缀法则，使用了临时表，效率低：</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:3454px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:11.580775%;height:0;"> 
    <img src="https://images2.imgbox.com/9c/3d/IeruEWnr_o.png" style="margin-left:;display:block;width:3454px;margin-top:-11.580775%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">根据profession、age分组，满足最足前缀法则，只使用了索引，未使用临时表，效率高：</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:3122px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:13.004484%;height:0;"> 
    <img src="https://images2.imgbox.com/59/d6/EQW335UX_o.png" style="margin-left:;display:block;width:3122px;margin-top:-13.004484%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h3 style="">3.5 limit优化</h3> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:2980px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:6.1744967%;height:0;"> 
    <img src="https://images2.imgbox.com/99/cf/HoVLJjNy_o.png" style="margin-left:;display:block;width:2980px;margin-top:-6.1744967%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">优化方法：覆盖索引+子查询</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:577px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:94.974%;height:0;"> 
    <img src="https://images2.imgbox.com/4b/7b/5Nmvyc6t_o.png" style="margin-left:;display:block;width:577px;margin-top:-94.974%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h3 style="">3.6 count优化</h3> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:617px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:23.338736%;height:0;"> 
    <img src="https://images2.imgbox.com/36/89/EvpxjZEC_o.png" style="margin-left:;display:block;width:617px;margin-top:-23.338736%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:635px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:17.165356%;height:0;"> 
    <img src="https://images2.imgbox.com/2a/89/mDykaQNS_o.png" style="margin-left:;display:block;width:635px;margin-top:-17.165356%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:584px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:41.26712%;height:0;"> 
    <img src="https://images2.imgbox.com/13/f0/w7X5fs6z_o.png" style="margin-left:;display:block;width:584px;margin-top:-41.26712%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h3 style="">3.7 update优化</h3> 
 <p style="">执行update时更新的条件字段一定要有索引，否则行锁会升级成表锁，一旦锁表，并发性能会降低；</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:636px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:24.213837%;height:0;"> 
    <img src="https://images2.imgbox.com/89/6a/6exJEDTa_o.png" style="margin-left:;display:block;width:636px;margin-top:-24.213837%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">1、id是主键索引，所以执行SQL 1语句时锁定的是id为1的这一行记录；此时，其他客户端可以同时更新id不是1的其他记录。</p> 
 <p style="">2、name没有建立索引，所以执行SQL 2语句时锁定的是整张表，此时其他客户端不能同时更新表，并发性能严重下降；</p> 
 <h2 style="">4 视图/存储过程/触发器</h2> 
 <h3 style="">4.1 视图</h3> 
 <h4 style="">4.1.1 视图介绍及基本用法</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:2894px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:14.78922%;height:0;"> 
    <img src="https://images2.imgbox.com/89/e7/242vGJvy_o.png" style="margin-left:;display:block;width:2894px;margin-top:-14.78922%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">视图是一张虚拟表，最终的数据来源于select语句，select语句从哪张表中查询数据，这张表称为视图所关联的基表。</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:568px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:44.542255%;height:0;"> 
    <img src="https://images2.imgbox.com/10/73/axb9x66x_o.png" style="margin-left:;display:block;width:568px;margin-top:-44.542255%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:468px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:70.94017%;height:0;"> 
    <img src="https://images2.imgbox.com/25/87/BAWtVz3i_o.png" style="margin-left:;display:block;width:468px;margin-top:-70.94017%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="">4.1.2 检查选项-级联-with cascaded check option</h4> 
 <p style="">视图是一张虚拟表，在视图中插入数据，数据实际是插入到了基表中。</p> 
 <p style="">视图检查选项：在视图中插入、更新、删除数据时，MySQL会检查对视图的上述操作是否符合视图定义，如果违背了视图定义时的条件，上述操作会失败。</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:587px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:42.589436%;height:0;"> 
    <img src="https://images2.imgbox.com/d1/48/eawHveP5_o.png" style="margin-left:;display:block;width:587px;margin-top:-42.589436%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">案例：</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:567px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:40.38801%;height:0;"> 
    <img src="https://images2.imgbox.com/c7/2f/lcFIiKHd_o.png" style="margin-left:;display:block;width:567px;margin-top:-40.38801%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:529px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:27.410208%;height:0;"> 
    <img src="https://images2.imgbox.com/3b/12/IRY9D6bb_o.png" style="margin-left:;display:block;width:529px;margin-top:-27.410208%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">stu_v_1插入5成功</p> 
 <p style="">stu_v_1插入25成功，因为定义stu_v_1时没有添加with check option选项</p> 
 <p style="">stu_v_2掺入7失败，不满足stdu_v_2定义时的视图要求（id&gt;=10）</p> 
 <p style="">stu_v_2掺入26失败，cascaded（级联）会检查被依赖的视图定义，stu_v_2基于stu_v_1创建而来，所以with cascaded check option要求对stu_v_2插入数据时，要同时满足stu_v_2和stu_v_1的视图定义</p> 
 <p style="">stu_v_2掺入15成功，同时满足stu_v_1和stu_v_2的视图定义</p> 
 <p style="">stu_v_3插入11成功，满足stu_v_2和stdu_v_1的视图定义要求,</p> 
 <p style="">stu_v_3插入17成功，满足stu_v_2和stdu_v_1的视图定义要求，定义stu_v_3视图时没有加检查选项，因此插入17时不会检查v_3的视图定义（id&lt;=15）</p> 
 <p style="">stu_v_3插入28失败，不满足stdu_v_1的视图定义要求</p> 
 <h4 style="">4.1.3 检查选项-with local check option</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:564px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:42.021275%;height:0;"> 
    <img src="https://images2.imgbox.com/f7/e7/KnU2n2Lu_o.png" style="margin-left:;display:block;width:564px;margin-top:-42.021275%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">案例：</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:477px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:56.603775%;height:0;"> 
    <img src="https://images2.imgbox.com/fb/17/InoeB6MN_o.png" style="margin-left:;display:block;width:477px;margin-top:-56.603775%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">给V4插入数据，不会检查视图定义，因为没有声明with check option</p> 
 <p style="">给V5插入数据时，会检查V5的视图定义，因为声明了with local check option；同时也会查看V4视图，因为V4没有声明with check option，因此不会检查V4的视图定义；如果V4声明了with check option，给V5插入数据时还会同时检查V4的视图定义；</p> 
 <p style="">stu_v_4插入5成功，V4没有声明with check option，插入数据时不会检查视图定义</p> 
 <p style="">stu_v_4插入16成功，V4没有声明with check option，插入数据时不会检查视图定义</p> 
 <p style="">stu_v_5掺入13成功，满足stdu_v_5定义时的视图要求（id&gt;=10），不检查V4的视图定义</p> 
 <p style="">stu_v_5掺入17成功，满足stdu_v_5定义时的视图要求（id&gt;=10），不检查V4的视图定义</p> 
 <p style="">stu_v_6掺入14成功，因为V6没有声明with check option，所以不对V6视图定义做检查；检查V5的视图定义，满足V5的视图定义（id&gt;=10）；同时也会查看V4视图，因为V4没有声明with check option，因此不会检查V4的视图定义；</p> 
 <h4 style="">4.1.4 视图更新条件以及作用</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:620px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:29.51613%;height:0;"> 
    <img src="https://images2.imgbox.com/00/e2/nx8hZxUu_o.png" style="margin-left:;display:block;width:620px;margin-top:-29.51613%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:620px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:33.225807%;height:0;"> 
    <img src="https://images2.imgbox.com/67/71/fA8QEaLx_o.png" style="margin-left:;display:block;width:620px;margin-top:-33.225807%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:698px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:25.358166%;height:0;"> 
    <img src="https://images2.imgbox.com/9e/f6/TEbwZM43_o.png" style="margin-left:;display:block;width:698px;margin-top:-25.358166%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h3 style="">4.2 存储过程</h3> 
 <h4 style="">4.2.1 存储过程基本语法</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:687px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:39.301308%;height:0;"> 
    <img src="https://images2.imgbox.com/07/d2/lJGjr5Hq_o.png" style="margin-left:;display:block;width:687px;margin-top:-39.301308%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">存储过程特点：</p> 
 <ol start="1"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;"><p>封装、复用SQL依据</p></li></ol> 
 <ol start="2"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;"><p>可以接收参数，也可以返回数据</p></li></ol> 
 <ol start="3"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;"><p>减少网络交互，从而提高数据处理效率</p></li></ol> 
 <pre class="kdocs-sql"><code class="language-sql">-- 创建存储过程
create procedure p2()
begin
    select count(*) from tb_brand;
end;

-- 调用存储过程
call p2();


-- 查看存储过程的SQL定义
show create procedure p2;

-- 查看指定数据库的存储过程以及状态信息
select * from information_schema.ROUTINES where ROUTINE_SCHEMA='db1';

-- 删除存储过程
drop procedure if exists p1;

-- sql命令行中定义存储过程分号问题，可通过delimiter指定SQL语句结束符号，如delimiter $$
delimiter $$
create procedure p3()
begin
    select count(*) from tb_brand;
end$$</code></pre> 
 <h4 style="">4.2.2 系统变量</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:623px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:35.63403%;height:0;"> 
    <img src="https://images2.imgbox.com/52/5b/k7jtzo8H_o.png" style="margin-left:;display:block;width:623px;margin-top:-35.63403%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <pre class="kdocs-sql"><code class="language-sql">-- 全局变量针对所有的会话都有效，会话变量只对当前会话有效。show后面如果不加级别，默认是会话级别的系统变量
-- 查看所有的系统变量
show variables ;
-- 模糊匹配，查看自动提交相关的系统变量
show variables  like 'auto%';
show global variables  like 'auto%';
-- 准确查看某一个系统变量
select @@autocommit;
select @@global.autocommit;
-- 设置系统变量
set @@autocommit=0;
set @@global.autocommit=0;
set session  autocommit  = 0;
set global  autocommit  = 0-- 数据库重启后，全局的autocommit变量会恢复到初始值</code></pre> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:615px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:9.756098%;height:0;"> 
    <img src="https://images2.imgbox.com/d3/74/Hp8HVmY2_o.png" style="margin-left:;display:block;width:615px;margin-top:-9.756098%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="">4.2.3 用户自定义变量</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:535px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:35.140186%;height:0;"> 
    <img src="https://images2.imgbox.com/f1/ad/UEtu6bKF_o.png" style="margin-left:;display:block;width:535px;margin-top:-35.140186%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <pre class="kdocs-sql"><code class="language-sql">-- 定义用户自定义变量，session内有效
set @myname='zxb';
set @myage:=20;
set @mygender='男',@mybobby:='running';-- 一次性定义多个
select @mycolor:='red';
select count(*) into @mycount from tb_brand;-- 将select的查询结果赋值给自定义变量 @mycount
-- 使用用户自定义变量
select @myage,@myname,@mygender;
select @abc -- 该变量没有声明，查询出来是null，查询时并不会报错</code></pre> 
 <h4 style="">4.2.4 局部变量</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:663px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:36.199093%;height:0;"> 
    <img src="https://images2.imgbox.com/d3/4d/VobVYQ0c_o.png" style="margin-left:;display:block;width:663px;margin-top:-36.199093%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <pre class="kdocs-sql"><code class="language-sql">
create procedure p4()
begin
    declare brand_count int default 0;-- 声明局部变量，p4()内有效
    select count(*) into brand_count from tb_brand;-- 局部变量赋值
    select brand_count;-- 查询局部变量
end;

call p4();</code></pre> 
 <h4 style="">4.2.5 if语法</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:240px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:55.416664%;height:0;"> 
    <img src="https://images2.imgbox.com/d8/26/d6Yj4NNK_o.png" style="margin-left:;display:block;width:240px;margin-top:-55.416664%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:296px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:35.81081%;height:0;"> 
    <img src="https://images2.imgbox.com/f4/cb/pj8XQ7wb_o.png" style="margin-left:;display:block;width:296px;margin-top:-35.81081%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <pre class="kdocs-sql"><code class="language-sql">create procedure p5()
begin
    declare score int default 80;-- 声明局部变量，p5()内有效
    declare result varchar(10);
    if score &gt;=85 then
        set result := '优秀';
    elseif score&gt;=60 then
        set result:='及格';
    else
        set result:='不及格';
    end if;
    select result;
end;

call p5();</code></pre> 
 <h4 style="">4.2.6 参数</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:574px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:41.986065%;height:0;"> 
    <img src="https://images2.imgbox.com/f2/a5/9iHe060B_o.png" style="margin-left:;display:block;width:574px;margin-top:-41.986065%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:290px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:70.68966%;height:0;"> 
    <img src="https://images2.imgbox.com/66/e4/M7mdFijM_o.png" style="margin-left:;display:block;width:290px;margin-top:-70.68966%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <pre class="kdocs-sql"><code class="language-sql">create procedure p6(in score int,out result varchar(10))
begin
    if score &gt;=85 then
        set result := '优秀';
    elseif score&gt;=60 then
        set result:='及格';
    else
        set result:='不及格';
    end if;
end;

call p6(98,@result);
select @result;</code></pre> 
 <pre class="kdocs-sql"><code class="language-sql">create procedure p7(inout score double)

begin
    set  score:=score*0.5;
end;
set @score = 80;
call p7(@score);
select @score;</code></pre> 
 <h4 style="">4.2.7 case</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:297px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:92.59259%;height:0;"> 
    <img src="https://images2.imgbox.com/9f/5e/l61hty03_o.png" style="margin-left:;display:block;width:297px;margin-top:-92.59259%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:357px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:47.338936%;height:0;"> 
    <img src="https://images2.imgbox.com/34/36/q97jq3Rn_o.png" style="margin-left:;display:block;width:357px;margin-top:-47.338936%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <pre class="kdocs-sql"><code class="language-sql">create procedure p8(in month int)
begin
    declare result varchar(10);
    case
        when month&gt;=1 and month&lt;=3 then
        set result:='一季度';
        when month&gt;=4 and month&lt;=6 then
            set result:='二季度';
        when month&gt;=7 and month&lt;=9 then
            set result:='三季度';
        when month&gt;=10 and month&lt;=12 then
            set result:='四季度';
        else
        set result:='非法参数';
    end case;
    select concat('你输入的月份为',month,',所属的季度为',result);-- 字符串拼接
end;

call p8(1);</code></pre> 
 <h4 style="">4.2.8 while循环</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:458px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:29.257643%;height:0;"> 
    <img src="https://images2.imgbox.com/74/53/LujPrJzP_o.png" style="margin-left:;display:block;width:458px;margin-top:-29.257643%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">计算1-n的累加值：</p> 
 <pre class="kdocs-sql"><code class="language-sql">create procedure p10(in n int)
begin
    declare sum int default 0;
    while n&gt;0 do
        set sum := sum+n;
        set  n := n-1;
    end while;
    select sum;
end;

call p10(10);</code></pre> 
 <h4 style="">4.2.9 repeat循环</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:418px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:33.25359%;height:0;"> 
    <img src="https://images2.imgbox.com/8d/14/Y8qiDuSw_o.png" style="margin-left:;display:block;width:418px;margin-top:-33.25359%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">计算1-n的累加值：</p> 
 <pre class="kdocs-sql"><code class="language-sql">create procedure p11(in n int)
begin
    declare sum int default 0;
    repeat
        set sum:=sum+n;
        set  n := n-1;
    until
        n&lt;=0
    end repeat;
    select sum;

end;


call p11(10);</code></pre> 
 <h4 style="">4.2.10 loop循环</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:562px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:37.010674%;height:0;"> 
    <img src="https://images2.imgbox.com/64/23/VEYbWVaS_o.png" style="margin-left:;display:block;width:562px;margin-top:-37.010674%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <ol start="1"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;"><p>计算1-n的累加值：</p></li></ol> 
 <pre class="kdocs-sql"><code class="language-sql">create procedure p12(in n int)
begin
    declare sum int default 0;
    sumLabel:loop
        if n&lt;=0 then
            leave sumLabel;
        end if;
        set sum:=sum+n;
        set  n := n-1;

    end loop sumLabel;
    select sum;
end;

call p12(10);</code></pre> 
 <ol start="2"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;"><p>计算1-n之间偶数累加值：</p></li></ol> 
 <pre class="kdocs-sql"><code class="language-sql">create procedure p13(in n int)
begin
    declare sum int default 0;
    sumLabel:loop
        if n&lt;=0 then
            leave sumLabel;
        end if;
        if n%2=1 then
            set  n := n-1;
            iterate sumLabel;-- 如果是奇数，跳过本次循环
        end if;
        set sum:=sum+n;
        set  n := n-1;

    end loop sumLabel;
    select sum;
end;

call p13(10);</code></pre> 
 <h4 style="">4.2.11 cursor游标</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:684px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:42.105263%;height:0;"> 
    <img src="https://images2.imgbox.com/d0/b0/2LiKDy46_o.png" style="margin-left:;display:block;width:684px;margin-top:-42.105263%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:643px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:8.553655%;height:0;"> 
    <img src="https://images2.imgbox.com/a9/83/TE2ig7NN_o.png" style="margin-left:;display:block;width:643px;margin-top:-8.553655%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <pre class="kdocs-sql"><code class="language-sql">create procedure p15(in n int)
begin
    -- 声明三个变量
    declare brand_name varchar(20);
    declare company_name varchar(20);
    declare ordered int default 0;
    -- 声明游标，存储查询结果集
    declare cur cursor for select brand_name,company_name,ordered from tb_brand where id&gt;=n;
    -- 创建一张新表
    drop table if exists tb_brand_2;
    create table if not exists tb_brand_2(id int primary key  auto_increment,brand_name varchar(20),company_name varchar(20),ordered int);
    -- 开启游标
    open cur;

    while true do
        -- 获取游标中的记录，并赋值给变量
        fetch cur into brand_name,company_name,ordered;
        -- 插入表结构
        insert into tb_brand_2 values(null,brand_name,company_name,ordered);

    end while;
    -- 关闭游标
    close cur;
end;

call p15(1063565);</code></pre> 
 <h4 style="">4.2.12 handler条件处理</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:505px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:47.920788%;height:0;"> 
    <img src="https://images2.imgbox.com/3c/aa/tPXLync2_o.png" style="margin-left:;display:block;width:505px;margin-top:-47.920788%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <pre class="kdocs-sql"><code class="language-sql">create procedure p15(in n int)
begin
    -- 声明三个变量
    declare brand_name varchar(20);
    declare company_name varchar(20);
    declare ordered int default 0;
    -- 声明游标，存储查询结果集
    declare cur cursor for select brand_name,company_name,ordered from tb_brand where id&gt;=n;
    -- 声明条件处理程序,当SQL报错02000时退出程序并关闭游标，[02000][1329] No data - zero rows fetched, selected, or processed
    declare exit handler for sqlstate  '02000' close cur;
    -- declare exit handler for not found close cur;
    -- 创建一张新表
    drop table if exists tb_brand_2;
    create table if not exists tb_brand_2(id int primary key  auto_increment,brand_name varchar(20),company_name varchar(20),ordered int);
    -- 开启游标
    open cur;

    while true do
        -- 获取游标中的记录，并赋值给变量
        fetch cur into brand_name,company_name,ordered;
        -- 插入表结构
        insert into tb_brand_2 values(null,brand_name,company_name,ordered);

    end while;
    -- 关闭游标
    -- close cur;
end;

call p15(1063565);</code></pre> 
 <h3 style="">4.3 存储函数</h3> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:425px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:63.058823%;height:0;"> 
    <img src="https://images2.imgbox.com/71/55/SdZsjOBz_o.png" style="margin-left:;display:block;width:425px;margin-top:-63.058823%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">计算1-n的累加值：</p> 
 <pre class="kdocs-sql"><code class="language-sql">create function fun1(n int)
returns int deterministic

begin
    declare sum int default 0;
    while n&gt;0 do
            set sum := sum+n;
            set  n := n-1;
    end while;
    return sum;

end;

select fun1(100);</code></pre> 
 <p style="">存储函数用的比较少，存储函数都可以用存储过程替代。</p> 
 <h3 style="">4.4 触发器</h3> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:635px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:33.54331%;height:0;"> 
    <img src="https://images2.imgbox.com/9d/90/iNmOqTZr_o.png" style="margin-left:;display:block;width:635px;margin-top:-33.54331%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">行级触发器：比如当执行update语句时影响了5行，如果触发器被触发5次，该触发器是行级触发器</p> 
 <p style="">语句级触发器：比如当执行update语句，不管这条update语句影响了多少行，该触发器只被触发一次</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:408px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:53.92157%;height:0;"> 
    <img src="https://images2.imgbox.com/d4/5b/8R4tt4RY_o.png" style="margin-left:;display:block;width:408px;margin-top:-53.92157%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">案例：</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:475px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:35.789474%;height:0;"> 
    <img src="https://images2.imgbox.com/49/eb/txmZptZr_o.png" style="margin-left:;display:block;width:475px;margin-top:-35.789474%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <pre class="kdocs-sql"><code class="language-sql">create table brand_logs(
    id int(11) primary key auto_increment,
    operation varchar(20) not null comment '操作类型,insert/update/delete',
    operate_time datetime not null comment '操作时间',
    operate_id int(11) not null comment '操作的id',
    operate_params varchar(500) comment '操作的参数'
);</code></pre> 
 <h4 style="">4.4.1 insert触发器</h4> 
 <pre class="kdocs-sql"><code class="language-sql">create trigger insert_trigger
after insert
on tb_brand for each row
begin
insert into brand_logs(id, operation, operate_time, operate_id, operate_params) values
(null,'insert',now(),NEW.id,concat(new.id,new.brand_name,new.company_name,new.ordered));

end;

show triggers;-- 查看当前数据库有哪些触发器
-- 测试，tb_brand表插入数据后，brand_logs会插入日志记录
insert into tb_brand(id, brand_name, company_name, ordered, description, status) values (null,'小米','xiaomi',1,'ddd',20);
select * from brand_logs;</code></pre> 
 <h4 style="">4.4.2 update触发器</h4> 
 <pre class="kdocs-sql"><code class="language-sql">create trigger update_trigger
    after update
    on tb_brand for each row
begin
    insert into brand_logs(id, operation, operate_time, operate_id, operate_params) values
        (null,'update',now(),NEW.id,concat('更新之前的数据',old.id,old.brand_name,old.company_name,old.ordered,'更新之后的数据',new.id,new.brand_name,new.company_name,new.ordered));

end;
-- 测试,tb_brand影响了几行，brand_logs中就会新增多少条记录，因为是行级触发器
update tb_brand set brand_name='xiaomi' where company_name='xiaomi';
select * from brand_logs;</code></pre> 
 <h4 style="">4.4.3 delete触发器</h4> 
 <pre class="kdocs-sql"><code class="language-sql">create trigger delete_trigger
    after delete
    on tb_brand for each row
begin
    insert into brand_logs(id, operation, operate_time, operate_id, operate_params) values
        (null,'delete',now(),old.id,concat('更新之前的数据',old.id,old.brand_name,old.company_name,old.ordered));

end;
-- 测试
delete from tb_brand where company_name='xiaomi';
select * from brand_logs;</code></pre> 
 <h2 style="">5 锁</h2> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:1592px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:15.075377%;height:0;"> 
    <img src="https://images2.imgbox.com/0d/1f/bgcNBbXP_o.png" style="margin-left:;display:block;width:1592px;margin-top:-15.075377%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:243px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:45.26749%;height:0;"> 
    <img src="https://images2.imgbox.com/63/8b/u6i89D0U_o.png" style="margin-left:;display:block;width:243px;margin-top:-45.26749%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h3 style="">5.1 全局锁</h3> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:524px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:38.74046%;height:0;"> 
    <img src="https://images2.imgbox.com/4c/a8/6tNXnnsf_o.png" style="margin-left:;display:block;width:524px;margin-top:-38.74046%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:525px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:45.52381%;height:0;"> 
    <img src="https://images2.imgbox.com/4c/fe/yGMI4OZ0_o.png" style="margin-left:;display:block;width:525px;margin-top:-45.52381%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">一、未加全局锁场景，出现数据不一致问题；</p> 
 <p style="">二、加全局锁</p> 
 <p style="">1、加全局锁</p> 
 <p style="">flush tables with read lock;其他客户端可以读取数据，不能写入数据。</p> 
 <p style="">2、业务操作</p> 
 <p style="">数据备份，mysqldump -uroot -p1234 dbname-&gt;D:/backup.sql</p> 
 <p style="">3、解锁</p> 
 <p style="">unlock tables;</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:507px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:41.42012%;height:0;"> 
    <img src="https://images2.imgbox.com/83/d0/AcpSbGBs_o.png" style="margin-left:;display:block;width:507px;margin-top:-41.42012%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">加上--single-transaction参数后，不用在手动加全局锁，InnoDB内部会保证数据一致。</p> 
 <h3 style="">5.2 表级锁</h3> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:540px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:31.111113%;height:0;"> 
    <img src="https://images2.imgbox.com/be/bc/9tJ69nZz_o.png" style="margin-left:;display:block;width:540px;margin-top:-31.111113%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="">5.2.1 表锁</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:500px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:41.0%;height:0;"> 
    <img src="https://images2.imgbox.com/0c/5a/RvbxE9PW_o.png" style="margin-left:;display:block;width:500px;margin-top:-41.0%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <pre class="kdocs-sql"><code class="language-sql">-- 读锁：加锁过程中，其他客户端和当前客户端可以读，不能写;
-- 写锁：加锁过程中，其他客户端不可以读、不可以写；当前客户端可以读，可以写；
lock tables tb_brand read;
unlock tables;

lock tables tb_brand write;
unlock tables;</code></pre> 
 <h4 style="">5.2.2 元数据锁</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:632px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:43.51266%;height:0;"> 
    <img src="https://images2.imgbox.com/e2/d8/lPITOpMj_o.png" style="margin-left:;display:block;width:632px;margin-top:-43.51266%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="">5.2.3 意向锁</h4> 
 <p style="">没有意向锁的话，线程A在加行级锁后，线程B如果要加表锁需要每行都扫描是否有行级锁，效率很低。</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:2874px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:44.46764%;height:0;"> 
    <img src="https://images2.imgbox.com/98/ff/tM2KlnNr_o.png" style="margin-left:;display:block;width:2874px;margin-top:-44.46764%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:644px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:44.409935%;height:0;"> 
    <img src="https://images2.imgbox.com/19/6a/EAQ3uLse_o.png" style="margin-left:;display:block;width:644px;margin-top:-44.409935%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:634px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:25.078865%;height:0;"> 
    <img src="https://images2.imgbox.com/45/27/pbb4Ehg6_o.png" style="margin-left:;display:block;width:634px;margin-top:-25.078865%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h3 style="">5.3 行级锁</h3> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:651px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:35.48387%;height:0;"> 
    <img src="https://images2.imgbox.com/92/76/97zRUljX_o.png" style="margin-left:;display:block;width:651px;margin-top:-35.48387%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="">5.3.1 行锁</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:505px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:46.930695%;height:0;"> 
    <img src="https://images2.imgbox.com/44/9e/DTMON0H0_o.png" style="margin-left:;display:block;width:505px;margin-top:-46.930695%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">1、事务A获得了这一行数据的共享锁，事务B也可以获得这行数据的共享锁，但是事务B不能获得这行数据的排它锁。</p> 
 <p style="">2、事务A获得了这行数据的排他锁，事务B不能同时获得这行数据的共享锁或者排他锁。</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:2866px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:24.424286%;height:0;"> 
    <img src="https://images2.imgbox.com/5f/43/gyN0KoLV_o.png" style="margin-left:;display:block;width:2866px;margin-top:-24.424286%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:2882px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:29.701595%;height:0;"> 
    <img src="https://images2.imgbox.com/56/e6/ILBLRGBt_o.png" style="margin-left:;display:block;width:2882px;margin-top:-29.701595%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="">5.3.2 间隙锁和临键锁</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:2008px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:32.270916%;height:0;"> 
    <img src="https://images2.imgbox.com/e1/76/3itSrNde_o.png" style="margin-left:;display:block;width:2008px;margin-top:-32.270916%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h2 style="">6 InnoDB存储引擎</h2> 
 <h3 style="">6.1 InnoDB逻辑储存结构</h3> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:3012px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:49.66799%;height:0;"> 
    <img src="https://images2.imgbox.com/1f/eb/smvquf2I_o.png" style="margin-left:;display:block;width:3012px;margin-top:-49.66799%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h3 style="">6.2 InnoDB系统架构</h3> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:645px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:50.542633%;height:0;"> 
    <img src="https://images2.imgbox.com/be/b1/dqRDj0qr_o.png" style="margin-left:;display:block;width:645px;margin-top:-50.542633%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="">6.2.1 InnoDB内存存储结构</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:637px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:46.310833%;height:0;"> 
    <img src="https://images2.imgbox.com/e5/ed/nKe0Xt3P_o.png" style="margin-left:;display:block;width:637px;margin-top:-46.310833%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">Buffer Pool中每一个方块就是一页，脏页是内存数据有更改但还没来得及刷新到磁盘上。</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:2926px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:48.87218%;height:0;"> 
    <img src="https://images2.imgbox.com/b5/fd/ykiqk820_o.png" style="margin-left:;display:block;width:2926px;margin-top:-48.87218%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">Change Buffer用来存储二级索引，不涉及聚集索引。</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:711px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:47.96062%;height:0;"> 
    <img src="https://images2.imgbox.com/e1/c0/o5YUvvDA_o.png" style="margin-left:;display:block;width:711px;margin-top:-47.96062%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:672px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:49.55357%;height:0;"> 
    <img src="https://images2.imgbox.com/a3/e6/OmhZOL10_o.png" style="margin-left:;display:block;width:672px;margin-top:-49.55357%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:2948px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:46.947083%;height:0;"> 
    <img src="https://images2.imgbox.com/eb/e2/oJzXcGVy_o.png" style="margin-left:;display:block;width:2948px;margin-top:-46.947083%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:538px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:47.769516%;height:0;"> 
    <img src="https://images2.imgbox.com/a5/05/R7lBUpSq_o.png" style="margin-left:;display:block;width:538px;margin-top:-47.769516%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:535px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:50.280373%;height:0;"> 
    <img src="https://images2.imgbox.com/6b/e7/9HMuM9si_o.png" style="margin-left:;display:block;width:535px;margin-top:-50.280373%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="">6.2.2 InnoDB磁盘存储结构</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:2820px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:47.51773%;height:0;"> 
    <img src="https://images2.imgbox.com/14/a9/vhxcW0E0_o.png" style="margin-left:;display:block;width:2820px;margin-top:-47.51773%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:2022px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:45.499504%;height:0;"> 
    <img src="https://images2.imgbox.com/a5/46/YDVDA16L_o.png" style="margin-left:;display:block;width:2022px;margin-top:-45.499504%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:1204px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:5.980067%;height:0;"> 
    <img src="https://images2.imgbox.com/7c/f0/V9oZ3zQW_o.png" style="margin-left:;display:block;width:1204px;margin-top:-5.980067%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:1618px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:5.315204%;height:0;"> 
    <img src="https://images2.imgbox.com/64/8d/CdKDqopx_o.png" style="margin-left:;display:block;width:1618px;margin-top:-5.315204%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">通用表空间需要手动创建。创建表时可以指定表数据存储在通用表空间中。</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:2022px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:45.499504%;height:0;"> 
    <img src="https://images2.imgbox.com/97/4a/byivpeJY_o.png" style="margin-left:;display:block;width:2022px;margin-top:-45.499504%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:2928px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:46.243168%;height:0;"> 
    <img src="https://images2.imgbox.com/6a/78/kgddFzML_o.png" style="margin-left:;display:block;width:2928px;margin-top:-46.243168%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="">6.2.3 后台线程</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:2996px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:45.99466%;height:0;"> 
    <img src="https://images2.imgbox.com/10/64/aALW8jZP_o.png" style="margin-left:;display:block;width:2996px;margin-top:-45.99466%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h3 style="">6.3 事务原理</h3> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:1956px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:43.04703%;height:0;"> 
    <img src="https://images2.imgbox.com/b0/37/LVQsf0Ja_o.png" style="margin-left:;display:block;width:1956px;margin-top:-43.04703%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:1686px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:38.671413%;height:0;"> 
    <img src="https://images2.imgbox.com/dd/20/wPncMBPT_o.png" style="margin-left:;display:block;width:1686px;margin-top:-38.671413%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="">6.3.1 redo log</h4> 
 <p style="">事务的持久性由redo log保证。脏页数据刷新到磁盘中发生错误时，redo log可以恢复数据。</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:1996px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:51.002003%;height:0;"> 
    <img src="https://images2.imgbox.com/07/e4/rlzOSknO_o.png" style="margin-left:;display:block;width:1996px;margin-top:-51.002003%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="">6.3.2 undo log</h4> 
 <p style="">事务的原子性由undo log保证。数据库操作失败，事务回滚时，MySQL依赖undo log进行回滚。</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:2010px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:40.099503%;height:0;"> 
    <img src="https://images2.imgbox.com/61/2b/fsuPTvzd_o.png" style="margin-left:;display:block;width:2010px;margin-top:-40.099503%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h3 style="text-align:left;">6.4 MVCC-多版本并发控制</h3> 
 <h4 style="">6.4.1 基本概念</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:2886px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:47.26265%;height:0;"> 
    <img src="https://images2.imgbox.com/1f/93/G9VEwWcz_o.png" style="margin-left:;display:block;width:2886px;margin-top:-47.26265%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="">6.4.2 MVCC实现原理</h4> 
 <h5 style="">6.4.2.1 记录中的隐藏字段</h5> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:1940px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:37.628864%;height:0;"> 
    <img src="https://images2.imgbox.com/04/4f/CMqJm4zk_o.png" style="margin-left:;display:block;width:1940px;margin-top:-37.628864%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h5 style="">6.4.2.2 undo log版本链</h5> 
 <p style="">undo log是回滚日志。</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:3002px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:35.24317%;height:0;"> 
    <img src="https://images2.imgbox.com/7c/cf/UemLhbpG_o.png" style="margin-left:;display:block;width:3002px;margin-top:-35.24317%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h5 style="">6.4.2.3 readview</h5> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:2782px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:37.023724%;height:0;"> 
    <img src="https://images2.imgbox.com/9f/a6/jLsnysWT_o.png" style="margin-left:;display:block;width:2782px;margin-top:-37.023724%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:2864px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:50.139664%;height:0;"> 
    <img src="https://images2.imgbox.com/b2/7f/0eSypNJN_o.png" style="margin-left:;display:block;width:2864px;margin-top:-50.139664%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:2952px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:50.677505%;height:0;"> 
    <img src="https://images2.imgbox.com/1f/64/mTB2Pwss_o.png" style="margin-left:;display:block;width:2952px;margin-top:-50.677505%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:2998px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:34.289524%;height:0;"> 
    <img src="https://images2.imgbox.com/0f/ca/yG25WanB_o.png" style="margin-left:;display:block;width:2998px;margin-top:-34.289524%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">MVCC+锁机制保证了事务的隔离性。</p> 
 <p style="">redo log+undo log共同保证事务的一致性。</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:540px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:51.666668%;height:0;"> 
    <img src="https://images2.imgbox.com/68/2b/a8XDQveI_o.png" style="margin-left:;display:block;width:540px;margin-top:-51.666668%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h2 style="">7 MySQL管理</h2> 
 <h3 style="">7.1 MySQL的系统数据库</h3> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:1988px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:29.778673%;height:0;"> 
    <img src="https://images2.imgbox.com/5e/68/EABpu4VP_o.png" style="margin-left:;display:block;width:1988px;margin-top:-29.778673%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:293px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:128.32764%;height:0;"> 
    <img src="https://images2.imgbox.com/82/67/k8tdUjyT_o.png" style="margin-left:;display:block;width:293px;margin-top:-128.32764%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h3 style="">7.2 MySQL常用工具</h3> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:349px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:86.24642%;height:0;"> 
    <img src="https://images2.imgbox.com/4f/d6/1nSMMM55_o.png" style="margin-left:;display:block;width:349px;margin-top:-86.24642%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="">7.2.1 MySQL客户端工具</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:660px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:35.454548%;height:0;"> 
    <img src="https://images2.imgbox.com/9c/88/9x8YAcwy_o.png" style="margin-left:;display:block;width:660px;margin-top:-35.454548%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="">7.2.2 mysqladmin</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:2424px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:54.455444%;height:0;"> 
    <img src="https://images2.imgbox.com/ea/3f/kPTwJDM2_o.png" style="margin-left:;display:block;width:2424px;margin-top:-54.455444%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="">7.2.3 mysqlbinlog</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:2084px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:38.291744%;height:0;"> 
    <img src="https://images2.imgbox.com/d4/98/XvAeBTIH_o.png" style="margin-left:;display:block;width:2084px;margin-top:-38.291744%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="">7.2.4 mysqlshow</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:1724px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:54.176334%;height:0;"> 
    <img src="https://images2.imgbox.com/27/e6/JkkSbnUg_o.png" style="margin-left:;display:block;width:1724px;margin-top:-54.176334%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:593px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:35.075886%;height:0;"> 
    <img src="https://images2.imgbox.com/29/98/9kWeSdRA_o.png" style="margin-left:;display:block;width:593px;margin-top:-35.075886%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:594px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:47.811447%;height:0;"> 
    <img src="https://images2.imgbox.com/bb/3c/VBpWneoB_o.png" style="margin-left:;display:block;width:594px;margin-top:-47.811447%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:617px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:14.748785%;height:0;"> 
    <img src="https://images2.imgbox.com/99/84/C7Rj1Bo5_o.png" style="margin-left:;display:block;width:617px;margin-top:-14.748785%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="">7.2.5 mysqldump导出/备份数据 </h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:1826px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:48.3023%;height:0;"> 
    <img src="https://images2.imgbox.com/c2/9b/1JN7Jwx1_o.png" style="margin-left:;display:block;width:1826px;margin-top:-48.3023%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="">7.2.6 mysqlimport/source导入数据</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:476px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:61.764706%;height:0;"> 
    <img src="https://images2.imgbox.com/6c/e3/GDR9O4eZ_o.png" style="margin-left:;display:block;width:476px;margin-top:-61.764706%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""></p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f3d061216494adbaa2b81bcc42e40973/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">vue2和vue3中nextTick的底层原理详解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9d98b0ef911e29f7d3963495fe106713/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">C语言--求100-999的水仙花数</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>