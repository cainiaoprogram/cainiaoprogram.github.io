<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>el-table的多选框（默认全选，条件性渲染，动态勾选等功能） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="el-table的多选框（默认全选，条件性渲染，动态勾选等功能）" />
<meta property="og:description" content="前言
最近一直在跟表格里的多选框做斗争，一开始觉得el-table本身的多选框不满足我的需求，想要自定义el-checkbox来实现，结果发现很多坑，还没解决（主要是数据绑定不同步更新的问题），感觉蛮花时间的，又回头看看el-table有没有方法能完善一下，结果成功了，虽然具体实现过程还是很。。。低级，希望可以借鉴这个寻找更好的解决方案，故此记录
页面元素：单选框、输入框、带多选框的表格
需求
针对页面元素说明功能需求如下
表格 带多选框多选框带条件性渲染，满足某条件，多选框不显示多选框默认全选中单选框 根据单选框的切换控制表格多选框是否禁用输入框 显示多选框选中的数量手动输入的数字不能超过表格可选数据的总数量手动输入数字，动态按顺序勾选多选框指定数量的数据 实现
el-table 本身就有多选框的功能
故只要加上&lt;el-table-column type=&#34;selection&#34;/&gt;就可以为表格加上多选框
以下为我的表格代码
&lt;el-table ref=&#34;dataTable&#34; :data=&#34;goodsList&#34; highlight-current-row stripe :fit=&#34;true&#34; type=&#34;index&#34; :cell-class-name=&#34;isRender&#34; @selection-change=&#34;handleGoodsChange&#34;&gt; &lt;el-table-column type=&#34;selection&#34; width=&#34;50&#34; :selectable=&#34;checkSelectable&#34; /&gt; &lt;el-table-column prop=&#34;name&#34; label=&#34;商品名称&#34; sortable /&gt; &lt;el-table-column prop=&#34;code&#34; label=&#34;商品编码&#34; sortable /&gt; &lt;el-table-column prop=&#34;unitprice&#34; sortable label=&#34;单价&#34; /&gt; &lt;el-table-column prop=&#34;num&#34; label=&#34;数量&#34; sortable /&gt; &lt;el-table-column prop=&#34;unit&#34; label=&#34;单位&#34; sortable /&gt; &lt;el-table-column prop=&#34;price&#34; sortable label=&#34;金额&#34; /&gt; &lt;/el-table&gt; 由此带多选框表格有了
控制多选框是否渲染
使用动态class为满足条件的行添加display:none样式隐藏多选框
:cell-class-name=&#34;isRender&#34; //为表格的每一行添加class /** * 条件判断，添加样式 * @param row * @returns classname */ isRender (row) { if (row." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/13e7f1c8066298ba28105a5ce3cbae75/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-05-14T10:17:27+08:00" />
<meta property="article:modified_time" content="2020-05-14T10:17:27+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">el-table的多选框（默认全选，条件性渲染，动态勾选等功能）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>前言</p> 
<p>最近一直在跟表格里的多选框做斗争，一开始觉得el-table本身的多选框不满足我的需求，想要自定义el-checkbox来实现，结果发现很多坑，还没解决（主要是数据绑定不同步更新的问题），感觉蛮花时间的，又回头看看el-table有没有方法能完善一下，结果成功了，虽然具体实现过程还是很。。。低级，希望可以借鉴这个寻找更好的解决方案，故此记录</p> 
<p>页面元素：单选框、输入框、带多选框的表格</p> 
<p>需求</p> 
<p>针对页面元素说明功能需求如下</p> 
<blockquote> 
 <ol><li>表格 
   <ul><li>带多选框</li><li>多选框带条件性渲染，满足某条件，多选框不显示</li><li>多选框默认全选中</li></ul></li><li>单选框 
   <ul><li>根据单选框的切换控制表格多选框是否禁用</li></ul></li><li>输入框 
   <ul><li>显示多选框选中的数量</li><li>手动输入的数字不能超过表格可选数据的总数量</li><li>手动输入数字，动态按顺序勾选多选框指定数量的数据</li></ul></li></ol> 
</blockquote> 
<p>实现</p> 
<p>el-table 本身就有多选框的功能</p> 
<p>故只要加上<code>&lt;el-table-column type="selection"/&gt;</code>就可以为表格加上多选框<br> 以下为我的表格代码</p> 
<pre><code>&lt;el-table ref="dataTable"
          :data="goodsList"
          highlight-current-row
          stripe
          :fit="true"
          type="index"
          :cell-class-name="isRender"
          @selection-change="handleGoodsChange"&gt;
      &lt;el-table-column type="selection"
                       width="50"
                       :selectable="checkSelectable" /&gt;
      &lt;el-table-column prop="name"
                       label="商品名称"
                       sortable /&gt;
      &lt;el-table-column prop="code"
                       label="商品编码"
                       sortable /&gt;
      &lt;el-table-column prop="unitprice"
                       sortable
                       label="单价" /&gt;
      &lt;el-table-column prop="num"
                       label="数量"
                       sortable /&gt;
      &lt;el-table-column prop="unit"
                       label="单位"
                       sortable /&gt;
      &lt;el-table-column prop="price"
                       sortable
                       label="金额" /&gt;
    &lt;/el-table&gt;
</code></pre> 
<p>由此带多选框表格有了</p> 
<p>控制多选框是否渲染</p> 
<p>使用动态class为满足条件的行添加<code>display:none</code>样式隐藏多选框</p> 
<pre><code>:cell-class-name="isRender" //为表格的每一行添加class

/**
     * 条件判断，添加样式
     * @param row
     * @returns classname
 */
isRender (row) {
     if (row.row.status === '1') {
        return 'disabled-column'
     }
}
&lt;style&gt;
 /* 隐藏多选框 */
.disabled-column .el-checkbox__input {
  display: none;
}
&lt;/style&gt;
</code></pre> 
<p>默认多选框全选</p> 
<p>使用<code>toggleAllSelection()</code>切换所有行的选中状态，刚初始化页面的时候即为全选</p> 
<pre><code>mounted () {
    this.$refs.dataTable.toggleAllSelection()
  },
</code></pre> 
<p>单选框和输入框的页面元素代码如下</p> 
<pre><code>&lt;div&gt;
    &lt;div style="float: left;"&gt;
      &lt;el-row&gt;
        &lt;el-radio v-model="selection"
                  label="1"
                  @change="handleSelectionChange"&gt;
          &lt;template&gt;
            勾选商品/勾选前
            &lt;el-input v-model="selectedSize"
                      class="el-input--mini"
                      max="goodsList.length"
                      @input="limitMax()" /&gt;
            &lt;el-button type="primary"
                       size="small"
                       :disabled="selection==='2'"
                       @click="confirmSelect"&gt;确认勾选&lt;/el-button&gt;
          &lt;/template&gt;
        &lt;/el-radio&gt;
      &lt;/el-row&gt;
      &lt;el-row style="float: left;"&gt;
        &lt;el-radio v-model="selection"
                  label="2"
                  @change="handleSelectionChange"&gt;最大限额自动拆分&lt;/el-radio&gt;
      &lt;/el-row&gt;
&lt;/div&gt;
</code></pre> 
<p>单选框切换，多选框禁用</p> 
<p>需要分为两个步骤</p> 
<ol><li>首先多选框全部选中<br> 对表格数据进行遍历，调用<code>toggleRowSelection(row,true)</code>切换行的选中状态为<code>true</code>,并且排除不可选的行数据</li></ol> 
<pre><code> /**
     * 条件判断，多选框全选
     *
 */
 handleSelectionChange () {
      if (this.selection !== '1') {
        for (let i = 0; i &lt; this.goodsList.length; i++) {
          if (this.goodsList[i].status !== '1') {
            this.$refs.dataTable.toggleRowSelection(this.goodsList[i], true)
          }
        }
      }
},
</code></pre> 
<ol><li>多选框全部禁用<br> 多选框使用<code>selectable</code>决定这一行是否可以勾选<br> 注意：不显示多选框的行也要禁用，这样在使用<code>toggleAllSelection()</code>不会选中这些行</li></ol> 
<pre><code>:selectable="checkSelectable"

/**
     * 条件判断，当前行多选框是否禁用
     * @param 列表数据
     * @returns true/不禁用 false/禁用
*/
checkSelectable (row) {
      if (row.status === '1') {  //禁用不可选行
        return false
      }
      if (this.selection === '1') {  //判断单选框值
        return true
      } else {
        return false
      }
},
</code></pre> 
<p>输入框显示表格选中的数量</p> 
<pre><code>watch: {
/**
     * 监控表格选中的数据，更新输入框显示的数值
     *
*/
selectedGoodsList: {
      handler (newval, old) {
        this.selectedSize = newval.length
      }
    }
}
</code></pre> 
<p>输入框限制输入数值的大小</p> 
<p>el-input有max属性，但是有bug，故添加了方法自己判断</p> 
<pre><code>&lt;el-input v-model="selectedSize"
                      class="el-input--mini"
                      max="goodsList.length" //木有用
                      @input="limitMax()" /&gt;
/**
     * 限制输入的最大值
     *
*/
limitMax () {
      const maxSize = this.goodsList.length - this.disablegoodlist.length
      if (this.selectedSize &gt; maxSize) {
        this.selectedSize = maxSize
      }
}
</code></pre> 
<p>手动勾选表格指定数量的数据</p> 
<blockquote> 
 <p>大概思路如下：<br> -使用<code>clearSelection()</code>清空表格勾选状态，<br> -遍历表格数据，如果不是不可选数据，则动态选中，如果是不可选的数据，遍历条件+1，直到循环结束</p> 
</blockquote> 
<pre><code>/**
     * 根据输入框的值动态勾选多选框
     *
*/
confirmSelect () {
      this.$refs.dataTable.clearSelection()
      let count = this.selectedSize
      for (let i = 0; i &lt; count; i++) {
        if (this.goodsList[i].status !== '1') {
          this.$refs.dataTable.toggleRowSelection(this.goodsList[i], true)
        } else {
          count++
        }
      }
}
</code></pre> 
<p>页面展示</p> 
<div> 
 <div> 
  <div>
      
  </div> 
  <div> 
   <img alt="20315386-2d5acbd453cbfd44.png" src="https://images2.imgbox.com/f7/b2/RImeQyDj_o.png"> 
  </div> 
 </div> 
 <div>
   image.png 
 </div> 
</div> 
<p> </p> 
<div> 
 <div> 
  <div>
      
  </div> 
  <div> 
   <img alt="20315386-42155d49c0d49054.png" src="https://images2.imgbox.com/0b/f2/SuHcDWff_o.png"> 
  </div> 
 </div> 
 <div>
   image.png 
 </div> 
</div> 
<p> </p> 
<p> </p> 
<div> 
 <div> 
  <div>
      
  </div> 
  <div> 
   <img alt="20315386-10fbe9fd4e6fe61f.png" src="https://images2.imgbox.com/90/82/QLhaok8d_o.png"> 
  </div> 
 </div> 
 <div>
   image.png 
 </div> 
</div> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b29af1169a282264b52f9b19f19c58c0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">VueTouchKeyboard——一个模拟键盘</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6d188731b7e270584d4842cbcb24aaa8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">filecoin lotus benchmarks v26 GeForce GTX 2080 Ti GeForce GTX 1080 Ti</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>