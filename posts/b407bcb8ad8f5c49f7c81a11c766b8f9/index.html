<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>linux命令行练级攻略 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="linux命令行练级攻略" />
<meta property="og:description" content="基础 学习 Bash 的基础知识。具体来说，输入 man bash 并至少全文浏览一遍; 它很简单并且不长。其他的 shell 可能很好用，但 Bash 功能强大且几乎所有情况下都是可用的 ( 只学习 zsh，fish 或其他的 shell 的话，在你自己的电脑上会显得很方便，但在很多情况下会限制你，比如当你需要在服务器上工作时)。
学习并掌握至少一个基于文本的编辑器。通常 Vim (vi) 会是你最好的选择。
学会如何使用 man 命令去阅读文档。学会使用 apropos 去查找文档。了解有些命令并不对应可执行文件，而是Bash内置的，可以使用 help 和 help -d 命令获取帮助信息。
学会使用 &gt; 和 &lt; 来重定向输出和输入，学会使用 | 来重定向管道。了解标准输出 stdout 和标准错误 stderr。
学会使用通配符 * (或许再算上 ? 和 {…}) 和引用以及引用中 &#39; 和 &#34; 的区别。
熟悉 Bash 任务管理工具: &amp;，ctrl-z，ctrl-c，jobs，fg，bg，kill 等。
了解 ssh，以及基本的无密码认证，ssh-agent，ssh-add 等。
学会基本的文件管理: ls 和 ls -l (了解 ls -l 中每一列代表的意义)，less，head，tail 和 tail -f (甚至less &#43;F)，ln 和 ln -s (了解硬链接与软链接的区别)，chown，chmod，du (硬盘使用情况概述: du -hk *)。 关于文件系统的管理，学习 df，mount，fdisk，mkfs，lsblk。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/b407bcb8ad8f5c49f7c81a11c766b8f9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2015-09-29T15:58:52+08:00" />
<meta property="article:modified_time" content="2015-09-29T15:58:52+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">linux命令行练级攻略</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3 id="基础" style="">基础</h3> 
<ul style=""><li style=""> <p style="">学习 Bash 的基础知识。具体来说，输入 <code style="">man bash</code> 并至少全文浏览一遍; 它很简单并且不长。其他的 shell 可能很好用，但 Bash 功能强大且几乎所有情况下都是可用的 ( <span style="">只</span>学习 zsh，fish 或其他的 shell 的话，在你自己的电脑上会显得很方便，但在很多情况下会限制你，比如当你需要在服务器上工作时)。</p> </li><li style=""> <p style="">学习并掌握至少一个基于文本的编辑器。通常 Vim (<code style="">vi</code>) 会是你最好的选择。</p> </li><li style=""> <p style="">学会如何使用 <code style="">man</code> 命令去阅读文档。学会使用 <code style="">apropos</code> 去查找文档。了解有些命令并不对应可执行文件，而是Bash内置的，可以使用 <code style="">help</code> 和 <code style="">help -d</code> 命令获取帮助信息。</p> </li><li style=""> <p style="">学会使用 <code style="">&gt;</code> 和 <code style="">&lt;</code> 来重定向输出和输入，学会使用 <code style="">|</code> 来重定向管道。了解标准输出 stdout 和标准错误 stderr。</p> </li><li style=""> <p style="">学会使用通配符 <code style="">*</code> (或许再算上 <code style="">?</code> 和 <code style="">{<!-- --></code>…<code style="">}</code>) 和引用以及引用中 <code style="">'</code> 和 <code style="">"</code> 的区别。</p> </li><li style=""> <p style="">熟悉 Bash 任务管理工具: <code style="">&amp;</code>，<span style="">ctrl-z</span>，<span style="">ctrl-c</span>，<code style="">jobs</code>，<code style="">fg</code>，<code style="">bg</code>，<code style="">kill</code> 等。</p> </li><li style=""> <p style="">了解 <code style="">ssh</code>，以及基本的无密码认证，<code style="">ssh-agent</code>，<code style="">ssh-add</code> 等。</p> </li><li style=""> <p style="">学会基本的文件管理: <code style="">ls</code> 和 <code style="">ls -l</code> (了解 <code style="">ls -l</code> 中每一列代表的意义)，<code style="">less</code>，<code style="">head</code>，<code style="">tail</code> 和 <code style="">tail -f</code> (甚至<code style="">less +F</code>)，<code style="">ln</code> 和 <code style="">ln -s</code> (了解硬链接与软链接的区别)，<code style="">chown</code>，<code style="">chmod</code>，<code style="">du</code> (硬盘使用情况概述: <code style="">du -hk *</code>)。 关于文件系统的管理，学习 <code style="">df</code>，<code style="">mount</code>，<code style="">fdisk</code>，<code style="">mkfs</code>，<code style="">lsblk</code>。</p> </li><li style=""> <p style="">学习基本的网络管理: <code style="">ip</code> 或 <code style="">ifconfig</code>，<code style="">dig</code>。</p> </li><li style=""> <p style="">熟悉正则表达式，以及 <code style="">grep</code>/<code style="">egrep</code> 里不同参数的作用，例如 <code style="">-i</code>，<code style="">-o</code>，<code style="">-A</code>，和 <code style="">-B</code>。</p> </li><li style=""> <p style="">学会使用 <code style="">apt-get</code>，<code style="">yum</code>，<code style="">dnf</code> 或 <code style="">pacman</code> (取决于你使用的 Linux 发行版)来查找或安装包。确保你的环境中有 <code style="">pip</code> 来安装基于 Python 的命令行工具 (部分程序使用 <code style="">pip</code> 来安装会很简单)。</p> </li></ul> 
<h3 id="日常使用" style="">日常使用</h3> 
<ul style=""><li style=""> <p style="">在 Bash 中，可以使用 <span style="">Tab</span> 自动补全参数，使用 <span style="">ctrl-r</span> 搜索命令行历史。</p> </li><li style=""> <p style="">在 Bash 中，使用 <span style="">ctrl-w</span> 删除你键入的最后一个单词，使用 <span style="">ctrl-u</span> 删除整行，使用 <span style="">alt-b</span> 和 <span style="">alt-f</span> 按单词移动，使用 <span style="">ctrl-k</span> 从光标处删除到行尾，使用 <span style="">ctrl-l</span> 清屏。键入 <code style="">man readline</code> 查看 Bash 中的默认快捷键，内容很多。例如 <span style="">alt-.</span> 循环地移向前一个参数，以及 <span style="">alt-*</span> 展开通配符。</p> </li><li style=""> <p style="">你喜欢的话，可以键入 <code style="">set -o vi</code> 来使用 vi 风格的快捷键。</p> </li><li style=""> <p style="">键入 <code style="">history</code> 查看命令行历史记录。其中有许多缩写，例如 <code style="">!$</code>(最后键入的参数)和 <code style="">!!</code>(最后键入的命令)，尽管通常被 <span style="">ctrl-r</span>和 <span style="">alt-.</span> 取代。</p> </li><li style=""> <p style="">回到上一个工作路径: <code style="">cd -</code></p> </li><li style=""> <p style="">如果你输入命令的时候改变了主意，按下 <span style="">alt-#</span> 在行首添加 <code style="">#</code>(将你输入的命令视为注释)，并回车。这样做的话，之后你可以很方便的利用命令行历史回到你刚才输入到一半的命令。</p> </li><li style=""> <p style="">使用 <code style="">xargs</code> ( 或 <code style="">parallel</code>)。他们非常给力。注意到你可以控制每行参数个数(<code style="">-L</code>)和最大并行数(<code style="">-P</code>)。如果你不确定它们是否会按你想的那样工作，先使用 <code style="">xargs echo</code> 查看一下。此外，使用 <code style="">-I{}</code> 会很方便。例如:</p> </li></ul> 
<table style=""><tbody style=""><tr style=""><td class="gutter" style=""> <pre style="">     
     <div class="line" style="">
      
      1
     
     </div>
     
     <div class="line" style="">
      
      2
     
     </div></pre> </td><td class="code" style=""> <pre style="">     
     <div class="line" style="">
      
      find . -name 
      
      <span class="string" style="">'*.py'</span> | xargs grep some_function
     
     </div>
     
     <div class="line" style="">
      
      cat hosts | xargs -I{} ssh root@{} hostname
     
     </div></pre> </td></tr></tbody></table> 
<ul style=""><li style=""> <p style=""><code style="">pstree -p</code> 有助于展示进程树。</p> </li><li style=""> <p style="">使用 <code style="">pgrep</code> 和 <code style="">pkill</code> 根据名字查找进程或发送信号。</p> </li><li style=""> <p style="">了解你可以发往进程的信号的种类。比如，使用 <code style="">kill -STOP [pid]</code> 停止一个进程。使用 <code style="">man 7 signal</code> 查看详细列表。</p> </li><li style=""> <p style="">使用 <code style="">nohup</code> 或 <code style="">disown</code> 使一个后台进程持续运行。</p> </li><li style=""> <p style="">使用 <code style="">netstat -lntp</code> 或 <code style="">ss -plat</code> 检查哪些进程在监听端口(默认是检查 TCP 端口; 使用参数 <code style="">-u</code> 检查 UDP 端口)。</p> </li><li style=""> <p style="">有关打开套接字和文件，请参阅 <code style="">lsof</code>。</p> </li><li style=""> <p style="">在 Bash 脚本中，使用 <code style="">set -x</code> 去调试输出，尽可能的使用严格模式，使用 <code style="">set -e</code> 令脚本在发生错误时退出而不是继续运行，使用 <code style="">set -o pipefail</code> 严谨地对待错误(尽管问题可能很微妙)。当牵扯到很多脚本时，使用 <code style="">trap</code>。</p> </li><li style=""> <p style="">在 Bash 脚本中，子 shell(使用括号<code style="">(...)</code>)是一种便捷的方式去组织参数。一个常见的例子是临时地移动工作路径，代码如下：</p> </li></ul> 
<table style=""><tbody style=""><tr style=""><td class="gutter" style=""> <pre style="">     
     <div class="line" style="">
      
      1
     
     </div>
     
     <div class="line" style="">
      
      2
     
     </div>
     
     <div class="line" style="">
      
      3
     
     </div></pre> </td><td class="code" style=""> <pre style="">     
     <div class="line" style="">
      
      <span class="comment" style=""># do something in current dir</span>
     
     </div>
     
     <div class="line" style="">
      
      (
      
      <span class="built_in" style="">cd</span> /some/other/dir &amp;&amp; other-command)
     
     </div>
     
     <div class="line" style="">
      
      <span class="comment" style=""># continue in original dir</span>
     
     </div></pre> </td></tr></tbody></table> 
<ul style=""><li style=""> <p style="">在 Bash 中，注意到其中有许多形式的扩展。检查变量是否存在: <code style="">${name:?error message}</code>。例如，当 Bash 脚本需要一个参数时，可以使用这样的代码 <code style="">input_file=${1:?usage: $0 input_file}</code>。数学表达式: <code style="">i=$(( (i + 1) % 5 ))</code>。序列: <code style="">{1..10}</code>。 截断字符串: <code style="">${var%suffix}</code> 和 <code style="">${var#prefix}</code>。例如，假设 <code style="">var=foo.pdf</code>，那么 <code style="">echo ${var%.pdf}.txt</code> 将输出 <code style="">foo.txt</code>。</p> </li><li style=""> <p style="">通过使用 <code style="">&lt;(some command)</code> 可以将输出视为文件。例如，对比本地文件 <code style="">/etc/hosts</code> 和一个远程文件:</p> </li></ul> 
<table style=""><tbody style=""><tr style=""><td class="gutter" style=""> <pre style="">     
     <div class="line" style="">
      
      1
     
     </div></pre> </td><td class="code" style=""> <pre style="">     
     <div class="line" style="">
      
      diff /etc/hosts &lt;(ssh somehost cat /etc/hosts)
     
     </div></pre> </td></tr></tbody></table> 
<ul style=""><li style=""> <p style="">了解 Bash 中的”here documents”，例如 <code style="">cat &lt;&lt;EOF ...</code>。</p> </li><li style=""> <p style="">在 Bash 中，同时重定向标准输出和标准错误，<code style="">some-command &gt;logfile 2&gt;&amp;1</code>。通常，为了保证命令不会在标准输入里残留一个打开了的文件句柄导致你当前所在的终端无法操作，添加 <code style="">&lt;/dev/null</code> 是一个好习惯。</p> </li><li style=""> <p style="">使用 <code style="">man ascii</code> 查看具有十六进制和十进制值的ASCII表。<code style="">man unicode</code>，<code style="">man utf-8</code>，以及 <code style="">man latin1</code> 有助于你去了解通用的编码信息。</p> </li><li style=""> <p style="">使用 <code style="">screen</code> 或 <a target="_blank" href="https://tmux.github.io/" rel="external noopener noreferrer" style=""><code style="">tmux</code></a> 来使用多个屏幕，当你在使用 ssh 时(保存 session 信息)将尤为有用。另一个轻量级的解决方案是<code style="">dtach</code>。</p> </li><li style=""> <p style="">ssh 中，了解如何使用 <code style="">-L</code> 或 <code style="">-D</code>(偶尔需要用 <code style="">-R</code>)去开启隧道是非常有用的，例如当你需要从一台远程服务器上访问 web。</p> </li><li style=""> <p style="">对 ssh 设置做一些小优化可能是很有用的，例如这个 <code style="">~/.ssh/config</code> 文件包含了防止特定环境下断开连接、压缩数据、多通道等选项：</p> </li></ul> 
<table style=""><tbody style=""><tr style=""><td class="gutter" style=""> <pre style="">     
     <div class="line" style="">
      
      1
     
     </div>
     
     <div class="line" style="">
      
      2
     
     </div>
     
     <div class="line" style="">
      
      3
     
     </div>
     
     <div class="line" style="">
      
      4
     
     </div>
     
     <div class="line" style="">
      
      5
     
     </div>
     
     <div class="line" style="">
      
      6
     
     </div>
     
     <div class="line" style="">
      
      7
     
     </div></pre> </td><td class="code" style=""> <pre style="">     
     <div class="line" style="">
      
      <span class="constant" style="">TCPKeepAlive</span>=yes
     
     </div>
     
     <div class="line" style="">
      
      <span class="constant" style="">ServerAliveInterval</span>=
      
      <span class="number" style="">15</span>
     
     </div>
     
     <div class="line" style="">
      
      <span class="constant" style="">ServerAliveCountMax</span>=
      
      <span class="number" style="">6</span>
     
     </div>
     
     <div class="line" style="">
      
      <span class="constant" style="">Compression</span>=yes
     
     </div>
     
     <div class="line" style="">
      
      <span class="constant" style="">ControlMaster auto</span>
     
     </div>
     
     <div class="line" style="">
      
      ControlPath /tmp/%r@%h:%p
     
     </div>
     
     <div class="line" style="">
      
      ControlPersist yes
     
     </div></pre> </td></tr></tbody></table> 
<ul style=""><li style=""> <p style="">部分其他的关于 ssh 的选项是安全敏感且应当小心启用的。例如在可信任的网络中:<code style="">StrictHostKeyChecking=no</code>，<code style="">ForwardAgent=yes</code></p> </li><li style=""> <p style="">获取文件的八进制格式权限，使用类似如下的代码：</p> </li></ul> 
<table style=""><tbody style=""><tr style=""><td class="gutter" style=""> <pre style="">     
     <div class="line" style="">
      
      1
     
     </div></pre> </td><td class="code" style=""> <pre style="">     
     <div class="line" style="">
      
      stat -c 
      
      <span class="string" style="">'%A %a %n'</span> /etc/timezone
     
     </div></pre> </td></tr></tbody></table> 
<ul style=""><li style=""> <p style="">使用 <a target="_blank" href="https://github.com/mooz/percol" rel="external noopener noreferrer" style=""><code style="">percol</code></a> 可以交互式地从另一个命令输出中选取值。</p> </li><li style=""> <p style="">使用 <code style="">fpp</code>(<a target="_blank" href="https://github.com/facebook/PathPicker" rel="external noopener noreferrer" style="">PathPicker</a>)可以与基于另一个命令(例如 <code style="">git</code>)输出的文件交互。</p> </li><li style=""> <p style="">将 web 服务器上当前目录下所有的文件(以及子目录)暴露给你所处网络的所有用户，使用：<br style=""> <code style="">python -m SimpleHTTPServer 7777</code> (使用端口 7777 和 Python 2)或<code style="">python -m http.server 7777</code> (使用端口 7777 和 Python 3)。</p> </li></ul> 
<h3 id="文件及数据处理" style="">文件及数据处理</h3> 
<ul style=""><li style=""> <p style="">在当前路径下通过文件名定位一个文件，<code style="">find . -iname '*something*'</code>(或类似的)。在所有路径下通过文件名查找文件，使用<code style="">locate something</code> (但请记住 <code style="">updatedb</code> 可能没有对最近新建的文件建立索引)。</p> </li><li style=""> <p style="">使用 <a target="_blank" href="https://github.com/ggreer/the_silver_searcher" rel="external noopener noreferrer" style=""><code style="">ag</code></a> 在源代码或数据文件里检索(比 <code style="">grep -r</code> 更好)。</p> </li><li style=""> <p style="">将HTML转为文本: <code style="">lynx -dump -stdin</code></p> </li><li style=""> <p style="">Markdown，HTML，以及所有文档格式之间的转换，试试 <a target="_blank" href="http://pandoc.org/" rel="external noopener noreferrer" style=""><code style="">pandoc</code></a>。</p> </li><li style=""> <p style="">如果你不得不处理 XML，<code style="">xmlstarlet</code> 宝刀未老。</p> </li><li style=""> <p style="">使用 <code style="">jq</code> 处理 JSON。</p> </li><li style=""> <p style="">Excel 或 CSV 文件的处理，<a target="_blank" href="https://github.com/onyxfish/csvkit" rel="external noopener noreferrer" style="">csvkit</a> 提供了 <code style="">in2csv</code>，<code style="">csvcut</code>，<code style="">csvjoin</code>，<code style="">csvgrep</code> 等工具。</p> </li><li style=""> <p style="">关于 Amazon S3，<a target="_blank" href="https://github.com/s3tools/s3cmd" rel="external noopener noreferrer" style=""><code style="">s3cmd</code></a> 很方便而 <a target="_blank" href="https://github.com/bloomreach/s4cmd" rel="external noopener noreferrer" style=""><code style="">s4cmd</code></a> 更快。Amazon 官方的 <a target="_blank" href="https://github.com/aws/aws-cli" rel="external noopener noreferrer" style=""><code style="">aws</code></a> 是其他 AWS 相关工作的基础。</p> </li><li style=""> <p style="">了解如何使用 <code style="">sort</code> 和 <code style="">uniq</code>，包括 uniq 的 <code style="">-u</code> 参数和 <code style="">-d</code> 参数，详见后文一行代码节。另外可以了解一下 <code style="">comm</code>。</p> </li><li style=""> <p style="">了解如何使用 <code style="">cut</code>，<code style="">paste</code> 和 <code style="">join</code> 来更改文件。很多人都会使用 <code style="">cut</code>，但几乎都不会使用 <code style="">join</code>。</p> </li><li style=""> <p style="">了解如何运用 <code style="">wc</code> 去计算新行数(<code style="">-l</code>)，字符数(<code style="">-m</code>)，单词数(<code style="">-w</code>)以及字节数(<code style="">-c</code>)。</p> </li><li style=""> <p style="">了解如何使用 <code style="">tee</code> 将标准输入复制到文件甚至标准输出，例如 <code style="">ls -al | tee file.txt</code>。</p> </li><li style=""> <p style="">了解语言环境对许多命令行工具的微妙影响，包括排序的顺序和性能。大多数 Linux 的安装过程会将 <code style="">LANG</code> 或其他有关的变量设置为符合本地的设置。意识到当你改变语言环境时，排序的结果可能会改变。明白国际化可能会时 sort 或其他命令运行效率下降<span style="">许多倍</span>。某些情况下(例如集合运算)你可以放心的使用 <code style="">export LC_ALL=C</code> 来忽略掉国际化并使用基于字节的顺序。</p> </li><li style=""> <p style="">了解 <code style="">awk</code> 和 <code style="">sed</code> 关于数据的简单处理的用法。例如，将文本文件中第三列的所有数字求和:<code style="">awk '{ x += $3 } END { print x }'</code>. 这可能比同等作用的 Python 代码块三倍且代码量少三倍。</p> </li><li style=""> <p style="">替换一个或多个文件中出现的字符串:</p> </li></ul> 
<table style=""><tbody style=""><tr style=""><td class="gutter" style=""> <pre style="">     
     <div class="line" style="">
      
      1
     
     </div></pre> </td><td class="code" style=""> <pre style="">     
     <div class="line" style="">
      
      perl -pi.bak 
      
      <span class="operator" style="">-e</span> 
      
      <span class="string" style="">'s/old-string/new-string/g'</span> my-files-*.txt
     
     </div></pre> </td></tr></tbody></table> 
<ul style=""><li style="">依据某种模式批量重命名多个文件，使用 <code style="">rename</code>。对于复杂的重命名规则，<a target="_blank" href="https://github.com/jlevy/repren" rel="external noopener noreferrer" style="">repren</a> 或许有帮助。</li></ul> 
<table style=""><tbody style=""><tr style=""><td class="gutter" style=""> <pre style="">     
     <div class="line" style="">
      
      1
     
     </div>
     
     <div class="line" style="">
      
      2
     
     </div>
     
     <div class="line" style="">
      
      3
     
     </div>
     
     <div class="line" style="">
      
      4
     
     </div></pre> </td><td class="code" style=""> <pre style="">     
     <div class="line" style="">
      
      <span class="comment" style=""># Recover backup files foo.bak -&gt; foo:</span>
     
     </div>
     
     <div class="line" style="">
      
      rename 
      
      <span class="string" style="">'s/\.bak$//'</span> *.bak
     
     </div>
     
     <div class="line" style="">
      
      <span class="comment" style=""># Full rename of filenames，directories，and contents foo -&gt; bar:</span>
     
     </div>
     
     <div class="line" style="">
      
      repren --full --preserve-case --from foo --to bar .
     
     </div></pre> </td></tr></tbody></table> 
<ul style=""><li style=""> <p style="">使用 <code style="">shuf</code> 从一个文件中随机选取行。</p> </li><li style=""> <p style="">了解 <code style="">sort</code> 的参数。明白键的工作原理(<code style="">-t</code> 和 <code style="">-k</code>)。例如，注意到你需要 <code style="">-k1，1</code> 来仅按第一个域来排序，而 <code style="">-k1</code> 意味着按整行排序。稳定排序(<code style="">sort -s</code>)在某些情况下很有用。例如，以第二个域为主关键字，第一个域为次关键字进行排序，你可以使用 <code style="">sort -k1，1 | sort -s -k2，2</code>。处理可读性数字（例如 <code style="">du -h</code> 的输出）的时候使用 <code style="">sort -h</code> 。</p> </li><li style=""> <p style="">如果你想在 Bash 命令行中写 tab 制表符，按下 <span style="">ctrl-v [Tab]</span> 或键入 <code style="">$'\t'</code> (后者可能更好，因为你可以复制粘贴它)。</p> </li><li style=""> <p style="">标准的源代码对比及合并工具是 <code style="">diff</code> 和 <code style="">patch</code>。使用 <code style="">diffstat</code> 查看变更总览数据。注意到 <code style="">diff -r</code> 对整个文件夹有效。使用 <code style="">diff -r tree1 tree2 | diffstat</code> 查看变更总览数据。</p> </li><li style=""> <p style="">对于二进制文件，使用 <code style="">hd</code> 使其以十六进制显示以及使用 <code style="">bvi</code> 来编辑二进制。</p> </li><li style=""> <p style="">同样对于二进制文件，使用 <code style="">strings</code>(包括 <code style="">grep</code> 等等)允许你查找一些文本。</p> </li><li style=""> <p style="">二进制文件对比(Delta 压缩)，使用 <code style="">xdelta3</code>。</p> </li><li style=""> <p style="">使用 <code style="">iconv</code> 更改文本编码。而更高级的用法，可以使用 <code style="">uconv</code>，它支持一些高级的 Unicode 功能。例如，这条命令将所有元音字母转为小写并移除了:</p> </li></ul> 
<table style=""><tbody style=""><tr style=""><td class="gutter" style=""> <pre style="">     
     <div class="line" style="">
      
      1
     
     </div></pre> </td><td class="code" style=""> <pre style="">     
     <div class="line" style="">
      
      uconv 
      
      <span class="operator" style="">-f</span> utf-
      
      <span class="number" style="">8</span> -t utf-
      
      <span class="number" style="">8</span> -x 
      
      <span class="string" style="">'::Any-Lower; ::Any-NFD; [:Nonspacing Mark:] &gt;; ::Any-NFC; '</span> &lt; input.txt &gt; output.txt
     
     </div></pre> </td></tr></tbody></table> 
<ul style=""><li style=""> <p style="">拆分文件，查看 <code style="">split</code>(按大小拆分)和 <code style="">csplit</code>(按模式拆分)。</p> </li><li style=""> <p style="">使用 <code style="">zless</code>，<code style="">zmore</code>，<code style="">zcat</code> 和 <code style="">zgrep</code>对压缩过的文件进行操作。</p> </li></ul> 
<h3 id="系统调试" style="">系统调试</h3> 
<ul style=""><li style=""> <p style=""><code style="">curl</code> 和 <code style="">curl -I</code> 可以便捷地被应用于 web 调试中，它们的好兄弟 <code style="">wget</code> 也可以，或者是更潮的 <a target="_blank" href="https://github.com/jakubroztocil/httpie" rel="external noopener noreferrer" style=""><code style="">httpie</code></a>。</p> </li><li style=""> <p style="">使用 <code style="">iostat</code>、<code style="">netstat</code>、<code style="">top</code> (<code style="">htop</code> 更佳)和 <code style="">dstat</code> 去获取硬盘、cpu 和网络的状态。熟练掌握这些工具可以使你快速的对系统的当前状态有一个大概的认识。</p> </li><li style=""> <p style="">若要对系统有一个深度的总体认识，使用 <a target="_blank" href="https://github.com/nicolargo/glances" rel="external noopener noreferrer" style=""><code style="">glances</code></a>。它在一个终端窗口中向你提供一些系统级的数据。这对于快速的检查各个子系统非常有帮助。</p> </li><li style=""> <p style="">若要了解内存状态，运行并理解 <code style="">free</code> 和 <code style="">vmstat</code> 的输出。尤其注意”cached”的值，它指的是 Linux 内核用来作为文件缓存的内存大小，因此它与空闲内存无关。</p> </li><li style=""> <p style="">Java 系统调试则是一件截然不同的事，一个可以用于 Oracle 的 JVM 或其他 JVM 上的调试的小技巧是你可以运行<code style="">kill -3 &lt;pid&gt;</code> 同时一个完整的栈轨迹和堆概述(包括 GC 的细节)会被保存到标准输出/日志文件。</p> </li><li style=""> <p style="">使用 <code style="">mtr</code> 去跟踪路由，用于确定网络问题。</p> </li><li style=""> <p style="">用 <code style="">ncdu</code> 来查看磁盘使用情况，它比常用的命令，如 <code style="">du -sh *</code>，更节省时间。</p> </li><li style=""> <p style="">查找正在使用带宽的套接字连接或进程，使用 <code style="">iftop</code> 或 <code style="">nethogs</code>。</p> </li><li style=""> <p style=""><code style="">ab</code> 工具(捆绑于 Apache)可以简单粗暴地检查 web 服务器的性能。对于更复杂的负载测试，使用 <code style="">siege</code>。</p> </li><li style=""> <p style=""><code style="">wireshark</code>，<code style="">tshark</code> 和 <code style="">ngrep</code> 可用于复杂的网络调试。</p> </li><li style=""> <p style="">了解 <code style="">strace</code> 和 <code style="">ltrace</code>。这俩工具在你的程序运行失败、挂起甚至崩溃，而你却不知道为什么或你想对性能有个总体的认识的时候是非常有用的。注意 profile 参数(<code style="">-c</code>)和附加到一个运行的进程参数 (<code style="">-p</code>)。</p> </li><li style=""> <p style="">了解使用 <code style="">ldd</code> 来检查共享库。</p> </li><li style=""> <p style="">了解如何运用 <code style="">gdb</code> 连接到一个运行着的进程并获取它的堆栈轨迹。</p> </li><li style=""> <p style="">学会使用 <code style="">/proc</code>。它在调试正在出现的问题的时候有时会效果惊人。比如:<code style="">/proc/cpuinfo</code>，<code style="">/proc/xxx/cwd</code>，<code style="">/proc/xxx/exe</code>，<code style="">/proc/xxx/fd/</code>，<code style="">/proc/xxx/smaps</code>。</p> </li><li style=""> <p style="">当调试一些之前出现的问题的时候，<code style="">sar</code> 非常有用。它展示了 cpu、内存以及网络等的历史数据。</p> </li><li style=""> <p style="">关于更深层次的系统分析以及性能分析，看看 <code style="">stap</code>(<a target="_blank" href="https://sourceware.org/systemtap/wiki" rel="external noopener noreferrer" style="">SystemTap</a>)，<a target="_blank" href="http://en.wikipedia.org/wiki/Perf_%28Linux" rel="external noopener noreferrer" style=""><code style="">perf</code></a>)，以及<a target="_blank" href="https://github.com/draios/sysdig" rel="external noopener noreferrer" style=""><code style="">sysdig</code></a>。</p> </li><li style=""> <p style="">查看你当前使用的 Linux 发行版(大部分发行版有效): <code style="">lsb_release -a</code></p> </li><li style=""> <p style="">无论什么东西工作得很欢乐时试试 <code style="">dmesg</code> (可能是硬件或驱动问题)。</p> </li></ul> 
<h3 id="一行代码" style="">一行代码</h3> 
<p style="">一些命令组合的例子:</p> 
<ul style=""><li style="">当你需要对文本文件做集合交、并、差运算时，结合使用 <code style="">sort</code>/<code style="">uniq</code> 很有帮助。假设 <code style="">a</code> 与 <code style="">b</code> 是两内容不同的文件。这种方式效率很高，并且在小文件和上G的文件上都能运用 (<code style="">sort</code> 不被内存大小约束，尽管在 <code style="">/tmp</code> 在一个小的根分区上时你可能需要 <code style="">-T</code> 参数)，参阅前文中关于 <code style="">LC_ALL</code> 和 <code style="">sort</code> 的 <code style="">-u</code> 参数的部分。</li></ul> 
<table style=""><tbody style=""><tr style=""><td class="gutter" style=""> <pre style="">     
     <div class="line" style="">
      
      1
     
     </div>
     
     <div class="line" style="">
      
      2
     
     </div>
     
     <div class="line" style="">
      
      3
     
     </div></pre> </td><td class="code" style=""> <pre style="">     
     <div class="line" style="">
      
      cat a b | sort | uniq &gt; c   
      
      <span class="comment" style=""># c is a union b</span>
     
     </div>
     
     <div class="line" style="">
      
      cat a b | sort | uniq 
      
      <span class="operator" style="">-d</span> &gt; c   
      
      <span class="comment" style=""># c is a intersect b</span>
     
     </div>
     
     <div class="line" style="">
      
      cat a b b | sort | uniq -u &gt; c   
      
      <span class="comment" style=""># c is set difference a - b</span>
     
     </div></pre> </td></tr></tbody></table> 
<ul style=""><li style=""> <p style="">使用 <code style="">grep . *</code> 来阅读检查目录下所有文件的内容，例如检查一个充满配置文件的目录比如 <code style="">/sys</code>、<code style="">/proc</code>、<code style="">/etc</code>。</p> </li><li style=""> <p style="">计算文本文件第三列中所有数的和(可能比同等作用的 Python 代码快三倍且代码量少三倍):</p> </li></ul> 
<table style=""><tbody style=""><tr style=""><td class="gutter" style=""> <pre style="">     
     <div class="line" style="">
      
      1
     
     </div></pre> </td><td class="code" style=""> <pre style="">     
     <div class="line" style="">
      
      awk 
      
      <span class="string" style="">'{ x += $3 } END { print x }'</span> myfile
     
     </div></pre> </td></tr></tbody></table> 
<ul style=""><li style="">如果你想在文件树上查看大小\日期，这可能看起来像递归版的 <code style="">ls -l</code> 但比 <code style="">ls -lR</code> 更易于理解:</li></ul> 
<table style=""><tbody style=""><tr style=""><td class="gutter" style=""> <pre style="">     
     <div class="line" style="">
      
      1
     
     </div></pre> </td><td class="code" style=""> <pre style="">     
     <div class="line" style="">
      
      find . -type f -ls
     
     </div></pre> </td></tr></tbody></table> 
<ul style=""><li style="">尽可能的使用 <code style="">xargs</code> 或 <code style="">parallel</code>。注意到你可以控制每行参数个数(<code style="">-L</code>)和最大并行数(<code style="">-P</code>)。如果你不确定它们是否会按你想的那样工作，先使用 <code style="">xargs echo</code> 查看一下。此外，使用 <code style="">-I{}</code> 会很方便。例如:</li></ul> 
<table style=""><tbody style=""><tr style=""><td class="gutter" style=""> <pre style="">     
     <div class="line" style="">
      
      1
     
     </div>
     
     <div class="line" style="">
      
      2
     
     </div></pre> </td><td class="code" style=""> <pre style="">     
     <div class="line" style="">
      
      find . -name 
      
      <span class="string" style="">'*.py'</span> | xargs grep some_function
     
     </div>
     
     <div class="line" style="">
      
      cat hosts | xargs -I{} ssh root@{} hostname
     
     </div></pre> </td></tr></tbody></table> 
<ul style=""><li style="">假设你有一个类似于 web 服务器日志文件的文本文件，并且一个确定的值只会出现在某些行上，假设一个 <code style="">acct_id</code> 参数在URI中。如果你想计算出每个 <code style="">acct_id</code> 值有多少次请求，使用如下代码:</li></ul> 
<table style=""><tbody style=""><tr style=""><td class="gutter" style=""> <pre style="">     
     <div class="line" style="">
      
      1
     
     </div></pre> </td><td class="code" style=""> <pre style="">     
     <div class="line" style="">
      
      cat access.log | egrep -o 
      
      <span class="string" style="">'acct_id=[0-9]+'</span> | cut 
      
      <span class="operator" style="">-d</span>= 
      
      <span class="operator" style="">-f</span>2 | sort | uniq -c | sort -rn
     
     </div></pre> </td></tr></tbody></table> 
<ul style=""><li style="">运行这个函数从这篇文档中随机获取一条小技巧(解析 Markdown 文件并抽取项目):</li></ul> 
<table style=""><tbody style=""><tr style=""><td class="gutter" style=""> <pre style="">     
     <div class="line" style="">
      
      1
     
     </div>
     
     <div class="line" style="">
      
      2
     
     </div>
     
     <div class="line" style="">
      
      3
     
     </div>
     
     <div class="line" style="">
      
      4
     
     </div>
     
     <div class="line" style="">
      
      5
     
     </div>
     
     <div class="line" style="">
      
      6
     
     </div>
     
     <div class="line" style="">
      
      7
     
     </div></pre> </td><td class="code" style=""> <pre style="">     
     <div class="line" style="">
      
      function 
      
      <span class="function" style=""><span class="title" style="">taocl</span></span>() {
     
     </div>
     
     <div class="line" style="">
      
        curl 
      
      <span class="operator" style="">-s</span> https://raw.githubusercontent.com/jlevy/the-art-of-command-line/master/README.md |
     
     </div>
     
     <div class="line" style="">
      
          pandoc 
      
      <span class="operator" style="">-f</span> markdown -t html |
     
     </div>
     
     <div class="line" style="">
      
          xmlstarlet fo --html --dropdtd |
     
     </div>
     
     <div class="line" style="">
      
          xmlstarlet sel -t -v 
      
      <span class="string" style="">"(html/body/ul/li[count(p)&gt;0])[<span class="variable" style="">$RANDOM</span> mod last()+1]"</span> |
     
     </div>
     
     <div class="line" style="">
      
          xmlstarlet unesc | fmt -
      
      <span class="number" style="">80</span>
     
     </div>
     
     <div class="line" style="">
      
      }
     
     </div></pre> </td></tr></tbody></table> 
<h3 id="冷门但有用" style="">冷门但有用</h3> 
<ul style=""><li style=""> <p style=""><code style="">expr</code>: 计算表达式或正则匹配</p> </li><li style=""> <p style=""><code style="">m4</code>: 简单地宏处理器</p> </li><li style=""> <p style=""><code style="">yes</code>: 多次打印字符串</p> </li><li style=""> <p style=""><code style="">cal</code>: 漂亮的日历</p> </li><li style=""> <p style=""><code style="">env</code>: 执行一个命令(脚本文件中很有用)</p> </li><li style=""> <p style=""><code style="">printenv</code>: 打印环境变量(调试时或在使用脚本文件时很有用)</p> </li><li style=""> <p style=""><code style="">look</code>: 查找以特定字符串开头的单词</p> </li><li style=""> <p style=""><code style="">cut</code>、<code style="">paste</code> 和 <code style="">join</code>: 数据修改</p> </li><li style=""> <p style=""><code style="">fmt</code>: 格式化文本段落</p> </li><li style=""> <p style=""><code style="">pr</code>: 将文本格式化成页/列形式</p> </li><li style=""> <p style=""><code style="">fold</code>: 包裹文本中的几行</p> </li><li style=""> <p style=""><code style="">column</code>: 将文本格式化成多列或表格</p> </li><li style=""> <p style=""><code style="">expand</code> 和 <code style="">unexpand</code>: 制表符与空格之间转换</p> </li><li style=""> <p style=""><code style="">nl</code>: 添加行号</p> </li><li style=""> <p style=""><code style="">seq</code>: 打印数字</p> </li><li style=""> <p style=""><code style="">bc</code>: 计算器</p> </li><li style=""> <p style=""><code style="">factor</code>: 分解因数</p> </li><li style=""> <p style=""><code style="">gpg</code>: 加密并签名文件</p> </li><li style=""> <p style=""><code style="">toe</code>: terminfo entries 列表</p> </li><li style=""> <p style=""><code style="">nc</code>: 网络调试及数据传输</p> </li><li style=""> <p style=""><code style="">socat</code>: 套接字代理，与 <code style="">netcat</code> 类似</p> </li><li style=""> <p style=""><code style="">slurm</code>: 网络可视化</p> </li><li style=""> <p style=""><code style="">dd</code>: 文件或设备间传输数据</p> </li><li style=""> <p style=""><code style="">file</code>: 确定文件类型</p> </li><li style=""> <p style=""><code style="">tree</code>: 以树的形式显示路径和文件，类似于递归的 <code style="">ls</code></p> </li><li style=""> <p style=""><code style="">stat</code>: 文件信息</p> </li><li style=""> <p style=""><code style="">tac</code>: 反向输出文件</p> </li><li style=""> <p style=""><code style="">shuf</code>: 文件中随机选取几行</p> </li><li style=""> <p style=""><code style="">comm</code>: 一行一行的比较排序过的文件</p> </li><li style=""> <p style=""><code style="">pv</code>: 监视通过管道的数据</p> </li><li style=""> <p style=""><code style="">hd</code> 和 <code style="">bvi</code>: 保存或编辑二进制文件</p> </li><li style=""> <p style=""><code style="">strings</code>: 从二进制文件中抽取文本</p> </li><li style=""> <p style=""><code style="">tr</code>: 转换字母</p> </li><li style=""> <p style=""><code style="">iconv</code> 或 <code style="">uconv</code>: 简易的文件编码</p> </li><li style=""> <p style=""><code style="">split</code> 和 <code style="">csplit</code>: 分割文件</p> </li><li style=""> <p style=""><code style="">units</code>: 将一种计量单位转换为另一种等效的计量单位(参阅 <code style="">/usr/share/units/definitions.units</code>)</p> </li><li style=""> <p style=""><code style="">7z</code>: 高比例的文件压缩</p> </li><li style=""> <p style=""><code style="">ldd</code>: 动态库信息</p> </li><li style=""> <p style=""><code style="">nm</code>: 提取 obj 文件中的符号</p> </li><li style=""> <p style=""><code style="">ab</code>: 性能分析 web 服务器</p> </li><li style=""> <p style=""><code style="">strace</code>: 系统调用调试</p> </li><li style=""> <p style=""><code style="">mtr</code>: 更好的网络调试跟踪工具</p> </li><li style=""> <p style=""><code style="">cssh</code>: 可视化的并发 shell</p> </li><li style=""> <p style=""><code style="">rsync</code>: 通过 ssh 同步文件和文件夹</p> </li><li style=""> <p style=""><code style="">wireshark</code> 和 <code style="">tshark</code>: 抓包和网络调试工具</p> </li><li style=""> <p style=""><code style="">ngrep</code>: 网络层的 grep</p> </li><li style=""> <p style=""><code style="">host</code> 和 <code style="">dig</code>: DNS 查找</p> </li><li style=""> <p style=""><code style="">lsof</code>: 列出当前系统打开文件的工具以及查看端口信息</p> </li><li style=""> <p style=""><code style="">dstat</code>: 系统状态查看</p> </li><li style=""> <p style=""><a target="_blank" href="https://github.com/nicolargo/glances" rel="external noopener noreferrer" style=""><code style="">glances</code></a>: 高层次的多子系统总览</p> </li><li style=""> <p style=""><code style="">iostat</code>: CPU 和硬盘状态</p> </li><li style=""> <p style=""><code style="">htop</code>: top 的加强版</p> </li><li style=""> <p style=""><code style="">last</code>: 登入记录</p> </li><li style=""> <p style=""><code style="">w</code>: 查看处于登录状态的用户</p> </li><li style=""> <p style=""><code style="">id</code>: 用户/组 ID 信息</p> </li><li style=""> <p style=""><code style="">sar</code>: 系统历史数据</p> </li><li style=""> <p style=""><code style="">iftop</code> 或 <code style="">nethogs</code>: 套接字及进程的网络利用</p> </li><li style=""> <p style=""><code style="">ss</code>: 套接字数据</p> </li><li style=""> <p style=""><code style="">dmesg</code>: 引导及系统错误信息</p> </li><li style=""> <p style=""><code style="">hdparm</code>: SATA/ATA 磁盘更改及性能分析</p> </li><li style=""> <p style=""><code style="">lsb_release</code>: Linux 发行版信息</p> </li><li style=""> <p style=""><code style="">lsblk</code>: 列出块设备信息: 以树形展示你的磁盘以及磁盘分区信息</p> </li><li style=""> <p style=""><code style="">lshw</code>，<code style="">lscpu</code>，<code style="">lspci</code>，<code style="">lsusb</code> 和 <code style="">dmidecode</code>: 查看硬件信息，包括 CPU、BIOS、RAID、显卡、USB设备等</p> </li><li style=""> <p style=""><code style="">fortune</code>，<code style="">ddate</code> 和 <code style="">sl</code>: 额，这主要取决于你是否认为蒸汽火车和莫名其妙的名人名言是否”有用”</p> </li></ul> 
<h3 id="更多资源" style="">更多资源</h3> 
<ul style=""><li style=""><a target="_blank" href="https://github.com/alebcay/awesome-shell" rel="external noopener noreferrer" style="">awesome-shell</a>: 一份精心组织的命令行工具及资源的列表。</li><li style=""><a target="_blank" href="http://redsymbol.net/articles/unofficial-bash-strict-mode/" rel="external noopener noreferrer" style="">Strict mode</a>： 为了编写更好的脚本文件。</li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d808cf07cbf2e6186f5db14ddc64d73d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Matlab - jacobian函数</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/bd18fa9f1047afc458b296a7b4d07ea6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Redis: 为行情数据库设计键值</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>