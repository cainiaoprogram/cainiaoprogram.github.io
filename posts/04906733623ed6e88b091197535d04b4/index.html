<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>简单三步，用 Python 发邮件 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="简单三步，用 Python 发邮件" />
<meta property="og:description" content="0. 前言 发送电子邮件是个很常见的开发需求。比如你写了个监控天气的脚本，发现第二天要下雨，或者网站上关注的某个商品降价了，就可以发个邮件到邮箱来提醒自己。
使用 Python 脚本发送邮件并不复杂。不过由于各家邮件的发送机制和安全策略不同，常常会因为一些配置问题造成发送失败。今天我们来举例讲讲如何使用 Python 发送邮件。
本文主要内容包括，了解发邮件的思路，发送邮件需要的一些设置，发送一封简单的邮件，发送一封包含附件的邮件，在写代码过程中我们需要注意哪些问题等等。（完整参考代码地址见文末）
1. 思路 使用脚本发送邮件的思路其实和客户端发送邮件一样，过程都是：
登录 —&gt; 写邮件 —&gt; 发送
只不过通过脚本发送时我们需要考虑到整个过程的方方面面。以下为思路导图：
2. Python-email 模块 与发送邮件相关的 Python 模块：
smtplib
是关于 SMTP（简单邮件传输协议）的操作模块，在发送邮件的过程中起到服务器之间互相通信的作用。
email
简单来说，即服务器之间通信的信息，包括信息头、信息主体等等。
举个简单的例子，当你登录邮箱，写好邮件后点击发送，这部分是由 SMTP 接管；而写邮件、添加附件是由 email 模块控制。
3. 开通电子邮箱的SMTP功能 在使用脚本发邮件之前，我们需要打开自己邮箱的 SMTP 功能，各家邮箱的设置方法就不一一讲述了，具体使用时可以百度一下，下面以 163 邮箱设置为例做一个简单的演示：
4. 简单代码 实践出真知，我们结合一个简单的代码来理解这一过程：登录 163 邮箱，向 qq 邮箱发送邮件。
脚本分为三个步骤：
设置好服务器端信息邮件主体信息登录发送 另外在处理文本时，我们需要使用 MIMEText 类。
import smtplib from email.mime.text import MIMEText #设置服务器所需信息 #163邮箱服务器地址 mail_host = &#39;smtp.163.com&#39; #163用户名 mail_user = &#39;159*****02&#39; #密码(部分邮箱为授权码) mail_pass = &#39;7******x&#39; #邮件发送方邮箱地址 sender = &#39;159*****02@163." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/04906733623ed6e88b091197535d04b4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-05T19:10:02+08:00" />
<meta property="article:modified_time" content="2024-01-05T19:10:02+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">简单三步，用 Python 发邮件</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="0__0"></a>0. 前言</h3> 
<p>发送电子邮件是个很常见的开发需求。比如你写了个监控天气的脚本，发现第二天要下雨，或者网站上关注的某个商品降价了，就可以发个邮件到邮箱来提醒自己。</p> 
<p>使用 Python 脚本发送邮件并不复杂。不过由于各家邮件的发送机制和安全策略不同，常常会因为一些配置问题造成发送失败。今天我们来举例讲讲如何使用 Python 发送邮件。</p> 
<p>本文主要内容包括，了解发邮件的思路，发送邮件需要的一些设置，发送一封简单的邮件，发送一封包含附件的邮件，在写代码过程中我们需要注意哪些问题等等。（完整参考代码地址见文末）</p> 
<h3><a id="1__6"></a>1. 思路</h3> 
<p>使用脚本发送邮件的思路其实和客户端发送邮件一样，过程都是：</p> 
<p><strong>登录 —&gt; 写邮件 —&gt; 发送</strong></p> 
<p>只不过通过脚本发送时我们需要考虑到整个过程的方方面面。以下为思路导图：<br> <img src="https://images2.imgbox.com/92/2c/2W8Oede7_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2_Pythonemail__13"></a>2. Python-email 模块</h3> 
<p>与发送邮件相关的 Python 模块：</p> 
<p><strong>smtplib</strong></p> 
<p>是关于 SMTP（简单邮件传输协议）的操作模块，在发送邮件的过程中起到服务器之间互相通信的作用。</p> 
<p><strong>email</strong></p> 
<p>简单来说，即服务器之间通信的信息，包括信息头、信息主体等等。</p> 
<p>举个简单的例子，当你登录邮箱，写好邮件后点击发送，这部分是由 SMTP 接管；而写邮件、添加附件是由 email 模块控制。</p> 
<h3><a id="3_SMTP_25"></a>3. 开通电子邮箱的SMTP功能</h3> 
<p>在使用脚本发邮件之前，我们需要打开自己邮箱的 SMTP 功能，各家邮箱的设置方法就不一一讲述了，具体使用时可以百度一下，下面以 163 邮箱设置为例做一个简单的演示：<br> <img src="https://images2.imgbox.com/ed/8b/fHktPYLn_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="4__28"></a>4. 简单代码</h3> 
<p>实践出真知，我们结合一个简单的代码来理解这一过程：登录 163 邮箱，向 qq 邮箱发送邮件。</p> 
<p>脚本分为三个步骤：</p> 
<ol><li>设置好服务器端信息</li><li>邮件主体信息</li><li>登录发送</li></ol> 
<p>另外在处理文本时，我们需要使用 MIMEText 类。</p> 
<pre><code class="prism language-cpp"><span class="token keyword">import</span> <span class="token module">smtplib</span>
from email<span class="token punctuation">.</span>mime<span class="token punctuation">.</span>text <span class="token keyword">import</span> <span class="token module">MIMEText</span>
#设置服务器所需信息
#<span class="token number">163</span>邮箱服务器地址
mail_host <span class="token operator">=</span> <span class="token char">'smtp.163.com'</span>  
#<span class="token number">163</span>用户名
mail_user <span class="token operator">=</span> <span class="token char">'159*****02'</span>  
#密码<span class="token punctuation">(</span>部分邮箱为授权码<span class="token punctuation">)</span> 
mail_pass <span class="token operator">=</span> <span class="token char">'7******x'</span>   
#邮件发送方邮箱地址
sender <span class="token operator">=</span> <span class="token char">'159*****02@163.com'</span>  
#邮件接受方邮箱地址，注意需要<span class="token punctuation">[</span><span class="token punctuation">]</span>包裹，这意味着你可以写多个邮件地址群发
receivers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token char">'59*****02@qq.com'</span><span class="token punctuation">]</span>  

#设置email信息
#邮件内容设置
message <span class="token operator">=</span> <span class="token function">MIMEText</span><span class="token punctuation">(</span><span class="token char">'content'</span><span class="token punctuation">,</span><span class="token char">'plain'</span><span class="token punctuation">,</span><span class="token char">'utf-8'</span><span class="token punctuation">)</span>
#邮件主题       
message<span class="token punctuation">[</span><span class="token char">'Subject'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'title'</span> 
#发送方信息
message<span class="token punctuation">[</span><span class="token char">'From'</span><span class="token punctuation">]</span> <span class="token operator">=</span> sender 
#接受方信息     
message<span class="token punctuation">[</span><span class="token char">'To'</span><span class="token punctuation">]</span> <span class="token operator">=</span> receivers<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  

#登录并发送邮件
<span class="token keyword">try</span><span class="token operator">:</span>
    smtpObj <span class="token operator">=</span> smtplib<span class="token punctuation">.</span><span class="token function">SMTP</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
    #连接到服务器
    smtpObj<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>mail_host<span class="token punctuation">,</span><span class="token number">25</span><span class="token punctuation">)</span>
    #登录到服务器
    smtpObj<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>mail_user<span class="token punctuation">,</span>mail_pass<span class="token punctuation">)</span> 
    #发送
    smtpObj<span class="token punctuation">.</span><span class="token function">sendmail</span><span class="token punctuation">(</span>
        sender<span class="token punctuation">,</span>receivers<span class="token punctuation">,</span>message<span class="token punctuation">.</span><span class="token function">as_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
    #退出
    smtpObj<span class="token punctuation">.</span><span class="token function">quit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token char">'success'</span><span class="token punctuation">)</span>
except smtplib<span class="token punctuation">.</span>SMTPException as e<span class="token operator">:</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token char">'error'</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span> #打印错误
</code></pre> 
<p>结果：<br> <img src="https://images2.imgbox.com/df/6c/ogdK1CIn_o.png" alt="在这里插入图片描述"><br> 注意事项：</p> 
<p>一些邮箱登录比如 QQ 邮箱需要 SSL 认证，所以 SMTP 已经不能满足要求，而需要SMTP_SSL，解决办法为：</p> 
<pre><code class="prism language-cpp">#启动
smtpObj <span class="token operator">=</span> smtplib<span class="token punctuation">.</span><span class="token function">SMTP</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
#连接到服务器
smtpObj<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>mail_host<span class="token punctuation">,</span><span class="token number">25</span><span class="token punctuation">)</span>
#######替换为########
smtpObj <span class="token operator">=</span> smtplib<span class="token punctuation">.</span><span class="token function">SMTP_SSL</span><span class="token punctuation">(</span>mail_host<span class="token punctuation">)</span>
</code></pre> 
<h3><a id="5_email_92"></a>5. 带有附件的email</h3> 
<p>上面我们介绍了发送字符串的邮件，但这明显不满足现代邮件的需求，下面我们介绍如何发送内容以 HTML 格式，并且带有图片和文本文件的邮件。</p> 
<p>处理多种形态的邮件主体我们需要 MIMEMultipart 类，而处理图片需要 MIMEImage 类。</p> 
<pre><code class="prism language-cpp"><span class="token keyword">import</span> <span class="token module">smtplib</span>
from email<span class="token punctuation">.</span>mime<span class="token punctuation">.</span>text <span class="token keyword">import</span> <span class="token module">MIMEText</span>
from email<span class="token punctuation">.</span>mime<span class="token punctuation">.</span>multipart <span class="token keyword">import</span> <span class="token module">MIMEMultipart</span>
from email<span class="token punctuation">.</span>mime<span class="token punctuation">.</span>image <span class="token keyword">import</span> <span class="token module">MIMEImage</span>

#设置登录及服务器信息
mail_host <span class="token operator">=</span> <span class="token char">'smtp.163.com'</span>
mail_user <span class="token operator">=</span> <span class="token char">'159*****02'</span>
mail_pass <span class="token operator">=</span> <span class="token char">'7******x'</span>
sender <span class="token operator">=</span> <span class="token char">'159*****02@163.com'</span>
receivers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token char">'7******0@qq.com'</span><span class="token punctuation">]</span>

#设置eamil信息
#添加一个MIMEmultipart类，处理正文及附件
message <span class="token operator">=</span> <span class="token function">MIMEMultipart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
message<span class="token punctuation">[</span><span class="token char">'From'</span><span class="token punctuation">]</span> <span class="token operator">=</span> sender
message<span class="token punctuation">[</span><span class="token char">'To'</span><span class="token punctuation">]</span> <span class="token operator">=</span> receivers<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
message<span class="token punctuation">[</span><span class="token char">'Subject'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'title'</span>
#推荐使用html格式的正文内容，这样比较灵活，可以附加图片地址，调整格式等
with <span class="token function">open</span><span class="token punctuation">(</span><span class="token char">'abc.html'</span><span class="token punctuation">,</span><span class="token char">'r'</span><span class="token punctuation">)</span> as f<span class="token operator">:</span>
    content <span class="token operator">=</span> f<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
#设置html格式参数
part1 <span class="token operator">=</span> <span class="token function">MIMEText</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span><span class="token char">'html'</span><span class="token punctuation">,</span><span class="token char">'utf-8'</span><span class="token punctuation">)</span>
#添加一个txt文本附件
with <span class="token function">open</span><span class="token punctuation">(</span><span class="token char">'abc.txt'</span><span class="token punctuation">,</span><span class="token char">'r'</span><span class="token punctuation">)</span>as h<span class="token operator">:</span>
    content2 <span class="token operator">=</span> h<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
#设置txt参数
part2 <span class="token operator">=</span> <span class="token function">MIMEText</span><span class="token punctuation">(</span>content2<span class="token punctuation">,</span><span class="token char">'plain'</span><span class="token punctuation">,</span><span class="token char">'utf-8'</span><span class="token punctuation">)</span>
#附件设置内容类型，方便起见，设置为二进制流
part2<span class="token punctuation">[</span><span class="token char">'Content-Type'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'application/octet-stream'</span>
#设置附件头，添加文件名
part2<span class="token punctuation">[</span><span class="token char">'Content-Disposition'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'attachment;filename="abc.txt"'</span>
#添加照片附件
with <span class="token function">open</span><span class="token punctuation">(</span><span class="token char">'1.png'</span><span class="token punctuation">,</span><span class="token char">'rb'</span><span class="token punctuation">)</span>as fp<span class="token operator">:</span>
    picture <span class="token operator">=</span> <span class="token function">MIMEImage</span><span class="token punctuation">(</span>fp<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    #与txt文件设置相似
    picture<span class="token punctuation">[</span><span class="token char">'Content-Type'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'application/octet-stream'</span>
    picture<span class="token punctuation">[</span><span class="token char">'Content-Disposition'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'attachment;filename="1.png"'</span>
#将内容附加到邮件主体中
message<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span>part1<span class="token punctuation">)</span>
message<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span>part2<span class="token punctuation">)</span>
message<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span>picture<span class="token punctuation">)</span>

#登录并发送
<span class="token keyword">try</span><span class="token operator">:</span>
    smtpObj <span class="token operator">=</span> smtplib<span class="token punctuation">.</span><span class="token function">SMTP</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    smtpObj<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>mail_host<span class="token punctuation">,</span><span class="token number">25</span><span class="token punctuation">)</span>
    smtpObj<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>mail_user<span class="token punctuation">,</span>mail_pass<span class="token punctuation">)</span>
    smtpObj<span class="token punctuation">.</span><span class="token function">sendmail</span><span class="token punctuation">(</span>
        sender<span class="token punctuation">,</span>receivers<span class="token punctuation">,</span>message<span class="token punctuation">.</span><span class="token function">as_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token char">'success'</span><span class="token punctuation">)</span>
    smtpObj<span class="token punctuation">.</span><span class="token function">quit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
except smtplib<span class="token punctuation">.</span>SMTPException as e<span class="token operator">:</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token char">'error'</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span>
</code></pre> 
<h3><a id="6_152"></a>6.小结</h3> 
<p>通过上面的代码，想必大家已经对发邮件有了基本的认识。</p> 
<p>从整体上我们要把握整个过程的思路：</p> 
<ol><li>登录</li><li>写邮件</li><li>发送</li></ol> 
<p>微观上我们需要了解：</p> 
<ul><li>smtplib/email 模块的代码规则；</li><li>什么时候使用 SMTP，什么时候使用 SMTP_SSL？</li><li>针对不同的邮件内容需要使用到不同的类，MIMEmultipart、MIMEText、MIMEIamge 等等；</li><li>怎么去设置附件信息</li></ul> 
<p>当然，看再多教程，不如亲自动手写一段代码。大家不妨都自己发一封邮件试一试。</p> 
<p><strong><mark>朋友们如果需要这份完整的资料可以微信扫描下方CSDN官方认证二维码免费领取<font color="red">【保证100%免费】</font></mark></strong></p> 
<blockquote> 
 <p>👉<a href="https://mp.weixin.qq.com/s/ZxS5RO3rb59V5z2G4hLRUA" rel="nofollow">[[<font color="red">CSDN大礼包：</font>《python安装包&amp;全套学习资料》免费分享]]</a><font color="green">（<strong>安全链接，放心点击</strong>）</font></p> 
</blockquote> 
<center> 
 <img src="https://images2.imgbox.com/ed/0e/v6drlLRw_o.png"> 
 <center> 
 </center> 
</center> 
<h3><a id="Python_177"></a>一、Python所有方向的学习路线</h3> 
<p>Python所有方向的技术点做的整理，形成各个领域的知识点汇总，它的用处就在于，你可以按照上面的知识点去找对应的学习资源，保证自己学得较为全面。<br> <img src="https://images2.imgbox.com/54/76/3zXo3rp2_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="Python_180"></a>二、Python必备开发工具</h3> 
<p><img src="https://images2.imgbox.com/41/8b/6CHQyy4g_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="Python_183"></a>三、精品Python学习书籍</h3> 
<p>当我学到一定基础，有自己的理解能力的时候，会去阅读一些前辈整理的书籍或者手写的笔记资料，这些笔记详细记载了他们对一些技术点的理解，这些理解是比较独到，可以学到不一样的思路。<br> <img src="https://images2.imgbox.com/80/f4/rAmTj6EF_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="Python_186"></a>四、Python视频合集</h3> 
<p>观看零基础学习视频，看视频学习是最快捷也是最有效果的方式，跟着视频中老师的思路，从基础到深入，还是很容易入门的。<br> <img src="https://images2.imgbox.com/ad/0a/0v5k7OjG_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_190"></a>五、实战案例</h3> 
<p>光学理论是没用的，要学会跟着一起敲，要动手实操，才能将自己的所学运用到实际当中去，这时候可以搞点实战案例来学习。<img src="https://images2.imgbox.com/2e/e7/6SHwUSJi_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="Python_193"></a>六、Python练习题</h3> 
<p>检查学习结果。<br> <img src="https://images2.imgbox.com/da/19/xh9fk6wK_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_197"></a>七、面试资料</h3> 
<p>我们学习Python必然是为了找到高薪的工作，下面这些面试题是来自阿里、腾讯、字节等一线互联网大厂最新的面试资料，并且有阿里大佬给出了权威的解答，刷完这一套面试资料相信大家都能找到满意的工作。<br> <img src="https://images2.imgbox.com/66/71/xX4ccd45_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/93/09/iFMNGXIX_o.png" alt="在这里插入图片描述"><br> <strong>最后，千万别辜负自己当时开始的一腔热血，一起变强大变优秀。</strong></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/141999d2a95e983c491da08163837388/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">如何访问GitHub快的飞起？两步解决访问超时GitHub，无法访问GitHub的问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2fd8829b482a5fcbffca8a3647cd8fdd/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">如何使用 Python 实现彩票自由（双色球）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>