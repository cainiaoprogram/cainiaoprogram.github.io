<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>小猫爪：S32K3学习笔记03-S32K3之eMIOS - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="小猫爪：S32K3学习笔记03-S32K3之eMIOS" />
<meta property="og:description" content="小猫爪：S32K3学习笔记03-S32K3之eMIOS 1 前言2 eMIOS资源介绍3 CNT和Counter Bus4 UC的工作模式4.1 General-Purpose Input and Output (GPIO) mode4.2 Single Action Input Capture (SAIC) mode4.3 Single Action Output Capture (SAOC) mode4.4 Input Pulse Width Measurement (IPWM) mode4.5 Input Period Measurement (IPM) Mode4.6 Double Action Output Compare (DAOC) mode4.7 Pulse Edge Counting (PEC) mode4.8 Modulus Counter (MC) mode4.9 Modulus Counter Buffered (MCB) mode4.10 Output Pulse Width and Frequency Modulation Buffered (OPWFMB) mode4.11 Center Aligned Output PWM with Dead Time Insertion Buffered (OPWMCB) mode4." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/71ce2c4c3d298f59a160aa5994391f05/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-04-19T17:32:09+08:00" />
<meta property="article:modified_time" content="2022-04-19T17:32:09+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">小猫爪：S32K3学习笔记03-S32K3之eMIOS</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>小猫爪：S32K3学习笔记03-S32K3之eMIOS</h4> 
 <ul><li><a href="#1__2" rel="nofollow">1 前言</a></li><li><a href="#2_eMIOS_5" rel="nofollow">2 eMIOS资源介绍</a></li><li><a href="#3_CNTCounter_Bus_14" rel="nofollow">3 CNT和Counter Bus</a></li><li><a href="#4_UC_30" rel="nofollow">4 UC的工作模式</a></li><li><ul><li><a href="#41_GeneralPurpose_Input_and_Output_GPIO_mode_32" rel="nofollow">4.1 General-Purpose Input and Output (GPIO) mode</a></li><li><a href="#42_Single_Action_Input_Capture_SAIC_mode_38" rel="nofollow">4.2 Single Action Input Capture (SAIC) mode</a></li><li><a href="#43_Single_Action_Output_Capture_SAOC_mode_47" rel="nofollow">4.3 Single Action Output Capture (SAOC) mode</a></li><li><a href="#44_Input_Pulse_Width_Measurement_IPWM_mode_55" rel="nofollow">4.4 Input Pulse Width Measurement (IPWM) mode</a></li><li><a href="#45_Input_Period_Measurement_IPM_Mode_59" rel="nofollow">4.5 Input Period Measurement (IPM) Mode</a></li><li><a href="#46_Double_Action_Output_Compare_DAOC_mode_63" rel="nofollow">4.6 Double Action Output Compare (DAOC) mode</a></li><li><a href="#47_Pulse_Edge_Counting_PEC_mode_67" rel="nofollow">4.7 Pulse Edge Counting (PEC) mode</a></li><li><a href="#48_Modulus_Counter_MC_mode_71" rel="nofollow">4.8 Modulus Counter (MC) mode</a></li><li><a href="#49_Modulus_Counter_Buffered_MCB_mode_79" rel="nofollow">4.9 Modulus Counter Buffered (MCB) mode</a></li><li><a href="#410_Output_Pulse_Width_and_Frequency_Modulation_Buffered_OPWFMB_mode_87" rel="nofollow">4.10 Output Pulse Width and Frequency Modulation Buffered (OPWFMB) mode</a></li><li><a href="#411_Center_Aligned_Output_PWM_with_Dead_Time_Insertion_Buffered_OPWMCB_mode_91" rel="nofollow">4.11 Center Aligned Output PWM with Dead Time Insertion Buffered (OPWMCB) mode</a></li><li><a href="#412_Output_PWM_Buffered_OPWMB_mode_95" rel="nofollow">4.12 Output PWM Buffered (OPWMB) mode</a></li><li><a href="#413_Output_PWM_with_Trigger_OPWMT_mode_99" rel="nofollow">4.13 Output PWM with Trigger (OPWMT) mode</a></li></ul> 
  </li><li><a href="#5_MCAL_102" rel="nofollow">5 MCAL配置</a></li><li><ul><li><a href="#51_MCU_104" rel="nofollow">5.1 MCU</a></li><li><a href="#52_MCL_108" rel="nofollow">5.2 MCL</a></li><li><a href="#53_PWM_116" rel="nofollow">5.3 PWM</a></li><li><a href="#54_ICU_126" rel="nofollow">5.4 ICU</a></li><li><a href="#55__146" rel="nofollow">5.5 周期频率的计算</a></li></ul> 
  </li><li><a href="#END_163" rel="nofollow">END</a></li></ul> 
</div> 
<p></p> 
<h2><a id="1__2"></a>1 前言</h2> 
<p>  这几天简单的学习了一下K3的eMIOS，这应该也算是K3相比较K1的一个大升级吧，因为eMIOS比FlexTimer强，常常得用它来进行信号测量啊，PWM波生成啊之类的。下面就简单的介绍一下这个模块吧。</p> 
<h2><a id="2_eMIOS_5"></a>2 eMIOS资源介绍</h2> 
<p>  下面两个表对eMIOS的资源情况做了简单详尽的介绍，大家仔细观看。<br> <img src="https://images2.imgbox.com/14/d1/ulr4SoGJ_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/34/28/rvhbbtqa_o.png" alt="在这里插入图片描述"><br>   可以看到每个eMIOS模块都有24个通道（UC），这些通道都是相互独立的且又是互相配合，但是这些通道在结构上并不是一模一样，而是分成了4种通道类型，分别是TypeX，TypeY，TypeG，TypeH。这4种通道类型的区别就在于它们所支持的工作模式不同，下表显示了每种通道所支持的工作模式。<br> <img src="https://images2.imgbox.com/e9/c2/shAgtd94_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/93/13/S5oOL10z_o.png" alt="在这里插入图片描述"><br>   下表显示三个eMIOS模块的24个通道分别是那种类型：<br> <img src="https://images2.imgbox.com/f7/ec/yMYMI9xR_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/0b/73/vs7xnorr_o.png" alt="在这里插入图片描述"><br>   为啥要设计不同结构的通道呢，这就是由eMIOS的工作原理来决定了，虽然说每个通道相互独立，但是eMIOS强大的功能需要由数个通道相互组合才能完全发挥。</p> 
<h2><a id="3_CNTCounter_Bus_14"></a>3 CNT和Counter Bus</h2> 
<p>  eMIOS的通道，通道又叫Unified channels（UC）。eMIOS各个UC之间是怎么相互合作的呢，其中一个最重要的点就是Counter Bus。什么是Counter Bus呢？</p> 
<p>  举个例子，在传统PWM生成模块中，里面都会有一个内部计数器，如果让其生成想要的PWM波则需要设置这个内部计数器的计数方式以及周期等，而eMIOS的Counter Bus则就是代替了这个内部计数器。而这个Counter Bus信号则就是另外一个UC的内部计数器CNT（每个UC内部都有一个内部计数器CNT）。</p> 
<p>  所有，如果我们需要使用eMIOS生成PWM信号的话，首先则需要先配置通道A内部计数器CNT的计数方式和周期，让通道A的CNT变成其他通道的Counter Bus；随后再配置通道B以Counter Bus代替自己的CNT作为计数器，两者结合就可以生成PWM信号了，也就是说生成一个PWM信号需要两个通道相互配合才能生成。</p> 
<p>  那么就有人问了，只使用一个通道不行吗，通道里面不是有一个CNT吗？答案是：当然可以。使用一个通道也是可以产生PWM的，这取决于通道的工作模式。因为每个通道是相互独立的，所以使用单个通道生成PWM做不到和别的通道生成的PWM同步，但是Counter Bus则完美的解决了这一点，因为多个通道可以共用一个Counter Bus。</p> 
<p>  当然也不是所有的通道都可以生成Counter Bus，还记得前面提供eMIOS的24个UC的结构是不同的，只有TypeX型UC可以生成Counter Bus。</p> 
<p>  经过上面的讲解，下面这副图就非常清晰了。<br> <img src="https://images2.imgbox.com/69/e8/LOQau95I_o.png" alt="在这里插入图片描述"><br>   TypeX型通道CH0，CH8，CH16分别生成局部Bus Counter_bus_B，Counter_bus_C，Counter_bus_D，局部Bus只能供给部分通道；TypeX型通道CH22,CH23生成全局Bus Counter_bus_A，Counter_bus_F，全局Bus可以为其他所有通道提供Bus。</p> 
<h2><a id="4_UC_30"></a>4 UC的工作模式</h2> 
<p>  从上面的介绍中得知eMIOS的通道，支持很多种模式，接下来就对这些模式进行简单的介绍。</p> 
<h3><a id="41_GeneralPurpose_Input_and_Output_GPIO_mode_32"></a>4.1 General-Purpose Input and Output (GPIO) mode</h3> 
<p>  这种模式属于UC的默认模式，或者叫初始状态吧，没啥暖用，唯一的作用就是用来作为过渡模式，也就说如果把一个UC由工作模式A变成工作模式B，那么就必须先UC变成GPIO模式，然后再将其配置成工作模式B。</p> 
<div class="mermaid sequence-diagram"> 
 <svg id="mermaid-svg-4kjf67zbTYZBE4SI" width="100%" xmlns="http://www.w3.org/2000/svg" height="62" style="max-width: 389.4875183105469px;" viewbox="0 0 389.4875183105469 62"> 
  <style>#mermaid-svg-4kjf67zbTYZBE4SI {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-svg-4kjf67zbTYZBE4SI .error-icon{fill:#552222;}#mermaid-svg-4kjf67zbTYZBE4SI .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-4kjf67zbTYZBE4SI .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-4kjf67zbTYZBE4SI .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-4kjf67zbTYZBE4SI .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-4kjf67zbTYZBE4SI .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-4kjf67zbTYZBE4SI .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-4kjf67zbTYZBE4SI .marker{fill:#333333;stroke:#333333;}#mermaid-svg-4kjf67zbTYZBE4SI .marker.cross{stroke:#333333;}#mermaid-svg-4kjf67zbTYZBE4SI svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-4kjf67zbTYZBE4SI .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-svg-4kjf67zbTYZBE4SI .cluster-label text{fill:#333;}#mermaid-svg-4kjf67zbTYZBE4SI .cluster-label span{color:#333;}#mermaid-svg-4kjf67zbTYZBE4SI .label text,#mermaid-svg-4kjf67zbTYZBE4SI span{fill:#333;color:#333;}#mermaid-svg-4kjf67zbTYZBE4SI .node rect,#mermaid-svg-4kjf67zbTYZBE4SI .node circle,#mermaid-svg-4kjf67zbTYZBE4SI .node ellipse,#mermaid-svg-4kjf67zbTYZBE4SI .node polygon,#mermaid-svg-4kjf67zbTYZBE4SI .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-svg-4kjf67zbTYZBE4SI .node .label{text-align:center;}#mermaid-svg-4kjf67zbTYZBE4SI .node.clickable{cursor:pointer;}#mermaid-svg-4kjf67zbTYZBE4SI .arrowheadPath{fill:#333333;}#mermaid-svg-4kjf67zbTYZBE4SI .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-svg-4kjf67zbTYZBE4SI .flowchart-link{stroke:#333333;fill:none;}#mermaid-svg-4kjf67zbTYZBE4SI .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-svg-4kjf67zbTYZBE4SI .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-svg-4kjf67zbTYZBE4SI .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-svg-4kjf67zbTYZBE4SI .cluster text{fill:#333;}#mermaid-svg-4kjf67zbTYZBE4SI .cluster span{color:#333;}#mermaid-svg-4kjf67zbTYZBE4SI div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-4kjf67zbTYZBE4SI :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style> 
  <g> 
   <g class="output"> 
    <g class="clusters"></g> 
    <g class="edgePaths"> 
     <g class="edgePath LS-A LE-链接" id="L-A-链接" style="opacity: 1;"> 
      <path class="path" d="M101.4375,31L105.60416666666667,31C109.77083333333333,31,118.10416666666667,31,126.4375,31C134.77083333333334,31,143.10416666666666,31,147.27083333333334,31L151.4375,31" marker-end="url(#arrowhead51)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead51" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path> 
       </marker> 
      </defs> 
     </g> 
     <g class="edgePath LS-链接 LE-B" style="opacity: 1;" id="L-链接-B"> 
      <path class="path" d="M238.4250030517578,31L242.59166971842447,31C246.75833638509116,31,255.09166971842447,31,263.4250030517578,31C271.7583363850911,31,280.0916697184245,31,284.2583363850911,31L288.4250030517578,31" marker-end="url(#arrowhead52)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead52" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path> 
       </marker> 
      </defs> 
     </g> 
    </g> 
    <g class="edgeLabels"> 
     <g class="edgeLabel" transform="" style="opacity: 1;"> 
      <g transform="translate(0,0)" class="label"> 
       <rect rx="0" ry="0" width="0" height="0"></rect> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span id="L-L-A-链接" class="edgeLabel L-LS-A' L-LE-链接"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" style="opacity: 1;" transform=""> 
      <g transform="translate(0,0)" class="label"> 
       <rect rx="0" ry="0" width="0" height="0"></rect> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span id="L-L-链接-B" class="edgeLabel L-LS-链接' L-LE-B"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
    </g> 
    <g class="nodes"> 
     <g class="node default" id="flowchart-A-21" transform="translate(54.71875,31)" style="opacity: 1;"> 
      <rect rx="0" ry="0" x="-46.71875" y="-23" width="93.4375" height="46" class="label-container"></rect> 
      <g class="label" transform="translate(0,0)"> 
       <g transform="translate(-36.71875,-13)"> 
        <foreignobject width="73.4375" height="26"> 
         <div style="display: inline-block; white-space: nowrap;">
           工作模式A 
         </div> 
        </foreignobject> 
       </g> 
      </g> 
     </g> 
     <g class="node default" style="opacity: 1;" id="flowchart-链接-22" transform="translate(194.9312515258789,31)"> 
      <rect rx="0" ry="0" x="-43.493751525878906" y="-23" width="86.98750305175781" height="46" class="label-container"></rect> 
      <g class="label" transform="translate(0,0)"> 
       <g transform="translate(-33.493751525878906,-13)"> 
        <foreignobject width="66.98750305175781" height="26"> 
         <div style="display: inline-block; white-space: nowrap;">
           GPIO模式 
         </div> 
        </foreignobject> 
       </g> 
      </g> 
     </g> 
     <g class="node default" style="opacity: 1;" id="flowchart-B-23" transform="translate(334.9562530517578,31)"> 
      <rect rx="0" ry="0" x="-46.53125" y="-23" width="93.0625" height="46" class="label-container"></rect> 
      <g class="label" transform="translate(0,0)"> 
       <g transform="translate(-36.53125,-13)"> 
        <foreignobject width="73.0625" height="26"> 
         <div style="display: inline-block; white-space: nowrap;">
           工作模式B 
         </div> 
        </foreignobject> 
       </g> 
      </g> 
     </g> 
    </g> 
   </g> 
  </g> 
 </svg> 
</div> 
<h3><a id="42_Single_Action_Input_Capture_SAIC_mode_38"></a>4.2 Single Action Input Capture (SAIC) mode</h3> 
<p>  这个就是最简单的传统意义上的输入捕捉功能，检测到一个上升沿或者下降沿，UC就生成一个Flag信号Sn[FLAG]，同时捕捉当前Counter Bus的值到AS2。</p> 
<ol><li> <p>单边沿捕捉如下：<br> <img src="https://images2.imgbox.com/8a/cb/WknOjIyH_o.png" alt="在这里插入图片描述"></p> </li><li> <p>双边沿捕捉如下：<br> <img src="https://images2.imgbox.com/4f/37/IyeP5o00_o.png" alt="在这里插入图片描述"></p> </li></ol> 
<h3><a id="43_Single_Action_Output_Capture_SAOC_mode_47"></a>4.3 Single Action Output Capture (SAOC) mode</h3> 
<p>  这个也就是最简单的匹配匹配输出功能，给AS2写入一个值，当Counter Bus的值与AS2相等时，这个时候就会产生一个Flag信号，同时控制输出跳变或者翻转。</p> 
<ol><li> <p>信号跳变<br> <img src="https://images2.imgbox.com/2a/1d/E57UW5SO_o.png" alt="在这里插入图片描述"></p> </li><li> <p>信号翻转<br> <img src="https://images2.imgbox.com/01/9e/NcElew9x_o.png" alt="在这里插入图片描述"></p> </li></ol> 
<h3><a id="44_Input_Pulse_Width_Measurement_IPWM_mode_55"></a>4.4 Input Pulse Width Measurement (IPWM) mode</h3> 
<p>  这个模式就是用来测量两个连续不同沿之间的宽度，即测量一个电平宽度。当检测到第一个沿（上升沿或者下降沿），捕捉Counter Bus的值，当检测到第二个沿（与第一个沿相反），再捕捉Counter Bus的值并产生一个Flag信号。<br> <img src="https://images2.imgbox.com/74/bf/rcHZnGjf_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="45_Input_Period_Measurement_IPM_Mode_59"></a>4.5 Input Period Measurement (IPM) Mode</h3> 
<p>  这个模式用来测量两个连续相同沿的宽度，通常用来测量信号周期，即检测到第一个沿（上升沿或者下降沿），捕捉Counter Bus的值，当检测到第二个沿（与第一个沿相通），再捕捉Counter Bus的值并产生一个Flag信号。</p> 
<p><img src="https://images2.imgbox.com/3a/0a/vcVb8uIh_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="46_Double_Action_Output_Compare_DAOC_mode_63"></a>4.6 Double Action Output Compare (DAOC) mode</h3> 
<p>  这个模式通常用于生产一段固定长度的电平。这个模式相比较SAOC，就是它可以有两个比较输出，最常见的应用就是当第一个匹配事件发生时，输出信号翻转，第二个匹配事件发生时，输出信号再次翻转。第一个匹配成功后可生产Flag信号也可以不生成Flag信号（可配置），而第二个匹配成功后则肯定会产生Flag信号。<br> <img src="https://images2.imgbox.com/be/e0/y4qCr0OU_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="47_Pulse_Edge_Counting_PEC_mode_67"></a>4.7 Pulse Edge Counting (PEC) mode</h3> 
<p>  这个模式通常用来测量信号的脉冲数或者边沿数。外部信号输入后，检测到有效信号后计数器累加，并且在当计数器CNT值发生匹配事件A后，复位计数器CNT并启动计数，发生匹配事件B后，停止计数并且输出Flag信号。<br> <img src="https://images2.imgbox.com/ef/60/bXT51H5R_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="48_Modulus_Counter_MC_mode_71"></a>4.8 Modulus Counter (MC) mode</h3> 
<p>  这个模式就是典型的把一个通道变成一个传统定时器的功能了，或者可以为其他通道生成一个Counter base信号。可以工作在UP计数模式和Up Count-Down计数模式。中途可以随意修改匹配值AS1。</p> 
<ol><li>在UP计数模式下，可产生一个溢出Flag信号，如下图所示：<br> <img src="https://images2.imgbox.com/45/14/4uGbrvKY_o.png" alt="在这里插入图片描述"></li><li>在Up Count-Down计数模式下，可产生两个匹配事件并产生Flag信号，分别是高低峰处AS1和BS1，如下图所示：<br> <img src="https://images2.imgbox.com/ef/cd/cfqjAXKl_o.png" alt="在这里插入图片描述"></li></ol> 
<h3><a id="49_Modulus_Counter_Buffered_MCB_mode_79"></a>4.9 Modulus Counter Buffered (MCB) mode</h3> 
<p>  这个模式就是单纯的为了生成一个Counter Bus信号。它也有两种模式，跟MC模式一样，直接贴图：</p> 
<ol><li>Up Count<br> <img src="https://images2.imgbox.com/37/8c/z90bki2U_o.png" alt="在这里插入图片描述"></li><li>Up Count-Down Count<br> <img src="https://images2.imgbox.com/ae/46/mXm5qeKk_o.png" alt="在这里插入图片描述"></li></ol> 
<p>  <strong>个人猜测</strong>：至于它与MC模式有什么区别，我也不知道，反反复复研究了好久都不知道这个buffered代表了什么，如果后面我悟了，会回来更新的，我个人觉得就是使能了寄存器双缓存机制，让改变寄存器值得速度变得更加的快。）</p> 
<h3><a id="410_Output_Pulse_Width_and_Frequency_Modulation_Buffered_OPWFMB_mode_87"></a>4.10 Output Pulse Width and Frequency Modulation Buffered (OPWFMB) mode</h3> 
<p>  这个模式通常用来生成单个PWM信号，因为这种模式没有采用Counter Bus作为自己的计数器，至于原理很简单，直接贴图：<br> <img src="https://images2.imgbox.com/87/c7/dVhDbq3q_o.png" alt="在这里插入图片描述"><br>   CNT与AS1匹配后输出翻转，CNT与BS1匹配后输出再翻转，一个周期结束。也就是说AS1决定PWM的占空比，BS1则决定PWM的周期。</p> 
<h3><a id="411_Center_Aligned_Output_PWM_with_Dead_Time_Insertion_Buffered_OPWMCB_mode_91"></a>4.11 Center Aligned Output PWM with Dead Time Insertion Buffered (OPWMCB) mode</h3> 
<p>  这个模式通常用来生成同步PWM信号，因为这种模式使用了Counter Bus作为计数器，至于原理很简单，直接贴图：<br> <img src="https://images2.imgbox.com/83/c7/hh5qYJcI_o.png" alt="在这里插入图片描述"><br>   可以看到在这个模式下，还可以插入死区时间。AS1决定占空比，BS1决定死去时间，至于周期则由Counter Bus来决定。</p> 
<h3><a id="412_Output_PWM_Buffered_OPWMB_mode_95"></a>4.12 Output PWM Buffered (OPWMB) mode</h3> 
<p>  这个模式也是用来生成同步PWM信号，如下图所示：<br> <img src="https://images2.imgbox.com/72/5b/7lzgRjfh_o.png" alt="在这里插入图片描述"><br>   这个模式与OPWFMB的区别就是它的周期是由选择的Counter Bus来决定的，而占空比则是由AS1和BS1共同决定。</p> 
<h3><a id="413_Output_PWM_with_Trigger_OPWMT_mode_99"></a>4.13 Output PWM with Trigger (OPWMT) mode</h3> 
<p>  这个模式不仅能生成PWM，还可以用来生成触发信号，通常用其来配合其他通道生成同步触发信号来触发ADC。而这个模式必须选择外部计数器，而且还必须是MC up和MCB up驱动生成的Counter Bus。<br> <img src="https://images2.imgbox.com/a1/5e/ppF3v2yj_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="5_MCAL_102"></a>5 MCAL配置</h2> 
<p>  下面就结合MCAL配置来把eMIOS模块用起来。首先设置完PORT的复用之后，接下来就是：</p> 
<h3><a id="51_MCU_104"></a>5.1 MCU</h3> 
<p>  首先得在MCU模块中使能eMIOS模块得时钟，以及设置参考时钟。<br> <img src="https://images2.imgbox.com/c1/73/Y9StUOyl_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/04/4f/VL2P53n5_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="52_MCL_108"></a>5.2 MCL</h3> 
<p>  然后得需要在MCL模块中激活eMIOS的支持，以及设置相应的counter bus。<br> <img src="https://images2.imgbox.com/ae/ca/cma7ToPI_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/52/05/TYrF6vBd_o.png" alt="在这里插入图片描述"><br>   添加counter bus，如下图：<br> <img src="https://images2.imgbox.com/b5/7e/vgVBgB2l_o.png" alt="在这里插入图片描述"><br>   这里需要注意以下，就是如果这个counter bus是给ICU使用的，即给输入捕获使用的，则必须设置成65535。</p> 
<h3><a id="53_PWM_116"></a>5.3 PWM</h3> 
<p>  如果是要产生PWM，则需要在PWM里面增加eMIOS的通道：<br> <img src="https://images2.imgbox.com/88/de/alsvTzhm_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/26/44/iUfmX7SN_o.png" alt="在这里插入图片描述"><br>   设置完相应的工作模式，参考Counter bus之后，添加PWM通道：<br> <img src="https://images2.imgbox.com/3a/9c/GwBRC559_o.png" alt="在这里插入图片描述"><br>   在这里需要注意的是，周期必须设置成与eMIOS通道相等，另外对于占空比，则是将占空比100等比变成了0x8000，举个例子，如果你要设置占空比为50%，那么这里的占空比则是要设置成0x4000。</p> 
<p>  到这里为止，PWM就可以产生了。</p> 
<h3><a id="54_ICU_126"></a>5.4 ICU</h3> 
<p>  如果要使用eMIOS的输入捕获功能，则需要配置ICU模块，首先同样的在ICU中添加参考eMIOS通道：<br> <img src="https://images2.imgbox.com/10/ca/EYAN4xyC_o.png" alt="在这里插入图片描述"><br>   设置好通道的工作模式，参考counter bus:<br> <img src="https://images2.imgbox.com/58/7a/msI0vhMh_o.png" alt="在这里插入图片描述"><br>   在这里需要注意的是，如果需要测量周期占空比，IPWM模式支持测量频率更大的信号，SAIC模式则小一点。之后就是添加ICU通道：<br> <img src="https://images2.imgbox.com/81/6c/5PJuwmTQ_o.png" alt="在这里插入图片描述"><br>   到这里还没有完，还需要去在platfrom模块中使能eMIOS的中断以及注册相应的中断服务函数，因为ICU是需要中断来做的：<br> <img src="https://images2.imgbox.com/7e/f0/KAobZuav_o.png" alt="在这里插入图片描述"><br>   至于通道数核服务函数名之间的对应关系如下：</p> 
<table><thead><tr><th>中断服务函数</th><th>通道数</th></tr></thead><tbody><tr><td>EMIOSx_0_IRQ</td><td>20~23</td></tr><tr><td>EMIOSx_1_IRQ</td><td>16~19</td></tr><tr><td>EMIOSx_2_IRQ</td><td>12~15</td></tr><tr><td>EMIOSx_3_IRQ</td><td>8~11</td></tr><tr><td>EMIOSx_4_IRQ</td><td>4~7</td></tr><tr><td>EMIOSx_5_IRQ</td><td>0~3</td></tr></tbody></table> 
<p>  当然也可以通过轮询的方式来实现，这种方式就不介绍了，此外还可以通过DMA的方式来实现，但是这种方法我觉得挺鸡肋的，这个数据量太小了。这里也不多做介绍了。</p> 
<h3><a id="55__146"></a>5.5 周期频率的计算</h3> 
<p>  下面来看一看周期频率的计算，举个例子来看一下计算过程。</p> 
<ol><li>首先第一步去看这个通道的Counter Bus来源是啥，比如这里选择的BUS_F，如下：<br> <img src="https://images2.imgbox.com/c9/2d/hlSUa9Zc_o.png" alt="在这里插入图片描述"></li><li>找到这个被引用的Counter Bus的配置，并且记住如下所示的三个参数：分别是MasterBusPrescaler, DefaultPeriod, MasterBusModeType。<br> <img src="https://images2.imgbox.com/02/11/cQlclU1V_o.png" alt="在这里插入图片描述"></li><li>找到eMIOS模块的总分频系数ClockDividerValue，如下：<br> <img src="https://images2.imgbox.com/8a/47/VNB5r9ke_o.png" alt="在这里插入图片描述"></li><li>找到eMIOS的参考时钟，并记录其参考时钟源，其实就是CoreClock，为160MHz，如下：<br> <img src="https://images2.imgbox.com/f2/ab/kAT1nu2e_o.png" alt="在这里插入图片描述"></li></ol> 
<p>  得到这些参数就可以计算累加频率了，如下：累加频率 = CoreClock / ClockDividerValue / MasterBusPrescaler / DefaultPeriod。<br> 所在在这里所设置的累加频率为：<br> 160M / 32 / 1 / 50000 = 1000。</p> 
<p>  最后再看看MasterBusModeType，也就是看看它的工作模式，如果是Up模式，则最后的频率为1000，如果是Up-Down模式，则最后的频率则为2000。</p> 
<h2><a id="END_163"></a>END</h2>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/12051bcaa36ea0d3780ee9149e22765a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">WASM反编译，WASM逆向</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/013baef855b8a403db4b0b0300674812/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">抖音算法推荐机制详解（科普向）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>