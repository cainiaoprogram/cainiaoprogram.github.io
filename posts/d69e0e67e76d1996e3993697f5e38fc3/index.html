<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>uniapp微信小程序投票系统实战 (SpringBoot2&#43;vue3.2&#43;element plus ) -投票创建后端实现 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="uniapp微信小程序投票系统实战 (SpringBoot2&#43;vue3.2&#43;element plus ) -投票创建后端实现" />
<meta property="og:description" content="锋哥原创的uniapp微信小程序投票系统实战：
uniapp微信小程序投票系统实战课程 (SpringBoot2&#43;vue3.2&#43;element plus ) ( 火爆连载更新中... )_哔哩哔哩_bilibiliuniapp微信小程序投票系统实战课程 (SpringBoot2&#43;vue3.2&#43;element plus ) ( 火爆连载更新中... )共计21条视频，包括：uniapp微信小程序投票系统实战课程 (SpringBoot2&#43;vue3.2&#43;element plus ) ( 火爆连载更新中... )、第2讲 投票项目后端架构搭建、第3讲 小程序端 TabBar搭建等，UP主更多精彩视频，请关注UP账号。https://www.bilibili.com/video/BV1ea4y137xf/新建Vote投票类:
package com.java1234.entity; import com.baomidou.mybatisplus.annotation.TableField; import com.baomidou.mybatisplus.annotation.TableName; import com.fasterxml.jackson.annotation.JsonFormat; import com.fasterxml.jackson.databind.annotation.JsonSerialize; import lombok.Data; import java.util.Date; import java.util.List; /** * 投票实体 * @author java1234_小锋 （公众号：java1234） * @site www.java1234.vip * @company 南通小锋网络科技有限公司 */ @TableName(&#34;t_vote&#34;) @Data public class Vote { private Integer id; // 编号 private String title; // 标题 private String explanation; // 投票说明 private String coverImage; // 封面图片 @JsonSerialize(using=CustomDateTimeSerializer." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/d69e0e67e76d1996e3993697f5e38fc3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-09T09:44:31+08:00" />
<meta property="article:modified_time" content="2024-01-09T09:44:31+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">uniapp微信小程序投票系统实战 (SpringBoot2&#43;vue3.2&#43;element plus ) -投票创建后端实现</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>锋哥原创的uniapp微信小程序投票系统实战：</p> 
<p><a class="has-card" href="https://www.bilibili.com/video/BV1ea4y137xf/" rel="nofollow" title="uniapp微信小程序投票系统实战课程 (SpringBoot2+vue3.2+element plus ) ( 火爆连载更新中... )_哔哩哔哩_bilibili"><span class="link-card-box"><span class="link-title">uniapp微信小程序投票系统实战课程 (SpringBoot2+vue3.2+element plus ) ( 火爆连载更新中... )_哔哩哔哩_bilibili</span><span class="link-desc">uniapp微信小程序投票系统实战课程 (SpringBoot2+vue3.2+element plus ) ( 火爆连载更新中... )共计21条视频，包括：uniapp微信小程序投票系统实战课程 (SpringBoot2+vue3.2+element plus ) ( 火爆连载更新中... )、第2讲 投票项目后端架构搭建、第3讲 小程序端 TabBar搭建等，UP主更多精彩视频，请关注UP账号。</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/3a/32/AqwZ2iuK_o.png" alt="icon-default.png?t=N7T8">https://www.bilibili.com/video/BV1ea4y137xf/</span></span></a>新建Vote投票类:</p> 
<pre><code class="language-java">package com.java1234.entity;

import com.baomidou.mybatisplus.annotation.TableField;
import com.baomidou.mybatisplus.annotation.TableName;
import com.fasterxml.jackson.annotation.JsonFormat;
import com.fasterxml.jackson.databind.annotation.JsonSerialize;
import lombok.Data;

import java.util.Date;
import java.util.List;

/**
 * 投票实体
 * @author java1234_小锋 （公众号：java1234）
 * @site www.java1234.vip
 * @company 南通小锋网络科技有限公司
 */
@TableName("t_vote")
@Data
public class Vote {

    private Integer id; // 编号

    private String title; // 标题

    private String explanation; // 投票说明

    private String coverImage; // 封面图片

    @JsonSerialize(using=CustomDateTimeSerializer.class)
    @JsonFormat(pattern = "yyyy-MM-dd HH:mm:ss", timezone = "GMT+8")
    private Date voteEndTime; // 投票结束时间

    private String openid; // 投票发起人openid

    @TableField(select=false,exist = false)
    private List&lt;VoteItem&gt; voteItemList;

    @TableField(select=false,exist = false)
    private WxUserInfo wxUserInfo;

    private Integer type=1; // 1 文字投票  2 图片投票

}</code></pre> 
<p>新建VoteItem投票选项类：</p> 
<pre><code class="language-java">package com.java1234.entity;

import com.baomidou.mybatisplus.annotation.TableName;
import lombok.Data;

/**
 * 投票选项实体
 * @author java1234_小锋 （公众号：java1234）
 * @site www.java1234.vip
 * @company 南通小锋网络科技有限公司
 */
@TableName("t_vote_item")
@Data
public class VoteItem {

    private Integer id; // 编号

    private Integer voteId; // 投票ID

    private String name; // 投票选项名称

    private String image; // 投票选项图片

    private Integer number; // 票数

}</code></pre> 
<p>数据库新建t_vote投票表：</p> 
<pre><code class="language-sql">create table `t_vote` (
	`id` int (11),
	`title` varchar (600),
	`explanation` varchar (3000),
	`cover_image` varchar (600),
	`vote_end_time` datetime ,
	`openid` varchar (600),
	`type` int (11)
); </code></pre> 
<p>数据库再新建t_vote_item投票选项表：</p> 
<pre><code class="language-sql">create table `t_vote_item` (
	`id` int (11),
	`vote_id` int (11),
	`name` varchar (600),
	`image` varchar (600),
	`number` int (11)
); </code></pre> 
<p>新建VoteMapper：</p> 
<pre><code class="language-java">/**
 * 投票Mapper接口
 */
public interface VoteMapper extends BaseMapper&lt;Vote&gt; {
}</code></pre> 
<p>新建VoteItemMapper：</p> 
<pre><code class="language-java">/**
 * 投票选项Mapper接口
 */
public interface VoteItemMapper extends BaseMapper&lt;VoteItem&gt; {

}</code></pre> 
<p>新建IVoteService：</p> 
<pre><code class="language-java">/**
 * 投票Service接口
 */
public interface IVoteService extends IService&lt;Vote&gt; {
    
}</code></pre> 
<p>新建IVoteItemService：</p> 
<pre><code class="language-java">/**
 * 投票选项Service接口
 */
public interface IVoteItemService extends IService&lt;VoteItem&gt; {

}</code></pre> 
<p>新建IVoteServiceImpl：</p> 
<pre><code class="language-java">@Service("voteService")
public class IVoteServiceImpl extends ServiceImpl&lt;VoteMapper,Vote&gt; implements IVoteService {

    @Autowired
    private VoteMapper voteMapper;

}</code></pre> 
<p>新建IVoteItemServiceImpl：</p> 
<pre><code class="language-java">@Service("voteItemService")
public class IVoteItemServiceImpl extends ServiceImpl&lt;VoteItemMapper, VoteItem&gt; implements IVoteItemService {

    @Autowired
    private VoteItemMapper voteItemMapper;
    
}</code></pre> 
<p>VoteController添加add方法:</p> 
<pre><code class="language-java">/**
 * 添加投票
 * @param vote
 * @return
 */
@RequestMapping("/add")
@Transactional
public R add(@RequestBody Vote vote, @RequestHeader String token){
    System.out.println("token="+token);
    Claims claims = JwtUtils.validateJWT(token).getClaims();
    System.out.println("openid="+claims.getId());
    vote.setOpenid(claims.getId());
    voteService.save(vote);
    // 存投票选项
    List&lt;VoteItem&gt; voteItemList=vote.getVoteItemList();
    for(VoteItem voteItem:voteItemList){
        voteItem.setVoteId(vote.getId());
        voteItem.setNumber(0);
        voteItemService.save(voteItem);
    }
    return R.ok();
}</code></pre> 
<p>前端验证以及提交：</p> 
<pre><code class="language-javascript">submitVote:async function(e){
    // 验证
    if(isEmpty(this.title)){
        uni.showToast({
            icon:"error",
            title:"请填写投票标题"
        })
        return;
    }
    // 投票选项片段 至少2个选项
    let resultOptions=this.options.filter(function(value,index,self){  // 过滤掉名称为空的投票选项
        console.log("value="+value.name)
        return !isEmpty(value.name)
    })
    console.log("xx"+JSON.stringify(resultOptions));
    console.log("length="+resultOptions.length)
    if(resultOptions.length&lt;2){
        uni.showToast({
            icon:"error",
            title:"请至少填写两个投票选项"
        })
        return;
    }
    // 提交表单
    let form={
        title:this.title,
        coverImage:this.coverImageFileName,
        explanation:this.explanation,
        voteEndTime:this.voteEndTime,
        voteItemList:resultOptions,
        type:1
    }
    const result=await requestUtil({url:"/vote/add",data:form,method:"post"});
    if(result.code==0){
        console.log("发布成功")
        uni.showToast({
            icon:"success",
            title:"投票发起成功!"
        })
    }
}</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8b656abd92b86e6bad9ccaac7d45c791/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">设计模式之状态模式【行为型模式】</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8ee49fc6f2ae9d75b45c7a57f57ad460/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">图片自适应各种设备尺寸</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>