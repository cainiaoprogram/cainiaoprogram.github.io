<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Spring Data JPA的使用 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Spring Data JPA的使用" />
<meta property="og:description" content="目录 spring data简介spring data jpa简介springboot整合jpa依赖yml实体类dao层 关联关系的表达一对一一对多多对多 常见问题 spring data简介 spring data是spring的一个子项目，是spring家族成员之一，旨在简化数据访问层的开发，给操作数据库（关系数据库sql、非关系数据库nosql）提供了一系列组件，常用的比如
spring data jpa：整合关系数据库spring data redis：整合redisspring data mongodb：整合mongodbspring data elasticsearch：整合es spring data jpa简介 Java Persistence API，spring data jpa是spring data系列组件之一，旨在简化对关系数据库的操作，可作为 mybatis、hibernate 外的另一种选择。包含了 hibernate 的很多功能，比如实体类生成表的正向工程，比如 @Entity、@Table、@Id、@GeneratedValue、@ManyToMany、@JoinTable 等注解。封装了dao层的通用接口，提供了许多通用方法，可通过方法命名约定不写单表操作的简单sql，简化了数据访问层的开发，大大提高了开发效率。提供的关联查询、级联操作了解即可，不推荐使用，因为容易踩坑、难以维护。 官方文档：https://docs.spring.io/spring-data/jpa/reference/index.html
github：https://github.com/spring-projects/spring-data-jpa
springboot整合jpa 依赖 创建时勾选 SQL -&gt; Spring Data JPA、数据库驱动，并添加连接池的依赖
&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;druid-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;1.1.22&lt;/version&gt; &lt;/dependency&gt; jpa的依赖中包含了hibernate的核心依赖
yml spring: datasource: type: com.alibaba.druid.pool.DruidDataSource driver-class-name: com.mysql.cj.jdbc.Driver url: jdbc:mysql://localhost:3306/mall?serverTimezone=Asia/Shanghai&amp;allowMultiQueries=true username: chy password: abcd jpa: #打印sql的日志 show-sql: true #hibernate正向工程，根据实体类生成数据表 # hibernate: # ddl-auto: update create：每次启动应用时都会根据实体类重新生成数据表（覆盖原表）update：每次启动应用时都会根据实体类更新数据表的定义（更新是先删除原表再新建） 个人并不推荐使用hibernate的正向工程，容易采坑，如果要使用，只在初次启动应用时使用，后续将其注释掉。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/7adf1e8eaf61d5efeb5f084537f4c6b8/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-28T16:07:37+08:00" />
<meta property="article:modified_time" content="2023-12-28T16:07:37+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Spring Data JPA的使用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night-eighties">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><ul><li><ul><li><a href="#spring_data_3" rel="nofollow">spring data简介</a></li><li><a href="#spring_data_jpa_12" rel="nofollow">spring data jpa简介</a></li><li><a href="#springbootjpa_23" rel="nofollow">springboot整合jpa</a></li><li><ul><li><a href="#_24" rel="nofollow">依赖</a></li><li><a href="#yml_48" rel="nofollow">yml</a></li><li><a href="#_72" rel="nofollow">实体类</a></li><li><a href="#dao_108" rel="nofollow">dao层</a></li></ul> 
    </li><li><a href="#_175" rel="nofollow">关联关系的表达</a></li><li><ul><li><a href="#_179" rel="nofollow">一对一</a></li><li><a href="#_230" rel="nofollow">一对多</a></li><li><a href="#_278" rel="nofollow">多对多</a></li></ul> 
    </li><li><a href="#_317" rel="nofollow">常见问题</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<br>   
<p></p> 
<h4><a id="spring_data_3"></a>spring data简介</h4> 
<p>spring data是spring的一个子项目，是spring家族成员之一，旨在简化数据访问层的开发，给操作数据库（关系数据库sql、非关系数据库nosql）提供了一系列组件，常用的比如</p> 
<ul><li>spring data jpa：整合关系数据库</li><li>spring data redis：整合redis</li><li>spring data mongodb：整合mongodb</li><li>spring data elasticsearch：整合es</li></ul> 
<p> </p> 
<h4><a id="spring_data_jpa_12"></a>spring data jpa简介</h4> 
<ul><li>Java Persistence API，spring data jpa是spring data系列组件之一，旨在简化对关系数据库的操作，可作为 mybatis、hibernate 外的另一种选择。</li><li>包含了 hibernate 的很多功能，比如实体类生成表的正向工程，比如 @Entity、@Table、@Id、@GeneratedValue、@ManyToMany、@JoinTable 等注解。</li><li>封装了dao层的通用接口，提供了许多通用方法，可通过方法命名约定不写单表操作的简单sql，简化了数据访问层的开发，大大提高了开发效率。</li><li>提供的关联查询、级联操作了解即可，不推荐使用，因为容易踩坑、难以维护。</li></ul> 
<p>官方文档：<a href="https://docs.spring.io/spring-data/jpa/reference/index.html" rel="nofollow">https://docs.spring.io/spring-data/jpa/reference/index.html</a><br> github：<a href="https://github.com/spring-projects/spring-data-jpa">https://github.com/spring-projects/spring-data-jpa</a></p> 
<p> </p> 
<h4><a id="springbootjpa_23"></a>springboot整合jpa</h4> 
<h5><a id="_24"></a>依赖</h5> 
<p>创建时勾选 SQL -&gt; Spring Data JPA、数据库驱动，并添加连接池的依赖</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-jpa<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>runtime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>druid-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.1.22<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>jpa的依赖中包含了hibernate的核心依赖</p> 
<p> </p> 
<h5><a id="yml_48"></a>yml</h5> 
<pre><code class="prism language-yml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> com.alibaba.druid.pool.DruidDataSource
        <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
        <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/mall<span class="token punctuation">?</span>serverTimezone=Asia/Shanghai<span class="token important">&amp;allowMultiQueries=true</span>
        <span class="token key atrule">username</span><span class="token punctuation">:</span> chy
        <span class="token key atrule">password</span><span class="token punctuation">:</span> abcd

    <span class="token key atrule">jpa</span><span class="token punctuation">:</span>
        <span class="token comment">#打印sql的日志</span>
        <span class="token key atrule">show-sql</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token comment">#hibernate正向工程，根据实体类生成数据表</span>
<span class="token comment">#        hibernate:</span>
<span class="token comment">#            ddl-auto: update</span>
</code></pre> 
<ul><li>create：每次启动应用时都会根据实体类重新生成数据表（覆盖原表）</li><li>update：每次启动应用时都会根据实体类更新数据表的定义（更新是先删除原表再新建）</li></ul> 
<p>个人并不推荐使用hibernate的正向工程，容易采坑，如果要使用，只在初次启动应用时使用，后续将其注释掉。</p> 
<p> </p> 
<h5><a id="_72"></a>实体类</h5> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token class-name">Column</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token class-name">GeneratedValue</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Serializable</span></span><span class="token punctuation">;</span>


<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"tb_user"</span><span class="token punctuation">)</span>  <span class="token comment">//显式指定表名，未指定时默认取实体类的snake写法作为表名，eg.GoodsInfo =&gt; goods_info</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Id</span>  <span class="token comment">//标识主键</span>
    <span class="token annotation punctuation">@GeneratedValue</span>  <span class="token comment">//使用数据库主键值自增</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>  <span class="token comment">//指定值不能为null</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"pwd"</span><span class="token punctuation">)</span>  <span class="token comment">//显式指定数据表字段名，未指定时默认取变量名的snake写法作为表名</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>columnDefinition <span class="token operator">=</span> <span class="token string">"DATE"</span><span class="token punctuation">)</span>  <span class="token comment">//对于jpa不能自动映射的类型，可手动指定对应的数据库字段类型</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> birthday<span class="token punctuation">;</span>
    
    <span class="token keyword">private</span> <span class="token class-name">String</span> tel<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> address<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> 
<p> </p> 
<h5><a id="dao_108"></a>dao层</h5> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 不需要加 @Repository
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserDao</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">/**
     * 使用默认实现时，方法名中的成员变量需要与实体类中的保持一致，形参表中的变量则无此要求
     */</span>
    <span class="token class-name">User</span> <span class="token function">findByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token comment">/**
     * 对于复杂查询，可以自己写sql语句。自己写sql语句时，方法名不需要遵守规范
     * 但表名要换成实体类名，字段名要换成员变量名
     */</span>
    <span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">"select user from User user where user.username=?1 and user.tel=?2"</span><span class="token punctuation">)</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAllByNameAndTel1</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> tel<span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token comment">/**
     * 有2种方式引用参数：
     * 1、?n即形参表的第n个参数，n从1开始
     * 2、@Param指定name，:name引用变量
     * 推荐第2种，阅读性更好，方便排错
     */</span>
    <span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">"select user from User user where user.username=:name and user.tel=:tel"</span><span class="token punctuation">)</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAllByNameAndTel2</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"tel"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> tel<span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token comment">/**
     * 可以select user.xxx选中一个字段，方法返回写该字段的类型或者该类型的List
     * 也可以select user选中全部字段，方法返回写实体类或者实体类的List
     * 不能select user.xxx1,user.xxx2选取多个字段，要取多个字段时，直接select user取全部字段
     * 也不能select user.*使用*号
     */</span>
    <span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">"select user.address from User user where user.username=:name and user.tel=:tel"</span><span class="token punctuation">)</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAllByNameAndTel3</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"tel"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> tel<span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token comment">/**
     * 写update、delete语句时，需要加 @Modifying
     * 调用时不管调用几个dao层的方法，只要调用了update|delete，都必须要在方法上加事务 @Transactional
     * 加spring的事务、javax的事务均可
     */</span>
    <span class="token annotation punctuation">@Modifying</span>
    <span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">"update User user set user.username=:name,user.tel=:tel where user.id=:id"</span><span class="token punctuation">)</span>
    <span class="token keyword">void</span> <span class="token function">updateNameAndTel</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"tel"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> tel<span class="token punctuation">)</span><span class="token punctuation">;</span>

    
<span class="token punctuation">}</span>
</code></pre> 
<p>继承常用接口</p> 
<ul><li>CrudRepository：继承了Repository接口，提供了crud的通用方法</li><li>PagingAndSortingRepository：继承了CrudRepository接口，在CrudRepository的基础上提供了分页、排序的方法</li><li>JpaRepository：继承了PagingAndSortingRepository接口，在 PagingAndSortingRepository的基础上提供了jpa规范相关的方法</li></ul> 
<p>这些接口都只提供了一些通用方法，可以根据需要新增方法，无需提供实现，jpa会自动实现。</p> 
<p>方法命名必须遵守jpa的规则，规则参考：<br> <a href="https://docs.spring.io/spring-data/jpa/reference/jpa/query-methods.html" rel="nofollow">https://docs.spring.io/spring-data/jpa/reference/jpa/query-methods.html</a></p> 
<p>自定义的接口名常用XxxDao、XxxRepository，使用时@Autowired注入即可。</p> 
<p> </p> 
<h4><a id="_175"></a>关联关系的表达</h4> 
<p>生成表时，jpa会自动把 @JoinColumn#name 指定的数据表字段 设置为外键；查询时，jpa会自动根据实体类的关联关系获取成员变量对应的实体。<br>  </p> 
<h5><a id="_179"></a>一对一</h5> 
<p>eg. 一个用户对应一张会员卡，一张会员卡也只属于一个用户</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GeneratedValue</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> tel<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> address<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@OneToOne</span>
    <span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"card_id"</span><span class="token punctuation">)</span>  <span class="token comment">//指定该实体类对应的外键列名</span>
    <span class="token keyword">private</span> <span class="token class-name">Card</span> card<span class="token punctuation">;</span>
    
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Entity</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Card</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GeneratedValue</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">BigDecimal</span> money<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@OneToOne</span>
    <span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"user_id"</span><span class="token punctuation">)</span>  <span class="token comment">//此处可不要@JoinColumn</span>
    <span class="token annotation punctuation">@JsonIgnore</span>  <span class="token comment">//放弃维护此字段</span>
    <span class="token keyword">private</span> <span class="token class-name">User</span> user<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>不使用@JsonIgnore会根据循环引用查询嵌套结果，使用@JsonIgnore后，该字段不会关联到对应的表，相当于一方放弃了关联关系。</p> 
<p>此处User可以查到对应的Card，Card不能查到对应的User。</p> 
<p> </p> 
<h5><a id="_230"></a>一对多</h5> 
<p>eg. 一个用户有多个订单，这些订单都属于同一个用户</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GeneratedValue</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> tel<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> address<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@OneToMany</span><span class="token punctuation">(</span>mappedBy <span class="token operator">=</span> <span class="token string">"user"</span><span class="token punctuation">)</span>  <span class="token comment">//mappedBy指定Order中的当前实体（User）对应的成员变量</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Order</span><span class="token punctuation">&gt;</span></span> orderList<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"tb_order"</span><span class="token punctuation">)</span>  <span class="token comment">//order和sql的排序关键字order冲突，不能使用order作为表名</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Order</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GeneratedValue</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@ManyToOne</span>
    <span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"user_id"</span><span class="token punctuation">)</span>  <span class="token comment">//在多的一方指定外键列名</span>
    <span class="token annotation punctuation">@JsonIgnore</span>  <span class="token comment">//放弃维护此字段</span>
    <span class="token keyword">private</span> <span class="token class-name">User</span> user<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>哪方是一就加@OneToMany，哪方是多就加@ManyToOne，To前面的单词代表当前实体类。</p> 
<p>此处User可以查到对应的Order，Order不能查到所属的User。</p> 
<p> </p> 
<h5><a id="_278"></a>多对多</h5> 
<p>eg. 一个学生有多个老师，一个老师也有多个学生</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Student</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GeneratedValue</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@ManyToMany</span>  <span class="token comment">// @JoinTable指定中间表，name指定表名，joinColumns指定中间表中当前实体类对应的字段，inverseJoinColumns指定中间表中对方对应的字段</span>
    <span class="token annotation punctuation">@JoinTable</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"teacher_student"</span><span class="token punctuation">,</span> joinColumns <span class="token operator">=</span> <span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"student_id"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> inverseJoinColumns <span class="token operator">=</span> <span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"teacher_id"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Teacher</span><span class="token punctuation">&gt;</span></span> teacherList<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Entity</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Teacher</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GeneratedValue</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@ManyToMany</span>
    <span class="token annotation punctuation">@JoinTable</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"teacher_student"</span><span class="token punctuation">,</span>joinColumns <span class="token operator">=</span><span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"teacher_id"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>inverseJoinColumns <span class="token operator">=</span> <span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"student_id"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@JsonIgnore</span>  <span class="token comment">//放弃维护此字段</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">&gt;</span></span> studentList<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>此处，学生可以查到自己的老师，老师不能查到自己的学生。</p> 
<p> </p> 
<h4><a id="_317"></a>常见问题</h4> 
<p>1、关联查询使用懒加载时报错 LazyInitializationException - no Session</p> 
<blockquote> 
 <p>org.hibernate.LazyInitializationException: failed to lazily initialize a collection of role: com.xxx.xxx.xxx, could not initialize proxy - no Session</p> 
</blockquote> 
<p>原因：执行懒加载之前事务就提交了，数据库 session 已经关闭，导致执行懒加载时没有可用的数据库session。<br> 解决方案：在 yml 中添加以下配置</p> 
<pre><code class="prism language-yml"><span class="token comment">#允许在无事务的情况下进行懒加载</span>
<span class="token key atrule">spring.jpa.properties.hibernate.enable_lazy_load_no_trans</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7fe959890d50bcbdf53c4cdc7596d9cd/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">虚幻UE 材质-PBR基于物理的渲染</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/988f2f114e9f5926ea4bf76f383b7d8a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">为什么TCP会粘包</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>