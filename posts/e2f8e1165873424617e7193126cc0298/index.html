<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>FileCoin 挖矿实战-基础命令 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="FileCoin 挖矿实战-基础命令" />
<meta property="og:description" content="基础命令 启动创建完整的 CAR 快照在首次启动 daemon 的时候执行导入快照初始化矿工创建钱包备份钱包创建矿工 修改 Miner 配置修改 API 连接配置，主要用于 worker 连接 miner修改 [Storage] 选项，将密封相关的任务全部分配给 worker 去做 使用远程 lotus daemon配置你的 lotus daemon config.toml 文件 启动 lotus-miner启动 lotus-worker(1) 启动一个只接 P1 任务的 worker(2) 启动一个可以同时接 P1 和 P2 任务的 worker(3) 启动一个只接 C2 任务的 worker查看已经连接到 miner 的 worker 列表质押扇区，启动挖矿查询当前集群的任务分配情况 启动 lotus daemon &gt; daemon.log 创建完整的 CAR 快照 lotus chain export &lt;filename&gt; 命令你可以导出一个完整的 lotus chain 快照。不过这个快照比较大，可能超过 100 GB。你也可以只导出最新的区块，跳过以前的旧消息。–recent-stateroots 参数指定要导出的状态根数。 --skip-old-msgs 参数表示只导出那些 stateroots 直接引用的区块。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/e2f8e1165873424617e7193126cc0298/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-03-31T14:49:22+08:00" />
<meta property="article:modified_time" content="2021-03-31T14:49:22+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">FileCoin 挖矿实战-基础命令</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>基础命令</h4> 
 <ul><li><ul><li><ul><li><a href="#_2" rel="nofollow">启动</a></li><li><a href="#_CAR__9" rel="nofollow">创建完整的 CAR 快照</a></li><li><a href="#_daemon__24" rel="nofollow">在首次启动 daemon 的时候执行导入快照</a></li><li><a href="#_35" rel="nofollow">初始化矿工</a></li><li><ul><li><a href="#_60" rel="nofollow">创建钱包</a></li><li><a href="#_65" rel="nofollow">备份钱包</a></li><li><a href="#_70" rel="nofollow">创建矿工</a></li></ul> 
    </li><li><a href="#_Miner__78" rel="nofollow">修改 Miner 配置</a></li><li><ul><li><a href="#_API__worker__miner_81" rel="nofollow">修改 API 连接配置，主要用于 worker 连接 miner</a></li><li><a href="#_Storage__worker__89" rel="nofollow">修改 [Storage] 选项，将密封相关的任务全部分配给 worker 去做</a></li></ul> 
    </li><li><a href="#_lotus_daemon_100" rel="nofollow">使用远程 lotus daemon</a></li><li><ul><li><a href="#_lotus_daemon_configtoml__101" rel="nofollow">配置你的 lotus daemon config.toml 文件</a></li></ul> 
    </li><li><a href="#_lotusminer_112" rel="nofollow">启动 lotus-miner</a></li><li><a href="#_lotusworker_118" rel="nofollow">启动 lotus-worker</a></li><li><ul><li><a href="#1__P1__worker_136" rel="nofollow">(1) 启动一个只接 P1 任务的 worker</a></li><li><a href="#2__P1__P2__worker_140" rel="nofollow">(2) 启动一个可以同时接 P1 和 P2 任务的 worker</a></li><li><a href="#3__C2__worker_146" rel="nofollow">(3) 启动一个只接 C2 任务的 worker</a></li><li><a href="#_miner__worker__153" rel="nofollow">查看已经连接到 miner 的 worker 列表</a></li><li><a href="#_157" rel="nofollow">质押扇区，启动挖矿</a></li><li><a href="#_162" rel="nofollow">查询当前集群的任务分配情况</a></li></ul> 
   </li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h4><a id="_2"></a>启动</h4> 
<pre><code class="prism language-bash">lotus daemon <span class="token operator">&gt;</span> daemon.log
</code></pre> 
<h4><a id="_CAR__9"></a>创建完整的 CAR 快照</h4> 
<pre><code class="prism language-bash">lotus chain <span class="token function">export</span> <span class="token operator">&lt;</span>filename<span class="token operator">&gt;</span> 
</code></pre> 
<blockquote> 
 <p>命令你可以导出一个完整的 lotus chain 快照。不过这个快照比较大，可能超过 100 GB。你也可以只导出最新的区块，跳过以前的旧消息。–recent-stateroots 参数指定要导出的状态根数。 --skip-old-msgs 参数表示只导出那些 stateroots 直接引用的区块。</p> 
</blockquote> 
<pre><code class="prism language-bash"><span class="token comment"># usage</span>
lotus chain <span class="token function">export</span> --skip-old-msgs --recent-stateroots<span class="token operator">=</span><span class="token operator">&lt;</span>stateroots-num<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>filename<span class="token operator">&gt;</span>
<span class="token comment"># e.g</span>
lotus chain <span class="token function">export</span> --skip-old-msgs --recent-stateroots<span class="token operator">=</span>2000 lotus-chain.car
</code></pre> 
<h4><a id="_daemon__24"></a>在首次启动 daemon 的时候执行导入快照</h4> 
<pre><code class="prism language-bash"><span class="token comment"># 跳过验证</span>
lotus daemon --import-snapshot <span class="token operator">&lt;</span>filename<span class="token operator">&gt;</span>
<span class="token comment"># 包含验证</span>
lotus daemon --import-chain <span class="token operator">&lt;</span>filename<span class="token operator">&gt;</span>
<span class="token comment"># 如果你希望在快照导入之后就立即退出守护进程，（例如在docker环境中很有用），请在命令中添加 --halt-after-import 标志</span>
lotus daemon --import-snapshot --halt-after-import <span class="token operator">&lt;</span>filename<span class="token operator">&gt;</span>
</code></pre> 
<h4><a id="_35"></a>初始化矿工</h4> 
<pre><code class="prism language-bash"><span class="token comment"># 等 lotus daemon 完成区块同步，检查区块是否同步完成</span>
<span class="token comment"># 该命令会显示当前同步多少区块了，还有多少没有同步完成，以及你现在的同步速度。</span>
<span class="token comment"># 如果没有同步完成，会一直处于阻塞状态，等待同步完成了该命令才会退出。</span>
lotus <span class="token function">sync</span> <span class="token function">wait</span>
</code></pre> 
<p>重写 <code>lotus-miner</code> 脚本</p> 
<pre><code class="prism language-bash">vim /usr/local/bin/lotus-miner
</code></pre> 
<pre><code class="prism language-bash">FIL_PROOFS_PARAMETER_CACHE<span class="token operator">=</span>/gamma/filecoin-proof-parameters \ <span class="token comment"># proof 参数路径</span>
IPFS_GATEWAY<span class="token operator">=</span>https://proof-parameters.s3.cn-south-1.jdcloud-oss.com/ipfs/ 
LOTUS_PATH<span class="token operator">=</span>/data/lotus \ <span class="token comment"># daemon 数据根路径</span>
LOTUS_MINER_PATH<span class="token operator">=</span>/data/lotus-miner  \ <span class="token comment"># miner 数据存储跟路径</span>
FIL_PROOFS_USE_GPU_COLUMN_BUILDER<span class="token operator">=</span>1 \ <span class="token comment"># 启用 GPU加速 COLUMN hash 计算</span>
FIL_PROOFS_USE_GPU_TREE_BUILDER<span class="token operator">=</span>1 \ <span class="token comment"># 启用 GPU 构造 Merkle 树</span>
RUST_LOG<span class="token operator">=</span>Trace \
FIL_PROOFS_MAXIMIZE_CACHING<span class="token operator">=</span>1 \
/opt/lotus/lotus-miner <span class="token variable">$*</span>
</code></pre> 
<h5><a id="_60"></a>创建钱包</h5> 
<pre><code class="prism language-bash">lotus wallet new bls
</code></pre> 
<h5><a id="_65"></a>备份钱包</h5> 
<pre><code class="prism language-bash">lotus wallet <span class="token function">export</span> <span class="token punctuation">{<!-- --></span>钱包地址<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="_70"></a>创建矿工</h5> 
<pre><code class="prism language-bash"><span class="token comment"># usage</span>
lotus-miner init --owner<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>钱包地址<span class="token punctuation">}</span> --sector-size<span class="token operator">=</span><span class="token operator">&lt;</span>val<span class="token operator">&gt;</span>
<span class="token comment"># e.g</span>
lotus-miner init --owner<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>钱包地址<span class="token punctuation">}</span> --sector-size<span class="token operator">=</span>32GiB
</code></pre> 
<h4><a id="_Miner__78"></a>修改 Miner 配置</h4> 
<p>miner 的配置文档在 <code>$LOTUS_MINER_PATH/config.toml</code>，如果你是跑单节点的话，那么无需修改配置文档，但是如果你是需要跑集群的话， 那么你需要修改下面几个地方：</p> 
<h5><a id="_API__worker__miner_81"></a>修改 API 连接配置，主要用于 worker 连接 miner</h5> 
<pre><code class="prism language-bash"><span class="token comment"># e.g</span>
 <span class="token punctuation">[</span>API<span class="token punctuation">]</span>
 ListenAddress <span class="token operator">=</span> <span class="token string">"/ip4/{miner 的内网 IP 地址}/tcp/2345/http"</span>
 RemoteListenAddress <span class="token operator">=</span> <span class="token string">"{miner 的内网 IP 地址}:2345"</span>
</code></pre> 
<h5><a id="_Storage__worker__89"></a>修改 [Storage] 选项，将密封相关的任务全部分配给 worker 去做</h5> 
<pre><code class="prism language-bash"> <span class="token punctuation">[</span>Storage<span class="token punctuation">]</span>
 <span class="token comment">#  ParallelFetchLimit = 10</span>
 AllowAddPiece <span class="token operator">=</span> <span class="token boolean">false</span>
 AllowPreCommit1 <span class="token operator">=</span> <span class="token boolean">false</span>
 AllowPreCommit2 <span class="token operator">=</span> <span class="token boolean">false</span>
 AllowCommit <span class="token operator">=</span> <span class="token boolean">false</span>
 <span class="token comment">#  AllowUnseal = true</span>
</code></pre> 
<h4><a id="_lotus_daemon_100"></a>使用远程 lotus daemon</h4> 
<h5><a id="_lotus_daemon_configtoml__101"></a>配置你的 lotus daemon config.toml 文件</h5> 
<pre><code class="prism language-bash"><span class="token comment"># e.g</span>
 <span class="token punctuation">[</span>API<span class="token punctuation">]</span>
 ListenAddress <span class="token operator">=</span> <span class="token string">"/ip4/{lotus daemon 的内网 IP 地址}/tcp/1234/http"</span>
 RemoteListenAddress <span class="token operator">=</span> <span class="token string">"{lotus daemon 的内网 IP 地址}:1234"</span>
</code></pre> 
<blockquote> 
 <p>同时需要拷贝 lotus dameon 的 api 和 token 文件到 miner 机器的 $LOTUS_PATH 目录下</p> 
</blockquote> 
<h4><a id="_lotusminer_112"></a>启动 lotus-miner</h4> 
<pre><code class="prism language-bash">lotus-miner run
</code></pre> 
<h4><a id="_lotusworker_118"></a>启动 lotus-worker</h4> 
<p>同样的，我们也需要重写 <code>lotus-worker</code> 脚本</p> 
<pre><code class="prism language-bash">FIL_PROOFS_PARAMETER_CACHE<span class="token operator">=</span>/gamma/filecoin-proof-parameters \ <span class="token comment"># proof 参数路径</span>
IPFS_GATEWAY<span class="token operator">=</span>https://proof-parameters.s3.cn-south-1.jdcloud-oss.com/ipfs/ 
LOTUS_WORKER_PATH<span class="token operator">=</span>/data/lotus-worker \ <span class="token comment"># worker 数据存储目录</span>
LOTUS_MINER_PATH<span class="token operator">=</span>/data/lotus-miner  \ <span class="token comment"># 保存 miner api 和 token 的目录</span>
FIL_PROOFS_USE_GPU_COLUMN_BUILDER<span class="token operator">=</span>1 \ <span class="token comment"># 启用 GPU加速 COLUMN hash 计算</span>
FIL_PROOFS_USE_GPU_TREE_BUILDER<span class="token operator">=</span>1 \ <span class="token comment"># 启用 GPU 构造 Merkle 树</span>
RUST_LOG<span class="token operator">=</span>Trace \
FIL_PROOFS_MAXIMIZE_CACHING<span class="token operator">=</span>1 \
/opt/lotus/lotus-worker <span class="token variable">$*</span>
</code></pre> 
<ol><li>拷贝 miner 的 api 和 token 文件到 <code>$LOTUS_MINER_PATH</code> 目录下。</li><li>启动 worker 程序，可以根据传入不同的参数来定义 worker 的类型。</li></ol> 
<h5><a id="1__P1__worker_136"></a>(1) 启动一个只接 P1 任务的 worker</h5> 
<pre><code class="prism language-bash">lotus-worker run --listen<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>worker 的内网 IP 地址<span class="token punctuation">}</span>:2345 --precommit1<span class="token operator">=</span>true --precommit2<span class="token operator">=</span>false -commit<span class="token operator">=</span>false
</code></pre> 
<h5><a id="2__P1__P2__worker_140"></a>(2) 启动一个可以同时接 P1 和 P2 任务的 worker</h5> 
<pre><code class="prism language-bash">lotus-worker run --listen<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>worker 的内网 IP 地址<span class="token punctuation">}</span>:2345 --precommit1<span class="token operator">=</span>true --precommit2<span class="token operator">=</span>true -commit<span class="token operator">=</span>false
</code></pre> 
<h5><a id="3__C2__worker_146"></a>(3) 启动一个只接 C2 任务的 worker</h5> 
<pre><code class="prism language-bash">lotus-worker run --listen<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>worker 的内网 IP 地址<span class="token punctuation">}</span>:2345 --precommit1<span class="token operator">=</span>false --precommit2<span class="token operator">=</span>false -commit<span class="token operator">=</span>true
</code></pre> 
<p>worker 启动之后会连接到 miner 领取任务</p> 
<h5><a id="_miner__worker__153"></a>查看已经连接到 miner 的 worker 列表</h5> 
<pre><code class="prism language-bash">lotus-miner sealing workers
</code></pre> 
<h5><a id="_157"></a>质押扇区，启动挖矿</h5> 
<pre><code class="prism language-bash">lotus-miner sectors pledge <span class="token comment"># 质押一个随机数据的扇区，开始密封</span>
</code></pre> 
<h5><a id="_162"></a>查询当前集群的任务分配情况</h5> 
<pre><code class="prism language-bash">lotus-miner sealing <span class="token function">jobs</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7291ac762769ae4bf7b77ff66774ec26/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C&#43;&#43;数组去重的方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8e1446bcbed99d09e4fba6c9c79a78ca/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">剑指offer47 礼物的最大价值</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>