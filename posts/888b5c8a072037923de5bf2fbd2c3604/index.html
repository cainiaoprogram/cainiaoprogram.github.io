<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>æ·±åº¦å­¦ä¹  Day14â€”â€”P3å¤©æ°”è¯†åˆ« - èœé¸Ÿç¨‹åºå‘˜åšå®¢</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="æ·±åº¦å­¦ä¹  Day14â€”â€”P3å¤©æ°”è¯†åˆ«" />
<meta property="og:description" content="ğŸ¨ æœ¬æ–‡ä¸ºğŸ”—365å¤©æ·±åº¦å­¦ä¹ è®­ç»ƒè¥ ä¸­çš„å­¦ä¹ è®°å½•åšå®¢ğŸ– åŸä½œè€…ï¼šKåŒå­¦å•Š | æ¥è¾…å¯¼ã€é¡¹ç›®å®šåˆ¶ æ–‡ç« ç›®å½• å‰è¨€1 æˆ‘çš„ç¯å¢ƒ2 ä»£ç å®ç°ä¸æ‰§è¡Œç»“æœ2.1 å‰æœŸå‡†å¤‡2.1.1 å¼•å…¥åº“2.1.2 è®¾ç½®GPUï¼ˆå¦‚æœè®¾å¤‡ä¸Šæ”¯æŒGPUå°±ä½¿ç”¨GPU,å¦åˆ™ä½¿ç”¨CPUï¼‰2.1.3 å¯¼å…¥æ•°æ®2.1.4 å¯è§†åŒ–æ•°æ®2.1.4 å›¾åƒæ•°æ®å˜æ¢2.1.4 åˆ’åˆ†æ•°æ®é›†2.1.4 åŠ è½½æ•°æ®2.1.4 æŸ¥çœ‹æ•°æ® 2.2 æ„å»ºCNNç½‘ç»œæ¨¡å‹2.3 è®­ç»ƒæ¨¡å‹2.3.1 è®­ç»ƒæ¨¡å‹2.3.2 ç¼–å†™è®­ç»ƒå‡½æ•°2.3.3 ç¼–å†™æµ‹è¯•å‡½æ•°2.3.4 æ­£å¼è®­ç»ƒ 2.4 ç»“æœå¯è§†åŒ– 3 çŸ¥è¯†ç‚¹è¯¦è§£3.1 torchvision.transforms.Compose()è¯¦è§£3.2 pathlibä¸­globåŒ¹é…å¤šä¸ªæ ¼å¼æ–‡ä»¶è·å–æ•°æ®åˆ—è¡¨3.3 plt.tight_layout()ä½œç”¨3.4 x.view()å‡½æ•°3.5 The freeze_support errorè§£å†³æ–¹æ¡ˆ3.6 æå‡æµ‹è¯•acc--æ”¹å˜ä¼˜åŒ–å™¨ æ€»ç»“ å‰è¨€ æœ¬æ–‡å°†é‡‡ç”¨pytorchæ¡†æ¶åˆ›å»ºCNNç½‘ç»œï¼Œå®ç°å¤©æ°”è¯†åˆ«ã€‚è®²è¿°å®ç°ä»£ç ä¸æ‰§è¡Œç»“æœï¼Œå¹¶æµ…è°ˆæ¶‰åŠçŸ¥è¯†ç‚¹ã€‚
å…³é”®å­—ï¼š torchvision.transforms.Compose()è¯¦è§£,pathlibä¸­globåŒ¹é…å¤šä¸ªæ ¼å¼æ–‡ä»¶è·å–æ•°æ®åˆ—è¡¨,plt.tight_layout()ä½œç”¨,x.view()å‡½æ•°ï¼ŒThe freeze_support errorè§£å†³æ–¹æ¡ˆï¼Œæå‡æµ‹è¯•accâ€“æ”¹å˜ä¼˜åŒ–å™¨ã€‚
1 æˆ‘çš„ç¯å¢ƒ ç”µè„‘ç³»ç»Ÿï¼šWindows 11è¯­è¨€ç¯å¢ƒï¼špython 3.8.6ç¼–è¯‘å™¨ï¼špycharm2020.2.3æ·±åº¦å­¦ä¹ ç¯å¢ƒï¼š
torch == 1.9.1&#43;cu111
torchvision == 0.10.1&#43;cu111æ˜¾å¡ï¼šNVIDIA GeForce RTX 4070 2 ä»£ç å®ç°ä¸æ‰§è¡Œç»“æœ 2.1 å‰æœŸå‡†å¤‡ 2.1.1 å¼•å…¥åº“ import torch import torch.nn as nn from torchvision import transforms, datasets import os from pathlib import Path from PIL import Image from torchinfo import summary import torch." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/888b5c8a072037923de5bf2fbd2c3604/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-14T11:40:30+08:00" />
<meta property="article:modified_time" content="2023-12-14T11:40:30+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="èœé¸Ÿç¨‹åºå‘˜åšå®¢" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">èœé¸Ÿç¨‹åºå‘˜åšå®¢</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">æ·±åº¦å­¦ä¹  Day14â€”â€”P3å¤©æ°”è¯†åˆ«</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <ul><li><strong>ğŸ¨ æœ¬æ–‡ä¸º<a href="https://mp.weixin.qq.com/s/Nb93582M_5usednAKp_Jtw" rel="nofollow">ğŸ”—365å¤©æ·±åº¦å­¦ä¹ è®­ç»ƒè¥</a> ä¸­çš„å­¦ä¹ è®°å½•åšå®¢</strong></li><li><strong>ğŸ– åŸä½œè€…ï¼š<a href="https://mtyjkh.blog.csdn.net/" rel="nofollow">KåŒå­¦å•Š | æ¥è¾…å¯¼ã€é¡¹ç›®å®šåˆ¶</a></strong></li></ul> 
</blockquote> 
<p></p> 
<div class="toc"> 
 <h4>æ–‡ç« ç›®å½•</h4> 
 <ul><li><a href="#_9" rel="nofollow">å‰è¨€</a></li><li><a href="#1__14" rel="nofollow">1 æˆ‘çš„ç¯å¢ƒ</a></li><li><a href="#2__23" rel="nofollow">2 ä»£ç å®ç°ä¸æ‰§è¡Œç»“æœ</a></li><li><ul><li><a href="#21__24" rel="nofollow">2.1 å‰æœŸå‡†å¤‡</a></li><li><ul><li><a href="#211__25" rel="nofollow">2.1.1 å¼•å…¥åº“</a></li><li><a href="#212_GPUGPUGPUCPU_47" rel="nofollow">2.1.2 è®¾ç½®GPUï¼ˆå¦‚æœè®¾å¤‡ä¸Šæ”¯æŒGPUå°±ä½¿ç”¨GPU,å¦åˆ™ä½¿ç”¨CPUï¼‰</a></li><li><a href="#213__61" rel="nofollow">2.1.3 å¯¼å…¥æ•°æ®</a></li><li><a href="#214__77" rel="nofollow">2.1.4 å¯è§†åŒ–æ•°æ®</a></li><li><a href="#214__99" rel="nofollow">2.1.4 å›¾åƒæ•°æ®å˜æ¢</a></li><li><a href="#214__130" rel="nofollow">2.1.4 åˆ’åˆ†æ•°æ®é›†</a></li><li><a href="#214___147" rel="nofollow">2.1.4 åŠ è½½æ•°æ®</a></li><li><a href="#214__162" rel="nofollow">2.1.4 æŸ¥çœ‹æ•°æ®</a></li></ul> 
   </li><li><a href="#22_CNN_179" rel="nofollow">2.2 æ„å»ºCNNç½‘ç»œæ¨¡å‹</a></li><li><a href="#23__258" rel="nofollow">2.3 è®­ç»ƒæ¨¡å‹</a></li><li><ul><li><a href="#231__259" rel="nofollow">2.3.1 è®­ç»ƒæ¨¡å‹</a></li><li><a href="#232__269" rel="nofollow">2.3.2 ç¼–å†™è®­ç»ƒå‡½æ•°</a></li><li><a href="#233__302" rel="nofollow">2.3.3 ç¼–å†™æµ‹è¯•å‡½æ•°</a></li><li><a href="#234__331" rel="nofollow">2.3.4 æ­£å¼è®­ç»ƒ</a></li></ul> 
   </li><li><a href="#24__383" rel="nofollow">2.4 ç»“æœå¯è§†åŒ–</a></li></ul> 
  </li><li><a href="#3__408" rel="nofollow">3 çŸ¥è¯†ç‚¹è¯¦è§£</a></li><li><ul><li><a href="#31_torchvisiontransformsCompose_409" rel="nofollow">3.1 torchvision.transforms.Compose()è¯¦è§£</a></li><li><a href="#32_pathlibglob_438" rel="nofollow">3.2 pathlibä¸­globåŒ¹é…å¤šä¸ªæ ¼å¼æ–‡ä»¶è·å–æ•°æ®åˆ—è¡¨</a></li><li><a href="#33_plttight_layout_456" rel="nofollow">3.3 plt.tight_layout()ä½œç”¨</a></li><li><a href="#34_xview_484" rel="nofollow">3.4 x.view()å‡½æ•°</a></li><li><a href="#35_The_freeze_support_error_514" rel="nofollow">3.5 The freeze_support errorè§£å†³æ–¹æ¡ˆ</a></li><li><a href="#36_acc_539" rel="nofollow">3.6 æå‡æµ‹è¯•acc--æ”¹å˜ä¼˜åŒ–å™¨</a></li></ul> 
  </li><li><a href="#_576" rel="nofollow">æ€»ç»“</a></li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="_9"></a>å‰è¨€</h2> 
<p>æœ¬æ–‡å°†é‡‡ç”¨pytorchæ¡†æ¶åˆ›å»ºCNNç½‘ç»œï¼Œå®ç°å¤©æ°”è¯†åˆ«ã€‚è®²è¿°å®ç°ä»£ç ä¸æ‰§è¡Œç»“æœï¼Œå¹¶æµ…è°ˆæ¶‰åŠçŸ¥è¯†ç‚¹ã€‚<br> å…³é”®å­—ï¼š torchvision.transforms.Compose()è¯¦è§£,pathlibä¸­globåŒ¹é…å¤šä¸ªæ ¼å¼æ–‡ä»¶è·å–æ•°æ®åˆ—è¡¨,plt.tight_layout()ä½œç”¨,x.view()å‡½æ•°ï¼ŒThe freeze_support errorè§£å†³æ–¹æ¡ˆï¼Œæå‡æµ‹è¯•accâ€“æ”¹å˜ä¼˜åŒ–å™¨ã€‚</p> 
<h2><a id="1__14"></a>1 æˆ‘çš„ç¯å¢ƒ</h2> 
<ul><li>ç”µè„‘ç³»ç»Ÿï¼šWindows 11</li><li>è¯­è¨€ç¯å¢ƒï¼špython 3.8.6</li><li>ç¼–è¯‘å™¨ï¼špycharm2020.2.3</li><li>æ·±åº¦å­¦ä¹ ç¯å¢ƒï¼š<br> torch == 1.9.1+cu111<br> torchvision == 0.10.1+cu111</li><li>æ˜¾å¡ï¼šNVIDIA GeForce RTX 4070</li></ul> 
<h2><a id="2__23"></a>2 ä»£ç å®ç°ä¸æ‰§è¡Œç»“æœ</h2> 
<h3><a id="21__24"></a>2.1 å‰æœŸå‡†å¤‡</h3> 
<h4><a id="211__25"></a>2.1.1 å¼•å…¥åº“</h4> 
<pre><code class="prism language-python"><span class="token keyword">import</span> torch
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn

<span class="token keyword">from</span> torchvision <span class="token keyword">import</span> transforms<span class="token punctuation">,</span> datasets
<span class="token keyword">import</span> os
<span class="token keyword">from</span> pathlib <span class="token keyword">import</span> Path
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image
<span class="token keyword">from</span> torchinfo <span class="token keyword">import</span> summary
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>functional <span class="token keyword">as</span> F
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'font.sans-serif'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'SimHei'</span><span class="token punctuation">]</span>  <span class="token comment"># ç”¨æ¥æ­£å¸¸æ˜¾ç¤ºä¸­æ–‡æ ‡ç­¾</span>
plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'axes.unicode_minus'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">False</span>  <span class="token comment"># ç”¨æ¥æ­£å¸¸æ˜¾ç¤ºè´Ÿå·</span>
plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'figure.dpi'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">100</span>  <span class="token comment"># åˆ†è¾¨ç‡</span>
<span class="token keyword">import</span> warnings

warnings<span class="token punctuation">.</span>filterwarnings<span class="token punctuation">(</span><span class="token string">'ignore'</span><span class="token punctuation">)</span>  <span class="token comment"># å¿½ç•¥ä¸€äº›warningå†…å®¹ï¼Œæ— éœ€æ‰“å°</span>
</code></pre> 
<h4><a id="212_GPUGPUGPUCPU_47"></a>2.1.2 è®¾ç½®GPUï¼ˆå¦‚æœè®¾å¤‡ä¸Šæ”¯æŒGPUå°±ä½¿ç”¨GPU,å¦åˆ™ä½¿ç”¨CPUï¼‰</h4> 
<pre><code class="prism language-python"><span class="token triple-quoted-string string">"""å‰æœŸå‡†å¤‡-è®¾ç½®GPU"""</span>
<span class="token comment"># å¦‚æœè®¾å¤‡ä¸Šæ”¯æŒGPUå°±ä½¿ç”¨GPU,å¦åˆ™ä½¿ç”¨CPU</span>
 device <span class="token operator">=</span> torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string">"cuda"</span> <span class="token keyword">if</span> torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>is_available<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token string">"cpu"</span><span class="token punctuation">)</span>
 <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Using {} device"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>è¾“å‡º</p> 
<pre><code>Using cuda device
</code></pre> 
<h4><a id="213__61"></a>2.1.3 å¯¼å…¥æ•°æ®</h4> 
<pre><code class="prism language-python"><span class="token triple-quoted-string string">'''å‰æœŸå·¥ä½œ-å¯¼å…¥æ•°æ®'''</span>
data_dir <span class="token operator">=</span> <span class="token string">"D:/DeepLearning/data/weather_photos/"</span>
data_dir <span class="token operator">=</span> Path<span class="token punctuation">(</span>data_dir<span class="token punctuation">)</span>

data_paths <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>data_dir<span class="token punctuation">.</span>glob<span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
classeNames <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"\\"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">for</span> path <span class="token keyword">in</span> data_paths<span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>classeNames<span class="token punctuation">)</span>
</code></pre> 
<p>è¾“å‡º</p> 
<pre><code>['cloudy', 'rain', 'shine', 'sunrise']
</code></pre> 
<h4><a id="214__77"></a>2.1.4 å¯è§†åŒ–æ•°æ®</h4> 
<pre><code class="prism language-python"><span class="token triple-quoted-string string">'''å‰æœŸå·¥ä½œ-å¯è§†åŒ–æ•°æ®'''</span>
<span class="token comment"># æŒ‡å®šå›¾åƒæ–‡ä»¶å¤¹è·¯å¾„</span>
image_folder <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>data_dir<span class="token punctuation">,</span> <span class="token string">'cloudy/'</span><span class="token punctuation">)</span>
<span class="token comment"># è·å–æ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰å›¾åƒæ–‡ä»¶</span>
image_files <span class="token operator">=</span> <span class="token punctuation">[</span>f <span class="token keyword">for</span> f <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>image_folder<span class="token punctuation">)</span> <span class="token keyword">if</span> f<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">".jpg"</span><span class="token punctuation">,</span> <span class="token string">".png"</span><span class="token punctuation">,</span> <span class="token string">".jpeg"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment"># åˆ›å»ºMatplotlibå›¾åƒ</span>
fig<span class="token punctuation">,</span> axes <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># ä½¿ç”¨åˆ—è¡¨æ¨å¯¼å¼åŠ è½½å’Œæ˜¾ç¤ºå›¾åƒ</span>
<span class="token keyword">for</span> ax<span class="token punctuation">,</span> img_file <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>axes<span class="token punctuation">.</span>flat<span class="token punctuation">,</span> image_files<span class="token punctuation">)</span><span class="token punctuation">:</span>
    img_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>image_folder<span class="token punctuation">,</span> img_file<span class="token punctuation">)</span>
    img <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>img_path<span class="token punctuation">)</span>
    ax<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
    ax<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">'off'</span><span class="token punctuation">)</span>
<span class="token comment"># æ˜¾ç¤ºå›¾åƒ</span>
plt<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/0e/cb/2cQDRpN9_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h4><a id="214__99"></a>2.1.4 å›¾åƒæ•°æ®å˜æ¢</h4> 
<pre><code class="prism language-python"><span class="token triple-quoted-string string">'''å‰æœŸå·¥ä½œ-å›¾åƒæ•°æ®å˜æ¢'''</span>
total_datadir <span class="token operator">=</span> data_dir

<span class="token comment"># å…³äºtransforms.Composeçš„æ›´å¤šä»‹ç»å¯ä»¥å‚è€ƒï¼šhttps://blog.csdn.net/qq_38251616/article/details/124878863</span>
train_transforms <span class="token operator">=</span> transforms<span class="token punctuation">.</span>Compose<span class="token punctuation">(</span><span class="token punctuation">[</span>
    transforms<span class="token punctuation">.</span>Resize<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">224</span><span class="token punctuation">,</span> <span class="token number">224</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># å°†è¾“å…¥å›¾ç‰‡resizeæˆç»Ÿä¸€å°ºå¯¸</span>
    transforms<span class="token punctuation">.</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># å°†PIL Imageæˆ–numpy.ndarrayè½¬æ¢ä¸ºtensorï¼Œå¹¶å½’ä¸€åŒ–åˆ°[0,1]ä¹‹é—´</span>
    transforms<span class="token punctuation">.</span>Normalize<span class="token punctuation">(</span>  <span class="token comment"># æ ‡å‡†åŒ–å¤„ç†--&gt;è½¬æ¢ä¸ºæ ‡å‡†æ­£å¤ªåˆ†å¸ƒï¼ˆé«˜æ–¯åˆ†å¸ƒï¼‰ï¼Œä½¿æ¨¡å‹æ›´å®¹æ˜“æ”¶æ•›</span>
        mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0.485</span><span class="token punctuation">,</span> <span class="token number">0.456</span><span class="token punctuation">,</span> <span class="token number">0.406</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0.229</span><span class="token punctuation">,</span> <span class="token number">0.224</span><span class="token punctuation">,</span> <span class="token number">0.225</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># å…¶ä¸­ mean=[0.485,0.456,0.406]ä¸std=[0.229,0.224,0.225] ä»æ•°æ®é›†ä¸­éšæœºæŠ½æ ·è®¡ç®—å¾—åˆ°çš„ã€‚</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
total_data <span class="token operator">=</span> datasets<span class="token punctuation">.</span>ImageFolder<span class="token punctuation">(</span>total_datadir<span class="token punctuation">,</span> transform<span class="token operator">=</span>train_transforms<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>total_data<span class="token punctuation">)</span>
</code></pre> 
<p>è¾“å‡º</p> 
<pre><code>Dataset ImageFolder
    Number of datapoints: 1125
    Root location: D:\DeepLearning\data\weather_photos
    StandardTransform
Transform: Compose(
               Resize(size=[224, 224], interpolation=bilinear, max_size=None, antialias=None)
               ToTensor()
               Normalize(mean=[0.485, 0.456, 0.406], std=[0.229, 0.224, 0.225])
           )
</code></pre> 
<h4><a id="214__130"></a>2.1.4 åˆ’åˆ†æ•°æ®é›†</h4> 
<pre><code class="prism language-python"><span class="token triple-quoted-string string">'''å‰æœŸå·¥ä½œ-åˆ’åˆ†æ•°æ®é›†'''</span>
train_size <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token number">0.8</span> <span class="token operator">*</span> <span class="token builtin">len</span><span class="token punctuation">(</span>total_data<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># train_sizeè¡¨ç¤ºè®­ç»ƒé›†å¤§å°ï¼Œé€šè¿‡å°†æ€»ä½“æ•°æ®é•¿åº¦çš„80%è½¬æ¢ä¸ºæ•´æ•°å¾—åˆ°ï¼›</span>
test_size <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>total_data<span class="token punctuation">)</span> <span class="token operator">-</span> train_size  <span class="token comment"># test_sizeè¡¨ç¤ºæµ‹è¯•é›†å¤§å°ï¼Œæ˜¯æ€»ä½“æ•°æ®é•¿åº¦å‡å»è®­ç»ƒé›†å¤§å°ã€‚</span>
<span class="token comment"># ä½¿ç”¨torch.utils.data.random_split()æ–¹æ³•è¿›è¡Œæ•°æ®é›†åˆ’åˆ†ã€‚è¯¥æ–¹æ³•å°†æ€»ä½“æ•°æ®total_dataæŒ‰ç…§æŒ‡å®šçš„å¤§å°æ¯”ä¾‹ï¼ˆ[train_size, test_size]ï¼‰éšæœºåˆ’åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œ</span>
<span class="token comment"># å¹¶å°†åˆ’åˆ†ç»“æœåˆ†åˆ«èµ‹å€¼ç»™train_datasetå’Œtest_datasetä¸¤ä¸ªå˜é‡ã€‚</span>
train_dataset<span class="token punctuation">,</span> test_dataset <span class="token operator">=</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data<span class="token punctuation">.</span>random_split<span class="token punctuation">(</span>total_data<span class="token punctuation">,</span> <span class="token punctuation">[</span>train_size<span class="token punctuation">,</span> test_size<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>train_dataset<span class="token punctuation">,</span> test_dataset<span class="token punctuation">)</span>

</code></pre> 
<p>è¾“å‡º</p> 
<pre><code>&lt;torch.utils.data.dataset.Subset object at 0x000001A0144E8D00&gt; &lt;torch.utils.data.dataset.Subset object at 0x000001A0144E8DC0&gt;
</code></pre> 
<h4><a id="214___147"></a>2.1.4 åŠ è½½æ•°æ®</h4> 
<pre><code class="prism language-python"><span class="token triple-quoted-string string">'''å‰æœŸå·¥ä½œ-åŠ è½½æ•°æ®'''</span>
batch_size <span class="token operator">=</span> <span class="token number">32</span>

train_dl <span class="token operator">=</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data<span class="token punctuation">.</span>DataLoader<span class="token punctuation">(</span>train_dataset<span class="token punctuation">,</span>
                                       batch_size<span class="token operator">=</span>batch_size<span class="token punctuation">,</span>
                                       shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
                                       num_workers<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
test_dl <span class="token operator">=</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data<span class="token punctuation">.</span>DataLoader<span class="token punctuation">(</span>test_dataset<span class="token punctuation">,</span>
                                      batch_size<span class="token operator">=</span>batch_size<span class="token punctuation">,</span>
                                      shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
                                      num_workers<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="214__162"></a>2.1.4 æŸ¥çœ‹æ•°æ®</h4> 
<pre><code class="prism language-python"><span class="token triple-quoted-string string">'''å‰æœŸå·¥ä½œ-æŸ¥çœ‹æ•°æ®'''</span>
<span class="token keyword">for</span> X<span class="token punctuation">,</span> y <span class="token keyword">in</span> test_dl<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Shape of X [N, C, H, W]: "</span><span class="token punctuation">,</span> X<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Shape of y: "</span><span class="token punctuation">,</span> y<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> y<span class="token punctuation">.</span>dtype<span class="token punctuation">)</span>
    <span class="token keyword">break</span>
</code></pre> 
<p>è¾“å‡º</p> 
<pre><code>Shape of X [N, C, H, W]:  torch.Size([32, 3, 224, 224])
Shape of y:  torch.Size([32]) torch.int64
</code></pre> 
<h3><a id="22_CNN_179"></a>2.2 æ„å»ºCNNç½‘ç»œæ¨¡å‹</h3> 
<p><img src="https://images2.imgbox.com/02/75/OheJBSoC_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<pre><code class="prism language-python"><span class="token triple-quoted-string string">"""æ„å»ºCNNç½‘ç»œ"""</span>
<span class="token keyword">class</span> <span class="token class-name">Network_bn</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>Network_bn<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token triple-quoted-string string">"""
        nn.Conv2d()å‡½æ•°ï¼š
        ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆin_channelsï¼‰æ˜¯è¾“å…¥çš„channelæ•°é‡
        ç¬¬äºŒä¸ªå‚æ•°ï¼ˆout_channelsï¼‰æ˜¯è¾“å‡ºçš„channelæ•°é‡
        ç¬¬ä¸‰ä¸ªå‚æ•°ï¼ˆkernel_sizeï¼‰æ˜¯å·ç§¯æ ¸å¤§å°
        ç¬¬å››ä¸ªå‚æ•°ï¼ˆstrideï¼‰æ˜¯æ­¥é•¿ï¼Œé»˜è®¤ä¸º1
        ç¬¬äº”ä¸ªå‚æ•°ï¼ˆpaddingï¼‰æ˜¯å¡«å……å¤§å°ï¼Œé»˜è®¤ä¸º0
        """</span>
        self<span class="token punctuation">.</span>conv1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>in_channels<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> out_channels<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>bn1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>in_channels<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">,</span> out_channels<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>bn2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pool <span class="token operator">=</span> nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv4 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>in_channels<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">,</span> out_channels<span class="token operator">=</span><span class="token number">24</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>bn4 <span class="token operator">=</span> nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv5 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>in_channels<span class="token operator">=</span><span class="token number">24</span><span class="token punctuation">,</span> out_channels<span class="token operator">=</span><span class="token number">24</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>bn5 <span class="token operator">=</span> nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>fc1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">24</span> <span class="token operator">*</span> <span class="token number">50</span> <span class="token operator">*</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>classeNames<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>bn1<span class="token punctuation">(</span>self<span class="token punctuation">.</span>conv1<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        x <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>bn2<span class="token punctuation">(</span>self<span class="token punctuation">.</span>conv2<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>pool<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        x <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>bn4<span class="token punctuation">(</span>self<span class="token punctuation">.</span>conv4<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        x <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>bn5<span class="token punctuation">(</span>self<span class="token punctuation">.</span>conv5<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>pool<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        x <span class="token operator">=</span> x<span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">50</span> <span class="token operator">*</span> <span class="token number">50</span><span class="token punctuation">)</span>
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>fc1<span class="token punctuation">(</span>x<span class="token punctuation">)</span>

        <span class="token keyword">return</span> x
        
model <span class="token operator">=</span> Network_bn<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span>
summary<span class="token punctuation">(</span>model<span class="token punctuation">)</span>        
</code></pre> 
<p>è¾“å‡º</p> 
<pre><code>Network_bn(
  (conv1): Conv2d(3, 12, kernel_size=(5, 5), stride=(1, 1))
  (bn1): BatchNorm2d(12, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
  (conv2): Conv2d(12, 12, kernel_size=(5, 5), stride=(1, 1))
  (bn2): BatchNorm2d(12, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
  (pool): MaxPool2d(kernel_size=2, stride=2, padding=0, dilation=1, ceil_mode=False)
  (conv4): Conv2d(12, 24, kernel_size=(5, 5), stride=(1, 1))
  (bn4): BatchNorm2d(24, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
  (conv5): Conv2d(24, 24, kernel_size=(5, 5), stride=(1, 1))
  (bn5): BatchNorm2d(24, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
  (fc1): Linear(in_features=60000, out_features=4, bias=True)
)
=================================================================
Layer (type:depth-idx)                   Param #
=================================================================
Network_bn                               --
â”œâ”€Conv2d: 1-1                            912
â”œâ”€BatchNorm2d: 1-2                       24
â”œâ”€Conv2d: 1-3                            3,612
â”œâ”€BatchNorm2d: 1-4                       24
â”œâ”€MaxPool2d: 1-5                         --
â”œâ”€Conv2d: 1-6                            7,224
â”œâ”€BatchNorm2d: 1-7                       48
â”œâ”€Conv2d: 1-8                            14,424
â”œâ”€BatchNorm2d: 1-9                       48
â”œâ”€Linear: 1-10                           240,004
=================================================================
Total params: 266,320
Trainable params: 266,320
Non-trainable params: 0
=================================================================
</code></pre> 
<h3><a id="23__258"></a>2.3 è®­ç»ƒæ¨¡å‹</h3> 
<h4><a id="231__259"></a>2.3.1 è®­ç»ƒæ¨¡å‹</h4> 
<pre><code class="prism language-python"><span class="token triple-quoted-string string">"""è®­ç»ƒæ¨¡å‹--è®¾ç½®è¶…å‚æ•°"""</span>
loss_fn <span class="token operator">=</span> nn<span class="token punctuation">.</span>CrossEntropyLoss<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># åˆ›å»ºæŸå¤±å‡½æ•°ï¼Œè®¡ç®—å®é™…è¾“å‡ºå’ŒçœŸå®ç›¸å·®å¤šå°‘ï¼Œäº¤å‰ç†µæŸå¤±å‡½æ•°ï¼Œäº‹å®ä¸Šï¼Œå®ƒå°±æ˜¯åšå›¾ç‰‡åˆ†ç±»ä»»åŠ¡æ—¶å¸¸ç”¨çš„æŸå¤±å‡½æ•°</span>
learn_rate <span class="token operator">=</span> <span class="token number">1e-4</span>  <span class="token comment"># å­¦ä¹ ç‡</span>
opt <span class="token operator">=</span> torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>SGD<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span>learn_rate<span class="token punctuation">)</span>  <span class="token comment"># ä½œç”¨æ˜¯å®šä¹‰ä¼˜åŒ–å™¨ï¼Œç”¨æ¥è®­ç»ƒæ—¶å€™ä¼˜åŒ–æ¨¡å‹å‚æ•°ï¼›å…¶ä¸­ï¼ŒSGDè¡¨ç¤ºéšæœºæ¢¯åº¦ä¸‹é™ï¼Œç”¨äºæ§åˆ¶å®é™…è¾“å‡ºyä¸çœŸå®yä¹‹é—´çš„ç›¸å·®æœ‰å¤šå¤§</span>

</code></pre> 
<h4><a id="232__269"></a>2.3.2 ç¼–å†™è®­ç»ƒå‡½æ•°</h4> 
<pre><code class="prism language-python"><span class="token triple-quoted-string string">"""è®­ç»ƒæ¨¡å‹--ç¼–å†™è®­ç»ƒå‡½æ•°"""</span>
<span class="token comment"># è®­ç»ƒå¾ªç¯</span>
<span class="token keyword">def</span> <span class="token function">train</span><span class="token punctuation">(</span>dataloader<span class="token punctuation">,</span> model<span class="token punctuation">,</span> loss_fn<span class="token punctuation">,</span> optimizer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    size <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>dataloader<span class="token punctuation">.</span>dataset<span class="token punctuation">)</span>  <span class="token comment"># è®­ç»ƒé›†çš„å¤§å°ï¼Œä¸€å…±60000å¼ å›¾ç‰‡</span>
    num_batches <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>dataloader<span class="token punctuation">)</span>  <span class="token comment"># æ‰¹æ¬¡æ•°ç›®ï¼Œ1875ï¼ˆ60000/32ï¼‰</span>

    train_loss<span class="token punctuation">,</span> train_acc <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span>  <span class="token comment"># åˆå§‹åŒ–è®­ç»ƒæŸå¤±å’Œæ­£ç¡®ç‡</span>

    <span class="token keyword">for</span> X<span class="token punctuation">,</span> y <span class="token keyword">in</span> dataloader<span class="token punctuation">:</span>  <span class="token comment"># åŠ è½½æ•°æ®åŠ è½½å™¨ï¼Œå¾—åˆ°é‡Œé¢çš„ Xï¼ˆå›¾ç‰‡æ•°æ®ï¼‰å’Œ yï¼ˆçœŸå®æ ‡ç­¾ï¼‰</span>
        X<span class="token punctuation">,</span> y <span class="token operator">=</span> X<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span> <span class="token comment"># ç”¨äºå°†æ•°æ®å­˜åˆ°æ˜¾å¡</span>

        <span class="token comment"># è®¡ç®—é¢„æµ‹è¯¯å·®</span>
        pred <span class="token operator">=</span> model<span class="token punctuation">(</span>X<span class="token punctuation">)</span>  <span class="token comment"># ç½‘ç»œè¾“å‡º</span>
        loss <span class="token operator">=</span> loss_fn<span class="token punctuation">(</span>pred<span class="token punctuation">,</span> y<span class="token punctuation">)</span>  <span class="token comment"># è®¡ç®—ç½‘ç»œè¾“å‡ºå’ŒçœŸå®å€¼ä¹‹é—´çš„å·®è·ï¼Œtargetsä¸ºçœŸå®å€¼ï¼Œè®¡ç®—äºŒè€…å·®å€¼å³ä¸ºæŸå¤±</span>

        <span class="token comment"># åå‘ä¼ æ’­</span>
        optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># æ¸…ç©ºè¿‡å¾€æ¢¯åº¦</span>
        loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># åå‘ä¼ æ’­ï¼Œè®¡ç®—å½“å‰æ¢¯åº¦</span>
        optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># æ ¹æ®æ¢¯åº¦æ›´æ–°ç½‘ç»œå‚æ•°</span>

        <span class="token comment"># è®°å½•accä¸loss</span>
        train_acc <span class="token operator">+=</span> <span class="token punctuation">(</span>pred<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> y<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">type</span><span class="token punctuation">(</span>torch<span class="token punctuation">.</span><span class="token builtin">float</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span>
        train_loss <span class="token operator">+=</span> loss<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span>

    train_acc <span class="token operator">/=</span> size
    train_loss <span class="token operator">/=</span> num_batches

    <span class="token keyword">return</span> train_acc<span class="token punctuation">,</span> train_loss
</code></pre> 
<h4><a id="233__302"></a>2.3.3 ç¼–å†™æµ‹è¯•å‡½æ•°</h4> 
<pre><code class="prism language-python"><span class="token triple-quoted-string string">"""è®­ç»ƒæ¨¡å‹--ç¼–å†™æµ‹è¯•å‡½æ•°"""</span>
<span class="token comment"># æµ‹è¯•å‡½æ•°å’Œè®­ç»ƒå‡½æ•°å¤§è‡´ç›¸åŒï¼Œä½†æ˜¯ç”±äºä¸è¿›è¡Œæ¢¯åº¦ä¸‹é™å¯¹ç½‘ç»œæƒé‡è¿›è¡Œæ›´æ–°ï¼Œæ‰€ä»¥ä¸éœ€è¦ä¼ å…¥ä¼˜åŒ–å™¨</span>
<span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>dataloader<span class="token punctuation">,</span> model<span class="token punctuation">,</span> loss_fn<span class="token punctuation">)</span><span class="token punctuation">:</span>
    size <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>dataloader<span class="token punctuation">.</span>dataset<span class="token punctuation">)</span>  <span class="token comment"># æµ‹è¯•é›†çš„å¤§å°ï¼Œä¸€å…±10000å¼ å›¾ç‰‡</span>
    num_batches <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>dataloader<span class="token punctuation">)</span>  <span class="token comment"># æ‰¹æ¬¡æ•°ç›®ï¼Œ313ï¼ˆ10000/32=312.5ï¼Œå‘ä¸Šå–æ•´ï¼‰</span>
    test_loss<span class="token punctuation">,</span> test_acc <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span>

    <span class="token comment"># å½“ä¸è¿›è¡Œè®­ç»ƒæ—¶ï¼Œåœæ­¢æ¢¯åº¦æ›´æ–°ï¼ŒèŠ‚çœè®¡ç®—å†…å­˜æ¶ˆè€—</span>
    <span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># æµ‹è¯•æ—¶æ¨¡å‹å‚æ•°ä¸ç”¨æ›´æ–°ï¼Œæ‰€ä»¥ no_gradï¼Œæ•´ä¸ªæ¨¡å‹å‚æ•°æ­£å‘æ¨å°±okï¼Œä¸åå‘æ›´æ–°å‚æ•°</span>
        <span class="token keyword">for</span> imgs<span class="token punctuation">,</span> target <span class="token keyword">in</span> dataloader<span class="token punctuation">:</span>
            imgs<span class="token punctuation">,</span> target <span class="token operator">=</span> imgs<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token punctuation">,</span> target<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>

            <span class="token comment"># è®¡ç®—loss</span>
            target_pred <span class="token operator">=</span> model<span class="token punctuation">(</span>imgs<span class="token punctuation">)</span>
            loss <span class="token operator">=</span> loss_fn<span class="token punctuation">(</span>target_pred<span class="token punctuation">,</span> target<span class="token punctuation">)</span>

            test_loss <span class="token operator">+=</span> loss<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span>
            test_acc <span class="token operator">+=</span> <span class="token punctuation">(</span>target_pred<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> target<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">type</span><span class="token punctuation">(</span>torch<span class="token punctuation">.</span><span class="token builtin">float</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#ç»Ÿè®¡é¢„æµ‹æ­£ç¡®çš„ä¸ªæ•°</span>

    test_acc <span class="token operator">/=</span> size
    test_loss <span class="token operator">/=</span> num_batches

    <span class="token keyword">return</span> test_acc<span class="token punctuation">,</span> test_loss

</code></pre> 
<h4><a id="234__331"></a>2.3.4 æ­£å¼è®­ç»ƒ</h4> 
<pre><code class="prism language-python"><span class="token triple-quoted-string string">"""è®­ç»ƒæ¨¡å‹--æ­£å¼è®­ç»ƒ"""</span>
epochs <span class="token operator">=</span> <span class="token number">20</span>
train_loss <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
train_acc <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
test_loss <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
test_acc <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token keyword">for</span> epoch <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>epochs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    model<span class="token punctuation">.</span>train<span class="token punctuation">(</span><span class="token punctuation">)</span>
    epoch_train_acc<span class="token punctuation">,</span> epoch_train_loss <span class="token operator">=</span> train<span class="token punctuation">(</span>train_dl<span class="token punctuation">,</span> model<span class="token punctuation">,</span> loss_fn<span class="token punctuation">,</span> opt<span class="token punctuation">)</span>

    model<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    epoch_test_acc<span class="token punctuation">,</span> epoch_test_loss <span class="token operator">=</span> test<span class="token punctuation">(</span>test_dl<span class="token punctuation">,</span> model<span class="token punctuation">,</span> loss_fn<span class="token punctuation">)</span>

    train_acc<span class="token punctuation">.</span>append<span class="token punctuation">(</span>epoch_train_acc<span class="token punctuation">)</span>
    train_loss<span class="token punctuation">.</span>append<span class="token punctuation">(</span>epoch_train_loss<span class="token punctuation">)</span>
    test_acc<span class="token punctuation">.</span>append<span class="token punctuation">(</span>epoch_test_acc<span class="token punctuation">)</span>
    test_loss<span class="token punctuation">.</span>append<span class="token punctuation">(</span>epoch_test_loss<span class="token punctuation">)</span>

    template <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'Epoch:{:2d}, Train_acc:{:.1f}%, Train_loss:{:.3f}, Test_acc:{:.1f}%ï¼ŒTest_loss:{:.3f}'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>template<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>epoch <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> epoch_train_acc <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">,</span> epoch_train_loss<span class="token punctuation">,</span> epoch_test_acc <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">,</span> epoch_test_loss<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Done'</span><span class="token punctuation">)</span>
</code></pre> 
<p>è¾“å‡º</p> 
<pre><code>Epoch: 1, Train_acc:55.8%, Train_loss:1.098, Test_acc:58.7%ï¼ŒTest_loss:1.073
Epoch: 2, Train_acc:79.8%, Train_loss:0.682, Test_acc:74.2%ï¼ŒTest_loss:1.073
Epoch: 3, Train_acc:83.7%, Train_loss:0.536, Test_acc:78.2%ï¼ŒTest_loss:0.552
Epoch: 4, Train_acc:85.3%, Train_loss:0.472, Test_acc:80.9%ï¼ŒTest_loss:0.466
Epoch: 5, Train_acc:88.4%, Train_loss:0.412, Test_acc:82.7%ï¼ŒTest_loss:0.477
Epoch: 6, Train_acc:88.8%, Train_loss:0.367, Test_acc:88.0%ï¼ŒTest_loss:0.418
Epoch: 7, Train_acc:90.7%, Train_loss:0.318, Test_acc:88.4%ï¼ŒTest_loss:0.411
Epoch: 8, Train_acc:91.4%, Train_loss:0.288, Test_acc:86.2%ï¼ŒTest_loss:0.371
Epoch: 9, Train_acc:91.8%, Train_loss:0.289, Test_acc:86.7%ï¼ŒTest_loss:0.377
Epoch:10, Train_acc:91.4%, Train_loss:0.282, Test_acc:89.3%ï¼ŒTest_loss:0.342
Epoch:11, Train_acc:93.1%, Train_loss:0.248, Test_acc:89.3%ï¼ŒTest_loss:0.332
Epoch:12, Train_acc:93.6%, Train_loss:0.230, Test_acc:87.6%ï¼ŒTest_loss:0.344
Epoch:13, Train_acc:94.8%, Train_loss:0.216, Test_acc:88.9%ï¼ŒTest_loss:0.381
Epoch:14, Train_acc:94.2%, Train_loss:0.206, Test_acc:87.6%ï¼ŒTest_loss:0.340
Epoch:15, Train_acc:94.8%, Train_loss:0.199, Test_acc:88.4%ï¼ŒTest_loss:0.316
Epoch:16, Train_acc:94.7%, Train_loss:0.205, Test_acc:88.4%ï¼ŒTest_loss:0.475
Epoch:17, Train_acc:95.7%, Train_loss:0.222, Test_acc:86.7%ï¼ŒTest_loss:0.340
Epoch:18, Train_acc:96.1%, Train_loss:0.200, Test_acc:88.0%ï¼ŒTest_loss:0.319
Epoch:19, Train_acc:95.4%, Train_loss:0.182, Test_acc:88.4%ï¼ŒTest_loss:0.337
Epoch:20, Train_acc:96.8%, Train_loss:0.192, Test_acc:89.3%ï¼ŒTest_loss:0.304
Done
</code></pre> 
<h3><a id="24__383"></a>2.4 ç»“æœå¯è§†åŒ–</h3> 
<pre><code class="prism language-python"><span class="token triple-quoted-string string">"""è®­ç»ƒæ¨¡å‹--ç»“æœå¯è§†åŒ–"""</span>
epochs_range <span class="token operator">=</span> <span class="token builtin">range</span><span class="token punctuation">(</span>epochs<span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>epochs_range<span class="token punctuation">,</span> train_acc<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Training Accuracy'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>epochs_range<span class="token punctuation">,</span> test_acc<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Test Accuracy'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span>loc<span class="token operator">=</span><span class="token string">'lower right'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Training and Validation Accuracy'</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>epochs_range<span class="token punctuation">,</span> train_loss<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Training Loss'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>epochs_range<span class="token punctuation">,</span> test_loss<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Test Loss'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span>loc<span class="token operator">=</span><span class="token string">'upper right'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Training and Validation Loss'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/b9/85/LRTSifbD_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h2><a id="3__408"></a>3 çŸ¥è¯†ç‚¹è¯¦è§£</h2> 
<h3><a id="31_torchvisiontransformsCompose_409"></a>3.1 torchvision.transforms.Compose()è¯¦è§£</h3> 
<p>torchvisionæ˜¯pytorchçš„ä¸€ä¸ªå›¾å½¢åº“ï¼Œå®ƒæœåŠ¡äºPyTorchæ·±åº¦å­¦ä¹ æ¡†æ¶çš„ï¼Œä¸»è¦ç”¨æ¥æ„å»ºè®¡ç®—æœºè§†è§‰æ¨¡å‹ã€‚torchvision.transformsä¸»è¦æ˜¯ç”¨äºå¸¸è§çš„ä¸€äº›å›¾å½¢å˜æ¢ã€‚ä»¥ä¸‹æ˜¯torchvisionçš„æ„æˆï¼š</p> 
<p>1.torchvision.datasets: ä¸€äº›åŠ è½½æ•°æ®çš„å‡½æ•°åŠå¸¸ç”¨çš„æ•°æ®é›†æ¥å£ï¼›<br> 2.torchvision.models: åŒ…å«å¸¸ç”¨çš„æ¨¡å‹ç»“æ„ï¼ˆå«é¢„è®­ç»ƒæ¨¡å‹ï¼‰ï¼Œä¾‹å¦‚AlexNetã€VGGã€ResNetç­‰ï¼›<br> 3.torchvision.transforms: å¸¸ç”¨çš„å›¾ç‰‡å˜æ¢ï¼Œä¾‹å¦‚è£å‰ªã€æ—‹è½¬ç­‰ï¼›<br> 4.torchvision.utils: å…¶ä»–çš„ä¸€äº›æœ‰ç”¨çš„æ–¹æ³•ã€‚</p> 
<pre><code class="prism language-python">torchvision<span class="token punctuation">.</span>transforms<span class="token punctuation">.</span>Compose<span class="token punctuation">(</span><span class="token punctuation">)</span>ç±»çš„ä¸»è¦ä½œç”¨æ˜¯ä¸²è”å¤šä¸ªå›¾ç‰‡å˜æ¢çš„æ“ä½œã€‚

<span class="token keyword">from</span> torchvision<span class="token punctuation">.</span>transforms <span class="token keyword">import</span> transforms

train_transforms <span class="token operator">=</span> transforms<span class="token punctuation">.</span>Compose<span class="token punctuation">(</span><span class="token punctuation">[</span>
    transforms<span class="token punctuation">.</span>Resize<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">224</span><span class="token punctuation">,</span> <span class="token number">224</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token comment"># å°†è¾“å…¥å›¾ç‰‡resizeæˆç»Ÿä¸€å°ºå¯¸</span>
    transforms<span class="token punctuation">.</span>RandomRotation<span class="token punctuation">(</span>degrees<span class="token operator">=</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>   <span class="token comment"># éšæœºæ—‹è½¬ï¼Œ-10åˆ°10åº¦ä¹‹é—´éšæœºé€‰</span>
    transforms<span class="token punctuation">.</span>RandomHorizontalFlip<span class="token punctuation">(</span>p<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>         <span class="token comment"># éšæœºæ°´å¹³ç¿»è½¬ é€‰æ‹©ä¸€ä¸ªæ¦‚ç‡æ¦‚ç‡</span>
    transforms<span class="token punctuation">.</span>RandomVerticalFlip<span class="token punctuation">(</span>p<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>           <span class="token comment"># éšæœºå‚ç›´ç¿»è½¬</span>
    transforms<span class="token punctuation">.</span>RandomPerspective<span class="token punctuation">(</span>distortion_scale<span class="token operator">=</span><span class="token number">0.6</span><span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment"># éšæœºè§†è§’</span>
    transforms<span class="token punctuation">.</span>GaussianBlur<span class="token punctuation">(</span>kernel_size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sigma<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># éšæœºé€‰æ‹©çš„é«˜æ–¯æ¨¡ç³Šæ¨¡ç³Šå›¾åƒ</span>
    transforms<span class="token punctuation">.</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token comment"># å°†PIL Imageæˆ–numpy.ndarrayè½¬æ¢ä¸ºtensorï¼Œå¹¶å½’ä¸€åŒ–åˆ°[0,1]ä¹‹é—´</span>
    transforms<span class="token punctuation">.</span>Normalize<span class="token punctuation">(</span>           <span class="token comment"># æ ‡å‡†åŒ–å¤„ç†--&gt;è½¬æ¢ä¸ºæ ‡å‡†æ­£å¤ªåˆ†å¸ƒï¼ˆé«˜æ–¯åˆ†å¸ƒï¼‰ï¼Œä½¿æ¨¡å‹æ›´å®¹æ˜“æ”¶æ•›</span>
        mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0.485</span><span class="token punctuation">,</span> <span class="token number">0.456</span><span class="token punctuation">,</span> <span class="token number">0.406</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
        std <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.229</span><span class="token punctuation">,</span> <span class="token number">0.224</span><span class="token punctuation">,</span> <span class="token number">0.225</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># å…¶ä¸­ mean=[0.485,0.456,0.406]ä¸std=[0.229,0.224,0.225] ä»æ•°æ®é›†ä¸­éšæœºæŠ½æ ·è®¡ç®—å¾—åˆ°çš„ã€‚</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p>å‚è€ƒé“¾æ¥:<a href="https://blog.csdn.net/qq_38251616/article/details/124878863">torchvision.transforms.Compose()è¯¦è§£ã€Pytorchå…¥é—¨æ‰‹å†Œã€‘</a></p> 
<h3><a id="32_pathlibglob_438"></a>3.2 pathlibä¸­globåŒ¹é…å¤šä¸ªæ ¼å¼æ–‡ä»¶è·å–æ•°æ®åˆ—è¡¨</h3> 
<p>å¯è§†åŒ–æ•°æ®å¯ç”¨å¦ä¸€ç§æ–¹å¼æ˜¾ç¤º</p> 
<pre><code class="prism language-python"><span class="token triple-quoted-string string">'''æ•°æ®é¢„å¤„ç†-å¯è§†åŒ–æ•°æ®'''</span>
    cloudyPath <span class="token operator">=</span> Path<span class="token punctuation">(</span>data_dir<span class="token punctuation">)</span><span class="token operator">/</span><span class="token string">"cloudy"</span>
    image_files <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>resolve<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> p <span class="token keyword">in</span> cloudyPath<span class="token punctuation">.</span>glob<span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">)</span> <span class="token keyword">if</span> p<span class="token punctuation">.</span>suffix <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">".jpg"</span><span class="token punctuation">,</span> <span class="token string">".png"</span><span class="token punctuation">,</span> <span class="token string">".jpeg"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>image_files<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">24</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        image_file <span class="token operator">=</span> image_files<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
        img <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>image_file<span class="token punctuation">)</span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">"off"</span><span class="token punctuation">)</span>
    <span class="token comment"># æ˜¾ç¤ºå›¾ç‰‡</span>
    plt<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="33_plttight_layout_456"></a>3.3 plt.tight_layout()ä½œç”¨</h3> 
<p>tight_layoutä¼šè‡ªåŠ¨è°ƒæ•´å­å›¾å‚æ•°ï¼Œä½¿ä¹‹å¡«å……æ•´ä¸ªå›¾åƒåŒºåŸŸã€‚è¿™æ˜¯ä¸ªå®éªŒç‰¹æ€§ï¼Œå¯èƒ½åœ¨ä¸€äº›æƒ…å†µä¸‹ä¸å·¥ä½œã€‚å®ƒä»…ä»…æ£€æŸ¥åæ ‡è½´æ ‡ç­¾ã€åˆ»åº¦æ ‡ç­¾ä»¥åŠæ ‡é¢˜çš„éƒ¨åˆ†ã€‚</p> 
<p>å½“ä½ æ‹¥æœ‰å¤šä¸ªå­å›¾æ—¶ï¼Œä½ ä¼šç»å¸¸çœ‹åˆ°ä¸åŒè½´åŸŸçš„æ ‡ç­¾å åœ¨ä¸€èµ·ã€‚</p> 
<pre><code class="prism language-python">plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'savefig.facecolor'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"0.8"</span>

<span class="token keyword">def</span> <span class="token function">example_plot</span><span class="token punctuation">(</span>ax<span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
     ax<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
     ax<span class="token punctuation">.</span>locator_params<span class="token punctuation">(</span>nbins<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
     ax<span class="token punctuation">.</span>set_xlabel<span class="token punctuation">(</span><span class="token string">'x-label'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span>fontsize<span class="token punctuation">)</span>
     ax<span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span><span class="token string">'y-label'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span>fontsize<span class="token punctuation">)</span>
     ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">'Title'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span>fontsize<span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token string">'all'</span><span class="token punctuation">)</span>
fig<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>ax1<span class="token punctuation">,</span> ax2<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>ax3<span class="token punctuation">,</span> ax4<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span>nrows<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> ncols<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
example_plot<span class="token punctuation">(</span>ax1<span class="token punctuation">)</span>
example_plot<span class="token punctuation">(</span>ax2<span class="token punctuation">)</span>
example_plot<span class="token punctuation">(</span>ax3<span class="token punctuation">)</span>
example_plot<span class="token punctuation">(</span>ax4<span class="token punctuation">)</span>
</code></pre> 
<p>äº§ç”Ÿå›¾ç‰‡ï¼š<br> <img src="https://images2.imgbox.com/ce/35/wcCJzX0N_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> å¢åŠ plt.tight_layout()ä¼šè°ƒæ•´å­å›¾ä¹‹é—´çš„é—´éš”æ¥å‡å°‘å †å ã€‚<br> <img src="https://images2.imgbox.com/d4/09/6eOthUCB_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> å‚è€ƒé“¾æ¥ï¼š<a href="https://blog.csdn.net/love1005lin/article/details/116697085">plt.tight_layout()</a></p> 
<h3><a id="34_xview_484"></a>3.4 x.view()å‡½æ•°</h3> 
<p>åœ¨æ„å»ºç¥ç»ç½‘ç»œçš„æ—¶å€™ï¼Œç»å¸¸ä¼šç”¨åˆ°x.view()å‡½æ•°ï¼Œå®é™…ä¸Šviewï¼ˆï¼‰ç±»ä¼¼äºreshapeï¼ˆï¼‰çš„ç”¨æ³•ï¼Œå°†å¼ é‡é‡æ–°è§„åˆ’æ ¼å¼ï¼Œæœ¬æ–‡å°†ç®€å•ä»‹ç»è¿™ä¸ªå‡½æ•°çš„ç”¨æ³•ã€‚</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> torch

a <span class="token operator">=</span> torch<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">17</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
a <span class="token operator">=</span> a<span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
</code></pre> 
<p>è¾“å‡º</p> 
<pre><code>torch.Size([16])
tensor([ 1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16])
torch.Size([4, 4])
tensor([[ 1,  2,  3,  4],
        [ 5,  6,  7,  8],
        [ 9, 10, 11, 12],
        [13, 14, 15, 16]])
</code></pre> 
<p>è¿™é‡Œviewçš„ç¬¬ä¸€ä¸ªå‚æ•°æœ‰æ—¶ä¼šæ˜¯-1ï¼Œ-1ä»£è¡¨ä¸ç¡®å®šï¼Œè¡Œæ•°å°†ç”±å¼ é‡çš„é•¿åº¦é™¤ä»¥åˆ—æ•°å†³å®šï¼Œä¹Ÿå°±æ˜¯è¯´<br> a.view(-1,4) == a.view(4,4)<br> a.view(-1,8) == a.view(2,8)</p> 
<p>å‚è€ƒé“¾æ¥ï¼š<a href="https://blog.51cto.com/u_14597003/5988978" rel="nofollow">x.view(-1,4)</a></p> 
<h3><a id="35_The_freeze_support_error_514"></a>3.5 The freeze_support errorè§£å†³æ–¹æ¡ˆ</h3> 
<pre><code>RuntimeError:
       An attempt has been made to start a new process before the
       current process has finished its bootstrapping phase.

   This probably means that you are not using fork to start your
   child processes and you have forgotten to use the proper idiom
   in the main module:

       if __name__ == '__main__':
           freeze_support()
           ...

   The "freeze_support()" line can be omitted if the program
   is not going to be frozen to produce an executable.
</code></pre> 
<p>è¿™ä¸ªé”™è¯¯ç›¸ä¿¡å¾ˆå¤šäººéƒ½ç¢°åˆ°è¿‡ï¼Œå°±æ˜¯ï¼Œåœ¨Linuxä¸­å¯ä»¥å¾ˆå¥½è¿è¡Œçš„ä»£ç ï¼Œåœ¨Windowsä¸­ä¼šç»™å‡ºè¿™æ ·çš„é”™è¯¯ã€‚<br> ç©¶å…¶åŸå› ï¼Œå¾€å¾€å‡ºç°åœ¨multiprocessä¸Šã€‚å½“ç¨‹åºä¸­è°ƒç”¨ multiprocesså‡½æ•°ï¼Œå´ä¸æ˜¯åœ¨mainä¸­æ—¶ï¼Œä¼šå‡ºç°è¿™æ ·çš„æŠ¥é”™ã€‚</p> 
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong><br> å†™ä¸€ä¸ªmainå‡½æ•°ï¼Œç„¶ååœ¨if <strong>name</strong> == â€˜<strong>main</strong>â€™:ä¸­è¿è¡Œè¿™ä¸ªmainå‡½æ•°ã€‚æŠŠé‚£äº›å¼•ç”¨multiprocessingçš„å‡½æ•°ä½œéƒ½æ”¾åˆ°main()å‡½æ•°é‡Œå»æ‰§è¡Œå°±OKäº†ã€‚<br> å‚è€ƒé“¾æ¥ï¼š<a href="https://juejin.cn/post/6844904195972136974" rel="nofollow">Windows freeze_support Error: An attempt has been made to start a new process</a></p> 
<h3><a id="36_acc_539"></a>3.6 æå‡æµ‹è¯•accâ€“æ”¹å˜ä¼˜åŒ–å™¨</h3> 
<p>åŸæ–‡ä¼˜åŒ–å™¨è®¾ç½®ä¸ºSDG</p> 
<pre><code class="prism language-python">opt <span class="token operator">=</span> torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span>learn_rate<span class="token punctuation">)</span> 
</code></pre> 
<p>å˜æ›´ä¼˜åŒ–å™¨ä¸ºAdamåï¼Œä»£ç å¦‚ä¸‹</p> 
<pre><code class="prism language-python">opt <span class="token operator">=</span> torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span>learn_rate<span class="token punctuation">)</span> 
</code></pre> 
<p>å˜æ›´åï¼Œæµ‹è¯•ç²¾åº¦æå‡</p> 
<pre><code>Epoch: 2, Train_acc:84.2%, Train_loss:0.435, Test_acc:90.2%ï¼ŒTest_loss:0.257
Epoch: 3, Train_acc:89.1%, Train_loss:0.323, Test_acc:84.9%ï¼ŒTest_loss:0.481
Epoch: 4, Train_acc:89.3%, Train_loss:0.346, Test_acc:91.6%ï¼ŒTest_loss:0.218
Epoch: 5, Train_acc:91.3%, Train_loss:0.272, Test_acc:92.9%ï¼ŒTest_loss:0.271
Epoch: 6, Train_acc:96.9%, Train_loss:0.183, Test_acc:94.7%ï¼ŒTest_loss:0.184
Epoch: 7, Train_acc:93.8%, Train_loss:0.261, Test_acc:92.0%ï¼ŒTest_loss:0.312
Epoch: 8, Train_acc:95.6%, Train_loss:0.141, Test_acc:92.4%ï¼ŒTest_loss:0.203
Epoch: 9, Train_acc:97.2%, Train_loss:0.143, Test_acc:94.2%ï¼ŒTest_loss:0.170
Epoch:10, Train_acc:93.1%, Train_loss:0.224, Test_acc:93.8%ï¼ŒTest_loss:0.265
Epoch:11, Train_acc:95.3%, Train_loss:0.275, Test_acc:93.8%ï¼ŒTest_loss:0.211
Epoch:12, Train_acc:95.6%, Train_loss:0.164, Test_acc:94.7%ï¼ŒTest_loss:0.196
Epoch:13, Train_acc:98.2%, Train_loss:0.066, Test_acc:93.3%ï¼ŒTest_loss:0.432
Epoch:14, Train_acc:99.0%, Train_loss:0.052, Test_acc:95.1%ï¼ŒTest_loss:0.191
Epoch:15, Train_acc:98.7%, Train_loss:0.087, Test_acc:93.3%ï¼ŒTest_loss:0.248
Epoch:16, Train_acc:96.8%, Train_loss:0.156, Test_acc:93.8%ï¼ŒTest_loss:0.290
Epoch:17, Train_acc:97.7%, Train_loss:0.067, Test_acc:93.8%ï¼ŒTest_loss:0.268
Epoch:18, Train_acc:99.1%, Train_loss:0.036, Test_acc:94.7%ï¼ŒTest_loss:0.388
Epoch:19, Train_acc:99.6%, Train_loss:0.021, Test_acc:95.6%ï¼ŒTest_loss:0.176
Epoch:20, Train_acc:99.9%, Train_loss:0.012, Test_acc:95.1%ï¼ŒTest_loss:0.181
Done
</code></pre> 
<p><img src="https://images2.imgbox.com/48/e1/vAbj4JH3_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> ä¼˜åŒ–å™¨çš„è¯¦è§£å¯ä»¥å‚è€ƒé“¾æ¥<a href="https://blog.csdn.net/LittleRuby/article/details/134843265?spm=1001.2014.3001.5502">æ·±åº¦å­¦ä¹  Day11â€”â€”T11ä¼˜åŒ–å™¨å¯¹æ¯”å®éªŒ</a></p> 
<h2><a id="_576"></a>æ€»ç»“</h2> 
<p>é€šè¿‡æœ¬æ–‡çš„å­¦ä¹ ï¼Œé‡åˆ°The freeze_support erroré—®é¢˜ï¼Œç½‘ä¸Šæ£€ç´¢è¯¥é—®é¢˜è§£å†³æ–¹æ¡ˆï¼Œé¡ºåˆ©è§£å†³è¯¥é—®é¢˜ï¼Œå¹¶é€šè¿‡æ”¹å˜ä¼˜åŒ–å™¨çš„æ–¹å¼ï¼Œæå‡äº†åŸæœ‰æ¨¡å‹çš„æµ‹è¯•ç²¾åº¦ã€‚</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ac28dfbfa3d8da2c48faed473993eaa2/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">æ·±åº¦å­¦ä¹  Day11â€”â€”T11ä¼˜åŒ–å™¨å¯¹æ¯”å®éªŒ</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/32e285f02988fb045305d8d5c946019e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">æ·±åº¦å­¦ä¹  Day17â€”â€”P6å¥½è±åæ˜æ˜Ÿè¯†åˆ«</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 èœé¸Ÿç¨‹åºå‘˜åšå®¢.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>