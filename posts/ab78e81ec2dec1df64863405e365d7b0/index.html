<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>YOLOv4训练自己的数据 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="YOLOv4训练自己的数据" />
<meta property="og:description" content="YOLOv4训练自己的数据集保姆级攻略 一、训练前的准备1.如何获取代码2.修改MakeFile文件3.下载权重4.测试初始训练权重效果 二、训练自己的数据集1.数据集文件夹格式2. main文件夹下生成训练集和测试集文件3. 修改voc.name4. 修改 voc.data5. voc_label.py生成训练用的txt文件和标签文件夹6. 修改yolov4.cfg文件7.生成anchors 三、训练计算所有值批量测试 一、训练前的准备 1.如何获取代码 https://github.com/AlexeyAB/darknet
2.修改MakeFile文件 GPU=1 CUDNN=1 CUDNN_HALF=0 OPENCV=1 AVX=0 OPENMP=0 LIBSO=1 ZED_CAMERA=0 ZED_CAMERA_v2_8=0 修改成自己的地址
3.下载权重 yolov4.weights
4.测试初始训练权重效果 在./darknet文件夹下的命令行中输入make clean, make
编译成功后：./darknet detect cfg/yolov4.cfg yolov4.weights data/dog.jp
成功后在主目录下出现predictions.jpg 图片为预测后的图片。
二、训练自己的数据集 1.数据集文件夹格式 VOCdevkit VOC2007 AnnotationsImageSets LayoutMainSegmentation JPEGImages 2. main文件夹下生成训练集和测试集文件 此处是代码
// An highlighted block var foo = &#39;bar&#39;; 3. 修改voc.name vehicle ship plane 4. 修改 voc.data classes= 3 # voc.name中类的个数 train = ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/ab78e81ec2dec1df64863405e365d7b0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-08-15T14:53:01+08:00" />
<meta property="article:modified_time" content="2021-08-15T14:53:01+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">YOLOv4训练自己的数据</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>YOLOv4训练自己的数据集保姆级攻略</h4> 
 <ul><li><a href="#_1" rel="nofollow">一、训练前的准备</a></li><li><ul><li><a href="#1_2" rel="nofollow">1.如何获取代码</a></li><li><a href="#2MakeFile_5" rel="nofollow">2.修改MakeFile文件</a></li><li><a href="#3_20" rel="nofollow">3.下载权重</a></li><li><a href="#4_23" rel="nofollow">4.测试初始训练权重效果</a></li></ul> 
  </li><li><a href="#_28" rel="nofollow">二、训练自己的数据集</a></li><li><a href="#1_29" rel="nofollow">1.数据集文件夹格式</a></li><li><ul><li><a href="#2_main_38" rel="nofollow">2. main文件夹下生成训练集和测试集文件</a></li><li><a href="#3_vocname_44" rel="nofollow">3. 修改voc.name</a></li><li><a href="#4__vocdata_50" rel="nofollow">4. 修改 voc.data</a></li><li><a href="#5_voc_labelpytxt_58" rel="nofollow">5. voc_label.py生成训练用的txt文件和标签文件夹</a></li><li><a href="#6_yolov4cfg_61" rel="nofollow">6. 修改yolov4.cfg文件</a></li><li><a href="#7anchors_113" rel="nofollow">7.生成anchors</a></li></ul> 
  </li><li><a href="#_118" rel="nofollow">三、训练</a></li><li><ul><li><a href="#_125" rel="nofollow">计算所有值</a></li><li><a href="#_129" rel="nofollow">批量测试</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>一、训练前的准备</h2> 
<h3><a id="1_2"></a>1.如何获取代码</h3> 
<p>https://github.com/AlexeyAB/darknet</p> 
<h3><a id="2MakeFile_5"></a>2.修改MakeFile文件</h3> 
<pre><code class="prism language-javascript"><span class="token constant">GPU</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token constant">CUDNN</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token constant">CUDNN_HALF</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token constant">OPENCV</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token constant">AVX</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token constant">OPENMP</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token constant">LIBSO</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token constant">ZED_CAMERA</span><span class="token operator">=</span><span class="token number">0</span> 
ZED_CAMERA_v2_8<span class="token operator">=</span><span class="token number">0</span> 
</code></pre> 
<p><img src="https://images2.imgbox.com/1e/75/821jur5B_o.png" alt="在这里插入图片描述"><br> 修改成自己的地址</p> 
<h3><a id="3_20"></a>3.下载权重</h3> 
<p><a href="https://github.com/AlexeyAB/darknet/releases/download/darknet_yolo_v3_optimal/yolov4.weights">yolov4.weights</a></p> 
<h3><a id="4_23"></a>4.测试初始训练权重效果</h3> 
<p>在./darknet文件夹下的命令行中输入make clean, make<br> 编译成功后：./darknet detect cfg/yolov4.cfg yolov4.weights data/dog.jp<br> 成功后在主目录下出现predictions.jpg 图片为预测后的图片。</p> 
<h2><a id="_28"></a>二、训练自己的数据集</h2> 
<h2><a id="1_29"></a>1.数据集文件夹格式</h2> 
<ul><li>VOCdevkit 
  <ul><li>VOC2007 
    <ul><li>Annotations</li><li>ImageSets 
      <ul><li>Layout</li><li>Main</li><li>Segmentation</li></ul> </li><li>JPEGImages</li></ul> </li></ul> </li></ul> 
<h3><a id="2_main_38"></a>2. main文件夹下生成训练集和测试集文件</h3> 
<p>此处是代码</p> 
<pre><code class="prism language-javascript"><span class="token comment">// An highlighted block</span>
<span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token string">'bar'</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="3_vocname_44"></a>3. 修改voc.name</h3> 
<pre><code class="prism language-javascript">vehicle
ship
plane
</code></pre> 
<h3><a id="4__vocdata_50"></a>4. 修改 voc.data</h3> 
<pre><code class="prism language-javascript">  classes<span class="token operator">=</span> <span class="token number">3</span> # voc<span class="token punctuation">.</span>name中类的个数
  train  <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token operator">/</span><span class="token constant">XXX</span><span class="token operator">/</span><span class="token number">2007</span>_train<span class="token punctuation">.</span>txt # 此文件由voc_lable<span class="token punctuation">.</span>py生成
  valid  <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token operator">/</span><span class="token constant">XXX</span><span class="token operator">/</span><span class="token number">2007</span>_test<span class="token punctuation">.</span>txt #（此文件由voc_lable<span class="token punctuation">.</span>py生成
  names <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token operator">/</span>darknet<span class="token operator">/</span>data<span class="token operator">/</span>voc<span class="token punctuation">.</span>name #（可以修改为自己的绝对路径）
  backup <span class="token operator">=</span> backup<span class="token operator">/</span> # 权重保存的位置
</code></pre> 
<h3><a id="5_voc_labelpytxt_58"></a>5. voc_label.py生成训练用的txt文件和标签文件夹</h3> 
<p>修改该文件中的类和地址，然后直接运行即可</p> 
<h3><a id="6_yolov4cfg_61"></a>6. 修改yolov4.cfg文件</h3> 
<pre><code class="prism language-javascript"><span class="token punctuation">[</span>net<span class="token punctuation">]</span>
batch<span class="token operator">=</span><span class="token number">64</span> 
subdivisions<span class="token operator">=</span><span class="token number">64</span> # 如果训练时出现out <span class="token keyword">of</span> memory 该值翻倍。
# Training
#width<span class="token operator">=</span><span class="token number">512</span> 
#height<span class="token operator">=</span><span class="token number">512</span>
width<span class="token operator">=</span><span class="token number">608</span> 
height<span class="token operator">=</span><span class="token number">608</span>
channels<span class="token operator">=</span><span class="token number">3</span>
momentum<span class="token operator">=</span><span class="token number">0.949</span>
decay<span class="token operator">=</span><span class="token number">0.0005</span>
angle<span class="token operator">=</span><span class="token number">0</span>
saturation <span class="token operator">=</span> <span class="token number">1.5</span>
exposure <span class="token operator">=</span> <span class="token number">1.5</span>
hue<span class="token operator">=</span><span class="token number">.1</span>

learning_rate<span class="token operator">=</span><span class="token number">0.0013</span> # 学习率
burn_in<span class="token operator">=</span><span class="token number">1000</span> 
max_batches <span class="token operator">=</span> <span class="token number">10000</span> # 最大迭代数 一般为类数<span class="token operator">*</span><span class="token number">2000</span>，但是最大迭代数一般不小于
训练图片的数量
policy<span class="token operator">=</span>steps
steps<span class="token operator">=</span><span class="token number">8000</span><span class="token punctuation">,</span><span class="token number">9000</span>
scales<span class="token operator">=</span><span class="token number">.1</span><span class="token punctuation">,</span><span class="token number">.1</span>
</code></pre> 
<pre><code class="prism language-javascript"><span class="token punctuation">[</span>convolutional<span class="token punctuation">]</span>
size<span class="token operator">=</span><span class="token number">1</span>
stride<span class="token operator">=</span><span class="token number">1</span>
pad<span class="token operator">=</span><span class="token number">1</span>
filters<span class="token operator">=</span><span class="token number">24</span> # <span class="token punctuation">(</span><span class="token keyword">class</span><span class="token operator">+</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">3</span>
activation<span class="token operator">=</span>linear
<span class="token punctuation">[</span>yolo<span class="token punctuation">]</span>
mask <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span>
anchors <span class="token operator">=</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span>  <span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span>  <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">,</span>  <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">89</span><span class="token punctuation">,</span>  <span class="token number">53</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">,</span>  <span class="token number">64</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">107</span><span class="token punctuation">,</span> <span class="token number">74</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">,</span><span class="token number">169</span><span class="token punctuation">,</span> <span class="token number">193</span><span class="token punctuation">,</span><span class="token number">303</span> 
# anchors 必须修改 
classes<span class="token operator">=</span><span class="token number">3</span> # voc<span class="token punctuation">.</span>name中的类数
num<span class="token operator">=</span><span class="token number">9</span>
jitter<span class="token operator">=</span><span class="token number">.3</span>
ignore_thresh <span class="token operator">=</span> <span class="token number">.7</span>
truth_thresh <span class="token operator">=</span> <span class="token number">1</span>
random<span class="token operator">=</span><span class="token number">1</span>
scale_x_y <span class="token operator">=</span> <span class="token number">1.05</span>
iou_thresh<span class="token operator">=</span><span class="token number">0.213</span>
cls_normalizer<span class="token operator">=</span><span class="token number">1.0</span>
iou_normalizer<span class="token operator">=</span><span class="token number">0.07</span>
iou_loss<span class="token operator">=</span>ciou
nms_kind<span class="token operator">=</span>greedynms
beta_nms<span class="token operator">=</span><span class="token number">0.6</span>
max_delta<span class="token operator">=</span><span class="token number">5</span>
</code></pre> 
<h3><a id="7anchors_113"></a>7.生成anchors</h3> 
<pre><code class="prism language-javascript"><span class="token punctuation">.</span><span class="token operator">/</span>darknet detector calc_anchors data<span class="token operator">/</span>voc<span class="token punctuation">.</span>data <span class="token operator">-</span>num_of_clusters <span class="token number">9</span> <span class="token operator">-</span>width <span class="token number">608</span> <span class="token operator">-</span>height <span class="token number">608</span>
</code></pre> 
<h2><a id="_118"></a>三、训练</h2> 
<pre><code class="prism language-javascript">#训练不带日志
<span class="token punctuation">.</span><span class="token operator">/</span>darknet detector train cfg<span class="token operator">/</span>voc<span class="token punctuation">.</span>data cfg<span class="token operator">/</span>yolov4<span class="token punctuation">.</span>cfg <span class="token operator">/</span>backup<span class="token operator">/</span>yolov4<span class="token punctuation">.</span>weights <span class="token operator">-</span>gpus <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span>
带日志
<span class="token punctuation">.</span><span class="token operator">/</span>darknet detector train cfg<span class="token operator">/</span>voc<span class="token punctuation">.</span>data cfg<span class="token operator">/</span>yolov4<span class="token punctuation">.</span>cfg <span class="token operator">/</span>backup<span class="token operator">/</span>yolov4<span class="token punctuation">.</span>weights <span class="token operator">-</span>gpus <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span> <span class="token operator">-</span>dont_show <span class="token operator">-</span> mjpeg_port <span class="token number">8090</span> <span class="token operator">-</span>map <span class="token number">2</span><span class="token operator">&gt;</span><span class="token number">1</span> <span class="token operator">|</span>tee
</code></pre> 
<h3><a id="_125"></a>计算所有值</h3> 
<pre><code class="prism language-javascript"><span class="token punctuation">.</span><span class="token operator">/</span>darknet detector map data<span class="token operator">/</span>voc<span class="token punctuation">.</span>data cfg<span class="token operator">/</span>yolov4<span class="token punctuation">.</span>cfg backup<span class="token operator">/</span>yolov4_best<span class="token punctuation">.</span>weights
</code></pre> 
<h3><a id="_129"></a>批量测试</h3> 
<pre><code class="prism language-javascript"><span class="token punctuation">.</span><span class="token operator">/</span>darknet detector test data<span class="token operator">/</span>voc<span class="token punctuation">.</span>data cfg<span class="token operator">/</span>yolo4<span class="token punctuation">.</span>cfg backup<span class="token operator">/</span>yolo_best<span class="token punctuation">.</span>weights
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/01de9938fcf1c6fc740da575ff185d9e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Kettle中“排序记录”的使用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/62a8453f8c05a5319ba55461f67f5242/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【JS从入门到精通】18-定时调用与延时调用</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>