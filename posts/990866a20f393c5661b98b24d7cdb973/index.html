<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ESP32学习：AD/DA数模转换 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ESP32学习：AD/DA数模转换" />
<meta property="og:description" content="一、概念介绍： 1.数字信号和模拟信号： 在显示生活中，我们经常遇到的如温度、压力、图像等都是模拟量，电子线路中的模拟电压和模拟电流等也都是模拟信号，它是一种连续变化的信号。而数字信号，通常我们无法看到，它通常存储在芯片内，如单片机、计算机、硬盘等。数字信号是离散的信号。
特点幅度变化信号传输方式保密性抗干扰能力处理和存储信号难易模拟信号在时间上和数值上都是连续变化的信号幅度的取值是连续的用模拟量的电压或电流来表示保密性差，通信信号很容易被窃听弱，很容易受到干扰难数字信号在时间上和数值上不连续变化的信号幅度的取值是离散的通过0和1的数字串所构成的数字流数字信号保密性较强，可加密-传输-解密再变换还原成模拟信号抗干扰能力强简单 2.数字信号和模拟信号相互转换的示例 上图是一个打电话的过程，首先，我们通过手机内部的ADC将声音信号（模拟信号）转化为数字信号，然后通过天线将数字信号转换出去，对方手机接收到我们的数字信号之后，通过DAC转换为模拟信号（声音），双方就可以通话了。
下图为AD/DA相互转换的示意：
3. 模拟信号转数字信号： 最低有效位(Least Significant Bit)LSB : 表示ADC芯片最小的一位所代表的模拟量的数值。 步骤：
采样：在时间轴上对信号数字化。按照固定的时间间隔抽取模拟信号的值，采样后就可以使一个时间连续的信号波变为在时间上取值数目有限的离散信号。保持量化编码 奈奎斯特采样定理：采样频率fs.max大于或等于有效信号最高频率fmax的两倍，采样值就可以包含原始信号的所有信号，被采样信号就可以不失真的还原成原始信号。
混叠效应：不同的信号频率在相同的采样频率下，可以得到相同的采样波形。
上图1为原始信号，但是，在混叠效应之下，根据采样点还原原始信号，可以有多种不同频率的信号（如图2）。因此AD转换时需要添加一个抗混叠滤波器，将一些高频谐波干扰杂波过滤掉。只采样需要的波形。
3.1 采样 采样过程示例
3.2 量化 上图为一个三位的ADC，即其所能能表示的分辨率位2的3次方，从000~111。
分辨率：ADC的分辨率指的是对于允许范围内的模拟信号，它能输出离散数字信号值的个数。例如，12位的ADC分辨率即为12位，或者说分辨率为满刻度的1/(2^12)。一个10V满刻度的12位ADC能分辨输入电压变化最小值为： 10V X 1/(2^12) = 2.4mV
转换误差：转换误差通常是以输出误差的最大值形式给出。表示A/D转换器实际输出的数字量和理论上输出的数字量之间的差别。 转换速率：ADC的转换指的是每秒转换的次数。 4 ADC转换方式 4.1 逐次逼近： 4.2 双积分式ADC 二、ESP32 模数转换 ESP32集成了两个12位SAR(逐次逼近寄存器)的ADC，并支持18通道（支持模拟的引脚）的测量。
ADC驱动器API支持ADC1(8个通道，连接到GPIO 32-39)和ADC2(10个通道，连接到GPIO 0、2、4、12-15和25-27)。但是，ADC2的使用对应用程序有一些限制：
Wi-Fi驱动程序使用了ADC2。因此，应用程序只能在未启动Wi-Fi驱动程序时使用ADC2。在一些开发板中ADC2引脚用作捆绑引脚（GPIO 0、2、15），因此不能自由使用。例如GPIO0：用于选择运行方式 ADC配置：
精度设置： typedef enum { ADC_WIDTH_BIT_9 = 0, /*!&lt; ADC capture width is 9Bit*/ ADC_WIDTH_BIT_10 = 1, /*!&lt; ADC capture width is 10Bit*/ ADC_WIDTH_BIT_11 = 2, /*!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/990866a20f393c5661b98b24d7cdb973/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-12-25T17:41:06+08:00" />
<meta property="article:modified_time" content="2021-12-25T17:41:06+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ESP32学习：AD/DA数模转换</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>一、概念介绍：</h2> 
<h3>1.数字信号和模拟信号：</h3> 
<p>         在显示生活中，我们经常遇到的如温度、压力、图像等都是模拟量，电子线路中的模拟电压和模拟电流等也都是模拟信号，它是一种连续变化的信号。而数字信号，通常我们无法看到，它通常存储在芯片内，如单片机、计算机、硬盘等。数字信号是离散的信号。</p> 
<table border="1" cellpadding="1" cellspacing="1" style="width:700px;"><tbody><tr><td></td><td style="text-align:center;"><strong>特点</strong></td><td style="text-align:center;"><strong>幅度变化</strong></td><td style="text-align:center;"><strong>信号传输方式</strong></td><td style="text-align:center;"><strong>保密性</strong></td><td style="text-align:center;"><strong>抗干扰能力</strong></td><td style="text-align:center;"><strong>处理和存储信号难易</strong></td></tr><tr><td><strong>模拟信号</strong></td><td>在时间上和数值上都是连续变化的信号</td><td>幅度的取值是连续的</td><td>用模拟量的电压或电流来表示</td><td>保密性差，通信信号很容易被窃听</td><td>弱，很容易受到干扰</td><td>难</td></tr><tr><td><strong>数字信号</strong></td><td>在时间上和数值上不连续变化的信号</td><td>幅度的取值是离散的</td><td>通过0和1的数字串所构成的数字流</td><td>数字信号保密性较强，可加密-传输-解密再变换还原成模拟信号</td><td>抗干扰能力强</td><td>简单</td></tr></tbody></table> 
<h3> 2.数字信号和模拟信号相互转换的示例</h3> 
<p style="text-align:center;"><img alt="" height="374" src="https://images2.imgbox.com/38/1d/00tRdFNd_o.png" width="483"></p> 
<p>         上图是一个打电话的过程，首先，我们通过手机内部的ADC将声音信号（模拟信号）转化为数字信号，然后通过天线将数字信号转换出去，对方手机接收到我们的数字信号之后，通过DAC转换为模拟信号（声音），双方就可以通话了。</p> 
<p>        下图为AD/DA相互转换的示意：</p> 
<p style="text-align:center;"><img alt="" height="649" src="https://images2.imgbox.com/64/38/uJBGWBHr_o.png" width="620"></p> 
<h3>3. 模拟信号转数字信号：</h3> 
<ul><li><strong>最低有效位(Least Significant Bit)LSB</strong> : 表示ADC芯片最小的一位所代表的模拟量的数值。</li></ul> 
<p><strong> 步骤：</strong></p> 
<ol><li><strong>采样</strong>：在时间轴上对信号数字化。按照固定的时间间隔抽取模拟信号的值，采样后就可以使一个时间连续的信号波变为在时间上取值数目有限的离散信号。</li><li><strong>保持</strong></li><li><strong>量化</strong></li><li><strong>编码</strong></li></ol> 
<p style="text-align:center;"><img alt="" height="340" src="https://images2.imgbox.com/f8/76/6ipqtAGR_o.png" width="671"></p> 
<p><strong>奈奎斯特采样定理：</strong>采样频率fs.max大于或等于有效信号最高频率fmax的两倍，采样值就可以包含原始信号的所有信号，被采样信号就可以不失真的还原成原始信号。</p> 
<p><strong>混叠效应：</strong>不同的信号频率在相同的采样频率下，可以得到相同的采样波形。</p> 
<p style="text-align:center;"><img alt="" height="386" src="https://images2.imgbox.com/98/f1/Io4KyQNz_o.png" width="428"></p> 
<p>         上图1为原始信号，但是，在混叠效应之下，根据采样点还原原始信号，可以有多种不同频率的信号（如图2）。因此AD转换时需要添加一个抗混叠滤波器，将一些高频谐波干扰杂波过滤掉。只采样需要的波形。</p> 
<h4>3.1 采样</h4> 
<p style="text-align:center;"><strong>采样过程示例</strong></p> 
<p style="text-align:center;"><img alt="" height="331" src="https://images2.imgbox.com/b4/af/o8703wm6_o.png" width="676"></p> 
<h4> 3.2 量化</h4> 
<p style="text-align:center;"><img alt="" height="403" src="https://images2.imgbox.com/df/4e/pgalpJpp_o.png" width="609"></p> 
<p><strong>        上图为一个三位的ADC，即其所能能表示的分辨率位2的3次方，从000~111</strong>。</p> 
<ul><li><strong>分辨率：ADC的分辨率指的是对于允许范围内的模拟信号，它能输出离散数字信号值的个数。</strong>例如，12位的ADC分辨率即为12位，或者说分辨率为<strong>满刻度的1/(2^12)</strong>。一个10V满刻度的12位ADC能分辨输入电压变化最小值为：</li></ul> 
<p style="text-align:center;"><strong>10V  X  1/(2^12) = 2.4mV</strong></p> 
<ul><li> <strong>转换误差</strong>：转换误差通常是以输出误差的最大值形式给出。表示A/D转换器实际输出的数字量和理论上输出的数字量之间的差别。</li><li><strong> 转换速率：</strong>ADC的转换指的是每秒转换的次数<strong>。</strong></li></ul> 
<h3> 4 ADC转换方式</h3> 
<h4> 4.1 逐次逼近：</h4> 
<p style="text-align:center;"><img alt="" height="309" src="https://images2.imgbox.com/a6/80/C64o2HyI_o.png" width="634"></p> 
<h4>4.2 双积分式ADC </h4> 
<p style="text-align:center;"><img alt="" height="259" src="https://images2.imgbox.com/50/81/RW6ito6i_o.png" width="654"></p> 
<h2>二、ESP32 模数转换</h2> 
<p>         ESP32集成了两个12位SAR(逐次逼近寄存器)的ADC，并支持18通道（支持模拟的引脚）的测量。</p> 
<p>        ADC驱动器API支持ADC1(8个通道，连接到GPIO 32-39)和ADC2(10个通道，连接到GPIO 0、2、4、12-15和25-27)。但是，ADC2的使用对应用程序有一些限制：</p> 
<ul><li><strong>Wi-Fi驱动程序使用了ADC2。因此，应用程序只能在未启动Wi-Fi驱动程序时使用ADC2。</strong></li><li>在一些开发板中ADC2引脚用作捆绑引脚（GPIO 0、2、15），因此不能自由使用。例如GPIO0：用于选择运行方式</li></ul> 
<p><strong> ADC配置：</strong></p> 
<ol><li>精度设置： <pre><code class="language-cpp">typedef enum {
    ADC_WIDTH_BIT_9  = 0, /*!&lt; ADC capture width is 9Bit*/
    ADC_WIDTH_BIT_10 = 1, /*!&lt; ADC capture width is 10Bit*/
    ADC_WIDTH_BIT_11 = 2, /*!&lt; ADC capture width is 11Bit*/
    ADC_WIDTH_BIT_12 = 3, /*!&lt; ADC capture width is 12Bit*/
    ADC_WIDTH_MAX,
} adc_bits_width_t;

</code></pre> <p><strong>ESP32内置12位ADC，可以在9位到12位的精度之间调整。</strong></p> </li><li>衰减倍数： <pre><code class="language-cpp">typedef enum {
    ADC_ATTEN_DB_0   = 0,  /*!&lt;The input voltage of ADC will be reduced to about 1/1 */
    ADC_ATTEN_DB_2_5 = 1,  /*!&lt;The input voltage of ADC will be reduced to about 1/1.34 */
    ADC_ATTEN_DB_6   = 2,  /*!&lt;The input voltage of ADC will be reduced to about 1/2 */
    ADC_ATTEN_DB_11  = 3,  /*!&lt;The input voltage of ADC will be reduced to about 1/3.6*/
    ADC_ATTEN_MAX,
} adc_atten_t;
</code></pre> <p>不同的衰减倍数对应不同的检测电压范围</p> </li></ol> 
<h2>三、程序编写</h2> 
<pre><code class="language-cpp">void adc_Init(){
	adc1_config_width(ADC_WIDTH_12Bit); //设置为12位的ADC 2^12=4096
	//设置ADC1通道6，参考电压为1.1V
	adc1_config_channel_atten(ADC1_CHANNEL_6 ,ADC_ATTEN_11db);
}


void app_main(void){
    adc_Init();
	int read_raw; //ADC值
	while(1)
    {
      read_raw=adc1_get_raw(ADC1_CHANNEL_6); //采集ADC1 6通道的ADC值
      printf("adc=%d,%dmv\r\n",read_raw, (read_raw*1100)/4096); //ADC值以及mV计算
      vTaskDelay(1000/portTICK_PERIOD_MS);
    }
}</code></pre> 
<h2>四、结束</h2> 
<p>        本文介绍了ADC模数转换的一些基本内容，并编写程序实现ESP32模数转换功能。</p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7ac0a1de8bd3b1e05468c64ebce3bb43/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">SHAP应用举例</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3085f07146d9baac5e22a42d4750fcce/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">软件测试好书推荐《自动化测试实践》30个项目测试案例分析</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>