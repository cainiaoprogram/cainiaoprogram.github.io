<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>空间金字塔思想在图像处理中的应用：SPP，PPM、ASPP和FPN结构理解和总结 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="空间金字塔思想在图像处理中的应用：SPP，PPM、ASPP和FPN结构理解和总结" />
<meta property="og:description" content="图像空间金字塔思想在图像处理中被广泛应用，本文主要针对具体的 SPP ，PPM，ASPP和 FPN 结构，以及传统图像处理的SIFT等进行简单的介绍和总结。
欢迎各位进行交流学习。【人肉整理，转载请注明出处】
文章目录 1 综述1.1 SPP结构（Spatial Pyramid Pooling）1.2 PPM结构（Pyramid Pooling Module）1.3 ASPP结构（Atrous Spatial Pyramid Pooling）1.4 FPN结构（Feature Pyramid Networks for Object Detection） 2 总结 1 综述 SPP论文链接：
Spatial Pyramid Pooling in Deep Convolutional Networks for Visual Recognition
pspNet论文链接：
Pyramid Scene Parsing Network
ASPP论文链接（此处已deeplab v3为例）：
deeplab v3（2017年）：Rethinking Atrous Convolution for Semantic Image Segmentation
deeplab v3&#43;（2018年）：Encoder-Decoder with Atrous Separable
Convolution for Semantic Image Segmentation
FPN论文连接:
Feature Pyramid Networks for Object Detection" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/9cbe3025daec971dccb7b847a25f915e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-06-29T00:14:19+08:00" />
<meta property="article:modified_time" content="2020-06-29T00:14:19+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">空间金字塔思想在图像处理中的应用：SPP，PPM、ASPP和FPN结构理解和总结</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>图像空间金字塔思想在图像处理中被广泛应用，本文主要针对具体的 SPP ，PPM，ASPP和 FPN 结构，以及传统图像处理的SIFT等进行简单的介绍和总结。</p> 
<p><strong>欢迎各位进行交流学习。【人肉整理，转载请注明出处】</strong><br> </p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#1__4" rel="nofollow">1 综述</a></li><li><ul><li><a href="#11_SPPSpatial_Pyramid_Pooling_20" rel="nofollow">1.1 SPP结构（Spatial Pyramid Pooling）</a></li><li><a href="#12_PPMPyramid_Pooling_Module_40" rel="nofollow">1.2 PPM结构（Pyramid Pooling Module）</a></li><li><a href="#13_ASPPAtrous_Spatial_Pyramid_Pooling_138" rel="nofollow">1.3 ASPP结构（Atrous Spatial Pyramid Pooling）</a></li><li><a href="#14_FPNFeature_Pyramid_Networks_for_Object_Detection_161" rel="nofollow">1.4 FPN结构（Feature Pyramid Networks for Object Detection）</a></li></ul> 
  </li><li><a href="#2__179" rel="nofollow">2 总结</a></li></ul> 
</div> 
<p></p> 
<h2><a id="1__4"></a>1 综述</h2> 
<p>SPP论文链接：<br> <a href="https://arxiv.org/pdf/1406.4729.pdf" rel="nofollow">Spatial Pyramid Pooling in Deep Convolutional Networks for Visual Recognition</a></p> 
<p>pspNet论文链接：<br> <a href="https://arxiv.org/pdf/1612.01105.pdf" rel="nofollow">Pyramid Scene Parsing Network</a></p> 
<p>ASPP论文链接（此处已deeplab v3为例）：<br> deeplab v3（2017年）：<a href="https://arxiv.org/pdf/1706.05587v1.pdf" rel="nofollow">Rethinking Atrous Convolution for Semantic Image Segmentation</a><br> deeplab v3+（2018年）：<a href="https://arxiv.org/pdf/1802.02611.pdf" rel="nofollow">Encoder-Decoder with Atrous Separable<br> Convolution for Semantic Image Segmentation</a></p> 
<p>FPN论文连接:<br> <a href="https://arxiv.org/pdf/1612.03144.pdf" rel="nofollow">Feature Pyramid Networks for Object Detection</a></p> 
<h3><a id="11_SPPSpatial_Pyramid_Pooling_20"></a>1.1 SPP结构（Spatial Pyramid Pooling）</h3> 
<p>在何恺明2015年《Spatial Pyramid Pooling in Deep ConvolutionalNetworks for Visual Recognition》被提出，改论文主要改进两点：</p> 
<p><strong>解决CNN需要固定输入图像的尺寸，导致不必要的精度损失的问题；</strong></p> 
<p>因为带有全连接层的网络结构都需要固定输入图像的尺度，当然后期也有直接用conv层代替FC层的，比如SSD网络直接用conv层来计算边界框坐标和置信度的。</p> 
<p><strong>解决R-CNN对候选区域进行重复卷积计算，导致计算冗余的问题；</strong></p> 
<p>因为R-CNN网络中基于segment seletive输出的2000个候选框都要重新计算feature map较为耗时，因此提出了候选区域到全图的特征(feature map)之间的对应映射，这样图像只需计算一次前向传播即可。<br> 在之后的 fast R-CNN 和 faster R-CNN 都采用这种映射关系，为ROI pooling层。<br> <mark>但在mask R-CNN中，用ROI Align替代了ROI pooling层，其认为两次量化的候选框与最开始的回归候选框有一定偏差，影响检测和分割准确度，ROI Align中不进行float量化，通过双线性内插计算四个坐标点，然后进行max pooling</mark>。</p> 
<p><strong>SPP结构如下：</strong><br> <img src="https://images2.imgbox.com/e5/8a/DC2jkJAr_o.png" alt="在这里插入图片描述"><br> 将256 channels 的 feature map 作为输入，在SPP layer被分成1x1，2x2，4x4三个pooling结构，对每个输入都作max pooling(论文使用的)，这样无论输入图像大小如何，出来的特征固定是(16+4+1)x256维度。这样就实现了不管图像中候选区域尺寸如何，SPP层的输出永远是(16+4+1) x 256 特征向量。</p> 
<h3><a id="12_PPMPyramid_Pooling_Module_40"></a>1.2 PPM结构（Pyramid Pooling Module）</h3> 
<p>应用在语义分割中，PSPNet网络结构如下：<br> <img src="https://images2.imgbox.com/7c/83/9g5TaywY_o.png" alt="在这里插入图片描述"><br> （1）Input Image：即自然场景下拍摄的包含不同目标的原始图；<br> （2）Feature Map：即通过前面CNN获得的特征图，，<strong>这个CNN是预训练的ResNet</strong>；<br> （3）Pyramid Pooling Module：上图中方框POOL表示采用<strong>1x1、2x2、3x3和6x6四种不同尺寸的pooling操作得到多个尺寸的特征图</strong>，并对这些尺寸的特征图再次<strong>进行“1x1的Conv”来减少通道数</strong>。然后采用<strong>双线性插值进行UPSAMPLE</strong>，即通过上采样来获得金字塔模块前相同尺寸的特征图，并在通道上进行拼接；<br> （4）Final Prediction：即最终预测结果；</p> 
<p>PPM模块代码如下，结合代码更直观：</p> 
<pre><code class="prism language-python"><span class="token comment">#下面是单个PPM模块</span>
<span class="token keyword">def</span> <span class="token function">interp_block</span><span class="token punctuation">(</span>prev_layer<span class="token punctuation">,</span> level<span class="token punctuation">,</span> feature_map_shape<span class="token punctuation">,</span> input_shape<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> input_shape <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token number">473</span><span class="token punctuation">,</span> <span class="token number">473</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        kernel_strides_map <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">:</span> <span class="token number">60</span><span class="token punctuation">,</span>
                              <span class="token number">2</span><span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
                              <span class="token number">3</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
                              <span class="token number">6</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">}</span>
    <span class="token keyword">elif</span> input_shape <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token number">713</span><span class="token punctuation">,</span> <span class="token number">713</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        kernel_strides_map <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">:</span> <span class="token number">90</span><span class="token punctuation">,</span>
                              <span class="token number">2</span><span class="token punctuation">:</span> <span class="token number">45</span><span class="token punctuation">,</span>
                              <span class="token number">3</span><span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
                              <span class="token number">6</span><span class="token punctuation">:</span> <span class="token number">15</span><span class="token punctuation">}</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Pooling parameters for input shape "</span><span class="token punctuation">,</span>
              input_shape<span class="token punctuation">,</span> <span class="token string">" are not defined."</span><span class="token punctuation">)</span>
        exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

    names <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string">"conv5_3_pool"</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>level<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"_conv"</span><span class="token punctuation">,</span>
        <span class="token string">"conv5_3_pool"</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>level<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"_conv_bn"</span>
    <span class="token punctuation">]</span>
    kernel <span class="token operator">=</span> <span class="token punctuation">(</span>kernel_strides_map<span class="token punctuation">[</span>level<span class="token punctuation">]</span><span class="token punctuation">,</span> kernel_strides_map<span class="token punctuation">[</span>level<span class="token punctuation">]</span><span class="token punctuation">)</span>
    strides <span class="token operator">=</span> <span class="token punctuation">(</span>kernel_strides_map<span class="token punctuation">[</span>level<span class="token punctuation">]</span><span class="token punctuation">,</span> kernel_strides_map<span class="token punctuation">[</span>level<span class="token punctuation">]</span><span class="token punctuation">)</span>
    prev_layer <span class="token operator">=</span> AveragePooling2D<span class="token punctuation">(</span>kernel<span class="token punctuation">,</span> strides<span class="token operator">=</span>strides<span class="token punctuation">)</span><span class="token punctuation">(</span>prev_layer<span class="token punctuation">)</span>  <span class="token comment">#或者maxPooling;</span>
    prev_layer <span class="token operator">=</span> Conv2D<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> strides<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token operator">=</span>names<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        use_bias<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">(</span>prev_layer<span class="token punctuation">)</span>
    prev_layer <span class="token operator">=</span> BN<span class="token punctuation">(</span>name<span class="token operator">=</span>names<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span>prev_layer<span class="token punctuation">)</span>
    prev_layer <span class="token operator">=</span> Activation<span class="token punctuation">(</span><span class="token string">'relu'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>prev_layer<span class="token punctuation">)</span>
    <span class="token comment"># prev_layer = Lambda(Interp, arguments={<!-- --></span>
    <span class="token comment">#                    'shape': feature_map_shape})(prev_layer)</span>
    prev_layer <span class="token operator">=</span> Interp<span class="token punctuation">(</span>feature_map_shape<span class="token punctuation">)</span><span class="token punctuation">(</span>prev_layer<span class="token punctuation">)</span> <span class="token comment">#此处进行上采样，resize到原来feature map的size；</span>
    <span class="token keyword">return</span> prev_layer

<span class="token comment">#下面是1,2,3,6的PPM模块</span>
<span class="token keyword">def</span> <span class="token function">build_pyramid_pooling_module</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> input_shape<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Build the Pyramid Pooling Module."""</span>
    <span class="token comment"># ---PSPNet concat layers with Interpolation</span>
    feature_map_size <span class="token operator">=</span> <span class="token builtin">tuple</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>ceil<span class="token punctuation">(</span>input_dim <span class="token operator">/</span> <span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                             <span class="token keyword">for</span> input_dim <span class="token keyword">in</span> input_shape<span class="token punctuation">)</span>  <span class="token comment">#原图经过resnet后变为1/8;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"PSP module will interpolate to a final feature map size of %s"</span> <span class="token operator">%</span>
          <span class="token punctuation">(</span>feature_map_size<span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">)</span>

    interp_block1 <span class="token operator">=</span> interp_block<span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> feature_map_size<span class="token punctuation">,</span> input_shape<span class="token punctuation">)</span>
    interp_block2 <span class="token operator">=</span> interp_block<span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> feature_map_size<span class="token punctuation">,</span> input_shape<span class="token punctuation">)</span>
    interp_block3 <span class="token operator">=</span> interp_block<span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> feature_map_size<span class="token punctuation">,</span> input_shape<span class="token punctuation">)</span>
    interp_block6 <span class="token operator">=</span> interp_block<span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> feature_map_size<span class="token punctuation">,</span> input_shape<span class="token punctuation">)</span>

    <span class="token comment"># concat all these layers. resulted</span>
    <span class="token comment"># shape=(1,feature_map_size_x,feature_map_size_y,4096)</span>
    res <span class="token operator">=</span> Concatenate<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">[</span>res<span class="token punctuation">,</span>
                         interp_block6<span class="token punctuation">,</span>
                         interp_block3<span class="token punctuation">,</span>
                         interp_block2<span class="token punctuation">,</span>
                         interp_block1<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> res

<span class="token comment">#pspnet网络结构</span>
<span class="token keyword">def</span> <span class="token function">build_pspnet</span><span class="token punctuation">(</span>nb_classes<span class="token punctuation">,</span> resnet_layers<span class="token punctuation">,</span> input_shape<span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'softmax'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Build PSPNet."""</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Building a PSPNet based on ResNet %i expecting inputs of shape %s predicting %i classes"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>
        resnet_layers<span class="token punctuation">,</span> input_shape<span class="token punctuation">,</span> nb_classes<span class="token punctuation">)</span><span class="token punctuation">)</span>

    inp <span class="token operator">=</span> Input<span class="token punctuation">(</span><span class="token punctuation">(</span>input_shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> input_shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    res <span class="token operator">=</span> ResNet<span class="token punctuation">(</span>inp<span class="token punctuation">,</span> layers<span class="token operator">=</span>resnet_layers<span class="token punctuation">)</span>
    psp <span class="token operator">=</span> build_pyramid_pooling_module<span class="token punctuation">(</span>res<span class="token punctuation">,</span> input_shape<span class="token punctuation">)</span>
<span class="token comment">#后面是经过3×3,1×1的卷积后一次上采样到原图</span>
    x <span class="token operator">=</span> Conv2D<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> strides<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token string">"same"</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"conv5_4"</span><span class="token punctuation">,</span>
               use_bias<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">(</span>psp<span class="token punctuation">)</span>
    x <span class="token operator">=</span> BN<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"conv5_4_bn"</span><span class="token punctuation">)</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    x <span class="token operator">=</span> Activation<span class="token punctuation">(</span><span class="token string">'relu'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    x <span class="token operator">=</span> Dropout<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>

    x <span class="token operator">=</span> Conv2D<span class="token punctuation">(</span>nb_classes<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> strides<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"conv6"</span><span class="token punctuation">)</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    <span class="token comment"># x = Lambda(Interp, arguments={'shape': (</span>
    <span class="token comment">#    input_shape[0], input_shape[1])})(x)</span>
    x <span class="token operator">=</span> Interp<span class="token punctuation">(</span><span class="token punctuation">[</span>input_shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> input_shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    x <span class="token operator">=</span> Activation<span class="token punctuation">(</span><span class="token string">'softmax'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>

    model <span class="token operator">=</span> Model<span class="token punctuation">(</span>inputs<span class="token operator">=</span>inp<span class="token punctuation">,</span> outputs<span class="token operator">=</span>x<span class="token punctuation">)</span>

    <span class="token comment"># Solver</span>
    sgd <span class="token operator">=</span> SGD<span class="token punctuation">(</span>lr<span class="token operator">=</span>learning_rate<span class="token punctuation">,</span> momentum<span class="token operator">=</span><span class="token number">0.9</span><span class="token punctuation">,</span> nesterov<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    model<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span>optimizer<span class="token operator">=</span>sgd<span class="token punctuation">,</span>
                  loss<span class="token operator">=</span><span class="token string">'categorical_crossentropy'</span><span class="token punctuation">,</span>
                  metrics<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'accuracy'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> model
</code></pre> 
<h3><a id="13_ASPPAtrous_Spatial_Pyramid_Pooling_138"></a>1.3 ASPP结构（Atrous Spatial Pyramid Pooling）</h3> 
<p>可以认为是SPP在语义分割中的应用，结合了空洞卷积可在不丢失分辨率（不进行下采样）的情况下扩大卷积核的感受野。此处已deeplab v3网络为例，deeplab v3论文中的ASPP结构如下如所示。</p> 
<p><img src="https://images2.imgbox.com/79/2a/z6RuhpUu_o.png" alt="在这里插入图片描述"></p> 
<ul><li>其中的1*1卷积，论文中的解释是当 rate = feature map size 时，dilation conv 就变成了 1 ×1 conv，所以这个 1 × 1 conv相当于rate很大的空洞卷积。还加入了全局池化，再上采样到原来的 feature map size，思想来源于PSPnet。为什么用 rate = [6, 12, 18] ？是论文实验得到的，因为这个搭配比例的 mIOU 最高。</li><li>在 backbone 的每一个block里面又参考了HDC的思想，设置了 [1,2,1] 的rate，所以每个conv的rate = Rate * rate。论文给出的 Multi-grid 部分结果如下所示。<br> <img src="https://images2.imgbox.com/7c/14/X4oiWnqi_o.png" alt="在这里插入图片描述"></li></ul> 
<p><mark><strong>这里提一下deeplab v3+ 结构，是对V3的一个加强，主要有两个改进点：</strong></mark></p> 
<ul><li><strong>对ASPP中的 upsample 进行了改进；</strong></li></ul> 
<p>下图来自 deeplab v3+ 论文中，(a) 是deeplab v3的结构，( c) 是deeplab v3+的结构，<strong>v3+ 中将上采样变成了2次 4× 的 upsample</strong>，相比于v3中直接进行 8× 的 upsample，具有更丰富的语义信息，所以对物体边缘分割效果较好。<br> <img src="https://images2.imgbox.com/47/d8/J6b21UQT_o.png" alt="在这里插入图片描述"></p> 
<ul><li><strong>deeplab v3+中另一个改进点，将 modify xception 作为 backbone；(这个改进点与ASPP无关)</strong></li></ul> 
<p>如此下图所示，（1）加深了网络结构层数，且利用了 Atrous Separable Convolution 来减少权重参数；（2）利用 stride = 2 的 depthwise conv 来替代max pooling 进行下采样；（3）在每一个 depthwise conv 后都加了 BN 和 relu 层。作者在论文中做了各种尝试组合，有兴趣的可查看论文；<br> 大家对 depthwise conv 有兴趣的可以阅读 Mobile Net 系列等轻量网络结构，论文可自行查找。<br> <img src="https://images2.imgbox.com/74/34/rnlLnfBk_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="14_FPNFeature_Pyramid_Networks_for_Object_Detection_161"></a>1.4 FPN结构（Feature Pyramid Networks for Object Detection）</h3> 
<p>FPN通常用在 object detection 网络中，通常低层的特征语义信息比较少，但是目标位置准确；高层的特征语义信息比较丰富，但是目标位置比较粗略。FPN 即是对两者进行了融合，同时利用低层特征高分辨率和高层特征的高语义信息，通过融合这些不同层的特征达到预测的效果。并且预测是在每个融合后的特征层上单独进行的，这和常规的特征融合方式不同。</p> 
<p>FPN结构如下图：<br> <img src="https://images2.imgbox.com/87/a4/nS5oNq4t_o.png" alt="在这里插入图片描述"><br> <strong>自底向上的路径：</strong><br> 具体而言，当 backbone 是 ResNet 时，我们使用每个阶段的最后一个residual block输出的特征激活输出。 对于conv2，conv3，conv4 和 conv5 输出，我们将这些最后residual block的输出表示为 {C2，C3，C4，C5}，并且它们相对于输入图像具有 {4, 8, 16, 32} 的步长。</p> 
<p><strong>自顶向下的路径：</strong><br> 通过对在空间上更抽象但语义更强高层特征图进行上采样来幻化高分辨率的特征。在C5上附加一个1×1卷积层来生成低分辨率图P5，随后通过侧向连接从底向上的路径，使得高层特征得到增强。将低分辨率的特征图做2倍上采样，最终的特征映射集称为{P2，P3，P4，P5}，分别对应于{C2，C3，C4，C5}，具有相同的尺寸。通过按元素相加，将上采样映射与相应的自底而上映射合并。<br> 最后，在每个合并的图上附加一个3×3卷积来生成最终的特征映射，这是为了减少上采样的混叠效应。</p> 
<p>作者在将其应用到 RPN 和 fast / faster R-CNN 中，在论中有详细的实验数据，大家有兴趣可自行查阅。</p> 
<p><mark>在YOLO v3中也采用了类似 FPN 的结构，但里面用了concat 进行特征融合；</mark></p> 
<h2><a id="2__179"></a>2 总结</h2> 
<p>空间金字塔思想在图像处理中具有很重要的作用，<br> 传统图像处理中:</p> 
<ul><li>在SIFT 中利用高斯差分金字塔 (DOG) 保持尺度不变性；</li><li>在配准 / 匹配算法中利用空间金字塔进行粗匹配和细匹配达到效率优化；</li></ul> 
<p>CNN 网络中:</p> 
<ul><li>在含有FC层网络中利用 SPP 改进输入需要固定尺度的问题；</li><li>在语义分割中利用 ASPP 在不丢失信息时组合不同感受野的语义信息，提高分割精度；</li><li>在 object detection 网络中利用 FPN 改善小目标难检测的问题；</li></ul> 
<p><em><strong>有错误之处请多多指教哈！！</strong></em></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/87b25b896ac5a7ac39e7d94d1d37ac0e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">nodemon一款给热爱技术的开发者定制的热更新软件</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6004de33495e8921b1c8590213e9322e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">每日一题Day04 顺序表逆序</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>