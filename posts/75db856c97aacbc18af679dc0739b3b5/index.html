<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Java如何获取ldap中的sid - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Java如何获取ldap中的sid" />
<meta property="og:description" content="(版权声明：原创作品，允许转载，转载时请务必以超链接形式标明文章 原始出处 、作者信息和本声明。否则将追究法律责任。）
一、对SID的初步认识
SID即安全标识符(System IDentifier)，它用来标识用户身份的。当系统每次创建用户都会分配一个唯一的SID。正因为SID有这样的特性，从Windows 2000以后的W系统对SID的依赖性较高，包括很多系统应用在内的系统内部进程引用帐户的SID而不是帐户的用户名和组名。因为用户的登陆名、显示名和归属的组等都可以修改，将一个帐户删除后再建立一个同名帐户，该账户的SID不同于被删除的那个帐户，所以它也不具有授权给前一个帐户的权利和权限。
二、系统如何使用SID
当用户通过输入用户名口令得到身份验证(authentication)后，系统内部进程会给用户发放一个访问令牌，其实也就相当于一个票证(ticket)。此后用户访问系统资源时不再需要提供用户名和口令，只需要将访问令牌提供给系统，然后系统检查用户试图访问对象(Resources)上的访问控制列表(ACL)。如果用户被允许访问该对象，系统将会分配给用户相应的访问权限，这也就完成了授权(authorization)的过程。
上面描述的其实就是一个authentication &amp; authorization的过程，那么如果系统修改了Resources ACL则需要等待ticket过期更换或者用户注销再登陆重新authentication获得新的ticket。
三、SID号码如何组成
例：S-1-5-21-2062728589-3024857285-4110131050-500
上面着一串是一个标准的SID。第一项S标示该字符串是SID；第二项是SID的版本号，这里版本号是1；第三项十标志符的颁发机构，Win2000之后的颁发机构都是5；最后是一系列资颁发机构前面3组是标志域，最后一组是标志域内的帐户和组。例子中的SID最后一段标志位是500，这代表了它是一个系统内置管理员帐号administrator的SID，又比如最后一段是501的话则是代表GUEST的帐号。有很多内置用户和组的SID相应标志位都是固定的,对应关系这里不再赘述。
四、如何获得用户和主机的SID
1、PsGetSid
PsGetSid是PsTools工具集中，由sysinternals发布,下载地址：http://download.sysinternals.com/Files/PsTools.zip 2、在控制台输入 whoami /all
五、Java代码的实现部分
Java Code 1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/75db856c97aacbc18af679dc0739b3b5/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2015-09-24T16:56:56+08:00" />
<meta property="article:modified_time" content="2015-09-24T16:56:56+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Java如何获取ldap中的sid</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><span style="color:rgb(68,68,68)">(</span><span style="color:rgb(68,68,68); font-size:16px; line-height:24px">版权声明：</span><span style="color:rgb(68,68,68); font-size:16px; line-height:24px">原创作品，允许转载，转载时请务必以超链接形式标明文章 </span><a target="_blank" href="http://blog.csdn.net/cug_zg/article/details/48712939" style="color:rgb(61,107,167); font-size:16px; line-height:24px" rel="noopener noreferrer"><span style="color:#0008ec">原始出处</span></a><span style="color:rgb(68,68,68); font-size:16px; line-height:24px"> 、作者信息和本声明。否则将追究法律责任。</span><span style="color:rgb(68,68,68)">）</span></p> 
<p><span style="color:rgb(68,68,68)">一、对<span style="font-family:Arial">SID</span><span style="font-family:宋体">的初步认识</span></span><span style="color:rgb(68,68,68)"><br> </span><span style="color:rgb(68,68,68)">　　<span style="font-family:Arial">SID</span><span style="font-family:宋体">即安全标识符</span><span style="font-family:Arial">(System IDentifier)</span><span style="font-family:宋体">，它用来标识用户身份的。当系统每次创建用户都会分配一个唯一的</span><span style="font-family:Arial">SID</span><span style="font-family:宋体">。正因为</span><span style="font-family:Arial">SID</span><span style="font-family:宋体">有这样的特性，从</span><span style="font-family:Arial">Windows 2000</span><span style="font-family:宋体">以后的</span><span style="font-family:Arial">W</span><span style="font-family:宋体">系统对</span><span style="font-family:Arial">SID</span><span style="font-family:宋体">的依赖性较高，包括很多系统应用在内的系统内部进程引用帐户的</span><span style="font-family:Arial">SID</span><span style="font-family:宋体">而不是帐户的用户名和组名。因为用户的登陆名、显示名和归属的组等都可以修改，将一个帐户删除后再建立一个同名帐户，该账户的</span><span style="font-family:Arial">SID</span><span style="font-family:宋体">不同于被删除的那个帐户，所以它也不具有授权给前一个帐户的权利和权限。</span></span><span style="color:rgb(68,68,68)"><br> </span><span style="color:rgb(68,68,68)"><br> </span><span style="color:rgb(68,68,68)">二、系统如何使用<span style="font-family:Arial">SID</span></span><span style="color:rgb(68,68,68)"><br> </span><span style="color:rgb(68,68,68)">　　当用户通过输入用户名口令得到身份验证<span style="font-family:Arial">(authentication)</span><span style="font-family:宋体">后，系统内部进程会给用户发放一个访问令牌，其实也就相当于一个票证</span><span style="font-family:Arial">(ticket)</span><span style="font-family:宋体">。此后用户访问系统资源时不再需要提供用户名和口令，只需要将访问令牌提供给系统，然后系统检查用户试图访问对象</span><span style="font-family:Arial">(Resources)</span><span style="font-family:宋体">上的访问控制列表</span><span style="font-family:Arial">(ACL)</span><span style="font-family:宋体">。如果用户被允许访问该对象，系统将会分配给用户相应的访问权限，这也就完成了授权</span><span style="font-family:Arial">(authorization)</span><span style="font-family:宋体">的过程。</span></span><span style="color:rgb(68,68,68)"><br> </span><span style="color:rgb(68,68,68)">　　上面描述的其实就是一个<span style="font-family:Arial">authentication &amp; authorization</span><span style="font-family:宋体">的过程，那么如果系统修改了</span><span style="font-family:Arial">Resources ACL</span><span style="font-family:宋体">则需要等待</span><span style="font-family:Arial">ticket</span><span style="font-family:宋体">过期更换或者用户注销再登陆重新</span><span style="font-family:Arial">authentication</span><span style="font-family:宋体">获得新的</span><span style="font-family:Arial">ticket</span><span style="font-family:宋体">。</span></span><span style="color:rgb(68,68,68)"><br> </span><span style="color:rgb(68,68,68)">　</span><span style="color:rgb(68,68,68)"><br> </span><span style="color:rgb(68,68,68)"><br> </span><span style="color:rgb(68,68,68)">三、<span style="font-family:Arial">SID</span><span style="font-family:宋体">号码如何组成</span></span><span style="color:rgb(68,68,68)"><br> </span><span style="color:rgb(68,68,68)">　　例：<span style="font-family:Arial">S-1-5-21-2062728589-3024857285-4110131050-500</span></span><span style="color:rgb(68,68,68)"><br> </span><span style="color:rgb(68,68,68)">　　上面着一串是一个标准的<span style="font-family:Arial">SID</span><span style="font-family:宋体">。第一项</span><span style="font-family:Arial">S</span><span style="font-family:宋体">标示该字符串是</span><span style="font-family:Arial">SID</span><span style="font-family:宋体">；第二项是</span><span style="font-family:Arial">SID</span><span style="font-family:宋体">的版本号，这里版本号是</span><span style="font-family:Arial">1</span><span style="font-family:宋体">；第三项十标志符的颁发机构，</span><span style="font-family:Arial">Win2000</span><span style="font-family:宋体">之后的颁发机构都是</span><span style="font-family:Arial">5</span><span style="font-family:宋体">；最后是一系列资颁发机构前面</span><span style="font-family:Arial">3</span><span style="font-family:宋体">组是标志域，最后一组是标志域内的帐户和组。例子中的</span><span style="font-family:Arial">SID</span><span style="font-family:宋体">最后一段标志位是</span><span style="font-family:Arial">500</span><span style="font-family:宋体">，这代表了它是一个系统内置管理员帐号</span><span style="font-family:Arial">administrator</span><span style="font-family:宋体">的</span><span style="font-family:Arial">SID</span><span style="font-family:宋体">，又比如最后一段是</span><span style="font-family:Arial">501</span><span style="font-family:宋体">的话则是代表</span><span style="font-family:Arial">GUEST</span><span style="font-family:宋体">的帐号。有很多内置用户和组的</span><span style="font-family:Arial">SID</span><span style="font-family:宋体">相应标志位都是固定的</span><span style="font-family:Arial">,</span><span style="font-family:宋体">对应关系这里不再赘述。</span></span><span style="color:rgb(68,68,68)"><br> </span><span style="color:rgb(68,68,68)"><br> </span><span style="color:rgb(68,68,68)">四、如何获得用户和主机的<span style="font-family:Arial">SID</span></span><span style="color:rgb(68,68,68)"><br> </span><span style="color:rgb(68,68,68)">1<span style="font-family:宋体">、</span><span style="font-family:Arial">PsGetSid</span></span><span style="color:rgb(68,68,68)"><br> </span><span style="color:rgb(68,68,68)">　　<span style="font-family:Arial">PsGetSid</span><span style="font-family:宋体">是</span><span style="font-family:Arial">PsTools</span><span style="font-family:宋体">工具集中，由</span><span style="font-family:Arial">sysinternals</span><span style="font-family:宋体">发布,</span></span><span style="color:rgb(68,68,68)">下载地址：</span><a target="_blank" href="http://download.sysinternals.com/Files/PsTools.zip" rel="nofollow noopener noreferrer"><span style="color:rgb(0,8,236)">http://download.sysinternals.com/Files/PsTools.zip</span></a><span style="color:rgb(68,68,68)"> </span><span style="color:rgb(68,68,68)"><br> </span></p> 
<p><span style="color:rgb(68,68,68)">2、在控制台输入 whoami /all</span></p> 
<p style="text-align:center"><img src="" alt=""><br> </p> 
<p style="text-align:center"><br> </p> 
<p><span style="color:rgb(68,68,68)">五、</span><span style="color:rgb(68,68,68)">Java<span style="font-family:宋体">代码的实现部分</span></span></p> 
<p><span style="color:rgb(68,68,68)"> </span></p> 
<p> Java Code </p> 
<table><tbody><tr><td style="background:rgb(227,227,227)"> <p><span style="color:rgb(0,130,132)">1</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">2</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">3</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">4</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">5</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">6</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">7</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">8</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">9</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">10</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">11</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">12</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">13</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">14</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">15</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">16</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">17</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">18</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">19</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">20</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">21</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">22</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">23</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">24</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">25</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">26</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">27</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">28</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">29</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">30</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">31</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">32</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">33</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">34</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">35</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">36</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">37</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">38</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">39</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">40</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">41</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">42</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">43</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">44</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">45</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">46</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">47</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">48</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">49</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">50</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">51</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">52</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">53</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">54</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">55</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">56</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">57</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">58</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">59</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">60</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">61</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">62</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">63</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">64</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">65</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">66</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">67</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">68</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">69</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">70</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">71</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">72</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">73</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">74</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">75</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">76</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">77</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">78</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">79</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">80</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">81</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">82</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">83</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">84</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">85</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">86</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">87</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">88</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">89</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">90</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">91</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">92</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">93</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">94</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">95</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">96</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">97</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">98</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">99</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">100</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">101</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">102</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">103</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">104</span><span style="color:rgb(0,130,132)"><br> </span><span style="color:rgb(0,130,132)">105</span></p> </td><td style="background:rgb(0,130,132)"> <p> </p> </td><td style="background:rgb(239,239,239)"> <p><span style="color:rgb(0,128,0)">/**</span><span style="color:rgb(0,128,0)"><br> </span><span style="color:rgb(0,128,0)"> * @Description:获取AD域账户信息中的objectSid，并且将byte[]转化为String</span><span style="color:rgb(0,128,0)"><br> </span><span style="color:rgb(0,128,0)"> * @ClassName: Test</span><span style="color:rgb(0,128,0)"><br> </span><span style="color:rgb(0,128,0)"> * @Copyright: Copyright (c) 2015</span><span style="color:rgb(0,128,0)"><br> </span><span style="color:rgb(0,128,0)"> * @author CUG_ZG</span><span style="color:rgb(0,128,0)"><br> </span><span style="color:rgb(0,128,0)"> * @date 2015-9-23 下午15:22:35</span><span style="color:rgb(0,128,0)"><br> </span><span style="color:rgb(0,128,0)"> * @version V1.0</span><span style="color:rgb(0,128,0)"><br> </span><span style="color:rgb(0,128,0)"> */</span><br> <span style="color:rgb(0,0,255)">import</span> java.util.Properties;<br> <span style="color:rgb(0,0,255)">import</span> javax.naming.Context;<br> <span style="color:rgb(0,0,255)">import</span> javax.naming.NamingEnumeration;<br> <span style="color:rgb(0,0,255)">import</span> javax.naming.NamingException;<br> <span style="color:rgb(0,0,255)">import</span> javax.naming.directory.Attributes;<br> <span style="color:rgb(0,0,255)">import</span> javax.naming.directory.SearchControls;<br> <span style="color:rgb(0,0,255)">import</span> javax.naming.directory.SearchResult;<br> <span style="color:rgb(0,0,255)">import</span> javax.naming.ldap.InitialLdapContext;<br> <span style="color:rgb(0,0,255)">import</span> javax.naming.ldap.LdapContext;<br> <span style="color:rgb(0,0,255)">public</span> <span style="color:rgb(0,0,255)">class</span> Test<br> {<!-- --><br>     <span style="color:rgb(0,0,255)">public</span> <span style="color:rgb(128,0,255)">String</span> getObjectSid(Attributes attrs) <span style="color:rgb(0,0,255)">throws</span> NamingException<br>     {<!-- --><br>         <span style="color:rgb(0,0,255)">if</span> (attrs.get(<span style="color:rgb(128,0,0)">"objectSid"</span>) != null)<br>         {<!-- --><br>             Object object = attrs.get(<span style="color:rgb(128,0,0)">"objectSid"</span>).get();<br>             <span style="color:rgb(128,0,255)">byte</span>[] SID = (<span style="color:rgb(128,0,255)">byte</span>[]) object;<br>             <span style="color:rgb(0,128,0)">// byte[] SID = object.toString().getBytes();//不可以用这种转换类型，有损耗</span><span style="color:rgb(0,128,0)"><br> </span>            StringBuilder strSID = <span style="color:rgb(0,0,255)">new</span> StringBuilder(<span style="color:rgb(128,0,0)">"S-"</span>);<br>             strSID.append(SID[<span style="color:rgb(255,0,0)">0</span>]).append(<span style="color:rgb(128,0,0)">'-'</span>);<br>             <span style="color:rgb(0,128,0)">// bytes[2..7] :</span><span style="color:rgb(0,128,0)"><br> </span>            StringBuilder tmpBuff = <span style="color:rgb(0,0,255)">new</span> StringBuilder();<br>             <span style="color:rgb(0,0,255)">for</span> (<span style="color:rgb(128,0,255)">int</span> t = <span style="color:rgb(255,0,0)">2</span>; t &lt;= <span style="color:rgb(255,0,0)">7</span>; t++)<br>             {<!-- --><br>                 <span style="color:rgb(128,0,255)">String</span> hexString = Integer.toHexString(SID[t] &amp; 0xFF);<br>                 tmpBuff.append(hexString);<br>             }<br>             strSID.append(Long.parseLong(tmpBuff.toString(), <span style="color:rgb(255,0,0)">16</span>));<br>             <span style="color:rgb(0,128,0)">// bytes[1] : the sub authorities count</span><span style="color:rgb(0,128,0)"><br> </span>            <span style="color:rgb(128,0,255)">int</span> count = SID[<span style="color:rgb(255,0,0)">1</span>];<br>             <span style="color:rgb(0,128,0)">// bytes[8..end] : the sub authorities (these are Integers - notice</span><span style="color:rgb(0,128,0)"><br> </span>            <span style="color:rgb(0,128,0)">// the endian)</span><span style="color:rgb(0,128,0)"><br> </span>            <span style="color:rgb(0,0,255)">for</span> (<span style="color:rgb(128,0,255)">int</span> i = <span style="color:rgb(255,0,0)">0</span>; i &lt; count; i++)<br>             {<!-- --><br>                 <span style="color:rgb(128,0,255)">int</span> currSubAuthOffset = i * <span style="color:rgb(255,0,0)">4</span>;<br>                 tmpBuff.setLength(<span style="color:rgb(255,0,0)">0</span>);<br>                 tmpBuff.append(<span style="color:rgb(128,0,255)">String</span>.format(<span style="color:rgb(128,0,0)">"%02X%02X%02X%02X"</span>,<br>                                              (SID[<span style="color:rgb(255,0,0)">11</span> + currSubAuthOffset] &amp; 0xFF),<br>                                              (SID[<span style="color:rgb(255,0,0)">10</span> + currSubAuthOffset] &amp; 0xFF),<br>                                              (SID[<span style="color:rgb(255,0,0)">9</span> + currSubAuthOffset] &amp; 0xFF),<br>                                              (SID[<span style="color:rgb(255,0,0)">8</span> + currSubAuthOffset] &amp; 0xFF)));<br>                 strSID.append(<span style="color:rgb(128,0,0)">'-'</span>).append(<br>                     Long.parseLong(tmpBuff.toString(), <span style="color:rgb(255,0,0)">16</span>));<br> <br>             }<br>             <span style="color:rgb(0,0,255)">return</span> strSID.toString();<br>         }<br>         <span style="color:rgb(0,0,255)">return</span> null;<br>     }<br> <br>     <span style="color:rgb(0,0,255)">public</span> <span style="color:rgb(0,0,255)">static</span> <span style="color:rgb(128,0,255)">void</span> main(<span style="color:rgb(128,0,255)">String</span>[] args)<br>     {<!-- --><br>         Test test = <span style="color:rgb(0,0,255)">new</span> Test();<br>         Properties env = <span style="color:rgb(0,0,255)">new</span> Properties();<br>         <span style="color:rgb(128,0,255)">String</span> adminName = <span style="color:rgb(128,0,0)">"</span><span style="color:rgb(128,0,0)">username</span><span style="color:rgb(128,0,0)">@</span><span style="color:rgb(128,0,0)">domain</span><span style="color:rgb(128,0,0)">.com"</span>;<span style="color:rgb(0,128,0)">// username@domain</span><span style="color:rgb(0,128,0)"><br> </span>        <span style="color:rgb(128,0,255)">String</span> adminPassword = <span style="color:rgb(128,0,0)">"</span><span style="color:rgb(128,0,0)">password</span><span style="color:rgb(128,0,0)">"</span>;<span style="color:rgb(0,128,0)">// password</span><span style="color:rgb(0,128,0)"><br> </span>        <span style="color:rgb(128,0,255)">String</span> ldapURL = <span style="color:rgb(128,0,0)">"LDAP://</span><span style="color:rgb(128,0,0)">ipaddress:port</span><span style="color:rgb(128,0,0)">"</span>;<span style="color:rgb(0,128,0)">// ip:port</span><span style="color:rgb(0,128,0)"><br> </span>        env.put(Context.INITIAL_CONTEXT_FACTORY,<br>                 <span style="color:rgb(128,0,0)">"com.sun.jndi.ldap.LdapCtxFactory"</span>);<br>         env.put(Context.SECURITY_AUTHENTICATION, <span style="color:rgb(128,0,0)">"simple"</span>);<span style="color:rgb(0,128,0)">// "none","simple","strong"</span><span style="color:rgb(0,128,0)"><br> </span>        env.put(Context.SECURITY_PRINCIPAL, adminName);<br>         env.put(Context.SECURITY_CREDENTIALS, adminPassword);<br>         env.put(Context.PROVIDER_URL, ldapURL);<br>         <span style="color:rgb(0,128,0)">//加上这个可以避免在byte[]转化为String类型的编译错误</span><span style="color:rgb(0,128,0)"><br> </span>        env.put(<span style="color:rgb(128,0,0)">"java.naming.ldap.attributes.binary"</span>, <span style="color:rgb(128,0,0)">"objectSid"</span>);<br>         <span style="color:rgb(0,0,255)">try</span><br>         {<!-- --><br>             LdapContext ctx = <span style="color:rgb(0,0,255)">new</span> InitialLdapContext(env, null);<br>             SearchControls searchCtls = <span style="color:rgb(0,0,255)">new</span> SearchControls();<br>             searchCtls.setSearchScope(SearchControls.SUBTREE_SCOPE);<br>             <span style="color:rgb(128,0,255)">String</span> searchFilter = <span style="color:rgb(128,0,0)">"(&amp;(objectCategory=person)(objectClass=user)(name=*))"</span>;<br>             <span style="color:rgb(128,0,255)">String</span> searchBase = <span style="color:rgb(128,0,0)">"DC=mosscenterm,DC=com"</span>;<br>             <span style="color:rgb(128,0,255)">String</span> returnedAtts[] = { <span style="color:rgb(128,0,0)">"objectSid"</span> };<br>             searchCtls.setReturningAttributes(returnedAtts);<br>             NamingEnumeration&lt;SearchResult&gt; answer = ctx.search(searchBase,<br>                     searchFilter, searchCtls);<br>             <span style="color:rgb(0,0,255)">while</span> (answer.hasMoreElements())<br>             {<!-- --><br>                 SearchResult sr = (SearchResult) answer.next();<br>                 Attributes attrs = sr.getAttributes();<br>                 System.out.println(<span style="color:rgb(128,0,0)">"&lt;&lt;&lt;::["</span> + sr.getNameInNamespace()<br>                                    + <span style="color:rgb(128,0,0)">"]::&gt;&gt;&gt;&gt;"</span>);<br>                 System.out.println(<span style="color:rgb(128,0,0)">"&lt;&lt;&lt;::["</span> + test.getObjectSid(attrs)<br>                                    + <span style="color:rgb(128,0,0)">"]::&gt;&gt;&gt;&gt;"</span>);<br> <br>             }<br>             ctx.close();<br>         }<br>         <span style="color:rgb(0,0,255)">catch</span> (NamingException e)<br>         {<!-- --><br>             e.printStackTrace();<br>             System.err.println(<span style="color:rgb(128,0,0)">"Problem searching directory: "</span> + e);<br>         }<br>     }<br> }</p> <p> </p> </td></tr></tbody></table> 
<p><span style="color:rgb(68,68,68)"> </span></p> 
<p><span style="color:rgb(68,68,68)"> 参考文章：</span></p> 
<p><span style="color:rgb(68,68,68)"><span style="font-size:12px"><span style="font-family:verdana,sans-serif"><strong>1.Java/JNDI: How to Convert Active Directory ObjectSID into String Format  Author: Eyal Lupu</strong></span></span></span></p> 
<p><span style="color:rgb(68,68,68)"><span style="font-family:verdana,sans-serif"><strong><span style="font-size:12px">From:  <u>http://www.jroller.com/eyallupu/entry/java_jndi_how_to_convert</u></span><br> </strong></span></span></p> 
<p><span style="color:rgb(68,68,68)"><span style="font-family:verdana,sans-serif"><strong><span style="font-size:12px">2.详解SID之终结篇  作者：<span style="color:rgb(85,85,85); font-family:宋体,'Arial Narrow',arial,serif; line-height:24px">梦卿的砖头</span></span></strong></span></span></p> 
<p><span style="color:rgb(68,68,68)"><span style="font-family:verdana,sans-serif"><strong><span style="font-size:12px">From:  <u>http://www.360doc.com/content/08/1201/14/74060_2029807.shtml</u><br> </span></strong></span></span></p> 
<p><span style="color:rgb(68,68,68)"><span style="font-family:verdana,sans-serif"><strong><span style="font-size:12px"><u><br> </u></span></strong></span></span></p> 
<p><span style="color:rgb(68,68,68)"><span style="font-family:verdana,sans-serif"><strong><span style="font-size:12px"><u><br> </u></span></strong></span></span></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/16f2a792e24726b8287442238f776405/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">dockerfile 多端口映射 expose</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2ffe150206d03285c608f0974051d004/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">修改tomcat中的字符集问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>