<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Redis集群重启 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Redis集群重启" />
<meta property="og:description" content="机器ip 192.168.251.51 以下，为伪集群模式，redis服务重启流程演示：
第一步 查看所有redis进程 [root@i-netlrktd ~]# ps -ef|grep redis root 1477 1 0 Aug09 ? 00:02:06 redis-server *:6371 [cluster] root 1481 1 0 Aug09 ? 00:02:05 redis-server *:6372 [cluster] root 1489 1 0 Aug09 ? 00:02:03 redis-server *:6373 [cluster] root 1493 1 0 Aug09 ? 00:01:56 redis-server *:6374 [cluster] root 1497 1 0 Aug09 ? 00:01:54 redis-server *:6375 [cluster] root 1505 1 0 Aug09 ? 00:01:54 redis-server *:6376 [cluster] root 25131 25105 0 09:37 pts/0 00:00:00 grep redis [root@i-netlrktd ~]# 第二步杀进程-关进程 kill 掉所有redis进程 kill -9 1477" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/6d013f59b82a02294ec312c3a301b5ef/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-07-13T23:24:58+08:00" />
<meta property="article:modified_time" content="2018-07-13T23:24:58+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Redis集群重启</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h4>机器ip 192.168.251.51</h4> 
<p>以下，为伪集群模式，redis服务重启流程演示：</p> 
<h4><span style="color:#333333;">第一步  查看所有redis</span><span style="color:#000099;">进程</span></h4> 
<table border="1"><tbody><tr><td> <pre><code class="language-html hljs">[root@i-netlrktd ~]# ps -ef|grep redis
root      1477     1  0 Aug09 ?        00:02:06 redis-server *:6371 [cluster]
root      1481     1  0 Aug09 ?        00:02:05 redis-server *:6372 [cluster]
root      1489     1  0 Aug09 ?        00:02:03 redis-server *:6373 [cluster]
root      1493     1  0 Aug09 ?        00:01:56 redis-server *:6374 [cluster]
root      1497     1  0 Aug09 ?        00:01:54 redis-server *:6375 [cluster]
root      1505     1  0 Aug09 ?        00:01:54 redis-server *:6376 [cluster]
root     25131 25105  0 09:37 pts/0    00:00:00 grep redis
[root@i-netlrktd ~]# </code></pre> </td></tr></tbody></table> 
<h4><br> 第二步杀进程-关进程</h4> 
<p>kill 掉所有redis进程   kill -9 1477</p> 
<h4>第三步 删除文件（如果是重启请勿删除如下持久化文件信息）</h4> 
<table border="1"><tbody><tr><td> <pre><code class="language-html hljs">[root@i-netlrktd ~]# cd /opt/cluster
[root@i-netlrktd cluster]# ls -l
total 11652
drwxr-xr-x 2 root root    4096 Aug  8 12:15 01
drwxr-xr-x 2 root root    4096 Apr 17 10:06 02
drwxr-xr-x 2 root root    4096 Apr 17 10:06 03
drwxr-xr-x 2 root root    4096 Apr 17 10:06 04
drwxr-xr-x 2 root root    4096 Apr 17 10:06 05
drwxr-xr-x 2 root root    4096 Apr 14 11:53 06
-rw-r--r-- 1 root root  661435 Aug 11 09:34 dump.rdb
-rw-r--r-- 1 root root     763 Aug  9 20:08 nodes-6371.conf
-rw-r--r-- 1 root root     763 Aug  9 20:08 nodes-6372.conf
-rw-r--r-- 1 root root     763 Aug  9 20:08 nodes-6373.conf
-rw-r--r-- 1 root root     763 Aug  9 20:08 nodes-6374.conf
-rw-r--r-- 1 root root     763 Aug  9 20:08 nodes-6375.conf
-rw-r--r-- 1 root root     763 Aug  9 20:08 nodes-6376.conf
-rw-r--r-- 1 root root 4698450 Sep 18  2016 redis-cli
-rw-r--r-- 1 root root   41561 Apr 14 12:40 redis.conf
-rw-r--r-- 1 root root 6471199 Sep 18  2016 redis-server
[root@i-netlrktd cluster]# rm -rf dump.rdb 
[root@i-netlrktd cluster]# rm -rf nodes-*.*</code></pre> </td></tr></tbody></table> 
<h4>第四步 重启redis节点，逐个启动</h4> 
<table border="1"><tbody><tr><td> <pre><code class="language-html hljs">[root@i-netlrktd cluster]#  redis-server 01/redis.conf 
[root@i-netlrktd cluster]#  redis-server 02/redis.conf 
[root@i-netlrktd cluster]#  redis-server 03/redis.conf 
[root@i-netlrktd cluster]#  redis-server 04/redis.conf 
[root@i-netlrktd cluster]#  redis-server 05/redis.conf 
[root@i-netlrktd cluster]#  redis-server 06/redis.conf 
[root@i-netlrktd cluster]# 
[root@i-netlrktd cluster]# 
[root@i-netlrktd cluster]# ps -ef|grep redis
root     25254     1  0 09:42 ?        00:00:00 redis-server *:6371 [cluster]
root     25262     1  0 09:42 ?        00:00:00 redis-server *:6372 [cluster]
root     25266     1  0 09:43 ?        00:00:00 redis-server *:6373 [cluster]
root     25274     1  0 09:43 ?        00:00:00 redis-server *:6374 [cluster]
root     25278     1  0 09:43 ?        00:00:00 redis-server *:6375 [cluster]
root     25282     1  0 09:43 ?        00:00:00 redis-server *:6376 [cluster]
root     25294 25105  0 09:43 pts/0    00:00:00 grep redis
[root@i-netlrktd cluster]# 

</code></pre> </td></tr></tbody></table> 
<h4>第五步 创建集群（如果是重启，不需要再次创建集群）</h4> 
<table border="1"><tbody><tr><td> <pre><code class="language-html hljs">[root@i-netlrktd opt]# cd /opt/redis
[root@i-netlrktd redis]# 
[root@i-netlrktd redis]# src/redis-trib.rb create --replicas 1 192.168.251.51:6371 192.168.251.51:6372 192.168.251.51:6373 192.168.251.51:6374 192.168.251.51:6375 192.168.251.51:6376
&gt;&gt;&gt; Creating cluster
&gt;&gt;&gt; Performing hash slots allocation on 6 nodes...
Using 3 masters:
192.168.251.51:6371
192.168.251.51:6372
192.168.251.51:6373
Adding replica 192.168.251.51:6374 to 192.168.251.51:6371
Adding replica 192.168.251.51:6375 to 192.168.251.51:6372
Adding replica 192.168.251.51:6376 to 192.168.251.51:6373
M: 601190311b907e03b62704c160b368b82fcad806 192.168.251.51:6371
   slots:0-5460 (5461 slots) master
M: 2d7430d3ffd28f12194966b16f569044b6d28506 192.168.251.51:6372
   slots:5461-10922 (5462 slots) master
M: 58ae303b38add3ba69dcd9529cf1c25bd16c872b 192.168.251.51:6373
   slots:10923-16383 (5461 slots) master
S: 41f0b8c7e91a010432d6bf338373b85b57f395ed 192.168.251.51:6374
   replicates 601190311b907e03b62704c160b368b82fcad806
S: e689c8437b826fdc8677822f5837ef376bc44229 192.168.251.51:6375
   replicates 2d7430d3ffd28f12194966b16f569044b6d28506
S: a82c996a01bceb07fe64087502fe1297111e7c49 192.168.251.51:6376
   replicates 58ae303b38add3ba69dcd9529cf1c25bd16c872b
Can I set the above configuration? (type 'yes' to accept): yes
&gt;&gt;&gt; Nodes configuration updated
&gt;&gt;&gt; Assign a different config epoch to each node
&gt;&gt;&gt; Sending CLUSTER MEET messages to join the cluster
Waiting for the cluster to join...
&gt;&gt;&gt; Performing Cluster Check (using node 192.168.251.51:6371)
M: 601190311b907e03b62704c160b368b82fcad806 192.168.251.51:6371
   slots:0-5460 (5461 slots) master
M: 2d7430d3ffd28f12194966b16f569044b6d28506 192.168.251.51:6372
   slots:5461-10922 (5462 slots) master
M: 58ae303b38add3ba69dcd9529cf1c25bd16c872b 192.168.251.51:6373
   slots:10923-16383 (5461 slots) master
M: 41f0b8c7e91a010432d6bf338373b85b57f395ed 192.168.251.51:6374
   slots: (0 slots) master
   replicates 601190311b907e03b62704c160b368b82fcad806
M: e689c8437b826fdc8677822f5837ef376bc44229 192.168.251.51:6375
   slots: (0 slots) master
   replicates 2d7430d3ffd28f12194966b16f569044b6d28506
M: a82c996a01bceb07fe64087502fe1297111e7c49 192.168.251.51:6376
   slots: (0 slots) master
   replicates 58ae303b38add3ba69dcd9529cf1c25bd16c872b
[OK] All nodes agree about slots configuration.
&gt;&gt;&gt; Check for open slots...
&gt;&gt;&gt; Check slots coverage...
[OK] All 16384 slots covered.
[root@i-netlrktd redis]# </code></pre> 
    <div>
        
    </div> </td></tr></tbody></table>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fb718a1ba5afefd543dd6a7cc0587bb2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">intellij idea配置网络代理</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4a86e44a83952c6f742ffe34aadf1788/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">矩阵转置算法和一些简单的加，减，乘法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>