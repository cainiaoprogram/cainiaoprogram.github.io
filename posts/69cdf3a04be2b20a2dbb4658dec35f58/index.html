<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【SpringCloud】Nacos注册中心、配置中心用法与原理（下） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【SpringCloud】Nacos注册中心、配置中心用法与原理（下）" />
<meta property="og:description" content="【SpringCloud】Nacos注册中心、配置中心用法与原理（下）
上集回顾
二、Nacos 配置中心
1. 统一配置管理
（1）在 Nacos 中添加配置文件
（2）从微服务拉取配置
2. 配置热更新
方式一：使用 @RefreshScope注解
方式二：使用 @ConfigurationProperties注解代替 @Value注解
3. 配置共享
（1）添加一个环境共享配置
（2）在user-service中读取共享配置
（3）运行两个UserApplication，使用不同的profile
（4）配置共享的优先级
4. 搭建Nacos集群
【SpringCloud】Nacos注册中心、配置中心用法与原理（下） 上集回顾 【SpringCloud】Nacos注册中心、配置中心用法与原理（上）_面向架构编程的博客-CSDN博客https://blog.csdn.net/weixin_43715214/article/details/128740974
二、Nacos 配置中心 Nacos除了可以做注册中心，同样可以做配置管理来使用。
1. 统一配置管理 当微服务部署的实例越来越多，达到数十、数百时，逐个修改微服务配置非常的麻烦，而且很容易出错！
所以，我们需要一种统一配置管理方案，可以集中管理所有实例的配置，而且还要实现热更新，即无需重启项目就可以让配置生效！
Nacos 就实现了这个功能！一方面可以将配置集中管理，另一方可以在配置变更时，及时通知微服务，实现配置的热更新。
Nacos 配置中心的图形化界面
（1）在 Nacos 中添加配置文件 然后在弹出的表单中，填写配置信息
Data ID的命名规则一般是：“ 服务名称-项目运行环境(开发).yaml ” 注意：
项目的核心配置，需要热更新的配置才有放到 Nacos 管理的必要。基本不会变更的一些配置还是保存在微服务本地比较好。
（2）从微服务拉取配置 微服务要拉取 nacos 中管理的配置，并且与本地的 application.yml 配置合并，才能完成项目启动。
【问】但如果尚未读取 application.yml，又如何得知 nacos地址呢？
Spring引入了一种新的配置文件：bootstrap.yaml文件，会在 application.yml 之前被读取！
也就是说，我们可以把 nacos的地址、文件相关信息 配置在 bootstrap.yaml 中，那么，我们就可以完成 Nacos配置的读取！！！" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/69cdf3a04be2b20a2dbb4658dec35f58/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-26T11:33:09+08:00" />
<meta property="article:modified_time" content="2023-01-26T11:33:09+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【SpringCloud】Nacos注册中心、配置中心用法与原理（下）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><a href="#%E3%80%90SpringCloud%E3%80%91Nacos%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E3%80%81%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E7%94%A8%E6%B3%95%E4%B8%8E%E5%8E%9F%E7%90%86%EF%BC%88%E4%B8%8B%EF%BC%89" rel="nofollow">【SpringCloud】Nacos注册中心、配置中心用法与原理（下）</a></p> 
<p id="%E4%B8%8A%E9%9B%86%E5%9B%9E%E9%A1%BE-toc" style="margin-left:0px;"><a href="#%E4%B8%8A%E9%9B%86%E5%9B%9E%E9%A1%BE" rel="nofollow">上集回顾</a></p> 
<p id="%E4%BA%8C%E3%80%81Nacos%20%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-toc" style="margin-left:0px;"><a href="#%E4%BA%8C%E3%80%81Nacos%20%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83" rel="nofollow">二、Nacos 配置中心</a></p> 
<p id="1.%20%E7%BB%9F%E4%B8%80%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86-toc" style="margin-left:40px;"><a href="#1.%20%E7%BB%9F%E4%B8%80%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86" rel="nofollow">1. 统一配置管理</a></p> 
<p id="%EF%BC%881%EF%BC%89%E5%9C%A8%20Nacos%20%E4%B8%AD%E6%B7%BB%E5%8A%A0%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-toc" style="margin-left:80px;"><a href="#%EF%BC%881%EF%BC%89%E5%9C%A8%20Nacos%20%E4%B8%AD%E6%B7%BB%E5%8A%A0%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6" rel="nofollow">（1）在 Nacos 中添加配置文件</a></p> 
<p id="%EF%BC%882%EF%BC%89%E4%BB%8E%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8B%89%E5%8F%96%E9%85%8D%E7%BD%AE-toc" style="margin-left:80px;"><a href="#%EF%BC%882%EF%BC%89%E4%BB%8E%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8B%89%E5%8F%96%E9%85%8D%E7%BD%AE" rel="nofollow">（2）从微服务拉取配置</a></p> 
<p id="2.%C2%A0%E9%85%8D%E7%BD%AE%E7%83%AD%E6%9B%B4%E6%96%B0-toc" style="margin-left:40px;"><a href="#2.%C2%A0%E9%85%8D%E7%BD%AE%E7%83%AD%E6%9B%B4%E6%96%B0" rel="nofollow">2. 配置热更新</a></p> 
<p id="%E6%96%B9%E5%BC%8F%E4%B8%80%EF%BC%9A%E4%BD%BF%E7%94%A8%20%40RefreshScope%E6%B3%A8%E8%A7%A3-toc" style="margin-left:80px;"><a href="#%E6%96%B9%E5%BC%8F%E4%B8%80%EF%BC%9A%E4%BD%BF%E7%94%A8%20%40RefreshScope%E6%B3%A8%E8%A7%A3" rel="nofollow">方式一：使用 @RefreshScope注解</a></p> 
<p id="%E6%96%B9%E5%BC%8F%E4%BA%8C%EF%BC%9A%E4%BD%BF%E7%94%A8%20%40ConfigurationProperties%E6%B3%A8%E8%A7%A3%E4%BB%A3%E6%9B%BF%20%40Value%E6%B3%A8%E8%A7%A3-toc" style="margin-left:80px;"><a href="#%E6%96%B9%E5%BC%8F%E4%BA%8C%EF%BC%9A%E4%BD%BF%E7%94%A8%20%40ConfigurationProperties%E6%B3%A8%E8%A7%A3%E4%BB%A3%E6%9B%BF%20%40Value%E6%B3%A8%E8%A7%A3" rel="nofollow">方式二：使用 @ConfigurationProperties注解代替 @Value注解</a></p> 
<p id="3.%20%E9%85%8D%E7%BD%AE%E5%85%B1%E4%BA%AB-toc" style="margin-left:40px;"><a href="#3.%20%E9%85%8D%E7%BD%AE%E5%85%B1%E4%BA%AB" rel="nofollow">3. 配置共享</a></p> 
<p id="%EF%BC%881%EF%BC%89%E6%B7%BB%E5%8A%A0%E4%B8%80%E4%B8%AA%E7%8E%AF%E5%A2%83%E5%85%B1%E4%BA%AB%E9%85%8D%E7%BD%AE-toc" style="margin-left:80px;"><a href="#%EF%BC%881%EF%BC%89%E6%B7%BB%E5%8A%A0%E4%B8%80%E4%B8%AA%E7%8E%AF%E5%A2%83%E5%85%B1%E4%BA%AB%E9%85%8D%E7%BD%AE" rel="nofollow">（1）添加一个环境共享配置</a></p> 
<p id="%EF%BC%882%EF%BC%89%E5%9C%A8user-service%E4%B8%AD%E8%AF%BB%E5%8F%96%E5%85%B1%E4%BA%AB%E9%85%8D%E7%BD%AE-toc" style="margin-left:80px;"><a href="#%EF%BC%882%EF%BC%89%E5%9C%A8user-service%E4%B8%AD%E8%AF%BB%E5%8F%96%E5%85%B1%E4%BA%AB%E9%85%8D%E7%BD%AE" rel="nofollow">（2）在user-service中读取共享配置</a></p> 
<p id="%EF%BC%883%EF%BC%89%E8%BF%90%E8%A1%8C%E4%B8%A4%E4%B8%AAUserApplication%EF%BC%8C%E4%BD%BF%E7%94%A8%E4%B8%8D%E5%90%8C%E7%9A%84profile-toc" style="margin-left:80px;"><a href="#%EF%BC%883%EF%BC%89%E8%BF%90%E8%A1%8C%E4%B8%A4%E4%B8%AAUserApplication%EF%BC%8C%E4%BD%BF%E7%94%A8%E4%B8%8D%E5%90%8C%E7%9A%84profile" rel="nofollow">（3）运行两个UserApplication，使用不同的profile</a></p> 
<p id="%EF%BC%884%EF%BC%89%E9%85%8D%E7%BD%AE%E5%85%B1%E4%BA%AB%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7-toc" style="margin-left:80px;"><a href="#%EF%BC%884%EF%BC%89%E9%85%8D%E7%BD%AE%E5%85%B1%E4%BA%AB%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7" rel="nofollow">（4）配置共享的优先级</a></p> 
<p id="4.%20%E6%90%AD%E5%BB%BANacos%E9%9B%86%E7%BE%A4-toc" style="margin-left:40px;"><a href="#4.%20%E6%90%AD%E5%BB%BANacos%E9%9B%86%E7%BE%A4" rel="nofollow">4. 搭建Nacos集群</a></p> 
<hr> 
<h2>【SpringCloud】Nacos注册中心、配置中心用法与原理（下）</h2> 
<h2 id="%E4%B8%8A%E9%9B%86%E5%9B%9E%E9%A1%BE">上集回顾</h2> 
<p><a class="has-card" href="https://blog.csdn.net/weixin_43715214/article/details/128740974" title="【SpringCloud】Nacos注册中心、配置中心用法与原理（上）_面向架构编程的博客-CSDN博客"><span class="link-card-box"><span class="link-title">【SpringCloud】Nacos注册中心、配置中心用法与原理（上）_面向架构编程的博客-CSDN博客</span><span class="link-link"><img alt="" class="link-link-icon" src="https://images2.imgbox.com/e6/36/TrsE9YR3_o.png">https://blog.csdn.net/weixin_43715214/article/details/128740974</span></span></a></p> 
<h2 id="%E4%BA%8C%E3%80%81Nacos%20%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83">二、Nacos 配置中心</h2> 
<p>Nacos除了可以做<strong>注册中心</strong>，同样可以做<span style="color:#fe2c24;"><strong>配置管理</strong></span>来使用。</p> 
<h3 id="1.%20%E7%BB%9F%E4%B8%80%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86">1. 统一配置管理</h3> 
<p>当微服务部署的<strong>实例越来越多</strong>，达到数十、数百时，<span style="color:#ff9900;"><strong>逐个修改</strong></span>微服务配置非常的麻烦，而且很容易出错！</p> 
<p>所以，我们需要一种<span style="color:#fe2c24;"><strong>统一配置管理方案</strong></span>，可以<strong>集中</strong>管理所有实例的配置，而且还要实现<span style="color:#fe2c24;"><strong>热更新</strong></span>，即<strong>无需重启</strong>项目就可以让<strong>配置生效</strong>！</p> 
<blockquote> 
 <p>Nacos 就实现了这个功能！一方面可以将<strong>配置集中管理</strong>，另一方可以在配置<strong>变更</strong>时，及时通知微服务，实现配置的<span style="color:#fe2c24;"><strong>热更新</strong></span>。</p> 
</blockquote> 
<p class="img-center"><img alt="" height="398" src="https://images2.imgbox.com/c3/d8/w2IZNtGQ_o.png" width="948"></p> 
<p><strong>Nacos 配置中心的图形化界面</strong></p> 
<p class="img-center"><img alt="" height="226" src="https://images2.imgbox.com/bc/d8/wF40uV0P_o.png" width="663"></p> 
<h4 id="%EF%BC%881%EF%BC%89%E5%9C%A8%20Nacos%20%E4%B8%AD%E6%B7%BB%E5%8A%A0%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">（1）在 Nacos 中添加配置文件</h4> 
<p class="img-center"><img alt="" height="234" src="https://images2.imgbox.com/fe/14/HVej6C6y_o.png" width="663"></p> 
<p>然后在弹出的表单中，填写配置信息</p> 
<p class="img-center"><img alt="" height="232" src="https://images2.imgbox.com/01/6b/G9mQOa3G_o.png" width="683"></p> 
<p><strong>Data ID</strong>的<strong>命名规则</strong>一般是：<strong>“ <span style="color:#fe2c24;">服务名称-项目运行环境(开发).yaml</span> ” </strong></p> 
<blockquote> 
 <p><strong>注意：</strong></p> 
 <p>项目的核心配置，<strong>需要热更新的配置</strong>才有放到 Nacos 管理的必要。基本不会变更的一些配置还是保存在微服务本地比较好。</p> 
</blockquote> 
<h4 id="%EF%BC%882%EF%BC%89%E4%BB%8E%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8B%89%E5%8F%96%E9%85%8D%E7%BD%AE">（2）从微服务拉取配置</h4> 
<p>微服务要拉取 nacos 中管理的配置，并且与本地的 application.yml 配置<span style="color:#fe2c24;"><strong>合并</strong></span>，才能完成项目启动。</p> 
<p><span style="color:#fe2c24;"><strong>【问】但如果尚未读取 application.yml，又如何得知 nacos地址呢？</strong></span></p> 
<p>Spring引入了一种新的配置文件：<span style="color:#fe2c24;"><strong>bootstrap.yaml文件</strong></span>，会在 application.yml <strong>之前</strong>被读取！</p> 
<p>也就是说，我们可以把 <strong><span style="color:#fe2c24;">nacos的地址、文件相关信息</span> </strong>配置在 <strong>bootstrap.yaml</strong> 中，那么，我们就可以完成<strong> Nacos配置的读取</strong>！！！</p> 
<p><strong>详细流程如下：</strong></p> 
<p class="img-center"><img alt="" height="225" src="https://images2.imgbox.com/8c/e2/zPMI0RGp_o.png" width="683"></p> 
<p><strong>a. 引入 nacos-config 依赖</strong></p> 
<p>首先，在 user-service 服务中，引入 <strong>nacos-config</strong>的客户端依赖：</p> 
<div> 
 <pre><code class="language-XML">&lt;!--nacos配置管理依赖--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-config&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre> 
</div> 
<p><strong>b. 添加bootstrap.yaml  </strong></p> 
<p>然后，在<strong>user-service</strong>中添加一个 <strong>bootstrap.yaml</strong> 文件，内容如下：</p> 
<div> 
 <pre><code class="language-bash"># 优先级比 application 高！！！
spring:
  application:
    name: userservice
  profiles:
    active: dev  # 环境
  cloud:
    nacos:
      server-addr: localhost:8848  # nacos地址
      config:
        file-extension: yaml  #文件后缀名</code></pre> 
</div> 
<div> 
 <p><img alt="" height="327" src="https://images2.imgbox.com/3f/84/ev2v46qk_o.png" width="804">​</p> 
</div> 
<p><span style="color:#fe2c24;"><strong>注意：</strong></span>这里的文件名一定要是<strong>bootstrap</strong>，后缀 yml or yaml都行。 </p> 
<p><strong>c. 读取nacos配置 </strong> </p> 
<p>在<strong> user-service</strong> 中的 UserController 中添加业务逻辑，<strong><span style="color:#fe2c24;">读取 pattern.dateformat 配置</span></strong></p> 
<blockquote> 
 <p><strong>目的：</strong>这样子做是为了<strong>证明</strong>我们刚刚在 <strong>Nacos 控制台配置的内容</strong>可以<strong>生效</strong>。</p> 
</blockquote> 
<div> 
 <pre><code class="language-java">@Slf4j
@RestController
@RequestMapping("/user")
public class UserController {

    @Autowired
    private UserService userService;

    // nacos 统一配置热加载
    // 获取nacos配置文件 - userservice-dev.yaml
    // 用于证明 nacos 统一配置中心生效！
    @Value("${pattern.dataformat}")
    private String dateformat;

    @GetMapping("now")
    public String now() {
        // 按照我们在nacos上面配置的格式，完成格式化 yyyy-MM-dd HH:mm:ss
        return LocalDateTime.now().format(DateTimeFormatter.ofPattern(dateformat));
    }    
}
</code></pre> 
</div> 
<p>在<strong>8081、8082</strong>页面访问，可以看到效果：</p> 
<p><strong>8081端口</strong></p> 
<div> 
 <p class="img-center"><img alt="" height="148" src="https://images2.imgbox.com/cd/65/4BP6z2cm_o.png" width="594"></p> 
 <p><strong>8082端口</strong></p> 
</div> 
<div> 
 <p class="img-center"><img alt="" height="138" src="https://images2.imgbox.com/ff/46/HR5BE9Z2_o.png" width="595"></p> 
</div> 
<h3 id="2.%C2%A0%E9%85%8D%E7%BD%AE%E7%83%AD%E6%9B%B4%E6%96%B0">2. 配置热更新</h3> 
<p>最终的目的，是修改 nacos中的配置后，微服务中<strong>无需重启</strong>即可让配置生效，也就是<span style="color:#fe2c24;"><strong>配置热更新</strong></span>。</p> 
<p>要实现配置热更新，可以使用<span style="color:#fe2c24;"><strong>两种方式</strong></span></p> 
<h4 id="%E6%96%B9%E5%BC%8F%E4%B8%80%EF%BC%9A%E4%BD%BF%E7%94%A8%20%40RefreshScope%E6%B3%A8%E8%A7%A3">方式一：使用 @RefreshScope注解</h4> 
<div> 
 <pre><code class="language-java">@Slf4j
@RestController
@RequestMapping("/user")
@RefreshScope // 开启 nacos 属性刷新
public class UserController {
    ......
}
</code></pre> 
</div> 
<h4 id="%E6%96%B9%E5%BC%8F%E4%BA%8C%EF%BC%9A%E4%BD%BF%E7%94%A8%20%40ConfigurationProperties%E6%B3%A8%E8%A7%A3%E4%BB%A3%E6%9B%BF%20%40Value%E6%B3%A8%E8%A7%A3">方式二：使用 @ConfigurationProperties注解代替 @Value注解</h4> 
<blockquote> 
 <p><strong>@ConfigurationProperties</strong>：</p> 
 <p>这个注解可以完成<span style="color:#fe2c24;"><strong>配置的自动加载</strong></span>！采用的是约定大于配置的方式，只要 @ConfigurationProperties(prefix = "pattern") 中的 <strong>前缀名+变量名</strong>和配置文件一致，就可以完成<strong>属性的自动注入</strong>！！！</p> 
</blockquote> 
<p>在user-service服务中的<strong> config包</strong>下新建一个 <strong>PatternProperties类</strong>，读取 patterrn.dateformat属性</p> 
<p><strong>PatternProperties类</strong></p> 
<div> 
 <pre><code class="language-java">/**
 * @ConfigurationProperties: 这个注解可以完成配置的自动加载！
 * 前缀名+变量名和配置文件一致，就可以完成属性的自动注入！！！
 */
@Data
@Component
@ConfigurationProperties(prefix = "pattern")
public class PatternProperties {
    private String dateformat;
}
</code></pre> 
</div> 
<p><strong>UserController类</strong></p> 
<div> 
 <pre><code class="language-java">@Slf4j
@RestController
@RequestMapping("/user")
public class UserController {

    @Autowired
    private UserService userService;

    // nacos 统一配置热加载
    @Autowired
    private PatternProperties patternProperties;

    @GetMapping("now")
    public String now() {
        // 按照我们在nacos上面配置的格式，完成格式化 yyyy-MM-dd HH:mm:ss
        return LocalDateTime.now().format(DateTimeFormatter.ofPattern(patternProperties.getDateformat()));
    }
}
</code></pre> 
</div> 
<h3 id="3.%20%E9%85%8D%E7%BD%AE%E5%85%B1%E4%BA%AB">3. 配置共享</h3> 
<p>其实微服务启动时，会去nacos<span style="color:#fe2c24;"><strong>读取多个配置文件</strong></span></p> 
<ul><li> <p><code>[spring.application.name]-[spring.profiles.active].yaml</code>，例如：<strong>userservice-dev.yaml</strong></p> </li><li> <p><code>[spring.application.name].yaml</code>，例如：<strong>userservice.yaml</strong></p> </li></ul> 
<p>而<strong><code>[spring.application.name].yaml</code><span style="color:#fe2c24;">不包含环境</span></strong>，因此可以<span style="color:#fe2c24;"><strong>被多个环境共享</strong></span>。</p> 
<p>所以，我们现在就是要<strong><span style="color:#fe2c24;">验证 </span>userservice.yaml </strong>能否被<strong>多个环境共享</strong>？</p> 
<h4 id="%EF%BC%881%EF%BC%89%E6%B7%BB%E5%8A%A0%E4%B8%80%E4%B8%AA%E7%8E%AF%E5%A2%83%E5%85%B1%E4%BA%AB%E9%85%8D%E7%BD%AE">（1）添加一个环境共享配置</h4> 
<p>我们在 Nacos 中添加一个<strong>userservice.yaml</strong>文件</p> 
<p class="img-center"><img alt="" height="397" src="https://images2.imgbox.com/82/8e/nuXwlMyn_o.png" width="655"></p> 
<h4 id="%EF%BC%882%EF%BC%89%E5%9C%A8user-service%E4%B8%AD%E8%AF%BB%E5%8F%96%E5%85%B1%E4%BA%AB%E9%85%8D%E7%BD%AE">（2）在user-service中读取共享配置</h4> 
<p>修改PatternProperties类，读取新添加的属性</p> 
<div> 
 <pre><code class="language-java">@Data
@Component
@ConfigurationProperties(prefix = "pattern")
public class PatternProperties {

    private String dataformat;

    private String envShareValue;
}
</code></pre> 
</div> 
<p>在user-service服务中，<strong>修改UserController</strong>，<strong>添加一个方法  </strong></p> 
<div> 
 <pre><code class="language-java">@Slf4j
@RestController
@RequestMapping("/user")
//@RefreshScope // 开启 nacos 属性刷新
public class UserController {

    // nacos 统一配置热加载
    @Autowired
    private PatternProperties patternProperties;

    // 共享配置
    @GetMapping("prop")
    public PatternProperties properties() {
        return patternProperties;
    }
}</code></pre> 
</div> 
<h4 id="%EF%BC%883%EF%BC%89%E8%BF%90%E8%A1%8C%E4%B8%A4%E4%B8%AAUserApplication%EF%BC%8C%E4%BD%BF%E7%94%A8%E4%B8%8D%E5%90%8C%E7%9A%84profile">（3）运行两个UserApplication，使用不同的profile</h4> 
<p>修改UserApplication2这个启动项，<span style="color:#fe2c24;"><strong>改变其active profile值</strong></span></p> 
<p class="img-center"><img alt="" height="412" src="https://images2.imgbox.com/0d/9c/UyK6nnl9_o.png" width="670"></p> 
<p>这样，<strong>UserApplication1(8081)</strong>使用的profile是<strong>dev(开发)</strong>，<strong>UserApplication2(8082)</strong>使用的profile是<strong>test(测试)</strong></p> 
<p>分别启动 <strong>UserApplication1 </strong>和 <strong>UserApplication2</strong></p> 
<p>访问页面  <strong>localhost:8081/user/prop</strong></p> 
<p class="img-center"><img alt="" height="291" src="https://images2.imgbox.com/b8/e1/ShdZobdJ_o.png" width="644"></p> 
<p>​访问页面 <strong>localhost:8082/user/prop</strong></p> 
<p class="img-center"><img alt="" height="311" src="https://images2.imgbox.com/1c/ad/e1lc9CCr_o.png" width="648"></p> 
<p>可以看出来，dataformat是配置在dev环境的，所以在test环境中是读不到的。</p> 
<p>但是，不管是dev，还是test环境，<strong>都读取到了envSharedValue</strong>这个属性的值，<span style="color:#fe2c24;">说明了<strong>userservice.yaml </strong>被多个环境共享了！</span></p> 
<h4 id="%EF%BC%884%EF%BC%89%E9%85%8D%E7%BD%AE%E5%85%B1%E4%BA%AB%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7">（4）配置共享的优先级</h4> 
<p>假如，<strong>userservice.yaml 和 </strong><strong>userservice-dev.yaml </strong>有一个同名属性时，那么该属性究竟为何值呢？？？</p> 
<p>这就要谈谈<strong>配置共享的优先级</strong>了！</p> 
<p><img alt="" height="267" src="https://images2.imgbox.com/ad/4a/DEqoxFo1_o.png" width="607"></p> 
<h3 id="4.%20%E6%90%AD%E5%BB%BANacos%E9%9B%86%E7%BE%A4">4. 搭建Nacos集群</h3> 
<p class="img-center"><img alt="" height="610" src="https://images2.imgbox.com/0b/db/sGYa1KN7_o.png" width="655"></p> 
<p><a class="has-card" href="https://blog.csdn.net/weixin_43715214/article/details/128762945" title="【SpringCloud】Nacos集群搭建_面向架构编程的博客-CSDN博客"><span class="link-card-box"><span class="link-title">【SpringCloud】Nacos集群搭建_面向架构编程的博客-CSDN博客</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/ee/77/3w3xDCij_o.png" alt="icon-default.png?t=MBR7">https://blog.csdn.net/weixin_43715214/article/details/128762945</span></span></a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/98744e9efe8a51033948832b92d49d18/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Spring自定义starter依赖以及相关引入依赖无法导入的问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/73c35cea6f0d68e9969294be6c5df179/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">51单片机PWM控制舵机</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>