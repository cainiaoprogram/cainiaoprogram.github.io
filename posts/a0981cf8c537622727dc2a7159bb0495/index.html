<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>C# 调用海康相机SDK - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="C# 调用海康相机SDK" />
<meta property="og:description" content="一、查找相机设备 /// &lt;summary&gt; /// 枚举相机 /// &lt;/summary&gt; public List&lt;string&gt; DeviceListAcq() { var list = new List&lt;string&gt;(); // ch:创建设备列表 | en:Create Device List System.GC.Collect(); //cbDeviceList.Items.Clear(); list.Clear(); m_stDeviceList.nDeviceNum = 0; //MV_CC_EnumDevices_NET 查找设备 枚举了GigE相机的设备信息 CGigECameraInfo 、 //U3V相机的设备信息 CUSBCameraInfo 、Camera Link相机的设备信息 CCamLCameraInfo 。 //查找成功 返回0 没有查找成功--非0 显示ShowErrorMsg int nRet = MyCamera.MV_CC_EnumDevices_NET(MyCamera.MV_GIGE_DEVICE | MyCamera.MV_USB_DEVICE, ref m_stDeviceList); if (0 != nRet) { throw new ArgumentException(&#34;Enum Devices Fail&#34;); //MessageBox.Show(&#34;Enum Devices Fail&#34;); } // ch:在窗体列表中显示设备名 | en:Display device name in the form list for (int i = 0; i &lt; m_stDeviceList." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/a0981cf8c537622727dc2a7159bb0495/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-01T16:58:27+08:00" />
<meta property="article:modified_time" content="2023-04-01T16:58:27+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">C# 调用海康相机SDK</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>一、查找相机设备</h2> 
<pre><code class="prism language-csharp"> <span class="token comment">/// &lt;summary&gt;</span>
 <span class="token comment">/// 枚举相机 </span>
 <span class="token comment">/// &lt;/summary&gt;</span>
 <span class="token keyword">public</span>  <span class="token return-type class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> <span class="token function">DeviceListAcq</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
            <span class="token class-name"><span class="token keyword">var</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// ch:创建设备列表 | en:Create Device List</span>
            System<span class="token punctuation">.</span>GC<span class="token punctuation">.</span><span class="token function">Collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//cbDeviceList.Items.Clear(); </span>
            list<span class="token punctuation">.</span><span class="token function">Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            m_stDeviceList<span class="token punctuation">.</span>nDeviceNum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token comment">//MV_CC_EnumDevices_NET 查找设备 枚举了GigE相机的设备信息 CGigECameraInfo 、</span>
            <span class="token comment">//U3V相机的设备信息 CUSBCameraInfo 、Camera Link相机的设备信息 CCamLCameraInfo 。</span>
            <span class="token comment">//查找成功 返回0 没有查找成功--非0 显示ShowErrorMsg</span>
            <span class="token class-name"><span class="token keyword">int</span></span> nRet <span class="token operator">=</span> MyCamera<span class="token punctuation">.</span><span class="token function">MV_CC_EnumDevices_NET</span><span class="token punctuation">(</span>MyCamera<span class="token punctuation">.</span>MV_GIGE_DEVICE <span class="token operator">|</span> MyCamera<span class="token punctuation">.</span>MV_USB_DEVICE<span class="token punctuation">,</span> <span class="token keyword">ref</span> m_stDeviceList<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> nRet<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArgumentException</span><span class="token punctuation">(</span><span class="token string">"Enum Devices Fail"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//MessageBox.Show("Enum Devices Fail");</span>
    
            <span class="token punctuation">}</span>

            <span class="token comment">// ch:在窗体列表中显示设备名 | en:Display device name in the form list</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> m_stDeviceList<span class="token punctuation">.</span>nDeviceNum<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">MyCamera<span class="token punctuation">.</span>MV_CC_DEVICE_INFO</span> device <span class="token operator">=</span> <span class="token punctuation">(</span>MyCamera<span class="token punctuation">.</span>MV_CC_DEVICE_INFO<span class="token punctuation">)</span>Marshal<span class="token punctuation">.</span><span class="token function">PtrToStructure</span><span class="token punctuation">(</span>m_stDeviceList<span class="token punctuation">.</span>pDeviceInfo<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">MyCamera<span class="token punctuation">.</span>MV_CC_DEVICE_INFO</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>device<span class="token punctuation">.</span>nTLayerType <span class="token operator">==</span> MyCamera<span class="token punctuation">.</span>MV_GIGE_DEVICE<span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token class-name">MyCamera<span class="token punctuation">.</span>MV_GIGE_DEVICE_INFO</span> gigeInfo <span class="token operator">=</span> <span class="token punctuation">(</span>MyCamera<span class="token punctuation">.</span>MV_GIGE_DEVICE_INFO<span class="token punctuation">)</span>MyCamera<span class="token punctuation">.</span><span class="token function">ByteToStruct</span><span class="token punctuation">(</span>device<span class="token punctuation">.</span>SpecialInfo<span class="token punctuation">.</span>stGigEInfo<span class="token punctuation">,</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">MyCamera<span class="token punctuation">.</span>MV_GIGE_DEVICE_INFO</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token keyword">if</span> <span class="token punctuation">(</span>gigeInfo<span class="token punctuation">.</span>chUserDefinedName <span class="token operator">!=</span> <span class="token string">""</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{<!-- --></span>
                        list<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">"GEV: "</span> <span class="token operator">+</span> gigeInfo<span class="token punctuation">.</span>chUserDefinedName <span class="token operator">+</span> <span class="token string">" ("</span> <span class="token operator">+</span> gigeInfo<span class="token punctuation">.</span>chSerialNumber <span class="token operator">+</span> <span class="token string">")"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">else</span>
                    <span class="token punctuation">{<!-- --></span>
                        list<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">"GEV: "</span> <span class="token operator">+</span> gigeInfo<span class="token punctuation">.</span>chManufacturerName <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> gigeInfo<span class="token punctuation">.</span>chModelName <span class="token operator">+</span> <span class="token string">" ("</span> <span class="token operator">+</span> gigeInfo<span class="token punctuation">.</span>chSerialNumber <span class="token operator">+</span> <span class="token string">")"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>device<span class="token punctuation">.</span>nTLayerType <span class="token operator">==</span> MyCamera<span class="token punctuation">.</span>MV_USB_DEVICE<span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token class-name">MyCamera<span class="token punctuation">.</span>MV_USB3_DEVICE_INFO</span> usbInfo <span class="token operator">=</span> <span class="token punctuation">(</span>MyCamera<span class="token punctuation">.</span>MV_USB3_DEVICE_INFO<span class="token punctuation">)</span>MyCamera<span class="token punctuation">.</span><span class="token function">ByteToStruct</span><span class="token punctuation">(</span>device<span class="token punctuation">.</span>SpecialInfo<span class="token punctuation">.</span>stUsb3VInfo<span class="token punctuation">,</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">MyCamera<span class="token punctuation">.</span>MV_USB3_DEVICE_INFO</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>usbInfo<span class="token punctuation">.</span>chUserDefinedName <span class="token operator">!=</span> <span class="token string">""</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{<!-- --></span>
                        list<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">"U3V: "</span> <span class="token operator">+</span> usbInfo<span class="token punctuation">.</span>chUserDefinedName <span class="token operator">+</span> <span class="token string">" ("</span> <span class="token operator">+</span> usbInfo<span class="token punctuation">.</span>chSerialNumber <span class="token operator">+</span> <span class="token string">")"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">else</span>
                    <span class="token punctuation">{<!-- --></span>
                        list<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">"U3V: "</span> <span class="token operator">+</span> usbInfo<span class="token punctuation">.</span>chManufacturerName <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> usbInfo<span class="token punctuation">.</span>chModelName <span class="token operator">+</span> <span class="token string">" ("</span> <span class="token operator">+</span> usbInfo<span class="token punctuation">.</span>chSerialNumber <span class="token operator">+</span> <span class="token string">")"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// ch:选择第一项 | en:Select the first item</span>
            <span class="token comment">//if (m_stDeviceList.nDeviceNum != 0)</span>
            <span class="token comment">//{<!-- --></span>
            <span class="token comment">//    cbDeviceList.SelectedIndex = 0;</span>
            <span class="token comment">//}</span>
            <span class="token keyword">return</span> list<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="_64"></a>二、打开相机</h2> 
<pre><code class="prism language-csharp">        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 获得相机的信息。异常:ArgumentException</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name="index"&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">MyCamera<span class="token punctuation">.</span>MV_CC_DEVICE_INFO</span> <span class="token function">GetCameraInfo</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> index<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>m_stDeviceList<span class="token punctuation">.</span>nDeviceNum <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">// || cbDeviceList.SelectedIndex == -1)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArgumentException</span><span class="token punctuation">(</span><span class="token string">"没有可用的相机设备"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token punctuation">}</span>
            <span class="token comment">// ch:获取选择的设备信息 | en:Get selected device information</span>
            <span class="token class-name">MyCamera<span class="token punctuation">.</span>MV_CC_DEVICE_INFO</span> device <span class="token operator">=</span>
                <span class="token punctuation">(</span>MyCamera<span class="token punctuation">.</span>MV_CC_DEVICE_INFO<span class="token punctuation">)</span>Marshal<span class="token punctuation">.</span><span class="token function">PtrToStructure</span><span class="token punctuation">(</span>m_stDeviceList<span class="token punctuation">.</span>pDeviceInfo<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">,</span>
                                                              <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">MyCamera<span class="token punctuation">.</span>MV_CC_DEVICE_INFO</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> device<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 打开相机。异常:ArgumentException</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name="index"&gt;&lt;/param&gt;</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OpenCamera</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> index<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>

            <span class="token keyword">try</span>
            <span class="token punctuation">{<!-- --></span>

                <span class="token comment">//获得相机信息</span>
                <span class="token class-name"><span class="token keyword">var</span></span> camerainfo <span class="token operator">=</span> <span class="token function">GetCameraInfo</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//创建相机句柄</span>
                <span class="token class-name"><span class="token keyword">int</span></span> nRet<span class="token operator">=</span> m_MyCamera<span class="token punctuation">.</span><span class="token function">MV_CC_CreateDevice_NET</span><span class="token punctuation">(</span><span class="token keyword">ref</span> camerainfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>MyCamera<span class="token punctuation">.</span>MV_OK <span class="token operator">!=</span> nRet<span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArgumentException</span><span class="token punctuation">(</span><span class="token string">"创建相机句柄失败!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token punctuation">}</span>

                nRet <span class="token operator">=</span> m_MyCamera<span class="token punctuation">.</span><span class="token function">MV_CC_OpenDevice_NET</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>MyCamera<span class="token punctuation">.</span>MV_OK <span class="token operator">!=</span> nRet<span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    m_MyCamera<span class="token punctuation">.</span><span class="token function">MV_CC_DestroyDevice_NET</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArgumentException</span><span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"打开相机失败!{0}"</span><span class="token punctuation">,</span>nRet<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token punctuation">}</span>

                <span class="token comment">// ch:探测网络最佳包大小(只对GigE相机有效) | en:Detection network optimal package size(It only works for the GigE camera)</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>camerainfo<span class="token punctuation">.</span>nTLayerType <span class="token operator">==</span> MyCamera<span class="token punctuation">.</span>MV_GIGE_DEVICE<span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token class-name"><span class="token keyword">int</span></span> nPacketSize <span class="token operator">=</span> m_MyCamera<span class="token punctuation">.</span><span class="token function">MV_CC_GetOptimalPacketSize_NET</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>nPacketSize <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{<!-- --></span>
                        nRet <span class="token operator">=</span> m_MyCamera<span class="token punctuation">.</span><span class="token function">MV_CC_SetIntValueEx_NET</span><span class="token punctuation">(</span><span class="token string">"GevSCPSPacketSize"</span><span class="token punctuation">,</span> nPacketSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>nRet <span class="token operator">!=</span> MyCamera<span class="token punctuation">.</span>MV_OK<span class="token punctuation">)</span>
                        <span class="token punctuation">{<!-- --></span>
                            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArgumentException</span><span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"Set Packet Size failed!"</span><span class="token punctuation">,</span>nRet<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">else</span>
                    <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArgumentException</span><span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"Get Packet Size failed!"</span><span class="token punctuation">,</span> nPacketSize<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>

                <span class="token comment">// ch:设置采集连续模式 | en:Set Continues Aquisition Mode</span>
                m_MyCamera<span class="token punctuation">.</span><span class="token function">MV_CC_SetEnumValue_NET</span><span class="token punctuation">(</span><span class="token string">"AcquisitionMode"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">uint</span><span class="token punctuation">)</span>MyCamera<span class="token punctuation">.</span>MV_CAM_ACQUISITION_MODE<span class="token punctuation">.</span>MV_ACQ_MODE_CONTINUOUS<span class="token punctuation">)</span><span class="token punctuation">;</span>
                m_MyCamera<span class="token punctuation">.</span><span class="token function">MV_CC_SetEnumValue_NET</span><span class="token punctuation">(</span><span class="token string">"TriggerMode"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">uint</span><span class="token punctuation">)</span>MyCamera<span class="token punctuation">.</span>MV_CAM_TRIGGER_MODE<span class="token punctuation">.</span>MV_TRIGGER_MODE_OFF<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">ArgumentException</span> ex<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">throw</span> ex<span class="token punctuation">;</span>
             <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">CloseCamera</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// ch:取流标志位清零 | en:Reset flow flag bit</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>m_bGrabbing <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                m_bGrabbing <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                m_hReceiveThread<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>m_BufForDriver <span class="token operator">!=</span> IntPtr<span class="token punctuation">.</span>Zero<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                Marshal<span class="token punctuation">.</span><span class="token function">Release</span><span class="token punctuation">(</span>m_BufForDriver<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// ch:关闭设备 | en:Close Device</span>
            m_MyCamera<span class="token punctuation">.</span><span class="token function">MV_CC_CloseDevice_NET</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            m_MyCamera<span class="token punctuation">.</span><span class="token function">MV_CC_DestroyDevice_NET</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre> 
<h2><a id="_161"></a>三、关闭相机</h2> 
<pre><code class="prism language-csharp">
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">CloseCamera</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// ch:取流标志位清零 | en:Reset flow flag bit</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>m_bGrabbing <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                m_bGrabbing <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                m_hReceiveThread<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>m_BufForDriver <span class="token operator">!=</span> IntPtr<span class="token punctuation">.</span>Zero<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                Marshal<span class="token punctuation">.</span><span class="token function">Release</span><span class="token punctuation">(</span>m_BufForDriver<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// ch:关闭设备 | en:Close Device</span>
            m_MyCamera<span class="token punctuation">.</span><span class="token function">MV_CC_CloseDevice_NET</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            m_MyCamera<span class="token punctuation">.</span><span class="token function">MV_CC_DestroyDevice_NET</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

</code></pre> 
<h2><a id="_185"></a>四、开始采集图像</h2> 
<pre><code class="prism language-csharp">        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 线程</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ReceiveThreadProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//获得</span>
            <span class="token class-name">MyCamera<span class="token punctuation">.</span>MVCC_INTVALUE</span> stParam <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyCamera<span class="token punctuation">.</span>MVCC_INTVALUE</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">int</span></span> nRet <span class="token operator">=</span> m_MyCamera<span class="token punctuation">.</span><span class="token function">MV_CC_GetIntValue_NET</span><span class="token punctuation">(</span><span class="token string">"PayloadSize"</span><span class="token punctuation">,</span> <span class="token keyword">ref</span> stParam<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>MyCamera<span class="token punctuation">.</span>MV_OK <span class="token operator">!=</span> nRet<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token comment">//ShowErrorMsg("Get PayloadSize failed", nRet);</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token class-name">UInt32</span> nPayloadSize <span class="token operator">=</span> stParam<span class="token punctuation">.</span>nCurValue<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>nPayloadSize <span class="token operator">&gt;</span> m_nBufSizeForDriver<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>m_BufForDriver <span class="token operator">!=</span> IntPtr<span class="token punctuation">.</span>Zero<span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    Marshal<span class="token punctuation">.</span><span class="token function">Release</span><span class="token punctuation">(</span>m_BufForDriver<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                m_nBufSizeForDriver <span class="token operator">=</span> nPayloadSize<span class="token punctuation">;</span>
                m_BufForDriver <span class="token operator">=</span> Marshal<span class="token punctuation">.</span><span class="token function">AllocHGlobal</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Int32<span class="token punctuation">)</span>m_nBufSizeForDriver<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>m_BufForDriver <span class="token operator">==</span> IntPtr<span class="token punctuation">.</span>Zero<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token class-name">MyCamera<span class="token punctuation">.</span>MV_FRAME_OUT_INFO_EX</span> stFrameInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyCamera<span class="token punctuation">.</span>MV_FRAME_OUT_INFO_EX</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//MyCamera.MV_DISPLAY_FRAME_INFO stDisplayInfo = new MyCamera.MV_DISPLAY_FRAME_INFO();</span>

            <span class="token keyword">while</span> <span class="token punctuation">(</span>m_bGrabbing<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">lock</span> <span class="token punctuation">(</span>BufForDriverLock<span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    nRet <span class="token operator">=</span> m_MyCamera<span class="token punctuation">.</span><span class="token function">MV_CC_GetOneFrameTimeout_NET</span><span class="token punctuation">(</span>m_BufForDriver<span class="token punctuation">,</span> nPayloadSize<span class="token punctuation">,</span> <span class="token keyword">ref</span> stFrameInfo<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>nRet <span class="token operator">==</span> MyCamera<span class="token punctuation">.</span>MV_OK<span class="token punctuation">)</span>
                    <span class="token punctuation">{<!-- --></span>
                        m_stFrameInfo <span class="token operator">=</span> stFrameInfo<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>nRet <span class="token operator">==</span> MyCamera<span class="token punctuation">.</span>MV_OK<span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    
                    <span class="token comment">//显示图像</span>

                    stDisplayInfo<span class="token punctuation">.</span>hWnd <span class="token operator">=</span> winHandle<span class="token punctuation">;</span>
                    stDisplayInfo<span class="token punctuation">.</span>pData <span class="token operator">=</span> m_BufForDriver<span class="token punctuation">;</span>
                    stDisplayInfo<span class="token punctuation">.</span>nDataLen <span class="token operator">=</span> stFrameInfo<span class="token punctuation">.</span>nFrameLen<span class="token punctuation">;</span>
                    stDisplayInfo<span class="token punctuation">.</span>nWidth <span class="token operator">=</span> stFrameInfo<span class="token punctuation">.</span>nWidth<span class="token punctuation">;</span>
                    stDisplayInfo<span class="token punctuation">.</span>nHeight <span class="token operator">=</span> stFrameInfo<span class="token punctuation">.</span>nHeight<span class="token punctuation">;</span>
                    stDisplayInfo<span class="token punctuation">.</span>enPixelType <span class="token operator">=</span> stFrameInfo<span class="token punctuation">.</span>enPixelType<span class="token punctuation">;</span>
                    m_MyCamera<span class="token punctuation">.</span><span class="token function">MV_CC_DisplayOneFrame_NET</span><span class="token punctuation">(</span><span class="token keyword">ref</span> stDisplayInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment">//else</span>
                <span class="token comment">//{<!-- --></span>
                <span class="token comment">//    if (bnTriggerMode.Checked)</span>
                <span class="token comment">//    {<!-- --></span>
                <span class="token comment">//        Thread.Sleep(5);</span>
                <span class="token comment">//    }</span>
                <span class="token comment">//}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 开始采集。异常:ArgumentException</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">StartGrab</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// ch:标志位置位true | en:Set position bit true</span>
            m_bGrabbing <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            m_hReceiveThread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Thread</span><span class="token punctuation">(</span>ReceiveThreadProcess<span class="token punctuation">)</span><span class="token punctuation">;</span>
            m_hReceiveThread<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            m_stFrameInfo<span class="token punctuation">.</span>nFrameLen <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//取流之前先清除帧长度</span>
            m_stFrameInfo<span class="token punctuation">.</span>enPixelType <span class="token operator">=</span> MyCamera<span class="token punctuation">.</span>MvGvspPixelType<span class="token punctuation">.</span>PixelType_Gvsp_Undefined<span class="token punctuation">;</span>
            <span class="token comment">// ch:开始采集 | en:Start Grabbing</span>
            <span class="token class-name"><span class="token keyword">int</span></span> nRet <span class="token operator">=</span> m_MyCamera<span class="token punctuation">.</span><span class="token function">MV_CC_StartGrabbing_NET</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>MyCamera<span class="token punctuation">.</span>MV_OK <span class="token operator">!=</span> nRet<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                m_bGrabbing <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                m_hReceiveThread<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArgumentException</span><span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"Start Grabbing Fail!{0}"</span><span class="token punctuation">,</span> nRet<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            
            <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>
</code></pre> 
<h2><a id="_276"></a>五、停止采集图像</h2> 
<pre><code class="prism language-csharp">        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 停止采集。 异常:ArgumentException</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">StopGrab</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// ch:标志位设为false | en:Set flag bit false</span>
            m_bGrabbing <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            m_hReceiveThread<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// ch:停止采集 | en:Stop Grabbing</span>
            <span class="token comment">//MV_CC_StopGrabbing_NET  停止采集图像。  成功，返回MyCamera.MV_OK（0）；失败，返回错误码</span>
            <span class="token class-name"><span class="token keyword">int</span></span> nRet <span class="token operator">=</span> m_MyCamera<span class="token punctuation">.</span><span class="token function">MV_CC_StopGrabbing_NET</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>nRet <span class="token operator">!=</span> MyCamera<span class="token punctuation">.</span>MV_OK<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArgumentException</span><span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"Stop Grabbing Fail!{0}"</span><span class="token punctuation">,</span> nRet<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> 
        <span class="token punctuation">}</span>
</code></pre> 
<h2><a id="_297"></a>六、保持采集的图像</h2> 
<pre><code class="prism language-csharp">       
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 判断是不是黑白数据</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name="enGvspPixelType"&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token keyword">private</span> <span class="token return-type class-name">Boolean</span> <span class="token function">IsMonoData</span><span class="token punctuation">(</span><span class="token class-name">MyCamera<span class="token punctuation">.</span>MvGvspPixelType</span> enGvspPixelType<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span>enGvspPixelType<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">case</span> MyCamera<span class="token punctuation">.</span>MvGvspPixelType<span class="token punctuation">.</span>PixelType_Gvsp_Mono8<span class="token punctuation">:</span>
                <span class="token keyword">case</span> MyCamera<span class="token punctuation">.</span>MvGvspPixelType<span class="token punctuation">.</span>PixelType_Gvsp_Mono10<span class="token punctuation">:</span>
                <span class="token keyword">case</span> MyCamera<span class="token punctuation">.</span>MvGvspPixelType<span class="token punctuation">.</span>PixelType_Gvsp_Mono10_Packed<span class="token punctuation">:</span>
                <span class="token keyword">case</span> MyCamera<span class="token punctuation">.</span>MvGvspPixelType<span class="token punctuation">.</span>PixelType_Gvsp_Mono12<span class="token punctuation">:</span>
                <span class="token keyword">case</span> MyCamera<span class="token punctuation">.</span>MvGvspPixelType<span class="token punctuation">.</span>PixelType_Gvsp_Mono12_Packed<span class="token punctuation">:</span>
                    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

                <span class="token keyword">default</span><span class="token punctuation">:</span>
                    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        
        
        
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 判断是否是彩色图像数据 </span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name="enGvspPixelType"&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;  成功，返回0；错误，返回-1 </span>
        <span class="token keyword">private</span> <span class="token return-type class-name">Boolean</span> <span class="token function">IsColorData</span><span class="token punctuation">(</span><span class="token class-name">MyCamera<span class="token punctuation">.</span>MvGvspPixelType</span> enGvspPixelType<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span>enGvspPixelType<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">case</span> MyCamera<span class="token punctuation">.</span>MvGvspPixelType<span class="token punctuation">.</span>PixelType_Gvsp_BayerGR8<span class="token punctuation">:</span>
                <span class="token keyword">case</span> MyCamera<span class="token punctuation">.</span>MvGvspPixelType<span class="token punctuation">.</span>PixelType_Gvsp_BayerRG8<span class="token punctuation">:</span>
                <span class="token keyword">case</span> MyCamera<span class="token punctuation">.</span>MvGvspPixelType<span class="token punctuation">.</span>PixelType_Gvsp_BayerGB8<span class="token punctuation">:</span>
                <span class="token keyword">case</span> MyCamera<span class="token punctuation">.</span>MvGvspPixelType<span class="token punctuation">.</span>PixelType_Gvsp_BayerBG8<span class="token punctuation">:</span>
                <span class="token keyword">case</span> MyCamera<span class="token punctuation">.</span>MvGvspPixelType<span class="token punctuation">.</span>PixelType_Gvsp_BayerGR10<span class="token punctuation">:</span>
                <span class="token keyword">case</span> MyCamera<span class="token punctuation">.</span>MvGvspPixelType<span class="token punctuation">.</span>PixelType_Gvsp_BayerRG10<span class="token punctuation">:</span>
                <span class="token keyword">case</span> MyCamera<span class="token punctuation">.</span>MvGvspPixelType<span class="token punctuation">.</span>PixelType_Gvsp_BayerGB10<span class="token punctuation">:</span>
                <span class="token keyword">case</span> MyCamera<span class="token punctuation">.</span>MvGvspPixelType<span class="token punctuation">.</span>PixelType_Gvsp_BayerBG10<span class="token punctuation">:</span>
                <span class="token keyword">case</span> MyCamera<span class="token punctuation">.</span>MvGvspPixelType<span class="token punctuation">.</span>PixelType_Gvsp_BayerGR12<span class="token punctuation">:</span>
                <span class="token keyword">case</span> MyCamera<span class="token punctuation">.</span>MvGvspPixelType<span class="token punctuation">.</span>PixelType_Gvsp_BayerRG12<span class="token punctuation">:</span>
                <span class="token keyword">case</span> MyCamera<span class="token punctuation">.</span>MvGvspPixelType<span class="token punctuation">.</span>PixelType_Gvsp_BayerGB12<span class="token punctuation">:</span>
                <span class="token keyword">case</span> MyCamera<span class="token punctuation">.</span>MvGvspPixelType<span class="token punctuation">.</span>PixelType_Gvsp_BayerBG12<span class="token punctuation">:</span>
                <span class="token keyword">case</span> MyCamera<span class="token punctuation">.</span>MvGvspPixelType<span class="token punctuation">.</span>PixelType_Gvsp_BayerGR10_Packed<span class="token punctuation">:</span>
                <span class="token keyword">case</span> MyCamera<span class="token punctuation">.</span>MvGvspPixelType<span class="token punctuation">.</span>PixelType_Gvsp_BayerRG10_Packed<span class="token punctuation">:</span>
                <span class="token keyword">case</span> MyCamera<span class="token punctuation">.</span>MvGvspPixelType<span class="token punctuation">.</span>PixelType_Gvsp_BayerGB10_Packed<span class="token punctuation">:</span>
                <span class="token keyword">case</span> MyCamera<span class="token punctuation">.</span>MvGvspPixelType<span class="token punctuation">.</span>PixelType_Gvsp_BayerBG10_Packed<span class="token punctuation">:</span>
                <span class="token keyword">case</span> MyCamera<span class="token punctuation">.</span>MvGvspPixelType<span class="token punctuation">.</span>PixelType_Gvsp_BayerGR12_Packed<span class="token punctuation">:</span>
                <span class="token keyword">case</span> MyCamera<span class="token punctuation">.</span>MvGvspPixelType<span class="token punctuation">.</span>PixelType_Gvsp_BayerRG12_Packed<span class="token punctuation">:</span>
                <span class="token keyword">case</span> MyCamera<span class="token punctuation">.</span>MvGvspPixelType<span class="token punctuation">.</span>PixelType_Gvsp_BayerGB12_Packed<span class="token punctuation">:</span>
                <span class="token keyword">case</span> MyCamera<span class="token punctuation">.</span>MvGvspPixelType<span class="token punctuation">.</span>PixelType_Gvsp_BayerBG12_Packed<span class="token punctuation">:</span>
                <span class="token keyword">case</span> MyCamera<span class="token punctuation">.</span>MvGvspPixelType<span class="token punctuation">.</span>PixelType_Gvsp_RGB8_Packed<span class="token punctuation">:</span>
                <span class="token keyword">case</span> MyCamera<span class="token punctuation">.</span>MvGvspPixelType<span class="token punctuation">.</span>PixelType_Gvsp_YUV422_Packed<span class="token punctuation">:</span>
                <span class="token keyword">case</span> MyCamera<span class="token punctuation">.</span>MvGvspPixelType<span class="token punctuation">.</span>PixelType_Gvsp_YUV422_YUYV_Packed<span class="token punctuation">:</span>
                <span class="token keyword">case</span> MyCamera<span class="token punctuation">.</span>MvGvspPixelType<span class="token punctuation">.</span>PixelType_Gvsp_YCBCR411_8_CBYYCRYY<span class="token punctuation">:</span>
                    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

                <span class="token keyword">default</span><span class="token punctuation">:</span>
                    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>


        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">///将图片保存为BMP格式 异常:ArgumentException</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name="fname"&gt;&lt;/param&gt;</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ImageSaveBMP</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> fname<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> m_bGrabbing<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArgumentException</span><span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"没有开始采集不能保存图像！0"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      
            <span class="token punctuation">}</span>
    
            <span class="token class-name">IntPtr</span> pTemp <span class="token operator">=</span> IntPtr<span class="token punctuation">.</span>Zero<span class="token punctuation">;</span>
            <span class="token class-name">MyCamera<span class="token punctuation">.</span>MvGvspPixelType</span> enDstPixelType <span class="token operator">=</span> MyCamera<span class="token punctuation">.</span>MvGvspPixelType<span class="token punctuation">.</span>PixelType_Gvsp_Undefined<span class="token punctuation">;</span>
            <span class="token comment">//先判断相机类型 是Mono8黑白还是BGR8彩色</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>m_stFrameInfo<span class="token punctuation">.</span>enPixelType <span class="token operator">==</span> MyCamera<span class="token punctuation">.</span>MvGvspPixelType<span class="token punctuation">.</span>PixelType_Gvsp_Mono8 <span class="token operator">||</span> 
                m_stFrameInfo<span class="token punctuation">.</span>enPixelType <span class="token operator">==</span> MyCamera<span class="token punctuation">.</span>MvGvspPixelType<span class="token punctuation">.</span>PixelType_Gvsp_BGR8_Packed<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                pTemp <span class="token operator">=</span> m_BufForDriver<span class="token punctuation">;</span>
                enDstPixelType <span class="token operator">=</span> m_stFrameInfo<span class="token punctuation">.</span>enPixelType<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">UInt32</span> nSaveImageNeedSize <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                <span class="token class-name">MyCamera<span class="token punctuation">.</span>MV_PIXEL_CONVERT_PARAM</span> stConverPixelParam <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyCamera<span class="token punctuation">.</span>MV_PIXEL_CONVERT_PARAM</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">lock</span> <span class="token punctuation">(</span>BufForDriverLock<span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>m_stFrameInfo<span class="token punctuation">.</span>nFrameLen <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArgumentException</span><span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"Save Bmp Fail! 0"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>


                    <span class="token comment">//判断是否是黑白数据函数</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">IsMonoData</span><span class="token punctuation">(</span>m_stFrameInfo<span class="token punctuation">.</span>enPixelType<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{<!-- --></span>
                        enDstPixelType <span class="token operator">=</span> MyCamera<span class="token punctuation">.</span>MvGvspPixelType<span class="token punctuation">.</span>PixelType_Gvsp_Mono8<span class="token punctuation">;</span>
                        nSaveImageNeedSize <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">uint</span><span class="token punctuation">)</span>m_stFrameInfo<span class="token punctuation">.</span>nWidth <span class="token operator">*</span> m_stFrameInfo<span class="token punctuation">.</span>nHeight<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">IsColorData</span><span class="token punctuation">(</span>m_stFrameInfo<span class="token punctuation">.</span>enPixelType<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{<!-- --></span>
                        enDstPixelType <span class="token operator">=</span> MyCamera<span class="token punctuation">.</span>MvGvspPixelType<span class="token punctuation">.</span>PixelType_Gvsp_BGR8_Packed<span class="token punctuation">;</span>
                        nSaveImageNeedSize <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">uint</span><span class="token punctuation">)</span>m_stFrameInfo<span class="token punctuation">.</span>nWidth <span class="token operator">*</span> m_stFrameInfo<span class="token punctuation">.</span>nHeight <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">else</span>
                    <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArgumentException</span><span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"No such pixel type! 0"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                       
                    <span class="token punctuation">}</span>

                    <span class="token keyword">if</span> <span class="token punctuation">(</span>m_nBufSizeForSaveImage <span class="token operator">&lt;</span> nSaveImageNeedSize<span class="token punctuation">)</span>
                    <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>m_BufForSaveImage <span class="token operator">!=</span> IntPtr<span class="token punctuation">.</span>Zero<span class="token punctuation">)</span>
                        <span class="token punctuation">{<!-- --></span>
                            Marshal<span class="token punctuation">.</span><span class="token function">Release</span><span class="token punctuation">(</span>m_BufForSaveImage<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        m_nBufSizeForSaveImage <span class="token operator">=</span> nSaveImageNeedSize<span class="token punctuation">;</span>
                        m_BufForSaveImage <span class="token operator">=</span> Marshal<span class="token punctuation">.</span><span class="token function">AllocHGlobal</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Int32<span class="token punctuation">)</span>m_nBufSizeForSaveImage<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                    stConverPixelParam<span class="token punctuation">.</span>nWidth <span class="token operator">=</span> m_stFrameInfo<span class="token punctuation">.</span>nWidth<span class="token punctuation">;</span>
                    stConverPixelParam<span class="token punctuation">.</span>nHeight <span class="token operator">=</span> m_stFrameInfo<span class="token punctuation">.</span>nHeight<span class="token punctuation">;</span>
                    stConverPixelParam<span class="token punctuation">.</span>pSrcData <span class="token operator">=</span> m_BufForDriver<span class="token punctuation">;</span>
                    stConverPixelParam<span class="token punctuation">.</span>nSrcDataLen <span class="token operator">=</span> m_stFrameInfo<span class="token punctuation">.</span>nFrameLen<span class="token punctuation">;</span>
                    stConverPixelParam<span class="token punctuation">.</span>enSrcPixelType <span class="token operator">=</span> m_stFrameInfo<span class="token punctuation">.</span>enPixelType<span class="token punctuation">;</span>
                    stConverPixelParam<span class="token punctuation">.</span>enDstPixelType <span class="token operator">=</span> enDstPixelType<span class="token punctuation">;</span>
                    stConverPixelParam<span class="token punctuation">.</span>pDstBuffer <span class="token operator">=</span> m_BufForSaveImage<span class="token punctuation">;</span>
                    stConverPixelParam<span class="token punctuation">.</span>nDstBufferSize <span class="token operator">=</span> m_nBufSizeForSaveImage<span class="token punctuation">;</span>
                    <span class="token class-name"><span class="token keyword">int</span></span> nRet <span class="token operator">=</span> m_MyCamera<span class="token punctuation">.</span><span class="token function">MV_CC_ConvertPixelType_NET</span><span class="token punctuation">(</span><span class="token keyword">ref</span> stConverPixelParam<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>MyCamera<span class="token punctuation">.</span>MV_OK <span class="token operator">!=</span> nRet<span class="token punctuation">)</span>
                    <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArgumentException</span><span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"Convert Pixel Type Fail! 0"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        
                    <span class="token punctuation">}</span>
                    pTemp <span class="token operator">=</span> m_BufForSaveImage<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">lock</span> <span class="token punctuation">(</span>BufForDriverLock<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>enDstPixelType <span class="token operator">==</span> MyCamera<span class="token punctuation">.</span>MvGvspPixelType<span class="token punctuation">.</span>PixelType_Gvsp_Mono8<span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">//************************Mono8 转 Bitmap*******************************</span>
                    <span class="token class-name">Bitmap</span> bmp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Bitmap</span><span class="token punctuation">(</span>m_stFrameInfo<span class="token punctuation">.</span>nWidth<span class="token punctuation">,</span> m_stFrameInfo<span class="token punctuation">.</span>nHeight<span class="token punctuation">,</span> m_stFrameInfo<span class="token punctuation">.</span>nWidth <span class="token operator">*</span> <span class="token number">1</span><span class="token punctuation">,</span> PixelFormat<span class="token punctuation">.</span>Format8bppIndexed<span class="token punctuation">,</span> pTemp<span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token class-name">ColorPalette</span> cp <span class="token operator">=</span> bmp<span class="token punctuation">.</span>Palette<span class="token punctuation">;</span>
                    <span class="token comment">// init palette</span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">256</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{<!-- --></span>
                        cp<span class="token punctuation">.</span>Entries<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> Color<span class="token punctuation">.</span><span class="token function">FromArgb</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> i<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token comment">// set palette back</span>
                    bmp<span class="token punctuation">.</span>Palette <span class="token operator">=</span> cp<span class="token punctuation">;</span>
                    bmp<span class="token punctuation">.</span><span class="token function">Save</span><span class="token punctuation">(</span>fname<span class="token punctuation">,</span> ImageFormat<span class="token punctuation">.</span>Bmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">//*********************BGR8 转 Bitmap**************************</span>
                    <span class="token keyword">try</span>
                    <span class="token punctuation">{<!-- --></span>
                        <span class="token class-name">Bitmap</span> bmp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Bitmap</span><span class="token punctuation">(</span>m_stFrameInfo<span class="token punctuation">.</span>nWidth<span class="token punctuation">,</span> m_stFrameInfo<span class="token punctuation">.</span>nHeight<span class="token punctuation">,</span> m_stFrameInfo<span class="token punctuation">.</span>nWidth <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">,</span> PixelFormat<span class="token punctuation">.</span>Format24bppRgb<span class="token punctuation">,</span> pTemp<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        bmp<span class="token punctuation">.</span><span class="token function">Save</span><span class="token punctuation">(</span><span class="token string">"image.bmp"</span><span class="token punctuation">,</span> ImageFormat<span class="token punctuation">.</span>Bmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">catch</span>
                    <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArgumentException</span><span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"Write File Fail! 0"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                      
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//throw new ArgumentException(string.Format("Save Succeed! 0"));        </span>
        <span class="token punctuation">}</span>
</code></pre> 
<h2><a id="_478"></a>七、设置相机参数</h2> 
<pre><code class="prism language-csharp">        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 设置相机参数。异常:ArgumentException</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name="date"&gt;&lt;/param&gt;</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">WriteCCDConfig</span><span class="token punctuation">(</span><span class="token class-name">Tuple<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> date<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>

            m_MyCamera<span class="token punctuation">.</span><span class="token function">MV_CC_SetEnumValue_NET</span><span class="token punctuation">(</span><span class="token string">"ExposureAuto"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">int</span></span> nRet <span class="token operator">=</span> m_MyCamera<span class="token punctuation">.</span><span class="token function">MV_CC_SetFloatValue_NET</span><span class="token punctuation">(</span><span class="token string">"ExposureTime"</span><span class="token punctuation">,</span> <span class="token keyword">float</span><span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>date<span class="token punctuation">.</span>Item1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>nRet <span class="token operator">!=</span> MyCamera<span class="token punctuation">.</span>MV_OK<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArgumentException</span><span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"Set Exposure Time Fail! {0}"</span><span class="token punctuation">,</span> nRet<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            m_MyCamera<span class="token punctuation">.</span><span class="token function">MV_CC_SetEnumValue_NET</span><span class="token punctuation">(</span><span class="token string">"GainAuto"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            nRet <span class="token operator">=</span> m_MyCamera<span class="token punctuation">.</span><span class="token function">MV_CC_SetFloatValue_NET</span><span class="token punctuation">(</span><span class="token string">"Gain"</span><span class="token punctuation">,</span> <span class="token keyword">float</span><span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>date<span class="token punctuation">.</span>Item2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>nRet <span class="token operator">!=</span> MyCamera<span class="token punctuation">.</span>MV_OK<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArgumentException</span><span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"Set Gain Fail! {0}"</span><span class="token punctuation">,</span> nRet<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                
            <span class="token punctuation">}</span>

            nRet <span class="token operator">=</span> m_MyCamera<span class="token punctuation">.</span><span class="token function">MV_CC_SetFloatValue_NET</span><span class="token punctuation">(</span><span class="token string">"AcquisitionFrameRate"</span><span class="token punctuation">,</span> <span class="token keyword">float</span><span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>date<span class="token punctuation">.</span>Item3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>nRet <span class="token operator">!=</span> MyCamera<span class="token punctuation">.</span>MV_OK<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArgumentException</span><span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"Set Frame Rate Fail! {0}"</span><span class="token punctuation">,</span> nRet<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
</code></pre> 
<h2><a id="_510"></a>八、读取相机参数</h2> 
<pre><code class="prism language-csharp">        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 读取参数信息。异常:ArgumentException</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">Tuple<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span><span class="token keyword">string</span><span class="token punctuation">,</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> <span class="token function">ReadCCDConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">MyCamera<span class="token punctuation">.</span>MVCC_FLOATVALUE</span> stParam <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyCamera<span class="token punctuation">.</span>MVCC_FLOATVALUE</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">int</span></span> nRet <span class="token operator">=</span> m_MyCamera<span class="token punctuation">.</span><span class="token function">MV_CC_GetFloatValue_NET</span><span class="token punctuation">(</span><span class="token string">"ExposureTime"</span><span class="token punctuation">,</span> <span class="token keyword">ref</span> stParam<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">string</span></span> s1 <span class="token operator">=</span> <span class="token string">"0"</span><span class="token punctuation">,</span> s2 <span class="token operator">=</span> <span class="token string">"0"</span><span class="token punctuation">,</span> s3 <span class="token operator">=</span> <span class="token string">"0"</span><span class="token punctuation">;</span>
            <span class="token comment">//获得曝光</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>MyCamera<span class="token punctuation">.</span>MV_OK <span class="token operator">==</span> nRet<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                s1 <span class="token operator">=</span> stParam<span class="token punctuation">.</span>fCurValue<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token string">"F1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//F1为一种格式</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//获得增益</span>
            nRet <span class="token operator">=</span> m_MyCamera<span class="token punctuation">.</span><span class="token function">MV_CC_GetFloatValue_NET</span><span class="token punctuation">(</span><span class="token string">"Gain"</span><span class="token punctuation">,</span> <span class="token keyword">ref</span> stParam<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>MyCamera<span class="token punctuation">.</span>MV_OK <span class="token operator">==</span> nRet<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
               s2 <span class="token operator">=</span> stParam<span class="token punctuation">.</span>fCurValue<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token string">"F1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//获得帧率</span>
            nRet <span class="token operator">=</span> m_MyCamera<span class="token punctuation">.</span><span class="token function">MV_CC_GetFloatValue_NET</span><span class="token punctuation">(</span><span class="token string">"ResultingFrameRate"</span><span class="token punctuation">,</span> <span class="token keyword">ref</span> stParam<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>MyCamera<span class="token punctuation">.</span>MV_OK <span class="token operator">==</span> nRet<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
               s3<span class="token operator">=</span> stParam<span class="token punctuation">.</span>fCurValue<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token string">"F1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Tuple<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">,</span> s3<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre> 
<h2><a id="_542"></a>九、界面设计</h2> 
<p><img src="https://images2.imgbox.com/71/ad/JeeINKWo_o.png" alt="在这里插入图片描述"></p> 
<p>界面程序：</p> 
<pre><code class="prism language-csharp"><span class="token keyword">namespace</span> <span class="token namespace">HaiKangCameraSDKDemo</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">partial</span> <span class="token keyword">class</span> <span class="token class-name">Form1</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Form</span></span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">hkccdSDK</span> hkccd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">hkccdSDK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token function">Form1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token function">InitializeComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Form1_Load</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            hkccd<span class="token punctuation">.</span>winHandle <span class="token operator">=</span> pictureBox1<span class="token punctuation">.</span>Handle<span class="token punctuation">;</span>
            cbxCCDList<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cbxCCDList<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">AddRange</span><span class="token punctuation">(</span>hkccd<span class="token punctuation">.</span><span class="token function">DeviceListAcq</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">btnOpenDevice_Click</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name"><span class="token keyword">var</span></span> index <span class="token operator">=</span> cbxCCDList<span class="token punctuation">.</span>SelectedIndex<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span>
            <span class="token punctuation">{<!-- --></span>
                hkccd<span class="token punctuation">.</span><span class="token function">OpenCamera</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
                MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token string">"设备打开成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">ArgumentException</span> ex<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span>ex<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>             
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">btnCloseDevice_Click</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            hkccd<span class="token punctuation">.</span><span class="token function">CloseCamera</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token string">"设备关闭成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">btnStartGrab_Click</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">try</span>
            <span class="token punctuation">{<!-- --></span>
                hkccd<span class="token punctuation">.</span><span class="token function">StartGrab</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token string">"已经开始采集"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ArgumentException</span> ex<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span>ex<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">btnStopGrab_Click</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">try</span>
            <span class="token punctuation">{<!-- --></span>
                hkccd<span class="token punctuation">.</span><span class="token function">StopGrab</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">ArgumentException</span> ex<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span>ex<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">btnSaveBMP_Click</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">try</span>
            <span class="token punctuation">{<!-- --></span>
                hkccd<span class="token punctuation">.</span><span class="token function">ImageSaveBMP</span><span class="token punctuation">(</span><span class="token string">"D:\\b1.bmp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">ArgumentException</span> ex<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span>ex<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">btnReadConfig_Click</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name"><span class="token keyword">var</span></span> data<span class="token operator">=</span>  hkccd<span class="token punctuation">.</span><span class="token function">ReadCCDConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            txtExposure<span class="token punctuation">.</span>Text <span class="token operator">=</span> data<span class="token punctuation">.</span>Item1<span class="token punctuation">;</span>
            txtGain<span class="token punctuation">.</span>Text <span class="token operator">=</span> data<span class="token punctuation">.</span>Item2<span class="token punctuation">;</span>
            txtFrame<span class="token punctuation">.</span>Text <span class="token operator">=</span> data<span class="token punctuation">.</span>Item3<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">btnSaveConfig_Click</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name"><span class="token keyword">float</span></span> v1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> v2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>v3 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">float</span><span class="token punctuation">.</span><span class="token function">TryParse</span><span class="token punctuation">(</span>txtExposure<span class="token punctuation">.</span>Text<span class="token punctuation">,</span> <span class="token keyword">out</span> v1<span class="token punctuation">)</span><span class="token operator">||</span>
            <span class="token operator">!</span><span class="token keyword">float</span><span class="token punctuation">.</span><span class="token function">TryParse</span><span class="token punctuation">(</span>txtGain<span class="token punctuation">.</span>Text<span class="token punctuation">,</span> <span class="token keyword">out</span> v2<span class="token punctuation">)</span><span class="token operator">||</span>
            <span class="token operator">!</span><span class="token keyword">float</span><span class="token punctuation">.</span><span class="token function">TryParse</span><span class="token punctuation">(</span>txtFrame<span class="token punctuation">.</span>Text<span class="token punctuation">,</span> <span class="token keyword">out</span> v3<span class="token punctuation">)</span> <span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token string">"参数格式不正确！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">try</span>
            <span class="token punctuation">{<!-- --></span>
                hkccd<span class="token punctuation">.</span><span class="token function">WriteCCDConfig</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Tuple<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>v1<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token string">"F1"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> v2<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token string">"F1"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> v3<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token string">"F1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token string">"参数写入成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ArgumentException</span> ex<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span>ex<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9adaf17388fea402c1f4718473ef56e0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">错误解决：Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception......</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/521d017ef852b1db9f015bce1f3a1558/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">python实现z-score标准化和0-1标准化</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>