<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>激光条纹中心提取——Zhang-Suen法python - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="激光条纹中心提取——Zhang-Suen法python" />
<meta property="og:description" content="Zhang-Suen法 原理—— Zhang-Suen法代码——python代码 原理—— Zhang-Suen法 细化法（又称形态学骨架法）是通过对光条纹不断地进行腐蚀操作，剥离光条纹边界，得到单像素宽度的光条纹连通线（又称骨架）的形态学处理方法。该方法是通过细化技术，将光条纹区域的细化曲线作为光条纹中心线。 由于细化法是基于形态学的方法，只是对光条纹骨架进行提取，没有考虑到光条纹的横截面灰度分布特点。因此，细化法提取的光条纹中心线精度有限。另一方面，由于该方法需要大量时间来进行反复的细化操作，提取算法的运算速度被大大降低。
细化的方法有很多种，下面介绍一种常用的Zhang-Suen细化算法。细化算法的一般分为以下四个步骤，
（1）标记将被删除的边界点；
（2）删除做了标记的点；
（3）继续标记将被删除的剩余的边界点；
（4）删除标记过的点。反复应用这个基本过程，直到再也没有被删除的点为止，此时算法终止，生成了该区域的骨架。
假设目标像素点标记为1，背景像素点标记为0，在图上图中 的八个邻域如图所示，Zhang-Suen算法第一步循环所有前景像素点，对满足如下公式（1-5）的像素标记点进行删除。第二步和第一步类似，满足公式（1-6）的像素 标记点记为删除。循环上述两个步骤，直到两步中没有像素标记点记为删除为止，输出图像即为二值图像细化后的骨架。
其中 N(P0)表示八个邻域中非零像素标记点的个数（二值图像只有0和1）， S(P0)表示八个邻域中，按照顺时针方向，相邻两个像素出现0→1的次数，。
细化法由于需要做多次膨胀腐蚀操作，耗时较多，处理速度较慢，另外细化法对二值化的要求极高，往往因为噪声的干扰，将图像二值化会出现较大的误差。细化法属于形态学范畴，没有利用到灰度值之间的信息，因此对于复杂条件下的激光曲线提取效果较差。
代码——python代码 # 作用： zhang-sufa # 作者： yeluo import cv2 import numpy as np import time import matplotlib.pyplot as plt def ROI(img): indexXY = np.argwhere(img &gt; 0) minxy = np.min(indexXY, axis=0) maxxy = np.max(indexXY, axis=0) return minxy,maxxy def neighbours(x,y,img): i = img x1,y1,x_1, y_1 = x&#43;1, y-1, x-1, y&#43;1 return [i[y1][x], i[y1][x1], i[y][x1], i[y_1][x1], # P2,P3,P4,P5 i[y_1][x], i[y_1][x_1], i[y][x_1], i[y1][x_1]] # P6,P7,P8,P9 def transitions(neighbours): n = neighbours &#43; neighbours[0:1] # P2, ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/4a1c520eb44e84263ebbf6884d2993f4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-03-12T18:15:20+08:00" />
<meta property="article:modified_time" content="2022-03-12T18:15:20+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">激光条纹中心提取——Zhang-Suen法python</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>Zhang-Suen法</h4> 
 <ul><li><ul><li><a href="#_ZhangSuen_3" rel="nofollow">原理—— Zhang-Suen法</a></li><li><a href="#python_15" rel="nofollow">代码——python代码</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="_ZhangSuen_3"></a>原理—— Zhang-Suen法</h3> 
<p><img src="https://images2.imgbox.com/e0/d8/SDcXlpL6_o.png" alt="在这里插入图片描述"><br> 细化法（又称形态学骨架法）是通过对光条纹不断地进行腐蚀操作，剥离光条纹边界，得到单像素宽度的光条纹连通线（又称骨架）的形态学处理方法。该方法是通过细化技术，将光条纹区域的细化曲线作为光条纹中心线。 由于细化法是基于形态学的方法，只是对光条纹骨架进行提取，没有考虑到光条纹的横截面灰度分布特点。因此，细化法提取的光条纹中心线精度有限。另一方面，由于该方法需要大量时间来进行反复的细化操作，提取算法的运算速度被大大降低。<br> 细化的方法有很多种，下面介绍一种常用的Zhang-Suen细化算法。细化算法的一般分为以下四个步骤，<br> （1）标记将被删除的边界点；<br> （2）删除做了标记的点；<br> （3）继续标记将被删除的剩余的边界点；<br> （4）删除标记过的点。反复应用这个基本过程，直到再也没有被删除的点为止，此时算法终止，生成了该区域的骨架。<br> 假设目标像素点标记为1，背景像素点标记为0，在图上图中 的八个邻域如图所示，Zhang-Suen算法第一步循环所有前景像素点，对满足如下公式（1-5）的像素标记点进行删除。第二步和第一步类似，满足公式（1-6）的像素 标记点记为删除。循环上述两个步骤，直到两步中没有像素标记点记为删除为止，输出图像即为二值图像细化后的骨架。<br> <img src="https://images2.imgbox.com/42/3d/Xk8pe4QX_o.png" alt="在这里插入图片描述"><br> 其中 N(P0)表示八个邻域中非零像素标记点的个数（二值图像只有0和1）， S(P0)表示八个邻域中，按照顺时针方向，相邻两个像素出现0→1的次数，。<br> 细化法由于需要做多次膨胀腐蚀操作，耗时较多，处理速度较慢，另外细化法对二值化的要求极高，往往因为噪声的干扰，将图像二值化会出现较大的误差。细化法属于形态学范畴，没有利用到灰度值之间的信息，因此对于复杂条件下的激光曲线提取效果较差。</p> 
<h3><a id="python_15"></a>代码——python代码</h3> 
<pre><code class="prism language-python"><span class="token comment"># 作用： zhang-sufa</span>
<span class="token comment"># 作者： yeluo</span>
<span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> time
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

<span class="token keyword">def</span> <span class="token function">ROI</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">:</span>
    indexXY <span class="token operator">=</span> np<span class="token punctuation">.</span>argwhere<span class="token punctuation">(</span>img <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    minxy <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span>indexXY<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
    maxxy <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span>indexXY<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> minxy<span class="token punctuation">,</span>maxxy
<span class="token keyword">def</span> <span class="token function">neighbours</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>img<span class="token punctuation">)</span><span class="token punctuation">:</span>
    i <span class="token operator">=</span> img
    x1<span class="token punctuation">,</span>y1<span class="token punctuation">,</span>x_1<span class="token punctuation">,</span> y_1 <span class="token operator">=</span> x<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> y<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> x<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> y<span class="token operator">+</span><span class="token number">1</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>i<span class="token punctuation">[</span>y1<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">,</span>  i<span class="token punctuation">[</span>y1<span class="token punctuation">]</span><span class="token punctuation">[</span>x1<span class="token punctuation">]</span><span class="token punctuation">,</span>   i<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x1<span class="token punctuation">]</span><span class="token punctuation">,</span>  i<span class="token punctuation">[</span>y_1<span class="token punctuation">]</span><span class="token punctuation">[</span>x1<span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># P2,P3,P4,P5</span>
            i<span class="token punctuation">[</span>y_1<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">[</span>y_1<span class="token punctuation">]</span><span class="token punctuation">[</span>x_1<span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x_1<span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">[</span>y1<span class="token punctuation">]</span><span class="token punctuation">[</span>x_1<span class="token punctuation">]</span><span class="token punctuation">]</span>  <span class="token comment"># P6,P7,P8,P9</span>
<span class="token keyword">def</span> <span class="token function">transitions</span><span class="token punctuation">(</span>neighbours<span class="token punctuation">)</span><span class="token punctuation">:</span>
    n <span class="token operator">=</span> neighbours <span class="token operator">+</span> neighbours<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">]</span>  <span class="token comment"># P2, ... P9, P2</span>
    <span class="token keyword">return</span> <span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">for</span> n1<span class="token punctuation">,</span> n2 <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> n<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">ZhangSuenPlus</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    运行时间55s
    :param image:
    :return:
    """</span>
    changing1 <span class="token operator">=</span> changing2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">while</span> changing1 <span class="token operator">or</span> changing2<span class="token punctuation">:</span>
        <span class="token comment"># Step 1</span>
        changing1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>image<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                P2<span class="token punctuation">,</span>P3<span class="token punctuation">,</span>P4<span class="token punctuation">,</span>P5<span class="token punctuation">,</span>P6<span class="token punctuation">,</span>P7<span class="token punctuation">,</span>P8<span class="token punctuation">,</span>P9 <span class="token operator">=</span> n <span class="token operator">=</span> neighbours<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> image<span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>image<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">and</span>    <span class="token comment"># (Condition 0)</span>
                    P4 <span class="token operator">*</span> P6 <span class="token operator">*</span> P8 <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">and</span>   <span class="token comment"># Condition 4</span>
                    P2 <span class="token operator">*</span> P4 <span class="token operator">*</span> P6 <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">and</span>   <span class="token comment"># Condition 3</span>
                    transitions<span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">and</span> <span class="token comment"># Condition 2</span>
                    <span class="token number">2</span> <span class="token operator">&lt;=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>      <span class="token comment"># Condition 1</span>
                    changing1<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> x<span class="token punctuation">,</span> y <span class="token keyword">in</span> changing1<span class="token punctuation">:</span> image<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token comment"># Step 2</span>
        changing2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>image<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                P2<span class="token punctuation">,</span>P3<span class="token punctuation">,</span>P4<span class="token punctuation">,</span>P5<span class="token punctuation">,</span>P6<span class="token punctuation">,</span>P7<span class="token punctuation">,</span>P8<span class="token punctuation">,</span>P9 <span class="token operator">=</span> n <span class="token operator">=</span> neighbours<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> image<span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>image<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">and</span>    <span class="token comment"># (Condition 0)</span>
                    P2 <span class="token operator">*</span> P6 <span class="token operator">*</span> P8 <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">and</span>   <span class="token comment"># Condition 4</span>
                    P2 <span class="token operator">*</span> P4 <span class="token operator">*</span> P8 <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">and</span>   <span class="token comment"># Condition 3</span>
                transitions<span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">and</span> <span class="token comment"># Condition 2</span>
                    <span class="token number">2</span> <span class="token operator">&lt;=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>      <span class="token comment"># Condition 1</span>
                    changing2<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> x<span class="token punctuation">,</span> y <span class="token keyword">in</span> changing2<span class="token punctuation">:</span> image<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token comment">#print changing1</span>
        <span class="token comment">#print changing2</span>
    flags <span class="token operator">=</span> image<span class="token operator">&gt;</span><span class="token number">0</span>
    image<span class="token punctuation">[</span>flags<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">255</span>
    <span class="token comment">#cv2.imshow("res",image)</span>
    <span class="token keyword">return</span> image
<span class="token keyword">def</span> <span class="token function">ZhangSuenPlus02</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    # 运行时间12.135秒
    :param image:
    :return:
    """</span>
    indexXY <span class="token operator">=</span> np<span class="token punctuation">.</span>argwhere<span class="token punctuation">(</span>image<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span>
    minxy <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span>indexXY<span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
    maxxy <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span>indexXY<span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
    roi <span class="token operator">=</span> image<span class="token punctuation">[</span>minxy<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>maxxy<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">,</span>minxy<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>maxxy<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span>
    changing1 <span class="token operator">=</span> changing2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">while</span> changing1 <span class="token operator">or</span> changing2<span class="token punctuation">:</span>
        <span class="token comment"># Step 1</span>
        changing1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>roi<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>roi<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> roi<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
                    P2<span class="token punctuation">,</span>P3<span class="token punctuation">,</span>P4<span class="token punctuation">,</span>P5<span class="token punctuation">,</span>P6<span class="token punctuation">,</span>P7<span class="token punctuation">,</span>P8<span class="token punctuation">,</span>P9 <span class="token operator">=</span> n <span class="token operator">=</span> neighbours<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> roi<span class="token punctuation">)</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>    <span class="token comment"># (Condition 0)</span>
                        P4 <span class="token operator">*</span> P6 <span class="token operator">*</span> P8 <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">and</span>   <span class="token comment"># Condition 4</span>
                        P2 <span class="token operator">*</span> P4 <span class="token operator">*</span> P6 <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">and</span>   <span class="token comment"># Condition 3</span>
                        transitions<span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">and</span> <span class="token comment"># Condition 2</span>
                        <span class="token number">2</span> <span class="token operator">&lt;=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>      <span class="token comment"># Condition 1</span>
                        changing1<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> x<span class="token punctuation">,</span> y <span class="token keyword">in</span> changing1<span class="token punctuation">:</span> roi<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token comment"># Step 2</span>
        changing2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>roi<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>roi<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> roi<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
                    P2<span class="token punctuation">,</span>P3<span class="token punctuation">,</span>P4<span class="token punctuation">,</span>P5<span class="token punctuation">,</span>P6<span class="token punctuation">,</span>P7<span class="token punctuation">,</span>P8<span class="token punctuation">,</span>P9 <span class="token operator">=</span> n <span class="token operator">=</span> neighbours<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> roi<span class="token punctuation">)</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>   <span class="token comment"># (Condition 0)</span>
                        P2 <span class="token operator">*</span> P6 <span class="token operator">*</span> P8 <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">and</span>   <span class="token comment"># Condition 4</span>
                        P2 <span class="token operator">*</span> P4 <span class="token operator">*</span> P8 <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">and</span>   <span class="token comment"># Condition 3</span>
                    transitions<span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">and</span> <span class="token comment"># Condition 2</span>
                        <span class="token number">2</span> <span class="token operator">&lt;=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>      <span class="token comment"># Condition 1</span>
                        changing2<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> x<span class="token punctuation">,</span> y <span class="token keyword">in</span> changing2<span class="token punctuation">:</span> roi<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token comment">#print changing1</span>
        <span class="token comment">#print changing2</span>
    flags <span class="token operator">=</span> roi<span class="token operator">&gt;</span><span class="token number">0</span>
    roi<span class="token punctuation">[</span>flags<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">255</span>
    <span class="token comment">#cv2.imshow("res",image)</span>
    <span class="token keyword">return</span> image
<span class="token keyword">def</span> <span class="token function">ZhangSuenPlus03</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    # 运行时间9秒
    :param image:
    :return:
    """</span>
    indexXY <span class="token operator">=</span> np<span class="token punctuation">.</span>argwhere<span class="token punctuation">(</span>image<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span>
    minxy <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span>indexXY<span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
    maxxy <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span>indexXY<span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
    roi <span class="token operator">=</span> image<span class="token punctuation">[</span>minxy<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>maxxy<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">,</span>minxy<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>maxxy<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span>
    changing1 <span class="token operator">=</span> changing2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">while</span> changing1 <span class="token operator">or</span> changing2<span class="token punctuation">:</span>
        indexXY <span class="token operator">=</span> np<span class="token punctuation">.</span>argwhere<span class="token punctuation">(</span>roi<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span>
        minxy <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span>indexXY<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
        maxxy <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span>indexXY<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
        roi <span class="token operator">=</span> roi<span class="token punctuation">[</span>minxy<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">:</span>maxxy<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> minxy<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">:</span>maxxy<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span>
        <span class="token comment"># Step 1</span>
        changing1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>roi<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>roi<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> roi<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
                    P2<span class="token punctuation">,</span>P3<span class="token punctuation">,</span>P4<span class="token punctuation">,</span>P5<span class="token punctuation">,</span>P6<span class="token punctuation">,</span>P7<span class="token punctuation">,</span>P8<span class="token punctuation">,</span>P9 <span class="token operator">=</span> n <span class="token operator">=</span> neighbours<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> roi<span class="token punctuation">)</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>    <span class="token comment"># (Condition 0)</span>
                        P4 <span class="token operator">*</span> P6 <span class="token operator">*</span> P8 <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">and</span>   <span class="token comment"># Condition 4</span>
                        P2 <span class="token operator">*</span> P4 <span class="token operator">*</span> P6 <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">and</span>   <span class="token comment"># Condition 3</span>
                        transitions<span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">and</span> <span class="token comment"># Condition 2</span>
                        <span class="token number">2</span> <span class="token operator">&lt;=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>      <span class="token comment"># Condition 1</span>
                        changing1<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> x<span class="token punctuation">,</span> y <span class="token keyword">in</span> changing1<span class="token punctuation">:</span> roi<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token comment"># Step 2</span>
        changing2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>roi<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>roi<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> roi<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
                    P2<span class="token punctuation">,</span>P3<span class="token punctuation">,</span>P4<span class="token punctuation">,</span>P5<span class="token punctuation">,</span>P6<span class="token punctuation">,</span>P7<span class="token punctuation">,</span>P8<span class="token punctuation">,</span>P9 <span class="token operator">=</span> n <span class="token operator">=</span> neighbours<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> roi<span class="token punctuation">)</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>   <span class="token comment"># (Condition 0)</span>
                        P2 <span class="token operator">*</span> P6 <span class="token operator">*</span> P8 <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">and</span>   <span class="token comment"># Condition 4</span>
                        P2 <span class="token operator">*</span> P4 <span class="token operator">*</span> P8 <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">and</span>   <span class="token comment"># Condition 3</span>
                    transitions<span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">and</span> <span class="token comment"># Condition 2</span>
                        <span class="token number">2</span> <span class="token operator">&lt;=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>      <span class="token comment"># Condition 1</span>
                        changing2<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> x<span class="token punctuation">,</span> y <span class="token keyword">in</span> changing2<span class="token punctuation">:</span> roi<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token comment">#print changing1</span>
        <span class="token comment">#print changing2</span>
    flags <span class="token operator">=</span> roi<span class="token operator">&gt;</span><span class="token number">0</span>
    roi<span class="token punctuation">[</span>flags<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">255</span>
    <span class="token comment">#cv2.imshow("res",image)</span>
    <span class="token keyword">return</span> image

<span class="token keyword">def</span> <span class="token function">ZhangSuen_Bad</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    将灰度值转化为0和1，企图加速计算过程
    运行时间21.28s
    thresh计算失败
    :param img:
    :return:
    """</span>
    copyMat <span class="token operator">=</span> img<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
    k <span class="token operator">=</span> <span class="token number">0</span>
    row<span class="token punctuation">,</span>col<span class="token operator">=</span> img<span class="token punctuation">.</span>shape
    row <span class="token operator">=</span> row<span class="token operator">-</span><span class="token number">1</span>
    col <span class="token operator">=</span> col<span class="token operator">-</span><span class="token number">1</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        k<span class="token operator">=</span> k<span class="token operator">+</span><span class="token number">1</span>
        stop<span class="token operator">=</span> <span class="token boolean">False</span>
        <span class="token comment"># step1</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>row<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>col<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> img<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"&gt;0"</span><span class="token punctuation">)</span>
                    p1 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> img<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token number">0</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    p2 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> img<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token number">0</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    p3 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> img<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token number">0</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    p4 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> img<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    p5 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> img<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    p6 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> img<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    p7 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> img<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> j<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    p8 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> img<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    p9 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> img<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> j<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    np1 <span class="token operator">=</span> p2<span class="token operator">+</span>p3<span class="token operator">+</span>p4<span class="token operator">+</span>p5<span class="token operator">+</span>p6<span class="token operator">+</span>p7<span class="token operator">+</span>p8<span class="token operator">+</span>p9
                    sp2 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p2 <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">and</span> p3 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    sp3 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p3 <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">and</span> p4 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    sp4 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p4 <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">and</span> p5 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    sp5 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p5 <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">and</span> p6 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    sp6 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p6 <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">and</span> p7 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    sp7 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p7 <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">and</span> p8 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    sp8 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p8 <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">and</span> p9 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    sp9 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p9 <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">and</span> p2 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    sp1 <span class="token operator">=</span> sp2 <span class="token operator">+</span> sp3 <span class="token operator">+</span> sp4 <span class="token operator">+</span> sp5 <span class="token operator">+</span> sp6 <span class="token operator">+</span> sp7 <span class="token operator">+</span> sp8 <span class="token operator">+</span> sp9
                    <span class="token keyword">if</span> np1<span class="token operator">&gt;=</span><span class="token number">2</span> <span class="token operator">and</span> np1<span class="token operator">&lt;=</span><span class="token number">6</span> <span class="token operator">and</span> sp1<span class="token operator">==</span><span class="token number">1</span> <span class="token operator">and</span><span class="token punctuation">(</span>p2<span class="token operator">*</span>p4<span class="token operator">*</span>p6<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span> <span class="token operator">and</span> <span class="token punctuation">(</span>p4<span class="token operator">*</span>p6<span class="token operator">*</span>p8<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">:</span>
                        stop <span class="token operator">=</span> <span class="token boolean">True</span>
                        copyMat<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"success"</span><span class="token punctuation">)</span>
        img <span class="token operator">=</span> copyMat<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># step2</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>row<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>col<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> img<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"&gt;&gt;"</span><span class="token punctuation">)</span>
                    p2 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> img<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    p3 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> img<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    p4 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> img<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    p5 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> img<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    p6 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> img<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    p7 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> img<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    p8 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> img<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    p9 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> img<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    np1 <span class="token operator">=</span> p2 <span class="token operator">+</span> p3 <span class="token operator">+</span> p4 <span class="token operator">+</span> p5 <span class="token operator">+</span> p6 <span class="token operator">+</span> p7 <span class="token operator">+</span> p8 <span class="token operator">+</span> p9
                    sp2 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p2 <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">and</span> p3 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    sp3 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p3 <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">and</span> p4 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    sp4 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p4 <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">and</span> p5 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    sp5 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p5 <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">and</span> p6 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    sp6 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p6 <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">and</span> p7 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    sp7 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p7 <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">and</span> p8 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    sp8 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p8 <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">and</span> p9 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    sp9 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p9 <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">and</span> p2 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    sp1 <span class="token operator">=</span> sp2 <span class="token operator">+</span> sp3 <span class="token operator">+</span> sp4 <span class="token operator">+</span> sp5 <span class="token operator">+</span> sp6 <span class="token operator">+</span> sp7 <span class="token operator">+</span> sp8 <span class="token operator">+</span> sp9
                    <span class="token keyword">if</span> np1 <span class="token operator">&gt;=</span> <span class="token number">2</span> <span class="token operator">and</span> np1 <span class="token operator">&lt;=</span> <span class="token number">6</span> <span class="token operator">and</span> sp1 <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">and</span> <span class="token punctuation">(</span>p2<span class="token operator">*</span>p4<span class="token operator">*</span>p8<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">and</span> <span class="token punctuation">(</span>p2<span class="token operator">*</span>p6<span class="token operator">*</span>p8<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                        stop <span class="token operator">=</span> <span class="token boolean">True</span>
                        copyMat<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"success"</span><span class="token punctuation">)</span>
        img <span class="token operator">=</span> copyMat<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">not</span> stop<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">break</span>
    resImg <span class="token operator">=</span> copyMat<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
    flags <span class="token operator">=</span> resImg<span class="token operator">&gt;</span><span class="token number">0</span>
    resImg<span class="token punctuation">[</span>flags<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">255</span>
    <span class="token comment">#print(k)</span>
    <span class="token comment"># cv2.imshow("res",resImg)</span>
    <span class="token keyword">return</span> resImg

<span class="token keyword">def</span> <span class="token function">ZhangSuen</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    运行时间20.7s
    :param img:
    :return:
    """</span>
    <span class="token comment">#indexXY = np.argwhere(img&gt;0)</span>
    <span class="token comment">#minxy = np.min(indexXY,axis=0)</span>
    <span class="token comment">#maxxy = np.max(indexXY,axis=0)</span>
    <span class="token comment">#roi = img[minxy[0]-3:maxxy[0]+4,minxy[1]-3:maxxy[1]+4]</span>
    <span class="token comment">#flags = roi&gt;0</span>
    <span class="token comment">#roi[flags] = 255</span>
    <span class="token comment">#cv2.imshow("roi",roi)</span>
    <span class="token comment">#print(roi.shape)</span>
    roi <span class="token operator">=</span> img
    k <span class="token operator">=</span> <span class="token number">0</span>
    row<span class="token punctuation">,</span>col<span class="token operator">=</span> roi<span class="token punctuation">.</span>shape
    changing1 <span class="token operator">=</span> changing2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">while</span> changing1 <span class="token operator">or</span> changing2<span class="token punctuation">:</span>
        changing1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>row<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>col<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> roi<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">:</span>
                    p2 <span class="token operator">=</span> roi<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>j<span class="token punctuation">]</span>
                    p3 <span class="token operator">=</span> roi<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span>
                    p4 <span class="token operator">=</span> roi<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span>
                    p5 <span class="token operator">=</span> roi<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span>
                    p6 <span class="token operator">=</span> roi<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">]</span>
                    p7 <span class="token operator">=</span> roi<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> j<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
                    p8 <span class="token operator">=</span> roi<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
                    p9 <span class="token operator">=</span> roi<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> j<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
                    np1 <span class="token operator">=</span> p2<span class="token operator">+</span>p3<span class="token operator">+</span>p4<span class="token operator">+</span>p5<span class="token operator">+</span>p6<span class="token operator">+</span>p7<span class="token operator">+</span>p8<span class="token operator">+</span>p9
                    sp2 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p2<span class="token punctuation">,</span>p3<span class="token punctuation">)</span><span class="token operator">==</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    sp3 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p3<span class="token punctuation">,</span>p4<span class="token punctuation">)</span><span class="token operator">==</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    sp4 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p4<span class="token punctuation">,</span>p5<span class="token punctuation">)</span><span class="token operator">==</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    sp5 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p5<span class="token punctuation">,</span>p6<span class="token punctuation">)</span><span class="token operator">==</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    sp6 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p6<span class="token punctuation">,</span>p7<span class="token punctuation">)</span><span class="token operator">==</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    sp7 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p7<span class="token punctuation">,</span>p8<span class="token punctuation">)</span><span class="token operator">==</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    sp8 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p8<span class="token punctuation">,</span>p9<span class="token punctuation">)</span><span class="token operator">==</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    sp9 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p9<span class="token punctuation">,</span>p2<span class="token punctuation">)</span><span class="token operator">==</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    sp1 <span class="token operator">=</span> sp2 <span class="token operator">+</span> sp3 <span class="token operator">+</span> sp4 <span class="token operator">+</span> sp5 <span class="token operator">+</span> sp6 <span class="token operator">+</span> sp7 <span class="token operator">+</span> sp8 <span class="token operator">+</span> sp9
                    <span class="token keyword">if</span> <span class="token number">2</span><span class="token operator">&lt;=</span>np1<span class="token operator">&lt;=</span><span class="token number">6</span> <span class="token operator">and</span> sp1<span class="token operator">==</span><span class="token number">1</span> <span class="token operator">and</span><span class="token punctuation">(</span>p2<span class="token operator">*</span>p4<span class="token operator">*</span>p6<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span> <span class="token operator">and</span> <span class="token punctuation">(</span>p4<span class="token operator">*</span>p6<span class="token operator">*</span>p8<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">:</span>
                        changing1<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> x<span class="token punctuation">,</span>y <span class="token keyword">in</span> changing1<span class="token punctuation">:</span>roi<span class="token punctuation">[</span>x<span class="token punctuation">,</span>y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token comment"># step2</span>
        changing2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>row<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>col<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> roi<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">:</span>
                    p2 <span class="token operator">=</span> roi<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">]</span>
                    p3 <span class="token operator">=</span> roi<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span>
                    p4 <span class="token operator">=</span> roi<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span>
                    p5 <span class="token operator">=</span> roi<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span>
                    p6 <span class="token operator">=</span> roi<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">]</span>
                    p7 <span class="token operator">=</span> roi<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>
                    p8 <span class="token operator">=</span> roi<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>
                    p9 <span class="token operator">=</span> roi<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>
                    np1 <span class="token operator">=</span> p2 <span class="token operator">+</span> p3 <span class="token operator">+</span> p4 <span class="token operator">+</span> p5 <span class="token operator">+</span> p6 <span class="token operator">+</span> p7 <span class="token operator">+</span> p8 <span class="token operator">+</span> p9
                    sp2 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p2<span class="token punctuation">,</span> p3<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    sp3 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p3<span class="token punctuation">,</span> p4<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    sp4 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p4<span class="token punctuation">,</span> p5<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    sp5 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p5<span class="token punctuation">,</span> p6<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    sp6 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p6<span class="token punctuation">,</span> p7<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    sp7 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p7<span class="token punctuation">,</span> p8<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    sp8 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p8<span class="token punctuation">,</span> p9<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    sp9 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p9<span class="token punctuation">,</span> p2<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    sp1 <span class="token operator">=</span> sp2 <span class="token operator">+</span> sp3 <span class="token operator">+</span> sp4 <span class="token operator">+</span> sp5 <span class="token operator">+</span> sp6 <span class="token operator">+</span> sp7 <span class="token operator">+</span> sp8 <span class="token operator">+</span> sp9
                    <span class="token keyword">if</span> <span class="token number">2</span><span class="token operator">&lt;=</span>np1<span class="token operator">&lt;=</span> <span class="token number">6</span> <span class="token operator">and</span> sp1 <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">and</span> <span class="token punctuation">(</span>p2<span class="token operator">*</span>p4<span class="token operator">*</span>p8<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">and</span> <span class="token punctuation">(</span>p2<span class="token operator">*</span>p6<span class="token operator">*</span>p8<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                        <span class="token comment">#roi[i,j] = 0</span>
                        changing2<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>
                        <span class="token comment">#print("success")</span>
        <span class="token keyword">for</span> x<span class="token punctuation">,</span>y <span class="token keyword">in</span> changing2<span class="token punctuation">:</span>roi<span class="token punctuation">[</span>x<span class="token punctuation">,</span>y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
    flags <span class="token operator">=</span> roi<span class="token operator">&gt;</span><span class="token number">0</span>
    roi<span class="token punctuation">[</span>flags<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">255</span>
    <span class="token keyword">return</span> roi

<span class="token keyword">def</span> <span class="token function">Draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">131</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img<span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"origin image"</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">"off"</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">132</span><span class="token punctuation">)</span>
    <span class="token comment"># plt.imshow(res,"gray")</span>
    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"res image"</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">"off"</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">133</span><span class="token punctuation">)</span>
    <span class="token comment"># plt.imshow(resP,"gray")</span>
    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"resP image"</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">"off"</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># Draw()</span>

<span class="token keyword">def</span> <span class="token function">XiHua</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">:</span>
    kernel_d <span class="token operator">=</span> cv2<span class="token punctuation">.</span>getStructuringElement<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>MORPH_RECT<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    image_d <span class="token operator">=</span> cv2<span class="token punctuation">.</span>dilate<span class="token punctuation">(</span>image<span class="token punctuation">,</span> kernel_d<span class="token punctuation">,</span> iterations<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">)</span>
    <span class="token comment"># cv2.namedWindow('dilate', cv2.WINDOW_NORMAL)</span>
    <span class="token comment"># cv2.imshow('dilate', image_d)</span>

    kernel_e <span class="token operator">=</span> cv2<span class="token punctuation">.</span>getStructuringElement<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>MORPH_RECT<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    image_e <span class="token operator">=</span> cv2<span class="token punctuation">.</span>erode<span class="token punctuation">(</span>image_d<span class="token punctuation">,</span> kernel_e<span class="token punctuation">)</span>
    image_ske <span class="token operator">=</span> morphology<span class="token punctuation">.</span>skeletonize<span class="token punctuation">(</span>image_e<span class="token punctuation">)</span>
    image_e <span class="token operator">=</span> np<span class="token punctuation">.</span>multiply<span class="token punctuation">(</span>image_e<span class="token punctuation">,</span> image_ske<span class="token punctuation">)</span>

    <span class="token keyword">return</span> image_e


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    <span class="token keyword">import</span> os
    <span class="token keyword">import</span> time
    <span class="token keyword">from</span> skimage <span class="token keyword">import</span> morphology
    image_path <span class="token operator">=</span> <span class="token string">'./image/'</span>
    save_path <span class="token operator">=</span> <span class="token string">'./paper/zhang-suen/'</span>
    sum_time <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">if</span> <span class="token operator">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isdir<span class="token punctuation">(</span>save_path<span class="token punctuation">)</span><span class="token punctuation">:</span> os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>save_path<span class="token punctuation">)</span>

    <span class="token keyword">for</span> img <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>image_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        image <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>image_path<span class="token punctuation">,</span> img<span class="token punctuation">)</span><span class="token punctuation">)</span>
        gray <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>image<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>
        ret<span class="token punctuation">,</span> thresh <span class="token operator">=</span> cv2<span class="token punctuation">.</span>threshold<span class="token punctuation">(</span>gray<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>THRESH_BINARY<span class="token punctuation">)</span>
        time1 <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        result <span class="token operator">=</span> ZhangSuen<span class="token punctuation">(</span>thresh<span class="token punctuation">)</span>
        time2 <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>

        temp_time <span class="token operator">=</span> time2 <span class="token operator">-</span> time1
        sum_time <span class="token operator">+=</span> temp_time
        <span class="token comment"># print("one image time: ", temp_time)</span>
        <span class="token comment"># cv2.namedWindow('result', 0)</span>
        <span class="token comment"># cv2.imshow('result', result)</span>
        <span class="token comment"># cv2.waitKey(10)</span>
        cv2<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>save_path<span class="token punctuation">,</span> img<span class="token punctuation">)</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span>
    per_time <span class="token operator">=</span> sum_time <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>image_path<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"average image time:"</span><span class="token punctuation">,</span> per_time<span class="token punctuation">)</span>









</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8c144f140daeb91618f5e7c4f0b685b6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">如何设置断点进行debug调试（Java）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/546d13ce50618ac35e318a96e5ac533f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">杰魔（Geomagic Design）逆向工程软件学习1-点云和多边形面片文件的处理</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>