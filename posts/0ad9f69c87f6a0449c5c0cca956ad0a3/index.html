<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>使用 Django 创建项目（入门笔记一） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="使用 Django 创建项目（入门笔记一）" />
<meta property="og:description" content="该笔记使用 Python 3.9.12
简介 Django 是一个由 Python 编写的一个开放源代码的 Web 应用框架，具有强大的数据库功能和强大的后台功能
安装 Django 在终端中键入下面命令安装：
$ pip install Django ··· ··· ··· Installing collected packages: sqlparse, asgiref, Django Successfully installed Django-4.1.1 asgiref-3.5.2 sqlparse-0.4.2 查看当前 Django 版本：
$ django-admin --version 4.1.1 安装完成 Django 后，就可以开始使用管理工具 django-admin 了
$ django-admin Type &#39;django-admin help &lt;subcommand&gt;&#39; for help on a specific subcommand. Available subcommands: [django] check compilemessages createcachetable dbshell diffsettings dumpdata flush inspectdb loaddata makemessages makemigrations migrate optimizemigration runserver sendtestemail shell showmigrations sqlflush sqlmigrate sqlsequencereset squashmigrations startapp startproject test testserver 创建项目 【一个额外的问题】 先说个目前看起来可能关系不大的问题。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/0ad9f69c87f6a0449c5c0cca956ad0a3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-09-14T16:20:44+08:00" />
<meta property="article:modified_time" content="2022-09-14T16:20:44+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">使用 Django 创建项目（入门笔记一）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>该笔记使用 Python 3.9.12</p> 
<h2><a id="_1"></a>简介</h2> 
<p>Django 是一个由 Python 编写的一个开放源代码的 Web 应用框架，具有强大的数据库功能和强大的后台功能</p> 
<h2><a id="_Django_4"></a>安装 Django</h2> 
<p>在终端中键入下面命令安装：</p> 
<pre><code class="prism language-shell">$ pip <span class="token function">install</span> Django
···
···
···
Installing collected packages: sqlparse, asgiref, Django
Successfully installed Django-4.1.1 asgiref-3.5.2 sqlparse-0.4.2
</code></pre> 
<p>查看当前 Django 版本：</p> 
<pre><code class="prism language-shell">$ django-admin --version
<span class="token number">4.1</span>.1
</code></pre> 
<p>安装完成 Django 后，就可以开始使用管理工具 django-admin 了</p> 
<pre><code class="prism language-shell">$ django-admin                  

Type <span class="token string">'django-admin help &lt;subcommand&gt;'</span> <span class="token keyword">for</span> <span class="token builtin class-name">help</span> on a specific subcommand.

Available subcommands:

<span class="token punctuation">[</span>django<span class="token punctuation">]</span>
    check
    compilemessages
    createcachetable
    dbshell
    diffsettings
    dumpdata
    flush
    inspectdb
    loaddata
    makemessages
    makemigrations
    migrate
    optimizemigration
    runserver
    sendtestemail
    shell
    showmigrations
    sqlflush
    sqlmigrate
    sqlsequencereset
    squashmigrations
    startapp
    startproject
    <span class="token builtin class-name">test</span>
    testserver
</code></pre> 
<h2><a id="_57"></a>创建项目</h2> 
<h5><a id="_58"></a>【一个额外的问题】</h5> 
<p>先说个目前看起来可能关系不大的问题。<br> （限 Python 3.3 及以上版本，不在该版本限制内直接看下面正文。）<br> 实际开发过程中往往会存在多个 Python 项目（学习过程中可能也有，但是吧，自己学习的时候比较有时间折腾）每个项目所需的 Python 版本可能不一致，比如 Python 2.X、Python 3.X，每个项目所需的依赖包也可能不一致，比如 A 项目只要 Selenium 相关依赖包，B 项目只要 Appium 相关依赖包，即便不同项目用同一个依赖包，但依赖包版本可能不一致。<br> 这个时候把不同项目所需要的环境隔离开来是很有用的。<br> 恰好 Python 自带的轻量级虚拟环境 venv 可以满足这种需求。使用方法如下：<br> 新建一个目录作为项目的容器：</p> 
<pre><code class="prism language-shell">$ <span class="token function">mkdir</span> my_note
$ <span class="token builtin class-name">cd</span> my_note
</code></pre> 
<p>在新建的目录中建立虚拟环境，并激活它，这里 ll_env 是当前环境的名称：</p> 
<pre><code class="prism language-shell">$ python -m venv ll_env
$ <span class="token builtin class-name">source</span> ll_env/bin/activate
</code></pre> 
<p>然后就可以在这个激活的这个虚拟环境中开始一个项目辣～<br> 如果想退出虚拟环境，在终端输入如下命令即可：</p> 
<pre><code class="prism language-shell">$ deactivate
</code></pre> 
<p>如果这个项目废弃终止不想学了，直接把整个目录删掉就可以辣～<br> 具体教程可以查看 <a href="https://docs.python.org/3/library/venv.html" rel="nofollow">venv — Creation of virtual environments</a></p> 
<h4><a id="_82"></a>【下面是正文】</h4> 
<p>这里创建一个名为 my_note 的项目，用于分类保存不同的学习笔记。</p> 
<pre><code class="prism language-shell">$ django-admin startproject my_note <span class="token builtin class-name">.</span>
</code></pre> 
<p>使用 <strong><mark>startproject</mark></strong> 子命令来创建一个项目，这里 <mark>my_note</mark> 是当前项目的名称，点号 <mark>(.)</mark> 指定项目创建路径为当前路径。<br> 使用下面命令可以查看更为详细的子命令使用语法：</p> 
<pre><code class="prism language-shell">$ django-admin <span class="token builtin class-name">help</span> startproject
</code></pre> 
<p>新建项目后，当前路径新增一个名为 manage.py 的文件和一个名为 my_note 的文件夹。</p> 
<pre><code class="prism language-shell">$ <span class="token function">ls</span>                            
manage.py	my_note
</code></pre> 
<p>其中，manage.py 是一个命令行工具，可让项目所有者以各种方式与该 Django 项目进行交互。<br> 文件夹 my_note 是当前项目的容器，其中又包含如下五个文件:</p> 
<pre><code class="prism language-shell">$ <span class="token function">ls</span> my_note 
__init__.py	settings.py	wsgi.py
asgi.py		urls.py
</code></pre> 
<p>各文件分工大致如下：</p> 
<table><thead><tr><th>my_note</th><th align="left">项目容器</th></tr></thead><tbody><tr><td><em>init</em>_.py</td><td align="left">空文件，告诉 Python 该目录是一个 Python 包</td></tr><tr><td>asgi.py</td><td align="left">(Asynchronous Server Gateway Interface) 异步服务器网关接口</td></tr><tr><td>settings.py</td><td align="left">Django 项目的配置文件，指定 Django 如何与系统交互以及如何管理项目</td></tr><tr><td>urls.py</td><td align="left">该 Django 项目的 URL 声明，一份由 Django 驱动的网站"目录"，告诉Django应创建哪些网页来响应浏览器请求</td></tr><tr><td>wigs.py</td><td align="left">(web server gateway interface) Web 服务器网关接口，帮助Django 提供它创建的文件</td></tr></tbody></table> 
<p>在终端键入如下命令启动该项目服务：</p> 
<pre><code class="prism language-shell">$ python manage.py runserver
Watching <span class="token keyword">for</span> <span class="token function">file</span> changes with StatReloader
Performing system checks<span class="token punctuation">..</span>.

System check identified no issues <span class="token punctuation">(</span><span class="token number">0</span> silenced<span class="token punctuation">)</span>.

You have <span class="token number">18</span> unapplied migration<span class="token punctuation">(</span>s<span class="token punctuation">)</span>. Your project may not work properly <span class="token keyword">until</span> you apply the migrations <span class="token keyword">for</span> app<span class="token punctuation">(</span>s<span class="token punctuation">)</span>: admin, auth, contenttypes, sessions.
Run <span class="token string">'python manage.py migrate'</span> to apply them.
September 09, <span class="token number">2022</span> - 06:02:21
Django version <span class="token number">4.1</span>.1, using settings <span class="token string">'my_note.settings'</span>
Starting development server at http://127.0.0.1:8000/
Quit the server with CONTROL-C.
</code></pre> 
<p>通过输出可以看到， django 默认使用 8000 端口，如果出现如下端口占用提示：</p> 
<pre><code class="prism language-shell">Error: That port is already <span class="token keyword">in</span> use.
</code></pre> 
<p>通过如下方式指定可用的端口即可（可以通过不断增加端口值来尝试到底哪个值是可用的）：</p> 
<pre><code class="prism language-shell">$ python manage.py runserver <span class="token number">8001</span>
</code></pre> 
<p>输出的最后一句提示终止服务器的指令 Ctrl + c：</p> 
<pre><code class="prism language-shell"><span class="token punctuation">..</span>.
Quit the server with CONTROL-C.
</code></pre> 
<p>成功启动项目服务后，先不急于关闭服务。在浏览器中打开 127.0.0.1:8000，检查是否能正常访问，这里我打开的网页显示如下：<br> <img src="https://images2.imgbox.com/22/aa/HnOydCCL_o.png" alt="一个空的 Django 项目"></p> 
<p>如果成功打开 Django 页面，则表示目前服务是正常的，如果无法打开，删除当前目录再依据上述步骤重走一遍。</p> 
<h2><a id="_149"></a>创建数据库</h2> 
<p>Django 的特点之一，是有强大的数据库功能，它采用的是 MVT 的软件设计模式，即：</p> 
<dl> 
 
   MVT 
  
 <dd>
   M(Model 模型)：负责和数据库交互 
 </dd> 
 <dd>
   V(View 视图)：负责业务处理逻辑处理 
 </dd> 
 <dd>
   T(Template 模版)：负责页面（html）数据渲染 
 </dd> 
</dl> 
<p><img src="https://images2.imgbox.com/7c/8b/2wLWscha_o.jpg" alt="MVT 模型"></p> 
<p>这里就先来创建一个数据库，体验一下 <s>强大的</s> 数据库功能。<br> Django 对各种数据库包括：PgSQL、MySQL、SQLite、Oracle 提供了很好的支持，这里使用 Django 默认的数据库 SQLite。</p> 
<pre><code class="prism language-shell">$ python manage.py migrate
Operations to perform:
  Apply all migrations: admin, auth, contenttypes, sessions
Running migrations:
  Applying contenttypes.0001_initial<span class="token punctuation">..</span>. OK
  <span class="token punctuation">..</span>.
  <span class="token punctuation">..</span>.
  Applying sessions.0001_initial<span class="token punctuation">..</span>. OK
</code></pre> 
<p><mark>migrate</mark> 迁移数据库，该子命令让数据库与当前状态匹配，确保数据库结构与当前状态匹配。若数据库不存在，将新建一个数据库，用于储存项目中存在的信息。<br> 当前 Demo 中的数据库是 db.splite3。</p> 
<pre><code class="prism language-shell">$ <span class="token function">ls</span>
db.sqlite3	manage.py	my_note
</code></pre> 
<h2><a id="_181"></a>创建应用程序</h2> 
<pre><code class="prism language-shell">$ python manage.py startapp notes
$ <span class="token function">ls</span> notes/
__init__.py	apps.py		models.py	views.py
admin.py	migrations	tests.py
</code></pre> 
<p><mark>startapp</mark> 创建一个应用，并在当前目录下创建同名目录，因此需要和项目名称区分开来，否则会报错：</p> 
<pre><code class="prism language-shell">$ python manage.py startapp my_note
CommandError: <span class="token string">'my_note'</span> conflicts with the name of an existing Python module and cannot be used as an app name. Please try another name.
</code></pre> 
<p>查看应用目录（这里是notes/）下文件：</p> 
<table><thead><tr><th>my_note</th><th align="left">应用目录</th></tr></thead><tbody><tr><td>admin.py</td><td align="left">用于自定义 Django 管理工具</td></tr><tr><td>apps.py</td><td align="left">主要用于左侧菜单栏展示，和排序位置</td></tr><tr><td>modes.py</td><td align="left">模型类，相当于数据库表</td></tr><tr><td>tests.py</td><td align="left">Django测试文件</td></tr><tr><td>views.py</td><td align="left">视图类</td></tr></tbody></table> 
<p>回顾 MVT 设计模式，数据库与用户的交互，离不开模型的支持，因此还需要定义模型。<br> （为什么一定要使用视图模型？为什么用户不能直接和数据库交互？模型视图实现了数据和界面分离，使得相同的数据在多个不同的视图中进行显示成为可能，提高了灵活性和重用性。详细的知识后面再学习和补充笔记。）</p> 
<h4><a id="_207"></a>定义模型</h4> 
<p>Django 模型使用自带的 ORM（Object Relational Mapping 对象关系映射）实现面向对象编程语言里不同类型系统的数据之间的转换，通过使用描述对象和数据库之间的映射的元数据，将程序中的对象自动持久化到数据库中。<br> <img src="https://images2.imgbox.com/18/0a/wwHYvveu_o.jpg" alt="ORM 对象关系映射"></p> 
<p>ORM 与数据库的对应关系如下：</p> 
<p><img src="https://images2.imgbox.com/5e/d2/MuMpEmhI_o.jpg" alt="ORM 与数据库的对应关系"></p> 
<p>其解析过程如下：<br> <img src="https://images2.imgbox.com/de/62/3UFUkUJp_o.jpg" alt="ORM 解析"></p> 
<p>优点：数据库类型无关<br> 缺点： ORM 代码转换为 SQL 语句对执行效率有一定程度影响</p> 
<p>模型定义于 notes/models.py</p> 
<pre><code class="prism language-shell">$  <span class="token function">cat</span> notes/models.py
from django.db <span class="token function">import</span> models

<span class="token comment"># Create your models here.</span>
</code></pre> 
<p>这里首先定义一个笔记主题类：</p> 
<pre><code class="prism language-python"><span class="token comment"># models.py</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models

<span class="token comment"># Create your models here.</span>
<span class="token keyword">class</span> <span class="token class-name">TopicModel</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment"># 主题名称</span>
	text <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">)</span>
	date_added <span class="token operator">=</span> models<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span>auto_now_add <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>

	<span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">return</span> self<span class="token punctuation">.</span>text
</code></pre> 
<p><mark>models.Model</mark> 是 Django 的一个模型类，Django 要求所有自定义模型类都必须继承此类。这里 <em>TopicModel</em> 可以理解为数据库的表名，而成员变量 <em>text</em>、<em>data_added</em> 表示表字段，其字段类型分别为 <em>Char</em> 和 <em>DateTime</em>。</p> 
<p>模型定义出来后，必须在项目中包含该应用。前面新建项目的时候，在项目容器目录 my_note 中有一个 <em>settings.py</em>，该文件为 Django 项目的配置文件，指定 Django 如何与系统交互以及如何管理项目。<br> 因此修改 <em>settings.py</em> 文件来 告诉Django 将应用 notes 安装在项目中。<br> 在 <em>settings.py</em> 中找到 <em>INSTALLED_APPS</em>，顾名思义，该列表告诉 Django 当前项目由哪些应用组成，在这个列表后追加上面新建的应用的名称，并保存该文件。</p> 
<pre><code class="prism language-python">INSTALLED_APPS <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'django.contrib.admin'</span><span class="token punctuation">,</span>
    <span class="token string">'django.contrib.auth'</span><span class="token punctuation">,</span>
    <span class="token string">'django.contrib.contenttypes'</span><span class="token punctuation">,</span>
    <span class="token string">'django.contrib.sessions'</span><span class="token punctuation">,</span>
    <span class="token string">'django.contrib.messages'</span><span class="token punctuation">,</span>
    <span class="token string">'django.contrib.staticfiles'</span><span class="token punctuation">,</span>
    <span class="token string">'notes'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre> 
<p><em>settings.py</em> 中还包含了很多其他的内容，后面在补充其他内容的笔记。<br> 一切准备就绪，接下来只要让 Django 在数据库中添加 <em>TopicModel</em> 相关的信息即可。</p> 
<pre><code class="prism language-shell">$ python manage.py makemigrations notes
Migrations <span class="token keyword">for</span> <span class="token string">'notes'</span><span class="token builtin class-name">:</span>
  notes/migrations/0001_initial.py
    - Create model TopicModel
$ python manage.py migrate    
Operations to perform:
  Apply all migrations: admin, auth, contenttypes, notes, sessions
Running migrations:
  Applying notes.0001_initial<span class="token punctuation">..</span>. OK
</code></pre> 
<p>子命令 <mark>makemigrations</mark> 为自定义的 model 类生成数据库迁移文件，以便于后面在数据库中生成数据表，最后调用 <em>migrate</em> 应用迁移，将迁移文件集同步到数据库中。<br> 现在数据库中已经包含了上面定义的模型：</p> 
<pre><code class="prism language-sql">sqlite<span class="token operator">&gt;</span> <span class="token punctuation">.</span><span class="token keyword">open</span> db<span class="token punctuation">.</span>sqlite3
sqlite<span class="token operator">&gt;</span> <span class="token keyword">select</span> tbl_name <span class="token keyword">from</span> sqlite_master <span class="token keyword">where</span> <span class="token keyword">type</span> <span class="token operator">=</span> <span class="token string">'table'</span><span class="token punctuation">;</span>
django_migrations
sqlite_sequence
auth_group_permissions
auth_user_groups
auth_user_user_permissions
django_admin_log
django_content_type
auth_permission
auth_group
auth_user
django_session
notes_topicmodel
sqlite<span class="token operator">&gt;</span> <span class="token punctuation">.</span><span class="token keyword">schema</span> notes_topicmodel
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token string">"notes_topicmodel"</span> <span class="token punctuation">(</span><span class="token string">"id"</span> <span class="token keyword">integer</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> AUTOINCREMENT<span class="token punctuation">,</span> <span class="token string">"text"</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token string">"date_added"</span> <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>【总结】修改 Django 数据库结构：</p> 
<ol><li>修改 models.py</li><li>调用 makemigrations 生成新的迁移文件</li><li>调用 migrate 应用迁移</li></ol> 
<h4><a id="_Django__303"></a>使用 Django 管理网站进行数据交互</h4> 
<p>首先创建一个超级管理员，方便使用超级管理员账号在 Django 管理网站上对数据库追加数据。</p> 
<pre><code class="prism language-shell"> python manage.py createsuperuser
Username <span class="token punctuation">(</span>leave blank to use <span class="token string">'a123'</span><span class="token punctuation">)</span>: admin
Email address: 
Password: 
Password <span class="token punctuation">(</span>again<span class="token punctuation">)</span>: 
Superuser created successfully.
</code></pre> 
<p>查看数据库可以发现，Django 并不直接保存密码明文，而是保存通过密码生成的一串散列值，用户登陆的时候，通过比较用户输入生成的散列值和数据库中的值来进行身份验证。</p> 
<pre><code class="prism language-sql">sqlite<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> auth_user<span class="token punctuation">;</span>
<span class="token number">1</span><span class="token operator">|</span>pbkdf2_sha256$<span class="token number">390000</span>$jQABTD2vujvADKmyU0SIWx$MoJz6m7XYP<span class="token operator">+</span>dNQQrxIAz0W8XxUhyI5AJL0dYmlrssWk<span class="token operator">=</span><span class="token operator">||</span><span class="token number">1</span><span class="token operator">|</span>admin<span class="token operator">||</span><span class="token operator">|</span><span class="token number">1</span><span class="token operator">|</span><span class="token number">1</span><span class="token operator">|</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">14</span> <span class="token number">02</span>:<span class="token number">33</span>:<span class="token number">34.769381</span><span class="token operator">|</span>
</code></pre> 
<p>为了在管理网站上操作自定义数据模型，还需要将上面创建的模型注册到网站中去，实现的方法是，在应用目录 notes/ 中的 admin.py 中进行注册：</p> 
<pre><code class="prism language-python"><span class="token comment"># admin.py</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib <span class="token keyword">import</span> admin

<span class="token comment"># Register your models here.</span>
<span class="token comment"># 注意这里先导入模型类，否则会提示’NameError: name 'TopicModel' is not defined‘</span>
<span class="token keyword">from</span> notes<span class="token punctuation">.</span>models <span class="token keyword">import</span> TopicModel
admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>register<span class="token punctuation">(</span>TopicModel<span class="token punctuation">)</span>
</code></pre> 
<p>现在，可以通过在浏览器访问 ‘<a href="http://127.0.0.1:8000/admin/" rel="nofollow">http://127.0.0.1:8000/admin/</a>’ 登录管理员账号辣～</p> 
<p><img src="https://images2.imgbox.com/9a/44/BqQiWMBl_o.png" alt="Django 管理网站登录界面"></p> 
<p>可以看到，网页上显示了上面自定义的 TopicModels 模型：<br> <img src="https://images2.imgbox.com/7d/ee/H0z59hkR_o.png" alt="管理界面"></p> 
<p>但上面有一个问题，就是 <em>Topic models</em> 是根据上面定义的类名生成的，但其实并不是我想要显示的文本。<br> <img src="https://images2.imgbox.com/2c/32/kfjLaPFe_o.png" alt="一个显示问题"></p> 
<p>这种情况下只要在模型中加入<em>class Meta</em> 即可：</p> 
<pre><code class="prism language-python"><span class="token comment"># models.py</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models

<span class="token comment"># Create your models here.</span>
<span class="token keyword">class</span> <span class="token class-name">TopicModel</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment"># 主题名称</span>
	text <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">)</span>
	date_added <span class="token operator">=</span> models<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span>auto_now_add <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>

	<span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">return</span> self<span class="token punctuation">.</span>text

	<span class="token comment"># ---------------- 下面是修改的部分 ----------------</span>
	<span class="token comment"># 自定义显示文本：</span>
	<span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
		<span class="token comment"># 单数</span>
		verbose_name <span class="token operator">=</span> <span class="token string">'Topic'</span>
		<span class="token comment"># 复数</span>
		verbose_name_plural <span class="token operator">=</span> <span class="token string">'Topics'</span>
</code></pre> 
<p><mark>Meta</mark> 类主要用来存储用于管理模型的额外信息，这里通过设置它的 <em>verbose_name</em> 和 <em>verbose_name_plural</em>，来实现自定义显示文本的效果。<br> 因为修改了模型，因此需要再次迁移数据库，并重新启动服务：</p> 
<pre><code class="prism language-shell">$ python manage.py makemigrations notes
Migrations <span class="token keyword">for</span> <span class="token string">'notes'</span><span class="token builtin class-name">:</span>
  notes/migrations/0002_alter_topicmodel_options.py
    - Change Meta options on topicmodel
$ python manage.py migrate
Operations to perform:
  Apply all migrations: admin, auth, contenttypes, notes, sessions
Running migrations:
  Applying notes.0002_alter_topicmodel_options<span class="token punctuation">..</span>. OK
  ¥ python manage.py runserver
Watching <span class="token keyword">for</span> <span class="token function">file</span> changes with StatReloader
Performing system checks<span class="token punctuation">..</span>.

System check identified no issues <span class="token punctuation">(</span><span class="token number">0</span> silenced<span class="token punctuation">)</span>.
September <span class="token number">14</span>, <span class="token number">2022</span> - 07:05:47
Django version <span class="token number">4.1</span>.1, using settings <span class="token string">'my_note.settings'</span>
Starting development server at http://127.0.0.1:8000/
Quit the server with CONTROL-C.
</code></pre> 
<p>重新登录管理账号显示效果：<br> <img src="https://images2.imgbox.com/d4/20/ryU5g9eZ_o.png" alt="修改显示文本之后的显示效果"></p> 
<p>现在，可以通过网页上的添加修改按键来添加主题，这里我随手建了两个主题：<br> <img src="https://images2.imgbox.com/d4/63/X3sTFn0P_o.png" alt="通过网页端新建主题"></p> 
<p>主题有了，现在新建一个条目类，用于往主题中新增条目，新增修改模型均在 models.py 文件入手，操作同上面建立主题模型一样：</p> 
<pre><code class="prism language-python"><span class="token comment"># models.py</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models

<span class="token keyword">class</span> <span class="token class-name">TopicModel</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
	text <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">)</span>
	date_added <span class="token operator">=</span> models<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span>auto_now_add <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>

	<span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">return</span> self<span class="token punctuation">.</span>text

	<span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
		verbose_name <span class="token operator">=</span> <span class="token string">'Topic'</span>
		verbose_name_plural <span class="token operator">=</span> <span class="token string">'Topics'</span>

<span class="token keyword">class</span> <span class="token class-name">EntryModel</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment"># 条目关联的主题</span>
	topic <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>TopicModel<span class="token punctuation">,</span> on_delete <span class="token operator">=</span> models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">)</span>
	text <span class="token operator">=</span> models<span class="token punctuation">.</span>TextField<span class="token punctuation">(</span><span class="token punctuation">)</span>
	date_added <span class="token operator">=</span> models<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span>auto_now_add <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>

	<span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>text<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">:</span>
			<span class="token keyword">return</span> self<span class="token punctuation">.</span>text
		<span class="token keyword">return</span> self<span class="token punctuation">.</span>text<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'...'</span>

	<span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
		verbose_name <span class="token operator">=</span> <span class="token string">'Entry'</span>
		verbose_name_plural <span class="token operator">=</span> <span class="token string">'Entries'</span>
</code></pre> 
<p>条目与主题的关系，通常是多对一的，因此在创建条目类 <em>EntryModel</em> 时，为其添加了一个外键，关联一个特定的主题。<br> 注意，新加入的模型要想使用的话，一定一定要在 admin.py 中进行注册</p> 
<pre><code class="prism language-python"><span class="token comment"># admin.py</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib <span class="token keyword">import</span> admin

<span class="token comment"># Register your models here.</span>
<span class="token keyword">from</span> notes<span class="token punctuation">.</span>models <span class="token keyword">import</span> TopicModel<span class="token punctuation">,</span> EntryModel
admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>register<span class="token punctuation">(</span>TopicModel<span class="token punctuation">)</span>
admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>register<span class="token punctuation">(</span>EntryModel<span class="token punctuation">)</span>
</code></pre> 
<p>迁移数据库并重启：</p> 
<pre><code class="prism language-shell">$ python manage.py makemigrations notes
Migrations <span class="token keyword">for</span> <span class="token string">'notes'</span><span class="token builtin class-name">:</span>
  notes/migrations/0003_entrymodel.py
    - Create model EntryModel
$ python manage.py migrate
Operations to perform:
  Apply all migrations: admin, auth, contenttypes, notes, sessions
Running migrations:
  Applying notes.0003_entrymodel<span class="token punctuation">..</span>. OK
  $  python manage.py runserver
Watching <span class="token keyword">for</span> <span class="token function">file</span> changes with StatReloader
Performing system checks<span class="token punctuation">..</span>.

System check identified no issues <span class="token punctuation">(</span><span class="token number">0</span> silenced<span class="token punctuation">)</span>.
September <span class="token number">14</span>, <span class="token number">2022</span> - 07:56:18
Django version <span class="token number">4.1</span>.1, using settings <span class="token string">'my_note.settings'</span>
Starting development server at http://127.0.0.1:8000/
Quit the server with CONTROL-C.
</code></pre> 
<p>现在重新登录网页端，就可以新增条目并关联主题辣～<br> <img src="https://images2.imgbox.com/dc/df/gZH8gtW1_o.png" alt="新增条目"><br> 添加条目并关联主题：<br> <img src="https://images2.imgbox.com/ae/35/WuuMs3DL_o.png" alt="在这里插入图片描述"><br> 条目长度大于 20 则自动显示省略号：<br> <img src="https://images2.imgbox.com/51/c7/FKkjDdhh_o.png" alt="在这里插入图片描述"></p> 
<p>至此，一个简单的网页笔记就创建完成了。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b6c48be1818ff77af763d4642c383922/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">前端项目中的鉴权是如何实现的？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3239d3c54235fb6d180c2fc4d71c4851/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Upload-labs（Pass7-8）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>