<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【游戏开发教程】BehaviorDesigner插件制作AI行为树（Unity | 保姆级教程 | 动态图演示 | Unity2021最新版） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【游戏开发教程】BehaviorDesigner插件制作AI行为树（Unity | 保姆级教程 | 动态图演示 | Unity2021最新版）" />
<meta property="og:description" content="文章目录 一、前言二、插件下载1、AssetStore下载2、GitCode下载 三、官方教程1、在线文档2、离线文档 四、插件界面1、打开编辑器2、界面介绍 五、快速制作一棵行为树1、创建物体2、挂BehaviorTree脚本3、添加Task节点4、运行测试5、导出BehaviorTree6、手动引用BehaviorTree树资源6.1、设置External Behavior6.2、使用Behavior Tree Reference 7、动态加载行为树资源并设置External Behavior 六、复合节点：Composities1、Sequence：顺序节点1.1、节点介绍1.2、新发口诀1.3、案例1：通知开饭了1.4、案例2：吃几口饭吃一口菜 2、Parallel：并行节点2.1、节点介绍2.2、新发口诀2.3、案例：边跑步边听歌 3、Selector：选择节点3.1、节点介绍3.2、新发口诀3.3、案例：诈骗举报概率 4、Parallel Selector：并行选择节点4.1、节点介绍4.2、新发口诀4.3、案例：考研和找工作 5、Priority Selector：优先级选择节点5.1、节点介绍5.2、新发口诀5.3、案例：先吵架还是先道歉 6、Random Selector：随机选择节点6.1、节点介绍6.2、新发口诀6.3、案例：吃米饭、面条、饺子 7、Random Sequence：随机顺序节点7.1、节点介绍7.2、新发口诀7.3、案例：番茄炒蛋 8、Parallel Complete：并行竞争节点8.1、节点介绍8.2、新发口诀 9、Selector Evaluator：评估选择节点9.1、节点介绍9.2、新发口诀 七、中断1、Self中断：老妈喊你回家吃饭2、Lower Priority中断：睡觉时地震3、Both中断：两者都中断 八、Variables：行为树成员变量1、添加变量2、读取变量3、修改变量4、拓展变量类型5、代码读写变量 九、行为树事件1、Send Event节点1.1、Target Game Object参数1.2、Event Name参数1.3、Group参数1.4、Argument参数 2、Has Receive Event节点2.1、Event Name参数2.2、Stored Value参数 3、代码中注册和注销事件 十、拓展行为树节点1、继承2、案例：MoveTo3、官方Sample包 十一、完毕 一、前言 嗨，大家好，我是新发。之前用过Behavior Designer行为树插件，最近又需要用到，我发现网上的教程很多写得不够好，今天我就来写写Behavior Designer行为树的教程吧，希望可以帮到大家。
二、插件下载 1、AssetStore下载 插件可以在AssetStore下载到，
地址：https://assetstore.unity.com/packages/tools/visual-scripting/behavior-designer-behavior-trees-for-everyone-15277
目前最新的版本是1.7.2，
可以在官网查看每个版本的迭代内容：
https://opsive.com/news/category/release-notes/behavior-designer-release-notes/
2、GitCode下载 我放了1.7.1版本的到GitCode上，地址：https://gitcode.net/linxinfa/unitybehaviordesigner
下载下来后，放入你的工程即可，
其中我加了一个FixGUIStyle脚本，
因为在Unity专业版上，打开Behavior Designer编辑器是这个鬼样，
注：如果你使用的是个人版，则不会有这个问题
它的GUIStyle在Unity专业版本有问题，插件编辑器是个dll文件，我们无法修改编辑器源码，
然后我进行了反编译，找到了它的封装各种GUIStyle的类：BehaviorDesignerUtility，
通过反射，修改这个类的私有静态成员对象，代码如下：
using UnityEngine; using UnityEditor; using System.Reflection; using BehaviorDesigner." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/f2e126b736d8e4ceae11b53af5f41887/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-05-01T11:22:44+08:00" />
<meta property="article:modified_time" content="2022-05-01T11:22:44+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【游戏开发教程】BehaviorDesigner插件制作AI行为树（Unity | 保姆级教程 | 动态图演示 | Unity2021最新版）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night-eighties">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><ul><li><a href="#_2" rel="nofollow">一、前言</a></li><li><a href="#_5" rel="nofollow">二、插件下载</a></li><li><ul><li><a href="#1AssetStore_6" rel="nofollow">1、AssetStore下载</a></li><li><a href="#2GitCode_15" rel="nofollow">2、GitCode下载</a></li></ul> 
    </li><li><a href="#_101" rel="nofollow">三、官方教程</a></li><li><ul><li><a href="#1_103" rel="nofollow">1、在线文档</a></li><li><a href="#2_106" rel="nofollow">2、离线文档</a></li></ul> 
    </li><li><a href="#_110" rel="nofollow">四、插件界面</a></li><li><ul><li><a href="#1_111" rel="nofollow">1、打开编辑器</a></li><li><a href="#2_120" rel="nofollow">2、界面介绍</a></li></ul> 
    </li><li><a href="#_153" rel="nofollow">五、快速制作一棵行为树</a></li><li><ul><li><a href="#1_156" rel="nofollow">1、创建物体</a></li><li><a href="#2BehaviorTree_163" rel="nofollow">2、挂BehaviorTree脚本</a></li><li><a href="#3Task_174" rel="nofollow">3、添加Task节点</a></li><li><a href="#4_185" rel="nofollow">4、运行测试</a></li><li><a href="#5BehaviorTree_190" rel="nofollow">5、导出BehaviorTree</a></li><li><a href="#6BehaviorTree_199" rel="nofollow">6、手动引用BehaviorTree树资源</a></li><li><ul><li><a href="#61External_Behavior_200" rel="nofollow">6.1、设置External Behavior</a></li><li><a href="#62Behavior_Tree_Reference_205" rel="nofollow">6.2、使用Behavior Tree Reference</a></li></ul> 
     </li><li><a href="#7External_Behavior_220" rel="nofollow">7、动态加载行为树资源并设置External Behavior</a></li></ul> 
    </li><li><a href="#Composities_288" rel="nofollow">六、复合节点：Composities</a></li><li><ul><li><a href="#1Sequence_297" rel="nofollow">1、Sequence：顺序节点</a></li><li><ul><li><a href="#11_298" rel="nofollow">1.1、节点介绍</a></li><li><a href="#12_310" rel="nofollow">1.2、新发口诀</a></li><li><a href="#131_314" rel="nofollow">1.3、案例1：通知开饭了</a></li><li><a href="#142_342" rel="nofollow">1.4、案例2：吃几口饭吃一口菜</a></li></ul> 
     </li><li><a href="#2Parallel_348" rel="nofollow">2、Parallel：并行节点</a></li><li><ul><li><a href="#21_349" rel="nofollow">2.1、节点介绍</a></li><li><a href="#22_356" rel="nofollow">2.2、新发口诀</a></li><li><a href="#23_359" rel="nofollow">2.3、案例：边跑步边听歌</a></li></ul> 
     </li><li><a href="#3Selector_368" rel="nofollow">3、Selector：选择节点</a></li><li><ul><li><a href="#31_370" rel="nofollow">3.1、节点介绍</a></li><li><a href="#32_388" rel="nofollow">3.2、新发口诀</a></li><li><a href="#33_390" rel="nofollow">3.3、案例：诈骗举报概率</a></li></ul> 
     </li><li><a href="#4Parallel_Selector_399" rel="nofollow">4、Parallel Selector：并行选择节点</a></li><li><ul><li><a href="#41_400" rel="nofollow">4.1、节点介绍</a></li><li><a href="#42_409" rel="nofollow">4.2、新发口诀</a></li><li><a href="#43_411" rel="nofollow">4.3、案例：考研和找工作</a></li></ul> 
     </li><li><a href="#5Priority_Selector_420" rel="nofollow">5、Priority Selector：优先级选择节点</a></li><li><ul><li><a href="#51_421" rel="nofollow">5.1、节点介绍</a></li><li><a href="#52_485" rel="nofollow">5.2、新发口诀</a></li><li><a href="#53_488" rel="nofollow">5.3、案例：先吵架还是先道歉</a></li></ul> 
     </li><li><a href="#6Random_Selector_508" rel="nofollow">6、Random Selector：随机选择节点</a></li><li><ul><li><a href="#61_509" rel="nofollow">6.1、节点介绍</a></li><li><a href="#62_519" rel="nofollow">6.2、新发口诀</a></li><li><a href="#63_522" rel="nofollow">6.3、案例：吃米饭、面条、饺子</a></li></ul> 
     </li><li><a href="#7Random_Sequence_529" rel="nofollow">7、Random Sequence：随机顺序节点</a></li><li><ul><li><a href="#71_530" rel="nofollow">7.1、节点介绍</a></li><li><a href="#72_541" rel="nofollow">7.2、新发口诀</a></li><li><a href="#73_543" rel="nofollow">7.3、案例：番茄炒蛋</a></li></ul> 
     </li><li><a href="#8Parallel_Complete_546" rel="nofollow">8、Parallel Complete：并行竞争节点</a></li><li><ul><li><a href="#81_547" rel="nofollow">8.1、节点介绍</a></li><li><a href="#82_552" rel="nofollow">8.2、新发口诀</a></li></ul> 
     </li><li><a href="#9Selector_Evaluator_555" rel="nofollow">9、Selector Evaluator：评估选择节点</a></li><li><ul><li><a href="#91_556" rel="nofollow">9.1、节点介绍</a></li><li><a href="#92_575" rel="nofollow">9.2、新发口诀</a></li></ul> 
    </li></ul> 
    </li><li><a href="#_579" rel="nofollow">七、中断</a></li><li><ul><li><a href="#1Self_590" rel="nofollow">1、Self中断：老妈喊你回家吃饭</a></li><li><a href="#2Lower_Priority_606" rel="nofollow">2、Lower Priority中断：睡觉时地震</a></li><li><a href="#3Both_616" rel="nofollow">3、Both中断：两者都中断</a></li></ul> 
    </li><li><a href="#Variables_620" rel="nofollow">八、Variables：行为树成员变量</a></li><li><ul><li><a href="#1_624" rel="nofollow">1、添加变量</a></li><li><a href="#2_629" rel="nofollow">2、读取变量</a></li><li><a href="#3_641" rel="nofollow">3、修改变量</a></li><li><a href="#4_650" rel="nofollow">4、拓展变量类型</a></li><li><a href="#5_712" rel="nofollow">5、代码读写变量</a></li></ul> 
    </li><li><a href="#_742" rel="nofollow">九、行为树事件</a></li><li><ul><li><ul><li><a href="#1Send_Event_748" rel="nofollow">1、Send Event节点</a></li><li><ul><li><a href="#11Target_Game_Object_751" rel="nofollow">1.1、Target Game Object参数</a></li><li><a href="#12Event_Name_770" rel="nofollow">1.2、Event Name参数</a></li><li><a href="#13Group_772" rel="nofollow">1.3、Group参数</a></li><li><a href="#14Argument_781" rel="nofollow">1.4、Argument参数</a></li></ul> 
      </li><li><a href="#2Has_Receive_Event_790" rel="nofollow">2、Has Receive Event节点</a></li><li><ul><li><a href="#21Event_Name_793" rel="nofollow">2.1、Event Name参数</a></li><li><a href="#22Stored_Value_795" rel="nofollow">2.2、Stored Value参数</a></li></ul> 
      </li><li><a href="#3_803" rel="nofollow">3、代码中注册和注销事件</a></li></ul> 
    </li></ul> 
    </li><li><a href="#_823" rel="nofollow">十、拓展行为树节点</a></li><li><ul><li><a href="#1_824" rel="nofollow">1、继承</a></li><li><a href="#2MoveTo_834" rel="nofollow">2、案例：MoveTo</a></li><li><a href="#3Sample_877" rel="nofollow">3、官方Sample包</a></li></ul> 
    </li><li><a href="#_884" rel="nofollow">十一、完毕</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h4><a id="_2"></a>一、前言</h4> 
<p>嗨，大家好，我是新发。之前用过<code>Behavior Designer</code>行为树插件，最近又需要用到，我发现网上的教程很多写得不够好，今天我就来写写<code>Behavior Designer</code>行为树的教程吧，希望可以帮到大家。</p> 
<h4><a id="_5"></a>二、插件下载</h4> 
<h5><a id="1AssetStore_6"></a>1、AssetStore下载</h5> 
<p>插件可以在<code>AssetStore</code>下载到，<br> 地址：<a href="https://assetstore.unity.com/packages/tools/visual-scripting/behavior-designer-behavior-trees-for-everyone-15277" rel="nofollow">https://assetstore.unity.com/packages/tools/visual-scripting/behavior-designer-behavior-trees-for-everyone-15277</a><br> <img src="https://images2.imgbox.com/be/20/2jfGoX5E_o.png" alt="在这里插入图片描述"><br> 目前最新的版本是<code>1.7.2</code>，<br> <img src="https://images2.imgbox.com/10/2d/lM6OpGIm_o.png" alt="在这里插入图片描述"><br> 可以在官网查看每个版本的迭代内容：<br> <a href="https://opsive.com/news/category/release-notes/behavior-designer-release-notes/" rel="nofollow">https://opsive.com/news/category/release-notes/behavior-designer-release-notes/</a><br> <img src="https://images2.imgbox.com/e8/b2/zqx73bH3_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="2GitCode_15"></a>2、GitCode下载</h5> 
<p>我放了<code>1.7.1</code>版本的到<code>GitCode</code>上，地址：<a href="https://gitcode.net/linxinfa/unitybehaviordesigner" rel="nofollow">https://gitcode.net/linxinfa/unitybehaviordesigner</a><br> <img src="https://images2.imgbox.com/5f/95/pLddbhf0_o.png" alt="在这里插入图片描述"></p> 
<p>下载下来后，放入你的工程即可，<br> <img src="https://images2.imgbox.com/cf/7e/hVmnQ1mj_o.png" alt="在这里插入图片描述"></p> 
<p>其中我加了一个<code>FixGUIStyle</code>脚本，<br> <img src="https://images2.imgbox.com/f0/04/kAuyV4RG_o.png" alt="在这里插入图片描述"></p> 
<p>因为在<code>Unity</code>专业版上，打开<code>Behavior Designer</code>编辑器是这个鬼样，</p> 
<blockquote> 
 <p>注：如果你使用的是个人版，则不会有这个问题</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/2c/e8/UZfv1vdy_o.png" alt="在这里插入图片描述"></p> 
<p>它的<code>GUIStyle</code>在<code>Unity</code>专业版本有问题，插件编辑器是个<code>dll</code>文件，我们无法修改编辑器源码，<br> <img src="https://images2.imgbox.com/fb/64/3vnuh1IC_o.png" alt="在这里插入图片描述"></p> 
<p>然后我进行了反编译，找到了它的封装各种<code>GUIStyle</code>的类：<code>BehaviorDesignerUtility</code>，<br> <img src="https://images2.imgbox.com/04/00/Ud5Jm0bK_o.png" alt="在这里插入图片描述"><br> 通过反射，修改这个类的私有静态成员对象，代码如下：</p> 
<pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">UnityEngine</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">UnityEditor</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Reflection</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">BehaviorDesigner<span class="token punctuation">.</span>Editor</span><span class="token punctuation">;</span>


<span class="token comment">/// &lt;summary&gt;</span>
<span class="token comment">/// 修复BehaviorDesigner编辑器的GUIStyle问题</span>
<span class="token comment">/// &lt;/summary&gt;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FixGUIStyle</span>
<span class="token punctuation">{<!-- --></span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">MenuItem</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"Tools/Behavior Designer/修复界面GUIStyle #b"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">RuntimeInitializeOnLoadMethod</span><span class="token attribute-arguments"><span class="token punctuation">(</span>RuntimeInitializeLoadType<span class="token punctuation">.</span>BeforeSceneLoad<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ShowWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>

        <span class="token class-name"><span class="token keyword">var</span></span> guiStyle <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">GUIStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        guiStyle<span class="token punctuation">.</span>alignment <span class="token operator">=</span> TextAnchor<span class="token punctuation">.</span>UpperCenter<span class="token punctuation">;</span>
        guiStyle<span class="token punctuation">.</span>fontSize <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span>
        guiStyle<span class="token punctuation">.</span>wordWrap <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        guiStyle<span class="token punctuation">.</span>normal<span class="token punctuation">.</span>textColor <span class="token operator">=</span> Color<span class="token punctuation">.</span>white<span class="token punctuation">;</span>
        guiStyle<span class="token punctuation">.</span>active<span class="token punctuation">.</span>textColor <span class="token operator">=</span> Color<span class="token punctuation">.</span>white<span class="token punctuation">;</span>
        guiStyle<span class="token punctuation">.</span>hover<span class="token punctuation">.</span>textColor <span class="token operator">=</span> Color<span class="token punctuation">.</span>white<span class="token punctuation">;</span>
        guiStyle<span class="token punctuation">.</span>focused<span class="token punctuation">.</span>textColor <span class="token operator">=</span> Color<span class="token punctuation">.</span>white<span class="token punctuation">;</span>

        <span class="token class-name">Texture2D</span> tex2D <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Texture2D</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> TextureFormat<span class="token punctuation">.</span>RGB24<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tex2D<span class="token punctuation">.</span><span class="token function">SetPixel</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Color</span><span class="token punctuation">(</span><span class="token number">0.1f</span><span class="token punctuation">,</span> <span class="token number">0.1f</span><span class="token punctuation">,</span> <span class="token number">0.1f</span><span class="token punctuation">,</span> <span class="token number">1f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tex2D<span class="token punctuation">.</span>hideFlags <span class="token operator">=</span> HideFlags<span class="token punctuation">.</span>HideAndDontSave<span class="token punctuation">;</span>
        tex2D<span class="token punctuation">.</span><span class="token function">Apply</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        guiStyle<span class="token punctuation">.</span>normal<span class="token punctuation">.</span>background <span class="token operator">=</span> tex2D<span class="token punctuation">;</span>

        <span class="token comment">// 反射动态修改私有静态成员，修改GUIStyle</span>
        <span class="token class-name"><span class="token keyword">var</span></span> t <span class="token operator">=</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">BehaviorDesignerUtility</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">var</span></span> graphBackgroundGUIStyle <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">GetField</span><span class="token punctuation">(</span><span class="token string">"graphBackgroundGUIStyle"</span><span class="token punctuation">,</span> BindingFlags<span class="token punctuation">.</span>Static <span class="token operator">|</span> BindingFlags<span class="token punctuation">.</span>NonPublic<span class="token punctuation">)</span><span class="token punctuation">;</span>
        graphBackgroundGUIStyle<span class="token punctuation">.</span><span class="token function">SetValue</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> guiStyle<span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token class-name"><span class="token keyword">var</span></span> taskCommentGUIStyle <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">GetField</span><span class="token punctuation">(</span><span class="token string">"taskCommentGUIStyle"</span><span class="token punctuation">,</span> BindingFlags<span class="token punctuation">.</span>Static <span class="token operator">|</span> BindingFlags<span class="token punctuation">.</span>NonPublic<span class="token punctuation">)</span><span class="token punctuation">;</span>
        taskCommentGUIStyle<span class="token punctuation">.</span><span class="token function">SetValue</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> guiStyle<span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token class-name"><span class="token keyword">var</span></span> selectedBackgroundGUIStyle <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">GetField</span><span class="token punctuation">(</span><span class="token string">"selectedBackgroundGUIStyle"</span><span class="token punctuation">,</span> BindingFlags<span class="token punctuation">.</span>Static <span class="token operator">|</span> BindingFlags<span class="token punctuation">.</span>NonPublic<span class="token punctuation">)</span><span class="token punctuation">;</span>
        selectedBackgroundGUIStyle<span class="token punctuation">.</span><span class="token function">SetValue</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> guiStyle<span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token class-name"><span class="token keyword">var</span></span> preferencesPaneGUIStyle <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">GetField</span><span class="token punctuation">(</span><span class="token string">"preferencesPaneGUIStyle"</span><span class="token punctuation">,</span> BindingFlags<span class="token punctuation">.</span>Static <span class="token operator">|</span> BindingFlags<span class="token punctuation">.</span>NonPublic<span class="token punctuation">)</span><span class="token punctuation">;</span>
        preferencesPaneGUIStyle<span class="token punctuation">.</span><span class="token function">SetValue</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> guiStyle<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>点击菜单<code>Tools/Behavior Designer/修复界面GUIStyle</code>，或者按一下<code>Shift+B</code>快捷键，即可修复<code>GUIStyle</code>问题，</p> 
<p><img src="https://images2.imgbox.com/89/3f/pSysXWB1_o.png" alt="在这里插入图片描述"></p> 
<p>效果如下<br> <img src="https://images2.imgbox.com/06/e4/XHhdxrHb_o.gif" alt="请添加图片描述"></p> 
<h4><a id="_101"></a>三、官方教程</h4> 
<p>学习插件的时候，建议先看下官方文档。</p> 
<h5><a id="1_103"></a>1、在线文档</h5> 
<p>官方在线文档： <a href="https://opsive.com/support/documentation/behavior-designer/overview/" rel="nofollow">https://opsive.com/support/documentation/behavior-designer/overview/</a><br> <img src="https://images2.imgbox.com/e2/4b/mqJNvUdo_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="2_106"></a>2、离线文档</h5> 
<p>插件的<code>Behavior Designer</code>目录中有个<code>Documentation.pdf</code>文档，不过可能很多同学都没去看这份文档，建议还是看一看，<br> <img src="https://images2.imgbox.com/a2/e0/pcE1E7Ix_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_110"></a>四、插件界面</h4> 
<h5><a id="1_111"></a>1、打开编辑器</h5> 
<p>点击菜单<code>Tools/Behavior Designer/Editor</code>即可打开编辑器窗口，<br> <img src="https://images2.imgbox.com/d7/cd/2xvAMtw8_o.png" alt="在这里插入图片描述"></p> 
<p>如下<br> <img src="https://images2.imgbox.com/db/57/2POZUpOI_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="2_120"></a>2、界面介绍</h5> 
<p>界面可以划分为<code>3</code>个区域，如下<br> <img src="https://images2.imgbox.com/f6/b2/JRlLBoqo_o.png" alt="在这里插入图片描述"></p> 
<p>第<code>1</code>个区域是行为树的组织区域，我们的行为树节点就是在这个区域上进行连线的；<br> <img src="https://images2.imgbox.com/76/3b/S3Fa4txz_o.png" alt="在这里插入图片描述"></p> 
<p>第<code>2</code>个区域顶部是四个标签页：<code>Behavior</code>、<code>Tasks</code>、<code>Variables</code>、<code>Inspector</code>，默认是<code>Tasks</code>标签页，显示的是节点列表；<br> <img src="https://images2.imgbox.com/21/1e/wsLeyYiT_o.png" alt="在这里插入图片描述"></p> 
<table><thead><tr><th align="left">标签页</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">Behavior</td><td align="left">对整个行为树的设置，比如行为树名称、是否激活时立即执行、执行完毕后是否重新执行等设置</td></tr><tr><td align="left">Tasks</td><td align="left">任务节点列表，比如Composities（符合节点）、Decorators（装饰节点）、Actions（行为节点）等等</td></tr><tr><td align="left">Variables</td><td align="left">行为树变量，可以设置全局变量，也可以设置行为树自身的变量</td></tr><tr><td align="left">Inspector</td><td align="left">查看节点详细信息，设置节点参数</td></tr></tbody></table> 
<p>第<code>3</code>个区域按钮功能如下<br> <img src="https://images2.imgbox.com/e9/1d/GivdwNvu_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/12/50/Av3gLVGw_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_153"></a>五、快速制作一棵行为树</h4> 
<p>在讲解节点之前，我先演示一遍如何快速制作一棵行为树，让大家对整个流程有个概念。</p> 
<h5><a id="1_156"></a>1、创建物体</h5> 
<p>首先在场景中创建一个物体，可以是任何物体，比如你想控制角色，那么这个物体就可以是你的角色模型，这里我创建一个空物体，<br> <img src="https://images2.imgbox.com/6f/f3/Yeh9eh8I_o.png" alt="在这里插入图片描述"></p> 
<p>重命名为<code>BehaviorTreeObj</code>，<br> <img src="https://images2.imgbox.com/68/92/uW8NaqFr_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="2BehaviorTree_163"></a>2、挂BehaviorTree脚本</h5> 
<p>打开<code>Behavior Designer</code>编辑器，先选中刚刚的<code>BehaviorTreeObj</code>物体，然后在编辑器网格空白处右键鼠标，点击菜单<code>Add Behavior Tree</code>，<br> <img src="https://images2.imgbox.com/2a/99/yVbPyWL6_o.gif" alt="请添加图片描述"></p> 
<p>这一步其实就是给物体挂上<code>BehaviorTree</code>组件，我们也可以通过<code>Add Component</code>手动添加<code>BehaviorTree</code>组件，<br> <img src="https://images2.imgbox.com/65/c8/tIKcQAU2_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="3Task_174"></a>3、添加Task节点</h5> 
<p>我以最简单的<code>Log</code>节点为例，它的功能就是输出日志，在空白处点击鼠标左键，按键盘的<code>空格键</code>即可弹出节点搜索框，搜索<code>log</code>，可以看到<code>Log</code>节点，点击即可创建出<code>Log</code>任务节点，它会自动帮我添加一个<code>Entry</code>入口节点，<code>Entry</code>连向<code>Log</code>，如下<br> <img src="https://images2.imgbox.com/6e/ce/Fh5p8s1V_o.gif" alt="请添加图片描述"></p> 
<p>我们给<code>Log</code>节点设置<code>Text</code>字段的值为<code>Hello World</code>，并添加注释，如下<br> <img src="https://images2.imgbox.com/19/7e/IEOt9w1W_o.gif" alt="请添加图片描述"></p> 
<h5><a id="4_185"></a>4、运行测试</h5> 
<p>运行<code>Unity</code>，可以看到<code>Log</code>节点被执行了，显示了一个绿色的勾，日志窗口也输出了<code>HelloWorld</code>，<br> <img src="https://images2.imgbox.com/d4/e1/2CoxEkWl_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="5BehaviorTree_190"></a>5、导出BehaviorTree</h5> 
<p>点击<code>Export</code>按钮，将行为树导出保存为资源文件，<br> <img src="https://images2.imgbox.com/b8/9d/NXm5n32c_o.png" alt="在这里插入图片描述"></p> 
<p>如下，这样子就可以复用行为树资源了，<br> <img src="https://images2.imgbox.com/d4/bc/RD7Mcc86_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="6BehaviorTree_199"></a>6、手动引用BehaviorTree树资源</h5> 
<h6><a id="61External_Behavior_200"></a>6.1、设置External Behavior</h6> 
<p>我们把上面导出的行为树资源赋值给<code>BehaviorTree</code>组件的<code>External Behavior</code>成员，如下<br> <img src="https://images2.imgbox.com/3b/63/bvTMLxRq_o.png" alt="在这里插入图片描述"><br> 运行时，就会根据这个<code>External Behavior</code>的行为树来执行了。</p> 
<h6><a id="62Behavior_Tree_Reference_205"></a>6.2、使用Behavior Tree Reference</h6> 
<p>另外，我们还可以通过<code>Behavior Tree Reference</code>节点来引用行为树资源，<br> 先创建一个<code>Behavior Tree Reference</code>节点，点击<code>Inspector</code>，设置它引用的外部行为树资源即可，<br> <img src="https://images2.imgbox.com/03/60/3guOe34B_o.png" alt="在这里插入图片描述"></p> 
<p>一般我们会做一个通用的行为树保存为资源文件，然后对特殊的怪物另外做行为树，并让其引用通用行为树资源，像这样子<br> <img src="https://images2.imgbox.com/db/4c/jOtxuPcs_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="7External_Behavior_220"></a>7、动态加载行为树资源并设置External Behavior</h5> 
<p>我们也可以通过代码动态设置<code>External Behavior</code>，我这里使用<code>Addressables</code>插件来做资源加载，</p> 
<blockquote> 
 <p>注：关于<code>Addressables</code>的使用，可以参见我之前写的这篇文章：<a href="https://linxinfa.blog.csdn.net/article/details/122390621" rel="nofollow">【游戏开发探究】Unity Addressables资源管理方式用起来太爽了，资源打包、加载、热更变得如此轻松（Addressable Asset System | 简称AA）</a></p> 
</blockquote> 
<p>首先给行为树资源文件添加<code>Addressable</code>管理，分配到一个<code>Addressable</code>索引名，如下</p> 
<blockquote> 
 <p>注：勾上Addressable就会自动分配一个索引名了</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/cb/7e/kmndZuoe_o.png" alt="在这里插入图片描述"></p> 
<p>接着我们可以使用代码加载行为树资源，动态赋值给<code>BehaviorTree</code>组件的<code>ExternalBehavior </code>对象，<br> 创建一个<code>AddBehaviorTree.cs</code>脚本，<br> <img src="https://images2.imgbox.com/0e/11/8AM93l1s_o.png" alt="在这里插入图片描述"></p> 
<p>代码如下</p> 
<pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">UnityEngine</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">BehaviorDesigner<span class="token punctuation">.</span>Runtime</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">UnityEngine<span class="token punctuation">.</span>AddressableAssets</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AddBehaviorTree</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MonoBehaviour</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token return-type class-name">IEnumerator</span> <span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 初始化Addressables</span>
        <span class="token keyword">yield</span> <span class="token keyword">return</span> Addressables<span class="token punctuation">.</span><span class="token function">InitializeAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 添加BehaviorTree</span>
        <span class="token class-name"><span class="token keyword">var</span></span> bt <span class="token operator">=</span> gameObject<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>BehaviorTree<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置不立即执行</span>
        bt<span class="token punctuation">.</span>StartWhenEnabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token comment">// 加载行为树资源</span>
        <span class="token class-name"><span class="token keyword">var</span></span> loader <span class="token operator">=</span> Addressables<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">LoadAssetAsync</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ExternalBehaviorTree<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">"Assets/BtRes/Behavior.asset"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">yield</span> <span class="token keyword">return</span> loader<span class="token punctuation">;</span>
        <span class="token comment">// 设置ExternalBehavior</span>
        bt<span class="token punctuation">.</span>ExternalBehavior <span class="token operator">=</span> loader<span class="token punctuation">.</span>Result<span class="token punctuation">;</span>
        <span class="token comment">// 执行行为树</span>
        bt<span class="token punctuation">.</span><span class="token function">EnableBehavior</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>我们创建一个空物体，重命名<code>BtObj</code>，并给它挂上<code>AddBehaviorTree</code>脚本，如下<br> <img src="https://images2.imgbox.com/8d/c9/BSB3JTZo_o.png" alt="在这里插入图片描述"></p> 
<p>我们运行<code>Unity</code>，可以看到<code>BtObj</code>物体动态挂了<code>BehaviorTree</code>组件，并且动态设置了<code>ExternalBehavior</code>对象，行为树也被执行了，输出了<code>Hello World</code>，如下<br> <img src="https://images2.imgbox.com/09/17/FgupohvY_o.png" alt="在这里插入图片描述"></p> 
<p>我们可以点击<code>BehaviorTree</code>组件上的<code>Open</code>按钮，<br> <img src="https://images2.imgbox.com/28/23/9xTV3krj_o.png" alt="在这里插入图片描述"></p> 
<p>可以看到行为树已经执行完毕，<br> <img src="https://images2.imgbox.com/53/9a/3mhw0tRU_o.png" alt="在这里插入图片描述"></p> 
<p>如果我们想让行为树执行完毕后重复执行，可以设置<code>RestartWhenComplete</code>为<code>true</code>，<br> <img src="https://images2.imgbox.com/af/78/NQ6ljH1W_o.png" alt="在这里插入图片描述"></p> 
<p>我们串一个<code>Wait</code>节点，方便观察，<br> <img src="https://images2.imgbox.com/1f/60/MdapJKbr_o.png" alt="在这里插入图片描述"></p> 
<p>执行效果如下，可以看到行为树可以重复执行了，<br> <img src="https://images2.imgbox.com/c6/0a/oxHJsmot_o.gif" alt="请添加图片描述"></p> 
<p>上面我们用到了<mark>Squence</mark>顺序节点，它是一个复合节点，下文我会进行节点的详细介绍。</p> 
<h4><a id="Composities_288"></a>六、复合节点：Composities</h4> 
<p>行为树任务节点中最重要的节点就是<mark>复合节点</mark>了，它决定了行为树的执行流，也就是<code>Tasks</code>列表中<code>Composities</code>分组的这些节点，<br> <img src="https://images2.imgbox.com/25/3a/SL63KSHh_o.png" alt="在这里插入图片描述"><br> 我先简单做个日常生活的行为树给大家看看，如下<br> <img src="https://images2.imgbox.com/78/34/c6K6Knjh_o.png" alt="在这里插入图片描述"></p> 
<p>上面的行为树的执行过程是怎么样的呢？想要搞清楚就得先知道行为树的执行顺序：<mark>从左到右，并且深度优先</mark>。<br> 另外，复合节点又控制着子节点的执行规则，是顺序执行还是并行执行，亦或者随机执行，是遇到成功就立即返回成功还是遇到失败就立即返回失败，亦或者遇到成功继续执行下一个，或者遇到失败继续执行下一个呢？<br> 这些都是复合节点来控制的，这里头的逻辑需要大家好好琢磨，下面我带大家挨个过一遍复合节点，讲解过程中我会穿插顺带讲解一下用到的其他任务节点，并举一些实际的应用场景，方便大家学以致用，也希望大家能够触类旁通。</p> 
<h5><a id="1Sequence_297"></a>1、Sequence：顺序节点</h5> 
<h6><a id="11_298"></a>1.1、节点介绍</h6> 
<p><img src="https://images2.imgbox.com/d9/8f/Q2XpIg7V_o.png" alt="在这里插入图片描述"></p> 
<p>顾名思义，顺序节点就是从左到右挨个顺序执行，当所有子节点都返回<code>Success</code>时，它才返回<code>Success</code>，<br> <img src="https://images2.imgbox.com/85/6d/PtoXbG3f_o.gif" alt="请添加图片描述"></p> 
<p>当某个子节点返回<code>Failure</code>时，顺序节点就会立刻返回<code>Failure</code>，<br> <img src="https://images2.imgbox.com/df/19/XRMmbxkt_o.gif" alt="请添加图片描述"></p> 
<h6><a id="12_310"></a>1.2、新发口诀</h6> 
<p>顺序节点，从左到右，为真继续，全真才真，一假即假，一假即停。<br> 类似于<code>与</code>逻辑。</p> 
<h6><a id="131_314"></a>1.3、案例1：通知开饭了</h6> 
<p>我们使用<code>Has Received Event</code>来监听开饭的事件，当它检测收到事件时才会返回<code>Success</code>，此时顺序节点就会去执行下一个子节点，即干饭的逻辑，达到响应事件的功能，如下<img src="https://images2.imgbox.com/0c/42/qGTqkhbe_o.png" alt="在这里插入图片描述"></p> 
<p>其中<code>Has Received Event</code>节点要设置监听的事件名称，定义一个字符串即可，<br> <img src="https://images2.imgbox.com/fa/71/H3rqQOqN_o.png" alt="在这里插入图片描述"></p> 
<p>抛出事件有两种方式，一种是代码调用行为树的<code>SendEvent</code>接口，如下</p> 
<pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SendEvent</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token generic-method"><span class="token function">SendEvent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name">T</span> arg1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token generic-method"><span class="token function">SendEvent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> U<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name">T</span> arg1<span class="token punctuation">,</span> <span class="token class-name">U</span> arg2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token generic-method"><span class="token function">SendEvent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> U<span class="token punctuation">,</span> V<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name">T</span> arg1<span class="token punctuation">,</span> <span class="token class-name">U</span> arg2<span class="token punctuation">,</span> <span class="token class-name">V</span> arg3<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>示例：</p> 
<pre><code class="prism language-csharp"><span class="token comment">// bt是BehaviorTree对象</span>
bt<span class="token punctuation">.</span><span class="token function">SendEvent</span><span class="token punctuation">(</span><span class="token string">"EAT_EVENT"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>另外一种是使用<code>SendEvent</code>节点，<br> <img src="https://images2.imgbox.com/98/29/WiZv4O1m_o.png" alt="在这里插入图片描述"><br> 设置要发送的事件名称即可，<br> <img src="https://images2.imgbox.com/99/6d/zVMHCWeI_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="142_342"></a>1.4、案例2：吃几口饭吃一口菜</h6> 
<p>想象一下你吃饭的过程，扒拉吃几口饭，然后吃一口菜，我们可以用顺序节点来组织，<br> <img src="https://images2.imgbox.com/c5/da/t0mtGIQq_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="2Parallel_348"></a>2、Parallel：并行节点</h5> 
<h6><a id="21_349"></a>2.1、节点介绍</h6> 
<p><img src="https://images2.imgbox.com/3d/a6/Ks0ngmAx_o.png" alt="在这里插入图片描述"></p> 
<p>并行节点，顾名思义，它会并行执行所有的子节点，所有的子节点都返回<code>Success</code>，并行节点才会返回<code>Success</code>，<br> <img src="https://images2.imgbox.com/6b/1f/Q3JsyCPc_o.gif" alt="请添加图片描述"><br> 只要有一个子节点返回<code>Failure</code>，并行节点就会立刻返回<code>Failure</code>。如下图，我们可以看到，等<code>10</code>秒和等<code>20</code>秒的两个节点还没执行完就被停止了，因为中间那个等<code>1</code>秒的节点执行完毕并返回了<code>Failure</code>给并行节点，整个并行以<code>Failure</code>结束，那些被终止的<code>Wait</code>也会直接返回<code>Failure</code>，<br> <img src="https://images2.imgbox.com/53/04/W8YbA1eo_o.gif" alt="请添加图片描述"></p> 
<h6><a id="22_356"></a>2.2、新发口诀</h6> 
<p>并行节点，并行执行，全真才真，一假即假，一假即停，被停即假。</p> 
<h6><a id="23_359"></a>2.3、案例：边跑步边听歌</h6> 
<p>比如我们边跑步边听歌，同时还要监听是否有下雨，有下雨的话要中断跑步，如下<br> <img src="https://images2.imgbox.com/0b/ee/EPmMFYJ5_o.png" alt="在这里插入图片描述"><br> 这个例子我用到了<code>Selector</code>节点，并且启用了<code>Self</code>中断，看不懂的同学不要着急，下文我会讲。</p> 
<h5><a id="3Selector_368"></a>3、Selector：选择节点</h5> 
<h6><a id="31_370"></a>3.1、节点介绍</h6> 
<p><img src="https://images2.imgbox.com/3e/6c/mlVb2NAa_o.png" alt="在这里插入图片描述"><br> 选择节点与顺序节点类似，也是从左到右执行，不同的是，当有子节点返回<code>Success</code>，选择节点就会立刻返回<code>Success</code>，<mark>不会</mark>执行下一个子节点</p> 
<p><img src="https://images2.imgbox.com/e0/04/LVCMVLql_o.gif" alt="请添加图片描述"></p> 
<p>如果子节点返回<code>Failure</code>，会就执行下一个子节点，其实很好理解，就是从左到右遍历选一个<code>Success</code>，有<code>Success</code>就返回<code>Success</code>，否则执行下一个子节点，</p> 
<p><img src="https://images2.imgbox.com/48/49/ptrUzUSv_o.gif" alt="请添加图片描述"><br> 如果所有子节点都返回<code>Failure</code>，选择节点才返回<code>Failure</code>，<br> <img src="https://images2.imgbox.com/db/ce/1YEOrOeM_o.gif" alt="请添加图片描述"></p> 
<h6><a id="32_388"></a>3.2、新发口诀</h6> 
<p>选择节点，从左到右，一真即真，一真即停，全假才假。</p> 
<h6><a id="33_390"></a>3.3、案例：诈骗举报概率</h6> 
<p>比如收到诈骗短信后，有<code>99%</code>的概率会执行举报，有<code>1%</code>的概率会上当受骗，如下<br> <img src="https://images2.imgbox.com/0d/d0/mmS0LRKW_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="4Parallel_Selector_399"></a>4、Parallel Selector：并行选择节点</h5> 
<h6><a id="41_400"></a>4.1、节点介绍</h6> 
<p><img src="https://images2.imgbox.com/15/a2/LR61Hz6a_o.png" alt="在这里插入图片描述"></p> 
<p>顾名思义，就是并行执行选择节点，有一个<code>Success</code>就立即返回<code>Success</code>，并且会终止其他子节点，被终止的子节点会返回<code>Failure</code>，如下<br> <img src="https://images2.imgbox.com/0c/88/alei4DSN_o.gif" alt="请添加图片描述"></p> 
<p>所有子节点都返回<code>Failure</code>时，并行选择节点才返回<code>Failure</code>，</p> 
<p><img src="https://images2.imgbox.com/f9/24/a7dbOCYx_o.gif" alt="请添加图片描述"></p> 
<h6><a id="42_409"></a>4.2、新发口诀</h6> 
<p>并行选择节点，并行执行，一真即真，一真即停，全假才假。</p> 
<h6><a id="43_411"></a>4.3、案例：考研和找工作</h6> 
<p>现在人生道路有两条路：考研、找工作，同时进行，其中一件事情成了，就吃一顿好的庆祝一下，如下<br> <img src="https://images2.imgbox.com/22/4e/bnA1YACr_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="5Priority_Selector_420"></a>5、Priority Selector：优先级选择节点</h5> 
<h6><a id="51_421"></a>5.1、节点介绍</h6> 
<p><img src="https://images2.imgbox.com/2b/be/dB1X1xPM_o.png" alt="在这里插入图片描述"></p> 
<p>这个节点和<code>Selector</code>类似，<code>Selector</code>的执行顺序是从左到右，而<code>Priority Selector</code>会先检查子节点的优先级（<code>priority</code>）进行排序，优先级高的优先执行。<br> 问题来了，我们如何设置子节点的<mark>优先级</mark>呢？节点的优先级默认是<code>0</code>，如果要修改优先级，需要重写<code>Task</code>的<code>GetPriority</code>方法，<br> <img src="https://images2.imgbox.com/cc/99/8Kno8ViH_o.png" alt="在这里插入图片描述"><br> 这里我封装一个带优先级参数的日志节点吧：<code>PriorityLog</code>，创建一个<code>PriorityLog</code>脚本，代码如下</p> 
<pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">UnityEngine</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">BehaviorDesigner<span class="token punctuation">.</span>Runtime<span class="token punctuation">.</span>Tasks</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">TaskDescription</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"带优先级参数的日志节点"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">TaskIcon</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"{SkinColor}LogIcon.png"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PriorityLog</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Action</span></span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Tooltip</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"Text to output to the log"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token class-name">SharedString</span> text<span class="token punctuation">;</span>
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Tooltip</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"Is this text an error?"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token class-name">SharedBool</span> logError<span class="token punctuation">;</span>
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Tooltip</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"Should the time be included in the log message?"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token class-name">SharedBool</span> logTime<span class="token punctuation">;</span>

        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Tooltip</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"优先级"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token class-name">SharedFloat</span> priority<span class="token punctuation">;</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 重写获取优先级的方法</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">float</span></span> <span class="token function">GetPriority</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> priority<span class="token punctuation">.</span>Value<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name">TaskStatus</span> <span class="token function">OnUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// Log the text and return success</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>logError<span class="token punctuation">.</span>Value<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                Debug<span class="token punctuation">.</span><span class="token function">LogError</span><span class="token punctuation">(</span><span class="token return-type class-name">logTime<span class="token punctuation">.</span>Value <span class="token punctuation">?</span></span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"{0}: {1}"</span><span class="token punctuation">,</span> Time<span class="token punctuation">.</span>time<span class="token punctuation">,</span> text<span class="token punctuation">)</span> <span class="token punctuation">:</span> text<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                Debug<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span><span class="token return-type class-name">logTime<span class="token punctuation">.</span>Value <span class="token punctuation">?</span></span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"{0}: {1}"</span><span class="token punctuation">,</span>Time<span class="token punctuation">.</span>time<span class="token punctuation">,</span> text<span class="token punctuation">)</span> <span class="token punctuation">:</span> text<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> TaskStatus<span class="token punctuation">.</span>Success<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnReset</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// Reset the properties back to their original values</span>
            text <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
            logError <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            logTime <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>现在我们就可以在<code>Tasks</code>列表中看到我们新封装的<code>PriorityLog</code>节点了，<br> <img src="https://images2.imgbox.com/67/8b/07bOL4ln_o.png" alt="在这里插入图片描述"><br> 使用它连个简单的行为树，如下<br> <img src="https://images2.imgbox.com/9f/bf/kuOQ0nnG_o.png" alt="在这里插入图片描述"><br> 我们可以选中节点，在<code>Inspector</code>中设置节点的<code>Priority</code>，<br> <img src="https://images2.imgbox.com/fb/c6/KuaCfT1m_o.png" alt="在这里插入图片描述"><br> 由于右边的节点优先级我们设置为了<code>1</code>，比左边的节点优先级高，所以会优先执行右边的节点，因为右边的节点执行返回了<code>Success</code>，此时<code>Priority Selector</code>就会直接返回<code>Success</code>，不会去执行左边的节点了，如下<br> <img src="https://images2.imgbox.com/d9/cb/NcNK71ja_o.gif" alt="请添加图片描述"></p> 
<h6><a id="52_485"></a>5.2、新发口诀</h6> 
<p>优先级选择节点，优先级排序，一真即真，一真即停，全假才假。</p> 
<h6><a id="53_488"></a>5.3、案例：先吵架还是先道歉</h6> 
<p>我先给行为树创建一<code>Foat</code>类型的变量：<code>SorryPriority</code>，如下<br> <img src="https://images2.imgbox.com/3c/ff/DzrSptyl_o.png" alt="在这里插入图片描述"><br> 以它作为道歉优先级变量，<br> <img src="https://images2.imgbox.com/08/92/9MUyIg5H_o.png" alt="在这里插入图片描述"><br> 接着制作如下的行为树，当按下<code>A</code>键的时候，设置<code>SorryPriority</code>变量，提高道歉的优先级，<br> <img src="https://images2.imgbox.com/37/f9/778wfKPO_o.png" alt="在这里插入图片描述"><br> 其中<code>Set Shared Float</code>节点的设置如下，让它去修改<code>SorryPriority</code>变量为<code>1</code>，</p> 
<p><img src="https://images2.imgbox.com/12/d4/UIVQqQNI_o.gif" alt="请添加图片描述"><br> 道歉节点的<code>Priority</code>参数设置为<code>SorryPriority</code>变量，如下<br> <img src="https://images2.imgbox.com/95/6c/OJ7soC5b_o.gif" alt="请添加图片描述"><br> 我们运行，如果我没有按下<code>A</code>键，则道歉优先级是<code>0</code>，<code>2</code>秒情绪酝酿完毕后，会默认先执行吵架，</p> 
<p><img src="https://images2.imgbox.com/7d/fa/nt4Xz9Ri_o.gif" alt="请添加图片描述"><br> 如果我在<code>2</code>秒情绪酝酿期间按下了<code>A</code>键，则会设置道歉优先级变量为<code>1</code>，情绪酝酿完毕后就会优先执行道歉，就不会吵架了，<br> <img src="https://images2.imgbox.com/ea/85/DIrS2Jqq_o.gif" alt="请添加图片描述"></p> 
<h5><a id="6Random_Selector_508"></a>6、Random Selector：随机选择节点</h5> 
<h6><a id="61_509"></a>6.1、节点介绍</h6> 
<p><img src="https://images2.imgbox.com/13/2e/C132PSOR_o.png" alt="在这里插入图片描述"></p> 
<p>这个很好理解，按选择节点的规则，只是不是从左到右执行，而是随机顺序执行。<br> 如果有子节点返回<code>Success</code>，则立即返回<code>Success</code>，否则继续执行下一个节点，</p> 
<p><img src="https://images2.imgbox.com/11/07/Q9dVOXIr_o.gif" alt="请添加图片描述"><br> 只有所有的子节点都返回<code>Failure</code>时，<code>Random Selector</code>才返回<code>Failure</code>，</p> 
<p><img src="https://images2.imgbox.com/0c/ae/31QJHNF1_o.gif" alt="请添加图片描述"></p> 
<h6><a id="62_519"></a>6.2、新发口诀</h6> 
<p>随机选择节点，随机执行，一真即真，一真即停，全假才假。</p> 
<h6><a id="63_522"></a>6.3、案例：吃米饭、面条、饺子</h6> 
<p>中午吃什么好呢？随机选一个吧，好的，吃面条~<br> <img src="https://images2.imgbox.com/9e/4a/45pqwi9z_o.gif" alt="请添加图片描述"></p> 
<h5><a id="7Random_Sequence_529"></a>7、Random Sequence：随机顺序节点</h5> 
<h6><a id="71_530"></a>7.1、节点介绍</h6> 
<p><img src="https://images2.imgbox.com/ac/8b/8hUojsRT_o.png" alt="在这里插入图片描述"></p> 
<p>这个也很好理解，就是顺序节点的规则，但不是从左到右执行，而是随机顺序执行。</p> 
<p>当所有子节点都返回<code>Success</code>时，它才返回<code>Success</code>，<br> <img src="https://images2.imgbox.com/c1/38/PLKt1dID_o.gif" alt="请添加图片描述"></p> 
<p>当某个子节点返回<code>Failure</code>时，顺序节点就会立刻返回<code>Failure</code>，<br> <img src="https://images2.imgbox.com/77/a3/x7e4qpsq_o.gif" alt="请添加图片描述"></p> 
<h6><a id="72_541"></a>7.2、新发口诀</h6> 
<p>随机顺序节点，随机顺序，为真继续，全真才真，一假即假，一假即停。</p> 
<h6><a id="73_543"></a>7.3、案例：番茄炒蛋</h6> 
<p>我现在要做一道番茄炒蛋，有的人先炒番茄，有的人先炒鸡蛋，这里我们就可以使用随机顺序节点了，如果炒鸡蛋或者炒番茄失败，那么我们就吃不到番茄炒蛋了，只有两个都成功了，才能吃到番茄炒蛋，<br> <img src="https://images2.imgbox.com/1e/8b/TYGicQQe_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="8Parallel_Complete_546"></a>8、Parallel Complete：并行竞争节点</h5> 
<h6><a id="81_547"></a>8.1、节点介绍</h6> 
<p><img src="https://images2.imgbox.com/66/44/0yCouNtB_o.png" alt="在这里插入图片描述"><br> 这个节点其实就是并行执行所有的子节点，只要有一个子节点返回了结果，它就结束，并以这个子节点的结果为结果，<br> <img src="https://images2.imgbox.com/49/0f/H717T1Nq_o.gif" alt="请添加图片描述"><br> <img src="https://images2.imgbox.com/b1/ab/29nEVKY6_o.gif" alt="请添加图片描述"></p> 
<h6><a id="82_552"></a>8.2、新发口诀</h6> 
<p>并行竞争节点，并行执行，最速之子，以子为果。</p> 
<h5><a id="9Selector_Evaluator_555"></a>9、Selector Evaluator：评估选择节点</h5> 
<h6><a id="91_556"></a>9.1、节点介绍</h6> 
<p><img src="https://images2.imgbox.com/42/bf/OxItdYtH_o.png" alt="在这里插入图片描述"><br> 这个节点不是很好理解，它的逻辑是这样的，从左到右顺序执行，如果遇到子节点返回<code>Success</code>，则立即结束，并返回<code>Success</code>，否则继续执行下一个子节点。</p> 
<p><img src="https://images2.imgbox.com/a7/85/gBw5Mf1a_o.gif" alt="请添加图片描述"><br> <img src="https://images2.imgbox.com/22/8e/ykZXcHf0_o.gif" alt="请添加图片描述"><br> 有同学会问了，那它与<code>Selector</code>节点有啥区别？<br> 上面我用的是<code>Log</code>节点，会立即返回结果，如果是用<code>Wait</code>节点，则会有<code>Running</code>状态，这个<code>Selector Evaluator</code>节点是个固执的强迫症节点，它认为子节点应该给它返回<code>Success</code>，如果子节点返回了<code>Failure</code>，它会硬着头皮执行下一子节点，但是，一旦下一个子节点处于<code>Running</code>状态，它就会像个渣男一样毫不犹豫地打断并返回第一个子节点，重新执行，只要有机会它就想要一个<code>Success</code>结果，如果后续的子节点都是立即返回成功或失败，而没有<code>Running</code>状态，则它会接受后续子节点的<code>Success</code>，也就是说，它也不是非得第一个子节点不娶，后面的子节点只要立刻<code>Success</code>，它就不打断去重新找第一个子节点了，相当地渣男啊！</p> 
<p>看，第二任只要考虑一下（<code>Running</code>状态），它就会立即打断回去执行初恋，<br> <img src="https://images2.imgbox.com/26/8c/UAI04YO3_o.gif" alt="请添加图片描述"><br> 如果第二任立即答应了，它就会接受第二任的结果，<br> <img src="https://images2.imgbox.com/90/48/lLWrMRuF_o.gif" alt="请添加图片描述"><br> 如果第二任直接给个<code>Failure</code>，那么这个渣男会去骚扰路人甲，如果路人甲给它<code>Success</code>，它就会爱上路人甲，</p> 
<p><img src="https://images2.imgbox.com/f1/ac/xMQPxm0z_o.gif" alt="请添加图片描述"><br> 如果路人甲立即给它<code>Failure</code>，这个渣男才会死心，<br> <img src="https://images2.imgbox.com/9b/a7/odPBubVu_o.gif" alt="请添加图片描述"></p> 
<h6><a id="92_575"></a>9.2、新发口诀</h6> 
<p>评估选择节点，渣男一个，从左到右，遇真即真，遇假继续，<code>Runing</code>时机打断，从头来过。</p> 
<h4><a id="_579"></a>七、中断</h4> 
<p>复合节点有中断的权利，我们可以选中某个复合节点，然后点击<code>Inspector</code>，设置它的中断模式，<br> <img src="https://images2.imgbox.com/94/4b/8Xjrh3gh_o.png" alt="在这里插入图片描述"><br> 默认为<code>None</code>，即无中断，另外三个中断模式，下文我会挨个进行演示。<br> 这里我先解释一下什么是中断，比如你正在睡觉，突然地震了，这个时候睡觉就要被中断，执行逃跑的逻辑，命要紧。<br> 复合节点的中断控制是由谁来调度的呢？细心的同学应该会发现，执行行为树的时候，会自动创建一个<code>Behavior Manager</code>对象，上面挂着<code>BehaviorManager</code>脚本，我们的行为树的执行都是由这个<code>BehaviorManager</code>来调度的，它就是最高司令，<br> <img src="https://images2.imgbox.com/5b/93/nXWi0xRY_o.png" alt="在这里插入图片描述"><br> 感兴趣的同学可以反编译<code>BehaviorDesigner.Runtime.dll</code>，查看<code>BehaviorManager</code>的源码，<br> <img src="https://images2.imgbox.com/58/01/WgZDkLZs_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="1Self_590"></a>1、Self中断：老妈喊你回家吃饭</h5> 
<p>一个复合节点下可以有多个子节点，假设现在有两个子节点，假设此时正在执行第二个子节点（<code>Running</code>状态），突然来了一个事件，需要中断第二个子节点，立即执行第一个子节点，这里就可以使用<code>Self</code>中断，<code>Self</code>其实是站在复合节点的角度的，就是中断复合节点自己。</p> 
<p>假设你去朋友家打游戏，你决定打完游戏就回家，如果打游戏过程中，老妈打电话喊你回家吃饭，那么就中断打游戏，回家。</p> 
<p>行为树如下<br> <img src="https://images2.imgbox.com/b7/a5/N1yuBEXE_o.png" alt="在这里插入图片描述"></p> 
<p>没有按下<code>A</code>键的执行效果如下，打完游戏开开心心回家，</p> 
<p><img src="https://images2.imgbox.com/96/6a/DzrqoEYr_o.gif" alt="请添加图片描述"><br> 打游戏过程中，按下<code>A</code>键，中断打游戏，回家，<br> <img src="https://images2.imgbox.com/b9/ff/6KEgkeO4_o.gif" alt="请添加图片描述"></p> 
<h5><a id="2Lower_Priority_606"></a>2、Lower Priority中断：睡觉时地震</h5> 
<p>我们以睡觉的时候发生地震为例，演示一下<code>Lower Priority</code>中断。<br> 睡觉的时候如果发生地震，需要中断睡觉，执行逃命逻辑。<br> 如下，睡觉节点与<mark>Sequence</mark>节点是平级关系，并且睡觉节点在右边，属于低优先级，当正在执行睡觉节点时，左边的<mark>Sequence</mark>节点想要中断右边的睡觉节点，设置<code>Lower Priority</code>中断即可，<br> <img src="https://images2.imgbox.com/97/53/AtJe4TLR_o.gif" alt="请添加图片描述"><br> 我们从中断的图标也可以看出，它指向右边，表示中断右边的节点的意思，<br> <img src="https://images2.imgbox.com/2d/8c/Bxs4TH1l_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="3Both_616"></a>3、Both中断：两者都中断</h5> 
<p><code>Both</code>中断其实就是<code>Self</code>和<code>Lower Priority</code>都中断。如下<br> <img src="https://images2.imgbox.com/3c/4a/pSyXQMfr_o.gif" alt="请添加图片描述"></p> 
<h4><a id="Variables_620"></a>八、Variables：行为树成员变量</h4> 
<p>我们点击<code>Variables</code>，可以给行为树添加成员变量，也可以查看已添加的成员变量，<br> <img src="https://images2.imgbox.com/29/9f/aYOA7igy_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="1_624"></a>1、添加变量</h5> 
<p>先起一个变量名，然后选择变量的数据类型，我们也可以添加自定义的数据类型，需要进行变量类型拓展，下文会讲解拓展变量类型的步骤，这里我们先选一个<code>String</code>好了，最后点击<code>Add</code>按钮即可，<br> <img src="https://images2.imgbox.com/c4/a2/q77GAIRn_o.png" alt="在这里插入图片描述"><br> 我们可以修改变量名，给变量设置初始值，如下<br> <img src="https://images2.imgbox.com/eb/80/EmqrPwS9_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="2_629"></a>2、读取变量</h5> 
<p>现在我们想通过<code>Log</code>节点把<code>myName</code>这个变量输出出来。<br> 先选中<code>Log</code>节点，切到<code>Inspector</code>页，点击<code>Text</code>值最右边的小点点，如下<br> <img src="https://images2.imgbox.com/50/c3/TnluOTRV_o.png" alt="在这里插入图片描述"><br> 此时会出现红色的感叹号<br> <img src="https://images2.imgbox.com/95/88/54rqEZUm_o.png" alt="在这里插入图片描述"><br> 我们点击下拉框，选中<code>myName</code>变量即可，<br> <img src="https://images2.imgbox.com/7a/3b/QnoBi4C0_o.png" alt="在这里插入图片描述"><br> 我们运行行为树，可以看到日志输出了变量值，如下<br> <img src="https://images2.imgbox.com/fe/68/tZ85xl46_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="3_641"></a>3、修改变量</h5> 
<p>我们在<code>Log</code>节点左边串一个<code>Set String</code>节点，</p> 
<blockquote> 
 <p>注：如果你的变量类型是<code>Bool</code>，则这里要使用<code>Set Bool</code>节点，其他类型同理，选择对应的<code>Set</code>节点，如果是自定义的数据类型，则要自己拓展一个<code>Set</code>变量值的节点才行。</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/df/8b/5s52rrsH_o.png" alt="在这里插入图片描述"><br> 此时带有一个红色感叹号，我们需要给它设置要修改的变量，如下<br> <img src="https://images2.imgbox.com/8c/ec/B3KQvDHy_o.png" alt="在这里插入图片描述"><br> 我们运行行为树，可以看到输出的变量值是皮皮猫了，<br> <img src="https://images2.imgbox.com/37/3e/iPrzshFF_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="4_650"></a>4、拓展变量类型</h5> 
<p>实际项目中，我们大概率是要拓展行为树的变量类型的，比如我现在有个<code>Blog</code>类，</p> 
<pre><code class="prism language-csharp"><span class="token comment">/// &lt;summary&gt;</span>
<span class="token comment">/// 博客</span>
<span class="token comment">/// &lt;/summary&gt;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Blog</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">/// 作者</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">string</span></span> author<span class="token punctuation">;</span>
    
    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">/// 博客地址</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">string</span></span> url<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token interpolation-string"><span class="token string">$"author: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">author</span><span class="token punctuation">}</span></span><span class="token string">, url: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">url</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>我想让他出现行为树<code>Variables</code>的变量类型列表中，我们需要给它包装一层<code>SharedBlog</code>。<br> 新建一个<code>SharedBlog</code>脚本，<br> <img src="https://images2.imgbox.com/27/3a/hDN4yf0Q_o.png" alt="在这里插入图片描述"><br> 按照下面这个格式写即可：</p> 
<pre><code class="prism language-csharp"><span class="token keyword">namespace</span> <span class="token namespace">BehaviorDesigner<span class="token punctuation">.</span>Runtime</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">System<span class="token punctuation">.</span>Serializable</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SharedT</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">SharedVariable<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">implicit</span> <span class="token keyword">operator</span> <span class="token function">SharedT</span><span class="token punctuation">(</span><span class="token class-name">T</span> <span class="token keyword">value</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SharedT</span> <span class="token punctuation">{<!-- --></span> mValue <span class="token operator">=</span> <span class="token keyword">value</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><code>SharedBlog</code>代码如下：</p> 
<pre><code class="prism language-csharp">
<span class="token keyword">namespace</span> <span class="token namespace">BehaviorDesigner<span class="token punctuation">.</span>Runtime</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">System<span class="token punctuation">.</span>Serializable</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SharedBlog</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">SharedVariable<span class="token punctuation">&lt;</span>Blog<span class="token punctuation">&gt;</span></span></span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">implicit</span> <span class="token keyword">operator</span> <span class="token function">SharedBlog</span><span class="token punctuation">(</span><span class="token class-name">Blog</span> <span class="token keyword">value</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SharedBlog</span> <span class="token punctuation">{<!-- --></span> mValue <span class="token operator">=</span> <span class="token keyword">value</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>此时，我们就可以在变量类型列表中看到我们拓展的<code>Blog</code>变量类型了，<br> <img src="https://images2.imgbox.com/44/c8/OrRfeN4G_o.png" alt="在这里插入图片描述"><br> 我们给行为树添加一个<code>Blog</code>变量吧，<br> <img src="https://images2.imgbox.com/09/f0/sDD9pIn9_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="5_712"></a>5、代码读写变量</h5> 
<p>上面我们拓展了一个<code>Blog</code>变量类型，并给行为树添加了一个<code>Blog</code>变量，现在我们想在代码中对这个变量进行访问和修改，我们可以通过<code>BehaviorTree</code>的<code>GetVariable</code>方法和<code>SetVariable</code>方法，</p> 
<pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token return-type class-name">SharedVariable</span> <span class="token function">GetVariable</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SetVariable</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name">SharedVariable</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>例：</p> 
<pre><code class="prism language-csharp"><span class="token comment">// 获取行为树对象</span>
<span class="token class-name"><span class="token keyword">var</span></span> bt <span class="token operator">=</span> <span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>BehaviorTree<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 访问成员变量-----------------------------------------</span>
<span class="token class-name"><span class="token keyword">var</span></span> sharedBlog <span class="token operator">=</span> <span class="token punctuation">(</span>SharedBlog<span class="token punctuation">)</span>bt<span class="token punctuation">.</span><span class="token function">GetVariable</span><span class="token punctuation">(</span><span class="token string">"myBlog"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Debug<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span>sharedBlog<span class="token punctuation">.</span>Value<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 修改变量值-----------------------------------------</span>
sharedBlog<span class="token punctuation">.</span>Value<span class="token punctuation">.</span>author <span class="token operator">=</span> <span class="token string">"Unity3D技术博主：林新发"</span><span class="token punctuation">;</span>
bt<span class="token punctuation">.</span><span class="token function">SetVariable</span><span class="token punctuation">(</span><span class="token string">"myBlog"</span><span class="token punctuation">,</span> sharedBlog<span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// 构建新的成员对象-----------------------------------------</span>
<span class="token class-name">SharedBlog</span> newSharedBlog  <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SharedBlog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Blog</span> newBlog <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Blog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
newBlog<span class="token punctuation">.</span>author <span class="token operator">=</span> <span class="token string">"博客技术专家：林新发"</span><span class="token punctuation">;</span>
newBlog<span class="token punctuation">.</span>url <span class="token operator">=</span> <span class="token string">"https://blog.csdn.net/linxinfa"</span><span class="token punctuation">;</span>
newSharedBlog<span class="token punctuation">.</span><span class="token function">SetValue</span><span class="token punctuation">(</span>newBlog<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 赋值成员变量</span>
bt<span class="token punctuation">.</span><span class="token function">SetVariable</span><span class="token punctuation">(</span><span class="token string">"myBlog"</span><span class="token punctuation">,</span> newSharedBlog<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="_742"></a>九、行为树事件</h4> 
<p>上文讲<mark>Sequence</mark>节点的时候已经举例讲了行为树事件，不过有些细节没有讲到，这里我进行补充。<br> 与事件相关的节点是<code>Send Event</code>和<code>Has Received Event</code>，<br> <img src="https://images2.imgbox.com/d3/f1/KBYaBKiN_o.png" alt="在这里插入图片描述"><br> 另外，我们也可以通过代码来发出事件和监听事件，下面给大家演示一遍。</p> 
<h6><a id="1Send_Event_748"></a>1、Send Event节点</h6> 
<p>我们首先看<code>Send Event</code>节点，可以在<code>Inspector</code>面板看到它的参数，<br> <img src="https://images2.imgbox.com/e1/ff/CziUPBii_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="11Target_Game_Object_751"></a>1.1、Target Game Object参数</h6> 
<p>行为树之间的事件是可以跨物体发送的，比如<code>A</code>物体上的行为树给<code>B</code>物体上的行为树发送事件。<br> 默认为<code>None</code>，事件会发给自身的行为树。<br> 我们可以查看<code>SendEvent</code>节点的源码，它调用了<code>GetDefaultGameObject</code>方法去获取目标物体，<br> <img src="https://images2.imgbox.com/99/25/xhxUUJem_o.png" alt="在这里插入图片描述"><br> 这个方法的源码如下：<br> <img src="https://images2.imgbox.com/31/71/ozLOhIRC_o.png" alt="在这里插入图片描述"><br> 意思就是如果为空，就返回自身的<code>gameObject</code>，也就是行为树自身的物体。<br> 如果我们想要设置这个<code>SendEvent</code>节点的<code>Target Game Object</code>参数，可以通过行为树变量来传递，比如在<code>Variables</code>中定义一个<code>targetObj</code>，<br> <img src="https://images2.imgbox.com/e9/b1/osuVmggi_o.png" alt="在这里插入图片描述"><br> 然后<code>SendEvent</code>的<code>Target Game Object</code>引用这个<code>targetObj</code>变量，<br> <img src="https://images2.imgbox.com/94/eb/jY0rWTIx_o.png" alt="在这里插入图片描述"><br> 而这个<code>targetObj</code>变量的赋值，我们可以通过代码来赋值，例：</p> 
<pre><code class="prism language-csharp"><span class="token comment">// go是目标物体GameObject对象，bt是自身行为树对象</span>
<span class="token class-name">SharedGameObject</span> targetObj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SharedGameObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
targetObj<span class="token punctuation">.</span>Value <span class="token operator">=</span> go<span class="token punctuation">;</span>
bt<span class="token punctuation">.</span><span class="token function">SetVariable</span><span class="token punctuation">(</span><span class="token string">"targetObj"</span><span class="token punctuation">,</span> targetObj<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h6><a id="12Event_Name_770"></a>1.2、Event Name参数</h6> 
<p><code>Event Name</code>就是事件名称，自己定义一个字符串即可，建议为<code>XXX_EVENT</code>。</p> 
<h6><a id="13Group_772"></a>1.3、Group参数</h6> 
<p><img src="https://images2.imgbox.com/44/e4/iIsv8ymm_o.png" alt="在这里插入图片描述"><br> 这个<code>Group</code>参数又是干啥用的呢？因为一个物体可以挂多个<code>BehaviorTree</code>组件，假设挂了<code>3</code>个<code>BehaviorTree</code>组件，我只想给其中的两个<code>BehaviorTree</code>发送事件，这个时候就要用到<code>Group</code>了。<br> 我们可以在<code>BehaviorTree</code>组件上看到有一个<code>Group</code>参数，<br> <img src="https://images2.imgbox.com/00/04/vzen6yTt_o.png" alt="在这里插入图片描述"><br> 我们可以给这些<code>BehaviorTree</code>分组，默认<code>Group</code>是<code>0</code>，<br> <img src="https://images2.imgbox.com/ed/d4/pOR5A9g0_o.png" alt="在这里插入图片描述"><br> 如果<code>SendEvent</code>的<code>Group</code>也是<code>0</code>，那么这个物体下所有<code>Group</code>为<code>0</code>的<code>BehaviorTree</code>都会收到事件。</p> 
<h6><a id="14Argument_781"></a>1.4、Argument参数</h6> 
<p><img src="https://images2.imgbox.com/78/81/E1G1F9fe_o.png" alt="在这里插入图片描述"><br> 我们可以看到有三个<code>Argument</code>参数，一般是用来做跨行为树发送事件时的数据传递用的。<br> 比如<code>A</code>打了<code>B</code>，<code>B</code>收到被打事件，但它并不知道是谁打它的，我们可以给它们定义一个<code>playerId</code>成员变量，</p> 
<blockquote> 
 <p>注：这里你使用<code>GameObject</code>变量也可以，看具体需要~</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/f6/3c/D5wLKWoM_o.png" alt="在这里插入图片描述"><br> 发事件的时候把<code>playerId</code>传递过去，<code>B</code>在收到事件后会去读取这个参数，<code>B</code>就知道是<code>A</code>打了它了，<br> <img src="https://images2.imgbox.com/ec/bf/q1H98gEO_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="2Has_Receive_Event_790"></a>2、Has Receive Event节点</h6> 
<p><code>Has Receive Event</code>节点参数如下，<br> <img src="https://images2.imgbox.com/98/34/f1CwtvFo_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="21Event_Name_793"></a>2.1、Event Name参数</h6> 
<p><code>Event Name</code>参数就是要监听的事件名称，与<code>SendEvent</code>的<code>Event Name</code>要对应上。</p> 
<h6><a id="22Stored_Value_795"></a>2.2、Stored Value参数</h6> 
<p><code>Stored Value</code>参数用来存储传递过来的数据的，与<code>Send Event</code>的三个<code>Argument</code>顺序对应。注意，这里是把传递过来的参数存储到<code>Stored Value</code>设置的变量中，比如<code>A</code>行为树传递了一个<code>playerId</code>过来，表示打人者的<code>Id</code>，<code>B</code>行为树收到事件，把这个<code>plaeyrId</code>存储到<code>fromPlayerId</code>变量中，<br> <img src="https://images2.imgbox.com/dd/a9/ODidxU8z_o.png" alt="在这里插入图片描述"><br> 然后我们可以在代码中通过<code>B</code>行为树的<code>GetVariable</code>方法读取到这个<code>fromPlayerId</code>，</p> 
<pre><code class="prism language-csharp"><span class="token class-name"><span class="token keyword">var</span></span> fromPlayerId <span class="token operator">=</span> <span class="token punctuation">(</span>SharedInt<span class="token punctuation">)</span>bt<span class="token punctuation">.</span><span class="token function">GetVariable</span><span class="token punctuation">(</span><span class="token string">"fromPlayerId"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Debug<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">fromPlayerId</span><span class="token punctuation">}</span></span><span class="token string"> 打了我"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h6><a id="3_803"></a>3、代码中注册和注销事件</h6> 
<p>有时候我们需要在代码中自己注册事件的响应函数，可以调用行为树的<code>RegisterEvent</code>方法，</p> 
<pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token generic-method"><span class="token function">RegisterEvent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> U<span class="token punctuation">,</span> V<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name">Action<span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> U<span class="token punctuation">,</span> V<span class="token punctuation">&gt;</span></span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token generic-method"><span class="token function">RegisterEvent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> U<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name">Action<span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> U<span class="token punctuation">&gt;</span></span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token generic-method"><span class="token function">RegisterEvent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name">Action<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">RegisterEvent</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>Action</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>对应的，要注销事件的响应函数，则调用<code>UnregisterEvent</code>方法，</p> 
<pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token generic-method"><span class="token function">UnregisterEvent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> U<span class="token punctuation">,</span> V<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name">Action<span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> U<span class="token punctuation">,</span> V<span class="token punctuation">&gt;</span></span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token generic-method"><span class="token function">UnregisterEvent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> U<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name">Action<span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> U<span class="token punctuation">&gt;</span></span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token generic-method"><span class="token function">UnregisterEvent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name">Action<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">UnregisterEvent</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>Action</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>可以查阅<code>Has Receive Event</code>节点的源码<br> <img src="https://images2.imgbox.com/d2/24/IkqpK7Dn_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_823"></a>十、拓展行为树节点</h4> 
<h5><a id="1_824"></a>1、继承</h5> 
<p>实际项目开发过程中，我们一般都需要自己拓展一些行为树节点，我们知道，所有的节点都是继承<code>Task</code>的，然后根据节点的功能分类，有细分了一些子类出来，比如复合节点的继承关系如下：<br> <img src="https://images2.imgbox.com/15/8f/IYJ3gkq8_o.png" alt="在这里插入图片描述"><br> 我们我们想要封装一个新的复合节点，也继承<code>Composite</code>然后进行拓展即可。<br> <img src="https://images2.imgbox.com/d0/74/gUp1l8m7_o.png" alt="在这里插入图片描述"></p> 
<p>同理，<code>Action</code>类的节点也如此，<br> <img src="https://images2.imgbox.com/b0/8d/QZnrwEz5_o.png" alt="在这里插入图片描述"></p> 
<p>我们可以参考<code>Log</code>节点、<code>Wait</code>节点的写法，自行拓展自己的<code>Action</code>节点。</p> 
<h5><a id="2MoveTo_834"></a>2、案例：MoveTo</h5> 
<p>举个例子，现在要写一个移动主角到指定<code>Transform</code>位置的<code>Action</code>，首先创建一个<code>MoveTo</code>脚本，<br> <img src="https://images2.imgbox.com/7b/c3/lP635qsP_o.png" alt="在这里插入图片描述"><br> 引入<code>BehaviorDesigner</code>的命名空间，然后继承<code>Action</code>，</p> 
<pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">UnityEngine</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">BehaviorDesigner<span class="token punctuation">.</span>Runtime</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">BehaviorDesigner<span class="token punctuation">.</span>Runtime<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>

<span class="token comment">// 移动主角到指定Transform位置</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MoveTo</span><span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Action</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span>
</code></pre> 
<p>接着定义一些必要的<code>public</code>成员变量，这些变量会在<code>Inspector</code>面板中显示，</p> 
<pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">UnityEngine</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">BehaviorDesigner<span class="token punctuation">.</span>Runtime</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">BehaviorDesigner<span class="token punctuation">.</span>Runtime<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>

<span class="token comment">// 移动主角到指定Transform位置</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MoveTo</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Action</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">float</span></span> speed <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">SharedTransform</span> target<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>再接着，我们重写<code>OnUpdate</code>方法，如下</p> 
<pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name">TaskStatus</span> <span class="token function">OnUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>Vector3<span class="token punctuation">.</span><span class="token function">SqrMagnitude</span><span class="token punctuation">(</span>transform<span class="token punctuation">.</span>position <span class="token operator">-</span> target<span class="token punctuation">.</span>Value<span class="token punctuation">.</span>position<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0.1f</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">return</span> TaskStatus<span class="token punctuation">.</span>Success<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   transform<span class="token punctuation">.</span>position <span class="token operator">=</span> Vector3<span class="token punctuation">.</span><span class="token function">MoveTowards</span><span class="token punctuation">(</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">,</span> target<span class="token punctuation">.</span>Value<span class="token punctuation">.</span>position<span class="token punctuation">,</span> speed <span class="token operator">*</span> Time<span class="token punctuation">.</span>deltaTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> TaskStatus<span class="token punctuation">.</span>Running<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>这样，我们自己封装的<code>MoveTo</code>节点就完成了，<br> <img src="https://images2.imgbox.com/f0/98/ioTOzWMC_o.png" alt="在这里插入图片描述"><br> 我们连个行为树，让<code>Cub</code>来回移动，效果如下<br> <img src="https://images2.imgbox.com/06/51/i75D5S5p_o.gif" alt="请添加图片描述"></p> 
<h5><a id="3Sample_877"></a>3、官方Sample包</h5> 
<p><code>BehaviorDesigner</code>官方自己写了一些拓展包，我们可以把对应的包导入项目中使用，<br> <img src="https://images2.imgbox.com/d8/4a/KwMugzMB_o.png" alt="在这里插入图片描述"><br> 这里分享给大家，<br> 链接：<a href="https://pan.baidu.com/s/1mQUkxbeokOh6oyTmEG837w" rel="nofollow">https://pan.baidu.com/s/1mQUkxbeokOh6oyTmEG837w</a><br> 提取码：oi74</p> 
<h4><a id="_884"></a>十一、完毕</h4> 
<p>好了，就先写到这里吧，我是林新发：<a href="https://blog.csdn.net/linxinfa">https://blog.csdn.net/linxinfa</a><br> 一个在小公司默默奋斗的<code>Unity</code>开发者，希望可以帮助更多想学<code>Unity</code>的人，共勉~</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d612e0fb3250f98bc820066e6a6a5a0b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Java中有没有类似C#中的区域注释？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/408de67f1a364d7ed1f74b3ab2b15053/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">树莓派学习之旅01（下载镜像&#43;烧录&#43;启动&#43;SSH&#43;VNC）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>