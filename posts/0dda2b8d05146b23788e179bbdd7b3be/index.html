<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Cookie是什么及用法详解 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Cookie是什么及用法详解" />
<meta property="og:description" content="cookie Cookie是一个客户端会话技术，是由服务器端创建，放在响应头发送到客户端保存，用于存储少量数据，因为存放在客户端中，容易被人编造伪造，不是很安全。一般不用于存储重要信息。它是通过键值对传递信息的。
Cookie是保存在客户端的数据，所以如果不做设定，默认情况下是跟着客户端一起消失，如果设置setMaxAge()，将会以设置的数值为主，时间到了将会自动消失
Cookie是服务器通知客户端保存键値对的一种技术客戶端有了 Cookie后，每次请求都发送给服务器每个 Cookie的大小不能超过4kB，超过这个限制cookie中无法存储该数据 Cookie应用场景 Cookie能使站点跟踪特定访问者的访问次数、最后访问时间和访问者进入站点的路径Cookie能告诉在线广告商广告被点击的次数，从而可以更精确的投放广告Cookie有效期限未到时，Cookie能使用户在不键入密码和用户名的情况下进入曾经浏览过的一些
站点Cookie能帮助站点统计用户个人资料以实现各种各样的个性化服务安全性能差，容易信息泄露 基础编程 添加cookie
Cookie ck1 = new Cookie(&#34;username&#34;, username); //创建cookie对象，注意cookie中只 能存放字符串，其它数据可以转换为字符串进行存储，默认maxAge为-1，表示采用内存cookie response.addCookie(ck1); //将cookie发送到客户端 读取cookie
Cookie[] cks = request.getCookies();//获取当前应用可以访问的所有cookie String username = null; for (Cookie ck : cks) { //遍历所有的cookie，根据名称查找对应的存储数据 if (&#34;username&#34;.equals(ck.getName())) { username = ck.getValue(); } } Cookie与Session的区别 Session是保存在服务端的，有一个唯一标识 session.getId() 。在服务端保存Session的方法很多，内存、数据库、文件都有。集群的时候也要考虑Session的转移，在大型的网站，一般会有专门的Session服务器集群，用来保存用户会话，这个时候 Session 信息都是放在内存的，使用一些缓存服务比
如Memcached之类的来放 Session。
Cookie作用于每次HTTP请求的时候，客户端都会发送相应的Cookie信息到服务端。
Cookie原理 对于Cookie的实现原理是基于HTTP协议的，其中设计HTTP协议中的两个请求头信息分别为：响应头set-cookie、请求头cookie
[response.addCookie]当要发送Cookie的时候会有一个响应头set-cookie，里面放着数据，当将来浏览器在请求服务器资源的时候，会通过一个cookie头把cookie的数据携带到服务器资源里面来请求
Cookie限制性 cookie存储大小一般为4kB，存储个数一般20-53个，视浏览器的不同。
Cookie编程基础 void setValue(String newValue) cookie创建后设置一个新的值。
String getName()返回Cookie的名字。名字和值是关心的两个部分
String getValue() 返回Cookie的值" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/0dda2b8d05146b23788e179bbdd7b3be/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-06T09:48:01+08:00" />
<meta property="article:modified_time" content="2023-05-06T09:48:01+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Cookie是什么及用法详解</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="cookie_0"></a>cookie</h3> 
<hr> 
<p>Cookie是一个客户端会话技术，是由服务器端创建，放在响应头发送到客户端保存，用于存储少量数据，因为存放在客户端中，容易被人编造伪造，不是很安全。一般不用于存储重要信息。它是通过键值对传递信息的。</p> 
<p>Cookie是保存在客户端的数据，所以如果不做设定，默认情况下是跟着客户端一起消失，如果设置setMaxAge()，将会以设置的数值为主，时间到了将会自动消失<br> <img src="https://images2.imgbox.com/4a/af/ODaPuOIF_o.png" alt="在这里插入图片描述"></p> 
<ul><li>Cookie是服务器通知客户端保存键値对的一种技术</li><li>客戶端有了 Cookie后，每次请求都发送给服务器</li><li>每个 Cookie的大小不能超过4kB，超过这个限制cookie中无法存储该数据</li></ul> 
<h3><a id="Cookie_9"></a>Cookie应用场景</h3> 
<hr> 
<ul><li>Cookie能使站点跟踪特定访问者的访问次数、最后访问时间和访问者进入站点的路径</li><li>Cookie能告诉在线广告商广告被点击的次数，从而可以更精确的投放广告</li><li>Cookie有效期限未到时，Cookie能使用户在不键入密码和用户名的情况下进入曾经浏览过的一些<br> 站点</li><li>Cookie能帮助站点统计用户个人资料以实现各种各样的个性化服务</li><li><strong>安全性能差，容易信息泄露</strong></li></ul> 
<h4><a id="_18"></a>基础编程</h4> 
<p>添加cookie</p> 
<pre><code class="prism language-java"><span class="token class-name">Cookie</span> ck1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cookie</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//创建cookie对象，注意cookie中只</span>
能存放字符串，其它数据可以转换为字符串进行存储，默认maxAge为<span class="token operator">-</span><span class="token number">1</span>，表示采用内存cookie
response<span class="token punctuation">.</span><span class="token function">addCookie</span><span class="token punctuation">(</span>ck1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//将cookie发送到客户端</span>
</code></pre> 
<p>读取cookie</p> 
<pre><code class="prism language-java"><span class="token class-name">Cookie</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cks <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getCookies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取当前应用可以访问的所有cookie</span>
<span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Cookie</span> ck <span class="token operator">:</span> cks<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">//遍历所有的cookie，根据名称查找对应的存储数据</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>ck<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
       username <span class="token operator">=</span> ck<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="CookieSession_35"></a>Cookie与Session的区别</h4> 
<p>Session是保存在服务端的，有一个唯一标识 session.getId() 。在服务端保存Session的方法很多，内存、数据库、文件都有。集群的时候也要考虑Session的转移，在大型的网站，一般会有专门的Session服务器集群，用来保存用户会话，这个时候 Session 信息都是放在内存的，使用一些缓存服务比<br> 如Memcached之类的来放 Session。</p> 
<p>Cookie作用于每次HTTP请求的时候，客户端都会发送相应的Cookie信息到服务端。</p> 
<h4><a id="Cookie_41"></a>Cookie原理</h4> 
<p>对于Cookie的实现原理是基于HTTP协议的，其中设计HTTP协议中的两个请求头信息分别为：响应头set-cookie、请求头cookie</p> 
<p>[response.addCookie]当要发送Cookie的时候会有一个响应头set-cookie，里面放着数据，当将来浏览器在请求服务器资源的时候，会通过一个cookie头把cookie的数据携带到服务器资源里面来请求</p> 
<h4><a id="Cookie_45"></a>Cookie限制性</h4> 
<p>cookie存储大小一般为4kB，存储个数一般20-53个，视浏览器的不同。</p> 
<h3><a id="Cookie_47"></a>Cookie编程基础</h3> 
<hr> 
<p>void setValue(String newValue) cookie创建后设置一个新的值。</p> 
<p>String getName()返回Cookie的名字。名字和值是关心的两个部分</p> 
<p>String getValue() 返回Cookie的值</p> 
<p>具体的cookie可以分为内存cookie和文件<code>cookie， Cookie ck=new Cookie("username","zhangsan")</code>时默认maxAge为 -1表示内存cookie，内存cookie在浏览器窗口关闭后会自动消失；如果需要使用文件cookie则需要设置maxAge，参数为正整数</p> 
<p>void setMaxAge(int expiry) 以秒计算，设置Cookie过期时间。注意这个值是cookie将要存在的最大时间，而不是cookie现在的存在时间。负值表示当浏览器关闭时，Cookie将会被删除。零值则是要删除该Cookie</p> 
<p>int getMaxAge() 返回Cookie过期之前的最大时间，以秒计算。</p> 
<p>文件cookie不受当前窗口是否关闭的影响</p> 
<pre><code class="prism language-java"><span class="token class-name">Cookie</span> ck<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Cookie</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span><span class="token string">"wangwu"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ck<span class="token punctuation">.</span><span class="token function">setMaxAge</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token operator">*</span><span class="token number">24</span><span class="token operator">*</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//需要存储15天，例如15天免登录</span>
response<span class="token punctuation">.</span><span class="token function">addCookie</span><span class="token punctuation">(</span>ck<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>void setComment(String purpose) 设置cookie中注释。</p> 
<p>String getComment()返回cookie中注释，如果没有注释的话将返回空值</p> 
<p>String getDomain() 返回cookie中Cookie适用的域名。使用getDomain() 方法可以指示浏览器把Cookie返回给同 一域内的其他服务器,而通常Cookie只返回给与发送它的服务器名字完全相同的服务器。注意域名必须以点开始，如.yesky.com）</p> 
<p>void setDomain(String pattern) 设置cookie中Cookie适用的域名</p> 
<p>String getPath()返回Cookie适用的路径。如果不指定路径，Cookie将返回给当前页面所在目录及其子目录下 的所有页面</p> 
<p>void setPath(String uri) 指定Cookie适用的路径。</p> 
<p><strong>其他方法</strong><br> boolean getSecure() 如果浏览器通过安全协议发送cookies将返回true值，如果浏览器使用标准协议则返回false值。</p> 
<p>int getVersion() 返回Cookie所遵从的协议版本。</p> 
<p>void setSecure(boolean flag) 指出浏览器使用的安全协议，例如HTTPS或SSL。</p> 
<p>void setVersion(int v) 设置Cookie所遵从的协议版本。</p> 
<h3><a id="Cookie_88"></a>Cookie通讯过程</h3> 
<hr> 
<p>Cookie在通讯中会经历4个过程：</p> 
<ul><li>浏览器发送请求</li><li>服务端接收请求，并返回响应，在报文头中包含set-cookie的字段</li><li>浏览器接收响应后将Cookie存储，并在之后的请求中都会带上cookie的信息</li><li>服务端接收请求，并返回响应。</li></ul> 
<h3><a id="Cookie_95"></a>Cookie属性</h3> 
<hr> 
<p>Cookie的属性有：key/value、Expires、Domain、path、Secure、HttpOnly</p> 
<ul><li>Key/value键值对，cookie按照键值对的模式存储信息</li><li>Expires过期时间，设置某个时间后，cookie会失效</li><li>Domain指定Cookie的域名作用域</li><li>Path是Cookie生成的路径</li><li>Secure只有在HTTPS模式下，服务端才会响应cookie信息</li><li>HttpOnly设为true后，只能通过http访问，不能通过document.cookie获取设定为httponly的键值，防止xss读取cookie</li></ul> 
<h4><a id="maxAge_105"></a>maxAge</h4> 
<p>标准用法</p> 
<pre><code>Cookie ck=new Cookie("name","wangwu");
// ck.setMaxAge(15*24*60*60);//需要存储15天，例如15天免登录
ck.setMaxAge(0); //删除cookie
response.addCookie(ck);
</code></pre> 
<p>基于语法 cookie.setMaxAge(60); 单位为秒。</p> 
<ul><li>当maxAge &gt;0时Cookie将在maxAge秒后自动失效</li><li>当maxAge =0时Cookie将立刻删除Cookie</li><li>当maxAge =-1时Cookie的时间过期后cookie依然存在在浏览器上，将存在一段时间或重启浏览器自动消失。</li></ul> 
<p>HttpServletResponse提供的Cookie操作只有一个addCookie，如果要修改Cookie只能用一个同名的Cookie进行覆盖。</p> 
<p>客户端发送的cookie时，只会提交name和value属性，其他属性是不可读的。也不会被提交。即服务端无法判断Cookie是否过期，获取域名信息等。如在服务端通过cookie.getMaxAge()获取过期时间，读取的是一个只读属性，值永远为-1。</p> 
<h4><a id="_121"></a>中文问题</h4> 
<p>在Cookie是中不能直接传输中文，如果想要传输中文的话，首先要在发送Cookie前先使用URL将中文进行编码，然后将编码后的数据发送到客户端</p> 
<pre><code class="prism language-java"><span class="token class-name">String</span> content<span class="token operator">=</span> <span class="token string">"服务器传送的Cookie"</span><span class="token punctuation">;</span>
content<span class="token operator">=</span> <span class="token class-name">URLEncoder</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span><span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Cookie</span> cookie <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cookie</span><span class="token punctuation">(</span><span class="token string">"memo"</span><span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span>
cookie<span class="token punctuation">.</span><span class="token function">setMaxAge</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//设置Maximum Age过期时间s,默认是-1,关闭浏览器失效</span>
cookie<span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getContextPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//设置cookie路径为当前项目路径</span>
response<span class="token punctuation">.</span><span class="token function">addCookie</span><span class="token punctuation">(</span>cookie<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//添加cookie</span>
</code></pre> 
<p>获取Cookie的时候要将获取的数据进行URL解码</p> 
<pre><code class="prism language-java"><span class="token class-name">String</span> val <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
<span class="token class-name">Cookie</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cookies <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getCookies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取cookie数组</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>cookies <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> cookies<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
     <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Cookie</span> cookie <span class="token operator">:</span> cookies<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">//遍历数组</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>cookie<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"memo"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          val <span class="token operator">=</span> cookie<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          val <span class="token operator">=</span> <span class="token class-name">URLDecoder</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>rediskt<span class="token punctuation">,</span><span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_145"></a>常见问题</h3> 
<hr> 
<ul><li>Session是在服务端保存的一个数据结构，用来跟踪用户的状态，这个数据可以保存在集群、数据库、文件中</li><li>Cookie是客户端保存用户信息的一种机制，用来记录用户的一些信息，也是实现Session的一种方式。</li></ul> 
<p>Cookie运行在客户端，Session运行在服务端，对吗？</p> 
<blockquote> 
 <p>不完全正确。Cookie是运行在客户端，有客户端进行管理；Session虽然是运行在服务器端，但是sessionID作为一个Cookie是存储在客户端的。</p> 
</blockquote> 
<p>浏览器禁止Cookie，Cookie就不能用了，但Session不会受浏览器影响，对吗？</p> 
<blockquote> 
 <p>错。浏览器禁止Cookie，Cookie确实不能用了，Session会受浏览器端的影响。很简单的实验，在登录一个网站后，清空浏览器的Cookie和隐私数据，单机后台的连接，就会因为丢失Cookie而退出。当然，有办法通过URL传递Session。</p> 
</blockquote> 
<p>浏览器关闭后，Cookie和Session都消失了，对吗？</p> 
<blockquote> 
 <p>错。存储在内存中额Cookie确实会随着浏览器的关闭而消失，但存储在硬盘上的不会。更顽固的是Flash Cookie，不过现在很多系统优化软件和新版浏览器都已经支持删除Flash Cookie。百度采用了这样的技术记忆用户：Session在浏览器关闭后也不会消失，除非正常退出，代码中使用了显示的unset删除Session。否则Session可能被回收，也有可能永远残留在系统中。</p> 
</blockquote> 
<p>Session 比 Cookie 更安全吗？ 不应该大量使用Cookie吗？</p> 
<blockquote> 
 <p>错误。Cookie确实可能存在一些不安全因素，但和JavaScript一样，即使突破前端验证，还有后端保障安全。一切都还要看设计，尤其是涉及提权的时候，特别需要注意。通常情况下，Cookie和Session是绑定的，获得Cookie就相当于获得了Session，客户端把劫持的Cookie原封不动地传给服务器，服务器收到后，原封不动地验证Session，若Session存在，就实现了Cookie和Session的绑定过程。因此，不存在Session比Cookie更安全这种说法。如果说不安全，也是由于代码不安<br> 全，错误地把用作身份验证的Cookie作为权限验证来使用。</p> 
</blockquote> 
<p>Session是创建在服务器上的，应该少用Session而多用Cookie，对吗？</p> 
<blockquote> 
 <p>错。Cookie可以提高用户体验，但会加大网络之间的数据传输量，应尽量在Cookie中仅保存必要的数据。</p> 
</blockquote> 
<p>如果把别人机器上的Cookie文件复制到我的电脑上（假设使用相同的浏览器），是不是能够登录别人的帐号呢？如何防范？</p> 
<blockquote> 
 <p>是的。这属于Cookie劫持的一种做法。要避免这种情况，需要在Cookie中针对IP、UA等加上特殊的校验信息，然后和服务器端进行比对。</p> 
</blockquote> 
<p>在IE浏览器下登录某网站，换成Firefox浏览器是否仍然是未登录状态？使用IE登录了腾讯网站后，为什么使用Firefox能保持登录状态？</p> 
<blockquote> 
 <p>不同浏览器使用不同的Cookie管理机制，无法实现公用Cookie。如果使用IE登录腾讯网站，使用Firefox也能登录，这是由于在安装腾讯QQ软件时，你的电脑上同时安装了针对这两个浏览器的插件，可以识别本地已登录QQ号码进而自动登录。本质上，不属于共用Cookie的范畴。</p> 
</blockquote> 
<h3><a id="ServletContext_173"></a>ServletContext</h3> 
<hr> 
<p>ServletContext上下文提供对应用程序中所有Servlet所共有的各种资源和功能的访问。Servlet上下文API用于设置应用程序中所有Servlet共有的信息。Servlet可能需要共享他们之间的共有信息。运行于同一服务器的Servlet有时会共享资源，如JSP页面、文件和其他Servlet</p> 
<p>在jsp中是9大默认对象的application对象</p> 
<h4><a id="_179"></a>初始化参数</h4> 
<p>上下文参数一般都是配置在web.xml中</p> 
<pre><code class="prism language-java"><span class="token operator">&lt;</span>context<span class="token operator">-</span>param<span class="token operator">&gt;</span> 上下文参数的个数没有限制
<span class="token operator">&lt;</span>param<span class="token operator">-</span>name<span class="token operator">&gt;</span>counter<span class="token operator">&lt;</span><span class="token operator">/</span>param<span class="token operator">-</span>name<span class="token operator">&gt;</span> 参数名称，不允许重复
<span class="token operator">&lt;</span>param<span class="token operator">-</span>value<span class="token operator">&gt;</span><span class="token number">99999</span><span class="token operator">&lt;</span><span class="token operator">/</span>param<span class="token operator">-</span>value<span class="token operator">&gt;</span> 对应配置参数值
<span class="token operator">&lt;</span><span class="token operator">/</span>context<span class="token operator">-</span>param<span class="token operator">&gt;</span>
</code></pre> 
<p>ServletContext接口的初始化参数允许servlet访问与web应用相关的上下文初始化参数，这些由应用开发人员在部署描述符中指定：</p> 
<ul><li>getInitParameter</li></ul> 
<pre><code class="prism language-java"><span class="token class-name">String</span> str<span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInitParameter</span><span class="token punctuation">(</span><span class="token string">"counter"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//如</span>
果上下文中没有这个初始化参数配置，则获取值<span class="token keyword">null</span>
</code></pre> 
<blockquote> 
 <p>允许servlet的init-param和上下文参数同名，这里只是通过不同的方式进行获取， 上下文参<br> 数使用application对象获取，servlet参数配置使用ServletConfig获取</p> 
</blockquote> 
<ul><li>getInitParameterNames</li></ul> 
<pre><code class="prism language-java"><span class="token keyword">final</span> <span class="token class-name">ServletContext</span> application <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">final</span> <span class="token class-name">Enumeration</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> names <span class="token operator">=</span>
application<span class="token punctuation">.</span><span class="token function">getInitParameterNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">while</span><span class="token punctuation">(</span>names<span class="token punctuation">.</span><span class="token function">hasMoreElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
     <span class="token class-name">String</span> name<span class="token operator">=</span>names<span class="token punctuation">.</span><span class="token function">nextElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token class-name">String</span> value<span class="token operator">=</span>application<span class="token punctuation">.</span><span class="token function">getInitParameter</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name<span class="token operator">+</span><span class="token string">"---"</span><span class="token operator">+</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>应用开发人员利用初始化参数传送配置信息。典型的例子是web管理员的e-mail地址或者一个持有关键数据的系统名称</p> 
<h4><a id="_209"></a>上下文属性</h4> 
<p>可以通过名称将对象属性绑定到上下文。任何绑定到上下文的属性可以被同一个web应用的其他servlet使用。ServletContext接口的方法允许访问</p> 
<ul><li>setAttribute</li><li>getAttribute</li><li>getAttributeNames</li><li>removeAttribute</li></ul> 
<p>针对基本不发生改变而且需要频繁读取的数据，可以考虑将数据共享在application中</p> 
<ul><li>正确的做法是参数ServletContextListener实现application被创建时自动加载，在application销毁时存储数据</li><li>变通做法是由Servlet在init方法中负责加载准备</li></ul> 
<pre><code class="prism language-java"><span class="token generics"><span class="token punctuation">&lt;</span>servlet<span class="token punctuation">&gt;</span></span>
    <span class="token operator">&lt;</span>servlet<span class="token operator">-</span>name<span class="token operator">&gt;</span>loadCatalog<span class="token operator">&lt;</span><span class="token operator">/</span>servlet<span class="token operator">-</span>name<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>servlet<span class="token operator">-</span><span class="token keyword">class</span><span class="token operator">&gt;</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>yan<span class="token punctuation">.</span>action<span class="token punctuation">.</span></span>LoadCatalogServlet</span><span class="token operator">&lt;</span><span class="token operator">/</span>servlet<span class="token operator">-</span><span class="token keyword">class</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>默认情况下，当第一次客户端访问<span class="token class-name">Servlet</span>时，才由服务器负责加载并初始化<span class="token class-name">Servlet</span>
对象 <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>配置参数load<span class="token operator">-</span>on<span class="token operator">-</span>startup表示应用启动时自动加载<span class="token class-name">Servlet</span>，值为大于等于零的整
数，值越大优先级越低<span class="token punctuation">.</span>默认值<span class="token operator">-</span><span class="token number">1</span>表示按需加载<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>load<span class="token operator">-</span>on<span class="token operator">-</span>startup<span class="token operator">&gt;</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>load<span class="token operator">-</span>on<span class="token operator">-</span>startup<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>servlet<span class="token operator">&gt;</span> 
<span class="token operator">&lt;</span>servlet<span class="token operator">-</span>mapping<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>servlet<span class="token operator">-</span>name<span class="token operator">&gt;</span>loadCatalog<span class="token operator">&lt;</span><span class="token operator">/</span>servlet<span class="token operator">-</span>name<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>url<span class="token operator">-</span>pattern<span class="token operator">&gt;</span><span class="token operator">/</span>load<span class="token punctuation">.</span><span class="token keyword">do</span><span class="token operator">&lt;</span><span class="token operator">/</span>url<span class="token operator">-</span>pattern<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>servlet<span class="token operator">-</span>mapping<span class="token operator">&gt;</span>
</code></pre> 
<p>在LoadCatalogServlet的init方法中加载类目信息，并存放在application对象的属性中，其它地方直接获取即可</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoadCatalogServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{<!-- --></span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{<!-- --></span>
<span class="token class-name">ServletContext</span> application<span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//模拟从数据库中获取所有的类目信息</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Catalog</span><span class="token punctuation">&gt;</span></span> catalogList<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
   <span class="token class-name">Catalog</span> catalog<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Catalog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   catalog<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
   catalog<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"name_"</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
   catalogList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>catalog<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>catalogList<span class="token punctuation">)</span><span class="token punctuation">;</span>
  application<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"catalogList"</span><span class="token punctuation">,</span>catalogList<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span>
response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
  request<span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span><span class="token string">"/product/add.jsp"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span>
response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>页面中从application中获取数据</p> 
<pre><code class="prism language-java"><span class="token operator">&lt;</span>select name<span class="token operator">=</span><span class="token string">"catalogId"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>option value<span class="token operator">=</span><span class="token string">""</span><span class="token operator">&gt;</span>请选择类别<span class="token operator">&lt;</span><span class="token operator">/</span>option<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">%</span>
    <span class="token class-name">Object</span> obj<span class="token operator">=</span>application<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"catalogList"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>obj<span class="token operator">!=</span><span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> obj <span class="token keyword">instanceof</span> <span class="token class-name">List</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
       <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Catalog</span><span class="token punctuation">&gt;</span></span> clist<span class="token operator">=</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Catalog</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> obj<span class="token punctuation">;</span>
       <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Catalog</span> c<span class="token operator">:</span>clist<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">%</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>option value<span class="token operator">=</span><span class="token string">"&lt;%=c.getId()%&gt;"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">%=</span>c<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>option<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">%</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">%</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>select<span class="token operator">&gt;</span>
</code></pre> 
<h4><a id="_277"></a>资源访问</h4> 
<p>ServletContext接口提供对web应用组成的静态内容文档层级的直接访问，包括HTML，GIF和JPEG文件：</p> 
<ul><li>getResource</li><li>getResourceAsStream</li></ul> 
<blockquote> 
 <p>需求：读取应用根目录下的某个资源文件<br> 比较麻烦的做法</p> 
</blockquote> 
<pre><code class="prism language-java"><span class="token keyword">final</span> <span class="token class-name">ServletContext</span> application <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">try</span><span class="token punctuation">{<!-- --></span>
<span class="token class-name">String</span> realPath<span class="token operator">=</span>application<span class="token punctuation">.</span><span class="token function">getRealPath</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//获取应用根路径--绝</span>
对路径，例如windows下c<span class="token operator">:</span>\dddd\bbb
<span class="token class-name">File</span> file<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>realPath<span class="token punctuation">,</span><span class="token string">"counter.data"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//采用相对路径的方式指代</span>
根路径下的文件counter<span class="token punctuation">.</span>data
<span class="token class-name">DataInputStream</span> dos<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span>
<span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dos<span class="token punctuation">.</span><span class="token function">readLong</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span><span class="token punctuation">;</span>
dos<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
application<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"indexServlet"</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>使用getResourceAsStream相对比较简单一些</p> 
</blockquote> 
<pre><code class="prism language-java"><span class="token keyword">try</span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">final</span> <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span>
application<span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span><span class="token string">"counter"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//一般不建议在web应用中获取</span>
运行环境相关的配置数据<span class="token operator">--</span>探针程序
<span class="token class-name">DataInputStream</span> dis<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
counter1<span class="token operator">=</span>dis<span class="token punctuation">.</span><span class="token function">readLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
application<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"indexServlet"</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>getResource和getResourceAsStream方法以 / 开头的字符串为参数，它指定上下文根路径的资源相对路径。文档的层级可能存在于服务器的文件系统、war文件、远程服务器或者在一些其它位置中。</p> 
<p>这些方法不用来获取动态内容。比如，在一个支持JSP规范1的容器中，getResource(“/index.jsp”)这种形式的方法调用将返回JSP源代码，而不是处理后的输出</p> 
<p>Web应用资源的完整列表可以使用getResourcePaths(String path)方法访问。</p> 
<h4><a id="_317"></a>操作日志</h4> 
<p>两个重载的log方法都是记录日志到servlet日志文件，需要注意的是servlet日志文件的路径由具体的servlet容器自己去决定。如果是在IDE中跑应用的话，那么日志信息将在控制台Console输出。如果是发布到Tomcat下的话，日志文件是Tomcat目录下的/logs/localhost.yyyy-MM-dd.log</p> 
<h4><a id="_319"></a>其它方法</h4> 
<p>getMajorVersion和getMinorVersion分别返回当前servlet容器支持的Servlet规范最高版本和最低版本。getEffectiveMajorVersion和getEffectiveMinorVersion分别返回当前应用基于的Servlet规范最高版本和最低版本，是servlet3.0规范增加的新特性。所以一般情况下：<code>： getMajorVersion &gt;= getEffectiveMajorVersion &gt; getEffectiveMinorVersion &gt;= getMinorVersion</code></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2af1fbbcee3b3fcc2ca3878a93975610/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">queryWrapper写内联接，多表查询</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1bad62463db2bb3e31bde7e0e4d27a72/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">BI技巧丨计算组单位切换</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>