<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>yocto的hello world - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="yocto的hello world" />
<meta property="og:description" content="为了辅助理解yocto编译的架构和编译过程，写一遍helloworld会好很多。
首先下载编译poky
$ git clone git://git.yoctoproject.org/poky $ cd poky $ source oe-init-build-env $ bitbake core-image-sato 创建自己的layer：meta-mylayer
$ bitbake-layers create-layer meta-mylayer NOTE: Starting bitbake server... Add your new layer with &#39;bitbake-layers add-layer meta-mylayer&#39; 在poky目录下通过bitbake-layers增加meta-layer，提示找不到bblayers.conf，原来是要在build目录下添加才对：
hui@hui:~/disk4t/codes/poky $ bitbake-layers add-layer meta-mylayer NOTE: Starting bitbake server... Unable to find bblayers.conf 在build目录下add-layer, 没有指定meta-mylayer路径报错
hui@hui:~/disk4t/codes/poky/build $ bitbake-layers add-layer meta-mylayer NOTE: Starting bitbake server... Specified layer directory /home/hui/disk4t/codes/poky/build/meta-mylayer doesn&#39;t exist 指定路径后可以了：
$ bitbake-layers add-layer ../meta-mylayer NOTE: Starting bitbake server." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/6f18048f2b5db177632a6436fb4c3820/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-09-15T17:15:36+08:00" />
<meta property="article:modified_time" content="2021-09-15T17:15:36+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">yocto的hello world</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>为了辅助理解yocto编译的架构和编译过程，写一遍helloworld会好很多。</p> 
<p>首先下载编译poky</p> 
<pre><code class="prism language-bash">$ <span class="token function">git</span> clone git://git.yoctoproject.org/poky
$ <span class="token builtin class-name">cd</span> poky
$ <span class="token builtin class-name">source</span> oe-init-build-env
$ bitbake core-image-sato
</code></pre> 
<p>创建自己的layer：meta-mylayer</p> 
<pre><code class="prism language-bash">$ bitbake-layers create-layer meta-mylayer
NOTE: Starting bitbake server<span class="token punctuation">..</span>.
Add your new layer with <span class="token string">'bitbake-layers add-layer meta-mylayer'</span>

</code></pre> 
<p>在poky目录下通过bitbake-layers增加meta-layer，提示找不到bblayers.conf，原来是要在build目录下添加才对：</p> 
<pre><code class="prism language-bash">hui@hui:~/disk4t/codes/poky
$ bitbake-layers add-layer meta-mylayer
NOTE: Starting bitbake server<span class="token punctuation">..</span>.
Unable to <span class="token function">find</span> bblayers.conf

</code></pre> 
<p>在build目录下add-layer, 没有指定meta-mylayer路径报错</p> 
<pre><code class="prism language-bash">hui@hui:~/disk4t/codes/poky/build
$ bitbake-layers add-layer meta-mylayer
NOTE: Starting bitbake server<span class="token punctuation">..</span>.
Specified layer directory /home/hui/disk4t/codes/poky/build/meta-mylayer doesn't exist

</code></pre> 
<p>指定路径后可以了：</p> 
<pre><code class="prism language-bash">$ bitbake-layers add-layer <span class="token punctuation">..</span>/meta-mylayer
NOTE: Starting bitbake server<span class="token punctuation">..</span>.
</code></pre> 
<p>cat bblayer.conf可以看到meta-mylayer加到了最后一行</p> 
<pre><code class="prism language-bash">$ <span class="token function">cat</span> conf/bblayers.conf 
<span class="token comment"># POKY_BBLAYERS_CONF_VERSION is increased each time build/conf/bblayers.conf</span>
<span class="token comment"># changes incompatibly</span>
POKY_BBLAYERS_CONF_VERSION <span class="token operator">=</span> <span class="token string">"2"</span>

BBPATH <span class="token operator">=</span> <span class="token string">"<span class="token variable">${TOPDIR}</span>"</span>
BBFILES ?<span class="token operator">=</span> <span class="token string">""</span>

BBLAYERS ?<span class="token operator">=</span> <span class="token string">" \
  /home/hui/disk4t/codes/poky/meta \
  /home/hui/disk4t/codes/poky/meta-poky \
  /home/hui/disk4t/codes/poky/meta-yocto-bsp \
  /home/hui/disk4t/codes/poky/meta-mylayer \
  "</span>

</code></pre> 
<p>查看meta-mylayer目录</p> 
<pre><code class="prism language-bash">$ tree <span class="token builtin class-name">.</span>
<span class="token builtin class-name">.</span>
├── conf
│   └── layer.conf
├── COPYING.MIT
├── README
└── recipes-example
    └── example
        └── example_0.1.bb

</code></pre> 
<p>新建files目录，在files目录下添加hello.c文件</p> 
<pre><code>$ tree meta-mylayer/
meta-mylayer/
├── conf
│   └── layer.conf
├── COPYING.MIT
├── README
└── recipes-example
    └── example
        ├── example_0.1.bb
        └── files
            └── hello.c
</code></pre> 
<p>修改example_0.1.bb，定义编译规则</p> 
<pre><code>SUMMARY = "bitbake-layers recipe"
LICENSE = "MIT"

python do_display_banner() {
    bb.plain("***********************************************");
    bb.plain("*                                             *");
    bb.plain("*  Example recipe created by bitbake-layers   *");
    bb.plain("*                                             *");
    bb.plain("***********************************************");
}

DESCRIPTION = "Simple helloworld application"
LICENSE = "MIT"
LIC_FILES_CHKSUM = "file://${COMMON_LICENSE_DIR}/MIT;md5=0835ade698e0bcf8506ecda2f7b4f302"

SRC_URI = "file://hello.c"

S = "${WORKDIR}"

do_compile() {
        ${CC} hello.c ${LDFLAGS} -o helloworld
}

do_install() {
        install -d ${D}${bindir}
        install -m 0755 helloworld ${D}${bindir}
}

</code></pre> 
<p>编译</p> 
<pre><code class="prism language-bash">$ bitbake example
Loading cache: <span class="token number">100</span>% <span class="token operator">|</span><span class="token comment">########################################################################################################################################################################| Time: 0:00:00</span>
Loaded <span class="token number">1470</span> entries from dependency cache.
NOTE: Resolving any missing task queue dependencies

Build Configuration:
BB_VERSION           <span class="token operator">=</span> <span class="token string">"1.51.1"</span>
BUILD_SYS            <span class="token operator">=</span> <span class="token string">"x86_64-linux"</span>
NATIVELSBSTRING      <span class="token operator">=</span> <span class="token string">"universal"</span>
TARGET_SYS           <span class="token operator">=</span> <span class="token string">"x86_64-poky-linux"</span>
MACHINE              <span class="token operator">=</span> <span class="token string">"qemux86-64"</span>
DISTRO               <span class="token operator">=</span> <span class="token string">"poky"</span>
DISTRO_VERSION       <span class="token operator">=</span> <span class="token string">"3.3+snapshot-bf47addb34debc049b59e5e466228f00045c2061"</span>
TUNE_FEATURES        <span class="token operator">=</span> <span class="token string">"m64 core2"</span>
TARGET_FPU           <span class="token operator">=</span> <span class="token string">""</span>
meta                 
meta-poky            
meta-yocto-bsp       
meta-mylayer         <span class="token operator">=</span> <span class="token string">"master:bf47addb34debc049b59e5e466228f00045c2061"</span>

Initialising tasks: <span class="token number">100</span>% <span class="token operator">|</span><span class="token comment">###################################################################################################################################################################| Time: 0:00:00</span>
Sstate summary: Wanted <span class="token number">0</span> Local <span class="token number">0</span> Network <span class="token number">0</span> Missed <span class="token number">0</span> Current <span class="token number">153</span> <span class="token punctuation">(</span><span class="token number">0</span>% match, <span class="token number">100</span>% complete<span class="token punctuation">)</span>
NOTE: Executing Tasks
NOTE: Tasks Summary: Attempted <span class="token number">623</span> tasks of <span class="token function">which</span> <span class="token number">623</span> didn't need to be rerun and all succeeded.
</code></pre> 
<p>然后在tmp目录下find生成的Helloworld</p> 
<pre><code class="prism language-bash">$ <span class="token function">find</span> <span class="token builtin class-name">.</span> -name <span class="token string">"helloworld"</span>
./work-shared/gcc-11.2.0-r0/gcc-11.2.0/libgo/misc/cgo/fortran/helloworld
./work/core2-64-poky-linux/gstreamer1.0/1.18.4-r0/gstreamer-1.18.4/tests/examples/helloworld
./work/core2-64-poky-linux/example/0.1-r0/packages-split/example/usr/bin/helloworld
./work/core2-64-poky-linux/example/0.1-r0/packages-split/example-dbg/usr/bin/.debug/helloworld
./work/core2-64-poky-linux/example/0.1-r0/package/usr/bin/.debug/helloworld
./work/core2-64-poky-linux/example/0.1-r0/package/usr/bin/helloworld
./work/core2-64-poky-linux/example/0.1-r0/image/usr/bin/helloworld
./work/core2-64-poky-linux/example/0.1-r0/helloworld

</code></pre> 
<p>在conf/local.conf文件中增加IMAGE_INSTALL</p> 
<pre><code>IMAGE_INSTALL = "example"
</code></pre> 
<p><code>IMAGE_INSTALL_append = "example"</code>,用IMAGE_INSTALL_append如下会报错，没有研究应该怎么用</p> 
<pre><code class="prism language-bash">$ bitbake core-image-sato
ERROR: Variable IMAGE_INSTALL_append contains an operation using the old override syntax. Please convert this layer/metadata before attempting to use with a newer bitbake.
</code></pre> 
<p>然后build core-image-sato</p> 
<pre><code class="prism language-bash">$ bitbake core-image-sato
</code></pre> 
<p>编译完成后再次运行，这次可能因为加了helloworld的缘故，没有进入到图形界面，但是在QEMU的shell环境中就可以运行helloworld程序，输出’Hello World!’。</p> 
<pre><code>$ runqemu tmp/deploy/images/qemux86-64/bzImage-qemux86-64.bin tmp/deploy/images/qemux86-64/core-image-sato-qemux86-64.ext4
</code></pre> 
<p>参考：</p> 
<ul><li><a href="https://www.cnblogs.com/chegxy/p/14394333.html#3-%E5%A6%82%E4%BD%95%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8Byocto%E9%A1%B9%E7%9B%AE" rel="nofollow">Yocto项目介绍及入门 – 嵌入师工程师必备利器</a></li><li><a href="https://variwiki.com/index.php?title=Yocto_Hello_World" rel="nofollow">DART-6UL - Hello, World!</a></li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2602438074a68269e905a02b902ae469/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">使用SSM框架的简单项目</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0f89e440252f87d090e6b337c3d672b2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">函数传参（指针）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>