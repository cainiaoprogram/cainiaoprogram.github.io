<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>18张图带你详解IP路由表七大要素：路由前缀、协议类型、优先级等 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="18张图带你详解IP路由表七大要素：路由前缀、协议类型、优先级等" />
<meta property="og:description" content="IP 路由表
上次有写过一篇《20张图深度详解MAC地址表、ARP表、路由表 》的文章，里面有提到路由表，那么什么是IP路由、什么又是IP路由表呢？
路由：路由是网络中的基本概念，网络的基本功能就是使得处于网络中两个IP地址能够互相通信。
当路由器收到一个IP数据包时，路由器会解析出IP数据包中的目的IP地址，然后根据目的IP地址查找路由表，依据最长掩码匹配原则，找到对应的路由条目，根据路由条目中的下一跳或者出接口将报文转发出去，这就是路由。
路由表：简单点说路由表就是路由器用于指导数据包如何转发的表项，记录了去往目的IP的下一跳去哪里（如下图）。
路由表的作用类似于我们生活中的地图或者指示牌，指引我们去往一个目的地该如何走?
IP路由表包含了哪些要素
IP路由表中包含了目的网络/掩码，协议类型，优先级，开销，标志，下一跳，出接口这个七大要素。
下面我们来看下一个真实的路由表：
从这个路由器我们可以通过命令 display ip routing-table来查询该设备的路由表，我们可以看到这条设备一共有12条路由条目。
每个路由条目必须包括下面几个信息元素：
目的网络/掩码
目的网络/掩码：也被称为路由前缀，这是路由条目所关联的目的网络地址及网络掩码。
一条完整的路由前缀由：网络地址&#43;前缀长度（或者网络掩码）构成，两者缺一不可，例如192.168.1.0/24与192.168.1.0/25，虽然网络地址相同，都是192.168.1.0，但是两者绝对是两条不同的路由，因为他们的前缀长度不相同。
当路由器收到一个IP数据包时，路由器会解析出IP数据包中的目的IP地址，然后根据目的IP地址查找路由表，依据最长掩码匹配原则，找到对应的路由条目。
最长掩码匹配原则匹配的就是目的网络/掩码。
比如：路由器收到一个目的IP地址为10.1.1.1的数据包，此时查找路由表，有两个路由条目，一个路由条目的A的目的网络/掩码是10.1.1.0/24，另一条路由条目B的目的网络/掩码是10.1.1.0/28，那么这个数据包匹配的是哪一个路由条目呢？
正确答案：是匹配路由条目B，因为B的掩码长。
协议类型
协议类型：指该路由条目是通过什么路由协议学些过来的。例如是直连的，或是静态的，或者是通过OSPF、IS-IS、EIGRP、BGP等动态路由学习到的。
1、直连路由：指和路由器的接口直接的地址生成的路由。
如下图中，协议类型是direct的就是直接直连地址生成的路由。
2、静态路由：静态路由是指通过静态路由协议生成的路由。
3、动态路由：动态路由协议主要有RIP、OSPF、ISIS、BGP。RIP和BGP是基于距离矢量的路由协议，OSPF和ISIS都是基于链路状态的路由协议。
优先级
路由表中去往同一目的地的路由可能通过多种路由协议生成。
举个例子：去往目的IP为192.168.2.1的通过静态路由生成了，也通过OSPF路由生成了。那么这个时候什么样的路由才会加入到路由表中呢？这个时候就和路由协议的优先级有关系了。
每种协议类型对应不同的优先级，优先级值越小则路由越优。
常用路由协议和优先级的关系表如下图。
那么当一台路由器同时从多种不同的路由协议学习到去往同一个目的地的路由时，它将优选路由协议优先级值最小的那条路由。
因此，本次例子中，正确的应该是通过OSPF学习到路由加入到路由表中（OSPF的路由优先级比静态路由优先级小）
开销
开销：路由的度量值，经常也使用metric来描述。
直连及静态路由的Cost为0。
通过动态路由协议学习到的Cost则根据实际情况而定。不同的路由协议计算Cost的方法不同。
例如上图中，R1去往PC2的路由条目通过OSPF路由协议学习到，开销为3。
标记
标志：路由标记，R表示该路由是迭代路由。D表示该路由下发到FIB（Forwarding Information Base）表。
迭代路由：路由必须有直连的下一跳才能够指导转发，但是路由生成时下一跳可能不是直连的，因此需要计算出一个直连的下一跳和对应的出接口，这个过程就叫做路由迭代。BGP路由、静态路由和UNR路由的下一跳都有可能不是直连的，都需要进行路由迭代。
例如，BGP路由的下一跳一般是非直连的对端loopback地址，不能指导转发，需要进行迭代。即根据以BGP学习到的下一跳为目的地址在IP路由表中查找，当找到一条具有直连的下一跳、出接口信息的路由后（一般为一条IGP路由），将其下一跳、出接口信息填入这条BGP路由的IP路由表中并生成对应的FIB表项。
下一跳
下一跳：去往目标网络的下一跳IP地址。
出接口
出接口：去往目标网络从本设备的哪个接口出去。
---END---" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/2647420f4a1ec4d465ce145c53198cc8/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-09-02T22:05:02+08:00" />
<meta property="article:modified_time" content="2021-09-02T22:05:02+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">18张图带你详解IP路由表七大要素：路由前缀、协议类型、优先级等</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><strong>IP 路由表</strong></p> 
<p>上次有写过一篇《20张图深度详解MAC地址表、ARP表、路由表 》的文章，里面有提到路由表，那么什么是IP路由、什么又是IP路由表呢？</p> 
<p></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/7b/c3/4UMfv2kY_o.png" width="1032"></p> 
<p></p> 
<p></p> 
<p><strong>路由：</strong>路由是网络中的基本概念，网络的基本功能就是使得处于网络中两个IP地址能够互相通信。</p> 
<p></p> 
<p>当路由器收到一个IP数据包时，路由器会解析出IP数据包中的<strong>目的IP地址</strong>，然后根据目的IP地址查找路由表，依据<strong>最长掩码匹配原则</strong>，找到对应的路由条目，根据路由条目中的下一跳或者出接口将报文转发出去，这就是<strong>路由</strong>。</p> 
<p></p> 
<p><strong>路由表</strong>：简单点说路由表就是路由器用于指导数据包如何转发的表项，记录了去往目的IP的下一跳去哪里（如下图）。</p> 
<p></p> 
<p></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/43/11/VLfjBCle_o.png" width="675"></p> 
<p></p> 
<p></p> 
<p>路由表的作用类似于我们生活中的地图或者指示牌，指引我们去往一个目的地该如何走?</p> 
<p></p> 
<p></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/2f/95/D7BkPR9f_o.png" width="820"></p> 
<p></p> 
<p><strong>IP路由表包含了哪些要素</strong></p> 
<p>IP路由表中包含了<strong>目的网络/掩码，协议类型，优先级，开销，标志，下一跳，出接口</strong>这个七大要素。</p> 
<p></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/f1/ee/WWT6VnnD_o.jpg" width="569"></p> 
<p></p> 
<p></p> 
<p>下面我们来看下一个真实的路由表：</p> 
<p></p> 
<p></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/75/7d/ZvMHQreW_o.png" width="699"></p> 
<p></p> 
<p></p> 
<p>从这个路由器我们可以通过命令 <strong>display ip routing-table</strong>来查询该设备的路由表，我们可以看到这条设备一共有12条路由条目。</p> 
<p></p> 
<p>每个路由条目必须包括下面几个信息元素：</p> 
<p><strong>目的网络/掩码</strong></p> 
<p><strong>目的网络/掩码：</strong>也被称为<strong>路由前缀</strong>，这是路由条目所关联的目的网络地址及网络掩码。</p> 
<p></p> 
<p>一条完整的路由前缀由：<strong>网络地址+前缀长度（或者网络掩码）</strong>构成，两者缺一不可，例如192.168.1.0/24与192.168.1.0/25，虽然网络地址相同，都是192.168.1.0，但是两者绝对是两条不同的路由，因为他们的前缀长度不相同。</p> 
<p></p> 
<p></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/a7/7f/ePVBAvOK_o.png" width="491"></p> 
<p></p> 
<p>当路由器收到一个IP数据包时，路由器会解析出IP数据包中的目的IP地址，然后根据目的IP地址查找路由表，依据<strong>最长掩码匹配</strong>原则，找到对应的路由条目。</p> 
<p><strong>最长掩码匹配原则匹配的就是目的网络/掩码。</strong></p> 
<p>比如：路由器收到一个目的IP地址为10.1.1.1的数据包，此时查找路由表，有两个路由条目，一个路由条目的A的目的网络/掩码是10.1.1.0/24，另一条路由条目B的目的网络/掩码是10.1.1.0/28，那么这个数据包匹配的是哪一个路由条目呢？</p> 
<p></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/f4/8c/eUq1NE84_o.png" width="931"></p> 
<p></p> 
<p></p> 
<p>正确答案：是匹配路由条目B，因为B的掩码长。</p> 
<p><strong>协议类型</strong></p> 
<p></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/5d/b1/hooOWuTx_o.jpg" width="589"></p> 
<p></p> 
<p><strong>协议类型：</strong>指该路由条目是通过什么路由协议学些过来的。例如是直连的，或是静态的，或者是通过OSPF、IS-IS、EIGRP、BGP等动态路由学习到的。</p> 
<p></p> 
<p><strong>1、直连路由：</strong>指和路由器的接口直接的地址生成的路由。</p> 
<p></p> 
<p>如下图中，协议类型是direct的就是直接直连地址生成的路由。</p> 
<p></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/25/e8/5FuYmGO8_o.png" width="1032"></p> 
<p></p> 
<p></p> 
<p><strong>2、静态路由</strong>：静态路由是指通过静态路由协议生成的路由。</p> 
<p></p> 
<p><strong>3、动态路由：</strong>动态路由协议主要有RIP、OSPF、ISIS、BGP。RIP和BGP是基于距离矢量的路由协议，OSPF和ISIS都是基于链路状态的路由协议。</p> 
<p></p> 
<p></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/cc/6d/eSgKgsEz_o.jpg" width="506"></p> 
<p></p> 
<p></p> 
<p><strong>优先级</strong></p> 
<p><strong>路由表中去往同一目的地的路由可能通过多种路由协议生成。</strong></p> 
<p>举个例子：去往目的IP为192.168.2.1的通过静态路由生成了，也通过OSPF路由生成了。那么这个时候什么样的路由才会加入到路由表中呢？这个时候就和<strong>路由协议的优先级</strong>有关系了。</p> 
<p>每种协议类型对应不同的优先级，<strong>优先级值越小则路由越优</strong>。</p> 
<p>常用路由协议和优先级的关系表如下图。</p> 
<p></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/3f/ad/WsRoASpW_o.jpg" width="282"></p> 
<p></p> 
<p></p> 
<p>那么当一台路由器同时从多种不同的路由协议学习到去往同一个目的地的路由时，它将<strong>优选路由协议优先级值最小的那条路由</strong>。</p> 
<p></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/43/96/AlavrdB0_o.png" width="1032"></p> 
<p></p> 
<p></p> 
<p>因此，本次例子中，正确的应该是通过<strong>OSPF</strong>学习到路由加入到路由表中（OSPF的路由优先级比静态路由优先级小）</p> 
<p><strong>开销</strong></p> 
<p><strong>开销：</strong>路由的度量值，经常也使用<strong>metric</strong>来描述。</p> 
<p>直连及静态路由的Cost为0。</p> 
<p></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/f1/73/2S5V4rj1_o.jpg" width="284"></p> 
<p></p> 
<p>通过动态路由协议学习到的Cost则根据实际情况而定。不同的路由协议计算Cost的方法不同。</p> 
<p></p> 
<p></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/06/52/XRA6ZWhl_o.png" width="1032"></p> 
<p></p> 
<p></p> 
<p>例如上图中，R1去往PC2的路由条目通过OSPF路由协议学习到，开销为3。</p> 
<p><strong>标记</strong></p> 
<p><strong>标志：</strong>路由标记，R表示该路由是<strong>迭代路由</strong>。D表示该路由下发到FIB（Forwarding Information Base）表。</p> 
<p></p> 
<p></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/44/a3/XIoLClpc_o.jpg" width="283"></p> 
<p></p> 
<p></p> 
<p><strong>迭代路由：</strong>路由必须有直连的下一跳才能够指导转发，但是路由生成时下一跳可能不是直连的，因此需要计算出一个直连的下一跳和对应的出接口，这个过程就叫做路由迭代。BGP路由、静态路由和UNR路由的下一跳都有可能不是直连的，都需要进行路由迭代。</p> 
<p></p> 
<p>例如，BGP路由的下一跳一般是非直连的对端loopback地址，不能指导转发，需要进行迭代。即根据以BGP学习到的下一跳为目的地址在IP路由表中查找，当找到一条具有直连的下一跳、出接口信息的路由后（一般为一条IGP路由），将其下一跳、出接口信息填入这条BGP路由的IP路由表中并生成对应的FIB表项。</p> 
<p><strong>下一跳</strong></p> 
<p><strong>下一跳：</strong>去往目标网络的下一跳IP地址。</p> 
<p></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/14/7b/k2id6CHM_o.png" width="1032"></p> 
<p></p> 
<p><strong>出接口</strong></p> 
<p><strong>出接口：</strong>去往目标网络从本设备的哪个接口出去。</p> 
<p></p> 
<p></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/0a/ad/v005RTjl_o.png" width="1032"></p> 
<p></p> 
<p></p> 
<p></p> 
<p><strong>---END---</strong></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a2a4544aa24d661dc1c993b3837d29af/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">操作系统中的IO控制方式详解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f7190420e472d364a8bda77e0ce036a9/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">图像的低频，中频，高频信息含义？</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>