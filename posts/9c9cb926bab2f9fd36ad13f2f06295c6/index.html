<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>为什么CommonJS和ES6可以混合使用? - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="为什么CommonJS和ES6可以混合使用?" />
<meta property="og:description" content="1 node环境下运行 新建一个文件夹testImport，创建webpack.config.js文件，创建src/index.js 内容为空。
执行npm init
安装第三方工具 npm install airspeed
目录结构如下：
index.js写入测试内容：
import isEmptyObject from &#39;airspeed/isEmptyObject&#39;; // const isEmptyObject = require(&#39;airspeed/isEmptyObject&#39;); const d = {name: &#39;maile&#39;} console.log(isEmptyObject(d)) module.exports = d; node src/index.js
会提示错误信息：SyntaxError: Cannot use import statement outside a module。
这是因为用node去执行index.js文件的时候，该文件运行在node环境下，支持的是CommonJs规范，不支持ES6。
const isEmptyObject = require(&#39;airspeed/isEmptyObject&#39;);
换成上面的方式进行引入，可以正常执行。
2 webpack编译 如果想让index.js文件支持es6模块，需要经过webpack编译后再使用。来配置下webpack：
const path = require(&#39;path&#39;) const config = { mode: &#39;development&#39;, entry: &#39;./src/index.js&#39;, output: { filename: `main.min.js`, path: path.resolve(__dirname, &#39;dist&#39;), } } module." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/9c9cb926bab2f9fd36ad13f2f06295c6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-02-16T11:06:28+08:00" />
<meta property="article:modified_time" content="2022-02-16T11:06:28+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">为什么CommonJS和ES6可以混合使用?</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3><strong>1 node环境下运行</strong></h3> 
<p>新建一个文件夹testImport，创建webpack.config.js文件，创建src/index.js 内容为空。</p> 
<p>执行npm init</p> 
<p>安装第三方工具 npm install airspeed</p> 
<p>目录结构如下：</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/72/0a/oG6T8Vin_o.png"></p> 
<p>index.js写入测试内容：</p> 
<pre><code>
import isEmptyObject from 'airspeed/isEmptyObject';

// const isEmptyObject = require('airspeed/isEmptyObject');

const d = {name: 'maile'}

console.log(isEmptyObject(d))

module.exports = d;</code></pre> 
<p>node src/index.js</p> 
<p>会提示错误信息：SyntaxError: Cannot use import statement outside a module。</p> 
<p>这是因为用node去执行index.js文件的时候，该文件运行在node环境下，支持的是CommonJs规范，不支持ES6。</p> 
<p><code>const isEmptyObject = require('airspeed/isEmptyObject');</code></p> 
<p>换成上面的方式进行引入，可以正常执行。</p> 
<h3><strong>2 webpack编译</strong></h3> 
<p>如果想让index.js文件支持es6模块，需要经过webpack编译后再使用。来配置下webpack：</p> 
<pre><code>
const path = require('path')
const config = {
  mode: 'development',
  entry: './src/index.js',
  output: {
    filename: `main.min.js`,
    path: path.resolve(__dirname, 'dist'),
  }
}

module.exports = config;</code></pre> 
<p>安装：npm install webpack@4 webpack-cli -D</p> 
<blockquote> 
 <p>主意：目前还没有使用babel，仅仅使用了webpack来进行打包。</p> 
</blockquote> 
<pre><code>"scripts": {
    "build": "webpack",
    "test": "echo \"Error: no test specified\" &amp;&amp; exit 1"
  },</code></pre> 
<p>修改src/index.js</p> 
<pre><code>
import isEmptyObject from 'airspeed/isEmptyObject';

// const isEmptyObject = require('airspeed/isEmptyObject');

const d = {name: 'maile'}

console.log(isEmptyObject(d))

export default d;</code></pre> 
<blockquote> 
 <p>注意：引入和导出使用规范保持一致。</p> 
</blockquote> 
<p>执行npm run build</p> 
<p>运行 node .\dist\main.min.js</p> 
<p>可以看到控制台打印出了false。</p> 
<p>再看下"airspeed/isEmptyObject"的导出方式：</p> 
<p>node_modules/airspeed/isEmptyObject.js</p> 
<pre><code>/**
 * 
 * @desc   判断`obj`是否为空
 * @param {Object} obj 
 * @returns {Boolean}
 */

function isEmptyObject(obj) {
  if(!obj || typeof obj !== 'object' || Array.isArray(obj)) {
    return false;
  }
  return !Object.keys(obj).length;
}
module.exports = isEmptyObject;</code></pre> 
<p>这个文件是用commonJs的规范导出的。后使用的过程中是用es6的规范引入的，经过webpack打包后，就支持了混合使用。</p> 
<h3>3 分析原因</h3> 
<p>先来看下webpack打包后的文件：</p> 
<p>main.min.js</p> 
<pre><code>/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' &amp;&amp; Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode &amp; 1: value is a module id, require it
/******/ 	// mode &amp; 2: merge all properties of value into the ns
/******/ 	// mode &amp; 4: return value when already ns object
/******/ 	// mode &amp; 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode &amp; 1) value = __webpack_require__(value);
/******/ 		if(mode &amp; 8) return value;
/******/ 		if((mode &amp; 4) &amp;&amp; typeof value === 'object' &amp;&amp; value &amp;&amp; value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode &amp; 2 &amp;&amp; typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module &amp;&amp; module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./src/index.js");
/******/ })
/************************************************************************/
/******/ ({

/***/ "./node_modules/airspeed/isEmptyObject.js":
/*!************************************************!*\
  !*** ./node_modules/airspeed/isEmptyObject.js ***!
  \************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("/**\r\n * \r\n * @desc   判断`obj`是否为空\r\n * @param {Object} obj \r\n * @returns {Boolean}\r\n */\r\n\r\nfunction isEmptyObject(obj) {\r\n  if(!obj || typeof obj !== 'object' || Array.isArray(obj)) {\r\n    return false;\r\n  }\r\n  return !Object.keys(obj).length;\r\n}\r\nmodule.exports = isEmptyObject;\n\n//# sourceURL=webpack:///./node_modules/airspeed/isEmptyObject.js?");

/***/ }),

/***/ "./src/index.js":
/*!**********************!*\
  !*** ./src/index.js ***!
  \**********************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var airspeed_isEmptyObject__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! airspeed/isEmptyObject */ \"./node_modules/airspeed/isEmptyObject.js\");\n/* harmony import */ var airspeed_isEmptyObject__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(airspeed_isEmptyObject__WEBPACK_IMPORTED_MODULE_0__);\n\r\n\r\n\r\n// const isEmptyObject = require('airspeed/isEmptyObject');\r\n\r\nconst d = {name: 'maile'}\r\n\r\nconsole.log(airspeed_isEmptyObject__WEBPACK_IMPORTED_MODULE_0___default()(d))\r\n\r\n/* harmony default export */ __webpack_exports__[\"default\"] = (d);\n\n//# sourceURL=webpack:///./src/index.js?");

/***/ })

/******/ });</code></pre> 
<p>简化一下上面的代码如下：</p> 
<pre><code> (function(modules) { // webpackBootstrap

 	// The require function
 	function __webpack_require__(moduleId) {

 		// Create a new module (and put it into the cache)
 		var module = {
 			i: moduleId,
 			l: false,
 			exports: {}
 		};

 		// Execute the module function
 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);

 		// Return the exports of the module
 		return module.exports;
 	}

 	// Load entry module and return exports
 	return __webpack_require__("./src/index.js");
 })

 ({

 "./node_modules/airspeed/isEmptyObject.js":

 (function(module, exports) {
   // ./node_modules/airspeed/isEmptyObject.js的内容

  }),
 "./src/index.js":

  (function(module, __webpack_exports__, __webpack_require__) {
  
    "use strict";
    //    ./src/index.js
  })
  
});</code></pre> 
<p>这样看着就是不是清晰多了，一个自动执行的函数，入参是 <code>modules</code>。<code>modules</code>是一个对象，key为入口文件和所依赖文件的路径，value是一个函数，函数体内部是处理后的文件内容。</p> 
<p>先来看自执行函数内部，定义了一个<strong>webpack_require</strong>函数，并且</p> 
<p>return<strong>webpack_require</strong>("./src/index.js")，入参是入口文件。</p> 
<p>这个<strong>webpack_require</strong> 函数内部定义了一个module对象，带有exports属性。调用的时候会传递module，和module.exports。</p> 
<p>modules[moduleId].call(module.exports, module, module.exports, _<strong>webpack_require</strong>); 这里调用的就是自执行函数的入参，找到对应的路径key,调用对应的函数。</p> 
<pre><code>"./node_modules/airspeed/isEmptyObject.js":

(function(module, exports) {

   eval("/**\r\n * \r\n * @desc   判断`obj`是否为空\r\n * @param {Object} obj \r\n * @returns {Boolean}\r\n */\r\n\r\nfunction isEmptyObject(obj) {\r\n  if(!obj || typeof obj !== 'object' || Array.isArray(obj)) {\r\n    return false;\r\n  }\r\n  return !Object.keys(obj).length;\r\n}\r\nmodule.exports = isEmptyObject;\n\n//# sourceURL=webpack:///./node_modules/airspeed/isEmptyObject.js?");

 }),</code></pre> 
<p>eval内部的module.exports = isEmptyObject，访问到的就是函数入参就是<strong>webpack_require</strong>函数中定义的module。</p> 
<pre><code>"./src/index.js":

 (function(module, __webpack_exports__, __webpack_require__) {
 
   "use strict";
   eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var airspeed_isEmptyObject__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! airspeed/isEmptyObject */ \"./node_modules/airspeed/isEmptyObject.js\");\n/* harmony import */ var airspeed_isEmptyObject__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(airspeed_isEmptyObject__WEBPACK_IMPORTED_MODULE_0__);\n\r\n\r\n\r\n// const isEmptyObject = require('airspeed/isEmptyObject');\r\n\r\nconst d = {name: 'maile'}\r\n\r\nconsole.log(airspeed_isEmptyObject__WEBPACK_IMPORTED_MODULE_0___default()(d))\r\n\r\n/* harmony default export */ __webpack_exports__[\"default\"] = (d);\n\n//# sourceURL=webpack:///./src/index.js?");
   
 })</code></pre> 
<p>上面函数入参<strong>webpack_exports</strong>就是<strong>webpack_require</strong>函数中定义的module.exports。而<strong>webpack_require</strong>就是<strong>webpack_require</strong>这个函数。</p> 
<p>看到eval的第一句先执行了一个函数<strong>webpack_require</strong>.r(_<strong><em>webpack_exports</em></strong>)，这个函数如下：</p> 
<pre><code>/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' &amp;&amp; Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};</code></pre> 
<p>大概意思就是标记一个这个文件使用的是es6规范导出的。</p> 
<p>src/index.js文件中第一行内容：</p> 
<pre><code>import isEmptyObject from 'airspeed/isEmptyObject';</code></pre> 
<p>输入为<strong>webpack_require</strong>(/*! airspeed/isEmptyObject */ \"./node_modules/airspeed/isEmptyObject.js\")。</p> 
<p>可以看出无论是以es6规范导出还是以CommonJs规范导出，最终都会被挂在<strong>webpack_require</strong>函数中定义的module对象上。当然，引入也是如此。</p> 
<p>所以如果你的项目使用了webpack进行打包，就放心了混合使用两种方式了。</p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/bcacf24123e9b5cfba20072cd1f93754/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">oracle 修改表字段顺序</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b74bfcfa69b00ca98919161b42e6141c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Java抽象工厂模式（附实例代码）每天一学设计模式</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>