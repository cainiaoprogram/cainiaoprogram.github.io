<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Fragmentå…¨æ–‡è¯¦è§£(ç”±æµ…å…¥æ·±_æºç åˆ†æ) - èœé¸Ÿç¨‹åºå‘˜åšå®¢</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Fragmentå…¨æ–‡è¯¦è§£(ç”±æµ…å…¥æ·±_æºç åˆ†æ)" />
<meta property="og:description" content="ç›¸ä¿¡androidå¼€å‘è€…ä»¬ä¸€å®šæˆ–å¤šæˆ–å°‘çš„ç”¨è¿‡Fragmentï¼Œä½†æ˜¯å¯¹äºå…¶æ›´æ·±å±‚æ¬¡çš„åŸç†æˆ‘çŒœå¯èƒ½å¤§éƒ¨åˆ†åº”è¯¥éƒ½æ²¡æœ‰äº†è§£è¿‡ï¼Œä»Šå¤©è¿™é‡Œå°±ç”±æµ…å…¥æ·±ï¼Œæ•´ä½“å¯¹Fragmentåšä¸€ä¸ªå…¨é¢è§£æã€‚
åŸºç¡€ä»‹ç» Fragmentæ˜¯ä»€ä¹ˆä»¥åŠä¸ºä»€ä¹ˆè¦æœ‰Fragmentå‘¢ï¼Ÿ Fragmentç›´è¯‘ä¸ºç¢ç‰‡ï¼Œæ˜¯Android 3.0å¼•å…¥çš„ç»„ä»¶ï¼ŒFragmentä¸èƒ½å•ç‹¬ä½¿ç”¨ï¼Œå¿…é¡»è¦ä¾èµ–äºActivityã€‚ Fragmentå¼•å…¥ä¹‹å‰å‡ ä¹æ‰€æœ‰çš„é€»è¾‘éƒ½è¢«æ”¾ç½®åœ¨Activityä¸­ï¼Œä½¿å¾—Activityè‡ƒè‚¿è€Œæ··ä¹±ï¼ŒFragmentä½œä¸ºä¸€ä¸ªå¾®å°çš„Activityè¯ç”Ÿã€‚
å¦å¤–Fragmentè¿˜æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š
æ¨¡å—åŒ–ï¼šæˆ‘ä»¬å¯ä»¥æŒ‰ç…§æ¨¡å—å°†ä»£ç å†™å…¥åˆ°ä¸åŒçš„Fragmentä¸­ï¼Œä¹‹ååœ¨æ ¹æ®éœ€è¦åµŒå…¥åˆ°Activityã€‚å¯é‡ç”¨ï¼šå¤šä¸ªActiviyå¯ä»¥å¤ç”¨åŒä¸€ä¸ªFragmentã€‚é€‚é…æ€§ï¼šæ ¹æ®ä¸åŒçš„å¸ƒå±€æ ·å¼ï¼Œç»„åˆä¸åŒçš„Fragmentã€‚ Fragmentç”Ÿå‘½å‘¨æœŸ Fragmentä½œä¸ºç®¡ç†ä¸€ç»„Viewçš„ç»„ä»¶ï¼Œä¹Ÿæ˜¯æœ‰è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸçš„ï¼Œå’ŒActivityç±»ä¼¼ï¼Œä½†åˆä¸å®Œå…¨ä¸€æ ·ã€‚åŸºæœ¬ç”Ÿå‘½å‘¨æœŸå¦‚ä¸‹å›¾æ‰€ä»¥ï¼š
onAttachï¼šåœ¨Fragmentå’ŒActivityå…³è”æ—¶è°ƒç”¨ï¼Œä»…ä»…åªè°ƒç”¨ä¸€æ¬¡ã€‚æˆ‘ä»¬å¯ä»¥å¯¹ä¼ é€’ç»™Fragmentçš„å‚æ•°è¿›è¡Œè§£æã€‚onCreateï¼šFragmentåˆ›å»ºæ—¶è°ƒç”¨ï¼Œä»…è°ƒç”¨ä¸€æ¬¡ã€‚onCreateViewï¼šæ„å»ºFragment Viewçš„æ—¶å€™è¿›è¡Œè°ƒç”¨ï¼Œè¿”å›Fragmentè¦ç»˜åˆ¶å¸ƒå±€çš„æ ¹è§†å›¾ã€‚onActivityCreatedï¼šåœ¨Activityæ‰§è¡Œå®ŒæˆonCreateä¹‹åè¿›è¡Œè°ƒç”¨ã€‚onStartï¼šFragmentå¯¹ç”¨æˆ·å¯è§çš„æ—¶å€™è¿›è¡Œè°ƒç”¨ã€‚onResumeï¼šFragmentå¯ä»¥å’Œç”¨æˆ·äº¤äº’çš„æ—¶å€™è¿›è¡Œè°ƒç”¨ã€‚onPauseï¼šFragmentå¯¹ç”¨æˆ·ä¸å¯äº¤äº’çš„æ—¶å€™è¿›è¡Œè°ƒç”¨ã€‚onStopï¼šFragmentå¯¹ç”¨æˆ·ä¸å¯è§æ—¶è¿›è¡Œè°ƒç”¨ã€‚onDestroyViewï¼šFragmentéœ€è¦ç§»é™¤è§†å›¾æ—¶è¿›è¡Œè°ƒç”¨ã€‚onDestroyï¼šFragmentè‡ªèº«é”€æ¯æ—¶è¿›è¡Œè°ƒç”¨ã€‚onDetachï¼šFragmentå’ŒActivityè§£é™¤å…³ç³»æ—¶è¿›è¡Œè°ƒç”¨ã€‚ Fragmentå¸¸ç”¨ç±»ä»¥åŠæ–¹æ³•è§£æ FragmentManagerï¼šé€šè¿‡getSupportFragmentManagerå‡½æ•°è·å–ï¼Œç”¨æ¥ç®¡ç†Activityä¸­çš„Fragmentã€‚
FragmentTransactionï¼šäº‹åŠ¡ã€‚å¯ä»¥é€šè¿‡FragmentManagerè°ƒç”¨beginTransaction()æ–¹æ³•æ¥å¼€å¯ä¸€ä¸ªäº‹åŠ¡ã€‚é€šè¿‡äº‹åŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹Fragmentè¿›è¡Œä¸€ç³»åˆ—çš„æ“ä½œã€‚å¦‚ä¸‹ï¼š
addï¼šæ·»åŠ ä¸€ä¸ªFragmentåˆ°Activityä¸­ã€‚
removeï¼šä»Activityä¸­ç§»é™¤ä¸€ä¸ªFragmentã€‚å¦‚æœFragmentæ²¡æœ‰è¢«åŠ å…¥å›é€€æ ˆä¸­ï¼Œåˆ™è¯¥Fragmentä¼šè¿›è¡Œé”€æ¯ã€‚
replaceï¼šç”¨å¦ä¸€ä¸ªFragmentæ›¿æ¢å½“å‰çš„Fragmentï¼Œæœ¬è´¨ä¸Šæ—¶å…ˆremoveå†addã€‚
hideï¼šéšè—å½“å‰çš„Fragmentï¼Œè®¾ç½®ä¸ºä¸å¯è§ï¼Œä¸ä¼šé”€æ¯ï¼Œä¸ä¹‹å¯¹åº”çš„æ˜¯showã€‚æœ¬è´¨æ˜¯å¯¹Viewè¿›è¡Œè°ƒç”¨äº†View.GONEã€‚
showï¼šæ˜¾ç¤ºä¹‹å‰éšè—çš„Fragmentï¼Œä¸ä¹‹å¯¹åº”çš„æ˜¯hideã€‚æœ¬è´¨æ˜¯å¯¹Viewè¿›è¡Œè°ƒç”¨äº†View.VISIBLEã€‚
detachï¼šå°†è§†å›¾è¿›è¡Œç§»é™¤ï¼Œä½†æ˜¯å¹¶ä¸é”€æ¯Fragmentï¼ŒFragmentä¾æ—§ç”±FragmentManagerè¿›è¡Œç®¡ç†ã€‚
addToBackStackï¼šå°†FragmentåŠ å…¥è¿”å›æ ˆã€‚å½“ç§»é™¤æˆ–æ›¿æ¢ä¸€ä¸ªFragmentå¹¶å‘è¿”å›æ ˆæ·»åŠ äº‹åŠ¡æ—¶ï¼Œç³»ç»Ÿä¼šåœæ­¢ï¼ˆè€Œéé”€æ¯ï¼‰ç§»é™¤çš„Fragmentã€‚å¦‚æœæ²¡æœ‰addToBackStackï¼Œåˆ™è¢«æ›¿æ¢çš„Fragmentä¼šç›´æ¥è¿›è¡Œé”€æ¯ã€‚
//ç¤ºä¾‹ï¼Œå¦‚æœç”¨æˆ·æ‰§è¡Œå›é€€æ“ä½œè¿›è¡ŒFragmentçš„æ¢å¤ï¼Œè¢«æ›¿æ¢çš„Fragmentå°†é‡æ–°å¯åŠ¨ã€‚ ft.replace(R.id.fl_content, LearnFragment()).addToBackStack(null).commitAllowingStateLoss() setMaxLifecycleï¼šè®¾å®šFragmentç”Ÿå‘½å‘¨æœŸæœ€é«˜ä¸Šé™ã€‚å¦‚æœè®¾ç½®çš„ç”Ÿå‘½å‘¨æœŸä¸Šé™ä½äºå½“å‰çš„ç”Ÿå‘½å‘¨æœŸä¸Šé™ï¼Œåˆ™ä¼šè¿›è¡Œå›é€€è®¾å®šçš„ç”Ÿå‘½å‘¨æœŸã€‚
æ¯”å¦‚ï¼Œå½“å‰ç”Ÿå‘½å‘¨æœŸä¸ºRESUMEï¼Œå¦‚æœè®¾ç½®MaxLifecycleä¸ºSTARTï¼Œåˆ™ç”Ÿå‘½å‘¨æœŸåˆ™ä¼šå›åˆ°RESUMEã€‚
è¯´ä¸€ä¸ªä¾‹å­ï¼Œåœ¨è°ƒç”¨hideå’Œshowå‡½æ•°çš„æ—¶å€™ï¼ŒFrgamentçš„ç”Ÿå‘½å‘¨æœŸå¹¶ä¸ä¼šè¿›è¡Œå˜åŒ–ã€‚ä½†æ˜¯æˆ‘å°±æ˜¯æƒ³è¦åœ¨showçš„æ—¶å€™è®©Fragmentèµ°åˆ°RESUMEå‘¢ï¼Ÿæ­¤æ—¶å¯ä»¥è¿›è¡Œå¦‚ä¸‹æ“ä½œã€‚
//hide ft.setMaxLifecycle(fragment,Lifecycle.State.STARTED).hide(fragment) //show ft.setMaxLifecycle(fragment,Lifecycle.State.RESUMED).show(fragment) commit/commitAllowingStateLossï¼šæäº¤ä¸€ä¸ªäº‹åŠ¡ã€‚commitå¦‚æœçŠ¶æ€ä¸¢å¤±åˆ™ä¼šæŠ›å¼‚å¸¸ï¼ŒcommitAllowingStateLossåˆ™ä¸ä¼šã€‚
æºç æµç¨‹åˆ†æ æ¥ä¸‹æ¥ç«™åœ¨æºç è§’åº¦å¯¹Fragmentè¿›è¡Œä¸€æ³¢åˆ†æï¼Œçœ‹çœ‹Fragmentæ˜¯å¦‚ä½•å®ç°çš„ã€‚ç›¸ä¿¡å¯ä»¥å¯¹Fragmentæœ‰æ›´æ·±å±‚æ¬¡çš„è®¤è¯†ã€‚
æˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ªFragmentåˆ°Activityä¸­æ—¶ï¼Œä¸€èˆ¬ä¼šè¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š
val fragmentManager = getSupportFragmentManager() // è·å–fragmentManager val ft = fragmentManager.beginTransaction() // å¼€å¯äº‹åŠ¡ ft.add(R.id.fl_content, LearnFragment(), tag) // æ·»åŠ  ft.commitAllowingStateLoss() // æäº¤äº‹åŠ¡ æˆ‘ç›¸ä¿¡ä¸Šé¢çš„ä»£ç ï¼Œå¤§å®¶å¯èƒ½éƒ½éå¸¸ç†Ÿæ‚‰äº†ï¼Œæ¥ä¸‹æ¥å°±æ ¹æ®ä¸Šè¿°ä»£ç ï¼Œä¸€æ­¥ä¸€æ­¥è¿›è¡Œæºç è·Ÿè¸ªåˆ†æã€‚
è·å–åˆ°FragmentManagerã€‚ getSupportFragmentManager()æ–¹æ³•ï¼Œåœ¨FragmentActivityç±»ä¸­ã€‚
FragmentActivity final FragmentController mFragments = FragmentController.createController(new HostCallbacks()); public FragmentManager getSupportFragmentManager() { //é€šè¿‡mFragments è·å–äº†FragmentManager è€ŒmFragmentså³ä¸º FragmentController return mFragments." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/7f5696492cae6fa58144225cacbbf690/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-01T21:38:07+08:00" />
<meta property="article:modified_time" content="2023-01-01T21:38:07+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="èœé¸Ÿç¨‹åºå‘˜åšå®¢" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">èœé¸Ÿç¨‹åºå‘˜åšå®¢</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Fragmentå…¨æ–‡è¯¦è§£(ç”±æµ…å…¥æ·±_æºç åˆ†æ)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>ç›¸ä¿¡androidå¼€å‘è€…ä»¬ä¸€å®šæˆ–å¤šæˆ–å°‘çš„ç”¨è¿‡Fragmentï¼Œä½†æ˜¯å¯¹äºå…¶æ›´æ·±å±‚æ¬¡çš„åŸç†æˆ‘çŒœå¯èƒ½å¤§éƒ¨åˆ†åº”è¯¥éƒ½æ²¡æœ‰äº†è§£è¿‡ï¼Œä»Šå¤©è¿™é‡Œå°±ç”±æµ…å…¥æ·±ï¼Œæ•´ä½“å¯¹Fragmentåšä¸€ä¸ªå…¨é¢è§£æã€‚</p> 
</blockquote> 
<h3><a id="_3"></a>åŸºç¡€ä»‹ç»</h3> 
<h4><a id="FragmentFragment_5"></a>Fragmentæ˜¯ä»€ä¹ˆä»¥åŠä¸ºä»€ä¹ˆè¦æœ‰Fragmentå‘¢ï¼Ÿ</h4> 
<p>Fragmentç›´è¯‘ä¸ºç¢ç‰‡ï¼Œæ˜¯Android 3.0å¼•å…¥çš„ç»„ä»¶ï¼ŒFragmentä¸èƒ½å•ç‹¬ä½¿ç”¨ï¼Œå¿…é¡»è¦ä¾èµ–äºActivityã€‚ Fragmentå¼•å…¥ä¹‹å‰å‡ ä¹æ‰€æœ‰çš„é€»è¾‘éƒ½è¢«æ”¾ç½®åœ¨Activityä¸­ï¼Œä½¿å¾—Activityè‡ƒè‚¿è€Œæ··ä¹±ï¼ŒFragmentä½œä¸ºä¸€ä¸ªå¾®å°çš„Activityè¯ç”Ÿã€‚</p> 
<p>å¦å¤–Fragmentè¿˜æœ‰<strong>ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹</strong>ï¼š</p> 
<ul><li>æ¨¡å—åŒ–ï¼šæˆ‘ä»¬å¯ä»¥æŒ‰ç…§æ¨¡å—å°†ä»£ç å†™å…¥åˆ°ä¸åŒçš„Fragmentä¸­ï¼Œä¹‹ååœ¨æ ¹æ®éœ€è¦åµŒå…¥åˆ°Activityã€‚</li><li>å¯é‡ç”¨ï¼šå¤šä¸ªActiviyå¯ä»¥å¤ç”¨åŒä¸€ä¸ªFragmentã€‚</li><li>é€‚é…æ€§ï¼šæ ¹æ®ä¸åŒçš„å¸ƒå±€æ ·å¼ï¼Œç»„åˆä¸åŒçš„Fragmentã€‚</li></ul> 
<h4><a id="Fragment_15"></a>Fragmentç”Ÿå‘½å‘¨æœŸ</h4> 
<p>Fragmentä½œä¸ºç®¡ç†ä¸€ç»„Viewçš„ç»„ä»¶ï¼Œä¹Ÿæ˜¯æœ‰è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸçš„ï¼Œå’ŒActivityç±»ä¼¼ï¼Œä½†åˆä¸å®Œå…¨ä¸€æ ·ã€‚åŸºæœ¬ç”Ÿå‘½å‘¨æœŸå¦‚ä¸‹å›¾æ‰€ä»¥ï¼š</p> 
<p><img src="https://images2.imgbox.com/a3/57/EdDjmLhX_o.jpg" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<ul><li>onAttachï¼šåœ¨Fragmentå’ŒActivityå…³è”æ—¶è°ƒç”¨ï¼Œä»…ä»…åªè°ƒç”¨ä¸€æ¬¡ã€‚æˆ‘ä»¬å¯ä»¥å¯¹ä¼ é€’ç»™Fragmentçš„å‚æ•°è¿›è¡Œè§£æã€‚</li><li>onCreateï¼šFragmentåˆ›å»ºæ—¶è°ƒç”¨ï¼Œä»…è°ƒç”¨ä¸€æ¬¡ã€‚</li><li>onCreateViewï¼šæ„å»ºFragment Viewçš„æ—¶å€™è¿›è¡Œè°ƒç”¨ï¼Œè¿”å›Fragmentè¦ç»˜åˆ¶å¸ƒå±€çš„æ ¹è§†å›¾ã€‚</li><li>onActivityCreatedï¼šåœ¨Activityæ‰§è¡Œå®ŒæˆonCreateä¹‹åè¿›è¡Œè°ƒç”¨ã€‚</li><li>onStartï¼šFragmentå¯¹ç”¨æˆ·å¯è§çš„æ—¶å€™è¿›è¡Œè°ƒç”¨ã€‚</li><li>onResumeï¼šFragmentå¯ä»¥å’Œç”¨æˆ·äº¤äº’çš„æ—¶å€™è¿›è¡Œè°ƒç”¨ã€‚</li><li>onPauseï¼šFragmentå¯¹ç”¨æˆ·ä¸å¯äº¤äº’çš„æ—¶å€™è¿›è¡Œè°ƒç”¨ã€‚</li><li>onStopï¼šFragmentå¯¹ç”¨æˆ·ä¸å¯è§æ—¶è¿›è¡Œè°ƒç”¨ã€‚</li><li>onDestroyViewï¼šFragmentéœ€è¦ç§»é™¤è§†å›¾æ—¶è¿›è¡Œè°ƒç”¨ã€‚</li><li>onDestroyï¼šFragmentè‡ªèº«é”€æ¯æ—¶è¿›è¡Œè°ƒç”¨ã€‚</li><li>onDetachï¼šFragmentå’ŒActivityè§£é™¤å…³ç³»æ—¶è¿›è¡Œè°ƒç”¨ã€‚</li></ul> 
<h4><a id="Fragment_36"></a>Fragmentå¸¸ç”¨ç±»ä»¥åŠæ–¹æ³•è§£æ</h4> 
<p><strong>FragmentManager</strong>ï¼šé€šè¿‡<code>getSupportFragmentManager</code>å‡½æ•°è·å–ï¼Œç”¨æ¥ç®¡ç†Activityä¸­çš„Fragmentã€‚</p> 
<p><strong>FragmentTransaction</strong>ï¼šäº‹åŠ¡ã€‚å¯ä»¥é€šè¿‡<code>FragmentManager</code>è°ƒç”¨<code>beginTransaction()</code>æ–¹æ³•æ¥å¼€å¯ä¸€ä¸ªäº‹åŠ¡ã€‚é€šè¿‡äº‹åŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹Fragmentè¿›è¡Œä¸€ç³»åˆ—çš„æ“ä½œã€‚å¦‚ä¸‹ï¼š</p> 
<ol><li> <p><strong>add</strong>ï¼šæ·»åŠ ä¸€ä¸ªFragmentåˆ°Activityä¸­ã€‚</p> </li><li> <p><strong>remove</strong>ï¼šä»Activityä¸­ç§»é™¤ä¸€ä¸ªFragmentã€‚å¦‚æœFragmentæ²¡æœ‰è¢«åŠ å…¥å›é€€æ ˆä¸­ï¼Œåˆ™è¯¥Fragmentä¼šè¿›è¡Œé”€æ¯ã€‚</p> </li><li> <p><strong>replace</strong>ï¼šç”¨å¦ä¸€ä¸ªFragmentæ›¿æ¢å½“å‰çš„Fragmentï¼Œæœ¬è´¨ä¸Šæ—¶å…ˆremoveå†addã€‚</p> </li><li> <p><strong>hide</strong>ï¼šéšè—å½“å‰çš„Fragmentï¼Œè®¾ç½®ä¸ºä¸å¯è§ï¼Œä¸ä¼šé”€æ¯ï¼Œä¸ä¹‹å¯¹åº”çš„æ˜¯showã€‚æœ¬è´¨æ˜¯å¯¹<code>View</code>è¿›è¡Œè°ƒç”¨äº†<code>View.GONE</code>ã€‚</p> </li><li> <p><strong>show</strong>ï¼šæ˜¾ç¤ºä¹‹å‰éšè—çš„Fragmentï¼Œä¸ä¹‹å¯¹åº”çš„æ˜¯hideã€‚æœ¬è´¨æ˜¯å¯¹<code>View</code>è¿›è¡Œè°ƒç”¨äº†<code>View.VISIBLE</code>ã€‚</p> </li><li> <p><strong>detach</strong>ï¼šå°†è§†å›¾è¿›è¡Œç§»é™¤ï¼Œä½†æ˜¯å¹¶ä¸é”€æ¯Fragmentï¼ŒFragmentä¾æ—§ç”±FragmentManagerè¿›è¡Œç®¡ç†ã€‚</p> </li><li> <p><strong>addToBackStack</strong>ï¼šå°†FragmentåŠ å…¥è¿”å›æ ˆã€‚<strong>å½“ç§»é™¤æˆ–æ›¿æ¢ä¸€ä¸ªFragmentå¹¶å‘è¿”å›æ ˆæ·»åŠ äº‹åŠ¡æ—¶ï¼Œç³»ç»Ÿä¼šåœæ­¢ï¼ˆè€Œéé”€æ¯ï¼‰ç§»é™¤çš„Fragmentã€‚å¦‚æœæ²¡æœ‰addToBackStackï¼Œåˆ™è¢«æ›¿æ¢çš„Fragmentä¼šç›´æ¥è¿›è¡Œé”€æ¯</strong>ã€‚</p> <pre><code class="prism language-kotlin"><span class="token comment">//ç¤ºä¾‹ï¼Œå¦‚æœç”¨æˆ·æ‰§è¡Œå›é€€æ“ä½œè¿›è¡ŒFragmentçš„æ¢å¤ï¼Œè¢«æ›¿æ¢çš„Fragmentå°†é‡æ–°å¯åŠ¨ã€‚</span>
ft<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>fl_content<span class="token punctuation">,</span> <span class="token function">LearnFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addToBackStack</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">commitAllowingStateLoss</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> </li><li> <p><strong>setMaxLifecycle</strong>ï¼šè®¾å®šFragmentç”Ÿå‘½å‘¨æœŸæœ€é«˜ä¸Šé™ã€‚å¦‚æœè®¾ç½®çš„ç”Ÿå‘½å‘¨æœŸä¸Šé™ä½äºå½“å‰çš„ç”Ÿå‘½å‘¨æœŸä¸Šé™ï¼Œåˆ™ä¼šè¿›è¡Œå›é€€è®¾å®šçš„ç”Ÿå‘½å‘¨æœŸã€‚</p> <p>æ¯”å¦‚ï¼Œå½“å‰ç”Ÿå‘½å‘¨æœŸä¸ºRESUMEï¼Œå¦‚æœè®¾ç½®MaxLifecycleä¸ºSTARTï¼Œåˆ™ç”Ÿå‘½å‘¨æœŸåˆ™ä¼šå›åˆ°RESUMEã€‚</p> <p>è¯´ä¸€ä¸ªä¾‹å­ï¼Œ<strong>åœ¨è°ƒç”¨<code>hide</code>å’Œ<code>show</code>å‡½æ•°çš„æ—¶å€™ï¼ŒFrgamentçš„ç”Ÿå‘½å‘¨æœŸå¹¶ä¸ä¼šè¿›è¡Œå˜åŒ–ã€‚ä½†æ˜¯æˆ‘å°±æ˜¯æƒ³è¦åœ¨showçš„æ—¶å€™è®©Fragmentèµ°åˆ°RESUMEå‘¢</strong>ï¼Ÿæ­¤æ—¶å¯ä»¥è¿›è¡Œå¦‚ä¸‹æ“ä½œã€‚</p> <pre><code class="prism language-kotlin"><span class="token comment">//hide</span>
ft<span class="token punctuation">.</span><span class="token function">setMaxLifecycle</span><span class="token punctuation">(</span>fragment<span class="token punctuation">,</span>Lifecycle<span class="token punctuation">.</span>State<span class="token punctuation">.</span>STARTED<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span>fragment<span class="token punctuation">)</span>
<span class="token comment">//show</span>
ft<span class="token punctuation">.</span><span class="token function">setMaxLifecycle</span><span class="token punctuation">(</span>fragment<span class="token punctuation">,</span>Lifecycle<span class="token punctuation">.</span>State<span class="token punctuation">.</span>RESUMED<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span>fragment<span class="token punctuation">)</span>
</code></pre> </li><li> <p><strong>commit/commitAllowingStateLoss</strong>ï¼šæäº¤ä¸€ä¸ªäº‹åŠ¡ã€‚commitå¦‚æœçŠ¶æ€ä¸¢å¤±åˆ™ä¼šæŠ›å¼‚å¸¸ï¼ŒcommitAllowingStateLossåˆ™ä¸ä¼šã€‚</p> </li></ol> 
<h3><a id="_78"></a>æºç æµç¨‹åˆ†æ</h3> 
<p>æ¥ä¸‹æ¥ç«™åœ¨æºç è§’åº¦å¯¹Fragmentè¿›è¡Œä¸€æ³¢åˆ†æï¼Œçœ‹çœ‹Fragmentæ˜¯å¦‚ä½•å®ç°çš„ã€‚ç›¸ä¿¡å¯ä»¥å¯¹Fragmentæœ‰æ›´æ·±å±‚æ¬¡çš„è®¤è¯†ã€‚</p> 
<p>æˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ªFragmentåˆ°Activityä¸­æ—¶ï¼Œä¸€èˆ¬ä¼šè¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š</p> 
<pre><code class="prism language-kotlin"><span class="token keyword">val</span> fragmentManager <span class="token operator">=</span> <span class="token function">getSupportFragmentManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// è·å–fragmentManager</span>
<span class="token keyword">val</span> ft <span class="token operator">=</span> fragmentManager<span class="token punctuation">.</span><span class="token function">beginTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// å¼€å¯äº‹åŠ¡</span>
ft<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>fl_content<span class="token punctuation">,</span> <span class="token function">LearnFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> tag<span class="token punctuation">)</span> <span class="token comment">// æ·»åŠ </span>
ft<span class="token punctuation">.</span><span class="token function">commitAllowingStateLoss</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// æäº¤äº‹åŠ¡</span>
</code></pre> 
<p>æˆ‘ç›¸ä¿¡ä¸Šé¢çš„ä»£ç ï¼Œå¤§å®¶å¯èƒ½éƒ½éå¸¸ç†Ÿæ‚‰äº†ï¼Œæ¥ä¸‹æ¥å°±æ ¹æ®ä¸Šè¿°ä»£ç ï¼Œä¸€æ­¥ä¸€æ­¥è¿›è¡Œæºç è·Ÿè¸ªåˆ†æã€‚</p> 
<h4><a id="FragmentManager_93"></a>è·å–åˆ°FragmentManagerã€‚</h4> 
<p><code>getSupportFragmentManager()</code>æ–¹æ³•ï¼Œåœ¨<code>FragmentActivity</code>ç±»ä¸­ã€‚</p> 
<pre><code class="prism language-java"><span class="token class-name">FragmentActivity</span>
<span class="token keyword">final</span> <span class="token class-name">FragmentController</span> mFragments <span class="token operator">=</span> <span class="token class-name">FragmentController</span><span class="token punctuation">.</span><span class="token function">createController</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HostCallbacks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token class-name">FragmentManager</span> <span class="token function">getSupportFragmentManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//é€šè¿‡mFragments è·å–äº†FragmentManager  è€ŒmFragmentså³ä¸º FragmentController</span>
	<span class="token keyword">return</span> mFragments<span class="token punctuation">.</span><span class="token function">getSupportFragmentManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">FragmentController</span>
<span class="token comment">//FragmentController é€šè¿‡createControllerå‡½æ•°åˆ›å»ºï¼Œå…¶å®å³ä¸ºnewäº†FragmentControllerå¯¹è±¡ï¼Œä¼ å…¥äº†HostCallbacks</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">FragmentController</span> <span class="token function">createController</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">FragmentHostCallback</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> callbacks<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">FragmentController</span><span class="token punctuation">(</span><span class="token function">checkNotNull</span><span class="token punctuation">(</span>callbacks<span class="token punctuation">,</span> <span class="token string">"callbacks == null"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token class-name">FragmentManager</span> <span class="token function">getSupportFragmentManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//mHostå³ä¸ºä¼ å…¥çš„HostCallbacksï¼Œå³é€šè¿‡HostCallbacksè·å–åˆ°äº†FragmentManager</span>
    <span class="token keyword">return</span> mHost<span class="token punctuation">.</span>mFragmentManager<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//HostCallbacks ç»§æ‰¿è‡ª FragmentHostCallbackï¼Œè€ŒmFragmentManageråœ¨FragmentHostCallbackä¸­è¿›è¡Œäº†åˆå§‹åŒ–ã€‚</span>
<span class="token class-name">FragmentHostCallback</span>
<span class="token keyword">final</span> <span class="token class-name">FragmentManager</span> mFragmentManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FragmentManagerImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>æ‰€ä»¥åœ¨<code>FragmentActivity</code>ä¸­ä¼šæŒæœ‰<code>FragmentController</code>å¯¹è±¡ï¼Œè€Œ<code>FragmentController</code>å…¶å®æ˜¯æš´éœ²åœ¨å¤–çš„ä»£ç†ç±»ï¼Œç›¸å…³çš„é€»è¾‘å‡äº¤ç”±<code>HostCallbacks</code>å®Œæˆï¼Œè€Œ<code>HostCallbacks</code>å†…éƒ¨åˆ™æ„å»ºäº†<code>FragmentManagerImpl</code>å³æˆ‘ä»¬æ‰€éœ€è¦çš„<code>FragmentManager</code>å¯¹è±¡ã€‚è€Œ<code>HostCallbacks</code>ä¹Ÿæä¾›äº†ä¸€äº›Fragmentä¸€äº›å¸¸ç”¨çš„å‚æ•°ï¼Œæ¯”å¦‚è·å–<code>Activity</code>ã€<code>Context</code>ã€<code>Handler</code>ç­‰ï¼Œè¯¥å¯¹è±¡ä¼šåœ¨Fragmentè¿›è¡Œattachçš„æ—¶å€™ä¼ é€’ç»™Fragmentã€‚</p> 
<pre><code class="prism language-java"><span class="token class-name">Activity</span> <span class="token function">getActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> mActivity<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">Context</span> <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> mContext<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">Handler</span> <span class="token function">getHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> mHandler<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="beginTransaction_134"></a>beginTransactionå¹²äº†ä»€ä¹ˆäº‹æƒ…</h4> 
<p>æ¥ä¸‹æ¥çœ‹<code>beginTransaction</code>åšäº†ä»€ä¹ˆäº‹æƒ…ã€‚</p> 
<pre><code class="prism language-java"><span class="token class-name">FragmentManager</span>
<span class="token keyword">public</span> <span class="token class-name">FragmentTransaction</span> <span class="token function">beginTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">//ä»…ä»…è¿”å›äº†BackStackRecordå¯¹è±¡</span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BackStackRecord</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">BackStackRecord</span>
<span class="token class-name">BackStackRecord</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">FragmentManager</span> manager<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>manager<span class="token punctuation">.</span><span class="token function">getFragmentFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> manager<span class="token punctuation">.</span><span class="token function">getHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span>
    <span class="token operator">?</span> manager<span class="token punctuation">.</span><span class="token function">getHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mManager <span class="token operator">=</span> manager<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><code>beginTransaction</code>æ˜¯FragmentManagerçš„ä»£ç ï¼Œæ‰€ä»¥è‡ªç„¶åœ¨FragmentManagerä¸­å¯»æ‰¾ã€‚ä½†æ˜¯æˆ‘ä»¬å‘ç°å¾ˆç®€å•ï¼Œ<code>beginTransaction</code>å…¶å®å°±æ˜¯ç®€å•çš„è¿”å›äº†ä¸€ä¸ª<code>BackStackRecord</code>å¯¹è±¡ï¼ŒåŒæ—¶å®ƒæŒæœ‰äº†<code>FragmentManager</code>å¯¹è±¡ã€‚</p> 
<h4><a id="ADD_156"></a>ADDæ“ä½œ</h4> 
<p>æˆ‘ä»¬æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹addæ“ä½œã€‚é€šè¿‡ä¸Šé¢æˆ‘ä»¬çŸ¥é“<code>FragmentTransaction</code>å…¶å®æ˜¯<code>BackStackRecord</code>å¯¹è±¡ã€‚æˆ‘ä»¬è·Ÿä¸€ä¸‹<code>add</code>æ“ä½œã€‚</p> 
<pre><code class="prism language-java"><span class="token class-name">FragmentTransaction</span>
<span class="token keyword">public</span> <span class="token class-name">FragmentTransaction</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token annotation punctuation">@IdRes</span> <span class="token keyword">int</span> containerViewId<span class="token punctuation">,</span> <span class="token annotation punctuation">@NonNull</span> <span class="token class-name">Fragment</span> fragment<span class="token punctuation">,</span>
<span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span> tag<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//è°ƒç”¨doAddOpæ³¨æ„æ¬¡æ•°ä¼ å…¥çš„æœ€åä¸€ä¸ªå‚æ•°ä¸º OP_ADD</span>
    doAddOp <span class="token punctuation">(</span>containerViewId<span class="token punctuation">,</span> fragment<span class="token punctuation">,</span> tag<span class="token punctuation">,</span> <span class="token constant">OP_ADD</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">doAddOp</span><span class="token punctuation">(</span><span class="token keyword">int</span> containerViewId<span class="token punctuation">,</span> <span class="token class-name">Fragment</span> fragment<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span> tag<span class="token punctuation">,</span> <span class="token keyword">int</span> opcmd<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token comment">//tag èµ‹å€¼</span>
    fragment<span class="token punctuation">.</span>mTag <span class="token operator">=</span> tag<span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token comment">//å®¹å™¨Id èµ‹å€¼</span>
    fragment<span class="token punctuation">.</span>mContainerId <span class="token operator">=</span> fragment<span class="token punctuation">.</span>mFragmentId <span class="token operator">=</span> containerViewId
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token comment">//å°†OP_ADDå’Œfragment æ”¾å…¥Opå¯¹è±¡ä¸­ï¼Œè°ƒç”¨addOp</span>
    <span class="token function">addOp</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Op</span><span class="token punctuation">(</span>opcmd<span class="token punctuation">,</span> fragment<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Op</span><span class="token punctuation">&gt;</span></span> mOps <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">addOp</span><span class="token punctuation">(</span><span class="token class-name">Op</span> op<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">//æ”¾å…¥æ•°ç»„ä¸­</span>
    mOps<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>op<span class="token punctuation">)</span><span class="token punctuation">;</span>
    op<span class="token punctuation">.</span>mEnterAnim <span class="token operator">=</span> mEnterAnim<span class="token punctuation">;</span>
    op<span class="token punctuation">.</span>mExitAnim <span class="token operator">=</span> mExitAnim<span class="token punctuation">;</span>
    op<span class="token punctuation">.</span>mPopEnterAnim <span class="token operator">=</span> mPopEnterAnim<span class="token punctuation">;</span>
    op<span class="token punctuation">.</span>mPopExitAnim <span class="token operator">=</span> mPopExitAnim<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>æ€»ç»“</strong>ï¼š<code>add</code>æ“ä½œå³å°†å½“å‰çš„å‘½ä»¤å’ŒFragmentæ”¾åˆ°äº†é›†åˆé‡Œé¢å­˜äº†èµ·æ¥ã€‚è€ŒOpåˆ™æ˜¯æœ€ç»ˆå­˜çš„å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹å…¶çš„æ•°æ®ç»“æ„ã€‚</p> 
<pre><code> static final class Op {
        int mCmd;//ä»£è¡¨å½“å‰å…·ä½“æ˜¯ä»€ä¹ˆæ“ä½œï¼Œæ¯”å¦‚addã€replaceã€removeã€hide.....
        Fragment mFragment;
        int mEnterAnim;
        int mExitAnim;
        int mPopEnterAnim;
        int mPopExitAnim;
        Lifecycle.State mOldMaxState;
        Lifecycle.State mCurrentMaxState;
}
</code></pre> 
<h4><a id="COMMIT_205"></a>COMMITå¹²äº†ä»€ä¹ˆ</h4> 
<p>å¥½äº†ï¼Œä¸çŸ¥ä¸è§‰æˆ‘ä»¬å°±åˆ°äº†æœ€åä¸€æ­¥ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹<code>commit</code>å¹²äº†ä»€ä¹ˆå§ã€‚ä¸Šæºç ã€‚</p> 
<p>æˆ‘ç›¸ä¿¡ç°åœ¨ç»å¸¸ç”¨çš„æ˜¯<code>commitAllowingStateLoss</code>å§ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥çœ‹å®ƒã€‚</p> 
<pre><code class="prism language-java">    <span class="token class-name">BackStackRecord</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">commitAllowingStateLoss</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    	<span class="token comment">//è°ƒç”¨commitInternal allowStateLoss = true</span>
        <span class="token keyword">return</span> <span class="token function">commitInternal</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">int</span> <span class="token function">commitInternal</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> allowStateLoss<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token comment">//è°ƒç”¨åˆ°FragmentManager çš„enqueueActionæ–¹æ³•</span>
        mManager<span class="token punctuation">.</span><span class="token function">enqueueAction</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> allowStateLoss<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> mIndex<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token class-name">FragmentManager</span>
    <span class="token keyword">void</span> <span class="token function">enqueueAction</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">OpGenerator</span> action<span class="token punctuation">,</span> <span class="token keyword">boolean</span> allowStateLoss<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>allowStateLoss<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        	<span class="token comment">//ç”±äºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯commitAllowingStateLoss æ‰€ä»¥allowStateLoss = trueï¼Œæ‰€ä»¥ä¸ä¼šæ ¡éªŒä¸‹é¢çš„ä¸œè¥¿ï¼Œå³ä¸ä¼šæŠ›å‡ºä¸‹é¢çš„å¼‚å¸¸ã€‚</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mHost <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>mDestroyed<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">"FragmentManager has been destroyed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">"FragmentManager has not been attached to a "</span>
                            <span class="token operator">+</span> <span class="token string">"host."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token function">checkStateLoss</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>mPendingActions<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
            <span class="token comment">//åŠ å…¥æ•°ç»„</span>
            mPendingActions<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//ç»§ç»­è°ƒç”¨</span>
            <span class="token function">scheduleCommit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">void</span> <span class="token function">scheduleCommit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>mPendingActions<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
            <span class="token comment">//æ ¸å¿ƒ å°†mExecCommit è°ƒåº¦åˆ°ä¸»çº¿ç¨‹æ‰§è¡Œ</span>
            mHost<span class="token punctuation">.</span><span class="token function">getHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>mExecCommit<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
	
    <span class="token keyword">private</span> <span class="token class-name">Runnable</span> mExecCommit <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">execPendingActions</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">boolean</span> <span class="token function">execPendingActions</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> allowStateLoss<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token keyword">boolean</span> didSomething <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token comment">//å°† mPendingActions çš„BackStackRecord å¯¹è±¡æ”¾åˆ°äº†mTmpRecordsæ•°ç»„ä¸­</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">generateOpsForPendingActions</span><span class="token punctuation">(</span>mTmpRecords<span class="token punctuation">,</span> mTmpIsPop<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            mExecutingActions <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">//æ‰§è¡Œ</span>
                <span class="token function">removeRedundantOperationsAndExecute</span><span class="token punctuation">(</span>mTmpRecords<span class="token punctuation">,</span> mTmpIsPop<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">cleanupExec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            didSomething <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token keyword">return</span> didSomething<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

</code></pre> 
<p><code>Commit</code>çš„æ“ä½œæ¯”è¾ƒå¤šä¸€ç‚¹ï¼Œåˆ°è¿™é‡Œé¦–å…ˆæ€»ç»“ä¸€ä¸‹ã€‚</p> 
<ol><li>æœ€ç»ˆ<code>commit</code>æ“ä½œä¼šäº¤ç»™<code>FragmentManager</code>è¿›è¡Œç»Ÿä¸€æ‰§è¡Œã€‚</li><li>æœ€ç»ˆçš„æ‰§è¡Œæ“ä½œè¢«è°ƒåº¦åˆ°äº†ä¸»çº¿ç¨‹è¿›è¡Œã€‚</li><li><code>commitAllowingStateLoss</code>å’Œ<code>commit</code>çš„æœ¬è´¨åŒºåˆ«æ˜¯ï¼Œä¸ä¼šå¯¹ä¸€äº›æ„å¤–çš„çŠ¶æ€è¿›è¡Œæ ¡éªŒè€ŒæŠ›å‡ºå¼‚å¸¸ï¼Œæ¯”å¦‚<code>mHost==null</code>æˆ–è€…å·²ç»<code>destroy</code>æˆ–è€…<code>activity å·²ç»è°ƒç”¨è¿‡onSaveInstanceState</code>äº†ã€‚</li></ol> 
<p>æ¥ä¸‹æ¥ç»§ç»­è°ƒç”¨åˆ°äº†<code>removeRedundantOperationsAndExecute</code>ï¼Œä¸­å›½è°ƒç”¨é“¾ä¹Ÿæ¯”è¾ƒå¤æ‚ä¸€ç‚¹ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥æ”¾è°ƒç”¨é“¾äº†ã€‚</p> 
<pre><code class="prism language-java"><span class="token class-name">FragmentManager</span> removeRedundantOperationsAndExecute 
ğŸ‘‡
<span class="token class-name">FragmentManager</span> executeOpsTogether
ğŸ‘‡
<span class="token class-name">FragmentManager</span> executeOps
ğŸ‘‡
<span class="token class-name">BackStackRecord</span> executeOps <span class="token comment">// æ³¨æ„æ­¤æ—¶æ‰§è¡Œåˆ°äº†BackStackRecordçš„executePopOps</span>
</code></pre> 
<p>æ¥ä¸‹æ¥æ¯”è¾ƒé‡è¦ä¸€ç‚¹ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹<code>BackStackRecord</code>é‡Œé¢çš„<code>executePopOps</code>æ˜¯å¦‚ä½•è¿›è¡Œå®ç°çš„</p> 
<pre><code class="prism language-java"><span class="token keyword">void</span> <span class="token function">executeOps</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> opNum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> opNum <span class="token operator">&lt;</span> numOps<span class="token punctuation">;</span> opNum<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">final</span> <span class="token class-name">Op</span> op <span class="token operator">=</span> mOps<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>opNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">final</span> <span class="token class-name">Fragment</span> f <span class="token operator">=</span> op<span class="token punctuation">.</span>mFragment<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>f <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                f<span class="token punctuation">.</span><span class="token function">setPopDirection</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                f<span class="token punctuation">.</span><span class="token function">setNextTransition</span><span class="token punctuation">(</span>mTransition<span class="token punctuation">)</span><span class="token punctuation">;</span>
                f<span class="token punctuation">.</span><span class="token function">setSharedElementNames</span><span class="token punctuation">(</span>mSharedElementSourceNames<span class="token punctuation">,</span> mSharedElementTargetNames<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span>op<span class="token punctuation">.</span>mCmd<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">case</span> <span class="token constant">OP_ADD</span><span class="token operator">:</span>
                    f<span class="token punctuation">.</span><span class="token function">setAnimations</span><span class="token punctuation">(</span>op<span class="token punctuation">.</span>mEnterAnim<span class="token punctuation">,</span> op<span class="token punctuation">.</span>mExitAnim<span class="token punctuation">,</span> op<span class="token punctuation">.</span>mPopEnterAnim<span class="token punctuation">,</span> op<span class="token punctuation">.</span>mPopExitAnim<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    mManager<span class="token punctuation">.</span><span class="token function">setExitAnimationOrder</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//æ·»åŠ  å†…éƒ¨fragmentæŒæœ‰äº†å½“å‰çš„FragmentManagerï¼ŒåŒæ—¶æ„å»ºäº†FragmentStateManager å°†fragmentæ”¾å…¥åˆ°äº†FragmentStoreçš„addå’Œactiveä¸­ fragment.removing è®¾ç½®ä¸ºäº†false</span>
                    mManager<span class="token punctuation">.</span><span class="token function">addFragment</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token constant">OP_REMOVE</span><span class="token operator">:</span>
                    f<span class="token punctuation">.</span><span class="token function">setAnimations</span><span class="token punctuation">(</span>op<span class="token punctuation">.</span>mEnterAnim<span class="token punctuation">,</span> op<span class="token punctuation">.</span>mExitAnim<span class="token punctuation">,</span> op<span class="token punctuation">.</span>mPopEnterAnim<span class="token punctuation">,</span> op<span class="token punctuation">.</span>mPopExitAnim<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    mManager<span class="token punctuation">.</span><span class="token function">removeFragment</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
             <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
             <span class="token comment">//é‡ç‚¹  çŠ¶æ€ç§»åŠ¨</span>
             mManager<span class="token punctuation">.</span><span class="token function">moveToState</span><span class="token punctuation">(</span>mManager<span class="token punctuation">.</span>mCurState<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> 
<p>è¿˜è®°å¾—ä¹‹å‰åœ¨<code>add</code>æ—¶å€™çœ‹åˆ°çš„æ•°ç»„å—ï¼Ÿåœ¨<code>BackStackRecord</code>ä¸­è¢«æ‹¿å‡ºæ¥è¿›è¡Œå¾ªç¯è·å–éœ€è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚æ¯”å¦‚<code>add</code>ï¼Œåˆ™æ‰§è¡Œäº†<code>addFragment</code>ã€‚å…¶ä»–çš„å‘½ä»¤ä¹Ÿä¸€æ ·åœ¨è¿™ä¸ªåœ°æ–¹æ‰§è¡Œï¼Œå°±ä¸ä¸€ä¸€åˆ—ä¸¾äº†ã€‚</p> 
<pre><code class="prism language-java">	<span class="token class-name">FragmentManager</span>
    <span class="token class-name">FragmentStateManager</span> <span class="token function">addFragment</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">Fragment</span> fragment<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">FragmentStateManager</span> fragmentStateManager <span class="token operator">=</span> <span class="token function">createOrGetFragmentStateManager</span><span class="token punctuation">(</span>fragment<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æŒæœ‰FragmentManager</span>
        fragment<span class="token punctuation">.</span>mFragmentManager <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token comment">//fragmentStateManager æ”¾å…¥storeçš„activeæ•°ç»„</span>
        mFragmentStore<span class="token punctuation">.</span><span class="token function">makeActive</span><span class="token punctuation">(</span>fragmentStateManager<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fragment<span class="token punctuation">.</span>mDetached<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//å°†fragmentæ”¾å…¥store</span>
            mFragmentStore<span class="token punctuation">.</span><span class="token function">addFragment</span><span class="token punctuation">(</span>fragment<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//è®¾ç½®mRemoving ä¸ºfalse</span>
            fragment<span class="token punctuation">.</span>mRemoving <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>fragment<span class="token punctuation">.</span>mView <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">//è®¾ç½®mHiddenChangedä¸ºfalse</span>
                fragment<span class="token punctuation">.</span>mHiddenChanged <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isMenuAvailable</span><span class="token punctuation">(</span>fragment<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                mNeedMenuInvalidate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> fragmentStateManager<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹<code>moveToState</code>å‡½æ•°</p> 
<pre><code class="prism language-java"><span class="token class-name">FragmentManager</span>
<span class="token keyword">void</span> <span class="token function">moveToState</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">Fragment</span> f<span class="token punctuation">,</span> <span class="token keyword">int</span> newState<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">FragmentStateManager</span> fragmentStateManager <span class="token operator">=</span> mFragmentStore<span class="token punctuation">.</span><span class="token function">getFragmentStateManager</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>mWho<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        newState <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>newState<span class="token punctuation">,</span> fragmentStateManager<span class="token punctuation">.</span><span class="token function">computeExpectedState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>f<span class="token punctuation">.</span>mState <span class="token operator">&lt;=</span> newState<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
         <span class="token comment">// If we are moving to the same state, we do not need to give up on the animation.</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>f<span class="token punctuation">.</span>mState <span class="token operator">&lt;</span> newState <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>mExitAnimationCancellationSignals<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// The fragment is currently being animated...  but!  Now we</span>
                <span class="token comment">// want to move our state back up.  Give up on waiting for the</span>
                <span class="token comment">// animation and proceed from where we are.</span>
                <span class="token function">cancelExitAnimation</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span>f<span class="token punctuation">.</span>mState<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">case</span> <span class="token class-name">Fragment</span><span class="token punctuation">.</span><span class="token constant">INITIALIZING</span><span class="token operator">:</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>newState <span class="token operator">&gt;</span> <span class="token class-name">Fragment</span><span class="token punctuation">.</span><span class="token constant">INITIALIZING</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token comment">//attach</span>
                        fragmentStateManager<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token comment">// fall through</span>
                <span class="token keyword">case</span> <span class="token class-name">Fragment</span><span class="token punctuation">.</span><span class="token constant">ATTACHED</span><span class="token operator">:</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>newState <span class="token operator">&gt;</span> <span class="token class-name">Fragment</span><span class="token punctuation">.</span><span class="token constant">ATTACHED</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token comment">//create</span>
                        fragmentStateManager<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token comment">// fall through</span>
                <span class="token keyword">case</span> <span class="token class-name">Fragment</span><span class="token punctuation">.</span><span class="token constant">CREATED</span><span class="token operator">:</span>
                    <span class="token comment">// We want to unconditionally run this anytime we do a moveToState that</span>
                    <span class="token comment">// moves the Fragment above INITIALIZING, including cases such as when</span>
                    <span class="token comment">// we move from CREATED =&gt; CREATED as part of the case fall through above.</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>newState <span class="token operator">&gt;</span> <span class="token class-name">Fragment</span><span class="token punctuation">.</span><span class="token constant">INITIALIZING</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        fragmentStateManager<span class="token punctuation">.</span><span class="token function">ensureInflatedView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                    <span class="token keyword">if</span> <span class="token punctuation">(</span>newState <span class="token operator">&gt;</span> <span class="token class-name">Fragment</span><span class="token punctuation">.</span><span class="token constant">CREATED</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        fragmentStateManager<span class="token punctuation">.</span><span class="token function">createView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
        	<span class="token keyword">switch</span> <span class="token punctuation">(</span>f<span class="token punctuation">.</span>mState<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">case</span> <span class="token class-name">Fragment</span><span class="token punctuation">.</span><span class="token constant">RESUMED</span><span class="token operator">:</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>newState <span class="token operator">&lt;</span> <span class="token class-name">Fragment</span><span class="token punctuation">.</span><span class="token constant">RESUMED</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        fragmentStateManager<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token comment">// fall through</span>
                <span class="token keyword">case</span> <span class="token class-name">Fragment</span><span class="token punctuation">.</span><span class="token constant">STARTED</span><span class="token operator">:</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>newState <span class="token operator">&lt;</span> <span class="token class-name">Fragment</span><span class="token punctuation">.</span><span class="token constant">STARTED</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        fragmentStateManager<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token punctuation">}</span>
        f<span class="token punctuation">.</span>mState <span class="token operator">=</span> newState<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>æ‰¾åˆ°äº†ï¼Œæœ€ç»ˆåœ¨<code>Fragment</code>çš„<code>moveToState</code>å‡½æ•°ä¸­ï¼Œå¯¹FragmentçŠ¶æ€è¿›è¡Œäº†æµè½¬ã€‚æœŸæœ›çš„çŠ¶æ€é€šè¿‡<code>fragmentStateManager</code>çš„<code>computeExpectedState</code>è¿›è¡Œè®¡ç®—ã€‚å¹¶ä¸”å„ä¸ªç”Ÿå‘½å‘¨æœŸå‡è°ƒç”¨åˆ°äº†<code>FragmentStateManager</code>è¿›è¡Œå¤„ç†ã€‚</p> 
<p>é‚£ä¹ˆ<code>Activity</code>çš„ç”Ÿå‘½å‘¨æœŸå¦‚ä½•åˆ†å‘ç»™Fragmentäº†å‘¢ï¼Ÿè¿˜è®°å¾—ä¹‹å‰åœ¨Activityä¸­çš„<code>FragmentController</code>äº†å—ï¼Ÿå…¶ä»£ç†äº†<code>FragmentManager</code>ã€‚</p> 
<p>æ¯”å¦‚è¦å‘ŠçŸ¥<code>Activity</code>å½“å‰å·²ç»Createå®Œæˆäº†ï¼Œåˆ™æ˜¯å¦‚ä¸‹æµç¨‹ï¼š</p> 
<pre><code class="prism language-java">    <span class="token class-name">FragmentActivity</span>
    protect <span class="token keyword">void</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        mFragments<span class="token punctuation">.</span><span class="token function">dispatchActivityCreated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//ğŸ‘‡</span>
    <span class="token comment">//FragmentController</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">dispatchActivityCreated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        mHost<span class="token punctuation">.</span>mFragmentManager<span class="token punctuation">.</span><span class="token function">dispatchActivityCreated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//ğŸ‘‡</span>
    <span class="token comment">//FragmentManager</span>
    <span class="token keyword">void</span> <span class="token function">dispatchActivityCreated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token function">dispatchStateChange</span><span class="token punctuation">(</span><span class="token class-name">Fragment</span><span class="token punctuation">.</span><span class="token constant">ACTIVITY_CREATED</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">dispatchStateChange</span><span class="token punctuation">(</span><span class="token keyword">int</span> nextState<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    	<span class="token comment">//æœ€ç»ˆæ‰§è¡Œåˆ°äº†moveToStateå‡½æ•°</span>
        <span class="token function">moveToState</span><span class="token punctuation">(</span>nextState<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>éƒ½åˆ°è¿™é‡Œäº†ï¼Œé‚£æˆ‘ä»¬ç®€å•çœ‹ä¸€ä¸ªFragmentçš„ç”Ÿå‘½å‘¨æœŸæ‰§è¡Œå‡½æ•°å§ï¼Œæ¯”å¦‚æˆ‘ä»¬çœ‹<code>CreateView</code>ï¼Œåˆ™æºä»£ç åœ¨<code>FragmentStateManager</code>ä¸­è¿›è¡Œæ‰§è¡Œã€‚</p> 
<pre><code class="prism language-java">   <span class="token keyword">void</span> <span class="token function">createView</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
       <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token class-name">LayoutInflater</span> layoutInflater <span class="token operator">=</span> mFragment<span class="token punctuation">.</span><span class="token function">performGetLayoutInflater</span><span class="token punctuation">(</span>
                mFragment<span class="token punctuation">.</span>mSavedFragmentState<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ViewGroup</span> container <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token comment">//è·å–åˆ°Fragmentçš„å®¹å™¨</span>
        mFragment<span class="token punctuation">.</span>mContainer <span class="token operator">=</span> container<span class="token punctuation">;</span>
       <span class="token comment">//è°ƒç”¨åˆ°createViewï¼Œç”±å¼€å‘è€…åˆ›å»ºView</span>
        mFragment<span class="token punctuation">.</span><span class="token function">performCreateView</span><span class="token punctuation">(</span>layoutInflater<span class="token punctuation">,</span> container<span class="token punctuation">,</span> mFragment<span class="token punctuation">.</span>mSavedFragmentState<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token comment">//å°†viewæ·»åŠ åˆ°Fragmentå®¹å™¨ å…¶å®æ˜¯è°ƒç”¨äº†container.addView</span>
        <span class="token function">addViewToContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        mFragment<span class="token punctuation">.</span>mState <span class="token operator">=</span> <span class="token class-name">Fragment</span><span class="token punctuation">.</span><span class="token constant">VIEW_CREATED</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>çœ‹å§ï¼Œå…¶å®Fragmentæ ¸å¿ƒæ— éå°±æ˜¯å¯¹Viewè¿›è¡Œç®¡ç†ï¼Œè®©å…¶æœ‰ç”Ÿå‘½å‘¨æœŸã€‚æœ€æ ¸å¿ƒçš„ä¸€å¥è¿˜çš„æ˜¯<code>addView</code>ã€‚</p> 
<h4><a id="_467"></a>æ€»ç»“</h4> 
<p>ç®€å•æ€»ç»“ä¸€ä¸‹ï¼š</p> 
<ol><li><code>FragmentActivity</code> æ”¯æŒfragmentåŠŸèƒ½çš„æœ€åº•å±‚çš„activityã€‚</li><li><code>FragmentActivity</code>å‘¨æœŸçš„åˆ†å‘ï¼Œé€šè¿‡<code>fragmentController</code>æœ€ç»ˆåˆ†å‘ç»™äº†<code>FragmentManager</code>ï¼Œè°ƒç”¨<code>moveToState</code>ã€‚</li><li><code>moveToState</code>çš„ä¸€äº›çŠ¶æ€ç®¡ç†æ“ä½œåˆ™äº¤ç”±äº†<code>FragmentStateManager</code>è¿›è¡Œç»Ÿä¸€å¤„ç†ã€‚</li><li><code>FragmentTransition</code>æ˜¯æŠ½è±¡ç±»ï¼Œå…·ä½“å®ç°ä¸º<code>BackStackRecord</code>ï¼ŒåŒæ—¶<code>beginTransaction</code>å³ä¸ºè¿”å›äº†<code>BackStackRecord</code>å¯¹è±¡ã€‚</li><li>ä¸€ä¸ª<code>BackStackRecord</code>å¯¹è±¡å¯ä»¥è¿›è¡Œå¤šä¸ªæ“ä½œï¼Œå°è£…ä¸º<code>Op</code>å¯¹è±¡å­˜åœ¨æ•°ç»„ä¸­ã€‚æœ€ç»ˆé€šè¿‡<code>FragmentManager</code>ç›¸å…³çš„æ“ä½œè¿˜æ˜¯è°ƒåº¦ç”±è‡ªå·±çš„<code>executeOps</code>æ“ä½œè¿›è¡Œæ‰§è¡Œï¼Œæ¯”å¦‚addã€removeã€hideç­‰ç­‰ã€‚</li><li>æ“ä½œæ¯”è¾ƒå¤šï¼Œä½†æ˜¯å¤§åŒå°å¼‚ï¼Œå¯ä»¥æ ¹æ®è‡ªèº«éœ€è¦æŸ¥çœ‹ä¸åŒçš„ä»£ç æ‰§è¡Œæµç¨‹ã€‚æ¯”å¦‚hideã€showç­‰ç­‰ã€‚</li></ol> 
<p>ğŸ™†â€â™€ï¸ã€‚æ¬¢è¿æŠ€æœ¯æ¢è®¨å™¢ï¼</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/86c401c33da60915a53f0acfc1164bdc/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">python ä¸­æ–‡æ˜¾ç¤ºä¹±ç å¦‚ä½•å¤„ç†</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/eeed57de405a39d256000b6c2726e8c3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">python&#43;opencv&#43;mediapipe&#43;tensorflowå®ç°æ‰‹åŠ¿è¯†åˆ«æ§åˆ¶è®¡ç®—æœº</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 èœé¸Ÿç¨‹åºå‘˜åšå®¢.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>