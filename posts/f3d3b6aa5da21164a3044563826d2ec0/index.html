<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>CENTOS7 Anaconda&#43;Jupyter&#43;Pyspark联合安装 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="CENTOS7 Anaconda&#43;Jupyter&#43;Pyspark联合安装" />
<meta property="og:description" content="目录 1、 安装anaconda（在线）
2、 连接jupyter notebook（在线）
3、离线Anaconda配置
4、离线Python环境配置（虚拟环境）
5、 jupyter notebook 连接pyspark
1、 安装anaconda（在线） 1.1、 下载anaconda
1）在终端输入（x86系统）
wget https://repo.anaconda.com/archive/Anaconda3-2020.02-Linux-x86_64.sh 报错
wget：commend not found # 没有wget命令则用yum安装，在终端输入： yum install wget -y 2）在终端输入（Arm系统）
wget https://github.com/Archiconda/build-tools/releases/download/0.2.3/Archiconda3-0.2.3-Linux-aarch64.sh 1.2、 安装，在终端输入
bash Anaconda3-2020.02-Linux-x86_64.sh 点击Enter，出现安装条例，一直Enter键直至出现是否同意，输入yes，最后确定安装位置。
1.3、 激活环境，在终端输入
source ~/.bashrc 1.4、 建立python虚拟环境，在终端输入
conda create -n pytorch(env_name) python==3.7.0 1.5、 激活环境
conda activate pytorch 问题： 1、在1.2步安装过程中可能出现
bunzip2 connot find 解决
yum install bzip2 2、 连接jupyter notebook（在线） 2.1 进入虚拟环境
conda activate pytorch(env_name) 2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/f3d3b6aa5da21164a3044563826d2ec0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-11-04T10:55:42+08:00" />
<meta property="article:modified_time" content="2022-11-04T10:55:42+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">CENTOS7 Anaconda&#43;Jupyter&#43;Pyspark联合安装</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>目录</h3> 
<p><a href="#1" rel="nofollow">1、 安装anaconda（在线）</a><br> <a href="#2" rel="nofollow">2、 连接jupyter notebook（在线）</a><br> <a href="#3" rel="nofollow">3、离线Anaconda配置</a><br> <a href="#4" rel="nofollow">4、离线Python环境配置（虚拟环境）</a><br> <a href="#5" rel="nofollow">5、 jupyter notebook 连接pyspark</a></p> 
<h4><a id="h2_id_11_anaconda_7"></a></h4> 
<h3 id="1">1、 安装anaconda（在线）</h3> 
<p>1.1、 下载anaconda</p> 
<p>1）在终端输入（x86系统）</p> 
<pre><code class="prism language-shell"><span class="token function">wget</span> https://repo.anaconda.com/archive/Anaconda3-2020.02-Linux-x86_64.sh
</code></pre> 
<p>报错</p> 
<pre><code class="prism language-shell">wget：commend not found 
<span class="token comment"># 没有wget命令则用yum安装，在终端输入：</span>
yum <span class="token function">install</span> <span class="token function">wget</span> -y
</code></pre> 
<p>2）在终端输入（Arm系统）</p> 
<pre><code class="prism language-shell"><span class="token function">wget</span> https://github.com/Archiconda/build-tools/releases/download/0.2.3/Archiconda3-0.2.3-Linux-aarch64.sh
</code></pre> 
<p>1.2、 安装，在终端输入</p> 
<pre><code class="prism language-shell"><span class="token function">bash</span> Anaconda3-2020.02-Linux-x86_64.sh
</code></pre> 
<p>点击Enter，出现安装条例，一直Enter键直至出现是否同意，输入yes，最后确定安装位置。</p> 
<p>1.3、 激活环境，在终端输入</p> 
<pre><code class="prism language-shell"><span class="token builtin class-name">source</span> ~/.bashrc
</code></pre> 
<p>1.4、 建立python虚拟环境，在终端输入</p> 
<pre><code class="prism language-shell">conda create -n pytorch<span class="token punctuation">(</span>env_name<span class="token punctuation">)</span> <span class="token assign-left variable">python</span><span class="token operator">==</span><span class="token number">3.7</span>.0
</code></pre> 
<p>1.5、 激活环境</p> 
<pre><code class="prism language-shell">conda activate pytorch
</code></pre> 
<h6><a id="_57"></a>问题：</h6> 
<p>1、在1.2步安装过程中可能出现</p> 
<pre><code class="prism language-shell">bunzip2 connot <span class="token function">find</span>
</code></pre> 
<p>解决</p> 
<pre><code class="prism language-shell">yum <span class="token function">install</span> <span class="token function">bzip2</span>
</code></pre> 
<h4><a id="h2_id_22_jupyter_notebook_73"></a></h4> 
<h3 id="2">2、 连接jupyter notebook（在线）</h3> 
<p>2.1 进入虚拟环境</p> 
<pre><code class="prism language-shell">conda activate pytorch<span class="token punctuation">(</span>env_name<span class="token punctuation">)</span>
</code></pre> 
<p>2.2 在虚拟环境中安装jupyter，在终端输入</p> 
<pre><code class="prism language-shell">conda <span class="token function">install</span> jupyter
</code></pre> 
<p>2.3 生成jupyter的配置文件，在终端输入</p> 
<pre><code class="prism language-shell">jupyter notebook --generate-config
</code></pre> 
<p>2.4 修改配置文件，在终端输入</p> 
<pre><code class="prism language-shell"><span class="token function">vim</span> ~/.jupyter/jupyter_notebook_config.py
</code></pre> 
<p>将如下几项内容去除注释后修改值如下并保存：</p> 
<pre><code class="prism language-shell"><span class="token comment"># 服务ip地址，0.0.0.0代表绑定到本机所有的ip上</span>
<span class="token comment"># c.NotebookApp.ip='0.0.0.0'</span>
<span class="token comment"># 工作端口</span>
c.NotebookApp.port <span class="token operator">=</span><span class="token number">8888</span> <span class="token comment"># 随便指定一个端口</span>
<span class="token comment"># 共享目录</span>
c.NotebookApp.notebook_dir <span class="token operator">=</span> <span class="token string">'xxxxxxx'</span> <span class="token comment"># 设置Jupyternotebook 打开的根目录</span>
</code></pre> 
<p>2.5 配置防火墙封端口</p> 
<pre><code class="prism language-shell">firewall-cmd --zone<span class="token operator">=</span>public --add-port<span class="token operator">=</span><span class="token number">8888</span>/tcp –permanent
<span class="token function">sudo</span> systemctl restart firewalld
</code></pre> 
<p>2.6 修改密码</p> 
<p>重置jupyter notebook密码，在终端输入</p> 
<pre><code class="prism language-shell">jupyter notebook password
</code></pre> 
<p>然后输入设置的密码即可。</p> 
<p>2.7 为jupyter notebook添加conda的内核</p> 
<p>在虚拟环境中安装插件，在终端输入</p> 
<pre><code class="prism language-shell">conda <span class="token function">install</span> nb_conda
</code></pre> 
<p>2.8 运行jupyter notebook，在虚拟环境下启动，在终端输入</p> 
<pre><code class="prism language-shell">jupyer notebook
</code></pre> 
<p>如果是管理员则输入</p> 
<pre><code class="prism language-shell">jupyer notebook --allow-root
</code></pre> 
<p>然后输入设置的密码即可。</p> 
<h6><a id="_149"></a>可能报错：</h6> 
<p><img src="https://images2.imgbox.com/ea/38/E8SgWe4b_o.png" alt="在这里插入图片描述"></p> 
<p>解决方案：将所缺失文件设置成一个软连接，连接到该目录下同一性质文件，这里报错是缺失libffi.so.7文件，但是该目录下存在libffi.so.6文件，故将其软连接于libffi.so.6文件上，问题得到解决。</p> 
<p>目录为虚拟环境中的lib文件夹</p> 
<pre><code class="prism language-shell"><span class="token builtin class-name">cd</span> ~/anaconda/envs/env_name/lib
<span class="token function">ln</span> -s libffi.so.6 libffi.so.7
</code></pre> 
<h4><a id="h2_id_33Anaconda_165"></a></h4> 
<h3 id="3">3、离线Anaconda配置</h3> 
<p>3.1、将离线下载的Anaconda安装包导入离线环境中</p> 
<p><img src="https://images2.imgbox.com/0c/8a/bzvAHYGb_o.png" alt=""></p> 
<p>3.2、安装，终端输入命令</p> 
<pre><code class="prism language-shell"><span class="token function">bash</span> Archiconda3-0.2.3-linux-aarch64.sh
</code></pre> 
<p>点击Enter，出现安装条例，一直Enter键直至出现是否同意，输入yes，最后确定安装位置。（同上）</p> 
<p>3.3、激活环境</p> 
<pre><code class="prism language-shell"><span class="token builtin class-name">source</span> ~/.bashrc
</code></pre> 
<h4><a id="h2_id_44Python_187"></a></h4> 
<h3 id="4">4、离线Python环境配置（虚拟环境）</h3> 
<p>4.1、将在线配置好的虚拟环境env_name打包，压缩虚拟环境</p> 
<pre><code class="prism language-shell"><span class="token function">tar</span> -cvf env_name.tar env_name/
</code></pre> 
<p>4.2、使用U盘或者<a href="https://so.csdn.net/so/search?q=ssh&amp;spm=1001.2101.3001.7020">ssh</a>将压缩后的文件传输到服务器</p> 
<p>4.3、将压缩包复制到服务器上的anaconda3/envs目录下，并解压，在终端输入</p> 
<pre><code class="prism language-shell"><span class="token function">tar</span> -xvf env_name.tar  <span class="token comment"># 解压</span>
</code></pre> 
<p>4.4、打开环境</p> 
<pre><code class="prism language-shell">conda activate env_name
</code></pre> 
<h4><a id="h2_id_55_jupyter_notebook_pyspark_211"></a></h4> 
<h3 id="5">5、 jupyter notebook 连接pyspark</h3> 
<p>在master服务器端，添加的~/.bashrc文件中添加如下环境变量：</p> 
<pre><code class="prism language-shell"> <span class="token function">vim</span> ~/.bashrc
</code></pre> 
<pre><code class="prism language-shell"><span class="token comment">#py-spark</span>
<span class="token builtin class-name">export</span> PYTHONPATH <span class="token operator">=</span> /spark/python:<span class="token variable">$PYTHONPATH</span> <span class="token comment">#pythonpath指向spark目录下的python文件夹</span>
<span class="token builtin class-name">export</span> PYTHONPATH <span class="token operator">=</span> /spark/python/lib/py4j-0.10.7-src.zip:<span class="token variable">$PYTHONPATH</span> <span class="token comment">#指向py4j包，没有的话下载一个</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">PYSPARK_PYTHON</span><span class="token operator">=</span>/anaconda3/envs/envs_name/bin/python3 <span class="token comment">#使用虚拟环境中的python3</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">PYSPARK_DRIVER_PYTHON</span><span class="token operator">=</span>/anaconda3/envs/envs_name/bin/jupyter <span class="token comment">#使用虚拟环境中的jupyter</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">PYSPARK_DRIVER_PYTHON_OPTS</span><span class="token operator">=</span><span class="token string">"notebook --ip=’0.0.0.0’ --no-browser --allow-root"</span>
</code></pre> 
<p>在服务器端输入</p> 
<pre><code class="prism language-shell">pyspark
</code></pre> 
<p>则会同样打印出访问链接，输入到本地浏览器访问即可。</p> 
<p>此时的jupyter类似在终端启的一个pyspark-shell ,所以在启用jupyter时可以定义任务资源，如下</p> 
<pre><code class="prism language-shell"><span class="token function">nohup</span> pyspark --master <span class="token function">yarn</span> --deploy-mode client --driver-memory 20g --driver-cores <span class="token number">1</span> --num-executors <span class="token number">10</span> --executor-memory 6g --executor-cores <span class="token number">1</span> --conf spark.yarn.executor.memoryOverhead<span class="token operator">=</span><span class="token number">8192</span>  --conf spark.default.parallelism<span class="token operator">=</span><span class="token number">800</span> <span class="token operator">&amp;</span>
</code></pre> 
<p>"nohup"是定义在终端关闭后，jupyter程序仍在运行（常规的jupyter任务也可以用，很强大的功能）；后面是定义的资源大小，可根据实际的情况配置。<br> 关闭nohup进程<br> 若想要关闭nohup jupyter,可以执行以下操作：</p> 
<pre><code class="prism language-shell"><span class="token comment">#查看进程</span>
<span class="token function">ps</span> -aux <span class="token operator">|</span> <span class="token function">grep</span> jupyter
<span class="token comment">#结束进程</span>
<span class="token function">kill</span> -9 xxxx<span class="token punctuation">(</span>进程号<span class="token punctuation">)</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ba11ebc56571cfbdd669bc7d0c28d220/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">MYSQL闪退及DBeaver连接MYSQL出现拒绝连接的解决方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6794f2fd314be25a395ecd5833c2e9fa/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">图像分割指标</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>