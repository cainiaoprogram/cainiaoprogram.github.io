<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Pandas中的字符串和时间转换与格式化 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Pandas中的字符串和时间转换与格式化" />
<meta property="og:description" content="Pandas 提供了若干个函数来格式化时间。
把字符串转为时间格式 其中，最常用的是 to_datetime() 函数。
可以使用 to_datetime() 函数将一个字符串解析为时间，并指定字符串的格式。例如：
import pandas as pd # 将字符串 &#34;2022-01-01&#34; 转为时间格式 time = pd.to_datetime(&#34;2022-01-01&#34;, format=&#34;%Y-%m-%d&#34;) print(time) 输出：
&lt;class &#39;pandas._libs.tslibs.timestamps.Timestamp&#39;&gt;:2022-01-01 00:00:00 把时间格式化为字符串 还可以使用 strftime() 函数将时间格式化为字符串。例如：
import pandas as pd # 将时间 &#34;2022-01-01 00:00:00&#34; 格式化为字符串 time_str = pd.to_datetime(&#34;2022-01-01 00:00:00&#34;).strftime(&#34;%Y-%m-%d&#34;) print(time_str) 输出：
&lt;class &#39;str&#39;&gt;:2022-01-01 格式化某一列的时间为字符串 如果想要格式化某一列中的时间，可以使用 pandas 的 to_datetime 函数。
例如，假设你有一个名为 df 的数据，并且你想要格式化其中一列名为 “Date” 的时间列，你可以这样做：
df[&#39;Date&#39;] = pd.to_datetime(df[&#39;Date&#39;]) 这将会将 “Date” 列中的所有时间转换为 Pandas 的时间数据类型。你也可以指定一个特定的时间格式，例如：
df[&#39;Date&#39;] = pd.to_datetime(df[&#39;Date&#39;], format=&#39;%Y-%m-%d %H:%M:%S&#39;) 这将会将 “Date” 列中的所有时间按照指定的格式转换为 Pandas 的时间数据类型。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/f38bc3f38be6741cb05e737c60a1d26f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-06T21:45:29+08:00" />
<meta property="article:modified_time" content="2023-01-06T21:45:29+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Pandas中的字符串和时间转换与格式化</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>Pandas 提供了若干个函数来格式化时间。</p> 
<h2><a id="_2"></a>把字符串转为时间格式</h2> 
<p>其中，最常用的是 <code>to_datetime()</code> 函数。</p> 
<p>可以使用 <code>to_datetime()</code> 函数将一个字符串解析为时间，并指定字符串的格式。例如：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

<span class="token comment"># 将字符串 "2022-01-01" 转为时间格式</span>
time <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_datetime<span class="token punctuation">(</span><span class="token string">"2022-01-01"</span><span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token operator">=</span><span class="token string">"%Y-%m-%d"</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span>
</code></pre> 
<p>输出：</p> 
<pre><code>&lt;class 'pandas._libs.tslibs.timestamps.Timestamp'&gt;:2022-01-01 00:00:00
</code></pre> 
<h2><a id="_22"></a>把时间格式化为字符串</h2> 
<p>还可以使用 <code>strftime()</code> 函数将时间格式化为字符串。例如：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

<span class="token comment"># 将时间 "2022-01-01 00:00:00" 格式化为字符串</span>
time_str <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_datetime<span class="token punctuation">(</span><span class="token string">"2022-01-01 00:00:00"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">"%Y-%m-%d"</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>time_str<span class="token punctuation">)</span>
</code></pre> 
<p>输出：</p> 
<pre><code class="prism language-python"><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'str'</span><span class="token operator">&gt;</span><span class="token punctuation">:</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>
</code></pre> 
<h2><a id="_41"></a>格式化某一列的时间为字符串</h2> 
<p>如果想要格式化某一列中的时间，可以使用 <code>pandas</code> 的 <code>to_datetime</code> 函数。</p> 
<p>例如，假设你有一个名为 <code>df</code> 的数据，并且你想要格式化其中一列名为 “Date” 的时间列，你可以这样做：</p> 
<pre><code class="prism language-python">df<span class="token punctuation">[</span><span class="token string">'Date'</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_datetime<span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'Date'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p>这将会将 “Date” 列中的所有时间转换为 Pandas 的时间数据类型。你也可以指定一个特定的时间格式，例如：</p> 
<pre><code>df['Date'] = pd.to_datetime(df['Date'], format='%Y-%m-%d %H:%M:%S')
</code></pre> 
<p>这将会将 “Date” 列中的所有时间按照指定的格式转换为 Pandas 的时间数据类型。</p> 
<h2><a id="_59"></a>遇到的错误</h2> 
<p>但是，我在修改以下数据的格式时，想要把listed_date和delisted_date格式化为字符串，出现了错误。</p> 
<pre><code>      sec_id  sec_name               listed_date             delisted_date
2716  hc2301  热轧卷板2301 2022-01-18 00:00:00+08:00 2023-01-16 00:00:00+08:00
2717  hc2302  热轧卷板2302 2022-02-16 00:00:00+08:00 2023-02-15 00:00:00+08:00
2718  hc2303  热轧卷板2303 2022-03-16 00:00:00+08:00 2023-03-15 00:00:00+08:00
2719  hc2304  热轧卷板2304 2022-04-18 00:00:00+08:00 2023-04-17 00:00:00+08:00
2720  hc2305  热轧卷板2305 2022-05-17 00:00:00+08:00 2023-05-15 00:00:00+08:00
2721  hc2306  热轧卷板2306 2022-06-16 00:00:00+08:00 2023-06-15 00:00:00+08:00
2722  hc2307  热轧卷板2307 2022-07-18 00:00:00+08:00 2023-07-17 00:00:00+08:00
2723  hc2308  热轧卷板2308 2022-08-16 00:00:00+08:00 2023-08-15 00:00:00+08:00
2724  hc2309  热轧卷板2309 2022-09-16 00:00:00+08:00 2023-09-15 00:00:00+08:00
2725  hc2310  热轧卷板2310 2022-10-18 00:00:00+08:00 2023-10-16 00:00:00+08:00
2726  hc2311  热轧卷板2311 2022-11-16 00:00:00+08:00 2023-11-15 00:00:00+08:00
2727  hc2312  热轧卷板2312 2022-12-16 00:00:00+08:00 2023-12-15 00:00:00+08:00
</code></pre> 
<p>格式化代码如下：</p> 
<pre><code class="prism language-python">data_choose<span class="token punctuation">[</span><span class="token string">'listed_date'</span><span class="token punctuation">]</span> <span class="token operator">=</span> data_choose<span class="token punctuation">[</span><span class="token string">'listed_date'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>dt<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%Y-%m-%d %H:%M:%S'</span><span class="token punctuation">)</span>
data_choose<span class="token punctuation">[</span><span class="token string">'delisted_date'</span><span class="token punctuation">]</span> <span class="token operator">=</span> data_choose<span class="token punctuation">[</span><span class="token string">'delisted_date'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>dt<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%Y-%m-%d %H:%M:%S'</span><span class="token punctuation">)</span>
</code></pre> 
<p>报错：</p> 
<pre><code class="prism language-python">SettingWithCopyWarning<span class="token punctuation">:</span>      
A value <span class="token keyword">is</span> trying to be <span class="token builtin">set</span> on a copy of a <span class="token builtin">slice</span> <span class="token keyword">from</span> a DataFrame

See the caveats <span class="token keyword">in</span> the documentation<span class="token punctuation">:</span> https<span class="token punctuation">:</span><span class="token operator">//</span>pandas<span class="token punctuation">.</span>pydata<span class="token punctuation">.</span>org<span class="token operator">/</span>pandas<span class="token operator">-</span>docs<span class="token operator">/</span>stable<span class="token operator">/</span>user_guide<span class="token operator">/</span>indexing<span class="token punctuation">.</span>html<span class="token comment">#returning-a-view-versus-a-copy</span>
</code></pre> 
<p>推测错误原因：</p> 
<p><strong>不能直接修改原来的dataframe上的列，然后再替换原来的列数据。</strong></p> 
<p>于是，复制了一个数据副本：</p> 
<pre><code class="prism language-python">data_new <span class="token operator">=</span> data_choose<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>

data_new<span class="token punctuation">[</span><span class="token string">'listed_date'</span><span class="token punctuation">]</span> <span class="token operator">=</span> data_choose<span class="token punctuation">[</span><span class="token string">'listed_date'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>dt<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%Y-%m-%d %H:%M:%S'</span><span class="token punctuation">)</span>
data_new<span class="token punctuation">[</span><span class="token string">'delisted_date'</span><span class="token punctuation">]</span> <span class="token operator">=</span> data_choose<span class="token punctuation">[</span><span class="token string">'delisted_date'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>dt<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%Y-%m-%d %H:%M:%S'</span><span class="token punctuation">)</span>
</code></pre> 
<p>在复制的数据上进行修改，果然没再报错。</p> 
<p>输出：</p> 
<pre><code>      sec_id  sec_name          listed_date        delisted_date
2716  hc2301  热轧卷板2301  2022-01-18 00:00:00  2023-01-16 00:00:00
2717  hc2302  热轧卷板2302  2022-02-16 00:00:00  2023-02-15 00:00:00
2718  hc2303  热轧卷板2303  2022-03-16 00:00:00  2023-03-15 00:00:00
2719  hc2304  热轧卷板2304  2022-04-18 00:00:00  2023-04-17 00:00:00
2720  hc2305  热轧卷板2305  2022-05-17 00:00:00  2023-05-15 00:00:00
2721  hc2306  热轧卷板2306  2022-06-16 00:00:00  2023-06-15 00:00:00
2722  hc2307  热轧卷板2307  2022-07-18 00:00:00  2023-07-17 00:00:00
2723  hc2308  热轧卷板2308  2022-08-16 00:00:00  2023-08-15 00:00:00
2724  hc2309  热轧卷板2309  2022-09-16 00:00:00  2023-09-15 00:00:00
2725  hc2310  热轧卷板2310  2022-10-18 00:00:00  2023-10-16 00:00:00
2726  hc2311  热轧卷板2311  2022-11-16 00:00:00  2023-11-15 00:00:00
2727  hc2312  热轧卷板2312  2022-12-16 00:00:00  2023-12-15 00:00:00
</code></pre> 
<h2><a id="applylambda_128"></a>使用apply(）和lambda函数</h2> 
<p>另一种格式化方式，并不会出错：</p> 
<pre><code class="prism language-python"><span class="token comment"># 把日期改为字符串</span>
data_choose<span class="token punctuation">.</span>listed_date <span class="token operator">=</span> data_choose<span class="token punctuation">.</span>listed_date<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">"%Y-%m-%d %H:%M:%S"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 把时间列转为字符串</span>
data_choose<span class="token punctuation">.</span>delisted_date <span class="token operator">=</span> data_choose<span class="token punctuation">.</span>delisted_date<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">"%Y-%m-%d %H:%M:%S"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>这里对列使用了apply(）和lambda函数，相当于遍历列的数据进行修改替换。</p> 
<h2><a id="_141"></a>把某一列转为时间格式</h2> 
<p>直接使用pd.to_datetime()就可以了。</p> 
<p>这里不会出现错误。</p> 
<pre><code class="prism language-python"><span class="token comment"># 把列转为时间格式</span>
data_new<span class="token punctuation">.</span>listed_date <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_datetime<span class="token punctuation">(</span>data_new<span class="token punctuation">.</span>listed_date<span class="token punctuation">)</span>
data_new<span class="token punctuation">.</span>delisted_date <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_datetime<span class="token punctuation">(</span>data_new<span class="token punctuation">.</span>delisted_date<span class="token punctuation">)</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/54400a277cd016bbcc8f18b94af2e08f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">基于51单片机的舵机控制（PWM）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/86b902029251619735f0de86c9e17267/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">如何用c&#43;&#43;解析 Gcode代码</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>