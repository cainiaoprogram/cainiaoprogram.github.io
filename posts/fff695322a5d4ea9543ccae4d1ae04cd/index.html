<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Entity FrameWork 6帮助类 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Entity FrameWork 6帮助类" />
<meta property="og:description" content="1 public class BaseDAL 2 { 3 string strConn = &#34;&#34;; 4 public BaseDAL(string connString) 5 { 6 strConn = connString; 7 } 8 9 #region 通用增删改查 10 #region 非原始sql语句方式 11 /// &lt;summary&gt; 12 /// 新增 13 /// &lt;/summary&gt; 14 /// &lt;param name=&#34;entity&#34;&gt;实体&lt;/param&gt; 15 /// &lt;returns&gt;返回受影响行数&lt;/returns&gt; 16 public bool Add&lt;T&gt;(T entity) where T : class 17 { 18 using (SysDb&lt;T&gt; db = new SysDb&lt;T&gt;(strConn)) 19 { 20 db.Entry&lt;T&gt;(entity).State = EntityState." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/fff695322a5d4ea9543ccae4d1ae04cd/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2016-12-17T08:55:00+08:00" />
<meta property="article:modified_time" content="2016-12-17T08:55:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Entity FrameWork 6帮助类</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div id="cnblogs_post_body" class="blogpost-body"> 
 <div class="cnblogs_code"> 
  <pre><span style="color:#008080;">  1</span> <span style="color:#0000ff;">public</span> <span style="color:#0000ff;">class</span><span style="color:#000000;"> BaseDAL
</span><span style="color:#008080;">  2</span> <span style="color:#000000;">    {
</span><span style="color:#008080;">  3</span>     <span style="color:#0000ff;">string</span> strConn = <span style="color:#800000;">""</span><span style="color:#000000;">;
</span><span style="color:#008080;">  4</span>     <span style="color:#0000ff;">public</span> BaseDAL(<span style="color:#0000ff;">string</span><span style="color:#000000;"> connString)
</span><span style="color:#008080;">  5</span> <span style="color:#000000;">    {
</span><span style="color:#008080;">  6</span>         strConn =<span style="color:#000000;"> connString;
</span><span style="color:#008080;">  7</span> <span style="color:#000000;">    }
</span><span style="color:#008080;">  8</span> 
<span style="color:#008080;">  9</span>     <span style="color:#0000ff;">#region</span> 通用增删改查
<span style="color:#008080;"> 10</span>     <span style="color:#0000ff;">#region</span> 非原始sql语句方式
<span style="color:#008080;"> 11</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;summary&gt;</span>
<span style="color:#008080;"> 12</span>     <span style="color:#808080;">///</span><span style="color:#008000;"> 新增
</span><span style="color:#008080;"> 13</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;/summary&gt;</span>
<span style="color:#008080;"> 14</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;param name="entity"&gt;</span><span style="color:#008000;">实体</span><span style="color:#808080;">&lt;/param&gt;</span>
<span style="color:#008080;"> 15</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;returns&gt;</span><span style="color:#008000;">返回受影响行数</span><span style="color:#808080;">&lt;/returns&gt;</span>
<span style="color:#008080;"> 16</span>     <span style="color:#0000ff;">public</span> <span style="color:#0000ff;">bool</span> Add&lt;T&gt;(T entity) <span style="color:#0000ff;">where</span> T : <span style="color:#0000ff;">class</span>
<span style="color:#008080;"> 17</span> <span style="color:#000000;">    {
</span><span style="color:#008080;"> 18</span>         <span style="color:#0000ff;">using</span> (SysDb&lt;T&gt; db = <span style="color:#0000ff;">new</span> SysDb&lt;T&gt;<span style="color:#000000;">(strConn))
</span><span style="color:#008080;"> 19</span> <span style="color:#000000;">        {
</span><span style="color:#008080;"> 20</span>         db.Entry&lt;T&gt;(entity).State =<span style="color:#000000;"> EntityState.Added;
</span><span style="color:#008080;"> 21</span>         <span style="color:#0000ff;">return</span> db.SaveChanges() &gt; <span style="color:#800080;">0</span><span style="color:#000000;">;
</span><span style="color:#008080;"> 22</span> <span style="color:#000000;">        }
</span><span style="color:#008080;"> 23</span> <span style="color:#000000;">    }
</span><span style="color:#008080;"> 24</span> 
<span style="color:#008080;"> 25</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;summary&gt;</span>
<span style="color:#008080;"> 26</span>     <span style="color:#808080;">///</span><span style="color:#008000;"> 修改
</span><span style="color:#008080;"> 27</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;/summary&gt;</span>
<span style="color:#008080;"> 28</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;param name="entity"&gt;</span><span style="color:#008000;">实体</span><span style="color:#808080;">&lt;/param&gt;</span>
<span style="color:#008080;"> 29</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;returns&gt;</span><span style="color:#008000;">返回受影响行数</span><span style="color:#808080;">&lt;/returns&gt;</span>
<span style="color:#008080;"> 30</span>     <span style="color:#0000ff;">public</span> <span style="color:#0000ff;">bool</span> Update&lt;T&gt;(T entity) <span style="color:#0000ff;">where</span> T : <span style="color:#0000ff;">class</span>
<span style="color:#008080;"> 31</span> <span style="color:#000000;">    {
</span><span style="color:#008080;"> 32</span>         <span style="color:#0000ff;">using</span> (SysDb&lt;T&gt; db = <span style="color:#0000ff;">new</span> SysDb&lt;T&gt;<span style="color:#000000;">(strConn))
</span><span style="color:#008080;"> 33</span> <span style="color:#000000;">        {
</span><span style="color:#008080;"> 34</span>         db.Set&lt;T&gt;<span style="color:#000000;">().Attach(entity);
</span><span style="color:#008080;"> 35</span>         db.Entry&lt;T&gt;(entity).State =<span style="color:#000000;"> EntityState.Modified;
</span><span style="color:#008080;"> 36</span>         <span style="color:#0000ff;">return</span> db.SaveChanges() &gt; <span style="color:#800080;">0</span><span style="color:#000000;">;
</span><span style="color:#008080;"> 37</span> <span style="color:#000000;">        }
</span><span style="color:#008080;"> 38</span> <span style="color:#000000;">    }
</span><span style="color:#008080;"> 39</span> 
<span style="color:#008080;"> 40</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;summary&gt;</span>
<span style="color:#008080;"> 41</span>     <span style="color:#808080;">///</span><span style="color:#008000;"> 删除
</span><span style="color:#008080;"> 42</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;/summary&gt;</span>
<span style="color:#008080;"> 43</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;param name="entity"&gt;</span><span style="color:#008000;">实体</span><span style="color:#808080;">&lt;/param&gt;</span>
<span style="color:#008080;"> 44</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;returns&gt;</span><span style="color:#008000;">返回受影响行数</span><span style="color:#808080;">&lt;/returns&gt;</span>
<span style="color:#008080;"> 45</span>     <span style="color:#0000ff;">public</span> <span style="color:#0000ff;">bool</span> Delete&lt;T&gt;(T entity) <span style="color:#0000ff;">where</span> T : <span style="color:#0000ff;">class</span>
<span style="color:#008080;"> 46</span> <span style="color:#000000;">    {
</span><span style="color:#008080;"> 47</span>         <span style="color:#0000ff;">using</span> (SysDb&lt;T&gt; db = <span style="color:#0000ff;">new</span> SysDb&lt;T&gt;<span style="color:#000000;">(strConn))
</span><span style="color:#008080;"> 48</span> <span style="color:#000000;">        {
</span><span style="color:#008080;"> 49</span>         db.Set&lt;T&gt;<span style="color:#000000;">().Attach(entity);
</span><span style="color:#008080;"> 50</span>         db.Entry&lt;T&gt;(entity).State =<span style="color:#000000;"> EntityState.Deleted;
</span><span style="color:#008080;"> 51</span>         <span style="color:#0000ff;">return</span> db.SaveChanges() &gt; <span style="color:#800080;">0</span><span style="color:#000000;">;
</span><span style="color:#008080;"> 52</span> <span style="color:#000000;">        }
</span><span style="color:#008080;"> 53</span> <span style="color:#000000;">    }
</span><span style="color:#008080;"> 54</span> 
<span style="color:#008080;"> 55</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;summary&gt;</span>
<span style="color:#008080;"> 56</span>     <span style="color:#808080;">///</span><span style="color:#008000;"> 根据条件删除
</span><span style="color:#008080;"> 57</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;/summary&gt;</span>
<span style="color:#008080;"> 58</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;param name="deleWhere"&gt;</span><span style="color:#008000;">删除条件</span><span style="color:#808080;">&lt;/param&gt;</span>
<span style="color:#008080;"> 59</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;returns&gt;</span><span style="color:#008000;">返回受影响行数</span><span style="color:#808080;">&lt;/returns&gt;</span>
<span style="color:#008080;"> 60</span>     <span style="color:#0000ff;">public</span> <span style="color:#0000ff;">bool</span> DeleteByConditon&lt;T&gt;(Expression&lt;Func&lt;T, <span style="color:#0000ff;">bool</span>&gt;&gt; deleWhere) <span style="color:#0000ff;">where</span> T : <span style="color:#0000ff;">class</span>
<span style="color:#008080;"> 61</span> <span style="color:#000000;">    {
</span><span style="color:#008080;"> 62</span>         <span style="color:#0000ff;">using</span> (SysDb&lt;T&gt; db = <span style="color:#0000ff;">new</span> SysDb&lt;T&gt;<span style="color:#000000;">(strConn))
</span><span style="color:#008080;"> 63</span> <span style="color:#000000;">        {
</span><span style="color:#008080;"> 64</span>         List&lt;T&gt; entitys = db.Set&lt;T&gt;<span style="color:#000000;">().Where(deleWhere).ToList();
</span><span style="color:#008080;"> 65</span>         entitys.ForEach(m =&gt; db.Entry&lt;T&gt;(m).State =<span style="color:#000000;"> EntityState.Deleted);
</span><span style="color:#008080;"> 66</span>         <span style="color:#0000ff;">return</span> db.SaveChanges() &gt; <span style="color:#800080;">0</span><span style="color:#000000;">;
</span><span style="color:#008080;"> 67</span> <span style="color:#000000;">        }
</span><span style="color:#008080;"> 68</span> <span style="color:#000000;">    }
</span><span style="color:#008080;"> 69</span> 
<span style="color:#008080;"> 70</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;summary&gt;</span>
<span style="color:#008080;"> 71</span>     <span style="color:#808080;">///</span><span style="color:#008000;"> 查找单个
</span><span style="color:#008080;"> 72</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;/summary&gt;</span>
<span style="color:#008080;"> 73</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;param name="id"&gt;</span><span style="color:#008000;">主键</span><span style="color:#808080;">&lt;/param&gt;</span>
<span style="color:#008080;"> 74</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;returns&gt;&lt;/returns&gt;</span>
<span style="color:#008080;"> 75</span>     <span style="color:#0000ff;">public</span> T GetSingleById&lt;T&gt;(<span style="color:#0000ff;">int</span> id) <span style="color:#0000ff;">where</span> T : <span style="color:#0000ff;">class</span>
<span style="color:#008080;"> 76</span> <span style="color:#000000;">    {
</span><span style="color:#008080;"> 77</span>         <span style="color:#0000ff;">using</span> (SysDb&lt;T&gt; db = <span style="color:#0000ff;">new</span> SysDb&lt;T&gt;<span style="color:#000000;">(strConn))
</span><span style="color:#008080;"> 78</span> <span style="color:#000000;">        {
</span><span style="color:#008080;"> 79</span>         <span style="color:#0000ff;">return</span> db.Set&lt;T&gt;<span style="color:#000000;">().Find(id);
</span><span style="color:#008080;"> 80</span> <span style="color:#000000;">        }
</span><span style="color:#008080;"> 81</span> <span style="color:#000000;">    }
</span><span style="color:#008080;"> 82</span> 
<span style="color:#008080;"> 83</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;summary&gt;</span>
<span style="color:#008080;"> 84</span>     <span style="color:#808080;">///</span><span style="color:#008000;"> 查找单个
</span><span style="color:#008080;"> 85</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;/summary&gt;</span>
<span style="color:#008080;"> 86</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;param name="seleWhere"&gt;</span><span style="color:#008000;">查询条件</span><span style="color:#808080;">&lt;/param&gt;</span>
<span style="color:#008080;"> 87</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;returns&gt;&lt;/returns&gt;</span>
<span style="color:#008080;"> 88</span>     <span style="color:#0000ff;">public</span> T GetSingle&lt;T&gt;(Expression&lt;Func&lt;T, <span style="color:#0000ff;">bool</span>&gt;&gt; seleWhere) <span style="color:#0000ff;">where</span> T : <span style="color:#0000ff;">class</span>
<span style="color:#008080;"> 89</span> <span style="color:#000000;">    {
</span><span style="color:#008080;"> 90</span>         <span style="color:#0000ff;">using</span> (SysDb&lt;T&gt; db = <span style="color:#0000ff;">new</span> SysDb&lt;T&gt;<span style="color:#000000;">(strConn))
</span><span style="color:#008080;"> 91</span> <span style="color:#000000;">        {
</span><span style="color:#008080;"> 92</span>         <span style="color:#0000ff;">return</span> db.Set&lt;T&gt;<span style="color:#000000;">().AsExpandable().FirstOrDefault(seleWhere);
</span><span style="color:#008080;"> 93</span> <span style="color:#000000;">        }
</span><span style="color:#008080;"> 94</span> <span style="color:#000000;">    }
</span><span style="color:#008080;"> 95</span> 
<span style="color:#008080;"> 96</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;summary&gt;</span>
<span style="color:#008080;"> 97</span>     <span style="color:#808080;">///</span><span style="color:#008000;"> 获取所有实体集合
</span><span style="color:#008080;"> 98</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;/summary&gt;</span>
<span style="color:#008080;"> 99</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;returns&gt;&lt;/returns&gt;</span>
<span style="color:#008080;">100</span>     <span style="color:#0000ff;">public</span> List&lt;T&gt; GetAll&lt;T&gt;() <span style="color:#0000ff;">where</span> T : <span style="color:#0000ff;">class</span>
<span style="color:#008080;">101</span> <span style="color:#000000;">    {
</span><span style="color:#008080;">102</span>         <span style="color:#0000ff;">using</span> (SysDb&lt;T&gt; db = <span style="color:#0000ff;">new</span> SysDb&lt;T&gt;<span style="color:#000000;">(strConn))
</span><span style="color:#008080;">103</span> <span style="color:#000000;">        {
</span><span style="color:#008080;">104</span>         <span style="color:#0000ff;">return</span> db.Set&lt;T&gt;().AsExpandable().ToList&lt;T&gt;<span style="color:#000000;">();
</span><span style="color:#008080;">105</span> <span style="color:#000000;">        }
</span><span style="color:#008080;">106</span> <span style="color:#000000;">    }
</span><span style="color:#008080;">107</span> 
<span style="color:#008080;">108</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;summary&gt;</span>
<span style="color:#008080;">109</span>     <span style="color:#808080;">///</span><span style="color:#008000;"> 获取所有实体集合(单个排序)
</span><span style="color:#008080;">110</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;/summary&gt;</span>
<span style="color:#008080;">111</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;returns&gt;&lt;/returns&gt;</span>
<span style="color:#008080;">112</span>     <span style="color:#0000ff;">public</span> List&lt;T&gt; GetAll&lt;T, Tkey&gt;(Expression&lt;Func&lt;T, Tkey&gt;&gt; orderWhere, <span style="color:#0000ff;">bool</span> isDesc) <span style="color:#0000ff;">where</span> T : <span style="color:#0000ff;">class</span>
<span style="color:#008080;">113</span> <span style="color:#000000;">    {
</span><span style="color:#008080;">114</span>         <span style="color:#0000ff;">using</span> (SysDb&lt;T&gt; db = <span style="color:#0000ff;">new</span> SysDb&lt;T&gt;<span style="color:#000000;">(strConn))
</span><span style="color:#008080;">115</span> <span style="color:#000000;">        {
</span><span style="color:#008080;">116</span>         <span style="color:#0000ff;">return</span> CommonSort(db.Set&lt;T&gt;().AsExpandable(), orderWhere, isDesc).ToList&lt;T&gt;<span style="color:#000000;">();
</span><span style="color:#008080;">117</span> <span style="color:#000000;">        }
</span><span style="color:#008080;">118</span> <span style="color:#000000;">    }
</span><span style="color:#008080;">119</span> 
<span style="color:#008080;">120</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;summary&gt;</span>
<span style="color:#008080;">121</span>     <span style="color:#808080;">///</span><span style="color:#008000;"> 获取所有实体集合(多个排序)
</span><span style="color:#008080;">122</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;/summary&gt;</span>
<span style="color:#008080;">123</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;returns&gt;&lt;/returns&gt;</span>
<span style="color:#008080;">124</span>     <span style="color:#0000ff;">public</span> List&lt;T&gt; GetAll&lt;T&gt;(<span style="color:#0000ff;">params</span> OrderModelField[] orderByExpression) <span style="color:#0000ff;">where</span> T : <span style="color:#0000ff;">class</span>
<span style="color:#008080;">125</span> <span style="color:#000000;">    {
</span><span style="color:#008080;">126</span>         <span style="color:#0000ff;">using</span> (SysDb&lt;T&gt; db = <span style="color:#0000ff;">new</span> SysDb&lt;T&gt;<span style="color:#000000;">(strConn))
</span><span style="color:#008080;">127</span> <span style="color:#000000;">        {
</span><span style="color:#008080;">128</span>         <span style="color:#0000ff;">return</span> CommonSort(db.Set&lt;T&gt;<span style="color:#000000;">().AsExpandable(), orderByExpression).ToList();
</span><span style="color:#008080;">129</span> <span style="color:#000000;">        }
</span><span style="color:#008080;">130</span> <span style="color:#000000;">    }
</span><span style="color:#008080;">131</span> 
<span style="color:#008080;">132</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;summary&gt;</span>
<span style="color:#008080;">133</span>     <span style="color:#808080;">///</span><span style="color:#008000;"> 单个排序通用方法
</span><span style="color:#008080;">134</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;/summary&gt;</span>
<span style="color:#008080;">135</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;typeparam name="Tkey"&gt;</span><span style="color:#008000;">排序字段</span><span style="color:#808080;">&lt;/typeparam&gt;</span>
<span style="color:#008080;">136</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;param name="data"&gt;</span><span style="color:#008000;">要排序的数据</span><span style="color:#808080;">&lt;/param&gt;</span>
<span style="color:#008080;">137</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;param name="orderWhere"&gt;</span><span style="color:#008000;">排序条件</span><span style="color:#808080;">&lt;/param&gt;</span>
<span style="color:#008080;">138</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;param name="isDesc"&gt;</span><span style="color:#008000;">是否倒序</span><span style="color:#808080;">&lt;/param&gt;</span>
<span style="color:#008080;">139</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;returns&gt;</span><span style="color:#008000;">排序后的集合</span><span style="color:#808080;">&lt;/returns&gt;</span>
<span style="color:#008080;">140</span>     <span style="color:#0000ff;">public</span> IQueryable&lt;T&gt; CommonSort&lt;T, Tkey&gt;(IQueryable&lt;T&gt; data, Expression&lt;Func&lt;T, Tkey&gt;&gt; orderWhere, <span style="color:#0000ff;">bool</span> isDesc) <span style="color:#0000ff;">where</span> T : <span style="color:#0000ff;">class</span>
<span style="color:#008080;">141</span> <span style="color:#000000;">    {
</span><span style="color:#008080;">142</span>         <span style="color:#0000ff;">if</span><span style="color:#000000;"> (isDesc)
</span><span style="color:#008080;">143</span> <span style="color:#000000;">        {
</span><span style="color:#008080;">144</span>         <span style="color:#0000ff;">return</span><span style="color:#000000;"> data.OrderByDescending(orderWhere);
</span><span style="color:#008080;">145</span> <span style="color:#000000;">        }
</span><span style="color:#008080;">146</span>         <span style="color:#0000ff;">else</span>
<span style="color:#008080;">147</span> <span style="color:#000000;">        {
</span><span style="color:#008080;">148</span>         <span style="color:#0000ff;">return</span><span style="color:#000000;"> data.OrderBy(orderWhere);
</span><span style="color:#008080;">149</span> <span style="color:#000000;">        }
</span><span style="color:#008080;">150</span> <span style="color:#000000;">    }
</span><span style="color:#008080;">151</span> 
<span style="color:#008080;">152</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;summary&gt;</span>
<span style="color:#008080;">153</span>     <span style="color:#808080;">///</span><span style="color:#008000;"> 多个排序通用方法
</span><span style="color:#008080;">154</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;/summary&gt;</span>
<span style="color:#008080;">155</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;typeparam name="Tkey"&gt;</span><span style="color:#008000;">排序字段</span><span style="color:#808080;">&lt;/typeparam&gt;</span>
<span style="color:#008080;">156</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;param name="data"&gt;</span><span style="color:#008000;">要排序的数据</span><span style="color:#808080;">&lt;/param&gt;</span>
<span style="color:#008080;">157</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;param name="orderWhereAndIsDesc"&gt;</span><span style="color:#008000;">字典集合(排序条件,是否倒序)</span><span style="color:#808080;">&lt;/param&gt;</span>
<span style="color:#008080;">158</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;returns&gt;</span><span style="color:#008000;">排序后的集合</span><span style="color:#808080;">&lt;/returns&gt;</span>
<span style="color:#008080;">159</span>     <span style="color:#0000ff;">public</span> IQueryable&lt;T&gt; CommonSort&lt;T&gt;(IQueryable&lt;T&gt; data, <span style="color:#0000ff;">params</span> OrderModelField[] orderByExpression) <span style="color:#0000ff;">where</span> T : <span style="color:#0000ff;">class</span>
<span style="color:#008080;">160</span> <span style="color:#000000;">    {
</span><span style="color:#008080;">161</span>         <span style="color:#008000;">//</span><span style="color:#008000;">创建表达式变量参数</span>
<span style="color:#008080;">162</span>         <span style="color:#0000ff;">var</span> parameter = Expression.Parameter(<span style="color:#0000ff;">typeof</span>(T), <span style="color:#800000;">"</span><span style="color:#800000;">o</span><span style="color:#800000;">"</span><span style="color:#000000;">);
</span><span style="color:#008080;">163</span> 
<span style="color:#008080;">164</span>         <span style="color:#0000ff;">if</span> (orderByExpression != <span style="color:#0000ff;">null</span> &amp;&amp; orderByExpression.Length &gt; <span style="color:#800080;">0</span><span style="color:#000000;">)
</span><span style="color:#008080;">165</span> <span style="color:#000000;">        {
</span><span style="color:#008080;">166</span>         <span style="color:#0000ff;">for</span> (<span style="color:#0000ff;">int</span> i = <span style="color:#800080;">0</span>; i &lt; orderByExpression.Length; i++<span style="color:#000000;">)
</span><span style="color:#008080;">167</span> <span style="color:#000000;">        {
</span><span style="color:#008080;">168</span>             <span style="color:#008000;">//</span><span style="color:#008000;">根据属性名获取属性</span>
<span style="color:#008080;">169</span>             <span style="color:#0000ff;">var</span> property = <span style="color:#0000ff;">typeof</span><span style="color:#000000;">(T).GetProperty(orderByExpression[i].PropertyName);
</span><span style="color:#008080;">170</span>             <span style="color:#008000;">//</span><span style="color:#008000;">创建一个访问属性的表达式</span>
<span style="color:#008080;">171</span>             <span style="color:#0000ff;">var</span> propertyAccess =<span style="color:#000000;"> Expression.MakeMemberAccess(parameter, property);
</span><span style="color:#008080;">172</span>             <span style="color:#0000ff;">var</span> orderByExp =<span style="color:#000000;"> Expression.Lambda(propertyAccess, parameter);
</span><span style="color:#008080;">173</span> 
<span style="color:#008080;">174</span>             <span style="color:#0000ff;">string</span> OrderName = <span style="color:#800000;">""</span><span style="color:#000000;">;
</span><span style="color:#008080;">175</span>             <span style="color:#0000ff;">if</span> (i &gt; <span style="color:#800080;">0</span><span style="color:#000000;">)
</span><span style="color:#008080;">176</span> <span style="color:#000000;">            {
</span><span style="color:#008080;">177</span>             OrderName = orderByExpression[i].IsDESC ? <span style="color:#800000;">"</span><span style="color:#800000;">ThenByDescending</span><span style="color:#800000;">"</span> : <span style="color:#800000;">"</span><span style="color:#800000;">ThenBy</span><span style="color:#800000;">"</span><span style="color:#000000;">;
</span><span style="color:#008080;">178</span> <span style="color:#000000;">            }
</span><span style="color:#008080;">179</span>             <span style="color:#0000ff;">else</span>
<span style="color:#008080;">180</span>             OrderName = orderByExpression[i].IsDESC ? <span style="color:#800000;">"</span><span style="color:#800000;">OrderByDescending</span><span style="color:#800000;">"</span> : <span style="color:#800000;">"</span><span style="color:#800000;">OrderBy</span><span style="color:#800000;">"</span><span style="color:#000000;">;
</span><span style="color:#008080;">181</span> 
<span style="color:#008080;">182</span>             MethodCallExpression resultExp = Expression.Call(<span style="color:#0000ff;">typeof</span>(Queryable), OrderName, <span style="color:#0000ff;">new</span> Type[] { <span style="color:#0000ff;">typeof</span><span style="color:#000000;">(T), property.PropertyType },
</span><span style="color:#008080;">183</span> <span style="color:#000000;">            data.Expression, Expression.Quote(orderByExp));
</span><span style="color:#008080;">184</span> 
<span style="color:#008080;">185</span>             data = data.Provider.CreateQuery&lt;T&gt;<span style="color:#000000;">(resultExp);
</span><span style="color:#008080;">186</span> <span style="color:#000000;">        }
</span><span style="color:#008080;">187</span> <span style="color:#000000;">        }
</span><span style="color:#008080;">188</span>         <span style="color:#0000ff;">return</span><span style="color:#000000;"> data;
</span><span style="color:#008080;">189</span> <span style="color:#000000;">    }
</span><span style="color:#008080;">190</span> 
<span style="color:#008080;">191</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;summary&gt;</span>
<span style="color:#008080;">192</span>     <span style="color:#808080;">///</span><span style="color:#008000;"> 根据条件查询实体集合
</span><span style="color:#008080;">193</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;/summary&gt;</span>
<span style="color:#008080;">194</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;param name="seleWhere"&gt;</span><span style="color:#008000;">查询条件 lambel表达式</span><span style="color:#808080;">&lt;/param&gt;</span>
<span style="color:#008080;">195</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;returns&gt;&lt;/returns&gt;</span>
<span style="color:#008080;">196</span>     <span style="color:#0000ff;">public</span> List&lt;T&gt; GetList&lt;T&gt;(Expression&lt;Func&lt;T, <span style="color:#0000ff;">bool</span>&gt;&gt; seleWhere) <span style="color:#0000ff;">where</span> T : <span style="color:#0000ff;">class</span>
<span style="color:#008080;">197</span> <span style="color:#000000;">    {
</span><span style="color:#008080;">198</span>         <span style="color:#0000ff;">using</span> (SysDb&lt;T&gt; db = <span style="color:#0000ff;">new</span> SysDb&lt;T&gt;<span style="color:#000000;">(strConn))
</span><span style="color:#008080;">199</span> <span style="color:#000000;">        {
</span><span style="color:#008080;">200</span>         <span style="color:#0000ff;">return</span> db.Set&lt;T&gt;<span style="color:#000000;">().AsExpandable().Where(seleWhere).ToList();
</span><span style="color:#008080;">201</span> <span style="color:#000000;">        }
</span><span style="color:#008080;">202</span> <span style="color:#000000;">    }
</span><span style="color:#008080;">203</span> 
<span style="color:#008080;">204</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;summary&gt;</span>
<span style="color:#008080;">205</span>     <span style="color:#808080;">///</span><span style="color:#008000;"> 根据条件查询实体集合
</span><span style="color:#008080;">206</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;/summary&gt;</span>
<span style="color:#008080;">207</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;param name="seleWhere"&gt;</span><span style="color:#008000;">查询条件 lambel表达式</span><span style="color:#808080;">&lt;/param&gt;</span>
<span style="color:#008080;">208</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;returns&gt;&lt;/returns&gt;</span>
<span style="color:#008080;">209</span>     <span style="color:#0000ff;">public</span> List&lt;T&gt; GetList&lt;T, TValue&gt;(Expression&lt;Func&lt;T, TValue&gt;&gt; seleWhere, IEnumerable&lt;TValue&gt; conditions) <span style="color:#0000ff;">where</span> T : <span style="color:#0000ff;">class</span>
<span style="color:#008080;">210</span> <span style="color:#000000;">    {
</span><span style="color:#008080;">211</span>         <span style="color:#0000ff;">using</span> (SysDb&lt;T&gt; db = <span style="color:#0000ff;">new</span> SysDb&lt;T&gt;<span style="color:#000000;">(strConn))
</span><span style="color:#008080;">212</span> <span style="color:#000000;">        {
</span><span style="color:#008080;">213</span> 
<span style="color:#008080;">214</span>         <span style="color:#0000ff;">return</span> db.Set&lt;T&gt;().AsExpandable().WhereIn&lt;T, TValue&gt;<span style="color:#000000;">(seleWhere, conditions).ToList();
</span><span style="color:#008080;">215</span> <span style="color:#000000;">        }
</span><span style="color:#008080;">216</span> <span style="color:#000000;">    }
</span><span style="color:#008080;">217</span> 
<span style="color:#008080;">218</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;summary&gt;</span>
<span style="color:#008080;">219</span>     <span style="color:#808080;">///</span><span style="color:#008000;"> 根据条件查询实体集合(单个字段排序)
</span><span style="color:#008080;">220</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;/summary&gt;</span>
<span style="color:#008080;">221</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;param name="seleWhere"&gt;</span><span style="color:#008000;">查询条件 lambel表达式</span><span style="color:#808080;">&lt;/param&gt;</span>
<span style="color:#008080;">222</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;returns&gt;&lt;/returns&gt;</span>
<span style="color:#008080;">223</span>     <span style="color:#0000ff;">public</span> List&lt;T&gt; GetList&lt;T, Tkey&gt;(Expression&lt;Func&lt;T, <span style="color:#0000ff;">bool</span>&gt;&gt; seleWhere, Expression&lt;Func&lt;T, Tkey&gt;&gt; orderWhere, <span style="color:#0000ff;">bool</span> isDesc) <span style="color:#0000ff;">where</span> T : <span style="color:#0000ff;">class</span>
<span style="color:#008080;">224</span> <span style="color:#000000;">    {
</span><span style="color:#008080;">225</span>         <span style="color:#0000ff;">using</span> (SysDb&lt;T&gt; db = <span style="color:#0000ff;">new</span> SysDb&lt;T&gt;<span style="color:#000000;">(strConn))
</span><span style="color:#008080;">226</span> <span style="color:#000000;">        {
</span><span style="color:#008080;">227</span>         <span style="color:#0000ff;">return</span> CommonSort(db.Set&lt;T&gt;<span style="color:#000000;">().AsExpandable().Where(seleWhere), orderWhere, isDesc).ToList();
</span><span style="color:#008080;">228</span> <span style="color:#000000;">        }
</span><span style="color:#008080;">229</span> <span style="color:#000000;">    }
</span><span style="color:#008080;">230</span> 
<span style="color:#008080;">231</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;summary&gt;</span>
<span style="color:#008080;">232</span>     <span style="color:#808080;">///</span><span style="color:#008000;"> 根据条件查询实体集合(多个字段排序)
</span><span style="color:#008080;">233</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;/summary&gt;</span>
<span style="color:#008080;">234</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;param name="seleWhere"&gt;</span><span style="color:#008000;">查询条件 lambel表达式</span><span style="color:#808080;">&lt;/param&gt;</span>
<span style="color:#008080;">235</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;returns&gt;&lt;/returns&gt;</span>
<span style="color:#008080;">236</span>     <span style="color:#0000ff;">public</span> List&lt;T&gt; GetList&lt;T&gt;(Expression&lt;Func&lt;T, <span style="color:#0000ff;">bool</span>&gt;&gt; seleWhere, <span style="color:#0000ff;">params</span> OrderModelField[] orderByExpression) <span style="color:#0000ff;">where</span> T : <span style="color:#0000ff;">class</span>
<span style="color:#008080;">237</span> <span style="color:#000000;">    {
</span><span style="color:#008080;">238</span>         <span style="color:#0000ff;">using</span> (SysDb&lt;T&gt; db = <span style="color:#0000ff;">new</span> SysDb&lt;T&gt;<span style="color:#000000;">(strConn))
</span><span style="color:#008080;">239</span> <span style="color:#000000;">        {
</span><span style="color:#008080;">240</span>         <span style="color:#0000ff;">return</span> CommonSort(db.Set&lt;T&gt;<span style="color:#000000;">().AsExpandable().Where(seleWhere), orderByExpression).ToList();
</span><span style="color:#008080;">241</span> <span style="color:#000000;">        }
</span><span style="color:#008080;">242</span> <span style="color:#000000;">    }
</span><span style="color:#008080;">243</span> 
<span style="color:#008080;">244</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;summary&gt;</span>
<span style="color:#008080;">245</span>     <span style="color:#808080;">///</span><span style="color:#008000;"> 获取分页集合(无条件无排序)
</span><span style="color:#008080;">246</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;/summary&gt;</span>
<span style="color:#008080;">247</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;returns&gt;&lt;/returns&gt;</span>
<span style="color:#008080;">248</span>     <span style="color:#0000ff;">public</span> List&lt;T&gt; GetListPaged&lt;T, Tkey&gt;(<span style="color:#0000ff;">int</span> pageIndex, <span style="color:#0000ff;">int</span> pageSize, <span style="color:#0000ff;">out</span> <span style="color:#0000ff;">int</span> totalcount) <span style="color:#0000ff;">where</span> T : <span style="color:#0000ff;">class</span>
<span style="color:#008080;">249</span> <span style="color:#000000;">    {
</span><span style="color:#008080;">250</span>         <span style="color:#0000ff;">using</span> (SysDb&lt;T&gt; db = <span style="color:#0000ff;">new</span> SysDb&lt;T&gt;<span style="color:#000000;">(strConn))
</span><span style="color:#008080;">251</span> <span style="color:#000000;">        {
</span><span style="color:#008080;">252</span>         totalcount = db.Set&lt;T&gt;().AsExpandable().Count();<span style="color:#008000;">//</span><span style="color:#008000;">获取总数
</span><span style="color:#008080;">253</span>         <span style="color:#008000;">//</span><span style="color:#008000;">需要增加AsExpandable(),否则查询的是所有数据到内存，然后再排序  AsExpandable是linqkit.dll中的方法</span>
<span style="color:#008080;">254</span>         <span style="color:#0000ff;">return</span> db.Set&lt;T&gt;().AsExpandable().Skip((pageIndex - <span style="color:#800080;">1</span>) *<span style="color:#000000;"> pageSize).Take(pageSize).ToList();
</span><span style="color:#008080;">255</span> <span style="color:#000000;">        }
</span><span style="color:#008080;">256</span> <span style="color:#000000;">    }
</span><span style="color:#008080;">257</span> 
<span style="color:#008080;">258</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;summary&gt;</span>
<span style="color:#008080;">259</span>     <span style="color:#808080;">///</span><span style="color:#008000;"> 获取分页集合(无条件单个排序)
</span><span style="color:#008080;">260</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;/summary&gt;</span>
<span style="color:#008080;">261</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;returns&gt;&lt;/returns&gt;</span>
<span style="color:#008080;">262</span>     <span style="color:#0000ff;">public</span> List&lt;T&gt; GetListPaged&lt;T, Tkey&gt;(<span style="color:#0000ff;">int</span> pageIndex, <span style="color:#0000ff;">int</span> pageSize, Expression&lt;Func&lt;T, Tkey&gt;&gt; orderWhere, <span style="color:#0000ff;">bool</span> isDesc, <span style="color:#0000ff;">out</span> <span style="color:#0000ff;">int</span> totalcount) <span style="color:#0000ff;">where</span> T : <span style="color:#0000ff;">class</span>
<span style="color:#008080;">263</span> <span style="color:#000000;">    {
</span><span style="color:#008080;">264</span>         <span style="color:#0000ff;">using</span> (SysDb&lt;T&gt; db = <span style="color:#0000ff;">new</span> SysDb&lt;T&gt;<span style="color:#000000;">(strConn))
</span><span style="color:#008080;">265</span> <span style="color:#000000;">        {
</span><span style="color:#008080;">266</span>         totalcount = db.Set&lt;T&gt;().AsExpandable().Count();<span style="color:#008000;">//</span><span style="color:#008000;">获取总数
</span><span style="color:#008080;">267</span>         <span style="color:#008000;">//</span><span style="color:#008000;">需要增加AsExpandable(),否则查询的是所有数据到内存，然后再排序  AsExpandable是linqkit.dll中的方法</span>
<span style="color:#008080;">268</span>         <span style="color:#0000ff;">return</span> CommonSort(db.Set&lt;T&gt;().AsExpandable(), orderWhere, isDesc).Skip((pageIndex - <span style="color:#800080;">1</span>) *<span style="color:#000000;"> pageSize).Take(pageSize).ToList();
</span><span style="color:#008080;">269</span> <span style="color:#000000;">        }
</span><span style="color:#008080;">270</span> <span style="color:#000000;">    }
</span><span style="color:#008080;">271</span> 
<span style="color:#008080;">272</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;summary&gt;</span>
<span style="color:#008080;">273</span>     <span style="color:#808080;">///</span><span style="color:#008000;"> 获取分页集合(无条件多字段排序)
</span><span style="color:#008080;">274</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;/summary&gt;</span>
<span style="color:#008080;">275</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;returns&gt;&lt;/returns&gt;</span>
<span style="color:#008080;">276</span>     <span style="color:#0000ff;">public</span> List&lt;T&gt; GetListPaged&lt;T&gt;(<span style="color:#0000ff;">int</span> pageIndex, <span style="color:#0000ff;">int</span> pageSize, <span style="color:#0000ff;">out</span> <span style="color:#0000ff;">int</span> totalcount, <span style="color:#0000ff;">params</span> OrderModelField[] orderByExpression) <span style="color:#0000ff;">where</span> T : <span style="color:#0000ff;">class</span>
<span style="color:#008080;">277</span> <span style="color:#000000;">    {
</span><span style="color:#008080;">278</span>         <span style="color:#0000ff;">using</span> (SysDb&lt;T&gt; db = <span style="color:#0000ff;">new</span> SysDb&lt;T&gt;<span style="color:#000000;">(strConn))
</span><span style="color:#008080;">279</span> <span style="color:#000000;">        {
</span><span style="color:#008080;">280</span>         totalcount = db.Set&lt;T&gt;().AsExpandable().Count();<span style="color:#008000;">//</span><span style="color:#008000;">获取总数
</span><span style="color:#008080;">281</span>         <span style="color:#008000;">//</span><span style="color:#008000;">需要增加AsExpandable(),否则查询的是所有数据到内存，然后再排序  AsExpandable是linqkit.dll中的方法</span>
<span style="color:#008080;">282</span>         <span style="color:#0000ff;">return</span> CommonSort(db.Set&lt;T&gt;().AsExpandable(), orderByExpression).Skip((pageIndex - <span style="color:#800080;">1</span>) *<span style="color:#000000;"> pageSize).Take(pageSize).ToList();
</span><span style="color:#008080;">283</span> <span style="color:#000000;">        }
</span><span style="color:#008080;">284</span> <span style="color:#000000;">    }
</span><span style="color:#008080;">285</span> 
<span style="color:#008080;">286</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;summary&gt;</span>
<span style="color:#008080;">287</span>     <span style="color:#808080;">///</span><span style="color:#008000;"> 获取分页集合(有条件无排序)
</span><span style="color:#008080;">288</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;/summary&gt;</span>
<span style="color:#008080;">289</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;returns&gt;&lt;/returns&gt;</span>
<span style="color:#008080;">290</span>     <span style="color:#0000ff;">public</span> List&lt;T&gt; GetListPaged&lt;T, Tkey&gt;(<span style="color:#0000ff;">int</span> pageIndex, <span style="color:#0000ff;">int</span> pageSize, Expression&lt;Func&lt;T, <span style="color:#0000ff;">bool</span>&gt;&gt; seleWhere, <span style="color:#0000ff;">out</span> <span style="color:#0000ff;">int</span> totalcount) <span style="color:#0000ff;">where</span> T : <span style="color:#0000ff;">class</span>
<span style="color:#008080;">291</span> <span style="color:#000000;">    {
</span><span style="color:#008080;">292</span>         <span style="color:#0000ff;">using</span> (SysDb&lt;T&gt; db = <span style="color:#0000ff;">new</span> SysDb&lt;T&gt;<span style="color:#000000;">(strConn))
</span><span style="color:#008080;">293</span> <span style="color:#000000;">        {
</span><span style="color:#008080;">294</span>         totalcount = db.Set&lt;T&gt;().AsExpandable().Where(seleWhere).Count();<span style="color:#008000;">//</span><span style="color:#008000;">获取总数
</span><span style="color:#008080;">295</span>         <span style="color:#008000;">//</span><span style="color:#008000;">需要增加AsExpandable(),否则查询的是所有数据到内存，然后再排序  AsExpandable是linqkit.dll中的方法</span>
<span style="color:#008080;">296</span>         <span style="color:#0000ff;">return</span> db.Set&lt;T&gt;().AsExpandable().Where(seleWhere).Skip((pageIndex - <span style="color:#800080;">1</span>) *<span style="color:#000000;"> pageSize).Take(pageSize).ToList();
</span><span style="color:#008080;">297</span> <span style="color:#000000;">        }
</span><span style="color:#008080;">298</span> <span style="color:#000000;">    }
</span><span style="color:#008080;">299</span> 
<span style="color:#008080;">300</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;summary&gt;</span>
<span style="color:#008080;">301</span>     <span style="color:#808080;">///</span><span style="color:#008000;"> 获取分页集合(有条件单个排序)
</span><span style="color:#008080;">302</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;/summary&gt;</span>
<span style="color:#008080;">303</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;returns&gt;&lt;/returns&gt;</span>
<span style="color:#008080;">304</span>     <span style="color:#0000ff;">public</span> List&lt;T&gt; GetListPaged&lt;T, Tkey&gt;(<span style="color:#0000ff;">int</span> pageIndex, <span style="color:#0000ff;">int</span> pageSize, Expression&lt;Func&lt;T, <span style="color:#0000ff;">bool</span>&gt;&gt;<span style="color:#000000;"> seleWhere,
</span><span style="color:#008080;">305</span>         Expression&lt;Func&lt;T, Tkey&gt;&gt; orderWhere, <span style="color:#0000ff;">bool</span> isDesc, <span style="color:#0000ff;">out</span> <span style="color:#0000ff;">int</span> totalcount) <span style="color:#0000ff;">where</span> T : <span style="color:#0000ff;">class</span>
<span style="color:#008080;">306</span> <span style="color:#000000;">    {
</span><span style="color:#008080;">307</span>         <span style="color:#0000ff;">using</span> (SysDb&lt;T&gt; db = <span style="color:#0000ff;">new</span> SysDb&lt;T&gt;<span style="color:#000000;">(strConn))
</span><span style="color:#008080;">308</span> <span style="color:#000000;">        {
</span><span style="color:#008080;">309</span>         totalcount = db.Set&lt;T&gt;().AsExpandable().Where(seleWhere).Count();<span style="color:#008000;">//</span><span style="color:#008000;">获取总数
</span><span style="color:#008080;">310</span>         <span style="color:#008000;">//</span><span style="color:#008000;">需要增加AsExpandable(),否则查询的是所有数据到内存，然后再排序  AsExpandable是linqkit.dll中的方法</span>
<span style="color:#008080;">311</span>         <span style="color:#0000ff;">return</span> CommonSort(db.Set&lt;T&gt;().AsExpandable().Where(seleWhere), orderWhere, isDesc).Skip((pageIndex - <span style="color:#800080;">1</span>) *<span style="color:#000000;"> pageSize).Take(pageSize).ToList();
</span><span style="color:#008080;">312</span> <span style="color:#000000;">        }
</span><span style="color:#008080;">313</span> <span style="color:#000000;">    }
</span><span style="color:#008080;">314</span> 
<span style="color:#008080;">315</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;summary&gt;</span>
<span style="color:#008080;">316</span>     <span style="color:#808080;">///</span><span style="color:#008000;"> 获取分页集合(有条件多字段排序)
</span><span style="color:#008080;">317</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;/summary&gt;</span>
<span style="color:#008080;">318</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;returns&gt;&lt;/returns&gt;</span>
<span style="color:#008080;">319</span>     <span style="color:#0000ff;">public</span> List&lt;T&gt; GetListPaged&lt;T&gt;(<span style="color:#0000ff;">int</span> pageIndex, <span style="color:#0000ff;">int</span> pageSize, Expression&lt;Func&lt;T, <span style="color:#0000ff;">bool</span>&gt;&gt;<span style="color:#000000;"> seleWhere,
</span><span style="color:#008080;">320</span>         <span style="color:#0000ff;">out</span> <span style="color:#0000ff;">int</span> totalcount, <span style="color:#0000ff;">params</span> OrderModelField[] orderModelFiled) <span style="color:#0000ff;">where</span> T : <span style="color:#0000ff;">class</span>
<span style="color:#008080;">321</span> <span style="color:#000000;">    {
</span><span style="color:#008080;">322</span>         <span style="color:#0000ff;">using</span> (SysDb&lt;T&gt; db = <span style="color:#0000ff;">new</span> SysDb&lt;T&gt;<span style="color:#000000;">(strConn))
</span><span style="color:#008080;">323</span> <span style="color:#000000;">        {
</span><span style="color:#008080;">324</span>         totalcount = db.Set&lt;T&gt;().AsExpandable().Where(seleWhere).Count();<span style="color:#008000;">//</span><span style="color:#008000;">获取总数
</span><span style="color:#008080;">325</span>         <span style="color:#008000;">//</span><span style="color:#008000;">需要增加AsExpandable(),否则查询的是所有数据到内存，然后再排序  AsExpandable是linqkit.dll中的方法</span>
<span style="color:#008080;">326</span>         <span style="color:#0000ff;">return</span> CommonSort(db.Set&lt;T&gt;().AsExpandable().Where(seleWhere), orderModelFiled).Skip((pageIndex - <span style="color:#800080;">1</span>) *<span style="color:#000000;"> pageSize).Take(pageSize).ToList();
</span><span style="color:#008080;">327</span> <span style="color:#000000;">        }
</span><span style="color:#008080;">328</span> <span style="color:#000000;">    }
</span><span style="color:#008080;">329</span>     <span style="color:#0000ff;">#endregion</span>
<span style="color:#008080;">330</span> 
<span style="color:#008080;">331</span>     <span style="color:#0000ff;">#region</span> 原始sql操作
<span style="color:#008080;">332</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;summary&gt;</span>
<span style="color:#008080;">333</span>     <span style="color:#808080;">///</span><span style="color:#008000;"> 执行操作
</span><span style="color:#008080;">334</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;/summary&gt;</span>
<span style="color:#008080;">335</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;param name="sql"&gt;&lt;/param&gt;</span>
<span style="color:#008080;">336</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;param name="paras"&gt;&lt;/param&gt;</span>
<span style="color:#008080;">337</span>     <span style="color:#0000ff;">public</span> <span style="color:#0000ff;">void</span> ExecuteSql(<span style="color:#0000ff;">string</span> sql, <span style="color:#0000ff;">params</span> <span style="color:#0000ff;">object</span><span style="color:#000000;">[] paras)
</span><span style="color:#008080;">338</span> <span style="color:#000000;">    {
</span><span style="color:#008080;">339</span>         <span style="color:#0000ff;">using</span> (SysDb db = <span style="color:#0000ff;">new</span><span style="color:#000000;"> SysDb(strConn))
</span><span style="color:#008080;">340</span> <span style="color:#000000;">        {
</span><span style="color:#008080;">341</span> <span style="color:#000000;">        db.Database.ExecuteSqlCommand(sql, paras);
</span><span style="color:#008080;">342</span> <span style="color:#000000;">        }
</span><span style="color:#008080;">343</span> <span style="color:#000000;">    }
</span><span style="color:#008080;">344</span> 
<span style="color:#008080;">345</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;summary&gt;</span>
<span style="color:#008080;">346</span>     <span style="color:#808080;">///</span><span style="color:#008000;"> 查询列表
</span><span style="color:#008080;">347</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;/summary&gt;</span>
<span style="color:#008080;">348</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;typeparam name="T"&gt;&lt;/typeparam&gt;</span>
<span style="color:#008080;">349</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;param name="sql"&gt;&lt;/param&gt;</span>
<span style="color:#008080;">350</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;param name="paras"&gt;&lt;/param&gt;</span>
<span style="color:#008080;">351</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;returns&gt;&lt;/returns&gt;</span>
<span style="color:#008080;">352</span>     <span style="color:#0000ff;">public</span> List&lt;T&gt; QueryList&lt;T&gt;(<span style="color:#0000ff;">string</span> sql, <span style="color:#0000ff;">params</span> <span style="color:#0000ff;">object</span>[] paras) <span style="color:#0000ff;">where</span> T : <span style="color:#0000ff;">class</span>
<span style="color:#008080;">353</span> <span style="color:#000000;">    {
</span><span style="color:#008080;">354</span>         <span style="color:#0000ff;">using</span> (SysDb db = <span style="color:#0000ff;">new</span><span style="color:#000000;"> SysDb(strConn))
</span><span style="color:#008080;">355</span> <span style="color:#000000;">        {
</span><span style="color:#008080;">356</span>         <span style="color:#0000ff;">return</span> db.Database.SqlQuery&lt;T&gt;<span style="color:#000000;">(sql, paras).ToList();
</span><span style="color:#008080;">357</span> <span style="color:#000000;">        }
</span><span style="color:#008080;">358</span> <span style="color:#000000;">    }
</span><span style="color:#008080;">359</span> 
<span style="color:#008080;">360</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;summary&gt;</span>
<span style="color:#008080;">361</span>     <span style="color:#808080;">///</span><span style="color:#008000;"> 查询单个
</span><span style="color:#008080;">362</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;/summary&gt;</span>
<span style="color:#008080;">363</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;typeparam name="T"&gt;&lt;/typeparam&gt;</span>
<span style="color:#008080;">364</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;param name="sql"&gt;&lt;/param&gt;</span>
<span style="color:#008080;">365</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;param name="paras"&gt;&lt;/param&gt;</span>
<span style="color:#008080;">366</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;returns&gt;&lt;/returns&gt;</span>
<span style="color:#008080;">367</span>     <span style="color:#0000ff;">public</span> T QuerySingle&lt;T&gt;(<span style="color:#0000ff;">string</span> sql, <span style="color:#0000ff;">params</span> <span style="color:#0000ff;">object</span>[] paras) <span style="color:#0000ff;">where</span> T : <span style="color:#0000ff;">class</span>
<span style="color:#008080;">368</span> <span style="color:#000000;">    {
</span><span style="color:#008080;">369</span>         <span style="color:#0000ff;">using</span> (SysDb&lt;T&gt; db = <span style="color:#0000ff;">new</span> SysDb&lt;T&gt;<span style="color:#000000;">(strConn))
</span><span style="color:#008080;">370</span> <span style="color:#000000;">        {
</span><span style="color:#008080;">371</span>         <span style="color:#0000ff;">return</span> db.Database.SqlQuery&lt;T&gt;<span style="color:#000000;">(sql, paras).FirstOrDefault();
</span><span style="color:#008080;">372</span> <span style="color:#000000;">        }
</span><span style="color:#008080;">373</span> <span style="color:#000000;">    }
</span><span style="color:#008080;">374</span> 
<span style="color:#008080;">375</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;summary&gt;</span>
<span style="color:#008080;">376</span>     <span style="color:#808080;">///</span><span style="color:#008000;"> 执行事务
</span><span style="color:#008080;">377</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;/summary&gt;</span>
<span style="color:#008080;">378</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;param name="lsSql"&gt;&lt;/param&gt;</span>
<span style="color:#008080;">379</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;param name="lsParas"&gt;&lt;/param&gt;</span>
<span style="color:#008080;">380</span>     <span style="color:#0000ff;">public</span> <span style="color:#0000ff;">void</span> ExecuteTransaction(List&lt;String&gt; lsSql, List&lt;Object[]&gt;<span style="color:#000000;"> lsParas)
</span><span style="color:#008080;">381</span> <span style="color:#000000;">    {
</span><span style="color:#008080;">382</span>         <span style="color:#0000ff;">using</span> (SysDb db = <span style="color:#0000ff;">new</span><span style="color:#000000;"> SysDb(strConn))
</span><span style="color:#008080;">383</span> <span style="color:#000000;">        {
</span><span style="color:#008080;">384</span>         <span style="color:#0000ff;">using</span> (<span style="color:#0000ff;">var</span> tran =<span style="color:#000000;"> db.Database.BeginTransaction())
</span><span style="color:#008080;">385</span> <span style="color:#000000;">        {
</span><span style="color:#008080;">386</span>             <span style="color:#0000ff;">try</span>
<span style="color:#008080;">387</span> <span style="color:#000000;">            {
</span><span style="color:#008080;">388</span>             <span style="color:#0000ff;">for</span> (<span style="color:#0000ff;">int</span> i = <span style="color:#800080;">0</span>; i &lt; lsSql.Count; i++<span style="color:#000000;">)
</span><span style="color:#008080;">389</span> <span style="color:#000000;">            {
</span><span style="color:#008080;">390</span>                 <span style="color:#0000ff;">if</span> (lsParas != <span style="color:#0000ff;">null</span> &amp;&amp; lsParas.Count &gt; <span style="color:#800080;">0</span><span style="color:#000000;">)
</span><span style="color:#008080;">391</span> <span style="color:#000000;">                {
</span><span style="color:#008080;">392</span> <span style="color:#000000;">                db.Database.ExecuteSqlCommand(lsSql[i], lsParas[i]);
</span><span style="color:#008080;">393</span> <span style="color:#000000;">                }
</span><span style="color:#008080;">394</span> <span style="color:#000000;">            }
</span><span style="color:#008080;">395</span>             <span style="color:#0000ff;">foreach</span> (String item <span style="color:#0000ff;">in</span><span style="color:#000000;"> lsSql)
</span><span style="color:#008080;">396</span> <span style="color:#000000;">            {
</span><span style="color:#008080;">397</span> <span style="color:#000000;">                db.Database.ExecuteSqlCommand(item);
</span><span style="color:#008080;">398</span> <span style="color:#000000;">            }
</span><span style="color:#008080;">399</span> 
<span style="color:#008080;">400</span> <span style="color:#000000;">            tran.Commit();
</span><span style="color:#008080;">401</span> <span style="color:#000000;">            }
</span><span style="color:#008080;">402</span>             <span style="color:#0000ff;">catch</span><span style="color:#000000;"> (Exception ex)
</span><span style="color:#008080;">403</span> <span style="color:#000000;">            {
</span><span style="color:#008080;">404</span> <span style="color:#000000;">            tran.Rollback();
</span><span style="color:#008080;">405</span>             <span style="color:#0000ff;">throw</span><span style="color:#000000;"> ex;
</span><span style="color:#008080;">406</span> <span style="color:#000000;">            }
</span><span style="color:#008080;">407</span> <span style="color:#000000;">        }
</span><span style="color:#008080;">408</span> <span style="color:#000000;">        }
</span><span style="color:#008080;">409</span> <span style="color:#000000;">    }
</span><span style="color:#008080;">410</span>     <span style="color:#0000ff;">#endregion</span>
<span style="color:#008080;">411</span>     <span style="color:#0000ff;">#endregion</span>
<span style="color:#008080;">412</span> 
<span style="color:#008080;">413</span>     <span style="color:#0000ff;">#region</span> 通用属性
<span style="color:#008080;">414</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;summary&gt;</span>
<span style="color:#008080;">415</span>     <span style="color:#808080;">///</span><span style="color:#008000;"> 获取数据库服务器当前时间。
</span><span style="color:#008080;">416</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;/summary&gt;</span>
<span style="color:#008080;">417</span>     <span style="color:#0000ff;">public</span><span style="color:#000000;"> DateTime ServerTime
</span><span style="color:#008080;">418</span> <span style="color:#000000;">    {
</span><span style="color:#008080;">419</span>         <span style="color:#0000ff;">get</span>
<span style="color:#008080;">420</span> <span style="color:#000000;">        {
</span><span style="color:#008080;">421</span>         <span style="color:#0000ff;">using</span> (SysDb db = <span style="color:#0000ff;">new</span><span style="color:#000000;"> SysDb(strConn))
</span><span style="color:#008080;">422</span> <span style="color:#000000;">        {
</span><span style="color:#008080;">423</span>             String sql = <span style="color:#800000;">"</span><span style="color:#800000;">SELECT GETDATE()</span><span style="color:#800000;">"</span><span style="color:#000000;">;
</span><span style="color:#008080;">424</span>             Object objServerTime = db.Database.SqlQuery&lt;Object&gt;<span style="color:#000000;">(sql);
</span><span style="color:#008080;">425</span>             <span style="color:#0000ff;">return</span><span style="color:#000000;"> Convert.ToDateTime(objServerTime);
</span><span style="color:#008080;">426</span> <span style="color:#000000;">        }
</span><span style="color:#008080;">427</span> <span style="color:#000000;">        }
</span><span style="color:#008080;">428</span> <span style="color:#000000;">    }
</span><span style="color:#008080;">429</span> 
<span style="color:#008080;">430</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;summary&gt;</span>
<span style="color:#008080;">431</span>     <span style="color:#808080;">///</span><span style="color:#008000;"> 获取数据库版本。
</span><span style="color:#008080;">432</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;/summary&gt;</span>
<span style="color:#008080;">433</span>     <span style="color:#0000ff;">public</span><span style="color:#000000;"> String DatabaseVersion
</span><span style="color:#008080;">434</span> <span style="color:#000000;">    {
</span><span style="color:#008080;">435</span>         <span style="color:#0000ff;">get</span>
<span style="color:#008080;">436</span> <span style="color:#000000;">        {
</span><span style="color:#008080;">437</span>         <span style="color:#0000ff;">using</span> (SysDb db = <span style="color:#0000ff;">new</span><span style="color:#000000;"> SysDb(strConn))
</span><span style="color:#008080;">438</span> <span style="color:#000000;">        {
</span><span style="color:#008080;">439</span>             <span style="color:#0000ff;">try</span>
<span style="color:#008080;">440</span> <span style="color:#000000;">            {
</span><span style="color:#008080;">441</span>             String sql = <span style="color:#800000;">"</span><span style="color:#800000;">SELECT Version FROM Sys_Version</span><span style="color:#800000;">"</span><span style="color:#000000;">;
</span><span style="color:#008080;">442</span>             Object objServerTime = db.Database.SqlQuery&lt;Object&gt;<span style="color:#000000;">(sql);
</span><span style="color:#008080;">443</span>             <span style="color:#0000ff;">return</span><span style="color:#000000;"> Convert.ToString(objServerTime);
</span><span style="color:#008080;">444</span> <span style="color:#000000;">            }
</span><span style="color:#008080;">445</span>             <span style="color:#0000ff;">catch</span>
<span style="color:#008080;">446</span> <span style="color:#000000;">            {
</span><span style="color:#008080;">447</span> <span style="color:#000000;">            }
</span><span style="color:#008080;">448</span>             <span style="color:#0000ff;">return</span><span style="color:#000000;"> String.Empty;
</span><span style="color:#008080;">449</span> <span style="color:#000000;">        }
</span><span style="color:#008080;">450</span> <span style="color:#000000;">        }
</span><span style="color:#008080;">451</span> <span style="color:#000000;">    }
</span><span style="color:#008080;">452</span>     <span style="color:#0000ff;">#endregion</span>
<span style="color:#008080;">453</span> 
<span style="color:#008080;">454</span> <span style="color:#000000;">    }
</span><span style="color:#008080;">455</span>     <span style="color:#0000ff;">public</span> <span style="color:#0000ff;">static</span> <span style="color:#0000ff;">class</span><span style="color:#000000;"> QueryableExtension
</span><span style="color:#008080;">456</span> <span style="color:#000000;">    {
</span><span style="color:#008080;">457</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;summary&gt;</span>
<span style="color:#008080;">458</span>     <span style="color:#808080;">///</span><span style="color:#008000;"> 扩展方法  支持 in 操作
</span><span style="color:#008080;">459</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;/summary&gt;</span>
<span style="color:#008080;">460</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;typeparam name="TEntity"&gt;</span><span style="color:#008000;">需要扩展的对象类型</span><span style="color:#808080;">&lt;/typeparam&gt;</span>
<span style="color:#008080;">461</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;typeparam name="TValue"&gt;</span><span style="color:#008000;">in 的值类型</span><span style="color:#808080;">&lt;/typeparam&gt;</span>
<span style="color:#008080;">462</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;param name="source"&gt;</span><span style="color:#008000;">需要扩展的对象</span><span style="color:#808080;">&lt;/param&gt;</span>
<span style="color:#008080;">463</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;param name="valueSelector"&gt;</span><span style="color:#008000;">值选择器 例如c=&gt;c.UserId</span><span style="color:#808080;">&lt;/param&gt;</span>
<span style="color:#008080;">464</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;param name="values"&gt;</span><span style="color:#008000;">值集合</span><span style="color:#808080;">&lt;/param&gt;</span>
<span style="color:#008080;">465</span>     <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;returns&gt;&lt;/returns&gt;</span>
<span style="color:#008080;">466</span>     <span style="color:#0000ff;">public</span> <span style="color:#0000ff;">static</span> IQueryable&lt;TEntity&gt; WhereIn&lt;TEntity, TValue&gt;(<span style="color:#0000ff;">this</span> IQueryable&lt;TEntity&gt; source, Expression&lt;Func&lt;TEntity, TValue&gt;&gt;<span style="color:#000000;"> valueSelector,
</span><span style="color:#008080;">467</span>         IEnumerable&lt;TValue&gt;<span style="color:#000000;"> values)
</span><span style="color:#008080;">468</span> <span style="color:#000000;">    {
</span><span style="color:#008080;">469</span>         <span style="color:#0000ff;">if</span> (<span style="color:#0000ff;">null</span> == valueSelector) { <span style="color:#0000ff;">throw</span> <span style="color:#0000ff;">new</span> ArgumentNullException(<span style="color:#800000;">"</span><span style="color:#800000;">valueSelector</span><span style="color:#800000;">"</span><span style="color:#000000;">); }
</span><span style="color:#008080;">470</span>         <span style="color:#0000ff;">if</span> (<span style="color:#0000ff;">null</span> == values) { <span style="color:#0000ff;">throw</span> <span style="color:#0000ff;">new</span> ArgumentNullException(<span style="color:#800000;">"</span><span style="color:#800000;">values</span><span style="color:#800000;">"</span><span style="color:#000000;">); }
</span><span style="color:#008080;">471</span>         ParameterExpression p =<span style="color:#000000;"> valueSelector.Parameters.Single();
</span><span style="color:#008080;">472</span> 
<span style="color:#008080;">473</span>         <span style="color:#0000ff;">if</span> (!<span style="color:#000000;">values.Any())
</span><span style="color:#008080;">474</span> <span style="color:#000000;">        {
</span><span style="color:#008080;">475</span>         <span style="color:#0000ff;">return</span><span style="color:#000000;"> source;
</span><span style="color:#008080;">476</span> <span style="color:#000000;">        }
</span><span style="color:#008080;">477</span>         <span style="color:#0000ff;">var</span> equals = values.Select(value =&gt; (Expression)Expression.Equal(valueSelector.Body, Expression.Constant(value, <span style="color:#0000ff;">typeof</span><span style="color:#000000;">(TValue))));
</span><span style="color:#008080;">478</span>         <span style="color:#0000ff;">var</span> body = equals.Aggregate&lt;Expression&gt;((accumulate, equal) =&gt;<span style="color:#000000;"> Expression.Or(accumulate, equal));
</span><span style="color:#008080;">479</span>         <span style="color:#0000ff;">return</span> source.Where(Expression.Lambda&lt;Func&lt;TEntity, <span style="color:#0000ff;">bool</span>&gt;&gt;<span style="color:#000000;">(body, p));
</span><span style="color:#008080;">480</span> <span style="color:#000000;">    }
</span><span style="color:#008080;">481</span> <span style="color:#000000;">    }
</span><span style="color:#008080;">482</span>     <span style="color:#0000ff;">public</span> <span style="color:#0000ff;">struct</span><span style="color:#000000;"> OrderModelField
</span><span style="color:#008080;">483</span> <span style="color:#000000;">    {
</span><span style="color:#008080;">484</span> 
<span style="color:#008080;">485</span>     <span style="color:#0000ff;">public</span> <span style="color:#0000ff;">bool</span> IsDESC { <span style="color:#0000ff;">get</span>; <span style="color:#0000ff;">set</span><span style="color:#000000;">; }
</span><span style="color:#008080;">486</span>     <span style="color:#0000ff;">public</span> <span style="color:#0000ff;">string</span> PropertyName { <span style="color:#0000ff;">get</span>; <span style="color:#0000ff;">set</span><span style="color:#000000;">; }
</span><span style="color:#008080;">487</span> <span style="color:#000000;">    }
</span><span style="color:#008080;">488</span> <span style="color:#000000;">dbcontext类：
</span><span style="color:#008080;">489</span> 
<span style="color:#008080;">490</span> <span style="color:#0000ff;">public</span> <span style="color:#0000ff;">class</span><span style="color:#000000;"> SysDb : DbContext
</span><span style="color:#008080;">491</span> <span style="color:#000000;">    {
</span><span style="color:#008080;">492</span>         <span style="color:#0000ff;">bool</span> isNew = <span style="color:#0000ff;">true</span>;<span style="color:#008000;">//</span><span style="color:#008000;">是否是新的sql执行</span>
<span style="color:#008080;">493</span>         <span style="color:#0000ff;">string</span> strMsg = <span style="color:#800000;">""</span>;<span style="color:#008000;">//</span><span style="color:#008000;">sql执行的相关信息</span>
<span style="color:#008080;">494</span>         <span style="color:#0000ff;">string</span> strConn = <span style="color:#800000;">""</span>;<span style="color:#008000;">//</span><span style="color:#008000;">数据库连接字符串</span>
<span style="color:#008080;">495</span>         <span style="color:#0000ff;">string</span> UserName = <span style="color:#800000;">""</span>;<span style="color:#008000;">//</span><span style="color:#008000;">日志用户名称</span>
<span style="color:#008080;">496</span>         <span style="color:#0000ff;">string</span> AdditionalInfo = <span style="color:#800000;">""</span>;<span style="color:#008000;">//</span><span style="color:#008000;">日志额外信息</span>
<span style="color:#008080;">497</span>         <span style="color:#0000ff;">public</span> SysDb(<span style="color:#0000ff;">string</span> connString) : <span style="color:#008000;">//</span><span style="color:#008000;"> 数据库链接字符串</span>
<span style="color:#008080;">498</span>             <span style="color:#0000ff;">base</span><span style="color:#000000;">(connString)
</span><span style="color:#008080;">499</span> <span style="color:#000000;">        {
</span><span style="color:#008080;">500</span>             strConn =<span style="color:#000000;"> connString;
</span><span style="color:#008080;">501</span>             Database.SetInitializer&lt;SysDb&gt;(<span style="color:#0000ff;">null</span>);<span style="color:#008000;">//</span><span style="color:#008000;">设置为空，防止自动检查和生成</span>
<span style="color:#008080;">502</span>             <span style="color:#0000ff;">base</span>.Database.Log = (info) =&gt;<span style="color:#000000;"> Debug.WriteLine(info);
</span><span style="color:#008080;">503</span> <span style="color:#000000;">        }
</span><span style="color:#008080;">504</span> 
<span style="color:#008080;">505</span>         <span style="color:#0000ff;">public</span> SysDb(<span style="color:#0000ff;">string</span> connString, <span style="color:#0000ff;">string</span> logUserName, <span style="color:#0000ff;">string</span> logAdditionalInfo) : <span style="color:#008000;">//</span><span style="color:#008000;"> 数据库链接字符串</span>
<span style="color:#008080;">506</span>             <span style="color:#0000ff;">base</span><span style="color:#000000;">(connString)
</span><span style="color:#008080;">507</span> <span style="color:#000000;">        {
</span><span style="color:#008080;">508</span>             strConn =<span style="color:#000000;"> connString;
</span><span style="color:#008080;">509</span>             Database.SetInitializer&lt;SysDb&gt;(<span style="color:#0000ff;">null</span>);<span style="color:#008000;">//</span><span style="color:#008000;">设置为空，防止自动检查和生成</span>
<span style="color:#008080;">510</span>             UserName =<span style="color:#000000;"> logUserName;
</span><span style="color:#008080;">511</span>             AdditionalInfo =<span style="color:#000000;"> logAdditionalInfo;
</span><span style="color:#008080;">512</span>             <span style="color:#0000ff;">base</span>.Database.Log =<span style="color:#000000;"> AddLogger;
</span><span style="color:#008080;">513</span> <span style="color:#000000;">        }
</span><span style="color:#008080;">514</span> 
<span style="color:#008080;">515</span>         <span style="color:#0000ff;">protected</span> <span style="color:#0000ff;">override</span> <span style="color:#0000ff;">void</span><span style="color:#000000;"> OnModelCreating(DbModelBuilder modelBuilder)
</span><span style="color:#008080;">516</span> <span style="color:#000000;">        {
</span><span style="color:#008080;">517</span>             <span style="color:#008000;">//</span><span style="color:#008000;">去掉复数映射</span>
<span style="color:#008080;">518</span>             modelBuilder.Conventions.Remove&lt;PluralizingTableNameConvention&gt;<span style="color:#000000;">();
</span><span style="color:#008080;">519</span>             <span style="color:#0000ff;">base</span><span style="color:#000000;">.OnModelCreating(modelBuilder);
</span><span style="color:#008080;">520</span> <span style="color:#000000;">        }
</span><span style="color:#008080;">521</span> 
<span style="color:#008080;">522</span>         <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;summary&gt;</span>
<span style="color:#008080;">523</span>         <span style="color:#808080;">///</span><span style="color:#008000;"> 添加日志
</span><span style="color:#008080;">524</span>         <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;/summary&gt;</span>
<span style="color:#008080;">525</span>         <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;param name="info"&gt;&lt;/param&gt;</span>
<span style="color:#008080;">526</span>         <span style="color:#0000ff;">public</span> <span style="color:#0000ff;">void</span> AddLogger(<span style="color:#0000ff;">string</span><span style="color:#000000;"> info)
</span><span style="color:#008080;">527</span> <span style="color:#000000;">        {
</span><span style="color:#008080;">528</span>             <span style="color:#0000ff;">if</span> (info != <span style="color:#800000;">"</span><span style="color:#800000;">\r\n</span><span style="color:#800000;">"</span> &amp;&amp; (!info.Contains(<span style="color:#800000;">"</span><span style="color:#800000;">Sys_EventLog</span><span style="color:#800000;">"</span><span style="color:#000000;">)))
</span><span style="color:#008080;">529</span> <span style="color:#000000;">            {
</span><span style="color:#008080;">530</span>                 <span style="color:#0000ff;">string</span> strTemp =<span style="color:#000000;"> info.ToUpper().Trim();
</span><span style="color:#008080;">531</span>                 <span style="color:#0000ff;">if</span><span style="color:#000000;"> (isNew)
</span><span style="color:#008080;">532</span> <span style="color:#000000;">                {
</span><span style="color:#008080;">533</span>                     <span style="color:#008000;">//</span><span style="color:#008000;">记录增删改</span>
<span style="color:#008080;">534</span>                     <span style="color:#0000ff;">if</span> (strTemp.StartsWith(<span style="color:#800000;">"</span><span style="color:#800000;">INSERT</span><span style="color:#800000;">"</span>) || strTemp.StartsWith(<span style="color:#800000;">"</span><span style="color:#800000;">UPDATE</span><span style="color:#800000;">"</span>) || strTemp.StartsWith(<span style="color:#800000;">"</span><span style="color:#800000;">DELETE</span><span style="color:#800000;">"</span><span style="color:#000000;">))
</span><span style="color:#008080;">535</span> <span style="color:#000000;">                    {
</span><span style="color:#008080;">536</span>                         strMsg =<span style="color:#000000;"> info;
</span><span style="color:#008080;">537</span>                         isNew = <span style="color:#0000ff;">false</span><span style="color:#000000;">;
</span><span style="color:#008080;">538</span> <span style="color:#000000;">                    }
</span><span style="color:#008080;">539</span> <span style="color:#000000;">                }
</span><span style="color:#008080;">540</span>                 <span style="color:#0000ff;">else</span>
<span style="color:#008080;">541</span> <span style="color:#000000;">                {
</span><span style="color:#008080;">542</span>                     <span style="color:#0000ff;">if</span> (strTemp.StartsWith(<span style="color:#800000;">"</span><span style="color:#800000;">CLOSED CONNECTION</span><span style="color:#800000;">"</span><span style="color:#000000;">))
</span><span style="color:#008080;">543</span> <span style="color:#000000;">                    {
</span><span style="color:#008080;">544</span>                         <span style="color:#008000;">//</span><span style="color:#008000;">增加新日志</span>
<span style="color:#008080;">545</span>                         <span style="color:#0000ff;">using</span> (SysDb db = <span style="color:#0000ff;">new</span><span style="color:#000000;"> SysDb(strConn))
</span><span style="color:#008080;">546</span> <span style="color:#000000;">                        {
</span><span style="color:#008080;">547</span>                             <span style="color:#0000ff;">try</span>
<span style="color:#008080;">548</span> <span style="color:#000000;">                            {
</span><span style="color:#008080;">549</span>                 <span style="color:#008000;">//</span><span style="color:#008000;">保存日志到数据库或其他地方</span>
<span style="color:#008080;">550</span> 
<span style="color:#008080;">551</span> <span style="color:#000000;">                            }
</span><span style="color:#008080;">552</span>                             <span style="color:#0000ff;">catch</span><span style="color:#000000;"> (Exception ex)
</span><span style="color:#008080;">553</span> <span style="color:#000000;">                            {
</span><span style="color:#008080;">554</span>                                 <span style="color:#0000ff;">using</span> (System.IO.StreamWriter sw = <span style="color:#0000ff;">new</span> System.IO.StreamWriter(AppDomain.CurrentDomain.BaseDirectory + <span style="color:#800000;">"</span><span style="color:#800000;">//logError.txt</span><span style="color:#800000;">"</span><span style="color:#000000;">))
</span><span style="color:#008080;">555</span> <span style="color:#000000;">                                {
</span><span style="color:#008080;">556</span> <span style="color:#000000;">                                    sw.Write(ex.Message);
</span><span style="color:#008080;">557</span> <span style="color:#000000;">                                    sw.Flush();
</span><span style="color:#008080;">558</span> <span style="color:#000000;">                                }
</span><span style="color:#008080;">559</span> <span style="color:#000000;">                            }
</span><span style="color:#008080;">560</span> <span style="color:#000000;">                        }
</span><span style="color:#008080;">561</span>                         <span style="color:#008000;">//</span><span style="color:#008000;">清空</span>
<span style="color:#008080;">562</span>                         strMsg = <span style="color:#800000;">""</span><span style="color:#000000;">;
</span><span style="color:#008080;">563</span>                         isNew = <span style="color:#0000ff;">true</span><span style="color:#000000;">;
</span><span style="color:#008080;">564</span> <span style="color:#000000;">                    }
</span><span style="color:#008080;">565</span>                     <span style="color:#0000ff;">else</span>
<span style="color:#008080;">566</span> <span style="color:#000000;">                    {
</span><span style="color:#008080;">567</span>                         strMsg +=<span style="color:#000000;"> info;
</span><span style="color:#008080;">568</span> <span style="color:#000000;">                    }
</span><span style="color:#008080;">569</span> <span style="color:#000000;">                }
</span><span style="color:#008080;">570</span> 
<span style="color:#008080;">571</span> <span style="color:#000000;">            }
</span><span style="color:#008080;">572</span> <span style="color:#000000;">        }
</span><span style="color:#008080;">573</span> 
<span style="color:#008080;">574</span>         
<span style="color:#008080;">575</span> <span style="color:#000000;">    }
</span><span style="color:#008080;">576</span>     <span style="color:#0000ff;">public</span> <span style="color:#0000ff;">class</span> SysDb&lt;T&gt; : SysDb <span style="color:#0000ff;">where</span> T : <span style="color:#0000ff;">class</span>
<span style="color:#008080;">577</span> <span style="color:#000000;">    {
</span><span style="color:#008080;">578</span>         <span style="color:#0000ff;">public</span> SysDb(<span style="color:#0000ff;">string</span> connString) : <span style="color:#008000;">//</span><span style="color:#008000;"> 数据库链接字符串</span>
<span style="color:#008080;">579</span>             <span style="color:#0000ff;">base</span><span style="color:#000000;">(connString)
</span><span style="color:#008080;">580</span> <span style="color:#000000;">        {
</span><span style="color:#008080;">581</span>             Database.SetInitializer&lt;SysDb&lt;T&gt;&gt;(<span style="color:#0000ff;">null</span>);<span style="color:#008000;">//</span><span style="color:#008000;">设置为空，防止自动检查和生成</span>
<span style="color:#008080;">582</span> <span style="color:#000000;">        }
</span><span style="color:#008080;">583</span> 
<span style="color:#008080;">584</span>         <span style="color:#0000ff;">public</span> SysDb(<span style="color:#0000ff;">string</span> connString, <span style="color:#0000ff;">string</span> logUserName, <span style="color:#0000ff;">string</span> logAdditionalInfo) : <span style="color:#008000;">//</span><span style="color:#008000;"> 数据库链接字符串</span>
<span style="color:#008080;">585</span>             <span style="color:#0000ff;">base</span><span style="color:#000000;">(connString,logUserName,logAdditionalInfo)
</span><span style="color:#008080;">586</span> <span style="color:#000000;">        {
</span><span style="color:#008080;">587</span>             Database.SetInitializer&lt;SysDb&lt;T&gt;&gt;(<span style="color:#0000ff;">null</span>);<span style="color:#008000;">//</span><span style="color:#008000;">设置为空，防止自动检查和生成</span>
<span style="color:#008080;">588</span> <span style="color:#000000;">        }
</span><span style="color:#008080;">589</span> 
<span style="color:#008080;">590</span>         <span style="color:#0000ff;">public</span> DbSet&lt;T&gt; Entities { <span style="color:#0000ff;">get</span>; <span style="color:#0000ff;">set</span><span style="color:#000000;">; }
</span><span style="color:#008080;">591</span> <span style="color:#000000;">    }
</span><span style="color:#008080;">592</span> <span style="color:#000000;">界面使用：（bll层忽略）
</span><span style="color:#008080;">593</span> 
<span style="color:#008080;">594</span> <span style="color:#0000ff;">public</span> <span style="color:#0000ff;">class</span><span style="color:#000000;"> BusinessController : Controller
</span><span style="color:#008080;">595</span> <span style="color:#000000;">    {
</span><span style="color:#008080;">596</span>         <span style="color:#008000;">//</span>
<span style="color:#008080;">597</span>         <span style="color:#008000;">//</span><span style="color:#008000;"> GET: /Jygl/Business/</span>
<span style="color:#008080;">598</span>         BaseBLL basebll = <span style="color:#0000ff;">new</span><span style="color:#000000;"> BaseBLL(WebHelper.Conn);
</span><span style="color:#008080;">599</span> 
<span style="color:#008080;">600</span>         <span style="color:#0000ff;">public</span> ActionResult GetXMList(<span style="color:#0000ff;">int</span> page,<span style="color:#0000ff;">int</span><span style="color:#000000;"> rows)
</span><span style="color:#008080;">601</span> <span style="color:#000000;">        {
</span><span style="color:#008080;">602</span>             <span style="color:#0000ff;">int</span> count = <span style="color:#800080;">0</span><span style="color:#000000;">;
</span><span style="color:#008080;">603</span>             <span style="color:#008000;">//</span><span style="color:#008000;">查询条件
</span><span style="color:#008080;">604</span>             <span style="color:#008000;">//</span><span style="color:#008000;">Expression&lt;Func&lt;JY_XM, bool&gt;&gt; searchPredicate = PredicateBuilder.True&lt;JY_XM&gt;();
</span><span style="color:#008080;">605</span>             <span style="color:#008000;">//</span><span style="color:#008000;">searchPredicate = searchPredicate.And(c =&gt; c.UserName.Contains(""));</span>
<span style="color:#008080;">606</span>             Expression&lt;Func&lt;JY_XM, <span style="color:#0000ff;">int</span>&gt;&gt; keySelector = u =&gt;<span style="color:#000000;"> u.UID;
</span><span style="color:#008080;">607</span>             <span style="color:#0000ff;">string</span> str = ExceptionHelper&lt;JY_XM&gt;.TryCatchPageQueryJson&lt;<span style="color:#0000ff;">int</span>&gt;(basebll.GetListPaged, page, rows, keySelector, <span style="color:#0000ff;">false</span>, <span style="color:#0000ff;">out</span><span style="color:#000000;"> count);
</span><span style="color:#008080;">608</span>             <span style="color:#0000ff;">return</span><span style="color:#000000;"> Content(str); 
</span><span style="color:#008080;">609</span> <span style="color:#000000;">        }
</span><span style="color:#008080;">610</span> 
<span style="color:#008080;">611</span> <span style="color:#000000;">        [HttpPost]
</span><span style="color:#008080;">612</span>         <span style="color:#0000ff;">public</span><span style="color:#000000;"> ActionResult XMEdit(JY_XM jyxm)
</span><span style="color:#008080;">613</span> <span style="color:#000000;">        {
</span><span style="color:#008080;">614</span> <span style="color:#000000;">            basebll.Add(jyxm);
</span><span style="color:#008080;">615</span>             <span style="color:#0000ff;">return</span><span style="color:#000000;"> View();
</span><span style="color:#008080;">616</span> <span style="color:#000000;">        }
</span><span style="color:#008080;">617</span> 
<span style="color:#008080;">618</span>         <span style="color:#0000ff;">public</span><span style="color:#000000;"> ActionResult GetAllGCLB()
</span><span style="color:#008080;">619</span> <span style="color:#000000;">        {
</span><span style="color:#008080;">620</span> 
<span style="color:#008080;">621</span>             List&lt;DICT_GCLB&gt; lsGCLB = basebll.GetAll&lt;DICT_GCLB&gt;<span style="color:#000000;">();
</span><span style="color:#008080;">622</span>             DICT_GCLB dicNew=<span style="color:#0000ff;">new</span><span style="color:#000000;"> DICT_GCLB();
</span><span style="color:#008080;">623</span>             dicNew.GCLBText=<span style="color:#800000;">"</span><span style="color:#800000;">-请选择-</span><span style="color:#800000;">"</span><span style="color:#000000;">;
</span><span style="color:#008080;">624</span>             dicNew.GCLBId=<span style="color:#800080;">0</span><span style="color:#000000;">;
</span><span style="color:#008080;">625</span> <span style="color:#000000;">            lsGCLB.Add(dicNew);
</span><span style="color:#008080;">626</span> 
<span style="color:#008080;">627</span>             <span style="color:#0000ff;">return</span><span style="color:#000000;"> Content(WebHelper.Json(lsGCLB));
</span><span style="color:#008080;">628</span> <span style="color:#000000;">        }
</span><span style="color:#008080;">629</span> 
<span style="color:#008080;">630</span>         <span style="color:#0000ff;">public</span><span style="color:#000000;"> ActionResult GetAllArea()
</span><span style="color:#008080;">631</span> <span style="color:#000000;">        {
</span><span style="color:#008080;">632</span>             List&lt;DICT_Area&gt; lsArea = basebll.GetAll&lt;DICT_Area&gt;<span style="color:#000000;">();
</span><span style="color:#008080;">633</span>             DICT_Area dicNew=<span style="color:#0000ff;">new</span><span style="color:#000000;"> DICT_Area();
</span><span style="color:#008080;">634</span>             dicNew.AreaText=<span style="color:#800000;">"</span><span style="color:#800000;">-请选择-</span><span style="color:#800000;">"</span><span style="color:#000000;">;
</span><span style="color:#008080;">635</span>             dicNew.AreaId=<span style="color:#800080;">0</span><span style="color:#000000;">;
</span><span style="color:#008080;">636</span> <span style="color:#000000;">            lsArea.Add(dicNew);
</span><span style="color:#008080;">637</span>             <span style="color:#0000ff;">return</span><span style="color:#000000;"> Content(WebHelper.Json(lsArea));
</span><span style="color:#008080;">638</span> <span style="color:#000000;">        }
</span><span style="color:#008080;">639</span>     }</pre> 
 </div> 
 <p> </p> 
</div> 
<p>转载于:https://www.cnblogs.com/slnzl/p/6189069.html</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0f6b987f841b5699151202d7ec44175d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">RESTful学习笔记 --- TypeError: __init__() got an unexpected keyword argument &#39;method&#39;</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/89b2847464337daf115625355e83a96a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">[Scrapy]模拟登陆并获取Cookie值</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>