<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Opencv处理图像--细化 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Opencv处理图像--细化" />
<meta property="og:description" content="Opencv处理图像--细化 细化的算法有很多种，但比较常用的算法是查表法
细化是从原来的图中去掉一些点，但仍要保持原来的形状。
实际上是保持原图的骨架。
代码如上：
#include&lt;iostream&gt; #include&lt;opencv2/core/core.hpp&gt; #include&lt;opencv2/highgui/highgui.hpp&gt; IplImage* ColorSrc ,*ColorSrcCopy; //#define SHOW //#define LONG int //#define BYTE unsigned char / //基于索引表的细化细化算法 //功能：对图象进行细化 //参数：lpDIBBits：代表图象的一维数组 // lWidth：图象高度 // lHeight：图象宽度 // 无返回值 bool ThiningDIBSkeleton (unsigned char* lpDIBBits, int lWidth, int lHeight) {	//循环变量 long i; long j; long lLength; unsigned char deletemark[256] = { 0,0,0,0,0,0,0,1,	0,0,1,1,0,0,1,1, 0,0,0,0,0,0,0,0,	0,0,1,1,1,0,1,1, 0,0,0,0,0,0,0,0,	1,0,0,0,1,0,1,1, 0,0,0,0,0,0,0,0,	1,0,1,1,1,0,1,1, 0,0,0,0,0,0,0,0,	0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,	0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,	1,0,0,0,1,0,1,1, 1,0,0,0,0,0,0,0,	1,0,1,1,1,0,1,1, 0,0,1,1,0,0,1,1,	0,0,0,1,0,0,1,1, 0,0,0,0,0,0,0,0,	0,0,0,1,0,0,1,1, 1,1,0,1,0,0,0,1,	0,0,0,0,0,0,0,0, 1,1,0,1,0,0,0,1,	1,1,0,0,1,0,0,0, 0,1,1,1,0,0,1,1,	0,0,0,1,0,0,1,1, 0,0,0,0,0,0,0,0,	0,0,0,0,0,1,1,1, 1,1,1,1,0,0,1,1,	1,1,0,0,1,1,0,0, 1,1,1,1,0,0,1,1,	1,1,0,0,1,1,0,0 };//索引表 unsigned char p0, p1, p2, p3, p4, p5, p6, p7; unsigned char *pmid, *pmidtemp; unsigned char sum; int changed; bool bStart = true; lLength = lWidth * lHeight; unsigned char *pTemp = (unsigned char *)malloc(sizeof(unsigned char) * lWidth * lHeight); // P0 P1 P2 // P7 P3 // P6 P5 P4 while(bStart) { bStart = false; changed = 0; //首先求边缘点(并行) pmid = (unsigned char *)lpDIBBits &#43; lWidth &#43; 1; memset(pTemp, 0, lLength); pmidtemp = (unsigned char *)pTemp &#43; lWidth &#43; 1; for(i = 1; i &lt; lHeight -1; i&#43;&#43;) { for(j = 1; j &lt; lWidth - 1; j&#43;&#43;) { if( *pmid == 0) { pmid&#43;&#43;; pmidtemp&#43;&#43;; continue; } p3 = *(pmid &#43; 1); p2 = *(pmid &#43; 1 - lWidth); p1 = *(pmid - lWidth); p0 = *(pmid - lWidth -1); p7 = *(pmid - 1); p6 = *(pmid &#43; lWidth - 1); p5 = *(pmid &#43; lWidth); p4 = *(pmid &#43; lWidth &#43; 1); sum = p0 &amp; p1 &amp; p2 &amp; p3 &amp; p4 &amp; p5 &amp; p6 &amp; p7; if(sum == 0) { *pmidtemp = 1; #ifdef SHOW cvSet2D(ColorSrc,i,j,cvScalar(0,0,255)); #endif } pmid&#43;&#43;; pmidtemp&#43;&#43;; } pmid&#43;&#43;; pmid&#43;&#43;; pmidtemp&#43;&#43;; pmidtemp&#43;&#43;; } #ifdef SHOW cvNamedWindow(&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/36568ebc695d1c4aae3405a2b2621548/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-08-07T14:51:11+08:00" />
<meta property="article:modified_time" content="2018-08-07T14:51:11+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Opencv处理图像--细化</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3>Opencv处理图像--细化</h3> 
<p>细化的算法有很多种，但比较常用的算法是查表法</p> 
<p>细化是从原来的图中去掉一些点，但仍要保持原来的形状。</p> 
<p>实际上是保持原图的骨架。</p> 
<p>代码如上：</p> 
<pre class="has"><code class="language-cpp">#include&lt;iostream&gt;
#include&lt;opencv2/core/core.hpp&gt;
#include&lt;opencv2/highgui/highgui.hpp&gt;


IplImage* ColorSrc ,*ColorSrcCopy;

//#define SHOW

//#define LONG int
//#define BYTE unsigned char
/
//基于索引表的细化细化算法
//功能：对图象进行细化
//参数：lpDIBBits：代表图象的一维数组
//      lWidth：图象高度
//      lHeight：图象宽度
//      无返回值
bool ThiningDIBSkeleton (unsigned char* lpDIBBits, int lWidth, int lHeight)
{	
	//循环变量
	long i;
	long j;
	long lLength;

	unsigned char deletemark[256] = {
		0,0,0,0,0,0,0,1,	0,0,1,1,0,0,1,1,
		0,0,0,0,0,0,0,0,	0,0,1,1,1,0,1,1,
		0,0,0,0,0,0,0,0,	1,0,0,0,1,0,1,1,
		0,0,0,0,0,0,0,0,	1,0,1,1,1,0,1,1,
		0,0,0,0,0,0,0,0,	0,0,0,0,0,0,0,0,
		0,0,0,0,0,0,0,0,	0,0,0,0,0,0,0,0,
		0,0,0,0,0,0,0,0,	1,0,0,0,1,0,1,1,
		1,0,0,0,0,0,0,0,	1,0,1,1,1,0,1,1,
		0,0,1,1,0,0,1,1,	0,0,0,1,0,0,1,1,
		0,0,0,0,0,0,0,0,	0,0,0,1,0,0,1,1,
		1,1,0,1,0,0,0,1,	0,0,0,0,0,0,0,0,
		1,1,0,1,0,0,0,1,	1,1,0,0,1,0,0,0,
		0,1,1,1,0,0,1,1,	0,0,0,1,0,0,1,1,
		0,0,0,0,0,0,0,0,	0,0,0,0,0,1,1,1,
		1,1,1,1,0,0,1,1,	1,1,0,0,1,1,0,0,
		1,1,1,1,0,0,1,1,	1,1,0,0,1,1,0,0
	};//索引表

	unsigned char p0, p1, p2, p3, p4, p5, p6, p7;
	unsigned char *pmid, *pmidtemp;
	unsigned char sum;
	int changed;
	bool bStart = true;
	lLength = lWidth * lHeight;
	unsigned char *pTemp = (unsigned char *)malloc(sizeof(unsigned char) * lWidth * lHeight);
	
	//    P0 P1 P2
	//    P7    P3
	//    P6 P5 P4

	while(bStart)
	{
		bStart = false;
		changed = 0;

		//首先求边缘点(并行)
		pmid = (unsigned char *)lpDIBBits + lWidth + 1;
		memset(pTemp,  0, lLength);
		pmidtemp = (unsigned char *)pTemp + lWidth + 1;
		for(i = 1; i &lt; lHeight -1; i++)
		{
			for(j = 1; j &lt; lWidth - 1; j++)
			{
				if( *pmid == 0)
				{
					pmid++;
					pmidtemp++;
					continue;
				}

				p3 = *(pmid + 1);
				p2 = *(pmid + 1 - lWidth);
				p1 = *(pmid - lWidth);
				p0 = *(pmid - lWidth -1);
				p7 = *(pmid - 1);
				p6 = *(pmid + lWidth - 1);
				p5 = *(pmid + lWidth);
				p4 = *(pmid + lWidth + 1);
				
				sum = p0 &amp; p1 &amp; p2 &amp; p3 &amp; p4 &amp; p5 &amp; p6 &amp; p7;
				if(sum == 0)
				{
					*pmidtemp = 1;
					
					#ifdef SHOW
					cvSet2D(ColorSrc,i,j,cvScalar(0,0,255));
					#endif
				}

				pmid++;
				pmidtemp++;
			}
			pmid++;
			pmid++;
			pmidtemp++;
			pmidtemp++;
		}
		#ifdef SHOW
		cvNamedWindow("color");
		cvShowImage("color",ColorSrc);
		cvWaitKey(0);
		#endif
		
		//现在开始串行删除
		pmid = (unsigned char *)lpDIBBits + lWidth + 1;
		pmidtemp = (unsigned char *)pTemp + lWidth + 1;

		for(i = 1; i &lt; lHeight -1; i++)
		{
			for(j = 1; j &lt; lWidth - 1; j++)
			{
				if( *pmidtemp == 0)
				{
					pmid++;
					pmidtemp++;
					continue;
				}

				p3 = *(pmid + 1);
				p2 = *(pmid + 1 - lWidth);
				p1 = *(pmid - lWidth);
				p0 = *(pmid - lWidth -1);
				p7 = *(pmid - 1);
				p6 = *(pmid + lWidth - 1);
				p5 = *(pmid + lWidth);
				p4 = *(pmid + lWidth + 1);
				
				p1 *= 2;
				p2 *= 4;
				p3 *= 8;
				p4 *= 16;
				p5 *= 32;
				p6 *= 64;
				p7 *= 128;

				sum = p0 | p1 | p2 | p3 | p4 | p5 | p6 | p7;
			//	sum = p0 + p1 + p2 + p3 + p4 + p5 + p6 + p7;
				if(deletemark[sum] == 1)
				{
					*pmid = 0;
					bStart = true;

					#ifdef SHOW
					cvSet2D(ColorSrc,i,j,cvScalar(0,0,0));

					cvNamedWindow("delcolor");
					cvShowImage("delcolor",ColorSrc);
					cvWaitKey(2);
					#endif
				}

				pmid++;
				pmidtemp++;
			}

			pmid++;
			pmid++;
			pmidtemp++;
			pmidtemp++;
		}
		
		#ifdef SHOW
		printf("过了一圈\n");
		#endif
	}

	return true;
}

int main()
{
	//#define WRITERESULT
	//#define WRITEIMAGE

	IplImage* src = cvLoadImage("char2.png",0); //加载图像并灰度化
	cvThreshold(src,src,100,255,CV_THRESH_BINARY);  //二值化图像  
	unsigned char* imagedata ;

	ColorSrc = cvLoadImage("char2.png",1);

	cvNamedWindow("s");
	cvShowImage("s" , src);


	FILE* fp ;

	#ifdef WRITEIMAGE
		fp = fopen("data255.txt","rt+");
	#endif

	imagedata = (unsigned char*)malloc(sizeof(char)*src-&gt;width*src-&gt;height); //动态分配内存

	int x , y;
	for(y=0;y&lt;src-&gt;height;y++)
	{
		unsigned char* ptr  = (unsigned char*)(src-&gt;imageData + y*src-&gt;widthStep);
		for(x=0;x&lt;src-&gt;width;x++)
		{
			imagedata[y*src-&gt;width+x] = ptr[x] &gt; 0 ? 1 : 0;

            #ifdef WRITEIMAGE
				if(ptr[x] &gt; 0)
					fprintf(fp,"1");
				else
				{
					fprintf(fp,"0");
				}
            #endif
		}

		#ifdef WRITEIMAGE
			fprintf(fp,"\n");
        #endif
	}

	#ifdef WRITEIMAGE
		fclose(fp);
	#endif

	#ifdef WRITERESULT
		fp = fopen("result.txt","rt+");
	#endif
	
	ThiningDIBSkeleton(imagedata,src-&gt;width,src-&gt;height);//进行细化操作

	for(y=0;y&lt;src-&gt;height;y++)
	{
		unsigned char* ptr  = (unsigned char*)(src-&gt;imageData + y*src-&gt;widthStep);
		for(x=0;x&lt;src-&gt;width;x++)
		{
			ptr[x] = imagedata[y*src-&gt;width + x]&gt;0? 255 : 0;

			#ifdef WRITERESULT
				if(ptr[x] &gt; 0)
					fprintf(fp,"1");
				else
				{
					fprintf(fp,"0");
				}
            #endif
		}

		#ifdef WRITERESULT
			fprintf(fp,"\n");
        #endif
	}

	#ifdef WRITERESULT
		fclose(fp);
	#endif

	cvNamedWindow("src");
	cvShowImage("src" , src);
	cvWaitKey(0);

	cvReleaseImage(&amp;src);
	cvReleaseImage(&amp;ColorSrc);
	free(imagedata);

	return 0;
}

</code></pre> 
<p><img alt="" class="has" height="105" src="https://images2.imgbox.com/72/56/ay69iHNz_o.png" width="152"><img alt="" class="has" height="105" src="https://images2.imgbox.com/5b/00/CT6if6En_o.png" width="152">   细化前后对比</p> 
<p>博客参考<a href="https://www.cnblogs.com/zhazhiqiang/p/4487950.html" rel="nofollow">https://www.cnblogs.com/zhazhiqiang/p/4487950.html</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f8eaed9f70c016ba091f598d98c1e5a2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">题解报告：poj 1321 棋盘问题（dfs）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a2905be25b219a20b9b9b59b544e76bd/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Android Studio快捷键Ctrl&#43;Shift&#43;F不能用，全局搜索不能用；</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>