<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>PPPoE Server Under Ubuntu/Debian - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="PPPoE Server Under Ubuntu/Debian" />
<meta property="og:description" content="http://imranasghar.blogspot.com/2009/05/pppoe-server-under-ubuntudebian.html
----------------------------
PPPoE Server Setup:
Operating System: Ubuntu Desktop(8.04)
1) Installation of Softwares:
Server Side
a) ppp
apt-get install ppp
b) pppoe
apt-get install pppoe
c) rp-pppoe (I used rp-pppoe-3.10.tar.gz)
RP PPPoE; can be obtained from,
http://www.roaringpenguin.com/products/pppoe
After download
Move it to some place e.g /var/tmp, unpack and change permission
root@pppoe:/var/tmp# mv /home/imran/Desktop/rp-pppoe-3.10.tar.gz /var/tmp/
root@pppoe:/var/tmp# tar -xvf rp-pppoe-3.10.tar.gz
root@pppoe:/var/tmp# chown imran:imran rp-pppoe-3.10
root@pppoe:/var/tmp# ls -l
total 220
drwxr-xr-x 8 imran imran 4096 2008-06-30 16:00 rp-pppoe-3." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/6498ddb9d7bfae23da1969fb9a71d747/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-07-02T22:46:50+08:00" />
<meta property="article:modified_time" content="2019-07-02T22:46:50+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">PPPoE Server Under Ubuntu/Debian</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div id="cnblogs_post_body" class="blogpost-body"> 
 <p><span style="font-size:12px;">http://imranasghar.blogspot.com/2009/05/pppoe-server-under-ubuntudebian.html</span></p> 
 <p><span style="font-size:12px;">----------------------------</span></p> 
 <p><span style="font-size:12px;">PPPoE Server Setup:</span><br><span style="font-size:12px;">Operating System: Ubuntu Desktop(8.04)</span><br><br><span style="font-size:12px;">1) Installation of Softwares:</span><br><span style="font-size:12px;">Server Side</span><br><span style="font-size:12px;">a) ppp</span><br><span style="font-size:12px;">apt-get install ppp</span><br><span style="font-size:12px;">b) pppoe</span><br><span style="font-size:12px;">apt-get install pppoe</span><br><span style="font-size:12px;">c) rp-pppoe (I used rp-pppoe-3.10.tar.gz)</span><br><span style="font-size:12px;">RP PPPoE; can be obtained from,</span><br><span style="font-size:12px;">http://www.roaringpenguin.com/products/pppoe</span><br><span style="font-size:12px;">After download</span><br><span style="font-size:12px;">Move it to some place e.g /var/tmp, unpack and change permission</span><br><br><span style="font-size:12px;">root@pppoe:/var/tmp# mv /home/imran/Desktop/rp-pppoe-3.10.tar.gz /var/tmp/</span><br><br><span style="font-size:12px;">root@pppoe:/var/tmp# tar -xvf rp-pppoe-3.10.tar.gz</span><br><br><span style="font-size:12px;">root@pppoe:/var/tmp# chown imran:imran rp-pppoe-3.10</span><br><br><span style="font-size:12px;">root@pppoe:/var/tmp# ls -l</span><br><br><span style="font-size:12px;">total 220</span><br><br><span style="font-size:12px;">drwxr-xr-x 8 imran imran   4096 2008-06-30 16:00 rp-pppoe-3.10</span><br><br><span style="font-size:12px;">-rw-r--r-- 1 imran imran 215288 2009-10-19 10:31 rp-pppoe-3.10.tar.gz</span><br><br><span style="font-size:12px;">root@pppoe:/var/tmp# </span><br><br><br><span style="font-size:12px;">Open README file and go through it.There are 3 methods I shall go for first one, QuickStart method.</span><br><br><span style="font-size:12px;">QUICKSTART Method: "If you're lucky, the "quickstart" method will work. After unpackingthe archive, become root and type"</span><br><span style="font-size:12px;">root@pppoe:/var/tmp# cd rp-pppoe-3.10/</span><br><span style="font-size:12px;">root@pppoe:/var/tmp/rp-pppoe-3.10# ./go</span><br><br><span style="font-size:12px;">I got some gcc error, fixed it by installing "build-essential", This will install gcc and a some other files that need to build something from source.</span><br><br><span style="font-size:12px;">sudo aptitude install build-essential</span><br><br><span style="font-size:12px;">root@pppoe:/var/tmp/rp-pppoe-3.10# ./go</span><br><br><span style="font-size:12px;">** Summary of what you entered **</span><br><br><span style="font-size:12px;">Ethernet Interface: eth1</span><br><span style="font-size:12px;">User name:          test</span><br><span style="font-size:12px;">Activate-on-demand: No</span><br><span style="font-size:12px;">Primary DNS:        82.196.201.43</span><br><span style="font-size:12px;">Secondary DNS:      82.196.193.143</span><br><span style="font-size:12px;">Firewalling:        NONE</span><br><br><span style="font-size:12px;">&gt;&gt;&gt; Accept these settings and adjust configuration files (y/n)? y</span><br><span style="font-size:12px;">Adjusting /etc/ppp/pppoe.conf</span><br><span style="font-size:12px;">Adjusting /etc/resolv.conf</span><br><span style="font-size:12px;"> (But first backing it up to /etc/resolv.conf-bak)</span><br><span style="font-size:12px;">Adjusting /etc/ppp/pap-secrets and /etc/ppp/chap-secrets</span><br><span style="font-size:12px;"> (But first backing it up to /etc/ppp/pap-secrets-bak)</span><br><span style="font-size:12px;"> (But first backing it up to /etc/ppp/chap-secrets-bak)</span><br><br><br><br><span style="font-size:12px;">You will get messeg, "Congratulations, it should be all set up!"</span><br><span style="font-size:12px;">Type 'pppoe-start' to bring up your PPPoE link and 'pppoe-stop' to bring</span><br><span style="font-size:12px;">it down. Type 'pppoe-status' to see the link status.</span><br><br><span style="font-size:12px;">Client Side :</span><br><span style="font-size:12px;"># apt-get install pppoeconf</span><br><br><span style="font-size:12px;">This will use to connect the pppoe server.</span><br><br><span style="font-size:12px;">2) Configuration</span><br><span style="font-size:12px;">Server side: Go the to /etc/ppp,</span><br><br><span style="font-size:12px;">root@pppoe:/var/tmp# cd /etc/ppp</span><br><span style="font-size:12px;">root@pppoe:/etc/ppp# ls</span><br><span style="font-size:12px;">chap-secrets              ip-down.d    options          pppoe.conf-bak</span><br><span style="font-size:12px;">chap-secrets-bak          ip-up        pap-secrets      pppoe_on_boot</span><br><span style="font-size:12px;">firewall-masq             ip-up.d      pap-secrets-bak  pppoe-server-options</span><br><span style="font-size:12px;">firewall-masq-3.10        ipv6-down    peers            pppoe-server-options-example</span><br><span style="font-size:12px;">firewall-standalone       ipv6-down.d  plugins          pppoe-up</span><br><span style="font-size:12px;">firewall-standalone-3.10  ipv6-up      pppoe.conf       resolv</span><br><span style="font-size:12px;">ip-down                   ipv6-up.d    pppoe.conf-3.10</span><br><span style="font-size:12px;">root@pppoe:/etc/ppp#</span><br><br><span style="font-size:12px;">Many files, but interested are , pppoe-server-options, pppoe.conf, options,pap-secrets,chap-secrets</span><br><span style="font-size:12px;">PAP is default authentication method, I let it.</span><br><span style="font-size:12px;">root@pppoe:/etc/ppp# nano pap-secrets</span><br><br><span style="font-size:12px;">#</span><br><span style="font-size:12px;"># /etc/ppp/pap-secrets</span><br><span style="font-size:12px;">#</span><br><br><span style="font-size:12px;"># INBOUND connections</span><br><br><span style="font-size:12px;"># Every regular user can use PPP and has to use passwords from /etc/passwd</span><br><span style="font-size:12px;">*       hostname        ""      *</span><br><br><span style="font-size:12px;"># UserIDs that cannot use PPP at all. Check your /etc/passwd and add any</span><br><span style="font-size:12px;"># other accounts that should not be able to use pppd!</span><br><span style="font-size:12px;">guest   hostname        "*"     -</span><br><span style="font-size:12px;">master  hostname        "*"     -</span><br><span style="font-size:12px;">root    hostname        "*"     -</span><br><span style="font-size:12px;">support hostname        "*"     -</span><br><span style="font-size:12px;">stats   hostname        "*"     -</span><br><span style="font-size:12px;"># OUTBOUND connections</span><br><br><span style="font-size:12px;"># Here you should add your userid password to connect to your providers via</span><br><span style="font-size:12px;"># PAP. The * means that the password is to be used for ANY host you connect</span><br><span style="font-size:12px;"># to. Thus you do not have to worry about the foreign machine name. Just</span><br><span style="font-size:12px;"># replace password with your password.</span><br><span style="font-size:12px;"># If you have different providers with different passwords then you better</span><br><span style="font-size:12px;"># remove the following line.</span><br><span style="font-size:12px;">#       *       password</span><br><br><span style="font-size:12px;">"test"  *       "test"</span><br><br><span style="font-size:12px;">You can change the authenticaion method from follwing file</span><br><span style="font-size:12px;">root@pppoe:/etc/ppp# nano pppoe-server-options</span><br><br><span style="font-size:12px;"># PPP options for the PPPoE server</span><br><span style="font-size:12px;"># LIC: GPL</span><br><span style="font-size:12px;">require-pap</span><br><span style="font-size:12px;">#require-chap</span><br><span style="font-size:12px;">login</span><br><span style="font-size:12px;">lcp-echo-interval 10</span><br><span style="font-size:12px;">lcp-echo-failure 2</span><br><br><br><span style="font-size:12px;">a) Change following in /etc/ppp/options file, some to them already uncommented.</span><br><span style="font-size:12px;">In case of chap as authentication, the file looks like</span><br><span style="font-size:12px;">root@pppoe:/etc/ppp# nano chap-secrets</span><br><br><br><span style="font-size:12px;"># Secrets for authentication using CHAP</span><br><span style="font-size:12px;"># client        server  secret                  IP addresses</span><br><br><span style="font-size:12px;">"test"          *        "test"         *</span><br><span style="font-size:12px;">"test1"         *        "test"         *</span><br><span style="font-size:12px;">"test2"         *       "test"          10.10.220.3</span><br><span style="font-size:12px;">"test3"         *       "test"          10.10.220.4</span><br><br><br><span style="font-size:12px;">Script that start the PPPoE server with NAT option</span><br><span style="font-size:12px;">Create a script pppoe-up and chmod to 755.</span><br><span style="font-size:12px;">root@pppoe:/etc/ppp# nano pppoe-up</span><br><span style="font-size:12px;">root@pppoe:/etc/ppp# chmod 755 pppoe-up</span><br><br><br><span style="font-size:12px;">#!/bin/bash</span><br><span style="font-size:12px;"># ----------------------------------------------------</span><br><br><span style="font-size:12px;"># Starts the PPPoE server and turns on NAT</span><br><br><span style="font-size:12px;"># ----------------------------------------------------</span><br><br><span style="font-size:12px;"># MAX is the maximum number of addresses your server</span><br><br><span style="font-size:12px;"># is allowed to hand out.</span><br><span style="font-size:12px;">PROV=pppoe</span><br><span style="font-size:12px;">MAX=5</span><br><br><span style="font-size:12px;"># BASE is the lowest IP address your server is allowed</span><br><br><span style="font-size:12px;"># to hand out.</span><br><br><span style="font-size:12px;">#BASE=192.168.1.238</span><br><span style="font-size:12px;">#PLA=192.168.1.0/24</span><br><br><span style="font-size:12px;">BASE=10.10.220.2</span><br><span style="font-size:12px;">PLA=10.10.220.4</span><br><br><span style="font-size:12px;"># NAT is the set of addresses which your server will</span><br><br><span style="font-size:12px;"># NAT behind it. Other addresses behind your server</span><br><br><span style="font-size:12px;"># WILL NOT be NATed.</span><br><br><span style="font-size:12px;">#NAT=10.10.220.0/8</span><br><br><span style="font-size:12px;"># MYIP is the public IP address of this server.</span><br><br><span style="font-size:12px;">MYIP=10.10.220.1</span><br><br><span style="font-size:12px;">##########################################</span><br><br><span style="font-size:12px;"># Here is where the script actually starts executing.</span><br><span style="font-size:12px;">##########################################</span><br><br><span style="font-size:12px;"># Disable IP spoofing on the external interface.</span><br><br><span style="font-size:12px;">#/sbin/iptables -A INPUT -i eth0 -s $NAT -j DROP</span><br><br><span style="font-size:12px;"># Enable NAT for the private addresses we hand out.</span><br><br><span style="font-size:12px;">#/sbin/iptables -t nat -A POSTROUTING -s $NAT -j $NAT --to-source $MYIP</span><br><br><span style="font-size:12px;"># Launch the server.</span><br><br><span style="font-size:12px;">/usr/sbin/pppoe-server pty -T 60 -I eth1 -L $MYIP -N $MAX -C $PROV -S $PROV -R $PLA</span><br><br><span style="font-size:12px;">#echo "1" &gt; "/proc/sys/net/ipv4/ip_forward"</span><br><br><br><span style="font-size:12px;">Client side</span><br><span style="font-size:12px;">Install pppoeconf, which may be already installed.</span><br><span style="font-size:12px;">apt-get install pppoeconf</span><br><br><span style="font-size:12px;">Run the Server</span><br><br><span style="font-size:12px;">Execute the pppoe-up script in server.</span><br><span style="font-size:12px;">root@pppoe:/etc/ppp# ./pppoe-up</span><br><br><span style="font-size:12px;">Connection of client</span><br><span style="font-size:12px;">Run pppoeconf in client's console,</span><br><span style="font-size:12px;">client# pppoeconf</span><br><br><span style="font-size:12px;">It will search for pppoe server on ethernet server. Once it found on, in this case in eth0 it will prompt for user name: test and passwd: test</span><br><br><span style="font-size:12px;">Testing and Troubleshooting</span><br><span style="font-size:12px;">Open the /var/log/syslog in server and monitor,</span><br><br><span style="font-size:12px;">da:72:54 (10.10.220.1) on eth1 using Service-Name ''</span><br><br><span style="font-size:12px;">Oct 19 12:58:11 pppoe pppd[6248]: pppd 2.4.4 started by root, uid 0</span><br><br><span style="font-size:12px;">Oct 19 12:58:11 pppoe pppd[6248]: Using interface ppp0</span><br><br><span style="font-size:12px;">Oct 19 12:58:11 pppoe pppd[6248]: Connect: ppp0 &lt;--&gt; /dev/pts/2</span><br><br><span style="font-size:12px;">Oct 19 12:58:17 pppoe pppd[6248]: PAP peer authentication failed for test</span><br><br><span style="font-size:12px;">Oct 19 12:58:17 pppoe pppd[6248]: Connection terminated.</span><br><br><span style="font-size:12px;">Oct 19 12:58:17 pppoe pppoe[6250]: read (asyncReadFromPPP): Session 2: Input/output error</span><br><br><span style="font-size:12px;">Oct 19 12:58:17 pppoe pppd[6248]: Exit.</span><br><br><span style="font-size:12px;">Oct 19 12:58:17 pppoe pppoe-server[5908]: Session 2 closed for client 00:1e:37:da:72:54 (10.10.220.1) on eth1</span><br><br><span style="font-size:12px;">Oct 19 12:58:17 pppoe pppoe-server[5908]: Sent PADT</span><br><br><span style="font-size:12px;">There are some problems which need to fix</span><br><span style="font-size:12px;">After fixing the issue, reconnect the client and monitor the log on server.</span><br><span style="font-size:12px;">client# pppoeconf</span><br><br><span style="font-size:12px;">Oct 19 13:19:18 pppoe pppd[8724]: pppd 2.4.4 started by root, uid 0</span><br><span style="font-size:12px;">Oct 19 13:19:18 pppoe pppd[8724]: Using interface ppp0</span><br><span style="font-size:12px;">Oct 19 13:19:18 pppoe pppd[8724]: Connect: ppp0 &lt;--&gt; /dev/pts/2</span><br><span style="font-size:12px;">Oct 19 13:19:21 pppoe pppd[8724]: Cannot determine ethernet address for proxy ARP</span><br><span style="font-size:12px;">Oct 19 13:19:21 pppoe pppd[8724]: local  IP address 10.10.220.1</span><br><span style="font-size:12px;">Oct 19 13:19:21 pppoe pppd[8724]: remote IP address 10.10.220.2</span><br><br><br><br><span style="font-size:12px;">It setted up ultimatley, I spent some time, checking the script carefully, running and testing several times before it was fixed.</span><br><br><span style="font-size:12px;">Final testing, Both client and server will get the ip and they are able to ping each other.</span><br><br><span style="font-size:12px;">Server side</span><br><span style="font-size:12px;">root@pppoe:/etc/ppp# ifconfig</span><br><span style="font-size:12px;">eth0      Link encap:Ethernet  HWaddr 00:11:25:ed:fd:e2 </span><br><span style="font-size:12px;">         inet addr:192.168.1.249  Bcast:192.168.1.255  Mask:255.255.255.0</span><br><span style="font-size:12px;">         inet6 addr: fe80::211:25ff:feed:fde2/64 Scope:Link</span><br><span style="font-size:12px;">         UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span style="font-size:12px;">         RX packets:8943 errors:0 dropped:0 overruns:0 frame:0</span><br><span style="font-size:12px;">         TX packets:3137 errors:0 dropped:0 overruns:0 carrier:0</span><br><span style="font-size:12px;">         collisions:0 txqueuelen:100</span><br><span style="font-size:12px;">         RX bytes:4222424 (4.0 MB)  TX bytes:833756 (814.2 KB)</span><br><span style="font-size:12px;">         Base address:0x4000 Memory:d0080000-d00a0000</span><br><br><span style="font-size:12px;">eth1      Link encap:Ethernet  HWaddr 00:08:a1:be:1d:65 </span><br><span style="font-size:12px;">         inet6 addr: fe80::208:a1ff:febe:1d65/64 Scope:Link</span><br><span style="font-size:12px;">         UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span style="font-size:12px;">         RX packets:648 errors:0 dropped:0 overruns:0 frame:0</span><br><span style="font-size:12px;">         TX packets:776 errors:0 dropped:0 overruns:0 carrier:0</span><br><span style="font-size:12px;">         collisions:0 txqueuelen:1000</span><br><span style="font-size:12px;">         RX bytes:39320 (38.3 KB)  TX bytes:50994 (49.7 KB)</span><br><span style="font-size:12px;">         Interrupt:21 Base address:0x6000</span><br><span style="font-size:12px;">eth1:avahi Link encap:Ethernet  HWaddr 00:08:a1:be:1d:65 </span><br><span style="font-size:12px;">         inet addr:169.254.5.242  Bcast:169.254.255.255  Mask:255.255.0.0</span><br><span style="font-size:12px;">         UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span style="font-size:12px;">         Interrupt:21 Base address:0x6000</span><br><br><span style="font-size:12px;">lo        Link encap:Local Loopback </span><br><span style="font-size:12px;">         inet addr:127.0.0.1  Mask:255.0.0.0</span><br><span style="font-size:12px;">         inet6 addr: ::1/128 Scope:Host</span><br><span style="font-size:12px;">         UP LOOPBACK RUNNING  MTU:16436  Metric:1</span><br><span style="font-size:12px;">         RX packets:2215 errors:0 dropped:0 overruns:0 frame:0</span><br><span style="font-size:12px;">         TX packets:2215 errors:0 dropped:0 overruns:0 carrier:0</span><br><span style="font-size:12px;">         collisions:0 txqueuelen:0</span><br><span style="font-size:12px;">         RX bytes:113003 (110.3 KB)  TX bytes:113003 (110.3 KB)</span><br><br><span style="font-size:12px;">ppp0      Link encap:Point-to-Point Protocol  </span><br><span style="font-size:12px;">          inet addr:10.10.220.1  P-t-P:10.10.220.2  Mask:255.255.255.255</span><br><span style="font-size:12px;">          UP POINTOPOINT RUNNING NOARP MULTICAST  MTU:1492  Metric:1</span><br><span style="font-size:12px;">          RX packets:12 errors:0 dropped:0 overruns:0 frame:0</span><br><span style="font-size:12px;">          TX packets:8 errors:0 dropped:0 overruns:0 carrier:0</span><br><span style="font-size:12px;">          collisions:0 txqueuelen:3 </span><br><span style="font-size:12px;">         RX bytes:724 (724.0 B)  TX bytes:382 (382.0 B)</span><br><br><br><span style="font-size:12px;">Ping from srver to client</span><br><br><span style="font-size:12px;">root@pppoe:/etc/ppp# ping 10.10.220.2</span><br><span style="font-size:12px;">PING 10.10.220.2 (10.10.220.2) 56(84) bytes of data.</span></p> 
</div> 
<p>转载于:https://www.cnblogs.com/kungfupanda/p/3268445.html</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fa80a403a5ac597268345963c9faa8a0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">qrfcview (RFC reader in Linux)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e66a31970b04ac960e62f0970ec02787/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Ubuntu上架设PPPoE Server</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>