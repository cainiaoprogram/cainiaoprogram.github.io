<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>如何在海思 Hi3519AV100上移植YOLOV3 （1） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="如何在海思 Hi3519AV100上移植YOLOV3 （1）" />
<meta property="og:description" content="HI3519AV100包含了深度学习的NNIE内核，算力为2TOPS，是目前同等算力下性价比最好的平台之一。公司产品已经可以实时运行YOLO V3，写这个系列的原因在于帮助我们开放平台下的开发者用户及公司新入职员工的使用培训，可以更快速的使用开发板进行模型的部署。
打个小广告：
海思hi3519av100开发板链接：
https://item.taobao.com/item.htm?spm=a230r.1.14.117.4afe75a61WreAX&amp;id=586610485052&amp;ns=1&amp;abbucket=1#detail
除了SDK与底板图纸之外我们提供了EMMC文件配置和摄像头采集到RFCN深度神经网络的物体识别和HDMI显示的完整代码，帮助开发者快速部署模型。
此篇为开篇，主要介绍都需要哪些关联的软件需要安装，环境怎么去搭建。
首先说明的是海思的文档中其实写的特别特别详细，大家可以去看详细的文档，我们重新写这个的目的是减少时间，只把关键的几个点写出来，如果怕安装出问题，可以阅读海思的详细文档。
海思相关的文档在 ..\Hi3519A V100R001C02SPC010\ReleaseDoc\zh\01.software\board\SVP 中的 “HiSVP 开发指南.pdf”。
Hi3519A目前支持的深度学习框架只有caffe，那两个文件是必不可少的：训练完成后 *.caffemodel，*.prototxt是必须要有的。
海思提供了一个mapper工具和一个simulation工具可以对模型进行量化和仿真。这两个工具都在海思提供的 RuyiStudio中，所以后面使用的软件就是RuyiStudio，以下简称RS。
RS是不需要安装的，直接解压就可以用，但是需要提前装好很多配置环境。
提前需要装的部分如下：
1. CUDA
2. CuDnn
3. OpenCV
4. wget
5. MinGW-w64
6. Msys
7. Python3.5
8. Caffe
9. VisualStudio2015
此部分软件为了方便使用我们会整理后上传到百度网盘。到时连接会贴到此博文中。
另外一点是如果不想出错就完全按照海思要求安装版本。
环境配置的过程后面有时间的时候会补充进来，着急用的朋友就看海思的文档吧。
---- YOLO V3移植-----
模型移植之前我们首先要做几件事情，
1）首先得有自己的模型或者用官方提供的模型也可以；
2）模型导入到RS中，做模型的mapper，生成 *.wk文件；
3）做mapper后的模型文件的仿真验证；
4）部署到板卡中运行。
一般在SVP中已经有YOLO V3的demo，至少我们提供的板卡上是有这个文件的。
直接在RS中打开工程文件，SDK中的路径为
..\Hi3519A V100R001C02SPC010\SVP_PC\HiSVP_PC_V1.2.0.5\software\sample_runtime
工程名称为.cproject .project
快速上手：
1）工程文件中首先找到*.cfg文件，在 sample_runtime\data\detection\yolov3 中，
此文件用来配置caffemodel转 *.wk 文件前的基本配置。
查看方式：右键—open with—mapper configuration editor
三个部分组成：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/f832d51afc1d419a0b5c7d95ccfdaf66/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-20T17:39:09+08:00" />
<meta property="article:modified_time" content="2023-12-20T17:39:09+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">如何在海思 Hi3519AV100上移植YOLOV3 （1）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="margin-left:0cm;">     HI3519AV100包含了深度学习的NNIE内核，算力为2TOPS，是目前同等算力下性价比最好的平台之一。公司产品已经可以实时运行YOLO V3，写这个系列的原因在于帮助我们开放平台下的开发者用户及公司新入职员工的使用培训，可以更快速的使用开发板进行模型的部署。</p> 
<p style="margin-left:0cm;">   打个小广告：</p> 
<p style="margin-left:0cm;">        海思hi3519av100开发板链接：</p> 
<p style="margin-left:0cm;"><a href="https://item.taobao.com/item.htm?spm=a230r.1.14.117.4afe75a61WreAX&amp;id=586610485052&amp;ns=1&amp;abbucket=1#detail" rel="nofollow" title="https://item.taobao.com/item.htm?spm=a230r.1.14.117.4afe75a61WreAX&amp;id=586610485052&amp;ns=1&amp;abbucket=1#detail">https://item.taobao.com/item.htm?spm=a230r.1.14.117.4afe75a61WreAX&amp;id=586610485052&amp;ns=1&amp;abbucket=1#detail</a></p> 
<p style="margin-left:0cm;">    除了SDK与底板图纸之外我们提供了EMMC文件配置和摄像头采集到RFCN深度神经网络的物体识别和HDMI显示的完整代码，帮助开发者快速部署模型。</p> 
<p style="margin-left:0cm;">      <img alt="" class="has" height="218" src="https://images2.imgbox.com/15/44/gEuZsAlH_o.png" width="386"></p> 
<p style="margin-left:0cm;">    此篇为开篇，主要介绍都需要哪些关联的软件需要安装，环境怎么去搭建。</p> 
<p style="margin-left:0cm;">    首先说明的是海思的文档中其实写的特别特别详细，大家可以去看详细的文档，我们重新写这个的目的是减少时间，只把关键的几个点写出来，如果怕安装出问题，可以阅读海思的详细文档。</p> 
<p style="margin-left:0cm;">海思相关的文档在 ..\Hi3519A V100R001C02SPC010\ReleaseDoc\zh\01.software\board\SVP 中的 “HiSVP 开发指南.pdf”。</p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="564" src="https://images2.imgbox.com/59/1e/49wqt0R3_o.png" width="385"></p> 
<p style="margin-left:0cm;"><strong>    Hi3519A目前支持的深度学习框架只有caffe，那两个文件是必不可少的：训练完成后 *.caffemodel，*.prototxt是必须要有的。</strong></p> 
<p style="margin-left:0cm;"><strong>    海思提供了一个mapper工具和一个simulation工具可以对模型进行量化和仿真。这两个工具都在海思提供的 RuyiStudio中，所以后面使用的软件就是RuyiStudio，以下简称RS。</strong></p> 
<p style="margin-left:0cm;"><strong>RS是不需要安装的，直接解压就可以用，但是需要提前装好很多配置环境。</strong></p> 
<p style="margin-left:0cm;"><strong>提前需要装的部分如下：</strong></p> 
<p style="margin-left:0cm;"><span style="color:#3399ea;"><strong>1. CUDA</strong></span></p> 
<p style="margin-left:0cm;"><span style="color:#3399ea;"><strong>2. CuDnn</strong></span></p> 
<p style="margin-left:0cm;"><span style="color:#3399ea;"><strong>3. OpenCV</strong></span></p> 
<p style="margin-left:0cm;"><span style="color:#3399ea;"><strong>4. wget</strong></span></p> 
<p style="margin-left:0cm;"><span style="color:#3399ea;"><strong>5. MinGW-w64</strong></span></p> 
<p style="margin-left:0cm;"><span style="color:#3399ea;"><strong>6. Msys</strong></span></p> 
<p style="margin-left:0cm;"><span style="color:#3399ea;"><strong>7. Python3.5</strong></span></p> 
<p style="margin-left:0cm;"><span style="color:#3399ea;"><strong>8. Caffe</strong></span></p> 
<p style="margin-left:0cm;"><span style="color:#3399ea;"><strong>9. VisualStudio2015</strong></span></p> 
<p style="margin-left:0cm;"><strong>此部分软件为了方便使用我们会整理后上传到百度网盘。到时连接会贴到此博文中。</strong></p> 
<p style="margin-left:0cm;">另外一点是如果不想出错就完全按照海思要求安装版本。</p> 
<p style="margin-left:0cm;">环境配置的过程后面有时间的时候会补充进来，着急用的朋友就看海思的文档吧。</p> 
<p style="margin-left:0cm;"><span style="color:#f33b45;"><strong>----  YOLO V3移植-----</strong></span></p> 
<p style="margin-left:0cm;">模型移植之前我们首先要做几件事情，</p> 
<p style="margin-left:0cm;"><strong>1）首先得有自己的模型或者用官方提供的模型也可以；</strong></p> 
<p style="margin-left:0cm;"><strong>2）模型导入到RS中，做模型的mapper，生成 *.wk文件；</strong></p> 
<p style="margin-left:0cm;"><strong>3）做mapper后的模型文件的仿真验证；</strong></p> 
<p style="margin-left:0cm;"><strong>4）部署到板卡中运行。</strong></p> 
<p style="margin-left:0cm;">一般在SVP中已经有YOLO V3的demo，至少我们提供的板卡上是有这个文件的。</p> 
<p style="margin-left:0cm;">直接在RS中打开工程文件，SDK中的路径为</p> 
<p style="margin-left:0cm;">..\Hi3519A V100R001C02SPC010\SVP_PC\HiSVP_PC_V1.2.0.5\software\sample_runtime</p> 
<p style="margin-left:0cm;">工程名称为.cproject .project</p> 
<p style="margin-left:0cm;"><strong>快速上手：</strong></p> 
<p style="margin-left:0cm;">1）工程文件中首先找到*.cfg文件，在 sample_runtime\data\detection\yolov3 中，</p> 
<p style="margin-left:0cm;">此文件用来配置caffemodel转 *.wk 文件前的基本配置。</p> 
<p style="margin-left:0cm;"><strong>查看方式：</strong>右键—open with—mapper configuration editor</p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="711" src="https://images2.imgbox.com/b4/b8/cGP8SPf7_o.png" width="1200"></p> 
<p style="margin-left:0cm;"><strong>三个部分组成：</strong></p> 
<p style="margin-left:0cm;"><strong>1) Input Setting: </strong></p> 
<p style="margin-left:0cm;">   <strong> Caffemodel: </strong> ./../data/detection/yolov3/model/yolov3.caffemodel   训练好的模型</p> 
<p style="margin-left:0cm;">    <strong>Marked_prototxt:  </strong>./../data/detection/yolov3/model/yolov3.prototxt   mapper验证过的模型，海思会验证网络层是否满足转化要求，定义了几个可转化的网络层，自定义的层需要自己转，这部分后面会专门写一章来说明。</p> 
<p style="margin-left:0cm;">   在上面按钮中点击“Mark”可以调出网络可视化窗口。</p> 
<p style="margin-left:0cm;">   <strong>Output_wk_name: </strong> ./../data/detection/yolov3/inst/****    输出 *.wk 文件的路径</p> 
<p style="margin-left:0cm;"><strong>2) mapper setting</strong></p> 
<p style="margin-left:0cm;">       mapper过程需要的配置参数： 这里列出来对应到说明文档中的页数，详细介绍可以查看说明材料。</p> 
<p style="margin-left:0cm;">       <strong>Compile_mode: </strong>p123  高精度、低带宽、自定义</p> 
<p style="margin-left:0cm;">       <strong>Log_level: </strong>p125</p> 
<p style="margin-left:0cm;">     <strong>  Align_bytes(align_size)</strong>:p143  </p> 
<p style="margin-left:0cm;">   <strong>    Batch_num:</strong>p123  </p> 
<p style="margin-left:0cm;">       <strong>Sparse_rate:</strong>p123  模型稀疏率</p> 
<p style="margin-left:0cm;"><strong>3)data</strong></p> 
<p style="margin-left:0cm;">      定义了模型量化过程中的参考图片等内容。其中一个比较重要的是输入图片格式和RGB颜色方式一定要选对，不然模型出来后板卡上跑不出来或识别效果特别差。</p> 
<p style="margin-left:0cm;">       <strong>Image_type:</strong> p122  输入图片类型</p> 
<p style="margin-left:0cm;">  <strong>    RGB_order：</strong>p125  RGB色彩方式</p> 
<p style="margin-left:0cm;">     <strong>  Image_list:</strong> p121   ../data/detection/yolov3/image_***_list.txt</p> 
<p style="margin-left:0cm;">  <strong>    Norm_type: </strong>p122</p> 
<p style="margin-left:0cm;"><strong>      Mean_file:</strong> p123</p> 
<p style="margin-left:0cm;"></p> 
<p style="margin-left:0cm;"><strong>配置好cfg后就可以点击 make WK按钮就可以生成 *.wk文件了。</strong></p> 
<p style="margin-left:0cm;">底部状态栏里会显示出模型生成成功的信息。</p> 
<p style="margin-left:0cm;">此篇讲到的模型mapper的过程，会增加一些细节性的说明和截图进行补充，再把关联的安装文件上传到云盘供下载。</p> 
<p style="margin-left:0cm;">下一篇会写如何在RS中进行模型功能仿真。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f1c08b8edc56b23126a17fbb7f6959b7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">海思SD3403,SS928/926,hi3519dv500,hi3516dv500移植yolov7,yolov8（3）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ccb0c678e0b5653033dcc1f9ba7577df/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Python处理excel和绘图</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>