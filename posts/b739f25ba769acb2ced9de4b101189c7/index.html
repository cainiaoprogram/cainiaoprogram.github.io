<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Autoware.universe部署01：Ubuntu20.04安装Autoware.universe并与Awsim联调 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Autoware.universe部署01：Ubuntu20.04安装Autoware.universe并与Awsim联调" />
<meta property="og:description" content="文章目录 引言一、安装依赖1.1 安装git1.2 克隆Autoware到本地1.3 自动安装相关依赖1.4 安装显卡驱动1.5 安装ROS2 Galactic1.6 安装ros2_dev_tools1.7 安装rmw_implementation1.8 安装pacmod1.9 安装autoware_core1.10 安装autoware universe dependencies1.11 安装pre_commit1.12 安装CUDA1.13 安装cuDNN and TensorRT 二、编译源码2.1 下载Universe代码库2.2 安装 Autoware ROS依赖包2.3 编译工作空间2.4 编译报错 三、 运行示例3.1 路径规划与车道跟随3.2 倒车入库3.3 添加行人与车辆3.4 交通灯识别仿真3.5 靠边停车3.5.1 平移停靠3.5.2 几何停靠3.5.3 后向停靠 3.6 路边起步3.6.1 平移起步3.6.2 几何起步与后向起步 3.7 变道3.8 禁停区 四、安装Awsim五、Autoware与Awsim联调 本文介绍Autoware.universe在Ubuntu20.04中的详细安装步骤，并测试一些Autoware.universe的基本功能，最后测试使用官方模拟器进行联调，本系列其他文章：
Autoware.universe部署02：高精Lanelet2地图的绘制
Autoware.universe部署03：与Carla（二进制版）联调
Autoware.universe部署04：universe传感器ROS2驱动
引言 本文介绍Autoware.universe在Ubuntu20.04中的详细安装步骤，基于ROS2 Galactic，其官方网站：Autoware Documentation
注意：左上角选择Galactic版本
最终运行效果：
一、安装依赖 在第3步自动安装依赖时，可以将ROS2 Galactic一并安装，也可以提前自己手动安装。
1.1 安装git sudo apt-get -y update sudo apt-get -y install git 1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/b739f25ba769acb2ced9de4b101189c7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-09T21:30:59+08:00" />
<meta property="article:modified_time" content="2023-09-09T21:30:59+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Autoware.universe部署01：Ubuntu20.04安装Autoware.universe并与Awsim联调</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_7" rel="nofollow">引言</a></li><li><a href="#_15" rel="nofollow">一、安装依赖</a></li><li><ul><li><a href="#11_git_17" rel="nofollow">1.1 安装git</a></li><li><a href="#12_Autoware_22" rel="nofollow">1.2 克隆Autoware到本地</a></li><li><a href="#13__29" rel="nofollow">1.3 自动安装相关依赖</a></li><li><a href="#14__40" rel="nofollow">1.4 安装显卡驱动</a></li><li><a href="#15_ROS2_Galactic_52" rel="nofollow">1.5 安装ROS2 Galactic</a></li><li><a href="#16_ros2_dev_tools_65" rel="nofollow">1.6 安装ros2_dev_tools</a></li><li><a href="#17_rmw_implementation_147" rel="nofollow">1.7 安装rmw_implementation</a></li><li><a href="#18_pacmod_177" rel="nofollow">1.8 安装pacmod</a></li><li><a href="#19_autoware_core_191" rel="nofollow">1.9 安装autoware_core</a></li><li><a href="#110_autoware_universe_dependencies_196" rel="nofollow">1.10 安装autoware universe dependencies</a></li><li><a href="#111_pre_commit_205" rel="nofollow">1.11 安装pre_commit</a></li><li><a href="#112_CUDA_216" rel="nofollow">1.12 安装CUDA</a></li><li><a href="#113_cuDNN_and_TensorRT_282" rel="nofollow">1.13 安装cuDNN and TensorRT</a></li></ul> 
  </li><li><a href="#_295" rel="nofollow">二、编译源码</a></li><li><ul><li><a href="#21_Universe_296" rel="nofollow">2.1 下载Universe代码库</a></li><li><a href="#22__Autoware_ROS_325" rel="nofollow">2.2 安装 Autoware ROS依赖包</a></li><li><a href="#23__368" rel="nofollow">2.3 编译工作空间</a></li><li><a href="#24__381" rel="nofollow">2.4 编译报错</a></li></ul> 
  </li><li><a href="#__453" rel="nofollow">三、 运行示例</a></li><li><ul><li><a href="#31__462" rel="nofollow">3.1 路径规划与车道跟随</a></li><li><a href="#32__473" rel="nofollow">3.2 倒车入库</a></li><li><a href="#33__482" rel="nofollow">3.3 添加行人与车辆</a></li><li><a href="#34__489" rel="nofollow">3.4 交通灯识别仿真</a></li><li><a href="#35__508" rel="nofollow">3.5 靠边停车</a></li><li><ul><li><a href="#351__509" rel="nofollow">3.5.1 平移停靠</a></li><li><a href="#352__514" rel="nofollow">3.5.2 几何停靠</a></li><li><a href="#353__521" rel="nofollow">3.5.3 后向停靠</a></li></ul> 
   </li><li><a href="#36__522" rel="nofollow">3.6 路边起步</a></li><li><ul><li><a href="#361__523" rel="nofollow">3.6.1 平移起步</a></li><li><a href="#362__527" rel="nofollow">3.6.2 几何起步与后向起步</a></li></ul> 
   </li><li><a href="#37__536" rel="nofollow">3.7 变道</a></li><li><a href="#38__539" rel="nofollow">3.8 禁停区</a></li></ul> 
  </li><li><a href="#Awsim_545" rel="nofollow">四、安装Awsim</a></li><li><a href="#AutowareAwsim_579" rel="nofollow">五、Autoware与Awsim联调</a></li></ul> 
</div> 
<p></p> 
<hr> 
<p>本文介绍Autoware.universe在Ubuntu20.04中的详细安装步骤，并测试一些Autoware.universe的基本功能，最后测试使用官方模拟器进行联调，本系列其他文章：<br> <strong><a href="https://blog.csdn.net/zardforever123/article/details/132528899?spm=1001.2014.3001.5502">Autoware.universe部署02：高精Lanelet2地图的绘制</a></strong><br> <strong><a href="https://blog.csdn.net/zardforever123/article/details/132357436?spm=1001.2014.3001.5501">Autoware.universe部署03：与Carla（二进制版）联调</a></strong><br> <strong><a href="https://blog.csdn.net/zardforever123/article/details/132529492?spm=1001.2014.3001.5501">Autoware.universe部署04：universe传感器ROS2驱动</a></strong></p> 
<h2><a id="_7"></a>引言</h2> 
<p>本文介绍Autoware.universe在Ubuntu20.04中的详细安装步骤，基于ROS2 Galactic，其官方网站：<a href="https://autowarefoundation.github.io/autoware-documentation/galactic/installation/autoware/source-installation/" rel="nofollow">Autoware Documentation</a><br> <img src="https://images2.imgbox.com/0f/4d/bGEYjoQk_o.png" alt="在这里插入图片描述"></p> 
<p><code>注意</code>：左上角选择<code>Galactic</code>版本<br> 最终运行效果：<br> <img src="https://images2.imgbox.com/b5/e6/65ZxbXbT_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_15"></a>一、安装依赖</h2> 
<p>在第3步自动安装依赖时，可以将ROS2 Galactic一并安装，也可以提前自己手动安装。</p> 
<h3><a id="11_git_17"></a>1.1 安装git</h3> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token parameter variable">-y</span> update
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token parameter variable">-y</span> <span class="token function">install</span> <span class="token function">git</span>
</code></pre> 
<h3><a id="12_Autoware_22"></a>1.2 克隆Autoware到本地</h3> 
<pre><code class="prism language-bash"><span class="token function">mkdir</span> autoware_universe
<span class="token builtin class-name">cd</span> autoware_universe/
<span class="token function">git</span> clone https://github.com/autowarefoundation/autoware.git <span class="token parameter variable">-b</span> galactic
</code></pre> 
<h3><a id="13__29"></a>1.3 自动安装相关依赖</h3> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> autoware
./setup-dev-env.sh
</code></pre> 
<p><img src="https://images2.imgbox.com/75/2e/q2yXH89c_o.png" alt="在这里插入图片描述"></p> 
<p>试了一下这个不太行，接下来再全部手动安装，按照官方给定的每一步骤链接进入获得安装命令（<code>注意</code>：进入之后要<code>选择Galactic版本</code>，如下图左上角，但是官方给的实际上有一点点问题，可以参考我下面的步骤）：<br> <img src="https://images2.imgbox.com/df/7e/4DcnyqB6_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/d7/7b/qizUMjmX_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="14__40"></a>1.4 安装显卡驱动</h3> 
<p>查看推荐显卡</p> 
<pre><code class="prism language-bash">ubuntu-drivers devices
</code></pre> 
<p><img src="https://images2.imgbox.com/63/d0/VjGzb8tF_o.png" alt="在这里插入图片描述"></p> 
<p>安装recommend推荐显卡版本，这里推荐的是535版本</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> nvidia-driver-535
</code></pre> 
<p>要选择版本不然会自动更新内核。 但是我安装535会黑屏，只能安装了510，由于是刚安装的系统，更新了内核也没太大的影响，另外安装版本太低的话也不行，因为下面安装CUDA要求最小版本</p> 
<h3><a id="15_ROS2_Galactic_52"></a>1.5 安装ROS2 Galactic</h3> 
<p>鱼香ros一键安装：</p> 
<pre><code class="prism language-bash"><span class="token function">wget</span> http://fishros.com/install <span class="token parameter variable">-O</span> fishros <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">.</span> fishros
</code></pre> 
<ul><li>选择[1]:一键安装:ROS(支持ROS和ROS2,树莓派Jetson)</li><li>选择[1]:更换系统源再继续安装，若是已经换过源可以选择[2]不更换源</li><li>选择[2]:更换系统源并清理第三方源</li><li>选择[3]:galactic(ROS2)</li><li>选择[1]:galactic(ROS2)桌面版<br> <img src="https://images2.imgbox.com/6e/eb/Ieu9gv9M_o.png" alt="在这里插入图片描述"></li></ul> 
<h3><a id="16_ros2_dev_tools_65"></a>1.6 安装ros2_dev_tools</h3> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> <span class="token punctuation">\</span>
  build-essential <span class="token punctuation">\</span>
  cmake <span class="token punctuation">\</span>
  <span class="token function">git</span> <span class="token punctuation">\</span>
  python3-colcon-common-extensions <span class="token punctuation">\</span>
  python3-flake8 <span class="token punctuation">\</span>
  python3-pip <span class="token punctuation">\</span>
  python3-pytest-cov <span class="token punctuation">\</span>
  python3-rosdep <span class="token punctuation">\</span>
  python3-setuptools <span class="token punctuation">\</span>
  python3-vcstool <span class="token punctuation">\</span>
  <span class="token function">wget</span>
</code></pre> 
<pre><code class="prism language-bash">python3 <span class="token parameter variable">-m</span> pip <span class="token function">install</span> <span class="token parameter variable">-U</span> <span class="token punctuation">\</span>
  flake8-blind-except <span class="token punctuation">\</span>
  flake8-builtins <span class="token punctuation">\</span>
  flake8-class-newline <span class="token punctuation">\</span>
  flake8-comprehensions <span class="token punctuation">\</span>
  flake8-deprecated <span class="token punctuation">\</span>
  flake8-docstrings <span class="token punctuation">\</span>
  flake8-import-order <span class="token punctuation">\</span>
  flake8-quotes <span class="token punctuation">\</span>
  pytest-repeat <span class="token punctuation">\</span>
  pytest-rerunfailures <span class="token punctuation">\</span>
  pytest <span class="token punctuation">\</span>
  setuptools
</code></pre> 
<p><img src="https://images2.imgbox.com/a3/a7/gAMgKL4j_o.png" alt="在这里插入图片描述"></p> 
<p>如果报以上的错误，就安装依赖：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> python3-testresources
</code></pre> 
<p>下面命令若是遇到问题可以参考文章：<a href="https://blog.csdn.net/zardforever123/article/details/130510145?spm=1001.2014.3001.5501">Ubuntu20.04同时安装ROS1和ROS2共存</a>，科学上网或者使用鱼香ROS rosdepc</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> rosdep init
rosdep update
</code></pre> 
<p>若报错：</p> 
<pre><code class="prism language-bash">ERROR: cannot download default sources list from:
https://raw.githubusercontent.com/ros/rosdistro/master/rosdep/sources.list.d/20-default.list
Website may be down.
</code></pre> 
<p>原因是GitHub的raw.githubusercontent.com无法连接，需要解决GitHub的raw.githubusercontent.com无法连接问题<br> 通过https://www.ipaddress.com/首页,输入raw.githubusercontent.com查询到真实IP地址，修改hosts Ubuntu:</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> gedit /etc/hosts
</code></pre> 
<p>添加查到的ip内容保存，再重启网络就好了即可</p> 
<pre><code class="prism language-bash"><span class="token number">185.199</span>.108.133 raw.githubusercontent.com
</code></pre> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> /etc/init.d/network-manager restart
</code></pre> 
<p>然后输入sudo rosdep init就可以了</p> 
<p><code>注</code>：后面我又发现一种更好的办法，参考：<a href="https://mirrors.tuna.tsinghua.edu.cn/help/rosdistro/" rel="nofollow">https://mirrors.tuna.tsinghua.edu.cn/help/rosdistro/</a></p> 
<pre><code class="prism language-bash"><span class="token comment"># 手动模拟 rosdep init</span>
<span class="token function">sudo</span> <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/ros/rosdep/sources.list.d/
<span class="token function">sudo</span> <span class="token function">curl</span> <span class="token parameter variable">-o</span> /etc/ros/rosdep/sources.list.d/20-default.list https://mirrors.tuna.tsinghua.edu.cn/github-raw/ros/rosdistro/master/rosdep/sources.list.d/20-default.list

<span class="token comment"># 为 rosdep update 换源</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ROSDISTRO_INDEX_URL</span><span class="token operator">=</span>https://mirrors.tuna.tsinghua.edu.cn/rosdistro/index-v4.yaml
<span class="token comment"># 后面的参数是为了不跳过ROS版本</span>
rosdep update --include-eol-distros

<span class="token comment"># 每次 rosdep update 之前，均需要增加该环境变量</span>
<span class="token comment"># 为了持久化该设定，可以将其写入 .bashrc 中，例如</span>
<span class="token builtin class-name">echo</span> <span class="token string">'export ROSDISTRO_INDEX_URL=https://mirrors.tuna.tsinghua.edu.cn/rosdistro/index-v4.yaml'</span> <span class="token operator">&gt;&gt;</span> ~/.bashrc
</code></pre> 
<h3><a id="17_rmw_implementation_147"></a>1.7 安装rmw_implementation</h3> 
<pre><code class="prism language-bash"><span class="token comment"># wget -O /tmp/amd64.env https://raw.githubusercontent.com/autowarefoundation/autoware/main/amd64.env &amp;&amp; source /tmp/amd64.env</span>
<span class="token comment"># 注意官网给的是mian，humble的，需要改成galactic</span>
<span class="token function">wget</span> <span class="token parameter variable">-O</span> /tmp/amd64.env https://raw.githubusercontent.com/autowarefoundation/autoware/galactic/amd64.env <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">source</span> /tmp/amd64.env
</code></pre> 
<p>如果第一句报以下问题：拒绝连接，有两种解决办法（<code>推荐第二种</code>）<br> （1）科学上网<br> （2）amd64.env是一些软件对应版本的环境变量，我们其实在1.2节已经下载了，source一下就好了</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> autoware_universe/
<span class="token builtin class-name">source</span> amd64.env
</code></pre> 
<p><img src="https://images2.imgbox.com/84/9c/lNLXFJ0d_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash"><span class="token comment"># For details: https://docs.ros.org/en/galactic/How-To-Guides/Working-with-multiple-RMW-implementations.html</span>
<span class="token function">sudo</span> <span class="token function">apt</span> update
<span class="token assign-left variable">rmw_implementation_dashed</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">eval</span> <span class="token function">sed</span> <span class="token parameter variable">-e</span> <span class="token string">"s/_/-/g"</span> <span class="token operator">&lt;&lt;&lt;</span> <span class="token string">"<span class="token variable">${rmw_implementation}</span>"</span><span class="token variable">)</span></span>
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> ros-<span class="token variable">${rosdistro}</span>-<span class="token variable">${rmw_implementation_dashed}</span>

<span class="token comment"># (Optional) You set the default RMW implementation in the ~/.bashrc file.</span>
<span class="token builtin class-name">echo</span> <span class="token string">''</span> <span class="token operator">&gt;&gt;</span> ~/.bashrc <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span> <span class="token string">"export RMW_IMPLEMENTATION=<span class="token variable">${rmw_implementation}</span>"</span> <span class="token operator">&gt;&gt;</span> ~/.bashrc
</code></pre> 
<p>下面这句报以下错误，将ROS版本变量改成galactic（报这个错是因为下载了main-对应humble的amd.env，上面改成galactic版本理论上就不会报这个错）<br> <img src="https://images2.imgbox.com/70/84/1VoFlmYs_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="18_pacmod_177"></a>1.8 安装pacmod</h3> 
<pre><code class="prism language-bash"><span class="token comment"># wget -O /tmp/amd64.env https://raw.githubusercontent.com/autowarefoundation/autoware/galactic/amd64.env &amp;&amp; source /tmp/amd64.env</span>
<span class="token builtin class-name">cd</span> autoware_universe/
<span class="token builtin class-name">source</span> amd64.env

<span class="token comment"># Taken from https://github.com/astuff/pacmod3#installation</span>
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> apt-transport-https
<span class="token function">sudo</span> <span class="token function">sh</span> <span class="token parameter variable">-c</span> <span class="token string">'echo "deb [trusted=yes] https://s3.amazonaws.com/autonomoustuff-repo/ $(lsb_release -sc) main" &gt; /etc/apt/sources.list.d/autonomoustuff-public.list'</span>
<span class="token function">sudo</span> <span class="token function">apt</span> update
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> ros-<span class="token variable">${rosdistro}</span>-pacmod3
</code></pre> 
<p>wget上面已经处理过一次了，这里可以只source（找不到就再复制一次）</p> 
<h3><a id="19_autoware_core_191"></a>1.9 安装autoware_core</h3> 
<pre><code class="prism language-bash">pip3 <span class="token function">install</span> gdown
</code></pre> 
<h3><a id="110_autoware_universe_dependencies_196"></a>1.10 安装autoware universe dependencies</h3> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> geographiclib-tools

<span class="token comment"># Add EGM2008 geoid grid to geographiclib</span>
<span class="token comment"># 下面过程很慢，耐心等待</span>
<span class="token function">sudo</span> geographiclib-get-geoids egm2008-1
</code></pre> 
<h3><a id="111_pre_commit_205"></a>1.11 安装pre_commit</h3> 
<pre><code class="prism language-bash"><span class="token assign-left variable">clang_format_version</span><span class="token operator">=</span><span class="token number">14.0</span>.6
pip3 <span class="token function">install</span> pre-commit clang-format<span class="token operator">==</span><span class="token variable">${clang_format_version}</span>

<span class="token comment"># Install Golang (Add Go PPA for shfmt)</span>
<span class="token function">sudo</span> add-apt-repository ppa:longsleep/golang-backports
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> golang
</code></pre> 
<h3><a id="112_CUDA_216"></a>1.12 安装CUDA</h3> 
<pre><code class="prism language-bash"><span class="token comment"># wget -O /tmp/amd64.env https://raw.githubusercontent.com/autowarefoundation/autoware/galactic/amd64.env &amp;&amp; source /tmp/amd64.env</span>
<span class="token builtin class-name">cd</span> autoware_universe/
<span class="token builtin class-name">source</span> amd64.env

<span class="token comment"># Modified from:</span>
<span class="token comment"># https://developer.nvidia.com/cuda-11-4-4-download-archive?target_os=Linux&amp;target_arch=x86_64&amp;Distribution=Ubuntu&amp;target_version=20.04&amp;target_type=deb_network</span>
<span class="token function">wget</span> https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2004/x86_64/cuda-ubuntu2004.pin
<span class="token function">sudo</span> <span class="token function">mv</span> cuda-ubuntu2004.pin /etc/apt/preferences.d/cuda-repository-pin-600
<span class="token function">sudo</span> apt-key adv --fetch-keys https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2004/x86_64/3bf863cc.pub
<span class="token function">sudo</span> add-apt-repository <span class="token string">"deb https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2004/x86_64/ /"</span>
<span class="token function">sudo</span> <span class="token function">apt-get</span> update
<span class="token assign-left variable">cuda_version_dashed</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">eval</span> <span class="token function">sed</span> <span class="token parameter variable">-e</span> <span class="token string">"s/[.]/-/g"</span> <span class="token operator">&lt;&lt;&lt;</span> <span class="token string">"<span class="token variable">${cuda_version}</span>"</span><span class="token variable">)</span></span>
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> cuda-<span class="token variable">${cuda_version_dashed}</span> --no-install-recommends
</code></pre> 
<p>一般来说以上过程会安装成功，但是安装最后一步的时候可能报下面的错，有以下两种解决办法（推荐第二种）：<br> <img src="https://images2.imgbox.com/f0/e9/1jTGRY4m_o.png" alt="在这里插入图片描述"></p> 
<p>（1）使用aptitude能调整依赖版本（慎用，<code>建议</code>用第二种方法）</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token function">aptitude</span>
<span class="token function">sudo</span> <span class="token function">aptitude</span> <span class="token function">install</span> cuda-<span class="token variable">${cuda_version_dashed}</span>
</code></pre> 
<p><code>--no-install-recommends</code> 参数是用于在安装软件包时禁止安装推荐的附加软件包，只安装 CUDA 11.6 的核心组件，可以帮助减少安装的软件包数量，节省磁盘空间并降低系统中的冗余，不需要可以取消。<br> 选择Y会重装显卡驱动（我的会重装535，但是会黑屏，因此没有用这个办法）<br> （2）使用手动安装方法：</p> 
<pre><code class="prism language-bash">nvidia-smi
</code></pre> 
<p>查看显卡驱动支持最高CUDA版本是12.1， 到<a href="https://developer.nvidia.com/cuda-toolkit-archive" rel="nofollow">cuda-toolkit-archive</a>，选择需要的CUDA（最好是env中写的11.6.2）版本下载，如下图，选择runfile(local)，并使用生成的指令进行下载和安装<br> <img src="https://images2.imgbox.com/9f/e6/Bs3nQi08_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/d8/57/6gBwiJI2_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/70/3f/suqmYRRg_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/bf/05/5k22mFqU_o.png" alt="在这里插入图片描述"></p> 
<p>回车取消安装显卡驱动，然后选择最后的安装：<br> <img src="https://images2.imgbox.com/ea/21/sE1c1AxO_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/61/8e/em4qxtji_o.png" alt="在这里插入图片描述"></p> 
<p>安装成功之后环境配置，在.bashrc文件末尾添加环境变量：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> gedit ~/.bashrc
<span class="token comment"># 添加以下内容：</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span>/usr/local/cuda-11.6/bin<span class="token variable">${<!-- --><span class="token environment constant">PATH</span><span class="token operator">:+</span><span class="token operator">:</span>${<!-- --><span class="token environment constant">PATH</span>}</span><span class="token punctuation">}</span> 
<span class="token builtin class-name">export</span> <span class="token assign-left variable">LD_LIBRARY_PATH</span><span class="token operator">=</span>/usr/local/cuda-11.6/lib64<span class="token variable">${LD_LIBRARY_PATH<span class="token operator">:+</span><span class="token operator">:</span>${LD_LIBRARY_PATH}</span><span class="token punctuation">}</span>
</code></pre> 
<p>或者终端输入以下命令添加：</p> 
<pre><code class="prism language-bash"><span class="token comment"># Taken from: https://docs.nvidia.com/cuda/cuda-installation-guide-linux/index.html#post-installation-actions</span>
<span class="token builtin class-name">echo</span> <span class="token string">'export PATH=/usr/local/cuda-11.6/bin${PATH:+:${PATH}}'</span> <span class="token operator">&gt;&gt;</span> ~/.bashrc
<span class="token builtin class-name">echo</span> <span class="token string">'export LD_LIBRARY_PATH=/usr/local/cuda-11.6/lib64${LD_LIBRARY_PATH:+:${LD_LIBRARY_PATH}}'</span> <span class="token operator">&gt;&gt;</span> ~/.bashrc
</code></pre> 
<p>验证是否安装成功</p> 
<pre><code class="prism language-bash">nvcc <span class="token parameter variable">-V</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/ae/70/6bjUpCzy_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="113_cuDNN_and_TensorRT_282"></a>1.13 安装cuDNN and TensorRT</h3> 
<pre><code class="prism language-bash"><span class="token comment"># wget -O /tmp/amd64.env https://raw.githubusercontent.com/autowarefoundation/autoware/galactic/amd64.env &amp;&amp; source /tmp/amd64.env</span>
<span class="token builtin class-name">cd</span> autoware_universe/
<span class="token builtin class-name">source</span> amd64.env

<span class="token comment"># Taken from: https://docs.nvidia.com/deeplearning/tensorrt/install-guide/index.html#installing</span>
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token assign-left variable">libcudnn8</span><span class="token operator">=</span><span class="token variable">${cudnn_version}</span> libcudnn8-dev<span class="token operator">=</span><span class="token variable">${cudnn_version}</span>
<span class="token function">sudo</span> apt-mark hold libcudnn8 libcudnn8-dev
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token assign-left variable">libnvinfer8</span><span class="token operator">=</span><span class="token variable">${tensorrt_version}</span> <span class="token assign-left variable">libnvonnxparsers8</span><span class="token operator">=</span><span class="token variable">${tensorrt_version}</span> <span class="token assign-left variable">libnvparsers8</span><span class="token operator">=</span><span class="token variable">${tensorrt_version}</span> libnvinfer-plugin8<span class="token operator">=</span><span class="token variable">${tensorrt_version}</span> libnvinfer-dev<span class="token operator">=</span><span class="token variable">${tensorrt_version}</span> libnvonnxparsers-dev<span class="token operator">=</span><span class="token variable">${tensorrt_version}</span> libnvparsers-dev<span class="token operator">=</span><span class="token variable">${tensorrt_version}</span> libnvinfer-plugin-dev<span class="token operator">=</span><span class="token variable">${tensorrt_version}</span>
<span class="token function">sudo</span> apt-mark hold libnvinfer8 libnvonnxparsers8 libnvparsers8 libnvinfer-plugin8 libnvinfer-dev libnvonnxparsers-dev libnvparsers-dev libnvinfer-plugin-dev
</code></pre> 
<h2><a id="_295"></a>二、编译源码</h2> 
<h3><a id="21_Universe_296"></a>2.1 下载Universe代码库</h3> 
<p>（1）创建 src 文件夹</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> autoware_universe/
<span class="token function">mkdir</span> src
</code></pre> 
<p>（2）修改 autoware.repos 文件</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> gedit autoware.repos
</code></pre> 
<p>在autoware.repos 文件中，28行位置加入以下内容</p> 
<pre><code class="prism language-bash">universe/external/open_planner:
    type: <span class="token function">git</span>
    url: https://github.com/ZATiTech/open_planner.git
    version: main
</code></pre> 
<p>（3）下载代码库到本地</p> 
<pre><code class="prism language-bash">vcs <span class="token function">import</span> src <span class="token operator">&lt;</span> autoware.repos
</code></pre> 
<p><img src="https://images2.imgbox.com/6d/69/BPyLeK1O_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="22__Autoware_ROS_325"></a>2.2 安装 Autoware ROS依赖包</h3> 
<p>（1）rosdep update</p> 
<pre><code class="prism language-bash">rosdep update
</code></pre> 
<p>如果遇到问题（一般都会遇到，<code>注意</code>如果成功但是跳过了galactic也是不行的，例如下图），解决办法参考1.6节最后的办法<br> <img src="https://images2.imgbox.com/77/a6/mcuyUHNU_o.png" alt="在这里插入图片描述"></p> 
<p>（2）安装ROS依赖</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">source</span> /opt/ros/galactic/setup.bash
rosdep <span class="token function">install</span> <span class="token parameter variable">-y</span> --from-paths src --ignore-src <span class="token parameter variable">--rosdistro</span> <span class="token variable">$ROS_DISTRO</span>
</code></pre> 
<p>安装ROS依赖时报错：</p> 
<pre><code class="prism language-bash">/usr/bin/pip3:6: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html
from pkg_resources <span class="token function">import</span> load_entry_point
</code></pre> 
<p><img src="https://images2.imgbox.com/e9/43/jgWGwqP3_o.png" alt="在这里插入图片描述"></p> 
<p>参考https://blog.csdn.net/yuteng12138/article/details/130123995：</p> 
<pre><code class="prism language-bash">pip <span class="token function">install</span> <span class="token parameter variable">--upgrade</span> <span class="token parameter variable">--user</span> <span class="token assign-left variable">setuptools</span><span class="token operator">==</span><span class="token number">58.3</span>.0
</code></pre> 
<p>安装时依赖版本太高：</p> 
<pre><code class="prism language-bash">ros-galactic-tvm-vendor <span class="token builtin class-name">:</span> Depends: ocl-icd-opencl-dev but it is not going to be installed
</code></pre> 
<p><img src="https://images2.imgbox.com/91/5f/adhBvdru_o.png" alt="在这里插入图片描述"><br> 使用aptitude可以对依赖降级，：保持原状N，接下来全输入y</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">aptitude</span> <span class="token function">install</span> ros-galactic-tvm-vendor
</code></pre> 
<p><img src="https://images2.imgbox.com/2e/5a/dxNHiIor_o.png" alt="在这里插入图片描述"></p> 
<p>安装ROS依赖时，安装open3d速度慢，报错问题可以参考：https://blog.csdn.net/yuteng12138/article/details/130123620</p> 
<pre><code class="prism language-bash">pip <span class="token function">install</span> open3d
</code></pre> 
<p><img src="https://images2.imgbox.com/84/cc/sYbAstpv_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="23__368"></a>2.3 编译工作空间</h3> 
<pre><code class="prism language-bash">colcon build --symlink-install --cmake-args <span class="token parameter variable">-DCMAKE_BUILD_TYPE</span><span class="token operator">=</span>Release
<span class="token comment"># 只编译指定包</span>
colcon build --symlink-install --cmake-args <span class="token parameter variable">-DCMAKE_BUILD_TYPE</span><span class="token operator">=</span>Release --packages-select 包名
<span class="token comment"># 忽略指定包</span>
colcon build --symlink-install --cmake-args <span class="token parameter variable">-DCMAKE_BUILD_TYPE</span><span class="token operator">=</span>Release --packages-ignore 包名
<span class="token comment"># 遇到编译错误继续编译其他模块</span>
colcon build --symlink-install --cmake-args <span class="token parameter variable">-DCMAKE_BUILD_TYPE</span><span class="token operator">=</span>Release --continue-on-error
</code></pre> 
<p>在编译过程中卡死或者崩溃，或者其他问题，可以多试几次或者参考官方：<a href="https://autowarefoundation.github.io/autoware-documentation/galactic/support/troubleshooting/#build-issues" rel="nofollow">build-issues</a>，下面是我遇到的编译报错以及解决办法</p> 
<h3><a id="24__381"></a>2.4 编译报错</h3> 
<p>（1）fmt报错：<code>undefined reference to fmt::v8::vformat[abi:cxx11](fmt::v8::basic_string_view&lt;char&gt;, fmt::v8::basic_format_args&lt;fmt::v8::basic_format_context&lt;fmt::v8::appender, char&gt; &gt;)'</code></p> 
<p><img src="https://images2.imgbox.com/6e/ab/yYwQWSF0_o.png" alt="在这里插入图片描述"></p> 
<p>说明缺少fmt库，去<a href="https://github.com/fmtlib/fmt/releases/tag/8.1.1">官网</a>tag/8.1.1下载源码<br> <img src="https://images2.imgbox.com/95/a0/YFkVPya3_o.png" alt="在这里插入图片描述"></p> 
<p>解压后使用cmake编译：</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> fmt-8.1.1
<span class="token function">mkdir</span> build <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> build
cmake <span class="token parameter variable">-DCMAKE_POSITION_INDEPENDENT_CODE</span><span class="token operator">=</span>TRUE <span class="token punctuation">..</span>
<span class="token function">make</span> <span class="token parameter variable">-j8</span>
<span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span>
</code></pre> 
<p>如果安装之后仍然报上面的错误，打开对应代码（最外层的头文件），添加头文件如下：</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">FMT_HEADER_ONLY</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fmt/format.h&gt;</span></span>
</code></pre> 
<p><img src="https://images2.imgbox.com/ad/e7/RJWEeRYy_o.png" alt="在这里插入图片描述"></p> 
<p>（2）遇到下面的错误 <code>error: implicitly-declared ‘constexpr Eigen::......</code><br> <img src="https://images2.imgbox.com/ba/d7/jORtm76s_o.png" alt="在这里插入图片描述"></p> 
<p>Eigen3的版本太低，重装3.4以上版本的Eigen。<br> （3）报Eigen错误：</p> 
<pre><code class="prism language-cpp"><span class="token operator">/</span>usr<span class="token operator">/</span>include<span class="token operator">/</span>eigen3<span class="token operator">/</span>Eigen<span class="token operator">/</span>src<span class="token operator">/</span>Core<span class="token operator">/</span>PlainObjectBase<span class="token punctuation">.</span>h<span class="token operator">:</span><span class="token number">504</span><span class="token operator">:</span><span class="token number">7</span><span class="token operator">:</span>  error<span class="token operator">:</span> ‘<span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token operator">&lt;</span>anonymous<span class="token operator">&gt;</span> <span class="token operator">+</span><span class="token number">48</span><span class="token punctuation">)</span>’ may be used uninitialized in <span class="token keyword">this</span> function <span class="token punctuation">[</span><span class="token operator">-</span>Werror<span class="token operator">=</span>maybe<span class="token operator">-</span>uninitialized<span class="token punctuation">]</span>
  <span class="token number">504</span> <span class="token operator">|</span>       m_storage <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>other<span class="token punctuation">.</span>m_storage<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这是gcc版本太高导致的编译错误，不能使用未初始化的变量，要想不降低gcc版本，可以修改eigen头文件</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> gedit /usr/include/eigen3/Eigen/src/Core/PlainObjectBase.h
</code></pre> 
<pre><code class="prism language-cpp"># <span class="token number">504</span>行：
<span class="token comment">// m_storage =  std::move(other.m_storage);</span>
DenseStorage<span class="token operator">&lt;</span>Scalar<span class="token punctuation">,</span> Base<span class="token double-colon punctuation">::</span>MaxSizeAtCompileTime<span class="token punctuation">,</span> Base<span class="token double-colon punctuation">::</span>RowsAtCompileTime<span class="token punctuation">,</span> Base<span class="token double-colon punctuation">::</span>ColsAtCompileTime<span class="token punctuation">,</span> Options<span class="token operator">&gt;</span> temp <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>other<span class="token punctuation">.</span>m_storage<span class="token punctuation">)</span><span class="token punctuation">;</span>
m_storage <span class="token operator">=</span> temp<span class="token punctuation">;</span>
# <span class="token number">511</span>行：
<span class="token comment">//EIGEN_STRONG_INLINE PlainObjectBase(const PlainObjectBase&amp; other): Base(), m_storage(other.m_storage) { }</span>
EIGEN_STRONG_INLINE <span class="token function">PlainObjectBase</span><span class="token punctuation">(</span><span class="token keyword">const</span> PlainObjectBase<span class="token operator">&amp;</span> other<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">Base</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    DenseStorage<span class="token operator">&lt;</span>Scalar<span class="token punctuation">,</span> Base<span class="token double-colon punctuation">::</span>MaxSizeAtCompileTime<span class="token punctuation">,</span> Base<span class="token double-colon punctuation">::</span>RowsAtCompileTime<span class="token punctuation">,</span> Base<span class="token double-colon punctuation">::</span>ColsAtCompileTime<span class="token punctuation">,</span> Options<span class="token operator">&gt;</span> temp <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>other<span class="token punctuation">.</span>m_storage<span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_storage <span class="token operator">=</span> temp<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/9c/05/u1krI4PR_o.png" alt="在这里插入图片描述"></p> 
<p>（4）找不到头文件</p> 
<pre><code class="prism language-cpp">src<span class="token operator">/</span>universe<span class="token operator">/</span>autoware<span class="token punctuation">.</span>universe<span class="token operator">/</span>planning<span class="token operator">/</span>static_centerline_optimizer<span class="token operator">/</span>src<span class="token operator">/</span>utils<span class="token punctuation">.</span>cpp<span class="token operator">:</span><span class="token number">17</span><span class="token operator">:</span><span class="token number">10</span><span class="token operator">:</span> fatal error<span class="token operator">:</span> behavior_path_planner<span class="token operator">/</span>data_manager<span class="token punctuation">.</span>hpp<span class="token operator">:</span> No such file <span class="token operator">or</span> directory
<span class="token number">17</span> <span class="token operator">|</span> #include <span class="token string">"behavior_path_planner/data_manager.hpp"</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/8e/86/fnRFNamA_o.png" alt="在这里插入图片描述"></p> 
<p>在static_centerline_optimizer包的cmakelists中添加头文件引用</p> 
<pre><code class="prism language-cpp"><span class="token function">include_directories</span><span class="token punctuation">(</span>
    SYSTEM
    $<span class="token punctuation">{<!-- --></span>EIGEN3_INCLUDE_DIR<span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/9d/19/nFqC8RfG_o.png" alt="在这里插入图片描述"><br> <code>编译完成！</code></p> 
<h2><a id="__453"></a>三、 运行示例</h2> 
<p>简单运行Universe，<code>$HOME/autoware_map/sample-map-planning</code>为从<a href="https://docs.google.com/uc?export=download&amp;id=1499_nsbUbIeturZaDj7jhUownh5fvXHd" rel="nofollow">官方下载的地图</a>：，修改为你自己的路径</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">source</span> install/setup.bash
ros2 launch autoware_launch planning_simulator.launch.xml map_path:<span class="token operator">=</span><span class="token environment constant">$HOME</span>/autoware_map/sample-map-planning vehicle_model:<span class="token operator">=</span>sample_vehicle sensor_model:<span class="token operator">=</span>sample_sensor_kit
</code></pre> 
<p>打开官方的一个仿真示例，这个仿真不需要开模拟器，初始位姿随便给，方便体验各种功能<br> <img src="https://images2.imgbox.com/5c/7f/IjXew5Xv_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="31__462"></a>3.1 路径规划与车道跟随</h3> 
<p>首先通过<code>2D Pose Estimate</code>给定初始位姿，小车模型会出现：<br> <img src="https://images2.imgbox.com/e6/78/m2XaDn2p_o.png" alt="在这里插入图片描述"><br> 再通过<code>2D Goal Pose</code>给定目标位姿生成路径<br> <img src="https://images2.imgbox.com/e7/11/6zhNLNdo_o.png" alt="在这里插入图片描述"><br> 新启动一个终端，发布以下消息（或者直接点击RVIZ中的<code>Engage</code>），开启自动驾驶:</p> 
<pre><code class="prism language-bash">ros2 topic pub /autoware/engage autoware_auto_vehicle_msgs/msg/Engage <span class="token string">'{engage: True}'</span> <span class="token parameter variable">-1</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/b0/21/mbqpVUfV_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="32__473"></a>3.2 倒车入库</h3> 
<p>首先通过自主导航或重开给定初始位姿行驶到停车场：<br> <img src="https://images2.imgbox.com/c0/7b/tKlOXDYY_o.png" alt="在这里插入图片描述"><br> 然后给定目标停车位姿（大概是base_link位置），点击RVIZ中的<code>Engage</code>即可自动倒车入库：<br> <img src="https://images2.imgbox.com/bb/88/058qyBss_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/f1/b7/QzwvVIP8_o.png" alt="在这里插入图片描述"><br> 有障碍物时的倒车入库：<br> <img src="https://images2.imgbox.com/da/24/cYlFJ7cT_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/63/b4/wLCY9Uln_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="33__482"></a>3.3 添加行人与车辆</h3> 
<p>点击工具栏中的<code>2D Dummy Car</code>或<code>2D Dummy Pedestrian</code>按钮。通过在地图上点击和拖动设置虚拟物体的位姿。在工具属性中设置物体的速度- &gt; 2D假车/行人面板。<br> <img src="https://images2.imgbox.com/28/d9/AnICTovf_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/2b/47/fPO3VzQ9_o.png" alt="在这里插入图片描述"></p> 
<p>可以在车辆行驶过程中添加横穿车辆来测试车辆的避障能力<br> <img src="https://images2.imgbox.com/37/6c/brzDmqfy_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="34__489"></a>3.4 交通灯识别仿真</h3> 
<p>默认情况下，地图上的交通信号灯都被视为设置为绿色。因此，当创建一条通过交通灯的交叉路口的路径时，自我车辆将在不停车的情况下通过交叉路口。<br> 下面的步骤说明如何设置和重置交通信号灯，以测试Planning将如何响应。首先要显示出交通灯ID，在话题的Map-&gt; Lanelet2VectorMap-&gt;Namespaces中点选交通灯ID（还可以选择行驶线等其他可视化组件），然后重新选择Map即可显示：<br> <img src="https://images2.imgbox.com/df/37/gkTHQzZY_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/e2/ad/m2AJNKQe_o.png" alt="在这里插入图片描述"></p> 
<p>（1）设置交通灯：转到Panels - &gt;添加新的Panel，选择TrafficLightPublishPanel，然后按OK键；<br> <img src="https://images2.imgbox.com/d4/97/hcE4lhNB_o.png" alt="在这里插入图片描述"></p> 
<p>（2）在TrafficLightPublishPanel中，设置交通灯的ID和颜色；<br> （3）单击Set按钮，Set-Traffic-Light；<br> <img src="https://images2.imgbox.com/59/0e/cJzhPvwA_o.png" alt="在这里插入图片描述"></p> 
<p>（4）最后，点击PUBLISH按钮，将交通灯状态发送到模拟器。任何经过所选交通灯的规划路径都会随之改变。<br> <img src="https://images2.imgbox.com/cc/1d/XH62lgF3_o.png" alt="在这里插入图片描述"><br> 可以手动设置交通灯颜色模拟交通灯变化，以观察汽车在经过路口时根据红绿灯的行驶情况，可以看到改成绿灯之后可以正常通行：<br> <img src="https://images2.imgbox.com/1d/5a/y2wpKlwG_o.png" alt="请添加图片描述"></p> 
<h3><a id="35__508"></a>3.5 靠边停车</h3> 
<h4><a id="351__509"></a>3.5.1 平移停靠</h4> 
<p>在有路边停靠车道的位置设置目标，当有足够的距离进行平缓地变道停车时，即可平移停靠<br> （路径平缓，不会停车转向）：<br> <img src="https://images2.imgbox.com/19/18/rNF4Dq3V_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/89/d2/adh14kjW_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="352__514"></a>3.5.2 几何停靠</h4> 
<p>当停靠的距离不够时，会进行几何停靠（中间两次停车进行转向）：<br> <img src="https://images2.imgbox.com/ab/59/AZHXeevs_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/6f/33/FSVOeNHe_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/5b/40/qAJCoAPo_o.png" alt="在这里插入图片描述"><br> 或者被挡住：<br> <img src="https://images2.imgbox.com/87/ad/JSINQbJx_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="353__521"></a>3.5.3 后向停靠</h4> 
<h3><a id="36__522"></a>3.6 路边起步</h3> 
<h4><a id="361__523"></a>3.6.1 平移起步</h4> 
<p>当车辆在路边停靠车道要驶入行驶车道，且前后均没有障碍物（或者足够远）时，即可启用平移起步：<br> <img src="https://images2.imgbox.com/e9/0c/VbGTaAkx_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="362__527"></a>3.6.2 几何起步与后向起步</h4> 
<p>当车前方停有障碍物，后方没有障碍物时，起步会先后退，拉到足够距离再进行几何起步（与平移起步的区别是中间会停下来转向，因为前方障碍物过近），大致过程如下：<br> <img src="https://images2.imgbox.com/11/7c/IexDms3q_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/f5/c5/O8IAUgp1_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/ff/7e/dP6yLOSX_o.png" alt="在这里插入图片描述"><br> 或者是后面障碍物有一定空间，也会先退一段，然后起步：<br> <img src="https://images2.imgbox.com/6d/73/5EG46Dhj_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/31/be/NPrxRTUR_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="37__536"></a>3.7 变道</h3> 
<p>变道需要有可变道车道，即同向相邻车道（可变道），如下图所示，我在原有地图上简单画了一条（绘制方法参考：<strong><a href="https://blog.csdn.net/zardforever123/article/details/132528899?spm=1001.2014.3001.5502">Autoware.universe部署02：高精Lanelet2地图的绘制</a></strong>），并设置了可变道，然后规划路径时即可变道：<br> <img src="https://images2.imgbox.com/e0/51/9t1leqWe_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="38__539"></a>3.8 禁停区</h3> 
<p>在某些车道路段，是不允许停车的，比如建筑门口。如下图如果将规划目标设置在禁停区，那么车辆将在行驶到禁停区域之前停止：<br> <img src="https://images2.imgbox.com/f7/ad/4cGXwcLd_o.png" alt="在这里插入图片描述"><br> 但是规划的路径是可以穿过禁停区域的，只是不允许在此路段停车<br> <img src="https://images2.imgbox.com/cf/7c/gPHJiJqb_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="Awsim_545"></a>四、安装Awsim</h2> 
<p>参考官方教程<a href="https://github.com/tier4/AWSIM/blob/v1.0.1/docs/GettingStarted/QuickStartDemo/index.md">AWSIM v1.0.1</a>，在.bashrc中添加以下内容：</p> 
<pre><code class="prism language-bash">Add the following to .bashrc

<span class="token builtin class-name">export</span> <span class="token assign-left variable">ROS_LOCALHOST_ONLY</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">RMW_IMPLEMENTATION</span><span class="token operator">=</span>rmw_cyclonedds_cpp  <span class="token comment"># 上面环境配置时已经添加</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-e</span> /tmp/cycloneDDS_configured <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
	<span class="token function">sudo</span> <span class="token function">sysctl</span> <span class="token parameter variable">-w</span> <span class="token assign-left variable">net.core.rmem_max</span><span class="token operator">=</span><span class="token number">2147483647</span>
	<span class="token function">sudo</span> <span class="token function">ip</span> <span class="token function">link</span> <span class="token builtin class-name">set</span> lo multicast on
	<span class="token function">touch</span> /tmp/cycloneDDS_configured
<span class="token keyword">fi</span>
</code></pre> 
<p>安装依赖：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> update
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> libvulkan1
</code></pre> 
<p>下载Awsim二进制文件：<a href="https://github.com/tier4/AWSIM/releases/download/v1.0.1/AWSIM_v1.0.1.zip">AWSIM_v1.0.1.zip</a>，解压之后运行：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">chmod</span> +x ./<span class="token operator">&lt;</span>path to AWSIM folder<span class="token operator">&gt;</span>/AWSIM.x86_64
./<span class="token operator">&lt;</span>path to AWSIM folder<span class="token operator">&gt;</span>/AWSIM.x86_64
</code></pre> 
<p><img src="https://images2.imgbox.com/0a/d3/yn4tnPLo_o.png" alt="在这里插入图片描述"><br> 目前官方的模拟器功能还比较少，只有下方进度条可以调节渲染频率<br> 开启后可以看到模拟器输出的传感器消息以及接收的底盘控制消息：</p> 
<pre><code class="prism language-bash">ros2 topic list
</code></pre> 
<p><img src="https://images2.imgbox.com/f6/17/nS6wk7Ui_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="AutowareAwsim_579"></a>五、Autoware与Awsim联调</h2> 
<p>首先下载模拟器地图：<a href="https://github.com/tier4/AWSIM/releases/download/v1.0.0/nishishinjuku_autoware_map.zip">nishishinjuku_autoware_map.zip</a>，包括高精地图以及点云地图。<br> 同时启动Awsim和Autoware，注意更换为你下载的地图地址</p> 
<pre><code class="prism language-bash">./<span class="token operator">&lt;</span>path to AWSIM folder<span class="token operator">&gt;</span>/AWSIM.x86_64

<span class="token comment"># 新开一个终端</span>
<span class="token builtin class-name">cd</span> autoware_universe
<span class="token builtin class-name">source</span> install/setup.bash
ros2 launch autoware_launch e2e_simulator.launch.xml vehicle_model:<span class="token operator">=</span>sample_vehicle sensor_model:<span class="token operator">=</span>awsim_sensor_kit map_path:<span class="token operator">=</span><span class="token operator">&lt;</span>your <span class="token builtin class-name">mapfile</span> location<span class="token operator">&gt;</span>
</code></pre> 
<p>利用RViz手动设置<code>2D Pose Estimate</code>，使用RViz手动设置<code>2D Goal Pose</code>，设置<code>2d Checkpoint Pose</code>(可选)，路径生成。<br> <img src="https://images2.imgbox.com/0c/b8/ze2PKZYM_o.png" alt="在这里插入图片描述"></p> 
<p>新启动一个终端，发布以下消息（或者点击RVIZ中的<code>Engage</code>），开启自动驾驶:</p> 
<pre><code class="prism language-bash">ros2 topic pub /autoware/engage autoware_auto_vehicle_msgs/msg/Engage <span class="token string">'{engage: True}'</span> <span class="token parameter variable">-1</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/ac/1c/szaWnw3y_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/ec/5b/vJAua3Oe_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d39c2a0cc25c7b2f1c1dcf705840d5b5/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【车载以太网测试从入门到精通】——物理层测试</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/27b1fbabeb1fb2d9577b639eaef2bc04/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">解决MySQL使用Group By报错的问题(报错信息：1055 - Expression #1 of SELECT list is not in GROUP BY clause and conta)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>