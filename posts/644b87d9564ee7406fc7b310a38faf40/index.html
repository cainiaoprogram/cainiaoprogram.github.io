<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>[车联网安全自学篇] Android安全之和平精英辅助APK逆向分析 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="[车联网安全自学篇] Android安全之和平精英辅助APK逆向分析" />
<meta property="og:description" content="欢迎新同学的光临
… …
人若无名，便可专心练剑
我不是一条咸鱼，而是一条死鱼啊！
0x01 前言 从小道师傅那边看到一篇文章，看着操作入手要求不是很高，刚好最近在学习逆向分析，就去网上找了一下资源（此篇不提供样本APK）
0x02 工具准备 2.1 抓包工具 工具名称使用平台优点缺点wiresharklinux、windowslinux平台支持好，功能强大不能解析https的内容fidderwindows功能强大，支持修改报文仅支持windowsCharleswindow、Mac可以按照域名进行分层级查看需要收费Burp Suite支持java的平台黑客喜欢用的功能强大工具界面不是很好看 2.2 模拟器 夜神模拟器 https://www.yeshen.com
PS：只支持Windows系统、Mac系统(M1暂不支持)
网易MUMU模拟器 https://mumu.163.com
PS：只支持Windows系统、Mac系统(M1暂不支持)
雷电模拟器 https://www.ldmnq.com
PS：只支持Windows系统
逍遥模拟器 https://www.xyaz.cn
PS：只支持Windows系统
https://mp.weixin.qq.com/s/eDexuhi3B2vs3gEPPJBJzA
0x03 加固特征库 360 assets/.appkey assets/libjiagu.so assets/libjiagu_art.so assets/libjiagu_x86.so assets/libprotectClass.so 爱加密 lib/armeabi/libexecmain.so assets/ijiami.ajm ijiami.dat assets/af.bin assets/signed.bin assets/ijm_lib/armeabi/libexec.so assets/ijm_lib/X86/libexec.so 几维安全 assets/dex.dat lib/armeabi/kdpdata.so lib/armeabi/libkdp.so lib/armeabi/libkwscmm.so libkwscr.so libkwslinker.so 梆梆安全 免费版
assets/secData0.jar lib/armeabi/libSecShell.so lib/armeabi/libSecShell-x86.so libsecexe.so libsecmain.so libDexHelper.so 定制版
assets/classes.jar lib/armeabi/DexHelper.so libDexHelper-x86.so DexHelper.so 腾讯加固 tencent_stub lib/armeabi/libshella-xxxx.so lib/armeabi/libshellx-xxxx.so lib/armeabi/mix." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/644b87d9564ee7406fc7b310a38faf40/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-08-30T16:32:03+08:00" />
<meta property="article:modified_time" content="2022-08-30T16:32:03+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">[车联网安全自学篇] Android安全之和平精英辅助APK逆向分析</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <hr> 
<p><strong>欢迎新同学的光临</strong><br> … …<br> <strong>人若无名，便可专心练剑</strong></p> 
<hr> 
<p><strong>我不是一条咸鱼，而是一条死鱼啊！</strong></p> 
<hr> 
<h2><a id="0x01__13"></a>0x01 前言</h2> 
<p>从小道师傅那边看到一篇文章，看着操作入手要求不是很高，刚好最近在学习逆向分析，就去网上找了一下资源（此篇不提供样本APK）</p> 
<p><img src="https://images2.imgbox.com/b1/c9/BrrJ7gT5_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="0x02__21"></a>0x02 工具准备</h2> 
<h3><a id="21__23"></a>2.1 抓包工具</h3> 
<table><thead><tr><th>工具名称</th><th>使用平台</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>wireshark</td><td>linux、windows</td><td>linux平台支持好，功能强大</td><td>不能解析https的内容</td></tr><tr><td>fidder</td><td>windows</td><td>功能强大，支持修改报文</td><td>仅支持windows</td></tr><tr><td>Charles</td><td>window、Mac</td><td>可以按照域名进行分层级查看</td><td>需要收费</td></tr><tr><td>Burp Suite</td><td>支持java的平台</td><td>黑客喜欢用的功能强大工具</td><td>界面不是很好看</td></tr></tbody></table> 
<h3><a id="22__32"></a>2.2 模拟器</h3> 
<ul><li>夜神模拟器</li></ul> 
<p>https://www.yeshen.com</p> 
<p><strong>PS</strong>：只支持Windows系统、Mac系统(M1暂不支持)</p> 
<ul><li>网易MUMU模拟器</li></ul> 
<p>https://mumu.163.com</p> 
<p><strong>PS</strong>：只支持Windows系统、Mac系统(M1暂不支持)</p> 
<ul><li>雷电模拟器</li></ul> 
<p>https://www.ldmnq.com</p> 
<p><strong>PS</strong>：只支持Windows系统</p> 
<ul><li>逍遥模拟器</li></ul> 
<p>https://www.xyaz.cn</p> 
<p><strong>PS</strong>：只支持Windows系统</p> 
<p>https://mp.weixin.qq.com/s/eDexuhi3B2vs3gEPPJBJzA</p> 
<h2><a id="0x03__61"></a>0x03 加固特征库</h2> 
<ul><li>360</li></ul> 
<pre><code class="prism language-c">assets<span class="token operator">/</span><span class="token punctuation">.</span>appkey
assets<span class="token operator">/</span>libjiagu<span class="token punctuation">.</span>so
assets<span class="token operator">/</span>libjiagu_art<span class="token punctuation">.</span>so
assets<span class="token operator">/</span>libjiagu_x86<span class="token punctuation">.</span>so
assets<span class="token operator">/</span>libprotectClass<span class="token punctuation">.</span>so
</code></pre> 
<ul><li>爱加密</li></ul> 
<pre><code class="prism language-c">lib<span class="token operator">/</span>armeabi<span class="token operator">/</span>libexecmain<span class="token punctuation">.</span>so
assets<span class="token operator">/</span>ijiami<span class="token punctuation">.</span>ajm
ijiami<span class="token punctuation">.</span>dat
assets<span class="token operator">/</span>af<span class="token punctuation">.</span>bin
assets<span class="token operator">/</span><span class="token keyword">signed</span><span class="token punctuation">.</span>bin
assets<span class="token operator">/</span>ijm_lib<span class="token operator">/</span>armeabi<span class="token operator">/</span>libexec<span class="token punctuation">.</span>so
assets<span class="token operator">/</span>ijm_lib<span class="token operator">/</span>X86<span class="token operator">/</span>libexec<span class="token punctuation">.</span>so
</code></pre> 
<ul><li>几维安全</li></ul> 
<pre><code class="prism language-c">assets<span class="token operator">/</span>dex<span class="token punctuation">.</span>dat
lib<span class="token operator">/</span>armeabi<span class="token operator">/</span>kdpdata<span class="token punctuation">.</span>so
lib<span class="token operator">/</span>armeabi<span class="token operator">/</span>libkdp<span class="token punctuation">.</span>so
lib<span class="token operator">/</span>armeabi<span class="token operator">/</span>libkwscmm<span class="token punctuation">.</span>so
libkwscr<span class="token punctuation">.</span>so
libkwslinker<span class="token punctuation">.</span>so
</code></pre> 
<ul><li>梆梆安全</li></ul> 
<p>免费版</p> 
<pre><code class="prism language-c">assets<span class="token operator">/</span>secData0<span class="token punctuation">.</span>jar
lib<span class="token operator">/</span>armeabi<span class="token operator">/</span>libSecShell<span class="token punctuation">.</span>so
lib<span class="token operator">/</span>armeabi<span class="token operator">/</span>libSecShell<span class="token operator">-</span>x86<span class="token punctuation">.</span>so
libsecexe<span class="token punctuation">.</span>so
libsecmain<span class="token punctuation">.</span>so
libDexHelper<span class="token punctuation">.</span>so
</code></pre> 
<p>定制版</p> 
<pre><code class="prism language-c">assets<span class="token operator">/</span>classes<span class="token punctuation">.</span>jar
lib<span class="token operator">/</span>armeabi<span class="token operator">/</span>DexHelper<span class="token punctuation">.</span>so
libDexHelper<span class="token operator">-</span>x86<span class="token punctuation">.</span>so
DexHelper<span class="token punctuation">.</span>so
</code></pre> 
<ul><li>腾讯加固</li></ul> 
<pre><code class="prism language-c">tencent_stub
lib<span class="token operator">/</span>armeabi<span class="token operator">/</span>libshella<span class="token operator">-</span>xxxx<span class="token punctuation">.</span>so
lib<span class="token operator">/</span>armeabi<span class="token operator">/</span>libshellx<span class="token operator">-</span>xxxx<span class="token punctuation">.</span>so
lib<span class="token operator">/</span>armeabi<span class="token operator">/</span>mix<span class="token punctuation">.</span>dex
lib<span class="token operator">/</span>armeabi<span class="token operator">/</span>mixz<span class="token punctuation">.</span>dex
libtup<span class="token punctuation">.</span>so
libexec<span class="token punctuation">.</span>so
libshell<span class="token punctuation">.</span>so
</code></pre> 
<ul><li>腾讯御安全</li></ul> 
<pre><code class="prism language-c">assets<span class="token operator">/</span>libtosprotection<span class="token punctuation">.</span>armeabi<span class="token operator">-</span>v7a<span class="token punctuation">.</span>so
assets<span class="token operator">/</span>libtosprotection<span class="token punctuation">.</span>armeabi<span class="token punctuation">.</span>so
assets<span class="token operator">/</span>libtosprotection<span class="token punctuation">.</span>x86<span class="token punctuation">.</span>so
assets<span class="token operator">/</span>tosversion
lib<span class="token operator">/</span>armeabi<span class="token operator">/</span>libtest<span class="token punctuation">.</span>so
lib<span class="token operator">/</span>armeabi<span class="token operator">/</span>libTmsdk<span class="token operator">-</span>xxx<span class="token operator">-</span>mfr<span class="token punctuation">.</span>so
</code></pre> 
<ul><li>顶象技术</li></ul> 
<pre><code class="prism language-c">lib<span class="token operator">/</span>armeabi<span class="token operator">/</span>libx3g<span class="token punctuation">.</span>so
</code></pre> 
<ul><li>阿里加固</li></ul> 
<pre><code class="prism language-c">aliprotect<span class="token punctuation">.</span>dat
assets<span class="token operator">/</span>armeabi<span class="token operator">/</span>libfakejni<span class="token punctuation">.</span>so
assets<span class="token operator">/</span>armeabi<span class="token operator">/</span>libzuma<span class="token punctuation">.</span>so
assets<span class="token operator">/</span>libzuma<span class="token punctuation">.</span>so
assets<span class="token operator">/</span>libzumadata<span class="token punctuation">.</span>so
assets<span class="token operator">/</span>libpreverify1<span class="token punctuation">.</span>so
libsgmain<span class="token punctuation">.</span>so
libsgsecuritybody<span class="token punctuation">.</span>so
libmobisec<span class="token punctuation">.</span>so
</code></pre> 
<ul><li>Dexprotect加固</li></ul> 
<pre><code class="prism language-c">assets<span class="token operator">/</span>classes<span class="token punctuation">.</span>dex<span class="token punctuation">.</span>dat
assets<span class="token operator">/</span>dp<span class="token punctuation">.</span>arm<span class="token operator">-</span>v7<span class="token punctuation">.</span>so<span class="token punctuation">.</span>dat
assets<span class="token operator">/</span>dp<span class="token punctuation">.</span>arm<span class="token punctuation">.</span>so<span class="token punctuation">.</span>dat
</code></pre> 
<ul><li>通付盾加固</li></ul> 
<pre><code class="prism language-c">libegis<span class="token punctuation">.</span>so
libNSaferOnly<span class="token punctuation">.</span>so
</code></pre> 
<ul><li>APKProtect加固</li></ul> 
<pre><code class="prism language-c">libAPKProtect<span class="token punctuation">.</span>so
</code></pre> 
<ul><li>百度加固</li></ul> 
<pre><code class="prism language-c">lib<span class="token operator">/</span>armeabi<span class="token operator">/</span>libbaiduprotect<span class="token punctuation">.</span>so
assets<span class="token operator">/</span>baiduprotect1<span class="token punctuation">.</span>jar
或者
assets<span class="token operator">/</span>baiduprotect<span class="token punctuation">.</span>jar
</code></pre> 
<ul><li>海云安加固</li></ul> 
<pre><code class="prism language-c">assets<span class="token operator">/</span>itse
lib<span class="token operator">/</span>armeabi<span class="token operator">/</span>libitsec<span class="token punctuation">.</span>so
</code></pre> 
<ul><li>apktoolplus</li></ul> 
<pre><code class="prism language-c">assets<span class="token operator">/</span>jiagu_data<span class="token punctuation">.</span>bin
assets<span class="token operator">/</span>sign<span class="token punctuation">.</span>bin
lib<span class="token operator">/</span>armeabi<span class="token operator">/</span>libapktoolplus_jiagu<span class="token punctuation">.</span>so
</code></pre> 
<ul><li>娜迦</li></ul> 
<pre><code class="prism language-c">libedog<span class="token punctuation">.</span>so<span class="token operator">/</span>libddog<span class="token punctuation">.</span>so
libfdog<span class="token punctuation">.</span>so
libedog<span class="token punctuation">.</span>so
libchaosvmp<span class="token punctuation">.</span>so
</code></pre> 
<ul><li>通付盾加固</li></ul> 
<pre><code class="prism language-c">libegis<span class="token punctuation">.</span>so
libNSaferOnly<span class="token punctuation">.</span>so
</code></pre> 
<ul><li>盛大加固</li></ul> 
<pre><code class="prism language-c">libapssec<span class="token punctuation">.</span>so
</code></pre> 
<ul><li>瑞星加固</li></ul> 
<pre><code class="prism language-c">librsprotect<span class="token punctuation">.</span>so
</code></pre> 
<ul><li>网秦加固</li></ul> 
<pre><code class="prism language-c">libnqshield<span class="token punctuation">.</span>so
</code></pre> 
<ul><li>网易易盾</li></ul> 
<pre><code class="prism language-c">libnesec<span class="token punctuation">.</span>so
</code></pre> 
<ul><li>uu安全</li></ul> 
<pre><code class="prism language-c">assets<span class="token operator">/</span>libuusafe<span class="token punctuation">.</span>jar<span class="token punctuation">.</span>so
assets<span class="token operator">/</span>libuusafe<span class="token punctuation">.</span>so
lib<span class="token operator">/</span>armeabi<span class="token operator">/</span>libuusafeempty<span class="token punctuation">.</span>so
</code></pre> 
<ul><li>中国移动加固</li></ul> 
<pre><code class="prism language-c">assets<span class="token operator">/</span>mogosec_classes
assets<span class="token operator">/</span>mogosec_data
assets<span class="token operator">/</span>mogosec_dexinfo
assets<span class="token operator">/</span>mogosec_march
lib<span class="token operator">/</span>armeabi<span class="token operator">/</span>libcmvmp<span class="token punctuation">.</span>so
lib<span class="token operator">/</span>armeabi<span class="token operator">/</span>libmogosec_dex<span class="token punctuation">.</span>so
lib<span class="token operator">/</span>armeabi<span class="token operator">/</span>libmogosec_sodecrypt<span class="token punctuation">.</span>so
lib<span class="token operator">/</span>armeabi<span class="token operator">/</span>libmogosecurity<span class="token punctuation">.</span>so
</code></pre> 
<ul><li>珊瑚灵御</li></ul> 
<pre><code class="prism language-c">assets<span class="token operator">/</span>libreincp<span class="token punctuation">.</span>so
assets<span class="token operator">/</span>libreincp_x86<span class="token punctuation">.</span>so
</code></pre> 
<h3><a id="application_285"></a>部分壳的application</h3> 
<ul><li>爱加密</li></ul> 
<pre><code class="prism language-c">s<span class="token punctuation">.</span>h<span class="token punctuation">.</span>e<span class="token punctuation">.</span>l<span class="token punctuation">.</span>l<span class="token punctuation">.</span>S
</code></pre> 
<ul><li>360加固</li></ul> 
<pre><code class="prism language-c">com<span class="token punctuation">.</span>stub<span class="token punctuation">.</span>StubApp
</code></pre> 
<ul><li>几维安全</li></ul> 
<pre><code class="prism language-c">com<span class="token punctuation">.</span>Kiwisec<span class="token punctuation">.</span>KiwiSecApplication
com<span class="token punctuation">.</span>Kiwisec<span class="token punctuation">.</span>ProxyApplication
或者干脆没有application
</code></pre> 
<ul><li>梆梆安全</li></ul> 
<pre><code class="prism language-c">com<span class="token punctuation">.</span>secshell<span class="token punctuation">.</span>secData<span class="token punctuation">.</span>ApplicationWrapper
</code></pre> 
<ul><li>腾讯加固</li></ul> 
<pre><code class="prism language-c">com<span class="token punctuation">.</span>tencent<span class="token punctuation">.</span>StubShell<span class="token punctuation">.</span>TxAppEntry
</code></pre> 
<ul><li>海云安</li></ul> 
<pre><code class="prism language-c">c<span class="token punctuation">.</span>b<span class="token punctuation">.</span>c<span class="token punctuation">.</span>b
</code></pre> 
<ul><li>腾讯御安全</li></ul> 
<pre><code class="prism language-c">MyWrapperProxyApplication
</code></pre> 
<ul><li>顶象技术</li></ul> 
<pre><code class="prism language-c">cn<span class="token punctuation">.</span>securitystack<span class="token punctuation">.</span>stee<span class="token punctuation">.</span>AppStub
</code></pre> 
<ul><li>apktoolplus</li></ul> 
<pre><code class="prism language-c">com<span class="token punctuation">.</span>linchaolong<span class="token punctuation">.</span>apktoolplus<span class="token punctuation">.</span>jiagu<span class="token punctuation">.</span>ProxyApplication
</code></pre> 
<ul><li>珊瑚灵御</li></ul> 
<pre><code class="prism language-c">com<span class="token punctuation">.</span>coral<span class="token punctuation">.</span>util<span class="token punctuation">.</span>StubApplication
</code></pre> 
<ul><li>魔固云(中国移动加固)</li></ul> 
<pre><code class="prism language-c">com<span class="token punctuation">.</span>mogosec<span class="token punctuation">.</span>AppMgr
</code></pre> 
<ul><li>apktool助手伪加固特征</li></ul> 
<pre><code class="prism language-c">监测application即可
</code></pre> 
<ul><li>假360加固</li></ul> 
<pre><code class="prism language-c">没<span class="token punctuation">.</span>appkey
application为com<span class="token punctuation">.</span>qihoo<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stub2678363137
</code></pre> 
<ul><li>假梆梆加固</li></ul> 
<pre><code class="prism language-c">application为com<span class="token punctuation">.</span>secoen<span class="token punctuation">.</span>apkwrapper<span class="token punctuation">.</span>ApplicationWrapper
</code></pre> 
<h2><a id="0x04__377"></a>0x04 和平精英辅助分析</h2> 
<p><img src="https://images2.imgbox.com/f9/40/22ci7swu_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/c9/90/NkOaYnj0_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/e3/23/hj4X29Pv_o.png" alt="在这里插入图片描述"><br> 配置好对应配置，这样我们就可以抓包了</p> 
<p><img src="https://images2.imgbox.com/6d/b5/y9inQXPI_o.png" alt="在这里插入图片描述"></p> 
<p>然后返回手机主页，再点击精英Fz APP</p> 
<p><img src="https://images2.imgbox.com/20/de/MWRv78QB_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/a7/5a/xKfIi5ls_o.png" alt="在这里插入图片描述"></p> 
<p>点击更新，此处会出现更新的链接，吐槽一哈Burp，该链接抓取时Burp的历史包里面会自动消失，建议更新时直接抓包或者使用其它的抓包协议把该请求获取到</p> 
<pre><code>GET /jdqsc/gx.txt HTTP/1.1
User-Agent: Dalvik/2.1.0 (Linux; U; Android 7.1.2; VOG-AL00 Build/N2G48H)
Host: buwo.oss-cn-beijing.aliyuncs.com
Connection: close
Accept-Encoding: gzip, deflate
</code></pre> 
<p><img src="https://images2.imgbox.com/e3/d7/9T51Vyrl_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/04/45/mwhbDcr9_o.png" alt="在这里插入图片描述"></p> 
<p>可以看到服务器是放到阿里云的对象存储OSS服务器上的，下面这个是：</p> 
<p>防封引擎地址：https://pan.lanzouw.com/xxx</p> 
<p><img src="https://images2.imgbox.com/46/53/aFbrLgnN_o.png" alt="在这里插入图片描述"></p> 
<p>发卡地址：https://xxx</p> 
<p><img src="https://images2.imgbox.com/70/0e/0CRsDDmf_o.png" alt="在这里插入图片描述"></p> 
<p>该APP主要通过网络通信行为有北京阿里云服务器、蓝奏云网盘、第三方平台的付款和注册卡做通信和验证</p> 
<p><img src="https://images2.imgbox.com/64/03/eXi3inxH_o.png" alt="在这里插入图片描述"></p> 
<p>先将APK后缀改为ZIP后解压包后，将里面的classes.dex文件复制出来，然后放到dex2jar路径下，执行如下命令：</p> 
<pre><code class="prism language-java">d2j<span class="token operator">-</span>dex2jar<span class="token punctuation">.</span>bat classes<span class="token punctuation">.</span>dex
</code></pre> 
<p><img src="https://images2.imgbox.com/77/66/XRICjCpn_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/f3/bc/sT4HVREc_o.png" alt="在这里插入图片描述"></p> 
<p>如上图发现入口类Application类被处理过了，APP做了加固</p> 
<ul><li>识别APP是否加固的小方法</li></ul> 
<blockquote> 
</blockquote> 
<p>1、将app解压出来查看assets目录下，是否有对应的so文件，这个目录下的so文件名称是可以作为识别是什么加固厂商的方法</p> 
<p>2、将app拖到反编译工具，如jadx工具上，通过工具可看出Application的入口类是否被替换，以及是否存在加固厂商的特征</p> 
<p><strong>PS</strong>：APP的Application类中的attachBaseContext和onCreate这两个函数是最先获取执行权进行代码执行的。这也是为什么很多加固工具的主要逻辑都是通过替换APP入口Application，并自实现这两个函数从而达到加固的效果</p> 
<p>上面截图中，发现存在如下特征：</p> 
<pre><code class="prism language-c">com<span class="token punctuation">.</span>stub<span class="token punctuation">.</span>StubApp
assets<span class="token operator">/</span><span class="token punctuation">.</span>appkey
assets<span class="token operator">/</span>libjiagu<span class="token punctuation">.</span>so
</code></pre> 
<p><strong>PS</strong>：发现该APP是360加固</p> 
<ul><li>小技巧 
  <ul><li>应用程序的asset目录，知道这个目录是不参与apk的资源编译过程的，所以很多加固的应用喜欢把加密之后的源apk放到这里</li><li>把源apk加密放到壳的dex文件的尾部，这种加固方式会发现使用dex2jar工具解析dex是失败的</li><li>libs目录</li><li>把源apk加密放到so文件中，一般都是把源apk进行拆分，存到so文件中，分析难度会加大的</li><li>从AndroidManifest.xml 查找入口类</li></ul> </li></ul> 
<h3><a id="41_Frida__468"></a>4.1 Frida 脱壳工具</h3> 
<ul><li>壳的分类</li></ul> 
<p>壳的种类非常多，可以简单的分为以下三类：</p> 
<ul><li>一代整体型：采用Dex整体加密，动态加载运行的机制（免费类的壳）</li><li>二代函数抽取型：将方法单独抽取出来，加密保存，解密执行（某加密）</li><li>三代VMP、Dex2C：独立虚拟机解释执行</li></ul> 
<h4><a id="411_FridaUnpack_477"></a>4.1.1 Frida-Unpack</h4> 
<p>firda-unpack 原理是利用frida hook libart.so中的OpenMemory方法，拿到内存中dex的地址，计算出dex文件的大小，从内存中将dex导出，我们可以查看项目中的 OpenMemory.js 文件中的代码更清晰直观地了解</p> 
<p><strong>项目地址</strong>：https://github.com/GuoQiang1993/Frida-Apk-Unpack</p> 
<pre><code class="prism language-c">frida <span class="token operator">-</span>U <span class="token operator">-</span>f   com<span class="token punctuation">.</span>APK进程名   <span class="token operator">-</span>l<span class="token punctuation">.</span> dexDump<span class="token punctuation">.</span>js<span class="token punctuation">.</span> <span class="token operator">--</span>no<span class="token operator">-</span>pause
</code></pre> 
<p><strong>PS</strong>：将 dex 文件并 dump 下来，保存在 data/data/packageName 目录下</p> 
<h4><a id="412_FRIDADEXDump_489"></a>4.1.2 FRIDA-DEXDump</h4> 
<p>脱壳后的dex文件保存在PC端main.py同一目录下，以包名为文件名</p> 
<p><strong>项目地址</strong>：https://github.com/hluwa/FRIDA-DEXDump</p> 
<h4><a id="413_frida_dump_495"></a>4.1.3 frida_dump</h4> 
<p>文件头搜索dex，来脱壳</p> 
<p><strong>项目地址</strong>：https://github.com/lasting-yang/frida_dump</p> 
<p><strong>PS</strong>：会搜索 dex 文件并 dump 下来，保存在 data/data/packageName/files 目录下</p> 
<h4><a id="414_FART_504"></a>4.1.4 FART</h4> 
<p>Frida 版的 Fart, 目前只能在 andorid8 上使用该frida版fart是使用hook的方式实现的函数粒度的脱壳，仅仅是对类中的所有函数进行了加载，但依然可以解决绝大多数的抽取保护</p> 
<p><strong>项目地址</strong>：https://github.com/hanbinglengyue/FART</p> 
<blockquote>
  解压 frida_fart.zip 将目录中的 fart.so 与 fart64.so 推送到 /data/app目录下 并使用 chmod 777 需要以spawn方式启动app，等待app进入Activity界面后，执行fart()函数即可。如app包名为com.example.test，则 
</blockquote> 
<pre><code class="prism language-c">frida <span class="token operator">-</span>U <span class="token operator">-</span>f com<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span>test <span class="token operator">-</span>l frida_fart_hook<span class="token punctuation">.</span>js <span class="token operator">--</span>no<span class="token operator">-</span>pause
</code></pre> 
<ul><li>等待app进入主界面,执行fart()</li></ul> 
<pre><code>高级用法：

如果发现某个类中的函数的CodeItem没有dump下来，
可以调用dump(classname),传入要处理的类名，
完成对该类下的所有函数体的dump，
dump下来的函数体会追加到bin文件当中
</code></pre> 
<p><strong>PS</strong>：于被动调用的脱壳修复，由于代码覆盖率低，不可能触发app中的所有函数的调用，因此，修复的范围有限</p> 
<h4><a id="415_BlackDex_533"></a>4.1.5 BlackDex</h4> 
<p>BlackDex是一个运行在Android手机上的脱壳工具，支持5.0～12，无需依赖任何环境任何手机都可以使用，包括模拟器。只需几秒，即可对已安装包括未安装的APK进行脱壳。</p> 
<p><strong>项目地址</strong>：https://github.com/CodingGay/BlackDex</p> 
<h3><a id="42__540"></a>4.2 脱壳</h3> 
<ul><li> <p>APP脱壳两个最为关键的要素</p> 
  <ul><li>内存中dex的起始地址和大小，只有拿到这两个要素，才能够成功dump下内存中的dex</li><li>脱壳时机，只有正确的脱壳时机，才能够dump下明文状态的dex。否则，时机不对，及时是正确的起始地址和大小，dump下来的也可能只是密文</li></ul> </li><li> <p>APP脱壳原理</p> </li></ul> 
<p>在壳app解密源apk的dex之后，源apk被加载之前，拦截这个过程中的系统函数，把内存中的dex文件dump拿出来</p> 
<p>对于完整的dex文件，采用暴力搜索方式搜索dex035关键特征，对于抹掉头文件信息的dex如抹掉dex035这个的magic bytes 信息，此时就需通过匹配一些特征来进行搜索</p> 
<p>工具：https://github.com/dstmath/frida-unpack</p> 
<ul><li>需要安装frida环境</li></ul> 
<p>https://frida.re</p> 
<pre><code class="prism language-c">pip3 install frida<span class="token operator">-</span>tools
</code></pre> 
<pre><code class="prism language-c">adb<span class="token punctuation">.</span>exe push C<span class="token operator">:</span>\xxx\frida<span class="token operator">-</span>unpack\inject<span class="token punctuation">.</span>sh  <span class="token operator">/</span>data
cd <span class="token operator">/</span>data
chmod <span class="token operator">+</span>x inject<span class="token punctuation">.</span>sh

# 转发frida端口
adb<span class="token punctuation">.</span>exe forward tcp<span class="token operator">:</span><span class="token number">27042</span> tcp<span class="token operator">:</span><span class="token number">27042</span>
adb<span class="token punctuation">.</span>exe forward tcp<span class="token operator">:</span><span class="token number">27043</span> tcp<span class="token operator">:</span><span class="token number">27043</span>
adb<span class="token punctuation">.</span>exe forward tcp<span class="token operator">:</span><span class="token number">38089</span> tcp<span class="token operator">:</span><span class="token number">38089</span>
# 启动frida并修改监听端口（防止部分app监测默认端口）
adb<span class="token punctuation">.</span>exe shell <span class="token operator">/</span>data<span class="token operator">/</span>local<span class="token operator">/</span>tmp<span class="token operator">/</span> <span class="token operator">-</span>l <span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token operator">:</span><span class="token number">38089</span>
</code></pre> 
<ul><li>AndroidCPU架构</li></ul> 
<table><thead><tr><th>CPU架构</th><th>描述</th></tr></thead><tbody><tr><td>armeabi</td><td>第5代 ARM v5TE，使用软件浮点运算，兼容所有ARM设备，通用性强，速度慢</td></tr><tr><td>armeabi-v7a</td><td>第7代 ARM v7，使用硬件浮点运算，具有高级扩展功能</td></tr><tr><td>arm64-v8a</td><td>第8代，64位,包含 Aarch32、Arch64两个执行状态对应32、64bit</td></tr><tr><td>x86</td><td>intel32位，一般用于平板电脑</td></tr><tr><td>x86_64</td><td>intel64位，一般用于平板电脑</td></tr><tr><td>mips</td><td>少接触</td></tr><tr><td>mips64</td><td>少接触</td></tr></tbody></table> 
<ul><li>获取当前模拟器的CPU，好选择frida-server的版本</li></ul> 
<pre><code class="prism language-c">adb shell getprop ro<span class="token punctuation">.</span>product<span class="token punctuation">.</span>cpu<span class="token punctuation">.</span>abi
</code></pre> 
<pre><code class="prism language-c">adb<span class="token punctuation">.</span>exe push E<span class="token operator">:</span>\xxx\frida<span class="token operator">-</span>unpack\frida<span class="token operator">-</span>server<span class="token operator">-</span><span class="token number">15.1</span><span class="token number">.14</span><span class="token operator">-</span>android<span class="token operator">-</span>x86  <span class="token operator">/</span>data<span class="token operator">/</span>local<span class="token operator">/</span>tmp<span class="token operator">/</span>

adb<span class="token punctuation">.</span>exe shell 
cd <span class="token operator">/</span>data<span class="token operator">/</span>local<span class="token operator">/</span>tmp<span class="token operator">/</span>
chmod <span class="token number">777</span> frida<span class="token operator">-</span>server<span class="token operator">-</span><span class="token number">15.1</span><span class="token number">.14</span><span class="token operator">-</span>android<span class="token operator">-</span>x86
<span class="token punctuation">.</span><span class="token operator">/</span>frida<span class="token operator">-</span>server<span class="token operator">-</span><span class="token number">15.1</span><span class="token number">.14</span><span class="token operator">-</span>android<span class="token operator">-</span>x86
</code></pre> 
<p><img src="https://images2.imgbox.com/cd/11/OB9ouyZM_o.png" alt="在这里插入图片描述"></p> 
<p><strong>PS</strong>： 可能大家会遇到脱壳失败的，多试几次</p> 
<p><img src="https://images2.imgbox.com/6d/fe/w9FPYOKX_o.png" alt="在这里插入图片描述"></p> 
<p>脱壳失败解决方案：</p> 
<ul><li>1、多试几次python main.py -n com.jyzlhkj</li><li>2、尝试python main.py -n com.jyzlhkj -p 进程ID号</li><li>3、尝试python main.py -n com.jyzlhkj -p 进程ID号 -f</li><li>4、非root权限的话，尝试sudo sysctl kernel.yama.ptrace_scope=0 ，或 以root权限运行frida</li><li>5、frida版本换一个，不要最新版的</li></ul> 
<p>博主是多次尝试第二种方法成功，有好几次运行的时候程序闪退，可能是模拟器的缘故造成的</p> 
<p>接下来我们再把另外一个脱一下壳</p> 
<pre><code class="prism language-c">pyhon3 main<span class="token punctuation">.</span>py <span class="token operator">-</span>p <span class="token number">4943</span>  <span class="token operator">-</span>n com<span class="token punctuation">.</span>zlhkjyq
</code></pre> 
<p><img src="https://images2.imgbox.com/d4/0c/LEslTRk8_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/77/ca/twO6rOI5_o.png" alt="在这里插入图片描述"></p> 
<ul><li>精英Fz文件反编译出如下dex文件，其中0xc3ee1a20.dex、0xc3ee1b70.dex未反编译成功</li></ul> 
<pre><code class="prism language-c"><span class="token number">0xb3c8d000.de</span>x
<span class="token number">0xb3e77f30.de</span>x
<span class="token number">0xb356d000.de</span>x
<span class="token number">0xc3ee1a20.de</span>x
<span class="token number">0xc3ee1b70.de</span>x
</code></pre> 
<p><img src="https://images2.imgbox.com/72/6e/xnpbX008_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/f5/1e/KjbeCLKs_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/b3/74/m6yi8yXd_o.png" alt="在这里插入图片描述"></p> 
<p>从上面的几张图，发现是用易语言开发的APK，包的特征比较明显</p> 
<p><img src="https://images2.imgbox.com/56/34/uT6WuoDT_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/77/c3/Nj3AmS0a_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/43/ca/RU1tQN9E_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-c">find <span class="token operator">/</span>  <span class="token operator">-</span>name <span class="token string">"*.txt"</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/48/ec/seRFFxdZ_o.png" alt="在这里插入图片描述"><br> 查看其中的一些文本发现可获得APK下载的地址</p> 
<p><img src="https://images2.imgbox.com/a4/f3/QhNw5YMr_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/e4/f7/IQcnDsnm_o.png" alt="在这里插入图片描述"><br> 将校验分享多少次可领注册码的文本内容改一下，改成20，即可领取注册码</p> 
<pre><code class="prism language-c">adb<span class="token punctuation">.</span>exe pull <span class="token operator">/</span>data<span class="token operator">/</span>media<span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span>stymd<span class="token operator">/</span>ther<span class="token operator">/</span>bmn<span class="token operator">/</span>zscs<span class="token punctuation">.</span>txt D<span class="token operator">:</span><span class="token operator">/</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/d0/3c/11WvTEfn_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-c">adb<span class="token punctuation">.</span>exe push D<span class="token operator">:</span><span class="token operator">/</span>zscs<span class="token punctuation">.</span>txt  <span class="token operator">/</span>data<span class="token operator">/</span>media<span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span>stymd<span class="token operator">/</span>ther<span class="token operator">/</span>bmn
</code></pre> 
<p><img src="https://images2.imgbox.com/52/d0/1jOS2068_o.png" alt="在这里插入图片描述"></p> 
<p>再次进入游戏，点击领取注册号</p> 
<p><img src="https://images2.imgbox.com/32/0d/R8vorZGh_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/18/c5/gn9ei6HA_o.png" alt="在这里插入图片描述"></p> 
<p>在我们已注册成功后，该软件会去下载防封引擎</p> 
<p><img src="https://images2.imgbox.com/02/9e/gLYiX3B3_o.png" alt="在这里插入图片描述"></p> 
<ul><li>下载防封引擎apk</li></ul> 
<pre><code class="prism language-javascript"><span class="token constant">GET</span> <span class="token operator">/</span>tp<span class="token operator">/</span>xxxxx <span class="token constant">HTTP</span><span class="token operator">/</span><span class="token number">1.1</span>
<span class="token literal-property property">Host</span><span class="token operator">:</span> iji<span class="token punctuation">.</span>lanzout<span class="token punctuation">.</span>com
<span class="token literal-property property">Connection</span><span class="token operator">:</span> close
Upgrade<span class="token operator">-</span>Insecure<span class="token operator">-</span>Requests<span class="token operator">:</span> <span class="token number">1</span>
User<span class="token operator">-</span>Agent<span class="token operator">:</span> Mozilla<span class="token operator">/</span><span class="token number">5.0</span> <span class="token punctuation">(</span>Linux<span class="token punctuation">;</span> Android <span class="token number">5.1</span><span class="token number">.1</span><span class="token punctuation">;</span> <span class="token constant">HD1910</span> Build<span class="token operator">/</span><span class="token constant">LMY48Z</span><span class="token punctuation">;</span> wv<span class="token punctuation">)</span> AppleWebKit<span class="token operator">/</span><span class="token number">537.36</span> <span class="token punctuation">(</span><span class="token constant">KHTML</span><span class="token punctuation">,</span> like Gecko<span class="token punctuation">)</span> Version<span class="token operator">/</span><span class="token number">4.0</span> Chrome<span class="token operator">/</span><span class="token number">52.0</span><span class="token number">.2743</span><span class="token number">.100</span> Mobile Safari<span class="token operator">/</span><span class="token number">537.36</span>
<span class="token literal-property property">Accept</span><span class="token operator">:</span> text<span class="token operator">/</span>html<span class="token punctuation">,</span>application<span class="token operator">/</span>xhtml<span class="token operator">+</span>xml<span class="token punctuation">,</span>application<span class="token operator">/</span>xml<span class="token punctuation">;</span>q<span class="token operator">=</span><span class="token number">0.9</span><span class="token punctuation">,</span>image<span class="token operator">/</span>webp<span class="token punctuation">,</span><span class="token operator">*</span><span class="token comment">/*;q=0.8
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,en-US;q=0.8
X-Requested-With: com.android.browser
</span></code></pre> 
<p><img src="https://images2.imgbox.com/46/d1/Y35Rm1Qs_o.png" alt="在这里插入图片描述"></p> 
<ul><li>防封引擎的破解方法</li></ul> 
<p>跟精英辅助Fz一样，通过本地判断的，白嫖永远是那么的理所当然，哈哈，但千万不要去购买破坏游戏规则，此处只做研究用，不提供APK样本</p> 
<p><img src="https://images2.imgbox.com/c7/ad/DXprJmVU_o.png" alt="在这里插入图片描述"></p> 
<p>返回游戏，发现显示注册成功</p> 
<pre><code class="prism language-c">adb<span class="token punctuation">.</span>exe push D<span class="token operator">:</span><span class="token operator">/</span>ff<span class="token punctuation">.</span>txt  <span class="token operator">/</span>mnt<span class="token operator">/</span>shell<span class="token operator">/</span>emulated<span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span>Dyri<span class="token operator">/</span>yxme<span class="token operator">/</span>winop
</code></pre> 
<p><img src="https://images2.imgbox.com/dc/0a/FtJjODyo_o.png" alt="在这里插入图片描述"></p> 
<p>之前看代码逻辑时，发现它判断是通过本地，一个是判断本地是否存在vip.txt文本和分享次数是否达到20次来判断是否已注册或满足领取注册号的资格，那么本地直接创建一个vip.txt，丢进去，即可激活</p> 
<p><img src="https://images2.imgbox.com/fd/ea/weZTombJ_o.png" alt="在这里插入图片描述"></p> 
<p><strong>PS</strong>：已知vip.txt文本为空，那么看来只是单纯的判断这个文本存不存在了</p> 
<p><img src="https://images2.imgbox.com/27/13/tOdLvYbv_o.png" alt="在这里插入图片描述"></p> 
<p>该APP外挂的防封引擎，它是通过将作弊功能的代码注入到游戏客户端上，而实现游戏作弊的功能和效果</p> 
<p>要实现游戏作弊功能，从业务层面上就是修改游戏角色属性或者关键函数参数、返回值信息。从底层引擎实现上来说就是通过基于修改底层渲染部分实现作弊功能，如调整子弹的速度，这样当子弹和碰撞体进行碰撞的时候，就会发生穿墙的效果。</p> 
<p><img src="https://images2.imgbox.com/29/00/RZZwckJb_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/de/7c/9Mj2cMdV_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/f1/55/G5no9Hkl_o.png" alt="在这里插入图片描述"></p> 
<p>游戏中购买使用游戏辅助软件，危险系数非常高的，因为使用游戏辅助那么肯定会面临被封号的风险，其二购买游戏辅助容易出现被骗的情况</p> 
<p><strong>参考链接</strong>：</p> 
<p>https://blog.csdn.net/g5703129/article/details/85054405</p> 
<p>https://www.cnblogs.com/wf-l5201314/p/9714435.html</p> 
<p>https://www.zhangkunzhi.com/index.php/archives/211/</p> 
<hr> 
<p><strong>我自横刀向天笑，去留肝胆两昆仑</strong></p> 
<hr>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b698fd9c344bd7ed8f0a7f7ab2ccd3f3/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">NMOS和PMOS管 电流方向和应用电路</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0f99c49f5d96804f19af15fcf3007359/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">win10系统怎么查看密钥？</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>