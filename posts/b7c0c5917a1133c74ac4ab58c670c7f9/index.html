<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>速码！！BGP最全学习笔记：IBGP和EBGP基本配置 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="速码！！BGP最全学习笔记：IBGP和EBGP基本配置" />
<meta property="og:description" content="实验1：配置IBGP和EBGP 实验目的 熟悉IBGP和EBGP的应用场景掌握IBGP和EBGP的配置方法 实验拓扑 想要华为数通配套实验拓扑和配置笔记的朋友们点赞&#43;关注，评论区留下邮箱发给你! 实验步骤 1.IP地址的配置
R1的配置
&lt;Huawei&gt;system-view Enter system view, return user view with Ctrl&#43;Z.
[Huawei]undo info-center enable [Huawei]sysname R1
[R1]interface g0/0/0
[R1-GigabitEthernet0/0/0]ip address 12.1.1.1 24
[R1-GigabitEthernet0/0/0]quit
[R1]interface LoopBack 0
[R1-LoopBack0]ip address 1.1.1.1 32
[R1-LoopBack0]quit
R2的配置
&lt;Huawei&gt;system-view Enter system view, return user view with Ctrl&#43;Z.
[Huawei]undo info-center enable [Huawei]sysname R2
[R2]interface g0/0/1
[R2-GigabitEthernet0/0/1]ip address 12.1.1.2 24
[R2-GigabitEthernet0/0/1]quit
[R2]interface g0/0/0
[R2-GigabitEthernet0/0/0]ip address 23.1.1.2 24
[R2-GigabitEthernet0/0/0]quit
[R2]interface LoopBack 0" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/b7c0c5917a1133c74ac4ab58c670c7f9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-24T09:00:00+08:00" />
<meta property="article:modified_time" content="2023-09-24T09:00:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">速码！！BGP最全学习笔记：IBGP和EBGP基本配置</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3 style="text-align:justify;"><strong><strong><strong>实验1：配置I</strong></strong><strong><strong>BGP</strong></strong><strong><strong>和E</strong></strong><strong><strong>BGP</strong></strong></strong></h3> 
<h4>实验目的</h4> 
<ol><li>熟悉IBGP和EBGP的应用场景</li><li>掌握IBGP和EBGP的配置方法</li></ol> 
<h4>实验拓扑</h4> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="158" src="https://images2.imgbox.com/f8/40/MOPhRKe8_o.png" width="496"></p> 
<p style="margin-left:.0001pt;text-align:justify;">                   </p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#fe2c24;"><strong>想要华为数通配套实验拓扑和配置笔记的朋友们点赞+关注，评论区留下邮箱发给你!</strong></span>       </p> 
<h4>实验步骤</h4> 
<p>1.IP地址的配置</p> 
<p style="margin-left:.0001pt;text-align:justify;">R1的配置</p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">&lt;Huawei&gt;system-view </span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">Enter system view, return user view with Ctrl+Z.</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[Huawei]undo info-center enable </span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[Huawei]sysname R1</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R1]interface g0/0/0</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R1-GigabitEthernet0/0/0]ip address 12.1.1.1 24</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R1-GigabitEthernet0/0/0]quit</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R1]interface LoopBack 0</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R1-LoopBack0]ip address 1.1.1.1 32</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R1-LoopBack0]quit</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;">R2的配置</p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">&lt;Huawei&gt;system-view </span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">Enter system view, return user view with Ctrl+Z.</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[Huawei]undo info-center enable </span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[Huawei]sysname R2</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R2]interface g0/0/1</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R2-GigabitEthernet0/0/1]ip address 12.1.1.2 24</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R2-GigabitEthernet0/0/1]quit</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R2]interface g0/0/0</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R2-GigabitEthernet0/0/0]ip address 23.1.1.2 24</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R2-GigabitEthernet0/0/0]quit</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R2]interface LoopBack 0</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R2-LoopBack0]ip address 2.2.2.2 32</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R2-LoopBack0]quit</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;">R3的配置</p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">&lt;Huawei&gt;system-view </span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">Enter system view, return user view with Ctrl+Z.</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[Huawei]undo info-center enable </span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[Huawei]sysname R3</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R3]interface g0/0/1</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R3-GigabitEthernet0/0/1]ip address 23.1.1.3 24</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R3-GigabitEthernet0/0/1]quit</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R3]interface LoopBack0</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R3-LoopBack0]ip address 3.3.3.3 32  </span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R3-LoopBack0]quit</span></span></p> 
<p>2.配置IGP：R1与R2运行OSPF协议</p> 
<p style="margin-left:.0001pt;text-align:justify;">R1的配置</p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R1]ospf router-id 1.1.1.1</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R1-ospf-1]area 0</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R1-ospf-1-area-0.0.0.0]network 12.1.1.0 0.0.0.255</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R1-ospf-1-area-0.0.0.0]network 1.1.1.1 0.0.0.0</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R1-ospf-1-area-0.0.0.0]quit</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R1-ospf-1]quit</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;">R2的配置</p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R2]ospf router-id 2.2.2.2</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R2-ospf-1]area 0</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R2-ospf-1-area-0.0.0.0]network 12.1.1.0 0.0.0.255</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R2-ospf-1-area-0.0.0.0]network 2.2.2.2 0.0.0.0</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R2-ospf-1-area-0.0.0.0]quit</span></span></p> 
<p>3.配置IBGP</p> 
<p style="margin-left:.0001pt;text-align:justify;">R1的配置</p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R1]bgp 100  //</span><span style="color:#0c0c0c;">启动B</span><span style="color:#0c0c0c;">GP</span><span style="color:#0c0c0c;">进程，进程号为1</span><span style="color:#0c0c0c;">00</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R1-bgp]undo synchronization  //</span><span style="color:#0c0c0c;">关闭同步，默认配置</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R1-bgp]undo summary automatic  //</span><span style="color:#0c0c0c;">关闭自动汇总，默认配置</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R1-bgp]router-id 1.1.1.1  //</span><span style="color:#0c0c0c;">设置B</span><span style="color:#0c0c0c;">GP</span><span style="color:#0c0c0c;">的r</span><span style="color:#0c0c0c;">outer-id</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R1-bgp]peer 2.2.2.2 as-number 100  </span><span style="color:#0c0c0c;">/</span><span style="color:#0c0c0c;">/</span><span style="color:#0c0c0c;">指定邻居和邻居的A</span><span style="color:#0c0c0c;">S</span><span style="color:#0c0c0c;">号</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R1-bgp]peer 2.2.2.2 connect-interface LoopBack 0  //</span><span style="color:#0c0c0c;">用环回口建邻居</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R1-bgp]quit</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;">R2的配置</p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R2]bgp 100</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R2-bgp]undo synchronization </span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R2-bgp]undo summary automatic </span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R2-bgp]bgp     </span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R2-bgp]router-id 2.2.2.2</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R2-bgp]peer 1.1.1.1 as-number 100</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R2-bgp]peer 1.1.1.1 connect-interface LoopBack 0</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R2-bgp]quit</span></span></p> 
<p>4.配置EBGP</p> 
<p style="margin-left:.0001pt;text-align:justify;">R2的配置</p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R2]bgp 100</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R2-bgp]peer 23.1.1.3 as-number 200  //EBGP</span><span style="color:#0c0c0c;">用直连接口建邻居</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;">R3的配置</p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R3]bgp 200</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R3-bgp]undo synchronization </span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R3-bgp]undo summary automatic </span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R3-bgp]peer 23.1.1.2 as-number 100</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><span style="color:#0c0c0c;">[R3-bgp]quit</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><strong>【</strong></strong><strong><strong>技术要点</strong></strong><strong><strong>】配置B</strong></strong><strong><strong>GP</strong></strong><strong><strong>对等体关系的建议</strong></strong></p> 
<ul><li><strong><strong>I</strong></strong><strong><strong>BGP</strong></strong><strong><strong>用环回口建邻居</strong></strong></li><li><strong><strong>E</strong></strong><strong><strong>BGP</strong></strong><strong><strong>用直连建邻居</strong></strong></li><li><strong><strong>如果E</strong></strong><strong><strong>BGP</strong></strong><strong><strong>用环回口建邻居必须配置</strong></strong><strong><strong>peer ebgp-max-hop命令</strong></strong></li></ul> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#fe2c24;"><strong>想要华为数通配套实验拓扑和配置笔记的朋友们点赞+关注，评论区留下邮箱发给你!</strong></span></p> 
<h4>实验调试</h4> 
<p>1.查看TCP连接</p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;">&lt;R1&gt;display tcp status </span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;">TCPCB    Tid/Soid Local Add:port        Foreign Add:port      VPNID  State</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;">1d322414 59 /1    0.0.0.0:23            0.0.0.0:0             -1     Listening</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;">172ede3c 107/2    0.0.0.0:179           2.2.2.2:0             0      Listening</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><strong><strong>172ed4fc 107/36   1.1.1.1:179           2.2.2.2:65309         0      Established</strong></strong></span></p> 
<p style="margin-left:.0001pt;text-align:justify;">通过以上可以看到，TCP连接是成功的</p> 
<p>2.查看对等体的状态</p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;">&lt;R1&gt;display bgp peer </span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"> BGP local router ID : 1.1.1.1    // BGP本地Router ID</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"> Local AS number : 100    //本地AS编号</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"> Total number of peers : 1                Peers in established state : 1</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;">   //对等体总个数                                 //处于建立状态的对等体个数</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><strong><strong>  Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State PrefRcv</strong></strong></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><strong><strong>  2.2.2.2         4         100      146      147     0 02:24:44 Established       0</strong></strong></span></p> 
<p style="margin-left:.0001pt;text-align:justify;">以上输出邻居表的各个字段的含义如下：</p> 
<ul><li>Peer：对等体的IP地址</li><li>V ：对等体使用的BGP版本</li><li>AS：自治系统号</li><li>MsgRcvd：接收的信息统计数</li><li>MsgSent：发送的信息统计数</li><li>OutQ：等待发往指定对等体的消息</li><li>Up/Down：邻居关系建立的时间</li><li>State：邻居的状态</li><li>PrefRcv：本端从对等体上收到路由前缀的数目</li></ul> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">3.在R3上用network宣告的方式产生一条BGP路由、在R1上引入的方式产生一条BGP路由</p> 
<p style="margin-left:.0001pt;text-align:justify;">R3 的配置</p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;">[R3]bgp 200</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;">[R3-bgp]network 3.3.3.3 32</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;">[R3-bgp]quit</span></p> 
<p style="margin-left:.0001pt;text-align:justify;">R1的配置</p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;">[R1]bgp 100</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;">[R1-bgp]import-route ospf 1</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><strong>【技术要点】</strong></strong></p> 
<p style="margin-left:.0001pt;text-align:justify;">BGP路由生成有三种方式：</p> 
<ul><li>Network</li><li>Import-route</li><li>与IGP协议相同，BGP支持根据已有的路由条目进行聚合，生成聚合路由。</li></ul> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">4.在R1上查看路由表</p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;">[R1]display bgp routing-table </span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"> BGP Local router ID is 1.1.1.1 </span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"> Status codes: * - valid, &gt; - best, d - damped,</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;">               h - history,  i - internal, s - suppressed, S - Stale</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;">               Origin : i - IGP, e - EGP, ? - incomplete</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"> Total Number of Routes: 4</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;">      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"> *&gt;   1.1.1.1/32         0.0.0.0         0                     0      ?</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"> *&gt;   2.2.2.2/32         0.0.0.0         1                     0      ?</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;">   i  3.3.3.3/32         23.1.1.3        0          100        0      200i</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"> *&gt;   12.1.1.0/24        0.0.0.0         0                     0      ?</span></p> 
<p style="margin-left:.0001pt;text-align:justify;">以上输出中，路由条目表项的状态码解析如下：</p> 
<ul><li>*代表路由条目有效  </li><li>&gt;代表路由条目最优，可以被传递，<span style="color:#ff0000;">只有下一跳可达路由才会最优</span></li><li>i代表路由是从IBGP学到的</li><li>Networkw：显示BGP路由表中的网络地址</li><li>  NextHop：报文发送的下一跳地址</li><li>   MED  ：路由度量值</li><li>   LocPrf  ：本地优先级</li><li>PrefVal : 协议首选值</li><li>Path/Ogn：显示AS路径号及Origin属性</li></ul> 
<p style="margin-left:.0001pt;text-align:justify;">以上输出我们可以发现3.3.3.3不是最优的，如果不优就不会在加载进全局路由表，也不会传给其它路由器，本例不优的原因为下一跳不可达，解决办法如下：</p> 
<p style="margin-left:.0001pt;text-align:justify;">R2的配置</p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;">[R2]bgp 100</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;">[R2-bgp]peer 1.1.1.1 next-hop-local   //配置下一跳本地</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;">[R2-bgp]quit</span></p> 
<p style="margin-left:.0001pt;text-align:justify;">5.再查看R1的路由表</p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;">[R1]display bgp routing-table</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"> BGP Local router ID is 1.1.1.1 </span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"> Status codes: * - valid, &gt; - best, d - damped,</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;">               h - history,  i - internal, s - suppressed, S - Stale</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;">               Origin : i - IGP, e - EGP, ? - incomplete</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"> Total Number of Routes: 4</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;">      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"> *&gt;   1.1.1.1/32         0.0.0.0         0                     0      ?</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"> *&gt;   2.2.2.2/32         0.0.0.0         1                     0      ?</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"><strong><strong> *&gt;i  3.3.3.3/32         2.2.2.2         0          100        0      200i</strong></strong></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"> *&gt;   12.1.1.0/24        0.0.0.0         0                     0      ?</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><strong>【技术要点】</strong></strong></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><strong> 什么情况下配置下一跳本地：</strong></strong></p> 
<p style="margin-left:.0001pt;text-align:justify;">对从EBGP邻居收到的路由，在传给IBGP邻居时，修改下一跳地址为本地的connet interface。</p> 
<p style="margin-left:.0001pt;text-align:justify;">（6）查看R2的BGP路由表</p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;">&lt;R2&gt;display bgp routing-table </span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"> BGP Local router ID is 2.2.2.2 </span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"> Status codes: * - valid, &gt; - best, d - damped,</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;">               h - history,  i - internal, s - suppressed, S - Stale</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;">               Origin : i - IGP, e - EGP, ? - incomplete</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"> Total Number of Routes: 4</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;">      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;">   i  1.1.1.1/32         1.1.1.1         0          100        0      ?</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"> *&gt;i  2.2.2.2/32         1.1.1.1         1          100        0      ?</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"> *&gt;   3.3.3.3/32         23.1.1.3        0                     0      200i</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#d8d8d8;"> *&gt;i  12.1.1.0/24        1.1.1.1         0          100        0      ?</span></p> 
<p style="margin-left:.0001pt;text-align:justify;">通过以上输出，我们可以发现1.1.1.1这条路由虽然下一跳可达，但是不是有效和最优的，其原因为：<span style="color:#ff0000;">如果I</span><span style="color:#ff0000;">GP</span><span style="color:#ff0000;">表里面宣告了这条路由，然后再在I</span><span style="color:#ff0000;">BGP</span><span style="color:#ff0000;">里面，路由只能本地有效。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#fe2c24;"><strong>想要华为数通配套实验拓扑和配置笔记的朋友们点赞+关注，评论区留下邮箱发给你!</strong></span></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c6f0ee928d58f257430a77afb12aa38d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">基于单片机智能教室照明人数统计设计</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/cd4190351e2059a87ad55dd44ba1b31a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">QT配置MySQL数据库 &amp;&amp; ninja: build stopped: subcommand failed</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>