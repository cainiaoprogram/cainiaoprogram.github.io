<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>手把手教你AndroidStudio多渠道打包 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="手把手教你AndroidStudio多渠道打包" />
<meta property="og:description" content="最近不断有朋友向我咨询AndroidStudio多渠道的打包方法，今天整理一下之前积累的打包套路，写一篇文章，手把手的教给大家。 说到多渠道，这里不得不提一下友盟统计，友盟统计是大家日常开发中常用的渠道统计工具，而我们的打包方法就是基于友盟统计实施的。按照友盟官方文档说明，渠道信息通常需要在AndroidManifest.xml中配置如下值：
&lt;meta-data android:value=&#34;Channel ID&#34; android:name=&#34;UMENG_CHANNEL&#34;/&gt; 上面的value值Channel_ID就是渠道标识。我们的期望的就是在编译时候这个值能够自动变化以满足区分多渠道的需求。
（一）在AndroidManifest.xml里设置动态渠道变量 &lt;meta-data android:name=&#34;UMENG_CHANNEL&#34; android:value=&#34;${UMENG_CHANNEL_VALUE}&#34; /&gt; （二）在build.gradle设置productFlavors 这里假定我们需要打包的渠道为酷安市场、360、小米、百度、豌豆荚 android { productFlavors { kuan { manifestPlaceholders = [UMENG_CHANNEL_VALUE: &#34;kuan&#34;] } xiaomi { manifestPlaceholders = [UMENG_CHANNEL_VALUE: &#34;xiaomi&#34;] } qh360 { manifestPlaceholders = [UMENG_CHANNEL_VALUE: &#34;qh360&#34;] } baidu { manifestPlaceholders = [UMENG_CHANNEL_VALUE: &#34;baidu&#34;] } wandoujia { manifestPlaceholders = [UMENG_CHANNEL_VALUE: &#34;wandoujia&#34;] } } } 或者批量修改
android { productFlavors { kuan {} xiaomi {} qh360 {} baidu {} wandoujia {} } productFlavors." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/9ad9bf96d5e33097163a6d5962c095b5/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2016-06-29T15:23:39+08:00" />
<meta property="article:modified_time" content="2016-06-29T15:23:39+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">手把手教你AndroidStudio多渠道打包</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>       最近不断有朋友向我咨询AndroidStudio多渠道的打包方法，今天整理一下之前积累的打包套路，写一篇文章，手把手的教给大家。 <br>        说到多渠道，这里不得不提一下友盟统计，友盟统计是大家日常开发中常用的渠道统计工具，而我们的打包方法就是基于友盟统计实施的。按照友盟官方文档说明，渠道信息通常需要在AndroidManifest.xml中配置如下值：</p> 
<pre class="prettyprint"><code class=" hljs cs">&lt;meta-data android:<span class="hljs-keyword">value</span>=<span class="hljs-string">"Channel ID"</span> android:name=<span class="hljs-string">"UMENG_CHANNEL"</span>/&gt;</code></pre> 
<p>       上面的value值Channel_ID就是渠道标识。我们的期望的就是在编译时候这个值能够自动变化以满足区分多渠道的需求。</p> 
<h3 id="一在androidmanifestxml里设置动态渠道变量">（一）在AndroidManifest.xml里设置动态渠道变量</h3> 
<pre class="prettyprint"><code class=" hljs haskell">&lt;meta-<span class="hljs-typedef"><span class="hljs-keyword">data</span></span>
    android:name=<span class="hljs-string">"UMENG_CHANNEL"</span>
    android:value=<span class="hljs-string">"${UMENG_CHANNEL_VALUE}"</span> /&gt;</code></pre> 
<h3 id="二在buildgradle设置productflavors">（二）在build.gradle设置productFlavors</h3> 
<pre class="prettyprint"><code class=" hljs bash">这里假定我们需要打包的渠道为酷安市场、<span class="hljs-number">360</span>、小米、百度、豌豆荚
android {  
    productFlavors {
        kuan {
            manifestPlaceholders = [UMENG_CHANNEL_VALUE: <span class="hljs-string">"kuan"</span>]
        }
        xiaomi {
            manifestPlaceholders = [UMENG_CHANNEL_VALUE: <span class="hljs-string">"xiaomi"</span>]
        }
        qh360 {
            manifestPlaceholders = [UMENG_CHANNEL_VALUE: <span class="hljs-string">"qh360"</span>]
        }
        baidu {
            manifestPlaceholders = [UMENG_CHANNEL_VALUE: <span class="hljs-string">"baidu"</span>]
        }
        wandoujia {
            manifestPlaceholders = [UMENG_CHANNEL_VALUE: <span class="hljs-string">"wandoujia"</span>]
        }
    }  
}</code></pre> 
<p>或者批量修改</p> 
<pre class="prettyprint"><code class=" hljs avrasm">android {  
    productFlavors {
        kuan {}
        xiaomi {}
        qh360 {}
        baidu {}
        wandoujia {}
    }  

    productFlavors<span class="hljs-preprocessor">.all</span> { 
        flavor -&gt; flavor<span class="hljs-preprocessor">.manifestPlaceholders</span> = [UMENG_CHANNEL_VALUE: name] 
    }
}</code></pre> 
<p>       所谓ProductFlavors其实就是可定义的产品特性，配合 manifest merger 使用的时候就可以达成在一次编译过程中产生多个具有自己特性配置的版本。上面这个配置的作用就是，为每个渠道包产生不同的 UMENG_CHANNEL_VALUE 的值。</p> 
<h3 id="三执行打包操作">（三）执行打包操作</h3> 
<p>在AndroidStudio菜单栏点击Build菜单–&gt;Generate signed APK–&gt;选择key，并输入密码 <br> <img src="https://images2.imgbox.com/51/e8/c6E1BdEx_o.png" alt="输入密码" title=""></p> 
<p>然后下一步，选择打包渠道</p> 
<p><img src="https://images2.imgbox.com/fe/bc/Zn5BPWjO_o.png" alt="选择打包渠道" title=""></p> 
<p>最后点击完成按钮</p> 
<p><img src="https://images2.imgbox.com/28/d7/r5hw003b_o.png" alt="这里写图片描述" title=""></p> 
<p>上图可以看到，我们已经成功的将五个渠道包打好。</p> 
<h3 id="四执行打包命令-gradlew-assemblerelease">（四）执行打包命令 ./gradlew assembleRelease</h3> 
<p>       除了使用AndroidStudio图形打包操作以外，我们也可以使用命令行进行打包操作，具体步骤如下：</p> 
<ul><li><h5 id="在androidstudio窗口左下角打开terminal面板输入gradlew-assemblerelease命令">在AndroidStudio窗口左下角打开Terminal面板，输入gradlew assembleRelease命令</h5></li></ul> 
<p><img src="https://images2.imgbox.com/85/26/7a4kS8Pp_o.png" alt="这里写图片描述" title=""></p> 
<ul><li><h5 id="如果系统中没有安装gradle则会自动下载完成安装及初始化">如果系统中没有安装Gradle，则会自动下载完成安装及初始化</h5></li></ul> 
<p><img src="https://images2.imgbox.com/d4/c2/GiBA9osg_o.png" alt="这里写图片描述" title=""></p> 
<ul><li><h5 id="打包成功后会提示build-successrul">打包成功后会提示BUILD SUCCESSRUL</h5></li></ul> 
<p><img src="https://images2.imgbox.com/cc/86/WQZHe9JS_o.png" alt="这里写图片描述" title=""></p> 
<ul><li><h5 id="在appbuildoutputsapk路径中就可以看到打包成功后的apk">在app–&gt;build–&gt;outputs–&gt;apk路径中就可以看到打包成功后的APK</h5></li></ul> 
<p><img src="https://images2.imgbox.com/02/1b/SDa7z9fT_o.png" alt="这里写图片描述" title=""></p> 
<p>注意，此时这里的APK包名显示为unsigned，也就是说未签名，我们可以继续在build.gradle文件中配置签名信息</p> 
<pre class="prettyprint"><code class=" hljs livecodeserver">signingConfigs {
        release{
            storeFile <span class="hljs-built_in">file</span>(<span class="hljs-string">"../wooyun_keystore"</span>)<span class="hljs-comment"> //签名文件路径</span>
            storePassword <span class="hljs-string">"123456"</span>
            keyAlias <span class="hljs-string">"123456"</span>
            keyPassword <span class="hljs-string">"123456"</span> <span class="hljs-comment"> //签名密码</span>
        }
    }</code></pre> 
<ul><li><h5 id="然后再次执行gradlew-assemblerelease命令">然后再次执行gradlew assembleRelease命令</h5></li></ul> 
<p><img src="https://images2.imgbox.com/5e/f1/ehsg1PqW_o.png" alt="这里写图片描述" title=""></p> 
<p>这次生成的就是含有签名的渠道包。</p> 
<ul><li><h5 id="当我们的渠道包版本比较多时可以自定义所打apk包名称用以区分">当我们的渠道包版本比较多时，可以自定义所打APK包名称，用以区分</h5></li></ul> 
<pre class="prettyprint"><code class=" hljs lasso"><span class="hljs-comment">// 自定义输出配置，这里我们加上APK版本号1.0</span>
            applicationVariants<span class="hljs-built_in">.</span><span class="hljs-literal">all</span> { variant <span class="hljs-subst">-&gt;
                </span>variant<span class="hljs-built_in">.</span>outputs<span class="hljs-built_in">.</span>each { output <span class="hljs-subst">-&gt;
                    </span>def outputFile <span class="hljs-subst">=</span> output<span class="hljs-built_in">.</span>outputFile
                    <span class="hljs-keyword">if</span> (outputFile <span class="hljs-subst">!=</span> <span class="hljs-built_in">null</span> <span class="hljs-subst">&amp;&amp;</span> outputFile<span class="hljs-built_in">.</span>name<span class="hljs-built_in">.</span>endsWith(<span class="hljs-string">'.apk'</span>)) {
                        <span class="hljs-comment">// 输出apk名称为wooyun_v1.0_wandoujia.apk</span>
                        def fileName <span class="hljs-subst">=</span> <span class="hljs-string">"wooyun_v${defaultConfig.versionName}_${variant.productFlavors[0].name}.apk"</span>
                        output<span class="hljs-built_in">.</span>outputFile <span class="hljs-subst">=</span> <span class="hljs-literal">new</span> File(outputFile<span class="hljs-built_in">.</span><span class="hljs-keyword">parent</span>, fileName)
                    }
                }
            }</code></pre> 
<p><img src="https://images2.imgbox.com/5d/0a/XuA7AV6q_o.png" alt="这里写图片描述" title=""></p> 
<ul><li><h5 id="assemble是gradle中的编译打包命令有如下用法">assemble是Gradle中的编译打包命令，有如下用法：</h5></li></ul> 
<p>如果我们想打包wandoujia渠道的release版本，执行如下命令就好了：</p> 
<pre class="prettyprint"><code class=" hljs ">gradlew assembleWandoujiaRelease</code></pre> 
<p>如果我们想打包wandoujia渠道的debug版本，执行如下命令就好了：</p> 
<pre class="prettyprint"><code class=" hljs ">gradlew assembleWandoujiaDebug</code></pre> 
<p>如果我们只打wandoujia渠道版本，则：</p> 
<pre class="prettyprint"><code class=" hljs ">gradlew assembleWandoujia</code></pre> 
<p>此命令会生成wandoujia渠道的Release和Debug版本</p> 
<p>同理我想打全部Release版本：</p> 
<pre class="prettyprint"><code class=" hljs ">gradlew assembleRelease</code></pre> 
<p>这条命令会把Product Flavor下的所有渠道的Release版本都打出来。</p> 
<p><strong>下面是我个人的build.gradle配置文件，分享给大家，以作参考</strong></p> 
<pre class="prettyprint"><code class=" hljs livecodeserver">apply plugin: <span class="hljs-string">'com.android.application'</span>

android {
    compileSdkVersion <span class="hljs-number">23</span>
    buildToolsVersion <span class="hljs-string">"23.0.3"</span>

    defaultConfig {
        applicationId <span class="hljs-string">"com.wooyun.castiel"</span>
        minSdkVersion <span class="hljs-number">15</span>
        targetSdkVersion <span class="hljs-number">23</span>
        versionCode <span class="hljs-number">1</span>
        versionName <span class="hljs-string">"1.0"</span>
    }

    <span class="hljs-comment"> //签名</span>
    signingConfigs {
        debugConfig {
            storeFile <span class="hljs-built_in">file</span>(<span class="hljs-string">"../wooyun_keystore"</span>)     <span class="hljs-comment"> //签名文件</span>
            storePassword <span class="hljs-string">"123456"</span>
            keyAlias <span class="hljs-string">"123456"</span>
            keyPassword <span class="hljs-string">"123456"</span> <span class="hljs-comment"> //签名密码</span>
        }
        release{
            storeFile <span class="hljs-built_in">file</span>(<span class="hljs-string">"../wooyun_keystore"</span>)     <span class="hljs-comment"> //签名文件</span>
            storePassword <span class="hljs-string">"123456"</span>
            keyAlias <span class="hljs-string">"123456"</span>
            keyPassword <span class="hljs-string">"123456"</span> <span class="hljs-comment"> //签名密码</span>
        }
    }

    buildTypes {
        release {
            minifyEnabled <span class="hljs-constant">false</span>
            proguardFiles getDefaultProguardFile(<span class="hljs-string">'proguard-android.txt'</span>), <span class="hljs-string">'proguard-rules.pro'</span>
           <span class="hljs-comment"> // 自定义输出配置</span>
            applicationVariants.all { variant -&gt;
                variant.outputs.<span class="hljs-keyword">each</span> { output -&gt;
                    def outputFile = output.outputFile
                    <span class="hljs-keyword">if</span> (outputFile != <span class="hljs-constant">null</span> &amp;&amp; outputFile.name.endsWith(<span class="hljs-string">'.apk'</span>)) {
                       <span class="hljs-comment"> // 输出apk名称为wooyun_v1.0_wandoujia.apk</span>
                        def fileName = <span class="hljs-string">"wooyun_v${defaultConfig.versionName}_${variant.productFlavors[0].name}.apk"</span>
                        output.outputFile = <span class="hljs-built_in">new</span> File(outputFile.parent, fileName)
                    }
                }
            }
        }
    }

    productFlavors {
        kuan {}
        xiaomi {}
        qh360 {}
        baidu {}
        wandoujia {}
    }

    productFlavors.all {
        flavor -&gt; flavor.manifestPlaceholders = [UMENG_CHANNEL_VALUE: name]
    }
}

dependencies {
    compile fileTree(dir: <span class="hljs-string">'libs'</span>, <span class="hljs-built_in">include</span>: [<span class="hljs-string">'*.jar'</span>])
    testCompile <span class="hljs-string">'junit:junit:4.12'</span>
    compile <span class="hljs-string">'com.android.support:appcompat-v7:23.4.0'</span>
}</code></pre> 
<p>       上面的signingConfigs配置中，可以写两个代码块，分别名为debugConfig和releaseConfig，并在其中写好一个完整签名需要的keyAlias、keyPassword、storeFile file、storePassword。 <br>        然后在buildTypes中，分两个代码块，分别是debug时用的，和release时用的。在其中引用刚刚写好的debugConfig和releaseConfig即可。</p> 
<p>       注意：signingConfigs代码块一定要写在buildTypes前面，否则会报下面这种错：</p> 
<pre class="prettyprint"><code class=" hljs livecodeserver">Could <span class="hljs-operator">not</span> find property <span class="hljs-string">'debugConfig'</span> <span class="hljs-command"><span class="hljs-keyword">on</span> <span class="hljs-title">SigningConfig</span> <span class="hljs-title">container</span>.</span></code></pre> 
<p>签名密码写在gradle中不安全，故最好在打包上线的时候将相关代码注释掉。</p> 
<p>参考链接：<a href="http://stormzhang.com/devtools/2015/01/15/android-studio-tutorial6/" rel="nofollow">http://stormzhang.com/devtools/2015/01/15/android-studio-tutorial6/</a></p> 
<p><br></p> 
<p><br></p> 
<p><br></p> 
<blockquote> 
 <p><strong>安卓开发高级技术交流QQ群：<font color="red" size="3">108721298</font> 欢迎入群</strong></p> 
 <p><strong>微信公众号：mobilesafehome</strong></p> 
 <p><font color="red" size="3">（本公众号支持投票）</font></p> 
 <p><img src="https://images2.imgbox.com/44/de/FRm9M5qq_o.jpg" alt="Android安全技术大本营" title=""></p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7cbec9b446b57973050c13b6ecff379c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">power mock 入门介绍及使用示例</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/45a7f230cd690054fbe65ef5da37ab9f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">js判断图片加载完成后获取图片实际宽高</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>