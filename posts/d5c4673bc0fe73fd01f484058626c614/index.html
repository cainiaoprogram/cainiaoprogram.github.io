<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【宝塔下的免费 waf 防火墙对比】 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【宝塔下的免费 waf 防火墙对比】" />
<meta property="og:description" content="最近搭建了一个网站以后，总觉得裸奔的网站非常不安全，需要加上防护措施。加一套 waf 防火墙，然后就可以安心的睡觉了。因为服务器使用了宝塔1管理，所以我需要既能跟宝塔一起用的 waf。
先说结论 宝塔自带 waf 收费；宝塔软件商店里 waf 要么不合适，要么门槛太高，不好用；其它免费 waf 大多要命令行安装，发挥不了宝塔优势。 最好是有一个能在宝塔 docker 上运行的防火墙，既能用宝塔管理服务状态，又能有自己管理界面的 waf，而且要免费，还得有效。所以，我最后选择用 docker compose 模板 &#43; 雷池 waf 社区版。安装方法参考我的另一篇文章 https://www.jianshu.com/p/978e08095628
waf 对比 宝塔内置 waf 既然用宝塔做服务管理，第一反应就是在宝塔上找找没有合适的 waf。在非常显眼的地方，找到了 “防火墙” 入口，然后看到了非常显眼的 “立即购买”。本着来都来了的想法，看了一下官方防火墙的功能介绍2，功能还是非常多的，各位看官有钱的捧个钱场，我只能捧个人场。
另外根据文档介绍，nginx 防火墙是基于 Lua 实现的，也就是说这个防火墙的本质是人工规则，人工规则防火墙在防护能力上可以抵御常见攻击，只能亡羊补牢不能防患未然。宝塔内置 waf 还有一个 Apache 版本3，与 nginx 类似，只是一个基于 Apache 一个基于 Nginx，这两者的差别见仁见智，宝塔官方推荐的是 nginx 版本。
宝塔软件商店中的免费 waf 宝塔自带了一个软件商店，抱着试试看的态度搜了一下，还真找到了 3 款 waf。前两个是官方内置的收费版，第 3 个则是免费版。这一看，不得了啊，这是打算跟官方同台竞技啊。赶紧装上试试。
感谢作者 “民国三年一场雨”，民国三年就是 1914年，一百多年过去了，也不知道雨里发生什么。考虑到这个应用只有 403.95k 大小，总觉得这个功能可能没有想的那么多。
根据配置界面，启用防护，然后试着发起一次攻击请求，然后被拦截了。后台管理界面看到的效果记录是：
拦截效果是：
拦截页面上还有提示，误报请联系宝塔 http://www.bt.cn/bbs？这不是官方 waf 么？为什么非要伪装一下自己？在一个隐蔽角落还找到一个“教程”链接4，发帖人是宝塔技术-小强5，这下是官方的免费 waf 没跑了。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/d5c4673bc0fe73fd01f484058626c614/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-28T18:32:30+08:00" />
<meta property="article:modified_time" content="2023-06-28T18:32:30+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【宝塔下的免费 waf 防火墙对比】</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>最近搭建了一个网站以后，总觉得裸奔的网站非常不安全，需要加上防护措施。加一套 waf 防火墙，然后就可以安心的睡觉了。因为服务器使用了宝塔<sup class="footnote-ref"><a href="#fn1" rel="nofollow" id="fnref1">1</a></sup>管理，所以我需要既能跟宝塔一起用的 waf。</p> 
<h2><a id="_2"></a>先说结论</h2> 
<ol><li>宝塔自带 waf 收费；</li><li>宝塔软件商店里 waf 要么不合适，要么门槛太高，不好用；</li><li>其它免费 waf 大多要命令行安装，发挥不了宝塔优势。</li></ol> 
<p>最好是有一个能在宝塔 docker 上运行的防火墙，既能用宝塔管理服务状态，又能有自己管理界面的 waf，而且要免费，还得有效。所以，我最后选择用 docker compose 模板 + 雷池 waf 社区版。安装方法参考我的另一篇文章 <a href="https://www.jianshu.com/p/978e08095628" rel="nofollow">https://www.jianshu.com/p/978e08095628</a></p> 
<h2><a id="waf__10"></a>waf 对比</h2> 
<h4><a id="_waf_12"></a>宝塔内置 waf</h4> 
<p>既然用宝塔做服务管理，第一反应就是在宝塔上找找没有合适的 waf。在非常显眼的地方，找到了 “防火墙” 入口，然后看到了非常显眼的 “立即购买”。本着来都来了的想法，看了一下官方防火墙的功能介绍<sup class="footnote-ref"><a href="#fn2" rel="nofollow" id="fnref2">2</a></sup>，功能还是非常多的，各位看官有钱的捧个钱场，我只能捧个人场。<br> <img src="https://images2.imgbox.com/0f/42/xTV2wtxu_o.png" alt="image.png"></p> 
<p>另外根据文档介绍，nginx 防火墙是基于 Lua 实现的，也就是说这个防火墙的本质是人工规则，人工规则防火墙在防护能力上可以抵御常见攻击，<strong>只能亡羊补牢不能防患未然</strong>。宝塔内置 waf 还有一个 Apache 版本<sup class="footnote-ref"><a href="#fn3" rel="nofollow" id="fnref3">3</a></sup>，与 nginx 类似，只是一个基于 Apache 一个基于 Nginx，这两者的差别见仁见智，宝塔官方推荐的是 nginx 版本。</p> 
<h4><a id="_waf_19"></a>宝塔软件商店中的免费 waf</h4> 
<p>宝塔自带了一个软件商店，抱着试试看的态度搜了一下，还真找到了 3 款 waf。前两个是官方内置的收费版，第 3 个则是免费版。这一看，不得了啊，这是打算跟官方同台竞技啊。赶紧装上试试。</p> 
<p>感谢作者 “民国三年一场雨”，民国三年就是 1914年，一百多年过去了，也不知道雨里发生什么。考虑到这个应用只有 403.95k 大小，总觉得这个功能可能没有想的那么多。<br> <img src="https://images2.imgbox.com/f8/62/cg6vYKLu_o.png" alt="image.png"></p> 
<p>根据配置界面，启用防护，然后试着发起一次攻击请求，然后被拦截了。后台管理界面看到的效果记录是：<br> <img src="https://images2.imgbox.com/c6/ae/Ftw1eS5P_o.png" alt="image.png"></p> 
<p>拦截效果是：<br> <img src="https://images2.imgbox.com/b2/75/INpmH2SF_o.png" alt="image.png"></p> 
<p>拦截页面上还有提示，误报请联系宝塔 <a href="http://www.bt.cn/bbs%EF%BC%9F%E8%BF%99%E4%B8%8D%E6%98%AF%E5%AE%98%E6%96%B9" rel="nofollow">http://www.bt.cn/bbs？这不是官方</a> waf 么？为什么非要伪装一下自己？在一个隐蔽角落还找到一个“教程”链接<sup class="footnote-ref"><a href="#fn4" rel="nofollow" id="fnref4">4</a></sup>，发帖人是宝塔技术-小强<sup class="footnote-ref"><a href="#fn5" rel="nofollow" id="fnref5">5</a></sup>，这下是官方的免费 waf 没跑了。</p> 
<p>另外我还发现，这个免费防火墙，在软件商店里浏览的时候是找不到的，必须搜索才能搜出来。所以，其实，人家是不希望你继续使用这个 waf 的。并且在使用时，还遇到了其它问题：</p> 
<ul><li><strong>管理界面不好找</strong></li></ul> 
<p>我需要先进应用商店，搜索 waf，然后找到之后，在通过 “设置” 按钮进入。</p> 
<ul><li><strong>防御类型固定</strong></li></ul> 
<p>想要防御什么类型的攻击，都是提前设置好的，只能防御这么多，并且不能新增。</p> 
<ul><li><strong>内置规则太少</strong></li></ul> 
<p>每种防御类型都需要自行配置，虽然有内置规则，但规则不多，并且都是比较常见的规则。<br> <img src="https://images2.imgbox.com/6f/a2/l0W102iv_o.png" alt="image.png"><br> 总体体验下来，有种我防御了，但好像防御不高的感觉。</p> 
<p>而且，这是怎么回事？我宝塔自己的 WordPress 用宝塔自己的防火墙扫描，怎么还扫出 2 个 webshell？这是谁出问题了？<br> <img src="https://images2.imgbox.com/07/ca/PqZVNEc4_o.png" alt="image.png"></p> 
<h4><a id="_waf_53"></a>其它 waf</h4> 
<p>😔很久没更新了：<a href="https://github.com/httpwaf/httpwaf2.0">https://github.com/httpwaf/httpwaf2.0</a></p> 
<p>😔不好塞进宝塔里：<a href="https://github.com/openresty/">https://github.com/openresty/</a></p> 
<p>😔老牌项目了，但是外国产品，用不惯：<a href="https://www.modsecurity.org/" rel="nofollow">https://www.modsecurity.org/</a></p> 
<p>😔这个不错，但是也没法塞进宝塔里：<a href="http://www.goodwaf.cn/" rel="nofollow">http://www.goodwaf.cn/</a></p> 
<p>✅ 巧了，这个原生 docker，刚好兼容宝塔，稍加改造，顺利上线，看看我的 waf 效果图。<a href="https://waf-ce.chaitin.cn/" rel="nofollow">https://waf-ce.chaitin.cn/</a></p> 
<p><img src="https://images2.imgbox.com/60/5a/Y1heTzhZ_o.png" alt="image.png"></p> 
<hr class="footnotes-sep"> 
<section class="footnotes"> 
 <ol class="footnotes-list"><li id="fn1" class="footnote-item"><p><a href="https://www.bt.cn/new/index.html" rel="nofollow">https://www.bt.cn/new/index.html</a> <a href="#fnref1" rel="nofollow" class="footnote-backref">↩︎</a></p> </li><li id="fn2" class="footnote-item"><p><a href="https://www.bt.cn/new/product_nginx_firewall.html" rel="nofollow">https://www.bt.cn/new/product_nginx_firewall.html</a> <a href="#fnref2" rel="nofollow" class="footnote-backref">↩︎</a></p> </li><li id="fn3" class="footnote-item"><p><a href="https://www.bt.cn/new/product/btwaf_httpd.html" rel="nofollow">https://www.bt.cn/new/product/btwaf_httpd.html</a> <a href="#fnref3" rel="nofollow" class="footnote-backref">↩︎</a></p> </li><li id="fn4" class="footnote-item"><p><a href="https://www.bt.cn/bbs/thread-57590-1-1.html" rel="nofollow">https://www.bt.cn/bbs/thread-57590-1-1.html</a> <a href="#fnref4" rel="nofollow" class="footnote-backref">↩︎</a></p> </li><li id="fn5" class="footnote-item"><p><a href="https://www.bt.cn/bbs/home.php?mod=space&amp;uid=34807" rel="nofollow">https://www.bt.cn/bbs/home.php?mod=space&amp;uid=34807</a> <a href="#fnref5" rel="nofollow" class="footnote-backref">↩︎</a></p> </li></ol> 
</section>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5f81325865b78103118ee2e538c968dd/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【博客679】LVS NAT模式与FULLNAT模式原理与配置差别</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9b0c428d22a2152002634ca7fe14619f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">TLS回调函数的两种写法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>