<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>机器学习-11.神经网络 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="机器学习-11.神经网络" />
<meta property="og:description" content="EduCoder：机器学习—神经网络 第1关：什么是神经网络 第2关：神经元与感知机 编程要求：
根据提示，在右侧编辑器补充 python 代码，构建一个感知机模型，底层代码会调用您实现的感知机模型进行训练，并对一个特征值分别为青绿、稍蜷、沉闷（即特征向量为[0,2,2]）的西瓜的好坏进行预测，预测正确则通关。
代码如下：
#encoding=utf8 import numpy as np #构建感知机算法 class Perceptron(object): def __init__(self, learning_rate = 0.01, max_iter = 200): self.lr = learning_rate self.max_iter = max_iter def fit(self, data, label): &#39;&#39;&#39; input:data(ndarray):训练数据特征 label(ndarray):训练数据标签 output:w(ndarray):训练好的权重 b(ndarry):训练好的偏置 &#39;&#39;&#39; #编写感知机训练方法，w为权重，b为偏置 self.w = np.random.randn(data.shape[1]) self.b = np.random.rand(1) #********* Begin *********# for i in range(len(label)): while label[i]*(np.matmul(self.w,data[i])&#43;self.b)&lt;=0: self.w=self.w&#43;self.lr*(label[i]*data[i]) self.b=self.b&#43;self.lr*label[i] #********* End *********# return None def predict(self, data): &#39;&#39;&#39; input:data(ndarray):测试数据特征 &#39;&#39;&#39; #编写感知机预测方法，若是正类返回1，负类返回-1 #********* Begin *********# yc=np." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/ebb21847c7ea481c8e231bd3faa49238/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-08T02:43:45+08:00" />
<meta property="article:modified_time" content="2023-01-08T02:43:45+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">机器学习-11.神经网络</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="EduCoder_4"></a>EduCoder：机器学习—神经网络</h2> 
<h3><a id="1_7"></a>第1关：什么是神经网络</h3> 
<p><img src="https://images2.imgbox.com/92/cf/EwvWVRv2_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2_14"></a>第2关：神经元与感知机</h3> 
<p><strong>编程要求：</strong></p> 
<p>根据提示，在右侧编辑器补充 python 代码，构建一个感知机模型，底层代码会调用您实现的感知机模型进行训练，并对一个特征值分别为青绿、稍蜷、沉闷（即特征向量为[0,2,2]）的西瓜的好坏进行预测，预测正确则通关。</p> 
<p><strong>代码如下：</strong></p> 
<pre><code class="prism language-python"><span class="token comment">#encoding=utf8</span>

<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token comment">#构建感知机算法</span>
<span class="token keyword">class</span> <span class="token class-name">Perceptron</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> learning_rate <span class="token operator">=</span> <span class="token number">0.01</span><span class="token punctuation">,</span> max_iter <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>lr <span class="token operator">=</span> learning_rate
        self<span class="token punctuation">.</span>max_iter <span class="token operator">=</span> max_iter
    <span class="token keyword">def</span> <span class="token function">fit</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data<span class="token punctuation">,</span> label<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">'''
        input:data(ndarray):训练数据特征
              label(ndarray):训练数据标签
        output:w(ndarray):训练好的权重
               b(ndarry):训练好的偏置
        '''</span>
        <span class="token comment">#编写感知机训练方法，w为权重，b为偏置</span>
        self<span class="token punctuation">.</span>w <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randn<span class="token punctuation">(</span>data<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>b <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token comment">#********* Begin *********#</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">while</span> label<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">*</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>self<span class="token punctuation">.</span>w<span class="token punctuation">,</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span>self<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token operator">&lt;=</span><span class="token number">0</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>w<span class="token operator">=</span>self<span class="token punctuation">.</span>w<span class="token operator">+</span>self<span class="token punctuation">.</span>lr<span class="token operator">*</span><span class="token punctuation">(</span>label<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">*</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>b<span class="token operator">=</span>self<span class="token punctuation">.</span>b<span class="token operator">+</span>self<span class="token punctuation">.</span>lr<span class="token operator">*</span>label<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
                
        <span class="token comment">#********* End *********#</span>
        <span class="token keyword">return</span> <span class="token boolean">None</span>
    <span class="token keyword">def</span> <span class="token function">predict</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">'''
        input:data(ndarray):测试数据特征
        '''</span>
        <span class="token comment">#编写感知机预测方法，若是正类返回1，负类返回-1</span>
        <span class="token comment">#********* Begin *********#        </span>
        yc<span class="token operator">=</span>np<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>data<span class="token punctuation">,</span>self<span class="token punctuation">.</span>w<span class="token punctuation">)</span><span class="token operator">+</span>self<span class="token punctuation">.</span>b
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>yc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>yc<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&gt;=</span><span class="token number">0</span><span class="token punctuation">:</span>
                yc<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                yc<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span>
        predict<span class="token operator">=</span>yc
        <span class="token keyword">return</span> predict
        <span class="token comment">#********* End *********#</span>
    
</code></pre> 
<h3><a id="3_67"></a>第3关：激活函数</h3> 
<p><strong>编程要求：</strong></p> 
<p>根据提示，在右侧编辑器补充Python代码，实现relu激活函数，底层代码会调用您实现的relu激活函数来进行测试。<br> <strong>测试说明：</strong></p> 
<p>输入：9</p> 
<p>预期输出：9</p> 
<p>输入：-1</p> 
<p>预期输出：0</p> 
<p><strong>代码如下：</strong></p> 
<pre><code class="prism language-python"><span class="token comment">#encoding=utf8</span>

<span class="token keyword">def</span> <span class="token function">relu</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    input:x(ndarray)输入数据
    '''</span>
    <span class="token comment">#********* Begin *********#</span>
    <span class="token keyword">if</span> x<span class="token operator">&lt;=</span><span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">0</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> x

    <span class="token comment">#********* End *********#</span>
</code></pre> 
<h3><a id="4_98"></a>第4关：反向传播算法</h3> 
<p><strong>编程要求：</strong></p> 
<p>根据提示，在右侧编辑器补充 python 代码，你需要完成神经网络的前向传播、反向传播以及梯度下降部分，然后用训练好的神经网络对鸢尾花进行分类。</p> 
<p><strong>测试说明：</strong></p> 
<p>只需返回预测结果即可，程序内部会检测您的代码，预测正确率高于90%视为过关。</p> 
<p><strong>代码如下：</strong></p> 
<pre><code class="prism language-python"><span class="token comment">#encoding=utf8</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> math <span class="token keyword">import</span> sqrt

<span class="token comment">#bp神经网络训练方法</span>
<span class="token keyword">def</span> <span class="token function">bp_train</span><span class="token punctuation">(</span>feature<span class="token punctuation">,</span>label<span class="token punctuation">,</span>n_hidden<span class="token punctuation">,</span>maxcycle<span class="token punctuation">,</span>alpha<span class="token punctuation">,</span>n_output<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    计算隐含层的输入
    input:feature(mat):特征
          label(mat):标签
          n_hidden(int)隐藏层的节点个数
          maxcycle(int):最大迭代次数
          alpha(float):学习率
          n_output(int):输出层的节点个数
    output:w0(mat):输入层到隐藏层之间的权重
           b0(mat):输入层到隐藏层之间的偏置
           w1(mat):隐藏层到输出层之间的权重
           b1(mat):隐藏层到输出层之间的偏置          
    '''</span>
    m<span class="token punctuation">,</span>n <span class="token operator">=</span> np<span class="token punctuation">.</span>shape<span class="token punctuation">(</span>feature<span class="token punctuation">)</span>
    <span class="token comment">#初始化</span>
    w0 <span class="token operator">=</span> np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>rand<span class="token punctuation">(</span>n<span class="token punctuation">,</span>n_hidden<span class="token punctuation">)</span><span class="token punctuation">)</span>
    w0 <span class="token operator">=</span> w0<span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token operator">*</span>sqrt<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">/</span>sqrt<span class="token punctuation">(</span>n<span class="token operator">+</span>n_hidden<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span>\
         np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span>np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span>n_hidden<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">*</span>\
         <span class="token punctuation">(</span><span class="token number">4.0</span><span class="token operator">*</span>sqrt<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">/</span>sqrt<span class="token punctuation">(</span>n<span class="token operator">+</span>n_hidden<span class="token punctuation">)</span><span class="token punctuation">)</span>
    b0 <span class="token operator">=</span> np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>n_hidden<span class="token punctuation">)</span><span class="token punctuation">)</span>
    b0 <span class="token operator">=</span> b0<span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token operator">*</span>sqrt<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">/</span>sqrt<span class="token punctuation">(</span>n<span class="token operator">+</span>n_hidden<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span>\
         np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span>np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>n_hidden<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">*</span>\
         <span class="token punctuation">(</span><span class="token number">4.0</span><span class="token operator">*</span>sqrt<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">/</span>sqrt<span class="token punctuation">(</span>n<span class="token operator">+</span>n_hidden<span class="token punctuation">)</span><span class="token punctuation">)</span>
    w1 <span class="token operator">=</span> np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>rand<span class="token punctuation">(</span>n_hidden<span class="token punctuation">,</span>n_output<span class="token punctuation">)</span><span class="token punctuation">)</span>
    w1 <span class="token operator">=</span> w1<span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token operator">*</span>sqrt<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">/</span>sqrt<span class="token punctuation">(</span>n_hidden<span class="token operator">+</span>n_output<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span>\
         np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span>np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span>n_hidden<span class="token punctuation">,</span>n_output<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">*</span>\
         <span class="token punctuation">(</span><span class="token number">4.0</span><span class="token operator">*</span>sqrt<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">/</span>sqrt<span class="token punctuation">(</span>n_hidden<span class="token operator">+</span>n_output<span class="token punctuation">)</span><span class="token punctuation">)</span>
    b1 <span class="token operator">=</span> np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>n_output<span class="token punctuation">)</span><span class="token punctuation">)</span>
    b1 <span class="token operator">=</span> b1<span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token operator">*</span>sqrt<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">/</span>sqrt<span class="token punctuation">(</span>n_hidden<span class="token operator">+</span>n_output<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span>\
         np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span>np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>n_output<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">*</span>\
         <span class="token punctuation">(</span><span class="token number">4.0</span><span class="token operator">*</span>sqrt<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">/</span>sqrt<span class="token punctuation">(</span>n_hidden<span class="token operator">+</span>n_output<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment">#训练</span>
    i <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">while</span> i <span class="token operator">&lt;=</span> maxcycle<span class="token punctuation">:</span>
        <span class="token comment">#********* Begin *********# </span>
        <span class="token comment">#前向传播</span>
        <span class="token comment">#计算隐藏层的输入</span>
        hidden_input<span class="token operator">=</span>hidden_in<span class="token punctuation">(</span>feature<span class="token punctuation">,</span>w0<span class="token punctuation">,</span>b0<span class="token punctuation">)</span>
        <span class="token comment">#计算隐藏层的输出</span>
        hidden_output<span class="token operator">=</span>hidden_out<span class="token punctuation">(</span>hidden_input<span class="token punctuation">)</span>
        <span class="token comment">#计算输出层的输入</span>
        output_in<span class="token operator">=</span>predict_in<span class="token punctuation">(</span>hidden_output<span class="token punctuation">,</span>w1<span class="token punctuation">,</span>b1<span class="token punctuation">)</span>
        <span class="token comment">#计算输出层的输出</span>
        output_out<span class="token operator">=</span>predict_out<span class="token punctuation">(</span>output_in<span class="token punctuation">)</span>
        <span class="token comment">#反向传播</span>
        <span class="token comment">#隐藏层到输出层之间的残差</span>
        delta_output<span class="token operator">=</span><span class="token operator">-</span>np<span class="token punctuation">.</span>multiply<span class="token punctuation">(</span><span class="token punctuation">(</span>label<span class="token operator">-</span>output_out<span class="token punctuation">)</span><span class="token punctuation">,</span>partial_sig<span class="token punctuation">(</span>output_in<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment">#输入层到隐藏层之间的残差</span>
        delta_hidden<span class="token operator">=</span>np<span class="token punctuation">.</span>multiply<span class="token punctuation">(</span><span class="token punctuation">(</span>delta_output<span class="token operator">*</span>w1<span class="token punctuation">.</span>T<span class="token punctuation">)</span><span class="token punctuation">,</span>partial_sig<span class="token punctuation">(</span>hidden_input<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment">#更新权重与偏置</span>
        w1<span class="token operator">=</span>w1<span class="token operator">-</span>alpha<span class="token operator">*</span><span class="token punctuation">(</span>hidden_output<span class="token punctuation">.</span>T<span class="token operator">*</span>delta_output<span class="token punctuation">)</span>
        b1<span class="token operator">=</span>b1<span class="token operator">-</span>alpha<span class="token operator">*</span>np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>delta_output<span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token operator">/</span>m<span class="token punctuation">)</span>
        w0<span class="token operator">=</span>w0<span class="token operator">-</span>alpha<span class="token operator">*</span><span class="token punctuation">(</span>feature<span class="token punctuation">.</span>T<span class="token operator">*</span>delta_hidden<span class="token punctuation">)</span>
        b0<span class="token operator">=</span>b0<span class="token operator">-</span>alpha<span class="token operator">*</span>np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>delta_hidden<span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token operator">/</span>m<span class="token punctuation">)</span>
        <span class="token comment">#********* End *********#</span>
        i <span class="token operator">+=</span><span class="token number">1</span>
    <span class="token keyword">return</span> w0<span class="token punctuation">,</span>w1<span class="token punctuation">,</span>b0<span class="token punctuation">,</span>b1

<span class="token comment">#计算隐藏层的输入函数    </span>
<span class="token keyword">def</span> <span class="token function">hidden_in</span><span class="token punctuation">(</span>feature<span class="token punctuation">,</span>w0<span class="token punctuation">,</span>b0<span class="token punctuation">)</span><span class="token punctuation">:</span>
    m <span class="token operator">=</span> np<span class="token punctuation">.</span>shape<span class="token punctuation">(</span>feature<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    hidden_in <span class="token operator">=</span> feature<span class="token operator">*</span>w0
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">:</span>
        hidden_in<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token punctuation">]</span> <span class="token operator">+=</span> b0
    <span class="token keyword">return</span> hidden_in

<span class="token comment">#计算隐藏层的输出函数</span>
<span class="token keyword">def</span> <span class="token function">hidden_out</span><span class="token punctuation">(</span>hidden_in<span class="token punctuation">)</span><span class="token punctuation">:</span>
    hidden_output <span class="token operator">=</span> sig<span class="token punctuation">(</span>hidden_in<span class="token punctuation">)</span>
    <span class="token keyword">return</span> hidden_output
    
<span class="token comment">#计算输出层的输入函数</span>
<span class="token keyword">def</span> <span class="token function">predict_in</span><span class="token punctuation">(</span>hidden_out<span class="token punctuation">,</span>w1<span class="token punctuation">,</span>b1<span class="token punctuation">)</span><span class="token punctuation">:</span>
    m <span class="token operator">=</span> np<span class="token punctuation">.</span>shape<span class="token punctuation">(</span>hidden_out<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    predict_in <span class="token operator">=</span> hidden_out<span class="token operator">*</span>w1
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">:</span>
        predict_in<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token punctuation">]</span> <span class="token operator">+=</span>b1
    <span class="token keyword">return</span> predict_in

<span class="token comment">#计算输出层的输出的函数</span>
<span class="token keyword">def</span> <span class="token function">predict_out</span><span class="token punctuation">(</span>predict_in<span class="token punctuation">)</span><span class="token punctuation">:</span>
    result <span class="token operator">=</span> sig<span class="token punctuation">(</span>predict_in<span class="token punctuation">)</span>
    <span class="token keyword">return</span> result

<span class="token comment">#sigmoid函数</span>
<span class="token keyword">def</span> <span class="token function">sig</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token number">1.0</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span>np<span class="token punctuation">.</span>exp<span class="token punctuation">(</span><span class="token operator">-</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">#计算sigmoid函数偏导</span>
<span class="token keyword">def</span> <span class="token function">partial_sig</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    m<span class="token punctuation">,</span>n <span class="token operator">=</span> np<span class="token punctuation">.</span>shape<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    out <span class="token operator">=</span> np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span>np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
            out<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> sig<span class="token punctuation">(</span>x<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span>sig<span class="token punctuation">(</span>x<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> out
        
</code></pre> 
<h3><a id="5Dropout_215"></a>第5关：Dropout</h3> 
<p><strong>编程要求：</strong></p> 
<p>根据提示，在右侧编辑器补充Python代码，实现Dropout方法，底层代码会调用您实现的Dropout方法来进行测试。</p> 
<p><strong>测试说明：</strong></p> 
<p>输入：<code>[0,1,2,3,4,5,6,7,8,9]</code></p> 
<p>预期输出：<code>[0 0 0 3 0 0 6 7 0 9]</code></p> 
<p>输入：<code>[10,11,12,13,14,15,16,17,18,19]</code></p> 
<p>预期输出：<code>[11 0 0 14 0 0 17 18 0 20]</code></p> 
<p><strong>代码如下：</strong></p> 
<pre><code class="prism language-python"><span class="token comment">#encoding=utf8</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

<span class="token comment">#由于Dropout方法输出存在随机性，我们已经设置好随机种子，你只需要完成Dropout方法就行。</span>
<span class="token keyword">class</span> <span class="token class-name">Dropout</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>dropout_ratio<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>dropout_ratio <span class="token operator">=</span> dropout_ratio
        self<span class="token punctuation">.</span>mask <span class="token operator">=</span> <span class="token boolean">None</span>
    
    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>x<span class="token punctuation">,</span>train_flg<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">'''
        前向传播中self.mask会随机生成和x形状相同的数组，
        并将值比dropout_ratio大的元素设为True，
        x为一个列表。  
        '''</span>
        <span class="token comment">#********* Begin *********#</span>
        <span class="token keyword">if</span> train_flg<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>mask<span class="token operator">=</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token operator">*</span>x<span class="token punctuation">.</span>shape<span class="token punctuation">)</span><span class="token operator">&gt;</span>self<span class="token punctuation">.</span>dropout_ratio
            <span class="token keyword">return</span> x<span class="token operator">*</span>self<span class="token punctuation">.</span>mask
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> x<span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token operator">-</span>self<span class="token punctuation">.</span>dropout_ratio<span class="token punctuation">)</span>
        <span class="token comment">#********* End *********#</span>

    <span class="token keyword">def</span> <span class="token function">backward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>dout<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">'''
        前向传播时传递了信号的神经元，
        反向传播时按原样传递信号。
        前向传播没有传递信号的神经元，
        反向传播时信号就停在那里。
        dout为一个列表。 
        '''</span>
        <span class="token comment">#********* Begin *********#</span>
        <span class="token keyword">return</span> dout<span class="token operator">*</span>self<span class="token punctuation">.</span>mask
        <span class="token comment">#********* End *********#</span>

</code></pre> 
<h3><a id="6sklearn_270"></a>第6关：sklearn中的神经网络</h3> 
<p><strong>编程要求：</strong></p> 
<p>填写iris_predict(train_sample, train_label, test_sample)函数完成鸢尾花分类任务，其中：</p> 
<ul><li>train_sample：训练样本</li><li>train_label：训练标签</li><li>test_sample：测试样本</li></ul> 
<p><strong>测试说明：</strong></p> 
<p>只需返回预测结果即可，程序内部会检测您的代码，预测正确率高于95%视为过关。</p> 
<p><strong>代码如下：</strong></p> 
<pre><code class="prism language-python"><span class="token comment">#encoding=utf8</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>neural_network <span class="token keyword">import</span> MLPClassifier

<span class="token keyword">def</span> <span class="token function">iris_predict</span><span class="token punctuation">(</span>train_sample<span class="token punctuation">,</span> train_label<span class="token punctuation">,</span> test_sample<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    实现功能：1.训练模型 2.预测
    :param train_sample: 包含多条训练样本的样本集，类型为ndarray
    :param train_label: 包含多条训练样本标签的标签集，类型为ndarray
    :param test_sample: 包含多条测试样本的测试集，类型为ndarry
    :return: test_sample对应的预测标签
    '''</span>
    
    <span class="token comment">#********* Begin *********#</span>
    
    tree_clf<span class="token operator">=</span>MLPClassifier<span class="token punctuation">(</span>solver<span class="token operator">=</span><span class="token string">'lbfgs'</span><span class="token punctuation">,</span>alpha<span class="token operator">=</span><span class="token number">1e-5</span><span class="token punctuation">,</span>random_state<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
    trre_clf<span class="token operator">=</span>tree_clf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_sample<span class="token punctuation">,</span>train_label<span class="token punctuation">)</span>
    y_pred<span class="token operator">=</span>tree_clf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>test_sample<span class="token punctuation">)</span>
    <span class="token keyword">return</span> y_pred
    
    <span class="token comment">#********* End *********#</span>
    
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/bbee4616917b039f7b12121dcc247781/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">机器学习-8.线性回归</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ae8c97dce239dbb53f998773997579d1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">sqli-labs 第七关 多命通关攻略</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>