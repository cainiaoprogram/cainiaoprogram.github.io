<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>java实现定时备份数据库sql文件，并且通过FTP协议向远程机器发送sql文件 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="java实现定时备份数据库sql文件，并且通过FTP协议向远程机器发送sql文件" />
<meta property="og:description" content="1.数据库备份的类 package com.dbtool; import java.io.*; import java.text.SimpleDateFormat; import java.util.Date; import java.util.TimerTask; /** * 实现数据表的备份 * @author whh * */ public class DataBaseTool{ // 读取配置文件中的信息 // MySql的安装bin目录路径和dump等参数 static String sqlurl = GetProperties.getSqlurl(); // 保存备份文件的路径及名称 static String path = GetProperties.getPath(); static String sqlNum = null; public DataBaseTool() throws IOException { backup(); // 备份数据库 } public static void backup() { try { // 返回与当前的Java应用程序的运行时对象 Runtime rt = Runtime.getRuntime(); // 调用 调用mysql的安装目录的命令 Process child = rt." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/03abe92b50e9562bb85e203e9746ba88/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-03-15T18:14:55+08:00" />
<meta property="article:modified_time" content="2020-03-15T18:14:55+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">java实现定时备份数据库sql文件，并且通过FTP协议向远程机器发送sql文件</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="1_0"></a>1.数据库备份的类</h3> 
<pre><code class="prism language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>dbtool<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>text<span class="token punctuation">.</span>SimpleDateFormat<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Date<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>TimerTask<span class="token punctuation">;</span>
<span class="token comment">/**
 * 实现数据表的备份
 * @author whh
 *
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DataBaseTool</span><span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 读取配置文件中的信息</span>
	<span class="token comment">// MySql的安装bin目录路径和dump等参数</span>
	<span class="token keyword">static</span> String sqlurl <span class="token operator">=</span> GetProperties<span class="token punctuation">.</span><span class="token function">getSqlurl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 保存备份文件的路径及名称</span>
	<span class="token keyword">static</span> String path <span class="token operator">=</span> GetProperties<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">static</span> String sqlNum <span class="token operator">=</span> null<span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token function">DataBaseTool</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{<!-- --></span>
		<span class="token function">backup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 备份数据库</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">backup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 返回与当前的Java应用程序的运行时对象</span>
			Runtime rt <span class="token operator">=</span> Runtime<span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 调用 调用mysql的安装目录的命令</span>
			Process child <span class="token operator">=</span> rt<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>sqlurl<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 设置导出编码为utf-8。这里必须是utf-8</span>
			<span class="token comment">// 把进程执行中的控制台输出信息写入.sql文件，即生成了备份文件。注：如果不对控制台信息进行读出，则会导致进程堵塞无法运行</span>
			InputStream in <span class="token operator">=</span> child<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 控制台的输出信息作为输入流</span>
			InputStreamReader xx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>in<span class="token punctuation">,</span> <span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 设置输出流编码为utf-8。这里必须是utf-8，否则从流中读入的是乱码</span>
			String inStr<span class="token punctuation">;</span>
			StringBuffer sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			String outStr<span class="token punctuation">;</span>
			<span class="token comment">// 组合控制台输出信息字符串</span>
			BufferedReader br <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span>xx<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>inStr <span class="token operator">=</span> br<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>inStr <span class="token operator">+</span> <span class="token string">"\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			outStr <span class="token operator">=</span> sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 要用来做导入用的sql目标文件：</span>
			Date date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			SimpleDateFormat f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 注意:sqlNum为一个自定义工具类中的static类型的Date变量,自己设置即可</span>
			sqlNum <span class="token operator">=</span> f<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>
			path <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">"-"</span> <span class="token operator">+</span> sqlNum <span class="token operator">+</span> <span class="token string">".sql"</span><span class="token punctuation">;</span>
			FileOutputStream fout <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
			OutputStreamWriter writer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OutputStreamWriter</span><span class="token punctuation">(</span>fout<span class="token punctuation">,</span> <span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>outStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
			writer<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			in<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			xx<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			br<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			writer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			fout<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"备份数据库成功!  "</span><span class="token operator">+</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="2sqlsql_66"></a>2.设置两个任务（sql备份任务和sql文件发送任务）</h3> 
<pre><code class="prism language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>dbtool<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>File<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>IOException<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>TimerTask<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>log4j<span class="token punctuation">.</span>Logger<span class="token punctuation">;</span>
<span class="token keyword">import</span> com<span class="token punctuation">.</span>ftputil<span class="token punctuation">.</span>ftpUtil<span class="token punctuation">;</span>
<span class="token keyword">import</span> it<span class="token punctuation">.</span>sauronsoftware<span class="token punctuation">.</span>ftp4j<span class="token punctuation">.</span>FTPAbortedException<span class="token punctuation">;</span>
<span class="token keyword">import</span> it<span class="token punctuation">.</span>sauronsoftware<span class="token punctuation">.</span>ftp4j<span class="token punctuation">.</span>FTPDataTransferException<span class="token punctuation">;</span>
<span class="token keyword">import</span> it<span class="token punctuation">.</span>sauronsoftware<span class="token punctuation">.</span>ftp4j<span class="token punctuation">.</span>FTPException<span class="token punctuation">;</span>
<span class="token keyword">import</span> it<span class="token punctuation">.</span>sauronsoftware<span class="token punctuation">.</span>ftp4j<span class="token punctuation">.</span>FTPIllegalReplyException<span class="token punctuation">;</span>
<span class="token comment">/**
 * 设置两个任务
 * 		1 定时备份
 * 		2 定时向ftp服务器发送文件
 * @author whh
 *
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OperationTimer</span> <span class="token keyword">extends</span> <span class="token class-name">TimerTask</span><span class="token punctuation">{<!-- --></span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">//实现数据库表的备份</span>
			<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">new</span> <span class="token class-name">DataBaseTool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
				Thread<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token comment">//连接ftp服务器发送文件夹</span>
				<span class="token keyword">new</span> <span class="token class-name">ftpUtil</span><span class="token punctuation">(</span><span class="token string">"ip"</span><span class="token punctuation">,</span> <span class="token string">"21"</span><span class="token punctuation">,</span> <span class="token string">"用户名"</span><span class="token punctuation">,</span> <span class="token string">"密码"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"D://任务//"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="3_104"></a>3.定时启动任务</h3> 
<pre><code class="prism language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>dbtool<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token comment">/**
 * 任务定时
 * @author whh
 *
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TimerManager</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">//读取配置文件获取间隔时间</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> PERIOD_DAY <span class="token operator">=</span> GetProperties<span class="token punctuation">.</span><span class="token function">getDistancetime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//构造函数进行</span>
    <span class="token keyword">public</span> <span class="token function">TimerManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//获取并处理配置文件中的时间</span>
        String backuptime<span class="token operator">=</span>GetProperties<span class="token punctuation">.</span><span class="token function">getBackuptime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        String<span class="token punctuation">[</span><span class="token punctuation">]</span> time<span class="token operator">=</span>backuptime<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> hour <span class="token operator">=</span> Integer<span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>time<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">int</span> minute <span class="token operator">=</span> Integer<span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>time<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">int</span> second <span class="token operator">=</span> Integer<span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>time<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//调用util包中的日历,设置时间</span>
        Calendar calendar <span class="token operator">=</span> Calendar<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        calendar<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>Calendar<span class="token punctuation">.</span>HOUR_OF_DAY<span class="token punctuation">,</span>hour<span class="token punctuation">)</span><span class="token punctuation">;</span>
        calendar<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>Calendar<span class="token punctuation">.</span>MINUTE<span class="token punctuation">,</span> minute<span class="token punctuation">)</span><span class="token punctuation">;</span>
        calendar<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>Calendar<span class="token punctuation">.</span>SECOND<span class="token punctuation">,</span> second<span class="token punctuation">)</span><span class="token punctuation">;</span>

        Date date<span class="token operator">=</span>calendar<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//第一次执行定时任务的时间</span>

        <span class="token comment">//如果第一次执行定时任务的时间 小于 当前的时间</span>
        <span class="token comment">//此时要在 第一次执行定时任务的时间 加一天，以便此任务在下个时间点执行。如果不加一天，任务会立即执行。</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>date<span class="token punctuation">.</span><span class="token function">before</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            date <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addDay</span><span class="token punctuation">(</span>date<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//启动定时器控件</span>
        Timer timer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//安排指定的任务在指定的时间开始进行重复的固定延迟执行。</span>
        timer<span class="token punctuation">.</span><span class="token function">schedule</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">OperationTimer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>date<span class="token punctuation">,</span>PERIOD_DAY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
    <span class="token punctuation">}</span>

    <span class="token comment">// 增加或减少天数</span>
    <span class="token keyword">public</span> Date <span class="token function">addDay</span><span class="token punctuation">(</span>Date date<span class="token punctuation">,</span> <span class="token keyword">int</span> num<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        Calendar startDT <span class="token operator">=</span> Calendar<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        startDT<span class="token punctuation">.</span><span class="token function">setTime</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>
        startDT<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>Calendar<span class="token punctuation">.</span>DAY_OF_MONTH<span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> startDT<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<h3><a id="3_158"></a>3.配置文件读取类</h3> 
<pre><code class="prism language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>dbtool<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Properties<span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span>  <span class="token keyword">class</span> <span class="token class-name">GetProperties</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">private</span> <span class="token keyword">static</span>  String sqlurl <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span>  String path <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">long</span> distancetime <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span>  String backuptime <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>

    <span class="token keyword">static</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">/**通过这个方法只能读取类路径下的properties文件*/</span>
        Properties properties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 使用ClassLoader加载properties配置文件生成对应的输入流</span>
        InputStream in <span class="token operator">=</span> GetProperties<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span><span class="token string">"backup.properties"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 使用properties对象加载输入流</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            properties<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//获取key对应的value值</span>
        sqlurl <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"sqlurl"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        path <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"path"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        distancetime <span class="token operator">=</span> Long<span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>properties<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"distancetime"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        backuptime <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"backuptime"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> String <span class="token function">getSqlurl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> sqlurl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">setSqlurl</span><span class="token punctuation">(</span>String sqlurl<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        GetProperties<span class="token punctuation">.</span>sqlurl <span class="token operator">=</span> sqlurl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> String <span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> path<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">setPath</span><span class="token punctuation">(</span>String path<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        GetProperties<span class="token punctuation">.</span>path <span class="token operator">=</span> path<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">long</span> <span class="token function">getDistancetime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> distancetime<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">setDistancetime</span><span class="token punctuation">(</span><span class="token keyword">long</span> distancetime<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        GetProperties<span class="token punctuation">.</span>distancetime <span class="token operator">=</span> distancetime<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> String <span class="token function">getBackuptime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> backuptime<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">setBackuptime</span><span class="token punctuation">(</span>String backuptime<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        GetProperties<span class="token punctuation">.</span>backuptime <span class="token operator">=</span> backuptime<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="4_220"></a>4.配置文件</h3> 
<h4><a id="41backupproperties_221"></a>4.1backup.properties</h4> 
<pre><code class="prism language-sql"><span class="token comment">###mysql备份功能路径和数据库用户名密码###</span>
sqlurl <span class="token operator">=</span> C:<span class="token operator">/</span>Program Files <span class="token punctuation">(</span>x86<span class="token punctuation">)</span><span class="token operator">/</span>MySQL<span class="token operator">/</span>MySQL Server <span class="token number">5.5</span><span class="token operator">/</span>bin<span class="token operator">/</span>mysqldump <span class="token operator">-</span>uroot <span class="token operator">-</span>p123 mydb tb_item 
<span class="token comment">###备份的sql路径，必须手动在指定盘符下创建LeaveDatabase目录###  </span>
path <span class="token operator">=</span> D:<span class="token operator">/</span>LeaveDatabase<span class="token operator">/</span>tb<span class="token operator">-</span><span class="token punctuation">.</span><span class="token keyword">sql</span>
<span class="token comment">###备份的时间间隔24*60*60*1000=86400000一天###</span>
distancetime <span class="token operator">=</span> <span class="token number">86400000</span>
<span class="token comment">###每天启动备份的时间###</span>
backuptime <span class="token operator">=</span> <span class="token number">12</span>:<span class="token number">00</span>:<span class="token number">00</span>
</code></pre> 
<h4><a id="42_log4jproperties_232"></a>4.2 log4j.properties（日志配置文件）</h4> 
<pre><code class="prism language-sql"> <span class="token comment">###设置日志级别###</span>
log4j<span class="token punctuation">.</span>rootLogger <span class="token operator">=</span> debug<span class="token punctuation">,</span>stdout<span class="token punctuation">,</span>D<span class="token punctuation">,</span>E

<span class="token comment">###输出信息到控制台###</span>
log4j<span class="token punctuation">.</span>appender<span class="token punctuation">.</span>stdout <span class="token operator">=</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>log4j<span class="token punctuation">.</span>ConsoleAppender
log4j<span class="token punctuation">.</span>appender<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>Target <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token keyword">out</span>
log4j<span class="token punctuation">.</span>appender<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>layout <span class="token operator">=</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>log4j<span class="token punctuation">.</span>PatternLayout
log4j<span class="token punctuation">.</span>appender<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>ConversionPattern <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">%</span><span class="token operator">-</span><span class="token number">5</span>p<span class="token punctuation">]</span> <span class="token operator">%</span>d{yyyy<span class="token operator">-</span>MM<span class="token operator">-</span>dd HH:mm:ss<span class="token punctuation">,</span>SSS} method:<span class="token operator">%</span>l<span class="token operator">%</span>n<span class="token operator">%</span>m<span class="token operator">%</span>n

<span class="token comment">###输出DEBUG级别的日志到  D://logs/error.log ###</span>
log4j<span class="token punctuation">.</span>appender<span class="token punctuation">.</span>D <span class="token operator">=</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>log4j<span class="token punctuation">.</span>DailyRollingFileAppender
log4j<span class="token punctuation">.</span>appender<span class="token punctuation">.</span>D<span class="token punctuation">.</span><span class="token keyword">File</span> <span class="token operator">=</span> D:<span class="token comment">//logs/log.log</span>
log4j<span class="token punctuation">.</span>appender<span class="token punctuation">.</span>D<span class="token punctuation">.</span>Append <span class="token operator">=</span> <span class="token boolean">true</span>
log4j<span class="token punctuation">.</span>appender<span class="token punctuation">.</span>D<span class="token punctuation">.</span>Threshold <span class="token operator">=</span> DEBUG 
log4j<span class="token punctuation">.</span>appender<span class="token punctuation">.</span>D<span class="token punctuation">.</span>layout <span class="token operator">=</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>log4j<span class="token punctuation">.</span>PatternLayout
log4j<span class="token punctuation">.</span>appender<span class="token punctuation">.</span>D<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>ConversionPattern <span class="token operator">=</span> <span class="token operator">%</span><span class="token operator">-</span>d{yyyy<span class="token operator">-</span>MM<span class="token operator">-</span>dd HH:mm:ss}  <span class="token punctuation">[</span> <span class="token operator">%</span>t:<span class="token operator">%</span>r <span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token punctuation">[</span> <span class="token operator">%</span>p <span class="token punctuation">]</span>  <span class="token operator">%</span>m<span class="token operator">%</span>n

<span class="token comment">###输出ERROR级别的日志到  D://logs/error.log ###</span>
log4j<span class="token punctuation">.</span>appender<span class="token punctuation">.</span>E <span class="token operator">=</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>log4j<span class="token punctuation">.</span>DailyRollingFileAppender
log4j<span class="token punctuation">.</span>appender<span class="token punctuation">.</span>E<span class="token punctuation">.</span><span class="token keyword">File</span> <span class="token operator">=</span>D:<span class="token comment">//logs/error.log </span>
log4j<span class="token punctuation">.</span>appender<span class="token punctuation">.</span>E<span class="token punctuation">.</span>Append <span class="token operator">=</span> <span class="token boolean">true</span>
log4j<span class="token punctuation">.</span>appender<span class="token punctuation">.</span>E<span class="token punctuation">.</span>Threshold <span class="token operator">=</span> ERROR 
log4j<span class="token punctuation">.</span>appender<span class="token punctuation">.</span>E<span class="token punctuation">.</span>layout <span class="token operator">=</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>log4j<span class="token punctuation">.</span>PatternLayout
log4j<span class="token punctuation">.</span>appender<span class="token punctuation">.</span>E<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>ConversionPattern <span class="token operator">=</span> <span class="token operator">%</span><span class="token operator">-</span>d{yyyy<span class="token operator">-</span>MM<span class="token operator">-</span>dd HH:mm:ss}  <span class="token punctuation">[</span> <span class="token operator">%</span>t:<span class="token operator">%</span>r <span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token punctuation">[</span> <span class="token operator">%</span>p <span class="token punctuation">]</span>  <span class="token operator">%</span>m<span class="token operator">%</span>n
</code></pre> 
<h3><a id="5_FTP_260"></a>5 FTP文件上传类</h3> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ftpUtil</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> Logger logger <span class="token operator">=</span> Logger<span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span>ftpUtil<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> FTPClient client<span class="token punctuation">;</span>
    <span class="token keyword">private</span> String ROOT_PATH <span class="token operator">=</span> <span class="token string">"content"</span><span class="token punctuation">;</span><span class="token comment">// FTP服务器根目录的目录名</span>
    String host<span class="token operator">=</span>null<span class="token punctuation">;</span>
    String port<span class="token operator">=</span>null<span class="token punctuation">;</span>
    String username<span class="token operator">=</span>null<span class="token punctuation">;</span>
    String password<span class="token operator">=</span>null<span class="token punctuation">;</span>
    File dir<span class="token operator">=</span>null<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token function">ftpUtil</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> IllegalStateException<span class="token punctuation">,</span> IOException<span class="token punctuation">,</span> FTPIllegalReplyException<span class="token punctuation">,</span> FTPException<span class="token punctuation">,</span> FTPDataTransferException<span class="token punctuation">,</span> FTPAbortedException <span class="token punctuation">{<!-- --></span>
   
    <span class="token punctuation">}</span>
    <span class="token comment">/**
     * 
     * @param host    	ftp服务器ip
     * @param port    	端口号
     * @param username	登陆名 
     * @param password	密码
     * @param dir		上传的本地文件夹
     * @throws IllegalStateException
     * @throws IOException
     * @throws FTPIllegalReplyException
     * @throws FTPException
     * @throws FTPDataTransferException
     * @throws FTPAbortedException
     */</span>
    <span class="token keyword">public</span> <span class="token function">ftpUtil</span><span class="token punctuation">(</span>String host<span class="token punctuation">,</span> String port<span class="token punctuation">,</span> String username<span class="token punctuation">,</span> String password<span class="token punctuation">,</span> File dir<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>host <span class="token operator">=</span> host<span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>port <span class="token operator">=</span> port<span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>username <span class="token operator">=</span> username<span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>password <span class="token operator">=</span> password<span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>dir <span class="token operator">=</span> dir<span class="token punctuation">;</span>
		<span class="token comment">//初始化客户端实现登陆</span>
		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			<span class="token function">initClient</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IllegalStateException</span> <span class="token operator">|</span> IOException <span class="token operator">|</span> FTPIllegalReplyException <span class="token operator">|</span> FTPException e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
			e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">//上传文件夹</span>
		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			<span class="token function">uploadDirectory</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IllegalStateException</span> <span class="token operator">|</span> IOException <span class="token operator">|</span> FTPIllegalReplyException <span class="token operator">|</span> FTPException
				<span class="token operator">|</span> FTPDataTransferException <span class="token operator">|</span> FTPAbortedException e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
			e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">//断开连接</span>
		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			<span class="token function">disConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"退出登陆"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IllegalStateException</span> <span class="token operator">|</span> IOException <span class="token operator">|</span> FTPIllegalReplyException <span class="token operator">|</span> FTPException e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
			e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		
	<span class="token punctuation">}</span>

	<span class="token comment">/**
     * 初使化客户端
     * 
     * @param host
     * @param port
     * @param username
     * @param password
     * @throws IllegalStateException
     * @throws IOException
     * @throws FTPIllegalReplyException
     * @throws FTPException
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initClient</span><span class="token punctuation">(</span>String host<span class="token punctuation">,</span> String port<span class="token punctuation">,</span> String username<span class="token punctuation">,</span>
            String password<span class="token punctuation">)</span> <span class="token keyword">throws</span> IllegalStateException<span class="token punctuation">,</span> IOException<span class="token punctuation">,</span> FTPIllegalReplyException<span class="token punctuation">,</span> FTPException <span class="token punctuation">{<!-- --></span>
        client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FTPClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&gt;&gt;&gt;&gt;&gt;start connect......."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			client<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> Integer<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NumberFormatException</span> <span class="token operator">|</span> IllegalStateException <span class="token operator">|</span> IOException <span class="token operator">|</span> FTPIllegalReplyException
				<span class="token operator">|</span> FTPException e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
			e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&gt;&gt;&gt;&gt;&gt;connect success......."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&gt;&gt;&gt;&gt;&gt;start login ......."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			client<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IllegalStateException</span> <span class="token operator">|</span> IOException <span class="token operator">|</span> FTPIllegalReplyException <span class="token operator">|</span> FTPException e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
			e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&gt;&gt;&gt;&gt;&gt;login success......."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&gt;&gt;&gt;&gt;&gt;current directory is.....["</span>
                <span class="token operator">+</span> client<span class="token punctuation">.</span><span class="token function">currentDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setRootPath</span><span class="token punctuation">(</span>String rootPath<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ROOT_PATH <span class="token operator">=</span> rootPath<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token comment">/**
     * 客户端初使化
     * 
     * @throws FTPException
     * @throws FTPIllegalReplyException
     * @throws IOException
     * @throws IllegalStateException
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> IllegalStateException<span class="token punctuation">,</span> IOException<span class="token punctuation">,</span>
            FTPIllegalReplyException<span class="token punctuation">,</span> FTPException <span class="token punctuation">{<!-- --></span>
        client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FTPClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&gt;&gt;&gt;&gt;&gt;start connect......."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        client<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&gt;&gt;&gt;&gt;&gt;connect success......."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&gt;&gt;&gt;&gt;&gt;start login ......."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        client<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token string">"ISUR"</span><span class="token punctuation">,</span> <span class="token string">"123"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&gt;&gt;&gt;&gt;&gt;login success......."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&gt;&gt;&gt;&gt;&gt;current directory is.....["</span>
                <span class="token operator">+</span> client<span class="token punctuation">.</span><span class="token function">currentDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token comment">/**
     * 上传整个目录
     * 
     * @param dir
     * @throws IOException
     * @throws FTPException
     * @throws FTPIllegalReplyException
     * @throws IllegalStateException
     * @throws FTPAbortedException
     * @throws FTPDataTransferException
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">uploadDirectory</span><span class="token punctuation">(</span>File dir<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException<span class="token punctuation">,</span>
            IllegalStateException<span class="token punctuation">,</span> FTPIllegalReplyException<span class="token punctuation">,</span> FTPException<span class="token punctuation">,</span>
            FTPDataTransferException<span class="token punctuation">,</span> FTPAbortedException <span class="token punctuation">{<!-- --></span>
 
        <span class="token comment">// 判断本地被上传的目录是否存在</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>dir<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
 
        <span class="token comment">// 取在ftp保存的相对路径</span>
        String dirs <span class="token operator">=</span> <span class="token function">getSavePath</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
        <span class="token comment">// 在ftp上创建目录</span>
        <span class="token function">mkDirs</span><span class="token punctuation">(</span>dirs<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
        <span class="token comment">// 判断是否是目录</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>dir<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 列举本地上传目录下的所有文件</span>
            File<span class="token punctuation">[</span><span class="token punctuation">]</span> files <span class="token operator">=</span> dir<span class="token punctuation">.</span><span class="token function">listFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> files<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">uploadDirectory</span><span class="token punctuation">(</span>files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 上传该文件</span>
            <span class="token function">upload</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
 
    <span class="token comment">/**
     * 获取文件保存相对路径
     * 
     * @param file
     * @return
     */</span>
    <span class="token keyword">public</span> String <span class="token function">getSavePath</span><span class="token punctuation">(</span>File file<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 如果是上传至根目录,则不创建目录</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>ROOT_PATH<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> null<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        String absPath <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> index <span class="token operator">=</span> absPath<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>ROOT_PATH<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> absPath<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>index <span class="token operator">+</span> ROOT_PATH<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> null<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token comment">/**
     * 创建层级目录
     * 
     * @param client
     * @param path
     * @throws FTPException
     * @throws FTPIllegalReplyException
     * @throws IOException
     * @throws IllegalStateException
     * @throws FTPException
     * @throws FTPIllegalReplyException
     * @throws IOException
     * @throws IllegalStateException
     */</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">mkDirs</span><span class="token punctuation">(</span>String path<span class="token punctuation">)</span> <span class="token keyword">throws</span> IllegalStateException<span class="token punctuation">,</span>
            IOException<span class="token punctuation">,</span> FTPIllegalReplyException<span class="token punctuation">,</span> FTPException <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>null <span class="token operator">==</span> path<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        String cpath <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">currentDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        client<span class="token punctuation">.</span><span class="token function">changeDirectory</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 切换到根目录</span>
        StringTokenizer dirs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringTokenizer</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> File<span class="token punctuation">.</span>separator<span class="token punctuation">)</span><span class="token punctuation">;</span>
        String temp <span class="token operator">=</span> null<span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>dirs<span class="token punctuation">.</span><span class="token function">hasMoreElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            temp <span class="token operator">=</span> dirs<span class="token punctuation">.</span><span class="token function">nextElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isDirExist</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                client<span class="token punctuation">.</span><span class="token function">createDirectory</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 创建目录</span>
                client<span class="token punctuation">.</span><span class="token function">changeDirectory</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 进入创建的目录</span>
                flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&gt;&gt;&gt;&gt;&gt;create directory:["</span> <span class="token operator">+</span> path <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        client<span class="token punctuation">.</span><span class="token function">changeDirectory</span><span class="token punctuation">(</span>cpath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token comment">/**
     * 上传文件到指定的目录下
     * 
     * @param client
     *            被指定上传的目录
     * @param file
     *            被上传的文件
     * @throws IOException
     * @throws FTPAbortedException
     * @throws FTPDataTransferException
     * @throws FTPException
     * @throws FTPIllegalReplyException
     * @throws IllegalStateException
     */</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">upload</span><span class="token punctuation">(</span>File file<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException<span class="token punctuation">,</span> IllegalStateException<span class="token punctuation">,</span>
            FTPIllegalReplyException<span class="token punctuation">,</span> FTPException<span class="token punctuation">,</span> FTPDataTransferException<span class="token punctuation">,</span>
            FTPAbortedException <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 切换到上传目录</span>
        String sPath <span class="token operator">=</span> <span class="token function">getSavePath</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
        <span class="token keyword">if</span> <span class="token punctuation">(</span>sPath <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            sPath <span class="token operator">=</span> <span class="token string">"/"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 如果当前目录 不是上传的目的目录,则切换目录</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>client<span class="token punctuation">.</span><span class="token function">currentDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>sPath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            client<span class="token punctuation">.</span><span class="token function">changeDirectory</span><span class="token punctuation">(</span><span class="token function">getSavePath</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 上传到client所在的目录</span>
        client<span class="token punctuation">.</span><span class="token function">upload</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&gt;&gt;&gt;&gt;&gt;upload file ["</span> <span class="token operator">+</span> file<span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token operator">+</span> <span class="token string">"] to FTP directory: ["</span> <span class="token operator">+</span> client<span class="token punctuation">.</span><span class="token function">currentDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token comment">/**
     * 检查目录是否存在
     * 
     * @param dir
     * @param ftpClient
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isDirExist</span><span class="token punctuation">(</span>String dir<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            client<span class="token punctuation">.</span><span class="token function">changeDirectory</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token comment">/**
     * 断开连接
     * 
     * @throws FTPException
     * @throws FTPIllegalReplyException
     * @throws IOException
     * @throws IllegalStateException
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">disConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> IllegalStateException<span class="token punctuation">,</span> IOException<span class="token punctuation">,</span>
            FTPIllegalReplyException<span class="token punctuation">,</span> FTPException <span class="token punctuation">{<!-- --></span>
        client<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&gt;&gt;&gt;&gt;&gt;login out......"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="6_544"></a>6主运行类</h3> 
<pre><code class="prism language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>main<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>IOException<span class="token punctuation">;</span>
<span class="token keyword">import</span> com<span class="token punctuation">.</span>dbtool<span class="token punctuation">.</span>TimerManager<span class="token punctuation">;</span>
<span class="token comment">/**
 * 启动定时任务，主程序入口
 * @author whh
 *
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">mainApp</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">new</span> <span class="token class-name">TimerManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9b36ea52df1500503302e3b102d1f2eb/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Excel工作表事件（4）- 单元格修订记录跟踪</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5ca23fe68b06f3ba112d87540d69b4bf/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">远程代码注入及DLL注入教程(InlineHook)---植物大战僵尸为例</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>