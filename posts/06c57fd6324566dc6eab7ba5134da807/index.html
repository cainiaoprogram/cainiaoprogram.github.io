<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>drools规则引擎可视化 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="drools规则引擎可视化" />
<meta property="og:description" content="参考：drools规则引擎可视化
Drools是一款基于Java的优秀的规则引擎，将复杂多变的业务规则从硬编码中解放出来，以规则脚本的形式存放在文件中，使得修改规则不需要改动代码重启服务就能生效。
Drools有一定的学习成本，官方英文文档非常详细，但中文文档少，本文将通过一篇文章来介绍Drools的使用和动态部署，这也是我学习过后的总结，希望对你入门Drools有帮助。
官网地址：https://www.drools.org/
github: https://github.com/kiegroup/drools
一、简单使用 给不同商品设置不同折扣。
1.1 pom.xml &lt;dependency&gt; &lt;groupId&gt;org.droolsgroupId&gt; &lt;artifactId&gt;drools-compilerartifactId&gt; &lt;version&gt;7.23.0.Finalversion&gt;dependency&gt; 1.2 kmodule.xml kmodule.xml 文件用于配置规则脚本，可以有多个kbase
文件放在项目resources/META-INF目录下可以自动加载
&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;&lt;kmodule xmlns=&#34;http://www.drools.org/xsd/kmodule&#34;&gt; &lt;kbase name=&#34;rules&#34; packages=&#34;rules&#34;&gt; &lt;ksession name=&#34;ksession-rule&#34;/&gt; 1.3 Product Bean实体 //lombok注解@Datapublic class Product { public static final String DIAMOND = &#34;DIAMOND&#34;; public static final String GOLD = &#34;GOLD&#34;; private String type; private int discount; } 1.4 Rules.drl resources/rules/Rules.drl 规则脚本
package rulesimport drools.Product // 当商品类型是DIAMOND时,打折为15% rule Offer4Diamond when productObject:Product(type == Product." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/06c57fd6324566dc6eab7ba5134da807/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-11-24T13:54:04+08:00" />
<meta property="article:modified_time" content="2022-11-24T13:54:04+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">drools规则引擎可视化</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>参考：<a href="https://blog.csdn.net/weixin_39959369/article/details/111215791" title="drools规则引擎可视化">drools规则引擎可视化</a></p> 
<blockquote> 
 <p>Drools是一款基于Java的优秀的<a href="https://so.csdn.net/so/search?q=%E8%A7%84%E5%88%99%E5%BC%95%E6%93%8E&amp;spm=1001.2101.3001.7020" title="规则引擎">规则引擎</a>，将复杂多变的业务规则从硬编码中解放出来，以规则脚本的形式存放在文件中，使得修改规则不需要改动代码重启服务就能生效。<br> Drools有一定的学习成本，官方英文文档非常详细，但中文文档少，本文将通过一篇文章来介绍Drools的使用和动态部署，这也是我学习过后的总结，希望对你入门Drools有帮助。</p> 
</blockquote> 
<blockquote> 
 <p>官网地址：https://www.drools.org/<br> github: https://github.com/kiegroup/drools</p> 
</blockquote> 
<h2><a name="t0"></a>一、简单使用</h2> 
<p>给不同商品设置不同折扣。</p> 
<h3><span style="color:#0d0016;"><code>1.1 pom.xml</code></span></h3> 
<pre><code class="language-XML">&lt;dependency&gt;      
  &lt;groupId&gt;org.droolsgroupId&gt;      
  &lt;artifactId&gt;drools-compilerartifactId&gt;      
&lt;version&gt;7.23.0.Finalversion&gt;dependency&gt;</code></pre> 
<h3><span style="color:#0d0016;"><code>1.2 kmodule.xml</code> </span></h3> 
<p><span style="color:#fe2c24;"><code>kmodule.xml</code></span> 文件用于配置规则脚本，可以有多个kbase<br> 文件放在项目<span style="color:#fe2c24;">resources/<code>META-INF</code></span>目录下可以自动加载</p> 
<pre><code class="language-XML">&lt;?xml  version="1.0" encoding="UTF-8"?&gt;&lt;kmodule xmlns="http://www.drools.org/xsd/kmodule"&gt;    
&lt;kbase name="rules" packages="rules"&gt;        
&lt;ksession name="ksession-rule"/&gt;    </code></pre> 
<h3><strong><code>1.3 Product Bean实体</code></strong></h3> 
<pre><code class="language-java">//lombok注解@Datapublic class Product {    
    public static final String DIAMOND = "DIAMOND";    
    public static final String GOLD = "GOLD";    
    private String type;    
    private int discount;
}</code></pre> 
<h3>1.4 <span style="color:#0d0016;"><strong><code>Rules.drl</code> </strong></span></h3> 
<p><strong>resources/rules/<span style="color:#fe2c24;"><code>Rules.drl</code></span> 规则脚本</strong></p> 
<pre><code class="language-Delphi">package rulesimport drools.Product

// 当商品类型是DIAMOND时,打折为15%
rule Offer4Diamond    
    when        
        productObject:Product(type == Product.DIAMOND)    
    then        
        productObject.setDiscount(15);    
end

//当商品类型是GOLD时，打折为25%
rule Offer4Gold 
    when        
        productObject: Product(type == Product.GOLD)    
    then        
        productObject.setDiscount(25);    
end</code></pre> 
<h3><span style="color:#0d0016;">1.5 junit Test</span></h3> 
<pre><code class="language-java">@Testpublic void droolsTest() {        
    KieServices ks = KieServices.Factory.get();        
    KieContainer kieContainer = ks.getKieClasspathContainer();       
    KieSession kSession = kieContainer.newKieSession("ksession-rule");        

    Product product = new Product();        
    product.setType(Product.GOLD);        
    kSession.insert(product);        
    int count = kSession.fireAllRules();        
    System.out.println("命中了" + count + "条规则");        
    System.out.println("商品" + product.getType() + "的商品折扣为" + product.getDiscount() + "%");    
}</code></pre> 
<p><strong>运行结果</strong></p> 
<pre><code>命中了1条规则商品GOLD的商品折扣为25%</code></pre> 
<h3><strong>1.6 解释</strong></h3> 
<h4><span style="color:#fe2c24;"><code>kmodule.xml</code></span></h4> 
<blockquote> 
 <ul><li> <p>该文件用来配置规则表，可以包含多个kbase,每个kbase都有name属性，不能重复</p> </li><li> <p>kbase可以包含多个ksession, packages属性是src/main/resources目录下文件夹的包路径，可以定义多个包，逗号分隔，packages目录下的所有规则文件都会被加载，除了子目录</p> </li><li> <p>ksession 的name不能重复，Java代码中KieSession设置的name就是该配置的name</p> </li></ul> 
</blockquote> 
<h4><code>droolsTest</code></h4> 
<blockquote> 
 <ul><li> <p>KieServices 该接口提供了很多方法，可以通过这些方法访问KIE关于构建和运行的相关对象，比如说可以获取KieContainer，利用KieContainer来访问KBase和KSession等信息；可以获取KieRepository对象，利用KieRepository来管理KieModule等。 KieServices就是一个中心，通过它来获取的各种对象来完成规则构建、管理和执行等操作。</p> </li><li> <p>KieContainerKieContainer可以理解为是一个KieBase的容器。</p> </li><li> <p>KieBase KieBase可以理解为是一个知识仓库，包含了若干的规则、流程、方法等，在Drools中主要就是规则和方法，KieBase本身并不包含运行时的数据之类的，如果需要执行规则KieBase中的规则的话，就需要根据KieBase创建KieSession。</p> </li><li> <p>KieSessionKieSession就是一个跟Drools引擎打交道的会话，其基于KieBase创建，它会包含运行时数据，包含“事实 Fact”，并对运行时数据事实进行规则运算。我们通过KieContainer创建KieSession是一种较为方便的做法，其实他本质上是从KieBase中创建出来</p> </li></ul> 
</blockquote> 
<h2><a name="t1"></a>二、动态规则</h2> 
<p>实现动态规则有这几种思路</p> 
<blockquote> 
 <p>     1. 使用Workbench，通过Web管理页面动态生成配置规则</p> 
 <p>     2. 将规则以字符串的形式存入数据库，需要自己开发一套规则管理系统</p> 
</blockquote> 
<p>使用Wrokbench</p> 
<h3>2.1 docker部署workbench</h3> 
<pre><code class="language-bash"># worker-bench
docker run \
-p 8080:8080 \
-p 8001:8001 \
-d --name drools-wb jboss/drools-workbench-showcase:7.5.0.Final

# kie-server
docker run \
-p 8180:8180 \
-d --name kie-server \
--link drools-wb:kie_wb jboss/kie-server-showcase:7.5.0.Final

# use
docker run \
-p 8080:8080 \
-p 8001:8001 \
-d --name drools-workbench-showcase \
docker.io/jboss/drools-workbench-showcase:latest</code></pre> 
<blockquote> 
 <p>访问http://ip地址:8080/drools-wb <br> 默认账号/密码 admin/admin</p> 
</blockquote> 
<p class="img-center"><img alt="360109cafab464aa865830dd2c535307.png" src="https://images2.imgbox.com/d2/73/0kI7r9Gv_o.png"></p> 
<h3>2.2 创建项目</h3> 
<p class="img-center"><img alt="d88d318a32b74c21380946696e2fa12f.png" src="https://images2.imgbox.com/16/2d/uL4bXdV8_o.png"></p> 
<p></p> 
<p class="img-center"><img alt="23b7ca66ec0f3e958a164c751596971e.png" src="https://images2.imgbox.com/1b/59/dFkKECft_o.png"></p> 
<h3>2.3 创建Object</h3> 
<p class="img-center"><img alt="1a695837ec3c86073638c2cb47f44922.png" src="https://images2.imgbox.com/e3/45/bGs6MKy5_o.png"></p> 
<p class="img-center"><img alt="24cc95e13d13b9e9c2fe43c3afd6ddbc.png" src="https://images2.imgbox.com/af/fd/dWXElgAw_o.png"></p> 
<h3>2.4 创建DRL文件</h3> 
<p class="img-center"><img alt="8337e69effc9a7f3939e33d1d173247f.png" src="https://images2.imgbox.com/81/b7/bE16pSJC_o.png"></p> 
<p class="img-center"><img alt="e887e6f0a6c8af36babfcbb155453e7c.png" src="https://images2.imgbox.com/1e/3e/4Wg928Ud_o.png"></p> 
<h3>2.5 部署</h3> 
<p class="img-center"><img alt="c7978701c61de7d309f15c176644671f.png" src="https://images2.imgbox.com/db/09/GADqRwIS_o.png"></p> 
<h3>2.6 使用部署的规则文件</h3> 
<p><strong><code>远程规则Maven仓库地址获取</code></strong></p> 
<p class="img-center"><img alt="3b1bd01ab6a91ee89aa8d29de1235f1e.png" src="https://images2.imgbox.com/a0/34/iKC3d7Ne_o.png"></p> 
<p><img alt="57411583bfc56184e64b2c7019c7e6c6.png" src="https://images2.imgbox.com/3e/72/A1TsvAbf_o.png"></p> 
<p><code>本地Maven仓库settings.xml配置，这里只摘录了需要添加的3处，需要对应去添加</code></p> 
<pre><code class="language-XML">&lt;servers&gt;
	&lt;!--...--&gt;
	&lt;server&gt;
		&lt;username&gt;admin&lt;/username&gt;
		&lt;password&gt;admin&lt;/password&gt;
		&lt;id&gt;guvnor-m2-repo
		&lt;/id&gt;
	&lt;/server&gt;
	&lt;!--...--&gt;
&lt;/servers&gt;
&lt;profiles&gt;
	&lt;!--...--&gt;
	&lt;profile&gt;
		&lt;id&gt;guvnor-m2-repo&lt;/id&gt;
		&lt;repositories&gt;
			&lt;repository&gt;
				&lt;id&gt;guvnor-m2-repo&lt;/id&gt;
				&lt;name&gt;Guvnor M2 Repo&lt;/name&gt;
				&lt;url&gt;http://10.211.55.7:8080/drools-wb/maven2/&lt;/url&gt;
				&lt;layout&gt;
					default
				&lt;/layout&gt;
				&lt;releases&gt;
					&lt;enabled&gt;true&lt;/enabled&gt;
					&lt;updatePolicy&gt;always&lt;/updatePolicy&gt;
				&lt;/releases&gt;
				&lt;snapshots&gt;
					&lt;enabled&gt;true&lt;/enabled&gt;
					&lt;updatePolicy&gt;always&lt;/updatePolicy&gt;
				&lt;/snapshots&gt;
			&lt;/repository&gt;
		&lt;/repositories&gt;
		&lt;activation&gt;
			&lt;activeByDefault&gt;true&lt;/activeByDefault&gt;
		&lt;/activation&gt;
	&lt;/profile&gt;
	&lt;!--...--&gt;
&lt;/profiles&gt;
&lt;activeProfiles&gt;
	&lt;activeProfile&gt;guvnor-m2-repo&lt;/activeProfile&gt;
&lt;/activeProfiles&gt;</code></pre> 
<h3>2.7 创建SpringBoot工程</h3> 
<p><code>Product</code>实体，包路径要跟规则文件中的一致</p> 
<pre><code class="language-java">@Data
public class Product {    
	private String type;    
	private int discount;
}</code></pre> 
<p><strong><code>DroolsController.java</code></strong></p> 
<pre><code class="language-java">@RestController
@RequestMapping("/api/")
@Slf4j
public class DroolsController {
	@PostMapping("getdiscount")
	public Product getDiscount(Product product) throws IOException {
		KieServices ks = KieServices.Factory.get();

		// RELEASE 代表使用jar包的最新正式版        
		ReleaseIdImpl releaseId = new ReleaseIdImpl("com.myteam", "test", "RELEASE");
		KieContainer kieContainer = ks.newKieContainer(releaseId);
		
        // 自动扫描Maven仓库，有新版本会自动下载        
		KieScanner kieScanner = ks.newKieScanner(kieContainer);
		kieScanner.start(3000);
		KieSession kieSession = kieContainer.newKieSession();
		kieSession.insert(product);
		int count = kieSession.fireAllRules();
		log.info("共执行了{}条规则", count);
		log.info("商品{}的折扣为{}%", product.getType(), product.getDiscount());
		
        return product;
	}
}</code></pre> 
<p><strong><code>PostMan访问接口</code></strong></p> 
<p class="img-center"><img alt="503ecbf46e325f2ae5376691e5a8b82c.png" src="https://images2.imgbox.com/b9/dd/fCfUYjRr_o.png"></p> 
<p>与DRL规则文件中配置的一致</p> 
<h3>2.8 动态规则</h3> 
<blockquote> 
 <p>修改<span style="color:#fe2c24;"><code>ppdrl.drl</code></span>规则表，修改GOLD的打折为50%，保存规则，将项目版本提高一个版本，并<span style="color:#fe2c24;"><code>build&amp;deploy</code></span>项目</p> 
</blockquote> 
<p class="img-center"><img alt="d4b5654aeee86e065762d542f4dfb2ec.png" src="https://images2.imgbox.com/88/84/Wy7XzasC_o.png"></p> 
<p class="img-center"><img alt="e3ea25b5bf5a8dbef89e9a777f2d709e.png" src="https://images2.imgbox.com/37/a7/SrgYpbWQ_o.png"></p> 
<p class="img-center"><img alt="d758c6bdb379f4c87f924443e395d693.png" src="https://images2.imgbox.com/30/3b/UZ8Kb2dD_o.png"></p> 
<p><code>再次访问接口，GOLD的折扣已经变为50%</code>,其中没有重启服务</p> 
<p class="img-center"><img alt="0404b9c5850e7c6513945a56253a2938.png" src="https://images2.imgbox.com/86/01/8e2bXuZm_o.png"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9979e981bae4e2289a8fe884d89bcc94/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">如何在Arcmap 中提取多段影像的某个波段</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/086b5060f17a01330385dddb62186825/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">java8新特性使用</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>