<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Pytorch中常见transform的使用 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Pytorch中常见transform的使用" />
<meta property="og:description" content="本次实验练习了pytorch中数据的读取，Dataset类的使用，以及transform模块的使用。
一、Pytorch简介 PyTorch是一个开源的Python机器学习库，基于Torch，用于自然语言处理等应用程序。
2017年1月，由Facebook人工智能研究院（FAIR）基于Torch推出了PyTorch。它是一个基于Python的可续计算包，提供两个高级功能：1、具有强大的GPU加速的张量计算（如NumPy）。2、包含自动求导系统的深度神经网络。
二、Pytorch的环境配置 关于Pytorch的环境配置网上有好多教学，这里不做赘述。
三、Dataset类的基本使用 Dataset类：处理数据，提供一种方式挑选数据及其对应的label。
Dataloader类：对Dataset挑选后的数据进行打包，为后面的网络提供不同的数据形式。
1、首先导入Dataset类
from torch.utils.data import Dataset
2、创建一个类，继承Dataset类
class MyData(Dataset): def __init__(self, root_dir, label_dir): self.root_dir = root_dir self.label_dir = label_dir # os.path.join的意思是把这两个路径拼接 # 如root路径是dataset\train，label路径是ants，拼接后的结果是dataset\train\\ants self.path = os.path.join(self.root_dir, self.label_dir) # os.listdir(path) # 作用：传入任意一个path路径，返回的是该路径下所有文件和目录组成的列表； self.img_path = os.listdir(self.path) # 这个函数作用是获取其中的每一个图片 def __getitem__(self, idx): # idx是图片的索引，img_name是获取图片 img_name = self.img_path[idx] # 把图片的路径也拼接上 img_item_path = os.path.join(self.root_dir, self.label_dir, img_name) # 打开图片 img = Image.open(img_item_path) # 需要用到标签 label = self.label_dir # 返回标签和读取的图片 return img, label def __len__(self): # 返回有多少张图 return len(self." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/3766936087cddba85fcf8ae14e41e06f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-10-28T13:44:05+08:00" />
<meta property="article:modified_time" content="2022-10-28T13:44:05+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Pytorch中常见transform的使用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="margin-left:0;text-align:center;">本次实验练习了pytorch中数据的读取，Dataset类的使用，以及transform模块的使用。</p> 
<h2 style="margin-left:0;text-align:justify;">一、Pytorch简介</h2> 
<p style="margin-left:0;text-align:justify;">PyTorch是一个开源的Python机器学习库，基于Torch，用于自然语言处理等应用程序。</p> 
<p style="margin-left:0;text-align:justify;">2017年1月，由Facebook人工智能研究院（FAIR）基于Torch推出了PyTorch。它是一个基于Python的可续计算包，提供两个高级功能：1、具有强大的GPU加速的张量计算（如NumPy）。2、包含自动求导系统的深度神经网络。</p> 
<h2 style="margin-left:0;text-align:justify;">二、Pytorch的环境配置</h2> 
<p style="margin-left:0;text-align:justify;">关于Pytorch的环境配置网上有好多教学，这里不做赘述。</p> 
<h2 style="margin-left:0;text-align:justify;">三、Dataset类的基本使用</h2> 
<p style="margin-left:0;text-align:justify;">Dataset类：处理数据，提供一种方式挑选数据及其对应的label。</p> 
<p style="margin-left:0;text-align:justify;">Dataloader类：对Dataset挑选后的数据进行打包，为后面的网络提供不同的数据形式。</p> 
<p style="margin-left:0;text-align:justify;">1、首先导入Dataset类</p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#2b2b2b;"><span style="color:#cc7832;">from </span><span style="color:#a9b7c6;">torch.utils.data </span><span style="color:#cc7832;">import </span><span style="color:#a9b7c6;">Dataset</span></span></p> 
<p style="margin-left:0;text-align:justify;">2、创建一个类，继承Dataset类</p> 
<pre style="margin-left:.0001pt;"><span style="background-color:#2b2b2b;"><span style="color:#cc7832;">class </span><span style="color:#a9b7c6;">MyData(Dataset):



    </span><span style="color:#cc7832;">def </span><span style="color:#b200b2;">__init__</span><span style="color:#a9b7c6;">(</span><span style="color:#94558d;">self</span><span style="color:#cc7832;">, </span><span style="color:#a9b7c6;">root_dir</span><span style="color:#cc7832;">, </span><span style="color:#a9b7c6;">label_dir):

        </span><span style="color:#94558d;">self</span><span style="color:#a9b7c6;">.root_dir = root_dir

        </span><span style="color:#94558d;">self</span><span style="color:#a9b7c6;">.label_dir = label_dir

        </span><span style="color:#808080;"># os.path.join</span><span style="color:#808080;">的意思是把这两个路径拼接

        # 如root路径是dataset\train，label路径是ants，拼接后的结果是dataset\train\\ants

        </span><span style="color:#94558d;">self</span><span style="color:#a9b7c6;">.path = os.path.join(</span><span style="color:#94558d;">self</span><span style="color:#a9b7c6;">.root_dir</span><span style="color:#cc7832;">, </span><span style="color:#94558d;">self</span><span style="color:#a9b7c6;">.label_dir)

        </span><span style="color:#808080;"># os.listdir(path)

        # </span><span style="color:#808080;">作用：传入任意一个path路径，返回的是该路径下所有文件和目录组成的列表；

        </span><span style="color:#94558d;">self</span><span style="color:#a9b7c6;">.img_path = os.listdir(</span><span style="color:#94558d;">self</span><span style="color:#a9b7c6;">.path)



    </span><span style="color:#808080;"># </span><span style="color:#808080;">这个函数作用是获取其中的每一个图片

    </span><span style="color:#cc7832;">def </span><span style="color:#b200b2;">__getitem__</span><span style="color:#a9b7c6;">(</span><span style="color:#94558d;">self</span><span style="color:#cc7832;">, </span><span style="color:#a9b7c6;">idx):

        </span><span style="color:#808080;"># idx</span><span style="color:#808080;">是图片的索引，img_name是获取图片

        </span><span style="color:#a9b7c6;">img_name = </span><span style="color:#94558d;">self</span><span style="color:#a9b7c6;">.img_path[idx]

        </span><span style="color:#808080;"># </span><span style="color:#808080;">把图片的路径也拼接上

        </span><span style="color:#a9b7c6;">img_item_path = os.path.join(</span><span style="color:#94558d;">self</span><span style="color:#a9b7c6;">.root_dir</span><span style="color:#cc7832;">, </span><span style="color:#94558d;">self</span><span style="color:#a9b7c6;">.label_dir</span><span style="color:#cc7832;">, </span><span style="color:#a9b7c6;">img_name)

        </span><span style="color:#808080;"># </span><span style="color:#808080;">打开图片

        </span><span style="color:#a9b7c6;">img = Image.open(img_item_path)

        </span><span style="color:#808080;"># </span><span style="color:#808080;">需要用到标签

        </span><span style="color:#a9b7c6;">label = </span><span style="color:#94558d;">self</span><span style="color:#a9b7c6;">.label_dir

        </span><span style="color:#808080;"># </span><span style="color:#808080;">返回标签和读取的图片

        </span><span style="color:#cc7832;">return </span><span style="color:#a9b7c6;">img</span><span style="color:#cc7832;">, </span><span style="color:#a9b7c6;">label



    </span><span style="color:#cc7832;">def </span><span style="color:#b200b2;">__len__</span><span style="color:#a9b7c6;">(</span><span style="color:#94558d;">self</span><span style="color:#a9b7c6;">):

        </span><span style="color:#808080;"># </span><span style="color:#808080;">返回有多少张图

        </span><span style="color:#cc7832;">return </span><span style="color:#8888c6;">len</span><span style="color:#a9b7c6;">(</span><span style="color:#94558d;">self</span><span style="color:#a9b7c6;">.img_path)</span></span></pre> 
<h2 style="margin-left:0;text-align:justify;">四、常见transform的使用</h2> 
<p style="margin-left:0;text-align:justify;">首先导入SummaryWriter函数，此函数的作用是将图片在浏览器中显示。</p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#2b2b2b;"><span style="color:#a9b7c6;">writer = SummaryWriter(</span><span style="color:#6a8759;">'logs'</span><span style="color:#a9b7c6;">)<br> img = Image.open(</span><span style="color:#6a8759;">'images/220927.png'</span><span style="color:#a9b7c6;">).convert(</span><span style="color:#6a8759;">'RGB'</span><span style="color:#a9b7c6;">)</span></span></p> 
<h3 style="margin-left:0;text-align:justify;">1、ToTensor方法：</h3> 
<p style="margin-left:0;text-align:justify;"><br> 这个类可以接受的图像类型为Convert a ``PIL Image`` or ``numpy.ndarray`` to tensor.</p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#2b2b2b;"><span style="color:#808080;"># ToTensor</span><span style="color:#808080;">的使用</span><br><span style="color:#a9b7c6;">trans_totensor = transforms.ToTensor()<br> img_tensor = trans_totensor(img)<br> writer.add_image(</span><span style="color:#6a8759;">"TotTensor"</span><span style="color:#cc7832;">, </span><span style="color:#a9b7c6;">img_tensor)</span></span></p> 
<p style="margin-left:0;text-align:justify;">在终端输入</p> 
<p style="margin-left:0;text-align:justify;">tensorboard --logdir="logs" --port=6007</p> 
<p style="margin-left:0;text-align:justify;">点击链接进入浏览器输出图像如下</p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="403" src="https://images2.imgbox.com/37/08/0NjZPjaa_o.png" width="364"></p> 
<p> </p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;">这个方法的作用是将图片转换为tensor类型。</p> 
<h3 style="margin-left:0;text-align:justify;">2、Normalize方法</h3> 
<p style="margin-left:0;text-align:justify;">归一化类，需要传入均值和标准差。</p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#2b2b2b;"><span style="color:#a9b7c6;">tran_norm = transforms.Normalize([</span><span style="color:#6897bb;">0.5</span><span style="color:#cc7832;">, </span><span style="color:#6897bb;">0.5</span><span style="color:#cc7832;">, </span><span style="color:#6897bb;">0.5</span><span style="color:#a9b7c6;">]</span><span style="color:#cc7832;">, </span><span style="color:#a9b7c6;">[</span><span style="color:#6897bb;">0.5</span><span style="color:#cc7832;">, </span><span style="color:#6897bb;">0.5</span><span style="color:#cc7832;">, </span><span style="color:#6897bb;">0.5</span><span style="color:#a9b7c6;">])</span><br><span style="color:#808080;"># </span><span style="color:#808080;">传入需要归一化的图片</span><br><span style="color:#a9b7c6;">img_norm = tran_norm(img_tensor)</span><br><span style="color:#8888c6;">print</span><span style="color:#a9b7c6;">(img_norm[</span><span style="color:#6897bb;">0</span><span style="color:#a9b7c6;">][</span><span style="color:#6897bb;">0</span><span style="color:#a9b7c6;">][</span><span style="color:#6897bb;">0</span><span style="color:#a9b7c6;">])<br> writer.add_image(</span><span style="color:#6a8759;">'Normalize'</span><span style="color:#cc7832;">, </span><span style="color:#a9b7c6;">img_norm</span><span style="color:#cc7832;">, </span><span style="color:#6897bb;">2</span><span style="color:#a9b7c6;">)</span></span></p> 
<p style="margin-left:0;text-align:justify;">输出结果如下</p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="457" src="https://images2.imgbox.com/4e/e3/QSJ4r5fg_o.png" width="411"> </p> 
<p style="margin-left:0;text-align:justify;"></p> 
<h3 style="margin-left:0;text-align:justify;">3、Resize方法</h3> 
<p style="margin-left:0;text-align:justify;">即改变图片尺寸</p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#2b2b2b;"><span style="color:#a9b7c6;">trans_resize = transforms.Resize((</span><span style="color:#6897bb;">3</span><span style="color:#cc7832;">, </span><span style="color:#6897bb;">3</span><span style="color:#a9b7c6;">))</span><br><span style="color:#a9b7c6;">img_resize = trans_resize(img_tensor)</span><br><span style="color:#8888c6;">print</span><span style="color:#a9b7c6;">(img_resize)<br> writer.add_image(</span><span style="color:#6a8759;">'Resize'</span><span style="color:#cc7832;">, </span><span style="color:#a9b7c6;">img_resize</span><span style="color:#cc7832;">, </span><span style="color:#6897bb;">0</span><span style="color:#a9b7c6;">)</span></span></p> 
<p style="margin-left:0;text-align:justify;">输出结果如下</p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="336" src="https://images2.imgbox.com/3c/01/dTOCIyYg_o.png" width="329"></p> 
<p> </p> 
<p style="margin-left:0;text-align:justify;"></p> 
<h3 style="margin-left:0;text-align:justify;">4、Compose方法</h3> 
<p style="margin-left:0;text-align:justify;">compose()用法：其中的参数需要的是一个列表，列表中的数据类型是transforms，意义是把两个类的方法合并。</p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#2b2b2b;"><span style="color:#a9b7c6;">trans_resize_2 = transforms.Resize(</span><span style="color:#6897bb;">512</span><span style="color:#a9b7c6;">)<br> trans_compose = transforms.Compose([trans_resize</span><span style="color:#cc7832;">, </span><span style="color:#a9b7c6;">trans_resize_2])<br> img_resize_2 = trans_compose(img_tensor)</span><br><span style="color:#8888c6;">print</span><span style="color:#a9b7c6;">(img_resize_2)<br> writer.add_image(</span><span style="color:#6a8759;">'resize'</span><span style="color:#cc7832;">, </span><span style="color:#a9b7c6;">img_resize_2</span><span style="color:#cc7832;">, </span><span style="color:#6897bb;">1</span><span style="color:#a9b7c6;">)</span></span></p> 
<p style="margin-left:0;text-align:justify;">输出结果如下</p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="374" src="https://images2.imgbox.com/f5/63/D4930J9z_o.png" width="343"></p> 
<p> </p> 
<p style="margin-left:0;text-align:justify;"></p> 
<h2 style="margin-left:0;text-align:justify;">五、dataset类与transform的结合使用</h2> 
<p style="margin-left:0;text-align:justify;">首先下载数据集，因为仅作练习使用，所以下载较小的CIFAR10数据集。</p> 
<p style="margin-left:0;text-align:justify;">root是保存的目录，train=True时下载的时训练集，反之下载数据集，将下载的数据集转换为tensor类型</p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#2b2b2b;"><span style="color:#a9b7c6;">train_set = torchvision.datasets.CIFAR10(</span><span style="color:#aa4926;">root</span><span style="color:#a9b7c6;">=</span><span style="color:#6a8759;">'./dataset'</span><span style="color:#cc7832;">, </span><span style="color:#aa4926;">train</span><span style="color:#a9b7c6;">=</span><span style="color:#cc7832;">True, </span><span style="color:#aa4926;">transform</span><span style="color:#a9b7c6;">=dataset_transform</span><span style="color:#cc7832;">,  </span><span style="color:#aa4926;">download</span><span style="color:#a9b7c6;">=</span><span style="color:#cc7832;">True</span><span style="color:#a9b7c6;">)<br> test_set = torchvision.datasets.CIFAR10(</span><span style="color:#aa4926;">root</span><span style="color:#a9b7c6;">=</span><span style="color:#6a8759;">'./dataset'</span><span style="color:#cc7832;">, </span><span style="color:#aa4926;">train</span><span style="color:#a9b7c6;">=</span><span style="color:#cc7832;">False, </span><span style="color:#aa4926;">transform</span><span style="color:#a9b7c6;">=dataset_transform</span><span style="color:#cc7832;">, </span><span style="color:#aa4926;">download</span><span style="color:#a9b7c6;">=</span><span style="color:#cc7832;">True</span><span style="color:#a9b7c6;">)</span></span></p> 
<p style="margin-left:0;text-align:justify;">取测试集的前十张图片传入浏览器</p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#2b2b2b;"><span style="color:#a9b7c6;">writer = SummaryWriter(</span><span style="color:#6a8759;">'logs'</span><span style="color:#a9b7c6;">)</span><br><span style="color:#cc7832;">for </span><span style="color:#a9b7c6;">i </span><span style="color:#cc7832;">in </span><span style="color:#8888c6;">range</span><span style="color:#a9b7c6;">(</span><span style="color:#6897bb;">10</span><span style="color:#a9b7c6;">):<br>     img</span><span style="color:#cc7832;">, </span><span style="color:#a9b7c6;">target = test_set[i]<br>     writer.add_image(</span><span style="color:#6a8759;">'test_set'</span><span style="color:#cc7832;">, </span><span style="color:#a9b7c6;">img</span><span style="color:#cc7832;">, </span><span style="color:#a9b7c6;">i)<br> writer.close()</span></span></p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;">输出结果如下</p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="465" src="https://images2.imgbox.com/e0/c1/OT1uYwFk_o.png" width="865"></p> 
<p> </p> 
<p style="margin-left:0;text-align:justify;"></p> 
<h3 style="margin-left:0;text-align:justify;">2、dataloader的使用</h3> 
<p style="margin-left:0;text-align:justify;">Dataloader类：对Dataset挑选后的数据进行打包，为后面的网络提供不同的数据形式。</p> 
<p style="margin-left:0;text-align:justify;">准备的测试数据集</p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#2b2b2b;"><span style="color:#a9b7c6;">test_data = torchvision.datasets.CIFAR10(</span><span style="color:#6a8759;">'./dataset'</span><span style="color:#cc7832;">, </span><span style="color:#aa4926;">train</span><span style="color:#a9b7c6;">=</span><span style="color:#cc7832;">False, </span><span style="color:#aa4926;">transform</span><span style="color:#a9b7c6;">=torchvision.transforms.ToTensor())</span></span></p> 
<p style="margin-left:0;text-align:justify;">batch_size=4的意思是每次从数据集中取出4个数据进行打包</p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#2b2b2b;"><span style="color:#a9b7c6;">test_loader = DataLoader(</span><span style="color:#aa4926;">dataset</span><span style="color:#a9b7c6;">=test_data</span><span style="color:#cc7832;">, </span><span style="color:#aa4926;">batch_size</span><span style="color:#a9b7c6;">=</span><span style="color:#6897bb;">4</span><span style="color:#cc7832;">, </span><span style="color:#aa4926;">shuffle</span><span style="color:#a9b7c6;">=</span><span style="color:#cc7832;">True, </span><span style="color:#aa4926;">num_workers</span><span style="color:#a9b7c6;">=</span><span style="color:#6897bb;">0</span><span style="color:#cc7832;">, </span><span style="color:#aa4926;">drop_last</span><span style="color:#a9b7c6;">=</span><span style="color:#cc7832;">False</span><span style="color:#a9b7c6;">)</span></span></p> 
<p style="margin-left:0;text-align:justify;">将打包好的图片在浏览器中显示</p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#2b2b2b;"><span style="color:#a9b7c6;">step = </span><span style="color:#6897bb;">0</span><br><span style="color:#a9b7c6;">writer = SummaryWriter(</span><span style="color:#6a8759;">'dataloader'</span><span style="color:#a9b7c6;">)</span><br><span style="color:#cc7832;">for </span><span style="color:#a9b7c6;">data </span><span style="color:#cc7832;">in </span><span style="color:#a9b7c6;">test_loader:<br>     imgs</span><span style="color:#cc7832;">, </span><span style="color:#a9b7c6;">targets = data<br>     writer.add_images(</span><span style="color:#6a8759;">'test_data'</span><span style="color:#cc7832;">, </span><span style="color:#a9b7c6;">imgs</span><span style="color:#cc7832;">, </span><span style="color:#a9b7c6;">step)<br>     step = step+</span><span style="color:#6897bb;">1</span><br><br><span style="color:#a9b7c6;">writer.close()</span></span></p> 
<p style="margin-left:0;text-align:justify;">输出结果如下</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="465" src="https://images2.imgbox.com/b5/b6/ueUsxZrF_o.png" width="865"></p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/de01016c4a763454d548d8ad3fed1825/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">java接口可以被继承吗</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fa3f419477d343998ce7253c9eaa2178/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">12个C语言必背实例</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>