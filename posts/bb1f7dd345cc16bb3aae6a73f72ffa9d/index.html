<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>我用AI给女友画了一幅画，这届算法有点强！ - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="我用AI给女友画了一幅画，这届算法有点强！" />
<meta property="og:description" content="大家好，我是 Jack。
小时候，我其实还是有点艺术细胞的，喜欢看火影忍者和七龙珠的我，虽然没学过绘画，但也笨手笨脚地画了不少作品。
特意叫我妈，把我收藏多年的小破本拿出来，分享下我儿时的快乐。
小学几年级画的记不清了，只记得一画就是小半天，还拿去学校显摆了一番。
如今，再让我拿起铅笔，画个素描，我是画不出来了。
不过，我另辟蹊径，用起了算法。我lbw，没有开挂！
Anime2Sketch Anime2Sketch 是一个动画、漫画、插画等艺术作品的素描提取器。
给我个艺术作品，我直接把它变成素描作品：
耗时1秒临摹的素描作品：
Anime2Sketch 算法也非常简单，就是一个 UNet 结构，生成素描作品，可以看下它的网络结构：
import torch import torch.nn as nn import functools class UnetGenerator(nn.Module): &#34;&#34;&#34;Create a Unet-based generator&#34;&#34;&#34; def __init__(self, input_nc, output_nc, num_downs, ngf=64, norm_layer=nn.BatchNorm2d, use_dropout=False): &#34;&#34;&#34;Construct a Unet generator Parameters: input_nc (int) -- the number of channels in input images output_nc (int) -- the number of channels in output images num_downs (int) -- the number of downsamplings in UNet." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/bb1f7dd345cc16bb3aae6a73f72ffa9d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-05-13T18:33:37+08:00" />
<meta property="article:modified_time" content="2021-05-13T18:33:37+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">我用AI给女友画了一幅画，这届算法有点强！</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>大家好，我是 Jack。</p> 
<p>小时候，我其实还是有点艺术细胞的，喜欢看火影忍者和七龙珠的我，虽然没学过绘画，但也笨手笨脚地画了不少作品。</p> 
<p>特意叫我妈，把我收藏多年的小破本拿出来，分享下我儿时的快乐。</p> 
<p style="text-align:center;"><img alt="" height="400" src="https://images2.imgbox.com/d9/f2/A8o1ADV0_o.png" width="600"></p> 
<p>小学几年级画的记不清了，只记得一画就是小半天，还拿去学校显摆了一番。</p> 
<p>如今，再让我拿起铅笔，画个素描，我是画不出来了。</p> 
<p><strong>不过，我另辟蹊径，用起了算法。我lbw，没有开挂！</strong></p> 
<h3>Anime2Sketch</h3> 
<p>Anime2Sketch 是一个动画、漫画、插画等艺术作品的<strong>素描提取器</strong>。</p> 
<p>给我个艺术作品，我直接把它变成素描作品：</p> 
<p style="text-align:center;"><img alt="" height="225" src="https://images2.imgbox.com/92/b9/uP834pEd_o.gif" width="800"></p> 
<p> </p> 
<p>耗时1秒临摹的素描作品：</p> 
<p style="text-align:center;"><img alt="" height="822" src="https://images2.imgbox.com/0d/c3/xagPeb6s_o.png" width="800"></p> 
<p> </p> 
<p>Anime2Sketch 算法也非常简单，就是一个 UNet 结构，生成素描作品，可以看下它的网络结构：</p> 
<pre><code class="language-python">import torch 
import torch.nn as nn 
import functools


class UnetGenerator(nn.Module):
    """Create a Unet-based generator"""

    def __init__(self, input_nc, output_nc, num_downs, ngf=64, norm_layer=nn.BatchNorm2d, use_dropout=False):
        """Construct a Unet generator
        Parameters:
            input_nc (int)  -- the number of channels in input images
            output_nc (int) -- the number of channels in output images
            num_downs (int) -- the number of downsamplings in UNet. For example, # if |num_downs| == 7,
                                image of size 128x128 will become of size 1x1 # at the bottleneck
            ngf (int)       -- the number of filters in the last conv layer
            norm_layer      -- normalization layer
        We construct the U-Net from the innermost layer to the outermost layer.
        It is a recursive process.
        """
        super(UnetGenerator, self).__init__()
        # construct unet structure
        unet_block = UnetSkipConnectionBlock(ngf * 8, ngf * 8, input_nc=None, submodule=None, norm_layer=norm_layer, innermost=True)  # add the innermost layer
        for _ in range(num_downs - 5):          # add intermediate layers with ngf * 8 filters
            unet_block = UnetSkipConnectionBlock(ngf * 8, ngf * 8, input_nc=None, submodule=unet_block, norm_layer=norm_layer, use_dropout=use_dropout)
        # gradually reduce the number of filters from ngf * 8 to ngf
        unet_block = UnetSkipConnectionBlock(ngf * 4, ngf * 8, input_nc=None, submodule=unet_block, norm_layer=norm_layer)
        unet_block = UnetSkipConnectionBlock(ngf * 2, ngf * 4, input_nc=None, submodule=unet_block, norm_layer=norm_layer)
        unet_block = UnetSkipConnectionBlock(ngf, ngf * 2, input_nc=None, submodule=unet_block, norm_layer=norm_layer)
        self.model = UnetSkipConnectionBlock(output_nc, ngf, input_nc=input_nc, submodule=unet_block, outermost=True, norm_layer=norm_layer)  # add the outermost layer

    def forward(self, input):
        """Standard forward"""
        return self.model(input)

class UnetSkipConnectionBlock(nn.Module):
    """Defines the Unet submodule with skip connection.
        X -------------------identity----------------------
        |-- downsampling -- |submodule| -- upsampling --|
    """

    def __init__(self, outer_nc, inner_nc, input_nc=None,
                 submodule=None, outermost=False, innermost=False, norm_layer=nn.BatchNorm2d, use_dropout=False):
        """Construct a Unet submodule with skip connections.
        Parameters:
            outer_nc (int) -- the number of filters in the outer conv layer
            inner_nc (int) -- the number of filters in the inner conv layer
            input_nc (int) -- the number of channels in input images/features
            submodule (UnetSkipConnectionBlock) -- previously defined submodules
            outermost (bool)    -- if this module is the outermost module
            innermost (bool)    -- if this module is the innermost module
            norm_layer          -- normalization layer
            use_dropout (bool)  -- if use dropout layers.
        """
        super(UnetSkipConnectionBlock, self).__init__()
        self.outermost = outermost
        if type(norm_layer) == functools.partial:
            use_bias = norm_layer.func == nn.InstanceNorm2d
        else:
            use_bias = norm_layer == nn.InstanceNorm2d
        if input_nc is None:
            input_nc = outer_nc
        downconv = nn.Conv2d(input_nc, inner_nc, kernel_size=4,
                             stride=2, padding=1, bias=use_bias)
        downrelu = nn.LeakyReLU(0.2, True)
        downnorm = norm_layer(inner_nc)
        uprelu = nn.ReLU(True)
        upnorm = norm_layer(outer_nc)

        if outermost:
            upconv = nn.ConvTranspose2d(inner_nc * 2, outer_nc,
                                        kernel_size=4, stride=2,
                                        padding=1)
            down = [downconv]
            up = [uprelu, upconv, nn.Tanh()]
            model = down + [submodule] + up
        elif innermost:
            upconv = nn.ConvTranspose2d(inner_nc, outer_nc,
                                        kernel_size=4, stride=2,
                                        padding=1, bias=use_bias)
            down = [downrelu, downconv]
            up = [uprelu, upconv, upnorm]
            model = down + up
        else:
            upconv = nn.ConvTranspose2d(inner_nc * 2, outer_nc,
                                        kernel_size=4, stride=2,
                                        padding=1, bias=use_bias)
            down = [downrelu, downconv, downnorm]
            up = [uprelu, upconv, upnorm]

            if use_dropout:
                model = down + [submodule] + up + [nn.Dropout(0.5)]
            else:
                model = down + [submodule] + up

        self.model = nn.Sequential(*model)

    def forward(self, x):
        if self.outermost:
            return self.model(x)
        else:   # add skip connections
            return torch.cat([x, self.model(x)], 1)


def create_model(gpu_ids=[]):
    """Create a model for anime2sketch
    hardcoding the options for simplicity
    """
    norm_layer = functools.partial(nn.InstanceNorm2d, affine=False, track_running_stats=False)
    net = UnetGenerator(3, 1, 8, 64, norm_layer=norm_layer, use_dropout=False)
    ckpt = torch.load('weights/netG.pth')
    for key in list(ckpt.keys()):
        if 'module.' in key:
            ckpt[key.replace('module.', '')] = ckpt[key]
            del ckpt[key]
    net.load_state_dict(ckpt)
    if len(gpu_ids) &gt; 0:
        assert(torch.cuda.is_available())
        net.to(gpu_ids[0])
        net = torch.nn.DataParallel(net, gpu_ids)  # multi-GPUs
    return net</code></pre> 
<p>UNet 应该都很熟悉了，就不多介绍了。</p> 
<blockquote> 
 <p>项目地址：https://github.com/Mukosame/Anime2Sketch</p> 
</blockquote> 
<p>环境部署也很简单，只需要安装以下三个库：</p> 
<pre><code>torch&gt;=0.4.1
torchvision&gt;=0.2.1
Pillow&gt;=6.0.0
</code></pre> 
<p>然后下载权重文件，即可。</p> 
<p>权重文件放在了GoogleDrive，<strong>为了方便大家，我将代码和权重文件，还有一些测试图片，都打包好了。</strong></p> 
<p>直接下载，即可运行（提取码：a7r4）：</p> 
<p><a href="https://pan.baidu.com/s/1h6bqgphqUUjj4fz61Y9HCA" rel="nofollow">https://pan.baidu.com/s/1h6bqgphqUUjj4fz61Y9HCA</a></p> 
<p>进入项目根目录，直接运行命令：</p> 
<pre><code>python3 test.py --dataroot test_samples --load_size 512 --output_dir results
</code></pre> 
<p>运行效果：</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/4d/f6/WwMBoE5A_o.gif"></p> 
<p>“画”得非常快，我在网上找了一些图片进行测试。</p> 
<p>鸣人和带土：</p> 
<p style="text-align:center;"><img alt="" height="582" src="https://images2.imgbox.com/7a/66/b2BUJVLY_o.png" width="600"></p> 
<p>柯南和灰原哀：</p> 
<p style="text-align:center;"><img alt="" height="563" src="https://images2.imgbox.com/2c/f8/o8dghaae_o.png" width="600"></p> 
<h3>絮叨</h3> 
<p>使用算法前：</p> 
<p>这样的素描，没有灵魂！</p> 
<p>使用算法后：</p> 
<p style="text-align:center;"><img alt="" height="225" src="https://images2.imgbox.com/18/34/sz2R5E9j_o.gif" width="400"></p> 
<p><strong>拿了一些真人的图片进行了测试，发现效果很差，果然真人的线条还是要复杂一些的。</strong></p> 
<p><strong>最后再送大家一本，帮助我拿到 BAT 等一线大厂 offer 的数据结构刷题笔记，是一位 Google 大神写的，对于算法薄弱或者需要提高的同学都十分受用（提起码：m19c）：</strong></p> 
<p><a href="https://pan.baidu.com/s/1txDItPwDrnG8mOloOFbGaQ" rel="nofollow">BAT 大佬分类总结的 Leetcode 刷题模版，助你搞定 90% 的面试</a></p> 
<p><strong>以及我整理的 BAT 算法工程师学习路线，书籍+视频，完整的学习路线和说明，对于想成为算法工程师的，绝对能有所帮助（提取码：jack）：</strong></p> 
<p><a href="https://pan.baidu.com/s/12tbVrUF056pY7aCyMpgl1w" rel="nofollow">我是如何成为算法工程师的，超详细的学习路线</a></p> 
<p>我是 Jack，我们下期见。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e51c14cdd428a7ae4f3ba6e2100d8b71/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">用AI算法玩起了素描</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/50327b9919894aebb8a93b4200079865/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">关于Ping和Tracert的一些总结</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>