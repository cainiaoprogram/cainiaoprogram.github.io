<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Drools规则引擎的基本使用 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Drools规则引擎的基本使用" />
<meta property="og:description" content="Drools规则引擎的基本使用 1、概述 规则引擎是一种嵌入在应用程序中的组件，实现了将业务决策从应用程序代码中分离出来，并使用预定义的语义模块编写业务决策。接受数据输入，解释业务规则，并根据业务规则做出业务决策。
Drools是一个基于java的规则引擎，开源的，可以将复杂多变的规则从硬编码中解放出来，以规则脚本的形式存放在文件中，使得规则的变更不需要修正代码重启机器就可以立即在线上环境生效。
其前身是 Codehaus 的一个开源项目叫 Drools，最近被纳入 JBoss 门下，更名为 JBoss Rules，成为了 JBoss 应用服务器的规则引擎。
常见规则引擎:
IBM的iLog，商业产品
Drools，开源
最近比较火的FLink CEP，开源
Easy Rule，开源
阿里的qlexpress，开源
2、工作机制 左边是规则，右边是事实(数据)，中间就是执行器(决策引擎)
在 Drools 中，规则被存放在 Production Memory（规则库）中，要匹配的facts（事实）被存在 Working Memory（工作内存）中。当时facts被插入到工作内存中后，规则引擎会把事实和规则库里的模式进行匹配；
对于匹配成功的规则再由 Agenda 负责具体执行推理算法中被激发规则的结论部分，同时 Agenda 通过冲突决策策略管理这些冲突规则的执行顺序，Drools 中规则冲突决策策略有：(1) 优先级策略 (2) 复杂度优先策略 (3) 简单性优先策略 (4) 广度策略 (5) 深度策略 (6) 装载序号策略 (7) 随机策略
3、基本使用 Kmodule配置
&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34; ?&gt; &lt;kmodule xmlns=&#34;http://www.drools.org/xsd/kmodule&#34;&gt; &lt;kbase name=&#34;rules&#34;&gt; &lt;ksession name=&#34;all-rules&#34;&gt;&lt;/ksession&gt; &lt;/kbase&gt; &lt;/kmodule&gt; Fact类：
@Data public class Applicant { private String name; private int age; private boolean valid; ​ public Applicant(String name, int age) { this." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/2acd5c6fbdfb0d04d665fe8cc6a48cc7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-04-07T23:48:40+08:00" />
<meta property="article:modified_time" content="2022-04-07T23:48:40+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Drools规则引擎的基本使用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="Drools_0"></a>Drools规则引擎的基本使用</h2> 
<h3><a id="1_1"></a>1、概述</h3> 
<p>规则引擎是一种嵌入在应用程序中的组件，实现了将业务决策从应用程序代码中分离出来，并使用预定义的语义模块编写业务决策。接受数据输入，解释业务规则，并根据业务规则做出业务决策。</p> 
<p>Drools是一个基于java的规则引擎，开源的，可以将复杂多变的规则从硬编码中解放出来，以规则脚本的形式存放在文件中，使得规则的变更不需要修正代码重启机器就可以立即在线上环境生效。<br> 其前身是 Codehaus 的一个开源项目叫 Drools，最近被纳入 JBoss 门下，更名为 JBoss Rules，成为了 JBoss 应用服务器的规则引擎。</p> 
<p><strong>常见规则引擎:</strong><br> IBM的iLog，商业产品<br> Drools，开源<br> 最近比较火的FLink CEP，开源<br> Easy Rule，开源<br> 阿里的qlexpress，开源</p> 
<h3><a id="2_13"></a>2、工作机制</h3> 
<p><img src="https://images2.imgbox.com/34/4c/bY1GS8Cb_o.png" alt="在这里插入图片描述"><br> 左边是规则，右边是事实(数据)，中间就是执行器(决策引擎)</p> 
<p>在 Drools 中，规则被存放在 Production Memory（规则库）中，要匹配的facts（事实）被存在 Working Memory（工作内存）中。当时facts被插入到工作内存中后，规则引擎会把事实和规则库里的模式进行匹配；</p> 
<p>对于匹配成功的规则再由 Agenda 负责具体执行推理算法中被激发规则的结论部分，同时 Agenda 通过冲突决策策略管理这些冲突规则的执行顺序，Drools 中规则冲突决策策略有：(1) 优先级策略 (2) 复杂度优先策略 (3) 简单性优先策略 (4) 广度策略 (5) 深度策略 (6) 装载序号策略 (7) 随机策略</p> 
<h3><a id="3_20"></a>3、基本使用</h3> 
<p><img src="https://images2.imgbox.com/0b/4e/qktVyCUO_o.png" alt="在这里插入图片描述"><br> <strong>Kmodule配置</strong></p> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8" ?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>kmodule</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.drools.org/xsd/kmodule<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>kbase</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>rules<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ksession</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>all-rules<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ksession</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>kbase</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>kmodule</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p><strong>Fact类：</strong></p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Applicant</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">boolean</span> valid<span class="token punctuation">;</span>
​
    <span class="token keyword">public</span> <span class="token class-name">Applicant</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>valid <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
​
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Action</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> msg<span class="token punctuation">;</span>
​
    <span class="token keyword">public</span> <span class="token class-name">Action</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>msg <span class="token operator">=</span> msg<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
​
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doSomeThing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>规则模板DRL文件</strong></p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>yyds<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>droolsdemo<span class="token punctuation">.</span>rules</span>
​
<span class="token comment">// 导包</span>
<span class="token keyword">import</span> <span class="token namespace">cn<span class="token punctuation">.</span>yyds<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>droolsdemo<span class="token punctuation">.</span></span><span class="token class-name">Applicant</span>
<span class="token keyword">import</span> <span class="token namespace">cn<span class="token punctuation">.</span>yyds<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>droolsdemo<span class="token punctuation">.</span></span><span class="token class-name">Action</span><span class="token punctuation">;</span>
​
rule <span class="token string">"age if valid"</span>  <span class="token comment">// rule名称</span>
when  <span class="token comment">// 触发判断条件</span>
  $a<span class="token operator">:</span> <span class="token class-name">Applicant</span><span class="token punctuation">(</span>age <span class="token operator">&lt;</span> <span class="token number">18</span><span class="token punctuation">)</span>
then  <span class="token comment">// 满足条件后要执行的逻辑</span>
  $a<span class="token punctuation">.</span><span class="token function">setValid</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 可以执行任何java代码（对输入的对象调用方法）</span>
  <span class="token keyword">new</span> <span class="token class-name">Action</span><span class="token punctuation">(</span><span class="token string">"执行动作"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doSomeThing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//可以执行任何java代码（创建对象调方法）</span>
  <span class="token function">insert</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Action</span><span class="token punctuation">(</span><span class="token string">"不合法"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//可以继续给容器插入对象，以触发其他规则</span>
end
</code></pre> 
<p><strong>测试代码:</strong></p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestApp</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">KieServices</span> kieServices <span class="token operator">=</span> <span class="token class-name">KieServices<span class="token punctuation">.</span>Factory</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//默认自动加载 META-INF/kmodule.xml</span>
        <span class="token class-name">KieContainer</span> kieContainer <span class="token operator">=</span> kieServices<span class="token punctuation">.</span><span class="token function">getKieClasspathContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//kmodule.xml 中定义的 ksession name</span>
        <span class="token class-name">KieSession</span> kieSession <span class="token operator">=</span> kieContainer<span class="token punctuation">.</span><span class="token function">newKieSession</span><span class="token punctuation">(</span><span class="token string">"all-rules"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Applicant</span> applicant <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Applicant</span><span class="token punctuation">(</span><span class="token string">"Mr John Smith"</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        kieSession<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>applicant<span class="token punctuation">)</span><span class="token punctuation">;</span>
        kieSession<span class="token punctuation">.</span><span class="token function">fireAllRules</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        kieSession<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>依赖：</strong></p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.drools<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>drools-compiler<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>7.23.0.Final<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h3><a id="4_104"></a>4、语法</h3> 
<p>规则文件可以使用 .drl文件，也可以是 .xml 文件，这里我们使用drl文件。</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>yyds<span class="token punctuation">.</span>drools<span class="token punctuation">.</span>rules</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>
rule <span class="token string">"name"</span>
   no<span class="token operator">-</span>loop <span class="token boolean">true</span>
​
   when
           $message<span class="token operator">:</span><span class="token class-name">Message</span><span class="token punctuation">(</span>status <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
   then
           <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"fit"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           $message<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token function">update</span><span class="token punctuation">(</span>$message<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="1_121"></a>1、基本定义语法</h4> 
<p>package： 对一个规则文件而言，package是必须定义的，必须放在规则文件第一行。特别的是，package的名字是随意的，不必必须对应物理路径，跟java的package的概念不同，这里只是逻辑上的一种区分。同样的package下定义的function和query等可以直接使用。<br> 比如：package com.drools.demo.point</p> 
<p>import： 导入规则文件需要使用到的外部变量，这里的使用方法跟java相同，但是不同于java的是，这里的import导入的不仅仅可以是一个类，也可以是这个类中的某一个可访问的静态方法。</p> 
<p>比如：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>drools<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>point<span class="token punctuation">.</span></span><span class="token class-name">PointDomain</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>drools<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>point<span class="token punctuation">.</span></span><span class="token class-name">PointDomain</span><span class="token punctuation">.</span>getById<span class="token punctuation">;</span>
</code></pre> 
<p>rule： 定义一个规则。rule “ruleName”。一个规则可以包含三个部分：<br> 属性部分：定义当前规则执行的一些属性等，比如是否可被重复执行、过期时间、生效时间等。<br> 条件部分，即LHS，定义当前规则的条件，如 when Message(); 判断当前workingMemory中是否存在Message对象。<br> 结果部分，即RHS，这里可以写普通java代码，即当前规则条件满足后执行的操作，可以直接调用Fact对象的方法来操作应用。</p> 
<h4><a id="2ATTRIBUTE_141"></a>2、属性定义ATTRIBUTE</h4> 
<p>no-loop : 定义当前的规则是否不允许多次循环执行，默认是false，也就是当前的规则只要满足条件，可以无限次执行。什么情况下会出现一条规则执行过一次又被多次重复执行呢？drools提供了一些api，可以对当前传入workingMemory中的Fact对象进行修改或者个数的增减，比如上述的update方法，就是将当前的workingMemory中的Message类型的Fact对象进行属性更新，这种操作会触发规则的重新匹配执行，可以理解为Fact对象更新了，所以规则需要重新匹配一遍，那么疑问是之前规则执行过并且修改过的那些Fact对象的属性的数据会不会被重置？结果是不会，已经修改过了就不会被重置，update之后，之前的修改都会生效。当然对Fact对象数据的修改并不是一定需要调用update才可以生效，简单的使用set方法设置就可以完成，这里类似于java的引用调用，所以何时使用update是一个需要仔细考虑的问题，一旦不慎，极有可能会造成规则的死循环。上述的no-loop true，即设置当前的规则，只执行一次，如果本身的RHS部分有update等触发规则重新执行的操作，也不要再次执行当前规则。</p> 
<p>但是其他的规则会被重新执行，岂不是也会有可能造成多次重复执行，数据紊乱甚至死循环？答案是使用其他的标签限制，也是可以控制的：lock-on-active true</p> 
<p>lock-on-active true：通过这个标签，可以控制当前的规则只会被执行一次，因为一个规则的重复执行不一定是本身触发的，也可能是其他规则触发的，所以这个是no-loop的加强版。当然该标签正规的用法会有其他的标签的配合，后续提及。</p> 
<p>date-expires：设置规则的过期时间，默认的时间格式：“日-月-年”，中英文格式相同，但是写法要用各自对应的语言，比如中文：“29-七月-2010”，但是还是推荐使用更为精确和习惯的格式，这需要手动在java代码中设置当前系统的时间格式，后续提及。属性用法举例：date-expires “2011-01-31 23:59:59” // 这里我们使用了更为习惯的时间格式</p> 
<p>date-effective：设置规则的生效时间，时间格式同上。</p> 
<p>duration：规则定时，duration 3000 ，3秒后执行规则</p> 
<p>salience：优先级，数值越大越先执行，这个可以控制规则的执行顺序。</p> 
<p>其他的属性可以参照相关的api文档查看具体用法，此处略。</p> 
<h4><a id="3LHS_159"></a>3、条件部分LHS</h4> 
<p>when：规则条件开始。条件可以单个，也可以多个，多个条件一次排列，比如</p> 
<pre><code class="prism language-java"> when
         <span class="token function">eval</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
         $customer<span class="token operator">:</span><span class="token class-name">Customer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
         $message<span class="token operator">:</span><span class="token class-name">Message</span><span class="token punctuation">(</span>status<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<p>上述罗列了三个条件，当前规则只有在这三个条件都匹配的时候才会执行RHS部分，三个条件中第一个<br> eval(true)：是一个默认的api，true 无条件执行，类似于 while(true)</p> 
<p>$message:Message(status==0) 这句话标示的：当前的workingMemory存在Message类型并且status属性的值为0的Fact对象，这个对象通常是通过外部java代码插入或者自己在前面已经执行的规则的RHS部分中insert进去的。</p> 
<p>前面的$message代表着当前条件的引用变量，在后续的条件部分和RHS部分中，可以使用当前的变量去引用符合条件的FACT对象，修改属性或者调用方法等。可选，如果不需要使用，则可以不写。</p> 
<p>条件可以有组合，比如：</p> 
<pre><code class="prism language-java"><span class="token class-name">Message</span><span class="token punctuation">(</span>status<span class="token operator">==</span><span class="token number">0</span> <span class="token operator">||</span> <span class="token punctuation">(</span>status <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> status <span class="token operator">&lt;=</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>RHS中对Fact对象private属性的操作必须使用getter和setter方法，而LHS中则必须要直接用.的方法去使用，比如</p> 
<pre><code class="prism language-java">$order<span class="token operator">:</span><span class="token class-name">Order</span><span class="token punctuation">(</span>name<span class="token operator">==</span><span class="token string">"qu"</span><span class="token punctuation">)</span>
$message<span class="token operator">:</span><span class="token class-name">Message</span><span class="token punctuation">(</span>status<span class="token operator">==</span><span class="token number">0</span> <span class="token operator">&amp;&amp;</span> orders contains $order <span class="token operator">&amp;&amp;</span> $order<span class="token punctuation">.</span>name<span class="token operator">==</span><span class="token string">"qu"</span><span class="token punctuation">)</span>
</code></pre> 
<p>特别的是，如果条件全部是 &amp;&amp;关系，可以使用“,”来替代，但是两者不能混用</p> 
<p>如果现在Fact对象中有一个List，需要判断条件，如何判断呢？</p> 
<p>看一个例子，有如下Message类fact对象<br> Message {<!-- --><br> int status;<br> List names;<br> }<br> 判断条件：<br> $message:Message(status==0 &amp;&amp; names contains “网易” &amp;&amp; names.size &gt;= 1)<br> 上述的条件中，status必须是0，并且names列表中含有“网易”并且列表长度大于等于1<br> contains：对比是否包含操作，操作的被包含目标可以是一个复杂对象也可以是一个简单的值。<br> Drools提供了十二中类型比较操作符：</p> 
<blockquote> 
 <blockquote> 
  <p>= &lt; &lt;= == != contains / not contains / memberOf / not memberOf /matches/ not matches<br> not contains：与contains相反。<br> memberOf：判断某个Fact属性值是否在某个集合中，与contains不同的是他被比较的对象是一个集合，而contains被比较的对象是单个值或者对象。<br> not memberOf：正好相反。<br> matches：正则表达式匹配，与java不同的是，不用考虑’/'的转义问题<br> not matches:正好相反。</p> 
 </blockquote> 
</blockquote> 
<h4><a id="4RHS_212"></a>4、结果部分RHS</h4> 
<p>当规则条件满足，则进入规则结果部分执行，结果部分可以是纯java代码，比如：</p> 
<pre><code class="prism language-java">then
       <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"OK"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//会在控制台打印出ok</span>
end
</code></pre> 
<p>当然也可以调用Fact的方法，比如 $message.execute();操作数据库等等一切操作。<br> 结果部分也有drools提供的方法：<br> insert：往当前workingMemory中插入一个新的Fact对象，会触发规则的再次执行，除非使用no-loop限定；<br> update： 更新<br> modify： 修改，与update语法不同，结果都是更新操作<br> retract： 删除</p> 
<p>RHS部分除了调用Drools提供的api和Fact对象的方法，也可以调用规则文件中定义的方法，方法的定义使用 function 关键字</p> 
<pre><code class="prism language-java">function <span class="token keyword">void</span> console <span class="token punctuation">{<!-- --></span>
   <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 调用外部静态方法，StringUtils必须使用import导入，getId()必须是静态方法</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="5declare_237"></a>5、类声明declare</h4> 
<p>Drools还有一个可以定义类的关键字：<br> declare 可以再规则文件中定义一个class，使用起来跟普通java对象相似，你可以在RHS部分中new一个并且使用getter和setter方法去操作其属性。</p> 
<pre><code class="prism language-java">declare <span class="token class-name">Address</span>
  <span class="token annotation punctuation">@author</span><span class="token punctuation">(</span>quzishen<span class="token punctuation">)</span> <span class="token comment">// 元数据，仅用于描述信息</span>
  <span class="token annotation punctuation">@createTime</span><span class="token punctuation">(</span><span class="token number">2011</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">24</span><span class="token punctuation">)</span>
  city <span class="token operator">:</span> <span class="token class-name">String</span> <span class="token annotation punctuation">@maxLengh</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
  postno <span class="token operator">:</span> <span class="token keyword">int</span>
end
</code></pre> 
<p>上述的’@'是什么呢？是元数据定义，用于描述数据的数据~，没什么执行含义<br> 可以在RHS部分中使用Address address = new Address()的方法来定义一个对象。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/499cc486b4dd0d5c05d60f43613709ff/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">使用docker搭建upload-labs</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/01eac34f7e8d3546a36f10259a7a0c97/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">在linux安装pyrit</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>