<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Yocto编译与分析 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Yocto编译与分析" />
<meta property="og:description" content="本文针对的是yocto(linux)的编译与分析，分享一下自己学习的心得。
文章目录 一、yocto是什么？二、工作步骤1.OpenEmbedded工作流2.流程解读 三.编译问题1.不支持UTF-8 （如图所示）2.将warnings视为errors(如图所示)3.do_fetch失败（如图所示） 四.编译过程中tips1.限制线程的数量2.编译成功后rootfs.img的位置 五.Bitbake编译1.编译步骤 总结 一、yocto是什么？ Yocto 项目是一个开源协作项目，可帮助开发人员创建基于 Linux 的定制系统，这些系统专为嵌入式产品而设计，无论产品的硬件架构如何。
分析一下目录结构，主要有三级构成：
meta-xxx-&gt;recipes-yyy-&gt;zzz/ttt.bb。
比如：meta-rockchip-&gt; recipes-kernel-&gt;linux-firmware
Yocto中一个软件包是放在bb文件中的，然后很多的bb文件集成一个recipe（配方），然后许多的recipe又组成一个meta layer(层)。配方文件分为bb文件和bbappend文件。（bbappend和bb的区别主要在于bbappend是基于bb的，功能是对相应的bb文件作补充和覆盖，有点类似于“重写”的概念）。
在yocto目录下，放工具的bitbake目录、放元数据的目录、和执行构建的build目录这三个目录比较重要：
bitbake目录： bitbake工具。
元数据目录： 在poky中元数据目录是meta。在元数据目录中，有3个目录里是真正的元数据：classes、conf、packages。
build目录: build是我们烹饪嵌入式系统的大厨房。整个构建过程就是在build目录的tmp子目录完成的。 build目录的conf子目录里是用户的配置文件local.conf。
二、工作步骤 1.OpenEmbedded工作流 视频链接：https://youtu.be/-cXvE4VyyA8
2.流程解读 首先，开发人员指定架构、策略、补丁和配置细节。然后构建系统从指定的位置获取和下载源代码。该项目支持标准方法，例如 tarball 或源代码存储库系统，例如 git。下载后，源代码将被提取到本地工作区，在该工作区应用补丁并运行配置和编译软件的通用步骤。然后将软件安装到临时暂存区，您选择的二进制包格式（deb、rpm 或 ipk）将用于汇总软件。在整个构建过程中运行不同的 QA 和健全性检查。创建二进制文件后，会生成一个二进制包提要，然后用于创建最终的根文件映像。生成文件系统映像。 三.编译问题 1.不支持UTF-8 （如图所示） 解决方法：
locale-gen en_US.UTF-8 export LANG=en_US.UTF-8 LANGUAGE=en_US.en LC_ALL=en_US.UTF-8 2.将warnings视为errors(如图所示) 原因：如果加上 -Wextra 选项会告知编译器做更深度的检查报告, -Wextra 还有更多的检查，打印一些额外的警告信息。上面只是其中一个 -Wall 没包含但很有用的一个检查。
解决方法：
下载代码后，编译前；在…/yocto/meta-rockchip/recipes-multimedia/gstreamer-rockchip/文件夹下面：
新建files文件夹，并将上面的patch文件放入即可。
3.do_fetch失败（如图所示） 解决方法：
1.查看URL是否可以打开，若无法打开，首先验证网络是否正常
若链接可以打开，正常下载，则是网络波动问题。
2.若网络正常，URL无法打开，则是链接出错，选择其他有效链接
四.编译过程中tips 1.限制线程的数量 在…/yocto/build/conf/include/common.conf配置文件中增加：
BB_NUMBER_THREADS = ‘16’ PARALLEL_MAKE =’-j 16’ (第一行修改编译线程的数量，改为多线程)" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/b85d5b2608fbd688438b1395918f85a7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-01-21T17:43:41+08:00" />
<meta property="article:modified_time" content="2022-01-21T17:43:41+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Yocto编译与分析</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><font color="#999AAA">本文针对的是yocto(linux)的编译与分析，分享一下自己学习的心得。</font></p> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#yocto_12" rel="nofollow">一、yocto是什么？</a></li><li><a href="#_28" rel="nofollow">二、工作步骤</a></li><li><ul><li><a href="#1OpenEmbedded_29" rel="nofollow">1.OpenEmbedded工作流</a></li><li><a href="#2_37" rel="nofollow">2.流程解读</a></li></ul> 
  </li><li><a href="#_47" rel="nofollow">三.编译问题</a></li><li><ul><li><a href="#1UTF8__48" rel="nofollow">1.不支持UTF-8 （如图所示）</a></li><li><a href="#2warningserrors_55" rel="nofollow">2.将warnings视为errors(如图所示)</a></li><li><a href="#3do_fetch_63" rel="nofollow">3.do_fetch失败（如图所示）</a></li></ul> 
  </li><li><a href="#tips_70" rel="nofollow">四.编译过程中tips</a></li><li><ul><li><a href="#1_71" rel="nofollow">1.限制线程的数量</a></li><li><a href="#2rootfsimg_80" rel="nofollow">2.编译成功后rootfs.img的位置</a></li></ul> 
  </li><li><a href="#Bitbake_85" rel="nofollow">五.Bitbake编译</a></li><li><ul><li><a href="#1_86" rel="nofollow">1.编译步骤</a></li></ul> 
  </li><li><a href="#_108" rel="nofollow">总结</a></li></ul> 
</div> 
<p></p> 
<hr color="#000000" size='1"'> 
<h2><a id="yocto_12"></a>一、yocto是什么？</h2> 
<p>Yocto 项目是一个开源协作项目，可帮助开发人员创建基于 Linux 的定制系统，这些系统专为嵌入式产品而设计，无论产品的硬件架构如何。</p> 
<p>分析一下目录结构，主要有三级构成：<br> meta-xxx-&gt;recipes-yyy-&gt;zzz/ttt.bb。<br> 比如：meta-rockchip-&gt; recipes-kernel-&gt;linux-firmware<br> Yocto中一个软件包是放在bb文件中的，然后很多的bb文件集成一个recipe（配方），然后许多的recipe又组成一个meta layer(层)。配方文件分为bb文件和bbappend文件。（bbappend和bb的区别主要在于bbappend是基于bb的，功能是对相应的bb文件作补充和覆盖，有点类似于“重写”的概念）。</p> 
<p>在yocto目录下，放工具的bitbake目录、放元数据的目录、和执行构建的build目录这三个目录比较重要：<br> bitbake目录： bitbake工具。<br> 元数据目录： 在poky中元数据目录是meta。在元数据目录中，有3个目录里是真正的元数据：classes、conf、packages。<br> build目录: build是我们烹饪嵌入式系统的大厨房。整个构建过程就是在build目录的tmp子目录完成的。 build目录的conf子目录里是用户的配置文件local.conf。</p> 
<h2><a id="_28"></a>二、工作步骤</h2> 
<h3><a id="1OpenEmbedded_29"></a>1.OpenEmbedded工作流</h3> 
<p><img src="https://images2.imgbox.com/75/76/tyiYMw8Y_o.png" alt="在这里插入图片描述"><br> 视频链接：https://youtu.be/-cXvE4VyyA8</p> 
<h3><a id="2_37"></a>2.流程解读</h3> 
<ol><li>首先，开发人员指定架构、策略、补丁和配置细节。</li><li>然后构建系统从指定的位置获取和下载源代码。该项目支持标准方法，例如 tarball 或源代码存储库系统，例如 git。</li><li>下载后，源代码将被提取到本地工作区，在该工作区应用补丁并运行配置和编译软件的通用步骤。</li><li>然后将软件安装到临时暂存区，您选择的二进制包格式（deb、rpm 或 ipk）将用于汇总软件。</li><li>在整个构建过程中运行不同的 QA 和健全性检查。</li><li>创建二进制文件后，会生成一个二进制包提要，然后用于创建最终的根文件映像。</li><li>生成文件系统映像。</li></ol> 
<h2><a id="_47"></a>三.编译问题</h2> 
<h3><a id="1UTF8__48"></a>1.不支持UTF-8 （如图所示）</h3> 
<p><img src="https://images2.imgbox.com/0b/ce/1UvrfCR5_o.png" alt="在这里插入图片描述"><br> 解决方法：</p> 
<pre><code>        locale-gen en_US.UTF-8 
        export LANG=en_US.UTF-8 LANGUAGE=en_US.en LC_ALL=en_US.UTF-8
</code></pre> 
<h3><a id="2warningserrors_55"></a>2.将warnings视为errors(如图所示)</h3> 
<p><img src="https://images2.imgbox.com/62/f5/wFxyorVo_o.png" alt="在这里插入图片描述">原因：如果加上 -Wextra 选项会告知编译器做更深度的检查报告, -Wextra 还有更多的检查，打印一些额外的警告信息。上面只是其中一个 -Wall 没包含但很有用的一个检查。</p> 
<p>解决方法：<br> <img src="https://images2.imgbox.com/1a/8a/CmwbwbSF_o.png" alt="在这里插入图片描述"><br> 下载代码后，编译前；在…/yocto/meta-rockchip/recipes-multimedia/gstreamer-rockchip/文件夹下面：<br> 新建files文件夹，并将上面的patch文件放入即可。</p> 
<h3><a id="3do_fetch_63"></a>3.do_fetch失败（如图所示）</h3> 
<p><img src="https://images2.imgbox.com/2e/69/FVnCTusi_o.png" alt="在这里插入图片描述"><br> 解决方法：<br> 1.查看URL是否可以打开，若无法打开，首先验证网络是否正常<br> 若链接可以打开，正常下载，则是网络波动问题。<br> 2.若网络正常，URL无法打开，则是链接出错，选择其他有效链接</p> 
<h2><a id="tips_70"></a>四.编译过程中tips</h2> 
<h3><a id="1_71"></a>1.限制线程的数量</h3> 
<p>在…/yocto/build/conf/include/common.conf配置文件中增加：</p> 
<pre><code>            BB_NUMBER_THREADS = ‘16’ 
            PARALLEL_MAKE =’-j 16’
</code></pre> 
<p>(第一行修改编译线程的数量，改为多线程)<br> (第二行修改cpu核的数量，根据实际情况修改)</p> 
<h3><a id="2rootfsimg_80"></a>2.编译成功后rootfs.img的位置</h3> 
<p>编译后<br> 在docker中yocto/ build/lastest 目录下生成 rootfs.img。<br> 在服务器的yocto/ build/lastest 目录下只是软链接，具体看软链接内容。<br> 也可以通过./mkfirmware.sh来打包，在…/rockdev下面生成rootfs.img.</p> 
<h2><a id="Bitbake_85"></a>五.Bitbake编译</h2> 
<h3><a id="1_86"></a>1.编译步骤</h3> 
<p>1．sudo su<br> 2. cd …/yocto<br> 3. source oe-init-build-env （进入build目录）<br> 4. bitbake +，bitbake具体命令如下：</p> 
<p>直接编译文件系统:<br> bitbake core-image-minimal<br> 重新编译u-boot:<br> bitbake -c compile -f u-boot（-v）<br> 只下载不编译：<br> bitbake -c fetchall core-image-minimal<br> 下载特定的包：<br> bitbake packagename -c fetch<br> 查看软件依赖关系：<br> bitbake –g packagename</p> 
<p>Bitbake前可以加入time，是为了看看最终需要多长时间。</p> 
<p>下图为bitbake的一些常用命令：<br> <img src="https://images2.imgbox.com/80/61/tXwCL7tg_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_108"></a>总结</h2> 
<p>本文主要讲了yocto系统的含义与编译。更为深层次的知识点未加上，例如：bb文件的含义与攥写，layer.conf文件架构以及如何往最终的系统中加入自定义软件包（hello等）。后续在更新！期待你的点赞~</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4a4ac58e54e9c2d2df20ba18a8174b93/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">[树梢]利用dom4j模拟spring的getbean功能</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/420588049a6affcf36ef30ffb7bce4b1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">SQL注入写shell权限</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>