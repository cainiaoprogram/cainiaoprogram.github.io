<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android 录音实现（MediaRecorder） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Android 录音实现（MediaRecorder）" />
<meta property="og:description" content="最近在项目中实现录音功能，并在逻辑中还有对录音文件的特殊要求，前前后后看了很多资料，学习了很多，今天在这里分享记录一下，以便后期回看。
Android提供了两个API用于录音的实现：MediaRecorder 和AudioRecord。
MediaRecorder：录制的音频文件是经过压缩后的，需要设置编码器。并且录制的音频文件可以用系统自带的Music播放器播放。MediaRecorder已经集成了录音、编码、压缩等，并支持少量的录音音频格式，但是这也是他的缺点，支持的格式过少并且无法实时处理音频数据。
AudioRecord：主要实现对音频实时处理以及边录边播功能，相对MediaRecorder比较专业，输出是PCM语音数据，如果保存成音频文件，是不能够被播放器播放的，所以必须先写代码实现数据编码以及压缩。
MediaRecorder MediaRecorder因为已经集成了录音、编码、压缩等功能，所以使用起来相对比较简单。
开始录音
MediaRecorder 使用起来相对简单，音频编码可以根据自己实际需要自己设定，文件名防止重复，使用了日期_时分秒的结构，audioSaveDir 是文件存储目录，可自行设定。下面贴出示例代码：
public void startRecord() {
// 开始录音
/* ①Initial：实例化MediaRecorder对象 */
if (mMediaRecorder == null)
mMediaRecorder = new MediaRecorder();
try {
/* ②setAudioSource/setVedioSource */
mMediaRecorder.setAudioSource(MediaRecorder.AudioSource.MIC);// 设置麦克风
/*
* ②设置输出文件的格式：THREE_GPP/MPEG-4/RAW_AMR/Default THREE_GPP(3gp格式
* ，H263视频/ARM音频编码)、MPEG-4、RAW_AMR(只支持音频且音频编码要求为AMR_NB)
*/
mMediaRecorder.setOutputFormat(MediaRecorder.OutputFormat.MPEG_4);
/* ②设置音频文件的编码：AAC/AMR_NB/AMR_MB/Default 声音的（波形）的采样 */
mMediaRecorder.setAudioEncoder(MediaRecorder.AudioEncoder.AAC);
fileName = DateFormat.format(&#34;yyyyMMdd_HHmmss&#34;, Calendar.getInstance(Locale.CHINA)) &#43; &#34;.m4a&#34;;
if (!FileUtils.isFolderExist(FileUtils.getFolderName(audioSaveDir))) {
FileUtils.makeFolders(audioSaveDir);
}
filePath = audioSaveDir &#43; fileName;
/* ③准备 */
mMediaRecorder.setOutputFile(filePath);
mMediaRecorder.prepare();" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/58272ad866f690a42524ac377415aafb/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-10-12T15:11:31+08:00" />
<meta property="article:modified_time" content="2021-10-12T15:11:31+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android 录音实现（MediaRecorder）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>最近在项目中实现录音功能，并在逻辑中还有对录音文件的特殊要求，前前后后看了很多资料，学习了很多，今天在这里分享记录一下，以便后期回看。</p> 
<p>Android提供了两个API用于录音的实现：MediaRecorder 和AudioRecord。</p> 
<ol><li> <p>MediaRecorder：录制的音频文件是经过压缩后的，需要设置编码器。并且录制的音频文件可以用系统自带的Music播放器播放。MediaRecorder已经集成了录音、编码、压缩等，并支持少量的录音音频格式，但是这也是他的缺点，支持的格式过少并且无法实时处理音频数据。</p> </li><li> <p>AudioRecord：主要实现对音频实时处理以及边录边播功能，相对MediaRecorder比较专业，输出是PCM语音数据，如果保存成音频文件，是不能够被播放器播放的，所以必须先写代码实现数据编码以及压缩。</p> </li></ol> 
<h4>MediaRecorder</h4> 
<p>MediaRecorder因为已经集成了录音、编码、压缩等功能，所以使用起来相对比较简单。</p> 
<p>开始录音</p> 
<p>MediaRecorder 使用起来相对简单，音频编码可以根据自己实际需要自己设定，文件名防止重复，使用了日期_时分秒的结构，audioSaveDir 是文件存储目录，可自行设定。下面贴出示例代码：</p> 
<p><br> public void startRecord() {<!-- --><br>     // 开始录音<br>     /* ①Initial：实例化MediaRecorder对象 */<br>     if (mMediaRecorder == null)<br>         mMediaRecorder = new MediaRecorder();<br>     try {<!-- --><br>         /* ②setAudioSource/setVedioSource */<br>         mMediaRecorder.setAudioSource(MediaRecorder.AudioSource.MIC);// 设置麦克风<br>         /*<br>          * ②设置输出文件的格式：THREE_GPP/MPEG-4/RAW_AMR/Default THREE_GPP(3gp格式<br>          * ，H263视频/ARM音频编码)、MPEG-4、RAW_AMR(只支持音频且音频编码要求为AMR_NB)<br>          */<br>         mMediaRecorder.setOutputFormat(MediaRecorder.OutputFormat.MPEG_4);<br>         /* ②设置音频文件的编码：AAC/AMR_NB/AMR_MB/Default 声音的（波形）的采样 */<br>         mMediaRecorder.setAudioEncoder(MediaRecorder.AudioEncoder.AAC);<br>         fileName = DateFormat.format("yyyyMMdd_HHmmss", Calendar.getInstance(Locale.CHINA)) + ".m4a";<br>         if (!FileUtils.isFolderExist(FileUtils.getFolderName(audioSaveDir))) {<!-- --><br>             FileUtils.makeFolders(audioSaveDir);<br>         }<br>         filePath = audioSaveDir + fileName;<br>         /* ③准备 */<br>         mMediaRecorder.setOutputFile(filePath);<br>         mMediaRecorder.prepare();<br>         /* ④开始 */<br>         mMediaRecorder.start();<br>     } catch (IllegalStateException e) {<!-- --><br>         LogUtil.i("call startAmr(File mRecAudioFile) failed!" + e.getMessage());<br>     } catch (IOException e) {<!-- --><br>         LogUtil.i("call startAmr(File mRecAudioFile) failed!" + e.getMessage());<br>     }<br> }</p> 
<p></p> 
<p>上面代码只是基本使用方式，具体使用还需结合项目具体需求制定具体逻辑，但是MediaRecorder使用时需实例化，所以在不用时一定要记得即时释放，以免造成内存泄漏。</p> 
<p>结束录音</p> 
<p>public void stopRecord() {<!-- --><br>     try {<!-- --><br>         mMediaRecorder.stop();<br>         mMediaRecorder.release();<br>         mMediaRecorder = null;<br>         filePath = "";<br>     } catch (RuntimeException e) {<!-- --><br>         LogUtil.e(e.toString());<br>         mMediaRecorder.reset();<br>         mMediaRecorder.release();<br>         mMediaRecorder = null;</p> 
<p>        File file = new File(filePath);<br>         if (file.exists())<br>             file.delete();</p> 
<p>        filePath = "";<br>     }<br> }</p> 
<p></p> 
<p>总结：MediaRecorder 实现录音还是比较简单的，代码量相对较少，较为简明，但也有不足之处，例如输出文件格式选择较少，录音过程不能暂停等。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/182199e02231f145d738e6483f066954/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">vue，小程序，html，js 60道常见面试题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/168126a35dbd582ea9167fdb241d698e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">哈工大｜NLP数据增强方法？我有15种</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>