<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>[yocto]bitbake使用详解 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="[yocto]bitbake使用详解" />
<meta property="og:description" content="bitbake安装 git clone git://git.openembedded.org/bitbake ./bitbake安装完成 tree -L 1 . ├── AUTHORS ├── bin ├── ChangeLog ├── classes ├── conf ├── contrib ├── doc ├── lib ├── LICENSE ├── LICENSE.GPL-2.0-only ├── LICENSE.MIT ├── MANIFEST.in ├── README ├── toaster-requirements.txt └── TODO 设置环境变量 export PATH=/home/xxx/Poky/test/bitbake/bin:$PATH 简单测试 bitbake --version BitBake Build Tool Core version 2.2.0 bitbake执行环境 conf/bblayer.conf 在开始执行时，bitbake首先在当前工作目录中寻找conf/bblayer.conf文件非必须，但是所有使用层的运行环境中都包括该文件BBLAYERS变量 指向所有层的路径 conf/layer.conf 每个层都有自己层配置文件，bblayer.conf中指定的路径下可以检索出层独有的层配置文件BBPATH bittbake使用该变量检索.class(classes文件夹)和.conf(conf文件夹)文件BBFILES 指定菜谱文件BBFILE_COLLECTIONS 通过&#43;=追加当前层的名字BBFILE_PATTERN_xxx 指定xxx层菜谱文件路径BBFILE_PRIORITY_xxx 指定xxx层的优先级 数值越大优先级越高如果多个层中出现同名菜谱，bitbake选择高优先级的菜谱进行编译优先级也决定了追加菜谱文件的顺序 任务 task bitbake可以在配方文件中定义shell或者python函数作为可执行元数据，而具体实现依靠task完成
bitbake把特殊函数当作任务，任务被定义在菜谱和类文件中针对特殊菜谱直接从bitbake命令行调用定义格式为： do_xxxxxdo_configure () { # Specify any needed configure commands here } addtask configure do_compile () { # You will almost certainly need to add additional arguments here oe_runmake -f makefile } addtask compile before do_install after do_configure do_install () { oe_runmake -f makefile install } addtask install after compile python do_clean(){ ##可以添加匿名python函数task #python function } add clean 执行task： bitbake task." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/67206a5b7d88b5c78ff395b961c4b929/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-20T13:59:44+08:00" />
<meta property="article:modified_time" content="2023-02-20T13:59:44+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">[yocto]bitbake使用详解</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="bitbake_0"></a><code>bitbake</code>安装</h3> 
<ul><li><code>git clone git://git.openembedded.org/bitbake ./bitbake</code></li><li>安装完成 <code>tree -L 1</code></li></ul> 
<pre><code class="prism language-c"><span class="token punctuation">.</span>
├── AUTHORS
├── bin
├── ChangeLog
├── classes
├── conf
├── contrib
├── doc
├── lib
├── LICENSE
├── LICENSE<span class="token punctuation">.</span>GPL<span class="token operator">-</span><span class="token number">2.0</span><span class="token operator">-</span>only
├── LICENSE<span class="token punctuation">.</span>MIT
├── MANIFEST<span class="token punctuation">.</span>in
├── README
├── toaster<span class="token operator">-</span>requirements<span class="token punctuation">.</span>txt
└── TODO
</code></pre> 
<ul><li>设置环境变量</li></ul> 
<pre><code class="prism language-c">export PATH<span class="token operator">=</span><span class="token operator">/</span>home<span class="token operator">/</span>xxx<span class="token operator">/</span>Poky<span class="token operator">/</span>test<span class="token operator">/</span>bitbake<span class="token operator">/</span>bin<span class="token operator">:</span>$PATH
</code></pre> 
<ul><li>简单测试 <code>bitbake --version</code></li></ul> 
<pre><code class="prism language-c">BitBake Build Tool Core version <span class="token number">2.2</span><span class="token number">.0</span>
</code></pre> 
<h3><a id="bitbake_30"></a><code>bitbake</code>执行环境</h3> 
<ul><li><code>conf/bblayer.conf</code> 
  <ul><li>在开始执行时，bitbake首先在当前工作目录中寻找<code>conf/bblayer.conf</code></li><li>文件非必须，但是所有使用层的运行环境中都包括该文件</li><li><code>BBLAYERS</code>变量 指向所有层的路径</li></ul> </li><li><code>conf/layer.conf</code> 
  <ul><li>每个层都有自己层配置文件，<code>bblayer.conf</code>中指定的路径下可以检索出层独有的层配置文件</li><li><code>BBPATH</code> bittbake使用该变量检索.<code>class</code>(<code>classes</code>文件夹)和<code>.conf</code>(<code>conf</code>文件夹)文件</li><li><code>BBFILES</code> 指定菜谱文件</li><li><code>BBFILE_COLLECTIONS</code> 通过<code>+=</code>追加当前层的名字</li><li><code>BBFILE_PATTERN_xxx</code> 指定xxx层菜谱文件路径</li><li><code>BBFILE_PRIORITY_xxx</code> 指定xxx层的优先级 
    <ul><li>数值越大优先级越高</li><li>如果多个层中出现同名菜谱，bitbake选择高优先级的菜谱进行编译</li><li>优先级也决定了追加菜谱文件的顺序</li></ul> </li></ul> </li></ul> 
<h3><a id="_task_48"></a>任务 task</h3> 
<p><code>bitbake</code>可以在配方文件中定义<code>shell</code>或者<code>python</code>函数作为可执行元数据，而具体实现依靠<code>task</code>完成</p> 
<ul><li><code>bitbake</code>把特殊函数当作任务，任务被定义在菜谱和类文件中</li><li>针对特殊菜谱直接从<code>bitbake</code>命令行调用</li><li>定义格式为： <code>do_xxxxx</code><pre><code class="prism language-c"><span class="token function">do_configure</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Specify any needed configure commands here</span></span>
<span class="token punctuation">}</span>
addtask configure
<span class="token function">do_compile</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">You will almost certainly need to add additional arguments here</span></span>
	oe_runmake <span class="token operator">-</span>f makefile
<span class="token punctuation">}</span>
addtask compile before do_install after do_configure
<span class="token function">do_install</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	oe_runmake <span class="token operator">-</span>f makefile install
<span class="token punctuation">}</span>
addtask install after compile
python <span class="token function">do_clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	##可以添加匿名python函数task
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">python</span> <span class="token expression">function</span></span>
<span class="token punctuation">}</span>
add clean
</code></pre> </li><li>执行task： <code>bitbake task.bb -c clean</code> 上述task放在task.bb 
  <ul><li>菜谱中使用before和after指令一起增加任务install 和 configure，创建执行链 
    <ul><li><code>bitbake task.bb -c compile</code></li><li>首先执行configure 再compile 最后install</li><li>假如别的task也是用before和after 那么链接关系仍然执行</li></ul> </li></ul> </li></ul> 
<h3><a id="bitbake__80"></a><code>bitbake</code> 命令</h3> 
<ul><li><code>bitbake packagename</code> 编译packagename</li><li><code>bitbake -c taskname packagename</code> 执行packagename的taskname任务</li><li><code>bitbake -e packagename</code> 显示生成的任务环境脚本</li></ul> 
<h3><a id="_85"></a>依赖</h3> 
<ul><li>依赖类型 
  <ul><li>构建依赖</li><li>运行时依赖</li></ul> </li><li>配置 
  <ul><li>菜谱使用<code>PROVIDDES</code>变量来声名他们的名字和功能性，然后其他菜谱文件可以用其来表达对软件包的依赖</li><li>配置类型 
    <ul><li>隐式配置·：假如不显式设置<code>PN</code>、<code>PV</code>和<code>PR</code>，那么<code>bitbake</code>会根据包名自动设置三个变量</li><li>显式配置</li><li>符号配置</li></ul> </li></ul> </li><li>依赖 
  <ul><li><code>DEPENDS</code> 编译依赖 
    <ul><li><strong>强制</strong>依赖： 构建包的菜谱的所有任务完成之后，依赖于那个包的菜谱才开始第一个<code>task</code></li><li>元数据属性deptsak ：<code>do_compile[deptask]= “do_pre_compile”</code> 
      <ul><li>包含在<code>DEPENDS</code>中的每个菜谱的<code>do_pre_compile</code>任务都必须在这个菜谱的<code>do_compile</code>运行之前完成</li></ul> </li></ul> </li><li><code>RDEPENDS</code> 运行时依赖，不强制要求在编译阶段就依赖 
    <ul><li>元数据属性rdeptsak ：<code>do_package_r[deptask]= “do_package”</code> 
      <ul><li><code>do_package_r</code>任务<strong>不能</strong>在运行时所依赖的所有包<em>完成其打包步骤之前运行</em></li></ul> </li></ul> </li><li>变量所依赖的包都需要<code>PROVIDDES</code>变量提供他们的名字</li></ul> </li><li>多个提供器 
  <ul><li>通过符号配置，多个包可以满足另一个包的构建或运行时依赖 
    <ul><li>例如多个来源的<code>opencv</code>，但是只需要一个有效即可<pre><code class="prism language-c"> source1<span class="token punctuation">.</span>bb<span class="token operator">:</span> PROVIDES <span class="token operator">=</span> <span class="token string">"opencv"</span>
 source2<span class="token punctuation">.</span>bb<span class="token operator">:</span> PROVIDES <span class="token operator">=</span> <span class="token string">"opencv"</span>
</code></pre> </li></ul> </li><li>配置<code>PREFERRED_PROVIDER</code>： 选择一个目标依赖使用<pre><code class="prism language-c"> PREFERRED_PROVIDER_opencv <span class="token operator">=</span>  <span class="token string">"source1"</span>
</code></pre> </li></ul> </li></ul> 
<h3><a id="_117"></a>变量</h3> 
<ul><li>内部获取的变量 
  <ul><li>从当前的上下文获取针对以下变量的值</li><li><code>FILE</code>：<code>bitbake</code>正在处理的文件的完整路径 
    <ul><li>文件可以是一个配置文件、一个菜谱、一个类等</li></ul> </li><li><code>LAYERDIR</code>：当<code>BitBake</code>处理那一层时，它把这个变量设置为到当前层的目录的完整路径</li><li><code>TOPDIR</code>：项目顶层目录</li></ul> </li><li>项目特定的变量<br> - <code>bitbake</code>特有<br> - <code>BBFILES</code>：空格分隔的针对菜谱的路径列表 
  <ul><li>层<code>layer.conf</code>配置文件扩展这个变量检索层下的所有配方文件</li></ul> </li><li><code>BBLAYERS</code>：当<code>BitBake</code>处理那一层时，它把这个变量设置为到当前层的目录的完整路径</li><li><code>BBPATH</code>：<code>BitBake</code>使用这个变量在一个名为<code>classes</code>的子目录中定位类(<code>.bbclass文件</code>);在一个名为conf的子目录中定位配置文件(<code>.conf文件</code>)以及在其他子目录中定位文件 
  <ul><li>变量包含一个由冒号(<code>:</code>)分隔的目录路径列表。层通常增加它们的顶级目录到这个变量：<code>BBPATH.="：${LAYERDIR}"</code>。<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">We have a conf and classes directory<span class="token punctuation">,</span> add to BBPATH</span></span>
BBPATH <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token string">":${LAYERDIR}"</span>

<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">We have recipes<span class="token operator">-</span><span class="token operator">*</span> directories<span class="token punctuation">,</span> add to BBFILES</span></span>
BBFILES <span class="token operator">+=</span> <span class="token string">"${LAYERDIR}/recipes-*/*/*.bb \
            ${LAYERDIR}/recipes-*/*/*.bbappend \
            ${LAYERDIR}/recipes-*/*/*/*.bb \
            ${LAYERDIR}/recipes-*/*/*/*.bbappend \
            "</span>
</code></pre> </li></ul> </li><li>标准运行时变量 
  <ul><li>这些变量通常被conf/bitbake.conf文件初始化</li><li>路径 
    <ul><li>poky/meta/conf/bitbake.conf</li><li>openembedded-core/meta/conf/bitbake.conf</li></ul> </li><li><code>B</code>：到<code>bitbake</code>构建一个源包所在的目录的完整路径</li><li><code>BUILD_ARCH</code>：构建主机的<code>CPU</code>架构</li><li><code>CACHE</code>：到用于元数据缓存的目录的完整路径，它通常存在于构建环境的内部 
    <ul><li>当<code>bitbake</code>在一个构建环境中第一次被运行时，它解析所有元数据文件和菜谱并且创建一个在后续运行时从那里读取的缓存</li><li>这改进了执行速度</li><li>一个元数据变化使缓存失效并且导致<code>bitbake</code>重新创建它</li></ul> </li><li><code>DEPENDS</code>：包依赖性</li><li><code>DEPLOY_DIR</code>：放置所有用于部署的文件所在的基础目录的完整路径 
    <ul><li>例如目标镜像、包源和许可程序清单</li></ul> </li><li><code>DEPLOY_DIR_IMAGE</code>：复制目标二进制镜像所在目录的完整路径</li><li><code>DL_DIR</code>：下载文件存放目录</li><li><code>FILE_DIRNAME</code>：到包含BitBake正在处理的文件的目录的路径</li><li><code>FILESDIR</code>：bitbake寻找本地文件所在目录的完整路径 
    <ul><li>BitBake仅仅当它不能在任何列于FILESPATH中的目录中找到文件时使用这个变量</li><li>对这个变量的最常见的用例在追加文件中(.bbappend)</li></ul> </li><li><code>FILESPATH</code>：这个变量包含一个冒号分隔的、bitbake的本地获取器为了匹配本地文件所搜索的完整目录路径列表</li><li><code>MKTEMPCMD</code>: bitbake用来创建临时文件的命令</li><li><code>MKTEMPDIRCMD</code>: bitbake用来创建临时目录的命令</li><li><code>OVERRIDES</code>：冒号分隔的条件覆盖的优先级列表 
    <ul><li>bitbake从右到左处理这个列表，所以后面列出的有更高优先级</li></ul> </li><li><code>P</code>：用横线（-）连接的包名、版本：<code>P="${PN}-${PV}"</code></li><li><code>PERSISTENT_DIR</code>：持久存储文件所在目录路径 
    <ul><li><code>CACHE</code>和<code>PERSISTENT_DIR</code>变量可以互换使用。其中之一必须被设置。</li><li>如果<code>PERSISTENT_DIR</code>没有被设置，使用<code>CACHE</code></li></ul> </li><li><code>PF</code>：用横线（-）连接的包名、版本和修订</li><li><code>PN</code>：包名(默认从菜谱文件名中获取/或显式设置)</li><li><code>PR</code>：包修订(默认从菜谱文件名中获取/或显式设置)</li><li><code>PROVIDES</code>：空格分隔的、声明一个包提供了什么的名字列表 
    <ul><li>其他菜谱可以使用这些名字来声明它们对这个包的依赖</li></ul> </li><li><code>PV</code>：包版本(默认从菜谱文件名中获取/或显式设置)</li><li><code> S</code>：放置已解压文件目录</li><li><code>TARGET_ARCH</code>：CPU架构</li><li><code>TMPDIR</code>：构建输出的顶级目录；</li><li><code>WORKDIR</code>：<code>bitbake</code>包储存路径并且存储所有与包的构建过程相关的日志信息</li></ul> </li><li>菜谱常用变量 : 以<code>gettext_0.21.bb</code>为例<pre><code class="prism language-c">SUMMARY <span class="token operator">=</span> <span class="token string">"Utilities and libraries for producing multi-lingual messages"</span>
DESCRIPTION <span class="token operator">=</span> <span class="token string">"GNU gettext is a set of tools that provides a framework to help other programs produce multi-lingual messages. \
These tools include a set of conventions about how programs should be written to support message catalogs, a directory and file \
naming organization for the message catalogs themselves, a runtime library supporting the retrieval of translated messages, and \
a few stand-alone programs to massage in various ways the sets of translatable and already translated strings."</span>
HOMEPAGE <span class="token operator">=</span> <span class="token string">"http://www.gnu.org/software/gettext/gettext.html"</span>
SECTION <span class="token operator">=</span> <span class="token string">"libs"</span>
LICENSE <span class="token operator">=</span> <span class="token string">"GPL-3.0-or-later &amp; LGPL-2.1-or-later"</span>
LIC_FILES_CHKSUM <span class="token operator">=</span> <span class="token string">"file://COPYING;md5=c678957b0c8e964aa6c70fd77641a71e"</span>

<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">without</span> <span class="token expression">libxml in PACKAGECONFIG vendor copy of the lib will be used</span></span>
LICENSE<span class="token operator">:</span>append <span class="token operator">=</span> <span class="token string">" ${@bb.utils.contains('PACKAGECONFIG', 'libxml', '', '&amp; MIT', d)}"</span>
LIC_FILES_CHKSUM<span class="token operator">:</span>append <span class="token operator">=</span> <span class="token string">" ${@bb.utils.contains('PACKAGECONFIG', 'libxml', '', 'file://libtextstyle/lib/libxml/COPYING;md5=2044417e2e5006b65a8b9067b683fcf1', d)}"</span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">without</span> <span class="token expression">croco in PACKAGECONFIG vendor copy of the lib will be used</span></span>
LIC_FILES_CHKSUM<span class="token operator">:</span>append <span class="token operator">=</span> <span class="token string">" ${@bb.utils.contains('PACKAGECONFIG', 'croco', '', 'file://libtextstyle/lib/libcroco/libcroco.h;md5=915a46e7307c2f7f8d2b9c503fc434ed;beginline=10;endline=28', d)}"</span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">without</span> <span class="token expression">glib in PACKAGECONFIG vendor copy of the lib will be used</span></span>
LIC_FILES_CHKSUM<span class="token operator">:</span>append <span class="token operator">=</span> <span class="token string">" ${@bb.utils.contains('PACKAGECONFIG', 'glib', '', 'file://libtextstyle/lib/glib/ghash.c;md5=af89a160226edf0b276b6183888037d0;beginline=10;endline=27', d)}"</span>


DEPENDS <span class="token operator">=</span> <span class="token string">"gettext-native virtual/libiconv"</span>
DEPENDS<span class="token operator">:</span>class<span class="token operator">-</span>native <span class="token operator">=</span> <span class="token string">"gettext-minimal-native"</span>
PROVIDES <span class="token operator">=</span> <span class="token string">"virtual/libintl virtual/gettext"</span>
PROVIDES<span class="token operator">:</span>class<span class="token operator">-</span>native <span class="token operator">=</span> <span class="token string">"virtual/gettext-native"</span>
RCONFLICTS<span class="token operator">:</span>$<span class="token punctuation">{<!-- --></span>PN<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token string">"proxy-libintl"</span>
SRC_URI <span class="token operator">=</span> <span class="token string">"${GNU_MIRROR}/gettext/gettext-${PV}.tar.gz \
           file://parallel.patch \
           file://use-pkgconfig.patch \
           file://run-ptest \
           file://serial-tests-config.patch \
           file://0001-tests-autopoint-3-unset-MAKEFLAGS.patch \
           file://0001-init-env.in-do-not-add-C-CXX-parameters.patch \
           file://mingw.patch \
           file://0001-msgmerge-29-Add-executable-file-mode-bits.patch \
           file://0001-libtextstyle-fix-builds-with-automake-1.16.4-and-new.patch \
           "</span>
SRC_URI<span class="token punctuation">[</span>sha256sum<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"c77d0da3102aec9c07f43671e60611ebff89a996ef159497ce8e59d075786b12"</span>

inherit autotools texinfo pkgconfig ptest

EXTRA_OECONF <span class="token operator">+=</span> <span class="token string">"--without-lispdir \
                 --disable-csharp \
                 --disable-libasprintf \
                 --disable-java \
                 --disable-native-java \
                 --disable-openmp \
                 --disable-acl \
                 --without-emacs \
                 --without-cvs \
                 --without-git \
                 --cache-file=${B}/config.cache \
                "</span>
EXTRA_OECONF<span class="token operator">:</span>append<span class="token operator">:</span>class<span class="token operator">-</span>target <span class="token operator">=</span> <span class="token string">" \
                 --with-bisonlocaledir=${datadir}/locale \
                 gt_cv_locale_fr_utf8=fr_FR \
                 gt_cv_locale_fr=fr_FR.ISO-8859-1 \
                 gt_cv_locale_de_utf8=de_DE \
                 gt_cv_locale_de=de_DE.ISO-8859-1 \
"</span>

PACKAGECONFIG <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">=</span> <span class="token string">"croco glib libxml"</span>
PACKAGECONFIG<span class="token operator">:</span>class<span class="token operator">-</span>native <span class="token operator">=</span> <span class="token string">""</span>
PACKAGECONFIG<span class="token operator">:</span>class<span class="token operator">-</span>nativesdk <span class="token operator">=</span> <span class="token string">""</span>

PACKAGECONFIG<span class="token punctuation">[</span>croco<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"--without-included-libcroco,--with-included-libcroco,libcroco"</span>
PACKAGECONFIG<span class="token punctuation">[</span>glib<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"--without-included-glib,--with-included-glib,glib-2.0"</span>
PACKAGECONFIG<span class="token punctuation">[</span>libxml<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"--without-included-libxml,--with-included-libxml,libxml2"</span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Need paths here to avoid host contamination but this can cause RPATH warnings</span></span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">or</span> <span class="token expression">problems <span class="token keyword">if</span> $libdir isn't $prefix<span class="token operator">/</span>lib<span class="token punctuation">.</span></span></span>
PACKAGECONFIG<span class="token punctuation">[</span>libunistring<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"--with-libunistring-prefix=${STAGING_LIBDIR}/..,--with-included-libunistring,libunistring"</span>
PACKAGECONFIG<span class="token punctuation">[</span>msgcat<span class="token operator">-</span>curses<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"--with-libncurses-prefix=${STAGING_LIBDIR}/..,--disable-curses,ncurses,"</span>

acpaths <span class="token operator">=</span> '<span class="token operator">-</span>I $<span class="token punctuation">{<!-- --></span>S<span class="token punctuation">}</span><span class="token operator">/</span>gettext<span class="token operator">-</span>runtime<span class="token operator">/</span>m4 \
           <span class="token operator">-</span>I $<span class="token punctuation">{<!-- --></span>S<span class="token punctuation">}</span><span class="token operator">/</span>gettext<span class="token operator">-</span>tools<span class="token operator">/</span>m4'

do_install<span class="token operator">:</span>append<span class="token operator">:</span>libc<span class="token operator">-</span><span class="token function">musl</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	rm <span class="token operator">-</span>f $<span class="token punctuation">{<!-- --></span>D<span class="token punctuation">}</span>$<span class="token punctuation">{<!-- --></span>libdir<span class="token punctuation">}</span><span class="token operator">/</span>charset<span class="token punctuation">.</span>alias
	rm <span class="token operator">-</span>f $<span class="token punctuation">{<!-- --></span>D<span class="token punctuation">}</span>$<span class="token punctuation">{<!-- --></span>includedir<span class="token punctuation">}</span><span class="token operator">/</span>libintl<span class="token punctuation">.</span>h
	rm <span class="token operator">-</span>f $<span class="token punctuation">{<!-- --></span>D<span class="token punctuation">}</span>$<span class="token punctuation">{<!-- --></span>libdir<span class="token punctuation">}</span><span class="token operator">/</span>libintl<span class="token punctuation">.</span>la
<span class="token punctuation">}</span>

<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">these</span> <span class="token expression">lack the <span class="token punctuation">.</span>x behind the <span class="token punctuation">.</span>so<span class="token punctuation">,</span> but shouldn't be in the <span class="token operator">-</span>dev package</span></span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Otherwise you get the following results<span class="token operator">:</span></span></span>
# <span class="token number">7.4</span>M    glibc<span class="token operator">/</span>images<span class="token operator">/</span>ep93xx<span class="token operator">/</span>Angstrom<span class="token operator">-</span>console<span class="token operator">-</span>image<span class="token operator">-</span>glibc<span class="token operator">-</span>ipk<span class="token operator">-</span><span class="token number">2008.1</span><span class="token operator">-</span>test<span class="token operator">-</span><span class="token number">20080104</span><span class="token operator">-</span>ep93xx<span class="token punctuation">.</span>rootfs<span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz
# <span class="token number">25</span>M     uclibc<span class="token operator">/</span>images<span class="token operator">/</span>ep93xx<span class="token operator">/</span>Angstrom<span class="token operator">-</span>console<span class="token operator">-</span>image<span class="token operator">-</span>uclibc<span class="token operator">-</span>ipk<span class="token operator">-</span><span class="token number">2008.1</span><span class="token operator">-</span>test<span class="token operator">-</span><span class="token number">20080104</span><span class="token operator">-</span>ep93xx<span class="token punctuation">.</span>rootfs<span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">because</span> <span class="token expression">gettext depends on gettext<span class="token operator">-</span>dev<span class="token punctuation">,</span> which pulls in more <span class="token operator">-</span>dev packages<span class="token operator">:</span></span></span>
# <span class="token number">15228</span>   KiB <span class="token operator">/</span>ep93xx<span class="token operator">/</span>libstdc<span class="token operator">++</span><span class="token operator">-</span>dev_4<span class="token punctuation">.</span><span class="token number">2.2</span><span class="token operator">-</span>r2_ep93xx<span class="token punctuation">.</span>ipk
# <span class="token number">1300</span>    KiB <span class="token operator">/</span>ep93xx<span class="token operator">/</span>uclibc<span class="token operator">-</span>dev_0<span class="token punctuation">.</span><span class="token number">9.29</span><span class="token operator">-</span>r8_ep93xx<span class="token punctuation">.</span>ipk
# <span class="token number">140</span>     KiB <span class="token operator">/</span>armv4t<span class="token operator">/</span>gettext<span class="token operator">-</span>dev_0<span class="token punctuation">.</span><span class="token number">14.1</span><span class="token operator">-</span>r6_armv4t<span class="token punctuation">.</span>ipk
# <span class="token number">4</span>       KiB <span class="token operator">/</span>ep93xx<span class="token operator">/</span>libgcc<span class="token operator">-</span>s<span class="token operator">-</span>dev_4<span class="token punctuation">.</span><span class="token number">2.2</span><span class="token operator">-</span>r2_ep93xx<span class="token punctuation">.</span>ipk

PACKAGES <span class="token operator">=</span><span class="token operator">+</span> <span class="token string">"libgettextlib libgettextsrc"</span>
FILES<span class="token operator">:</span>libgettextlib <span class="token operator">=</span> <span class="token string">"${libdir}/libgettextlib-*.so*"</span>
FILES<span class="token operator">:</span>libgettextsrc <span class="token operator">=</span> <span class="token string">"${libdir}/libgettextsrc-*.so*"</span>

PACKAGES <span class="token operator">=</span><span class="token operator">+</span> <span class="token string">"gettext-runtime gettext-runtime-dev gettext-runtime-doc"</span>

FILES<span class="token operator">:</span>$<span class="token punctuation">{<!-- --></span>PN<span class="token punctuation">}</span> <span class="token operator">+=</span> <span class="token string">"${libdir}/${BPN}/*"</span>

<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">The its<span class="token operator">/</span>Makefile<span class="token punctuation">.</span>am has defined<span class="token operator">:</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">itsdir</span> <span class="token expression"><span class="token operator">=</span> $<span class="token punctuation">(</span>pkgdatadir<span class="token punctuation">)</span>$<span class="token punctuation">(</span>PACKAGE_SUFFIX<span class="token punctuation">)</span><span class="token operator">/</span>its</span></span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">not</span> <span class="token expression">itsdir <span class="token operator">=</span> $<span class="token punctuation">(</span>pkgdatadir<span class="token punctuation">)</span><span class="token punctuation">,</span> so use wildcard to match the version<span class="token punctuation">.</span></span></span>
FILES<span class="token operator">:</span>$<span class="token punctuation">{<!-- --></span>PN<span class="token punctuation">}</span> <span class="token operator">+=</span> <span class="token string">"${datadir}/${BPN}-*/*"</span>

FILES<span class="token operator">:</span>gettext<span class="token operator">-</span>runtime <span class="token operator">=</span> <span class="token string">"${bindir}/gettext \
                         ${bindir}/ngettext \
                         ${bindir}/envsubst \
                         ${bindir}/gettext.sh \
                         ${libdir}/libasprintf.so* \
                         ${libdir}/GNU.Gettext.dll \
                        "</span>
FILES<span class="token operator">:</span>gettext<span class="token operator">-</span>runtime<span class="token operator">-</span>dev <span class="token operator">+=</span> <span class="token string">"${libdir}/libasprintf.a \
                      ${includedir}/autosprintf.h \
                     "</span>
FILES<span class="token operator">:</span>gettext<span class="token operator">-</span>runtime<span class="token operator">-</span>doc <span class="token operator">=</span> <span class="token string">"${mandir}/man1/gettext.* \
                             ${mandir}/man1/ngettext.* \
                             ${mandir}/man1/envsubst.* \
                             ${mandir}/man1/.* \
                             ${mandir}/man3/* \
                             ${docdir}/gettext/gettext.* \
                             ${docdir}/gettext/ngettext.* \
                             ${docdir}/gettext/envsubst.* \
                             ${docdir}/gettext/*.3.html \
                             ${datadir}/gettext/ABOUT-NLS \
                             ${docdir}/gettext/csharpdoc/* \
                             ${docdir}/libasprintf/autosprintf.html \
                             ${infodir}/autosprintf.info \
                            "</span>

do_install<span class="token operator">:</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    rm <span class="token operator">-</span>f $<span class="token punctuation">{<!-- --></span>D<span class="token punctuation">}</span>$<span class="token punctuation">{<!-- --></span>libdir<span class="token punctuation">}</span><span class="token operator">/</span>preloadable_libintl<span class="token punctuation">.</span>so
<span class="token punctuation">}</span>

do_install<span class="token operator">:</span>append<span class="token operator">:</span>class<span class="token operator">-</span><span class="token function">native</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	rm $<span class="token punctuation">{<!-- --></span>D<span class="token punctuation">}</span>$<span class="token punctuation">{<!-- --></span>datadir<span class="token punctuation">}</span><span class="token operator">/</span>aclocal<span class="token comment">/*
	rm ${D}${datadir}/gettext/config.rpath
	rm ${D}${datadir}/gettext/po/Makefile.in.in
	rm ${D}${datadir}/gettext/po/remove-potcdate.sin

        create_wrapper ${D}${bindir}/msgfmt \
                GETTEXTDATADIR="${STAGING_DATADIR_NATIVE}/gettext-${PV}/"

}

do_compile_ptest() {
        cd ${B}/gettext-tools/tests/
        sed -i '/^buildtest-TESTS: /c buildtest-TESTS: $(TESTS) $(check_PROGRAMS)' Makefile
        oe_runmake buildtest-TESTS
        cd -
}

do_install_ptest() {
    if [ ${PTEST_ENABLED} = "1" ]; then
        mkdir -p                                        ${D}${PTEST_PATH}/tests
        mkdir -p                                        ${D}${PTEST_PATH}/src
        mkdir -p                                        ${D}${PTEST_PATH}/po
        mkdir -p                                        ${D}${PTEST_PATH}/misc
        mkdir -p                                        ${D}${PTEST_PATH}/its
        mkdir -p                                        ${D}${PTEST_PATH}/styles
        mkdir -p                                        ${D}${PTEST_PATH}/gnulib-lib
        mkdir -p                                        ${D}${PTEST_PATH}/examples
        cp -rf ${S}/gettext-tools/its/*                 ${D}${PTEST_PATH}/its
        cp -rf ${S}/gettext-tools/styles/*              ${D}${PTEST_PATH}/styles
        cp -rf ${S}/gettext-tools/gnulib-lib/gettext.h  ${D}${PTEST_PATH}/gnulib-lib
        cp -rf ${S}/gettext-tools/examples/hello-c      ${D}${PTEST_PATH}/examples
        cp -rf ${S}/gettext-tools/tests/*               ${D}${PTEST_PATH}/tests
        cp -rf ${B}/gettext-tools/tests/.libs/*         ${D}${PTEST_PATH}/tests
        cp -rf ${B}/gettext-runtime/intl/.libs/libgnuintl.so.8*         ${D}${libdir}/
        cp -rf ${B}/gettext-tools/tests/Makefile        ${D}${PTEST_PATH}/tests
        cp -rf ${B}/gettext-tools/tests/init-env        ${D}${PTEST_PATH}/tests
        sed -i '/^Makefile:/c Makefile:'                ${D}${PTEST_PATH}/tests/Makefile
        sed -i -e 's:lang-c lang-c++:lang-c++:g'        ${D}${PTEST_PATH}/tests/Makefile
        install ${S}/gettext-tools/src/msgunfmt.tcl     ${D}${PTEST_PATH}/src
        install ${S}/gettext-tools/src/project-id       ${D}${PTEST_PATH}/src
        install ${B}/gettext-runtime/src/gettext.sh     ${D}${PTEST_PATH}/src
        install ${B}/gettext-runtime/src/ngettext       ${D}${PTEST_PATH}/src
        install ${B}/gettext-runtime/src/envsubst       ${D}${PTEST_PATH}/src
        install ${B}/gettext-runtime/src/gettext        ${D}${PTEST_PATH}/src
        install ${B}/gettext-tools/src/.libs/cldr-plurals   ${D}${PTEST_PATH}/src
        install ${S}/gettext-tools/po/gettext-tools.pot ${D}${PTEST_PATH}/po
        install ${B}/gettext-tools/misc/*       ${D}${PTEST_PATH}/misc
        find ${D}${PTEST_PATH}/ -name "*.o" -exec rm {} \;
        chmod 0755 ${D}${PTEST_PATH}/tests/lang-vala ${D}${PTEST_PATH}/tests/plural-1 ${D}${PTEST_PATH}/tests/xgettext-tcl-4 \
                   ${D}${PTEST_PATH}/tests/xgettext-vala-1  ${D}${PTEST_PATH}/tests/xgettext-po-2
        sed -i -e 's|${DEBUG_PREFIX_MAP}||g' ${D}${PTEST_PATH}/tests/init-env
    fi
}

RDEPENDS:${PN}-ptest += "make xz"
RDEPENDS:${PN}-ptest:append:libc-glibc = "\
    glibc-gconv-big5 \
    glibc-charmap-big5 \
    glibc-gconv-cp1251 \
    glibc-charmap-cp1251 \
    glibc-charmap-iso-8859-9 \
    glibc-gconv-iso8859-9 \
    glibc-charmap-koi8-r \
    glibc-gconv-koi8-r \
    glibc-gconv-iso8859-2 \
    glibc-charmap-iso-8859-2 \
    glibc-gconv-iso8859-1 \
    glibc-charmap-iso-8859-1 \
    glibc-gconv-euc-kr \
    glibc-charmap-euc-kr \
    glibc-gconv-euc-jp \
    glibc-charmap-euc-jp \
    locale-base-de-de \
    locale-base-fr-fr \
"

RRECOMMENDS:${PN}-ptest:append:libc-glibc = "\
    locale-base-de-de.iso-8859-1 \
    locale-base-fr-fr.iso-8859-1 \
"

INSANE_SKIP:${PN}-ptest += "ldflags"
INSANE_SKIP:${PN}-ptest += "rpaths"

BBCLASSEXTEND = "native nativesdk"

</span></code></pre> 
  <ul><li><code>SECTION</code>: 给包进行分类，用于软件包管理</li><li><code>LICENSE</code>: 配方源文件(源码)的<code>LICENSE</code>列表</li><li><code>LIC_FILES_CHKSUM</code>: <code>LICENSE</code>文本文件校验码 
    <ul><li>配方文件使用append追加了需要使用的其他源</li></ul> </li><li><code>DEPENDS</code>：配文构建时所需要配置的依赖 
    <ul><li><code>RDEPENDS</code>: 配方包目标运行时所需要的依赖</li></ul> </li><li><code>PROVIDES</code>：给配方起别名 
    <ul><li>配方自己的包名<code>{PN}</code>已经包含在<code>PROVIDES</code>变量的列表中；别名等效于<code>{PN}</code>，可被其他配方使用(依赖项)</li><li><code>PROVIDES:class-native</code></li><li><code>RCONFLICTS_${PN}</code>: 提供包名的别名列表</li></ul> </li><li><code>RCONFLICTS:${PN}</code>: 指定和当前软件包冲突的包列表 
    <ul><li>安装目标包前需要先删除冲突的包，否则目标包不会被安装</li></ul> </li><li><code>SRC_URI</code>：源,本地或者远程</li><li><code>SRC_URI[sha256sum]</code>：源校验</li><li><code>inherit</code>: 继承类class</li><li><code>EXTRA_OECONF</code>: 指定用于<code>configure</code>配置脚本的参数 
    <ul><li><code>EXTRA_OECONF:append:class-target</code></li></ul> </li><li><code>PACKAGECONFIG</code>: 变量提供了在配方上启用或禁用配方的<strong>feature</strong>的方法<pre><code class="prism language-c"> PACKAGECONFIG <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">=</span> <span class="token string">"croco glib libxml"</span>
</code></pre> 
    <ul><li>指定<strong>feature</strong>列表</li></ul> <pre><code class="prism language-c">PACKAGECONFIG<span class="token punctuation">[</span>croco<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"--without-included-libcroco,--with-included-libcroco,libcroco"</span>
PACKAGECONFIG<span class="token punctuation">[</span>glib<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"--without-included-glib,--with-included-glib,glib-2.0"</span>
PACKAGECONFIG<span class="token punctuation">[</span>libxml<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"--without-included-libxml,--with-included-libxml,libxml2"</span>
</code></pre> 
    <ul><li>指定每个<strong>feature</strong>的行为，最多指定六个参数，每个参数需要按顺序指定 
      <ul><li>1.如果启用了<strong>feature</strong>功能，则应将额外的参数添加到配置脚本参数列表 (EXTRA_OECONF)</li><li>2.如果禁用了<strong>feature</strong>功能，应该将额外的参数添加到EXTRA_OECONF</li><li>3.如果启用了<strong>feature</strong>功能，则应添加附加的构建时依赖关系(DEPENDS)</li><li>4.如果启用了<strong>feature</strong>功能，应该添加附加的运行时依赖关系(<code>RDEPENDS</code>)</li><li>5.其他运行时建议 (推荐)应添加，如果 该功能已启用</li><li>6.此功能的任何冲突(即互斥)<code>PACKAGECONFIG</code>设置</li></ul> </li><li>针对<code>PACKAGECONFIG[gtk] = "--with-gtk3,--without-gtk3,gtk+3"</code> <code>librsvggtk</code> 
      <ul><li>仅当功能是启用时，<strong>feature</strong>被添加到脚本参数列表(<code>EXTRA_OECONF</code>)和(<code>DEPENDS</code>)中</li><li>如果通过使用<code>.bbappend</code>文件禁用该功能，则第二个参数被添加到脚本参数列表(<code>EXTRA_OECONF</code>)中</li></ul> </li><li>修改现有的<code>PACKAGECONFIG</code>方法： 
      <ul><li>1.附加文件：在层中创建一个<code>.bbappend</code>附加文件，并覆盖<code>PACKAGECONFIG</code>的值<pre><code class="prism language-c">PACKAGECONFIG <span class="token operator">=</span> <span class="token string">"f4 f5"</span>
</code></pre> 或者，添加<pre><code class="prism language-c">PACKAGECONFIG：append <span class="token operator">=</span> <span class="token string">" f4"</span>
</code></pre> </li><li>2.配置文件：如果没有修改<code>local.conf</code>或<code>mydistro.conf</code>文件，此方法与通过附加文件更改块相同;<pre><code class="prism language-c">PACKAGECONFIG<span class="token operator">:</span>pn<span class="token operator">-</span>recipename <span class="token operator">=</span> <span class="token string">"f4 f5"</span>
</code></pre> 或者，追加<pre><code class="prism language-c">PACKAGECONFIG<span class="token operator">:</span>append<span class="token operator">:</span>pn<span class="token operator">-</span>recipename <span class="token operator">=</span> <span class="token string">" f4"</span>
</code></pre> </li></ul> </li></ul> </li><li><code>FILES</code>: 指定需要放入包中的目录或者文件的列表；使用FILES需要和包名结合 
    <ul><li>指定的路径需要根据<code>meta/conf/bitbake.conf</code>所指定的相对路径来标识路径，而不是绝对路径</li></ul> <pre><code class="prism language-c">  FILES<span class="token operator">:</span>$<span class="token punctuation">{<!-- --></span>PN<span class="token punctuation">}</span> <span class="token operator">+=</span> <span class="token string">"${datadir}/${BPN}-*/*"</span>
</code></pre> </li><li><code>SYSTEMD_SERVICE</code>: 如果配方继承了systemd类，那么变量为配方生成包指定了systemd的服务名称<pre><code class="prism language-c">   SYSTEMD_SERVICE<span class="token operator">:</span>$ <span class="token punctuation">{<!-- --></span>PN<span class="token punctuation">}</span> <span class="token operator">=</span>“connman<span class="token punctuation">.</span>service”
</code></pre> </li><li><code>RRECOMMENDS</code>: 扩展软件包可用性的软件包列表建立; 
    <ul><li>正在构建的包不依赖于此列表 包为了成功构建，而是将它们用于扩展的可用性</li></ul> <pre><code class="prism language-c">RRECOMMENDS<span class="token operator">:</span>$<span class="token punctuation">{<!-- --></span>PN<span class="token punctuation">}</span><span class="token operator">-</span>dev <span class="token operator">+=</span> <span class="token string">"wireless_package_name"</span>
</code></pre> </li><li><code>FILESEXTRAPATHS</code>：扩展用于由FILESPATH定义的额外本地文件的构建系统的搜索路径 
    <ul><li>这个变量最常以<code>FILESEXTRAPATHS_prepend：="${THISDIR}/${PN}"</code>形式被用于追加文件中，它导致构建系统在由</li></ul> </li><li><code>EXCLUDE_FROM_WORLD</code>：将当前配方从BitBake world 中排除 
    <ul><li>如果需要BitBake world不构建当前配方，在配方中将<code>EXCLUDE_FROM_WORLD</code>变量设置为“1”</li><li>如果有其他配方依赖于设置<code>EXCLUDE_FROM_WORLD</code>的值为1的配方，则此配方<strong>仍然可能</strong>被BitBake world构建</li><li>将<code>EXCLUDE_FROM_WORLD</code>设置为1,仅<strong>确保配方未显式添加</strong>到BitBake world的构建目标列表中</li></ul> </li><li><code>PACKAGES</code>: 配方所创建的包列表</li><li>在打包过程中,<code>do_package</code>任务遍历<code>PACKAGES</code>并使用与每个包对应的<code>FILES</code>变量将文件分配给包</li><li>如果文件与多个文件的<code>FILES</code>变量匹配包中的包，最早会分配给 （最左边）包</li><li>变量列表中的包为空(即没有<strong>pkg</strong>中的模式与<code>do_install</code>任务安装的任何文件匹配)不会生成， 除非通过<strong>ALLOW_EMPTY</strong>变量强制生成</li><li>默认值<pre><code class="prism language-c">$<span class="token punctuation">{<!-- --></span>PN<span class="token punctuation">}</span><span class="token operator">-</span>src $<span class="token punctuation">{<!-- --></span>PN<span class="token punctuation">}</span><span class="token operator">-</span>dbg $<span class="token punctuation">{<!-- --></span>PN<span class="token punctuation">}</span><span class="token operator">-</span>staticdev $<span class="token punctuation">{<!-- --></span>PN<span class="token punctuation">}</span><span class="token operator">-</span>dev $<span class="token punctuation">{<!-- --></span>PN<span class="token punctuation">}</span><span class="token operator">-</span>doc $<span class="token punctuation">{<!-- --></span>PN<span class="token punctuation">}</span><span class="token operator">-</span>locale $<span class="token punctuation">{<!-- --></span>PACKAGE_BEFORE_PN<span class="token punctuation">}</span> $<span class="token punctuation">{<!-- --></span>PN<span class="token punctuation">}</span>
</code></pre> </li></ul> </li></ul> 
<h3><a id="_486"></a>变量赋值</h3> 
<ul><li><code>bitbake</code>使用的变量均为<strong>无类型</strong>，所有赋值给变量的值都视作<strong>字符串</strong></li><li>变量赋值 
  <ul><li><code>=</code> :直接赋值</li><li><code>?=</code> : 默认赋值 
    <ul><li>假如变量之前未被赋值，则赋值为目标值；否则(被赋值过)，保留原值，赋值无效</li></ul> </li><li><code>??=</code> : 弱默认赋值 
    <ul><li>赋值在解析过程结束才会发生，即多个<code>??=</code>只有<strong>最后一个会生效</strong></li></ul> </li><li><code>:=</code> : 直接变量扩展 
    <ul><li>变量扩展直到变量被使用才会发生，直接扩展就是立刻进行变量扩展<pre><code class="prism language-c">v1 <span class="token operator">=</span> <span class="token string">"1"</span>
v2 <span class="token operator">=</span> <span class="token string">"${v1} + 2"</span>
v1 <span class="token operator">=</span> <span class="token string">"11"</span>
v3 <span class="token operator">=</span> <span class="token string">"${v1} + 3"</span>
v4 <span class="token operator">:</span><span class="token operator">=</span> <span class="token string">"${v2} + 4"</span>
结果：v4 <span class="token string">"11 + 2 + 4"</span> 
</code></pre> </li></ul> </li><li><code>+=</code> :追加，并且新增空格</li><li><code>=+</code> :前新增变量，并且新增空格<pre><code class="prism language-c">v1 <span class="token operator">=</span> <span class="token string">"1"</span>
v1 <span class="token operator">+=</span> <span class="token string">" 2"</span>
v2 <span class="token operator">=</span> <span class="token string">"11"</span>
v2 <span class="token operator">=</span><span class="token operator">+</span> <span class="token string">"33"</span>
结果：v1<span class="token operator">:</span> <span class="token number">1</span> <span class="token number">2</span>   v2<span class="token operator">:</span> <span class="token number">33</span> <span class="token number">11</span>  
</code></pre> </li><li><code>+=</code> :追加，不新增空格</li><li><code>=+</code> :前新增变量，不新增空格<pre><code class="prism language-c">v1 <span class="token operator">=</span> <span class="token string">"1"</span>
v1 <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token string">" 2"</span>
v2 <span class="token operator">=</span> <span class="token string">"11"</span>
v2 <span class="token operator">=</span><span class="token punctuation">.</span> <span class="token string">"33"</span>
结果：v1<span class="token operator">:</span> <span class="token number">12</span>   v2<span class="token operator">:</span> <span class="token number">3311</span>  
</code></pre> </li><li><code>_append</code> :追加，使用在变量名上，不包含空格</li><li><code>_prepend</code> :前新增变量，使用在变量名上，不包含空格<pre><code class="prism language-c">v1 <span class="token operator">=</span> <span class="token string">"11"</span>
v1_append <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token string">" 22"</span>
v2 <span class="token operator">=</span> <span class="token string">"aa"</span>
v2_prepend <span class="token operator">=</span><span class="token punctuation">.</span> <span class="token string">"bb"</span>
结果：v1<span class="token operator">:</span> <span class="token number">12</span>   v2<span class="token operator">:</span> bbaa  
</code></pre> </li><li><code>_remove</code> :去除，使用在变量名上，去除变量中的右值目标 
    <ul><li>除非额外增加空格，不然空格仍然保留，目标变量是第一个除外1<pre><code class="prism language-c">v1 <span class="token operator">=</span> <span class="token string">"11 aa cccccc qq 1234 00"</span>
v1_remove <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token string">" qq"</span>
v1_remove <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token string">"1234"</span>
结果：v1<span class="token operator">:</span> aa cccccc  <span class="token number">1234</span> <span class="token number">00</span> 
</code></pre> </li></ul> </li></ul> </li><li>变量引用 
  <ul><li>和<code>shell</code>脚本用法类似，可以使用<code>${}</code>来引用变量的内容</li><li><code>var1 = "You" ; var2 = "${var1} and me"</code></li></ul> </li><li>变量条件赋值 
  <ul><li><code>OVEREIDES = "cond1:cond2:dond3"</code></li><li>bitbake从右向左处理，右边优先级高于左边</li></ul> </li><li>变量属性 
  <ul><li>类似于数组用法，变量名为数组名，数组中的值为该属性的值</li></ul> </li></ul> 
<h3><a id="_548"></a>日志文件</h3> 
<p><strong>通用日志文件</strong></p> 
<ul><li><code>bitbake</code>把通用日志文件存储在由<code>LOG_DIR</code>变量指定的目录中。</li><li>默认 <code>LOG_DIR = "${TMPDIR}/log"</code></li></ul> 
<pre><code class="prism language-c">WARNING<span class="token operator">:</span> You are using a local hash equivalence server but have configured an sstate mirror<span class="token punctuation">.</span> This will likely mean no sstate will match from the mirror<span class="token punctuation">.</span> You may wish to disable the hash equivalence <span class="token function">use</span> <span class="token punctuation">(</span>BB_HASHSERVE<span class="token punctuation">)</span><span class="token punctuation">,</span> or use a hash equivalence server alongside the sstate mirror<span class="token punctuation">.</span>
NOTE<span class="token operator">:</span> Resolving any missing task queue dependencies

Build Configuration<span class="token operator">:</span>
BB_VERSION           <span class="token operator">=</span> <span class="token string">"2.0.0"</span>                              <span class="token comment">//bitbake版本号</span>
BUILD_SYS            <span class="token operator">=</span> <span class="token string">"x86_64-linux"</span>                       <span class="token comment">//构建系统的类型(使用的构建工具)</span>
NATIVELSBSTRING      <span class="token operator">=</span> <span class="token string">"ubuntu-20.04"</span>
TARGET_SYS           <span class="token operator">=</span> <span class="token string">"aarch64-poky-linux"</span>                <span class="token comment">//目标构建系统的类型</span>
MACHINE              <span class="token operator">=</span> <span class="token string">"xxxx"</span>
DISTRO               <span class="token operator">=</span> <span class="token string">"poky"</span>
DISTRO_VERSION       <span class="token operator">=</span> <span class="token string">"4.0.6"</span>
TUNE_FEATURES        <span class="token operator">=</span> <span class="token string">"aarch64 armv8a crc cortexa53 crypto"</span> <span class="token comment">//针对目标CPU架构的优化参数</span>
TARGET_FPU           <span class="token operator">=</span> <span class="token string">""</span>
meta                 
meta<span class="token operator">-</span>poky            
meta<span class="token operator">-</span>yocto<span class="token operator">-</span>bsp       <span class="token operator">=</span> <span class="token string">"HEAD:9006ef9075811a541ada61c509346f04241f40d3"</span>   <span class="token comment">//层的提交ID</span>
meta<span class="token operator">-</span>oecore          <span class="token operator">=</span> <span class="token string">"HEAD:76ddcd64e327b6b840804c04f62cb9e6e81d07ef"</span>
meta<span class="token operator">-</span>oe              
meta<span class="token operator">-</span>python          
meta<span class="token operator">-</span>multimedia      <span class="token operator">=</span> <span class="token string">"HEAD:aa20821f171471cd59c38a3d4b1c3cbb5d90b311"</span>
meta<span class="token operator">-</span>selinux         <span class="token operator">=</span> <span class="token string">"HEAD:a401f4b2816a0b41ce8d9351542658c721935bcd"</span>
meta<span class="token operator">-</span>ambabsp         
meta<span class="token operator">-</span>ambalib         
meta<span class="token operator">-</span>ambaapp         
meta<span class="token operator">-</span>thirdparty      
meta<span class="token operator">-</span>external        <span class="token operator">=</span> <span class="token string">"HEAD:0fbffff03e295a026bb4522874ef0a990e4ba658"</span>

NOTE<span class="token operator">:</span> Fetching uninative binary shim http<span class="token operator">:</span><span class="token comment">//downloads.yoctoproject.org/releases/uninative/3.7/x86_64-nativesdk-libc-3.7.tar.xz;sha256sum=b110bf2e10fe420f5ca2f3ec55f048ee5f0a54c7e34856a3594e51eb2aea0570 (will check PREMIRRORS first)</span>
Sstate summary<span class="token operator">:</span> Wanted <span class="token number">22</span> Local <span class="token number">0</span> Mirrors <span class="token number">22</span> Missed <span class="token number">0</span> Current <span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">100</span><span class="token operator">%</span> match<span class="token punctuation">,</span> <span class="token number">0</span><span class="token operator">%</span> complete<span class="token punctuation">)</span>
NOTE<span class="token operator">:</span> Executing Tasks
</code></pre> 
<p><strong>任务日志文件</strong></p> 
<ul><li>bitbake为每个菜谱的每个文件创建日志文件</li><li>T变量指定输出路径 <code>T = "${WORKDIR}/tmp"</code> 
  <ul><li>日志文件被存储到根据其执行菜谱的包名命名的子目录中</li><li><code>temp/work/cortexa53-crypto-poky-linux/speexdsp/1.2.0-r0/temp/log.do_package_write_rpm_setscene</code></li></ul> </li><li><code>clear</code>任务日志路径 <code>T_task_clean = "${LOGDIR}/cleanlogs/{PN}"</code> 
  <ul><li>因为<code>clean</code>任务会删除工作目录和其子目录，所以日志保存路径特殊</li></ul> </li></ul> 
<h3><a id="_594"></a>增加打印信息在配方文件中</h3> 
<p><strong>打印消息级别</strong></p> 
<ul><li><code>Plain</code>：完全按照传递的方式记录消息而不带任何额外信息</li><li><code>Debug</code>：记录前缀了DEBUG:的消息</li><li><code>Note</code>：通知</li><li><code>Warn</code>：它们不导致构建失败</li><li><code>Error</code>：构建可以继续直到没有需要构建的任务</li><li><code>Fatal</code>：致命条件使得<code>bitbake</code>在消息已经被记录后立即终止构建过程</li></ul> 
<p><strong><code>bitbake</code>的调试级别是通过增加<code>-D</code>参数到<code>bitbake</code>的命令行来设置的</strong></p> 
<ul><li>普通消息永远不会打印到控制台</li></ul> 
<pre><code class="prism language-c">bitbake <span class="token operator">-</span>D <span class="token operator">&lt;</span>target<span class="token operator">&gt;</span>
bitbake <span class="token operator">-</span>DD <span class="token operator">&lt;</span>target<span class="token operator">&gt;</span>
bitbake <span class="token operator">-</span>DDD <span class="token operator">&lt;</span>target<span class="token operator">&gt;</span>
</code></pre> 
<p><strong>配方文件使用</strong></p> 
<ul><li>python 
  <ul><li>python函数作为bitbake库的一部分实现<pre><code class="prism language-c">python do_configure（）<span class="token punctuation">{<!-- --></span>
	bb<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"debug"</span><span class="token punctuation">)</span>
	bb<span class="token punctuation">.</span><span class="token function">fatal</span><span class="token punctuation">(</span><span class="token string">"fatal"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> 
</code></pre> </li></ul> </li><li>shell 
  <ul><li>shell函数是由logging.bbclass实现的，logging.bbclass是由OpenEmbedded核心元数据层提供的<pre><code class="prism language-c">	do_configure（）<span class="token punctuation">{<!-- --></span>
		bbdebug <span class="token number">1</span> <span class="token string">"debug"</span>
		bbfatal <span class="token string">"fatal"</span>
	<span class="token punctuation">}</span> 
</code></pre> </li></ul> </li></ul> 
<h3><a id="_629"></a>菜谱任务执行</h3> 
<p><strong>列出目标菜谱任务清单</strong></p> 
<pre><code class="prism language-c">bitbake linux<span class="token operator">-</span>xxxx <span class="token operator">-</span>c listtasks
</code></pre> 
<pre><code class="prism language-c">NOTE<span class="token operator">:</span> Executing Tasks
do_build                        Default task <span class="token keyword">for</span> a recipe <span class="token operator">-</span> depends on all other normal tasks required to <span class="token char">'build'</span> a recipe
do_buildclean                   
do_bundle_initramfs             Combines an initial ramdisk image and kernel together to form a single image
do_checkuri                     Validates the SRC_URI value
do_clean                        Removes all output files <span class="token keyword">for</span> a target
do_cleanall                     Removes all output files<span class="token punctuation">,</span> shared state cache<span class="token punctuation">,</span> and downloaded source files <span class="token keyword">for</span> a target
do_cleansstate                  Removes all output files and shared state cache <span class="token keyword">for</span> a target
do_compile                      Compiles the source in the compilation directory
do_compile_kernelmodules        Compiles loadable modules <span class="token keyword">for</span> the Linux kernel
do_config_analysis
do_configure                    Configures the source by enabling and disabling any build<span class="token operator">-</span>time and configuration options <span class="token keyword">for</span> the software being built
do_deploy                       Writes deployable output files to the deploy directory
do_deploy_source_date_epoch
do_devshell                     Starts a shell with the environment set up <span class="token keyword">for</span> development<span class="token operator">/</span>debugging
do_diffconfig                   Compares the old and new config files after running do_menuconfig <span class="token keyword">for</span> the kernel
do_fetch                        Fetches the source code
do_install                      Copies files from the compilation directory to a holding area
do_kernel_configme              Assembles the kernel configuration <span class="token keyword">for</span> a linux<span class="token operator">-</span>yocto style kernel
do_kernel_link_images           Creates a symbolic link in arch<span class="token operator">/</span>$arch<span class="token operator">/</span>boot <span class="token keyword">for</span> vmlinux and vmlinuz kernel images
do_kernel_metadata
do_kernel_version_sanity_check
do_listtasks                    Lists all defined tasks <span class="token keyword">for</span> a target
do_menuconfig                   Runs <span class="token char">'make menuconfig'</span> <span class="token keyword">for</span> the kernel
do_package                      Analyzes the content of the holding area and splits it into subsets based on available packages and files
do_package_qa                   Runs QA checks on packaged files
do_package_write_rpm            Creates the actual RPM packages and places them in the Package Feed area
do_packagedata                  Creates package metadata used by the build system to generate the final packages
do_populate_lic                 Writes license information <span class="token keyword">for</span> the recipe that is collected later when the image is constructed
do_populate_sysroot             Copies a subset of files installed by do_install into the sysroot in order to make them available to other recipes
do_prepare_recipe_sysroot
do_pydevshell                   Starts an interactive Python shell <span class="token keyword">for</span> development<span class="token operator">/</span>debugging
do_savedefconfig                Creates a minimal Linux kernel configuration file
do_shared_workdir
do_sizecheck                    Checks the size of the kernel image against <span class="token function">KERNEL_IMAGE_MAXSIZE</span> <span class="token punctuation">(</span><span class="token keyword">if</span> set<span class="token punctuation">)</span>
do_strip                        Strips unneeded sections out of the Linux kernel image
do_symlink_kernsrc
do_transform_kernel
do_unpack                       Unpacks the source code into a working directory
NOTE<span class="token operator">:</span> Tasks Summary<span class="token operator">:</span> Attempted <span class="token number">1</span> tasks of which <span class="token number">0</span> didn't need to be rerun and all succeeded<span class="token punctuation">.</span>
</code></pre> 
<p><strong>软件包构建流程</strong></p> 
<ul><li><strong>获取</strong> <code>checkuri,fetch</code></li><li><strong>解压</strong> <code>unpack</code></li><li><strong>打补丁</strong></li><li><strong>配置</strong> <code>configure</code></li><li><strong>构建</strong>(编译) <code>compile</code></li><li><strong>安装</strong> <code>install</code> 
  <ul><li>复制二进制和辅助文件到他们再模拟的系统环境中的目标目录</li></ul> </li><li><strong>打包</strong> <code>package</code></li></ul> 
<h3><a id="_702"></a>参考</h3> 
<blockquote> 
 <p>1.《嵌入式linux系统开发：基于yocto project》<br> 2. https://docs.yoctoproject.org/bitbake/2.2/index.html</p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0c883d1c07c35c52b5e9c6e8f0de6a78/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">贝叶斯变分推断</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3a471184304204d97de79882bc27a2ca/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">详解可变形注意力模块（Deformable Attention Module）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>