<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>网络地址转换（NAT） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="网络地址转换（NAT）" />
<meta property="og:description" content="网络地址转换（NAT） 文章目录 网络地址转换（NAT）1.NAT的工作原理2.NAT功能3.NAT的实现方式4.NAT优缺点5.静态NAT1）概述2）配置方法 6.动态NAT7.PAT8.实验1）静态NAT（一个内网地址对一个公网地址）2）动态NAT——PAT（多个内网地址对多个公网地址）3）Easyip（多个内网地址对一个接口地址）4）静态PAT（一对一，外网口IP和服务 映射 网内网服务器的IP和服务） 1.NAT的工作原理 ● NAT用来将内网地址和端口号转换成合法的公网地址和端口号，建立一个会话，与公网主机进行通信。
● NAT外部的主机无法主动跟位于NAT内部的主机通信，NAT内部主机想要通信，必须主动和公网的一个IP通信，路由器负责建立一个映射关系，从而实现数据的转发。
2.NAT功能 NAT不仅能解决了IP地址不足的问题，而且还能够有效的避免来自网络外部的入侵，隐藏并保护网络内部的计算机。
①宽带分享：这是NAT主机的最大功能
②安全防护：NAT之内的PC联机到Internet上面时，他所显示的IP是NAT主机的公网IP，所以client端的PC就具有一定程度的安全了，外界在进行portscan（端口扫描）的时候，就侦测不到源client端的PC。
3.NAT的实现方式 ● 静态转换
● 动态转换
● 端口多路复用（PAT）
4.NAT优缺点 优点：
● 节省共有合法IP地址
● 处理地址重叠
● 增强灵活性
● 安全性
缺点：
● 延迟增大
● 配置和维护的复杂性
● 不支持某些应用，可以通过静态NAT映射来避免
5.静态NAT 1）概述 静态NAT实现私网地址和公网地址的一对一转换。有多少个私网地址就需要配置多少个公网地址。静态NAT不能节约公网地址，但可以起到隐藏内部网络的作用。
内部网络向外部网络发送报文时，静态NAT将报文的源IP地址替换为对应的公网地址；外部网络向内部网络发送响应报文时，静态NAT件发给报文的目的地址替换为相应的私网地址。
2）配置方法 第一种：全局模式下设置静态NAT
第二种：直接在接口上申明nat static
6.动态NAT 动态NAT是指将内部网络的私有IP地址转换为公用IP地址时，IP地址对是不确定的，是随机的，所有被授权访问Internet的私有IP地址可随机转换为任何指定的合法IP地址。也就是说，只要指定哪些内部地址可以进行转换，以及用哪些合法地址作为外部地址时，就可以进行动态转换。
内部地址的一个范围段转换为合理合法的公网范围段。
7.PAT 通过改变外出数据包的源IP地址和源端口并进行端口转换，内部网络的所有主机均可共享一个合法IP地址实现互联网的访问，节约IP。
8.实验 1）静态NAT（一个内网地址对一个公网地址） 端口配置IP
配置静态NAT
测试
PC1（192.168.1.10）ping PC3（200.10.100.2）
PC2（192.168.1.20）ping PC3（200.10.100.2）
并在PC3 e0/0/1抓包
通过抓包可以看出PC1的IP映射为了15.0.0.10，PC2的IP映射为了15.0.0.20
2）动态NAT——PAT（多个内网地址对多个公网地址） 端口配置IP
设置nat分组
[r1]nat address-group 1 15." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/b376e7dde96982c18ec5a2734d9c50b5/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-04-28T13:12:57+08:00" />
<meta property="article:modified_time" content="2022-04-28T13:12:57+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">网络地址转换（NAT）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="NAT_0"></a>网络地址转换（NAT）</h2> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#NAT_0" rel="nofollow">网络地址转换（NAT）</a></li><li><ul><li><a href="#1NAT_3" rel="nofollow">1.NAT的工作原理</a></li><li><a href="#2NAT_11" rel="nofollow">2.NAT功能</a></li><li><a href="#3NAT_21" rel="nofollow">3.NAT的实现方式</a></li><li><a href="#4NAT_31" rel="nofollow">4.NAT优缺点</a></li><li><a href="#5NAT_53" rel="nofollow">5.静态NAT</a></li><li><ul><li><a href="#1_55" rel="nofollow">1）概述</a></li><li><a href="#2_63" rel="nofollow">2）配置方法</a></li></ul> 
   </li><li><a href="#6NAT_69" rel="nofollow">6.动态NAT</a></li><li><a href="#7PAT_77" rel="nofollow">7.PAT</a></li><li><a href="#8_83" rel="nofollow">8.实验</a></li><li><ul><li><a href="#1NAT_91" rel="nofollow">1）静态NAT（一个内网地址对一个公网地址）</a></li><li><a href="#2NATPAT_119" rel="nofollow">2）动态NAT——PAT（多个内网地址对多个公网地址）</a></li><li><a href="#3Easyip_169" rel="nofollow">3）Easyip（多个内网地址对一个接口地址）</a></li><li><a href="#4PATIP__IP_191" rel="nofollow">4）静态PAT（一对一，外网口IP和服务 映射 网内网服务器的IP和服务）</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="1NAT_3"></a>1.NAT的工作原理</h3> 
<p>● NAT用来将内网地址和端口号转换成合法的公网地址和端口号，建立一个会话，与公网主机进行通信。</p> 
<p>● NAT外部的主机无法主动跟位于NAT内部的主机通信，NAT内部主机想要通信，必须主动和公网的一个IP通信，路由器负责建立一个映射关系，从而实现数据的转发。</p> 
<h3><a id="2NAT_11"></a>2.NAT功能</h3> 
<p>NAT不仅能解决了IP地址不足的问题，而且还能够有效的避免来自网络外部的入侵，隐藏并保护网络内部的计算机。</p> 
<p>①宽带分享：这是NAT主机的最大功能</p> 
<p>②安全防护：NAT之内的PC联机到Internet上面时，他所显示的IP是NAT主机的公网IP，所以client端的PC就具有一定程度的安全了，外界在进行portscan（端口扫描）的时候，就侦测不到源client端的PC。</p> 
<h3><a id="3NAT_21"></a>3.NAT的实现方式</h3> 
<p>● 静态转换</p> 
<p>● 动态转换</p> 
<p>● 端口多路复用（PAT）</p> 
<h3><a id="4NAT_31"></a>4.NAT优缺点</h3> 
<p>优点：</p> 
<p>● 节省共有合法IP地址</p> 
<p>● 处理地址重叠</p> 
<p>● 增强灵活性</p> 
<p>● 安全性</p> 
<p>缺点：</p> 
<p>● 延迟增大</p> 
<p>● 配置和维护的复杂性</p> 
<p>● 不支持某些应用，可以通过静态NAT映射来避免</p> 
<h3><a id="5NAT_53"></a>5.静态NAT</h3> 
<h4><a id="1_55"></a>1）概述</h4> 
<p>静态NAT实现私网地址和公网地址的一对一转换。有多少个私网地址就需要配置多少个公网地址。静态NAT不能节约公网地址，但可以起到隐藏内部网络的作用。</p> 
<p>内部网络向外部网络发送报文时，静态NAT将报文的源IP地址替换为对应的公网地址；外部网络向内部网络发送响应报文时，静态NAT件发给报文的目的地址替换为相应的私网地址。</p> 
<h4><a id="2_63"></a>2）配置方法</h4> 
<p>第一种：全局模式下设置静态NAT</p> 
<p>第二种：直接在接口上申明nat static</p> 
<h3><a id="6NAT_69"></a>6.动态NAT</h3> 
<p>动态NAT是指将内部网络的私有IP地址转换为公用IP地址时，IP地址对是不确定的，是随机的，所有被授权访问Internet的私有IP地址可随机转换为任何指定的合法IP地址。也就是说，只要指定哪些内部地址可以进行转换，以及用哪些合法地址作为外部地址时，就可以进行动态转换。</p> 
<p>内部地址的一个范围段转换为合理合法的公网范围段。</p> 
<h3><a id="7PAT_77"></a>7.PAT</h3> 
<p>通过改变外出数据包的源IP地址和源端口并进行端口转换，内部网络的所有主机均可共享一个合法IP地址实现互联网的访问，节约IP。</p> 
<h3><a id="8_83"></a>8.实验</h3> 
<p><img src="https://images2.imgbox.com/7c/13/oRNrvIyc_o.png" alt="image-20220427155522172"></p> 
<h4><a id="1NAT_91"></a>1）静态NAT（一个内网地址对一个公网地址）</h4> 
<p>端口配置IP</p> 
<p><img src="https://images2.imgbox.com/61/ec/bppVsAxY_o.png" alt="image-20220427160047698"></p> 
<p>配置静态NAT</p> 
<p><img src="https://images2.imgbox.com/2f/2f/69erKtKz_o.png" alt="image-20220427163047282"></p> 
<p>测试</p> 
<p>PC1（192.168.1.10）ping PC3（200.10.100.2）</p> 
<p>PC2（192.168.1.20）ping PC3（200.10.100.2）</p> 
<p>并在PC3 e0/0/1抓包</p> 
<p><img src="https://images2.imgbox.com/fd/bd/TyVIaa9h_o.png" alt="image-20220427161411829"></p> 
<p><img src="https://images2.imgbox.com/2e/27/ZUZPiaxa_o.png" alt="image-20220427163219420"></p> 
<p>通过抓包可以看出PC1的IP映射为了15.0.0.10，PC2的IP映射为了15.0.0.20</p> 
<h4><a id="2NATPAT_119"></a>2）动态NAT——PAT（多个内网地址对多个公网地址）</h4> 
<p>端口配置IP</p> 
<p><img src="https://images2.imgbox.com/99/57/CsXdZAiw_o.png" alt="image-20220427160047698"></p> 
<p>设置nat分组</p> 
<p>[r1]nat address-group 1 15.0.0.10 15.0.0.11是可以映射为外部地址的范围</p> 
<p><img src="https://images2.imgbox.com/07/55/5TegxNay_o.png" alt="image-20220427182843825"></p> 
<p>设置ACL 访问控制</p> 
<p>配置允许通过规则，ACL是有范围的，2000-2999只能匹配源IP地址</p> 
<p>0.0.0.255为反掩码，就是子网掩码255的部分转为0，0转为255</p> 
<p>规则是允许192.168.1.0网段通过</p> 
<p><img src="https://images2.imgbox.com/d5/f6/ik8dQrU1_o.png" alt="image-20220427170920255"></p> 
<p>在R1的g0/0/1接口，指定地址池（映射外部IP的地址范围），配置ACL访问控制规则，指定方向，方向是outbound</p> 
<p>配置完成后查看</p> 
<p><img src="https://images2.imgbox.com/d4/d1/BR5nQuFq_o.png" alt="image-20220427172436764"></p> 
<p>测试</p> 
<p>PC1（192.168.1.10）ping PC3（200.10.100.2）</p> 
<p>并在PC3 e0/0/1抓包</p> 
<p><img src="https://images2.imgbox.com/1a/3c/qmpTBSmW_o.png" alt="image-20220427183201042"></p> 
<p>通过抓包可以看到PC1的IP映射为了15.0.0.17</p> 
<p>再测试PC2（192.168.1.20）ping PC3（200.10.100.2）</p> 
<p><img src="https://images2.imgbox.com/b3/6e/yV6kqBmQ_o.png" alt="image-20220427183315490"></p> 
<p>PC2的IP映射为了15.0.0.12</p> 
<h4><a id="3Easyip_169"></a>3）Easyip（多个内网地址对一个接口地址）</h4> 
<p><img src="https://images2.imgbox.com/66/35/uioLh4pY_o.png" alt="image-20220427183655357"></p> 
<p>设置ACL 访问控制</p> 
<p><img src="https://images2.imgbox.com/6f/a7/9C1GaUyp_o.png" alt="image-20220427183823455"></p> 
<p>EIP相比之前两者来说实用性更好一点，EIP是多个内网地址对应一个接口，而不是一个地址了，出去的时候不需要映射一个单独定义的公网地址的范围或确定的公网地址。</p> 
<p>尝试在PC1、PC2 ping PC</p> 
<p><img src="https://images2.imgbox.com/f1/0e/lT1gIUY4_o.png" alt="image-20220427185039550"></p> 
<p><img src="https://images2.imgbox.com/56/98/QiNSSkRz_o.png" alt="image-20220427185237402"></p> 
<p>可以看到映射的都是接口IP 200.10.100.1</p> 
<h4><a id="4PATIP__IP_191"></a>4）静态PAT（一对一，外网口IP和服务 映射 网内网服务器的IP和服务）</h4> 
<p>目的：在路由器AR2可以通过FTP的方式登录和访问内网服务器的内容</p> 
<p><img src="https://images2.imgbox.com/16/af/RQG4Bwn4_o.png" alt="image-20220428124643606"></p> 
<p>配置 Server 1</p> 
<p><img src="https://images2.imgbox.com/8e/4c/3sfsyHpf_o.png" alt="image-20220427213029805"></p> 
<p>21端口默认为FTP端口</p> 
<p><img src="https://images2.imgbox.com/e2/f9/CcmcPbGE_o.png" alt="image-20220428125207169"></p> 
<p>配置路由器AR1</p> 
<p><img src="https://images2.imgbox.com/5a/7a/MFNGWaFs_o.png" alt="image-20220427185552216"></p> 
<p>因为映射IP是配置在loopback回环接口上的，当要转发到200.10.100.2时跨网段了，所以AR1需要配置静态理由，此题中可以设置默认路由</p> 
<p><img src="https://images2.imgbox.com/0b/43/LPjLl3Xn_o.png" alt="image-20220427212837941"></p> 
<p>进入外网口配置映射</p> 
<p>nat （映射）server（服务） protocol （协议）tcp global （全局）15.0.0.10 21（端口） inside 192.168.1.10 21</p> 
<p><img src="https://images2.imgbox.com/cd/5e/nMukSpvT_o.png" alt="image-20220427212125681"></p> 
<p>FTP服务默认数据端口没有开启，需要手动去开</p> 
<p><img src="https://images2.imgbox.com/c6/2c/qdAfqiCK_o.png" alt="image-20220427205922082"></p> 
<p>AR2配置静态路由</p> 
<p><img src="https://images2.imgbox.com/6b/a9/Kw8hYCek_o.png" alt="image-20220428130948139"></p> 
<p>因为配置映射的时候并没有配置子网掩码，默认子网掩码是 /32，所以需要AR3需要配置静态路由指向 /32 的唯一地址</p> 
<p><img src="https://images2.imgbox.com/1a/0a/IqgVBzuU_o.png" alt="image-20220427192948944"></p> 
<p>最后，在AR2尝试FTP登录，指定映射端口15.0.0.10（注意是在用户模式下）</p> 
<p><img src="https://images2.imgbox.com/18/2c/gxQyyWQ5_o.png" alt="image-20220428130737321"></p> 
<p>可以看到，在AR2位置已经可以登录并访问Server 1 了</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/bf398f4634c090f48936e5b373425ab9/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">缓冲池（Buffer Pool）介绍</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/524a0e7ac230c7b380fb92d11f006b60/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">oracle update from</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>