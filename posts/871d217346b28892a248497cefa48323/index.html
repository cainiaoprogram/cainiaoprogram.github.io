<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>CentOS7 交换文件(swap file)设置 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="CentOS7 交换文件(swap file)设置" />
<meta property="og:description" content="问题来源 想在买的VPS上搭点博客服务，偏爱于动态博客之类的，选用了nodejs，范围一下就减小了，一开始看中了N-blog。需要安装bower，如果在安装的时候，一直提示npm版本问题：
npm WARN deprecated This version of npm lacks support for important features, npm WARN deprecated such as scoped packages, offered by the primary npm npm WARN deprecated registry. Consider upgrading to at least npm@2, if not the npm WARN deprecated latest stable version. To upgrade to npm@2, run: npm WARN deprecated npm WARN deprecated npm -g install npm@latest-2 npm WARN deprecated npm WARN deprecated To upgrade to the latest stable version, run: npm WARN deprecated npm WARN deprecated npm -g install npm@latest npm WARN deprecated npm WARN deprecated (Depending on how Node." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/871d217346b28892a248497cefa48323/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2016-06-19T03:28:40+08:00" />
<meta property="article:modified_time" content="2016-06-19T03:28:40+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">CentOS7 交换文件(swap file)设置</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2 id="问题来源">问题来源</h2> 
<p>想在买的VPS上搭点博客服务，偏爱于动态博客之类的，选用了nodejs，范围一下就减小了，一开始看中了<a href="https://github.com/nswbmw/N-blog">N-blog</a>。需要安装bower，如果在安装的时候，一直提示npm版本问题：</p> 
<pre class="prettyprint"><code class=" hljs applescript">npm WARN deprecated This <span class="hljs-property">version</span> <span class="hljs-keyword">of</span> npm lacks support <span class="hljs-keyword">for</span> important features,
npm WARN deprecated such <span class="hljs-keyword">as</span> scoped packages, offered <span class="hljs-keyword">by</span> <span class="hljs-keyword">the</span> primary npm
npm WARN deprecated registry. Consider upgrading <span class="hljs-keyword">to</span> <span class="hljs-keyword">at</span> least npm@<span class="hljs-number">2</span>, <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">the</span>
npm WARN deprecated latest stable <span class="hljs-property">version</span>. To upgrade <span class="hljs-keyword">to</span> npm@<span class="hljs-number">2</span>, <span class="hljs-command">run</span>:
npm WARN deprecated 
npm WARN deprecated   npm -g install npm@latest-<span class="hljs-number">2</span>
npm WARN deprecated 
npm WARN deprecated To upgrade <span class="hljs-keyword">to</span> <span class="hljs-keyword">the</span> latest stable <span class="hljs-property">version</span>, <span class="hljs-command">run</span>:
npm WARN deprecated 
npm WARN deprecated   npm -g install npm@latest
npm WARN deprecated 
npm WARN deprecated (Depending <span class="hljs-function_start"><span class="hljs-keyword">on</span></span> how Node.js was installed <span class="hljs-function_start"><span class="hljs-keyword">on</span></span> your system, you
npm WARN deprecated may need <span class="hljs-keyword">to</span> prefix <span class="hljs-keyword">the</span> preceding commands <span class="hljs-keyword">with</span> `sudo`, <span class="hljs-keyword">or</span> <span class="hljs-keyword">if</span>
npm WARN deprecated <span class="hljs-function_start"><span class="hljs-keyword">on</span></span> Windows, <span class="hljs-command">run</span> them <span class="hljs-keyword">from</span> an Administrator prompt.)
npm WARN deprecated 
npm WARN deprecated If you're <span class="hljs-property">running</span> <span class="hljs-keyword">the</span> <span class="hljs-property">version</span> <span class="hljs-keyword">of</span> npm bundled <span class="hljs-keyword">with</span>
npm WARN deprecated Node.js <span class="hljs-number">0.10</span> LTS, be aware <span class="hljs-keyword">that</span> <span class="hljs-keyword">the</span> next <span class="hljs-property">version</span> <span class="hljs-keyword">of</span> <span class="hljs-number">0.10</span> LTS
npm WARN deprecated will be bundled <span class="hljs-keyword">with</span> a <span class="hljs-property">version</span> <span class="hljs-keyword">of</span> npm@<span class="hljs-number">2</span>, which has <span class="hljs-keyword">some</span> small
npm WARN deprecated backwards-incompatible changes made <span class="hljs-keyword">to</span> `npm <span class="hljs-command">run</span>-<span class="hljs-keyword">script</span>` <span class="hljs-keyword">and</span>
npm WARN deprecated semver behavior.</code></pre> 
<p>提示其实很清楚，是说npm版本太低，有一些特性不支持。参照提示，执行</p> 
<pre class="prettyprint"><code class=" hljs coffeescript"><span class="hljs-built_in">npm</span> -g install <span class="hljs-built_in">npm</span><span class="hljs-property">@latest</span></code></pre> 
<p>同样先出现一屏提示，毕竟npm在这个时刻还没有升级，等了几十秒钟后，出现了如下</p> 
<pre class="prettyprint"><code class=" hljs lasso"><span class="hljs-attribute">...</span><span class="hljs-attribute">...</span>以上省略
npm WARN deprecated backwards<span class="hljs-attribute">-incompatible</span> changes made <span class="hljs-keyword">to</span> <span class="hljs-string">`npm run-script`</span> <span class="hljs-literal">and</span>
npm WARN deprecated semver behavior<span class="hljs-built_in">.</span>
Killed</code></pre> 
<p>如果不细心，就发现莫名其妙的结束了，而npm也没有更新。仔细看，会发现最后一行出现一个Killed提示。 <br> 到网上一搜，可以发现，这个是因为<b>内存不够</b>，服务器内存不够，于是程序就直接结束了。其实如果VPS内存较小的话，不仅在安装nodejs库的时候会出现问题，直接使用yum安装包的时候，也会提示<b>Cannot allocate memory</b>的Error。</p> 
<h2 id="solution">Solution</h2> 
<h3 id="升级vps配置">升级VPS配置</h3> 
<p>最简单的办法当然是升级VPS配置了，这个去网页上点点按钮就可以，只要掏钱就行。 <br> 对个人玩家而言，不过是用VPS上搭点个人网站、折腾点小玩意，没多大流量，往往不需要太好的配置。于是，就采用下面一个办法了，增加<b>交换文件</b>。</p> 
<h3 id="swap-file">SWAP FILE</h3> 
<p>我们平时听得更多的可能是交换分区，就是直接在硬盘上单独分一个区来当作交换空间使用。如果是在系统已经安装好后，不方便新建分区，可以使用文件来替代。 <br> 交换空间实质就是硬盘，在系统中用作内存的一个较大的缓存，操作系统内存不够用的时候，会把一些不常用的页替换到交换空间里面。所以，交换空间会改善一些系统的性能。 <br> 但交换空间不是越大越好，因为应用程序如果刚好用到了交换空间的数据，这个时候会有一个比较大的延迟，太大的交换分区会导致大量的应用程序高延迟的情况出现。所以，如果程序有大内存需求，最好的办法还是增加物理内存。<b>买内存才是王道</b>，交换空间只是一个稍微改善性能的途径而已。</p> 
<h2 id="centos7设置交换文件">CentOS7设置交换文件</h2> 
<h3 id="检查系统条件">检查系统条件</h3> 
<p>首先，检查系统是否已经设置了交换空间，原则上，交换空间尽量只设置一个。另外，也需要检查，系统是否有足够剩余硬盘空间。</p> 
<pre class="prettyprint"><code class=" hljs bash">swapon <span class="hljs-operator">-s</span></code></pre> 
<p>可以通过swapon命令查看系统的交换空间，或者，也可以通过free命令来查看。</p> 
<pre class="prettyprint"><code class=" hljs lasso">free <span class="hljs-attribute">-h</span></code></pre> 
<p>通过df命令，来检查系统的剩余硬盘空间。</p> 
<pre class="prettyprint"><code class=" hljs lasso">df <span class="hljs-attribute">-h</span></code></pre> 
<h3 id="创建swap文件">创建swap文件</h3> 
<p>通过fallocate命令来新建一个交换文件，由于我的系统内存是512M，交换分区一般设置为内存了2~4倍，所以我设置成了1G，直接挂载到根目录下。</p> 
<pre class="prettyprint"><code class=" hljs bash"><span class="hljs-built_in">sudo</span> fallocate <span class="hljs-operator">-l</span> <span class="hljs-number">1</span>G /swapfile</code></pre> 
<p>可以通过ls命令来查看</p> 
<pre class="prettyprint"><code class=" hljs mel"><span class="hljs-keyword">ls</span> -lh /swapfile</code></pre> 
<p>结果如下</p> 
<pre class="prettyprint"><code class=" hljs brainfuck"><span class="hljs-literal">-</span><span class="hljs-comment">rw</span><span class="hljs-literal">-</span><span class="hljs-comment">r</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">r</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span> <span class="hljs-comment">1</span> <span class="hljs-comment">root</span> <span class="hljs-comment">root</span> <span class="hljs-comment">1</span><span class="hljs-string">.</span><span class="hljs-comment">0G</span> <span class="hljs-comment">Oct</span> <span class="hljs-comment">30</span> <span class="hljs-comment">11:00</span> <span class="hljs-comment">/swapfile</span></code></pre> 
<h3 id="启用交换文件">启用交换文件</h3> 
<p>首先，修改/swapfile权限，只允许root用户访问。</p> 
<pre class="prettyprint"><code class=" hljs bash"><span class="hljs-built_in">sudo</span> chmod <span class="hljs-number">600</span> /swapfile</code></pre> 
<p>ls的结果如下</p> 
<pre class="prettyprint"><code class=" hljs brainfuck"><span class="hljs-literal">-</span><span class="hljs-comment">rw</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span> <span class="hljs-comment">1</span> <span class="hljs-comment">root</span> <span class="hljs-comment">root</span> <span class="hljs-comment">1</span><span class="hljs-string">.</span><span class="hljs-comment">0G</span> <span class="hljs-comment">Oct</span> <span class="hljs-comment">30</span> <span class="hljs-comment">11:00</span> <span class="hljs-comment">/swapfile</span></code></pre> 
<p>接下来，通知系统创建交换空间</p> 
<pre class="prettyprint"><code class=" hljs bash"><span class="hljs-built_in">sudo</span> mkswap /swapfile</code></pre> 
<p>最后，启用交换空间</p> 
<pre class="prettyprint"><code class=" hljs bash"><span class="hljs-built_in">sudo</span> swapon /swapfile</code></pre> 
<p>可以通过swapon -s或者df -h命令来查看结果，交换空间应该会显示出来。</p> 
<h3 id="持久化配置">持久化配置</h3> 
<p>重启后，系统就不会再将/swapfile设置为交换空间了。 <br> 可以在/etc/fstab中添加如下</p> 
<pre class="prettyprint"><code class=" hljs avrasm">/swapfile   <span class="hljs-keyword">swap</span>    <span class="hljs-keyword">swap</span>    sw  <span class="hljs-number">0</span>   <span class="hljs-number">0</span></code></pre> 
<p>这样，重启后系统会自动将/swapfile映射为交换空间。</p> 
<h2 id="最后">最后</h2> 
<p>可以想象，如果实际内存需求远超物理内存大小，会频繁的出现内存和交换空间的数据交换情况，对硬盘的损伤是比较大的。而且，应用体验也会比较差。</p> 
<p>所以，<b>交换空间只是临时解决办法，买内存条才是王道</b>。</p> 
<h2 id="附本文参考">附本文参考</h2> 
<p><a href="https://www.digitalocean.com/community/questions/npm-gets-killed-no-matter-what" rel="nofollow">NPM gets killed no matter what.</a></p> 
<p><a href="https://www.digitalocean.com/community/tutorials/how-to-add-swap-on-centos-7" rel="nofollow">How To Add Swap on CentOS 7</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5a99290d5d7277f075d36fb43e708ee4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Nginx反向代理新篇-使用location对多个URL做反向代理</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6c2d87e6ff3140112b6d248a6f3a1249/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Android中使用Thread线程与AsyncTask异步任务的区别</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>