<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ntp服务器修改时区,部署ntp服务器笔记与时区的介绍与修改 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ntp服务器修改时区,部署ntp服务器笔记与时区的介绍与修改" />
<meta property="og:description" content="准备工作：
server ip:10.1.1.119
client ip :10.1.1.56
关闭selinux：
vi /etc/selinux/config
SELINUX=disabled
关闭iptables：
service iptables stop
chkconfig iptables off
一.安装NTP软件包：
yum -y install ntp /*yum安装NTP服务*/
chkconfig --add ntpd /*添加NTP*/
chkconfig ntpd on /*开机自启动NTP*/
二.修改NTP配置文件：
vim /etc/ntp.conf
# For more information about this file, see the man pages
# ntp.conf(5), ntp_acc(5), ntp_auth(5), ntp_clock(5), ntp_misc(5), ntp_mon(5).
driftfile /var/lib/ntp/drift
#设置默认策略为拒绝所有访问方式的请求
restrict default ignore
# Permit time synchronization with our time source, but do not" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/0805d841e698ca2ce8e20ca642263765/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-08-10T08:07:06+08:00" />
<meta property="article:modified_time" content="2021-08-10T08:07:06+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ntp服务器修改时区,部署ntp服务器笔记与时区的介绍与修改</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="font-size:16px;"> 
 <p>准备工作：</p> 
 <p>server ip:10.1.1.119</p> 
 <p>client  ip :10.1.1.56</p> 
 <p>关闭selinux：</p> 
 <p>vi /etc/selinux/config</p> 
 <p>SELINUX=disabled</p> 
 <p>关闭iptables：</p> 
 <p>service iptables stop</p> 
 <p>chkconfig iptables off</p> 
 <p>一.安装NTP软件包：</p> 
 <p>yum -y install ntp /*yum安装NTP服务*/</p> 
 <p>chkconfig --add ntpd /*添加NTP*/</p> 
 <p>chkconfig ntpd on /*开机自启动NTP*/</p> 
 <p>二.修改NTP配置文件：</p> 
 <p>vim /etc/ntp.conf</p> 
 <p># For more information about this file, see the man pages</p> 
 <p># ntp.conf(5), ntp_acc(5), ntp_auth(5), ntp_clock(5), ntp_misc(5), ntp_mon(5).</p> 
 <p>driftfile /var/lib/ntp/drift</p> 
 <p>#设置默认策略为拒绝所有访问方式的请求</p> 
 <p>restrict default ignore</p> 
 <p># Permit time synchronization with our time source, but do not</p> 
 <p># permit the source to query or modify the service on this system.</p> 
 <p>restrict default kod nomodify notrap nopeer noquery</p> 
 <p>restrict -6 default kod nomodify notrap nopeer noquery</p> 
 <p># Permit all access over the loopback interface.  This could(</p> 
 <p># be tightened as well, but to do so would effect some of</p> 
 <p># the administrative functions.</p> 
 <p>restrict 127.0.0.1</p> 
 <p>restrict -6 ::1</p> 
 <p># Hosts on local network are less restricted.</p> 
 <p>#restrict 192.168.1.0 mask 255.255.255.0 nomodify notrap</p> 
 <p>#允许局域网内机器同步时间(这里有待test能不能测试多个网段同步时间)</p> 
 <p>restrict 10.1.1.0 mask 255.255.255.0 nomodify notrap</p> 
 <p># Use public servers from the pool.ntp.org project.</p> 
 <p># Please consider joining the pool (http://www.pool.ntp.org/join.html).</p> 
 <p>#server 0.centos.pool.ntp.org iburst</p> 
 <p>#server 1.centos.pool.ntp.org iburst</p> 
 <p>#server 2.centos.pool.ntp.org iburst</p> 
 <p>#server 3.centos.pool.ntp.org iburst</p> 
 <p>#设置同步服务器加prefer表示优先</p> 
 <p>server 0.cn.pool.ntp.org prefer</p> 
 <p>server 1.s2m.time.edu.cn</p> 
 <p>server 2.1.cn.pool.ntp.org</p> 
 <p>#broadcast 192.168.1.255 autokey # broadcast server</p> 
 <p>#broadcastclient   # broadcast client</p> 
 <p>#broadcast 224.0.1.1 autokey  # multicast server</p> 
 <p>#multicastclient 224.0.1.1  # multicast client</p> 
 <p>#manycastserver 239.255.254.254  # manycast server</p> 
 <p>#manycastclient 239.255.254.254 autokey # manycast client</p> 
 <p>#允许与上层服务器同步时间</p> 
 <p>restrict 0.cn.pool.ntp.org nomodify notrap noquery</p> 
 <p>restrict 1.s2m.time.edu.cn nomodify notrap noquery</p> 
 <p>restrict 2.1.cn.pool.ntp.org nomodify notrap noquery</p> 
 <p># Undisciplined Local Clock. This is a fake driver intended for backup</p> 
 <p># # and when no outside source of synchronized time is available.</p> 
 <p>#外界同步源无法联系时，使用本地时间为同步服务</p> 
 <p>server  127.127.1.0     # local clock</p> 
 <p>fudge   127.127.1.0 stratum 0</p> 
 <p># Enable public key cryptography.</p> 
 <p>#crypto</p> 
 <p>includefile /etc/ntp/crypto/pw</p> 
 <p># Key file containing the keys and key identifiers used when operating</p> 
 <p># with symmetric key cryptography.</p> 
 <p>keys /etc/ntp/keys</p> 
 <p># Specify the key identifiers which are trusted.</p> 
 <p>#trustedkey 4 8 42</p> 
 <p># Specify the key identifier to use with the ntpdc utility.</p> 
 <p>#requestkey 8</p> 
 <p># Specify the key identifier to use with the ntpq utility.</p> 
 <p>#controlkey 8</p> 
 <p># Enable writing of statistics records.</p> 
 <p>#statistics clockstats cryptostats loopstats peerstats</p> 
 <p>注意：这里要注意机器的所在时区</p> 
 <p>/usr/share/zoneinfo/Asia/ #下保存着系统各个时区信息</p> 
 <p>/etc/localtime 保存当前系统时区及时间信息</p> 
 <p>修改时区前显示：</p> 
 <p>[root@localhost ~]# date</p> 
 <p>Mon Jul 27 21:41:14 PDT 2015</p> 
 <p>示例修改时区</p> 
 <p>[root@localhost ~]# cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</p> 
 <p>cp: overwrite `/etc/localtime'? y</p> 
 <p>修改时区以后显示：</p> 
 <p>[root@localhost ~]# date</p> 
 <p>Tue Jul 28 12:43:00 CST 2015</p> 
 <p>PDT 是Pacific Daylight Time的简称,意思是太平洋夏令时</p> 
 <p>UTC 世界协调时间UTC</p> 
 <p>格林威治标准时间GMT</p> 
 <p>CST可以同时表示美国，澳大利亚，中国，古巴四个国家的标准时间</p> 
 <p>三.与上层服务器同步时间：</p> 
 <p>[root@yql ~]# ntpdate cn.pool.ntp.org</p> 
 <p>启动NTP服务</p> 
 <p>[root@yql ~]# service ntpd start</p> 
 <p>正在启动 ntpd：                                            [确定]</p> 
 <p>[root@yql ~]# date</p> 
 <p>2015年 07月 28日 星期二 12:19:55 CST</p> 
 <p>五.在客户机测试时间同步：</p> 
 <p>[root@localhost ~]# ntpdate 10.1.1.119</p> 
 <p>28 Jul 12:43:40 ntpdate[1551]: adjust time server 10.1.1.119 offset 0.057411 sec</p> 
 <p>问题1：</p> 
 <p>[root@PXEServer ~]# ntpdate 0.centos.pool.ntp.org</p> 
 <p>8 Nov 11:12:34 ntpdate[4606]: the NTP socket is in use, exiting</p> 
 <p>原因：该机已经运行NTP服务。</p> 
 <p>解决：</p> 
 <p>[root@PXEServer ~]# service ntpd stop</p> 
 <p>关闭 ntpd：[确定]</p> 
 <p>[root@PXEServer ~]# ntpdate 0.centos.pool.ntp.org</p> 
 <p>8 Nov 11:13:09 ntpdate[4618]: adjust time server 202.112.29.82 offset -0.037618 sec</p> 
 <p>[root@PXEServer ~]# service ntpd start</p> 
 <p>正在启动 ntpd：[确定]</p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/094d5386cf1735dfe9a0a5b82fd82129/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">虚拟化服务器的管理与维,服务器虚拟化管理</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5a3c1a9b255b5b00e046c311dea40682/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">VMware提示【该虚拟机似乎正在使用中】的解决方案</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>