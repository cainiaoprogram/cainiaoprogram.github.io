<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Python爬虫：github自动登录，ctfhub自动签到(带验证码) - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Python爬虫：github自动登录，ctfhub自动签到(带验证码)" />
<meta property="og:description" content="目录 0x00 写在前面0x01 GitHub的登录0x02 CTFHub的登录0x03 CTFHub自动登录，签到的完整代码 0x00 写在前面 这次是记录学习过程中关于自动登录的案例，在这几天的学习中发现，很多情况下，我们都只有在登录的情况下才能看到我们想要的数据，所以自动登录是爬虫必不可少的一环
0x01 GitHub的登录 github登录网址：https://github.com/login
github的登录不需要验证码验证，也就不需要定位，直接post就行了，相对简单，就试了试不使用selenium，先用123测试一下发送数据的格式
在session下找到了post的数据
其中，用红框框起来的几条数据，看起来像是动态生成的，去网页源码里搜索一下
找到了位置，从而我们就得到了data里的所有数据。值得注意的是，这里是用了cookie在储存数据
而如果我们的request不带有cookie，登录的时候就会出现…
不能正常登录，所以我们要使用
session=requests.session() 来为网站创建一个会话对象，这样就能自动生成，储存cookie，从而正常登录，完整代码如下：
from lxml import etree import requests url=&#39;https://github.com/login&#39; headers={&#34;User-Agent&#34;: &#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:77.0) Gecko/20100101 Firefox/77.0&#34;} session=requests.session()#创建会话对象，后面的所有请求都由此对象发出 response=session.get(url=url,headers=headers) response.encoding=&#39;utf-8&#39; tree=etree.HTML(response.text) token=tree.xpath(&#39;//*[@name=&#34;authenticity_token&#34;]/@value&#39;)[0] #gaid=tree.xpath(&#39;//*[@class=&#34;js-octo-ga-id-input&#34;]/@value&#39;)[0] timestamp=tree.xpath(&#39;//*[@name=&#34;timestamp&#34;]/@value&#39;)[0] timestampsec=tree.xpath(&#39;//*[@name=&#34;timestamp_secret&#34;]&#39;)[0] data = { &#39;commit&#39;: &#39;Sign in&#39;, &#39;authenticity_token&#39;: token, &#39;ga_id&#39;:&#39;929822435.1570627169&#39;,#可以看到本来我写了获取这个值的代码，但是我又发现这个值好像没变过，就直接写在这了 &#39;login&#39;: &#39;github帐号&#39;, &#39;password&#39;: &#39;github密码&#39;, &#39;webauthn-support&#39;: &#39;supported&#39;, &#39;webauthn-iuvpaa-support&#39;:&#39;unsupported&#39;, &#39;return_to:&#39;:&#39;&#39;, &#39;required_field_05fd&#39;:&#39;&#39;,#这里的05fd好像每次请求都不一样，但是好像是不影响登录，如果发现无法登录，可以试试post后查看对应参数并修改 &#39;timestamp&#39;:timestamp, &#39;timestamp_secret&#39;:timestampsec } login=session.post(url=&#39;https://github.com/session&#39;,data=data,headers=headers) f=open(&#39;login.html&#39;,&#39;w&#39;,encoding=&#39;utf-8&#39;) f.write(login.text)#将登录后的界面写入login.html，如果显示的页面不是错误页面则说明登录成功 0x02 CTFHub的登录 ctfhub的登录使用了selenium，因为又要弄验证码，而且这码还不简单" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/687fd19c42468d1d02026e556aeb9f8f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-08-28T22:08:30+08:00" />
<meta property="article:modified_time" content="2020-08-28T22:08:30+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Python爬虫：github自动登录，ctfhub自动签到(带验证码)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#0x00__1" rel="nofollow">0x00 写在前面</a></li><li><a href="#0x01_GitHub_3" rel="nofollow">0x01 GitHub的登录</a></li><li><a href="#0x02_CTFHub_52" rel="nofollow">0x02 CTFHub的登录</a></li><li><a href="#0x03_CTFHub_110" rel="nofollow">0x03 CTFHub自动登录，签到的完整代码</a></li></ul> 
</div> 
<p></p> 
<h2><a id="0x00__1"></a>0x00 写在前面</h2> 
<p>这次是记录学习过程中关于自动登录的案例，在这几天的学习中发现，很多情况下，我们都只有在登录的情况下才能看到我们想要的数据，所以自动登录是爬虫必不可少的一环</p> 
<h2><a id="0x01_GitHub_3"></a>0x01 GitHub的登录</h2> 
<p>github登录网址：<a href="https://github.com/login">https://github.com/login</a><br> github的登录不需要验证码验证，也就不需要定位，直接post就行了，相对简单，就试了试不使用selenium，先用123测试一下发送数据的格式<br> 在session下找到了post的数据<br> <img src="https://images2.imgbox.com/22/f2/024wUeQb_o.png" alt="在这里插入图片描述"></p> 
<p>其中，用红框框起来的几条数据，看起来像是动态生成的，去网页源码里搜索一下<br> <img src="https://images2.imgbox.com/40/8e/shhd1raq_o.png" alt="在这里插入图片描述"></p> 
<p>找到了位置，从而我们就得到了data里的所有数据。值得注意的是，这里是用了cookie在储存数据<br> <img src="https://images2.imgbox.com/80/b6/s4DcpZ0g_o.png" alt="在这里插入图片描述"></p> 
<p>而如果我们的request不带有cookie，登录的时候就会出现…<br> <img src="https://images2.imgbox.com/d6/0f/TZbazOt7_o.png" alt="在这里插入图片描述"><br> 不能正常登录，所以我们要使用</p> 
<pre><code class="prism language-python">session<span class="token operator">=</span>requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>来为网站创建一个会话对象，这样就能自动生成，储存cookie，从而正常登录，完整代码如下：</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree
<span class="token keyword">import</span> requests
url<span class="token operator">=</span><span class="token string">'https://github.com/login'</span>
headers<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">"User-Agent"</span><span class="token punctuation">:</span> <span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:77.0) Gecko/20100101 Firefox/77.0"</span><span class="token punctuation">}</span>
session<span class="token operator">=</span>requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#创建会话对象，后面的所有请求都由此对象发出</span>
response<span class="token operator">=</span>session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
response<span class="token punctuation">.</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span>
tree<span class="token operator">=</span>etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
token<span class="token operator">=</span>tree<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//*[@name="authenticity_token"]/@value'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token comment">#gaid=tree.xpath('//*[@class="js-octo-ga-id-input"]/@value')[0]</span>
timestamp<span class="token operator">=</span>tree<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//*[@name="timestamp"]/@value'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
timestampsec<span class="token operator">=</span>tree<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//*[@name="timestamp_secret"]'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'commit'</span><span class="token punctuation">:</span> <span class="token string">'Sign in'</span><span class="token punctuation">,</span>
    <span class="token string">'authenticity_token'</span><span class="token punctuation">:</span> token<span class="token punctuation">,</span>
    <span class="token string">'ga_id'</span><span class="token punctuation">:</span><span class="token string">'929822435.1570627169'</span><span class="token punctuation">,</span><span class="token comment">#可以看到本来我写了获取这个值的代码，但是我又发现这个值好像没变过，就直接写在这了</span>
    <span class="token string">'login'</span><span class="token punctuation">:</span> <span class="token string">'github帐号'</span><span class="token punctuation">,</span>
    <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'github密码'</span><span class="token punctuation">,</span>
    <span class="token string">'webauthn-support'</span><span class="token punctuation">:</span> <span class="token string">'supported'</span><span class="token punctuation">,</span>
    <span class="token string">'webauthn-iuvpaa-support'</span><span class="token punctuation">:</span><span class="token string">'unsupported'</span><span class="token punctuation">,</span>
    <span class="token string">'return_to:'</span><span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token string">'required_field_05fd'</span><span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token comment">#这里的05fd好像每次请求都不一样，但是好像是不影响登录，如果发现无法登录，可以试试post后查看对应参数并修改</span>
    <span class="token string">'timestamp'</span><span class="token punctuation">:</span>timestamp<span class="token punctuation">,</span>
    <span class="token string">'timestamp_secret'</span><span class="token punctuation">:</span>timestampsec
<span class="token punctuation">}</span>
login<span class="token operator">=</span>session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span><span class="token string">'https://github.com/session'</span><span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
f<span class="token operator">=</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'login.html'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>login<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token comment">#将登录后的界面写入login.html，如果显示的页面不是错误页面则说明登录成功</span>
</code></pre> 
<h2><a id="0x02_CTFHub_52"></a>0x02 CTFHub的登录</h2> 
<p>ctfhub的登录使用了selenium，因为又要弄验证码，而且这码还不简单<br> 网站：<a href="https://www.ctfhub.com/#/user/login" rel="nofollow">https://www.ctfhub.com/#/user/login</a><br> 先看看网页元素，我们要先定位帐号，密码，验证码的输入框和验证码图案的位置<br> <img src="https://images2.imgbox.com/a1/4e/rbQfK4yn_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/d6/95/x7E7G1y6_o.png" alt="帐号输入框位置"><br> <img src="https://images2.imgbox.com/84/36/tW8nqyrx_o.png" alt="密码输入框位置"><br> <img src="https://images2.imgbox.com/41/92/GqqYyllI_o.png" alt="验证码的位置"><br> 我们可以看到，他们的id或者class都是独一无二的，我们就可以通过id或class来定位，验证码图片的加密字符串只需要再经过正则匹配即可，代码如下</p> 
<pre><code class="prism language-python">options <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>ChromeOptions<span class="token punctuation">(</span><span class="token punctuation">)</span>
options<span class="token punctuation">.</span>add_experimental_option<span class="token punctuation">(</span><span class="token string">'excludeSwitches'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'enable-automation'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
driver <span class="token operator">=</span> Chrome<span class="token punctuation">(</span>options<span class="token operator">=</span>options<span class="token punctuation">)</span><span class="token comment">#这个设置是用来消除[浏览器正在受到自测软件控制]的影响</span>
driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://www.ctfhub.com/#/user/login'</span><span class="token punctuation">)</span>
driver<span class="token punctuation">.</span>find_element_by_id<span class="token punctuation">(</span><span class="token string">'account'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
driver<span class="token punctuation">.</span>find_element_by_id<span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
driver<span class="token punctuation">.</span>find_element_by_id<span class="token punctuation">(</span><span class="token string">'account'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span><span class="token string">'帐号'</span><span class="token punctuation">)</span>
driver<span class="token punctuation">.</span>find_element_by_id<span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span><span class="token string">'密码'</span><span class="token punctuation">)</span>
img <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element_by_class_name<span class="token punctuation">(</span><span class="token string">'getCaptcha'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get_attribute<span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span><span class="token comment">#验证码图片的src内容</span>
b64 <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">'data:image/png;base64,(.*)'</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token comment">#正则匹配加密字符串</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
这里是api解析验证码图片的代码，先不写出来哈
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
driver<span class="token punctuation">.</span>find_element_by_id<span class="token punctuation">(</span><span class="token string">'imgCaptcha'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span><span class="token string">'验证码'</span><span class="token punctuation">)</span><span class="token comment">#获取验证码输入框的位置并输入得到的验证码字符串</span>
</code></pre> 
<p>接着我就发现了问题，应该是我自己的原因，我定位‘确定’键的时候，没那么好定位，后来我意识到，我直接在验证码输入完之后，多send一个enter不就好了嘛</p> 
<pre><code class="prism language-python">driver<span class="token punctuation">.</span>find_element_by_id<span class="token punctuation">(</span><span class="token string">'imgCaptcha'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span>Keys<span class="token punctuation">.</span>ENTER<span class="token punctuation">)</span><span class="token comment">#这里要import一个新库，代码为：from selenium.webdriver.common.keys import Keys</span>
</code></pre> 
<p>下一个问题就是如何判断登陆成功，我的方法是如果driver的url没变，那就说明没登录成功，url改变，就是完成了登录跳转，当然，别忘了写一个while循环来循环写入验证码并尝试登陆，只要url变了直接break循环即可.</p> 
<pre><code class="prism language-python">    <span class="token keyword">if</span> <span class="token punctuation">(</span>driver<span class="token punctuation">.</span>current_url <span class="token operator">==</span> <span class="token string">'https://www.ctfhub.com/#/user/login'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'验证码错误，正在重试'</span><span class="token punctuation">)</span>
        driver<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span><span class="token string">'//*[@id="formLogin"]/div[1]/div[3]/div/div[4]/div[2]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#这句话是通过点击更新验证码，按理说不写也行，但是不写的时候超级鹰总是说系统错误</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>
</code></pre> 
<p>登录ctfhub之后的第一件事当然是签到了，但是，当你登录的时候，会出现一个弹出框<br> <img src="https://images2.imgbox.com/49/cf/yAimmFZy_o.png" alt="在这里插入图片描述"><br> 刚好挡住了我们要定位的元素，这里sleep是个方法，但是我是直接refresh网页，这样就没有弹出框了，而这里的签到隐藏在二级菜单中，我们需要鼠标的悬停操作来唤出二级菜单<br> <img src="https://images2.imgbox.com/39/cb/R5Ay3dVG_o.png" alt="在这里插入图片描述"></p> 
<p>这里的元素定位就不细说，直接上代码了</p> 
<pre><code class="prism language-python"><span class="token keyword">try</span><span class="token punctuation">:</span>
    driver<span class="token punctuation">.</span>refresh<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'test pass: refresh successful'</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Exception found"</span><span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#刷新页面</span>
sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
move <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span><span class="token string">'//*[@id="app"]/div/div/div[1]/div/div/div[2]/span[2]'</span><span class="token punctuation">)</span>
ActionChains<span class="token punctuation">(</span>driver<span class="token punctuation">)</span><span class="token punctuation">.</span>move_to_element<span class="token punctuation">(</span>move<span class="token punctuation">)</span><span class="token punctuation">.</span>perform<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#将鼠标悬停在个人名称上，唤出二级菜单</span>
driver<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span><span class="token string">'/html/body/div[2]/div/div/ul/li[1]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#点击二级菜单中的签到</span>
</code></pre> 
<p>这样我们就能够自动登录ctfhub并签到了，当然，爬取一些数据肯定也是可以的</p> 
<h2><a id="0x03_CTFHub_110"></a>0x03 CTFHub自动登录，签到的完整代码</h2> 
<pre><code class="prism language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver <span class="token keyword">import</span> Chrome<span class="token punctuation">,</span> ActionChains
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>common<span class="token punctuation">.</span>keys <span class="token keyword">import</span> Keys
<span class="token keyword">from</span> chaojiying <span class="token keyword">import</span> Chaojiying_Client<span class="token comment">#这里是导入了超级鹰的api</span>
<span class="token keyword">from</span> time <span class="token keyword">import</span> sleep
<span class="token keyword">import</span> re

options <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>ChromeOptions<span class="token punctuation">(</span><span class="token punctuation">)</span>
options<span class="token punctuation">.</span>add_experimental_option<span class="token punctuation">(</span><span class="token string">'excludeSwitches'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'enable-automation'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
driver <span class="token operator">=</span> Chrome<span class="token punctuation">(</span>options<span class="token operator">=</span>options<span class="token punctuation">)</span><span class="token comment">#这个设置是用来消除[浏览器正在受到自测软件控制]的影响</span>
driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://www.ctfhub.com/#/user/login'</span><span class="token punctuation">)</span>
driver<span class="token punctuation">.</span>find_element_by_id<span class="token punctuation">(</span><span class="token string">'account'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
driver<span class="token punctuation">.</span>find_element_by_id<span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
driver<span class="token punctuation">.</span>find_element_by_id<span class="token punctuation">(</span><span class="token string">'account'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span><span class="token string">'ctfhub帐号'</span><span class="token punctuation">)</span>
driver<span class="token punctuation">.</span>find_element_by_id<span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span><span class="token string">'ctfhub密码'</span><span class="token punctuation">)</span>
sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
cjy <span class="token operator">=</span> Chaojiying_Client<span class="token punctuation">(</span><span class="token string">'超级鹰帐号'</span><span class="token punctuation">,</span> <span class="token string">'超级鹰密码'</span><span class="token punctuation">,</span> <span class="token string">'软件号'</span><span class="token punctuation">)</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token comment">#这个sleep是我当时想先看看输入的验证码对不对而写的</span>
    img <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element_by_class_name<span class="token punctuation">(</span><span class="token string">'getCaptcha'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get_attribute<span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span>
    <span class="token comment">#print(img)</span>
    b64 <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">'data:image/png;base64,(.*)'</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token comment">#print(b64)</span>
    dic <span class="token operator">=</span> cjy<span class="token punctuation">.</span>PostBase64<span class="token punctuation">(</span>b64<span class="token punctuation">,</span> <span class="token number">1902</span><span class="token punctuation">)</span><span class="token comment">#这里的b64是加密字符串，1902是超级鹰的验证码类型参数，dic是返回的带有解析出来的验证码的字典</span>
    <span class="token comment">#print(dic)</span>
    driver<span class="token punctuation">.</span>find_element_by_id<span class="token punctuation">(</span><span class="token string">'imgCaptcha'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span>dic<span class="token punctuation">[</span><span class="token string">'pic_str'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">#写入得到的验证码</span>
    sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    driver<span class="token punctuation">.</span>find_element_by_id<span class="token punctuation">(</span><span class="token string">'imgCaptcha'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span>Keys<span class="token punctuation">.</span>ENTER<span class="token punctuation">)</span><span class="token comment">#写入enter，代替了  点击[确定]键 的行为</span>
    sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>driver<span class="token punctuation">.</span>current_url<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>driver<span class="token punctuation">.</span>current_url <span class="token operator">==</span> <span class="token string">'https://www.ctfhub.com/#/user/login'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'验证码错误，正在重试'</span><span class="token punctuation">)</span>
        cjy<span class="token punctuation">.</span>ReportError<span class="token punctuation">(</span>dic<span class="token punctuation">[</span><span class="token string">'pic_id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        driver<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span><span class="token string">'//*[@id="formLogin"]/div[1]/div[3]/div/div[4]/div[2]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#url不变，则登录失败</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span><span class="token comment">#改变则登录成功，跳出循环</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    driver<span class="token punctuation">.</span>refresh<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'test pass: refresh successful'</span><span class="token punctuation">)</span><span class="token comment">#登录成功后先刷新，消除掉弹窗</span>
<span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Exception found"</span><span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span>
sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
move <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span><span class="token string">'//*[@id="app"]/div/div/div[1]/div/div/div[2]/span[2]'</span><span class="token punctuation">)</span>
ActionChains<span class="token punctuation">(</span>driver<span class="token punctuation">)</span><span class="token punctuation">.</span>move_to_element<span class="token punctuation">(</span>move<span class="token punctuation">)</span><span class="token punctuation">.</span>perform<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#将鼠标悬停在个人名称上，唤出二级菜单</span>
driver<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span><span class="token string">'/html/body/div[2]/div/div/ul/li[1]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#点击签到</span>

</code></pre> 
<p>里面关于base64数据获取的详见上一篇博客…</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c2555dcfc70819a27302c9f272ddd593/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">3D数学-基础光照</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8d7aa4102b1f5856d06e380f1c6e5a10/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">因 Redis Key 命令不规范，导致熬了一个通宵才把Key删完了！</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>