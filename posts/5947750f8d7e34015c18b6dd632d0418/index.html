<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>docker下安装clickhouse - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="docker下安装clickhouse" />
<meta property="og:description" content="文章目录 01 前言02 安装03 修改配置3.1 安装vim插件3.2 修改用户密码 04 验证 01 前言 clickhouse docker hub首页：https://hub.docker.com/r/yandex/clickhouse-server，这里描述了clickhouse在docker下的简介以及部署方式：
搜索自己需要的版本：https://hub.docker.com/r/yandex/clickhouse-server/tags?page=1：
访问：https://hub.docker.com/r/yandex/clickhouse-server/dockerfile查看dockerfile，内容如下（已添加注释）：
# 使用基础镜像为 Ubuntu 18.04 FROM ubuntu:18.04 # 设置构建参数：ClickHouse仓库、版本和gosu版本 ARG repository=&#34;deb http://repo.yandex.ru/clickhouse/deb/stable/ main/&#34; ARG version=19.1.13 ARG gosu_ver=1.10 # 更新APT源，并安装所需软件和依赖 RUN apt-get update \ &amp;&amp; apt-get install --yes --no-install-recommends \ apt-transport-https \ dirmngr \ gnupg \ &amp;&amp; mkdir -p /etc/apt/sources.list.d \ &amp;&amp; apt-key adv --keyserver keyserver.ubuntu.com --recv E0C56BD4 \ &amp;&amp; echo $repository &gt; /etc/apt/sources.list.d/clickhouse.list \ &amp;&amp; apt-get update \ &amp;&amp; env DEBIAN_FRONTEND=noninteractive \ apt-get install --allow-unauthenticated --yes --no-install-recommends \ clickhouse-common-static=$version \ clickhouse-client=$version \ clickhouse-server=$version \ libgcc-7-dev \ locales \ tzdata \ wget \ &amp;&amp; rm -rf \ /var/lib/apt/lists/* \ /var/cache/debconf \ /tmp/* \ &amp;&amp; apt-get clean # 下载并安装gosu工具 ADD https://github." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/5947750f8d7e34015c18b6dd632d0418/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-29T11:00:17+08:00" />
<meta property="article:modified_time" content="2023-08-29T11:00:17+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">docker下安装clickhouse</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#01__1" rel="nofollow">01 前言</a></li><li><a href="#02__77" rel="nofollow">02 安装</a></li><li><a href="#03__96" rel="nofollow">03 修改配置</a></li><li><ul><li><a href="#31_vim_97" rel="nofollow">3.1 安装vim插件</a></li><li><a href="#32__110" rel="nofollow">3.2 修改用户密码</a></li></ul> 
  </li><li><a href="#04__137" rel="nofollow">04 验证</a></li></ul> 
</div> 
<p></p> 
<h2><a id="01__1"></a>01 前言</h2> 
<p>clickhouse docker hub首页：<a href="https://hub.docker.com/r/yandex/clickhouse-server" rel="nofollow">https://hub.docker.com/r/yandex/clickhouse-server</a>，这里描述了clickhouse在docker下的简介以及部署方式：<br> <img src="https://images2.imgbox.com/0d/8d/dkPD9B6I_o.png" alt="在这里插入图片描述"></p> 
<p>搜索自己需要的版本：<a href="https://hub.docker.com/r/yandex/clickhouse-server/tags?page=1" rel="nofollow">https://hub.docker.com/r/yandex/clickhouse-server/tags?page=1</a>：<br> <img src="https://images2.imgbox.com/87/9e/kNj97BOO_o.png" alt="在这里插入图片描述"></p> 
<p>访问：<a href="https://hub.docker.com/r/yandex/clickhouse-server/dockerfile" rel="nofollow">https://hub.docker.com/r/yandex/clickhouse-server/dockerfile</a>查看dockerfile，内容如下（已添加注释）：</p> 
<pre><code class="prism language-shell"><span class="token comment"># 使用基础镜像为 Ubuntu 18.04</span>
FROM ubuntu:18.04

<span class="token comment"># 设置构建参数：ClickHouse仓库、版本和gosu版本</span>
ARG <span class="token assign-left variable">repository</span><span class="token operator">=</span><span class="token string">"deb http://repo.yandex.ru/clickhouse/deb/stable/ main/"</span>
ARG <span class="token assign-left variable">version</span><span class="token operator">=</span><span class="token number">19.1</span>.13
ARG <span class="token assign-left variable">gosu_ver</span><span class="token operator">=</span><span class="token number">1.10</span>

<span class="token comment"># 更新APT源，并安装所需软件和依赖</span>
RUN <span class="token function">apt-get</span> update <span class="token punctuation">\</span>
    <span class="token operator">&amp;&amp;</span> <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token parameter variable">--yes</span> --no-install-recommends <span class="token punctuation">\</span>
        apt-transport-https <span class="token punctuation">\</span>
        dirmngr <span class="token punctuation">\</span>
        gnupg <span class="token punctuation">\</span>
    <span class="token operator">&amp;&amp;</span> <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/apt/sources.list.d <span class="token punctuation">\</span>
    <span class="token operator">&amp;&amp;</span> apt-key adv <span class="token parameter variable">--keyserver</span> keyserver.ubuntu.com <span class="token parameter variable">--recv</span> E0C56BD4 <span class="token punctuation">\</span>
    <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span> <span class="token variable">$repository</span> <span class="token operator">&gt;</span> /etc/apt/sources.list.d/clickhouse.list <span class="token punctuation">\</span>
    <span class="token operator">&amp;&amp;</span> <span class="token function">apt-get</span> update <span class="token punctuation">\</span>
    <span class="token operator">&amp;&amp;</span> <span class="token function">env</span> <span class="token assign-left variable">DEBIAN_FRONTEND</span><span class="token operator">=</span>noninteractive <span class="token punctuation">\</span>
        <span class="token function">apt-get</span> <span class="token function">install</span> --allow-unauthenticated <span class="token parameter variable">--yes</span> --no-install-recommends <span class="token punctuation">\</span>
            clickhouse-common-static<span class="token operator">=</span><span class="token variable">$version</span> <span class="token punctuation">\</span>
            clickhouse-client<span class="token operator">=</span><span class="token variable">$version</span> <span class="token punctuation">\</span>
            clickhouse-server<span class="token operator">=</span><span class="token variable">$version</span> <span class="token punctuation">\</span>
            libgcc-7-dev <span class="token punctuation">\</span>
            locales <span class="token punctuation">\</span>
            tzdata <span class="token punctuation">\</span>
            <span class="token function">wget</span> <span class="token punctuation">\</span>
    <span class="token operator">&amp;&amp;</span> <span class="token function">rm</span> <span class="token parameter variable">-rf</span> <span class="token punctuation">\</span>
        /var/lib/apt/lists/* <span class="token punctuation">\</span>
        /var/cache/debconf <span class="token punctuation">\</span>
        /tmp/* <span class="token punctuation">\</span>
    <span class="token operator">&amp;&amp;</span> <span class="token function">apt-get</span> clean

<span class="token comment"># 下载并安装gosu工具</span>
ADD https://github.com/tianon/gosu/releases/download/1.10/gosu-amd64 /bin/gosu

<span class="token comment"># 生成en_US.UTF-8语言环境</span>
RUN locale-gen en_US.UTF-8
ENV <span class="token environment constant">LANG</span> en_US.UTF-8
ENV <span class="token environment constant">LANGUAGE</span> en_US:en
ENV <span class="token environment constant">LC_ALL</span> en_US.UTF-8

<span class="token comment"># 创建初始化数据库目录</span>
RUN <span class="token function">mkdir</span> /docker-entrypoint-initdb.d

<span class="token comment"># 复制配置文件和入口脚本到镜像中</span>
COPY docker_related_config.xml /etc/clickhouse-server/config.d/
COPY entrypoint.sh /entrypoint.sh

<span class="token comment"># 赋予入口脚本和gosu可执行权限</span>
RUN <span class="token function">chmod</span> +x <span class="token punctuation">\</span>
    /entrypoint.sh <span class="token punctuation">\</span>
    /bin/gosu

<span class="token comment"># 暴露ClickHouse的端口并设置数据卷</span>
EXPOSE <span class="token number">9000</span> <span class="token number">8123</span> <span class="token number">9009</span>
VOLUME /var/lib/clickhouse

<span class="token comment"># 设置ClickHouse配置文件路径并指定入口命令为entrypoint.sh</span>
ENV CLICKHOUSE_CONFIG /etc/clickhouse-server/config.xml
ENTRYPOINT <span class="token punctuation">[</span><span class="token string">"/entrypoint.sh"</span><span class="token punctuation">]</span>
</code></pre> 
<p>注意：<font color="red"><u>判断以上暴露的端口是否与本机已有的服务冲突</u></font>。</p> 
<h2><a id="02__77"></a>02 安装</h2> 
<p><strong>拉取镜像</strong>：</p> 
<pre><code class="prism language-shell"><span class="token function">docker</span> pull yandex/clickhouse-server:21.3.20.1
</code></pre> 
<p><img src="https://images2.imgbox.com/35/50/TlwtVeNV_o.png" alt="在这里插入图片描述"></p> 
<p><strong>启动容器</strong>：</p> 
<pre><code class="prism language-shell"><span class="token function">docker</span> run <span class="token parameter variable">--rm</span> <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span><span class="token operator">=</span>clickhouse-server <span class="token punctuation">\</span>
<span class="token parameter variable">--ulimit</span> <span class="token assign-left variable">nofile</span><span class="token operator">=</span><span class="token number">262144</span>:262144 <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">8123</span>:8123 <span class="token parameter variable">-p</span> <span class="token number">9009</span>:9009 <span class="token parameter variable">-p</span> <span class="token number">9090</span>:9000 <span class="token punctuation">\</span>
yandex/clickhouse-server:21.3.20.1
</code></pre> 
<p><img src="https://images2.imgbox.com/32/c1/J074Mwxa_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="03__96"></a>03 修改配置</h2> 
<h3><a id="31_vim_97"></a>3.1 安装vim插件</h3> 
<p>因为clickhouse容器里面是没有安装vim的，所以要手动安装：</p> 
<pre><code class="prism language-shell"><span class="token comment"># 进入容器</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> clickhouse-server <span class="token function">bash</span>

<span class="token comment">## 安装vim</span>
<span class="token function">apt-get</span> update
<span class="token function">apt-get</span> <span class="token function">install</span> <span class="token function">vim</span> <span class="token parameter variable">-y</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/88/bd/uFdNNP0S_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="32__110"></a>3.2 修改用户密码</h3> 
<p>在<code>/etc/clickhouse-server/users.xml</code>中配置用户密码，首先生成密码，这里需要sha256加密，加入我的命令为123456，执行命令：</p> 
<pre><code class="prism language-shell"><span class="token assign-left variable">PASSWORD</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>base64 <span class="token operator">&lt;</span> /dev/urandom <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-c8</span><span class="token variable">)</span></span><span class="token punctuation">;</span> <span class="token builtin class-name">echo</span> <span class="token string">"123456"</span><span class="token punctuation">;</span> <span class="token builtin class-name">echo</span> <span class="token parameter variable">-n</span> <span class="token string">"123456"</span> <span class="token operator">|</span> sha256sum <span class="token operator">|</span> <span class="token function">tr</span> <span class="token parameter variable">-d</span> <span class="token string">'-'</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/e0/7d/kSsMgJ5V_o.png" alt="在这里插入图片描述"><br> 使用vi命令，修改文件里面的“<code>&lt;password&gt;</code>”标签为“<code>&lt;password_sha256_hex&gt;</code>”然后复制加密后的密码进<code>/etc/clickhouse-server/users.xml</code>文件里面的<code>&lt;password_sha256_hex&gt;&lt;/password_sha256_hex&gt;</code>，:</p> 
<pre><code class="prism language-shell"><span class="token comment"># 编辑</span>
<span class="token function">vi</span> /etc/clickhouse-server/users.xml

<span class="token comment"># 复制password</span>
<span class="token operator">&lt;</span>password_sha256_hex<span class="token operator">&gt;</span>8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c9<span class="token operator"><span class="token file-descriptor important">2</span>&lt;</span>/password_sha256_hex<span class="token operator">&gt;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/e8/35/4D5FEQAV_o.png" alt="在这里插入图片描述"></p> 
<p>退出容器，然后重启：</p> 
<pre><code class="prism language-shell"><span class="token comment"># 退出</span>
<span class="token builtin class-name">exit</span>
<span class="token comment"># 重启</span>
<span class="token function">docker</span> restart clickhouse-server
</code></pre> 
<h2><a id="04__137"></a>04 验证</h2> 
<p>使用DBeaver连接Clickhouse，首先新建ClickHouse连接：<br> <img src="https://images2.imgbox.com/d7/d1/utBxNtBF_o.png" alt="在这里插入图片描述"><br> 配置信息如下：<br> <img src="https://images2.imgbox.com/50/2e/mPFLS1U4_o.png" alt="在这里插入图片描述"><br> 点击测试连接，根据指引去点击“next”，会自动下载相关的依赖，连接成功如下：<br> <img src="https://images2.imgbox.com/52/2b/5vwyjitv_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/13522f87e97caefaeb060baf22f1cb58/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">串口232接收数据代码，linux</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ddbfe7f61b41684941f1f116103f2964/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Chrome浏览器的跨域设置----包含新老版本两种设置</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>