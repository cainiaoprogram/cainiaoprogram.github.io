<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>pygame播放视频并实现音视频同步 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="pygame播放视频并实现音视频同步" />
<meta property="og:description" content="一、前言
在我接触pygame时最新的pygame已经不支持movie模块，这就导致在pygame播放视频变成一个问题，网上搜了下解决方案有两个：
一是使用opencv播放视频，再结合pygame.mixer来播放音频
二是使用moviepy播放视频，再结合pygame.mixer播放音频
上述两个方案其实都是先将mp4的视频分离成“画面帧”和“mp3音频”，所谓的播放实际上是不停地在切换“画面帧”，同时播放音频，最终实现音视频的同时播放。
但上述两个方案都存在“音画同步”的问题，因为无论是opencv还是moviepy都只负责将视频切片成帧，播放则是pygame自己在执行一个while循环来不停切换界面上展示出来的图片帧，这也就导致while循环很快就将帧播放完毕，而音频则还按着原有节奏缓慢播放。
解决是在while循环中加入合适的延时同时根据当前视频播放进度来设置音频的播放起点以实现同步，但这个方案据我实践在加入延时后就实现了较好的音画同步效果不知道为啥还要去设置音频的播放起点，另外在设置音频播放起点时一直提示错误也不知道为何，所以我这里提供两个方案：
方案一：在while循环中加入延时，短视频测试效果还行
方案二：根据音频的播放节奏来决定视频帧的播放节奏，这样音画肯定是同步的
我选择使用moviepy来做，因为moviepy从mp4中分离mp3比较简单。
二、方案一
在项目的目录下新建videos目录，并放入一个测试使用的mp4文件test.mp4
上述代码实际上是将整个游戏的帧率设置成与视频一致，这样可能存在一些隐患（直觉）。
三、方案二
代码如下：
上述代码的逻辑如下：
1、通过“pygame.mixer.music.get_pos()”获取当前音频的播放进度
2、通过音频播放进度除以视频的总时长，得到音频播放的百分比进度（音画同步的话，音频百分比进度就应该跟视频百分比进度一致）
3、百分比进度乘以视频总帧数可得到当前应当播放哪一个视频帧
4、再判断一下当前实际播放的帧是否已超过了理论应该播放的视频帧（是的话就跳过当前帧的播放）
注意音频播放结束或视频帧播放结束都要结束视频的播放。
四、总结
本篇提供了pygame播放视频的两个方案，第一个方案是网上找的现成的，第二个方案则是参考了opencv（主流方案）自己逆向思维做的，还未经过实际验证。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/d47214ab01a82c7f0541a171e3602103/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-21T21:15:06+08:00" />
<meta property="article:modified_time" content="2023-11-21T21:15:06+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">pygame播放视频并实现音视频同步</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>一、<strong>前言</strong></p> 
<p>在我接触pygame时最新的pygame已经不支持movie模块，这就导致在pygame播放视频变成一个问题，网上搜了下解决方案有两个：</p> 
<p>一是使用opencv播放视频，再结合pygame.mixer来播放音频</p> 
<p>二是使用moviepy播放视频，再结合pygame.mixer播放音频</p> 
<p>上述两个方案其实都是先将mp4的视频分离成“画面帧”和“mp3音频”，所谓的播放实际上是不停地在切换“画面帧”，同时播放音频，最终实现音视频的同时播放。</p> 
<p>但上述两个方案都存在“音画同步”的问题，因为无论是opencv还是moviepy都只负责将视频切片成帧，播放则是pygame自己在执行一个while循环来不停切换界面上展示出来的图片帧，这也就导致while循环很快就将帧播放完毕，而音频则还按着原有节奏缓慢播放。</p> 
<p>解决是在while循环中加入合适的延时同时根据当前视频播放进度来设置音频的播放起点以实现同步，但这个方案据我实践在加入延时后就实现了较好的音画同步效果不知道为啥还要去设置音频的播放起点，另外在设置音频播放起点时一直提示错误也不知道为何，所以我这里提供两个方案：</p> 
<p>方案一：在while循环中加入延时，短视频测试效果还行</p> 
<p>方案二：根据音频的播放节奏来决定视频帧的播放节奏，这样音画肯定是同步的</p> 
<p>我选择使用moviepy来做，因为moviepy从mp4中分离mp3比较简单。</p> 
<p></p> 
<p>二、<strong>方案一</strong></p> 
<p>在项目的目录下新建videos目录，并放入一个测试使用的mp4文件test.mp4</p> 
<p></p> 
<p class="img-center"><img alt="" height="629" src="https://images2.imgbox.com/9d/cb/AXgY87oT_o.png" width="802"></p> 
<p></p> 
<p class="img-center"><img alt="" height="272" src="https://images2.imgbox.com/06/80/ppJVzQiB_o.png" width="802"></p> 
<p></p> 
<p class="img-center"><img alt="" height="788" src="https://images2.imgbox.com/72/bf/QOAj9oZT_o.png" width="969"></p> 
<p>上述代码实际上是将整个游戏的帧率设置成与视频一致，这样可能存在一些隐患（直觉）。</p> 
<p></p> 
<p>三、<strong>方案二</strong></p> 
<p>代码如下：</p> 
<p></p> 
<p class="img-center"><img alt="" height="849" src="https://images2.imgbox.com/75/8c/uX8MkLB0_o.png" width="965"></p> 
<p></p> 
<p class="img-center"><img alt="" height="549" src="https://images2.imgbox.com/98/e3/GFB9c4ov_o.png" width="969"></p> 
<p></p> 
<p class="img-center"><img alt="" height="543" src="https://images2.imgbox.com/7d/ad/xSCaooPH_o.png" width="969"></p> 
<p></p> 
<p class="img-center"><img alt="" height="435" src="https://images2.imgbox.com/fa/85/ukQtvcqS_o.png" width="968"></p> 
<p>上述代码的逻辑如下：</p> 
<p>1、通过“pygame.mixer.music.get_pos()”获取当前音频的播放进度</p> 
<p>2、通过音频播放进度除以视频的总时长，得到音频播放的百分比进度（音画同步的话，音频百分比进度就应该跟视频百分比进度一致）</p> 
<p>3、百分比进度乘以视频总帧数可得到当前应当播放哪一个视频帧</p> 
<p>4、再判断一下当前实际播放的帧是否已超过了理论应该播放的视频帧（是的话就跳过当前帧的播放）</p> 
<p>注意音频播放结束或视频帧播放结束都要结束视频的播放。</p> 
<p></p> 
<p>四、<strong>总结</strong></p> 
<p>本篇提供了pygame播放视频的两个方案，第一个方案是网上找的现成的，第二个方案则是参考了opencv（主流方案）自己逆向思维做的，还未经过实际验证。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3e909604496b908f459341b01aad5db3/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">封神台第二关</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3dd6c15331f3fdff560c71a98c7a4b24/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">小诺2.0开源版工程启动</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>