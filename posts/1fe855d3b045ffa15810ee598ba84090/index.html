<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>恒定PH值分子动力学模拟 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="恒定PH值分子动力学模拟" />
<meta property="og:description" content="自然界中往往存在一些对PH值敏感的蛋白，当我们想要探究这些蛋白在不同PH条件下构象变化时自然离不开MD的辅助。遗憾的是Gromacs暂不支持恒定PH条件下的模拟，因为这涉及到了蛋白表面残基质子化状态需要时刻改变。一种折衷的方法是：用propka等预测工具预测蛋白极性/可质子化残基的pka值（因为实际蛋白表面的pka值可能受到邻近残基的影响而发生偏移），然后根据想要模拟的PH环境，自主确定各个可质子化残基质子化状态（比如某个残基pKa=4，pH环境为7，那么这个残基自然是处于离去质子的解离状态）。然后修改对应pdb文件中的残基名，比如脱去质子的CYS改名为CYM（这个问题文末有提及）。这种方法存在的最大缺点在于：质子化状态一但设定好就会一成不变，这和实际情况显然是不符的。因此我们今天不介绍这种方法，而是介绍在Amber中的实现方法。
1. 准备结构 有这样一张表(下图所示)，罗列了常见质子化残基，包括ASP、GLU、HIS、CYS、LYS、TYR. 第三列数据对应它们各自的pKa值。第二列对应它们在恒定PH环境模拟时Amber识别的名字，如果想让Amber在模拟时对某个残基上面的质子化状态&#34;多多关照&#34;,总得披上&#34;马甲&#34;好让Amber认识它吧。比如我想要模拟PH=7的环境，查看下表可以看出ASP、GLU、HIS在此条件下质子会发生解离，那么就把pdb文件中它们的名称改成对应的&#34;马甲&#34;。ASP→AS4、GLU→GL4、HIS→HIP
本次就以11个氨基酸长度的小肽test.pdb在pH为7的环境下模拟为例：
第一步，修改pdb文件 首先修改需要更换“马甲”的残基名，这里我们做了ASP→AS4、GLU→GL4修改，由于没有HIS残基，所以就不做考虑。此外该分子种有两个距离较靠近的CYS，我们想让他们之间成二硫键，所以修改做出修改：CYS→CYX。修改后的文件名为test_fix.pdb
#用pdb4amber不加氢，补全缺失原子，连接二硫键 pdb4amber -i test_fix.pdb --nohyd -o test_fix2.pdb #不知道什么原因pdb4amber除氢总是失败，只能用下条命令自行除去了 grep -v &#39;.............H&#39; test_fix2.pdb &gt; test_fix3.pdb 下图所示，我们想要连接的二硫键并没有形成，什么原因呢？这是因为只有硫原子间距小于2.5Å时pdb4amber才会自动连接。不过也没关系，后面我们还能在构建拓扑时强制将它们连上。
第二步，构建拓扑 #唤醒tleap程序 tleap #加载constph力场（底层用的amber_ff10力场，同时于蛋白而言等价于ff99SB） source leaprc.constph source leaprc.water.tip3p #为后面的抗衡离子添加力场 #加载修改好的pdb mol = loadPDB test_fix3.pdb #连接二硫键 #遵循语法bond &lt;原子1&gt; &lt;原子2&gt; [bondtype] #bondtype分三类：“-”单键、“=”双键、“#”三键、“:”芳香键,若不指定则默认是单键 bond mol.4.SG mol.8.SG #维持体系电中性 addions mol Cl- 0 addions mol Na&#43; 0 #保存拓扑、坐标 saveAmberParm mol test.prmtop test.inpcrd #退出tleap程序 quit 注意，这里我们构建拓扑时没有添加水分子，这是因为本例要使用的是’隐式水‘模型。’隐式水‘不是真正的水分子，你可以把它理解为一个个数据点。启用’隐式水‘模型的参数为icnstph=1,需要将它添加到后文用到的以*.in为后缀的文件中。
第三步，准备恒定pH输入文件(cpin file) #因为本例中我们只考虑了GLU、ASP的质子化状态改变，所以resname后面的参数改为它们对应的&#39;马甲&#39;——GL4、AS4 cpinutil.py -resnames GL4 AS4 -p test." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/1fe855d3b045ffa15810ee598ba84090/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-30T23:27:13+08:00" />
<meta property="article:modified_time" content="2023-07-30T23:27:13+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">恒定PH值分子动力学模拟</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>自然界中往往存在一些对PH值敏感的蛋白，当我们想要探究这些蛋白在不同PH条件下构象变化时自然离不开MD的辅助。遗憾的是Gromacs暂不支持恒定PH条件下的模拟，因为这涉及到了蛋白表面残基质子化状态需要时刻改变。一种折衷的方法是：用<code>propka</code>等预测工具预测蛋白极性/可质子化残基的pka值（因为实际蛋白表面的pka值可能受到邻近残基的影响而发生偏移），然后根据想要模拟的PH环境，自主确定各个可质子化残基质子化状态（比如某个残基pKa=4，pH环境为7，那么这个残基自然是处于离去质子的解离状态）。然后修改对应pdb文件中的残基名，比如脱去质子的CYS改名为CYM（这个问题文末有提及）。这种方法存在的最大缺点在于：质子化状态一但设定好就会一成不变，这和实际情况显然是不符的。因此我们今天不介绍这种方法，而是介绍在Amber中的实现方法。</p> 
</blockquote> 
<h4><a id="1__6"></a>1. 准备结构</h4> 
<blockquote> 
 <p>有这样一张表(下图所示)，罗列了常见质子化残基，包括<code>ASP、GLU、HIS、CYS、LYS、TYR</code>. 第三列数据对应它们各自的pKa值。第二列对应它们在恒定PH环境模拟时Amber识别的名字，如果想让Amber在模拟时对某个残基上面的质子化状态"多多关照",总得披上"马甲"好让Amber认识它吧。比如我想要模拟PH=7的环境，查看下表可以看出<code>ASP、GLU、HIS</code>在此条件下质子会发生解离，那么就把pdb文件中它们的名称改成对应的"马甲"。<code>ASP</code>→<code>AS4</code>、<code>GLU</code>→<code>GL4</code>、<code>HIS</code>→<code>HIP</code></p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/7f/9c/xt9EbFKW_o.png" alt=""></p> 
<p>本次就以11个氨基酸长度的小肽<code>test.pdb</code>在pH为7的环境下模拟为例：</p> 
<ul><li>第一步，修改pdb文件</li></ul> 
<blockquote> 
 <p>首先修改需要更换“马甲”的残基名，这里我们做了<code>ASP</code>→<code>AS4</code>、<code>GLU</code>→<code>GL4</code>修改，由于没有HIS残基，所以就不做考虑。此外该分子种有两个距离较靠近的CYS，我们想让他们之间成二硫键，所以修改做出修改：<code>CYS</code>→<code>CYX</code>。修改后的文件名为<code>test_fix.pdb</code></p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/18/3d/Dg14js4l_o.png" alt="ASP→AS4名称更换示意"></p> 
<pre><code class="prism language-bash"><span class="token comment">#用pdb4amber不加氢，补全缺失原子，连接二硫键</span>
pdb4amber <span class="token parameter variable">-i</span> test_fix.pdb <span class="token parameter variable">--nohyd</span> <span class="token parameter variable">-o</span> test_fix2.pdb
<span class="token comment">#不知道什么原因pdb4amber除氢总是失败，只能用下条命令自行除去了</span>
<span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token string">'.............H'</span> test_fix2.pdb <span class="token operator">&gt;</span> test_fix3.pdb
</code></pre> 
<p>下图所示，我们想要连接的二硫键并没有形成，什么原因呢？这是因为只有硫原子间距小于2.5Å时<code>pdb4amber</code>才会自动连接。不过也没关系，后面我们还能在构建拓扑时强制将它们连上。</p> 
<p><img src="https://images2.imgbox.com/74/4b/GQTlPSZC_o.png" alt=""></p> 
<ul><li>第二步，构建拓扑</li></ul> 
<pre><code class="prism language-bash"><span class="token comment">#唤醒tleap程序</span>
tleap
<span class="token comment">#加载constph力场（底层用的amber_ff10力场，同时于蛋白而言等价于ff99SB）</span>
<span class="token builtin class-name">source</span> leaprc.constph
<span class="token builtin class-name">source</span> leaprc.water.tip3p  <span class="token comment">#为后面的抗衡离子添加力场</span>
<span class="token comment">#加载修改好的pdb</span>
mol <span class="token operator">=</span> loadPDB test_fix3.pdb
<span class="token comment">#连接二硫键</span>
<span class="token comment">#遵循语法bond &lt;原子1&gt; &lt;原子2&gt; [bondtype]</span>
<span class="token comment">#bondtype分三类：“-”单键、“=”双键、“#”三键、“:”芳香键,若不指定则默认是单键</span>
bond mol.4.SG mol.8.SG 
<span class="token comment">#维持体系电中性</span>
addions mol Cl- <span class="token number">0</span>
addions mol Na+ <span class="token number">0</span>
<span class="token comment">#保存拓扑、坐标</span>
saveAmberParm mol test.prmtop test.inpcrd
<span class="token comment">#退出tleap程序</span>
quit
</code></pre> 
<blockquote> 
 <p>注意，这里我们构建拓扑时没有添加水分子，这是因为本例要使用的是’隐式水‘模型。’隐式水‘不是真正的水分子，你可以把它理解为一个个数据点。启用’隐式水‘模型的参数为<code>icnstph=1</code>,需要将它添加到后文用到的以<code>*.in</code>为后缀的文件中。</p> 
</blockquote> 
<ul><li>第三步，准备恒定pH输入文件(cpin file)</li></ul> 
<pre><code class="prism language-bash"><span class="token comment">#因为本例中我们只考虑了GLU、ASP的质子化状态改变，所以resname后面的参数改为它们对应的'马甲'——GL4、AS4</span>
cpinutil.py <span class="token parameter variable">-resnames</span> GL4 AS4 <span class="token parameter variable">-p</span> test.prmtop <span class="token parameter variable">-o</span> test.cpin
</code></pre> 
<h4><a id="2_61"></a>2.模拟</h4> 
<ul><li>第一步，EM</li></ul> 
<pre><code class="prism language-bash"><span class="token comment">#em.in文件在分享文件中的em文件夹内</span>
pmemd <span class="token parameter variable">-O</span> <span class="token parameter variable">-i</span> em/em.in <span class="token parameter variable">-p</span> test.prmtop <span class="token parameter variable">-c</span> test.inpcrd <span class="token parameter variable">-o</span> em/test_min.mdout <span class="token parameter variable">-r</span> em/test_min.rst <span class="token parameter variable">-ref</span> test.inpcrd <span class="token parameter variable">-cpin</span> test.cpin <span class="token parameter variable">-inf</span> em/em_mdinfo
</code></pre> 
<ul><li>第二步，体系加热</li></ul> 
<pre><code class="prism language-bash"><span class="token comment">#heat.in文件在分享文件中的heat文件夹内</span>
pmemd <span class="token parameter variable">-O</span> <span class="token parameter variable">-i</span> heat/heat.in <span class="token parameter variable">-p</span> test.prmtop <span class="token parameter variable">-c</span> em/test_min.rst <span class="token parameter variable">-o</span> heat/test_heat.mdout <span class="token parameter variable">-r</span> heat/test_heat.rst <span class="token parameter variable">-ref</span> em/test_min.rst <span class="token parameter variable">-cpin</span> test.cpin <span class="token parameter variable">-inf</span> heat/heat_mdinfo
</code></pre> 
<ul><li>第三步，预平衡</li></ul> 
<blockquote> 
 <ul><li>这一步<code>*in</code>文件里需要添加或调整参数<code>solvph=</code>, <code>ntcnstph=</code>。</li><li><code>solvph=</code>设定体系pH值，<code>ntcnstph=</code> 设置每隔多少步监测一次所选残基质子化状态。要注意的是，amber每次只能监测一个残基的状态，也就是说所选“滴定残基”(即需要质子化状态改变的残基）数越多，于单个残基而言监测间隔越长。这就需要我们进行适当取舍。amber官方举的例子：当选取滴定残基数为10时，监测步长设为5得到的结果比较好。可见即便amber可以模拟恒定pH条件，但这也是有限制的。本例中我们选取的滴定残基数总共就两个，所以<code>ntcnstph=</code>可以设得比较大，我设定为25。<em>（ps:后来才发现前面设置了三个“滴定残基”，不过影响应该不大）</em></li></ul> 
</blockquote> 
<pre><code class="prism language-bash"><span class="token comment">#pr.in文件在分享文件中的pr文件夹内</span>
pmemd <span class="token parameter variable">-O</span> <span class="token parameter variable">-i</span> pr/pr.in <span class="token parameter variable">-p</span> test.prmtop <span class="token parameter variable">-c</span> heat/test_heat.rst <span class="token parameter variable">-o</span> pr/test_pr.mdout <span class="token parameter variable">-cpin</span> test.cpin <span class="token parameter variable">-r</span> pr/test_pr.rst <span class="token parameter variable">-cpout</span> pr/test_pr.cpout <span class="token parameter variable">-cprestrt</span> pr/test_pr.cpin <span class="token parameter variable">-inf</span> pr/pr_mdinfo
</code></pre> 
<blockquote> 
 <p>本步输出的<code>test_pr.cpin</code>是<code>test.cpin</code>文件更新版。在预平衡中，“滴定残基”质子化状态发生了改变，所以需要将更新后的信息保存到新结果中，以供下一步成品模拟调用。</p> 
</blockquote> 
<p><strong>无关紧要的内容</strong>👇👇👇</p> 
<hr> 
<p>如下图所示展示了Amber计算各种质子化状态之间的相对自由能差的原理。绿色区域的各种质子化状态的自由能在模拟过程中（t0）存入以<code>*cpin</code>为后缀的文件中。在当质子化状态又一次发生改变[下图红色区域]时(t0+Δt)依照下方公式即可计算出残基质子化前后自由能的变换。</p> 
<p><img src="https://images2.imgbox.com/dd/40/gj3KKOrz_o.png" alt="Amber计算各种质子化状态之间的相对自由能差 原理示意图"></p> 
<hr> 
<p><strong>无关紧要的内容</strong>👆👆👆</p> 
<ul><li>第四步，成品模拟</li></ul> 
<pre><code class="prism language-bash"><span class="token comment">#md.in文件在分享文件中的md文件夹内</span>
pmemd <span class="token parameter variable">-O</span> <span class="token parameter variable">-i</span> md/md.in <span class="token parameter variable">-p</span> test.prmtop <span class="token parameter variable">-c</span> pr/test_pr.rst <span class="token parameter variable">-o</span> md/test_md.mdout <span class="token parameter variable">-cpin</span> pr/test_pr.cpin <span class="token parameter variable">-r</span> md/test_md.rst <span class="token parameter variable">-x</span> md/test_md.nc <span class="token parameter variable">-cpout</span> md/test_md.cpout <span class="token parameter variable">-cprestrt</span> md/test_md.cpin <span class="token parameter variable">-inf</span> md/md_mdinfo
</code></pre> 
<h4><a id="3_103"></a>3.结果分析</h4> 
<pre><code>#结果输出到analyse文件夹内
cphstats -i md/test_md.cpin md/test_md.cpout -o analyse/calcpka.dat --population analyse/populations.dat
</code></pre> 
<blockquote> 
 <ul><li><code>calcpka.dat</code>文件中记录了每个滴定残基的预测pKa值及质子化存在时间比率等信息。本例由于运行时间很短，所以两个ASP质子化状态未改变，所以pKa没有预测值。</li><li><code>populations.dat</code>文件记录了每个残基各种质子化状态及相应状态数量占比。</li></ul> 
</blockquote> 
<p>除此之外，你也可以按照常规步骤分析其他的性质，比如构象变化、主成分、自由能等。</p> 
<p><strong>写在最后</strong> 👇</p> 
<hr> 
<h4><a id="_119"></a>关于残基的"马甲"</h4> 
<blockquote> 
 <p>在Amber中，对于一些标准残基的特殊状态，我们往往用另一种名字替代。这样Amber才能识别，并施加适当的力场参数。大体有如下几种情况：</p> 
</blockquote> 
<table><thead><tr><th align="center">原残基名</th><th align="center">“马甲”</th><th align="left">描述</th></tr></thead><tbody><tr><td align="center">CYS</td><td align="center">CYX</td><td align="left">半胱氨酸成二硫键</td></tr><tr><td align="center">CYS</td><td align="center">CYM</td><td align="left">半胱氨酸和金属螯合/或用于恒定pH模拟的滴定碱基</td></tr><tr><td align="center">HIS</td><td align="center">HIE</td><td align="left">见下图描述</td></tr><tr><td align="center">HIS</td><td align="center">HID</td><td align="left">见下图描述</td></tr><tr><td align="center">HIS</td><td align="center">HIP</td><td align="left">见下图描述/同时用于恒定pH模拟的滴定碱基</td></tr><tr><td align="center">ASP</td><td align="center">AS4</td><td align="left">可用于恒定pH模拟的滴定碱基</td></tr><tr><td align="center">GLU</td><td align="center">GL4</td><td align="left">可用于恒定pH模拟的滴定碱基</td></tr></tbody></table> 
<p>:::</p> 
<p><img src="https://images2.imgbox.com/c2/d6/5WPvxTKA_o.png" alt=""></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/07f2f5fa264e5306b46772fadae8b659/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">薛定谔 | 诱导契合对接(结合位点柔性)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/68a17d7aeec0e0d7f456a5eaed787a45/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">web服务器的部署及优化</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>