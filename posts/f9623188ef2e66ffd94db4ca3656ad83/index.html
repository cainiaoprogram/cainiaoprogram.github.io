<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>架构套路总结 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="架构套路总结" />
<meta property="og:description" content="前言 系统的技术架构（相对于业务架构），主要会考虑下面5个点：
高性能、高可用、可伸缩、可扩展、安全。
一、高性能 1、架构层面 1.1、缓存 浏览器缓存
CDN缓存
反向代理缓存
本地缓存
分布式缓存
缓存注意的点：
1）避免缓存穿透：把空对象保存在内存缓存里
2）缓存与数据库的数据一致性：Cache Aside模式：先更新DB，再清除缓存，DB主从同步完成后，再清理缓存。
1.2、异步 本地队列
分布式队列
1.3、资源复用 线程池、连接池、对象池
单例
2、代码层面 2.1、多线程 线程池，线程数与CPU核数相关：看IO密集型还是计算密集型
线程数 = （任务执行时间 / （任务执行时间 - IO等待时间））* CPU核数
2.2、内存：空间换时间 2.3、锁 尽量不用锁
非要用锁，尽量降低锁粒度、控制锁总数、尽量使用无锁框架CAS，putIfAbsent等
2.4、数据结构的时间复杂度 Skiplist 替代 TreeMap
2.5、访问量大时可批量请求，降低请求次数 Kafka producer批量请求
3、DB层面 3.1、索引 InnoDB引擎 默认BTree&#43; 索引
3.2、SQL优化 3.3、NoSQL 4、附录：衡量性能指标 4.1、TPS &amp; QPS 4.2、系统性能参数：CPU Load Average, CPU User Usage, 内存，网络IO，磁盘IOPS CPU Load Average：平均每核CPU，理想值在100%
CPU User Usage：理想值在70%以内
4.3、响应时间 4.4、并发数：并发访问数、在线用户数 二、高可用 1、冗余：数据冗余 &amp; 依赖服务冗余 2、限流、降级、熔断 3、自动化运维 3." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/f9623188ef2e66ffd94db4ca3656ad83/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-02-15T15:34:24+08:00" />
<meta property="article:modified_time" content="2022-02-15T15:34:24+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">架构套路总结</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>前言</h3> 
<p>系统的技术架构（相对于业务架构），主要会考虑下面5个点：<br> 高性能、高可用、可伸缩、可扩展、安全。</p> 
<h3><a id="_4"></a>一、高性能</h3> 
<h3><a id="1_5"></a>1、架构层面</h3> 
<h4><a id="11_6"></a>1.1、缓存</h4> 
<p>浏览器缓存<br> CDN缓存<br> 反向代理缓存<br> 本地缓存<br> 分布式缓存</p> 
<p>缓存注意的点：<br> 1）避免缓存穿透：把空对象保存在内存缓存里<br> 2）缓存与数据库的数据一致性：Cache Aside模式：先更新DB，再清除缓存，DB主从同步完成后，再清理缓存。</p> 
<h4><a id="12_16"></a>1.2、异步</h4> 
<p>本地队列<br> 分布式队列</p> 
<h4><a id="13_20"></a>1.3、资源复用</h4> 
<p>线程池、连接池、对象池<br> 单例</p> 
<h3><a id="2_24"></a>2、代码层面</h3> 
<h4><a id="21_25"></a>2.1、多线程</h4> 
<p>线程池，线程数与CPU核数相关：看IO密集型还是计算密集型<br> 线程数 = （任务执行时间 / （任务执行时间 - IO等待时间））* CPU核数</p> 
<h4><a id="22_28"></a>2.2、内存：空间换时间</h4> 
<h4><a id="23_29"></a>2.3、锁</h4> 
<p>尽量不用锁<br> 非要用锁，尽量降低锁粒度、控制锁总数、尽量使用无锁框架CAS，putIfAbsent等</p> 
<h4><a id="24_32"></a>2.4、数据结构的时间复杂度</h4> 
<p>Skiplist 替代 TreeMap</p> 
<h4><a id="25_34"></a>2.5、访问量大时可批量请求，降低请求次数</h4> 
<p>Kafka producer批量请求</p> 
<h3><a id="3DB_36"></a>3、DB层面</h3> 
<h4><a id="31_37"></a>3.1、索引</h4> 
<p>InnoDB引擎 默认BTree+ 索引</p> 
<h4><a id="32SQL_39"></a>3.2、SQL优化</h4> 
<h4><a id="33NoSQL_40"></a>3.3、NoSQL</h4> 
<h3><a id="4_41"></a>4、附录：衡量性能指标</h3> 
<h4><a id="41TPS__QPS_42"></a>4.1、TPS &amp; QPS</h4> 
<h4><a id="42CPU_Load_Average_CPU_User_Usage_IOIOPS_43"></a>4.2、系统性能参数：CPU Load Average, CPU User Usage, 内存，网络IO，磁盘IOPS</h4> 
<p>CPU Load Average：平均每核CPU，理想值在100%<br> CPU User Usage：理想值在70%以内</p> 
<h4><a id="43_46"></a>4.3、响应时间</h4> 
<p><img src="https://images2.imgbox.com/42/9b/OwWkJqbL_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="44_49"></a>4.4、并发数：并发访问数、在线用户数</h4> 
<h2><a id="_51"></a>二、高可用</h2> 
<h3><a id="1___52"></a>1、冗余：数据冗余 &amp; 依赖服务冗余</h3> 
<h3><a id="2_53"></a>2、限流、降级、熔断</h3> 
<h3><a id="3_54"></a>3、自动化运维</h3> 
<h4><a id="31_55"></a>3.1、故障自愈</h4> 
<h4><a id="32_56"></a>3.2、自动扩缩容</h4> 
<h4><a id="33_57"></a>3.3、服务自动失效转移</h4> 
<h3><a id="4_58"></a>4、自动测试与发布</h3> 
<h4><a id="41_59"></a>4.1、自动化测试</h4> 
<h4><a id="42_60"></a>4.2、预发布测试</h4> 
<h4><a id="43_61"></a>4.3、灰度发布</h4> 
<h3><a id="5_62"></a>5、多维度监控，告警逐步升级</h3> 
<p>维度1：客户端APM打点 &amp; Server端监控<br> 维度2：业务级监控 &amp; 系统指标参数监控<br> 自动化巡检，发现问题</p> 
<h2><a id="_67"></a>三、可伸缩</h2> 
<h3><a id="1_68"></a>1、应用层可伸缩：无状态服务</h3> 
<p>微服务的拆分方式：<br> 1）横向拆分：拆分成职责不同的应用：如chatroom和CMP<br> 2）纵向拆分：如chatroom和chatroommessage服务</p> 
<p>每个微服务都要可水平扩展</p> 
<h3><a id="2Redis_74"></a>2、缓存层可伸缩：Redis容器云方案</h3> 
<p>Redis Cluster集群模式的负载均衡策略：槽位迁移</p> 
<h3><a id="3DBProxy_76"></a>3、关系型数据库：在DB上游通过Proxy保证可伸缩</h3> 
<h3><a id="4NoSQL_77"></a>4、NoSQL：天然可伸缩</h3> 
<h2><a id="_78"></a>四、易扩展</h2> 
<p>易扩展主要指微服务的拆分时保证每个微服务“高内聚、低耦合”</p> 
<h3><a id="1_80"></a>1、应用间通过队列异步解耦</h3> 
<h3><a id="2_81"></a>2、分布式微服务</h3> 
<h2><a id="_82"></a>五、安全</h2> 
<h3><a id="1_83"></a>1、密码和手机校验码做身份认证</h3> 
<p>用户对于开放http API接口访问时，要携带秘钥做签名认证</p> 
<h3><a id="2_85"></a>2、登录、交易、敏感数据等，对网络通信做加密</h3> 
<p>加解密方式：<br> 1）单向散列加密：如MD5，SHA等，通常加密后加点salt。<br> 单向加密不可逆，仅能比较加密后数据是否一致，如用于做密码校验，但不能还原密码。</p> 
<p>2）对称加密：即加密和解密用同一个秘钥，如DES，RC等<br> 优点：算法简单、性能快<br> 缺点：加解密用同一个秘钥，不够安全。</p> 
<p>3）非对称加密：加密和解密用不同的秘钥，如RSA等<br> 一个对外公开，叫公钥；一个只有网站系统知道，叫私钥<br> 用公钥加密的信息，必须用私钥才能解密；反之，用私钥加密的信息，用公钥才能解开。</p> 
<h3><a id="3XSSSQL_97"></a>3、请求编码转换，避免XSS攻击、SQL注入等</h3> 
<p>1）XSS（Cross Site Script）：指的是通过利用网页开发时留下的漏洞，通过巧妙的方法注入恶意指令代码到网页，使用户加载并执行攻击者恶意制造的网页程序。<br> 这些恶意网页程序通常是JavaScript，但实际上也可以包括Java、 VBScript、ActiveX、 Flash 或者甚至是普通的HTML。<br> 攻击成功后，攻击者可能得到包括但不限于更高的权限（如执行一些操作）、私密网页内容、会话和cookie、密码等各种内容。</p> 
<p>防攻击手段：<br> 1）消毒：对某些HTML危险字符转义，如"&gt;"转义为“&amp;gt”等<br> 2）HttpOnly：禁止浏览器JS访问带有HttpOnly属性的cookie。即对于存敏感信息的cookie，如用户密码等，未该cookie添加HttpOnly属性，防止被JavaScript窃取</p> 
<p>2）SQL注入<br> 通过预编译参数绑定，如ibatis, hibernate等框架都实现了参与预绑定。</p> 
<h3><a id="_109"></a>常用响应时间</h3> 
<p><img src="https://images2.imgbox.com/5a/13/n1UUABNi_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/11af247f00cdc0f231f1fc74554fa281/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Topic 9. SCI 文章第二张表—单因素回归分析表</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f30a55599ea229a3971f69a4b0ebdfbe/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">如何使用filter过滤器对入参进行处理（完整版）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>