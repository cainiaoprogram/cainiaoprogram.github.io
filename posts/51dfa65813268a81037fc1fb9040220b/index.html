<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>WebRTC的噪声抑制（noise suppression，NS）算法 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="WebRTC的噪声抑制（noise suppression，NS）算法" />
<meta property="og:description" content="原文转载于：http://blog.csdn.net/shichaog/article/details/52514816 非常感谢。
WebRTC噪声抑制核心算法在ns_core.c文件里。
噪声频谱可以使用如语音/噪声似然函数进行估计。将接收到的每帧信号和频率分量分类为噪声或语音。
算法原理
该算法的核心思想是采用维纳滤波器抑制估计出来的噪声。
上式中x和n分别表示语音和噪声，而y表示麦克风采集到的信号。
它们的频谱关系如上，从上图可以看出语音和噪声是加性且不相关的关系，对于非加性关系可以有AEC等算法对不同场景进行抑制。根据中心极限定义，一般认为噪声和语音分布服从均值为0，方差为ui的正态分布。但是也有采用和分布的情况。
所以这里的中心思想就变成了从Y中估计噪声N，然后抑制N以得到语音，即：
所以对噪声的估计准确性是至关重要的，噪声估计的越准得到的结果就越好，由此又多出来几种估计噪声的方法。
1. 基于VAD检测的噪声估计，VAD对Y进行检测，如果检测没有语音，则认为噪声，这是对噪声的一种估计方法。
2.基于全局幅度谱最小原理，该估计认为幅度谱最小的情况必然对应没有语音的时候。
3.还有基于矩阵奇异值分解原理估计噪声的。
webRTC没有采用上述的方法，而是对似然比（VAD检测时就用了该方法）函数进行改进，将多个语音/噪声分类特征合并到一个模型中形成一个多特征综合概率密度函数，对输入的每帧频谱进行分析。其可以有效抑制风扇/办公设备等噪声。
其抑制过程如下：
对接收到的每一帧带噪语音信号，以对该帧的初始噪声估计为前提，定义语音概率函数，测量每一帧带噪信号的分类特征，使用测量出来的分类特征，计算每一帧基于多特征的语音概率，在对计算出的语音概率进行动态因子（信号分类特征和阈值参数）加权，根据计算出的每帧基于特征的语音概率，修改多帧中每一帧的语音概率函数，以及使用修改后每帧语音概率函数，更新每帧中的初始噪声（连续多帧中每一帧的分位数噪声）估计。
基于特征的语音概率函数通过使用映射函数（sigmoid/tanh又称S函数，在神经元分类算法中常用为种子函数）将每帧的信号分类特征映射到一个概率值而得出的。
分类特征包括：随时间变化的平局似然比，频谱平坦度测量以及频谱模板差异测量。频谱模板差异测量以输入信号频谱与模板噪声频谱的对比为基础。
信号分析：包括缓冲、加窗和离散傅立叶变换(DFT) 的预处理步骤
噪声估计和过滤包括：初始噪声估计、后验和先验SNR的判决引导(DD)更新、语音/噪声可能性测定，可能性测定是基于似然比(LR)因子进行的，而似然比是使用后验和先验SNR，以及语音概率密度函数(HF)模型 (如高斯、拉普拉斯算子、伽马、超高斯等)，还有根据特征建模、噪声估计更新并应用维纳增益滤波器确定的概率而确定的。
信号合成：离散傅立叶逆变换、缩放和窗口合成。
初始噪声估计是以分位数噪声估计为基础。噪声估计受分位数参数控制，该参数以q表示。根据初始噪声估计步骤确定的噪声估计，仅能用作促进噪声更新/估计的后续流程的初始条件。
set_feature_extraction_parameters 设置了特征提取使用到的参数，当前WebRTC噪声抑制算法使用了LRT特征/频谱平坦度和频谱差异度三个指标，没有使用频谱熵和频谱方差这两个特征。
WebRtc Ns_Init Core NS（noise suppression）模块初始化，后面的代码按fs=8000，来分析。
[cpp] view plain copy //语音数据的长度，8k/10ms的数据量是80 self-&gt;blockLen = 80; //分析长度，由于是在频域分析，将长度像上取2的幂次，最小的值是128，实际上是fft的长度。 self-&gt;anaLen = 128; //窗函数，采用混合汉宁平顶窗函数 self-&gt;window = kBlocks80w128; 初始化FFT用到的相关存储成员 [cpp] view plain copy // Initialize FFT work arrays. self-&gt;ip[0] = 0; // Setting this triggers initialization. memset(self-&gt;dataBuf, 0, sizeof(float) * ANAL_BLOCKL_MAX); WebRtc_rdft(self-&gt;anaLen, 1, self-&gt;dataBuf, self-&gt;ip, self-&gt;wfft); //是滑动分析窗，针对80点128的fft而言，每一次会保留前一帧的128-80=48个点的数据，而不是对80点简单填充0变成128点做fft。 //但这会带来合成上的问题，通常采用加窗以防止重叠带来的突变。可以使用做fft变换一样的窗函数。但这要求窗函数保幂映射，即重叠 //区部分窗口的平方和必须为1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/51dfa65813268a81037fc1fb9040220b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-06-24T08:55:25+08:00" />
<meta property="article:modified_time" content="2017-06-24T08:55:25+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">WebRTC的噪声抑制（noise suppression，NS）算法</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"><strong>原文转载于：<a target="_blank" href="http://blog.csdn.net/shichaog/article/details/52514816" rel="noopener noreferrer">http://blog.csdn.net/shichaog/article/details/52514816</a>   非常感谢。</strong></p> 
<p style="font-family:Arial; font-size:14px"><span style="color:#333333">WebRTC</span><span style="color:#ff0000"><strong>噪声抑制核心算法</strong></span><span style="color:#333333">在ns_core.c文件里。</span></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">噪声频谱可以使用如语音/噪声似然函数进行估计。将接收到的每帧信号和频率分量分类为噪声或语音。<br> </p> 
<h3 style="margin:0px; padding:0px; color:rgb(51,51,51); font-family:Arial"><a target="_blank" name="t0" style="color:rgb(51,102,153)"></a>算法原理<br> </h3> 
<p style="font-family:Arial; font-size:14px"><span style="color:rgb(51,51,51)">该算法的核心思想是采用</span><span style="color:#ff0000"><strong>维纳滤波器抑制估计出来的噪声</strong></span><span style="color:#333333">。</span></p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/8e/5c/aWXlZ6bj_o.png" alt="" style="border:none; max-width:100%"><br> </p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">上式中x和n分别表示语音和噪声，而y表示麦克风采集到的信号。</p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/68/a4/qeodlUbu_o.png" alt="" style="border:none; max-width:100%"><br> </p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">它们的频谱关系如上，从上图可以看出语音和噪声是加性且不相关的关系，对于非加性关系可以有AEC等算法对不同场景进行抑制。根据中心极限定义，一般认为噪声和语音分布服从均值为0，方差为ui的正态分布。但是也有采用<img src="https://images2.imgbox.com/2d/44/mJmxfbCx_o.png" alt="" style="border:none; max-width:100%">和<img src="https://images2.imgbox.com/8e/93/s85iaCLv_o.png" alt="" style="border:none; max-width:100%">分布的情况。</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">所以这里的中心思想就变成了从Y中估计噪声N，然后抑制N以得到语音，即：</p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/4d/76/nMW3dL7C_o.png" alt="" style="border:none; max-width:100%"><br> </p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">所以对噪声的估计准确性是至关重要的，噪声估计的越准得到的结果就越好，由此又多出来几种估计噪声的方法。</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">1. 基于VAD检测的噪声估计，VAD对Y进行检测，如果检测没有语音，则认为噪声，这是对噪声的一种估计方法。</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">2.基于全局幅度谱最小原理，该估计认为幅度谱最小的情况必然对应没有语音的时候。</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">3.还有基于矩阵奇异值分解原理估计噪声的。</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">webRTC没有采用上述的方法，而是对<strong>似然比</strong>（VAD检测时就用了该方法）函数进行改进，将多个语音/噪声分类特征合并到一个模型中形成一个多特征综合概率密度函数，对输入的每帧频谱进行分析。其可以有效抑制风扇/办公设备等噪声。</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">其抑制过程如下：</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"><strong>对接收到的每一帧带噪语音信号，以对该帧的初始噪声估计为前提，定义语音概率函数，测量每一帧带噪信号的分类特征，使用测量出来的分类特征，计算每一帧基于多特征的语音概率，在对计算出的语音概率进行动态因子（信号分类特征和阈值参数）加权，根据计算出的每帧基于特征的语音概率，修改多帧中每一帧的语音概率函数，以及使用修改后每帧语音概率函数，更新每帧中的初始噪声（连续多帧中每一帧的分位数噪声）估计。</strong></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"> <br> </p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">基于特征的语音概率函数通过使用映射函数（sigmoid/tanh又称S函数，在神经元分类算法中常用为种子函数）将每帧的信号分类特征映射到一个概率值而得出的。</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">分类特征包括：随时间变化的平局似然比，频谱平坦度测量以及频谱模板差异测量。频谱模板差异测量以输入信号频谱与模板噪声频谱的对比为基础。</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"><br> </p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">信号分析：包括缓冲、加窗和离散傅立叶变换(DFT) 的预处理步骤</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">噪声估计和过滤包括：初始噪声估计、后验和先验SNR的判决引导(DD)更新、语音/噪声可能性测定，可能性测定是基于似然比(LR)因子进行的，而似然比是使用后验和先验SNR，以及语音概率密度函数(HF)模型 (如高斯、拉普拉斯算子、伽马、超高斯等)，还有根据特征建模、噪声估计更新并应用维纳增益滤波器确定的概率而确定的。</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">信号合成：离散傅立叶逆变换、缩放和窗口合成。</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"><br> </p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">初始噪声估计是以分位数噪声估计为基础。噪声估计受分位数参数控制，该参数以q表示。根据初始噪声估计步骤确定的噪声估计，仅能用作促进噪声更新/估计的后续流程的初始条件。<br> </p> 
<h3 style="margin:0px; padding:0px; color:rgb(51,51,51); font-family:Arial"><a target="_blank" name="t1" style="color:rgb(51,102,153)"></a>set_feature_extraction_parameters</h3> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">设置了特征提取使用到的参数，当前WebRTC噪声抑制算法使用了LRT特征/频谱平坦度和频谱差异度三个指标，没有使用频谱熵和频谱方差这两个特征。</p> 
<h3 style="margin:0px; padding:0px; color:rgb(51,51,51); font-family:Arial"><a target="_blank" name="t2" style="color:rgb(51,102,153)"></a><strong>WebRtc Ns_Init Core</strong></h3> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">NS（noise suppression）模块初始化，后面的代码按fs=8000，来分析。</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"></p> 
<div class="dp-highlighter bg_cpp" style='font-family:Consolas,"Courier New",Courier,mono,serif; background-color:rgb(231,229,220); width:700.906px; overflow-x:auto; overflow-y:hidden; padding-top:1px; position:relative; color:rgb(51,51,51); margin:18px 0px!important'> 
 <div class="bar" style="padding-left:45px"> 
  <div class="tools" style="padding:3px 8px 10px 10px; font-size:9px; line-height:normal; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; background-color:rgb(248,248,248); border-left:3px solid rgb(108,226,108)"> 
   <strong>[cpp]</strong>  
   <a target="_blank" href="http://blog.csdn.net/shichaog/article/details/52514816#" class="ViewSource" title="view plain" style="color:rgb(160,160,160); background-color:inherit; border:none; padding:1px; margin:0px 10px 0px 0px; font-size:9px; display:inline-block; width:16px; height:16px; text-indent:-2000px" rel="noopener noreferrer">view plain</a> 
    <a target="_blank" href="http://blog.csdn.net/shichaog/article/details/52514816#" class="CopyToClipboard" title="copy" style="color:rgb(160,160,160); background-color:inherit; border:none; padding:1px; margin:0px 10px 0px 0px; font-size:9px; display:inline-block; width:16px; height:16px; text-indent:-2000px" rel="noopener noreferrer">copy</a> 
   <div style="position:absolute; left:834px; top:2046px; width:18px; height:18px; z-index:99"> 
   </div> 
    
  </div> 
 </div> 
 <ol start="1" class="dp-cpp" style="padding:0px; border:none; list-style-position:initial; background-color:rgb(255,255,255); color:rgb(92,92,92); margin:0px 0px 1px 45px!important"><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">//语音数据的长度，8k/10ms的数据量是80</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">self-&gt;blockLen = 80;  </span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">//分析长度，由于是在频域分析，将长度像上取2的幂次，最小的值是128，实际上是fft的长度。</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">self-&gt;anaLen = 128;  </span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">//窗函数，采用混合汉宁平顶窗函数</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">self-&gt;window = kBlocks80w128;  </span></li></ol> 
</div> 
<span style="color:rgb(51,51,51); font-family:Arial; font-size:14px">初始化FFT用到的相关存储成员</span> 
<span style="color:rgb(51,51,51); font-family:Arial; font-size:14px"></span> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"></p> 
<div class="dp-highlighter bg_cpp" style='font-family:Consolas,"Courier New",Courier,mono,serif; background-color:rgb(231,229,220); width:700.906px; overflow-x:auto; overflow-y:hidden; padding-top:1px; position:relative; color:rgb(51,51,51); margin:18px 0px!important'> 
 <div class="bar" style="padding-left:45px"> 
  <div class="tools" style="padding:3px 8px 10px 10px; font-size:9px; line-height:normal; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; background-color:rgb(248,248,248); border-left:3px solid rgb(108,226,108)"> 
   <strong>[cpp]</strong>  
   <a target="_blank" href="http://blog.csdn.net/shichaog/article/details/52514816#" class="ViewSource" title="view plain" style="color:rgb(160,160,160); background-color:inherit; border:none; padding:1px; margin:0px 10px 0px 0px; font-size:9px; display:inline-block; width:16px; height:16px; text-indent:-2000px" rel="noopener noreferrer">view plain</a> 
    <a target="_blank" href="http://blog.csdn.net/shichaog/article/details/52514816#" class="CopyToClipboard" title="copy" style="color:rgb(160,160,160); background-color:inherit; border:none; padding:1px; margin:0px 10px 0px 0px; font-size:9px; display:inline-block; width:16px; height:16px; text-indent:-2000px" rel="noopener noreferrer">copy</a> 
   <div style="position:absolute; left:834px; top:2266px; width:18px; height:18px; z-index:99"> 
   </div> 
    
  </div> 
 </div> 
 <ol start="1" class="dp-cpp" style="padding:0px; border:none; list-style-position:initial; background-color:rgb(255,255,255); color:rgb(92,92,92); margin:0px 0px 1px 45px!important"><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// Initialize FFT work arrays.</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  self-&gt;ip[0] = 0;  <span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// Setting this triggers initialization.</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  memset(self-&gt;dataBuf, 0, <span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); background-color:inherit; font-weight:bold">sizeof</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">(</span><span class="datatypes" style="margin:0px; padding:0px; border:none; color:rgb(46,139,87); background-color:inherit; font-weight:bold">float</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">) * ANAL_BLOCKL_MAX);  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  WebRtc_rdft(self-&gt;anaLen, 1, self-&gt;dataBuf, self-&gt;ip, self-&gt;wfft);  </span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  </span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">//是滑动分析窗，针对80点128的fft而言，每一次会保留前一帧的128-80=48个点的数据，而不是对80点简单填充0变成128点做fft。</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">//但这会带来合成上的问题，通常采用加窗以防止重叠带来的突变。可以使用做fft变换一样的窗函数。但这要求窗函数保幂映射，即重叠</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">//区部分窗口的平方和必须为1.</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"> memset(self-&gt;analyzeBuf, 0, <span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); background-color:inherit; font-weight:bold">sizeof</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">(</span><span class="datatypes" style="margin:0px; padding:0px; border:none; color:rgb(46,139,87); background-color:inherit; font-weight:bold">float</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">) * ANAL_BLOCKL_MAX);  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">//dataBuf存储的是原始时域信号</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  memset(self-&gt;dataBuf, 0, <span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); background-color:inherit; font-weight:bold">sizeof</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">(</span><span class="datatypes" style="margin:0px; padding:0px; border:none; color:rgb(46,139,87); background-color:inherit; font-weight:bold">float</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">) * ANAL_BLOCKL_MAX);  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">//syntBuf是谱减法，减去噪声后变换到时域的信号</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  memset(self-&gt;syntBuf, 0, <span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); background-color:inherit; font-weight:bold">sizeof</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">(</span><span class="datatypes" style="margin:0px; padding:0px; border:none; color:rgb(46,139,87); background-color:inherit; font-weight:bold">float</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">) * ANAL_BLOCKL_MAX);  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  </span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  <span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// For HB processing. 这是高频部分，最多有两个band，</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  memset(self-&gt;dataBufHB,  </span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">         0,  </span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">         <span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); background-color:inherit; font-weight:bold">sizeof</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">(</span><span class="datatypes" style="margin:0px; padding:0px; border:none; color:rgb(46,139,87); background-color:inherit; font-weight:bold">float</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">) * NUM_HIGH_BANDS_MAX * ANAL_BLOCKL_MAX);  </span></span></li></ol> 
</div> 
<span style="color:rgb(51,51,51); font-family:Arial; font-size:14px">初始化分位数估计用到的变量</span> 
<span style="color:rgb(51,51,51); font-family:Arial; font-size:14px"></span> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"></p> 
<div class="dp-highlighter bg_cpp" style='font-family:Consolas,"Courier New",Courier,mono,serif; background-color:rgb(231,229,220); width:700.906px; overflow-x:auto; overflow-y:hidden; padding-top:1px; position:relative; color:rgb(51,51,51); margin:18px 0px!important'> 
 <div class="bar" style="padding-left:45px"> 
  <div class="tools" style="padding:3px 8px 10px 10px; font-size:9px; line-height:normal; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; background-color:rgb(248,248,248); border-left:3px solid rgb(108,226,108)"> 
   <strong>[cpp]</strong>  
   <a target="_blank" href="http://blog.csdn.net/shichaog/article/details/52514816#" class="ViewSource" title="view plain" style="color:rgb(160,160,160); background-color:inherit; border:none; padding:1px; margin:0px 10px 0px 0px; font-size:9px; display:inline-block; width:16px; height:16px; text-indent:-2000px" rel="noopener noreferrer">view plain</a> 
    <a target="_blank" href="http://blog.csdn.net/shichaog/article/details/52514816#" class="CopyToClipboard" title="copy" style="color:rgb(160,160,160); background-color:inherit; border:none; padding:1px; margin:0px 10px 0px 0px; font-size:9px; display:inline-block; width:16px; height:16px; text-indent:-2000px" rel="noopener noreferrer">copy</a> 
   <div style="position:absolute; left:834px; top:2738px; width:18px; height:18px; z-index:99"> 
   </div> 
    
  </div> 
 </div> 
 <ol start="1" class="dp-cpp" style="padding:0px; border:none; list-style-position:initial; background-color:rgb(255,255,255); color:rgb(92,92,92); margin:0px 0px 1px 45px!important"><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// For quantile noise estimation.</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  memset(self-&gt;quantile, 0, <span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); background-color:inherit; font-weight:bold">sizeof</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">(</span><span class="datatypes" style="margin:0px; padding:0px; border:none; color:rgb(46,139,87); background-color:inherit; font-weight:bold">float</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">) * HALF_ANAL_BLOCKL);  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">//3帧同步估计，lquantile是对数分位数。density是概率密度，计算分位数用到概率密度的。</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"> <span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); background-color:inherit; font-weight:bold">for</span><span style="margin:0px; padding:0px; border:none; background-color:inherit"> (i = 0; i &lt; SIMULT * HALF_ANAL_BLOCKL; i++) {  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    self-&gt;lquantile[i] = 8.f;  </span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    self-&gt;density[i] = 0.3f;  </span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  }  </span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  </span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  <span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); background-color:inherit; font-weight:bold">for</span><span style="margin:0px; padding:0px; border:none; background-color:inherit"> (i = 0; i &lt; SIMULT; i++) {  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">//我的理解counter是一个权值，代表的每一帧对分位数估计而言其所占的比重。</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  self-&gt;counter[i] =  </span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">        (<span class="datatypes" style="margin:0px; padding:0px; border:none; color:rgb(46,139,87); background-color:inherit; font-weight:bold">int</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">)floor((</span><span class="datatypes" style="margin:0px; padding:0px; border:none; color:rgb(46,139,87); background-color:inherit; font-weight:bold">float</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">)(END_STARTUP_LONG * (i + 1)) / (</span><span class="datatypes" style="margin:0px; padding:0px; border:none; color:rgb(46,139,87); background-color:inherit; font-weight:bold">float</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">)SIMULT);  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  }  </span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  </span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  self-&gt;updates = 0;  </span></li></ol> 
</div> 
<span style="color:rgb(51,51,51); font-family:Arial; font-size:14px">维纳滤波器初始化</span> 
<span style="color:rgb(51,51,51); font-family:Arial; font-size:14px"></span> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"></p> 
<div class="dp-highlighter bg_cpp" style='font-family:Consolas,"Courier New",Courier,mono,serif; background-color:rgb(231,229,220); width:700.906px; overflow-x:auto; overflow-y:hidden; padding-top:1px; position:relative; color:rgb(51,51,51); margin:18px 0px!important'> 
 <div class="bar" style="padding-left:45px"> 
  <div class="tools" style="padding:3px 8px 10px 10px; font-size:9px; line-height:normal; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; background-color:rgb(248,248,248); border-left:3px solid rgb(108,226,108)"> 
   <strong>[cpp]</strong>  
   <a target="_blank" href="http://blog.csdn.net/shichaog/article/details/52514816#" class="ViewSource" title="view plain" style="color:rgb(160,160,160); background-color:inherit; border:none; padding:1px; margin:0px 10px 0px 0px; font-size:9px; display:inline-block; width:16px; height:16px; text-indent:-2000px" rel="noopener noreferrer">view plain</a> 
    <a target="_blank" href="http://blog.csdn.net/shichaog/article/details/52514816#" class="CopyToClipboard" title="copy" style="color:rgb(160,160,160); background-color:inherit; border:none; padding:1px; margin:0px 10px 0px 0px; font-size:9px; display:inline-block; width:16px; height:16px; text-indent:-2000px" rel="noopener noreferrer">copy</a> 
   <div style="position:absolute; left:834px; top:3120px; width:18px; height:18px; z-index:99"> 
   </div> 
    
  </div> 
 </div> 
 <ol start="1" class="dp-cpp" style="padding:0px; border:none; list-style-position:initial; background-color:rgb(255,255,255); color:rgb(92,92,92); margin:0px 0px 1px 45px!important"><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); background-color:inherit; font-weight:bold">for</span><span style="margin:0px; padding:0px; border:none; background-color:inherit"> (i = 0; i &lt; HALF_ANAL_BLOCKL; i++) {  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  self-&gt;smooth[i] = 1.f;  </span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">}  </span></li></ol> 
</div> 
<span style="color:rgb(51,51,51); font-family:Arial; font-size:14px">设置抑制噪声的激进度</span> 
<span style="color:rgb(51,51,51); font-family:Arial; font-size:14px"></span> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"></p> 
<div class="dp-highlighter bg_cpp" style='font-family:Consolas,"Courier New",Courier,mono,serif; background-color:rgb(231,229,220); width:700.906px; overflow-x:auto; overflow-y:hidden; padding-top:1px; position:relative; color:rgb(51,51,51); margin:18px 0px!important'> 
 <div class="bar" style="padding-left:45px"> 
  <div class="tools" style="padding:3px 8px 10px 10px; font-size:9px; line-height:normal; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; background-color:rgb(248,248,248); border-left:3px solid rgb(108,226,108)"> 
   <strong>[cpp]</strong>  
   <a target="_blank" href="http://blog.csdn.net/shichaog/article/details/52514816#" class="ViewSource" title="view plain" style="color:rgb(160,160,160); background-color:inherit; border:none; padding:1px; margin:0px 10px 0px 0px; font-size:9px; display:inline-block; width:16px; height:16px; text-indent:-2000px" rel="noopener noreferrer">view plain</a> 
    <a target="_blank" href="http://blog.csdn.net/shichaog/article/details/52514816#" class="CopyToClipboard" title="copy" style="color:rgb(160,160,160); background-color:inherit; border:none; padding:1px; margin:0px 10px 0px 0px; font-size:9px; display:inline-block; width:16px; height:16px; text-indent:-2000px" rel="noopener noreferrer">copy</a> 
   <div style="position:absolute; left:834px; top:3286px; width:18px; height:18px; z-index:99"> 
   </div> 
    
  </div> 
 </div> 
 <ol start="1" class="dp-cpp" style="padding:0px; border:none; list-style-position:initial; background-color:rgb(255,255,255); color:rgb(92,92,92); margin:0px 0px 1px 45px!important"><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// Set the aggressiveness: default.</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">self-&gt;aggrMode = 0;  </span></li></ol> 
</div> 
<br style="color:rgb(51,51,51); font-family:Arial; font-size:14px"> 
<span style="color:rgb(51,51,51); font-family:Arial; font-size:14px">噪声估计使用到的</span> 
<span style="color:rgb(51,51,51); font-family:Arial; font-size:14px"></span> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"></p> 
<div class="dp-highlighter bg_cpp" style='font-family:Consolas,"Courier New",Courier,mono,serif; background-color:rgb(231,229,220); width:700.906px; overflow-x:auto; overflow-y:hidden; padding-top:1px; position:relative; color:rgb(51,51,51); margin:18px 0px!important'> 
 <div class="bar" style="padding-left:45px"> 
  <div class="tools" style="padding:3px 8px 10px 10px; font-size:9px; line-height:normal; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; background-color:rgb(248,248,248); border-left:3px solid rgb(108,226,108)"> 
   <strong>[cpp]</strong>  
   <a target="_blank" href="http://blog.csdn.net/shichaog/article/details/52514816#" class="ViewSource" title="view plain" style="color:rgb(160,160,160); background-color:inherit; border:none; padding:1px; margin:0px 10px 0px 0px; font-size:9px; display:inline-block; width:16px; height:16px; text-indent:-2000px" rel="noopener noreferrer">view plain</a> 
    <a target="_blank" href="http://blog.csdn.net/shichaog/article/details/52514816#" class="CopyToClipboard" title="copy" style="color:rgb(160,160,160); background-color:inherit; border:none; padding:1px; margin:0px 10px 0px 0px; font-size:9px; display:inline-block; width:16px; height:16px; text-indent:-2000px" rel="noopener noreferrer">copy</a> 
   <div style="position:absolute; left:834px; top:3460px; width:18px; height:18px; z-index:99"> 
   </div> 
    
  </div> 
 </div> 
 <ol start="1" class="dp-cpp" style="padding:0px; border:none; list-style-position:initial; background-color:rgb(255,255,255); color:rgb(92,92,92); margin:0px 0px 1px 45px!important"><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// Initialize variables for new method.</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">self-&gt;priorSpeechProb = 0.5f;  <span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// Prior prob for speech/noise.</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// Previous analyze mag spectrum.</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">memset(self-&gt;magnPrevAnalyze, 0, <span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); background-color:inherit; font-weight:bold">sizeof</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">(</span><span class="datatypes" style="margin:0px; padding:0px; border:none; color:rgb(46,139,87); background-color:inherit; font-weight:bold">float</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">) * HALF_ANAL_BLOCKL);  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// Previous process mag spectrum.</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">memset(self-&gt;magnPrevProcess, 0, <span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); background-color:inherit; font-weight:bold">sizeof</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">(</span><span class="datatypes" style="margin:0px; padding:0px; border:none; color:rgb(46,139,87); background-color:inherit; font-weight:bold">float</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">) * HALF_ANAL_BLOCKL);  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// Current noise-spectrum.</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">memset(self-&gt;noise, 0, <span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); background-color:inherit; font-weight:bold">sizeof</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">(</span><span class="datatypes" style="margin:0px; padding:0px; border:none; color:rgb(46,139,87); background-color:inherit; font-weight:bold">float</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">) * HALF_ANAL_BLOCKL);  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// Previous noise-spectrum.</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">memset(self-&gt;noisePrev, 0, <span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); background-color:inherit; font-weight:bold">sizeof</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">(</span><span class="datatypes" style="margin:0px; padding:0px; border:none; color:rgb(46,139,87); background-color:inherit; font-weight:bold">float</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">) * HALF_ANAL_BLOCKL);  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// Conservative noise spectrum estimate.</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">memset(self-&gt;magnAvgPause, 0, <span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); background-color:inherit; font-weight:bold">sizeof</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">(</span><span class="datatypes" style="margin:0px; padding:0px; border:none; color:rgb(46,139,87); background-color:inherit; font-weight:bold">float</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">) * HALF_ANAL_BLOCKL);  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// For estimation of HB in second pass.</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">memset(self-&gt;speechProb, 0, <span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); background-color:inherit; font-weight:bold">sizeof</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">(</span><span class="datatypes" style="margin:0px; padding:0px; border:none; color:rgb(46,139,87); background-color:inherit; font-weight:bold">float</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">) * HALF_ANAL_BLOCKL);  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// Initial average magnitude spectrum.</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">memset(self-&gt;initMagnEst, 0, <span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); background-color:inherit; font-weight:bold">sizeof</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">(</span><span class="datatypes" style="margin:0px; padding:0px; border:none; color:rgb(46,139,87); background-color:inherit; font-weight:bold">float</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">) * HALF_ANAL_BLOCKL);  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); background-color:inherit; font-weight:bold">for</span><span style="margin:0px; padding:0px; border:none; background-color:inherit"> (i = 0; i &lt; HALF_ANAL_BLOCKL; i++) {  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  <span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// Smooth LR (same as threshold).</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  self-&gt;log LrtTimeAvg[i] = LRT_FEATURE_THR;  </span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">}  </span></li></ol> 
</div> 
<span style="color:rgb(51,51,51); font-family:Arial; font-size:14px">特征量，计算噪声用到</span> 
<span style="color:rgb(51,51,51); font-family:Arial; font-size:14px"></span> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"></p> 
<div class="dp-highlighter bg_cpp" style='font-family:Consolas,"Courier New",Courier,mono,serif; background-color:rgb(231,229,220); width:700.906px; overflow-x:auto; overflow-y:hidden; padding-top:1px; position:relative; color:rgb(51,51,51); margin:18px 0px!important'> 
 <div class="bar" style="padding-left:45px"> 
  <div class="tools" style="padding:3px 8px 10px 10px; font-size:9px; line-height:normal; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; background-color:rgb(248,248,248); border-left:3px solid rgb(108,226,108)"> 
   <strong>[cpp]</strong>  
   <a target="_blank" href="http://blog.csdn.net/shichaog/article/details/52514816#" class="ViewSource" title="view plain" style="color:rgb(160,160,160); background-color:inherit; border:none; padding:1px; margin:0px 10px 0px 0px; font-size:9px; display:inline-block; width:16px; height:16px; text-indent:-2000px" rel="noopener noreferrer">view plain</a> 
    <a target="_blank" href="http://blog.csdn.net/shichaog/article/details/52514816#" class="CopyToClipboard" title="copy" style="color:rgb(160,160,160); background-color:inherit; border:none; padding:1px; margin:0px 10px 0px 0px; font-size:9px; display:inline-block; width:16px; height:16px; text-indent:-2000px" rel="noopener noreferrer">copy</a> 
   <div style="position:absolute; left:834px; top:3932px; width:18px; height:18px; z-index:99"> 
   </div> 
    
  </div> 
 </div> 
 <ol start="1" class="dp-cpp" style="padding:0px; border:none; list-style-position:initial; background-color:rgb(255,255,255); color:rgb(92,92,92); margin:0px 0px 1px 45px!important"><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// Feature quantities.</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  <span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// Spectral flatness (start on threshold).</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  self-&gt;featureData[0] = SF_FEATURE_THR;  </span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  self-&gt;featureData[1] = 0.f;  <span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// Spectral entropy: not used in this version.</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  self-&gt;featureData[2] = 0.f;  <span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// Spectral variance: not used in this version.</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  <span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// Average LRT factor (start on threshold).</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  self-&gt;featureData[3] = LRT_FEATURE_THR;  </span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  <span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// Spectral template diff (start on threshold).</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  self-&gt;featureData[4] = SF_FEATURE_THR;  </span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  self-&gt;featureData[5] = 0.f;  <span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// Normalization for spectral difference.</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  <span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// Window time-average of input magnitude spectrum.</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  self-&gt;featureData[6] = 0.f;  </span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  </span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  <span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// Histogram quantities: used to estimate/update thresholds for features.</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  memset(self-&gt;histLrt, 0, <span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); background-color:inherit; font-weight:bold">sizeof</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">(</span><span class="datatypes" style="margin:0px; padding:0px; border:none; color:rgb(46,139,87); background-color:inherit; font-weight:bold">int</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">) * HIST_PAR_EST);  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  memset(self-&gt;histSpecFlat, 0, <span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); background-color:inherit; font-weight:bold">sizeof</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">(</span><span class="datatypes" style="margin:0px; padding:0px; border:none; color:rgb(46,139,87); background-color:inherit; font-weight:bold">int</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">) * HIST_PAR_EST);  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  memset(self-&gt;histSpecDiff, 0, <span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); background-color:inherit; font-weight:bold">sizeof</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">(</span><span class="datatypes" style="margin:0px; padding:0px; border:none; color:rgb(46,139,87); background-color:inherit; font-weight:bold">int</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">) * HIST_PAR_EST);  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  </span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  <span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// Update flag for parameters:</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  <span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// 0 no update, 1 = update once, 2 = update every window.</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  self-&gt;modelUpdatePars[0] = 2;  </span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  self-&gt;modelUpdatePars[1] = 500;  <span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// Window for update.</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  <span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// Counter for update of conservative noise spectrum.</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  self-&gt;modelUpdatePars[2] = 0;  </span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  <span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// Counter if the feature thresholds are updated during the sequence.</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  self-&gt;modelUpdatePars[3] = self-&gt;modelUpdatePars[1];  </span></li></ol> 
</div> 
<span style="color:rgb(51,51,51); font-family:Arial; font-size:14px">白噪声和粉红噪声</span> 
<br style="color:rgb(51,51,51); font-family:Arial; font-size:14px"> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"></p> 
<div class="dp-highlighter bg_cpp" style='font-family:Consolas,"Courier New",Courier,mono,serif; background-color:rgb(231,229,220); width:700.906px; overflow-x:auto; overflow-y:hidden; padding-top:1px; position:relative; color:rgb(51,51,51); margin:18px 0px!important'> 
 <div class="bar" style="padding-left:45px"> 
  <div class="tools" style="padding:3px 8px 10px 10px; font-size:9px; line-height:normal; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; background-color:rgb(248,248,248); border-left:3px solid rgb(108,226,108)"> 
   <strong>[cpp]</strong>  
   <a target="_blank" href="http://blog.csdn.net/shichaog/article/details/52514816#" class="ViewSource" title="view plain" style="color:rgb(160,160,160); background-color:inherit; border:none; padding:1px; margin:0px 10px 0px 0px; font-size:9px; display:inline-block; width:16px; height:16px; text-indent:-2000px" rel="noopener noreferrer">view plain</a> 
    <a target="_blank" href="http://blog.csdn.net/shichaog/article/details/52514816#" class="CopyToClipboard" title="copy" style="color:rgb(160,160,160); background-color:inherit; border:none; padding:1px; margin:0px 10px 0px 0px; font-size:9px; display:inline-block; width:16px; height:16px; text-indent:-2000px" rel="noopener noreferrer">copy</a> 
   <div style="position:absolute; left:834px; top:4512px; width:18px; height:18px; z-index:99"> 
   </div> 
    
  </div> 
 </div> 
 <ol start="1" class="dp-cpp" style="padding:0px; border:none; list-style-position:initial; background-color:rgb(255,255,255); color:rgb(92,92,92); margin:0px 0px 1px 45px!important"><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span style="margin:0px; padding:0px; border:none; background-color:inherit">self-&gt;signalEnergy = 0.0;  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">self-&gt;sumMagn = 0.0;  </span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">self-&gt;whiteNoiseLevel = 0.0;  </span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">self-&gt;pinkNoiseNumerator = 0.0;  </span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">self-&gt;pinkNoiseExp = 0.0;  </span></li></ol> 
</div> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"></p> 
<h3 style="margin:0px; padding:0px; color:rgb(51,51,51); font-family:Arial"><a target="_blank" name="t3" style="color:rgb(51,102,153)"></a>Compute Spectral Flatness</h3> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">频谱平坦度计算，该算法假设语音比噪声有更多的谐波。语音频谱往往会在基频（基音）和谐波中出现峰值，而噪声频谱则相对平坦。因此其作为区分噪声和语音的一个特征。</p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/6e/97/41uklCEK_o.png" alt="" style="border:none; max-width:100%"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">频谱度计算时N表示STFT后频率点数，B代表频率带的数量，K是频点指数，j是频带指数。每个频带包括大量的频率点。就128个频率点可分成4个频带（低带，中低频带，中高频带，高频），每个频带32个频点。对于噪声Flatness偏大且为常数，而对于语音，计算出的数量则偏下且为变量。<br> </p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"></p> 
<div class="dp-highlighter bg_cpp" style='font-family:Consolas,"Courier New",Courier,mono,serif; background-color:rgb(231,229,220); width:700.906px; overflow-x:auto; overflow-y:hidden; padding-top:1px; position:relative; color:rgb(51,51,51); margin:18px 0px!important'> 
 <div class="bar" style="padding-left:45px"> 
  <div class="tools" style="padding:3px 8px 10px 10px; font-size:9px; line-height:normal; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; background-color:rgb(248,248,248); border-left:3px solid rgb(108,226,108)"> 
   <strong>[cpp]</strong>  
   <a target="_blank" href="http://blog.csdn.net/shichaog/article/details/52514816#" class="ViewSource" title="view plain" style="color:rgb(160,160,160); background-color:inherit; border:none; padding:1px; margin:0px 10px 0px 0px; font-size:9px; display:inline-block; width:16px; height:16px; text-indent:-2000px" rel="noopener noreferrer">view plain</a> 
    <a target="_blank" href="http://blog.csdn.net/shichaog/article/details/52514816#" class="CopyToClipboard" title="copy" style="color:rgb(160,160,160); background-color:inherit; border:none; padding:1px; margin:0px 10px 0px 0px; font-size:9px; display:inline-block; width:16px; height:16px; text-indent:-2000px" rel="noopener noreferrer">copy</a> 
   <div style="position:absolute; left:834px; top:5013px; width:18px; height:18px; z-index:99"> 
   </div> 
    
  </div> 
 </div> 
 <ol start="1" class="dp-cpp" style="padding:0px; border:none; list-style-position:initial; background-color:rgb(255,255,255); color:rgb(92,92,92); margin:0px 0px 1px 45px!important"><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// Compute spectral flatness on input spectrum.</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// |magnIn| is the magnitude spectrum.</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// Spectral flatness is returned in self-&gt;featureData[0].</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); background-color:inherit; font-weight:bold">static</span><span style="margin:0px; padding:0px; border:none; background-color:inherit"> </span><span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); background-color:inherit; font-weight:bold">void</span><span style="margin:0px; padding:0px; border:none; background-color:inherit"> ComputeSpectralFlatness(NoiseSuppressionC* self,  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">                                    <span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); background-color:inherit; font-weight:bold">const</span><span style="margin:0px; padding:0px; border:none; background-color:inherit"> </span><span class="datatypes" style="margin:0px; padding:0px; border:none; color:rgb(46,139,87); background-color:inherit; font-weight:bold">float</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">* magnIn) {  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  <span class="datatypes" style="margin:0px; padding:0px; border:none; color:rgb(46,139,87); background-color:inherit; font-weight:bold">size_t</span><span style="margin:0px; padding:0px; border:none; background-color:inherit"> i;  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  <span class="datatypes" style="margin:0px; padding:0px; border:none; color:rgb(46,139,87); background-color:inherit; font-weight:bold">size_t</span><span style="margin:0px; padding:0px; border:none; background-color:inherit"> shiftLP = 1;  </span><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// Option to remove first bin(s) from spectral measures.</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  <span class="datatypes" style="margin:0px; padding:0px; border:none; color:rgb(46,139,87); background-color:inherit; font-weight:bold">float</span><span style="margin:0px; padding:0px; border:none; background-color:inherit"> avgSpectralFlatnessNum, avgSpectralFlatnessDen, spectralTmp;  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  </span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  <span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// Compute spectral measures.</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  <span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// For flatness.</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  avgSpectralFlatnessNum = 0.0;  </span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  avgSpectralFlatnessDen = self-&gt;sumMagn;  </span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  <span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); background-color:inherit; font-weight:bold">for</span><span style="margin:0px; padding:0px; border:none; background-color:inherit"> (i = 0; i &lt; shiftLP; i++) {   </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">//跳过第一个频点，即直流频点Den是denominator（分母）的缩写，avgSpectralFlatnessDen是上述公式分母计算用到的</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    avgSpectralFlatnessDen -= magnIn[i];  </span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  }  </span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  <span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// Compute log of ratio of the geometric to arithmetic mean: check for log(0) case.</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  <span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// 计算分子部分，numerator(分子)，对log(0)是无穷小的值，所以计算时对这一情况特殊处理。</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  <span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); background-color:inherit; font-weight:bold">for</span><span style="margin:0px; padding:0px; border:none; background-color:inherit"> (i = shiftLP; i &lt; self-&gt;magnLen; i++) {  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); background-color:inherit; font-weight:bold">if</span><span style="margin:0px; padding:0px; border:none; background-color:inherit"> (magnIn[i] &gt; 0.0) {  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">      avgSpectralFlatnessNum += (<span class="datatypes" style="margin:0px; padding:0px; border:none; color:rgb(46,139,87); background-color:inherit; font-weight:bold">float</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">)log(magnIn[i]);  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">} <span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); background-color:inherit; font-weight:bold">else</span><span style="margin:0px; padding:0px; border:none; background-color:inherit"> {  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">//TVAG是time-average的缩写，对于能量出现异常的处理。利用前一次平坦度直接取平均返回。</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">      self-&gt;featureData[0] -= SPECT_FL_TAVG * self-&gt;featureData[0];  </span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">      <span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); background-color:inherit; font-weight:bold">return</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">;  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    }  </span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  }  </span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  <span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// Normalize.</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  avgSpectralFlatnessDen = avgSpectralFlatnessDen / self-&gt;magnLen;  </span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  avgSpectralFlatnessNum = avgSpectralFlatnessNum / self-&gt;magnLen;  </span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  </span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  <span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// Ratio and inverse log: check for case of log(0).</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  spectralTmp = (<span class="datatypes" style="margin:0px; padding:0px; border:none; color:rgb(46,139,87); background-color:inherit; font-weight:bold">float</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">)exp(avgSpectralFlatnessNum) / avgSpectralFlatnessDen;  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  </span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  <span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// Time-avg update of spectral flatness feature.</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  self-&gt;featureData[0] += SPECT_FL_TAVG * (spectralTmp - self-&gt;featureData[0]);  </span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  <span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// Done with flatness feature.</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">}  </span></li></ol> 
</div> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"></p> 
<h3 style="margin:0px; padding:0px; color:rgb(51,51,51); font-family:Arial"><a target="_blank" name="t4" style="color:rgb(51,102,153)"></a>Compute Spectral Difference</h3> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">有关噪声频谱的另一个假设是，噪声频谱比语音频谱更稳定。因此，可假设噪声频谱的整体形状在任何给定阶段都倾向于保持相同。这第三个特征用于测量输入频谱与噪声频谱形状的偏差。<br> </p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">计算公式变成如下：</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"></p> 
<div class="dp-highlighter bg_cpp" style='font-family:Consolas,"Courier New",Courier,mono,serif; background-color:rgb(231,229,220); width:700.906px; overflow-x:auto; overflow-y:hidden; padding-top:1px; position:relative; color:rgb(51,51,51); margin:18px 0px!important'> 
 <div class="bar" style="padding-left:45px"> 
  <div class="tools" style="padding:3px 8px 10px 10px; font-size:9px; line-height:normal; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; background-color:rgb(248,248,248); border-left:3px solid rgb(108,226,108)"> 
   <strong>[cpp]</strong>  
   <a target="_blank" href="http://blog.csdn.net/shichaog/article/details/52514816#" class="ViewSource" title="view plain" style="color:rgb(160,160,160); background-color:inherit; border:none; padding:1px; margin:0px 10px 0px 0px; font-size:9px; display:inline-block; width:16px; height:16px; text-indent:-2000px" rel="noopener noreferrer">view plain</a> 
    <a target="_blank" href="http://blog.csdn.net/shichaog/article/details/52514816#" class="CopyToClipboard" title="copy" style="color:rgb(160,160,160); background-color:inherit; border:none; padding:1px; margin:0px 10px 0px 0px; font-size:9px; display:inline-block; width:16px; height:16px; text-indent:-2000px" rel="noopener noreferrer">copy</a> 
   <div style="position:absolute; left:834px; top:5951px; width:18px; height:18px; z-index:99"> 
   </div> 
    
  </div> 
 </div> 
 <ol start="1" class="dp-cpp" style="padding:0px; border:none; list-style-position:initial; background-color:rgb(255,255,255); color:rgb(92,92,92); margin:0px 0px 1px 45px!important"><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// avgDiffNormMagn = var(magnIn) - cov(magnIn, magnAvgPause)^2 / var(magnAvgPause)</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li></ol> 
</div> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"></p> 
<h3 style="margin:0px; padding:0px; color:rgb(51,51,51); font-family:Arial"><a target="_blank" name="t5" style="color:rgb(51,102,153)"></a>Compute SNR</h3> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">根据分位数噪声估计计算前后信噪比。</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">后验信噪比指观测到的能量与噪声功率相关的输入功率相比的瞬态SNR：<br> </p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"><br> </p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/f6/2f/1GJpWxca_o.png" alt="" style="border:none; max-width:100%"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">其中Y是输入含噪声的频谱，见公式1.N是噪声频谱，先验SNR是与噪声功率相关的纯净（未必是语音）信号功率的期望值，可表示为：</p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/dc/6b/9VLbmvHT_o.png" alt="" style="border:none; max-width:100%"><br> </p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">其中X是指输入的纯净信号，这里对应的指语音信号。在WebRTC实际的计算中，并没有采用平方数量级，而是采用了量级数量级。</p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/c1/5e/OubywxrG_o.png" alt="" style="border:none; max-width:100%"></p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/fb/65/ieJWhu2g_o.png" alt="" style="border:none; max-width:100%"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">由于纯净信号是未知信号，先验SNR的估计是上一帧经估计的先验SNR和瞬态SNR <img src="https://images2.imgbox.com/65/e3/zjBeneg0_o.png" alt="" style="border:none; max-width:100%">的平均值：</p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/a4/22/K5fY9nJZ_o.png" alt="" style="border:none; max-width:100%"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">上式中H对应与代码中的smooth是上一帧的维纳滤波器，用于对瞬时SNR平滑，前一项是上一帧的先验SNR，后一项是先验SNR的瞬态估计。其通过判决应道DD进行跟新，时间平滑参数是<img src="https://images2.imgbox.com/c7/02/qPuqAxHM_o.png" alt="" style="border:none; max-width:100%">，其值越大，流畅度越高，延迟也会越大，程序中选择的是0.98.<br> </p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"></p> 
<div class="dp-highlighter bg_cpp" style='font-family:Consolas,"Courier New",Courier,mono,serif; background-color:rgb(231,229,220); width:700.906px; overflow-x:auto; overflow-y:hidden; padding-top:1px; position:relative; color:rgb(51,51,51); margin:18px 0px!important'> 
 <div class="bar" style="padding-left:45px"> 
  <div class="tools" style="padding:3px 8px 10px 10px; font-size:9px; line-height:normal; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; background-color:rgb(248,248,248); border-left:3px solid rgb(108,226,108)"> 
   <strong>[cpp]</strong>  
   <a target="_blank" href="http://blog.csdn.net/shichaog/article/details/52514816#" class="ViewSource" title="view plain" style="color:rgb(160,160,160); background-color:inherit; border:none; padding:1px; margin:0px 10px 0px 0px; font-size:9px; display:inline-block; width:16px; height:16px; text-indent:-2000px" rel="noopener noreferrer">view plain</a> 
    <a target="_blank" href="http://blog.csdn.net/shichaog/article/details/52514816#" class="CopyToClipboard" title="copy" style="color:rgb(160,160,160); background-color:inherit; border:none; padding:1px; margin:0px 10px 0px 0px; font-size:9px; display:inline-block; width:16px; height:16px; text-indent:-2000px" rel="noopener noreferrer">copy</a> 
   <div style="position:absolute; left:834px; top:6912px; width:18px; height:18px; z-index:99"> 
   </div> 
    
  </div> 
 </div> 
 <ol start="1" class="dp-cpp" style="padding:0px; border:none; list-style-position:initial; background-color:rgb(255,255,255); color:rgb(92,92,92); margin:0px 0px 1px 45px!important"><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); background-color:inherit; font-weight:bold">static</span><span style="margin:0px; padding:0px; border:none; background-color:inherit"> </span><span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); background-color:inherit; font-weight:bold">void</span><span style="margin:0px; padding:0px; border:none; background-color:inherit"> ComputeSnr(</span><span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); background-color:inherit; font-weight:bold">const</span><span style="margin:0px; padding:0px; border:none; background-color:inherit"> NoiseSuppressionC* self,  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">                       <span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); background-color:inherit; font-weight:bold">const</span><span style="margin:0px; padding:0px; border:none; background-color:inherit"> </span><span class="datatypes" style="margin:0px; padding:0px; border:none; color:rgb(46,139,87); background-color:inherit; font-weight:bold">float</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">* magn,  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">                       <span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); background-color:inherit; font-weight:bold">const</span><span style="margin:0px; padding:0px; border:none; background-color:inherit"> </span><span class="datatypes" style="margin:0px; padding:0px; border:none; color:rgb(46,139,87); background-color:inherit; font-weight:bold">float</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">* noise,  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">                       <span class="datatypes" style="margin:0px; padding:0px; border:none; color:rgb(46,139,87); background-color:inherit; font-weight:bold">float</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">* snrLocPrior,  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">                       <span class="datatypes" style="margin:0px; padding:0px; border:none; color:rgb(46,139,87); background-color:inherit; font-weight:bold">float</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">* snrLocPost) {  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  <span class="datatypes" style="margin:0px; padding:0px; border:none; color:rgb(46,139,87); background-color:inherit; font-weight:bold">size_t</span><span style="margin:0px; padding:0px; border:none; background-color:inherit"> i;  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  </span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  <span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); background-color:inherit; font-weight:bold">for</span><span style="margin:0px; padding:0px; border:none; background-color:inherit"> (i = 0; i &lt; self-&gt;magnLen; i++) {  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// Previous post SNR.</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// Previous estimate: based on previous frame with gain filter. 此处公式7加了平滑，对应公式8的前半部分</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="datatypes" style="margin:0px; padding:0px; border:none; color:rgb(46,139,87); background-color:inherit; font-weight:bold">float</span><span style="margin:0px; padding:0px; border:none; background-color:inherit"> previousEstimateStsa = self-&gt;magnPrevAnalyze[i] /  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">        (self-&gt;noisePrev[i] + 0.0001f) * self-&gt;smooth[i];  </span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// Post SNR.</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    snrLocPost[i] = 0.f;  </span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); background-color:inherit; font-weight:bold">if</span><span style="margin:0px; padding:0px; border:none; background-color:inherit"> (magn[i] &gt; noise[i]) {  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">      snrLocPost[i] = magn[i] / (noise[i] + 0.0001f) - 1.f;<span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">//实际上magn中包括语音和noise，减一是将噪声减去，获得后验snr</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    }  </span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// DD estimate is sum of two terms: current estimate and previous estimate.</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// Directed decision update of snrPrior.</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    snrLocPrior[i] =  </span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">        DD_PR_SNR * previousEstimateStsa + (1.f - DD_PR_SNR) * snrLocPost[i];<span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">//此处是公式8的计算</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  }  <span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// End of loop over frequencies.</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">}  </span></li></ol> 
</div> 
<h3 style="margin:0px; padding:0px; color:rgb(51,51,51); font-family:Arial"><a target="_blank" name="t6" style="color:rgb(51,102,153)"></a>Speech Noise Prob</h3> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"></p> 
<div class="dp-highlighter bg_cpp" style='font-family:Consolas,"Courier New",Courier,mono,serif; background-color:rgb(231,229,220); width:700.906px; overflow-x:auto; overflow-y:hidden; padding-top:1px; position:relative; color:rgb(51,51,51); margin:18px 0px!important'> 
 <div class="bar" style="padding-left:45px"> 
  <div class="tools" style="padding:3px 8px 10px 10px; font-size:9px; line-height:normal; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; background-color:rgb(248,248,248); border-left:3px solid rgb(108,226,108)"> 
   <strong>[cpp]</strong>  
   <a target="_blank" href="http://blog.csdn.net/shichaog/article/details/52514816#" class="ViewSource" title="view plain" style="color:rgb(160,160,160); background-color:inherit; border:none; padding:1px; margin:0px 10px 0px 0px; font-size:9px; display:inline-block; width:16px; height:16px; text-indent:-2000px" rel="noopener noreferrer">view plain</a> 
    <a target="_blank" href="http://blog.csdn.net/shichaog/article/details/52514816#" class="CopyToClipboard" title="copy" style="color:rgb(160,160,160); background-color:inherit; border:none; padding:1px; margin:0px 10px 0px 0px; font-size:9px; display:inline-block; width:16px; height:16px; text-indent:-2000px" rel="noopener noreferrer">copy</a> 
   <div style="position:absolute; left:834px; top:7474px; width:18px; height:18px; z-index:99"> 
   </div> 
    
  </div> 
 </div> 
 <ol start="1" class="dp-cpp" style="padding:0px; border:none; list-style-position:initial; background-color:rgb(255,255,255); color:rgb(92,92,92); margin:0px 0px 1px 45px!important"><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span style="margin:0px; padding:0px; border:none; background-color:inherit">该函数参数的意义。  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// |magn| is the input magnitude spectrum.输入信号幅度谱，包括信号和噪声</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// |noise| is the noise spectrum.</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">以下两个概率由ComputeSnr函数计算得到。  </span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// |snrLocPrior| is the prior SNR for each frequency.</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// |snrLocPost| is the post SNR for each frequency.</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li></ol> 
</div> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">代码中和第一个特征相关的计算是：</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"></p> 
<div class="dp-highlighter bg_cpp" style='font-family:Consolas,"Courier New",Courier,mono,serif; background-color:rgb(231,229,220); width:700.906px; overflow-x:auto; overflow-y:hidden; padding-top:1px; position:relative; color:rgb(51,51,51); margin:18px 0px!important'> 
 <div class="bar" style="padding-left:45px"> 
  <div class="tools" style="padding:3px 8px 10px 10px; font-size:9px; line-height:normal; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; background-color:rgb(248,248,248); border-left:3px solid rgb(108,226,108)"> 
   <strong>[cpp]</strong>  
   <a target="_blank" href="http://blog.csdn.net/shichaog/article/details/52514816#" class="ViewSource" title="view plain" style="color:rgb(160,160,160); background-color:inherit; border:none; padding:1px; margin:0px 10px 0px 0px; font-size:9px; display:inline-block; width:16px; height:16px; text-indent:-2000px" rel="noopener noreferrer">view plain</a> 
    <a target="_blank" href="http://blog.csdn.net/shichaog/article/details/52514816#" class="CopyToClipboard" title="copy" style="color:rgb(160,160,160); background-color:inherit; border:none; padding:1px; margin:0px 10px 0px 0px; font-size:9px; display:inline-block; width:16px; height:16px; text-indent:-2000px" rel="noopener noreferrer">copy</a> 
   <div style="position:absolute; left:834px; top:7694px; width:18px; height:18px; z-index:99"> 
   </div> 
    
  </div> 
 </div> 
 <ol start="1" class="dp-cpp" style="padding:0px; border:none; list-style-position:initial; background-color:rgb(255,255,255); color:rgb(92,92,92); margin:0px 0px 1px 45px!important"><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// Compute feature based on average LR factor.</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// This is the average over all frequencies of the smooth log LRT.</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">logLrtTimeAvgKsum = 0.0;  </span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); background-color:inherit; font-weight:bold">for</span><span style="margin:0px; padding:0px; border:none; background-color:inherit"> (i = 0; i &lt; self-&gt;magnLen; i++) {  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  tmpFloat1 = 1.f + 2.f * snrLocPrior[i];  </span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  tmpFloat2 = 2.f * snrLocPrior[i] / (tmpFloat1 + 0.0001f);  </span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  besselTmp = (snrLocPost[i] + 1.f) * tmpFloat2;  </span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  self-&gt;logLrtTimeAvg[i] +=  </span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">      LRT_TAVG * (besselTmp - (<span class="datatypes" style="margin:0px; padding:0px; border:none; color:rgb(46,139,87); background-color:inherit; font-weight:bold">float</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">)log(tmpFloat1) - self-&gt;logLrtTimeAvg[i]);  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  logLrtTimeAvgKsum += self-&gt;logLrtTimeAvg[i];  </span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">}  </span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">logLrtTimeAvgKsum = (<span class="datatypes" style="margin:0px; padding:0px; border:none; color:rgb(46,139,87); background-color:inherit; font-weight:bold">float</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">)logLrtTimeAvgKsum / (self-&gt;magnLen);  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">self-&gt;featureData[3] = logLrtTimeAvgKsum;  </span></li></ol> 
</div> 
<span style="color:rgb(51,51,51); font-family:Arial; font-size:14px">要看懂上述代码所蕴含的物理和数学意义，必须先看动下面的推导。</span> 
<br style="color:rgb(51,51,51); font-family:Arial; font-size:14px"> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">计算speech/nosie的probability。该概率返回在probSpeechFinal参数中，</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">先推到语音/噪声概率计算方法，先来看语音/噪声的概率模型，定义语音状态为<img src="https://images2.imgbox.com/06/61/wLyfIkvC_o.png" alt="" style="border:none; max-width:100%">，定义噪声状态为<img src="https://images2.imgbox.com/cf/15/FT54H8zD_o.png" alt="" style="border:none; max-width:100%">，其中m是帧，k是频率。则语音/噪声的概率可表示为：<br> <img src="https://images2.imgbox.com/16/85/3RMyzDqt_o.png" alt="" style="border:none; max-width:100%"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">这一概率取决于观测到的额噪声输入频谱系数<img src="https://images2.imgbox.com/f7/86/1Zk0tqJe_o.png" alt="" style="border:none; max-width:100%">以及所处理信号的一些特征数据（如信号的分类特征），也就是这里的{F}。特征数据可以是有噪输入频谱，过往频谱数据，模型数据等。如特征数据{F}可以包括频谱平坦度测量，谐振峰值距，LPC残余以及模板匹配等。根据贝叶斯准则，语音/噪声概率可表示为：</p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/da/fb/rcUM9LQ0_o.png" alt="" style="border:none; max-width:100%"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">其中p（{F}）是以信号的特征数据为基础的先验概率，该值在下方一个或多个表达式中被设为一个常数。数量<img src="https://images2.imgbox.com/40/1e/ev5yiRuF_o.png" alt="" style="border:none; max-width:100%">是特征数据{F}下的语音/噪声概率，在忽略{F}为基础的先验概率p{F}，简化<img src="https://images2.imgbox.com/5f/3c/2wpTcXZd_o.png" alt="" style="border:none; max-width:100%">以及<img src="https://images2.imgbox.com/ea/58/x5RyjAls_o.png" alt="" style="border:none; max-width:100%">，则标准化的语音概率可写作为：</p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/bd/39/O2aQMI06_o.png" alt="" style="border:none; max-width:100%"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">上式简写为：</p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/b9/27/3hbBew7H_o.png" alt="" style="border:none; max-width:100%"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">其中似然比（LR）为：</p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/c5/c7/uplRMC86_o.png" alt="" style="border:none; max-width:100%"><br> </p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">在上述<img src="https://images2.imgbox.com/e9/e5/q8whqKuC_o.png" alt="" style="border:none; max-width:100%">的表达式中，<img src="https://images2.imgbox.com/5e/df/H9aFJ1Rd_o.png" alt="" style="border:none; max-width:100%">通过线性模型和针对语音和噪声频谱系数的高斯概率密度函数（PDF）假设来确定。具体来说，有噪输入信号的线性模型表达式为：语音状态下：<br> </p> 
<div style="text-align:center"> 
 <img src="https://images2.imgbox.com/51/03/euzPMYXN_o.png" alt="" style="border:none; max-width:100%"> 
</div> 
<p></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">噪声状态下是：</p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/70/42/RyAPwQyS_o.png" alt="" style="border:none; max-width:100%"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">假设高斯概率密度函数使用复杂系数<img src="https://images2.imgbox.com/0b/52/BSiO1lly_o.png" alt="" style="border:none; max-width:100%">，则数量<img src="https://images2.imgbox.com/45/ff/YPzmVrvn_o.png" alt="" style="border:none; max-width:100%">表示如下：</p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/46/f3/04PeCwmE_o.png" alt="" style="border:none; max-width:100%"></p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/6a/94/368iGvWY_o.png" alt="" style="border:none; max-width:100%"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">由于完全可以根据线性模型和高斯PDF假设确定概率，因此可将特征依赖从上述表达式中删除。这样，似然比<img src="https://images2.imgbox.com/e0/ad/annrYXm1_o.png" alt="" style="border:none; max-width:100%">变成：</p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/4f/93/0t62AJrg_o.png" alt="" style="border:none; max-width:100%"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">其中，<img src="https://images2.imgbox.com/9f/70/Wc8vJW4U_o.png" alt="" style="border:none; max-width:100%">是未知信号的SNR（即先验SNR），<img src="https://images2.imgbox.com/38/c9/3tjisxyk_o.png" alt="" style="border:none; max-width:100%">是频率K和帧m的后验SNR（即后验SNR或瞬态SNR）。在一个现实例子中，上述表达式中使用的先验SNR和后验SNR由量级定义进行估计，算式为：</p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/bc/b5/JkCvaDBp_o.png" alt="" style="border:none; max-width:100%"></p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/28/94/RC6CscbN_o.png" alt="" style="border:none; max-width:100%"><br> </p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">根据上述表达式，语音/噪声状态概率可通过似然比<img src="https://images2.imgbox.com/02/67/V5rhny5D_o.png" alt="" style="border:none; max-width:100%">和数量q获得，其中，似然比根据频变后验和先验SNR确定，数量是基于特征或基于模型的概率，详细描述参加下文。因此，语音/噪声状态概率可以表示为：</p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/f1/97/vYDglJvX_o.png" alt="" style="border:none; max-width:100%"></p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/df/bd/rcMDMOC2_o.png" alt="" style="border:none; max-width:100%"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">有时帧到帧之间的频变似然比因子<img src="https://images2.imgbox.com/84/99/ME0BJIIl_o.png" alt="" style="border:none; max-width:100%">会有很大的波动，所以采用经过时间平滑处理的似然比因子：</p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/2b/55/4mdJNLZk_o.png" alt="" style="border:none; max-width:100%"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">上面这个公式就是先前代码所做的事情，但是代码里又没有完全按照这里的公式推导来的。这里先用<img src="https://images2.imgbox.com/cc/97/iXKv1xc2_o.png" alt="" style="border:none; max-width:100%">和<img src="https://images2.imgbox.com/9e/fc/BIw64v80_o.png" alt="" style="border:none; max-width:100%">对上述代码进行简化处理。</p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/86/df/uYGqN90U_o.png" alt="" style="border:none; max-width:100%"></p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/2a/e4/8azxdTUi_o.png" alt="" style="border:none; max-width:100%"></p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/26/5a/SARqxdKE_o.png" alt="" style="border:none; max-width:100%"></p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/d1/ef/oa4stCLI_o.png" alt="" style="border:none; max-width:100%"></p> 
<p style="text-align:justify; color:rgb(51,51,51); font-family:Arial; font-size:14px"> 该式的最后一项是如下式子取对数所得。值得注意的是上述的代码并未完全按照公式计算得来。</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"></p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/82/23/h2w5y4hT_o.png" alt="" style="border:none; max-width:100%"></p> 
<br style="color:rgb(51,51,51); font-family:Arial; font-size:14px"> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">经过时间平滑处理的似然比因子的几何平均数（包括所有频率）可用作对基于帧的语音/噪声分类的可靠测量结果：</p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/d9/7b/1IDM6RrN_o.png" alt="" style="border:none; max-width:100%"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"></p> 
<div class="dp-highlighter bg_cpp" style='font-family:Consolas,"Courier New",Courier,mono,serif; background-color:rgb(231,229,220); width:700.906px; overflow-x:auto; overflow-y:hidden; padding-top:1px; position:relative; color:rgb(51,51,51); margin:18px 0px!important'> 
 <div class="bar" style="padding-left:45px"> 
  <div class="tools" style="padding:3px 8px 10px 10px; font-size:9px; line-height:normal; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; background-color:rgb(248,248,248); border-left:3px solid rgb(108,226,108)"> 
   <strong>[cpp]</strong>  
   <a target="_blank" href="http://blog.csdn.net/shichaog/article/details/52514816#" class="ViewSource" title="view plain" style="color:rgb(160,160,160); background-color:inherit; border:none; padding:1px; margin:0px 10px 0px 0px; font-size:9px; display:inline-block; width:16px; height:16px; text-indent:-2000px" rel="noopener noreferrer">view plain</a> 
    <a target="_blank" href="http://blog.csdn.net/shichaog/article/details/52514816#" class="CopyToClipboard" title="copy" style="color:rgb(160,160,160); background-color:inherit; border:none; padding:1px; margin:0px 10px 0px 0px; font-size:9px; display:inline-block; width:16px; height:16px; text-indent:-2000px" rel="noopener noreferrer">copy</a> 
   <div style="position:absolute; left:834px; top:10899px; width:18px; height:18px; z-index:99"> 
   </div> 
    
  </div> 
 </div> 
 <ol start="1" class="dp-cpp" style="padding:0px; border:none; list-style-position:initial; background-color:rgb(255,255,255); color:rgb(92,92,92); margin:0px 0px 1px 45px!important"><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span style="margin:0px; padding:0px; border:none; background-color:inherit">logLrtTimeAvgKsum = (</span><span class="datatypes" style="margin:0px; padding:0px; border:none; color:rgb(46,139,87); background-color:inherit; font-weight:bold">float</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">)logLrtTimeAvgKsum / (self-&gt;magnLen);  </span></span></li></ol> 
</div> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">在语音/噪声概率计算时，使用高斯假设作为语音PDF模型，从而获得似然比。在其它模型中，概率密度PDF模型也可以用作测量似然比的基础，包括拉普拉斯算子，伽马，超高斯。举个例子，当高斯假设可合理表示噪声时，该假设并不一定适用于语音，尤其是在较短的时帧中（如～10ms）。在这种情况下，可以使用另一种语音PDF模型，但这很可能会增加复杂性。<br> </p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">要在噪声估计和过滤流程中确定语音/噪声的概率，这不仅需要本地SNR（即先验SNR和瞬态SNR）的引导，还要结合从特征建模中获得的语音模型/认知内容。将语音模 型/认知内容并入到语音/噪声概率确定中，能让噪声抑制流程更好地处理和区分极不稳定的 噪声水平。如果仅依靠本地SNR，可能会造成可能性偏差。这里对包含本地SNR和语音特征/模型数据的每个帧和频率更新和适应基于特征的概率<img src="https://images2.imgbox.com/c4/7d/dNo41zxG_o.png" alt="" style="border:none; max-width:100%">。可以简写为<img src="https://images2.imgbox.com/50/7a/NhHnhlF8_o.png" alt="" style="border:none; max-width:100%">。因为此处所述流程仅以帧为基础对数量<img src="https://images2.imgbox.com/c6/60/h5fJkCLM_o.png" alt="" style="border:none; max-width:100%">建模和更新，所以变量k就受到抑制。</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">基于特征的概率的更新可采用一下模型：</p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/17/15/LyLRdj9h_o.png" alt="" style="border:none; max-width:100%"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">其中，<img src="https://images2.imgbox.com/02/a4/YvcBkKLh_o.png" alt="" style="border:none; max-width:100%">是一个平滑阐述，<img src="https://images2.imgbox.com/a2/47/08xiwaSG_o.png" alt="" style="border:none; max-width:100%">是给定时间和频率的映射函数（如在0和1之间）。此映射函数中的变量Z是Z=F-T，其中F是被测特征，T是阈值。参数w则代表映射函数的形状/宽度特征。映射函数根据测量出的特征以及阈值和宽度参数，将时频槽划分为语音（M接近1）或噪声（M接近0）.</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">在噪声估计和过滤流程中，确定语音/噪声可能性时，会考虑语音信号的以下特征：（1）LRT均值，可以基于本地SNR得出，（2）频谱平坦度，可基于语音谐波模型得出，以及（3）频谱模板差异测量。还可以使用其它语音信号特征作为补充或替代特征。</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"><strong>1. LRT均值特征</strong></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">经过时间平滑处理的似然比（LR）因子的几何平均数是语音/噪声状态的可靠指标：</p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/8c/4f/WzX0icTZ_o.png" alt="" style="border:none; max-width:100%"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">其中经过时间处理的LR因子根据前文所述表达式得出。使用LRT均值特征时，映射函数M（z）的一个示例可能是“S”型曲线函数，例如：</p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/8c/b2/KcXrJQLP_o.png" alt="" style="border:none; max-width:100%"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"></p> 
<div class="dp-highlighter bg_cpp" style='font-family:Consolas,"Courier New",Courier,mono,serif; background-color:rgb(231,229,220); width:700.906px; overflow-x:auto; overflow-y:hidden; padding-top:1px; position:relative; color:rgb(51,51,51); margin:18px 0px!important'> 
 <div class="bar" style="padding-left:45px"> 
  <div class="tools" style="padding:3px 8px 10px 10px; font-size:9px; line-height:normal; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; background-color:rgb(248,248,248); border-left:3px solid rgb(108,226,108)"> 
   <strong>[cpp]</strong>  
   <a target="_blank" href="http://blog.csdn.net/shichaog/article/details/52514816#" class="ViewSource" title="view plain" style="color:rgb(160,160,160); background-color:inherit; border:none; padding:1px; margin:0px 10px 0px 0px; font-size:9px; display:inline-block; width:16px; height:16px; text-indent:-2000px" rel="noopener noreferrer">view plain</a> 
    <a target="_blank" href="http://blog.csdn.net/shichaog/article/details/52514816#" class="CopyToClipboard" title="copy" style="color:rgb(160,160,160); background-color:inherit; border:none; padding:1px; margin:0px 10px 0px 0px; font-size:9px; display:inline-block; width:16px; height:16px; text-indent:-2000px" rel="noopener noreferrer">copy</a> 
   <div style="position:absolute; left:834px; top:11917px; width:18px; height:18px; z-index:99"> 
   </div> 
    
  </div> 
 </div> 
 <ol start="1" class="dp-cpp" style="padding:0px; border:none; list-style-position:initial; background-color:rgb(255,255,255); color:rgb(92,92,92); margin:0px 0px 1px 45px!important"><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// Compute indicator function: sigmoid map.</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">indicator0 =  </span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    0.5f *  </span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    ((<span class="datatypes" style="margin:0px; padding:0px; border:none; color:rgb(46,139,87); background-color:inherit; font-weight:bold">float</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">)tanh(widthPrior * (logLrtTimeAvgKsum - threshPrior0)) + 1.f);  </span></span></li></ol> 
</div> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"></p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/f2/90/GLmk6iNO_o.png" alt="" style="border:none; max-width:100%"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">其中，<img src="https://images2.imgbox.com/42/e6/aKd0nwbA_o.png" alt="" style="border:none; max-width:100%">是特征，<img src="https://images2.imgbox.com/76/d2/ThFSGdn9_o.png" alt="" style="border:none; max-width:100%">是一个过渡/宽度参数，用于控制从0到1的映射的平滑性。阈值参数<img src="https://images2.imgbox.com/88/dd/m7KdV2Yi_o.png" alt="" style="border:none; max-width:100%">需要根据参数设置来确定。</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"><strong>2. 频谱平坦度特征</strong></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"> 为获得频谱平坦度特征，假设语音比噪声有更多的谐波行为。然而，语音频谱往往会在基频（基音）和谐波中出现峰值，而噪声频谱则相对平坦。因此，至少在某些布置中，本地频谱平坦度测量的综合可用做区分语音和噪声的良好判断依据。</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">在计算频谱平坦度时，N代表频率槽的数量，B代表频率带的数量。k是频率槽指数，j是频率带指数。每个频率带将包括大量的频率槽。举例来说，128槽的频率频谱可分成4个频率带（低，中低，中高，高）。每个频率带包括32个槽。在另一个示例中，仅使用一个包括所有频率的频率带。频谱平坦度可以通过计算输入幅度谱的几何平均数与算术平均数的比值得出：</p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/1e/9f/2VvD4wo3_o.png" alt="" style="border:none; max-width:100%"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">其中N表示频率带中的频率数。对于噪声，计算出的数量<img src="https://images2.imgbox.com/b7/ba/h83svEaL_o.png" alt="" style="border:none; max-width:100%">偏大且为常数，而对于语音，计算出的数量则偏小且为变量。同样，用于对基于特征的先验概率进行更新的映射函数<img src="https://images2.imgbox.com/67/e0/L7wsCwnf_o.png" alt="" style="border:none; max-width:100%">的一个示例可表示为s型曲线函数：<br> </p> 
<div style="text-align:center"> 
 <img src="https://images2.imgbox.com/74/47/IwpcaPiQ_o.png" alt="" style="border:none; max-width:100%"> 
</div> 
<p></p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/65/eb/A6Ey8Ama_o.png" alt="" style="border:none; max-width:100%"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"></p> 
<div class="dp-highlighter bg_cpp" style='font-family:Consolas,"Courier New",Courier,mono,serif; background-color:rgb(231,229,220); width:700.906px; overflow-x:auto; overflow-y:hidden; padding-top:1px; position:relative; color:rgb(51,51,51); margin:18px 0px!important'> 
 <div class="bar" style="padding-left:45px"> 
  <div class="tools" style="padding:3px 8px 10px 10px; font-size:9px; line-height:normal; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; background-color:rgb(248,248,248); border-left:3px solid rgb(108,226,108)"> 
   <strong>[cpp]</strong>  
   <a target="_blank" href="http://blog.csdn.net/shichaog/article/details/52514816#" class="ViewSource" title="view plain" style="color:rgb(160,160,160); background-color:inherit; border:none; padding:1px; margin:0px 10px 0px 0px; font-size:9px; display:inline-block; width:16px; height:16px; text-indent:-2000px" rel="noopener noreferrer">view plain</a> 
    <a target="_blank" href="http://blog.csdn.net/shichaog/article/details/52514816#" class="CopyToClipboard" title="copy" style="color:rgb(160,160,160); background-color:inherit; border:none; padding:1px; margin:0px 10px 0px 0px; font-size:9px; display:inline-block; width:16px; height:16px; text-indent:-2000px" rel="noopener noreferrer">copy</a> 
   <div style="position:absolute; left:834px; top:12743px; width:18px; height:18px; z-index:99"> 
   </div> 
    
  </div> 
 </div> 
 <ol start="1" class="dp-cpp" style="padding:0px; border:none; list-style-position:initial; background-color:rgb(255,255,255); color:rgb(92,92,92); margin:0px 0px 1px 45px!important"><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// Compute indicator function: sigmoid map.</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">indicator1 =  </span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    0.5f *  </span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    ((<span class="datatypes" style="margin:0px; padding:0px; border:none; color:rgb(46,139,87); background-color:inherit; font-weight:bold">float</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">)tanh((</span><span class="datatypes" style="margin:0px; padding:0px; border:none; color:rgb(46,139,87); background-color:inherit; font-weight:bold">float</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">)sgnMap * widthPrior * (threshPrior1 - tmpFloat1)) +  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">     1.f);  </span></li></ol> 
</div> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"><strong>3. 频谱模板差异特征</strong></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">除了频谱平坦度特征的噪声相关假设之外，有关噪声频谱的另一个假设是，噪声频谱比语音频谱更温度。因此，可假设噪声频谱的整体形状在任何给定阶段都倾向与保持相同。模板频谱通过更新频谱（最初被设为零）中极有可能是噪声或语音停顿的区段来确定。该比较结果是对噪声的保守估计，其中仅对语音概率确定低于阈值（如<img src="https://images2.imgbox.com/59/e9/Y0oSZS0W_o.png" alt="" style="border:none; max-width:100%">）的区段处跟新了噪声。在其它分布中，模板频谱也可能被导入到算法中，或从对应不同噪声的形状中筛选出来。考虑到输入频谱<img src="https://images2.imgbox.com/7a/2c/MjepVxW4_o.png" alt="" style="border:none; max-width:100%">和模板频谱（表示为<img src="https://images2.imgbox.com/8e/e0/l6HU0ECD_o.png" alt="" style="border:none; max-width:100%">），如想获得频谱模板差异特征，可首先将频谱差异测量定义为：<img src="https://images2.imgbox.com/f4/a7/CfQaYlXJ_o.png" alt="" style="border:none; max-width:100%"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">其中，<img src="https://images2.imgbox.com/33/ef/NIgM8kD0_o.png" alt="" style="border:none; max-width:100%">是形状参数，包括线性位移和振幅参数，是通过将J最小化获得的。<img src="https://images2.imgbox.com/f2/3b/mx0RZI3J_o.png" alt="" style="border:none; max-width:100%">通过线性方程获得，因此可对每个帧轻松抽取此参数。在某些示例中，这些参数可表明输入频谱（在音量增加的情况下）的任何简单位移/标度变化。之后该特征将成为标准话的测度。</p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/ea/47/x90eaWRD_o.png" alt="" style="border:none; max-width:100%"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">其中标准化是所有频率以及之前时帧在某些时间窗口的平均输入频谱。<br> </p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/8e/3f/sTsEo3jg_o.png" alt="" style="border:none; max-width:100%"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">如上所述，频谱模板差异特征可测量出模板或习得噪声频谱与输入频谱的差异/偏差。至少在某些布置中，这种频谱模板差异特征可用于修正特征的语音/噪声概率<img src="https://images2.imgbox.com/c1/d2/X58RfXjH_o.png" alt="" style="border:none; max-width:100%">。如果<img src="https://images2.imgbox.com/91/db/4OKLYGkw_o.png" alt="" style="border:none; max-width:100%">较小，可将输入帧频谱视作“接近”模板频谱，且很可能将该输入帧视为噪声。另一方面，如果频谱模板差异特征值较大，则表示输入帧频谱与噪声模板频谱差异很大，则判为语音。使用S曲线将频谱模板差异特征映射为概率权数。需要重点强调的是，频谱模板差异特征测量比频谱平坦度特征测量更普遍。如果一个模板具备恒定的平坦频谱，则频谱模板差异特征可简化为对频谱平坦度的测量。</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">可以在频谱模板差异测量中加入佳琪期限<img src="https://images2.imgbox.com/d1/16/MDAWdZ14_o.png" alt="" style="border:none; max-width:100%">，以突出频谱中的特定频率带：</p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/89/69/cPVZB6YX_o.png" alt="" style="border:none; max-width:100%"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">上述多个特征（LRT均值，频谱平坦度和频谱模板差异）可在语音/噪声概率的更新模板中同时出现，如下：</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"><img src="https://images2.imgbox.com/7a/a2/4WDU32zg_o.png" alt="" style="border:none; max-width:100%"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">不同特征院子不同信息。这些呼吸补充，以提供一个更稳定，更具适应性的语音/噪声概率更新。</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"></p> 
<div class="dp-highlighter bg_cpp" style='font-family:Consolas,"Courier New",Courier,mono,serif; background-color:rgb(231,229,220); width:700.906px; overflow-x:auto; overflow-y:hidden; padding-top:1px; position:relative; color:rgb(51,51,51); margin:18px 0px!important'> 
 <div class="bar" style="padding-left:45px"> 
  <div class="tools" style="padding:3px 8px 10px 10px; font-size:9px; line-height:normal; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; background-color:rgb(248,248,248); border-left:3px solid rgb(108,226,108)"> 
   <strong>[cpp]</strong>  
   <a target="_blank" href="http://blog.csdn.net/shichaog/article/details/52514816#" class="ViewSource" title="view plain" style="color:rgb(160,160,160); background-color:inherit; border:none; padding:1px; margin:0px 10px 0px 0px; font-size:9px; display:inline-block; width:16px; height:16px; text-indent:-2000px" rel="noopener noreferrer">view plain</a> 
    <a target="_blank" href="http://blog.csdn.net/shichaog/article/details/52514816#" class="CopyToClipboard" title="copy" style="color:rgb(160,160,160); background-color:inherit; border:none; padding:1px; margin:0px 10px 0px 0px; font-size:9px; display:inline-block; width:16px; height:16px; text-indent:-2000px" rel="noopener noreferrer">copy</a> 
   <div style="position:absolute; left:834px; top:13932px; width:18px; height:18px; z-index:99"> 
   </div> 
    
  </div> 
 </div> 
 <ol start="1" class="dp-cpp" style="padding:0px; border:none; list-style-position:initial; background-color:rgb(255,255,255); color:rgb(92,92,92); margin:0px 0px 1px 45px!important"><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// Combine the indicator function with the feature weights.</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">indPrior = weightIndPrior0 * indicator0 + weightIndPrior1 * indicator1 +  </span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">           weightIndPrior2 * indicator2;  </span></li></ol> 
</div> 
<br style="color:rgb(51,51,51); font-family:Arial; font-size:14px"> 
<span style="color:rgb(51,51,51); font-family:Arial; font-size:14px">最后把log转换到正常的概率。</span> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"></p> 
<div class="dp-highlighter bg_cpp" style='font-family:Consolas,"Courier New",Courier,mono,serif; background-color:rgb(231,229,220); width:700.906px; overflow-x:auto; overflow-y:hidden; padding-top:1px; position:relative; color:rgb(51,51,51); margin:18px 0px!important'> 
 <div class="bar" style="padding-left:45px"> 
  <div class="tools" style="padding:3px 8px 10px 10px; font-size:9px; line-height:normal; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; background-color:rgb(248,248,248); border-left:3px solid rgb(108,226,108)"> 
   <strong>[cpp]</strong>  
   <a target="_blank" href="http://blog.csdn.net/shichaog/article/details/52514816#" class="ViewSource" title="view plain" style="color:rgb(160,160,160); background-color:inherit; border:none; padding:1px; margin:0px 10px 0px 0px; font-size:9px; display:inline-block; width:16px; height:16px; text-indent:-2000px" rel="noopener noreferrer">view plain</a> 
    <a target="_blank" href="http://blog.csdn.net/shichaog/article/details/52514816#" class="CopyToClipboard" title="copy" style="color:rgb(160,160,160); background-color:inherit; border:none; padding:1px; margin:0px 10px 0px 0px; font-size:9px; display:inline-block; width:16px; height:16px; text-indent:-2000px" rel="noopener noreferrer">copy</a> 
   <div style="position:absolute; left:834px; top:14124px; width:18px; height:18px; z-index:99"> 
   </div> 
    
  </div> 
 </div> 
 <ol start="1" class="dp-cpp" style="padding:0px; border:none; list-style-position:initial; background-color:rgb(255,255,255); color:rgb(92,92,92); margin:0px 0px 1px 45px!important"><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// Final speech probability: combine prior model with LR factor:.</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">gainPrior = (1.f - self-&gt;priorSpeechProb) / (self-&gt;priorSpeechProb + 0.0001f);  </span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); background-color:inherit; font-weight:bold">for</span><span style="margin:0px; padding:0px; border:none; background-color:inherit"> (i = 0; i &lt; self-&gt;magnLen; i++) {  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  invLrt = (<span class="datatypes" style="margin:0px; padding:0px; border:none; color:rgb(46,139,87); background-color:inherit; font-weight:bold">float</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">)exp(-self-&gt;logLrtTimeAvg[i]);  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  invLrt = (<span class="datatypes" style="margin:0px; padding:0px; border:none; color:rgb(46,139,87); background-color:inherit; font-weight:bold">float</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">)gainPrior * invLrt;  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">  probSpeechFinal[i] = 1.f / (1.f + invLrt);  </span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">}  </span></li></ol> 
</div> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"></p> 
<h3 style="margin:0px; padding:0px; color:rgb(51,51,51); font-family:Arial"><a target="_blank" name="t7" style="color:rgb(51,102,153)"></a>噪声估计 Update Noise Estimate<br> </h3> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">语音/噪声概率确定后，将执行噪声估计更新，表示如下：</p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/fa/fd/uPJva0aO_o.png" alt="" style="border:none; max-width:100%"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"></p> 
<div class="dp-highlighter bg_cpp" style='font-family:Consolas,"Courier New",Courier,mono,serif; background-color:rgb(231,229,220); width:700.906px; overflow-x:auto; overflow-y:hidden; padding-top:1px; position:relative; color:rgb(51,51,51); margin:18px 0px!important'> 
 <div class="bar" style="padding-left:45px"> 
  <div class="tools" style="padding:3px 8px 10px 10px; font-size:9px; line-height:normal; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; background-color:rgb(248,248,248); border-left:3px solid rgb(108,226,108)"> 
   <strong>[cpp]</strong>  
   <a target="_blank" href="http://blog.csdn.net/shichaog/article/details/52514816#" class="ViewSource" title="view plain" style="color:rgb(160,160,160); background-color:inherit; border:none; padding:1px; margin:0px 10px 0px 0px; font-size:9px; display:inline-block; width:16px; height:16px; text-indent:-2000px" rel="noopener noreferrer">view plain</a> 
    <a target="_blank" href="http://blog.csdn.net/shichaog/article/details/52514816#" class="CopyToClipboard" title="copy" style="color:rgb(160,160,160); background-color:inherit; border:none; padding:1px; margin:0px 10px 0px 0px; font-size:9px; display:inline-block; width:16px; height:16px; text-indent:-2000px" rel="noopener noreferrer">copy</a> 
   <div style="position:absolute; left:834px; top:14460px; width:18px; height:18px; z-index:99"> 
   </div> 
    
  </div> 
 </div> 
 <ol start="1" class="dp-cpp" style="padding:0px; border:none; list-style-position:initial; background-color:rgb(255,255,255); color:rgb(92,92,92); margin:0px 0px 1px 45px!important"><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span style="margin:0px; padding:0px; border:none; background-color:inherit">probSpeech = self-&gt;speechProb[i];  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">probNonSpeech = 1.f - probSpeech;  </span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// Temporary noise update:</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">// Use it for speech frames if update value is less than previous.</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">noiseUpdateTmp = gammaNoiseTmp * self-&gt;noisePrev[i] +  </span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">                 (1.f - gammaNoiseTmp) * (probNonSpeech * magn[i] +  </span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">                                          probSpeech * self-&gt;noisePrev[i]);  </span></li></ol> 
</div> 
<span style="color:rgb(51,51,51); font-family:Arial; font-size:14px">其中</span> 
<img src="https://images2.imgbox.com/82/f3/vXmru4gQ_o.png" alt="" style="border:none; max-width:100%; color:rgb(51,51,51); font-family:Arial; font-size:14px"> 
<span style="color:rgb(51,51,51); font-family:Arial; font-size:14px">是帧/时间为m，频率槽为k时对噪声频谱量级的估计。参数</span> 
<img src="https://images2.imgbox.com/f1/60/reZS4MEa_o.png" alt="" style="border:none; max-width:100%; color:rgb(51,51,51); font-family:Arial; font-size:14px"> 
<span style="color:rgb(51,51,51); font-family:Arial; font-size:14px">控制噪声更新的平滑度，第二个期限则使用输入频谱和上次噪声估计对噪声进行跟新，然后根据如上所述的语音/噪声概率进行加权，这可表示为：</span> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"></p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/9f/2e/BZXu17DP_o.png" alt="" style="border:none; max-width:100%"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">其中LR因子<img src="https://images2.imgbox.com/1b/50/FZcnIzI1_o.png" alt="" style="border:none; max-width:100%">是：</p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/ae/4c/updB1PKP_o.png" alt="" style="border:none; max-width:100%"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">数量<img src="https://images2.imgbox.com/77/cd/Mp503dUR_o.png" alt="" style="border:none; max-width:100%">是基于模型或基于特征的语音/噪声概率，得自上述具有多个特征的更新模型。上述噪声估计模型会对噪声可能性较大（即语音可能性较小）的每个帧和频率槽的噪声进行更新。对于噪声可能性不大的帧和频率槽，则将对信号中上一个帧的估计作为噪声估计。</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">噪声估计更新流程收到语音/噪声概率和平滑参数<img src="https://images2.imgbox.com/a8/77/sTiTDO5D_o.png" alt="" style="border:none; max-width:100%">的控制，平滑参数可被设为像0.85这样的值。在不同的示例中，对于语音概率超过阈值参数<img src="https://images2.imgbox.com/61/07/lOB4CVrr_o.png" alt="" style="border:none; max-width:100%">的区域，平滑参数可能会被增加到<img src="https://images2.imgbox.com/d8/fd/X6trMHup_o.png" alt="" style="border:none; max-width:100%">=0.99，以防止语音开始处的噪声水平增加过高。在一个或多个布置中，阈值参数被设定为<img src="https://images2.imgbox.com/13/7e/e1Jm7aoS_o.png" alt="" style="border:none; max-width:100%">=0.2/0.25,。</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">完成噪声估计更新后，噪声估计和过滤流程采用维纳增益滤波器以减少或消除来自输入帧的估计噪声量。标准维纳滤波器表达如下：、</p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/94/47/XHRhAcKP_o.png" alt="" style="border:none; max-width:100%"><br> </p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">其中<img src="https://images2.imgbox.com/f4/81/1twMl7Wv_o.png" alt="" style="border:none; max-width:100%">是估计得出的噪声频谱系数，<img src="https://images2.imgbox.com/c4/2b/EUZggflK_o.png" alt="" style="border:none; max-width:100%">是观测到的有噪频谱系数，<img src="https://images2.imgbox.com/6b/76/BPb5Oq2a_o.png" alt="" style="border:none; max-width:100%">是纯净语音频谱（帧为m，频率为k）。之后，平方量级可被量级替代，维纳滤波器变成：</p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/8b/d7/UhoRc9IB_o.png" alt="" style="border:none; max-width:100%"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">在一种或多种常规方法中，会对滤波器直接应用时间平均法，以减少任何的帧间波动。根据本发明的某些方面，维纳滤波器用先验SNR表示，而判决引导（DD）更新则用于对先验SNR进行时间平均计算。维纳滤波器可用先验SNR表示为：</p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/e3/e1/GP9ewDHU_o.png" alt="" style="border:none; max-width:100%"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">其中，<img src="https://images2.imgbox.com/3c/1e/wyhY1Xag_o.png" alt="" style="border:none; max-width:100%">代表上文定义的先验SNR，将噪声频谱替换为估计得出的噪声频谱：</p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/ef/04/WQu9L275_o.png" alt="" style="border:none; max-width:100%"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">如上所述，按照DD更新估计先验SNR。该增益滤波器通过取底和过相减参数，可得出：</p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/b3/23/1vDJ90wt_o.png" alt="" style="border:none; max-width:100%"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">因为DD更新明确对先验SNR进行时间平均计算，所以不会对该增益滤波器再进行外部时间平均计算。参数<img src="https://images2.imgbox.com/8e/d8/YDhMYw4h_o.png" alt="" style="border:none; max-width:100%">是根据噪声抑制系统中实施的噪声抑制器的主动配置定义的。</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">维纳滤波器应用到输入量级频谱中，以获得经抑制的信号。在噪声估计和过滤流程中采用维纳滤波器会得出：</p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/f1/97/xUn8trqk_o.png" alt="" style="border:none; max-width:100%"></p> 
<h3 style="margin:0px; padding:0px; color:rgb(51,51,51); font-family:Arial"><a target="_blank" name="t8" style="color:rgb(51,102,153)"></a>信号合成<br> </h3> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">信号合成包括各种后验噪声抑制处理，以生成包括纯净语音的输出帧。在应用维纳滤波器后，使用反向DFT将帧转换回时域。在一个或多个布置中，转换回时域可表达为：</p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/ff/df/Ydxe924B_o.png" alt="" style="border:none; max-width:100%"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">其中，<img src="https://images2.imgbox.com/08/44/v8Qss2ai_o.png" alt="" style="border:none; max-width:100%">是经维纳滤波器抑制后估计得出的语音，<img src="https://images2.imgbox.com/46/38/3FYWD3iU_o.png" alt="" style="border:none; max-width:100%">是相应的时域信号，其中时间索引为n，帧索引为m。</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">在反向DFT之后，作为信号合成流程的一部分，对经噪声抑制的信号实施能量缩放。能量缩放可用于帮助重建语音帧，且重建方式可增加经抑制后的语音的能量。例如，实施缩放时应确保只有语音帧会放大到一定程度，而噪声帧保持不变。由于噪声抑制可能降低语音信号水平，因此在缩放过程中对语音区段适当放大是有益处的。在一个布置中，根据语音帧在噪声估计和过滤流程中的能量损失，对该帧实施缩放。增益情况可通过该语音帧在噪声抑制处理前后的能量比来确定。<br> </p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/ed/d7/2Xfohsxb_o.png" alt="" style="border:none; max-width:100%"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">在当前示例中，可根据下方模型提取标度：</p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/b5/7a/MdF6BjK1_o.png" alt="" style="border:none; max-width:100%"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">其中，<img src="https://images2.imgbox.com/ef/08/8gV72IwT_o.png" alt="" style="border:none; max-width:100%">是帧m的语音概率，通过取所有频率的语音概率函数<img src="https://images2.imgbox.com/ee/6e/zEfplHDG_o.png" alt="" style="border:none; max-width:100%">的平均值而得：</p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/e4/9d/DS6LKqfO_o.png" alt="" style="border:none; max-width:100%"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">在上述标度方程中，如果概率<img src="https://images2.imgbox.com/a3/9a/CMwwvDTG_o.png" alt="" style="border:none; max-width:100%">接近1，则第一项将较大，如果是噪声，则第二想将较大。</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">在上述标度方程中，参数<img src="https://images2.imgbox.com/6b/b9/AXzUNm4o_o.png" alt="" style="border:none; max-width:100%">，<img src="https://images2.imgbox.com/53/da/ey0lyUkn_o.png" alt="" style="border:none; max-width:100%">控制输入帧的缩放。<br> </p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">信号合成包括窗口合成操作，该操作提供估计得出的语音的最终输出帧。在一个示例中，窗口合成为：</p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/f1/fe/vn0KkJkf_o.png" alt="" style="border:none; max-width:100%"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">其中，标度参数由每个帧的上述标度方程式得出。</p> 
<h3 style="margin:0px; padding:0px; color:rgb(51,51,51); font-family:Arial"><a target="_blank" name="t9" style="color:rgb(51,102,153)"></a>参数估计</h3> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">基于特征的语音/噪声概率函数的更新模型包括应用到特征测量的多个特征加权<img src="https://images2.imgbox.com/ea/9e/nwYlUVmj_o.png" alt="" style="border:none; max-width:100%">和阈值<img src="https://images2.imgbox.com/24/76/NSDTprj3_o.png" alt="" style="border:none; max-width:100%">参数：<br> </p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/ea/28/2qd270dQ_o.png" alt="" style="border:none; max-width:100%"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">这些加权<img src="https://images2.imgbox.com/89/a4/vSlvcdeb_o.png" alt="" style="border:none; max-width:100%">和<img src="https://images2.imgbox.com/fd/e2/eOVVmzb9_o.png" alt="" style="border:none; max-width:100%">用于防止不可靠的特征测量进入更新模型。映射函数也包括宽度参数<img src="https://images2.imgbox.com/1c/84/5BpHg44a_o.png" alt="" style="border:none; max-width:100%">以控制映射函数的形状：</p> 
<p style="text-align:center; color:rgb(51,51,51); font-family:Arial; font-size:14px"> <img src="https://images2.imgbox.com/4c/b9/cvzmu284_o.png" alt="" style="border:none; max-width:100%"></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">例如，如果给的输入的LRT均值特征F1不可靠.</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c0e43b883e034e7c611d19bf49817da3/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">第一次接触单片机ADC 都会有这些问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2ee2261a1d49cd77650a5b0274436bf3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">efm32 c语言1</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>