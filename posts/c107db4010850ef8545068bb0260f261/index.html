<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【Linux】序列化和反序列化 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【Linux】序列化和反序列化" />
<meta property="og:description" content="文章目录 定义利用 Json 实现序列化反序列化Json 的认识Jsoncpp 库的下载与认识实现序列化实现反序列化 在网络编程中，直接使用 结构体 进行数据传输会出错，因为本质上socket无法传输结构体，我们只有将结构体装换为字节数组，或者是字符串格式来传输，然后对端主机收到了数据，再将其转化为结构体，这就是序列化和反序列化的过程！
定义 序列化 (Serialization)是将对象的状态信息转换为可以存储或传输的形式的过程。在序列化期间，对象将其当前状态写入到临时或持久性存储区。以后，可以通过从存储区中读取或反序列化对象的状态，重新创建该对象。
序列化主要有两个用途：
把对象的字节序列永久保存到硬盘上，通常存放在一个文件中（序列化对象）在网络上传送对象的字节序列（网络传输对象） 实际上就是将数据持久化，防止一直存储在内存当中，消耗内存资源。而且序列化后也能更好的便于网络运输何传播。
如下，在网上找到的一张图片，可以很好地描述序列化和反序列化，及其作用（以 java 对象为例）。
利用 Json 实现序列化反序列化 Json 的认识 json 是一种数据交换格式，采用完全独立于编程语言的文本格式来存储和表示数据。
例如：小明同学的学生信息:
char name = &#34;小明&#34;; int age = 18; float score[3] = {88.5, 99, 58}; 则json这种数据交换格式是将这多种数据对象组织成为一个字符串：
[ { &#34;姓名&#34; : &#34;小明&#34;, &#34;年龄&#34; : 18, &#34;成绩&#34; : [88.5, 99, 58] }, { &#34;姓名&#34; : &#34;小黑&#34;, &#34;年龄&#34; : 18, &#34;成绩&#34; : [88.5, 99, 58] } ] json 数据类型：对象，数组，字符串，数字。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/c107db4010850ef8545068bb0260f261/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-01T18:28:37+08:00" />
<meta property="article:modified_time" content="2023-09-01T18:28:37+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【Linux】序列化和反序列化</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_3" rel="nofollow">定义</a></li><li><a href="#_Json__16" rel="nofollow">利用 Json 实现序列化反序列化</a></li><li><ul><li><a href="#Json__18" rel="nofollow">Json 的认识</a></li><li><a href="#Jsoncpp__51" rel="nofollow">Jsoncpp 库的下载与认识</a></li><li><a href="#_121" rel="nofollow">实现序列化</a></li><li><a href="#_162" rel="nofollow">实现反序列化</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<p>在网络编程中，直接使用 <strong>结构体</strong> 进行数据传输会出错，因为<strong>本质上socket无法传输结构体</strong>，我们只有将结构体装换为字节数组，或者是字符串格式来传输，然后对端主机收到了数据，再将其转化为结构体，这就是序列化和反序列化的过程！</p> 
<h2><a id="_3"></a>定义</h2> 
<p>序列化 (Serialization)是将对象的状态信息转换为可以<strong>存储</strong>或<strong>传输</strong>的形式的过程。在序列化期间，对象将其当前状态写入到临时或持久性存储区。以后，可以通过从存储区中读取或反序列化对象的状态，重新创建该对象。</p> 
<p>序列化主要有两个用途：</p> 
<ul><li>把对象的字节序列<strong>永久保存到硬盘上</strong>，通常存放在一个文件中（序列化对象）</li><li>在<strong>网络上传送</strong>对象的字节序列（网络传输对象）</li></ul> 
<p>实际上就是将数据持久化，防止一直存储在内存当中，消耗内存资源。而且序列化后也能更好的便于网络运输何传播。</p> 
<p>如下，在网上找到的一张图片，可以很好地描述序列化和反序列化，及其作用（以 java 对象为例）。<br> <img src="https://images2.imgbox.com/f7/05/vQTc7sjT_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_Json__16"></a>利用 Json 实现序列化反序列化</h2> 
<h3><a id="Json__18"></a>Json 的认识</h3> 
<p>json 是一种数据交换格式，采用完全独立于编程语言的文本格式来存储和表示数据。</p> 
<p>例如：小明同学的学生信息:</p> 
<pre><code class="prism language-cpp"><span class="token keyword">char</span> name <span class="token operator">=</span> <span class="token string">"小明"</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> age <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">;</span>
<span class="token keyword">float</span> score<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">88.5</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">58</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>则json这种数据交换格式是将这多种数据对象组织成为一个字符串：</p> 
<pre><code class="prism language-json"><span class="token punctuation">[</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token string-property property">"姓名"</span> <span class="token operator">:</span> <span class="token string">"小明"</span><span class="token punctuation">,</span>
		<span class="token string-property property">"年龄"</span> <span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
		<span class="token string-property property">"成绩"</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">88.5</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">58</span><span class="token punctuation">]</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token string-property property">"姓名"</span> <span class="token operator">:</span> <span class="token string">"小黑"</span><span class="token punctuation">,</span>
		<span class="token string-property property">"年龄"</span> <span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
		<span class="token string-property property">"成绩"</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">88.5</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">58</span><span class="token punctuation">]</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre> 
<p>json 数据类型：对象，数组，字符串，数字。</p> 
<ul><li>对象：使用花括号 {} 括起来的表示一个对象。</li><li>数组：使用中括号 [] 括起来的表示一个数组。</li><li>字符串：使用常规双引号 “” 括起来的表示一个字符串</li><li>数字：包括整形和浮点型，直接使用。</li></ul> 
<h3><a id="Jsoncpp__51"></a>Jsoncpp 库的下载与认识</h3> 
<pre><code class="prism language-shell"><span class="token function">sudo</span> yum <span class="token function">install</span> epel-release
<span class="token function">sudo</span> yum <span class="token function">install</span> jsoncpp-devel
</code></pre> 
<p>依次执行上面两个指令，然后在 /usr/include/jsoncpp/json/ 目录下查看是否有相关文件，如下图，有则下载成功。</p> 
<p><img src="https://images2.imgbox.com/b3/7e/w8qMbaSG_o.png" alt="在这里插入图片描述"></p> 
<p>jsoncpp 库用于实现 json 格式的序列化和反序列化，完成将多个数据对象组织成为 json 格式字符串，以及将 json格式字符串解析得到多个数据对象的功能。</p> 
<p>这其中主要借助三个类以及其对应的少量成员函数完成：</p> 
<p>在这里过多介绍下面接口肯略微抽象，要在下面的使用过程中去理解其用法。</p> 
<pre><code class="prism language-cpp"><span class="token comment">//Json数据对象类</span>
<span class="token keyword">class</span> <span class="token class-name">Json</span><span class="token operator">:</span><span class="token base-clause"><span class="token operator">:</span><span class="token class-name">Value</span></span> <span class="token punctuation">{<!-- --></span>
	Value <span class="token operator">&amp;</span><span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> Value <span class="token operator">&amp;</span>other<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Value重载了[]和=，因此所有的赋值和获取数据都可以通过</span>
	Value<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//简单的方式完成 val["姓名"] = "小明";</span>
	Value<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
	Value <span class="token function">removeMember</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//移除元素</span>
	<span class="token keyword">const</span> Value<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span>ArrayIndex index<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span> <span class="token comment">//val["成绩"][0]</span>
	Value<span class="token operator">&amp;</span> <span class="token function">append</span><span class="token punctuation">(</span><span class="token keyword">const</span> Value<span class="token operator">&amp;</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//添加数组元素val["成绩"].append(88);</span>
	ArrayIndex <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span><span class="token comment">//获取数组元素个数 val["成绩"].size();</span>
	std<span class="token double-colon punctuation">::</span>string <span class="token function">asString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span><span class="token comment">//转string string name = val["name"].asString();</span>
	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> <span class="token function">asCString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span><span class="token comment">//转char* char *name = val["name"].asCString();</span>
	Int <span class="token function">asInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span><span class="token comment">//转int int age = val["age"].asInt();</span>
	<span class="token keyword">float</span> <span class="token function">asFloat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span><span class="token comment">//转float</span>
	<span class="token keyword">bool</span> <span class="token function">asBool</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span><span class="token comment">//转 bool</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token comment">//json序列化类，低版本用这个更简单</span>
<span class="token keyword">class</span> <span class="token class-name">JSON_API</span> Writer <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">virtual</span> std<span class="token double-colon punctuation">::</span>string <span class="token function">write</span><span class="token punctuation">(</span><span class="token keyword">const</span> Value<span class="token operator">&amp;</span> root<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">JSON_API</span> FastWriter <span class="token operator">:</span> <span class="token keyword">public</span> Writer <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">virtual</span> std<span class="token double-colon punctuation">::</span>string <span class="token function">write</span><span class="token punctuation">(</span><span class="token keyword">const</span> Value<span class="token operator">&amp;</span> root<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">JSON_API</span> StyledWriter <span class="token operator">:</span> <span class="token keyword">public</span> Writer <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">virtual</span> std<span class="token double-colon punctuation">::</span>string <span class="token function">write</span><span class="token punctuation">(</span><span class="token keyword">const</span> Value<span class="token operator">&amp;</span> root<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//json序列化类，高版本推荐，如果用低版本的接口可能会有警告</span>
<span class="token keyword">class</span> <span class="token class-name">JSON_API</span> StreamWriter <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">virtual</span> <span class="token keyword">int</span> <span class="token function">write</span><span class="token punctuation">(</span>Value <span class="token keyword">const</span><span class="token operator">&amp;</span> root<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">*</span> sout<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">JSON_API</span> StreamWriterBuilder <span class="token operator">:</span> <span class="token keyword">public</span> StreamWriter<span class="token double-colon punctuation">::</span>Factory <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">virtual</span> StreamWriter<span class="token operator">*</span> <span class="token function">newStreamWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>



<span class="token comment">//json反序列化类，低版本用起来更简单</span>
<span class="token keyword">class</span> <span class="token class-name">JSON_API</span> Reader <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">bool</span> <span class="token function">parse</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> document<span class="token punctuation">,</span> Value<span class="token operator">&amp;</span> root<span class="token punctuation">,</span> <span class="token keyword">bool</span> collectComments <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//json反序列化类，高版本更推荐</span>
<span class="token keyword">class</span> <span class="token class-name">JSON_API</span> CharReader <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">virtual</span> <span class="token keyword">bool</span> <span class="token function">parse</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token keyword">const</span><span class="token operator">*</span> beginDoc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token keyword">const</span><span class="token operator">*</span> endDoc<span class="token punctuation">,</span>
	                   Value<span class="token operator">*</span> root<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">*</span> errs<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">JSON_API</span> CharReaderBuilder <span class="token operator">:</span> <span class="token keyword">public</span> CharReader<span class="token double-colon punctuation">::</span>Factory <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">virtual</span> CharReader<span class="token operator">*</span> <span class="token function">newCharReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_121"></a>实现序列化</h3> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;iostream&gt;</span>    </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;jsoncpp/json/json.h&gt;</span>    </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;memory&gt;</span>    </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sstream&gt;</span>    </span>
    
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>    
    
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    
<span class="token punctuation">{<!-- --></span>    
  <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>name <span class="token operator">=</span> <span class="token string">"小明"</span><span class="token punctuation">;</span>    
  <span class="token keyword">int</span> age <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">;</span>    
  <span class="token keyword">float</span> score<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">88.5</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">,</span> <span class="token number">58</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    
  Json<span class="token double-colon punctuation">::</span>Value val<span class="token punctuation">;</span>    
  <span class="token comment">// 在val对象中写入数据</span>
  val<span class="token punctuation">[</span><span class="token string">"姓名"</span><span class="token punctuation">]</span> <span class="token operator">=</span> name<span class="token punctuation">;</span>    
  val<span class="token punctuation">[</span><span class="token string">"年龄"</span><span class="token punctuation">]</span> <span class="token operator">=</span> age<span class="token punctuation">;</span>    
  val<span class="token punctuation">[</span><span class="token string">"成绩"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>score<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 因为 score 是数组，所以存入Json::Value 对象要用 append </span>
  val<span class="token punctuation">[</span><span class="token string">"成绩"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>score<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
  val<span class="token punctuation">[</span><span class="token string">"成绩"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>score<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
  
  Json<span class="token double-colon punctuation">::</span>StreamWriterBuilder swb<span class="token punctuation">;</span>    
  std<span class="token double-colon punctuation">::</span>unique_ptr<span class="token operator">&lt;</span>Json<span class="token double-colon punctuation">::</span>StreamWriter<span class="token operator">&gt;</span> <span class="token function">sw</span><span class="token punctuation">(</span>swb<span class="token punctuation">.</span><span class="token function">newStreamWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
  std<span class="token double-colon punctuation">::</span>ostringstream os<span class="token punctuation">;</span>    
  sw<span class="token operator">-&gt;</span><span class="token function">write</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> <span class="token operator">&amp;</span>os<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 将 val对象序列化，并放到 os 中  </span>
  std<span class="token double-colon punctuation">::</span>string str <span class="token operator">=</span> os<span class="token punctuation">.</span><span class="token function">str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                                                                                    
  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> str <span class="token operator">&lt;&lt;</span>std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>  <span class="token comment">// 打印序列化之后的内容</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>    
<span class="token punctuation">}</span>   
</code></pre> 
<p>如上代码，有 val 对象，里面存储了一些数据（姓名、年龄、成绩），然后将其序列化，打印序列化之后的内容，结果如下。</p> 
<p>序列化的过程我们无需关心，因为这是 StreamWriter 封装好的，我们只需要调用其 write 接口，传入参数即可。</p> 
<p><img src="https://images2.imgbox.com/15/7b/q8aBJjAh_o.png" alt="在这里插入图片描述" width="800"><br> 此时，这些序列化之后的内容，就可以在网络中传输，也就是说，如果要进行网络通信传输这些数据，就可以调用 write/sendto/send 等等接口，将上面代码中的 str 进行传输！而不是直接传输 val 对象！</p> 
<h3><a id="_162"></a>实现反序列化</h3> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;iostream&gt;</span>    </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;jsoncpp/json/json.h&gt;</span>    </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;memory&gt;</span>    </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sstream&gt;</span>    </span>
    
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>    
    
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    
<span class="token punctuation">{<!-- --></span>    
  std<span class="token double-colon punctuation">::</span>string str <span class="token operator">=</span> <span class="token raw-string string">R"({"姓名":"小明", "年龄":18, "成绩":[76.5, 55, 88]})"</span><span class="token punctuation">;</span>    
  Json<span class="token double-colon punctuation">::</span>Value root<span class="token punctuation">;</span>    
  Json<span class="token double-colon punctuation">::</span>CharReaderBuilder crb<span class="token punctuation">;</span>    
  std<span class="token double-colon punctuation">::</span>unique_ptr<span class="token operator">&lt;</span>Json<span class="token double-colon punctuation">::</span>CharReader<span class="token operator">&gt;</span> <span class="token function">cr</span><span class="token punctuation">(</span>crb<span class="token punctuation">.</span><span class="token function">newCharReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
  std<span class="token double-colon punctuation">::</span>string err<span class="token punctuation">;</span>    
  cr<span class="token operator">-&gt;</span><span class="token function">parse</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> str<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> str<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>root<span class="token punctuation">,</span> <span class="token operator">&amp;</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 反序列化 </span>
  
  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> root<span class="token punctuation">[</span><span class="token string">"姓名"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">asString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>    
  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> root<span class="token punctuation">[</span><span class="token string">"年龄"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">asInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>    
  <span class="token keyword">int</span> sz <span class="token operator">=</span> root<span class="token punctuation">[</span><span class="token string">"成绩"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
  
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> sz<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>                                                                                                 
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> root<span class="token punctuation">[</span><span class="token string">"成绩"</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">asFloat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>    
  <span class="token punctuation">}</span>    
  <span class="token comment">// 第二种遍历方式</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> it <span class="token operator">=</span> root<span class="token punctuation">[</span><span class="token string">"成绩"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it <span class="token operator">!=</span> root<span class="token punctuation">[</span><span class="token string">"成绩"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>    
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> it<span class="token operator">-&gt;</span><span class="token function">asFloat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>    
  <span class="token punctuation">}</span>    
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>    
<span class="token punctuation">}</span>  
</code></pre> 
<p>如上，现在有一段序列化之后的数据 str，里面的内容是完全按照 json 的格式来组织的。现在要完成反序列化，将其数据放入 root 对象中。</p> 
<p>本质上只要调用 CharReader 的 parse 接口，依次传参即可，然后 root 中就会被放入数据。</p> 
<p><img src="https://images2.imgbox.com/39/9e/RhD7Y38S_o.png" alt="在这里插入图片描述" width="800"></p> 
<p>当然，实现序列化和反序列化不是只有用 jsoncpp 库这一个办法，还有其他办法例如：protbuf 等等。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9841053ca2faae44d7aebfa92ee9718c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">一篇关于LLM指令微调的综述</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/83e93a7b5c4a53d6cd697709ce052e20/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">机器学习笔记之正则化(一)拉格朗日乘数法角度</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>