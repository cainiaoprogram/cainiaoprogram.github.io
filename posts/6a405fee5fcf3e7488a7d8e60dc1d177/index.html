<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Flutter NestedScrollView 、SliverAppBar全解析，悬浮菜单的应用 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Flutter NestedScrollView 、SliverAppBar全解析，悬浮菜单的应用" />
<meta property="og:description" content="在我们开发过程中经常会使用到悬浮菜单的使用，当我们滑动到指定位置后，菜单会自动悬浮。
实现效果如下（左为滑动前、右为滑动后）：
上述便是通过NestedScrollView 、SliverAppBar实现的效果，通过两个控件我们便可以实现上述的效果。
废话不多说直接上代码，代码的实现原理会以注释的形式实现：
import &#39;package:aboxmini/view/home/room/room_device_page.dart&#39;; import &#39;package:flutter/material.dart&#39;; import &#39;../../model/app_model.dart&#39;; class HomeTabBar extends StatefulWidget { const HomeTabBar({super.key}); @override State&lt;HomeTabBar&gt; createState() =&gt; _HomeTabBarState(); } class _HomeTabBarState extends State&lt;HomeTabBar&gt; with TickerProviderStateMixin { /// 自定义的一个类，此类可获取屏幕宽度等 final AppModel _appModel = AppModel.share(); /// 设置 中间展示区域的高度 final double _topHeight = 180 &#43; AppModel.share().safeTop &#43; kToolbarHeight; /// 分栏控制器 late TabController tabController = TabController(length: 3, vsync: this); /// 分栏控制器每一个标题 final _tabs = &lt;String&gt;[&#34;Tab 1&#34;, &#34;Tab 2&#34;, &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/6a405fee5fcf3e7488a7d8e60dc1d177/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-17T15:11:33+08:00" />
<meta property="article:modified_time" content="2023-11-17T15:11:33+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Flutter NestedScrollView 、SliverAppBar全解析，悬浮菜单的应用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>在我们开发过程中经常会使用到悬浮菜单的使用，当我们滑动到指定位置后，菜单会自动悬浮。</p> 
<p>实现效果如下（左为滑动前、右为滑动后）：</p> 
<p><img alt="" height="609" src="https://images2.imgbox.com/48/80/3B54WLEz_o.png" width="281"><img alt="" height="616" src="https://images2.imgbox.com/b5/ed/O5CtEhWN_o.png" width="284"></p> 
<p>上述便是通过NestedScrollView 、SliverAppBar实现的效果，通过两个控件我们便可以实现上述的效果。</p> 
<p>废话不多说直接上代码，代码的实现原理会以注释的形式实现：</p> 
<pre><code class="language-Dart">import 'package:aboxmini/view/home/room/room_device_page.dart';
import 'package:flutter/material.dart';
import '../../model/app_model.dart';

class HomeTabBar extends StatefulWidget {

  const HomeTabBar({super.key});

  @override
  State&lt;HomeTabBar&gt; createState() =&gt; _HomeTabBarState();
}

class _HomeTabBarState extends State&lt;HomeTabBar&gt; with TickerProviderStateMixin {
  /// 自定义的一个类，此类可获取屏幕宽度等
  final AppModel _appModel = AppModel.share();
  /// 设置 中间展示区域的高度
  final double _topHeight = 180 + AppModel.share().safeTop + kToolbarHeight;
  /// 分栏控制器
  late TabController tabController = TabController(length: 3, vsync: this);
  /// 分栏控制器每一个标题
  final _tabs = &lt;String&gt;["Tab 1", "Tab 2", "Tab 3"];

  @override
  void dispose() {
    tabController.dispose();
    super.dispose();
  }

  @override
  Widget build(BuildContext context) {
    return DefaultTabController(
      length: _tabs.length,
      child: NestedScrollView(
        headerSliverBuilder: (BuildContext context, bool innerBoxIsScrolled) {
          return &lt;Widget&gt;[
            SliverOverlapAbsorber(
              handle: NestedScrollView.sliverOverlapAbsorberHandleFor(context),
              sliver: SliverAppBar(
                /// 取消系统导航左边按钮
                leading: Container(),
                /// 设置背景色
                backgroundColor: Colors.white,
                /// 设置左边按钮宽度
                leadingWidth: _appModel.width,
                centerTitle: false,
                pinned: true,
                floating: false,
                snap: false,
                primary: true,
                /// 设置分栏区域上面的高度
                expandedHeight: 230.0,
                elevation: 10,
                //是否显示阴影，直接取值innerBoxIsScrolled，展开不显示阴影，合并后会显示
                forceElevated: innerBoxIsScrolled,
                ///自定义导航和中间内容的展示
                flexibleSpace: _displayNavAndEnvInfo(),
                /// TabBar 分栏标题
                bottom: _addTabBar(),
              ),
            ),
          ];
        },
        /// 分栏展示的页面信息
        body: _addTabBarView(),
      ),
    );
  }

  /// 自定义导航和中间内容展示
  Widget _displayNavAndEnvInfo() {
    return Container(
      color: Colors.white,
      width: _appModel.width,
      height: _topHeight,
      child: Column(
        children: &lt;Widget&gt;[
          _addNav(),
          _displayEnvDevice(),
        ],
      ),
    );
  }

  /// 自定义导航 可随意定制
  Widget _addNav() {
    return SizedBox(
      width: _appModel.width,
      height: _appModel.safeTop + kToolbarHeight,
      child: Container(
        margin: EdgeInsets.only(top: _appModel.safeTop),
        height: kToolbarHeight,
        width: _appModel.width,
        alignment: Alignment.centerLeft,
        child: Row(
          children: &lt;Widget&gt;[
            GestureDetector(
              onTap: () {
                widget.z.toggle!();
              },
              child: Row(
                children: [
                  Container(
                    margin: const EdgeInsets.only(left: 12, right: 6),
                    child: const Icon(
                      Icons.menu,
                      size: 20,
                      color: Colors.red,
                    ),
                  ),
                  Text("${_appModel.currentDatum?.hostname ?? ""}"),
                ],
              ),
            ),
            Expanded(child: Container())
          ],
        ),
      ),
    );
  }

  /// 导航和TabBar中间展示的内容，可随意自定义
  Widget _displayEnvDevice() {
    return Container(
      color: Colors.white,
    );
  }

  /// TabBar 展示样式自定义，可以滚动并且居左展示
  PreferredSize _addTabBar() {
    return PreferredSize(
      /// 设置高度
      preferredSize: const Size.fromHeight(35),
      child: Align(
        /// 设置展示方式
        alignment: Alignment.centerLeft,
        /// TabBar选中、未选中样式
        child: TabBar(
          /// 是否允许滚动 
          isScrollable: true,
          unselectedLabelColor: Colors.black54,
          unselectedLabelStyle: const TextStyle(fontSize: 15),
          labelColor: Colors.blue,
          labelStyle:
              const TextStyle(fontSize: 16, fontWeight: FontWeight.bold),
          indicatorSize: TabBarIndicatorSize.label,
          tabs: _tabs.map((String name) =&gt; Tab(text: name)).toList(),
        ),
      ),
    );
  }

  /// TabBar 分栏下的各个页面
  Widget _addTabBarView() {
    return TabBarView(
      children: _tabs.map((String name) {
        // 分栏下的页面（可随意定义、也可以设置成Text等控件），实现方式还有其他方式
        return RoomDevicePage();
      }).toList(),
    );
  }
}
</code></pre> 
<p>以上便是菜单悬浮的效果实现，注释写的很详细，直接粘贴复制即可实现。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4f9bff18790c124bd781e03edcafd58c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【开发路上的坑合集】</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/259d0c0ec867a75ffa32d7147d57f192/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Anaconda最新安装图文教程（详细版）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>