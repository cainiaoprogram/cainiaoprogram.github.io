<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【机器学习】阿里云天池竞赛——工业蒸汽量预测（5） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【机器学习】阿里云天池竞赛——工业蒸汽量预测（5）" />
<meta property="og:description" content="机器学习经典赛题：工业蒸汽量预测（5） 机器学习经典赛题：工业蒸汽量预测（5）：模型验证（赛题实战）5.3 模型验证与调参实战5.3.1 模型过拟合与欠拟合5.3.2 模型正则化5.3.3 模型交叉验证5.3.4 模型超参空间及调参5.3.5 学习曲线和验证曲线 参考资料 机器学习经典赛题：工业蒸汽量预测（5）：模型验证（赛题实战） 5.3 模型验证与调参实战 5.3.1 模型过拟合与欠拟合 基础代码
导入工具包，用于模型验证和数据处理。 import numpy as np import pandas as pd import matplotlib.pyplot as plt import seaborn as sns from scipy import stats import warnings warnings.filterwarnings(&#34;ignore&#34;) from sklearn.linear_model import LinearRegression #从sklearn引入线性模型 from sklearn.neighbors import KNeighborsRegressor #k近邻回归模型 from sklearn.tree import DecisionTreeRegressor #决策树回归模型 from sklearn.ensemble import RandomForestRegressor #随机森林回归模型 from sklearn.svm import SVR #支持向量机 from lightgbm import LGBMRegressor #LightGBM回归模型 from sklearn." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/15dfe9519e8e370126654bc07f4cbf2e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-10-15T20:48:25+08:00" />
<meta property="article:modified_time" content="2022-10-15T20:48:25+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【机器学习】阿里云天池竞赛——工业蒸汽量预测（5）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>机器学习经典赛题：工业蒸汽量预测（5）</h4> 
 <ul><li><a href="#5_1" rel="nofollow">机器学习经典赛题：工业蒸汽量预测（5）：模型验证（赛题实战）</a></li><li><ul><li><a href="#53__2" rel="nofollow">5.3 模型验证与调参实战</a></li><li><ul><li><a href="#531__3" rel="nofollow">5.3.1 模型过拟合与欠拟合</a></li><li><a href="#532__132" rel="nofollow">5.3.2 模型正则化</a></li><li><a href="#533__188" rel="nofollow">5.3.3 模型交叉验证</a></li><li><a href="#534__294" rel="nofollow">5.3.4 模型超参空间及调参</a></li><li><a href="#535__419" rel="nofollow">5.3.5 学习曲线和验证曲线</a></li></ul> 
   </li><li><a href="#_507" rel="nofollow">参考资料</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="5_1"></a>机器学习经典赛题：工业蒸汽量预测（5）：模型验证（赛题实战）</h2> 
<h3><a id="53__2"></a>5.3 模型验证与调参实战</h3> 
<h4><a id="531__3"></a>5.3.1 模型过拟合与欠拟合</h4> 
<ol><li>基础代码<br> 导入工具包，用于模型验证和数据处理。</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> seaborn <span class="token keyword">as</span> sns
<span class="token keyword">from</span> scipy <span class="token keyword">import</span> stats
<span class="token keyword">import</span> warnings
warnings<span class="token punctuation">.</span>filterwarnings<span class="token punctuation">(</span><span class="token string">"ignore"</span><span class="token punctuation">)</span>

<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>linear_model <span class="token keyword">import</span> LinearRegression   <span class="token comment">#从sklearn引入线性模型</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>neighbors <span class="token keyword">import</span> KNeighborsRegressor   <span class="token comment">#k近邻回归模型</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>tree <span class="token keyword">import</span> DecisionTreeRegressor     <span class="token comment">#决策树回归模型</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">import</span> RandomForestRegressor    <span class="token comment">#随机森林回归模型</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>svm <span class="token keyword">import</span> SVR    <span class="token comment">#支持向量机</span>
<span class="token keyword">from</span> lightgbm <span class="token keyword">import</span> LGBMRegressor   <span class="token comment">#LightGBM回归模型</span>

<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split <span class="token comment">#切分数据</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> mean_squared_error  <span class="token comment">#评价指标</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>linear_model <span class="token keyword">import</span> SGDRegressor
</code></pre> 
<p>读取数据：</p> 
<pre><code class="prism language-python"><span class="token comment">#读取数据</span>
train_data_file <span class="token operator">=</span> <span class="token string">'../data/zhengqi_train.txt'</span>
test_data_file <span class="token operator">=</span> <span class="token string">'../data/zhengqi_test.txt'</span>
train_data <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>train_data_file<span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">'\t'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
test_data <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>test_data_file<span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">'\t'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
</code></pre> 
<p>对数据进行归一化处理：</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> sklearn <span class="token keyword">import</span> preprocessing

<span class="token comment">#归一化处理</span>
features_columns <span class="token operator">=</span> <span class="token punctuation">[</span>col <span class="token keyword">for</span> col <span class="token keyword">in</span> train_data<span class="token punctuation">.</span>columns <span class="token keyword">if</span> col <span class="token keyword">not</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'target'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
min_max_scaler <span class="token operator">=</span> preprocessing<span class="token punctuation">.</span>MinMaxScaler<span class="token punctuation">(</span><span class="token punctuation">)</span>
min_max_scaler <span class="token operator">=</span> min_max_scaler<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_data<span class="token punctuation">[</span>features_columns<span class="token punctuation">]</span><span class="token punctuation">)</span>

train_data_scaler <span class="token operator">=</span> min_max_scaler<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>train_data<span class="token punctuation">[</span>features_columns<span class="token punctuation">]</span><span class="token punctuation">)</span>
test_data_scaler <span class="token operator">=</span> min_max_scaler<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>test_data<span class="token punctuation">[</span>features_columns<span class="token punctuation">]</span><span class="token punctuation">)</span>

train_data_scaler <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>train_data_scaler<span class="token punctuation">)</span>
train_data_scaler<span class="token punctuation">.</span>columns <span class="token operator">=</span> features_columns

test_data_scaler <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>test_data_scaler<span class="token punctuation">)</span>
test_data_scaler<span class="token punctuation">.</span>columns <span class="token operator">=</span> features_columns
train_data_scaler<span class="token punctuation">[</span><span class="token string">'target'</span><span class="token punctuation">]</span> <span class="token operator">=</span> train_data<span class="token punctuation">[</span><span class="token string">'target'</span><span class="token punctuation">]</span>
</code></pre> 
<p>使用PCA进行特征降维：</p> 
<pre><code class="prism language-python"><span class="token comment">#PCA方法降维</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>decomposition <span class="token keyword">import</span> PCA

<span class="token comment"># 保留16个主成分</span>
pca <span class="token operator">=</span> PCA<span class="token punctuation">(</span>n_components<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
new_train_pca_16 <span class="token operator">=</span> pca<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>train_data_scaler<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
new_test_pca_16 <span class="token operator">=</span> pca<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>test_data_scaler<span class="token punctuation">)</span>
new_train_pca_16 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>new_train_pca_16<span class="token punctuation">)</span>
new_test_pca_16 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>new_test_pca_16<span class="token punctuation">)</span>
new_train_pca_16<span class="token punctuation">[</span><span class="token string">'target'</span><span class="token punctuation">]</span> <span class="token operator">=</span> train_data_scaler<span class="token punctuation">[</span><span class="token string">'target'</span><span class="token punctuation">]</span>
</code></pre> 
<p>切分数据集，分为训练集和验证集：</p> 
<pre><code class="prism language-python"><span class="token comment">#保留16维特征并切分数据</span>
new_train_pca_16 <span class="token operator">=</span> new_train_pca_16<span class="token punctuation">.</span>fillna<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
train <span class="token operator">=</span> new_train_pca_16<span class="token punctuation">[</span>new_train_pca_16<span class="token punctuation">.</span>columns<span class="token punctuation">]</span>
target <span class="token operator">=</span> new_train_pca_16<span class="token punctuation">[</span><span class="token string">'target'</span><span class="token punctuation">]</span>

<span class="token comment">#划分数据集, 训练集80% : 验证机20%</span>
train_data<span class="token punctuation">,</span> test_data<span class="token punctuation">,</span> train_target<span class="token punctuation">,</span> test_target <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>train<span class="token punctuation">,</span> target<span class="token punctuation">,</span>test_size<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<ol start="2"><li>欠拟合<br> 模型欠拟合的情况：</li></ol> 
<pre><code class="prism language-python"><span class="token comment"># 模型欠拟合的情况</span>
clf <span class="token operator">=</span> SGDRegressor<span class="token punctuation">(</span>max_iter<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">,</span> tol<span class="token operator">=</span><span class="token number">1e-2</span><span class="token punctuation">)</span>
clf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_data<span class="token punctuation">,</span> train_target<span class="token punctuation">)</span>
score_train <span class="token operator">=</span> mean_squared_error<span class="token punctuation">(</span>train_target<span class="token punctuation">,</span> clf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>train_data<span class="token punctuation">)</span><span class="token punctuation">)</span>
score_test <span class="token operator">=</span> mean_squared_error<span class="token punctuation">(</span>test_target<span class="token punctuation">,</span> clf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>test_data<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"SGDRegressor train MSE:"</span><span class="token punctuation">,</span> score_train<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"SGDRegressor test MSE:"</span><span class="token punctuation">,</span> score_test<span class="token punctuation">)</span>
</code></pre> 
<p>输出结果：</p> 
<pre><code class="prism language-python">SGDRegressor train MSE<span class="token punctuation">:</span> <span class="token number">0.0009160671723394329</span>
SGDRegressor test MSE<span class="token punctuation">:</span> <span class="token number">0.000981634366517726</span>
</code></pre> 
<ol start="3"><li>过拟合<br> 模型过拟合的情况：</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> PolynomialFeatures

poly <span class="token operator">=</span> PolynomialFeatures<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
train_data_poly <span class="token operator">=</span> poly<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>train_data<span class="token punctuation">)</span>
test_data_poly <span class="token operator">=</span> poly<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>test_data<span class="token punctuation">)</span>
clf <span class="token operator">=</span> SGDRegressor<span class="token punctuation">(</span>max_iter<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span> tol<span class="token operator">=</span><span class="token number">1e-3</span><span class="token punctuation">)</span>
clf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_data_poly<span class="token punctuation">,</span> train_target<span class="token punctuation">)</span>
score_train <span class="token operator">=</span> mean_squared_error<span class="token punctuation">(</span>train_target<span class="token punctuation">,</span> clf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>train_data_poly<span class="token punctuation">)</span><span class="token punctuation">)</span>
score_test <span class="token operator">=</span> mean_squared_error<span class="token punctuation">(</span>test_target<span class="token punctuation">,</span> clf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>test_data_poly<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"SGDRegressor train MSE:"</span><span class="token punctuation">,</span> score_train<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"SGDRegressor test MSE:"</span><span class="token punctuation">,</span> score_test<span class="token punctuation">)</span>
</code></pre> 
<p>输出结果：</p> 
<pre><code class="prism language-python">SGDRegressor train MSE<span class="token punctuation">:</span> <span class="token number">1.0898632608641039e+24</span>
SGDRegressor test MSE<span class="token punctuation">:</span> <span class="token number">1.6982104334110243e+24</span>
</code></pre> 
<ol start="4"><li>正常拟合<br> 模型正常拟合的情况：</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> PolynomialFeatures

poly <span class="token operator">=</span> PolynomialFeatures<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
train_data_poly <span class="token operator">=</span> poly<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>train_data<span class="token punctuation">)</span>
test_data_poly <span class="token operator">=</span> poly<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>test_data<span class="token punctuation">)</span>
clf <span class="token operator">=</span> SGDRegressor<span class="token punctuation">(</span>max_iter<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span> tol<span class="token operator">=</span><span class="token number">1e-3</span><span class="token punctuation">)</span>
clf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_data_poly<span class="token punctuation">,</span> train_target<span class="token punctuation">)</span>
score_train <span class="token operator">=</span> mean_squared_error<span class="token punctuation">(</span>train_target<span class="token punctuation">,</span> clf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>train_data_poly<span class="token punctuation">)</span><span class="token punctuation">)</span>
score_test <span class="token operator">=</span> mean_squared_error<span class="token punctuation">(</span>test_target<span class="token punctuation">,</span> clf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>test_data_poly<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"SGDRegressor train MSE:"</span><span class="token punctuation">,</span> score_train<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"SGDRegressor test MSE:"</span><span class="token punctuation">,</span> score_test<span class="token punctuation">)</span>
</code></pre> 
<p>输出结果：</p> 
<pre><code class="prism language-python">SGDRegressor train MSE<span class="token punctuation">:</span> <span class="token number">0.001055038113307342</span>
SGDRegressor test MSE<span class="token punctuation">:</span> <span class="token number">0.001233821154013793</span>
</code></pre> 
<h4><a id="532__132"></a>5.3.2 模型正则化</h4> 
<ol><li>L2范数正则化<br> 采用L2范数正则化处理模型：</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> PolynomialFeatures

poly <span class="token operator">=</span> PolynomialFeatures<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
train_data_poly <span class="token operator">=</span> poly<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>train_data<span class="token punctuation">)</span>
test_data_poly <span class="token operator">=</span> poly<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>test_data<span class="token punctuation">)</span>
clf <span class="token operator">=</span> SGDRegressor<span class="token punctuation">(</span>max_iter<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span> tol<span class="token operator">=</span><span class="token number">1e-3</span><span class="token punctuation">,</span> penalty<span class="token operator">=</span><span class="token string">'L2'</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.0001</span><span class="token punctuation">)</span>
clf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_data_poly<span class="token punctuation">,</span> train_target<span class="token punctuation">)</span>
score_train <span class="token operator">=</span> mean_squared_error<span class="token punctuation">(</span>train_target<span class="token punctuation">,</span> clf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>train_data_poly<span class="token punctuation">)</span><span class="token punctuation">)</span>
score_test <span class="token operator">=</span> mean_squared_error<span class="token punctuation">(</span>test_target<span class="token punctuation">,</span> clf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>test_data_poly<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"SGDRegressor train MSE:"</span><span class="token punctuation">,</span> score_train<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"SGDRegressor test MSE:"</span><span class="token punctuation">,</span> score_test<span class="token punctuation">)</span>
</code></pre> 
<p>输出结果：</p> 
<pre><code class="prism language-python">SGDRegressor train MSE<span class="token punctuation">:</span> <span class="token number">0.0010417279350570649</span>
SGDRegressor test MSE<span class="token punctuation">:</span> <span class="token number">0.0012885335267450496</span>
</code></pre> 
<ol start="2"><li>L1范数正则化<br> 使用L1范数正则化处理模型</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> PolynomialFeatures

poly <span class="token operator">=</span> PolynomialFeatures<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
train_data_poly <span class="token operator">=</span> poly<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>train_data<span class="token punctuation">)</span>
test_data_poly <span class="token operator">=</span> poly<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>test_data<span class="token punctuation">)</span>
clf <span class="token operator">=</span> SGDRegressor<span class="token punctuation">(</span>max_iter<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span> tol<span class="token operator">=</span><span class="token number">1e-3</span><span class="token punctuation">,</span> penalty<span class="token operator">=</span><span class="token string">'L1'</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.0001</span><span class="token punctuation">)</span>
clf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_data_poly<span class="token punctuation">,</span> train_target<span class="token punctuation">)</span>
score_train <span class="token operator">=</span> mean_squared_error<span class="token punctuation">(</span>train_target<span class="token punctuation">,</span> clf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>train_data_poly<span class="token punctuation">)</span><span class="token punctuation">)</span>
score_test <span class="token operator">=</span> mean_squared_error<span class="token punctuation">(</span>test_target<span class="token punctuation">,</span> clf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>test_data_poly<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"SGDRegressor train MSE:"</span><span class="token punctuation">,</span> score_train<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"SGDRegressor test MSE:"</span><span class="token punctuation">,</span> score_test<span class="token punctuation">)</span>
</code></pre> 
<ol start="3"><li>ElasticNet联合L1和L2范数加权正则化<br> 使用ElasticNet正则化处理模型：</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> PolynomialFeatures

poly <span class="token operator">=</span> PolynomialFeatures<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
train_data_poly <span class="token operator">=</span> poly<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>train_data<span class="token punctuation">)</span>
test_data_poly <span class="token operator">=</span> poly<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>test_data<span class="token punctuation">)</span>
clf <span class="token operator">=</span> SGDRegressor<span class="token punctuation">(</span>max_iter<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span> tol<span class="token operator">=</span><span class="token number">1e-3</span><span class="token punctuation">,</span> penalty<span class="token operator">=</span><span class="token string">'elasticnet'</span><span class="token punctuation">,</span> l1_ratio<span class="token operator">=</span><span class="token number">0.9</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">.0001</span><span class="token punctuation">)</span>
clf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_data_poly<span class="token punctuation">,</span> train_target<span class="token punctuation">)</span>
score_train <span class="token operator">=</span> mean_squared_error<span class="token punctuation">(</span>train_target<span class="token punctuation">,</span> clf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>train_data_poly<span class="token punctuation">)</span><span class="token punctuation">)</span>
score_test <span class="token operator">=</span> mean_squared_error<span class="token punctuation">(</span>test_target<span class="token punctuation">,</span> clf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>test_data_poly<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"SGDRegressor train MSE:"</span><span class="token punctuation">,</span> score_train<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"SGDRegressor test MSE:"</span><span class="token punctuation">,</span> score_test<span class="token punctuation">)</span>
</code></pre> 
<p>输出结果：</p> 
<pre><code class="prism language-python">SGDRegressor train MSE<span class="token punctuation">:</span> <span class="token number">0.0009336657359501396</span>
SGDRegressor test MSE<span class="token punctuation">:</span> <span class="token number">0.0011472413880708912</span>
</code></pre> 
<h4><a id="533__188"></a>5.3.3 模型交叉验证</h4> 
<ol><li>简单交叉验证<br> 使用简单交叉验证方法对模型进行交叉验证并切分数据集，其中训练数据为80%，验证数据为20%。</li></ol> 
<pre><code class="prism language-python"><span class="token comment">#划分数据集, 训练集80% : 验证机20%</span>
train_data<span class="token punctuation">,</span> test_data<span class="token punctuation">,</span> train_target<span class="token punctuation">,</span> test_target <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>train<span class="token punctuation">,</span> target<span class="token punctuation">,</span>test_size<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>

clf <span class="token operator">=</span> SGDRegressor<span class="token punctuation">(</span>max_iter<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span> tol<span class="token operator">=</span><span class="token number">1e-3</span><span class="token punctuation">)</span>
clf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_data<span class="token punctuation">,</span> train_target<span class="token punctuation">)</span>
score_train <span class="token operator">=</span> mean_squared_error<span class="token punctuation">(</span>train_target<span class="token punctuation">,</span> clf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>train_data<span class="token punctuation">)</span><span class="token punctuation">)</span>
score_test <span class="token operator">=</span> mean_squared_error<span class="token punctuation">(</span>test_target<span class="token punctuation">,</span> clf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>test_data<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"SGDRegressor train MSE:"</span><span class="token punctuation">,</span> score_train<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"SGDRegressor test MSE:"</span><span class="token punctuation">,</span> score_test<span class="token punctuation">)</span>
</code></pre> 
<p>输出结果：</p> 
<pre><code class="prism language-python">SGDRegressor train MSE<span class="token punctuation">:</span> <span class="token number">0.0008805332436144762</span>
SGDRegressor test MSE<span class="token punctuation">:</span> <span class="token number">0.0009742019879530982</span>
</code></pre> 
<ol start="2"><li>K折交叉验证<br> 使用K折交叉验证方法对模型进行交叉验证：</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> KFold

kf <span class="token operator">=</span> KFold<span class="token punctuation">(</span>n_splits<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> k<span class="token punctuation">,</span> <span class="token punctuation">(</span>train_index<span class="token punctuation">,</span> test_index<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>kf<span class="token punctuation">.</span>split<span class="token punctuation">(</span>train<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    train_data<span class="token punctuation">,</span> test_data<span class="token punctuation">,</span> train_target<span class="token punctuation">,</span> test_target <span class="token operator">=</span> train<span class="token punctuation">.</span>values<span class="token punctuation">[</span>train_index<span class="token punctuation">]</span><span class="token punctuation">,</span> train<span class="token punctuation">.</span>values<span class="token punctuation">[</span>test_index<span class="token punctuation">]</span><span class="token punctuation">,</span> target<span class="token punctuation">[</span>
        train_index<span class="token punctuation">]</span><span class="token punctuation">,</span> target<span class="token punctuation">[</span>test_index<span class="token punctuation">]</span>
    clf <span class="token operator">=</span> SGDRegressor<span class="token punctuation">(</span>max_iter<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span> tol<span class="token operator">=</span><span class="token number">1e-3</span><span class="token punctuation">)</span>
    clf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_data<span class="token punctuation">,</span> train_target<span class="token punctuation">)</span>
    score_train <span class="token operator">=</span> mean_squared_error<span class="token punctuation">(</span>train_target<span class="token punctuation">,</span> clf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>train_data<span class="token punctuation">)</span><span class="token punctuation">)</span>
    score_test <span class="token operator">=</span> mean_squared_error<span class="token punctuation">(</span>test_target<span class="token punctuation">,</span> clf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>test_data<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> <span class="token string">"折"</span><span class="token punctuation">,</span> <span class="token string">"SGDRegressor train MSE:"</span><span class="token punctuation">,</span> score_train<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> <span class="token string">"折"</span><span class="token punctuation">,</span> <span class="token string">"SGDRegressor test MSE:"</span><span class="token punctuation">,</span> score_test<span class="token punctuation">,</span> <span class="token string">"\n"</span><span class="token punctuation">)</span>
</code></pre> 
<p>运行结果：</p> 
<pre><code class="prism language-python"><span class="token number">0</span> 折 SGDRegressor train MSE<span class="token punctuation">:</span> <span class="token number">0.0009220591043969376</span>
<span class="token number">0</span> 折 SGDRegressor test MSE<span class="token punctuation">:</span> <span class="token number">0.0005310778285509602</span> 

<span class="token number">1</span> 折 SGDRegressor train MSE<span class="token punctuation">:</span> <span class="token number">0.0008800234249554588</span>
<span class="token number">1</span> 折 SGDRegressor test MSE<span class="token punctuation">:</span> <span class="token number">0.001259968578517734</span> 

<span class="token number">2</span> 折 SGDRegressor train MSE<span class="token punctuation">:</span> <span class="token number">0.0008211966326584619</span>
<span class="token number">2</span> 折 SGDRegressor test MSE<span class="token punctuation">:</span> <span class="token number">0.0009107924815045727</span> 

<span class="token number">3</span> 折 SGDRegressor train MSE<span class="token punctuation">:</span> <span class="token number">0.0009456226800574005</span>
<span class="token number">3</span> 折 SGDRegressor test MSE<span class="token punctuation">:</span> <span class="token number">0.0009853654948970164</span> 

<span class="token number">4</span> 折 SGDRegressor train MSE<span class="token punctuation">:</span> <span class="token number">0.0009055864978733344</span>
<span class="token number">4</span> 折 SGDRegressor test MSE<span class="token punctuation">:</span> <span class="token number">0.0011048017616418345</span> 
</code></pre> 
<ol start="3"><li>留一法交叉验证<br> 使用留一法交叉验证对模型进行交叉验证：</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> LeaveOneOut

loo <span class="token operator">=</span> LeaveOneOut<span class="token punctuation">(</span><span class="token punctuation">)</span>
num <span class="token operator">=</span> <span class="token number">100</span>
<span class="token keyword">for</span> k<span class="token punctuation">,</span> <span class="token punctuation">(</span>train_index<span class="token punctuation">,</span> test_index<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>loo<span class="token punctuation">.</span>split<span class="token punctuation">(</span>train<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    train_data<span class="token punctuation">,</span> test_data<span class="token punctuation">,</span> train_target<span class="token punctuation">,</span> test_target <span class="token operator">=</span> train<span class="token punctuation">.</span>values<span class="token punctuation">[</span>train_index<span class="token punctuation">]</span><span class="token punctuation">,</span> train<span class="token punctuation">.</span>values<span class="token punctuation">[</span>test_index<span class="token punctuation">]</span><span class="token punctuation">,</span> target<span class="token punctuation">[</span>
        train_index<span class="token punctuation">]</span><span class="token punctuation">,</span> target<span class="token punctuation">[</span>test_index<span class="token punctuation">]</span>
    clf <span class="token operator">=</span> SGDRegressor<span class="token punctuation">(</span>max_iter<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span> tol<span class="token operator">=</span><span class="token number">1e-3</span><span class="token punctuation">)</span>
    clf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_data<span class="token punctuation">,</span> train_target<span class="token punctuation">)</span>
    score_train <span class="token operator">=</span> mean_squared_error<span class="token punctuation">(</span>train_target<span class="token punctuation">,</span> clf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>train_data<span class="token punctuation">)</span><span class="token punctuation">)</span>
    score_test <span class="token operator">=</span> mean_squared_error<span class="token punctuation">(</span>test_target<span class="token punctuation">,</span> clf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>test_data<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> <span class="token string">"个"</span><span class="token punctuation">,</span> <span class="token string">"SGDRegressor train MSE:"</span><span class="token punctuation">,</span> score_train<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> <span class="token string">"个"</span><span class="token punctuation">,</span> <span class="token string">"SGDRegressor test MSE:"</span><span class="token punctuation">,</span> score_test<span class="token punctuation">,</span> <span class="token string">"\n"</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> k <span class="token operator">&gt;=</span> <span class="token number">9</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>
</code></pre> 
<p>运行结果：</p> 
<pre><code class="prism language-python"><span class="token number">0</span> 个 SGDRegressor train MSE<span class="token punctuation">:</span> <span class="token number">0.0007447292899787238</span>
<span class="token number">0</span> 个 SGDRegressor test MSE<span class="token punctuation">:</span> <span class="token number">5.2599252754080336e-05</span> 
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">9</span> 个 SGDRegressor train MSE<span class="token punctuation">:</span> <span class="token number">0.0007887842650802939</span>
<span class="token number">9</span> 个 SGDRegressor test MSE<span class="token punctuation">:</span> <span class="token number">0.0005482147049830396</span> 
</code></pre> 
<ol start="4"><li>留P法交叉验证<br> 使用留P法交叉验证对模型进行交叉验证：</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> LeavePOut

lpo <span class="token operator">=</span> LeavePOut<span class="token punctuation">(</span>p<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
num <span class="token operator">=</span> <span class="token number">100</span>
<span class="token keyword">for</span> k<span class="token punctuation">,</span> <span class="token punctuation">(</span>train_index<span class="token punctuation">,</span> test_index<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>lpo<span class="token punctuation">.</span>split<span class="token punctuation">(</span>train<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    train_data<span class="token punctuation">,</span> test_data<span class="token punctuation">,</span> train_target<span class="token punctuation">,</span> test_target <span class="token operator">=</span> train<span class="token punctuation">.</span>values<span class="token punctuation">[</span>train_index<span class="token punctuation">]</span><span class="token punctuation">,</span> train<span class="token punctuation">.</span>values<span class="token punctuation">[</span>test_index<span class="token punctuation">]</span><span class="token punctuation">,</span> target<span class="token punctuation">[</span>
        train_index<span class="token punctuation">]</span><span class="token punctuation">,</span> target<span class="token punctuation">[</span>test_index<span class="token punctuation">]</span>
    clf <span class="token operator">=</span> SGDRegressor<span class="token punctuation">(</span>max_iter<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span> tol<span class="token operator">=</span><span class="token number">1e-3</span><span class="token punctuation">)</span>
    clf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_data<span class="token punctuation">,</span> train_target<span class="token punctuation">)</span>
    score_train <span class="token operator">=</span> mean_squared_error<span class="token punctuation">(</span>train_target<span class="token punctuation">,</span> clf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>train_data<span class="token punctuation">)</span><span class="token punctuation">)</span>
    score_test <span class="token operator">=</span> mean_squared_error<span class="token punctuation">(</span>test_target<span class="token punctuation">,</span> clf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>test_data<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> <span class="token string">"10个"</span><span class="token punctuation">,</span> <span class="token string">"SGDRegressor train MSE:"</span><span class="token punctuation">,</span> score_train<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> <span class="token string">"10个"</span><span class="token punctuation">,</span> <span class="token string">"SGDRegressor test MSE:"</span><span class="token punctuation">,</span> score_test<span class="token punctuation">,</span> <span class="token string">"\n"</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> k <span class="token operator">&gt;=</span> <span class="token number">9</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>
</code></pre> 
<p>运行结果：</p> 
<pre><code class="prism language-python"><span class="token number">0</span> <span class="token number">10</span>个 SGDRegressor train MSE<span class="token punctuation">:</span> <span class="token number">0.0007482296929583594</span>
<span class="token number">0</span> <span class="token number">10</span>个 SGDRegressor test MSE<span class="token punctuation">:</span> <span class="token number">0.00029421354601069736</span> 
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">9</span> <span class="token number">10</span>个 SGDRegressor train MSE<span class="token punctuation">:</span> <span class="token number">0.0008062741989626481</span>
<span class="token number">9</span> <span class="token number">10</span>个 SGDRegressor test MSE<span class="token punctuation">:</span> <span class="token number">0.00023679186419471267</span> 
</code></pre> 
<h4><a id="534__294"></a>5.3.4 模型超参空间及调参</h4> 
<ol><li>穷举网格搜索<br> 使用数据训练随机森林模型，采用网格搜索方法调参：</li></ol> 
<pre><code class="prism language-python"><span class="token comment">#使用数据训练随机森林模型，采用穷举网格搜索方法调参</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> GridSearchCV
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">import</span> RandomForestRegressor

RandomForestRegressor <span class="token operator">=</span> RandomForestRegressor<span class="token punctuation">(</span><span class="token punctuation">)</span>
parameters <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'n_estimators'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'max_depth'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
clf <span class="token operator">=</span> GridSearchCV<span class="token punctuation">(</span>RandomForestRegressor<span class="token punctuation">,</span> parameters<span class="token punctuation">,</span> cv<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
clf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_data<span class="token punctuation">,</span> train_target<span class="token punctuation">)</span>
score_test <span class="token operator">=</span> mean_squared_error<span class="token punctuation">(</span>test_target<span class="token punctuation">,</span> clf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>test_data<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"RandomForestRegressor GridSearchCV test MSE:"</span><span class="token punctuation">,</span> score_test<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">sorted</span><span class="token punctuation">(</span>clf<span class="token punctuation">.</span>cv_results_<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">#包含训练时间和验证指标的一些信息</span>
</code></pre> 
<p>运行结果：</p> 
<pre><code class="prism language-python">RandomForestRegressor GridSearchCV test MSE<span class="token punctuation">:</span> <span class="token number">0.012637546435789914</span>
<span class="token punctuation">[</span><span class="token string">'mean_fit_time'</span><span class="token punctuation">,</span> <span class="token string">'mean_score_time'</span><span class="token punctuation">,</span> <span class="token string">'mean_test_score'</span><span class="token punctuation">,</span> <span class="token string">'param_max_depth'</span><span class="token punctuation">,</span> <span class="token string">'param_n_estimators'</span><span class="token punctuation">,</span> <span class="token string">'params'</span><span class="token punctuation">,</span> <span class="token string">'rank_test_score'</span><span class="token punctuation">,</span> <span class="token string">'split0_test_score'</span><span class="token punctuation">,</span> <span class="token string">'split1_test_score'</span><span class="token punctuation">,</span> <span class="token string">'split2_test_score'</span><span class="token punctuation">,</span> <span class="token string">'split3_test_score'</span><span class="token punctuation">,</span> <span class="token string">'split4_test_score'</span><span class="token punctuation">,</span> <span class="token string">'std_fit_time'</span><span class="token punctuation">,</span> <span class="token string">'std_score_time'</span><span class="token punctuation">,</span> <span class="token string">'std_test_score'</span><span class="token punctuation">]</span>
</code></pre> 
<ol start="2"><li>随机参数优化<br> 使用数据训练随机森林模型，采用随机参数优化方法调参：</li></ol> 
<pre><code class="prism language-python"><span class="token comment">#使用数据训练随机森林模型，采用随即参数优化方法调参</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> RandomizedSearchCV
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">import</span> RandomForestRegressor

RandomForestRegressor <span class="token operator">=</span> RandomForestRegressor<span class="token punctuation">(</span><span class="token punctuation">)</span>
parameters <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'n_estimators'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'max_depth'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
clf <span class="token operator">=</span> RandomizedSearchCV<span class="token punctuation">(</span>RandomForestRegressor<span class="token punctuation">,</span> parameters<span class="token punctuation">,</span> cv<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
clf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_data<span class="token punctuation">,</span> train_target<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Best parameters found are:'</span><span class="token punctuation">,</span> clf<span class="token punctuation">.</span>best_params_<span class="token punctuation">)</span>
score_test <span class="token operator">=</span> mean_squared_error<span class="token punctuation">(</span>test_target<span class="token punctuation">,</span> clf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>test_data<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"RandomForestRegressor RandomizedSearchCV GridSearchCV test MSE:"</span><span class="token punctuation">,</span> score_test<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">sorted</span><span class="token punctuation">(</span>clf<span class="token punctuation">.</span>cv_results_<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">#包含训练时间和验证指标的一些信息</span>
</code></pre> 
<p>运行结果：</p> 
<pre><code class="prism language-python">Best parameters found are<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'n_estimators'</span><span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token string">'max_depth'</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">}</span>
RandomForestRegressor RandomizedSearchCV GridSearchCV test MSE<span class="token punctuation">:</span> <span class="token number">8.52446793094484e-05</span>
<span class="token punctuation">[</span><span class="token string">'mean_fit_time'</span><span class="token punctuation">,</span> <span class="token string">'mean_score_time'</span><span class="token punctuation">,</span> <span class="token string">'mean_test_score'</span><span class="token punctuation">,</span> <span class="token string">'param_max_depth'</span><span class="token punctuation">,</span> <span class="token string">'param_n_estimators'</span><span class="token punctuation">,</span> <span class="token string">'params'</span><span class="token punctuation">,</span> <span class="token string">'rank_test_score'</span><span class="token punctuation">,</span> <span class="token string">'split0_test_score'</span><span class="token punctuation">,</span> <span class="token string">'split1_test_score'</span><span class="token punctuation">,</span> <span class="token string">'split2_test_score'</span><span class="token punctuation">,</span> <span class="token string">'split3_test_score'</span><span class="token punctuation">,</span> <span class="token string">'split4_test_score'</span><span class="token punctuation">,</span> <span class="token string">'std_fit_time'</span><span class="token punctuation">,</span> <span class="token string">'std_score_time'</span><span class="token punctuation">,</span> <span class="token string">'std_test_score'</span><span class="token punctuation">]</span>
</code></pre> 
<ol start="3"><li>LGB调参<br> 使用数据训练LGB模型，采用网格搜索方法调参：</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">import</span> lightgbm <span class="token keyword">as</span> lgb

clf <span class="token operator">=</span> lgb<span class="token punctuation">.</span>LGBMRegressor<span class="token punctuation">(</span>num_leaves<span class="token operator">=</span><span class="token number">31</span><span class="token punctuation">)</span>
parameters <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'learning_rate'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.01</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'n_estimators'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
clf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_data<span class="token punctuation">,</span> train_target<span class="token punctuation">)</span>

score_test <span class="token operator">=</span> mean_squared_error<span class="token punctuation">(</span>test_target<span class="token punctuation">,</span> clf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>test_data<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"LGBMRegressor GridSearchCV test MSE:"</span><span class="token punctuation">,</span> score_test<span class="token punctuation">)</span>
<span class="token comment"># LGBMRegressor GridSearchCV test MSE: 1.560809562908417e-05</span>
</code></pre> 
<ol start="4"><li>LGB线下验证<br> 下面给出对数据建模、5折交叉验证、划分数据、对LGB模型进行训练、计算MSE评价性能等流程的代码：</li></ol> 
<pre><code class="prism language-python"><span class="token comment"># 加载数据</span>
train_data2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'../data/zhengqi_train.txt'</span><span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">'\t'</span><span class="token punctuation">)</span>
test_data2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'../data/zhengqi_test.txt'</span><span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">'\t'</span><span class="token punctuation">)</span>

train_data2_f <span class="token operator">=</span> train_data2<span class="token punctuation">[</span>test_data2<span class="token punctuation">.</span>columns<span class="token punctuation">]</span><span class="token punctuation">.</span>values
train_data2_target <span class="token operator">=</span> train_data2<span class="token punctuation">[</span><span class="token string">'target'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values

<span class="token comment"># lgb 模型</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> KFold
<span class="token keyword">import</span> lightgbm <span class="token keyword">as</span> lgb
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

<span class="token comment"># 5折交叉验证</span>
Folds <span class="token operator">=</span> <span class="token number">5</span>
kf <span class="token operator">=</span> KFold<span class="token punctuation">(</span>n_splits<span class="token operator">=</span>Folds<span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">2022</span><span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token comment"># 记录训练和预测MSE</span>
MSE_DICT <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'train_mse'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'test_mse'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token comment"># 线下训练预测</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span> <span class="token punctuation">(</span>train_index<span class="token punctuation">,</span> test_index<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>kf<span class="token punctuation">.</span>split<span class="token punctuation">(</span>train_data2_f<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># lgb树模型</span>
    lgb_reg <span class="token operator">=</span> lgb<span class="token punctuation">.</span>LGBMRegressor<span class="token punctuation">(</span>
        learning_rate<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">,</span>
        max_depth<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
        n_estimators<span class="token operator">=</span><span class="token number">5000</span><span class="token punctuation">,</span>
        boosting_type<span class="token operator">=</span><span class="token string">'gbdt'</span><span class="token punctuation">,</span>
        random_state<span class="token operator">=</span><span class="token number">2022</span><span class="token punctuation">,</span>
        objective<span class="token operator">=</span><span class="token string">'regression'</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>

    <span class="token comment"># 切分训练集和预测集</span>
    X_train_KFold<span class="token punctuation">,</span> X_test_KFold <span class="token operator">=</span> train_data2_f<span class="token punctuation">[</span>train_index<span class="token punctuation">]</span><span class="token punctuation">,</span> train_data2_f<span class="token punctuation">[</span>test_index<span class="token punctuation">]</span>
    y_train_KFold<span class="token punctuation">,</span> y_test_KFold <span class="token operator">=</span> train_data2_target<span class="token punctuation">[</span>train_index<span class="token punctuation">]</span><span class="token punctuation">,</span> train_data2_target<span class="token punctuation">[</span>test_index<span class="token punctuation">]</span>

    <span class="token comment"># 训练模型</span>
    <span class="token comment">#     reg.fit(X_train_KFold, y_train_KFold)</span>
    lgb_reg<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>
        X<span class="token operator">=</span>X_train_KFold<span class="token punctuation">,</span> y<span class="token operator">=</span>y_train_KFold<span class="token punctuation">,</span>
        eval_set<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">(</span>X_train_KFold<span class="token punctuation">,</span> y_train_KFold<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>X_test_KFold<span class="token punctuation">,</span> y_test_KFold<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        eval_names<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Train'</span><span class="token punctuation">,</span> <span class="token string">'Test'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        early_stopping_rounds<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span>
        eval_metric<span class="token operator">=</span><span class="token string">'MSE'</span><span class="token punctuation">,</span>
        verbose<span class="token operator">=</span><span class="token number">50</span>
    <span class="token punctuation">)</span>

    <span class="token comment"># 训练集预测 测试集预测</span>
    y_train_KFold_predict <span class="token operator">=</span> lgb_reg<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_train_KFold<span class="token punctuation">,</span> num_iteration<span class="token operator">=</span>lgb_reg<span class="token punctuation">.</span>best_iteration_<span class="token punctuation">)</span>
    y_test_KFold_predict <span class="token operator">=</span> lgb_reg<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test_KFold<span class="token punctuation">,</span> num_iteration<span class="token operator">=</span>lgb_reg<span class="token punctuation">.</span>best_iteration_<span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'第{}折 训练和预测 训练MSE 预测MSE'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    train_mse <span class="token operator">=</span> mean_squared_error<span class="token punctuation">(</span>y_train_KFold_predict<span class="token punctuation">,</span> y_train_KFold<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'------\n'</span><span class="token punctuation">,</span> <span class="token string">'训练MSE\n'</span><span class="token punctuation">,</span> train_mse<span class="token punctuation">,</span> <span class="token string">'\n------'</span><span class="token punctuation">)</span>
    test_mse <span class="token operator">=</span> mean_squared_error<span class="token punctuation">(</span>y_test_KFold_predict<span class="token punctuation">,</span> y_test_KFold<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'------\n'</span><span class="token punctuation">,</span> <span class="token string">'预测MSE\n'</span><span class="token punctuation">,</span> test_mse<span class="token punctuation">,</span> <span class="token string">'\n------\n'</span><span class="token punctuation">)</span>

    MSE_DICT<span class="token punctuation">[</span><span class="token string">'train_mse'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>train_mse<span class="token punctuation">)</span>
    MSE_DICT<span class="token punctuation">[</span><span class="token string">'test_mse'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>test_mse<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'------\n'</span><span class="token punctuation">,</span> <span class="token string">'训练MSE\n'</span><span class="token punctuation">,</span> MSE_DICT<span class="token punctuation">[</span><span class="token string">'train_mse'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'\n'</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>MSE_DICT<span class="token punctuation">[</span><span class="token string">'train_mse'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'\n------'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'------\n'</span><span class="token punctuation">,</span> <span class="token string">'预测MSE\n'</span><span class="token punctuation">,</span> MSE_DICT<span class="token punctuation">[</span><span class="token string">'test_mse'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'\n'</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>MSE_DICT<span class="token punctuation">[</span><span class="token string">'test_mse'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'\n------'</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="535__419"></a>5.3.5 学习曲线和验证曲线</h4> 
<ol><li>学习曲线<br> 绘制数据的学习曲线，使用模型SGDRegressor</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> ShuffleSplit
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>linear_model <span class="token keyword">import</span> SGDRegressor
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> learning_curve

train_data_file <span class="token operator">=</span> <span class="token string">"../data/zhengqi_train.txt"</span>
test_data_file <span class="token operator">=</span> <span class="token string">"../data/zhengqi_test.txt"</span>
train_data <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>train_data_file<span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">'\t'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
test_data <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>test_data_file<span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">'\t'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dpi<span class="token operator">=</span><span class="token number">150</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">plot_learning_curve</span><span class="token punctuation">(</span>estimator<span class="token punctuation">,</span> title<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> ylim<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> cv<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> n_jobs<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> train_sizes<span class="token operator">=</span>np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token number">.1</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span>title<span class="token punctuation">)</span>
    <span class="token keyword">if</span> ylim <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        plt<span class="token punctuation">.</span>ylim<span class="token punctuation">(</span><span class="token operator">*</span>ylim<span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">"Training examples"</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">"Score"</span><span class="token punctuation">)</span>
    train_sizes<span class="token punctuation">,</span> train_scores<span class="token punctuation">,</span> test_scores <span class="token operator">=</span> learning_curve<span class="token punctuation">(</span>estimator<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> cv<span class="token operator">=</span>cv<span class="token punctuation">,</span> n_jobs<span class="token operator">=</span>n_jobs<span class="token punctuation">,</span>
                                                            train_sizes<span class="token operator">=</span>train_sizes<span class="token punctuation">)</span>
    train_scores_mean <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>train_scores<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
    train_scores_std <span class="token operator">=</span> np<span class="token punctuation">.</span>std<span class="token punctuation">(</span>train_scores<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
    test_scores_mean <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>test_scores<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
    test_scores_std <span class="token operator">=</span> np<span class="token punctuation">.</span>std<span class="token punctuation">(</span>test_scores<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>grid<span class="token punctuation">(</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>fill_between<span class="token punctuation">(</span>train_sizes<span class="token punctuation">,</span> train_scores_mean <span class="token operator">-</span> train_scores_std<span class="token punctuation">,</span> train_scores_mean <span class="token operator">+</span> train_scores_std<span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span>
                     color<span class="token operator">=</span><span class="token string">'r'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>fill_between<span class="token punctuation">(</span>train_sizes<span class="token punctuation">,</span> test_scores_mean <span class="token operator">-</span> test_scores_std<span class="token punctuation">,</span> test_scores_mean <span class="token operator">+</span> test_scores_std<span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span>
                     color<span class="token operator">=</span><span class="token string">'g'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>train_sizes<span class="token punctuation">,</span> train_scores_mean<span class="token punctuation">,</span> <span class="token string">'o-'</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'r'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"training score"</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>train_sizes<span class="token punctuation">,</span> test_scores_mean<span class="token punctuation">,</span> <span class="token string">'o-'</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'g'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"corss-validation score"</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span>loc<span class="token operator">=</span><span class="token string">"best"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> plt


x <span class="token operator">=</span> train_data<span class="token punctuation">[</span>test_data<span class="token punctuation">.</span>columns<span class="token punctuation">]</span><span class="token punctuation">.</span>values
y <span class="token operator">=</span> train_data<span class="token punctuation">[</span><span class="token string">'target'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values
title <span class="token operator">=</span> <span class="token string">"LinearRegression"</span>
cv <span class="token operator">=</span> ShuffleSplit<span class="token punctuation">(</span>n_splits<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
estimator <span class="token operator">=</span> SGDRegressor<span class="token punctuation">(</span><span class="token punctuation">)</span>
plot_learning_curve<span class="token punctuation">(</span>estimator<span class="token punctuation">,</span> title<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> ylim<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token number">1.01</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv<span class="token operator">=</span>cv<span class="token punctuation">,</span> n_jobs<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/57/81/3B62Htyp_o.png" alt="学习曲线"><br> 2. 验证曲线</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>linear_model <span class="token keyword">import</span> SGDRegressor
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> validation_curve

train_data_file <span class="token operator">=</span> <span class="token string">"../data/zhengqi_train.txt"</span>
test_data_file <span class="token operator">=</span> <span class="token string">"../data/zhengqi_test.txt"</span>
train_data <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>train_data_file<span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">'\t'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
test_data <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>test_data_file<span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">'\t'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
x <span class="token operator">=</span> train_data<span class="token punctuation">[</span>test_data<span class="token punctuation">.</span>columns<span class="token punctuation">]</span><span class="token punctuation">.</span>values
y <span class="token operator">=</span> train_data<span class="token punctuation">[</span><span class="token string">'target'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values

param_range <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.01</span><span class="token punctuation">,</span> <span class="token number">0.001</span><span class="token punctuation">,</span> <span class="token number">0.0001</span><span class="token punctuation">,</span> <span class="token number">0.00001</span><span class="token punctuation">,</span> <span class="token number">0.000001</span><span class="token punctuation">]</span>
train_scores<span class="token punctuation">,</span> test_scores <span class="token operator">=</span> validation_curve<span class="token punctuation">(</span>SGDRegressor<span class="token punctuation">(</span>max_iter<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span> tol<span class="token operator">=</span><span class="token number">1e-3</span><span class="token punctuation">,</span> penalty<span class="token operator">=</span><span class="token string">'L1'</span><span class="token punctuation">)</span>
                                             <span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> param_name<span class="token operator">=</span><span class="token string">'alpha'</span><span class="token punctuation">,</span> param_range<span class="token operator">=</span>param_range<span class="token punctuation">,</span>
                                             cv<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> scoring<span class="token operator">=</span><span class="token string">'r2'</span><span class="token punctuation">,</span> n_jobs<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
train_scores_mean <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>train_scores<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
train_scores_std <span class="token operator">=</span> np<span class="token punctuation">.</span>std<span class="token punctuation">(</span>train_scores<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
test_scores_mean <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>test_scores<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
test_scores_std <span class="token operator">=</span> np<span class="token punctuation">.</span>std<span class="token punctuation">(</span>test_scores<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"Validation Curve with SCDRegressor"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">"alpha"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">"Score"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylim<span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.1</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>semilogx<span class="token punctuation">(</span>param_range<span class="token punctuation">,</span> train_scores_mean<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"Training scores"</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'r'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>fill_between<span class="token punctuation">(</span>param_range<span class="token punctuation">,</span> train_scores_mean <span class="token operator">-</span> train_scores_std<span class="token punctuation">,</span> train_scores_mean <span class="token operator">+</span> train_scores_std<span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span>
                 color<span class="token operator">=</span><span class="token string">'r'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>semilogx<span class="token punctuation">(</span>param_range<span class="token punctuation">,</span> test_scores_mean<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"Sross_validation score"</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'g'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>fill_between<span class="token punctuation">(</span>param_range<span class="token punctuation">,</span> train_scores_mean <span class="token operator">-</span> train_scores_std<span class="token punctuation">,</span> train_scores_mean <span class="token operator">+</span> train_scores_std<span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span>
                 color<span class="token operator">=</span><span class="token string">'g'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span>loc<span class="token operator">=</span><span class="token string">"best"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/56/c5/1Z4ZGga8_o.png" alt="验证曲线"></p> 
<h3><a id="_507"></a>参考资料</h3> 
<p>[1] 《阿里云天池大赛赛题解析——机器学习篇》</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/95b29053ddfd735630586bba1aaf8d41/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">(附源码)计算机毕业设计高校学生网上请假系统</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ddf529ef331de5f282bd44bb81c26501/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Xshell显示找不到匹配的outgoing encryption算法怎么解决</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>