<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Keepalived工具安装 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Keepalived工具安装" />
<meta property="og:description" content="装keepalived前，要先检查主机上是否已经安装， ps -ef | grep keepalive 不检查的话，容易把前人装的东西覆盖掉，那么以前弄的配置文件都没了比较麻烦。 以下都为root用户 root用户上传工具，压缩包就200多k，不大。 cd &amp;&amp; mkdir fwy &amp;&amp; chmod 777 fwy &amp;&amp; cd fwy scp padba@cnsz081003:/paic/dba/dbsoft/mysql/keepalived-1.1.19.tar.gz . 密码MdCg2014 tar xvf keepalived-1.1.19.tar.gz mv keepalived-1.1.19 .. 安装OpenSSL [root@cnsh042942 fwy]# yum install openssl-devel Loaded plugins: product-id, security, subscription-manager This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register. el6_u5_base | 1.2 kB 00:00 Setting up Install Process Package openssl-devel-1.0.1e-15.el6.x86_64 already installed and latest version Nothing to do 编译并安装 mv /root/fwy/keepalived-1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/9961bf848485416b8e8d98cdba177fbb/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2014-04-26T19:33:53+08:00" />
<meta property="article:modified_time" content="2014-04-26T19:33:53+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Keepalived工具安装</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px"><span style="color:#e60013; background-color:inherit">装keepalived前，要先检查主机上是否已经安装，</span></span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px">ps -ef | grep keepalive</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px">不检查的话，容易把前人装的东西覆盖掉，那么以前弄的配置文件都没了比较麻烦。</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px"><br style="background-color:inherit"> </span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px"></span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px"></span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px"><span style="color:#e60013; background-color:inherit">以下都为root用户</span></span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px"><span style="color:#e60013; background-color:inherit">root用户上传工具，压缩包就200多k，不大。</span></span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px">cd &amp;&amp; mkdir fwy &amp;&amp; chmod 777 fwy &amp;&amp; cd fwy</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px">scp padba@cnsz081003:/paic/dba/dbsoft/mysql/keepalived-1.1.19.tar.gz .</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit">密码MdCg2014</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px"></span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px">tar xvf keepalived-1.1.19.tar.gz</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px">mv keepalived-1.1.19 ..</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px"><br style="background-color:inherit"> </span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <div style="background-color:inherit"> 
  <span style="background-color:inherit; font-family:宋体; font-size:10.5pt"><span style="color:#e60013; background-color:inherit">安装<span lang="EN-US" style="background-color:inherit">OpenSSL</span></span></span> 
 </div> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px">[root@cnsh042942 fwy]# yum install openssl-devel</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191); font-size:14px">Loaded plugins: product-id, security, subscription-manager</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191); font-size:14px">This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191); font-size:14px">el6_u5_base | 1.2 kB 00:00</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191); font-size:14px">Setting up Install Process</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191); font-size:14px">Package openssl-devel-1.0.1e-15.el6.x86_64 already installed and latest version</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191); font-size:14px">Nothing to do</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191); font-size:14px"><br style="background-color:inherit"> </span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px"></span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px"></span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px"><span style="color:#e60013; background-color:inherit">编译并安装</span></span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px">mv /root/fwy/keepalived-1.1.19 /root</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px">cd /root/keepalived-1.1.19</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px">./configure</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px">make &amp;&amp; make install</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px"><br style="background-color:inherit"> </span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px"></span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px"><span style="color:#e60013; background-color:inherit">配置</span></span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px">cp /usr/local/etc/rc.d/init.d/keepalived /etc/rc.d/init.d/</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px">cp /usr/local/etc/sysconfig/keepalived /etc/sysconfig/</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px">mkdir /etc/keepalived</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px">cp /usr/local/sbin/keepalived /usr/sbin/</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px">mkdir /opt/keepalived</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px">touch /etc/keepalived/keepalived.conf</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px"><br style="background-color:inherit"> </span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px"></span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px"><span style="color:#e60013; background-color:inherit">配置脚本</span></span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <div style="background-color:inherit"> 
  <span style="background-color:inherit; font-size:14px">[root@cnsh042942 keepalived]# ip a</span> 
 </div> 
 <div style="background-color:inherit"> 
  <span style="background-color:rgb(191,191,191)">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 16436 qdisc noqueue state UNKNOWN</span> 
 </div> 
 <div style="background-color:inherit"> 
  <span style="background-color:rgb(191,191,191)">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span> 
 </div> 
 <div style="background-color:inherit"> 
  <span style="background-color:rgb(191,191,191)">    inet 127.0.0.1/8 scope host lo</span> 
 </div> 
 <div style="background-color:inherit"> 
  <span style="background-color:rgb(191,191,191)">    inet6 ::1/128 scope host</span> 
 </div> 
 <div style="background-color:inherit"> 
  <span style="background-color:rgb(191,191,191)">       valid_lft forever preferred_lft forever</span> 
 </div> 
 <div style="background-color:inherit"> 
  <span style="background-color:rgb(191,191,191)">2: eth0: &lt;BROADCAST,MULTICAST,SLAVE,UP,LOWER_UP&gt; mtu 1500 qdisc mq master bond0 state UP qlen 1000</span> 
 </div> 
 <div style="background-color:inherit"> 
  <span style="background-color:rgb(191,191,191)">    link/ether 00:50:56:aa:0a:89 brd ff:ff:ff:ff:ff:ff</span> 
 </div> 
 <div style="background-color:inherit"> 
  <span style="background-color:rgb(191,191,191)">3: </span> 
  <span style="background-color:rgb(0,158,151)">bond0</span> 
  <span style="background-color:rgb(191,191,191)">: &lt;BROADCAST,MULTICAST,MASTER,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP</span> 
 </div> 
 <div style="background-color:inherit"> 
  <span style="background-color:rgb(191,191,191)">    link/ether 00:50:56:aa:0a:89 brd ff:ff:ff:ff:ff:ff</span> 
 </div> 
 <div style="background-color:inherit"> 
  <span style="background-color:rgb(191,191,191)">    inet </span> 
  <span style="background-color:rgb(0,158,151)">10.31.10.138</span> 
  <span style="background-color:rgb(191,191,191)">/24 brd 10.31.10.255 scope global bond0</span> 
 </div> 
 <div style="background-color:inherit"> 
  <span style="background-color:rgb(191,191,191)">    inet6 fe80::250:56ff:feaa:a89/64 scope link</span> 
 </div> 
 <div style="background-color:inherit"> 
  <span style="background-color:rgb(191,191,191)">       valid_lft forever preferred_lft forever</span> 
 </div> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191)"><br style="background-color:inherit"> </span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <div style="background-color:inherit"> 
  <span style="background-color:inherit; font-size:14px"><span style="color:#e60013; background-color:inherit">我们的10.31.10.138是绑定在bond0上的，bond0应该算是虚拟网卡。</span></span> 
 </div> 
 <div style="background-color:inherit"> 
  <span style="background-color:inherit; font-size:14px"><span style="color:#e60013; background-color:inherit">其中interface bond0的bond0，virtual_router_id 117的117，virtual_ipaddress中的地址，是写成自己想要的vip，也是DA先申请好一个vip以免冲突。</span></span> 
 </div> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191)"><br style="background-color:inherit"> </span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px">touch /opt/keepalived/keepalived_check_mysql.sh</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px">touch /opt/keepalived/to_master.sh</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px"><br style="background-color:inherit"> </span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px">keepalived.conf配置文件，</span> 
 <span style="background-color:inherit; font-size:14px">该文件存在但是是空的。</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px">ls -l /etc/keepalived/keepalived.conf</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <br style="background-color:inherit"> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <div style="background-color:inherit"> 
  <span style="background-color:inherit; font-size:14px"><span style="color:#e60013; background-color:inherit">Master节点用如下脚本:</span></span> 
 </div> 
 <div style="background-color:inherit"> 
  <span style="background-color:rgb(191,191,191)">vrrp_script check_mysql {<!-- --></span> 
 </div> 
 <div style="background-color:inherit"> 
  <span style="background-color:rgb(191,191,191)">  script "/opt/keepalived/keepalived_check_mysql.sh"</span> 
 </div> 
 <div style="background-color:inherit"> 
  <span style="background-color:rgb(191,191,191)">  weight -10</span> 
 </div> 
 <div style="background-color:inherit"> 
  <span style="background-color:rgb(191,191,191)">}</span> 
 </div> 
 <div style="background-color:inherit"> 
  <span style="background-color:rgb(191,191,191)">vrrp_instance KEEPALIVED_MYSQL {<!-- --></span> 
 </div> 
 <div style="background-color:inherit"> 
  <span style="background-color:rgb(191,191,191)">        ##注意：两台MYSQL服务器都设置为BACKUP</span> 
 </div> 
 <div style="background-color:inherit"> 
  <span style="background-color:rgb(191,191,191)">        </span> 
  <span style="background-color:rgb(0,158,151)">state backup</span> 
 </div> 
 <div style="background-color:inherit"> 
  <span style="background-color:rgb(191,191,191)">        interface </span> 
  <span style="background-color:rgb(0,158,151)">bond0</span> 
 </div> 
 <div style="background-color:inherit"> 
  <span style="background-color:rgb(191,191,191)">        virtual_router_id </span> 
  <span style="background-color:rgb(0,158,151)">117</span> 
 </div> 
 <div style="background-color:inherit"> 
  <span style="background-color:rgb(191,191,191)">        ##Master设置为101，Slave设置为100</span> 
 </div> 
 <div style="background-color:inherit"> 
  <span style="background-color:rgb(191,191,191)">        priority </span> 
  <span style="background-color:rgb(0,158,151)">101</span> 
 </div> 
 <div style="background-color:inherit"> 
  <span style="background-color:rgb(191,191,191)">        nopreempt</span> 
 </div> 
 <div style="background-color:inherit"> 
  <span style="background-color:rgb(191,191,191)">       </span> 
 </div> 
 <div style="background-color:inherit"> 
  <span style="background-color:rgb(191,191,191)">        track_script {<!-- --></span> 
 </div> 
 <div style="background-color:inherit"> 
  <span style="background-color:rgb(191,191,191)">          check_mysql</span> 
 </div> 
 <div style="background-color:inherit"> 
  <span style="background-color:rgb(191,191,191)">        }</span> 
 </div> 
 <div style="background-color:inherit"> 
  <span style="background-color:rgb(191,191,191)">        virtual_ipaddress {<!-- --></span> 
 </div> 
 <div style="background-color:inherit"> 
  <span style="background-color:inherit"><span style="background-color:rgb(191,191,191)">               </span><span style="background-color:rgb(0,158,151)"> 10.31.10.152</span></span> 
 </div> 
 <div style="background-color:inherit"> 
  <span style="background-color:rgb(191,191,191)">        }</span> 
 </div> 
 <div style="background-color:inherit"> 
  <span style="background-color:rgb(191,191,191)">        notify_master /opt/keepalived/to_master.sh</span> 
 </div> 
 <div style="background-color:inherit"> 
  <span style="background-color:rgb(191,191,191)">}</span> 
 </div> 
 <div style="background-color:inherit"> 
  <span style="background-color:rgb(191,191,191)">vrrp_script check_mysql {<!-- --></span> 
 </div> 
 <div style="background-color:inherit"> 
  <span style="background-color:rgb(191,191,191)">  script "/opt/keepalived/keepalived_check_mysql.sh"</span> 
 </div> 
 <div style="background-color:inherit"> 
  <span style="background-color:rgb(191,191,191)">  weight -10</span> 
 </div> 
 <div style="background-color:inherit"> 
  <span style="background-color:rgb(191,191,191)">}</span> 
 </div> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px"><span style="color:#e60013; background-color:inherit">主库、从库的virtual_router_id值要相同，mysql取100-149之间，如果同一网段已经有相同的virtual_router_id被用了，那么就会起来失败。</span></span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px"></span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <br style="background-color:inherit"> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px"></span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px">Slave节点用如下脚本，可以注意到,priority比上面小1。</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191)">vrrp_instance KEEPALIVED_MYSQL {<!-- --></span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191)">        ##注意：两台MYSQL服务器都设置为BACKUP</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191)">        </span> 
 <span style="background-color:rgb(0,158,151)">state backup</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191)">        interface </span> 
 <span style="background-color:rgb(0,158,151)">bond0</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191)">        virtual_router_id </span> 
 <span style="background-color:rgb(0,158,151)">117</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191)">        ##Master设置为101，Slave设置为100</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191)">        priority </span> 
 <span style="background-color:rgb(0,158,151)">100</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191)"></span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191)">        ##nopreempt</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191)">       </span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191)">        track_script {<!-- --></span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191)">          check_mysql</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191)">        }</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191)">        virtual_ipaddress {<!-- --></span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191)">               </span> 
 <span style="background-color:rgb(0,158,151)"> 10.31.10.152</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191)">        }</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191)">        notify_master /opt/keepalived/to_master.sh</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191)">}</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <br style="background-color:inherit"> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <br style="background-color:inherit"> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px"></span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px"><span style="color:#e60013; background-color:inherit">创建通道</span></span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px">通道就是，在mysql里面定义一些可以用密文登陆的用户，然后给一些工具直接用密文来登陆的，以保证安全。</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px"></span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px">切换到mysql用户：</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191)">mysql_config_editor set --login-path=keepalived_monitor --host=localhost --user=keepalived --password</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191)">--socket=${MYSQL_HOME}/var/mysql.sock</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px">然后就会在mysql用户家目录下生成一下.mylogin.cnf文件。</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px"><br style="background-color:inherit"> </span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px">root用户</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px"></span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px">cd /opt/keepalived/</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px"></span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px"><span style="color:#e60013; background-color:inherit">keepalived_check_mysql.sh脚本如下</span></span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px">MYSQL=/usr/bin/mysql，要修改为/paic/t0gimp/rdbms/mysql/5.6/bin/mysql</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px">LOG_FILE=/opt/keepalived/check_mysql.log 这里可以修改为更具识别名称的/opt/keepalived/check_t0gimp.log</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px">export MYSQL_TEST_LOGIN_FILE=/paic/emmsq/data/mysqldata/emmsq /.mylogin.cnf ，这个.mylogin.cnf文件，在mysql用户的家目录下，是用mysql用户创建通道时自动建立的。</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px">$MYSQL --login-path=keepalived_monitor -e 的”keepalived_monitor修改为实际的通道名“</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <br style="background-color:inherit"> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px"></span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191); font-size:9px">#!/bin/bash</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(0,158,151); font-size:9px">MYSQL=/paic/t0gimp/rdbms/mysql/5.6/bin/mysql</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191); font-size:9px"></span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191); font-size:9px"># 日志文件</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(0,158,151); font-size:9px">LOG_FILE=/opt/keepalived/check_t0gimp.log</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(0,158,151); font-size:9px">export MYSQL_TEST_LOGIN_FILE=/paic/t0gimp/rdbms/mt0gimp/.mylogin.cnf</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191); font-size:9px"># 检查次数</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191); font-size:9px">CHECK_TIME=3</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191); font-size:9px">#mysql is working MYSQL_OK is 1 , mysql down MYSQL_OK is 0</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191); font-size:9px">MYSQL_OK=1</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191); font-size:9px">function check_mysql_helth (){<!-- --></span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191); font-size:9px">  $MYSQL --login-path=</span> 
 <span style="background-color:rgb(0,158,151); font-size:9px">keepalived_monitor </span> 
 <span style="background-color:rgb(191,191,191); font-size:9px">-e "show status;" &gt;/dev/null 2&gt;&amp;1</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191); font-size:9px">  if [ $? = 0 ] ;then</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191); font-size:9px">    MYSQL_OK=1</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191); font-size:9px">  else</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191); font-size:9px">    MYSQL_OK=0</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191); font-size:9px">  fi</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191); font-size:9px">  return $MYSQL_OK</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191); font-size:9px">}</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191); font-size:9px"></span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191); font-size:9px">while [ $CHECK_TIME -ne 0 ]</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191); font-size:9px">do</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191); font-size:9px">  let "CHECK_TIME -= 1"</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191); font-size:9px">  check_mysql_helth</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191); font-size:9px">  if [ $MYSQL_OK = 1 ] ; then</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191); font-size:9px">    CHECK_TIME=0</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191); font-size:9px">    #echo `date --date=today +"%Y-%m-%d %H:%M:%S"` - [INFO] - mysql available: success[$MYSQL_OK] &gt;&gt; $LOG_FILE</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191); font-size:9px">    exit 0</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191); font-size:9px">  fi</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191); font-size:9px">  if [ $MYSQL_OK -eq 0 ] &amp;&amp; [ $CHECK_TIME -eq 0 ]</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191); font-size:9px">  then</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191); font-size:9px">    echo `date --date=today +"%Y-%m-%d %H:%M:%S"` - [INFO] - mysql invaild. keepalived stop. &gt;&gt; $LOG_FILE</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191); font-size:9px">    exit 1</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191); font-size:9px">  fi</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191); font-size:9px">  sleep 1</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191); font-size:9px">done</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px"></span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit; font-size:14px"></span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <br style="background-color:inherit"> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <br style="background-color:inherit"> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑">
  to_master.sh  这是从库切换为主库之后运行的shell脚本 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <br style="background-color:inherit"> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191)">#!/bin/bash</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191)">MYSQL=</span> 
 <span style="background-color:rgb(0,158,151); font-size:9px">/paic/t0gimp/rdbms/mysql/5.6/bin/mysql</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191)">VIP=</span> 
 <span style="background-color:rgb(0,158,151)">10.31.10.152</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191)">GATEWAY=</span> 
 <span style="background-color:rgb(0,158,151)">10.31.10.200</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191)">/sbin/arping -I </span> 
 <span style="background-color:rgb(0,158,151)">bond0</span> 
 <span style="background-color:rgb(191,191,191)"> </span> 
 <span style="background-color:rgb(191,191,191)">-c 5 -s $VIP $GATEWAY &amp;&gt;/dev/null</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191)">$MYSQL --login-path=</span> 
 <span style="background-color:rgb(0,158,151)">keepalived_switch</span> 
 <span style="background-color:rgb(191,191,191)"> -e "set global read_only=OFF" &gt;/dev/null 2&gt;&amp;1</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191)"><br style="background-color:inherit"> </span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191)">sh脚本赋权</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191)">cd /opt/keepalived</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191)">chmod 700 *.sh</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191)"><br style="background-color:inherit"> </span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191)">keepalived启停</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191)">[root@cnsh281018 ~]# /etc/init.d/keepalived start</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191)">[root@cnsh281018 ~]# /etc/init.d/keepalived stop</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191)"><br style="background-color:inherit"> </span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:inherit">验证，</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191)">[root@cnsh042942 keepalived]# /etc/init.d/keepalived start</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191)">Starting keepalived: [ OK ]</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191)">[root@cnsh042942 keepalived]# ps -ef | grep keepa</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191)">root 20353 1 0 13:53 ? 00:00:00 keepalived -D</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191)">root 20354 20353 0 13:53 ? 00:00:00 keepalived -D</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191)">root 20372 1 0 13:53 ? 00:00:00 /bin/bash /opt/keepalived/keepalived_check_mysql.sh</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191)">root 20382 20354 3 13:53 ? 00:00:00 keepalived -D</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191)">root 20383 20382 0 13:53 ? 00:00:00 /bin/bash /opt/keepalived/keepalived_check_mysql.sh</span> 
</div> 
<div style="background-color:inherit; font-family:微软雅黑"> 
 <span style="background-color:rgb(191,191,191)">root 20394 17696 0 13:53 pts/2 00:00:00 grep keepa</span> 
</div> 
<div> 
 <span style="background-color:rgb(191,191,191)"><br> </span> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4632c9bb7862d26dc9f41271622cca40/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Visual Studio 2010 c&#43;&#43;经典入门教程</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b19e64f6d012ca1dd70312eb897a0347/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">构造、析构、继承对对象的影响</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>