<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Spring Boot自动装配原理 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Spring Boot自动装配原理" />
<meta property="og:description" content="目录
什么是自动装配?
自动装配是如何实现的?
自己写一个可以被Spring Boot自动装配的依赖
什么是自动装配? 我们可以先看一段代码
@RestController public class RedisContorller { @Autowired RedisTemplate&lt;String, String&gt; redisTemplate; @GetMapping(&#34;/get&#34;) public String getName() { return redisTemplate.opsForValue().get(&#34;name&#34;); } } 我们明明没有注册RedisTemplate这个bean，那么我们是怎么从spring容器里拿到的呢
这就是Spring Boot的自动装配，只要我们加入spring-boot-starter-data-redis依赖，就会自动的把RedisTemplate 放到spring容器里。
自动装配是如何实现的? 其实很简单，只需要第三方组件告诉Spring Boot你的Configuration所在的地方
Spring Boot的启动类上有个注解@SpringBootApplication
@SpringBootApplication又是由三个注解组成
@SpringBootConfiguration@EnableAutoConfiguration@ComponentScan *如果不清楚Spring注册bean的几种方式应该先了解一下 Import注册bean的三种方式 这很重要
@SpringBootConfiguration其实就是@Configuration
大家都知道@ComponentScan &#43; @Configuration是注册bean的一种方式，他会扫描@Component@Service等等的注解并把他们注册成bean
@EnableAutoConfiguration 又是由@Import(AutoConfigurationImportSelector.class)注解组成，而 @Configuration &#43; @Import也是注册bean的方式，AutoConfigurationImportSelector实现ImportSelector类，所以我们只要把第三方组件的配置类的全类名放到AutoConfigurationImportSelector里，就可以注册第三方组件的配置类的bean了，也就相当自动装配
第三方组件的配置类就是加了@Configuration注解的，它可以通过@Configuration 把自己的bean注册到spring里. 所以Spring Boot制定了一个规则，就是第三方组件的classpath：META-INF有一个spring.factories文件，文件里是配置类的全类名，所以Spring Boot只要扫描META-INF/spring.factories就可以加载到第三方组件的配置类了
下图是Mybatis整合Spring Boot的jar包 ，它的里面就有这个spring.factories文件
spring.factories文件里面的内容 KV的结构
# Auto Configure
org.springframework.boot.autoconfigure.EnableAutoConfiguration=\ org.mybatis.spring.boot.autoconfigure.MybatisAutoConfiguration
要注意的是 spring-boot-starter-data-redis是Spring Boot提供的官方的包，所以没有spring.factories 文件，它是由条件判断触发的装配。
条件触发装配有两种方式
@ConditionalOnClass 相当于@ConditionalMETA-INF/spring-autoconfigure-metadata." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/658ee189fb903cdaf11671c8e175d0aa/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-08T11:14:57+08:00" />
<meta property="article:modified_time" content="2023-09-08T11:14:57+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Spring Boot自动装配原理</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="main-toc-toc" style="margin-left:80px;"><a href="#main-toc" rel="nofollow">什么是自动装配?</a></p> 
<p id="%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D%E6%98%AF%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%9A%84%3F-toc" style="margin-left:80px;"><a href="#%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D%E6%98%AF%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%9A%84%3F" rel="nofollow">自动装配是如何实现的?</a></p> 
<p id="%E8%87%AA%E5%B7%B1%E5%86%99%E4%B8%80%E4%B8%AA%E5%8F%AF%E4%BB%A5%E8%A2%ABSpring%20Boot%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D%E7%9A%84%E4%BE%9D%E8%B5%96-toc" style="margin-left:80px;"><a href="#%E8%87%AA%E5%B7%B1%E5%86%99%E4%B8%80%E4%B8%AA%E5%8F%AF%E4%BB%A5%E8%A2%ABSpring%20Boot%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D%E7%9A%84%E4%BE%9D%E8%B5%96" rel="nofollow">自己写一个可以被Spring Boot自动装配的依赖</a></p> 
<hr id="hr-toc"> 
<h4>什么是自动装配?</h4> 
<p>我们可以先看一段代码</p> 
<pre><code class="language-java">@RestController
public class RedisContorller {

    @Autowired
    RedisTemplate&lt;String, String&gt; redisTemplate;

    @GetMapping("/get")
    public String getName() {
        return redisTemplate.opsForValue().get("name");
    }
}</code></pre> 
<p>我们明明没有注册<span style="color:#fe2c24;">RedisTemplate</span>这个bean，那么我们是怎么从spring容器里拿到的呢</p> 
<p>这就是Spring Boot的自动装配，只要我们加入<span style="color:#fe2c24;">spring-boot-starter-data-redis</span>依赖，就会自动的把<span style="color:#fe2c24;">RedisTemplate</span> 放到spring容器里。</p> 
<h4 id="%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D%E6%98%AF%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%9A%84%3F">自动装配是如何实现的?</h4> 
<p>其实很简单，只需要第三方组件告诉Spring Boot你的Configuration所在的地方</p> 
<p>Spring Boot的启动类上有个注解<span style="color:#fe2c24;">@SpringBootApplication</span></p> 
<p>@SpringBootApplication又是由三个注解组成</p> 
<ul><li>@SpringBootConfiguration</li><li>@EnableAutoConfiguration</li><li>@ComponentScan</li></ul> 
<p>*如果不清楚Spring注册bean的几种方式应该先了解一下  <a href="https://blog.csdn.net/w7486/article/details/122421208" title="Import注册bean的三种方式">Import注册bean的三种方式</a> 这很重要</p> 
<blockquote> 
 <p><span style="color:#fe2c24;">@SpringBootConfiguration其实就是@Configuration</span></p> 
 <p>大家都知道@<span style="color:#fe2c24;">ComponentScan + @Configuration</span>是注册bean的一种方式，他会扫描@Component@Service等等的注解并把他们注册成bean</p> 
 <p><span style="color:#fe2c24;">@EnableAutoConfiguration 又是由@Import(AutoConfigurationImportSelector.class)</span>注解组成，而 @Configuration + @Import也是注册bean的方式，<span style="color:#fe2c24;">AutoConfigurationImportSelector</span>实现<span style="color:#fe2c24;">ImportSelector</span>类，所以我们只要把第三方组件的配置类的全类名放到<span style="color:#fe2c24;">AutoConfigurationImportSelector</span>里，就可以注册第三方组件的配置类的bean了，也就相当自动装配</p> 
 <p>第三方组件的配置类就是加了@Configuration注解的，它可以通过@Configuration 把自己的bean注册到spring里. </p> 
</blockquote> 
<p>所以Spring Boot制定了一个规则，就是第三方组件的classpath：META-INF有一个spring.factories文件，文件里是配置类的全类名，所以Spring Boot只要扫描<span style="color:#fe2c24;">META-INF/spring.factories</span>就可以加载到第三方组件的配置类了</p> 
<p>下图是Mybatis整合Spring Boot的jar包 ，它的里面就有这个<span style="color:#fe2c24;">spring.factories</span>文件</p> 
<p></p> 
<p><img alt="" height="270" src="https://images2.imgbox.com/e4/81/VlFnwWlI_o.png" width="480"></p> 
<p><span style="color:#fe2c24;">spring.factories</span>文件里面的内容 KV的结构</p> 
<blockquote> 
 <p># Auto Configure</p> 
 <p>org.springframework.boot.autoconfigure.EnableAutoConfiguration=\ org.mybatis.spring.boot.autoconfigure.MybatisAutoConfiguration</p> 
</blockquote> 
<p>要注意的是 <span style="color:#fe2c24;">spring-boot-starter-data-redis</span>是Spring Boot提供的官方的包，所以没有<span style="color:#fe2c24;">spring.factories</span> 文件，它是由条件判断触发的装配。</p> 
<p>条件触发装配有两种方式</p> 
<ul><li>@ConditionalOnClass 相当于@Conditional</li><li><span style="color:#0d0016;">META-INF/spring-autoconfigure-metadata.properties</span></li></ul> 
<h4 id="%E8%87%AA%E5%B7%B1%E5%86%99%E4%B8%80%E4%B8%AA%E5%8F%AF%E4%BB%A5%E8%A2%ABSpring%20Boot%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D%E7%9A%84%E4%BE%9D%E8%B5%96"><span style="color:#0d0016;">自己写一个可以被Spring Boot自动装配的依赖</span></h4> 
<p>项目结构</p> 
<p><img alt="" height="420" src="https://images2.imgbox.com/db/bd/lvdCmhL9_o.png" width="300"></p> 
<p> 目的是让Spring Boot加入这个项目的依赖时可以把<span style="color:#fe2c24;">WsAppSevice</span>注入到spring容器里</p> 
<p>WsAppService:</p> 
<pre><code class="language-java">public class WsAppService {

    public String say() {
       return "ws-app 已完成自动装配!";
    }
}</code></pre> 
<p>WsAppConfigration</p> 
<pre><code class="language-java">@Configuration
public class WsAppConfigration {

    @Bean
    public WsAppService wsAppService() {
        return new WsAppService();
    }
}</code></pre> 
<p>最重要的<span style="color:#fe2c24;">META-INF/spring.factories</span></p> 
<pre><code class="language-XML"># Auto Configure
org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
com.ws.autoconfigure.WsAppConfigration</code></pre> 
<p><span style="color:#0d0016;">条件触发META-INF/spring-autoconfigure-metadata.properties</span></p> 
<p>我没有加</p> 
<p>把这个项目打包</p> 
<p><img alt="" height="273" src="https://images2.imgbox.com/d1/6b/xOOd5fyE_o.png" width="353"></p> 
<p> 在Spring Boot项目上加入这个依赖</p> 
<blockquote> 
 <pre>&lt;dependency&gt;
    &lt;groupId&gt;com.ws&lt;/groupId&gt;
    &lt;artifactId&gt;ws-app-spring-boot-starter&lt;/artifactId&gt;
    &lt;version&gt;6.6.6&lt;/version&gt;
&lt;/dependency&gt;</pre> 
</blockquote> 
<p>在启动类上测试是否装载了WsAppService这个bean</p> 
<pre><code class="language-java">@SpringBootApplication
public class Day0127Application {

    public static void main(String[] args) {
        ConfigurableApplicationContext run = SpringApplication.run(Day0127Application.class, args);
        WsAppService wsAppService = run.getBean(WsAppService.class);
        System.out.println(wsAppService.say());

    }

}</code></pre> 
<p>启动结果</p> 
<p><img alt="" height="337" src="https://images2.imgbox.com/60/7b/28lwnML8_o.png" width="1200"></p> 
<p> 自动装配成功！</p> 
<p>在SpringBoot3.0之后自动装配的配置稍微有些变化。改为通过<code>META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports</code>文件</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fd037553e142a94d63e7e7805e2ae051/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">对称方式生成正弦波数据（execl）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/acd1800a9113a10d968db7890c9240e5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Tomcat启动！ 一文带你知道什么是Tomcat以及如何安装</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>