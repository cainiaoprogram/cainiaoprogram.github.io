<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android VR视频 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Android VR视频" />
<meta property="og:description" content="话不多说，先上图（眼睛模式） 参考的开源库——传送门 MD360Player4Android 在开源库的基础上，做了菜单和播放器逻辑。 VR功能的部分通过依赖vrlib来实现，视频播放的部分集成ijkPlayer 这里对MD360Player4Android中的一些代码做解释。 初始化VR播放器
@Override protected MDVRLibrary createVRLibrary() { return MDVRLibrary.with(this) .displayMode(MDVRLibrary.DISPLAY_MODE_NORMAL) //默认360度全景 .interactiveMode(MDVRLibrary.INTERACTIVE_MODE_MOTION_WITH_TOUCH)//触摸和重力 .asVideo(new MDVRLibrary.IOnSurfaceReadyCallback() { @Override public void onSurfaceReady(Surface surface) { mMediaPlayerWrapper.setSurface(surface); } }) .ifNotSupport(new MDVRLibrary.INotSupportCallback() { @Override public void onNotSupport(int mode) { String tip = mode == MDVRLibrary.INTERACTIVE_MODE_MOTION ? &#34;onNotSupport:MOTION&#34; : &#34;onNotSupport:&#34; &#43; String.valueOf(mode); Toast.makeText(VrPlayerActivity.this, tip, Toast.LENGTH_SHORT).show(); } }) .pinchConfig(new MDPinchConfig().setMin(1.0f).setMax(8.0f).setDefaultValue(0.1f)) .pinchEnabled(true) .directorFactory(new MD360DirectorFactory() { @Override public MD360Director createDirector(int index) { return MD360Director.builder().setPitch(90).build(); } }) ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/238029fb7b964f522e1c888939c3f74b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-08-17T16:01:01+08:00" />
<meta property="article:modified_time" content="2018-08-17T16:01:01+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android VR视频</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>话不多说，先上图（眼睛模式） <br> <img src="https://images2.imgbox.com/e5/cd/kWdnIOhQ_o.jpg" alt="这里写图片描述" title=""> <br> 参考的开源库——传送门 <a href="https://github.com/ashqal/MD360Player4Android%20%E5%8F%82%E8%80%83%E5%BC%80%E6%BA%90%E5%BA%93">MD360Player4Android</a> <br> 在开源库的基础上，做了菜单和播放器逻辑。 <br> VR功能的部分通过依赖vrlib来实现，视频播放的部分集成ijkPlayer <br> <img src="https://images2.imgbox.com/49/76/J6yfkXV6_o.png" alt="这里写图片描述" title=""> <br> <img src="https://images2.imgbox.com/2c/f3/KRnhypqV_o.png" alt="这里写图片描述" title=""> <br> 这里对MD360Player4Android中的一些代码做解释。 <br> 初始化VR播放器</p> 
<pre class="prettyprint"><code class=" hljs avrasm">    @Override
    protected MDVRLibrary createVRLibrary() {

        return MDVRLibrary<span class="hljs-preprocessor">.with</span>(this)
                <span class="hljs-preprocessor">.displayMode</span>(MDVRLibrary<span class="hljs-preprocessor">.DISPLAY</span>_MODE_NORMAL) //默认<span class="hljs-number">360</span>度全景
                <span class="hljs-preprocessor">.interactiveMode</span>(MDVRLibrary<span class="hljs-preprocessor">.INTERACTIVE</span>_MODE_MOTION_WITH_TOUCH)//触摸和重力
                <span class="hljs-preprocessor">.asVideo</span>(new MDVRLibrary<span class="hljs-preprocessor">.IOnSurfaceReadyCallback</span>() {
                    @Override
                    public void onSurfaceReady(Surface surface) {
                        mMediaPlayerWrapper<span class="hljs-preprocessor">.setSurface</span>(surface)<span class="hljs-comment">;</span>
                    }
                })
                <span class="hljs-preprocessor">.ifNotSupport</span>(new MDVRLibrary<span class="hljs-preprocessor">.INotSupportCallback</span>() {
                    @Override
                    public void onNotSupport(int mode) {
                        String tip = mode == MDVRLibrary<span class="hljs-preprocessor">.INTERACTIVE</span>_MODE_MOTION
                                ? <span class="hljs-string">"onNotSupport:MOTION"</span> : <span class="hljs-string">"onNotSupport:"</span> + String<span class="hljs-preprocessor">.valueOf</span>(mode)<span class="hljs-comment">;</span>
                        Toast<span class="hljs-preprocessor">.makeText</span>(VrPlayerActivity<span class="hljs-preprocessor">.this</span>, tip, Toast<span class="hljs-preprocessor">.LENGTH</span>_SHORT)<span class="hljs-preprocessor">.show</span>()<span class="hljs-comment">;</span>
                    }
                })
                <span class="hljs-preprocessor">.pinchConfig</span>(new MDPinchConfig()<span class="hljs-preprocessor">.setMin</span>(<span class="hljs-number">1.0</span>f)<span class="hljs-preprocessor">.setMax</span>(<span class="hljs-number">8.0</span>f)<span class="hljs-preprocessor">.setDefaultValue</span>(<span class="hljs-number">0.1</span>f))
                <span class="hljs-preprocessor">.pinchEnabled</span>(true)
                <span class="hljs-preprocessor">.directorFactory</span>(new MD360DirectorFactory() {
                    @Override
                    public MD360Director createDirector(int index) {
                        return MD360Director<span class="hljs-preprocessor">.builder</span>()<span class="hljs-preprocessor">.setPitch</span>(<span class="hljs-number">90</span>)<span class="hljs-preprocessor">.build</span>()<span class="hljs-comment">;</span>
                    }
                })
                <span class="hljs-preprocessor">.projectionFactory</span>(new CustomProjectionFactory())<span class="hljs-preprocessor">.listenGesture</span>(new MDVRLibrary<span class="hljs-preprocessor">.IGestureListener</span>() {
                    @Override
                    public void onClick(MotionEvent e) {
                        touchRl<span class="hljs-preprocessor">.setVisibility</span>(View<span class="hljs-preprocessor">.VISIBLE</span>)<span class="hljs-comment">;</span>
                        if(mMediaPlayerWrapper<span class="hljs-preprocessor">.getPlayer</span>()<span class="hljs-preprocessor">.isPlaying</span>()){
                            img_start_vr<span class="hljs-preprocessor">.setVisibility</span>(View<span class="hljs-preprocessor">.GONE</span>)<span class="hljs-comment">;</span>
                            img_stop_vr<span class="hljs-preprocessor">.setVisibility</span>(View<span class="hljs-preprocessor">.VISIBLE</span>)<span class="hljs-comment">;</span>
                        }else {
                            img_start_vr<span class="hljs-preprocessor">.setVisibility</span>(View<span class="hljs-preprocessor">.VISIBLE</span>)<span class="hljs-comment">;</span>
                            img_stop_vr<span class="hljs-preprocessor">.setVisibility</span>(View<span class="hljs-preprocessor">.GONE</span>)<span class="hljs-comment">;</span>
                        }
                        mHandler<span class="hljs-preprocessor">.sendEmptyMessage</span>(MESSAGE_SHOW_PROGRESS)<span class="hljs-comment">;</span>
                        hasMenuAction()<span class="hljs-comment">;</span>
                        verticalSeekBar<span class="hljs-preprocessor">.setProgress</span>(audioManager<span class="hljs-preprocessor">.getStreamVolume</span>(AudioManager<span class="hljs-preprocessor">.STREAM</span>_MUSIC) * <span class="hljs-number">100</span> / mMaxVolume)<span class="hljs-comment">;</span>
                    }
                })
                <span class="hljs-preprocessor">.barrelDistortionConfig</span>(new BarrelDistortionConfig()<span class="hljs-preprocessor">.setDefaultEnabled</span>(false)<span class="hljs-preprocessor">.setScale</span>(<span class="hljs-number">0.95</span>f))
                <span class="hljs-preprocessor">.build</span>(findViewById(R<span class="hljs-preprocessor">.id</span><span class="hljs-preprocessor">.gl</span>_view))<span class="hljs-comment">;</span>

    }</code></pre> 
<p>主要的设置有displayMode——眼睛模式和全景模式，interactiveMode——这个字面上理解是交互模式，可以设置重力感应，触摸，或者禁止重力感应，禁止触摸等。 <br> 其实在M360PlayerActivity中，各种设置选项已经陈列出来了</p> 
<pre class="prettyprint"><code class=" hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">M360PlayerActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AppCompatActivity</span> {<!-- --></span>

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SparseArray&lt;String&gt; sDisplayMode = <span class="hljs-keyword">new</span> SparseArray&lt;&gt;();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SparseArray&lt;String&gt; sInteractiveMode = <span class="hljs-keyword">new</span> SparseArray&lt;&gt;();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SparseArray&lt;String&gt; sProjectionMode = <span class="hljs-keyword">new</span> SparseArray&lt;&gt;();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SparseArray&lt;String&gt; sAntiDistortion = <span class="hljs-keyword">new</span> SparseArray&lt;&gt;();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SparseArray&lt;String&gt; sPitchFilter = <span class="hljs-keyword">new</span> SparseArray&lt;&gt;();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SparseArray&lt;String&gt; sFlingEnabled = <span class="hljs-keyword">new</span> SparseArray&lt;&gt;();

    <span class="hljs-keyword">static</span> {
        sDisplayMode.put(MDVRLibrary.DISPLAY_MODE_NORMAL,<span class="hljs-string">"NORMAL"</span>);
        sDisplayMode.put(MDVRLibrary.DISPLAY_MODE_GLASS,<span class="hljs-string">"GLASS"</span>);

        sInteractiveMode.put(MDVRLibrary.INTERACTIVE_MODE_MOTION,<span class="hljs-string">"MOTION"</span>);
        sInteractiveMode.put(MDVRLibrary.INTERACTIVE_MODE_TOUCH,<span class="hljs-string">"TOUCH"</span>);
        sInteractiveMode.put(MDVRLibrary.INTERACTIVE_MODE_MOTION_WITH_TOUCH,<span class="hljs-string">"M &amp; T"</span>);
        sInteractiveMode.put(MDVRLibrary.INTERACTIVE_MODE_CARDBORAD_MOTION,<span class="hljs-string">"CARDBOARD M"</span>);
        sInteractiveMode.put(MDVRLibrary.INTERACTIVE_MODE_CARDBORAD_MOTION_WITH_TOUCH,<span class="hljs-string">"CARDBOARD M&amp;T"</span>);

        sProjectionMode.put(MDVRLibrary.PROJECTION_MODE_SPHERE,<span class="hljs-string">"SPHERE"</span>);
        sProjectionMode.put(MDVRLibrary.PROJECTION_MODE_DOME180,<span class="hljs-string">"DOME 180"</span>);
        sProjectionMode.put(MDVRLibrary.PROJECTION_MODE_DOME230,<span class="hljs-string">"DOME 230"</span>);
        sProjectionMode.put(MDVRLibrary.PROJECTION_MODE_DOME180_UPPER,<span class="hljs-string">"DOME 180 UPPER"</span>);
        sProjectionMode.put(MDVRLibrary.PROJECTION_MODE_DOME230_UPPER,<span class="hljs-string">"DOME 230 UPPER"</span>);
        sProjectionMode.put(MDVRLibrary.PROJECTION_MODE_STEREO_SPHERE_HORIZONTAL,<span class="hljs-string">"STEREO H SPHERE"</span>);
        sProjectionMode.put(MDVRLibrary.PROJECTION_MODE_STEREO_SPHERE_VERTICAL,<span class="hljs-string">"STEREO V SPHERE"</span>);
        sProjectionMode.put(MDVRLibrary.PROJECTION_MODE_PLANE_FIT,<span class="hljs-string">"PLANE FIT"</span>);
        sProjectionMode.put(MDVRLibrary.PROJECTION_MODE_PLANE_CROP,<span class="hljs-string">"PLANE CROP"</span>);
        sProjectionMode.put(MDVRLibrary.PROJECTION_MODE_PLANE_FULL,<span class="hljs-string">"PLANE FULL"</span>);
        sProjectionMode.put(MDVRLibrary.PROJECTION_MODE_MULTI_FISH_EYE_HORIZONTAL,<span class="hljs-string">"MULTI FISH EYE HORIZONTAL"</span>);
        sProjectionMode.put(MDVRLibrary.PROJECTION_MODE_MULTI_FISH_EYE_VERTICAL,<span class="hljs-string">"MULTI FISH EYE VERTICAL"</span>);

        sAntiDistortion.put(<span class="hljs-number">1</span>,<span class="hljs-string">"ANTI-ENABLE"</span>);
        sAntiDistortion.put(<span class="hljs-number">0</span>,<span class="hljs-string">"ANTI-DISABLE"</span>);

        sPitchFilter.put(<span class="hljs-number">1</span>,<span class="hljs-string">"FILTER PITCH"</span>);
        sPitchFilter.put(<span class="hljs-number">0</span>,<span class="hljs-string">"FILTER NOP"</span>);

        sFlingEnabled.put(<span class="hljs-number">1</span>, <span class="hljs-string">"FLING ENABLED"</span>);
        sFlingEnabled.put(<span class="hljs-number">0</span>, <span class="hljs-string">"FLING DISABLED"</span>);
    }
}</code></pre> 
<p>在onSurfaceReady(Surface surface)的回调中，调用了 mMediaPlayerWrapper.setSurface(surface); 这里的MediaPlayerWrapper是一个封住了ijkPlayer的播放器。这里可以理解成在VR功能接入完毕后，又把视频的处理交还给了ijkPlayer。而ijkPlayer的使用，跟VR功能就没关系了。（理解有点生硬，完全是看单词翻译的有木有- -！） <br> 项目实现大概就是这样，形容确切一点，就是一个具有VR功能的ijjPlayer <br> 页面布局activity_md_using_surface_view.xml</p> 
<pre class="prettyprint"><code class=" hljs xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">RelativeLayout</span> <span class="hljs-attribute">xmlns:android</span>=<span class="hljs-value">"http://schemas.android.com/apk/res/android"</span>
    <span class="hljs-attribute">xmlns:tools</span>=<span class="hljs-value">"http://schemas.android.com/tools"</span>
    <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
    <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"match_parent"</span>
    &gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-title">FrameLayout
</span>       <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/framelayout_gl"</span>
       <span class="hljs-attribute">android:orientation</span>=<span class="hljs-value">"horizontal"</span>
       <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
       <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"match_parent"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">android.opengl.GLSurfaceView
</span>          <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/gl_view"</span>
          <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
          <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"match_parent"</span> /&gt;</span>

   <span class="hljs-tag">&lt;/<span class="hljs-title">FrameLayout</span>&gt;</span>
   <span class="hljs-comment">&lt;!--视频菜单--&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-title">include</span> <span class="hljs-attribute">layout</span>=<span class="hljs-value">"@layout/include_menu"</span>/&gt;</span>

   <span class="hljs-tag">&lt;<span class="hljs-title">ProgressBar
</span>       <span class="hljs-attribute">android:layout_centerInParent</span>=<span class="hljs-value">"true"</span>
       <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/progress"</span>
       <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"wrap_content"</span>
       <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span> /&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-title">RelativeLayout</span>&gt;</span>
</code></pre> 
<p>菜单布局include_menu.xml</p> 
<pre class="prettyprint"><code class=" hljs xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">RelativeLayout
</span>    <span class="hljs-attribute">xmlns:android</span>=<span class="hljs-value">"http://schemas.android.com/apk/res/android"</span>
    <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/rl_touch_menu"</span>
    <span class="hljs-attribute">android:background</span>=<span class="hljs-value">"#33000000"</span>
    <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
    <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"match_parent"</span>
    <span class="hljs-attribute">android:visibility</span>=<span class="hljs-value">"gone"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">LinearLayout
</span>        <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"wrap_content"</span>
        <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"44dp"</span>
        <span class="hljs-attribute">android:orientation</span>=<span class="hljs-value">"horizontal"</span>
        <span class="hljs-attribute">android:gravity</span>=<span class="hljs-value">"center_vertical"</span>
        &gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">ImageView
</span>            <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/img_back"</span>
            <span class="hljs-attribute">android:layout_marginLeft</span>=<span class="hljs-value">"15dp"</span>
            <span class="hljs-attribute">android:src</span>=<span class="hljs-value">"@drawable/back_normal"</span>
            <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"wrap_content"</span>
            <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">TextView
</span>            <span class="hljs-attribute">android:layout_marginLeft</span>=<span class="hljs-value">"26dp"</span>
            <span class="hljs-attribute">android:gravity</span>=<span class="hljs-value">"center_vertical"</span>
            <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/tv_vr_title"</span>
            <span class="hljs-attribute">android:textSize</span>=<span class="hljs-value">"16sp"</span>
            <span class="hljs-attribute">android:text</span>=<span class="hljs-value">"视频名字哦"</span>
            <span class="hljs-attribute">android:textColor</span>=<span class="hljs-value">"#ffffff"</span>
            <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"wrap_content"</span>
            <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"match_parent"</span> /&gt;</span>

    <span class="hljs-tag">&lt;/<span class="hljs-title">LinearLayout</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">LinearLayout
</span>        <span class="hljs-attribute">android:layout_marginTop</span>=<span class="hljs-value">"13dp"</span>
        <span class="hljs-attribute">android:layout_alignParentRight</span>=<span class="hljs-value">"true"</span>
        <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"wrap_content"</span>
        <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span>
        <span class="hljs-attribute">android:orientation</span>=<span class="hljs-value">"horizontal"</span>
        <span class="hljs-attribute">android:gravity</span>=<span class="hljs-value">"center_vertical"</span>
        <span class="hljs-attribute">android:layout_marginRight</span>=<span class="hljs-value">"18dp"</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">Button
</span>            <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/btn_vr_nor"</span>
            <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"wrap_content"</span>
            <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span>
            <span class="hljs-attribute">android:text</span>=<span class="hljs-value">"360°全景"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">Button
</span>            <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/btn_vr_glass"</span>
            <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"wrap_content"</span>
            <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span>
            <span class="hljs-attribute">android:text</span>=<span class="hljs-value">"眼睛模式"</span> /&gt;</span>

    <span class="hljs-tag">&lt;/<span class="hljs-title">LinearLayout</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">LinearLayout
</span>        <span class="hljs-attribute">android:layout_centerVertical</span>=<span class="hljs-value">"true"</span>
        <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"wrap_content"</span>
        <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span>
        <span class="hljs-attribute">android:orientation</span>=<span class="hljs-value">"vertical"</span>
        <span class="hljs-attribute">android:gravity</span>=<span class="hljs-value">"center_horizontal"</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">RelativeLayout
</span>            <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/rl_voice_add"</span>
            <span class="hljs-attribute">android:padding</span>=<span class="hljs-value">"7dp"</span>
            <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"wrap_content"</span>
            <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span>&gt;</span>

            <span class="hljs-tag">&lt;<span class="hljs-title">TextView
</span>                <span class="hljs-attribute">android:textColor</span>=<span class="hljs-value">"@color/white"</span>
                <span class="hljs-attribute">android:text</span>=<span class="hljs-value">"音量+"</span>
                <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"wrap_content"</span>
                <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span> /&gt;</span>

        <span class="hljs-tag">&lt;/<span class="hljs-title">RelativeLayout</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">com.vrplayerdemo.view.VerticalSeekBar
</span>            <span class="hljs-attribute">android:layout_marginTop</span>=<span class="hljs-value">"15dp"</span>
            <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/seekbar_voice"</span>
            <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"100dp"</span>
            <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"160dp"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">RelativeLayout
</span>            <span class="hljs-attribute">android:layout_marginTop</span>=<span class="hljs-value">"15dp"</span>
            <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/rl_voice_sub"</span>
            <span class="hljs-attribute">android:padding</span>=<span class="hljs-value">"7dp"</span>
            <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"wrap_content"</span>
            <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">TextView
</span>                <span class="hljs-attribute">android:textColor</span>=<span class="hljs-value">"@color/white"</span>
                <span class="hljs-attribute">android:text</span>=<span class="hljs-value">"音量-"</span>
                <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"wrap_content"</span>
                <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">RelativeLayout</span>&gt;</span>

    <span class="hljs-tag">&lt;/<span class="hljs-title">LinearLayout</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">ImageView
</span>        <span class="hljs-attribute">android:clickable</span>=<span class="hljs-value">"true"</span>
        <span class="hljs-attribute">android:layout_marginRight</span>=<span class="hljs-value">"45dp"</span>
        <span class="hljs-attribute">android:layout_centerVertical</span>=<span class="hljs-value">"true"</span>
        <span class="hljs-attribute">android:layout_alignParentRight</span>=<span class="hljs-value">"true"</span>
        <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/img_next_video"</span>
        <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"wrap_content"</span>
        <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span>
        <span class="hljs-attribute">android:src</span>=<span class="hljs-value">"@drawable/vr_next_nor"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">ImageView
</span>        <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/img_stop_vr"</span>
        <span class="hljs-attribute">android:src</span>=<span class="hljs-value">"@drawable/btn_vr_stop"</span>
        <span class="hljs-attribute">android:layout_centerInParent</span>=<span class="hljs-value">"true"</span>
        <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"wrap_content"</span>
        <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">ImageView
</span>        <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/img_start_vr"</span>
        <span class="hljs-attribute">android:src</span>=<span class="hljs-value">"@drawable/btn_vr_start_nor"</span>
        <span class="hljs-attribute">android:layout_centerInParent</span>=<span class="hljs-value">"true"</span>
        <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"wrap_content"</span>
        <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span>
        <span class="hljs-attribute">android:visibility</span>=<span class="hljs-value">"gone"</span>/&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">LinearLayout
</span>        <span class="hljs-attribute">android:layout_marginLeft</span>=<span class="hljs-value">"28dp"</span>
        <span class="hljs-attribute">android:layout_marginRight</span>=<span class="hljs-value">"28dp"</span>
        <span class="hljs-attribute">android:layout_marginBottom</span>=<span class="hljs-value">"17dp"</span>
        <span class="hljs-attribute">android:layout_alignParentBottom</span>=<span class="hljs-value">"true"</span>
        <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
        <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">TextView
</span>            <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/tv_current_play_time"</span>
            <span class="hljs-attribute">android:text</span>=<span class="hljs-value">"00:00"</span>
            <span class="hljs-attribute">android:textColor</span>=<span class="hljs-value">"#FFFFFF"</span>
            <span class="hljs-attribute">android:textSize</span>=<span class="hljs-value">"14sp"</span>
            <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"wrap_content"</span>
            <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">SeekBar
</span>            <span class="hljs-attribute">style</span>=<span class="hljs-value">"@style/SeekBarAppTheme"</span>
            <span class="hljs-attribute">android:layout_marginLeft</span>=<span class="hljs-value">"15dp"</span>
            <span class="hljs-attribute">android:layout_marginRight</span>=<span class="hljs-value">"15dp"</span>
            <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/seekbar_play_video"</span>
            <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
            <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span>
            <span class="hljs-attribute">android:layout_weight</span>=<span class="hljs-value">"1"</span>
            /&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">TextView
</span>            <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/tv_end_play_time"</span>
            <span class="hljs-attribute">android:text</span>=<span class="hljs-value">"12:05"</span>
            <span class="hljs-attribute">android:textColor</span>=<span class="hljs-value">"#FFFFFF"</span>
            <span class="hljs-attribute">android:textSize</span>=<span class="hljs-value">"14sp"</span>
            <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"wrap_content"</span>
            <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span> /&gt;</span>


    <span class="hljs-tag">&lt;/<span class="hljs-title">LinearLayout</span>&gt;</span>


<span class="hljs-tag">&lt;/<span class="hljs-title">RelativeLayout</span>&gt;</span></code></pre> 
<p>M360PlayerActivity代码</p> 
<pre class="prettyprint"><code class=" hljs java"><span class="hljs-keyword">package</span> com.vrplayerdemo.view;

<span class="hljs-keyword">import</span> android.animation.PropertyValuesHolder;
<span class="hljs-keyword">import</span> android.animation.ValueAnimator;
<span class="hljs-keyword">import</span> android.app.Activity;
<span class="hljs-keyword">import</span> android.content.Context;
<span class="hljs-keyword">import</span> android.content.Intent;
<span class="hljs-keyword">import</span> android.content.res.Configuration;
<span class="hljs-keyword">import</span> android.graphics.Bitmap;
<span class="hljs-keyword">import</span> android.graphics.BitmapFactory;
<span class="hljs-keyword">import</span> android.net.Uri;
<span class="hljs-keyword">import</span> android.os.Bundle;
<span class="hljs-keyword">import</span> android.support.v7.app.AppCompatActivity;
<span class="hljs-keyword">import</span> android.util.SparseArray;
<span class="hljs-keyword">import</span> android.view.View;
<span class="hljs-keyword">import</span> android.view.Window;
<span class="hljs-keyword">import</span> android.view.WindowManager;

<span class="hljs-keyword">import</span> com.asha.vrlib.MDDirectorCamUpdate;
<span class="hljs-keyword">import</span> com.asha.vrlib.MDVRLibrary;
<span class="hljs-keyword">import</span> com.asha.vrlib.plugins.hotspot.IMDHotspot;
<span class="hljs-keyword">import</span> com.asha.vrlib.texture.MD360BitmapTexture;
<span class="hljs-keyword">import</span> com.vrplayerdemo.R;
<span class="hljs-keyword">import</span> com.vrplayerdemo.VrPlayerActivity;
<span class="hljs-keyword">import</span> com.vrplayerdemo.model.VideoModel;

<span class="hljs-keyword">import</span> java.io.FileNotFoundException;


<span class="hljs-javadoc">/**
 * using MD360Renderer
 *
 * Created by hzqiujiadi on 16/1/22.
 * hzqiujiadi ashqalcn@gmail.com
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">M360PlayerActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AppCompatActivity</span> {<!-- --></span>

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SparseArray&lt;String&gt; sDisplayMode = <span class="hljs-keyword">new</span> SparseArray&lt;&gt;();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SparseArray&lt;String&gt; sInteractiveMode = <span class="hljs-keyword">new</span> SparseArray&lt;&gt;();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SparseArray&lt;String&gt; sProjectionMode = <span class="hljs-keyword">new</span> SparseArray&lt;&gt;();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SparseArray&lt;String&gt; sAntiDistortion = <span class="hljs-keyword">new</span> SparseArray&lt;&gt;();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SparseArray&lt;String&gt; sPitchFilter = <span class="hljs-keyword">new</span> SparseArray&lt;&gt;();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SparseArray&lt;String&gt; sFlingEnabled = <span class="hljs-keyword">new</span> SparseArray&lt;&gt;();

    <span class="hljs-keyword">static</span> {
        sDisplayMode.put(MDVRLibrary.DISPLAY_MODE_NORMAL,<span class="hljs-string">"NORMAL"</span>);
        sDisplayMode.put(MDVRLibrary.DISPLAY_MODE_GLASS,<span class="hljs-string">"GLASS"</span>);

        sInteractiveMode.put(MDVRLibrary.INTERACTIVE_MODE_MOTION,<span class="hljs-string">"MOTION"</span>);
        sInteractiveMode.put(MDVRLibrary.INTERACTIVE_MODE_TOUCH,<span class="hljs-string">"TOUCH"</span>);
        sInteractiveMode.put(MDVRLibrary.INTERACTIVE_MODE_MOTION_WITH_TOUCH,<span class="hljs-string">"M &amp; T"</span>);
        sInteractiveMode.put(MDVRLibrary.INTERACTIVE_MODE_CARDBORAD_MOTION,<span class="hljs-string">"CARDBOARD M"</span>);
        sInteractiveMode.put(MDVRLibrary.INTERACTIVE_MODE_CARDBORAD_MOTION_WITH_TOUCH,<span class="hljs-string">"CARDBOARD M&amp;T"</span>);

        sProjectionMode.put(MDVRLibrary.PROJECTION_MODE_SPHERE,<span class="hljs-string">"SPHERE"</span>);
        sProjectionMode.put(MDVRLibrary.PROJECTION_MODE_DOME180,<span class="hljs-string">"DOME 180"</span>);
        sProjectionMode.put(MDVRLibrary.PROJECTION_MODE_DOME230,<span class="hljs-string">"DOME 230"</span>);
        sProjectionMode.put(MDVRLibrary.PROJECTION_MODE_DOME180_UPPER,<span class="hljs-string">"DOME 180 UPPER"</span>);
        sProjectionMode.put(MDVRLibrary.PROJECTION_MODE_DOME230_UPPER,<span class="hljs-string">"DOME 230 UPPER"</span>);
        sProjectionMode.put(MDVRLibrary.PROJECTION_MODE_STEREO_SPHERE_HORIZONTAL,<span class="hljs-string">"STEREO H SPHERE"</span>);
        sProjectionMode.put(MDVRLibrary.PROJECTION_MODE_STEREO_SPHERE_VERTICAL,<span class="hljs-string">"STEREO V SPHERE"</span>);
        sProjectionMode.put(MDVRLibrary.PROJECTION_MODE_PLANE_FIT,<span class="hljs-string">"PLANE FIT"</span>);
        sProjectionMode.put(MDVRLibrary.PROJECTION_MODE_PLANE_CROP,<span class="hljs-string">"PLANE CROP"</span>);
        sProjectionMode.put(MDVRLibrary.PROJECTION_MODE_PLANE_FULL,<span class="hljs-string">"PLANE FULL"</span>);
        sProjectionMode.put(MDVRLibrary.PROJECTION_MODE_MULTI_FISH_EYE_HORIZONTAL,<span class="hljs-string">"MULTI FISH EYE HORIZONTAL"</span>);
        sProjectionMode.put(MDVRLibrary.PROJECTION_MODE_MULTI_FISH_EYE_VERTICAL,<span class="hljs-string">"MULTI FISH EYE VERTICAL"</span>);

        sAntiDistortion.put(<span class="hljs-number">1</span>,<span class="hljs-string">"ANTI-ENABLE"</span>);
        sAntiDistortion.put(<span class="hljs-number">0</span>,<span class="hljs-string">"ANTI-DISABLE"</span>);

        sPitchFilter.put(<span class="hljs-number">1</span>,<span class="hljs-string">"FILTER PITCH"</span>);
        sPitchFilter.put(<span class="hljs-number">0</span>,<span class="hljs-string">"FILTER NOP"</span>);

        sFlingEnabled.put(<span class="hljs-number">1</span>, <span class="hljs-string">"FLING ENABLED"</span>);
        sFlingEnabled.put(<span class="hljs-number">0</span>, <span class="hljs-string">"FLING DISABLED"</span>);
    }

<span class="hljs-comment">//    public static void startVideo(Context context, Uri uri){<!-- --></span>
<span class="hljs-comment">//        start(context, uri,VideoPlayerActivity.class);</span>
<span class="hljs-comment">//    }</span>
    <span class="hljs-comment">// uri在userAlbumModel里,不是本地数据，不需要Uri格式</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">startVideo</span>(Context context, VideoModel videoModel, <span class="hljs-keyword">int</span> playType){
        start(context,videoModel,playType, VrPlayerActivity.class);
    }
<span class="hljs-comment">//    public static void startBitmap(Context context, Uri uri){<!-- --></span>
<span class="hljs-comment">//        start(context, uri, BitmapPlayerActivity.class);</span>
<span class="hljs-comment">//    }</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">start</span>(Context context,VideoModel videoModel,<span class="hljs-keyword">int</span> playType,Class&lt;? extends Activity&gt; clz){
        Intent i = <span class="hljs-keyword">new</span> Intent(context,clz);
<span class="hljs-comment">//        i.setData(uri);</span>
        i.putExtra(<span class="hljs-string">"videoModel"</span>,videoModel);
        i.putExtra(<span class="hljs-string">"playType"</span>,playType);
        context.startActivity(i);
    }

    <span class="hljs-keyword">private</span> MDVRLibrary mVRLibrary;

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCreate</span>(Bundle savedInstanceState) {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState);

        <span class="hljs-comment">// no title</span>
        requestWindowFeature(Window.FEATURE_NO_TITLE);

        <span class="hljs-comment">// full screen</span>
        getWindow().setFlags(WindowManager.LayoutParams.FLAG_FULLSCREEN,
                WindowManager.LayoutParams.FLAG_FULLSCREEN);

        <span class="hljs-comment">// set content view</span>
        setContentView(R.layout.activity_md_using_surface_view);

        <span class="hljs-comment">// init VR Library</span>
        mVRLibrary = createVRLibrary();

        <span class="hljs-keyword">final</span> Activity activity = <span class="hljs-keyword">this</span>;


        getVRLibrary().setEyePickChangedListener(<span class="hljs-keyword">new</span> MDVRLibrary.IEyePickListener() {
            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onHotspotHit</span>(IMDHotspot hotspot, <span class="hljs-keyword">long</span> hitTimestamp) {

                <span class="hljs-keyword">if</span> (System.currentTimeMillis() - hitTimestamp &gt; <span class="hljs-number">5000</span>){
                    getVRLibrary().resetEyePick();
                }
            }
        });


    }


    <span class="hljs-keyword">private</span> ValueAnimator animator;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">startCameraAnimation</span>(<span class="hljs-keyword">final</span> MDDirectorCamUpdate cameraUpdate, PropertyValuesHolder... values){
        <span class="hljs-keyword">if</span> (animator != <span class="hljs-keyword">null</span>){
            animator.cancel();
        }

        animator = ValueAnimator.ofPropertyValuesHolder(values).setDuration(<span class="hljs-number">2000</span>);
        animator.addUpdateListener(<span class="hljs-keyword">new</span> ValueAnimator.AnimatorUpdateListener() {
            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onAnimationUpdate</span>(ValueAnimator animation) {
                <span class="hljs-keyword">float</span> near = (<span class="hljs-keyword">float</span>) animation.getAnimatedValue(<span class="hljs-string">"near"</span>);
                <span class="hljs-keyword">float</span> eyeZ = (<span class="hljs-keyword">float</span>) animation.getAnimatedValue(<span class="hljs-string">"eyeZ"</span>);
                <span class="hljs-keyword">float</span> pitch = (<span class="hljs-keyword">float</span>) animation.getAnimatedValue(<span class="hljs-string">"pitch"</span>);
                <span class="hljs-keyword">float</span> yaw = (<span class="hljs-keyword">float</span>) animation.getAnimatedValue(<span class="hljs-string">"yaw"</span>);
                <span class="hljs-keyword">float</span> roll = (<span class="hljs-keyword">float</span>) animation.getAnimatedValue(<span class="hljs-string">"roll"</span>);
                cameraUpdate.setEyeZ(eyeZ).setNearScale(near).setPitch(pitch).setYaw(yaw).setRoll(roll);
            }
        });
        animator.start();
    }

    <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">protected</span> MDVRLibrary <span class="hljs-title">createVRLibrary</span>();

    <span class="hljs-keyword">public</span> MDVRLibrary <span class="hljs-title">getVRLibrary</span>() {
        <span class="hljs-keyword">return</span> mVRLibrary;
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onResume</span>() {
        <span class="hljs-keyword">super</span>.onResume();
        mVRLibrary.onResume(<span class="hljs-keyword">this</span>);
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onPause</span>() {
        <span class="hljs-keyword">super</span>.onPause();
        mVRLibrary.onPause(<span class="hljs-keyword">this</span>);
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onDestroy</span>() {
        <span class="hljs-keyword">super</span>.onDestroy();
        mVRLibrary.onDestroy();
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onConfigurationChanged</span>(Configuration newConfig) {
        <span class="hljs-keyword">super</span>.onConfigurationChanged(newConfig);
        mVRLibrary.onOrientationChanged(<span class="hljs-keyword">this</span>);
    }

    <span class="hljs-keyword">protected</span> Uri <span class="hljs-title">getUri</span>() {
        Intent i = getIntent();
        <span class="hljs-keyword">if</span> (i == <span class="hljs-keyword">null</span> || i.getData() == <span class="hljs-keyword">null</span>){
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
        }
        <span class="hljs-keyword">return</span> i.getData();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">cancelBusy</span>(){
        findViewById(R.id.progress).setVisibility(View.GONE);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">busy</span>(){
        findViewById(R.id.progress).setVisibility(View.VISIBLE);
    }

    <span class="hljs-comment">// android impl</span>
    <span class="hljs-keyword">private</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AndroidProvider</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">MDVRLibrary</span>.<span class="hljs-title">IImageLoadProvider</span> {<!-- --></span>

        Activity activity;

        <span class="hljs-keyword">public</span> <span class="hljs-title">AndroidProvider</span>(Activity activity) {
            <span class="hljs-keyword">this</span>.activity = activity;
        }

        <span class="hljs-annotation">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onProvideBitmap</span>(Uri uri, MD360BitmapTexture.Callback callback) {
            <span class="hljs-keyword">try</span> {
                Bitmap bitmap = BitmapFactory.decodeStream(activity.getContentResolver().openInputStream(uri));
                callback.texture(bitmap);
            } <span class="hljs-keyword">catch</span> (FileNotFoundException e) {
                e.printStackTrace();
            }

        }
    }
}</code></pre> 
<p>最后就是我们页面的主要逻辑,也是区别于MD360Player4Android,自己做的页面逻辑，让demo更像实际开发的项目。这里页面风格主要仿照尤果圈。</p> 
<pre class="prettyprint"><code class=" hljs java"><span class="hljs-keyword">package</span> com.vrplayerdemo;

<span class="hljs-keyword">import</span> android.content.Context;
<span class="hljs-keyword">import</span> android.graphics.Color;
<span class="hljs-keyword">import</span> android.media.AudioManager;
<span class="hljs-keyword">import</span> android.os.Bundle;
<span class="hljs-keyword">import</span> android.os.Handler;
<span class="hljs-keyword">import</span> android.os.Looper;
<span class="hljs-keyword">import</span> android.os.Message;
<span class="hljs-keyword">import</span> android.util.Log;
<span class="hljs-keyword">import</span> android.view.MotionEvent;
<span class="hljs-keyword">import</span> android.view.Surface;
<span class="hljs-keyword">import</span> android.view.View;
<span class="hljs-keyword">import</span> android.widget.Button;
<span class="hljs-keyword">import</span> android.widget.ImageView;
<span class="hljs-keyword">import</span> android.widget.RelativeLayout;
<span class="hljs-keyword">import</span> android.widget.SeekBar;
<span class="hljs-keyword">import</span> android.widget.TextView;
<span class="hljs-keyword">import</span> android.widget.Toast;

<span class="hljs-keyword">import</span> com.asha.vrlib.MD360Director;
<span class="hljs-keyword">import</span> com.asha.vrlib.MD360DirectorFactory;
<span class="hljs-keyword">import</span> com.asha.vrlib.MDVRLibrary;
<span class="hljs-keyword">import</span> com.asha.vrlib.model.BarrelDistortionConfig;
<span class="hljs-keyword">import</span> com.asha.vrlib.model.MDPinchConfig;
<span class="hljs-keyword">import</span> com.vrplayerdemo.model.VideoModel;
<span class="hljs-keyword">import</span> com.vrplayerdemo.view.CustomProjectionFactory;
<span class="hljs-keyword">import</span> com.vrplayerdemo.view.M360PlayerActivity;
<span class="hljs-keyword">import</span> com.vrplayerdemo.view.MediaPlayerWrapper;
<span class="hljs-keyword">import</span> com.vrplayerdemo.view.VerticalSeekBar;

<span class="hljs-keyword">import</span> tv.danmaku.ijk.media.player.IMediaPlayer;



<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VrPlayerActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">M360PlayerActivity</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">View</span>.<span class="hljs-title">OnClickListener</span>{<!-- --></span>
    <span class="hljs-javadoc">/**
     * 是否在拖动进度条中，默认为停止拖动，true为在拖动中，false为停止拖动
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> isDragging;
    <span class="hljs-javadoc">/**
     * 播放缓冲监听
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> mCurrentBufferPercentage=<span class="hljs-number">0</span>;
    <span class="hljs-javadoc">/**
     * 同步进度
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> MESSAGE_SHOW_PROGRESS = <span class="hljs-number">1</span>;
    <span class="hljs-javadoc">/**
     * 5秒菜单操作，隐藏菜单面板
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> MESSAGE_TOUCH_MENU = <span class="hljs-number">3</span>;
    <span class="hljs-javadoc">/**
     * 开启倒计时
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> MESSAGE_START_COUNTDOWN = <span class="hljs-number">4</span>;
    <span class="hljs-javadoc">/**
     * 重新播放
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> MESSAGE_PLAY_NEXT = <span class="hljs-number">5</span>;
    <span class="hljs-keyword">private</span> MediaPlayerWrapper mMediaPlayerWrapper = <span class="hljs-keyword">new</span> MediaPlayerWrapper();

    <span class="hljs-comment">//显示菜单的全屏区域</span>
    <span class="hljs-keyword">private</span> RelativeLayout touchRl;
    <span class="hljs-comment">//音量的seekbar</span>
    <span class="hljs-keyword">private</span> VerticalSeekBar verticalSeekBar;
    <span class="hljs-keyword">private</span> RelativeLayout addVoice;
    <span class="hljs-keyword">private</span> RelativeLayout subVoice;
    <span class="hljs-keyword">private</span> Button btn_vr_nor;<span class="hljs-comment">//全景模式</span>
    <span class="hljs-keyword">private</span> Button btn_vr_glass; <span class="hljs-comment">//眼镜模式</span>
    <span class="hljs-keyword">private</span> ImageView img_stop_vr; <span class="hljs-comment">//停止vr按钮</span>
    <span class="hljs-keyword">private</span> ImageView img_start_vr;<span class="hljs-comment">//继续vr按钮</span>
    <span class="hljs-keyword">private</span> TextView endTimeTv; <span class="hljs-comment">//总时长</span>
    <span class="hljs-keyword">private</span> TextView currentTimeTv; <span class="hljs-comment">//当前时长</span>
    <span class="hljs-keyword">private</span> SeekBar playSeekbar; <span class="hljs-comment">//视频播放进度</span>
    <span class="hljs-keyword">private</span> TextView titleTv;  <span class="hljs-comment">//视频标题</span>
    <span class="hljs-keyword">private</span> ImageView img_back; <span class="hljs-comment">//返回键</span>
    <span class="hljs-keyword">private</span> ImageView img_next_video; <span class="hljs-comment">//下一部视频</span>
    <span class="hljs-comment">//当前声音大小</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> volume;
    <span class="hljs-comment">//设备最大音量</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> mMaxVolume;
    <span class="hljs-comment">//音频管理器</span>
    <span class="hljs-keyword">private</span> AudioManager audioManager;
    <span class="hljs-javadoc">/**
     * 播放总时长
     */</span>
    <span class="hljs-keyword">private</span> VideoModel videoModel;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> playType=MDVRLibrary.DISPLAY_MODE_NORMAL;


    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> isFirstGlass;

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCreate</span>(Bundle savedInstanceState) {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState);
        videoModel= (VideoModel) getIntent().getSerializableExtra(<span class="hljs-string">"videoModel"</span>);
        playType =getIntent().getIntExtra(<span class="hljs-string">"playType"</span>,MDVRLibrary.DISPLAY_MODE_NORMAL);
        initView();

        <span class="hljs-comment">//初始化页面动画</span>
        touchRl.setVisibility(View.VISIBLE);
        initMediaPlayer();
        mHandler.sendEmptyMessage(MESSAGE_SHOW_PROGRESS);

    }
    <span class="hljs-comment">//初始化播放器</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initMediaPlayer</span>() {
        mMediaPlayerWrapper.init();
        mMediaPlayerWrapper.setPreparedListener(<span class="hljs-keyword">new</span> IMediaPlayer.OnPreparedListener() {
            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onPrepared</span>(IMediaPlayer mp) {
                cancelBusy();
                <span class="hljs-keyword">if</span> (getVRLibrary() != <span class="hljs-keyword">null</span>){
                    getVRLibrary().notifyPlayerChanged();
                }
                <span class="hljs-keyword">if</span>(isFirstGlass){
                    isFirstGlass=<span class="hljs-keyword">false</span>;
                    mMediaPlayerWrapper.pause();
                }
            }
        });
        mMediaPlayerWrapper.getPlayer().setOnErrorListener(<span class="hljs-keyword">new</span> IMediaPlayer.OnErrorListener() {
            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">onError</span>(IMediaPlayer mp, <span class="hljs-keyword">int</span> what, <span class="hljs-keyword">int</span> extra) {
                String error = String.format(<span class="hljs-string">"Play Error what=%d extra=%d"</span>,what,extra);
                Toast.makeText(VrPlayerActivity.<span class="hljs-keyword">this</span>, error, Toast.LENGTH_SHORT).show();
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
            }
        });
        mMediaPlayerWrapper.getPlayer().setOnVideoSizeChangedListener(<span class="hljs-keyword">new</span> IMediaPlayer.OnVideoSizeChangedListener() {
            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onVideoSizeChanged</span>(IMediaPlayer mp, <span class="hljs-keyword">int</span> width, <span class="hljs-keyword">int</span> height, <span class="hljs-keyword">int</span> sar_num, <span class="hljs-keyword">int</span> sar_den) {
                getVRLibrary().onTextureResize(width, height);
            }
        });

        <span class="hljs-keyword">if</span>(videoModel.getVideoUrl()!=<span class="hljs-keyword">null</span>){
            mMediaPlayerWrapper.openRemoteFile(videoModel.getVideoUrl());
            mMediaPlayerWrapper.prepare();
        }
        mMediaPlayerWrapper.getPlayer().setOnBufferingUpdateListener(<span class="hljs-keyword">new</span> IMediaPlayer.OnBufferingUpdateListener() {
            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onBufferingUpdate</span>(IMediaPlayer iMediaPlayer, <span class="hljs-keyword">int</span> percent) {
                mCurrentBufferPercentage = percent;
            }
        });
        mMediaPlayerWrapper.getPlayer().setOnCompletionListener(<span class="hljs-keyword">new</span> IMediaPlayer.OnCompletionListener() {
            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCompletion</span>(IMediaPlayer iMediaPlayer) {
                mHandler.sendEmptyMessage(MESSAGE_START_COUNTDOWN);
            }
        });
    }

    <span class="hljs-comment">//初始化页面菜单功能</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initView</span>() {
        img_back= (ImageView) findViewById(R.id.img_back);
        img_back.setOnClickListener(<span class="hljs-keyword">this</span>);
        touchRl= (RelativeLayout) findViewById(R.id.rl_touch_menu);
        touchRl.setOnClickListener(<span class="hljs-keyword">this</span>);
        verticalSeekBar= (VerticalSeekBar) findViewById(R.id.seekbar_voice);
        addVoice= (RelativeLayout) findViewById(R.id.rl_voice_add);
        subVoice= (RelativeLayout) findViewById(R.id.rl_voice_sub);
        addVoice.setOnClickListener(<span class="hljs-keyword">this</span>);
        subVoice.setOnClickListener(<span class="hljs-keyword">this</span>);
        <span class="hljs-comment">//不要显示进度球</span>
        verticalSeekBar.setThumbSize(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>);
        verticalSeekBar.setUnSelectColor(Color.parseColor(<span class="hljs-string">"#ff707070"</span>));
        verticalSeekBar.setSelectColor(Color.parseColor(<span class="hljs-string">"#ffffffff"</span>));
        <span class="hljs-comment">//单位px</span>
        verticalSeekBar.setmInnerProgressWidth(<span class="hljs-number">3</span>);
        verticalSeekBar.setOnSlideChangeListener(slideChangeListener);
        titleTv= (TextView) findViewById(R.id.tv_vr_title);
        titleTv.setText(videoModel.getName());

        btn_vr_nor= (Button) findViewById(R.id.btn_vr_nor);
        btn_vr_glass= (Button) findViewById(R.id.btn_vr_glass);
        btn_vr_nor.setOnClickListener(<span class="hljs-keyword">this</span>);
        btn_vr_glass.setOnClickListener(<span class="hljs-keyword">this</span>);
        img_stop_vr= (ImageView) findViewById(R.id.img_stop_vr);
        img_start_vr= (ImageView) findViewById(R.id.img_start_vr);
        img_stop_vr.setOnClickListener(<span class="hljs-keyword">this</span>);
        img_start_vr.setOnClickListener(<span class="hljs-keyword">this</span>);
        endTimeTv = (TextView) findViewById(R.id.tv_end_play_time);
        currentTimeTv = (TextView) findViewById(R.id.tv_current_play_time);
        img_next_video= (ImageView) findViewById(R.id.img_next_video);
        img_next_video.setOnClickListener(<span class="hljs-keyword">this</span>);

        audioManager = (AudioManager) <span class="hljs-keyword">this</span>.getSystemService(Context.AUDIO_SERVICE);
        mMaxVolume = audioManager.getStreamMaxVolume(AudioManager.STREAM_MUSIC);
        verticalSeekBar.setProgress(audioManager.getStreamVolume(AudioManager.STREAM_MUSIC) * <span class="hljs-number">100</span> / mMaxVolume);

        playSeekbar= (SeekBar) findViewById(R.id.seekbar_play_video);
        playSeekbar.setMax(<span class="hljs-number">1000</span>);
        playSeekbar.setOnSeekBarChangeListener(mSeekListener);
        <span class="hljs-keyword">if</span>(playType==MDVRLibrary.DISPLAY_MODE_GLASS){
            <span class="hljs-comment">//因为默认是360全景，所有只有当playType为眼镜模式时,才需要改变默认.在M360PlayerActivity中，createVRLibrary带不过参数，所有是先设置全景，再改变</span>
            changeToglass();
        }


    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">protected</span> MDVRLibrary <span class="hljs-title">createVRLibrary</span>() {

        <span class="hljs-keyword">return</span> MDVRLibrary.with(<span class="hljs-keyword">this</span>)
                .displayMode(MDVRLibrary.DISPLAY_MODE_NORMAL) <span class="hljs-comment">//默认360度全景</span>
                .interactiveMode(MDVRLibrary.INTERACTIVE_MODE_MOTION_WITH_TOUCH)<span class="hljs-comment">//触摸和重力</span>
                .asVideo(<span class="hljs-keyword">new</span> MDVRLibrary.IOnSurfaceReadyCallback() {
                    <span class="hljs-annotation">@Override</span>
                    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onSurfaceReady</span>(Surface surface) {
                        mMediaPlayerWrapper.setSurface(surface);
                    }
                })
                .ifNotSupport(<span class="hljs-keyword">new</span> MDVRLibrary.INotSupportCallback() {
                    <span class="hljs-annotation">@Override</span>
                    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onNotSupport</span>(<span class="hljs-keyword">int</span> mode) {
                        String tip = mode == MDVRLibrary.INTERACTIVE_MODE_MOTION
                                ? <span class="hljs-string">"onNotSupport:MOTION"</span> : <span class="hljs-string">"onNotSupport:"</span> + String.valueOf(mode);
                        Toast.makeText(VrPlayerActivity.<span class="hljs-keyword">this</span>, tip, Toast.LENGTH_SHORT).show();
                    }
                })
                .pinchConfig(<span class="hljs-keyword">new</span> MDPinchConfig().setMin(<span class="hljs-number">1.0</span>f).setMax(<span class="hljs-number">8.0</span>f).setDefaultValue(<span class="hljs-number">0.1</span>f))
                .pinchEnabled(<span class="hljs-keyword">true</span>)
                .directorFactory(<span class="hljs-keyword">new</span> MD360DirectorFactory() {
                    <span class="hljs-annotation">@Override</span>
                    <span class="hljs-keyword">public</span> MD360Director <span class="hljs-title">createDirector</span>(<span class="hljs-keyword">int</span> index) {
                        <span class="hljs-keyword">return</span> MD360Director.builder().setPitch(<span class="hljs-number">90</span>).build();
                    }
                })
                .projectionFactory(<span class="hljs-keyword">new</span> CustomProjectionFactory()).listenGesture(<span class="hljs-keyword">new</span> MDVRLibrary.IGestureListener() {
                    <span class="hljs-annotation">@Override</span>
                    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onClick</span>(MotionEvent e) {
                        touchRl.setVisibility(View.VISIBLE);
                        <span class="hljs-keyword">if</span>(mMediaPlayerWrapper.getPlayer().isPlaying()){
                            img_start_vr.setVisibility(View.GONE);
                            img_stop_vr.setVisibility(View.VISIBLE);
                        }<span class="hljs-keyword">else</span> {
                            img_start_vr.setVisibility(View.VISIBLE);
                            img_stop_vr.setVisibility(View.GONE);
                        }
                        mHandler.sendEmptyMessage(MESSAGE_SHOW_PROGRESS);
                        hasMenuAction();
                        verticalSeekBar.setProgress(audioManager.getStreamVolume(AudioManager.STREAM_MUSIC) * <span class="hljs-number">100</span> / mMaxVolume);
                    }
                })
                .barrelDistortionConfig(<span class="hljs-keyword">new</span> BarrelDistortionConfig().setDefaultEnabled(<span class="hljs-keyword">false</span>).setScale(<span class="hljs-number">0.95</span>f))
                .build(findViewById(R.id.gl_view));

    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onDestroy</span>() {
        <span class="hljs-keyword">super</span>.onDestroy();
        mHandler.removeMessages(MESSAGE_SHOW_PROGRESS);
        mMediaPlayerWrapper.destroy();
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onPause</span>() {
        <span class="hljs-keyword">super</span>.onPause();
        mMediaPlayerWrapper.pause();
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onResume</span>() {
        <span class="hljs-keyword">super</span>.onResume();
<span class="hljs-comment">//        mMediaPlayerWrapper.resume();</span>
    }

    <span class="hljs-keyword">int</span> curProgress;
    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onClick</span>(View v) {
        <span class="hljs-keyword">switch</span> (v.getId()){

            <span class="hljs-keyword">case</span> R.id.rl_touch_menu:<span class="hljs-comment">//点击菜单无点击事件的区域，菜单消失</span>
                touchRl.setVisibility(View.GONE);
                mHandler.removeMessages(MESSAGE_TOUCH_MENU);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> R.id.rl_voice_add:<span class="hljs-comment">//增加音量</span>
                curProgress=verticalSeekBar.getProgress();
                Log.d(<span class="hljs-string">"vrdemo"</span>,<span class="hljs-string">"音量增加="</span>+verticalSeekBar.getProgress());
                <span class="hljs-keyword">if</span>(curProgress&lt;<span class="hljs-number">100</span>){
                    curProgress=curProgress+<span class="hljs-number">5</span>;
                    verticalSeekBar.setProgress(curProgress);
                }
                volume = (<span class="hljs-keyword">int</span>) (mMaxVolume * curProgress * <span class="hljs-number">0.01</span>);
                audioManager.setStreamVolume(AudioManager.STREAM_MUSIC, volume, <span class="hljs-number">0</span>);
                hasMenuAction();
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> R.id.rl_voice_sub:<span class="hljs-comment">//减少音量</span>
                Log.d(<span class="hljs-string">"vrdemo"</span>,<span class="hljs-string">"音量减少="</span>+verticalSeekBar.getProgress());
                curProgress=verticalSeekBar.getProgress();
                <span class="hljs-keyword">if</span>(curProgress&gt;<span class="hljs-number">0</span>){
                    curProgress=curProgress-<span class="hljs-number">5</span>;
                    verticalSeekBar.setProgress(curProgress);
                }
                volume = (<span class="hljs-keyword">int</span>) (mMaxVolume * curProgress * <span class="hljs-number">0.01</span>);
                audioManager.setStreamVolume(AudioManager.STREAM_MUSIC, volume, <span class="hljs-number">0</span>);
                hasMenuAction();
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> R.id.btn_vr_nor:<span class="hljs-comment">//360全景模式</span>
                <span class="hljs-keyword">if</span>(playType!=MDVRLibrary.DISPLAY_MODE_NORMAL){
                    changeTo360nor();
                }
                hasMenuAction();
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> R.id.btn_vr_glass:<span class="hljs-comment">//眼镜模式</span>
                <span class="hljs-keyword">if</span>(playType!=MDVRLibrary.DISPLAY_MODE_GLASS){
                    changeToglass();
                }
                hasMenuAction();
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> R.id.img_stop_vr:<span class="hljs-comment">//暂停</span>
                img_stop_vr.setVisibility(View.GONE);
                img_start_vr.setVisibility(View.VISIBLE);
                mMediaPlayerWrapper.pause();
                mHandler.removeMessages(MESSAGE_TOUCH_MENU);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> R.id.img_start_vr:<span class="hljs-comment">//继续播放</span>
                img_start_vr.setVisibility(View.GONE);
                img_stop_vr.setVisibility(View.VISIBLE);
                mMediaPlayerWrapper.resume();
                hasMenuAction();
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> R.id.img_back:<span class="hljs-comment">//返回</span>
                finish();
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> R.id.img_next_video:<span class="hljs-comment">//下一部</span>
                playNext();
                <span class="hljs-keyword">break</span>;
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">playNext</span>() {
        <span class="hljs-comment">//获取下一步内容</span>
        <span class="hljs-comment">//TODO 获取新片资源</span>
        <span class="hljs-keyword">if</span>(videoModel.getId()==<span class="hljs-number">15</span>){
            videoModel=MainActivity.videoModels.get(<span class="hljs-number">0</span>);
        }<span class="hljs-keyword">else</span> {
            videoModel=MainActivity.videoModels.get(videoModel.getId());
        }
        titleTv.setText(videoModel.getName());
        mMediaPlayerWrapper.pause();
        mMediaPlayerWrapper.destroy();
        mMediaPlayerWrapper.init();
        mMediaPlayerWrapper.openRemoteFile(videoModel.getVideoUrl());
        mMediaPlayerWrapper.prepare();
    }



    <span class="hljs-comment">//切换成360全景模式</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">changeTo360nor</span>(){
        playType=MDVRLibrary.DISPLAY_MODE_NORMAL;
        getVRLibrary().switchDisplayMode(VrPlayerActivity.<span class="hljs-keyword">this</span>, MDVRLibrary.DISPLAY_MODE_NORMAL);
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">changeToglass</span>(){
        playType=MDVRLibrary.DISPLAY_MODE_GLASS;
        getVRLibrary().switchDisplayMode(VrPlayerActivity.<span class="hljs-keyword">this</span>, MDVRLibrary.DISPLAY_MODE_GLASS);
    }
    <span class="hljs-keyword">private</span> VerticalSeekBar.SlideChangeListener slideChangeListener=<span class="hljs-keyword">new</span> VerticalSeekBar.SlideChangeListener() {
        <span class="hljs-annotation">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onStart</span>(VerticalSeekBar slideView, <span class="hljs-keyword">int</span> progress) {

        }

        <span class="hljs-annotation">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onProgress</span>(VerticalSeekBar slideView, <span class="hljs-keyword">int</span> progress) {
            volume= (<span class="hljs-keyword">int</span>) (mMaxVolume * progress * <span class="hljs-number">0.01</span>);
            <span class="hljs-keyword">if</span> (volume &gt; mMaxVolume)
                volume = mMaxVolume;
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (volume &lt; <span class="hljs-number">0</span>)
                volume = <span class="hljs-number">0</span>;
            <span class="hljs-comment">// 变更声音</span>
            audioManager.setStreamVolume(AudioManager.STREAM_MUSIC, volume, <span class="hljs-number">0</span>);
        }

        <span class="hljs-annotation">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onStop</span>(VerticalSeekBar slideView, <span class="hljs-keyword">int</span> progress) {

        }
    };
    <span class="hljs-javadoc">/**
     * 时长格式化显示
     */</span>
    <span class="hljs-keyword">private</span> String <span class="hljs-title">generateTime</span>(<span class="hljs-keyword">long</span> time) {
        <span class="hljs-keyword">int</span> totalSeconds = (<span class="hljs-keyword">int</span>) (time / <span class="hljs-number">1000</span>);
        <span class="hljs-keyword">int</span> seconds = totalSeconds % <span class="hljs-number">60</span>;
        <span class="hljs-keyword">int</span> minutes = (totalSeconds / <span class="hljs-number">60</span>) % <span class="hljs-number">60</span>;
        <span class="hljs-keyword">int</span> hours = totalSeconds / <span class="hljs-number">3600</span>;
        <span class="hljs-keyword">return</span> hours &gt; <span class="hljs-number">0</span> ? String.format(<span class="hljs-string">"%02d:%02d:%02d"</span>, hours, minutes, seconds) : String.format(<span class="hljs-string">"%02d:%02d"</span>, minutes, seconds);
    }
    <span class="hljs-javadoc">/**
     * 进度条滑动监听
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> SeekBar.OnSeekBarChangeListener mSeekListener = <span class="hljs-keyword">new</span> SeekBar.OnSeekBarChangeListener() {

        <span class="hljs-javadoc">/**数值的改变*/</span>
        <span class="hljs-annotation">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onProgressChanged</span>(SeekBar seekBar, <span class="hljs-keyword">int</span> progress, <span class="hljs-keyword">boolean</span> fromUser) {
            <span class="hljs-keyword">long</span> duration = mMediaPlayerWrapper.getPlayer().getDuration();
            <span class="hljs-keyword">int</span> position = (<span class="hljs-keyword">int</span>) ((duration * progress * <span class="hljs-number">1.0</span>) / <span class="hljs-number">1000</span>);
            String time = generateTime(position);
            currentTimeTv.setText(time);

        }

        <span class="hljs-javadoc">/**开始拖动*/</span>
        <span class="hljs-annotation">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onStartTrackingTouch</span>(SeekBar seekBar) {
            isDragging = <span class="hljs-keyword">true</span>;
            mHandler.removeMessages(MESSAGE_SHOW_PROGRESS);
        }

        <span class="hljs-javadoc">/**停止拖动*/</span>
        <span class="hljs-annotation">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onStopTrackingTouch</span>(SeekBar seekBar) {
            <span class="hljs-keyword">long</span> duration = mMediaPlayerWrapper.getPlayer().getDuration();
            mMediaPlayerWrapper.getPlayer().seekTo((<span class="hljs-keyword">int</span>) ((duration * seekBar.getProgress() * <span class="hljs-number">1.0</span>) / <span class="hljs-number">1000</span>));

            mHandler.removeMessages(MESSAGE_SHOW_PROGRESS);
            isDragging = <span class="hljs-keyword">false</span>;
            mHandler.sendEmptyMessageDelayed(MESSAGE_SHOW_PROGRESS, <span class="hljs-number">1000</span>);
            hasMenuAction();
        }
    };

    <span class="hljs-javadoc">/**
     * 消息处理
     */</span>
    <span class="hljs-keyword">private</span> Handler mHandler = <span class="hljs-keyword">new</span> Handler(Looper.getMainLooper()) {
        <span class="hljs-annotation">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handleMessage</span>(Message msg) {
            <span class="hljs-keyword">switch</span> (msg.what) {
                <span class="hljs-javadoc">/**滑动中，同步播放进度*/</span>
                <span class="hljs-keyword">case</span> MESSAGE_SHOW_PROGRESS:
                    <span class="hljs-keyword">long</span> pos = syncProgress();
                    <span class="hljs-keyword">if</span> (!isDragging) {
                        msg = obtainMessage(MESSAGE_SHOW_PROGRESS);
                        sendMessageDelayed(msg, <span class="hljs-number">1000</span> - (pos % <span class="hljs-number">1000</span>));
                    }
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-javadoc">/**隐藏菜单面板*/</span>
                <span class="hljs-keyword">case</span> MESSAGE_TOUCH_MENU:
                    touchRl.setVisibility(View.GONE);
                    <span class="hljs-comment">//防止点触面引起的显示冲突</span>
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> MESSAGE_PLAY_NEXT:
                    playNext();
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> MESSAGE_START_COUNTDOWN:<span class="hljs-comment">//播放完成时，开始倒计时，抛出handler是不明确完成时是否有线程安全问题</span>
                    playNext();
                    <span class="hljs-keyword">break</span>;
            }
        }
    };

    <span class="hljs-javadoc">/**
     * 同步进度
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">long</span> <span class="hljs-title">syncProgress</span>() {
        <span class="hljs-keyword">if</span> (isDragging) {
            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
        }
        <span class="hljs-keyword">long</span> position = mMediaPlayerWrapper.getPlayer().getCurrentPosition();
        <span class="hljs-keyword">long</span> duration = mMediaPlayerWrapper.getPlayer().getDuration();
        <span class="hljs-keyword">if</span> (playSeekbar != <span class="hljs-keyword">null</span>) {
            <span class="hljs-keyword">if</span> (duration &gt; <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">long</span> pos = <span class="hljs-number">1000</span>L * position / duration;
                playSeekbar.setProgress((<span class="hljs-keyword">int</span>) pos);
            }
            <span class="hljs-keyword">int</span> percent =mCurrentBufferPercentage;
            playSeekbar.setSecondaryProgress(percent * <span class="hljs-number">10</span>);
        }

        currentTimeTv.setText(generateTime(position));
        endTimeTv.setText(generateTime(duration));
        verticalSeekBar.setProgress(audioManager.getStreamVolume(AudioManager.STREAM_MUSIC) * <span class="hljs-number">100</span> / mMaxVolume);

        <span class="hljs-keyword">return</span> position;
    }
    <span class="hljs-comment">//有菜单操作</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">hasMenuAction</span>(){
        <span class="hljs-keyword">if</span>(isDragging){
            mHandler.removeMessages(MESSAGE_TOUCH_MENU);
        }<span class="hljs-keyword">else</span> {
            mHandler.removeMessages(MESSAGE_TOUCH_MENU);
            mHandler.sendEmptyMessageDelayed(MESSAGE_TOUCH_MENU, <span class="hljs-number">5000</span>);
        }
    }

}
</code></pre> 
<p>代码中用到的VideoModel是一个视频资源的model，可以根据实际项目需求传入，大致可以有标题，视频的url，封面图片，视频时长等字段。 <br> 这里讲下普通视频资源跟VR视频资源。拍摄VR视频的时候，是那种360°的机器，拍出来的视频就是360°的，如果你在浏览器上放VR视频，看到的一个很长的视频，你把VR视频用VR播放器播放，就相当于把长视频又卷到一个球上，而观看者在球中间。 <br> demo中放置的几个测试url都是普通视频的url，所以看起来想过就很畸形了。</p> 
<h3 id="代码传送门">代码传送门</h3> 
<p><a href="https://download.csdn.net/download/qq_31390699/10610824">https://download.csdn.net/download/qq_31390699/10610824</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ab3224ac85f893559557e240137cdb57/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Mybatis自定义sql，进行insert、update、delete操作，如何返回影响的行记录数？？？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ed3dd0bfa89500c5feb306cd4d9db56c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">正则</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>