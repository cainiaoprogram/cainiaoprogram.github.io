<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>linux忽略写入的报错信息,linux  –  sort：写入失败|破管 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="linux忽略写入的报错信息,linux  –  sort：写入失败|破管" />
<meta property="og:description" content="晚上好,
以下是我在脚本中使用的一段代码.从SSH sesssion启动工作正常,但是,当它通过cron运行时,它会在屏幕上显示损坏的管道错误.
我不能通过SSH重现它.
码：
IP=$(sort --random-sort /root/ips.csv | head -n 1); nc -zv -w 2 $IP 443 2&gt;&amp;1 | grep succeeded &gt;&gt; outfile
屏幕错误：
sort: write failed: standard output; Broken pipe
sort: write error
任何提示/指针？
谢谢！
解决方法:
当头部在处理完第一条线后完成时,它会退出,关闭管道的另一端. sort可能仍在尝试编写更多内容,写入已关闭的管道或套接字会返回EPIPE错误.但它也会引发SIGPIPE信号,从而导致进程无效,除非忽略或处理信号.忽略信号后,sort会看到错误,抱怨和退出.但是如果信号没有被忽略,它就会死掉,而不会留下错误信息.
忽略信号会继承到子进程,因此我们可以从shell控制它：
$ trap - PIPE # set default action for signal
$sort bigfile | head -1 &gt; /dev/null # no error message
$trap &#34;&#34; PIPE # ignore the signal" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/fec7e93b4569dcfca6875ee2baa4d7f8/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-05-08T14:11:43+08:00" />
<meta property="article:modified_time" content="2021-05-08T14:11:43+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">linux忽略写入的报错信息,linux  –  sort：写入失败|破管</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="font-size:16px;"> 
 <p>晚上好,</p> 
 <p>以下是我在脚本中使用的一段代码.从SSH sesssion启动工作正常,但是,当它通过cron运行时,它会在屏幕上显示损坏的管道错误.</p> 
 <p>我不能通过SSH重现它.</p> 
 <p>码：</p> 
 <p>IP=$(sort --random-sort /root/ips.csv | head -n 1); nc -zv -w 2 $IP 443 2&gt;&amp;1 | grep succeeded &gt;&gt; outfile</p> 
 <p>屏幕错误：</p> 
 <p>sort: write failed: standard output; Broken pipe</p> 
 <p>sort: write error</p> 
 <p>任何提示/指针？</p> 
 <p>谢谢！</p> 
 <p>解决方法:</p> 
 <p>当头部在处理完第一条线后完成时,它会退出,关闭管道的另一端. sort可能仍在尝试编写更多内容,写入已关闭的管道或套接字会返回EPIPE错误.但它也会引发SIGPIPE信号,从而导致进程无效,除非忽略或处理信号.忽略信号后,sort会看到错误,抱怨和退出.但是如果信号没有被忽略,它就会死掉,而不会留下错误信息.</p> 
 <p>忽略信号会继承到子进程,因此我们可以从shell控制它：</p> 
 <p>$ trap - PIPE # set default action for signal</p> 
 <p>$sort bigfile | head -1 &gt; /dev/null # no error message</p> 
 <p>$trap "" PIPE # ignore the signal</p> 
 <p>$sort bigfile | head -1 &gt; /dev/null</p> 
 <p>sort: write failed: standard output: Broken pipe</p> 
 <p>sort: write error</p> 
 <p>That’s</p> 
 <p>not really useful for normal daemons though, and as we try to provide a</p> 
 <p>good, useful execution environment for daemons, we turn this off. Of</p> 
 <p>course, shells and suchlike should turn this on again.</p> 
 <p>在我的系统上,/ lib / system / system / cron.service显式撤消了cron的默认值,设置了IgnoreSIGPIPE = false.</p> 
 <p>标签：head,bash,linux,grep,sort</p> 
 <p>来源： https://codeday.me/bug/20190813/1646748.html</p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e98c6c800a520bdb70a348f0372a915a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">综合型RSA题目</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5a159b229ab3d1028714347f5cd38f9d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">精读VueCli《1》</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>