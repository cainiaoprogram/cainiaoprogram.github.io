<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Hyperledger Fabric 03 超详细图解——通过Fabric测试网络深入理解联盟链 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Hyperledger Fabric 03 超详细图解——通过Fabric测试网络深入理解联盟链" />
<meta property="og:description" content="区块链 | Hyperledger Fabric 03 超详细图解——通过Fabric测试网络深入理解联盟链 - 墨天轮
导读
超级账本，作为最火热的联盟链技术，得到了广泛地使用，也得到了很多科研人员的青睐。
今天这篇文章，我们一起来安装go环境，并通过测试网络来对联盟链Fabric有更深刻地理解。我们也针对安装过程中出现的一些问题做了详细的说明，并提供解决方案。
让我们一起走进文章，来感受Fabric并深入理解联盟链吧！
1
说在前面的话
1、预备知识 为了后续大家能够更好地学习，首先我们需要先了解一些相关的基本理论和概念。
区块链 | Hyperledger Fabric 01 超级账本介绍
后续我们也会逐步更新必备的基础概念，大家可以点击阅读原文。详细了解。
2、环境需求 在今天的内容之前，我们需要先检查一下自己的“背包”，才能让接下来的旅途走得更加悠然。
我们在测试网络文件夹打开终端：
1、Docker
首先我们先检查是否安装Docker和Docker compose，命令如下：
docker --version docker-compose --version 2、测试网络
然后我们检查测试网络是否存在：
./network.sh -h 上面这个命令是打印帮助文档，把测试网络所有可用的功能都打印出来。
如果这个过程出现问题，大家可以在下面这篇文章查找解决方案：
区块链 | Hyperledger Fabric 02 超详细图解——Fabric2.3.3安装及常见报错解决方案
3、安装go 前面我们没有安装go，这是因为前面我们只是安装配置fabric，go并不是必须的。
现在我们要开始运行链码，即联盟链中的智能合约，官网中给的示例是go语言开发的。如果大家有其他语言的开发经验，如Java，可以跳过这个步骤。
首先我们需要下载go的安装包：
https://studygolang.com/dl 大家也可以在我的公众号【AI与区块链技术】回复go下载。
下载好之后，我们将其解压，然后将其移动到local文件夹：
tar -zxvf go1.17.2.linux-amd64.tar.gz sudo mv go /usr/local/ 接下来我们配置一下环境变量，首先我们打开环境变量文件：
sudo gedit ~/.profile 下面的提示是已经完成了更改后的警告：
然后我们在最后添加：
export GOROOT=/usr/local/go export GOPATH=$HOME/go export PATH=$GOPATH/bin:$GOROOT/bin:$PATH 然后点击save保存并关闭。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/357b23c471486c10b518f6be34c786d5/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-10-14T11:12:09+08:00" />
<meta property="article:modified_time" content="2022-10-14T11:12:09+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Hyperledger Fabric 03 超详细图解——通过Fabric测试网络深入理解联盟链</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><a href="https://www.modb.pro/db/227440" rel="nofollow" title="区块链 | Hyperledger Fabric 03 超详细图解——通过Fabric测试网络深入理解联盟链 - 墨天轮">区块链 | Hyperledger Fabric 03 超详细图解——通过Fabric测试网络深入理解联盟链 - 墨天轮</a></p> 
<p>导读</p> 
<p></p> 
<p></p> 
<p>超级账本，作为最火热的联盟链技术，得到了广泛地使用，也得到了很多科研人员的青睐。</p> 
<p></p> 
<p>今天这篇文章，我们一起来安装go环境，并通过测试网络来对联盟链Fabric有更深刻地理解。我们也针对安装过程中出现的一些问题做了详细的说明，并提供解决方案。</p> 
<p></p> 
<p>让我们一起走进文章，来感受Fabric并深入理解联盟链吧！</p> 
<p></p> 
<p></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/a4/0a/OIbIg5Rw_o.png"></p> 
<p></p> 
<p>1</p> 
<p>说在前面的话</p> 
<p></p> 
<p></p> 
<h3>1、预备知识</h3> 
<p></p> 
<p>为了后续大家能够更好地学习，首先我们需要先了解一些相关的基本理论和概念。</p> 
<p></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/25/db/IqIfJgcq_o.png"></p> 
<p>区块链 | Hyperledger Fabric 01 超级账本介绍</p> 
<p></p> 
<p>后续我们也会逐步更新必备的基础概念，大家可以点击<strong>阅读原文</strong>。详细了解。</p> 
<p></p> 
<h3>2、环境需求</h3> 
<p></p> 
<p>在今天的内容之前，我们需要先检查一下自己的“背包”，才能让接下来的旅途走得更加悠然。</p> 
<p></p> 
<p>我们在测试网络文件夹打开终端：</p> 
<p></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/ff/5f/oBuHB8Ob_o.png"></p> 
<p></p> 
<p><strong>1、Docker</strong></p> 
<p></p> 
<p>首先我们先检查是否安装Docker和Docker compose，命令如下：</p> 
<p></p> 
<ul><li><li></ul> 
<pre><code>docker --version</code>
<code>docker-compose --version</code>
</pre> 
<p></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/e2/55/ItUN6JgR_o.png"></p> 
<p></p> 
<p><strong>2、测试网络</strong></p> 
<p></p> 
<p>然后我们检查测试网络是否存在：</p> 
<p></p> 
<ul><li></ul> 
<pre><code>./network.sh -h</code>
</pre> 
<p></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/da/ce/rG0csF5a_o.png"></p> 
<p></p> 
<p>上面这个命令是打印帮助文档，把测试网络所有可用的功能都打印出来。</p> 
<p></p> 
<p>如果这个过程出现问题，大家可以在下面这篇文章查找解决方案：</p> 
<p></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/ca/d9/BwgXdYHW_o.png"></p> 
<p>区块链 | Hyperledger Fabric 02 超详细图解——Fabric2.3.3安装及常见报错解决方案</p> 
<p></p> 
<h3>3、安装go</h3> 
<p></p> 
<p>前面我们没有安装go，这是因为前面我们只是安装配置fabric，go并不是必须的。</p> 
<p></p> 
<p>现在我们要开始运行链码，即联盟链中的智能合约，官网中给的示例是go语言开发的。如果大家有其他语言的开发经验，如Java，可以跳过这个步骤。</p> 
<p></p> 
<p>首先我们需要下载go的安装包：</p> 
<p></p> 
<ul><li></ul> 
<pre><code>https://studygolang.com/dl</code>
</pre> 
<p></p> 
<p><strong>大家也可以</strong><strong>在我的公众号【</strong><strong>AI与区块链技术</strong><strong>】回复</strong><strong>go</strong><strong>下载。</strong></p> 
<p></p> 
<p>下载好之后，我们将其解压，然后将其移动到local文件夹：</p> 
<p></p> 
<ul><li><li></ul> 
<pre><code>tar -zxvf go1.17.2.linux-amd64.tar.gz</code>
<code>sudo mv go /usr/local/</code>
</pre> 
<p></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/24/a3/QvYfzGJ7_o.png"></p> 
<p></p> 
<p>接下来我们配置一下环境变量，首先我们打开环境变量文件：</p> 
<p></p> 
<ul><li></ul> 
<pre><code>sudo gedit ~/.profile</code>
</pre> 
<p></p> 
<p>下面的提示是已经完成了更改后的警告：</p> 
<p> </p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/03/b3/fTcUReZx_o.png"></p> 
<p></p> 
<p>然后我们在最后添加：</p> 
<p></p> 
<ul><li><li><li></ul> 
<pre><code>export GOROOT=/usr/local/go</code>
<code>export GOPATH=$HOME/go</code>
<code>export PATH=$GOPATH/bin:$GOROOT/bin:$PATH</code>
</pre> 
<p></p> 
<p>然后点击save保存并关闭。</p> 
<p></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/33/c7/WGFVDdvy_o.png"></p> 
<p></p> 
<p>然后我们重新加载一下新的环境变量：</p> 
<p></p> 
<ul><li></ul> 
<pre><code>source ~/.profile</code>
</pre> 
<p></p> 
<p>接下来我们查看我们安装的版本，检测是否安装成功：</p> 
<p></p> 
<ul><li></ul> 
<pre><code>go version</code>
</pre> 
<p></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/d0/98/HqW7q2w7_o.png"></p> 
<p></p> 
<p>2</p> 
<p>运行Fabric案例</p> 
<p></p> 
<p></p> 
<h3>1、打开测试网络</h3> 
<p></p> 
<p>这个操作，上一篇文章我们已经讲过，执行过程中可能会出现问题，如果遇到问题，大家可以查阅上一篇文章，在这里，我们只说流程。报错及解决方案在这里就不赘述了。</p> 
<p></p> 
<p>首先我们先切换到我们的fabric-samples下的 test-network 文件夹，用这里的代码来测试网络。</p> 
<p></p> 
<ul><li></ul> 
<pre><code>cd fabric-samples/test-network</code>
</pre> 
<p></p> 
<p>或者我们可以直接在test-network文件夹下打开终端，在这个文件夹下，我们能找到一个network.sh文件。我们使用如下命令运行这个文件，用以打开我们的网络：</p> 
<p></p> 
<ul><li></ul> 
<pre><code>./network.sh up</code>
</pre> 
<p></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/73/a2/qH73OGUp_o.png"></p> 
<p></p> 
<p>出现上面的界面，就说我们打开没有问题了。</p> 
<p></p> 
<p>我们把后面的内容复制下来，这样，最后面的信息会更加清晰，格式也更加美观：</p> 
<p></p> 
<ul><li><li><li><li><li><li><li><li><li><li><li><li><li></ul> 
<pre><code>Creating network "fabric_test" with the default driver</code>
<code>Creating volume "docker_orderer.example.com" with default driver</code>
<code>Creating volume "docker_peer0.org1.example.com" with default driver</code>
<code>Creating volume "docker_peer0.org2.example.com" with default driver</code>
<code>Creating orderer.example.com    ... done</code>
<code>Creating peer0.org1.example.com ... done</code>
<code>Creating peer0.org2.example.com ... done</code>
<code>Creating cli                    ... done</code>
<code>CONTAINER ID   IMAGE                               COMMAND             CREATED          STATUS                  PORTS                                                                                                                                 NAMES</code>
<code>23bf079fc362   hyperledger/fabric-tools:latest     "/bin/bash"         3 seconds ago    Up Less than a second                                                                                                                                         cli</code>
<code>4170f2a781a1   hyperledger/fabric-peer:latest      "peer node start"   16 seconds ago   Up 3 seconds            0.0.0.0:7051-&gt;7051/tcp, :::7051-&gt;7051/tcp, 0.0.0.0:17051-&gt;17051/tcp, :::17051-&gt;17051/tcp                                              peer0.org1.example.com</code>
<code>f1cfa1e57865   hyperledger/fabric-peer:latest      "peer node start"   16 seconds ago   Up 3 seconds            0.0.0.0:9051-&gt;9051/tcp, :::9051-&gt;9051/tcp, 7051/tcp, 0.0.0.0:19051-&gt;19051/tcp, :::19051-&gt;19051/tcp                                    peer0.org2.example.com</code>
<code>81dcce22fc01   hyperledger/fabric-orderer:latest   "orderer"           16 seconds ago   Up 3 seconds            0.0.0.0:7050-&gt;7050/tcp, :::7050-&gt;7050/tcp, 0.0.0.0:7053-&gt;7053/tcp, :::7053-&gt;7053/tcp, 0.0.0.0:17050-&gt;17050/tcp, :::17050-&gt;17050/tcp   orderer.example.com</code>
</pre> 
<p></p> 
<p>下面我们详细说明一下这些内容。</p> 
<p></p> 
<h3>2、查看容器</h3> 
<p></p> 
<p>通过上面的结果，我们发现，一共创建了4个容器，我们可以使用如下命令去查看所有的容器：</p> 
<p></p> 
<ul><li></ul> 
<pre><code>docker ps -a</code>
</pre> 
<p></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/c0/51/IRVxeA9T_o.png"></p> 
<p></p> 
<p>我们将其复制下来，会发现和我们上面的是对应的：</p> 
<p></p> 
<ul><li><li><li><li><li></ul> 
<pre><code>CONTAINER ID   IMAGE                               COMMAND             CREATED         STATUS         PORTS                                                                                                                                 NAMES</code>
<code>23bf079fc362   hyperledger/fabric-tools:latest     "/bin/bash"         4 minutes ago   Up 4 minutes                                                                                                                                         cli</code>
<code>4170f2a781a1   hyperledger/fabric-peer:latest      "peer node start"   4 minutes ago   Up 4 minutes   0.0.0.0:7051-&gt;7051/tcp, :::7051-&gt;7051/tcp, 0.0.0.0:17051-&gt;17051/tcp, :::17051-&gt;17051/tcp                                              peer0.org1.example.com</code>
<code>f1cfa1e57865   hyperledger/fabric-peer:latest      "peer node start"   4 minutes ago   Up 4 minutes   0.0.0.0:9051-&gt;9051/tcp, :::9051-&gt;9051/tcp, 7051/tcp, 0.0.0.0:19051-&gt;19051/tcp, :::19051-&gt;19051/tcp                                    peer0.org2.example.com</code>
<code>81dcce22fc01   hyperledger/fabric-orderer:latest   "orderer"           4 minutes ago   Up 4 minutes   0.0.0.0:7050-&gt;7050/tcp, :::7050-&gt;7050/tcp, 0.0.0.0:7053-&gt;7053/tcp, :::7053-&gt;7053/tcp, 0.0.0.0:17050-&gt;17050/tcp, :::17050-&gt;17050/tcp   orderer.example.com</code>
</pre> 
<p></p> 
<p>这四个容器分别存储不同的节点：</p> 
<p></p> 
<p>1、其中第一个是<strong>客户端节点</strong>（cli），客户端节点本质上也是一个对等节点。</p> 
<p></p> 
<p>2、中间两个是<strong>peer节点（对等节点） </strong>用于存储区块链账本并在进行交易之前对其进行验证，同行运行包含业务用于管理区块链账本的智能合约上的业务逻辑；两个对等节点如下：</p> 
<p></p> 
<ul><li><li></ul> 
<pre><code>Org1 (peer0.org1.example.com) </code>
<code>Org2 (peer0.org2.example.com)</code>
</pre> 
<p>3、最后一个是<strong>排序节点</strong>（orderer.example.com），用于维护网络排序服务。</p> 
<p></p> 
<p>每个节点和用户都必须属于一个网络成员的组织。 在测试网络中，每个组织都只产生一个节点，这一个节点会独立表示一个组织，<strong>后面的讲解中，对于概念和理论的讲解我们会使用组织，对代码的说明我们使用节点</strong>。Fabric网络成员的所有组织通常称为<strong>联盟</strong>(consortium)。</p> 
<p></p> 
<p><strong>与传统公链不同，联盟链Fabric网络需要一个排序服务</strong>。对等组织只负责验证交易并将交易块添加到区块链账本，他们不决定交易顺序或包含他们进入新的区块。在分布式网络上，对等组织中的节点经常分布很远且可能具有很大的差异，并且对何时创建事务难以达成共识。也就是说，在交易顺序上达成共识是一个代价高昂的过程，这会为其他对等节点增加开销。排序服务允许对等组织中的节点专注于验证交易并将它们提交到账本。排序节点从客户那里收到认可的交易后，他们就交易顺序达成共识，然后添加区块。这样会极大地提高效率。这些区块之后被分配给添加这些区块到账本的对等节点。</p> 
<p></p> 
<p>排序组织还可以操作定义Fabric网络的功能的系统通道，例如如何制作块以及节点可以使用的Fabric版本。系统通道定义了哪个组织是该联盟的成员。</p> 
<p></p> 
<p>在上面的测试网络中使用一个排序节点（orderer.example.com）运行Raft排序服务，该服务由排序组织运行。但是在一个真实的网络将有多个排序节点，不同的排序节点将使用<strong>Raft共识算法</strong>达成跨交易顺序的共识网络。</p> 
<p></p> 
<h3>3、创建通道</h3> 
<p></p> 
<p>接下来我们需要创建用于对等节点之间进行交易的Fabric通道。 </p> 
<p></p> 
<p><strong>通道是特定网络成员之间的专用通信层</strong>。通道只能由被邀请加入通道的组织使用，并且对网络的其他成员不可见。每个通道都有一个单独的区块链账本。被邀请的组织“加入”他们的对等节点来存储其通道账本并验证交易。</p> 
<p></p> 
<p>首先就是默认创建方式：</p> 
<p></p> 
<ul><li></ul> 
<pre><code>./network.sh createChannel</code>
</pre> 
<p></p> 
<p>这种方式会创建名为mychannel的通道：</p> 
<p></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/91/4b/bUdfvYjO_o.png"></p> 
<p></p> 
<p>这个命令执行会有特别长的输出，并且会自动将两个peer节点添加到通道中：</p> 
<p></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/9c/7f/KblW4XdZ_o.png"></p> 
<p></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/87/ba/bsagT3yl_o.png"></p> 
<p></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/51/c1/OeJIcpxh_o.png"></p> 
<p></p> 
<p>如果我们想自己自定义通道名称，我们可以使用如下命令，其中channel1是通道名称：</p> 
<p></p> 
<ul><li></ul> 
<pre><code>./network.sh createChannel -c channel1</code>
</pre> 
<p></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/e2/dc/PBgDGykt_o.png"></p> 
<p></p> 
<p>这两个通道除了名称不同，其他都是相通的，包括通道中的节点（因为我们目前只有两个peer节点）。也就是说，是允许多个节点或者多个组织之间存在多个通道的。</p> 
<p></p> 
<p>接下来我们继续创建一个通道：</p> 
<p></p> 
<ul><li></ul> 
<pre><code>./network.sh createChannel -c channel2</code>
</pre> 
<p></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/b9/d8/xXBOvKBF_o.png"></p> 
<p></p> 
<p>最后我们可以在文件夹下发现新建了一个channel-artifacts文件夹，里面有三个通道文件：</p> 
<p></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/6a/33/u3cKF7Kt_o.png"></p> 
<p></p> 
<p>我们也可以在开启网络的时候，就直接同步创建通道：</p> 
<p></p> 
<ul><li></ul> 
<pre><code>./network.sh up createChannel</code>
</pre> 
<p></p> 
<h3>4、链码测试</h3> 
<p></p> 
<p>做完了上面的，我们就可以来测试一下链码啦！</p> 
<p></p> 
<p>注意，默认情况下，脚本安装Go版本的 asset-transfer (basic) 链码。但是大家可以使用语言便签 <code>-l</code><br> ，用于安装 Java 或 javascript 版本的链码。我们可以在 fabric-samples 目录的 asset-transfer-basic 文件夹中找到 asset-transfer (basic) 链码。此目录包含作为案例和用来突显 Fabric 特征的样本链码。</p> 
<p></p> 
<p>我们执行如下命令：</p> 
<p></p> 
<ul><li></ul> 
<pre><code>./network.sh deployCC -ccn basic -ccp ../asset-transfer-basic/chaincode-go -ccl go</code>
</pre> 
<p></p> 
<p>但是会有如下报错：</p> 
<p></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/b3/4c/1s6SVh6i_o.png"></p> 
<p></p> 
<p>首先我们先检查自己是否成功安装go，如果成功安装，那就需要检查我们的网络是否连接了。</p> 
<p></p> 
<p>最简单的方法就是在看右上角的的网络连接，或者系统中打开网页，如果无法成功打开，则说明网络有问题，我们在主机中Win+R 打开services.msc。</p> 
<p></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/63/99/647376l0_o.png"></p> 
<p></p> 
<p>然后找到虚拟机网络服务，让他们重新运行。</p> 
<p></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/83/08/imEcUfKc_o.png"></p> 
<p></p> 
<p>接下来大家可以再次尝试，如果不行，那就需要更换代理，我们输入如下两条命令：</p> 
<p></p> 
<ul><li><li></ul> 
<pre><code>go env -w GOPROXY=https://goproxy.io,direct</code>
<code>go env -w GO111MODULE=on</code>
</pre> 
<p></p> 
<p>然后再执行。</p> 
<p></p> 
<p>如果产生如下错误：</p> 
<p></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/f7/1c/sBTgFQ41_o.png"></p> 
<p></p> 
<ul><li><li><li></ul> 
<pre><code>Error: chaincode install failed with status: 500 - failed to invoke backing implementation of 'InstallChaincode': chaincode already successfully installed</code>
<code>Chaincode installation on peer0.org1 has failed</code>
<code>Deploying chaincode failed</code>
</pre> 
<p></p> 
<p>我们首先关掉这个测试网络：</p> 
<p></p> 
<ul><li></ul> 
<pre><code>./network.sh down</code>
</pre> 
<p></p> 
<p>然后我们再重新开启并创建通道：</p> 
<p></p> 
<ul><li></ul> 
<pre><code>./network.sh up createChannel</code>
</pre> 
<p></p> 
<p>也就是把前面的所有流程重新来一遍。</p> 
<p></p> 
<p>然后我们就可以执行了：</p> 
<p></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/8f/87/9ebUYpN4_o.png"></p> 
<p></p> 
<h3>5、与网络交互</h3> 
<p></p> 
<p>完成上面的操作后，我们就可以使用客户端节点来和网络交互啦！我们可以通过客户端节点调用已部署的智能合约，更新通道，或安装和部署新的智能合约。</p> 
<p></p> 
<p><strong>1、基本配置</strong></p> 
<p></p> 
<p>首先我们需要做一些基本配置，我们把peer的二进制文件添加到客户端节点路径中：</p> 
<p></p> 
<ul><li></ul> 
<pre><code>export PATH=${PWD}/../bin:$PATH</code>
</pre> 
<p></p> 
<p>然后我们将fabric-samples代码库中的FABRIC_CFG_PATH设置为指向其中的core.yaml文件：</p> 
<p></p> 
<ul><li></ul> 
<pre><code>export FABRIC_CFG_PATH=$PWD/../config/</code>
</pre> 
<p></p> 
<p>执行结果如下：</p> 
<p></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/b0/96/kFbeqksS_o.png"></p> 
<p></p> 
<p><strong>2、组织1配置</strong></p> 
<p></p> 
<p>然后我们需要配置组织1的环境，全部命令如下：</p> 
<p></p> 
<ul><li><li><li><li><li></ul> 
<pre><code>export CORE_PEER_TLS_ENABLED=true</code>
<code>export CORE_PEER_LOCALMSPID="Org1MSP"</code>
<code>export CORE_PEER_TLS_ROOTCERT_FILE=${PWD}/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt</code>
<code>export CORE_PEER_MSPCONFIGPATH=${PWD}/organizations/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp</code>
<code>export CORE_PEER_ADDRESS=localhost:7051</code>
</pre> 
<p></p> 
<p>我们需要在终端中依次执行：</p> 
<p></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/f9/5e/yxpg7IpZ_o.png"></p> 
<p></p> 
<p><strong>3、组织1进行账本操作</strong></p> 
<p></p> 
<p>我们运行以下命令用一些资产来初始化账本：</p> 
<p></p> 
<ul><li></ul> 
<pre><code>peer chaincode invoke -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile ${PWD}/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n basic --peerAddresses localhost:7051 --tlsRootCertFiles ${PWD}/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt --peerAddresses localhost:9051 --tlsRootCertFiles ${PWD}/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt -c '{"function":"InitLedger","Args":[]}'</code>
</pre> 
<p></p> 
<p>为了方便大家观看，我们整理一下格式：</p> 
<p></p> 
<ul><li><li><li><li><li><li><li><li><li><li><li><li></ul> 
<pre><code>peer chaincode invoke </code>
<code>-o localhost:7050 </code>
<code>--ordererTLSHostnameOverride orderer.example.com </code>
<code>--tls </code>
<code>--cafile ${PWD}/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem </code>
<code>-C mychannel </code>
<code>-n basic </code>
<code>--peerAddresses localhost:7051 </code>
<code>--tlsRootCertFiles ${PWD}/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt </code>
<code>--peerAddresses localhost:9051 </code>
<code>--tlsRootCertFiles ${PWD}/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt </code>
<code>-c '{"function":"InitLedger","Args":[]}'</code>
</pre> 
<p></p> 
<p>我们会得到如下输出：</p> 
<p></p> 
<ul><li></ul> 
<pre><code>2021-10-26 23:12:37.939 CST [chaincodeCmd] chaincodeInvokeOrQuery -&gt; INFO 001 Chaincode invoke successful. result: status:200 </code>
</pre> 
<p></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/bb/e4/FfVzwUPo_o.png"></p> 
<p></p> 
<p>接下来我们用客户端工具来查询账本。运行以下指令来获取添加到通道账本的资产列表：</p> 
<p></p> 
<ul><li></ul> 
<pre><code>peer chaincode query -C mychannel -n basic -c '{"Args":["GetAllAssets"]}'</code>
</pre> 
<p></p> 
<p>我们会得到如下输出：</p> 
<p></p> 
<ul><li><li><li><li><li><li><li><li></ul> 
<pre><code>[</code>
<code>  {"AppraisedValue":300,"Color":"blue","ID":"asset1","Owner":"Tomoko","Size":5},</code>
<code>  {"AppraisedValue":400,"Color":"red","ID":"asset2","Owner":"Brad","Size":5},</code>
<code>  {"AppraisedValue":500,"Color":"green","ID":"asset3","Owner":"Jin Soo","Size":10},</code>
<code>  {"AppraisedValue":600,"Color":"yellow","ID":"asset4","Owner":"Max","Size":10},</code>
<code>  {"AppraisedValue":700,"Color":"black","ID":"asset5","Owner":"Adriana","Size":15},</code>
<code>  {"AppraisedValue":800,"Color":"white","ID":"asset6","Owner":"Michel","Size":15}</code>
<code>]</code>
</pre> 
<p></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/1b/2d/lXYldjXc_o.png"></p> 
<p></p> 
<p>当一个网络成员希望在账本上转账或者改变资产时，我们需要调用 asset-transfer (basic) 链码改变账本上的资产所有者，因为 asset-transfer (basic) 链码的背书策略需要交易同时被 Org1 和 Org2 签名，链码调用指令需要使用 --peerAddresses 标签来指向如下两个地址：</p> 
<p></p> 
<ul><li><li></ul> 
<pre><code>peer0.org1.example.com</code>
<code>peer0.org2.example.com</code>
</pre> 
<p></p> 
<p>命令如下：</p> 
<p></p> 
<ul><li></ul> 
<pre><code>peer chaincode invoke -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile ${PWD}/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n basic --peerAddresses localhost:7051 --tlsRootCertFiles ${PWD}/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt --peerAddresses localhost:9051 --tlsRootCertFiles ${PWD}/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt -c '{"function":"TransferAsset","Args":["asset6","Christopher"]}'</code>
</pre> 
<p></p> 
<p>和前面类似，我们会得到下面的结果：</p> 
<p></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/ba/b1/uIbtOp7D_o.png"></p> 
<p></p> 
<p><strong>4、组织2配置</strong></p> 
<p></p> 
<p>调用链码之后，我们可以使用另一个查询来查看调用如何改变了区块链账本的资产。因为我们已经查询了 Org1 的 peer，我们可以把这个查询链码的机会通过 Org2 的 peer 来运行。设置以下的环境变量来操作 Org2：</p> 
<p></p> 
<ul><li><li><li><li><li></ul> 
<pre><code>export CORE_PEER_TLS_ENABLED=true</code>
<code>export CORE_PEER_LOCALMSPID="Org2MSP"</code>
<code>export CORE_PEER_TLS_ROOTCERT_FILE=${PWD}/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt</code>
<code>export CORE_PEER_MSPCONFIGPATH=${PWD}/organizations/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp</code>
<code>export CORE_PEER_ADDRESS=localhost:9051</code>
</pre> 
<p></p> 
<p>执行结果如下：</p> 
<p></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/f9/ac/0EIyFNaq_o.png"></p> 
<p></p> 
<p><strong>5、结果查询</strong></p> 
<p></p> 
<p>我们可以查询运行在 peer0.org2.example.com asset-transfer (basic) 链码：</p> 
<p></p> 
<ul><li></ul> 
<pre><code>peer chaincode query -C mychannel -n basic -c '{"Args":["ReadAsset","asset6"]}'</code>
</pre> 
<p></p> 
<p>执行结果如下：</p> 
<p></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/4e/9a/bkwdRjYo_o.png"></p> 
<p></p> 
<h3>6、关闭网络</h3> 
<p></p> 
<p>到这里，我们测试网络的基本操作就完成啦，通过这个测试网络，我们就能大致了解联盟链的工作流程和参与的实体。最后我们将我们测试的网络关闭即可：</p> 
<p></p> 
<ul><li></ul> 
<pre><code>./network.sh down</code>
</pre> 
<p></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/1d/f4/6TIiuGa7_o.png"></p> 
<p></p> 
<p>3</p> 
<p>说在后面的话</p> 
<p></p> 
<p></p> 
<p>到这里，我们就了解了联盟链的基本概念，了解了Hyperledger Fabric的基本原理，安装与配置以及执行细节。在未来，我们会更加深入学习相关的知识。</p> 
<p></p> 
<p>一起加油啦！</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e8fedcd9480e28cc43e45b43137d01f4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">win11电脑锁定触摸板或无鼠标打开触摸板</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f95c6a49e45f87d09ee5f8b2c4a3f275/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【PyTorch实战】图像描述——让神经网络看图讲故事</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>