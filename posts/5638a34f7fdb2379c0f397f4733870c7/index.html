<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Qualcomm® AI Engine Direct 使用手册（18） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Qualcomm® AI Engine Direct 使用手册（18）" />
<meta property="og:description" content="Qualcomm® AI Engine Direct 使用手册（18） 6.4 分析6.4.1 qnn-量化-检查器（实验）6.4.2 qnn-accuracy-evaluator（实验） 6.4 分析 6.4.1 qnn-量化-检查器（实验） qnn-quantization-checker工具用于分析 qnn-converter 中单个模型文件或模型目录的每个后续层可用的所有可能量化选项的激活、权重和偏差。分析涉及将量化选项的权重、偏差和激活张量与未量化选项进行比较。该工具运行模型来生成浮点激活并分析浮点权重、偏差和激活以确定编码的质量。它最终输出所有量化选项的有问题的权重、偏差和激活张量。
X86-Linux/ WSL Usage: qnn-quantization-checker [--model MODEL_PATH] [--input_list INPUT_LIST_PATH] [--activation_width ACT_BW] [--bias_width BIAS_BW] [--output_dir OUTPUT_DIR_PATH] [--skip_building_model] [--skip_generator] [--skip_runner] [--generate_histogram] [--per_channel_histogram] [--output_csv] --config_file CONFIG_FILE_PATH X86-Windows/ Windows on Snapdragon Usage: python qnn-quantization-checker [--model MODEL_PATH] [--input_list INPUT_LIST_PATH] [--activation_width ACT_BW] [--bias_width BIAS_BW] [--output_dir OUTPUT_DIR_PATH] [--skip_building_model] [--skip_generator] [--skip_runner] [--generate_histogram] [--per_channel_histogram] [--output_csv] --config_file CONFIG_FILE_PATH 所需参数：
–config_file - 配置文件的路径，指定执行所需的所有可能选项。
例如，[RUN_IN_REPAIR_MODE、MODEL_PATH、INPUT_LIST_PATH、ACTIVATION_WIDTH、BIAS_WIDTH、WEIGHT_WIDTH、INPUT_LAYOUT、OUTPUT_DIR_PATH、CLANG_PATH、BASH_PATH、BIN_PATH、PY3_PATH、TENSORFLOW_HOME、TFLITE_HOME、ONNX_HOME、QUANTIZATION_OVERRIDES、 WEIGHT_COMPARISON_ALGORITHMS、BIAS_COMPARISON_ALGORITHMS、ACT_COMPARISON_ALGORITHMS、INPUT_DATA_ANALYSIS_ALGORITHMS、OUTPUT_CSV、GENERATE_HISTOGRAM、QUANTIZATION_VARIATIONS、QUANTIZATION_ALGORITHMS ]" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/5638a34f7fdb2379c0f397f4733870c7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-04T14:54:34+08:00" />
<meta property="article:modified_time" content="2024-01-04T14:54:34+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Qualcomm® AI Engine Direct 使用手册（18）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>Qualcomm® AI Engine Direct 使用手册（18）</h4> 
 <ul><li><ul><li><a href="#64__4" rel="nofollow">6.4 分析</a></li><li><ul><li><a href="#641_qnn_6" rel="nofollow">6.4.1 qnn-量化-检查器（实验）</a></li><li><a href="#642_qnnaccuracyevaluator_234" rel="nofollow">6.4.2 qnn-accuracy-evaluator（实验）</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<hr> 
<h3><a id="64__4"></a>6.4 分析</h3> 
<h4><a id="641_qnn_6"></a>6.4.1 qnn-量化-检查器（实验）</h4> 
<p>qnn-quantization-checker工具用于分析 qnn-converter 中单个模型文件或模型目录的每个后续层可用的所有可能量化选项的激活、权重和偏差。分析涉及将量化选项的权重、偏差和激活张量与未量化选项进行比较。该工具运行模型来生成浮点激活并分析浮点权重、偏差和激活以确定编码的质量。它最终输出所有量化选项的有问题的权重、偏差和激活张量。</p> 
<pre><code class="prism language-c">X86<span class="token operator">-</span>Linux<span class="token operator">/</span> WSL Usage<span class="token operator">:</span> qnn<span class="token operator">-</span>quantization<span class="token operator">-</span>checker <span class="token punctuation">[</span><span class="token operator">--</span>model MODEL_PATH<span class="token punctuation">]</span>
                                <span class="token punctuation">[</span><span class="token operator">--</span>input_list INPUT_LIST_PATH<span class="token punctuation">]</span>
                                <span class="token punctuation">[</span><span class="token operator">--</span>activation_width ACT_BW<span class="token punctuation">]</span>
                                <span class="token punctuation">[</span><span class="token operator">--</span>bias_width BIAS_BW<span class="token punctuation">]</span>
                                <span class="token punctuation">[</span><span class="token operator">--</span>output_dir OUTPUT_DIR_PATH<span class="token punctuation">]</span>
                                <span class="token punctuation">[</span><span class="token operator">--</span>skip_building_model<span class="token punctuation">]</span>
                                <span class="token punctuation">[</span><span class="token operator">--</span>skip_generator<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">--</span>skip_runner<span class="token punctuation">]</span>
                                <span class="token punctuation">[</span><span class="token operator">--</span>generate_histogram<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">--</span>per_channel_histogram<span class="token punctuation">]</span>
                                <span class="token punctuation">[</span><span class="token operator">--</span>output_csv<span class="token punctuation">]</span>
                                <span class="token operator">--</span>config_file CONFIG_FILE_PATH

X86<span class="token operator">-</span>Windows<span class="token operator">/</span> Windows on Snapdragon Usage<span class="token operator">:</span> python qnn<span class="token operator">-</span>quantization<span class="token operator">-</span>checker <span class="token punctuation">[</span><span class="token operator">--</span>model MODEL_PATH<span class="token punctuation">]</span>
                                <span class="token punctuation">[</span><span class="token operator">--</span>input_list INPUT_LIST_PATH<span class="token punctuation">]</span>
                                <span class="token punctuation">[</span><span class="token operator">--</span>activation_width ACT_BW<span class="token punctuation">]</span>
                                <span class="token punctuation">[</span><span class="token operator">--</span>bias_width BIAS_BW<span class="token punctuation">]</span>
                                <span class="token punctuation">[</span><span class="token operator">--</span>output_dir OUTPUT_DIR_PATH<span class="token punctuation">]</span>
                                <span class="token punctuation">[</span><span class="token operator">--</span>skip_building_model<span class="token punctuation">]</span>
                                <span class="token punctuation">[</span><span class="token operator">--</span>skip_generator<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">--</span>skip_runner<span class="token punctuation">]</span>
                                <span class="token punctuation">[</span><span class="token operator">--</span>generate_histogram<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">--</span>per_channel_histogram<span class="token punctuation">]</span>
                                <span class="token punctuation">[</span><span class="token operator">--</span>output_csv<span class="token punctuation">]</span>
                                <span class="token operator">--</span>config_file CONFIG_FILE_PATH

</code></pre> 
<p><strong>所需参数：</strong><br> –config_file - 配置文件的路径，指定执行所需的所有可能选项。<br> 例如，[RUN_IN_REPAIR_MODE、MODEL_PATH、INPUT_LIST_PATH、ACTIVATION_WIDTH、BIAS_WIDTH、WEIGHT_WIDTH、INPUT_LAYOUT、OUTPUT_DIR_PATH、CLANG_PATH、BASH_PATH、BIN_PATH、PY3_PATH、TENSORFLOW_HOME、TFLITE_HOME、ONNX_HOME、QUANTIZATION_OVERRIDES、 WEIGHT_COMPARISON_ALGORITHMS、BIAS_COMPARISON_ALGORITHMS、ACT_COMPARISON_ALGORITHMS、INPUT_DATA_ANALYSIS_ALGORITHMS、OUTPUT_CSV、GENERATE_HISTOGRAM、QUANTIZATION_VARIATIONS、QUANTIZATION_ALGORITHMS ]</p> 
<p><strong>可选参数：</strong><br> –model - 模型图形文件的路径，如果配置文件中未设置 MODEL_PATH，则需要此参数。–input_list - 包含输入文件列表的文本文件的路径。如果 MODEL_PATH/model 引用单个模型文件并且 INPUT_LIST_PATH 不存在于配置文件中，则这是必需的。–activation_width - [可选] 用于激活的位宽度。例如，8、16。默认值为 8。也可以使用 config_file 中的 ACTIVATION_WIDTH 字段进行设置。–bias_width - [可选] 用于偏差的位宽度。例如，8、32。默认为8。也可以使用config_file 中的BIAS_WIDTH 进行设置。–output_dir - [可选] 存储未量化输出文件的路径。也可以使用 config_file 中的 OUTPUT_DIR_PATH 进行设置。–skip_building_model - [可选] 停止工具构建模型。假设 model.so 是预先构建的。–skip_generator - [可选] 停止工具运行 QNN 转换器。假设必要的文件已经可用。–skip_runner - [可选] 停止工具运行模型。假设必要的文件已经可用。–generate_histogram - [可选] 生成权重/偏差的直方图分析。默认是跳过 histgoram 生成。–per_channel_histogram - [可选] 生成每个通道的权重/偏差直方图分析。默认是跳过 histgoram 生成。–output_csv - [可选] 将分析结果存储在输出目录中的 csv 文件中。</p> 
<p>请注意：如果存在重叠，命令行上接受的参数将覆盖配置文件中的参数。</p> 
<p>以下是配置文件中提到的不同算法和阈值的示例：</p> 
<pre><code class="prism language-cpp"><span class="token punctuation">{<!-- --></span>
   <span class="token comment">// All other required user options can be added here</span>

   <span class="token string">"WEIGHT_COMPARISON_ALGORITHMS"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"algo_name"</span><span class="token operator">:</span><span class="token string">"minmax"</span><span class="token punctuation">,</span> <span class="token string">"threshold"</span><span class="token operator">:</span><span class="token string">"10"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">"algo_name"</span><span class="token operator">:</span><span class="token string">"maxdiff"</span><span class="token punctuation">,</span> <span class="token string">"threshold"</span><span class="token operator">:</span><span class="token string">"10"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">"algo_name"</span><span class="token operator">:</span><span class="token string">"sqnr"</span><span class="token punctuation">,</span> <span class="token string">"threshold"</span><span class="token operator">:</span><span class="token string">"26"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">"algo_name"</span><span class="token operator">:</span><span class="token string">"stats"</span><span class="token punctuation">,</span> <span class="token string">"threshold"</span><span class="token operator">:</span><span class="token string">"2"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">"algo_name"</span><span class="token operator">:</span><span class="token string">"data_range_analyzer"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">"algo_name"</span><span class="token operator">:</span><span class="token string">"data_distribution_analyzer"</span><span class="token punctuation">,</span> <span class="token string">"threshold"</span><span class="token operator">:</span><span class="token string">"0.6"</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token string">"BIAS_COMPARISON_ALGORITHMS"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"algo_name"</span><span class="token operator">:</span><span class="token string">"minmax"</span><span class="token punctuation">,</span> <span class="token string">"threshold"</span><span class="token operator">:</span><span class="token string">"10"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">"algo_name"</span><span class="token operator">:</span><span class="token string">"maxdiff"</span><span class="token punctuation">,</span> <span class="token string">"threshold"</span><span class="token operator">:</span><span class="token string">"10"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">"algo_name"</span><span class="token operator">:</span><span class="token string">"sqnr"</span><span class="token punctuation">,</span> <span class="token string">"threshold"</span><span class="token operator">:</span><span class="token string">"26"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">"algo_name"</span><span class="token operator">:</span><span class="token string">"stats"</span><span class="token punctuation">,</span> <span class="token string">"threshold"</span><span class="token operator">:</span><span class="token string">"2"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">"algo_name"</span><span class="token operator">:</span><span class="token string">"data_range_analyzer"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">"algo_name"</span><span class="token operator">:</span><span class="token string">"data_distribution_analyzer"</span><span class="token punctuation">,</span> <span class="token string">"threshold"</span><span class="token operator">:</span><span class="token string">"0.6"</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token string">"ACT_COMPARISON_ALGORITHMS"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"algo_name"</span><span class="token operator">:</span><span class="token string">"minmax"</span><span class="token punctuation">,</span> <span class="token string">"threshold"</span><span class="token operator">:</span><span class="token string">"10"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">"algo_name"</span><span class="token operator">:</span><span class="token string">"data_range_analyzer"</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>该工具生成一个html目录，其中包含所有 .html 文件，其中包含量化选项和输入文件的不同组合的失败和成功的明确指示符。该工具还生成一个csv目录，其中包含存储每个指标的详细计算结果的所有 .csv 文件。此外，该工具还会在qnn-quantization-checker-log目录下生成一个输出日志文件，其中包含所有日志输出。</p> 
<p>命令示例</p> 
<pre><code class="prism language-c">qnn<span class="token operator">-</span>quantization<span class="token operator">-</span>checker <span class="token operator">--</span>config_file $<span class="token punctuation">{<!-- --></span>SDK_ROOT<span class="token punctuation">}</span><span class="token operator">/</span>lib<span class="token operator">/</span>python<span class="token operator">/</span>qti<span class="token operator">/</span>aisw<span class="token operator">/</span>quantization_checker<span class="token operator">/</span>configs<span class="token operator">/</span>quant_checker_config_normal<span class="token punctuation">.</span>json

</code></pre> 
<p>示例配置文件</p> 
<pre><code class="prism language-c"><span class="token punctuation">{<!-- --></span>
<span class="token string">"CLANG_PATH"</span><span class="token operator">:</span> <span class="token string">"{Path_To_Clang_Lib}/clang-9.0.0/bin"</span><span class="token punctuation">,</span>
<span class="token string">"PY3_PATH"</span><span class="token operator">:</span> <span class="token string">"/{PY3_PATH}/py3env/bin"</span><span class="token punctuation">,</span>
<span class="token string">"BASH_PATH"</span><span class="token operator">:</span> <span class="token string">"/bin"</span><span class="token punctuation">,</span>
<span class="token string">"BIN_PATH"</span><span class="token operator">:</span> <span class="token string">"/usr/bin"</span><span class="token punctuation">,</span>
<span class="token string">"TENSORFLOW_HOME"</span><span class="token operator">:</span> <span class="token string">"/{Path_To_Tensorflow}/bionic/py3"</span><span class="token punctuation">,</span>
<span class="token string">"TFLITE_HOME"</span><span class="token operator">:</span> <span class="token string">"/{Path_To_TFLITE}/bionic/py3"</span><span class="token punctuation">,</span>
<span class="token string">"ONNX_HOME"</span><span class="token operator">:</span> <span class="token string">"/{Path_To_Onnx}/bionic/py3"</span><span class="token punctuation">,</span>
<span class="token string">"MODEL_PATH"</span><span class="token operator">:</span> <span class="token string">"/{Path_To_Model}/model_frozen.pb"</span><span class="token punctuation">,</span>
<span class="token string">"INPUT_LIST_PATH"</span><span class="token operator">:</span> <span class="token string">"/{Path_To_Input}/input_list.txt"</span><span class="token punctuation">,</span>
<span class="token string">"OUTPUT_DIR_PATH"</span><span class="token operator">:</span> <span class="token string">"{Path_To_Output_Dir}"</span>
<span class="token string">"WEIGHT_COMPARISON_ALGORITHMS"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"algo_name"</span><span class="token operator">:</span><span class="token string">"minmax"</span><span class="token punctuation">,</span> <span class="token string">"threshold"</span><span class="token operator">:</span><span class="token string">"10"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">"algo_name"</span><span class="token operator">:</span><span class="token string">"maxdiff"</span><span class="token punctuation">,</span> <span class="token string">"threshold"</span><span class="token operator">:</span><span class="token string">"10"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">"algo_name"</span><span class="token operator">:</span><span class="token string">"sqnr"</span><span class="token punctuation">,</span> <span class="token string">"threshold"</span><span class="token operator">:</span><span class="token string">"26"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">"algo_name"</span><span class="token operator">:</span><span class="token string">"stats"</span><span class="token punctuation">,</span> <span class="token string">"threshold"</span><span class="token operator">:</span><span class="token string">"2"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">"algo_name"</span><span class="token operator">:</span><span class="token string">"data_range_analyzer"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">"algo_name"</span><span class="token operator">:</span><span class="token string">"data_distribution_analyzer"</span><span class="token punctuation">,</span> <span class="token string">"threshold"</span><span class="token operator">:</span><span class="token string">"0.6"</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token string">"BIAS_COMPARISON_ALGORITHMS"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"algo_name"</span><span class="token operator">:</span><span class="token string">"minmax"</span><span class="token punctuation">,</span> <span class="token string">"threshold"</span><span class="token operator">:</span><span class="token string">"10"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">"algo_name"</span><span class="token operator">:</span><span class="token string">"maxdiff"</span><span class="token punctuation">,</span> <span class="token string">"threshold"</span><span class="token operator">:</span><span class="token string">"10"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">"algo_name"</span><span class="token operator">:</span><span class="token string">"sqnr"</span><span class="token punctuation">,</span> <span class="token string">"threshold"</span><span class="token operator">:</span><span class="token string">"26"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">"algo_name"</span><span class="token operator">:</span><span class="token string">"stats"</span><span class="token punctuation">,</span> <span class="token string">"threshold"</span><span class="token operator">:</span><span class="token string">"2"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">"algo_name"</span><span class="token operator">:</span><span class="token string">"data_range_analyzer"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">"algo_name"</span><span class="token operator">:</span><span class="token string">"data_distribution_analyzer"</span><span class="token punctuation">,</span> <span class="token string">"threshold"</span><span class="token operator">:</span><span class="token string">"0.6"</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token string">"ACT_COMPARISON_ALGORITHMS"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"algo_name"</span><span class="token operator">:</span><span class="token string">"minmax"</span><span class="token punctuation">,</span> <span class="token string">"threshold"</span><span class="token operator">:</span><span class="token string">"10"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">"algo_name"</span><span class="token operator">:</span><span class="token string">"data_range_analyzer"</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token string">"INPUT_DATA_ANALYSIS_ALGORITHMS"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"algo_name"</span><span class="token operator">:</span><span class="token string">"stats"</span><span class="token punctuation">,</span> <span class="token string">"threshold"</span><span class="token operator">:</span><span class="token string">"2"</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token string">"OUTPUT_CSV"</span><span class="token operator">:</span> <span class="token string">"True"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>查看结果（html、csv 或日志文件）<br> 所有结果都存储在用户指定目录下的输出目录中。</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">In user_specified_dir<span class="token punctuation">,</span> all <span class="token punctuation">.</span>html files are stored in </span><span class="token string">"user_specified_dir/html"</span><span class="token expression"><span class="token punctuation">,</span> <span class="token punctuation">.</span>csv files are stored in </span><span class="token string">"user_specified_dir/csv"</span> <span class="token expression">and log files are stored in </span><span class="token string">"user_specified_dir/snpe-quantization-checker-log"</span><span class="token expression"><span class="token punctuation">.</span></span></span>
cd $<span class="token punctuation">{<!-- --></span>Path_to_the_model<span class="token punctuation">}</span><span class="token operator">/</span>user_specified_dir<span class="token operator">/</span>html
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">This directory contains all the html files produced by the snpe<span class="token operator">-</span>quantization<span class="token operator">-</span>checker which can be opened with any standard web browser<span class="token punctuation">.</span></span></span>
cd $<span class="token punctuation">{<!-- --></span>Path_to_the_model<span class="token punctuation">}</span><span class="token operator">/</span>user_specified_dir<span class="token operator">/</span>csv
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">This directory contains all the csv files produced by the snpe<span class="token operator">-</span>quantization<span class="token operator">-</span>checker which can be viewed with any standard text editor or spreadsheet application such as Excel<span class="token punctuation">,</span> LibreOffice<span class="token punctuation">,</span> etc<span class="token punctuation">.</span></span></span>
cd $<span class="token punctuation">{<!-- --></span>Path_to_the_model<span class="token punctuation">}</span><span class="token operator">/</span>user_specified_dir<span class="token operator">/</span>snpe<span class="token operator">-</span>quantization<span class="token operator">-</span>checker<span class="token operator">-</span>log
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">This directory contains all the log files produced by the snpe<span class="token operator">-</span>quantization<span class="token operator">-</span>checker<span class="token punctuation">.</span> The files are time stamped and can be viewed in any text editor<span class="token punctuation">.</span></span></span>

If histogram generation is specified in the config file<span class="token punctuation">,</span> histogram analysis <span class="token keyword">for</span> weights and biases are also produced into the respective directories as followed<span class="token operator">:</span>
cd $<span class="token punctuation">{<!-- --></span>Path_to_the_model<span class="token punctuation">}</span><span class="token operator">/</span>user_specified_dir<span class="token operator">/</span>hist_analysis_weights
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">This directory contains all the png files representing pixelwise data distribution <span class="token keyword">for</span> unquantized and quantized weights<span class="token punctuation">.</span> The files can be viewed in any image viewer<span class="token punctuation">.</span></span></span>
cd $<span class="token punctuation">{<!-- --></span>Path_to_the_model<span class="token punctuation">}</span><span class="token operator">/</span>user_specified_dir<span class="token operator">/</span>hist_analysis_biases
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">This directory contains all the png files representing pixelwise data distribution <span class="token keyword">for</span> unquantized and quantized biases<span class="token punctuation">.</span> The files can be viewed in any image viewer<span class="token punctuation">.</span></span></span>

</code></pre> 
<p>HTML 结果文件<br> 每个 HTML 文件都包含每个量化选项和提供的每个输入文件的结果摘要。</p> 
<blockquote> 
 <p>笔记<br> 为了清晰起见，添加了 HTML 内容的快照。</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/f7/22/Pyz4zpmY_o.png" alt="请添加图片描述"><br> CSV 结果文件<br> 每个 CSV 文件包含特定节点类型（激活/权重/偏差）和量化选项的详细计算结果。csv 文件中的每一行显示操作名称、节点名称、传递精度（真/假）、计算结果（精度差异）、每个算法使用的阈值以及算法名称。根据不同的算法/指标，计算结果（精度差异）格式可能会有所不同。</p> 
<p>以下是有关不同算法和每个 csv 行包含的信息的一些简短说明：</p> 
<ul><li> <p>minmax：表示未量化最小值与反量化最小值之间的差异。相应地，表示最大未量化值和反量化值的差值相同。<br> 计算结果示例：“min: #VALUE max: #VALUE”</p> </li><li> <p>maxdiff：计算所有数据点的未量化和反量化数据之间的绝对差，并显示结果的最大值。<br> 计算结果示例：“#VALUE”</p> </li><li> <p>sqnr：计算未量化和反量化数据的两个张量之间的信号与量化噪声比。<br> 计算结果示例：“#VALUE”</p> </li><li> <p>data_range_analyzer：计算张量中最大值和最小值之间的差，并将其与位宽支持的最大值进行比较，以确定所选量化位宽是否可以合理地表示值的范围。<br> 计算结果示例：“唯一小数位数：#INT_VALUE 数据范围：#VALUE”。计算结果字段中的信息包括我们需要多少位唯一的小数位来以量化格式表达非量化数据以及实际的数据范围是多少。</p> </li><li> <p>data_distribution_analyzer：计算数据的聚类，以查找大量唯一的未量化值是否被量化为相同的值。<br> 计算结果示例：“高于阈值的像素分布：#VALUE”</p> </li><li> <p>stats：计算接收到的数据的一些基本统计数据，例如最小值、最大值、中值、方差、标准差、众数和偏斜。偏度用于指示数据的对称程度。<br> 计算结果示例： 偏斜：#VALUE 最小值：#VALUE 最大值：#VALUE 中值：#VALUE 方差：#VALUE stdDev:#VALUE 模式：#VALUE</p> </li></ul> 
<blockquote> 
 <p>笔记<br> 下面添加了量化选项之一的重量数据的 CSV 文件内容快照。<br> <img src="https://images2.imgbox.com/a2/29/IzLBZtpr_o.png" alt="请添加图片描述"><br> 单独的 .csv 文件可用于每个量化选项的激活、权重和偏差。与激活相关的结果还包括对所提供的每个输入文件的分析。</p> 
</blockquote> 
<p>记录结果文件<br> 日志文件包含以下信息：</p> 
<ol><li> <p>作为脚本运行的一部分执行的所有命令。这将包括具有不同量化选项的 qnn-converter 工具的不同运行</p> </li><li> <p>激活分析失败</p> </li><li> <p>权重分析失败</p> </li><li> <p>偏差分析失败</p> </li></ol> 
<p>示例日志输出如下所示：</p> 
<pre><code class="prism language-c"><span class="token operator">&lt;=</span><span class="token operator">==</span><span class="token operator">=</span>ACTIVATIONS ANALYSIS FAILURES<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">&gt;</span>

Results <span class="token keyword">for</span> the enhanced quantization<span class="token operator">:</span>
<span class="token operator">|</span>         Op Name         <span class="token operator">|</span> Activation Node <span class="token operator">|</span> Passes Accuracy <span class="token operator">|</span>         Accuracy Difference          <span class="token operator">|</span> Threshold Used <span class="token operator">|</span> Algorithm Used <span class="token operator">|</span>
<span class="token operator">|</span>  conv_tanh_comp1_conv0  <span class="token operator">|</span>    ReLU_6919    <span class="token operator">|</span>      False      <span class="token operator">|</span> minabs_diff<span class="token operator">:</span> <span class="token number">0.59</span> maxabs_diff<span class="token operator">:</span> <span class="token number">17.16</span> <span class="token operator">|</span>      <span class="token number">0.05</span>      <span class="token operator">|</span>     minmax     <span class="token operator">|</span>

</code></pre> 
<p>在哪里，</p> 
<ul><li> <p>Op Name：Op Name，如 qnn_model.cpp 中所示</p> </li><li> <p>激活节点：Op中的激活节点名称</p> </li><li> <p>通过准确性：如果与 float32 图表中的值相比，量化激活（或权重或偏差）满足阈值，则通过</p> </li><li> <p>准确度差异：有关所使用算法的准确度的详细信息</p> </li><li> <p>使用的阈值：用于影响“Passes Accuracy”列结果的阈值</p> </li><li> <p>使用的算法：用于将实际量化激活/权重/偏差与未量化浮点数据进行比较或分析未量化浮点数据质量的指标。指标可以是 minmax、maxdiff、sqnr、stats、data_range_analyzer、data_distribution_analyzer。</p> </li></ul> 
<p>修复模式<br> 此功能增加了“修复”图中由于量化而导致精度较差的节点的能力。该工具运行并识别由于量化而表现出较差精度的节点。根据违反的规则，确定纠正措施以提高性能（准确性）。然后使用所决定的纠正措施重新运行该工具，并再次评估节点以查看准确性是否有所提高。确定节点的性能是使用量化检查器工具中已使用的当前比较算法集来完成的。当前的实现仅限于增加表现最差的张量（权重、偏差或激活）的位宽，作为要采取的纠正措施，即“修复”。</p> 
<blockquote> 
 <p>笔记<br> 修复模式并不能保证准确性的提高，而只是尝试进行最简单的更改，从而为最终用户消除了一个额外的调试步骤。</p> 
</blockquote> 
<p>修复模式还通过向配置文件提供以下参数来支持手动模式：<br> RUN_IN_REPAIR_MODE 类型：布尔（真/假）<br> 描述：在修复模式下运行 [snpe, qnn]-quantization-checker。该模式将识别由于量化而表现出较差精度的节点，并进一步调整量化编码以提高所识别节点的精度。然后使用更新的编码值重新运行该工具，并在完成后给出准确性改进的报告。</p> 
<p>修复模式的输出示例：</p> 
<pre><code class="prism language-c">MINMAX<span class="token operator">:</span> Percentage of Failed Nodes

<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
<span class="token operator">|</span> Tensor Type <span class="token operator">|</span> unquantized <span class="token operator">|</span>         tf          <span class="token operator">|</span>       tf_cle        <span class="token operator">|</span>      tf_pcq         <span class="token operator">|</span>     tf_cle_pcq      <span class="token operator">|</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
<span class="token operator">|</span>   Weights   <span class="token operator">|</span>     N<span class="token operator">/</span>A     <span class="token operator">|</span>        <span class="token number">0.0</span>          <span class="token operator">|</span>         <span class="token number">0.0</span>         <span class="token operator">|</span>         <span class="token number">0.0</span>         <span class="token operator">|</span>         <span class="token number">0.0</span>         <span class="token operator">|</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
<span class="token operator">|</span>   Biases    <span class="token operator">|</span>     N<span class="token operator">/</span>A     <span class="token operator">|</span>        <span class="token number">0.0</span>          <span class="token operator">|</span>         <span class="token number">0.0</span>         <span class="token operator">|</span>         <span class="token number">0.0</span>         <span class="token operator">|</span>         <span class="token number">0.0</span>         <span class="token operator">|</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
<span class="token operator">|</span> Activations <span class="token operator">|</span>     N<span class="token operator">/</span>A     <span class="token operator">|</span> <span class="token number">0.11634671320535195</span> <span class="token operator">|</span> <span class="token number">0.11634671320535195</span> <span class="token operator">|</span> <span class="token number">0.11634671320535195</span> <span class="token operator">|</span> <span class="token number">0.11634671320535195</span> <span class="token operator">|</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>

</code></pre> 
<p>故障排除步骤<br> 以下步骤适用该工具有一些源自 snpe 二进制文件要求的要求/依赖项：</p> 
<ul><li> <p>必须安装 clang 9</p> </li><li> <p>必须使用 python 3 venv</p> </li><li> <p>必须安装 bash shell 解释器</p> </li><li> <p>根据正在分析的模型类型，必须至少安装以下框架之一：于使用该工具有困难的最终用户。这些是需要调查的常见领域，但并不全面。</p> 
  <ul><li> <p>Tensorflow</p> </li><li> <p>Onnx</p> </li><li> <p>TFLite</p> </li></ul> </li></ul> 
<p>此外，可以进行一些检查以确保模型在第一次尝试时运行：</p> 
<ul><li> <p>确保指定给要分析的模型的路径是正确的</p> </li><li> <p>确保输出目录的路径存在并且可写</p> </li><li> <p>使用提供的预定义配置文件并根据您的本地设置填写详细信息，即本地路径</p> </li><li> <p>该工具突出显示的故障可能是可接受的故障，具体取决于模型，由用户根据所分析的特定模型的用户知识来确定故障是否表明存在问题</p> </li><li> <p>python 错误通常是由于版本不匹配造成的，该工具仅适用于 Python 3.6 及更高版本，目前主要针对 Python 3.8</p> </li></ul> 
<h4><a id="642_qnnaccuracyevaluator_234"></a>6.4.2 qnn-accuracy-evaluator（实验）</h4> 
<p>qnn-accuracy-evaluator工具用于识别给定输入集上模型的最佳量化选项。此外，该工具还提供了一个框架来评估给定数据集上模型的端到端准确性指标。</p> 
<p>依赖关系</p> 
<p>QNN 精度评估器假定已遵循“设置”页面中概述的平台依赖性和环境设置说明。此外，还应为此工具安装以下 python 软件包。</p> 
<pre><code class="prism language-c">torch<span class="token operator">==</span><span class="token number">1.13</span><span class="token number">.1</span>
torchvision<span class="token operator">==</span><span class="token number">0.14</span><span class="token number">.1</span>
onnxruntime<span class="token operator">==</span><span class="token number">1.9</span><span class="token number">.0</span>
onnxsim<span class="token operator">==</span><span class="token number">0.4</span><span class="token number">.5</span>

</code></pre> 
<p>运行以下命令检查并安装所有 python 依赖项：</p> 
<pre><code class="prism language-c">$ source $<span class="token punctuation">{<!-- --></span>QNN_SDK_ROOT<span class="token punctuation">}</span><span class="token operator">/</span>bin<span class="token operator">/</span>envsetup<span class="token punctuation">.</span>sh
$ $<span class="token punctuation">{<!-- --></span>QNN_SDK_ROOT<span class="token punctuation">}</span><span class="token operator">/</span>bin<span class="token operator">/</span>check<span class="token operator">-</span>python<span class="token operator">-</span>dependency
$ python3 <span class="token operator">-</span>m pip install torch<span class="token operator">==</span><span class="token number">1.13</span><span class="token number">.1</span>
$ python3 <span class="token operator">-</span>m pip install torchvision<span class="token operator">==</span><span class="token number">0.14</span><span class="token number">.1</span>
$ python3 <span class="token operator">-</span>m pip install onnxruntime<span class="token operator">==</span><span class="token number">1.9</span><span class="token number">.0</span>
$ python3 <span class="token operator">-</span>m pip install onnxsim<span class="token operator">==</span><span class="token number">0.4</span><span class="token number">.5</span>

</code></pre> 
<blockquote> 
 <p>笔记<br> 要进行设置，QNN_SDK_ROOT请参阅Linux 的环境设置。</p> 
</blockquote> 
<p>用法<br> 用户需要将 QNN_SDK_ROOT 环境变量设置为 QNN SDK 的根目录。可能需要使用适当的值设置以下环境变量： QNN_MODEL_ZOO ：模型动物园的路径。如果未设置 model_zoo 基目录路径，则假定为“/home/model_zoo”。注意：仅当提供的模型路径不是绝对路径且相对于设置的模型动物园路径时，才需要此环境变量。ADB_PATH ：设置 ADB 二进制文件的路径。如果未设置，则假定 ADB 位于“/opt/bin/adb”。</p> 
<p>该工具有两种使用模式 - 最小模式和配置模式。</p> 
<p>最小模式选项是对所有可能的量化选项执行精度分析，并在与 cpu fp32 输出进行比较时根据给定的比较器对它们进行排序。</p> 
<p>配置模式通过自定义后端、量化选项和参考推理模式，支持给定数据集上模型的准确性分析。</p> 
<p>支持机型<br> qnn-accuracy-evaluator 目前支持 ONNX 和 PyTorch (torchscript) 模型。</p> 
<p>注意：对于 PyTorch 模型，必须根据 QNN 的命名约定（在适用的情况下）提供模型的输入和输出节点信息，在使用 qnn-pytorch-converter 执行此类模型时可以观察到该命名约定。</p> 
<p>最小模式<br> 最小模式选项是对所有可能的量化选项执行精度分析，并在与 cpu fp32 输出进行比较时根据给定的比较器对它们进行排序。</p> 
<pre><code class="prism language-c">qnn<span class="token operator">-</span>accuracy<span class="token operator">-</span>evaluator Options

minimal mode options<span class="token operator">:</span>
    <span class="token operator">-</span>model MODEL          path to model or model directory
    <span class="token operator">-</span>backend <span class="token punctuation">{<!-- --></span>cpu<span class="token punctuation">,</span>htp<span class="token punctuation">,</span>aic<span class="token punctuation">,</span>htp_mcp<span class="token punctuation">,</span>dspv69<span class="token punctuation">,</span>dspv73<span class="token punctuation">,</span>dspv75<span class="token punctuation">,</span>gpu<span class="token punctuation">}</span>
                          Backend to run the inference
    <span class="token operator">-</span>target<span class="token operator">-</span>arch <span class="token punctuation">{<!-- --></span>aarch64<span class="token operator">-</span>android<span class="token punctuation">,</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>clang<span class="token punctuation">}</span>
                          Target architecture to compile<span class="token punctuation">.</span>
    <span class="token operator">-</span>preproc<span class="token operator">-</span>file PREPROC_FILE
                          Path to a file specifying paths to raw inputs<span class="token punctuation">.</span>
    <span class="token operator">-</span>comparator COMPARATOR
                          comparator to be used<span class="token punctuation">.</span>
    <span class="token operator">-</span>tol<span class="token operator">-</span>thresh TOL_THRESH
                          Tolerance threshold to be used <span class="token keyword">for</span> the comparator
    <span class="token operator">-</span>act<span class="token operator">-</span>bw ACT_BW        <span class="token punctuation">[</span>Optional<span class="token punctuation">]</span> bitwidth to use <span class="token keyword">for</span> activations<span class="token punctuation">.</span> E<span class="token punctuation">.</span>g<span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span>
                          <span class="token number">1.</span>  Default is <span class="token number">8.</span>
    <span class="token operator">-</span>bias<span class="token operator">-</span>bw BIAS_BW      <span class="token punctuation">[</span>Optional<span class="token punctuation">]</span> bitwidth to use <span class="token keyword">for</span> biases<span class="token punctuation">.</span> either <span class="token number">8</span>
                          <span class="token punctuation">(</span><span class="token keyword">default</span><span class="token punctuation">)</span> or <span class="token number">32.</span>
    <span class="token operator">-</span>box<span class="token operator">-</span>input BOX_INPUT  Path to the json file<span class="token punctuation">.</span> Used only with the box
                          comparator

other options<span class="token operator">:</span>
    <span class="token operator">-</span>input<span class="token operator">-</span>info INPUT_INFO INPUT_INFO
                            The name and dimension of all the input buffers to the
                            network specified in the format <span class="token punctuation">[</span>input_name comma<span class="token operator">-</span>
                            separated<span class="token operator">-</span>dimensions<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">for</span> example<span class="token operator">:</span> <span class="token char">'data'</span>
                            <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">224</span><span class="token punctuation">,</span><span class="token number">224</span><span class="token punctuation">,</span><span class="token number">3.</span> This option is mandatory <span class="token keyword">for</span> pytorch
                            models in minimal mode<span class="token punctuation">.</span>
    <span class="token operator">-</span>onnx<span class="token operator">-</span>symbol ONNX_SYMBOL <span class="token punctuation">[</span>ONNX_SYMBOL <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>
                            Replace onnx symbols in input<span class="token operator">/</span>output shapes<span class="token punctuation">.</span>Can be
                            passed multiple timesDefault replaced by <span class="token number">1.</span> e<span class="token punctuation">.</span>g
                            __unk_200<span class="token operator">:</span><span class="token number">1</span>
    <span class="token operator">-</span>device<span class="token operator">-</span>id DEVICE_ID  Target device<span class="token operator">-</span>id<span class="token operator">/</span>device<span class="token operator">-</span>serial to be provided
    <span class="token operator">-</span>work<span class="token operator">-</span>dir WORK_DIR    working directory path<span class="token punctuation">.</span> <span class="token keyword">default</span> is <span class="token punctuation">.</span><span class="token operator">/</span>qacc_temp
    <span class="token operator">-</span>silent               Run in silent mode
    <span class="token operator">-</span>debug DEBUG          Set logging level to DEBUG within the tool

</code></pre> 
<blockquote> 
 <p>笔记<br> 对于主机上的 HTP 后端模拟，请在 CLI 命令中将 backend 设置为“htp”，将 target-arch 设置为“x86_64-linux-clang”。<br> 对于 Android 设备上的 HTP 后端执行，用户必须在 CLI 命令中指定后端以及版本（例如“dspv69/v73/v75”）和 target-arch 为“aarch64-android”。</p> 
</blockquote> 
<p>命令示例</p> 
<pre><code class="prism language-c">qnn<span class="token operator">-</span>accuracy<span class="token operator">-</span>evaluator <span class="token operator">-</span>model $<span class="token punctuation">{<!-- --></span>QNN_MODEL_ZOO<span class="token punctuation">}</span><span class="token operator">/</span>onnx<span class="token operator">-</span>cnns_mobilenet<span class="token operator">/</span>Source_model<span class="token operator">/</span>model<span class="token punctuation">.</span>onnx
                       <span class="token operator">-</span>preproc<span class="token operator">-</span>file $<span class="token punctuation">{<!-- --></span>QNN_MODEL_ZOO<span class="token punctuation">}</span><span class="token operator">/</span>onnx<span class="token operator">-</span>cnns_mobilenet<span class="token operator">/</span>inputs<span class="token operator">/</span>input_list<span class="token punctuation">.</span>txt
                       <span class="token operator">-</span>backend htp
                       <span class="token operator">-</span>target<span class="token operator">-</span>arch x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>clang
                       <span class="token operator">-</span>comparator abs
                       <span class="token operator">-</span>tol<span class="token operator">-</span>thresh <span class="token number">0.1</span>

</code></pre> 
<p>结果</p> 
<p>该工具显示一个表格，其中包含根据所选比较器按输出匹配排序的量化选项，并生成具有相同数据的 csv 文件。比较器列显示基于所选比较器的输出匹配百分比/值。定量参数列显示用于该运行的量化参数。其他列还显示使用的后端、运行时/编译参数。该信息还存储在位于{work_dir}/metrics-info.csv的 csv 文件中。</p> 
<blockquote> 
 <p>笔记<br> HTP MCP 编译参数“elf_path”默认设置为 $QNN_SDK_ROOT/lib/hexagon-v68/unsigned/libQnnHtpMcpV68.elf。用户可以通过更新 $QNN_SDK_ROOT/lib/python/qti/aisw/accuracy_evaluator/common/defaults.py 中的 qacc.default_inference_schemas.htp_mcp_x86.inference_schema.compiler_params.elf_path 来更改路径</p> 
</blockquote> 
<p>在最小模式下运行的量化选项组合：</p> 
<pre><code class="prism language-c">param_quantizer<span class="token operator">:</span>  tf <span class="token operator">|</span> symmetric <span class="token operator">|</span> enhanced <span class="token operator">|</span> adjusted
algorithms<span class="token operator">:</span> <span class="token keyword">default</span> <span class="token operator">|</span> cle
use_per_channel_quantization<span class="token operator">:</span> True <span class="token operator">|</span> False

</code></pre> 
<p>每个量化选项工作目录都存储在{work_dir}/infer/schema{i}<em>qnn</em>{quant_option}中。QNN IR 文件存储在 {work_dir}/infer/schema{i}<em>qnn</em>{quant_option}/qnn_ir 中，输出存储在{work_dir}/infer/schema{i}<em>qnn</em>{quant_option}/Result_{i} 中。</p> 
<blockquote> 
 <p>笔记<br> 为了清晰起见，添加了控制台日志的快照。</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/f4/5d/XNObncoY_o.png" alt="请添加图片描述"></p> 
<blockquote> 
 <p>笔记<br> 为了清晰起见，添加了 csv 文件的快照。</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/67/1b/CWcuhXiR_o.png" alt="请添加图片描述"><br> 配置模式<br> 配置模式通过自定义后端、量化选项和参考推理模式，支持给定数据集上模型的准确性分析。示例配置文件可以在${QNN_SDK_ROOT}/lib/python/qti/aisw/accuracy_evaluator/configs/samples/model_configs找到 。</p> 
<p>模型配置的高级结构如下所示：</p> 
<pre><code class="prism language-c">model
    info
    globals
    dataset
    processing
        preprocessing
        postprocessing
    inference<span class="token operator">-</span>engine
    evaluator

</code></pre> 
<p>用户需要在模型配置文件中的数据集部分下提供所有数据集信息，否则将引发错误。下面显示了一个示例：</p> 
<pre><code class="prism language-c">dataset<span class="token operator">:</span>
    name<span class="token operator">:</span> COCO2014
    path<span class="token operator">:</span> <span class="token char">'/home/ml-datasets/COCO/2014/'</span>
    inputlist_file<span class="token operator">:</span> inputlist<span class="token punctuation">.</span>txt
    calibration<span class="token operator">:</span>
        type<span class="token operator">:</span> index
        file<span class="token operator">:</span> calibration<span class="token operator">-</span>index<span class="token punctuation">.</span>txt

</code></pre> 
<p>数据集字段详细信息如下：</p> 
<p><img src="https://images2.imgbox.com/52/ef/zfBCgAD6_o.png" alt="在这里插入图片描述"><br> 推理引擎用于在多个推理模式上运行模型。下面显示了示例推理引擎部分，后面是推理部分中不同可配置条目的描述。</p> 
<pre><code class="prism language-c">inference<span class="token operator">-</span>engine<span class="token operator">:</span>
    model_path<span class="token operator">:</span> MLPerfModels<span class="token operator">/</span>ResNetV1<span class="token punctuation">.</span><span class="token number">5</span><span class="token operator">/</span>modelFiles<span class="token operator">/</span>ONNX<span class="token operator">/</span>resnet50_v1<span class="token punctuation">.</span>onnx
    simplify_model <span class="token operator">:</span> True
    inference_schemas<span class="token operator">:</span>
        <span class="token operator">-</span> inference_schema<span class="token operator">:</span>
            name<span class="token operator">:</span> qnn
            target_arch<span class="token operator">:</span> x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>clang
            backend<span class="token operator">:</span> aic
            precision<span class="token operator">:</span> quant
            tag<span class="token operator">:</span> aic_int8
            converter_params<span class="token operator">:</span>
                param_quantizer<span class="token operator">:</span> tf <span class="token operator">|</span> symmetric <span class="token operator">|</span> enhanced <span class="token operator">|</span> adjusted
            compiler_params<span class="token operator">:</span>
                compiler_num_of_cores<span class="token operator">:</span> <span class="token number">8</span>
            runtime_params<span class="token operator">:</span>
                runtime_device_id<span class="token operator">:</span> <span class="token number">0</span>
    inputs_info<span class="token operator">:</span>
        <span class="token operator">-</span> input_tensor_0<span class="token operator">:</span>
              type<span class="token operator">:</span> float32
              shape<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"*"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">224</span><span class="token punctuation">,</span> <span class="token number">224</span><span class="token punctuation">]</span>
    outputs_info<span class="token operator">:</span>
        <span class="token operator">-</span> ArgMax_0<span class="token operator">:</span>
              type<span class="token operator">:</span> int64
              shape<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"*"</span><span class="token punctuation">]</span>
        <span class="token operator">-</span> softmax_tensor_0<span class="token operator">:</span>
              type<span class="token operator">:</span> float32
              shape<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"*"</span><span class="token punctuation">,</span> <span class="token number">1001</span><span class="token punctuation">]</span>

</code></pre> 
<p>每个可配置条目的详细信息如下：</p> 
<p><img src="https://images2.imgbox.com/df/35/yIwFQDDT_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>笔记<br> 对于主机上的 HTP 后端模拟，请在配置文件中将 backend 设置为“htp”，将 target_arch 设置为“x86_64-linux-clang”。<br> 对于 Android 设备上的 HTP 后端执行，用户必须在配置文件中将后端以及版本（例如 dspv69 / dspv73 / dspv75 和 target_arch ）指定为“aarch64-android”。</p> 
</blockquote> 
<p>评估器部分提供有关在多个推理模式的情况下用于比较推理输出的比较器的信息。下面显示了示例评估器部分，后面是该部分中不同可配置条目的描述。</p> 
<pre><code class="prism language-c">evaluator<span class="token operator">:</span>
    comparator<span class="token operator">:</span>
        enabled<span class="token operator">:</span> True
        fetch<span class="token operator">-</span>top<span class="token operator">:</span> <span class="token number">1</span>
        type<span class="token operator">:</span> avg
        tol<span class="token operator">:</span> <span class="token number">0.001</span>

</code></pre> 
<p>每个可配置条目的详细信息如下：</p> 
<p><img src="https://images2.imgbox.com/51/c3/4bvodruy_o.png" alt="在这里插入图片描述"><br> 配置模式可用的命令行选项如下：</p> 
<pre><code class="prism language-c">qnn<span class="token operator">-</span>acc<span class="token operator">-</span>evaluator options

required options<span class="token operator">:</span>
    <span class="token operator">-</span>config CONFIG        path to model config yaml

    pipeline options<span class="token operator">:</span>
    <span class="token operator">-</span>preproc<span class="token operator">-</span>file PREPROC_FILE
                            preprocessed input file<span class="token punctuation">,</span> overrides inputfile provided in model config
    <span class="token operator">-</span>calib<span class="token operator">-</span>file CALIB_FILE
                            calibration input file<span class="token punctuation">,</span> overrides calibration file provided in model config

other options<span class="token operator">:</span>
    <span class="token operator">-</span>device<span class="token operator">-</span>id DEVICE_ID    Target device id to be provided
    <span class="token operator">-</span>work<span class="token operator">-</span>dir WORK_DIR      working directory path<span class="token punctuation">.</span> <span class="token keyword">default</span> is <span class="token punctuation">.</span><span class="token operator">/</span>qacc_temp
    <span class="token operator">-</span>silent                 Run in silent mode
    <span class="token operator">-</span>debug DEBUG            Set logging level to DEBUG within the tool
    <span class="token operator">-</span>inference<span class="token operator">-</span>schema INFERENCE_SCHEMA
                            run only on this inference schema
    <span class="token operator">-</span>inference<span class="token operator">-</span>schema<span class="token operator">-</span>tag INFERENCE_SCHEMA_TAG
                            run only this inference schema tag
    <span class="token operator">-</span>batchsize BATCHSIZE    overrides batchsize provided in model config
    <span class="token operator">-</span>onnx<span class="token operator">-</span>symbol ONNX_SYMBOL <span class="token punctuation">[</span>ONNX_SYMBOL <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>
                            Replace onnx symbols in input<span class="token operator">/</span>output shapes<span class="token punctuation">.</span>Can be
                            passed multiple timesDefault replaced by <span class="token number">1.</span> e<span class="token punctuation">.</span>g
                            __unk_200<span class="token operator">:</span><span class="token number">1</span>
    <span class="token operator">-</span>set<span class="token operator">-</span>global SET_GLOBAL <span class="token punctuation">[</span>SET_GLOBAL <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>
                            Replace global symbols with given value<span class="token punctuation">.</span>Can be passed
                            multiple times<span class="token punctuation">.</span> e<span class="token punctuation">.</span>g <span class="token operator">&lt;</span>symbol<span class="token operator">&gt;</span><span class="token operator">:</span><span class="token number">2</span>

</code></pre> 
<p>命令示例</p> 
<pre><code class="prism language-c">qnn<span class="token operator">-</span>accuracy<span class="token operator">-</span>evaluator <span class="token operator">-</span>config <span class="token punctuation">{<!-- --></span>path to configs<span class="token punctuation">}</span><span class="token operator">/</span>qnn_resnet50_config<span class="token punctuation">.</span>yaml

</code></pre> 
<p>结果</p> 
<p>请参阅最小模式部分</p> 
<p>配置文件选项</p> 
<pre><code class="prism language-c"><span class="token operator">-</span> inference_schema<span class="token operator">:</span>
    name<span class="token operator">:</span> qnn
    target_arch<span class="token operator">:</span> x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>clang
    backend<span class="token operator">:</span> cpu
    precision<span class="token operator">:</span> fp32
    tag<span class="token operator">:</span> qnn_cpu_x86

<span class="token operator">-</span> inference_schema<span class="token operator">:</span>
    name<span class="token operator">:</span> qnn
    target_arch<span class="token operator">:</span> aarch64<span class="token operator">-</span>android
    backend<span class="token operator">:</span> cpu
    precision<span class="token operator">:</span> fp32
    tag<span class="token operator">:</span> qnn_cpu_android

<span class="token operator">-</span> inference_schema<span class="token operator">:</span>
    name<span class="token operator">:</span> qnn
    target_arch<span class="token operator">:</span> aarch64<span class="token operator">-</span>android
    backend<span class="token operator">:</span> gpu
    precision<span class="token operator">:</span> fp32
    tag<span class="token operator">:</span> qnn_gpu_android

<span class="token operator">-</span> inference_schema<span class="token operator">:</span>
    name<span class="token operator">:</span> qnn
    target_arch<span class="token operator">:</span> x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>clang
    backend<span class="token operator">:</span> htp
    precision<span class="token operator">:</span> quant
    tag<span class="token operator">:</span> htp_int8
    runtime_params<span class="token operator">:</span>
        vtcm_mb<span class="token operator">:</span> <span class="token number">4</span>
        rpc_control_latency<span class="token operator">:</span> <span class="token number">100</span>
    converter_params<span class="token operator">:</span>
        param_quantizer<span class="token operator">:</span> tf <span class="token operator">|</span> symmetric <span class="token operator">|</span> enhanced <span class="token operator">|</span> adjusted
        act_quantizer<span class="token operator">:</span> tf <span class="token operator">|</span> symmetric
        algorithms<span class="token operator">:</span> <span class="token keyword">default</span> <span class="token operator">|</span> cle
        use_per_channel_quantization<span class="token operator">:</span> True <span class="token operator">|</span> False
        quantization_overrides<span class="token operator">:</span> <span class="token string">"path to the ext quant json"</span>
        act_bw<span class="token operator">:</span> <span class="token number">8</span> <span class="token operator">|</span> <span class="token number">16</span>
        bias_bw<span class="token operator">:</span> <span class="token number">8</span> <span class="token operator">|</span> <span class="token number">32</span>
        weight_bw<span class="token operator">:</span> <span class="token number">8</span>

<span class="token operator">-</span> inference_schema<span class="token operator">:</span>
    name<span class="token operator">:</span> qnn
    target_arch<span class="token operator">:</span> aarch64<span class="token operator">-</span>android
    backend<span class="token operator">:</span> dspv69<span class="token operator">/</span>dspv73<span class="token operator">/</span>dspv75
    precision<span class="token operator">:</span> quant
    tag<span class="token operator">:</span> htp_int8
    runtime_params<span class="token operator">:</span>
        vtcm_mb<span class="token operator">:</span> <span class="token number">4</span>
        rpc_control_latency<span class="token operator">:</span> <span class="token number">100</span>
    converter_params<span class="token operator">:</span>
        param_quantizer<span class="token operator">:</span> tf <span class="token operator">|</span> symmetric <span class="token operator">|</span> enhanced <span class="token operator">|</span> adjusted
        act_quantizer<span class="token operator">:</span> tf <span class="token operator">|</span> symmetric
        algorithms<span class="token operator">:</span> <span class="token keyword">default</span> <span class="token operator">|</span> cle
        use_per_channel_quantization<span class="token operator">:</span> True <span class="token operator">|</span> False
        quantization_overrides<span class="token operator">:</span> <span class="token string">"path to the ext quant json"</span>
        act_bw<span class="token operator">:</span> <span class="token number">8</span> <span class="token operator">|</span> <span class="token number">16</span>
        bias_bw<span class="token operator">:</span> <span class="token number">8</span> <span class="token operator">|</span> <span class="token number">32</span>
        weight_bw<span class="token operator">:</span> <span class="token number">8</span>

<span class="token operator">-</span> inference_schema<span class="token operator">:</span>
    name<span class="token operator">:</span> qnn
    target_arch<span class="token operator">:</span> x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>clang
    backend<span class="token operator">:</span> aic
    precision<span class="token operator">:</span> fp16
    tag<span class="token operator">:</span> aic_fp16
    runtime_params<span class="token operator">:</span>
        runtime_device_id<span class="token operator">:</span> <span class="token number">0</span>
        runtime_num_activations<span class="token operator">:</span> <span class="token number">100</span>
    compiler_params<span class="token operator">:</span>
        compiler_num_of_cores<span class="token operator">:</span> <span class="token number">8</span>
        compiler_convert_to_FP16<span class="token operator">:</span> true
        compiler_perfWarnings<span class="token operator">:</span> true

<span class="token operator">-</span> inference_schema<span class="token operator">:</span>
    name<span class="token operator">:</span> qnn
    target_arch<span class="token operator">:</span> x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>clang
    backend<span class="token operator">:</span> aic
    precision<span class="token operator">:</span> quant
    tag<span class="token operator">:</span> aic_int8
    runtime_params<span class="token operator">:</span>
        runtime_device_id<span class="token operator">:</span> <span class="token number">0</span>
        runtime_num_activations<span class="token operator">:</span> <span class="token number">100</span>
    converter_params<span class="token operator">:</span>
        param_quantizer<span class="token operator">:</span> tf <span class="token operator">|</span> symmetric <span class="token operator">|</span> enhanced <span class="token operator">|</span> adjusted
        act_quantizer<span class="token operator">:</span> tf <span class="token operator">|</span> symmetric
        algorithms<span class="token operator">:</span> <span class="token keyword">default</span> <span class="token operator">|</span> cle
        use_per_channel_quantization<span class="token operator">:</span> True <span class="token operator">|</span> False
        quantization_overrides<span class="token operator">:</span> <span class="token string">"path to the ext quant json"</span>
        act_bw<span class="token operator">:</span> <span class="token number">8</span> <span class="token operator">|</span> <span class="token number">16</span>
        bias_bw<span class="token operator">:</span> <span class="token number">8</span> <span class="token operator">|</span> <span class="token number">32</span>
        weight_bw<span class="token operator">:</span> <span class="token number">8</span>
    compiler_params<span class="token operator">:</span>
        compiler_num_of_cores<span class="token operator">:</span> <span class="token number">8</span>
        compiler_perfWarnings<span class="token operator">:</span> true

<span class="token operator">-</span> inference_schema<span class="token operator">:</span>
    name<span class="token operator">:</span> qnn
    target_arch<span class="token operator">:</span> x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>clang
    backend<span class="token operator">:</span> htp_mcp
    precision<span class="token operator">:</span> fp16
    tag<span class="token operator">:</span> htp_mcp_fp16
    runtime_params<span class="token operator">:</span>
        device_id<span class="token operator">:</span> <span class="token number">0</span>
        timeout<span class="token operator">:</span> <span class="token number">5000</span>
    compiler_params<span class="token operator">:</span>
        fp16_relaxed_precision<span class="token operator">:</span> <span class="token number">1</span>
        num_cores<span class="token operator">:</span> <span class="token number">1</span>
        elf_path<span class="token operator">:</span> <span class="token string">"path to .elf"</span>     # Should be either an absolute path or
                                     <span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">relative</span> <span class="token expression">to QNN_SDK_ROOT<span class="token punctuation">.</span> Sample file</span></span>
                                     <span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">can</span> <span class="token expression">be found in</span></span>
                                     # $QNN_SDK_ROOT<span class="token operator">/</span>lib<span class="token operator">/</span>hexagon<span class="token operator">-</span>v68<span class="token operator">/</span><span class="token keyword">unsigned</span><span class="token operator">/</span>libQnnHtpMcpV68<span class="token punctuation">.</span>elf

<span class="token operator">-</span> inference_schema<span class="token operator">:</span>
    name<span class="token operator">:</span> qnn
    target_arch<span class="token operator">:</span> x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>clang
    backend<span class="token operator">:</span> htp_mcp
    precision<span class="token operator">:</span> int8
    tag<span class="token operator">:</span> htp_mcp_int8
    runtime_params<span class="token operator">:</span>
        device_id<span class="token operator">:</span> <span class="token number">0</span>
        timeout<span class="token operator">:</span> <span class="token number">5000</span>
    converter_params<span class="token operator">:</span>
        param_quantizer<span class="token operator">:</span> tf <span class="token operator">|</span> symmetric <span class="token operator">|</span> enhanced <span class="token operator">|</span> adjusted
        act_quantizer<span class="token operator">:</span> tf <span class="token operator">|</span> symmetric
        algorithms<span class="token operator">:</span> <span class="token keyword">default</span> <span class="token operator">|</span> cle
        use_per_channel_quantization<span class="token operator">:</span> True <span class="token operator">|</span> False
    compiler_params<span class="token operator">:</span>
        num_cores<span class="token operator">:</span> <span class="token number">1</span>
        elf_path<span class="token operator">:</span> <span class="token string">"path to .elf"</span>     # Should be either an absolute path or
                                     <span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">relative</span> <span class="token expression">to QNN_SDK_ROOT<span class="token punctuation">.</span> Sample file</span></span>
                                     <span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">can</span> <span class="token expression">be found in</span></span>
                                     # $QNN_SDK_ROOT<span class="token operator">/</span>lib<span class="token operator">/</span>hexagon<span class="token operator">-</span>v68<span class="token operator">/</span><span class="token keyword">unsigned</span><span class="token operator">/</span>libQnnHtpMcpV68<span class="token punctuation">.</span>elf

</code></pre> 
<p>比较器</p> 
<p>以下是可用于比较输出的比较器。一些比较器输出两个张量之间的百分比匹配，一些比较器输出与所选比较器相对应的绝对值。</p> 
<ol><li> <p>abs - 基于相对容差阈值的两个张量之间的百分比匹配</p> </li><li> <p>cos - 基于余弦相似度得分的两个张量之间的百分比匹配</p> </li><li> <p>topk - 基于两个张量之间的 topk 匹配的两个张量之间的百分比匹配</p> </li><li> <p>avg - 基于两个张量之间的平均差的两个张量之间的百分比匹配</p> </li><li> <p>l1norm - 基于差异的 L1 范数的两个张量之间的百分比匹配</p> </li><li> <p>l2norm - 基于差异的 L2 范数的两个张量之间的百分比匹配</p> </li><li> <p>std - 基于标准差差异的两个张量之间的百分比匹配</p> </li><li> <p>rme - 基于张量之间的 RMSE 的两个张量之间的百分比匹配</p> </li><li> <p>snr - 两个张量之间的信噪比</p> </li><li> <p>maxerror - 两个张量之间的最大误差值</p> </li><li> <p>kld - KL 两个张量之间的散度值</p> </li><li> <p>PixelbyPixel - 两个张量之间的逐像素图差异。对于每个输入 i，绘图保存在{work_dir}/{schema}/Result_{i}</p> </li><li> <p>box - box 验证程序需要–box_input参数，该参数接受以下格式的 json 文件的文件名：</p> <pre><code class="prism language-c"><span class="token punctuation">{<!-- --></span><span class="token string">"box"</span><span class="token operator">:</span><span class="token string">"Result_0/detection_boxes_0.raw"</span><span class="token punctuation">,</span>
<span class="token string">"class"</span><span class="token operator">:</span><span class="token string">"Result_0/detection_classes_0.raw"</span><span class="token punctuation">,</span>
<span class="token string">"score"</span><span class="token operator">:</span><span class="token string">"Result_0/detection_scores_0.raw"</span><span class="token punctuation">}</span>

</code></pre> </li></ol> 
<p>型号目录</p> 
<p>在最小模式下，用户还可以传递模型目录。目录结构预计采用以下格式：</p> 
<pre><code class="prism language-c">model_dir<span class="token operator">/</span>
  <span class="token operator">|</span>__model1<span class="token operator">/</span>
  <span class="token operator">|</span>     <span class="token operator">|</span>__Source_model<span class="token operator">/</span>
  <span class="token operator">|</span>     <span class="token operator">|</span>       <span class="token operator">|</span>__model<span class="token punctuation">.</span>onnx
  <span class="token operator">|</span>     <span class="token operator">|</span>__inputs<span class="token operator">/</span>
  <span class="token operator">|</span>     <span class="token operator">|</span>       <span class="token operator">|</span>__data<span class="token operator">/</span>images<span class="token punctuation">.</span>raw
  <span class="token operator">|</span>     <span class="token operator">|</span>       <span class="token operator">|</span>__input_list<span class="token punctuation">.</span>txt
  <span class="token operator">|</span>__model2<span class="token operator">/</span>
  <span class="token operator">|</span>     <span class="token operator">|</span>__Source_model<span class="token operator">/</span>
  <span class="token operator">|</span>     <span class="token operator">|</span>       <span class="token operator">|</span>__model<span class="token punctuation">.</span>onnx
  <span class="token operator">|</span>     <span class="token operator">|</span>__inputs<span class="token operator">/</span>
  <span class="token operator">|</span>     <span class="token operator">|</span>       <span class="token operator">|</span>__data<span class="token operator">/</span>images<span class="token punctuation">.</span>raw
  <span class="token operator">|</span>     <span class="token operator">|</span>       <span class="token operator">|</span>__input_list<span class="token punctuation">.</span>txt

</code></pre> 
<p>每个模型的输出目录将位于{work_dir}/{model_dir}</p> 
<p>qnn-architecture-checker（实验）<br> Architecture Checker 是一款针对 HTP 后端运行的模型而设计的工具，包括量化 8 位、量化 16 位和 FP16 模型。它输出模型中的问题列表，这些问题使模型在 HTP 后端运行时无法获得更好的性能。可以使用修改器功能调用架构检查器工具，该修改器功能将为这些问题应用建议的修改。这将有助于可视化可应用于模型的更改，使其更适合 HTP 后端。</p> 
<pre><code class="prism language-c">X86<span class="token operator">-</span>Linux<span class="token operator">/</span> WSL Usage<span class="token operator">:</span>
$ qnn<span class="token operator">-</span>architecture<span class="token operator">-</span>checker <span class="token operator">-</span>i <span class="token operator">&lt;</span>path<span class="token operator">&gt;</span><span class="token operator">/</span>model<span class="token punctuation">.</span>json
                         <span class="token operator">-</span>b <span class="token operator">&lt;</span>optional_path<span class="token operator">&gt;</span><span class="token operator">/</span>model<span class="token punctuation">.</span>bin
                         <span class="token operator">-</span>o <span class="token operator">&lt;</span>optional_output_path<span class="token operator">&gt;</span>
                         <span class="token operator">-</span>m <span class="token operator">&lt;</span>optional_modifier_argument<span class="token operator">&gt;</span>

X86<span class="token operator">-</span>Windows<span class="token operator">/</span> Windows on Snapdragon Usage<span class="token operator">:</span>
$ python qnn<span class="token operator">-</span>architecture<span class="token operator">-</span>checker <span class="token operator">-</span>i <span class="token operator">&lt;</span>path<span class="token operator">&gt;</span><span class="token operator">/</span>model<span class="token punctuation">.</span>json
                         <span class="token operator">-</span>b <span class="token operator">&lt;</span>optional_path<span class="token operator">&gt;</span><span class="token operator">/</span>model<span class="token punctuation">.</span>bin
                         <span class="token operator">-</span>o <span class="token operator">&lt;</span>optional_output_path<span class="token operator">&gt;</span>
                         <span class="token operator">-</span>m <span class="token operator">&lt;</span>optional_modifier_argument<span class="token operator">&gt;</span>

 required arguments<span class="token operator">:</span>
     <span class="token operator">-</span>i INPUT_JSON<span class="token punctuation">,</span> <span class="token operator">--</span>input_json INPUT_JSON
                             Path to json file

 optional arguments<span class="token operator">:</span>
     <span class="token operator">-</span>b BIN<span class="token punctuation">,</span> <span class="token operator">--</span>bin BIN
                     Path to a bin file
     <span class="token operator">-</span>o OUTPUT_PATH<span class="token punctuation">,</span> <span class="token operator">--</span>output_path OUTPUT_PATH
                     Path where the output csv should be saved<span class="token punctuation">.</span> If not specified<span class="token punctuation">,</span> the output csv will be written to the same path as the input file
     <span class="token operator">-</span>m MODIFY<span class="token punctuation">,</span> <span class="token operator">--</span>modify MODIFY
                     The query to select the modifications to apply<span class="token punctuation">.</span>
                         <span class="token operator">--</span>modify or <span class="token operator">--</span>modify show <span class="token operator">-</span> To see all the possible modifications<span class="token punctuation">.</span> Display list of rule names and details of the modifications<span class="token punctuation">.</span>
                         <span class="token operator">--</span>modify all <span class="token operator">-</span> To apply all the possible modifications found <span class="token keyword">for</span> the model<span class="token punctuation">.</span>
                         <span class="token operator">--</span>modify apply<span class="token operator">=</span>rule_name1<span class="token punctuation">,</span>rule_name2 <span class="token operator">-</span> To apply modifications <span class="token keyword">for</span> specified rule names<span class="token punctuation">.</span> The list of rules should be comma separated without spaces

</code></pre> 
<blockquote> 
 <p>笔记：<br> 如果在量化模型上运行，则使用一幅输入图像生成的量化模型足以满足使工具正常运行的量化要求。<br> 运行该工具之前必须配置 QNN_SDK_ROOT 环境变量。<br> 弃用注意事项：<br> 通过在上面列出的每个转换器中传递“–arch_checker”来启用架构检查器的选项将被弃用。例如：运行 qnn-tflite-converter -i &lt;路径&gt;/model.tflite -d &lt;网络输入名称&gt; -o &lt;可选输出路径&gt; -p &lt;可选包名称&gt; –arch_checker 将被弃用。<br> 要启用架构检查器，请运行转换器工具而不传递“–arch_checker”参数，然后运行 ​​qnn-architecture-checker 命令以查看架构检查器输出。<br> 仅 qnn-architecture-checker 命令支持使用“–modify”。</p> 
</blockquote> 
<p>输出是 csv 文件，将保存为 &lt;可选输出路径&gt;/&lt;模型名称&gt;_architecture_checker.csv。示例输出如下所示：</p> 
<p><img src="https://images2.imgbox.com/96/7b/vIRDX2Re_o.png" alt="在这里插入图片描述"><br> 如何读取示例输出 csv？<br> 第 1 行：这是图上的一个问题，该图使用 16 位激活数据，正如建议中所述，将激活从 16 位更改为 8 位可以提供更好的性能。<br> 第 2 行：问题出现在 QNN 节点名称为“Node_name_1”的节点上。该节点具有三个输入：input_1、__param_1 和 convolution_0_bias，其中维度分别为 [1, 250, 250, 3]、[5, 5, 3, 32] 和 [32]。该节点有一个输出，QNN 张量名称为 output_1，该张量的维度为 [1, 123, 123, 32]。该节点的类型是Conv2d。“参数”列中提供了上一个/下一个节点名称以及完整的附加节点参数集，可用于在原始模型内定位节点。该节点的问题是输入张量的通道较低，因为通道小于 32，建议将通道增加到至少 32，以便在 HTP 后端获得更好的性能。目前输入维度为 [1, 250, 250, 3]，理想情况下为 [1, x, x, 32]。Modification 和 Modification_info 列提供有关应用于节点的修改的详细信息。如果架构检查器未使用修改器调用，或者没有任何适用的修改，则这些值将为 N/A。<br> QNN 节点/张量名称与原始模型中的名称相同吗？<br> 不一样但应该相似。为了满足 QNN 命名标准，转换器中进行了命名清理。输入张量、输出张量、前一个节点、下一个节点以及所有附加参数在输出 csv 文件中可用，以帮助在原始模型中找到正确的节点。<br> 命令示例</p> 
<pre><code class="prism language-c">qnn<span class="token operator">-</span>architecture<span class="token operator">-</span>checker <span class="token operator">--</span>input_json <span class="token punctuation">.</span><span class="token operator">/</span>model_net<span class="token punctuation">.</span>json
                       <span class="token operator">--</span>bin <span class="token punctuation">.</span><span class="token operator">/</span>model<span class="token punctuation">.</span>bin
                       <span class="token operator">--</span>output_path <span class="token punctuation">.</span><span class="token operator">/</span>archCheckerOutput

</code></pre> 
<p>架构检查器 - 模型修改器</p> 
<p>为了将修改应用于模型，可以使用“–modify”或“–modify show”调用架构检查器，这将显示可能修改的列表。在这种情况下，架构检查器工具将仅显示规则名称和修改详细信息。它将在不对模型进行任何更改的情况下运行并生成 csv 输出。使用上述运行中的规则名称，可以通过“–modify all”或“–modify apply=rule_name1,rule_name2”调用架构检查器。在这种情况下，规则特定的更改将应用​​于模型，并且可以在更新的模型 json 中查看更改。此外，输出 csv 还将包含与修改相关的信息。</p> 
<p>考虑在示例模型上应用“–modify apply=elwisediv”修改后生成的以下 csv 输出。</p> 
<p><img src="https://images2.imgbox.com/d6/fc/p6XH8jMJ_o.png" alt="在这里插入图片描述"><br> 如何读取示例输出 csv？<br> 第 1 行：QNN 节点名称为“Node_name_1”的节点的问题在于它具有元素除法，与元素乘法相比，性能较差。使用“–modify apply=elwisediv”调用架构检查器后，修改已成功应用，即元素明智除法被元素明智乘以倒数值取代。此信息可在 Modification 和 Modification_info 列中找到。<br> 第 2 行：QNN 节点名称为“Node_name_2”的节点上的问题是该节点的输入张量的通道数小于 32。建议将通道数增加到 32 或更多以获得更好的性能。对于此问题，通过工具进行的修改不适用，因此 Modification 和 Modification_info 列不适用。<br> 修改模型后，上述运行将生成更新的 model.cpp、model_net.json 和/或 model.bin 以及 csv 输出。在更新后的模型 json 上运行架构检查器将不再显示 Node_Name_1 上的元素明智划分问题。<br> 以下是使用修改器调用架构检查器以显示修改列表的命令：</p> 
<p>命令示例</p> 
<pre><code class="prism language-c">qnn<span class="token operator">-</span>architecture<span class="token operator">-</span>checker <span class="token operator">--</span>input_json <span class="token punctuation">.</span><span class="token operator">/</span>model_net<span class="token punctuation">.</span>json
                       <span class="token operator">--</span>bin <span class="token punctuation">.</span><span class="token operator">/</span>model<span class="token punctuation">.</span>bin
                       <span class="token operator">--</span>output_path <span class="token punctuation">.</span><span class="token operator">/</span>archCheckerOutput
                       <span class="token operator">--</span>modify

</code></pre> 
<p>命令示例</p> 
<pre><code class="prism language-c">qnn<span class="token operator">-</span>architecture<span class="token operator">-</span>checker <span class="token operator">--</span>input_json <span class="token punctuation">.</span><span class="token operator">/</span>model_net<span class="token punctuation">.</span>json
                       <span class="token operator">--</span>bin <span class="token punctuation">.</span><span class="token operator">/</span>model<span class="token punctuation">.</span>bin
                       <span class="token operator">--</span>output_path <span class="token punctuation">.</span><span class="token operator">/</span>archCheckerOutput
                       <span class="token operator">--</span>modify show

</code></pre> 
<p>以下是将修改应用于所有可能的修改或特定规则的命令：</p> 
<p>命令示例</p> 
<pre><code class="prism language-c">qnn<span class="token operator">-</span>architecture<span class="token operator">-</span>checker <span class="token operator">--</span>input_json <span class="token punctuation">.</span><span class="token operator">/</span>model_net<span class="token punctuation">.</span>json
                       <span class="token operator">--</span>bin <span class="token punctuation">.</span><span class="token operator">/</span>model<span class="token punctuation">.</span>bin
                       <span class="token operator">--</span>output_path <span class="token punctuation">.</span><span class="token operator">/</span>archCheckerOutput
                       <span class="token operator">--</span>modify all

</code></pre> 
<p>命令示例</p> 
<pre><code class="prism language-c">qnn<span class="token operator">-</span>architecture<span class="token operator">-</span>checker <span class="token operator">--</span>input_json <span class="token punctuation">.</span><span class="token operator">/</span>model_net<span class="token punctuation">.</span>json
                       <span class="token operator">--</span>bin <span class="token punctuation">.</span><span class="token operator">/</span>model<span class="token punctuation">.</span>bin
                       <span class="token operator">--</span>output_path <span class="token punctuation">.</span><span class="token operator">/</span>archCheckerOutput
                       <span class="token operator">--</span>modify apply<span class="token operator">=</span>prelu<span class="token punctuation">,</span>elwisediv

</code></pre> 
<blockquote> 
 <p>笔记：<br> 带修改器的架构检查器是一项增强功能，可帮助可视化可应用于模型的更改，以更好地适应 HTP。为了看到实际的性能改进，模型可能需要重新训练/重新设计。</p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/08556554a2cae62ffbc169aa82268f49/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">vue前端表单常用的邮箱、电话、身份证、url、Ip等正则式多语言版校验</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f21adb4553f1baea4b8607bc6cb313ec/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Ef Core花里胡哨系列(11) ef8 无实体查询，你好!</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>