<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>谷歌浏览器中video播放视频进度条无法拖动，一点击进度条就回到0重新播放 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="谷歌浏览器中video播放视频进度条无法拖动，一点击进度条就回到0重新播放" />
<meta property="og:description" content="问题：一个.mp4视频进度条无法拖动，只在谷歌浏览器中有问题，火狐中没有问题，console也不报错。
初步排查到的bug原因:与Video标签适配的请求响应有问题。
无法拖动的视频响应截图如下：
能正常拖动的视频响应截图如下：
如何去解决：
1.Chrome浏览器默认请求会在 Header 添加一个Range如下：服务器要做的就是响应这个Header
Range: bytes=0- 2.服务器接收到这个Header以后，响应的Header如下，同时需要设置状态码为206：
Accept-Ranges: bytes Content-Length: 2097152 Content-Range: bytes 0-2097151/38696534 3.百度了个服务端设置响应的代码，如下（我不太懂后台代码，仅供参考,有更好的解决方案，欢迎大家留言哈~)：
public ActionResult Video(Guid id) { //数据库存储的文件路径 var archive = ManagerFactory.ArchiveManager.GetVideoArchive(id); //物理绝对路径 var path = Server.MapPath(&#34;~/&#34; &#43; archive.Path); //设置响应头 HttpContext.Response.Headers.Add(&#34;Accept-Ranges&#34;, &#34;bytes&#34;); //判定是否响应Chrome中的Range请求 var rangeQuery = HttpContext.Request.Headers[&#34;Range&#34;]; if (rangeQuery.IsNotNullAndNotEmpty()) { //startIndex 与 endIndex 是索引值,是0开始的,注意在与 Length 比较的时候 Length 要 -1 var startIndex= 0; //视频每节长度为2MB var length = 2 * 1024 * 1024; var range = rangeQuery." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/9ca9d0f0c9e06e1afdcd022acdb96cf9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-01-19T11:05:30+08:00" />
<meta property="article:modified_time" content="2021-01-19T11:05:30+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">谷歌浏览器中video播放视频进度条无法拖动，一点击进度条就回到0重新播放</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>问题：一个.mp4视频进度条无法拖动，只在谷歌浏览器中有问题，火狐中没有问题，console也不报错。</p> 
<p>初步排查到的bug原因:<strong>与Video标签适配的请求响应有问题。</strong></p> 
<p><strong>无法拖动的视频响应截图如下：</strong></p> 
<p><img alt="" height="769" src="https://images2.imgbox.com/54/c5/tjQ2Ybas_o.png" width="1200"></p> 
<p><img alt="" height="719" src="https://images2.imgbox.com/9f/66/6Q2pEEje_o.png" width="1200"></p> 
<p>能正常拖动的视频响应截图如下：</p> 
<p><img alt="" height="934" src="https://images2.imgbox.com/e0/b9/SPXeDM7v_o.png" width="1200"></p> 
<p>如何去解决：</p> 
<p>1.Chrome浏览器默认请求会在 Header 添加一个Range如下：服务器要做的就是响应这个Header</p> 
<pre><code>Range:             bytes=0-</code></pre> 
<p> 2.服务器接收到这个Header以后，响应的Header如下，同时需要设置状态码为206：</p> 
<pre><code class="language-javascript">Accept-Ranges: bytes

Content-Length: 2097152

Content-Range: bytes 0-2097151/38696534</code></pre> 
<p>3.百度了个服务端设置响应的代码，如下（我不太懂后台代码，仅供参考,有更好的解决方案，欢迎大家留言哈~)：</p> 
<pre><code class="language-java">    public ActionResult Video(Guid id)
        {
            //数据库存储的文件路径
            var archive = ManagerFactory.ArchiveManager.GetVideoArchive(id);
            //物理绝对路径
            var path = Server.MapPath("~/" + archive.Path);
 
            //设置响应头
            HttpContext.Response.Headers.Add("Accept-Ranges", "bytes");
            
            //判定是否响应Chrome中的Range请求
            var rangeQuery = HttpContext.Request.Headers["Range"];
            if (rangeQuery.IsNotNullAndNotEmpty())
            {
                //startIndex 与 endIndex 是索引值,是0开始的,注意在与 Length 比较的时候 Length 要 -1
                var startIndex= 0;
                //视频每节长度为2MB
                var length = 2 * 1024 * 1024;
                var range = rangeQuery.Split('=')[1].Split('-');
                startIndex= range[0].ParseToInt();
                var endIndex = startIndex + length - 1;
                var fileLength = (int)archive.Length;
 
                //是否指定了索引终结点
                if (range[1].IsNotNullAndNotEmpty())
                {
                    endIndex = range[1].ParseToInt();
                }
                if (endIndex &lt;= startIndex )
                {
                    endIndex = startIndex + length - 1;
                }
                if (endIndex &gt; fileLength - 1)
                {
                    endIndex = fileLength - 1;
                }
                
                //关键设置
                HttpContext.Response.Headers.Add("Content-Range", $"bytes {startIndex}-{endIndex}/{archive.Length}");
                //关键设置
                HttpContext.Response.StatusCode = 206;
 
                //按照索引读取文件流
                using (var fs = System.IO.File.OpenRead(path))
                {
                    var buffer = new byte[endIndex - startIndex + 1];
                    fs.Position = startIndex ;
                    fs.Read(buffer, 0, buffer.Length);
                    return File(buffer, archive.ContentType);
                }
            }
            
            //如果未设置则返回整个文件
            return File(path, archive.ContentType);
        }</code></pre> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/92191eea79e2d2b0dc5de9d416ff5e76/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">mysql 系统表 columns_MySQL系统表故障探究</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b1e9da30367cfe53e122a5c6cb3a0894/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">腾讯云mysql性能_腾讯云MySQL实例高IO版性能测试报告</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>