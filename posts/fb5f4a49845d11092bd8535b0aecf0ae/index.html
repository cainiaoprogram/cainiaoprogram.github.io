<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>intouch制作历史报警查询（时间查询，筛选关键字） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="intouch制作历史报警查询（时间查询，筛选关键字）" />
<meta property="og:description" content="在项目中，intouch制作历史报警查询已属于标配功能，如何做出按时间以及关键字来进行综合查询，提高历史报警查询效率仍然是一个值得研究的问题，接下来参考网上文章自己总结下如何制作。
1.DTPicker格式制作 首先，时间选择器的安装不再一一演示，（安装32位office系统，从向导中安装date and time picker即可）。然后，选择自定义格式，这里格式十分重要，直接关系到时间查询的准确性（12小时制，24小时制的区别）。
格式如下：yyyy-M-d H:mm:ss
控件时间，设置为上午/下午以区分24小时，时间选择为本地时间。
2020/5/4:备注
%H参数可以直接修改为24小时制
总体效果如下：
2.过滤器编写 过滤器的原理其实很简单，就是利用AlmDbViewCtrl控件本身自带的过滤器属性进行XML文档配置，然后再后台拼凑去过滤器的格式，填充好相应的查询关键字内容即可。
1.首先，编辑好过滤器路径和文件
C:\Program Files (x86)\Wonderware\InTouch\test.xml
2.查看文件格式和内容，试着手动新建一个看看格式。
3.可以利用自定义函数去拼凑相应格式，填写相应内容。
编写quickfunction函数:ALMFILTERSEARCH
FileDelete(&#34;C:\Program Files (x86)\Wonderware\InTouch\test.xml&#34;); FileWriteMessage( &#34;C:\Program Files (x86)\Wonderware\InTouch\test.xml&#34;,0, HIST_XMLCODE &#43;&#34;&lt;FILTER_FAVORITES&gt;&lt;RECORD&gt;&lt;FILTERNAME&gt;MYFILTER&lt;/FILTERNAME&gt;&lt;ELEMENT&gt;&#34;, 0 ); IF HIST_SEARCHINDEX == 1 THEN FileWriteMessage( &#34;C:\Program Files (x86)\Wonderware\InTouch\test.xml&#34;,-1, &#34;&lt;NAME&gt;名称&lt;/NAME&gt;&lt;ORIGNAME&gt;Name&lt;/ORIGNAME&gt;&lt;OPERATOR&gt;LIKE&lt;/OPERATOR&gt;&lt;VALUE&gt;%&#34;&#43;CONDITION&#43;&#34;%&lt;/VALUE&gt;&lt;PARENT&gt;0&lt;/PARENT&gt;&#34;, 0); ELSE FileWriteMessage( &#34;C:\Program Files (x86)\Wonderware\InTouch\test.xml&#34;,-1, &#34;&lt;NAME&gt;报警注释&lt;/NAME&gt;&lt;ORIGNAME&gt;Alarm Comment&lt;/ORIGNAME&gt;&lt;OPERATOR&gt;LIKE&lt;/OPERATOR&gt;&lt;VALUE&gt;%&#34;&#43;CONDITION&#43;&#34;%&lt;/VALUE&gt;&lt;PARENT&gt;0&lt;/PARENT&gt;&#34;, 0); ENDIF; FileWriteMessage( &#34;C:\Program Files (x86)\Wonderware\InTouch\test.xml&#34;, -1, &#34;&lt;/ELEMENT&gt;&lt;/RECORD&gt;&lt;/FILTER_FAVORITES&gt;&#34;, 0 ); #AlmDbViewCtrl1.FilterFavoritesFile = &#34;C:\Program Files (x86)\Wonderware\InTouch\test.xml&#34;; 其中：HIST_XMLCODE为内存消息，存放xml头部消息（&lt;?xml version=&#34;1.0&#34; encoding=&#34;GB2312&#34;?&gt;）
HIST_SEARCHINDEX为内存整型，单选按钮选择状态（选择标记名为1）" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/fb5f4a49845d11092bd8535b0aecf0ae/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-11-23T15:36:26+08:00" />
<meta property="article:modified_time" content="2019-11-23T15:36:26+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">intouch制作历史报警查询（时间查询，筛选关键字）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>在项目中，intouch制作历史报警查询已属于标配功能，如何做出按时间以及关键字来进行综合查询，提高历史报警查询效率仍然是一个值得研究的问题，接下来参考网上文章自己总结下如何制作。</p> 
<blockquote> 
 <h4><span style="color:#3399ea;"><strong>1.DTPicker格式制作</strong></span></h4> 
</blockquote> 
<p>首先，时间选择器的安装不再一一演示，（安装32位office系统，从向导中安装date and time picker即可）。然后，选择自定义格式，这里格式十分重要，直接关系到时间查询的准确性（12小时制，24小时制的区别）。</p> 
<p>格式如下：yyyy-M-d H:mm:ss</p> 
<p><img alt="" class="has" height="359" src="https://images2.imgbox.com/10/dc/iF0sXjMI_o.png" width="464"></p> 
<p>控件时间，设置为上午/下午以区分24小时，时间选择为本地时间。</p> 
<p><img alt="" class="has" height="435" src="https://images2.imgbox.com/11/6f/6krHbrDz_o.png" width="474"></p> 
<p>2020/5/4:备注</p> 
<p><span style="color:#f33b45;"><strong>%H参数可以直接修改为24小时制</strong></span></p> 
<p><img alt="" height="437" src="https://images2.imgbox.com/38/38/50wYTusv_o.png" width="481"></p> 
<p>总体效果如下：</p> 
<p><img alt="" class="has" height="106" src="https://images2.imgbox.com/b4/44/r3QH5f90_o.png" width="591"></p> 
<blockquote> 
 <h4><span style="color:#3399ea;"><strong>2.过滤器编写</strong></span></h4> 
</blockquote> 
<p>过滤器的原理其实很简单，就是利用AlmDbViewCtrl控件本身自带的过滤器属性进行XML文档配置，然后再后台拼凑去过滤器的格式，填充好相应的查询关键字内容即可。</p> 
<p>1.首先，编辑好过滤器路径和文件</p> 
<p>C:\Program Files (x86)\Wonderware\InTouch\test.xml</p> 
<p><img alt="" class="has" height="434" src="https://images2.imgbox.com/9f/e5/TY8rE19K_o.png" width="482"></p> 
<p>2.查看文件格式和内容，试着手动新建一个看看格式。</p> 
<p><img alt="" class="has" height="237" src="https://images2.imgbox.com/7b/b9/txq6n9Xc_o.png" width="410"></p> 
<p>3.可以利用自定义函数去拼凑相应格式，填写相应内容。</p> 
<p><img alt="" class="has" height="108" src="https://images2.imgbox.com/b8/e0/zLfUd9Ir_o.png" width="317"></p> 
<p>编写quickfunction函数:ALMFILTERSEARCH</p> 
<p><img alt="" class="has" height="293" src="https://images2.imgbox.com/a7/f5/vIVGAXPK_o.png" width="1200"></p> 
<pre class="has"><code class="language-vbnet">FileDelete("C:\Program Files (x86)\Wonderware\InTouch\test.xml");
FileWriteMessage( "C:\Program Files (x86)\Wonderware\InTouch\test.xml",0, HIST_XMLCODE +"&lt;FILTER_FAVORITES&gt;&lt;RECORD&gt;&lt;FILTERNAME&gt;MYFILTER&lt;/FILTERNAME&gt;&lt;ELEMENT&gt;", 0 );
IF HIST_SEARCHINDEX == 1 THEN
    FileWriteMessage( "C:\Program Files (x86)\Wonderware\InTouch\test.xml",-1, "&lt;NAME&gt;名称&lt;/NAME&gt;&lt;ORIGNAME&gt;Name&lt;/ORIGNAME&gt;&lt;OPERATOR&gt;LIKE&lt;/OPERATOR&gt;&lt;VALUE&gt;%"+CONDITION+"%&lt;/VALUE&gt;&lt;PARENT&gt;0&lt;/PARENT&gt;", 0);
ELSE 
    FileWriteMessage( "C:\Program Files (x86)\Wonderware\InTouch\test.xml",-1, "&lt;NAME&gt;报警注释&lt;/NAME&gt;&lt;ORIGNAME&gt;Alarm Comment&lt;/ORIGNAME&gt;&lt;OPERATOR&gt;LIKE&lt;/OPERATOR&gt;&lt;VALUE&gt;%"+CONDITION+"%&lt;/VALUE&gt;&lt;PARENT&gt;0&lt;/PARENT&gt;", 0);  
ENDIF;
FileWriteMessage( "C:\Program Files (x86)\Wonderware\InTouch\test.xml", -1, "&lt;/ELEMENT&gt;&lt;/RECORD&gt;&lt;/FILTER_FAVORITES&gt;", 0 );
#AlmDbViewCtrl1.FilterFavoritesFile = "C:\Program Files (x86)\Wonderware\InTouch\test.xml";</code></pre> 
<p>其中：HIST_XMLCODE为内存消息，存放xml头部消息（&lt;?xml version="1.0" encoding="GB2312"?&gt;）</p> 
<p>HIST_SEARCHINDEX为内存整型，单选按钮选择状态（选择标记名为1）</p> 
<p>CONDITION为内存消息，此处为查询的关键字内容。</p> 
<blockquote> 
 <h4><span style="color:#3399ea;"><strong>3.脚本编写</strong></span></h4> 
</blockquote> 
<p>脚本的话，主要分为窗口脚本，以及查询按钮脚本。窗口脚本主要用于填写显示时，初始化脚本。查询则为点击查询时，所约束的时间和过滤器内容。</p> 
<p>窗口脚本：规定默认时间选择当天一天时间，历史报警也显示为该天中所有报警信息。</p> 
<pre class="has"><code class="language-vbnet">#DTPicker1.value = $DateString+" "+ "00:00:00";
#DTPicker2.value = $DateString+"  "+"23:59:59";
#AlmDbViewCtrl1.SpecificTime = 1;
#AlmDbViewCtrl1.StartTime = StringMid(#DTPicker1.value,6,2) + "/" + StringMid(#DTPicker1.value,9,2) + "/" + StringMid(#DTPicker1.value,1,4) + " "+ StringMid(#DTPicker1.value,13,2) + StringMid(#DTPicker1.value,16,2) +StringMid(#DTPicker1.value,19,2) ;
#AlmDbViewCtrl1.EndTime = StringMid(#DTPicker2.value,6,2) + "/" + StringMid(#DTPicker2.value,9,2) + "/" + StringMid(#DTPicker2.value,1,4) + " " + StringMid(#DTPicker2.value,13,2) + StringMid(#DTPicker2.value,16,2) +StringMid(#DTPicker2.value,19,2) ;
#AlmDbViewCtrl1.Refresh();</code></pre> 
<p>2020/5/4:备注</p> 
<p>上述脚本在实际过程中存在小bug，会跳出月/日或年不对的问题，怀疑是03此类月份，和3月有写法上的不同，特此修改。</p> 
<pre><code class="language-vbnet">#DTPicker1.value = $DateString+" "+ "00:00:00";
#DTPicker2.value = $DateString+"  "+"23:59:59";
#AlmDbViewCtrl1.SpecificTime = 1;
#AlmDbViewCtrl1.StartTime=#DTPicker1.Month+ "/"+ #DTPicker1.Day+"/"+#DTPicker1.Year +" " + #DTPicker1.Hour+ ":"+ #DTPicker1.Minute+":"+#DTPicker1.Second;
#AlmDbViewCtrl1.EndTime=#DTPicker2.Month + "/"+ #DTPicker2.Day+"/"+#DTPicker2.Year +" " + #DTPicker2.Hour+ ":"+ #DTPicker2.Minute+":"+ #DTPicker2.Second;
#AlmDbViewCtrl1.Refresh();</code></pre> 
<p>查询脚本：条件判断，和调用quickfunctions函数建立过滤器判断。</p> 
<pre class="has"><code class="language-vbnet">#AlmDbViewCtrl1.StartTime=#DTPicker1.Month+ "/"+ #DTPicker1.Day+"/"+#DTPicker1.Year +" " + #DTPicker1.Hour+ ":"+ #DTPicker1.Minute+":"+#DTPicker1.Second;
#AlmDbViewCtrl1.EndTime=#DTPicker2.Month + "/"+ #DTPicker2.Day+"/"+#DTPicker2.Year +" " + #DTPicker2.Hour+ ":"+ #DTPicker2.Minute+":"+ #DTPicker2.Second;
#AlmDbViewCtrl1.GroupName = "$SYSTEM";

IF CONDITION &lt;&gt; "" THEN
CALL ALMFILTERSEARCH(CONDITION);
#AlmDbViewCtrl1.ShowFilter();

ELSE

#AlmDbViewCtrl1.Refresh();

ENDIF;
</code></pre> 
<p> </p> 
<blockquote> 
 <h4><span style="color:#3399ea;"><strong>4.演示效果</strong></span></h4> 
</blockquote> 
<p><img alt="" class="has" height="408" src="https://images2.imgbox.com/08/13/DsQehnuX_o.png" width="1000"></p> 
<p><img alt="" class="has" height="340" src="https://images2.imgbox.com/20/01/ATgIpLDD_o.png" width="1000"></p> 
<blockquote> 
 <h4><span style="color:#3399ea;"><strong>5.总结</strong></span></h4> 
</blockquote> 
<p>基本功能已经实现，在实际使用过程中若是还存在问题，再后续补充。</p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d24197a1bd2b1027f503fd37ae5ebf06/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">基于概率论的分类方法： 朴素贝叶斯</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/839b1fab9a9a0cb223a459e3e55250a5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">软件制造工程期末复习知识点汇总（一）——软件工程概述</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>