<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>200人 500人规模园区网设计（中小企业网络） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="200人 500人规模园区网设计（中小企业网络）" />
<meta property="og:description" content="200人 500人规模园区网 一、设备选型（光口和电口的交换机，注意设备利旧）二、技术需求三、详细配置STP Eth-trunkVLAN网关 SVIDHCP出口路由 NATNAT端口映射ACLTelnetVLAN 修剪拓扑配置文件 实验要求 ① 设置合理的STP优先级、边缘端口、Eth-trunk 环路会引起广播风暴，设置STP可二层防环，STP是破环协议 ② 企业内网划分多个vlan ，减少广播域大小，提高网络稳定性 ③ 所有设备，在任何位置都可以telnet远程管理 ④ 出口配置NAT ⑤ 所有用户均为自动获取ip地址（核心交换机） ⑥ 在企业出口将内网（web）服务器的80端口映射出去，允许外网用户访问 ⑦ 企业财务服务器，只允许财务部（vlan 30）的员工访问。 对于中小企业网络，医院，高校，酒店。 两层架构（核心层和接入层）
假设企业达到1000人，就加上汇聚层，在我的博客里也能看到1000人
中小型企业，尽量扁平化，如果设备太多，每一个设备都可成为故障点，传输速率也会慢点
人员分布
同个部门员工都在同一层楼，布线好布置，这样就两层架构。
如果员工分散在N层楼，这样就三层架构
企业网按部门划分网段，校园网按宿舍楼层划分网段
PC2是用一个路由器来模拟PC（telnet）
一、设备选型（光口和电口的交换机，注意设备利旧） …
二、技术需求 ①二层：STP Eth-trunk 即冗余技术，把接入层到核心层的两条线捆绑成一条线
让交换机运行快速生成树，核心交换机的优先级要调最低。
②vlan、trunk
vlan即虚拟局域网，隔离广播域，提升网络的稳定性 安全性，同时方便管理和控制这个网络，满足特殊网络的访问控制要求
一个vlan 对应一个网段 对应一个广播域
trunk是对vlan的一个提升，允许多个VLAN通信，接入交换机和核心交换机 通过trunk。
专门单独设置一个管理VLAN，用作远程管理
③网关、SVI配置
④DHCP配置
第一种方式：DHCP是在核心交换机上做的，启用DHCP功能
第二种方式：若找DHCP服务器分配的话，就要在核心交换机上做DHCP中继
配置DHCP地址池，网关DNS
⑤出口NAT配置
NAT：网络地址翻译，将内网私网地址转换成公网地址。在出口的时候 转换成公网地址
⑥服务器端口映射
将内网的某一台服务器的某一个端口 映射到公网上，方便外网直接访问某台设备和服务
⑦ACL配置
控制部门之间的互访
如：财务服务器，禁止部分员工去访问，只允许财务部和董事长
⑧telnet远程管理配置
远程登录，方便运维
⑨vlan修剪配置
通过进一步缩小广播域，进一步提升网络的稳定性和安全性
trunk 只允许有划分的vlan通过，而不是所有vlan通过。 使广播范围小了" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/4b33d81c0e1d349f53e060652e4b36dd/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-07-19T09:38:38+08:00" />
<meta property="article:modified_time" content="2020-07-19T09:38:38+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">200人 500人规模园区网设计（中小企业网络）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atelier-sulphurpool-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>200人 500人规模园区网</h4> 
 <ul><li><a href="#_24" rel="nofollow">一、设备选型（光口和电口的交换机，注意设备利旧）</a></li><li><a href="#_28" rel="nofollow">二、技术需求</a></li><li><a href="#_63" rel="nofollow">三、详细配置</a></li><li><ul><li><a href="#STP_Ethtrunk_64" rel="nofollow">STP Eth-trunk</a></li><li><a href="#VLAN_102" rel="nofollow">VLAN</a></li><li><a href="#_SVI_150" rel="nofollow">网关 SVI</a></li><li><a href="#DHCP_185" rel="nofollow">DHCP</a></li><li><a href="#_NAT_220" rel="nofollow">出口路由 NAT</a></li><li><a href="#NAT_234" rel="nofollow">NAT</a></li><li><a href="#_243" rel="nofollow">端口映射</a></li><li><a href="#ACL_251" rel="nofollow">ACL</a></li><li><a href="#Telnet_264" rel="nofollow">Telnet</a></li><li><a href="#VLAN__299" rel="nofollow">VLAN 修剪</a></li><li><a href="#_327" rel="nofollow">拓扑配置文件</a></li></ul> 
 </li></ul> 
</div> 
<br> 
<img src="https://images2.imgbox.com/9d/f8/MwbeT7wP_o.png" alt="占个坑"> 
<br> 实验要求 
<br> ① 设置合理的STP优先级、边缘端口、Eth-trunk 
<br> 环路会引起广播风暴，设置STP可二层防环，STP是破环协议 
<br> ② 企业内网划分多个vlan ，减少广播域大小，提高网络稳定性 
<br> ③ 所有设备，在任何位置都可以telnet远程管理 
<br> ④ 出口配置NAT 
<br> ⑤ 所有用户均为自动获取ip地址（核心交换机） 
<br> ⑥ 在企业出口将内网（web）服务器的80端口映射出去，允许外网用户访问 
<br> ⑦ 企业财务服务器，只允许财务部（vlan 30）的员工访问。 
<p></p> 
<ul><li> <p>对于中小企业网络，医院，高校，酒店。 两层架构（核心层和接入层）<br> 假设企业达到1000人，就加上汇聚层，在我的博客里也能看到1000人</p> </li><li> <p>中小型企业，尽量扁平化，如果设备太多，每一个设备都可成为故障点，传输速率也会慢点</p> </li><li> <p>人员分布<br> 同个部门员工都在同一层楼，布线好布置，这样就两层架构。<br> 如果员工分散在N层楼，这样就三层架构<br> 企业网按部门划分网段，校园网按宿舍楼层划分网段</p> </li><li> <p>PC2是用一个路由器来模拟PC（telnet）</p> </li></ul> 
<h2><a id="_24"></a>一、设备选型（光口和电口的交换机，注意设备利旧）</h2> 
<p>…</p> 
<p> </p> 
<h2><a id="_28"></a>二、技术需求</h2> 
<p>①二层：STP Eth-trunk 即冗余技术，把接入层到核心层的两条线捆绑成一条线<br> 让交换机运行快速生成树，核心交换机的优先级要调最低。</p> 
<p>②vlan、trunk<br> vlan即虚拟局域网，隔离广播域，提升网络的稳定性 安全性，同时方便管理和控制这个网络，满足特殊网络的访问控制要求<br> 一个vlan 对应一个网段 对应一个广播域<br> trunk是对vlan的一个提升，允许多个VLAN通信，接入交换机和核心交换机 通过trunk。<br> 专门单独设置一个管理VLAN，用作远程管理</p> 
<p>③网关、SVI配置</p> 
<p>④DHCP配置<br> 第一种方式：DHCP是在核心交换机上做的，启用DHCP功能<br> 第二种方式：若找DHCP服务器分配的话，就要在核心交换机上做DHCP中继<br> 配置DHCP地址池，网关DNS</p> 
<p>⑤出口NAT配置<br> NAT：网络地址翻译，将内网私网地址转换成公网地址。在出口的时候 转换成公网地址</p> 
<p>⑥服务器端口映射<br> 将内网的某一台服务器的某一个端口 映射到公网上，方便外网直接访问某台设备和服务</p> 
<p>⑦ACL配置<br> 控制部门之间的互访<br> 如：财务服务器，禁止部分员工去访问，只允许财务部和董事长</p> 
<p>⑧telnet远程管理配置<br> 远程登录，方便运维</p> 
<p>⑨vlan修剪配置<br> 通过进一步缩小广播域，进一步提升网络的稳定性和安全性<br> trunk 只允许有划分的vlan通过，而不是所有vlan通过。 使广播范围小了</p> 
<p> </p> 
<h2><a id="_63"></a>三、详细配置</h2> 
<h3><a id="STP_Ethtrunk_64"></a>STP Eth-trunk</h3> 
<p>①STP Eth-trunk设置合理的优先级（越小越优先），设置边缘端口<br> <strong>设置边缘端口的好处：可以提高网络的收敛速度，增加稳定性</strong><br> 千兆口连接上行，百兆口连接下行用户</p> 
<pre><code class="prism language-python"><span class="token number">1.</span>STP
核心：sw1
<span class="token punctuation">[</span>sw1<span class="token punctuation">]</span>stp root primary   <span class="token operator">//</span>成为主根桥

接入：sw2 sw3 sw4 sw5
<span class="token punctuation">[</span>sw2<span class="token punctuation">]</span>port<span class="token operator">-</span>g group<span class="token operator">-</span>member e0<span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span> to e0<span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">22</span>   <span class="token operator">//</span>g是group
<span class="token punctuation">[</span>sw2<span class="token operator">-</span>port<span class="token operator">-</span>group<span class="token punctuation">]</span>stp edged<span class="token operator">-</span>port enable

<span class="token number">2.</span>Eth<span class="token operator">-</span>trunk，将两条链路捆绑起来
sw1：
<span class="token builtin">int</span> eth<span class="token operator">-</span>trunk <span class="token number">2</span>
 mode lacp<span class="token operator">-</span>static
 trunkport gi <span class="token number">0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span>
 trunkport gi <span class="token number">0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">4</span>
<span class="token builtin">int</span> eth<span class="token operator">-</span>trunk <span class="token number">2</span>
 stp cost <span class="token number">10000</span>

sw2：
interface eth<span class="token operator">-</span>trunk <span class="token number">2</span>
 mode lacp<span class="token operator">-</span>static
 trunkport gi <span class="token number">0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span>
 trunkport gi <span class="token number">0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">2</span>
<span class="token builtin">int</span> eth<span class="token operator">-</span>trunk <span class="token number">2</span>
 stp cost <span class="token number">10000</span>  <span class="token operator">//</span>强制这个stp口的开销，设置了可以优化网络，让STP更稳定。如果一条链路断了，stp会重新收敛。 为了避免重新收敛这种，将其捆绑后设定一个固定cost
 
dis eth<span class="token operator">-</span>trunk <span class="token number">2</span> 
省略其他交换机的配置，都是类似的
sw3<span class="token operator">-</span><span class="token operator">-</span>sw1   eth<span class="token operator">-</span>trunk3
sw4<span class="token operator">-</span><span class="token operator">-</span>sw1   eth<span class="token operator">-</span>trunk4
sw5<span class="token operator">-</span><span class="token operator">-</span>sw1   eth<span class="token operator">-</span>trunk5

</code></pre> 
<h3><a id="VLAN_102"></a>VLAN</h3> 
<p>②vlan trunk</p> 
<pre><code class="prism language-python">接入SW2 SW3 SW4 SW5，创建vlan，将接口划入vlan
<span class="token punctuation">[</span>sw2<span class="token punctuation">]</span>vlan <span class="token number">10</span>
<span class="token punctuation">[</span>sw2<span class="token operator">-</span>vlan10<span class="token punctuation">]</span>vlan <span class="token number">20</span>
<span class="token punctuation">[</span>sw2<span class="token punctuation">]</span><span class="token builtin">int</span> eth<span class="token operator">-</span>trunk2
<span class="token punctuation">[</span>sw2<span class="token operator">-</span>Eth<span class="token operator">-</span>Trunk2<span class="token punctuation">]</span>port link<span class="token operator">-</span><span class="token builtin">type</span> trunk
<span class="token punctuation">[</span>sw2<span class="token operator">-</span>Eth<span class="token operator">-</span>Trunk2<span class="token punctuation">]</span>port trunk allow<span class="token operator">-</span><span class="token keyword">pass</span> vlan <span class="token builtin">all</span>   <span class="token operator">//</span><span class="token builtin">all</span>的范围就是 <span class="token number">2</span> to <span class="token number">4094</span>，因此这种也要修剪
<span class="token punctuation">[</span>sw2<span class="token punctuation">]</span><span class="token builtin">int</span> e0<span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">2</span>
<span class="token punctuation">[</span>sw2<span class="token operator">-</span>Ethernet0<span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">]</span>port link<span class="token operator">-</span><span class="token builtin">type</span> access
<span class="token punctuation">[</span>sw2<span class="token operator">-</span>Ethernet0<span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">]</span>port default vlan <span class="token number">10</span>
<span class="token punctuation">[</span>sw2<span class="token punctuation">]</span><span class="token builtin">int</span> e0<span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">3</span>
<span class="token punctuation">[</span>sw2<span class="token operator">-</span>Ethernet0<span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">3</span><span class="token punctuation">]</span>port link<span class="token operator">-</span><span class="token builtin">type</span> access
<span class="token punctuation">[</span>sw2<span class="token operator">-</span>Ethernet0<span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">3</span><span class="token punctuation">]</span>port default vlan <span class="token number">20</span>

针对交换机下很多PC，直接按组配置
<span class="token punctuation">[</span>sw3<span class="token punctuation">]</span>vlan <span class="token number">20</span>
<span class="token punctuation">[</span>sw3<span class="token punctuation">]</span><span class="token builtin">int</span> eth<span class="token operator">-</span>trunk3
<span class="token punctuation">[</span>sw3<span class="token operator">-</span>Eth<span class="token operator">-</span>Trunk3<span class="token punctuation">]</span>port link<span class="token operator">-</span><span class="token builtin">type</span> trunk
<span class="token punctuation">[</span>sw3<span class="token operator">-</span>Eth<span class="token operator">-</span>Trunk3<span class="token punctuation">]</span>port trunk allow<span class="token operator">-</span><span class="token keyword">pass</span> vlan <span class="token builtin">all</span>

<span class="token punctuation">[</span>sw3<span class="token punctuation">]</span>port<span class="token operator">-</span>g g Ethernet <span class="token number">0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">3</span> to Ethernet <span class="token number">0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">22</span>
<span class="token punctuation">[</span>sw3<span class="token operator">-</span>port<span class="token operator">-</span>group<span class="token punctuation">]</span>port link<span class="token operator">-</span><span class="token builtin">type</span> access
<span class="token punctuation">[</span>sw3<span class="token operator">-</span>port<span class="token operator">-</span>group<span class="token punctuation">]</span>port default vlan <span class="token number">3</span> <span class="token number">0</span>
 sw4 sw5 配置略
 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>


核心SW1，修剪
接入交换机有的VLAN，也要在核心交换机上一并创建
<span class="token punctuation">[</span>sw1<span class="token punctuation">]</span>vlan <span class="token number">10</span>
<span class="token punctuation">[</span>sw1<span class="token punctuation">]</span>vlan <span class="token number">20</span>
<span class="token punctuation">[</span>sw1<span class="token punctuation">]</span><span class="token builtin">int</span> eth<span class="token operator">-</span>trunk <span class="token number">2</span>
<span class="token punctuation">[</span>sw1<span class="token operator">-</span>Eth<span class="token operator">-</span>Trunk2<span class="token punctuation">]</span>port link<span class="token operator">-</span><span class="token builtin">type</span> trunk
<span class="token punctuation">[</span>sw1<span class="token operator">-</span>Eth<span class="token operator">-</span>Trunk2<span class="token punctuation">]</span>port trunk allow<span class="token operator">-</span><span class="token keyword">pass</span> vlan <span class="token number">10</span> <span class="token number">20</span> <span class="token number">999</span> 
这种就是VLAN修剪，原因：
如果是trunk <span class="token builtin">all</span>，它的广播域会过大，整个trunk链路都是广播域，使网络不稳定
因为用户发送的广播报文，带着vlan10的标签的广播会发送到所有trunk中，即所有的交换机都会收到，即使接下来其他交换机收到不会发到PC。

直接一次性按组配置，这种就全是<span class="token builtin">all</span>，后期要修剪比较好
<span class="token punctuation">[</span>sw1<span class="token punctuation">]</span>vlan batch <span class="token number">10</span> <span class="token number">20</span> <span class="token number">30</span> <span class="token number">40</span> <span class="token number">200</span>
<span class="token punctuation">[</span>sw1<span class="token punctuation">]</span>port<span class="token operator">-</span>g g Eth<span class="token operator">-</span>Trunk <span class="token number">2</span> to Eth<span class="token operator">-</span>Trunk <span class="token number">5</span>
<span class="token punctuation">[</span>sw1<span class="token operator">-</span>port<span class="token operator">-</span>group<span class="token punctuation">]</span>port link <span class="token builtin">type</span> turnk
<span class="token punctuation">[</span>sw1<span class="token operator">-</span>port<span class="token operator">-</span>group<span class="token punctuation">]</span>port turnk allow<span class="token operator">-</span><span class="token keyword">pass</span> vlan <span class="token builtin">all</span>

</code></pre> 
<h3><a id="_SVI_150"></a>网关 SVI</h3> 
<p>③网关 SVI SVI就是VLAN IF接口</p> 
<pre><code class="prism language-python">DHCP自动获取IP地址，就是通过网关来获取的
这里先配置接口
sw1<span class="token punctuation">:</span>   交换机虚拟接口
<span class="token builtin">int</span> vlanif10
ip add <span class="token number">192.168</span><span class="token number">.10</span><span class="token number">.1</span> <span class="token number">255.255</span><span class="token number">.255</span><span class="token number">.0</span>
<span class="token builtin">int</span> vlanif20
ip add <span class="token number">192.168</span><span class="token number">.20</span><span class="token number">.1</span> <span class="token number">255.255</span><span class="token number">.255</span><span class="token number">.0</span>
<span class="token builtin">int</span> vlanif30
ip add <span class="token number">192.168</span><span class="token number">.30</span><span class="token number">.1</span> <span class="token number">255.255</span><span class="token number">.255</span><span class="token number">.0</span>
<span class="token builtin">int</span> vlanif40
ip add <span class="token number">192.168</span><span class="token number">.40</span><span class="token number">.1</span> <span class="token number">255.255</span><span class="token number">.255</span><span class="token number">.0</span>
<span class="token builtin">int</span> vlanif200
ip add <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.1</span> <span class="token number">255.255</span><span class="token number">.255</span><span class="token number">.0</span>
</code></pre> 
<p>三层交换机和路由器的三层对接：<br> <img src="https://images2.imgbox.com/fe/3b/xJwyF2rg_o.png" alt="在这里插入图片描述"><br> 交换机接口 默认是不能配置IP地址的。 所以这时使用vlan if 接口对接<br> 然后给交换机vlanif 800 配置 192.168.254.2<br> 出口R1的ge0/0/0 配置 192.168.254.1</p> 
<p>SW1的具体配置</p> 
<pre><code class="prism language-python">sw1：
<span class="token punctuation">[</span>sw1<span class="token punctuation">]</span>vlan <span class="token number">800</span>
<span class="token punctuation">[</span>sw1<span class="token punctuation">]</span><span class="token builtin">int</span> g <span class="token number">0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">24</span>
port link<span class="token operator">-</span><span class="token builtin">type</span> access  <span class="token operator">//</span>配置成access，别配置成trunk
port default vlan <span class="token number">800</span>
<span class="token punctuation">[</span>sw1<span class="token punctuation">]</span><span class="token builtin">int</span> vlanif <span class="token number">800</span>
ip add <span class="token number">192.168</span><span class="token number">.254</span><span class="token number">.2</span> <span class="token number">255.255</span><span class="token number">.255</span><span class="token number">.0</span>
</code></pre> 
<h3><a id="DHCP_185"></a>DHCP</h3> 
<p>④DHCP配置 服务器地址是静态配置</p> 
<pre><code class="prism language-python">sw1：
<span class="token punctuation">[</span>sw1<span class="token punctuation">]</span>dhcp enable
<span class="token punctuation">[</span>sw1<span class="token punctuation">]</span>ip pool caiwu
<span class="token punctuation">[</span>sw1<span class="token operator">-</span>ip<span class="token operator">-</span>pool<span class="token operator">-</span>caiwu<span class="token punctuation">]</span>gateway<span class="token operator">-</span><span class="token builtin">list</span> <span class="token number">192.168</span><span class="token number">.30</span><span class="token number">.1</span>
<span class="token punctuation">[</span>sw1<span class="token operator">-</span>ip<span class="token operator">-</span>pool<span class="token operator">-</span>caiwu<span class="token punctuation">]</span>network <span class="token number">192.168</span><span class="token number">.30</span><span class="token number">.0</span> mask <span class="token number">24</span>
<span class="token punctuation">[</span>sw1<span class="token operator">-</span>ip<span class="token operator">-</span>pool<span class="token operator">-</span>caiwu<span class="token punctuation">]</span>dns<span class="token operator">-</span><span class="token builtin">list</span> <span class="token number">114.114</span><span class="token number">.114</span><span class="token number">.114</span> <span class="token number">8.8</span><span class="token number">.8</span><span class="token number">.8</span>
<span class="token comment">#</span>
ip pool jishu
gateway<span class="token operator">-</span><span class="token builtin">list</span> <span class="token number">192.168</span><span class="token number">.40</span><span class="token number">.1</span>
network <span class="token number">192.168</span><span class="token number">.40</span><span class="token number">.0</span> mask <span class="token number">255.255</span><span class="token number">.255</span><span class="token number">.0</span>
dns<span class="token operator">-</span><span class="token builtin">list</span> <span class="token number">114.114</span><span class="token number">.144</span><span class="token number">.114</span> <span class="token number">8.8</span><span class="token number">.8</span><span class="token number">.8</span>
<span class="token comment">#</span>
ip pool xiaoshou_1
gateway<span class="token operator">-</span><span class="token builtin">list</span> <span class="token number">192.168</span><span class="token number">.10</span><span class="token number">.1</span>
network <span class="token number">192.168</span><span class="token number">.10</span><span class="token number">.0</span> mask <span class="token number">255.255</span><span class="token number">.255</span><span class="token number">.0</span>
dns<span class="token operator">-</span><span class="token builtin">list</span> <span class="token number">114.114</span><span class="token number">.144</span><span class="token number">.114</span> <span class="token number">8.8</span><span class="token number">.8</span><span class="token number">.8</span>
<span class="token comment">#</span>
ip pool xiaoshou_2
gateway<span class="token operator">-</span><span class="token builtin">list</span> <span class="token number">192.168</span><span class="token number">.20</span><span class="token number">.1</span>
network <span class="token number">192.168</span><span class="token number">.20</span><span class="token number">.0</span> mask <span class="token number">255.255</span><span class="token number">.255</span><span class="token number">.0</span>
dns<span class="token operator">-</span><span class="token builtin">list</span> <span class="token number">114.114</span><span class="token number">.144</span><span class="token number">.114</span> <span class="token number">8.8</span><span class="token number">.8</span><span class="token number">.8</span>
<span class="token comment">#</span>

<span class="token comment">#用户请求，交换机查看用户请求报文，看用户是来自VLAN 10，然后会查看路由表的VLAN IF 10上配的地址网段是 192.168.10.0网段，让用户去全局上拿地址池</span>
<span class="token punctuation">[</span>sw1<span class="token punctuation">]</span><span class="token builtin">int</span> vlanif <span class="token number">10</span>
<span class="token punctuation">[</span>sw1<span class="token operator">-</span>vlanif10<span class="token punctuation">]</span>dhcp select <span class="token keyword">global</span>
<span class="token punctuation">[</span>sw1<span class="token punctuation">]</span><span class="token builtin">int</span> vlanif <span class="token number">20</span>
<span class="token punctuation">[</span>sw1<span class="token operator">-</span>vlanif20<span class="token punctuation">]</span>dhcp select <span class="token keyword">global</span>       
<span class="token number">30</span> <span class="token number">40</span> <span class="token number">50</span> 略

</code></pre> 
<h3><a id="_NAT_220"></a>出口路由 NAT</h3> 
<p>⑤出口路由 NAT</p> 
<pre><code class="prism language-python">核心sw1上设置缺省路由 指向出口路由器
<span class="token punctuation">[</span>sw1<span class="token punctuation">]</span>ip route<span class="token operator">-</span>static <span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span> <span class="token number">0</span> <span class="token number">192.168</span><span class="token number">.254</span><span class="token number">.1</span>

出口路由器上设置缺省路由  指向运营商
<span class="token punctuation">[</span>R1<span class="token punctuation">]</span>ip route<span class="token operator">-</span>static <span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span> <span class="token number">0</span> <span class="token number">12.1</span><span class="token number">.1</span><span class="token number">.6</span>

出去后 要回来
路由器要根据路由表回去
<span class="token punctuation">[</span>R1<span class="token punctuation">]</span>ip route<span class="token operator">-</span>static <span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.0</span> <span class="token number">16</span> <span class="token number">192.168</span><span class="token number">.254</span><span class="token number">.2</span>
</code></pre> 
<h3><a id="NAT_234"></a>NAT</h3> 
<p>⑥NAT</p> 
<pre><code class="prism language-python">acl <span class="token number">2000</span>
 rule <span class="token number">5</span> permit source <span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.0</span> <span class="token number">0.0</span><span class="token number">.255</span><span class="token number">.255</span>
<span class="token punctuation">[</span>R1<span class="token punctuation">]</span><span class="token builtin">int</span> g0<span class="token operator">/</span><span class="token number">1</span>
<span class="token punctuation">[</span> <span class="token punctuation">]</span>nat outbound <span class="token number">2000</span>
</code></pre> 
<h3><a id="_243"></a>端口映射</h3> 
<p>⑦服务器端口映射</p> 
<pre><code class="prism language-python">R1<span class="token punctuation">:</span>
<span class="token builtin">int</span> g0<span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span>
nat server protocol tcp <span class="token keyword">global</span> <span class="token number">12.1</span><span class="token number">.1</span><span class="token number">.2</span> <span class="token number">80</span> inside <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.10</span> <span class="token number">80</span>
</code></pre> 
<h3><a id="ACL_251"></a>ACL</h3> 
<p>⑧ACL配置 只有财务部vlan30可以访问财务服务器</p> 
<pre><code class="prism language-python">sw1<span class="token punctuation">:</span>
acl number <span class="token number">3000</span>
 rule <span class="token number">5</span> permit ip source <span class="token number">192.168</span><span class="token number">.30</span><span class="token number">.0</span> <span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.255</span> destination <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.20</span> <span class="token number">0</span>
 rule <span class="token number">10</span> deny ip destination <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.20</span> <span class="token number">0</span>

<span class="token builtin">int</span> eth<span class="token operator">-</span>trunk5
 traffic<span class="token operator">-</span><span class="token builtin">filter</span> outbound acl <span class="token number">3000</span> 
 
</code></pre> 
<h3><a id="Telnet_264"></a>Telnet</h3> 
<p>⑨Telnet配置</p> 
<pre><code class="prism language-python">所有设备（路由 交换机）都需如下配置
telnet server enable
aaa
 local<span class="token operator">-</span>user aa privilege level <span class="token number">3</span> password cipher <span class="token number">123</span>
 local<span class="token operator">-</span>user aa service<span class="token operator">-</span><span class="token builtin">type</span> telnet

user<span class="token operator">-</span>interface vty <span class="token number">0</span> <span class="token number">4</span>
 authentication<span class="token operator">-</span>mode aaa
</code></pre> 
<p>接入交换机（二层交换机）配置管理地址（交换机有了管理地址才能telnet）：<br> 使用专门管理vlan 999承载telnet的管理流量，建议将管理IP地址配置在一个网段即可<br> 管理vlan：vlan 999<br> 管理网段：192.168.253.0/24</p> 
<pre><code class="prism language-python">sw1：
vlan <span class="token number">999</span>
<span class="token builtin">int</span> vlanif <span class="token number">999</span>
ip add <span class="token number">192.168</span><span class="token number">.253</span><span class="token number">.1</span> <span class="token number">24</span>

sw2   
vlan <span class="token number">999</span>   <span class="token operator">//</span>创建vlan
<span class="token builtin">int</span> vlanif <span class="token number">999</span>  <span class="token operator">//</span>配置vlan 管理地址
ip add <span class="token number">192.168</span><span class="token number">.253</span><span class="token number">.2</span> <span class="token number">24</span>
sw3  sw4  sw5 配置略，只要ip地址最后一位改一下

❤下面该缺省路由是为了管理流量回包。每个接入层交换机都需要配置。 
因为这里管理和业务是分开的。
<span class="token punctuation">[</span>sw2<span class="token punctuation">]</span>ip route<span class="token operator">-</span>s <span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span> <span class="token number">0</span> <span class="token number">192.168</span><span class="token number">.253</span><span class="token number">.1</span>  <span class="token operator">//</span>sw2配置缺省路由 回到核心交换机
sw3  sw4  sw5 配置略，一模一样的

</code></pre> 
<h3><a id="VLAN__299"></a>VLAN 修剪</h3> 
<p>⑨VLAN修剪<br> 为了进一步减少trunk链路上的广播报文的发送范围，进一步缩小广播域，在trunk链路上配置VLAN的过滤</p> 
<pre><code class="prism language-python">sw2 
<span class="token builtin">int</span> eth<span class="token operator">-</span>trunk <span class="token number">2</span>
port link<span class="token operator">-</span><span class="token builtin">type</span> trunk
port trunk allow<span class="token operator">-</span><span class="token keyword">pass</span> vlan <span class="token number">10</span> <span class="token number">20</span> <span class="token number">999</span>
sw3 sw4 也是类似这样配置。修剪

sw1
<span class="token builtin">int</span> eth<span class="token operator">-</span>trunk <span class="token number">2</span>
port link<span class="token operator">-</span><span class="token builtin">type</span> trunk
port trunk allow<span class="token operator">-</span><span class="token keyword">pass</span> vlan <span class="token number">10</span> <span class="token number">20</span> <span class="token number">999</span>

</code></pre> 
<p>补充知识点</p> 
<ul><li>创建vlan，配置vlan管理地址，根据管理地址对应的网段 去DHCP地址池找相应，自动分配</li><li>因为交换机 不可以在接口直接配置IP地址，即使是核心交换机也不行<br> 因此使用vlanif接口方式 使交换机和路由器 三层对接</li><li>楼宇还是楼层，都要根据需求去划分vlan。如果是学生宿舍，每层楼的vlan就独立<br> 楼宇之间 光纤千兆Gigabitethernet， 楼层之间 百兆Ethernet</li><li>用户上网是走二层的MAC地址</li><li>VLAN间的本质是 标签的转换， VLAN间通信</li></ul> 
<p> </p> 
<h3><a id="_327"></a>拓扑配置文件</h3> 
<p>附上网络配置（积分可以去淘宝搜一下CSDN）：<br> https://download.csdn.net/download/qq_39578545/12381369</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c091ce9e5edd2e2e67f6ef6c32e8b8d4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C语言-定义一个结构体，其中包括学号，学生姓名，分数三个成员。</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c5016b61bf8f9bd440473265b9e4f4b6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">SENet详解-最后一届ImageNet冠军模型</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>