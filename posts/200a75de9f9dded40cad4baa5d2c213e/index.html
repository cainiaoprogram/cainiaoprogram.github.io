<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>hg226g 虚拟服务器,华为HG8245H救砖番外篇之利用JTAG完成硬件初始化 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="hg226g 虚拟服务器,华为HG8245H救砖番外篇之利用JTAG完成硬件初始化" />
<meta property="og:description" content="原文发在我的bloghttp://blog.csersoft.net/archives/196
前言
前几天使用UBoot恢复mtd分区时因为误操作导致flash全部被擦除。这下设备上电时连StartCode都跑不了。写内存跑StartCode都不行外部设备没有初始化无法访问DRAM&gt; mdw 0x82000000
data abort at 0x82000000, dfsr = 0x00001008
可以看到原本是放置StartCode的地址现在都无法访问。折腾了几天大致成功的利用JTAG完成硬件初步初始化并且可以加载StartCode到内存并成功运行了。
问题解决思路
想要写内存来运行代码就必须对内存进行初始化操作。但这个初始化操作应该都是StartCode里做的。现在StartCode都跑不起更别说写内存了。
如果用JTAG来模拟StartCode的初始操作的话也不太现实毕竟100多KB的代码分析起来就够累人了别说模拟了。但是如果能找到一个平衡点模拟少量的操作让硬件环境刚好够我利用来跑StartCode这样实现还是比较容易的。
在网上查了很多关于ARM处理器复位时的流程和低级bootloader做的工作相关的资料。大致感觉有路可走
一般对于采用非可直接寻址的存储设备(Nand Flash)来引导的话CPU内部会有一个bootrombootrom在上电时会从非可直接寻址的存储设备的固定位置装载固定大小的内容到片内SRAM比如从Nand Flash的0地址读取2KB内容到片内SRAM然后设置pc过去并运行。这很小的一部分bootloader就会做简单的初始化操作然后读取完整的bootloader到内存中的指定位置并运行。
逆向分析StartCode
StartCode的一开始就是ARM经典的中断向量表
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24seg000:00000000;---------------------------------------------------------------------------
seg000:00000000Bsub_5C
seg000:00000004;---------------------------------------------------------------------------
seg000:00000004LDRPC,=sub_820003A0
seg000:00000008;---------------------------------------------------------------------------
seg000:00000008LDRPC,=loc_82000400
seg000:0000000C;---------------------------------------------------------------------------
seg000:0000000CLDRPC,=loc_82000460
seg000:00000010;---------------------------------------------------------------------------
seg000:00000010LDRPC,=loc_820004C0
seg000:00000014;---------------------------------------------------------------------------
seg000:00000014LDRPC,=loc_82000520
seg000:00000018;---------------------------------------------------------------------------
seg000:00000018LDRPC,=loc_82000580
seg000:0000001C;---------------------------------------------------------------------------
seg000:0000001CLDRPC,=loc_820005E0
seg000:0000001C;---------------------------------------------------------------------------
seg000:00000020off_20DCDsub_820003A0;DATAXREF:seg000:00000004
seg000:00000024off_24DCDloc_82000400;DATAXREF:seg000:00000008
seg000:00000028off_28DCDloc_82000460;DATAXREF:seg000:0000000C
seg000:0000002Coff_2CDCDloc_820004C0;DATAXREF:seg000:00000010
seg000:00000030off_30DCDloc_82000520;DATAXREF:seg000:00000014
seg000:00000034off_34DCDloc_82000580;DATAXREF:seg000:00000018
seg000:00000038off_38DCDloc_820005E0;DATAXREF:seg000:0000001C" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/200a75de9f9dded40cad4baa5d2c213e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-08-05T02:00:28+08:00" />
<meta property="article:modified_time" content="2021-08-05T02:00:28+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">hg226g 虚拟服务器,华为HG8245H救砖番外篇之利用JTAG完成硬件初始化</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="font-size:16px;"> 
 <p>原文发在我的bloghttp://blog.csersoft.net/archives/196</p> 
 <p>前言</p> 
 <p>前几天使用UBoot恢复mtd分区时因为误操作导致flash全部被擦除。这下设备上电时连StartCode都跑不了。写内存跑StartCode都不行外部设备没有初始化无法访问DRAM&gt; mdw 0x82000000</p> 
 <p>data abort at 0x82000000, dfsr = 0x00001008</p> 
 <p>可以看到原本是放置StartCode的地址现在都无法访问。折腾了几天大致成功的利用JTAG完成硬件初步初始化并且可以加载StartCode到内存并成功运行了。</p> 
 <p>问题解决思路</p> 
 <p>想要写内存来运行代码就必须对内存进行初始化操作。但这个初始化操作应该都是StartCode里做的。现在StartCode都跑不起更别说写内存了。</p> 
 <p>如果用JTAG来模拟StartCode的初始操作的话也不太现实毕竟100多KB的代码分析起来就够累人了别说模拟了。但是如果能找到一个平衡点模拟少量的操作让硬件环境刚好够我利用来跑StartCode这样实现还是比较容易的。</p> 
 <p>在网上查了很多关于ARM处理器复位时的流程和低级bootloader做的工作相关的资料。大致感觉有路可走</p> 
 <p>一般对于采用非可直接寻址的存储设备(Nand Flash)来引导的话CPU内部会有一个bootrombootrom在上电时会从非可直接寻址的存储设备的固定位置装载固定大小的内容到片内SRAM比如从Nand Flash的0地址读取2KB内容到片内SRAM然后设置pc过去并运行。这很小的一部分bootloader就会做简单的初始化操作然后读取完整的bootloader到内存中的指定位置并运行。</p> 
 <p>逆向分析StartCode</p> 
 <p>StartCode的一开始就是ARM经典的中断向量表</p> 
 <p>1</p> 
 <p>2</p> 
 <p>3</p> 
 <p>4</p> 
 <p>5</p> 
 <p>6</p> 
 <p>7</p> 
 <p>8</p> 
 <p>9</p> 
 <p>10</p> 
 <p>11</p> 
 <p>12</p> 
 <p>13</p> 
 <p>14</p> 
 <p>15</p> 
 <p>16</p> 
 <p>17</p> 
 <p>18</p> 
 <p>19</p> 
 <p>20</p> 
 <p>21</p> 
 <p>22</p> 
 <p>23</p> 
 <p>24seg000:00000000;---------------------------------------------------------------------------</p> 
 <p>seg000:00000000Bsub_5C</p> 
 <p>seg000:00000004;---------------------------------------------------------------------------</p> 
 <p>seg000:00000004LDRPC,=sub_820003A0</p> 
 <p>seg000:00000008;---------------------------------------------------------------------------</p> 
 <p>seg000:00000008LDRPC,=loc_82000400</p> 
 <p>seg000:0000000C;---------------------------------------------------------------------------</p> 
 <p>seg000:0000000CLDRPC,=loc_82000460</p> 
 <p>seg000:00000010;---------------------------------------------------------------------------</p> 
 <p>seg000:00000010LDRPC,=loc_820004C0</p> 
 <p>seg000:00000014;---------------------------------------------------------------------------</p> 
 <p>seg000:00000014LDRPC,=loc_82000520</p> 
 <p>seg000:00000018;---------------------------------------------------------------------------</p> 
 <p>seg000:00000018LDRPC,=loc_82000580</p> 
 <p>seg000:0000001C;---------------------------------------------------------------------------</p> 
 <p>seg000:0000001CLDRPC,=loc_820005E0</p> 
 <p>seg000:0000001C;---------------------------------------------------------------------------</p> 
 <p>seg000:00000020off_20DCDsub_820003A0;DATAXREF:seg000:00000004</p> 
 <p>seg000:00000024off_24DCDloc_82000400;DATAXREF:seg000:00000008</p> 
 <p>seg000:00000028off_28DCDloc_82000460;DATAXREF:seg000:0000000C</p> 
 <p>seg000:0000002Coff_2CDCDloc_820004C0;DATAXREF:seg000:00000010</p> 
 <p>seg000:00000030off_30DCDloc_82000520;DATAXREF:seg000:00000014</p> 
 <p>seg000:00000034off_34DCDloc_82000580;DATAXREF:seg000:00000018</p> 
 <p>seg000:00000038off_38DCDloc_820005E0;DATAXREF:seg000:0000001C</p> 
 <p>第一个中断向量就是偏移0的复位中断向量。CPU在复位时会从这里开始执行复位中断向量直接跳到0x5C处处理reset中断的实际代码位置。</p> 
 <p>在StartCode的0x5C处IDA Pro就可以直接F5了以下为还原的伪代码部分地方还原的有问题手工修改过</p> 
 <p>1</p> 
 <p>2</p> 
 <p>3</p> 
 <p>4</p> 
 <p>5</p> 
 <p>6</p> 
 <p>7</p> 
 <p>8</p> 
 <p>9</p> 
 <p>10</p> 
 <p>11</p> 
 <p>12</p> 
 <p>13</p> 
 <p>14</p> 
 <p>15</p> 
 <p>16</p> 
 <p>17</p> 
 <p>18</p> 
 <p>19</p> 
 <p>20</p> 
 <p>21</p> 
 <p>22</p> 
 <p>23</p> 
 <p>24</p> 
 <p>25</p> 
 <p>26</p> 
 <p>27</p> 
 <p>28</p> 
 <p>29</p> 
 <p>30</p> 
 <p>31</p> 
 <p>32</p> 
 <p>33</p> 
 <p>34</p> 
 <p>35</p> 
 <p>36</p> 
 <p>37</p> 
 <p>38</p> 
 <p>39</p> 
 <p>40</p> 
 <p>41</p> 
 <p>42</p> 
 <p>43</p> 
 <p>44</p> 
 <p>45</p> 
 <p>46</p> 
 <p>47</p> 
 <p>48</p> 
 <p>49</p> 
 <p>50</p> 
 <p>51</p> 
 <p>52</p> 
 <p>53</p> 
 <p>54</p> 
 <p>55</p> 
 <p>56</p> 
 <p>57</p> 
 <p>58</p> 
 <p>59</p> 
 <p>60</p> 
 <p>61</p> 
 <p>62</p> 
 <p>63</p> 
 <p>64</p> 
 <p>65</p> 
 <p>66</p> 
 <p>67</p> 
 <p>68</p> 
 <p>69</p> 
 <p>70</p> 
 <p>71</p> 
 <p>72</p> 
 <p>73</p> 
 <p>74</p> 
 <p>75</p> 
 <p>76</p> 
 <p>77</p> 
 <p>78</p> 
 <p>79</p> 
 <p>80</p> 
 <p>81</p> 
 <p>82</p> 
 <p>83</p> 
 <p>84</p> 
 <p>85</p> 
 <p>86</p> 
 <p>87</p> 
 <p>88</p> 
 <p>89</p> 
 <p>90</p> 
 <p>91</p> 
 <p>92</p> 
 <p>93</p> 
 <p>94</p> 
 <p>95</p> 
 <p>96</p> 
 <p>97</p> 
 <p>98</p> 
 <p>99</p> 
 <p>100</p> 
 <p>101</p> 
 <p>102</p> 
 <p>103</p> 
 <p>104</p> 
 <p>105</p> 
 <p>106</p> 
 <p>107</p> 
 <p>108</p> 
 <p>109</p> 
 <p>110</p> 
 <p>111</p> 
 <p>112</p> 
 <p>113</p> 
 <p>114</p> 
 <p>115</p> 
 <p>116</p> 
 <p>117</p> 
 <p>118</p> 
 <p>119voidsub_5C()</p> 
 <p>{<!-- --></p> 
 <p>unsignedint_R0;// r0@1</p> 
 <p>signedintv5;// r3@1</p> 
 <p>signedintv6;// r0@1</p> 
 <p>signedintv7;// r1@2</p> 
 <p>_DWORD*v8;// r2@14</p> 
 <p>int(*v9)();// r0@16</p> 
 <p>void(__noreturn*v10)();// r1@16</p> 
 <p>intv11;// r3@17</p> 
 <p>intv12;// r4@17</p> 
 <p>intv13;// r5@17</p> 
 <p>intv14;// r6@17</p> 
 <p>intv15;// r7@17</p> 
 <p>intv16;// r8@17</p> 
 <p>intv17;// r9@17</p> 
 <p>intv18;// r10@17</p> 
 <p>//enter Supervisor mode</p> 
 <p>_R0=__get_CPSR()&amp;0xFFFFFFE0|0xD3;</p> 
 <p>__asm{MSRCPSR_cf,R0}</p> 
 <p>//arm cp15 coprocessor</p> 
 <p>__mcr(15,0,0,8,7,0);</p> 
 <p>__mcr(15,0,0,7,5,0);</p> 
 <p>__mcr(15,2,0,0,0,0);</p> 
 <p>v5=((unsignedint)__mrc(15,1,0,0,0)&gt;&gt;13)&amp;0x1FF;</p> 
 <p>v6=0;</p> 
 <p>do</p> 
 <p>{<!-- --></p> 
 <p>v7=0;</p> 
 <p>do</p> 
 <p>__mcr(15,0,(v6&lt;&lt;30)|32*v7++,7,6,2);</p> 
 <p>while(v7&lt;=v5);</p> 
 <p>++v6;</p> 
 <p>}</p> 
 <p>while(v6&lt;4);</p> 
 <p>if(__mrc(15,0,0,0,5)&amp;0xF)</p> 
 <p>gotoLABEL_25;</p> 
 <p>__mcr(15,0,__mrc(15,0,1,0,0)&amp;0xFFFFDFF8|0x802,1,0,0);</p> 
 <p>if(!(__mrc(15,0,0,0,5)&amp;0xF))</p> 
 <p>{<!-- --></p> 
 <p>sub_6EC();</p> 
 <p>sub_700();</p> 
 <p>sub_710();</p> 
 <p>}</p> 
 <p>__mcr(15,0,__mrc(15,0,1,0,0)|0x1000,1,0,0);</p> 
 <p>v10A30004=853;</p> 
 <p>v10A20100|=2u;</p> 
 <p>sub_FAD4();</p> 
 <p>dword_1010007C=-1;</p> 
 <p>dword_1010008C=-1;</p> 
 <p>dword_1010012C=-1;</p> 
 <p>dword_10100130=0xFE7FFFFF;</p> 
 <p>dword_10100138|=0x7Fu;</p> 
 <p>dword_10100140|=0x80000000;</p> 
 <p>if(dword_10100800==0x51152100)</p> 
 <p>{<!-- --></p> 
 <p>if((dword_10100190&amp;1)==1)</p> 
 <p>dword_1010005C=0x8103844D;</p> 
 <p>dword_1010005C=0x8103444D;</p> 
 <p>}</p> 
 <p>while((dword_10100038&amp;0x10000)!=0x10000)</p> 
 <p>;</p> 
 <p>while((dword_10100038&amp;0x40000)!=0x40000)</p> 
 <p>;</p> 
 <p>dword_1010013C=dword_1010013C&amp;0xFFFFFFE3|0x10;</p> 
 <p>sub_FCD4();</p> 
 <p>dword_1010013C&amp;=0xFFFFF3FF;</p> 
 <p>dword_10100138&amp;=0xFFDFFFFF;</p> 
 <p>dword_10100138&amp;=0xFFF7FFFF;</p> 
 <p>dword_10100054=0xFFFFFFE0;</p> 
 <p>dword_10100050=0x7FF00;</p> 
 <p>dword_10100000|=4u;</p> 
 <p>while((*v8&amp;4)!=4)</p> 
 <p>;</p> 
 <p>sub_FAF4();</p> 
 <p>sub_FBD8();</p> 
 <p>sub_FED4();</p> 
 <p>//判断装载地址准备自搬移</p> 
 <p>v9=sub_0;</p> 
 <p>v10=sub_82000000;</p> 
 <p>if((char*)sub_0!=(char*)sub_82000000)</p> 
 <p>{<!-- --></p> 
 <p>do</p> 
 <p>{<!-- --></p> 
 <p>v11=*(_DWORD*)v9;</p> 
 <p>v12=*((_DWORD*)v9+1);</p> 
 <p>v13=*((_DWORD*)v9+2);</p> 
 <p>v14=*((_DWORD*)v9+3);</p> 
 <p>v15=*((_DWORD*)v9+4);</p> 
 <p>v16=*((_DWORD*)v9+5);</p> 
 <p>v17=*((_DWORD*)v9+6);</p> 
 <p>v18=*((_DWORD*)v9+7);</p> 
 <p>v9=(int(*)())((char*)v9+32);</p> 
 <p>*(_DWORD*)v10=v11;</p> 
 <p>*((_DWORD*)v10+1)=v12;</p> 
 <p>*((_DWORD*)v10+2)=v13;</p> 
 <p>*((_DWORD*)v10+3)=v14;</p> 
 <p>*((_DWORD*)v10+4)=v15;</p> 
 <p>*((_DWORD*)v10+5)=v16;</p> 
 <p>*((_DWORD*)v10+6)=v17;</p> 
 <p>*((_DWORD*)v10+7)=v18;</p> 
 <p>v10=(void(__noreturn*)())((char*)v10+32);</p> 
 <p>}</p> 
 <p>while((signedint)v9&lt;=(signedint)&amp;unk_1F1B4);</p> 
 <p>if(dword_10100800!=0x51152100)</p> 
 <p>LABEL_21:</p> 
 <p>JUMPOUT(&amp;loc_820002C8);</p> 
 <p>if(__mrc(15,0,0,0,5)&amp;0xF)</p> 
 <p>{<!-- --></p> 
 <p>LABEL_25:</p> 
 <p>while(3538!=dword_10100120)</p> 
 <p>;</p> 
 <p>gotoLABEL_21;</p> 
 <p>}</p> 
 <p>}</p> 
 <p>JUMPOUT(&amp;loc_82000304);</p> 
 <p>}</p> 
 <p>可以看出在v9 = sub_0;</p> 
 <p>v10 = sub_82000000;</p> 
 <p>之后就开始代码的自搬移了。其中v9是程序装载的位置v10是StartCode应该被放置的地址。</p> 
 <p>也就是说只要通过JTAG完成这两句代码之前StartCode所做的操作就可以使用JTAG访问外部RAM了起始地址大约在0x80000000。</p> 
 <p>使用TCL脚本模拟实现初始化操作</p> 
 <p>好在OpenOCD支持tcl脚本大概熟悉了一下tcl的语法并结合逆向的数据写了个模拟初始化操作的脚本</p> 
 <p>1</p> 
 <p>2</p> 
 <p>3</p> 
 <p>4</p> 
 <p>5</p> 
 <p>6</p> 
 <p>7</p> 
 <p>8</p> 
 <p>9</p> 
 <p>10</p> 
 <p>11</p> 
 <p>12</p> 
 <p>13</p> 
 <p>14</p> 
 <p>15</p> 
 <p>16</p> 
 <p>17</p> 
 <p>18</p> 
 <p>19</p> 
 <p>20</p> 
 <p>21</p> 
 <p>22</p> 
 <p>23</p> 
 <p>24</p> 
 <p>25</p> 
 <p>26</p> 
 <p>27</p> 
 <p>28</p> 
 <p>29</p> 
 <p>30</p> 
 <p>31</p> 
 <p>32</p> 
 <p>33</p> 
 <p>34</p> 
 <p>35</p> 
 <p>36</p> 
 <p>37</p> 
 <p>38</p> 
 <p>39</p> 
 <p>40</p> 
 <p>41</p> 
 <p>42</p> 
 <p>43</p> 
 <p>44</p> 
 <p>45</p> 
 <p>46</p> 
 <p>47</p> 
 <p>48</p> 
 <p>49</p> 
 <p>50</p> 
 <p>51</p> 
 <p>52</p> 
 <p>53</p> 
 <p>54</p> 
 <p>55</p> 
 <p>56</p> 
 <p>57</p> 
 <p>58</p> 
 <p>59</p> 
 <p>60</p> 
 <p>61</p> 
 <p>62</p> 
 <p>63</p> 
 <p>64</p> 
 <p>65</p> 
 <p>66</p> 
 <p>67</p> 
 <p>68</p> 
 <p>69</p> 
 <p>70</p> 
 <p>71</p> 
 <p>72</p> 
 <p>73</p> 
 <p>74</p> 
 <p>75</p> 
 <p>76</p> 
 <p>77</p> 
 <p>78</p> 
 <p>79</p> 
 <p>80</p> 
 <p>81</p> 
 <p>82</p> 
 <p>83</p> 
 <p>84</p> 
 <p>85</p> 
 <p>86</p> 
 <p>87</p> 
 <p>88</p> 
 <p>89</p> 
 <p>90</p> 
 <p>91</p> 
 <p>92</p> 
 <p>93</p> 
 <p>94</p> 
 <p>95</p> 
 <p>96</p> 
 <p>97</p> 
 <p>98</p> 
 <p>99</p> 
 <p>100</p> 
 <p>101</p> 
 <p>102</p> 
 <p>103</p> 
 <p>104</p> 
 <p>105</p> 
 <p>106</p> 
 <p>107</p> 
 <p>108</p> 
 <p>109</p> 
 <p>110</p> 
 <p>111</p> 
 <p>112</p> 
 <p>113</p> 
 <p>114</p> 
 <p>115</p> 
 <p>116</p> 
 <p>117</p> 
 <p>118</p> 
 <p>119</p> 
 <p>120</p> 
 <p>121</p> 
 <p>122</p> 
 <p>123</p> 
 <p>124</p> 
 <p>125</p> 
 <p>126</p> 
 <p>127</p> 
 <p>128</p> 
 <p>129</p> 
 <p>130</p> 
 <p>131</p> 
 <p>132</p> 
 <p>133</p> 
 <p>134</p> 
 <p>135</p> 
 <p>136</p> 
 <p>137</p> 
 <p>138</p> 
 <p>139</p> 
 <p>140</p> 
 <p>141</p> 
 <p>142</p> 
 <p>143</p> 
 <p>144</p> 
 <p>145</p> 
 <p>146</p> 
 <p>147</p> 
 <p>148</p> 
 <p>149</p> 
 <p>150</p> 
 <p>151</p> 
 <p>152</p> 
 <p>153</p> 
 <p>154</p> 
 <p>155</p> 
 <p>156</p> 
 <p>157</p> 
 <p>158</p> 
 <p>159</p> 
 <p>160</p> 
 <p>161</p> 
 <p>162</p> 
 <p>163</p> 
 <p>164</p> 
 <p>165</p> 
 <p>166</p> 
 <p>167</p> 
 <p>168</p> 
 <p>169</p> 
 <p>170</p> 
 <p>171</p> 
 <p>172</p> 
 <p>173</p> 
 <p>174</p> 
 <p>175</p> 
 <p>176</p> 
 <p>177</p> 
 <p>178</p> 
 <p>179</p> 
 <p>180</p> 
 <p>181</p> 
 <p>182</p> 
 <p>183</p> 
 <p>184</p> 
 <p>185</p> 
 <p>186</p> 
 <p>187</p> 
 <p>188</p> 
 <p>189</p> 
 <p>190</p> 
 <p>191</p> 
 <p>192</p> 
 <p>193</p> 
 <p>194</p> 
 <p>195</p> 
 <p>196</p> 
 <p>197</p> 
 <p>198</p> 
 <p>199</p> 
 <p>200</p> 
 <p>201</p> 
 <p>202</p> 
 <p>203</p> 
 <p>204</p> 
 <p>205</p> 
 <p>206</p> 
 <p>207</p> 
 <p>208</p> 
 <p>209</p> 
 <p>210</p> 
 <p>211</p> 
 <p>212</p> 
 <p>213</p> 
 <p>214</p> 
 <p>215</p> 
 <p>216</p> 
 <p>217</p> 
 <p>218</p> 
 <p>219</p> 
 <p>220</p> 
 <p>221</p> 
 <p>222</p> 
 <p>223</p> 
 <p>224</p> 
 <p>225</p> 
 <p>226</p> 
 <p>227</p> 
 <p>228</p> 
 <p>229</p> 
 <p>230</p> 
 <p>231</p> 
 <p>232</p> 
 <p>233</p> 
 <p>234</p> 
 <p>235</p> 
 <p>236</p> 
 <p>237</p> 
 <p>238</p> 
 <p>239</p> 
 <p>240</p> 
 <p>241</p> 
 <p>242</p> 
 <p>243</p> 
 <p>244</p> 
 <p>245</p> 
 <p>246</p> 
 <p>247</p> 
 <p>248</p> 
 <p>249</p> 
 <p>250</p> 
 <p>251</p> 
 <p>252</p> 
 <p>253</p> 
 <p>254</p> 
 <p>255</p> 
 <p>256</p> 
 <p>257</p> 
 <p>258</p> 
 <p>259</p> 
 <p>260</p> 
 <p>261</p> 
 <p>262</p> 
 <p>263</p> 
 <p>264</p> 
 <p>265</p> 
 <p>266</p> 
 <p>267</p> 
 <p>268</p> 
 <p>269</p> 
 <p>270</p> 
 <p>271</p> 
 <p>272</p> 
 <p>273</p> 
 <p>274</p> 
 <p>275</p> 
 <p>276</p> 
 <p>277</p> 
 <p>278</p> 
 <p>279</p> 
 <p>280</p> 
 <p>281</p> 
 <p>282</p> 
 <p>283</p> 
 <p>284</p> 
 <p>285</p> 
 <p>286</p> 
 <p>287</p> 
 <p>288</p> 
 <p>289</p> 
 <p>290</p> 
 <p>291</p> 
 <p>292</p> 
 <p>293</p> 
 <p>294</p> 
 <p>295</p> 
 <p>296</p> 
 <p>297</p> 
 <p>298</p> 
 <p>299</p> 
 <p>300</p> 
 <p>301</p> 
 <p>302</p> 
 <p>303</p> 
 <p>304</p> 
 <p>305</p> 
 <p>306</p> 
 <p>307</p> 
 <p>308</p> 
 <p>309</p> 
 <p>310</p> 
 <p>311</p> 
 <p>312</p> 
 <p>313</p> 
 <p>314</p> 
 <p>315</p> 
 <p>316</p> 
 <p>317</p> 
 <p>318</p> 
 <p>319</p> 
 <p>320</p> 
 <p>321</p> 
 <p>322</p> 
 <p>323</p> 
 <p>324</p> 
 <p>325</p> 
 <p>326</p> 
 <p>327</p> 
 <p>328</p> 
 <p>329</p> 
 <p>330</p> 
 <p>331</p> 
 <p>332</p> 
 <p>333</p> 
 <p>334</p> 
 <p>335</p> 
 <p>336</p> 
 <p>337</p> 
 <p>338</p> 
 <p>339</p> 
 <p>340</p> 
 <p>341</p> 
 <p>342</p> 
 <p>343</p> 
 <p>344</p> 
 <p>345</p> 
 <p>346</p> 
 <p>347</p> 
 <p>348</p> 
 <p>349</p> 
 <p>350</p> 
 <p>351</p> 
 <p>352</p> 
 <p>353</p> 
 <p>354</p> 
 <p>355</p> 
 <p>356</p> 
 <p>357</p> 
 <p>358</p> 
 <p>359</p> 
 <p>360</p> 
 <p>361</p> 
 <p>362</p> 
 <p>363</p> 
 <p>364</p> 
 <p>365</p> 
 <p>366</p> 
 <p>367</p> 
 <p>368</p> 
 <p>369</p> 
 <p>370</p> 
 <p>371</p> 
 <p>372</p> 
 <p>373</p> 
 <p>374</p> 
 <p>375</p> 
 <p>376</p> 
 <p>377</p> 
 <p>378</p> 
 <p>379</p> 
 <p>380</p> 
 <p>381</p> 
 <p>382</p> 
 <p>383</p> 
 <p>384</p> 
 <p>385</p> 
 <p>386</p> 
 <p>387</p> 
 <p>388</p> 
 <p>389</p> 
 <p>390</p> 
 <p>391</p> 
 <p>392</p> 
 <p>393</p> 
 <p>394</p> 
 <p>395</p> 
 <p>396</p> 
 <p>397</p> 
 <p>398</p> 
 <p>399</p> 
 <p>400</p> 
 <p>401</p> 
 <p>402</p> 
 <p>403</p> 
 <p>404</p> 
 <p>405</p> 
 <p>406</p> 
 <p>407</p> 
 <p>408</p> 
 <p>409</p> 
 <p>410</p> 
 <p>411</p> 
 <p>412</p> 
 <p>413</p> 
 <p>414</p> 
 <p>415</p> 
 <p>416</p> 
 <p>417</p> 
 <p>418</p> 
 <p>419</p> 
 <p>420</p> 
 <p>421</p> 
 <p>422</p> 
 <p>423</p> 
 <p>424</p> 
 <p>425</p> 
 <p>426</p> 
 <p>427</p> 
 <p>428</p> 
 <p>429</p> 
 <p>430</p> 
 <p>431</p> 
 <p>432</p> 
 <p>433</p> 
 <p>434</p> 
 <p>435</p> 
 <p>436</p> 
 <p>437</p> 
 <p>438</p> 
 <p>439</p> 
 <p>440</p> 
 <p>441</p> 
 <p>442</p> 
 <p>443</p> 
 <p>444</p> 
 <p>445</p> 
 <p>446</p> 
 <p>447</p> 
 <p>448</p> 
 <p>449</p> 
 <p>450</p> 
 <p>451</p> 
 <p>452</p> 
 <p>453</p> 
 <p>454</p> 
 <p>455</p> 
 <p>456</p> 
 <p>457</p> 
 <p>458</p> 
 <p>459</p> 
 <p>460</p> 
 <p>461</p> 
 <p>462</p> 
 <p>463</p> 
 <p>464</p> 
 <p>465</p> 
 <p>466</p> 
 <p>467</p> 
 <p>468</p> 
 <p>469</p> 
 <p>470</p> 
 <p>471</p> 
 <p>472</p> 
 <p>473</p> 
 <p>474</p> 
 <p>475</p> 
 <p>476</p> 
 <p>477</p> 
 <p>478</p> 
 <p>479</p> 
 <p>480</p> 
 <p>481</p> 
 <p>482</p> 
 <p>483</p> 
 <p>484</p> 
 <p>485</p> 
 <p>486#</p> 
 <p># Hisilicon SD5115 (T?)</p> 
 <p>#</p> 
 <p># Author : CserSoft</p> 
 <p># Version : 1.2.2</p> 
 <p>#</p> 
 <p>transportselectjtag</p> 
 <p>if{[infoexistsCHIPNAME]}{<!-- --></p> 
 <p>set_CHIPNAME$CHIPNAME</p> 
 <p>}else{<!-- --></p> 
 <p>set_CHIPNAMEsd5115</p> 
 <p>}</p> 
 <p>if{[infoexistsCPUTAPID]}{<!-- --></p> 
 <p>set_CPU_TAPID$CPUTAPID</p> 
 <p>}else{<!-- --></p> 
 <p>set_CPU_TAPID0x4ba00477</p> 
 <p>}</p> 
 <p>if{[infoexistsENDIAN]}{<!-- --></p> 
 <p>set_ENDIAN$ENDIAN</p> 
 <p>}else{<!-- --></p> 
 <p># this defaults to a bigendian</p> 
 <p>set_ENDIANlittle</p> 
 <p>}</p> 
 <p>if{[infoexistsETB_TAPID]}{<!-- --></p> 
 <p>set_ETB_TAPID$ETB_TAPID</p> 
 <p>}else{<!-- --></p> 
 <p>set_ETB_TAPID0x410CF231</p> 
 <p>}</p> 
 <p>jtagnewtap$_CHIPNAMEcpu-irlen4-ircapture0x1-irmask0xf-expected-id$_CPU_TAPID</p> 
 <p># jtag newtap $_CHIPNAME etb -irlen 4 -expected-id $_ETB_TAPID</p> 
 <p>set_TARGETNAME$_CHIPNAME.cpu</p> 
 <p>targetcreate$_TARGETNAMEcortex_a-endian$_ENDIAN-chain-position$_TARGETNAME</p> 
 <p># etm_dummy config $_TARGETNAME</p> 
 <p># etb config $_TARGETNAME $_CHIPNAME.etb</p> 
 <p>procsd5115_dbginit{target}{<!-- --></p> 
 <p>cortex_adbginit</p> 
 <p>}</p> 
 <p>procgetmem32{addr}{<!-- --></p> 
 <p>mem2arrayatmp32$addr1</p> 
 <p>return[lindex$atmp1]</p> 
 <p>}</p> 
 <p>procsetmem32{addrvalue}{<!-- --></p> 
 <p>mwwphys$addr$value1</p> 
 <p>}</p> 
 <p>procandmem32{addrvalue}{<!-- --></p> 
 <p>setvmem[getmem32$addr]</p> 
 <p>return[expr$vmem&amp;$value]</p> 
 <p>}</p> 
 <p>procandmem32w{addrvalue}{<!-- --></p> 
 <p>setvmem[expr[getmem32$addr]&amp;$value]</p> 
 <p>mwwphys$addr$vmem1</p> 
 <p>return$vmem</p> 
 <p>}</p> 
 <p>procormem32{addrvalue}{<!-- --></p> 
 <p>setvmem[getmem32$addr]</p> 
 <p>return[expr$vmem|$value]</p> 
 <p>}</p> 
 <p>procormem32w{addrvalue}{<!-- --></p> 
 <p>setvmem[expr[getmem32$addr]|$value]</p> 
 <p>mwwphys$addr$vmem1</p> 
 <p>return$vmem</p> 
 <p>}</p> 
 <p>procsd5115_startcode_offset_0x6EC{}{<!-- --></p> 
 <p>andmem32w0x101800000xFFFFFFFE</p> 
 <p>}</p> 
 <p>procsd5115_startcode_offset_0x700{}{<!-- --></p> 
 <p>mwwphys0x1018000C0xFFFFFFFF1</p> 
 <p>}</p> 
 <p>procsd5115_startcode_offset_0x710{}{<!-- --></p> 
 <p>ormem32w0x101800540xFF</p> 
 <p>ormem32w0x101800000x1</p> 
 <p>}</p> 
 <p>procsd5115_startcode_offset_0xFAD4{}{<!-- --></p> 
 <p>setmem320x10100144[expr[andmem320x101001440xFFF803FF]|0x400]</p> 
 <p>}</p> 
 <p>procsd5115_startcode_offset_0xFAF4{}{<!-- --></p> 
 <p>setvcpuid[getmem320x10100800]</p> 
 <p>if{$vcpuid==0x51151100}{<!-- --></p> 
 <p>ormem32w0x130000000x80000</p> 
 <p>ormem32w0x101060080xC0</p> 
 <p>ormem32w0x101060080x300</p> 
 <p>}elseif{$vcpuid==0x51152100}{<!-- --></p> 
 <p>ormem32w0x130000000x60000</p> 
 <p>ormem32w0x101080080xF0</p> 
 <p>}else{<!-- --></p> 
 <p>ormem32w0x130001C80x100</p> 
 <p>ormem32w0x101060080xC00</p> 
 <p>andmem32w0x130000000xFFFFFFFB</p> 
 <p>andmem32w0x130001C80xFFFFFFDF</p> 
 <p>ormem32w0x101060080x3000</p> 
 <p>andmem32w0x130000000xFFFDFFFF</p> 
 <p>andmem32w0x130001C80xFFFFFFBF</p> 
 <p>}</p> 
 <p>}</p> 
 <p>procsd5115_startcode_offset_0xFBD8{}{<!-- --></p> 
 <p>setvcpuid[getmem320x10100800]</p> 
 <p>if{$vcpuid!=0x51151100}{<!-- --></p> 
 <p>if{$vcpuid==0x51152100}{<!-- --></p> 
 <p>setmem320x104005000x1FFF800</p> 
 <p>andmem32w0x101001340xFFFFFFFC</p> 
 <p>andmem32w0x101070080xDDFFFFFF</p> 
 <p>ormem32w0x101070040x22000000</p> 
 <p>ormem32w0x101070000x22000000</p> 
 <p>andmem32w0x101080080xFFF7FFFF</p> 
 <p>ormem32w0x101080040x80000</p> 
 <p>ormem32w0x101080000x80000</p> 
 <p>andmem32w0x101001440x3FFFFFFF</p> 
 <p>}else{<!-- --></p> 
 <p>setmem320x104005000x1FFF800</p> 
 <p>andmem32w0x101001340xFFFFFFFC</p> 
 <p>ormem32w0x101070040x18000</p> 
 <p>andmem32w0x101070000xFFFE7FFF</p> 
 <p>ormem32w0x101070000x18000</p> 
 <p>andmem32w0x1300016C0xFFFFFFFC</p> 
 <p>}</p> 
 <p>}</p> 
 <p>}</p> 
 <p>procsd5115_startcode_offset_0xFCD4{}{<!-- --></p> 
 <p>setvcpuid[getmem320x10100800]</p> 
 <p>if{$vcpuid==0x51151100}{<!-- --></p> 
 <p>andmem32w0x1010012C0xFFBFFFFF</p> 
 <p>andmem32w0x101001380xFFFFFFBF</p> 
 <p>ormem32w0x101000800x9</p> 
 <p>andmem32w0x1010013C0xFFFFEFFF</p> 
 <p>setmem320x1010005C0x81020248</p> 
 <p>while{[andmem320x101000380x10000]!=0x10000}{sleep1}</p> 
 <p>ormem32w0x1010007C0x9</p> 
 <p>ormem32w0x101001480x2</p> 
 <p>ormem32w0x1010012C0x400000</p> 
 <p>ormem32w0x101001380x40</p> 
 <p>}elseif{$vcpuid==0x51152100}{<!-- --></p> 
 <p>if{[andmem320x101001901]==1}{<!-- --></p> 
 <p>andmem32w0x1010012C0xFFBFFFFF</p> 
 <p>andmem32w0x101001380xFFFFFFBF</p> 
 <p>ormem32w0x101000800x9</p> 
 <p>andmem32w0x101001440xFEFFFFFF</p> 
 <p>andmem32w0x101001400xFFFFCFFF</p> 
 <p>ormem32w0x101001400x40000000</p> 
 <p>setmem320x101000740x81028249</p> 
 <p>while{[andmem320x101000380x40000]!=0x40000}{sleep1}</p> 
 <p>ormem32w0x1010007C0x9</p> 
 <p>ormem32w0x101001480x2</p> 
 <p>ormem32w0x1010012C0x400000</p> 
 <p>ormem32w0x101001380x40</p> 
 <p>}else{<!-- --></p> 
 <p>while{[andmem320x101000380x20000]!=0x20000}{sleep1}</p> 
 <p>}</p> 
 <p>}else{<!-- --></p> 
 <p>andmem32w0x1010012C0xFFBFFFFF</p> 
 <p>andmem32w0x101001380xFFFFFFBF</p> 
 <p>ormem32w0x101000800x9</p> 
 <p>setmem320x1010011C0x81028648</p> 
 <p>while{[andmem320x101000380x20000]!=0x20000}{sleep1}</p> 
 <p>ormem32w0x1010007C0x9</p> 
 <p>ormem32w0x101001480x2</p> 
 <p>ormem32w0x1010012C0x400000</p> 
 <p>ormem32w0x101001380x40</p> 
 <p>}</p> 
 <p>}</p> 
 <p>procsd5115_startcode_offset_0xFED4{}{<!-- --></p> 
 <p>setvcpuid[getmem320x10100800]</p> 
 <p>if{$vcpuid==0x51151100}{<!-- --></p> 
 <p>setmem320x101020101</p> 
 <p>setmem320x1010201C0x8DF40630</p> 
 <p>setmem320x101020200x10184</p> 
 <p>setmem320x1010202C0x132</p> 
 <p>setmem320x101020400x80000000</p> 
 <p>setmem320x101020500x62330A08</p> 
 <p>setmem320x101020540x7F525616</p> 
 <p>setmem320x1010205C0x4BE58352</p> 
 <p>setmem320x101020F41</p> 
 <p>setmem320x101020580x6230A000</p> 
 <p>setmem320x101020040</p> 
 <p>while{[andmem320x101020004]!=0}{sleep1}</p> 
 <p>setmem320x101024040x80000000</p> 
 <p>while{[andmem320x101024101]!=1}{sleep1}</p> 
 <p>setmem320x101024180xDC000</p> 
 <p>setmem320x101025840x5D</p> 
 <p>setmem320x1010240C0x3008401</p> 
 <p>setmem320x101024440x48B</p> 
 <p>setmem320x101024480x51106644</p> 
 <p>setmem320x1010244C0x1A81629A</p> 
 <p>setmem320x101024500x100220C8</p> 
 <p>setmem320x101024540x1520</p> 
 <p>setmem320x101024586</p> 
 <p>setmem320x1010245C0</p> 
 <p>setmem320x101024600</p> 
 <p>setmem320x101025C00x44000887</p> 
 <p>setmem320x101024400xF008003E</p> 
 <p>setmem320x101024680x1001541</p> 
 <p>setmem320x101024040xFFF3</p> 
 <p>while{[andmem320x101024100x80000FFF]!=0x80000FFF}{sleep1}</p> 
 <p>setmem320x101020580x6230A05F</p> 
 <p>setmem320x101020200x410185</p> 
 <p>setmem320x1010201C0x8DF40630</p> 
 <p>setmem320x101022000x305133</p> 
 <p>setmem320x101022040x3062CC</p> 
 <p>}elseif{$vcpuid==0x51152100}{<!-- --></p> 
 <p>if{[andmem320x101001901]==1}{<!-- --></p> 
 <p>setmem320x101020101</p> 
 <p>setmem320x1010201C0x80000600</p> 
 <p>setmem320x101020200x584</p> 
 <p>setmem320x1010202C0x142</p> 
 <p>setmem320x101020400x80000000</p> 
 <p>setmem320x101020500x63440E0A</p> 
 <p>setmem320x101020540xFF526720</p> 
 <p>setmem320x101020580x6240A000</p> 
 <p>setmem320x1010205C0xFFDFF5F2</p> 
 <p>setmem320x101020F40x21</p> 
 <p>setmem320x101020AC0x3000501</p> 
 <p>setmem320x101020040</p> 
 <p>while{[andmem320x101020004]!=0}{sleep1}</p> 
 <p>setmem320x101024040x80000000</p> 
 <p>while{[andmem320x101024101]!=1}{sleep1}</p> 
 <p>setmem320x101024180x5C000</p> 
 <p>setmem320x1010248C0xF01E78</p> 
 <p>setmem320x1010241C0x1F40FA10</p> 
 <p>setmem320x101024200x61A808CA</p> 
 <p>setmem320x101024280xC83D090</p> 
 <p>setmem320x1010242C0x1F4186A0</p> 
 <p>setmem320x101024440x48B</p> 
 <p>setmem320x101024480x6D538844</p> 
 <p>setmem320x1010244C0x22820282</p> 
 <p>setmem320x101024500x1002EA00</p> 
 <p>setmem320x101024540x1930</p> 
 <p>setmem320x101024580x42</p> 
 <p>setmem320x1010245C8</p> 
 <p>setmem320x101024600</p> 
 <p>setmem320x101024640x210000</p> 
 <p>setmem320x101024680x210035C3</p> 
 <p>setmem320x101025840x2D</p> 
 <p>setmem320x101025C00x44000E81</p> 
 <p>setmem320x101026000x44000E81</p> 
 <p>setmem320x101024400xF000603E</p> 
 <p>setmem320x101024040xFFF3</p> 
 <p>while{[andmem320x101024101]!=1}{sleep1}</p> 
 <p>setmem320x101020580x6240A079</p> 
 <p>setmem320x101022000x304132</p> 
 <p>setmem320x101022040x306132</p> 
 <p>setmem320x101022080x304066</p> 
 <p>setmem320x101022100x306132</p> 
 <p>}else{<!-- --></p> 
 <p>setmem320x101020101</p> 
 <p>setmem320x1010201C0x80000601</p> 
 <p>setmem320x101020200x580</p> 
 <p>setmem320x1010202C0x142</p> 
 <p>setmem320x101020400x80000000</p> 
 <p>setmem320x101020500xC466150F</p> 
 <p>setmem320x101020540xFF545540</p> 
 <p>setmem320x101020580x84610000</p> 
 <p>setmem320x1010205C0xFFDFF4F4</p> 
 <p>setmem320x101020F40x21</p> 
 <p>setmem320x101020AC0x3000501</p> 
 <p>setmem320x101020040</p> 
 <p>while{[andmem320x101020004]!=0}{sleep1}</p> 
 <p>setmem320x101024040x80000000</p> 
 <p>while{[andmem320x101024101]!=1}{sleep1}</p> 
 <p>setmem320x101024180x5C000</p> 
 <p>setmem320x1010248C0xF01860</p> 
 <p>setmem320x1010241C0x1900C810</p> 
 <p>setmem320x101024200x4E200708</p> 
 <p>setmem320x101024280xA030D40</p> 
 <p>setmem320x1010242C0x19013880</p> 
 <p>setmem320x101024440x48B</p> 
 <p>setmem320x101024480x550F6644</p> 
 <p>setmem320x1010244C0x22820202</p> 
 <p>setmem320x101024500x1002EA00</p> 
 <p>setmem320x101024540x1510</p> 
 <p>setmem320x101024580x42</p> 
 <p>setmem320x1010245C0</p> 
 <p>setmem320x101024600</p> 
 <p>setmem320x101024640x210000</p> 
 <p>setmem320x101024680x210035C3</p> 
 <p>setmem320x101025840x2D</p> 
 <p>setmem320x101025C00x44000E81</p> 
 <p>setmem320x101026000x44000E81</p> 
 <p>setmem320x101024400xF008603E</p> 
 <p>setmem320x101024040xFFF3</p> 
 <p>while{[andmem320x101024101]!=1}{sleep1}</p> 
 <p>setmem320x101020580x846100C3</p> 
 <p>setmem320x101022000x304132</p> 
 <p>setmem320x101022040x306132</p> 
 <p>setmem320x101022080x304066</p> 
 <p>setmem320x101022100x306132</p> 
 <p>}</p> 
 <p>}else{<!-- --></p> 
 <p>setmem320x101020101</p> 
 <p>setmem320x1010201C0xE92E0601</p> 
 <p>setmem320x101020200x1F180</p> 
 <p>setmem320x1010202C0x132</p> 
 <p>setmem320x101020400x80000000</p> 
 <p>setmem320x101020500xC466130E</p> 
 <p>setmem320x101020540xFF535625</p> 
 <p>setmem320x1010205C0x7E58484</p> 
 <p>setmem320x101020F41</p> 
 <p>setmem320x101020580x74511000</p> 
 <p>setmem320x101020AC0x3000501</p> 
 <p>setmem320x101020040</p> 
 <p>while{[andmem320x101020004]!=0}{sleep1}</p> 
 <p>setmem320x101024040x80000000</p> 
 <p>while{[andmem320x101024101]!=1}{sleep1}</p> 
 <p>setmem320x101024180xDC000</p> 
 <p>setmem320x1010240C0x3008401</p> 
 <p>setmem320x101024440x48B</p> 
 <p>setmem320x101024480x4D0E6644</p> 
 <p>setmem320x1010244C0x1A812A30</p> 
 <p>setmem320x101024500x1001A0C8</p> 
 <p>setmem320x101024540x1320</p> 
 <p>setmem320x101024580x42</p> 
 <p>setmem320x1010245C0</p> 
 <p>setmem320x101024600</p> 
 <p>setmem320x101024680x11001547</p> 
 <p>setmem320x101025C00x44000887</p> 
 <p>setmem320x101026000x44000E81</p> 
 <p>setmem320x101024400xF008003E</p> 
 <p>setmem320x101025840x1D</p> 
 <p>setmem320x101024040xFFF3</p> 
 <p>while{[andmem320x101024100x80000FFF]!=0x80000FFF}{sleep1}</p> 
 <p>setmem320x101020580x7450F09E</p> 
 <p>setmem320x101020200x40EF01</p> 
 <p>setmem320x101020F80</p> 
 <p>setmem320x101022000x305133</p> 
 <p>setmem320x101022040x306266</p> 
 <p>setmem320x101022080x306066</p> 
 <p>setmem320x1010220C0</p> 
 <p>setmem320x1010201C0xB9D60601</p> 
 <p>}</p> 
 <p>}</p> 
 <p>procsd5115_hwinit{}{<!-- --></p> 
 <p>halt</p> 
 <p>#enter Supervisor mode</p> 
 <p>regcpsr0x1D3</p> 
 <p>armmcr1508700</p> 
 <p>armmcr1507500</p> 
 <p>armmcr1520000</p> 
 <p>setv5[expr([armmrc151000]&gt;&gt;13)&amp;0x1ff]</p> 
 <p>setv60</p> 
 <p>while{$v6&lt;4}{<!-- --></p> 
 <p>setv70</p> 
 <p>while{$v7&lt;=$v5}{<!-- --></p> 
 <p>setvtmp[expr($v6&lt;&lt;30)|32*$v7]</p> 
 <p>setv7[incr$v7]</p> 
 <p>armmcr150762$vtmp</p> 
 <p>}</p> 
 <p>setv6[incr$v6]</p> 
 <p>}</p> 
 <p>if{[expr[armmrc150005]&amp;0xf]!=0}{<!-- --></p> 
 <p>echo"Error 1 !"</p> 
 <p>return</p> 
 <p>}</p> 
 <p>armmcr150100[expr[armmrc150001]&amp;0xFFFFDFF8|0x802]</p> 
 <p>if{[expr[armmrc150005]&amp;0xf]!=0}{<!-- --></p> 
 <p>sd5115_startcode_offset_0x6EC</p> 
 <p>sd5115_startcode_offset_0x700</p> 
 <p>sd5115_startcode_offset_0x710</p> 
 <p>}</p> 
 <p>armmcr150100[expr[armmrc150100]|0x1000]</p> 
 <p>setmem320x10A300040x00000355</p> 
 <p>ormem32w0x10A201000x2</p> 
 <p>sd5115_startcode_offset_0xFAD4</p> 
 <p>setmem320x1010007C0xFFFFFFFF</p> 
 <p>setmem320x1010008C0xFFFFFFFF</p> 
 <p>setmem320x1010012C0xFFFFFFFF</p> 
 <p>setmem320x101001300xFE7FFFFF</p> 
 <p>ormem32w0x101001380x7F</p> 
 <p>ormem32w0x101001400x80000000</p> 
 <p>setvcpuid[getmem320x10100800]</p> 
 <p>if{$vcpuid==0x51152100}{<!-- --></p> 
 <p>if{[expr[getmem320x10100190]&amp;1]==1}{<!-- --></p> 
 <p>mwwphys0x1010005C0x8103844D1</p> 
 <p>}</p> 
 <p>mwwphys0x1010005C0x8103444D1</p> 
 <p>}</p> 
 <p>while{[andmem320x101000380x10000]!=0x10000}{sleep1}</p> 
 <p>while{[andmem320x101000380x40000]!=0x40000}{sleep1}</p> 
 <p>setmem320x1010013C[expr[andmem320x1010013C0xFFFFFFE3]|0x10]</p> 
 <p>sd5115_startcode_offset_0xFCD4</p> 
 <p>andmem32w0x1010013C0xFFFFF3FF</p> 
 <p>andmem32w0x101001380xFFDFFFFF</p> 
 <p>andmem32w0x101001380xFFF7FFFF</p> 
 <p>setmem320x101000540xFFFFFFE0</p> 
 <p>setmem320x101000500x7FF00</p> 
 <p>ormem32w0x101000000x4</p> 
 <p>while{[andmem320x101000000x4]!=0x4}{sleep1}</p> 
 <p>sd5115_startcode_offset_0xFAF4</p> 
 <p>sd5115_startcode_offset_0xFBD8</p> 
 <p>sd5115_startcode_offset_0xFED4</p> 
 <p>echo"Hardware initialization is complete!"</p> 
 <p>}</p> 
 <p>$_TARGETNAMEconfigure-eventreset-assert-post"sd5115_dbginit $_TARGETNAME"</p> 
 <p># init</p> 
 <p># dap apsel 1</p> 
 <p>使用JTAG完成基本硬件初始化</p> 
 <p>为了确保初始化准确无误需要保证CPU上电时完全无法找到可以引导的代码。</p> 
 <p>因为我之前清空flash时也曾尝试立刻刷回StartCode可惜不知什么原因只写入了2KB的StartCode这样仍然无法完成基本的初始化。但不清楚这2KB的代码完成了哪些操作所以一个办法就是先将flash的CE#CE#这种后面带#字的引脚都是低电平有效与3.3V短接最好是能与输出3.3V的GPIO短接与3.3V的VCC短接电流可能较大不知是否有不良影响再给板子上电。HG8245H的CE#引脚在板子背面电源led附近有个上拉电阻R1542可以在这里短接。</p> 
 <p>CPU上电后在OpenOCD的telnet里执行上面脚本提供的sd5115_hwinit函数等看到输出Hardware initialization is complete!</p> 
 <p>字样的提示后把之前dump出来的StartCode写入内存并运行</p> 
 <p>1halt ; load_image binary/mtd0.bin 0x82000000 ; resume 0x82000000</p> 
 <p>这时应该可以看见UART里输出了久违的StartCode信息HuaWei StartCode 2012.02 (R13C10 Apr 22 2014 – 18:06:02)</p> 
 <p>NAND: Nand(Hardware): 128 MiB</p> 
 <p>startcode select the uboot to load</p> 
 <p>the high RAM is :8080103c</p> 
 <p>startcode uboot boot count:-1</p> 
 <p>Slave struct initializtion success!!</p> 
 <p>Use the UbootA to load first</p> 
 <p>Start from UbootA ERROR, Change to UbootB</p> 
 <p>Both UbootA and UbootB are wrong, load it by JTAG!</p> 
 <p>补充</p> 
 <p>新版本的OpenOCD配置文件见https://github.com/csersoft/hi_sd5115_openocd_config</p> 
 <p>最新sd5115 openocd 配置文件见https://github.com/csersoft/hi_sd5115_openocd_config</p> 
 <p>安卓应用层抓包通杀脚本发布《高研班》2021年3月班开始招生</p> 
 <p>上传的附件</p> 
 <p>hi_sd5115_jtag.zip</p> 
 <p>2.61kb28次下载</p> 
 <p>blog.csersoft.net-华为HG8245H救砖番外篇之利用JTAG完成硬件初始化.pdf</p> 
 <p>154.44kb29次下载</p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b49cac58d3a00e8da2acb8be7f29c06e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">ubuntu-server 20.04 连接wifi（热点）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6c071f7d75494cea1574f23b2a0d3e4f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">IIT信息服务器,IIT工作岗位汇总及岗位要求.doc</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>