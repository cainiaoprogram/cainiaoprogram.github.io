<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>利用docker和gitLab搭建git私有服务器 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="利用docker和gitLab搭建git私有服务器" />
<meta property="og:description" content="随着Git代码管理工具的兴起，我们很多时候需要用到自己的git私有服务器，从而做到防止代码泄露等。gitLab为我们提供了一种简便的方式，使我们可以快速搭建自己的Git私有服务器
基础条件 本文主要是在一台装有ubuntu系统的服务器上安装gitLab
安装docker 此处主要参考了菜鸟教程 Ubuntu Docker 安装
查看并确定ubuntu内核版本高于3.10 uname -r使用脚本安装docker wget -qO- https://get.docker.com/ | sh安装完成之后，会提示： If you would like to use Docker as a non-root user, you should now consider adding your user to the &#34;docker&#34; group with something like: sudo usermod -aG docker xxx Remember that you will have to log out and back in for this to take effect! 按照提示，执行对应的命令sudo usermod -aG docker xxx即可，为docker用户赋予权限，然后重新退出登录。
启动docker服务并查看状态 sudo service docker start sudo service docker status 安装gitlab 克隆gitlab-ce" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/69509ee50dc032a6fe12231e20acda8b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-06-15T11:23:52+08:00" />
<meta property="article:modified_time" content="2018-06-15T11:23:52+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">利用docker和gitLab搭建git私有服务器</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>随着Git代码管理工具的兴起，我们很多时候需要用到自己的git私有服务器，从而做到防止代码泄露等。gitLab为我们提供了一种简便的方式，使我们可以快速搭建自己的Git私有服务器</p> 
<h3 id="基础条件">基础条件</h3> 
<p>本文主要是在一台装有ubuntu系统的服务器上安装gitLab</p> 
<h3 id="安装docker">安装docker</h3> 
<p>此处主要参考了<a href="http://www.runoob.com/docker/ubuntu-docker-install.html" rel="nofollow">菜鸟教程 Ubuntu Docker 安装</a></p> 
<ol><li><p>查看并确定ubuntu内核版本高于3.10 </p> <pre class="prettyprint"><code class=" hljs lasso">uname <span class="hljs-attribute">-r</span></code></pre></li><li><p>使用脚本安装docker </p> <pre class="prettyprint"><code class=" hljs livecodeserver">wget -qO- <span class="hljs-keyword">https</span>://<span class="hljs-built_in">get</span>.docker.com/ | sh</code></pre></li><li><p>安装完成之后，会提示： </p> <pre class="prettyprint"><code class=" hljs vbnet"><span class="hljs-keyword">If</span> you would <span class="hljs-keyword">like</span> <span class="hljs-keyword">to</span> use Docker <span class="hljs-keyword">as</span> a non-root user, you should now consider
adding your user <span class="hljs-keyword">to</span> the <span class="hljs-string">"docker"</span> <span class="hljs-keyword">group</span> <span class="hljs-keyword">with</span> something <span class="hljs-keyword">like</span>:

   sudo usermod -aG docker xxx
Remember that you will have <span class="hljs-keyword">to</span> log out <span class="hljs-keyword">and</span> back <span class="hljs-keyword">in</span> <span class="hljs-keyword">for</span> this <span class="hljs-keyword">to</span> <span class="hljs-keyword">take</span> effect!  </code></pre></li><li><p>按照提示，执行对应的命令<code>sudo usermod -aG docker xxx</code>即可，为docker用户赋予权限，然后重新退出登录。</p></li><li>启动docker服务并查看状态</li></ol> 
<pre class="prettyprint"><code class=" hljs bash"><span class="hljs-built_in">sudo</span> service docker start
<span class="hljs-built_in">sudo</span> service docker status</code></pre> 
<h3 id="安装gitlab">安装gitlab</h3> 
<ol><li><p>克隆gitlab-ce</p> <pre class="prettyprint"><code class=" hljs bash"><span class="hljs-built_in">sudo</span> docker pull gitlab/gitlab-ce:latest</code></pre></li><li><p>创建docker container <br> 注意，这里因为作者的服务器80端口等已经被占用，所以，对端口进行了映射</p> <pre class="prettyprint"><code class=" hljs lasso">sudo docker run <span class="hljs-attribute">-d</span> <span class="hljs-attribute">-p</span> <span class="hljs-number">8443</span>:<span class="hljs-number">443</span> <span class="hljs-attribute">-p</span> <span class="hljs-number">8081</span>:<span class="hljs-number">80</span> <span class="hljs-attribute">-p</span> <span class="hljs-number">8022</span>:<span class="hljs-number">22</span> <span class="hljs-subst">\</span>
<span class="hljs-subst">--</span>name gitlab <span class="hljs-subst">--</span>restart always <span class="hljs-subst">\</span>
<span class="hljs-subst">--</span>volume /home/xxx/dockerData/gitlab/config:/etc/gitlab <span class="hljs-subst">\</span>
<span class="hljs-subst">--</span>volume /home/xxx/dockerData/gitlab/logs:/<span class="hljs-built_in">var</span>/<span class="hljs-keyword">log</span>/gitlab <span class="hljs-subst">\</span>
<span class="hljs-subst">--</span>volume /home/xxx/dockerData/gitlab/<span class="hljs-built_in">data</span>:/<span class="hljs-built_in">var</span>/opt/gitlab <span class="hljs-subst">\</span>
gitlab/gitlab<span class="hljs-attribute">-ce</span>:latest</code></pre> <p>这里，’/home/xxx/dockerData/gitlab’是映射到物理机上的卷的路径。可以根据需要自定义。 <br> 另外，注意映射端口时，避免使用8080端口，因为8080在docker内部被Unicorn占用，<a href="https://docs.gitlab.com/omnibus/docker/#expose-gitlab-on-different-ports" rel="nofollow">这里</a>可以找到相关材料。</p></li><li><p>访问并测试 <br> 首次启动比较慢，所以，需要稍等一会儿，就可以在对应<a href="http://xxx.xxx.xxx.xxx:8081" rel="nofollow">http://xxx.xxx.xxx.xxx:8081</a> 链接中访问到页面。初次使用时，需要我们创建默认的管理员密码。当登录之后，创建项目，突然发现，坏了。 <br> 在项目clone的路径中，本来应该是:8081的地方，变成了主机名。</p></li><li><p>修改配置 <br> 为了解决这个问题，我们需要修改external_url，</p> <pre class="prettyprint"><code class=" hljs bash"><span class="hljs-built_in">sudo</span> docker <span class="hljs-keyword">exec</span> -it gitlab /bin/bash
vim /etc/gitlab/gitlab.rb</code></pre> <p>修改external_url为</p> <pre class="prettyprint"><code class=" hljs bash">external_url <span class="hljs-string">"http://xxx.xxx.xxx.xxx:8081"</span></code></pre> <p>这里，请将”xxx.xxx.xxx.xxx”变成为自己的主机ip <br> 运行gitlab-ctl使配置生效</p> <pre class="prettyprint"><code class=" hljs lasso">gitlab<span class="hljs-attribute">-ctl</span> reconfigure</code></pre></li><li><p>再次测试 <br> 再次访问<a href="http://xxx.xxx.xxx.xxx:8081" rel="nofollow">http://xxx.xxx.xxx.xxx:8081</a>，发现，访问不了了。。 <br> 不得不说，我感觉这是一个bug，翻了半天文档，没找到对应的说明。 <br> 解决方法： <br> 修改external_url时，container内部的项目端口竟然也被直接转到了8081端口上，而原来我们映射的端口时8081:80，此时，80端口上没东西了，造成访问不了了。所以，删掉这个容器，重新创建</p> <pre class="prettyprint"><code class=" hljs lasso">sudo docker stop gitlab
sudo docker rm gitlab
sudo docker run <span class="hljs-attribute">-d</span> <span class="hljs-attribute">-p</span> <span class="hljs-number">8443</span>:<span class="hljs-number">443</span> <span class="hljs-attribute">-p</span> <span class="hljs-number">8081</span>:<span class="hljs-number">8081</span> <span class="hljs-attribute">-p</span> <span class="hljs-number">8022</span>:<span class="hljs-number">22</span> <span class="hljs-subst">\</span>
<span class="hljs-subst">--</span>name gitlab <span class="hljs-subst">--</span>restart always <span class="hljs-subst">\</span>
<span class="hljs-subst">--</span>volume /home/xxx/dockerData/gitlab/config:/etc/gitlab <span class="hljs-subst">\</span>
<span class="hljs-subst">--</span>volume /home/xxx/dockerData/gitlab/logs:/<span class="hljs-built_in">var</span>/<span class="hljs-keyword">log</span>/gitlab <span class="hljs-subst">\</span>
<span class="hljs-subst">--</span>volume /home/xxx/dockerData/gitlab/<span class="hljs-built_in">data</span>:/<span class="hljs-built_in">var</span>/opt/gitlab <span class="hljs-subst">\</span>
gitlab/gitlab<span class="hljs-attribute">-ce</span>:latest</code></pre> <p>注意，此处将8081仍然映射到了8081端口上。ps，这也是为什么上面不让用8080端口的，因为如果用8080，会造成内部端口冲突。 <br> 做好这一切之后，重新访问<a href="http://xxx.xxx.xxx.xxx:8081" rel="nofollow">http://xxx.xxx.xxx.xxx:8081</a>，突然感觉世界平静了好多，这里截一张正常的图，以示庆贺。 <br> <img src="https://images2.imgbox.com/90/38/eqtfzZaJ_o.png" alt="docker安装gitlab" title=""></p></li></ol> 
<h3 id="参考资料">参考资料</h3> 
<p><a href="http://www.runoob.com/docker/ubuntu-docker-install.html" rel="nofollow">Ubuntu Docker 安装</a> <br> <a href="https://www.jianshu.com/p/24959481340e" rel="nofollow">用Docker安装Gitlab</a> <br> <a href="https://docs.gitlab.com/omnibus/docker/#expose-gitlab-on-different-ports" rel="nofollow">Expose GitLab on different ports </a> <br> <a href="https://docs.gitlab.com/omnibus/settings/configuration.html#configuring-the-external-url-for-gitlab" rel="nofollow">Configuring the external URL for GitLab </a> <br> <a href="https://www.jianshu.com/p/d707f70c60d2" rel="nofollow">利用GitLab Docker images安装GitLab（填坑）</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/81e7d54fc05c4ec85e06e89891f0b8dd/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">如何解除word文档的密码保护状态</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/93dcd48eab3af67019ef29e9612ae86e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Qt中的QGraphicsScene中，删除部分图元</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>