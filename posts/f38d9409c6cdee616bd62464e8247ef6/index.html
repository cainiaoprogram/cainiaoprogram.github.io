<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Docker搭建MariaDB/Mysql MHA高可用集群 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Docker搭建MariaDB/Mysql MHA高可用集群" />
<meta property="og:description" content="Docker搭建MariaDB MHA高可用集群 制作需要使用的相关镜像 mha4mysql是日本工程师Yoshinori Matsunobu开发的一款MySQL高可用软件。mha4mysql分为两部分，一是管理器部分mha4mysql-manager，二是结点部分mha4mysql-node。mha4mysql-node要运行在每台受管理的MySQL服务器上；而mha4mysql-manager所在服务器则不需要MariaDB，但需要mha4mysql-node。因为mha4mysql-manager依赖mha4mysql-node，即安装mha4mysql-manager前必须先安装mha4mysql-node。
下面讲解一下，基于debian:jessie制作mha4mariadb-manager的Docker镜像和
基于mariadb:10.2.22制作mha4mysql-node的Docker镜像。
mha4mariadb-manager Dockerfile如下
FROM debian:jessie COPY ./mha4mysql-manager.tar.gz /tmp/ COPY ./mha4mysql-node.tar.gz /tmp/ RUN build_deps=&#39;ssh sshpass perl libdbi-perl libmodule-install-perl libdbd-mysql-perl libconfig-tiny-perl liblog-dispatch-perl libparallel-forkmanager-perl make&#39; \ &amp;&amp; apt-get update \ &amp;&amp; apt-get -y --force-yes install $build_deps \ &amp;&amp; tar -zxf /tmp/mha4mysql-node.tar.gz -C /opt \ &amp;&amp; cd /opt/mha4mysql-node \ &amp;&amp; perl Makefile.PL \ &amp;&amp; make \ &amp;&amp; make install \ &amp;&amp; tar -zxf /tmp/mha4mysql-manager.tar.gz -C /opt \ &amp;&amp; cd /opt/mha4mysql-manager \ &amp;&amp; perl Makefile." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/f38d9409c6cdee616bd62464e8247ef6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-03-12T15:46:31+08:00" />
<meta property="article:modified_time" content="2019-03-12T15:46:31+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Docker搭建MariaDB/Mysql MHA高可用集群</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="DockerMariaDB_MHA_0"></a>Docker搭建MariaDB MHA高可用集群</h3> 
<h5><a id="_2"></a>制作需要使用的相关镜像</h5> 
<p>mha4mysql是日本工程师<a href="https://www.percona.com/live/mysql-conference-2014/users/yoshinori-matsunobu" rel="nofollow">Yoshinori Matsunobu</a>开发的一款MySQL高可用软件。mha4mysql分为两部分，一是管理器部分<a href="https://github.com/mysql-dev-fun/mha4mysql-manager-0.56">mha4mysql-manager</a>，二是结点部分<a href="https://github.com/mysql-dev-fun/mha4mysql-node-0.56">mha4mysql-node</a>。mha4mysql-node要运行在每台受管理的MySQL服务器上；而mha4mysql-manager所在服务器则不需要MariaDB，但需要mha4mysql-node。因为mha4mysql-manager依赖mha4mysql-node，即安装mha4mysql-manager前必须先安装mha4mysql-node。</p> 
<p>下面讲解一下，基于<a href="https://hub.docker.com/_/debian/" rel="nofollow">debian:jessie</a>制作mha4mariadb-manager的Docker镜像和<br> 基于<a href="https://hub.docker.com/_/mariadb?tab=tags" rel="nofollow">mariadb:10.2.22</a>制作mha4mysql-node的Docker镜像。</p> 
<ul><li><strong>mha4mariadb-manager</strong></li></ul> 
<p>Dockerfile如下</p> 
<pre><code>FROM debian:jessie

COPY ./mha4mysql-manager.tar.gz /tmp/
COPY ./mha4mysql-node.tar.gz /tmp/

RUN build_deps='ssh sshpass perl libdbi-perl libmodule-install-perl libdbd-mysql-perl 
libconfig-tiny-perl liblog-dispatch-perl libparallel-forkmanager-perl make' \
    &amp;&amp; apt-get update \
    &amp;&amp; apt-get -y --force-yes install $build_deps \
    &amp;&amp; tar -zxf /tmp/mha4mysql-node.tar.gz -C /opt \
    &amp;&amp; cd /opt/mha4mysql-node \
    &amp;&amp; perl Makefile.PL \
    &amp;&amp; make \
    &amp;&amp; make install \
    &amp;&amp; tar -zxf /tmp/mha4mysql-manager.tar.gz -C /opt \
    &amp;&amp; cd /opt/mha4mysql-manager \
    &amp;&amp; perl Makefile.PL \
    &amp;&amp; make \
    &amp;&amp; make install \
    &amp;&amp; cd /opt \
    &amp;&amp; rm -rf /opt/mha4mysql-* \
    &amp;&amp; apt-get clean
</code></pre> 
<blockquote> 
 <p>注释：</p> 
 <p>基于debian:jessie镜像二次制作；<br> 将mha4mysql-manager和mha4mysql-node的当前版本（v0.56）打包，复制到镜像内；<br> build_deps是mha4mysql-manager和mha4mysql-node的安装依赖、运行依赖；<br> 先拆包安装mha4mysql-node，安装命令：perl <a href="http://Makefile.PL" rel="nofollow">Makefile.PL</a> &amp;&amp; make &amp;&amp; make install；<br> 才能拆包安装mha4mysql-manager，安装命令：perl <a href="http://Makefile.PL" rel="nofollow">Makefile.PL</a> &amp;&amp; make &amp;&amp; make install；<br> 清理一些无用文件。</p> 
</blockquote> 
<p>在该目录下运行命令构造mha4mariadb-manager镜像</p> 
<pre><code>docker build -t mha4mariadb-manager .
</code></pre> 
<ul><li><strong>mha4mariadb-node</strong></li></ul> 
<p>Dockerfile如下</p> 
<pre><code>FROM mariadb:10.0

COPY ./mha4mysql-node.tar.gz /tmp/

RUN build_deps='ssh sshpass perl libdbi-perl libmodule-install-perl libdbd-mysql-perl make' \
    &amp;&amp; apt-get update \
    &amp;&amp; apt-get -y --force-yes install $build_deps \
    &amp;&amp; tar -zxf /tmp/mha4mysql-node.tar.gz -C /opt \
    &amp;&amp; cd /opt/mha4mysql-node \
    &amp;&amp; perl Makefile.PL \
    &amp;&amp; make \
    &amp;&amp; make install \
    &amp;&amp; cd /opt \
    &amp;&amp; rm -rf /opt/mha4mysql-* \
    &amp;&amp; apt-get clean

</code></pre> 
<blockquote> 
 <p>注释：</p> 
 <p>基于mariadb:10.2.22镜像二次制作；<br> 将mha4mysql-node的当前版本（v0.56）打包，复制到镜像内；<br> build_deps是mha4mysql-node的安装依赖、运行依赖；<br> 拆包安装mha4mysql-manager，安装命令：perl <a href="http://Makefile.PL" rel="nofollow">Makefile.PL</a> &amp;&amp; make &amp;&amp; make install；<br> 清理一些无用文件</p> 
</blockquote> 
<p>在该目录下运行命令构造mha4mariadb-node镜像</p> 
<pre><code> docker build -t mha4mariadb-node .
</code></pre> 
<h5><a id="Docker_Compose_90"></a>Docker Compose编排</h5> 
<p>这个编排主要实现一主一备一从的MariaDB MHA高可用集群。</p> 
<ul><li><strong>目录结构</strong></li></ul> 
<pre><code>L--mariadb-mha-docker                //主目录
    L--scripts                     //本地（Docker宿主）使用的一些脚本
    	L--mariadb_set_mbs.sh
        L--mha_check_repl.sh
        L--mha_check_ssh.sh
        L--mha_start_manager.sh
        L--ssh_share.sh
        L--ssh_start.sh
    L--services                    //需要build的服务（目前是空）
    L--volumes                     //各个容器的挂载数据卷
        L--mha_manager
        	L--conf
        		L--app1.conf       //MHA配置
        L--mha_node0
        	L--conf
        		L--my.cnf
        L--mha_node1	
        	L--conf
        		L--my.cnf
        L--mha_node2
        	L--conf
        		L--my.cnf
        L--mha_share               //各个容器共享的目录
          L--scripts               //各个容器共用的一些脚本
          	L--mariadb_grant_slave.sh
          	L--mariadb_start_slave.sh
          	L--ssh_auth_keys.sh
          	L--ssh_generate_key.sh
          L--sshkeys               //各个容器的ssh public key
    L--parameters.env              //账号密码等环境参数
    L--docker-compose.yml          //编排配置

</code></pre> 
<ul><li><strong>/scripts/mariadb_set_mbs.sh</strong></li></ul> 
<pre><code>docker exec -it mha_node0 /bin/bash /root/mha_share/scripts/mariadb_grant_slave.sh
docker exec -it mha_node1 /bin/bash /root/mha_share/scripts/mariadb_grant_slave.sh
docker exec -it mha_node1 /bin/bash /root/mha_share/scripts/mariadb_start_slave.sh
docker exec -it mha_node2 /bin/bash /root/mha_share/scripts/mariadb_start_slave.sh
</code></pre> 
<ul><li><strong>/scripts/mha_check_repl.sh</strong></li></ul> 
<pre><code>docker exec -it mha_manager masterha_check_repl  --conf=/etc/mha/app1.conf
</code></pre> 
<ul><li><strong>/scripts/mha_check_ssh.sh</strong></li></ul> 
<pre><code>docker exec -it mha_manager masterha_check_ssh  --conf=/etc/mha/app1.conf
</code></pre> 
<ul><li><strong>/scripts/mha_start_manager.sh</strong></li></ul> 
<pre><code>docker exec -it mha_manager masterha_manager --conf=/etc/mha/app1.conf
</code></pre> 
<ul><li><strong>/scripts/ssh_share.sh</strong></li></ul> 
<pre><code>docker exec -it mha_node0 /bin/bash /root/mha_share/scripts/ssh_generate_key.sh
docker exec -it mha_node1 /bin/bash /root/mha_share/scripts/ssh_generate_key.sh
docker exec -it mha_node2 /bin/bash /root/mha_share/scripts/ssh_generate_key.sh
docker exec -it mha_manager /bin/bash /root/mha_share/scripts/ssh_generate_key.sh

docker exec -it mha_node0 /bin/bash /root/mha_share/scripts/ssh_auth_keys.sh
docker exec -it mha_node1 /bin/bash /root/mha_share/scripts/ssh_auth_keys.sh
docker exec -it mha_node2 /bin/bash /root/mha_share/scripts/ssh_auth_keys.sh
docker exec -it mha_manager /bin/bash /root/mha_share/scripts/ssh_auth_keys.sh

</code></pre> 
<ul><li><strong>/scripts/ssh_start.sh</strong></li></ul> 
<pre><code>docker exec -it mha_node0 /bin/bash service ssh start
docker exec -it mha_node1 /bin/bash service ssh start
docker exec -it mha_node2 /bin/bash service ssh start
docker exec -it mha_manager /bin/bash service ssh start
</code></pre> 
<ul><li><strong>/volumes/mha_manager/conf/app1.conf</strong></li></ul> 
<pre><code>[server default]
user=root
password=123456
ssh_user=root

manager_workdir=/usr/local/mha
remote_workdir=/usr/local/mha

repl_user=myslave
repl_password=myslave

[server0]
hostname=10.5.0.10

[server1]
hostname=10.5.0.11

[server2]
hostname=10.5.0.12
</code></pre> 
<ul><li><strong>/volumes/mha_node0/conf/my.cnf(主库)</strong></li></ul> 
<pre><code>[mysqld]
server-id=1
log-bin=mysql-bin
binlog-do-db=testing
binlog-ignore-db=mysql
replicate-do-db=testing
replicate-ignore-db=mysql
auto_increment_increment=2
auto_increment_offset=1
expire_logs_days=7
</code></pre> 
<ul><li><strong>/volumes/mha_node1/conf/my.cnf(备库)</strong></li></ul> 
<pre><code>[mysqld]
server-id=2
log-bin=mysql-bin
binlog-do-db=testing
binlog-ignore-db=mysql
replicate-do-db=testing
replicate-ignore-db=mysql
auto_increment_increment=2
auto_increment_offset=2
expire_logs_days=7
read_only = ON
</code></pre> 
<ul><li><strong>/volumes/mha_node2/conf/my.cnf(从库)</strong></li></ul> 
<pre><code>[mysqld]
server-id=3
replicate-do-db=testing
replicate-ignore-db=mysql
expire_logs_days=7
read_only = ON
</code></pre> 
<ul><li><strong>/volumes/mha_share/scripts/mariadb_grant_slave.sh</strong></li></ul> 
<pre><code>mysql -u root -p$MYSQL_ROOT_PASSWORD &lt;&lt;EOSQL
GRANT ALL ON *.* TO myuser@'10.5.0.%' IDENTIFIED BY 'mypass';
GRANT REPLICATION SLAVE ON *.* TO 'myslave'@'10.5.0.%' IDENTIFIED BY 'myslave';
reset master;
EOSQL
</code></pre> 
<ul><li><strong>/volumes/mha_share/scripts/mariadb_start_slave.sh</strong></li></ul> 
<pre><code>mysql -u root -p$MYSQL_ROOT_PASSWORD &lt;&lt;EOSQL
GRANT ALL ON *.* TO myuser@'10.5.0.%' IDENTIFIED BY 'mypass';
CHANGE MASTER TO MASTER_HOST='10.5.0.10', MASTER_USER='myslave', MASTER_PASSWORD='myslave', MASTER_CONNECT_RETRY=60;
start slave;
EOSQL
</code></pre> 
<ul><li><strong>/volumes/mha_share/scripts/ssh_auth_keys.sh</strong></li></ul> 
<pre><code>cat $MHA_SHARE_SSHKEYS_PATH/*.pub &gt; /root/.ssh/authorized_keys
</code></pre> 
<ul><li><strong>/volumes/mha_share/scripts/ssh_generate_key.sh</strong></li></ul> 
<pre><code>ssh-keygen -t rsa -P "" -f /root/.ssh/id_rsa
cp /root/.ssh/id_rsa.pub "$MHA_SHARE_SSHKEYS_PATH/id_rsa_$CONTAINER_NAME.pub"
</code></pre> 
<ul><li><strong>docker-compose.yml</strong></li></ul> 
<pre><code>version: "3.7"
services:

  mha_master:
    image: mha4mariadb-node:latest
    container_name: mha_node0
    restart: always
    networks:
      net1:
        ipv4_address: 10.5.0.10
    ports:
      - "33060:3306"
    volumes:
      - "./volumes/mha_share/:/root/mha_share/"
      - "./volumes/mha_node0/lib/:/var/lib/mysql/"
      - "./volumes/mha_node0/conf/:/etc/mysql/conf.d/"
    env_file:
      - ./parameters.env
    environment:
      - CONTAINER_NAME=mha_node0

  mha_slave1:
    image: mha4mariadb-node:latest
    container_name: mha_node1
    restart: always
    depends_on:
      - mha_master
    networks:
      net1:
        ipv4_address: 10.5.0.11
    ports:
      - "33061:3306"
    volumes:
      - "./volumes/mha_share/:/root/mha_share/"
      - "./volumes/mha_node1/lib/:/var/lib/mysql/"
      - "./volumes/mha_node1/conf/:/etc/mysql/conf.d/"
    env_file:
      - ./parameters.env
    environment:
      - CONTAINER_NAME=mha_node1
  mha_slave2:
    image: mha4mariadb-node:latest
    container_name: mha_node2
    depends_on:
      - mha_master
    restart: always
    networks:
      net1:
        ipv4_address: 10.5.0.12
    ports:
      - "33062:3306"
    volumes:
      - "./volumes/mha_share/:/root/mha_share/"
      - "./volumes/mha_node2/lib/:/var/lib/mysql/"
      - "./volumes/mha_node2/conf/:/etc/mysql/conf.d/"
    env_file:
      - ./parameters.env
    environment:
      - CONTAINER_NAME=mha_node2

  mha_manager:
    image: mha4mariadb-manager:latest
    container_name: mha_manager
    depends_on:
      - mha_master
      - mha_slave1
      - mha_slave2
    restart: always
    networks:
      net1:
        ipv4_address: 10.5.0.9
    volumes:
      - "./volumes/mha_share/:/root/mha_share/"
      - "./volumes/mha_manager/conf:/etc/mha"
      - "./volumes/mha_manager/work:/usr/local/mha"
    entrypoint: "tailf /dev/null"
    env_file:
      - ./parameters.env
    environment:
      - CONTAINER_NAME=mha_manager
networks:
  net1:
    driver: bridge
    ipam:
      config:
        - subnet: 10.5.0.0/16
</code></pre> 
<ul><li><strong>parameters.env</strong></li></ul> 
<pre><code>ROOT_PASSWORD=123456
MYSQL_ROOT_PASSWORD=123456
MYSQL_DATABASE=testing
MYSQL_User=testing
MYSQL_PASSWORD=testing
MHA_SHARE_SCRIPTS_PATH=/root/mha_share/scripts
MHA_SHARE_SSHKEYS_PATH=/root/mha_share/sshkeys
</code></pre> 
<ul><li><strong>建立容器并运行</strong></li></ul> 
<p>在主目录下执行<code>docker-compose up -d</code>构建并运行整个Docker服务。</p> 
<ul><li><strong>SSH设置</strong></li></ul> 
<p>MHA要求各个主机能够相互SSH登录，所以整体服务首次启动成功后，在主目录下先执行一些命令：</p> 
<pre><code>$ sh ./scripts/ssh_start.sh
$ sh ./scripts/ssh_share.sh
</code></pre> 
<p><code>ssh_start.sh</code>作用是在各个容器上开启SSH服务，<code>ssh_share.sh</code>作用是在容器内生成SSH公密钥，再把公钥共享到其他容器。常用命令调用的脚本在<code>scripts</code>和<code>volumes/mha_share/scripts</code>下，这些脚本都很简单，一看就明。<br> 若是整体服务重新启动，只需重新开启SSH服务即可：</p> 
<pre><code>$ sh ./scripts/ssh_start.sh
</code></pre> 
<p>在manager容器上检测SSH是否配置成功：</p> 
<pre><code>$ docker exec -it mha_manager /bin/bash
root@mha_manager# masterha_check_ssh --conf=/etc/mha/app1.conf
</code></pre> 
<p>若是成功，会显示</p> 
<pre><code>Mon Oct 16 14:53:59 2017 - [debug]   ok.
Mon Oct 16 14:53:59 2017 - [info] All SSH connection tests passed successfully.
</code></pre> 
<ul><li><strong>开启数据主从复制</strong></li></ul> 
<p>首先对主库、备考创建和授权复制账号，对备库、从库设置主库信息和开始复制，以下命令会完成这些操作：</p> 
<pre><code>$ sh ./scripts/mariadb_set_mbs.sh
</code></pre> 
<p>可以在主库上的testing数据库里创建一张表，写入一些数据，看看备库、从库会不会同步。</p> 
<p>在manager容器上检测REPL是否配置成功：</p> 
<pre><code>$ docker exec -it mha_manager /bin/bash
root@mha_manager# masterha_check_repl --conf=/etc/mha/app1.conf
</code></pre> 
<p>若是成功，会显示</p> 
<pre><code>Mon Oct 16 15:01:35 2017 - [info] Got exit code 0 (Not master dead).

MySQL Replication Health is OK.
</code></pre> 
<ul><li><strong>开启MHA监控</strong></li></ul> 
<p>SSH和REPL检测没问题后，可以在manager容器上开启MHA监控：</p> 
<pre><code>$ docker exec -it mha_manager /bin/bash
root@mha_manager# masterha_manager --conf=/etc/mha/app1.conf
</code></pre> 
<p><code>masterha_manager</code>进程会一直监视主库状态是否可用，若是主库宕机，<code>masterha_manager</code>会将备库与从库的Relay Log进行比较，把最新的数据整合到备库，然后把备库提升为新主库，从库跟随复制新主库，最后<code>masterha_manager</code>进程会退出，不再监控。</p> 
<ul><li><strong>模拟master节点故障</strong></li></ul> 
<p>我们可以在本地（Docker宿主）暂停主库（mha_node0容器）：</p> 
<pre><code>$ docker pause mha_node0
</code></pre> 
<p>然后，manager容器上<code>masterha_manager</code>确认主库失联后，开始切换主库，成功后会显示：</p> 
<pre><code>----- Failover Report -----

app1: MySQL Master failover 10.5.0.10(10.5.0.10:3306) to 10.5.0.11(10.5.0.11:3306) succeeded

Master 10.5.0.10(10.5.0.10:3306) is down!

Check MHA Manager logs at 56560d023a4c for details.

Started automated(non-interactive) failover.
The latest slave 10.5.0.11(10.5.0.11:3306) has all relay logs for recovery.
Selected 10.5.0.11(10.5.0.11:3306) as a new master.
10.5.0.11(10.5.0.11:3306): OK: Applying all logs succeeded.
10.5.0.12(10.5.0.12:3306): This host has the latest relay log events.
Generating relay diff files from the latest slave succeeded.
10.5.0.12(10.5.0.12:3306): OK: Applying all logs succeeded. Slave started, replicating from 10.5.0.11(10.5.0.11:3306)
10.5.0.11(10.5.0.11:3306): Resetting slave info succeeded.
Master failover to 10.5.0.11(10.5.0.11:3306) completed successfully.
</code></pre> 
<p>可以到从库（mha_node2容器），查看复制状态，可以看到跟随主库是10.5.0.11，原来的主库为10.5.0.10即新主库（原备库）：</p> 
<pre><code>docker exec -it mha_node2 /bin/bash
mysql -u root -p123456 
MariaDB [(none)]&gt; show slave status;
+----------------------------------+
Master_Host : 10.5.0.11 
</code></pre> 
<ul><li><strong>恢复MHA状态</strong></li></ul> 
<p>让node0变成备库，在/volumes/mha_node1/conf/my.cnf中加入</p> 
<pre><code>read_only = ON
</code></pre> 
<p>重启mha_node0容器</p> 
<pre><code>docker restart mha_node0
</code></pre> 
<p>进入node0节点查看redy_only模式是否开启</p> 
<pre><code>docker exec -it mha_node0 /bin/bash
mysql -uroot -p123456
show variables like 'read_only';
</code></pre> 
<p>得到结果</p> 
<pre><code>+---------------+-------+
| Variable_name | Value |
+---------------+-------+
| read_only     | ON    |
+---------------+-------+
</code></pre> 
<p>表示redy_only已经开启。</p> 
<p>接下来只要把node0变为node1的从库即可恢复MHA的状态。(具体操作请查看<a href="https://blog.csdn.net/clearlxj/article/details/88313033">MariaDB的主从复制部署</a>)<br> 并重启整个项目</p> 
<pre><code>docker-compose restarts
</code></pre> 
<p>重新开启SSH服务即可：</p> 
<pre><code>$ sh ./scripts/ssh_start.sh
</code></pre> 
<h5><a id="_541"></a></h5> 
<h5><a id="_543"></a>遇到的问题</h5> 
<p>MHA检查复制状态时出现如下报错：</p> 
<pre><code>Checking if super_read_only is defined and turned on..DBD::mysql::st execute failed: Unknown system variable 'super_read_only' at /usr/share/perl5/vendor_perl/MHA/SlaveUtil.pm line 245.
</code></pre> 
<p>原因是在5.5.56-MariaDB版本中虽然从节点设置了read_only选项，但是对于管理员权限的用户这点不生效，所以在MySQL5.6（Mariadb10.1）后新增了super_read_only选项，但当前版本中没有这个选项，所以报错。</p> 
<p>解决办法是最后将MHA的版本换成mha4mysql-0.56。</p> 
<p>而且版本的mha4mysql-0.57和mha4mysql-0.58都不能解决这个问题，测试之后只有mha4mysql-0.56能够解决。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/26d97c8cc17405873f6b94ea1e443ef4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">VSCode内npm run build编译打包时候报错：code ELIFECYCLE - （已解决）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ca6bf76751cdc83766fc0d2875124f8f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">程序员C&#43;&#43;代码实现超酷炫表白，用过的人都找到了对象...</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>