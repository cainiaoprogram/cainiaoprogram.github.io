<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>模型评估：余弦距离的应用 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="模型评估：余弦距离的应用" />
<meta property="og:description" content="其实在模型训练过程中，我们在不断地评估着样本间的距离，如何评估样本距离也是定义优化目标和训练方法的基础。
在机器学习问题中，通常将特征表示为向量的形式，所以在分析两个特征向量之间的相似性时，常使用余弦相似度来表示。余弦相似度的取值范围是[-1,1]，相同的两个向量之间的相似度为1。如果希望得到类似于距离的表示，将1减去余弦相似度即为余弦距离。因此，余弦距离的取值范围为[0,2]，相同的两个向量余弦距离为0.
1.为什么在一些场景中要使用余弦相似度而不是欧氏距离 对于两个向量A和B，其余弦相似度定义为，即两个向量夹角的余弦，关注的是向量之间的角度关系，并不关心它们的绝对大小，其取值范围是[-1,1]。当一对文本相似度的长度差距很大，但内容十分相近时，如果使用词频或词向量作为特征，它们在特征空间中的欧氏距离通常很大；而如果使用余弦相似度的话，它们之间的夹角可能很小，因而相似度高。此外，在文本、图像、视频等领域，研究的对象的特征维度往往很高，余弦相似度在高维情况下依然保持“相同时为1，正交时为0，相反时为-1”的性质，而欧氏距离的数值则受维度的影响，范围不固定，并且含义也比较模糊。
在一些场景，例如Word2Vec中，其向量的模长是经过归一化的，此时欧氏距离与余弦距离有着单调的关系，即
其中表示欧氏距离，表示余弦相似度，表示余弦距离。在此场景下，如果选择距离最小（相似度最大）的近邻，那么使用余弦相似度和欧式距离的结果是相同的。
总体来说，欧氏距离体现数值上的绝对差异，而余弦距离体现方向上的相对差异。例如，统计两部剧的用户观看行为，用户A的观看向量为（0,1），用户B为（1,0）；此时二者的余弦距离很大，而欧氏距离很小；我们分析两个用户对于不同视频的偏好，更关注相对差异，显然应当使用余弦距离。而当我们分析用户活跃度，以登录次数（单位：次）和平均观看时长（单位：分钟）作为特征时，余弦距离会认为（1,10）、（10,100）两个用户距离很近；但显然这两个用户活跃度是有着极大差异的，此时我们更关注数值绝对差异，应当使用欧氏距离。
特定的度量方法适用于什么样的问题，需要在学习和研究中多总结和思考，这样在遇到新的问题时也可以活学活用。
2.余弦距离是否是一个严格定义的距离? 该题主要考察对距离的定义的理解，以及简单的反证和推导。首先看距离的定义：在一个集合中，如果每一对元素均可唯一确定一个实数，使得三条距离公理（正定型、对称性、三角不等式）成立，则该实数可称为这对元素之间的距离。
余弦距离满足正定型和对称性，但是不满足三角不等式，因此他并不是严格定义的距离。具体来说，对于向量A和B，三条距离公理的证明过程如下。
正定性 根据余弦距离的定义，有
考虑到 ，因此有恒成立。特别地，有
对称性 根据余弦距离的定义，有
因此余弦距离满足对称性。
三角不等式 该性质并不成立，下面给出一个反例。给定一个A=(1,0),B=(1,1),C=(0,1)，则有
因此有
其实从问题1中，我们也能够得出：单位圆上欧氏距离和余弦距离满足
即有如下关系
显然在单位圆上，余弦距离和欧氏距离的范围都是[0,2]。我们已知欧氏距离是一个合法的距离，而余弦距离与欧氏距离有二次关系，自然不满足三角不等式。具体来说，可以假设A与B、B与C非常近，其欧氏距离为极小量；此时A、B、C虽然在圆弧上，但近似在一条直线上，所以A与C的欧氏距离接近于。因此，A与B、B与C的余弦距离为；A与C的余弦距离接近于，大于A与B、B与C的余弦距离之和。
在机器学习领域，被俗称为距离，却不满足三条距离公理的不仅仅有余弦距离，还有KL距离（Kullback-Leibler Divergence），也叫作相对熵，它用于计算两个分布之间的差异，但不满足对称性和三角不等式。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/9f2d8209ea1149e2d1c202612b635f7f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-11T17:43:59+08:00" />
<meta property="article:modified_time" content="2024-01-11T17:43:59+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">模型评估：余弦距离的应用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>其实在模型训练过程中，我们在不断地评估着样本间的距离，如何评估样本距离也是定义优化目标和训练方法的基础。</p> 
<p>在机器学习问题中，通常将特征表示为向量的形式，所以在分析两个特征向量之间的相似性时，常使用余弦相似度来表示。余弦相似度的取值范围是[-1,1]，相同的两个向量之间的相似度为1。如果希望得到类似于距离的表示，将1减去余弦相似度即为余弦距离。因此，余弦距离的取值范围为[0,2]，相同的两个向量余弦距离为0.</p> 
<h3>1.为什么在一些场景中要使用余弦相似度而不是欧氏距离</h3> 
<p>对于两个向量A和B，其余弦相似度定义为<img alt="\cos (A,B)=\frac{A\cdot B}{||A||_{2}||B||_2}" class="mathcode" src="https://images2.imgbox.com/fb/a2/adkMViE7_o.png">，即两个向量夹角的余弦，关注的是向量之间的角度关系，并不关心它们的绝对大小，其取值范围是[-1,1]。当一对文本相似度的长度差距很大，但内容十分相近时，如果使用词频或词向量作为特征，它们在特征空间中的欧氏距离通常很大；而如果使用余弦相似度的话，它们之间的夹角可能很小，因而相似度高。此外，在文本、图像、视频等领域，研究的对象的特征维度往往很高，<span style="color:#1c7331;"><strong>余弦相似度在高维情况下依然保持“相同时为1，正交时为0，相反时为-1”的性质，而欧氏距离的数值则受维度的影响，范围不固定，并且含义也比较模糊。</strong></span></p> 
<p>在一些场景，例如Word2Vec中，其向量的模长是经过归一化的，此时欧氏距离与余弦距离有着单调的关系，即</p> 
<p style="text-align:center;"><img alt="||A-B||_2=\sqrt{2(1-\cos(A,B))}" class="mathcode" src="https://images2.imgbox.com/d6/8b/8nutwbkG_o.png"></p> 
<p>其中<img alt="||A-B||_2" class="mathcode" src="https://images2.imgbox.com/18/61/1p1NwuRP_o.png">表示欧氏距离，<img alt="\cos(A,B)" class="mathcode" src="https://images2.imgbox.com/79/15/YlJv4OpF_o.png">表示余弦相似度，<img alt="(1-\cos(A,B))" class="mathcode" src="https://images2.imgbox.com/c0/3c/X9hDEaEl_o.png">表示余弦距离。在此场景下，如果选择距离最小（相似度最大）的近邻，那么使用余弦相似度和欧式距离的结果是相同的。</p> 
<p><span style="color:#be191c;"><strong>总体来说，欧氏距离体现数值上的绝对差异，而余弦距离体现方向上的相对差异</strong></span>。例如，统计两部剧的用户观看行为，用户A的观看向量为（0,1），用户B为（1,0）；此时二者的余弦距离很大，而欧氏距离很小；我们分析两个用户对于不同视频的偏好，<span style="color:#ad720d;"><strong>更关注相对差异，显然应当使用余弦距离</strong>。</span>而当我们分析用户活跃度，以登录次数（单位：次）和平均观看时长（单位：分钟）作为特征时，余弦距离会认为（1,10）、（10,100）两个用户距离很近；但显然这两个用户活跃度是有着极大差异的，<span style="color:#1a439c;"><strong>此时我们更关注数值绝对差异，应当使用欧氏距离</strong></span><span style="color:#b95514;">。</span></p> 
<p>特定的度量方法适用于什么样的问题，需要在学习和研究中多总结和思考，这样在遇到新的问题时也可以活学活用。</p> 
<h3>2.余弦距离是否是一个严格定义的距离?</h3> 
<p>该题主要考察对距离的定义的理解，以及简单的反证和推导。首先看距离的定义：在一个集合中，如果每一对元素均可唯一确定一个实数，使得三条距离公理（正定型、对称性、三角不等式）成立，则该实数可称为这对元素之间的距离。</p> 
<p>余弦距离满足正定型和对称性，但是不满足三角不等式，因此他并不是严格定义的距离。具体来说，对于向量A和B，三条距离公理的证明过程如下。</p> 
<ul><li><strong>正定性</strong></li></ul> 
<p>根据余弦距离的定义，有</p> 
<p style="text-align:center;"><img alt="\text{dist}(A,B)=1-\cos(\theta)=\frac{||A||_2||B||_2-AB}{||A||_2||B||_2}" class="mathcode" src="https://images2.imgbox.com/16/9a/myVWlggF_o.png"></p> 
<p>考虑到 <img alt="||A||_2||B||_2-AB\geq0" class="mathcode" src="https://images2.imgbox.com/93/8c/N3Q8zksD_o.png">，因此有<img alt="\text{dist}(A,B)\geq0" class="mathcode" src="https://images2.imgbox.com/21/e8/q57gNaDM_o.png">恒成立。特别地，有</p> 
<p style="text-align:center;"><img alt="\text{dist}(A,B)=0 \Leftrightarrow ||A||_2||B||_2=AB\Leftrightarrow A=B" class="mathcode" src="https://images2.imgbox.com/24/0a/muNPbmMY_o.png"></p> 
<ul><li><strong>对称性</strong></li></ul> 
<p>根据余弦距离的定义，有</p> 
<p style="text-align:center;"> <img alt="\text{dist}(A,B)=\frac{||A||_2||B||_2-AB}{||A||_2||B||_2}=\frac{||B||_2||A||_2-AB}{||B||_2||A||_2}=\text{dist}(B,A)" class="mathcode" src="https://images2.imgbox.com/c6/41/IbEwtYMR_o.png"></p> 
<p>因此余弦距离满足对称性。</p> 
<ul><li><strong>三角不等式</strong></li></ul> 
<p>该性质并不成立，下面给出一个反例。给定一个A=(1,0),B=(1,1),C=(0,1)，则有</p> 
<p style="text-align:center;"> <img alt="\text{dist}(A,B)=1-\frac{\sqrt 2}{2}" class="mathcode" src="https://images2.imgbox.com/95/e3/F7VAIyap_o.png"></p> 
<p style="text-align:center;"><img alt="\text{dist}(B,C)=1-\frac{\sqrt 2}{2}" class="mathcode" src="https://images2.imgbox.com/6b/1d/zMwCzxlM_o.png"></p> 
<p style="text-align:center;"><img alt="\text{dist}(A,C)=1" class="mathcode" src="https://images2.imgbox.com/28/79/Mqy9KqKD_o.png"></p> 
<p>因此有</p> 
<p style="text-align:center;"> <img alt="\text{dist}(A,B)+\text{dist}(B,C)=2-\sqrt 2&lt;1=\text{dist}(A,C)" class="mathcode" src="https://images2.imgbox.com/01/a3/PqqwcqaY_o.png"></p> 
<p>其实从问题1中，我们也能够得出：单位圆上欧氏距离和余弦距离满足</p> 
<p style="text-align:center;"><img alt="||A-B||=\sqrt{2\text{dist}(A,B)}" class="mathcode" src="https://images2.imgbox.com/09/70/giNR8TNj_o.png"></p> 
<p>即有如下关系</p> 
<p style="text-align:center;"> <img alt="\text{dist}(A,B)=\frac{1}{2}||A-B||^2" class="mathcode" src="https://images2.imgbox.com/23/26/3AfJwx0z_o.png"></p> 
<p>显然在单位圆上，余弦距离和欧氏距离的范围都是[0,2]。我们已知欧氏距离是一个合法的距离，而<span style="color:#4da8ee;"><strong>余弦距离与欧氏距离有二次关系</strong></span>，自然不满足三角不等式。具体来说，可以假设A与B、B与C非常近，其欧氏距离为极小量<img alt="u" class="mathcode" src="https://images2.imgbox.com/a5/51/Zl0E09Ku_o.png">；此时A、B、C虽然在圆弧上，但近似在一条直线上，所以A与C的欧氏距离接近于<img alt="2u" class="mathcode" src="https://images2.imgbox.com/3f/03/Eeq7DVlQ_o.png">。因此，A与B、B与C的余弦距离为<img alt="u^2/2" class="mathcode" src="https://images2.imgbox.com/ce/eb/kCmLnPbd_o.png">；A与C的余弦距离接近于<img alt="2u^2" class="mathcode" src="https://images2.imgbox.com/dd/f4/on6wAVrC_o.png">，大于A与B、B与C的余弦距离之和。</p> 
<p>在机器学习领域，被俗称为距离，却不满足三条距离公理的不仅仅有余弦距离，还有<span style="color:#956fe7;"><strong>KL距离（Kullback-Leibler Divergence），也叫作相对熵，它用于计算两个分布之间的差异</strong></span>，但不满足对称性和三角不等式。</p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/db4d5ce5720e63fa65528196de9e6d0f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">AI绘图哪家强？50款AI绘图软件大盘点【内附Midjourney保姆级上手教程】</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e012ceef6e42baeebe384ae50cfdd472/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">设计模式原理与分析</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>