<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>你知道【查找附近的人】是怎么实现的吗 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="你知道【查找附近的人】是怎么实现的吗" />
<meta property="og:description" content="我们在App上,经常能看到【查找附近的人】这么个功能，但是你知道它是怎么实现的吗？
Redis的GEO功能 Redis的3.2版本提供了GEO功能，能够方便地进行地理位置信息的存储与查找
存储经纬度信息
#命令格式：GEOADD key 经度 维度 memberGEOADD USER:LOCATION 114.18612410 22.29358599 HongKongAlice 获取成员的地理位置信息
#命令格式：GEOPOS key membergeopos USER:LOCATION HongKongAlice 计算两个坐标之间的距离
unit表示单位有以下四个值：
- m (meter) 代表米
- km （kilometer）代表千米
- mi （miles）代表英里
- ft （ft）代表尺
#命令格式：geodist key member1 member2 [unit]geodist USER:LOCATION HangZhouTom HongKongAlice km 获取指定位置范围内的所有地理位置
以下命令可以实现附近的人功能
#命令格式：georadius key 经度 维度 距离 [unit]georadius USER:LOCATION 114.18612509965897 22.293586120392426 2000 km#命令格式：georadiusbymember key member 距离 [unit]georadiusbymember USER:LOCATION HongKongAlice 2000 km 删除地理位置信息
GEO没有提供删除的命令，但是因为本身是由zset实现的，可以使用zrem对地理位置进行删除
zrem key memberzrem USER:LOCATION HongKongAlice 查找附近的人功能实现三步骤 1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/03b6d7baace7c31ad69cf5020a1c2081/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-15T17:24:58+08:00" />
<meta property="article:modified_time" content="2023-08-15T17:24:58+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">你知道【查找附近的人】是怎么实现的吗</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>我们在App上,经常能看到【查找附近的人】这么个功能，但是你知道它是怎么实现的吗？</p> 
<h3 id="h_649955993_0">Redis的GEO功能</h3> 
<p>Redis的3.2版本提供了GEO功能，能够方便地进行地理位置信息的存储与查找</p> 
<p><strong>存储经纬度信息</strong></p> 
<table><tbody><tr><th>#命令格式：GEOADD key 经度 维度 member</th></tr><tr><td>GEOADD USER:LOCATION 114.18612410 22.29358599 HongKongAlice</td></tr></tbody></table> 
<p></p> 
<p><strong>获取成员的地理位置信息</strong></p> 
<table><tbody><tr><th>#命令格式：GEOPOS key member</th></tr><tr><td>geopos USER:LOCATION HongKongAlice</td></tr></tbody></table> 
<p></p> 
<p><strong>计算两个坐标之间的距离</strong></p> 
<p>unit表示单位有以下四个值：</p> 
<p>- m (meter) 代表米</p> 
<p>- km （kilometer）代表千米</p> 
<p>- mi （miles）代表英里</p> 
<p>- ft （ft）代表尺</p> 
<table><tbody><tr><th>#命令格式：geodist key member1 member2 [unit]</th></tr><tr><td>geodist USER:LOCATION HangZhouTom HongKongAlice km</td></tr></tbody></table> 
<p></p> 
<p><strong>获取指定位置范围内的所有地理位置</strong></p> 
<p>以下命令可以实现附近的人功能</p> 
<table><tbody><tr><th>#命令格式：georadius key 经度 维度 距离 [unit]</th></tr><tr><td>georadius USER:LOCATION 114.18612509965897 22.293586120392426 2000 km</td></tr><tr><td>#命令格式：georadiusbymember key member 距离 [unit]</td></tr><tr><td>georadiusbymember USER:LOCATION HongKongAlice 2000 km</td></tr></tbody></table> 
<p></p> 
<p><strong>删除地理位置信息</strong></p> 
<p>GEO没有提供删除的命令，但是因为本身是由zset实现的，可以使用<em><strong>zrem</strong></em>对地理位置进行删除</p> 
<table><tbody><tr><th>zrem key member</th></tr><tr><td>zrem USER:LOCATION HongKongAlice</td></tr></tbody></table> 
<p></p> 
<h3 id="h_649955993_1">查找附近的人功能实现三步骤</h3> 
<p>1.获取定位信息</p> 
<p>2.经纬度信息存储</p> 
<p>3.经纬度信息查询</p> 
<p></p> 
<h3 id="h_649955993_2">第一步：获取定位信息</h3> 
<p>获取定位信息的3种方式</p> 
<p><strong>1.基于你连接的Wifi热点</strong></p> 
<p>wifi热点的位置是固定，你只要连了wifi，就能将你的位置锁定在一个范围内</p> 
<p><strong>2.基于移动基站定位</strong></p> 
<p>你的手机信号是移动基站提供的，当你的手机连接多个基站的信号，不同基站信号衰减不同，根据衰减情况与基站位置，大致确定你当前所在范围。</p> 
<p><strong>3.通过卫星定位</strong></p> 
<p>通过接收GPS、北斗等卫星的信号来计算出当前位置，该方法是最精准的。</p> 
<p></p> 
<p><strong>如果通过编程获取定位信息</strong></p> 
<p>1.通过android、iOS提供的API来获取定位信息</p> 
<p>2.通过第三方API来获取定位信息，如<a href="https://link.zhihu.com/?target=https%3A//lbs.amap.com/api/webservice/guide/api/ipconfig" rel="nofollow" title="高德地图API">高德地图API</a>、<a href="https://link.zhihu.com/?target=https%3A//lbsyun.baidu.com/faq/api%3Ftitle%3Dwebapi/ip-api-base" rel="nofollow" title="百度地图API">百度地图API</a>等</p> 
<p></p> 
<h3 id="h_649955993_3">第二步：经纬度信息的存储</h3> 
<pre><code>    public void addGeoInfos(){
        String key="USER:LOCATION";
        //添加地理位置与人
        redisTemplate.opsForGeo().add(key,new Point(114.18612509965897,22.293586120392426),"liSa");
        redisTemplate.opsForGeo().add(key,new Point(120.21551180,30.25308298),"Alice");

    }</code></pre> 
<h3 id="h_649955993_4">第三步：查找附近所有的人</h3> 
<pre><code>    public void findNearByMembers() {
        //key值
        String key="USER:LOCATION";
        //member
        String member="Alice";
        //距离
        Distance distance=new Distance(2000, RedisGeoCommands.DistanceUnit.KILOMETERS);
        //查找数据
        GeoResults&lt;RedisGeoCommands.GeoLocation&lt;Object&gt;&gt; results= redisTemplate.opsForGeo().radius(key,member,distance);
        //打印结果
        List&lt;GeoResult&lt;RedisGeoCommands.GeoLocation&lt;Object&gt;&gt;&gt; list= results.getContent();
        for (GeoResult&lt;RedisGeoCommands.GeoLocation&lt;Object&gt;&gt; location:list){
            System.out.println(location.getContent().getName());
        }
    }</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4be07e793809831d40c2628ad9c776a3/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">LaTeX详细教程&#43;技巧总结</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/001614710e45c90a5c7d5c2987c51224/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">FreeSwitch 使用keepalived进行主备切换高可用部署</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>