<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ES（elasticSearch学习笔记） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ES（elasticSearch学习笔记）" />
<meta property="og:description" content="什么是es es是面向文档型的数据库，一条数据在es数据库就是一个文档，和关系型数据库做一个类比：
1：es的索引类比关系型数据库的数据库，
2：es的type类比数据表（7.0版本以上删除了type这个概念），
3：es的索引下的文档document类比关系型数据库的行，新增时可以指定文档主键id,不指定会自动生成
4：es的文档中的字段类比关系关系型数据库的列。
现实生产中一般一个索引类似张表，但是一个索引下的字段还可以是一个对象,可以嵌套。
match每一次全文搜索分词是针对某一个字段的，可以是嵌套搜索，一次全文搜索不是针对整个索引的全部字段，想要同时全文搜多个字段可以一次请求中match多个字段
put请求新建索引，post/put请求新增数据，新增的数据就是一个文档，新增会有一个文档id就是索引下一个数据的主键
涉及的操作索引的增删改查和文档的增删改查
什么是倒排索引 es基本入门操作 1.安装访问
在本地es执行目录：/Users/liuqinhua/Desktop/错误/elasticsearch-7.6.2/bin
执行可执行文件：./elasticsearch
访问
2.创建索引put请求http://localhost:9200/liuqinhua（liuqinhua是索引名）
3**.get请求查看索引信息**：http://localhost:9200/索引名
例如：http://localhost:9200/liuqinhua
4.get请求查看所有的索引:http://localhost:9200/_cat/indices?v
这时候他是强制返回的内容是text格式的，所以会展示成表格的格式
5.delete请求删除索引wudonghui：http://localhost:9200/索引名
例如：http://localhost:9200/wudonghui
6.post请求给索引新增文档数据http://localhost:9200/索引名字/_doc
eg：http://localhost:9200/liuqinhua/_doc
这种会返回文档id
或者post或者put请求：http://localhost:9200/liuqinhua/_doc/自定义文档id
7.get请求查询索引的数据
查询某一个文档id内容
http://localhost:9200/索引名/_doc/文档id
例如：http://localhost:9200/liuqinhua/_doc/1001
get请求查询某一个索引下所有的文档
http://localhost:9200/索引名/_search
例如：
http://localhost:9200/liuqinhua/_search
put请求根据索引下的主键id全量修改更新某一条文档数据
格式：http://localhost:9200/索引名/_doc/数据主键id
eg:http://localhost:9200/liuqinhua/_doc/1001
put全量会把该主键id的文档数据变成这一次传入的
再更新一下：
post请求局部更新某索引下某主键文档id数据
http://localhost:9200/索引名/_update/文档主键id
eg:http://localhost:9200/liuqinhua/_update/1001
delete请求删除索引下某主键的文档
格式http://localhost:9200/索引名/_doc/文档主键id
条件查询 url拼接查询条件
格式：http://localhost:9200/liuqinhua/_search?q=文档下一级key :文档下一级value
二级的key-value是搜不出来的
查询条件放requestbody进行查询放入query-match里面
放requestbody全量查询索引下文档
分页查询
get请求http://localhost:9200/索引名/_search加reqbody里面的多条件查询和范围查询 reqbody内容
{ &#34;query&#34;:{ &#34;bool&#34;:{ &#34;should&#34;:[// must相当于mysql的and,should相当于or { &#34;match&#34;:{ &#34;uname&#34; :&#34;forbidden&#34; //&#34;gender&#34;:26 } }, { &#34;match&#34;:{ //&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/17df078db04916317d8d154df58c0d7e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-29T22:12:59+08:00" />
<meta property="article:modified_time" content="2023-01-29T22:12:59+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ES（elasticSearch学习笔记）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="es_0"></a>什么是es</h3> 
<p>es是面向文档型的数据库，一条数据在es数据库就是一个文档，和关系型数据库做一个类比：<br> 1：es的索引类比关系型数据库的数据库，<br> 2：es的type类比数据表（<strong>7.0版本以上删除了type这个概念</strong>），<br> 3：es的索引下的文档document类比关系型数据库的行，新增时可以指定文档主键id,不指定会自动生成<br> 4：es的文档中的字段类比关系关系型数据库的列。</p> 
<p>现实生产中一般一个索引类似张表，但是一个索引下的字段还可以是一个对象,可以嵌套。<br> match每一次全文搜索分词是针对某一个字段的，可以是嵌套搜索，一次全文搜索不是针对整个索引的全部字段，想要同时全文搜多个字段可以一次请求中match多个字段</p> 
<p>put请求新建索引，post/put请求新增数据，新增的数据就是一个文档，<strong>新增会有一个文档id就是索引下一个数据的主键</strong></p> 
<p><strong>涉及的操作索引的增删改查和文档的增删改查</strong></p> 
<h3><a id="_15"></a>什么是倒排索引</h3> 
<p><img src="https://images2.imgbox.com/d1/6f/KI0Dk33U_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="es_19"></a>es基本入门操作</h3> 
<p><strong>1.安装访问</strong><br> 在本地es执行目录：/Users/liuqinhua/Desktop/错误/elasticsearch-7.6.2/bin<br> 执行可执行文件：./elasticsearch<br> 访问<br> <img src="https://images2.imgbox.com/7f/b6/PKQNWBVF_o.png" alt="在这里插入图片描述"><br> 2.创建索引<strong>put请求</strong>http://localhost:9200/liuqinhua（liuqinhua是索引名）<br> <img src="https://images2.imgbox.com/dc/7e/dfQx0wQm_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/bf/f0/xIh8VDd3_o.png" alt="在这里插入图片描述"></p> 
<p>3**.get请求查看索引信息**：http://localhost:9200/索引名<br> 例如：http://localhost:9200/liuqinhua<br> <img src="https://images2.imgbox.com/42/e3/v7Xb2svE_o.png" alt="在这里插入图片描述"></p> 
<p><strong>4.get请求查看所有的索引</strong>:http://localhost:9200/_cat/indices?v<br> 这时候他是<strong>强制返回的内容是text格式的，所以会展示成表格的格式</strong><br> <img src="https://images2.imgbox.com/cd/9b/6qbQyx8M_o.png" alt="在这里插入图片描述"><br> 5.<strong>delete请求删除索引</strong>wudonghui：http://localhost:9200/索引名<br> 例如：http://localhost:9200/wudonghui<br> <img src="https://images2.imgbox.com/b9/55/2VygRLB6_o.png" alt="在这里插入图片描述"></p> 
<p>6.post请求给索引新增文档数据http://localhost:9200/索引名字/_doc<br> eg：http://localhost:9200/liuqinhua/_doc<br> 这种会返回文档id<br> 或者post或者put请求：http://localhost:9200/liuqinhua/_doc/自定义文档id</p> 
<p><img src="https://images2.imgbox.com/04/e8/OpZf6oqH_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/f3/64/YNksGdXQ_o.png" alt="在这里插入图片描述"></p> 
<p>7.get请求查询索引的数据<br> 查询某一个文档id内容<br> http://localhost:9200/索引名/_doc/文档id<br> 例如：http://localhost:9200/liuqinhua/_doc/1001<br> <img src="https://images2.imgbox.com/2f/fa/xfVApM5H_o.png" alt="在这里插入图片描述"></p> 
<p><strong>get请求查询某一个索引下所有的文档</strong><br> http://localhost:9200/索引名/_search<br> 例如：<br> http://localhost:9200/liuqinhua/_search</p> 
<p><img src="https://images2.imgbox.com/bd/b2/ChfuJvkG_o.png" alt="在这里插入图片描述"></p> 
<p><strong>put请求根据索引下的主键id全量修改更新某一条文档数据</strong></p> 
<p>格式：http://localhost:9200/索引名/_doc/数据主键id<br> eg:http://localhost:9200/liuqinhua/_doc/1001</p> 
<p><img src="https://images2.imgbox.com/13/07/ZU5rJa0e_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/a5/d7/0ipjAowi_o.png" alt="在这里插入图片描述"><br> put全量会把该主键id的文档数据变成这一次传入的<br> <img src="https://images2.imgbox.com/9d/ff/L2AuQUWE_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/07/02/Dudo8yuZ_o.png" alt="在这里插入图片描述"><br> 再更新一下：<br> <img src="https://images2.imgbox.com/2b/0e/Wdaz8MpZ_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/b9/7b/glLJsvvG_o.png" alt="在这里插入图片描述"></p> 
<p><strong>post请求局部更新</strong>某索引下某主键文档id数据<br> http://localhost:9200/索引名/_update/文档主键id<br> eg:http://localhost:9200/liuqinhua/_update/1001<br> <img src="https://images2.imgbox.com/f9/dc/vAJrnoWg_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/58/74/sFTYrUh5_o.png" alt="在这里插入图片描述"></p> 
<p>delete请求删除索引下某主键的文档<br> 格式http://localhost:9200/索引名/_doc/文档主键id<br> <img src="https://images2.imgbox.com/e6/99/POmDsBKX_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_93"></a>条件查询</h3> 
<p>url拼接查询条件<br> 格式：http://localhost:9200/liuqinhua/_search?q=文档下一级key :文档下一级value<br> 二级的key-value是搜不出来的</p> 
<p><img src="https://images2.imgbox.com/29/92/jhf5wNct_o.png" alt="在这里插入图片描述"></p> 
<p>查询条件放requestbody进行查询放入query-match里面<br> <img src="https://images2.imgbox.com/ee/e1/fwV978pi_o.png" alt="在这里插入图片描述"><br> 放requestbody全量查询索引下文档<br> <img src="https://images2.imgbox.com/97/eb/tbz7TgYA_o.png" alt="在这里插入图片描述"><br> 分页查询<br> <img src="https://images2.imgbox.com/f1/4c/oy46JDZP_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="gethttplocalhost9200_searchreqbody_107"></a>get请求http://localhost:9200/索引名/_search加reqbody里面的多条件查询和范围查询</h3> 
<p>reqbody内容</p> 
<pre><code class="prism language-java"><span class="token punctuation">{<!-- --></span>
    <span class="token string">"query"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
        <span class="token string">"bool"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
            <span class="token string">"should"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token comment">// must相当于mysql的and,should相当于or</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"match"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
                     <span class="token string">"uname"</span> <span class="token operator">:</span><span class="token string">"forbidden"</span>
                      <span class="token comment">//"gender":26</span>
                  <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"match"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
                     <span class="token comment">//"uname" :"forbidden"</span>
                      <span class="token string">"gender"</span><span class="token operator">:</span><span class="token number">26</span>
                  <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">"filter"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span><span class="token comment">//过滤</span>
                <span class="token string">"range"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span><span class="token comment">//范围查询</span>
                    <span class="token string">"gender"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
                        <span class="token string">"gt"</span><span class="token operator">:</span><span class="token number">26</span><span class="token comment">//gt表示大于，gender大于26岁的</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>查出结果</p> 
<pre><code class="prism language-java"><span class="token punctuation">{<!-- --></span>
    <span class="token string">"took"</span><span class="token operator">:</span> <span class="token number">23</span><span class="token punctuation">,</span>
    <span class="token string">"timed_out"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token string">"_shards"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"total"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token string">"successful"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token string">"skipped"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token string">"failed"</span><span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">"hits"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"total"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"value"</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
            <span class="token string">"relation"</span><span class="token operator">:</span> <span class="token string">"eq"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">"max_score"</span><span class="token operator">:</span> <span class="token number">1.4769237</span><span class="token punctuation">,</span>
        <span class="token string">"hits"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token string">"_index"</span><span class="token operator">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span>
                <span class="token string">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span>
                <span class="token string">"_id"</span><span class="token operator">:</span> <span class="token string">"-rD414IBzFC3z-tJgVq3"</span><span class="token punctuation">,</span>
                <span class="token string">"_score"</span><span class="token operator">:</span> <span class="token number">1.4769237</span><span class="token punctuation">,</span>
                <span class="token string">"_source"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"schoolId"</span><span class="token operator">:</span> <span class="token string">"2000014495"</span><span class="token punctuation">,</span>
                    <span class="token string">"teacherUid"</span><span class="token operator">:</span> <span class="token string">"100000094198"</span><span class="token punctuation">,</span>
                    <span class="token string">"uname"</span><span class="token operator">:</span> <span class="token string">"forbidden zhang"</span><span class="token punctuation">,</span>
                    <span class="token string">"unamePing"</span><span class="token operator">:</span> <span class="token string">"forbiddenzhang"</span><span class="token punctuation">,</span>
                    <span class="token string">"gender"</span><span class="token operator">:</span> <span class="token number">28</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token string">"_index"</span><span class="token operator">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span>
                <span class="token string">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span>
                <span class="token string">"_id"</span><span class="token operator">:</span> <span class="token string">"-7D414IBzFC3z-tJ2Fqf"</span><span class="token punctuation">,</span>
                <span class="token string">"_score"</span><span class="token operator">:</span> <span class="token number">1.4769237</span><span class="token punctuation">,</span>
                <span class="token string">"_source"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"schoolId"</span><span class="token operator">:</span> <span class="token string">"2000014485"</span><span class="token punctuation">,</span>
                    <span class="token string">"teacherUid"</span><span class="token operator">:</span> <span class="token string">"100000094198"</span><span class="token punctuation">,</span>
                    <span class="token string">"uname"</span><span class="token operator">:</span> <span class="token string">"forbidden city"</span><span class="token punctuation">,</span>
                    <span class="token string">"unamePing"</span><span class="token operator">:</span> <span class="token string">"forbiddencity"</span><span class="token punctuation">,</span>
                    <span class="token string">"gender"</span><span class="token operator">:</span> <span class="token number">30</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token string">"_index"</span><span class="token operator">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span>
                <span class="token string">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span>
                <span class="token string">"_id"</span><span class="token operator">:</span> <span class="token string">"_LD714IBzFC3z-tJBFra"</span><span class="token punctuation">,</span>
                <span class="token string">"_score"</span><span class="token operator">:</span> <span class="token number">1.4769237</span><span class="token punctuation">,</span>
                <span class="token string">"_source"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"schoolId"</span><span class="token operator">:</span> <span class="token string">"2000014485"</span><span class="token punctuation">,</span>
                    <span class="token string">"teacherUid"</span><span class="token operator">:</span> <span class="token string">"100000094198"</span><span class="token punctuation">,</span>
                    <span class="token string">"uname"</span><span class="token operator">:</span> <span class="token string">"forbidden city"</span><span class="token punctuation">,</span>
                    <span class="token string">"unamePing"</span><span class="token operator">:</span> <span class="token string">"forbiddencity"</span><span class="token punctuation">,</span>
                    <span class="token string">"gender"</span><span class="token operator">:</span> <span class="token number">30</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token string">"_index"</span><span class="token operator">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span>
                <span class="token string">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span>
                <span class="token string">"_id"</span><span class="token operator">:</span> <span class="token string">"_bAC2IIBzFC3z-tJB1qB"</span><span class="token punctuation">,</span>
                <span class="token string">"_score"</span><span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
                <span class="token string">"_source"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"schoolId"</span><span class="token operator">:</span> <span class="token string">"2000014485"</span><span class="token punctuation">,</span>
                    <span class="token string">"teacherUid"</span><span class="token operator">:</span> <span class="token string">"100000094199"</span><span class="token punctuation">,</span>
                    <span class="token string">"uname"</span><span class="token operator">:</span> <span class="token string">"sijiali"</span><span class="token punctuation">,</span>
                    <span class="token string">"unamePing"</span><span class="token operator">:</span> <span class="token string">"sijiali"</span><span class="token punctuation">,</span>
                    <span class="token string">"gender"</span><span class="token operator">:</span> <span class="token number">30</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_221"></a>全文检索和完全匹配</h3> 
<p>url同上,<strong>全文检索的核心就是分词后用了倒排，</strong>，中文一个字会分做一个词，英文字母是以空格结束当做是一个单词做分词,连续没有空格的n个数字不会分成多个词</p> 
<p>reqbody内容：”forbidden 小“把这两个字分词把还有forbidden 和小都查了出来</p> 
<pre><code class="prism language-java"><span class="token punctuation">{<!-- --></span>
    <span class="token string">"query"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
        <span class="token string">"bool"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
            <span class="token string">"must"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token comment">// must相当于mysql的and,should相当于or</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"match"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
                     <span class="token string">"uname"</span> <span class="token operator">:</span><span class="token string">"sijiali 华"</span>
                      <span class="token comment">//"gender":26</span>
                  <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"match"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
                     <span class="token string">"unamePing"</span> <span class="token operator">:</span><span class="token string">"sijiali liu"</span>
                      <span class="token comment">//"gender":26</span>
                  <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
        
            <span class="token punctuation">]</span>
            
        <span class="token punctuation">}</span>
        
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token punctuation">{<!-- --></span>
    <span class="token string">"took"</span><span class="token operator">:</span> <span class="token number">146</span><span class="token punctuation">,</span>
    <span class="token string">"timed_out"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token string">"_shards"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"total"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token string">"successful"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token string">"skipped"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token string">"failed"</span><span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">"hits"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"total"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"value"</span><span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">,</span>
            <span class="token string">"relation"</span><span class="token operator">:</span> <span class="token string">"eq"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">"max_score"</span><span class="token operator">:</span> <span class="token number">4.4716845</span><span class="token punctuation">,</span>
        <span class="token string">"hits"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token string">"_index"</span><span class="token operator">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span>
                <span class="token string">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span>
                <span class="token string">"_id"</span><span class="token operator">:</span> <span class="token string">"A7BM2IIBzFC3z-tJ01ts"</span><span class="token punctuation">,</span>
                <span class="token string">"_score"</span><span class="token operator">:</span> <span class="token number">4.4716845</span><span class="token punctuation">,</span>
                <span class="token string">"_source"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"schoolId"</span><span class="token operator">:</span> <span class="token string">"2000014485"</span><span class="token punctuation">,</span>
                    <span class="token string">"teacherUid"</span><span class="token operator">:</span> <span class="token string">"100000094119"</span><span class="token punctuation">,</span>
                    <span class="token string">"uname"</span><span class="token operator">:</span> <span class="token string">"小华"</span><span class="token punctuation">,</span>
                    <span class="token string">"unamePing"</span><span class="token operator">:</span> <span class="token string">"sijiali liu"</span><span class="token punctuation">,</span>
                    <span class="token string">"gender"</span><span class="token operator">:</span> <span class="token number">31</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token string">"_index"</span><span class="token operator">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span>
                <span class="token string">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span>
                <span class="token string">"_id"</span><span class="token operator">:</span> <span class="token string">"ArBI2IIBzFC3z-tJuVt_"</span><span class="token punctuation">,</span>
                <span class="token string">"_score"</span><span class="token operator">:</span> <span class="token number">3.5823827</span><span class="token punctuation">,</span>
                <span class="token string">"_source"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"schoolId"</span><span class="token operator">:</span> <span class="token string">"2000014485"</span><span class="token punctuation">,</span>
                    <span class="token string">"teacherUid"</span><span class="token operator">:</span> <span class="token string">"100000094119"</span><span class="token punctuation">,</span>
                    <span class="token string">"uname"</span><span class="token operator">:</span> <span class="token string">"a sijiali 100"</span><span class="token punctuation">,</span>
                    <span class="token string">"unamePing"</span><span class="token operator">:</span> <span class="token string">"sijiali liu"</span><span class="token punctuation">,</span>
                    <span class="token string">"gender"</span><span class="token operator">:</span> <span class="token number">31</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token string">"_index"</span><span class="token operator">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span>
                <span class="token string">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span>
                <span class="token string">"_id"</span><span class="token operator">:</span> <span class="token string">"BbBP2IIBzFC3z-tJA1sN"</span><span class="token punctuation">,</span>
                <span class="token string">"_score"</span><span class="token operator">:</span> <span class="token number">3.3120766</span><span class="token punctuation">,</span>
                <span class="token string">"_source"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"schoolId"</span><span class="token operator">:</span> <span class="token string">"2000014485"</span><span class="token punctuation">,</span>
                    <span class="token string">"teacherUid"</span><span class="token operator">:</span> <span class="token string">"100000094119"</span><span class="token punctuation">,</span>
                    <span class="token string">"uname"</span><span class="token operator">:</span> <span class="token string">"小华"</span><span class="token punctuation">,</span>
                    <span class="token string">"unamePing"</span><span class="token operator">:</span> <span class="token string">"xiao liu hua"</span><span class="token punctuation">,</span>
                    <span class="token string">"gender"</span><span class="token operator">:</span> <span class="token number">31</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token string">"_index"</span><span class="token operator">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span>
                <span class="token string">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span>
                <span class="token string">"_id"</span><span class="token operator">:</span> <span class="token string">"BLBM2IIBzFC3z-tJ41s_"</span><span class="token punctuation">,</span>
                <span class="token string">"_score"</span><span class="token operator">:</span> <span class="token number">3.2610822</span><span class="token punctuation">,</span>
                <span class="token string">"_source"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"schoolId"</span><span class="token operator">:</span> <span class="token string">"2000014485"</span><span class="token punctuation">,</span>
                    <span class="token string">"teacherUid"</span><span class="token operator">:</span> <span class="token string">"100000094119"</span><span class="token punctuation">,</span>
                    <span class="token string">"uname"</span><span class="token operator">:</span> <span class="token string">"小华"</span><span class="token punctuation">,</span>
                    <span class="token string">"unamePing"</span><span class="token operator">:</span> <span class="token string">"sijiali "</span><span class="token punctuation">,</span>
                    <span class="token string">"gender"</span><span class="token operator">:</span> <span class="token number">31</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token string">"_index"</span><span class="token operator">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span>
                <span class="token string">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span>
                <span class="token string">"_id"</span><span class="token operator">:</span> <span class="token string">"_bAC2IIBzFC3z-tJB1qB"</span><span class="token punctuation">,</span>
                <span class="token string">"_score"</span><span class="token operator">:</span> <span class="token number">2.917797</span><span class="token punctuation">,</span>
                <span class="token string">"_source"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"schoolId"</span><span class="token operator">:</span> <span class="token string">"2000014485"</span><span class="token punctuation">,</span>
                    <span class="token string">"teacherUid"</span><span class="token operator">:</span> <span class="token string">"100000094199"</span><span class="token punctuation">,</span>
                    <span class="token string">"uname"</span><span class="token operator">:</span> <span class="token string">"sijiali"</span><span class="token punctuation">,</span>
                    <span class="token string">"unamePing"</span><span class="token operator">:</span> <span class="token string">"sijiali"</span><span class="token punctuation">,</span>
                    <span class="token string">"gender"</span><span class="token operator">:</span> <span class="token number">30</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token string">"_index"</span><span class="token operator">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span>
                <span class="token string">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span>
                <span class="token string">"_id"</span><span class="token operator">:</span> <span class="token string">"_rAv2IIBzFC3z-tJrFrx"</span><span class="token punctuation">,</span>
                <span class="token string">"_score"</span><span class="token operator">:</span> <span class="token number">2.3717804</span><span class="token punctuation">,</span>
                <span class="token string">"_source"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"schoolId"</span><span class="token operator">:</span> <span class="token string">"2000014485"</span><span class="token punctuation">,</span>
                    <span class="token string">"teacherUid"</span><span class="token operator">:</span> <span class="token string">"100000094199"</span><span class="token punctuation">,</span>
                    <span class="token string">"uname"</span><span class="token operator">:</span> <span class="token string">"a sijiali b"</span><span class="token punctuation">,</span>
                    <span class="token string">"unamePing"</span><span class="token operator">:</span> <span class="token string">"sijiali"</span><span class="token punctuation">,</span>
                    <span class="token string">"gender"</span><span class="token operator">:</span> <span class="token number">30</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token string">"_index"</span><span class="token operator">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span>
                <span class="token string">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span>
                <span class="token string">"_id"</span><span class="token operator">:</span> <span class="token string">"_7A12IIBzFC3z-tJBlrv"</span><span class="token punctuation">,</span>
                <span class="token string">"_score"</span><span class="token operator">:</span> <span class="token number">2.3717804</span><span class="token punctuation">,</span>
                <span class="token string">"_source"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"schoolId"</span><span class="token operator">:</span> <span class="token string">"2000014485"</span><span class="token punctuation">,</span>
                    <span class="token string">"teacherUid"</span><span class="token operator">:</span> <span class="token string">"100000094119"</span><span class="token punctuation">,</span>
                    <span class="token string">"uname"</span><span class="token operator">:</span> <span class="token string">"a sijiali 9"</span><span class="token punctuation">,</span>
                    <span class="token string">"unamePing"</span><span class="token operator">:</span> <span class="token string">"sijiali"</span><span class="token punctuation">,</span>
                    <span class="token string">"gender"</span><span class="token operator">:</span> <span class="token number">30</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token string">"_index"</span><span class="token operator">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span>
                <span class="token string">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span>
                <span class="token string">"_id"</span><span class="token operator">:</span> <span class="token string">"ALA32IIBzFC3z-tJa1vV"</span><span class="token punctuation">,</span>
                <span class="token string">"_score"</span><span class="token operator">:</span> <span class="token number">2.3717804</span><span class="token punctuation">,</span>
                <span class="token string">"_source"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"schoolId"</span><span class="token operator">:</span> <span class="token string">"2000014485"</span><span class="token punctuation">,</span>
                    <span class="token string">"teacherUid"</span><span class="token operator">:</span> <span class="token string">"100000094119"</span><span class="token punctuation">,</span>
                    <span class="token string">"uname"</span><span class="token operator">:</span> <span class="token string">"a sijiali 99"</span><span class="token punctuation">,</span>
                    <span class="token string">"unamePing"</span><span class="token operator">:</span> <span class="token string">"sijiali"</span><span class="token punctuation">,</span>
                    <span class="token string">"gender"</span><span class="token operator">:</span> <span class="token number">30</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token string">"_index"</span><span class="token operator">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span>
                <span class="token string">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span>
                <span class="token string">"_id"</span><span class="token operator">:</span> <span class="token string">"AbBE2IIBzFC3z-tJEFt2"</span><span class="token punctuation">,</span>
                <span class="token string">"_score"</span><span class="token operator">:</span> <span class="token number">2.3717804</span><span class="token punctuation">,</span>
                <span class="token string">"_source"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"schoolId"</span><span class="token operator">:</span> <span class="token string">"2000014485"</span><span class="token punctuation">,</span>
                    <span class="token string">"teacherUid"</span><span class="token operator">:</span> <span class="token string">"100000094119"</span><span class="token punctuation">,</span>
                    <span class="token string">"uname"</span><span class="token operator">:</span> <span class="token string">"a sijiali 100"</span><span class="token punctuation">,</span>
                    <span class="token string">"unamePing"</span><span class="token operator">:</span> <span class="token string">"sijiali"</span><span class="token punctuation">,</span>
                    <span class="token string">"gender"</span><span class="token operator">:</span> <span class="token number">31</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>完全匹配：把match改为match_phrase，相当于mysql的like “%str%”</strong></p> 
<pre><code class="prism language-java"><span class="token punctuation">{<!-- --></span>
    <span class="token string">"query"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
        <span class="token string">"bool"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
            <span class="token string">"must"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token comment">// must相当于mysql的and,should相当于or</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"match_phrase"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
                     <span class="token string">"uname"</span> <span class="token operator">:</span><span class="token string">"sijiali"</span>
                      <span class="token comment">//"gender":26</span>
                  <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
        
            <span class="token punctuation">]</span>
            
        <span class="token punctuation">}</span>
        
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>返回</p> 
<pre><code class="prism language-java"><span class="token punctuation">{<!-- --></span>
    <span class="token string">"took"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token string">"timed_out"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token string">"_shards"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"total"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token string">"successful"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token string">"skipped"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token string">"failed"</span><span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">"hits"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"total"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"value"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
            <span class="token string">"relation"</span><span class="token operator">:</span> <span class="token string">"eq"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">"max_score"</span><span class="token operator">:</span> <span class="token number">2.581265</span><span class="token punctuation">,</span>
        <span class="token string">"hits"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token string">"_index"</span><span class="token operator">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span>
                <span class="token string">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span>
                <span class="token string">"_id"</span><span class="token operator">:</span> <span class="token string">"_bAC2IIBzFC3z-tJB1qB"</span><span class="token punctuation">,</span>
                <span class="token string">"_score"</span><span class="token operator">:</span> <span class="token number">2.581265</span><span class="token punctuation">,</span>
                <span class="token string">"_source"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"schoolId"</span><span class="token operator">:</span> <span class="token string">"2000014485"</span><span class="token punctuation">,</span>
                    <span class="token string">"teacherUid"</span><span class="token operator">:</span> <span class="token string">"100000094199"</span><span class="token punctuation">,</span>
                    <span class="token string">"uname"</span><span class="token operator">:</span> <span class="token string">"sijiali"</span><span class="token punctuation">,</span>
                    <span class="token string">"unamePing"</span><span class="token operator">:</span> <span class="token string">"sijiali"</span><span class="token punctuation">,</span>
                    <span class="token string">"gender"</span><span class="token operator">:</span> <span class="token number">30</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token string">"_index"</span><span class="token operator">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span>
                <span class="token string">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span>
                <span class="token string">"_id"</span><span class="token operator">:</span> <span class="token string">"_rAv2IIBzFC3z-tJrFrx"</span><span class="token punctuation">,</span>
                <span class="token string">"_score"</span><span class="token operator">:</span> <span class="token number">1.7744548</span><span class="token punctuation">,</span>
                <span class="token string">"_source"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"schoolId"</span><span class="token operator">:</span> <span class="token string">"2000014485"</span><span class="token punctuation">,</span>
                    <span class="token string">"teacherUid"</span><span class="token operator">:</span> <span class="token string">"100000094199"</span><span class="token punctuation">,</span>
                    <span class="token string">"uname"</span><span class="token operator">:</span> <span class="token string">"a sijiali b"</span><span class="token punctuation">,</span>
                    <span class="token string">"unamePing"</span><span class="token operator">:</span> <span class="token string">"sijiali"</span><span class="token punctuation">,</span>
                    <span class="token string">"gender"</span><span class="token operator">:</span> <span class="token number">30</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>分词中文和数字会分作两个词，字母和数字不会分做两个词</p> 
<p>中文和数字</p> 
<pre><code class="prism language-java"><span class="token punctuation">{<!-- --></span>
    <span class="token string">"query"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
        <span class="token string">"bool"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
            <span class="token string">"must"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token comment">// must相当于mysql的and,should相当于or</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"match"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
                     <span class="token string">"uname"</span> <span class="token operator">:</span><span class="token string">"小9"</span>
                      <span class="token comment">//"gender":26</span>
                  <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
        
            <span class="token punctuation">]</span>
            
        <span class="token punctuation">}</span>
        
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>




返回<span class="token punctuation">{<!-- --></span>
    <span class="token string">"took"</span><span class="token operator">:</span> <span class="token number">925</span><span class="token punctuation">,</span>
    <span class="token string">"timed_out"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token string">"_shards"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"total"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token string">"successful"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token string">"skipped"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token string">"failed"</span><span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">"hits"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"total"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"value"</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
            <span class="token string">"relation"</span><span class="token operator">:</span> <span class="token string">"eq"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">"max_score"</span><span class="token operator">:</span> <span class="token number">2.2984395</span><span class="token punctuation">,</span>
        <span class="token string">"hits"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token string">"_index"</span><span class="token operator">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span>
                <span class="token string">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span>
                <span class="token string">"_id"</span><span class="token operator">:</span> <span class="token string">"_7A12IIBzFC3z-tJBlrv"</span><span class="token punctuation">,</span>
                <span class="token string">"_score"</span><span class="token operator">:</span> <span class="token number">2.2984395</span><span class="token punctuation">,</span>
                <span class="token string">"_source"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"schoolId"</span><span class="token operator">:</span> <span class="token string">"2000014485"</span><span class="token punctuation">,</span>
                    <span class="token string">"teacherUid"</span><span class="token operator">:</span> <span class="token string">"100000094119"</span><span class="token punctuation">,</span>
                    <span class="token string">"uname"</span><span class="token operator">:</span> <span class="token string">"a sijiali 9"</span><span class="token punctuation">,</span>
                    <span class="token string">"unamePing"</span><span class="token operator">:</span> <span class="token string">"sijiali"</span><span class="token punctuation">,</span>
                    <span class="token string">"gender"</span><span class="token operator">:</span> <span class="token number">30</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token string">"_index"</span><span class="token operator">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span>
                <span class="token string">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span>
                <span class="token string">"_id"</span><span class="token operator">:</span> <span class="token string">"8bDn14IBzFC3z-tJ1lov"</span><span class="token punctuation">,</span>
                <span class="token string">"_score"</span><span class="token operator">:</span> <span class="token number">1.5314121</span><span class="token punctuation">,</span>
                <span class="token string">"_source"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"schoolId"</span><span class="token operator">:</span> <span class="token string">"2000014494"</span><span class="token punctuation">,</span>
                    <span class="token string">"teacherUid"</span><span class="token operator">:</span> <span class="token string">"100000094187"</span><span class="token punctuation">,</span>
                    <span class="token string">"uname"</span><span class="token operator">:</span> <span class="token string">"刘小君"</span><span class="token punctuation">,</span>
                    <span class="token string">"unamePing"</span><span class="token operator">:</span> <span class="token string">"lingweijun01"</span><span class="token punctuation">,</span>
                    <span class="token string">"gender"</span><span class="token operator">:</span> <span class="token number">23</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token string">"_index"</span><span class="token operator">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span>
                <span class="token string">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span>
                <span class="token string">"_id"</span><span class="token operator">:</span> <span class="token string">"8LDm14IBzFC3z-tJDVor"</span><span class="token punctuation">,</span>
                <span class="token string">"_score"</span><span class="token operator">:</span> <span class="token number">1.5314121</span><span class="token punctuation">,</span>
                <span class="token string">"_source"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"schoolId"</span><span class="token operator">:</span> <span class="token string">"2000014494"</span><span class="token punctuation">,</span>
                    <span class="token string">"teacherUid"</span><span class="token operator">:</span> <span class="token string">"100000094186"</span><span class="token punctuation">,</span>
                    <span class="token string">"uname"</span><span class="token operator">:</span> <span class="token string">"凌小君"</span><span class="token punctuation">,</span>
                    <span class="token string">"unamePing"</span><span class="token operator">:</span> <span class="token string">"lingweijun01"</span><span class="token punctuation">,</span>
                    <span class="token string">"gender"</span><span class="token operator">:</span> <span class="token number">23</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token string">"_index"</span><span class="token operator">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span>
                <span class="token string">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span>
                <span class="token string">"_id"</span><span class="token operator">:</span> <span class="token string">"77Dl14IBzFC3z-tJ2FrK"</span><span class="token punctuation">,</span>
                <span class="token string">"_score"</span><span class="token operator">:</span> <span class="token number">1.5314121</span><span class="token punctuation">,</span>
                <span class="token string">"_source"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"schoolId"</span><span class="token operator">:</span> <span class="token string">"2000014494"</span><span class="token punctuation">,</span>
                    <span class="token string">"teacherUid"</span><span class="token operator">:</span> <span class="token string">"100000094185"</span><span class="token punctuation">,</span>
                    <span class="token string">"uname"</span><span class="token operator">:</span> <span class="token string">"凌小军"</span><span class="token punctuation">,</span>
                    <span class="token string">"unamePing"</span><span class="token operator">:</span> <span class="token string">"lingweijun01"</span><span class="token punctuation">,</span>
                    <span class="token string">"gender"</span><span class="token operator">:</span> <span class="token number">23</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>英文和数字</p> 
<pre><code class="prism language-java"><span class="token punctuation">{<!-- --></span>
    <span class="token string">"query"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
        <span class="token string">"bool"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
            <span class="token string">"must"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token comment">// must相当于mysql的and,should相当于or</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"match"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
                     <span class="token string">"uname"</span> <span class="token operator">:</span><span class="token string">"a99"</span>
                      <span class="token comment">//"gender":26</span>
                  <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
        
            <span class="token punctuation">]</span>
            
        <span class="token punctuation">}</span>
        
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

返回
<span class="token punctuation">{<!-- --></span>
    <span class="token string">"took"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token string">"timed_out"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token string">"_shards"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"total"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token string">"successful"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token string">"skipped"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token string">"failed"</span><span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">"hits"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"total"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"value"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token string">"relation"</span><span class="token operator">:</span> <span class="token string">"eq"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">"max_score"</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
        <span class="token string">"hits"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_608"></a>聚合查询</h3> 
<p>聚合查询相当于mysql的group by</p> 
<pre><code class="prism language-java"><span class="token punctuation">{<!-- --></span>
    <span class="token string">"aggs"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span><span class="token comment">//定义聚合</span>
        <span class="token string">"fenzu"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span><span class="token comment">//年龄进行分组，给聚合起个名字</span>
            <span class="token string">"terms"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span><span class="token comment">//聚合的类型是 term</span>
                <span class="token string">"field"</span><span class="token operator">:</span><span class="token string">"gender"</span><span class="token comment">//参与聚合的字段</span>
                <span class="token string">"size"</span><span class="token operator">:</span> <span class="token number">10</span> <span class="token comment">// 希望获取的聚合结果数量</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">"size"</span><span class="token operator">:</span><span class="token number">0</span><span class="token comment">//表示不返回文档数组列表0条,设置size为0，结果中不包含文档，只包含聚合结果</span>
<span class="token punctuation">}</span>



返回

<span class="token punctuation">{<!-- --></span>
    <span class="token string">"took"</span><span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span>
    <span class="token string">"timed_out"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token string">"_shards"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"total"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token string">"successful"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token string">"skipped"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token string">"failed"</span><span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">"hits"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"total"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"value"</span><span class="token operator">:</span> <span class="token number">21</span><span class="token punctuation">,</span>
            <span class="token string">"relation"</span><span class="token operator">:</span> <span class="token string">"eq"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">"max_score"</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
        <span class="token string">"hits"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">"aggregations"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"fenzu"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"doc_count_error_upper_bound"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token string">"sum_other_doc_count"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token string">"buckets"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"key"</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
                    <span class="token string">"doc_count"</span><span class="token operator">:</span> <span class="token number">6</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"key"</span><span class="token operator">:</span> <span class="token number">23</span><span class="token punctuation">,</span>
                    <span class="token string">"doc_count"</span><span class="token operator">:</span> <span class="token number">5</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"key"</span><span class="token operator">:</span> <span class="token number">26</span><span class="token punctuation">,</span>
                    <span class="token string">"doc_count"</span><span class="token operator">:</span> <span class="token number">4</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"key"</span><span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span>
                    <span class="token string">"doc_count"</span><span class="token operator">:</span> <span class="token number">2</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"key"</span><span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">,</span>
                    <span class="token string">"doc_count"</span><span class="token operator">:</span> <span class="token number">1</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"key"</span><span class="token operator">:</span> <span class="token number">28</span><span class="token punctuation">,</span>
                    <span class="token string">"doc_count"</span><span class="token operator">:</span> <span class="token number">1</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"key"</span><span class="token operator">:</span> <span class="token number">31</span><span class="token punctuation">,</span>
                    <span class="token string">"doc_count"</span><span class="token operator">:</span> <span class="token number">1</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_689"></a>映射关系</h3> 
<p>映射类似关系型数据库中的schema，描述了文档中有哪些字段和字段的类型，如string，data，int等。而 类型 是一组具有相关性的映射组成，然后使用"properties"来表示该类型中可能包含的字段属性。<strong>如果不设置，创建文档的时候会根据每个字段值自动匹配映射关系</strong></p> 
<p>可以通过mapping字段修改索引的映射关系</p> 
<p>例如</p> 
<pre><code class="prism language-java"> 
put    http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>ip<span class="token operator">:</span><span class="token number">9200</span><span class="token operator">/</span>index_name
 
<span class="token punctuation">{<!-- --></span>
    <span class="token string">"mappings"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"properties"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"realname"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
                <span class="token string">"index"</span><span class="token operator">:</span> <span class="token boolean">true</span>
                        <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">"username"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"keyword"</span><span class="token punctuation">,</span>
                <span class="token string">"index"</span><span class="token operator">:</span> <span class="token boolean">false</span>
                        <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
 
text<span class="token operator">:</span> 大的长文本，需要做分词，做倒排索引
 
keyword： 不会被分词，也不会被做倒排索引。做精确匹配的搜索（比如订单状态，用的微信号，qq号，手机号）
 
text <span class="token punctuation">,</span> keyword 都是属于string类型。
</code></pre> 
<h3><a id="ES__722"></a>ES 内置分词器</h3> 
<p>standard：默认分词，单词会被拆分，大小会转换为小写。<br> simple：按照非字母分词。大写转为小写。<br> whitespace：按照空格分词。忽略大小写。 s<br> top：去除无意义单词，比如 the / a / an / is …<br> keyword：不做分词。把整个文本作为一个单独的关键词</p> 
<p>索引下字段的子字段类型，这种情况相当于是一个字段是一个对象的json字符串，但是索引的一级字段没下一层级字段，会有一个默认字段keyword</p> 
<pre><code class="prism language-java"><span class="token constant">PUT</span> index_name
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"mappings"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"properties"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"title"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>               # 字段名称
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>        # 字段类型
        <span class="token string">"analyzer"</span><span class="token operator">:</span> <span class="token string">"english"</span><span class="token punctuation">,</span> # 字段分词器
        <span class="token string">"fields"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>            # 多字段域，固定写法
          <span class="token string">"std1"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>             # 子字段名称
            <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>    # 子字段类型
            <span class="token string">"analyzer"</span><span class="token operator">:</span> <span class="token string">"standard"</span>  # 子字段分词器
           <span class="token punctuation">}</span><span class="token punctuation">,</span>
           <span class="token string">"ziziduan"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
                <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>    # 子字段类型
            <span class="token string">"analyzer"</span><span class="token operator">:</span> <span class="token string">"standard"</span>  # 子字段分词器
           <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="esmatch_759"></a>es嵌套字段是一个对象，第一层字段直接match搜不出来</h3> 
<p>content是一个对象，不是一个字符串<br> 索引全部文档内容：<br> <img src="https://images2.imgbox.com/6f/64/zy9vcn5K_o.png" alt="在这里插入图片描述"></p> 
<p>content是一个对象，不是一个字符串，直接match查嵌套字段里面内容查不出来，是一个字符串就可以，：</p> 
<p><img src="https://images2.imgbox.com/23/a6/tEt1oyH9_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/70/de/iBQQihuy_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="term_770"></a>term查询完全匹配</h3> 
<p>进一步优化查询，因为是精准查询，不需要查询进行评分计算，只希望对文档进行包括或排除的计算，所以我们会使用 constant_score 查询以非评分模式来执行 term 查询并以一作为统一评分。推荐如下查询</p> 
<p><a href="https://blog.csdn.net/lzxlfly/article/details/102771175">参考</a></p> 
<pre><code class="prism language-java"><span class="token punctuation">{<!-- --></span>
    <span class="token string">"query"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
        <span class="token string">"bool"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
            <span class="token string">"should"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token comment">// must相当于mysql的and,should相当于or</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"match"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
                     <span class="token string">"uname"</span> <span class="token operator">:</span><span class="token string">"forbidden"</span>
                      <span class="token comment">//"gender":26</span>
                  <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"match"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
                     <span class="token comment">//"uname" :"forbidden"</span>
                      <span class="token string">"gender"</span><span class="token operator">:</span><span class="token number">0</span>
                  <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">"filter"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span><span class="token comment">//过滤</span>
                <span class="token string">"term"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
                    <span class="token string">"gender"</span><span class="token operator">:</span><span class="token number">30</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


返回


<span class="token punctuation">{<!-- --></span>
    <span class="token string">"took"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    <span class="token string">"timed_out"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token string">"_shards"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"total"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token string">"successful"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token string">"skipped"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token string">"failed"</span><span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">"hits"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"total"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"value"</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
            <span class="token string">"relation"</span><span class="token operator">:</span> <span class="token string">"eq"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">"max_score"</span><span class="token operator">:</span> <span class="token number">1.8449266</span><span class="token punctuation">,</span>
        <span class="token string">"hits"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token string">"_index"</span><span class="token operator">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span>
                <span class="token string">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span>
                <span class="token string">"_id"</span><span class="token operator">:</span> <span class="token string">"_LD714IBzFC3z-tJBFra"</span><span class="token punctuation">,</span>
                <span class="token string">"_score"</span><span class="token operator">:</span> <span class="token number">1.8449266</span><span class="token punctuation">,</span>
                <span class="token string">"_source"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"schoolId"</span><span class="token operator">:</span> <span class="token string">"2000014485"</span><span class="token punctuation">,</span>
                    <span class="token string">"teacherUid"</span><span class="token operator">:</span> <span class="token string">"100000094198"</span><span class="token punctuation">,</span>
                    <span class="token string">"uname"</span><span class="token operator">:</span> <span class="token string">"forbidden city"</span><span class="token punctuation">,</span>
                    <span class="token string">"unamePing"</span><span class="token operator">:</span> <span class="token string">"forbiddencity"</span><span class="token punctuation">,</span>
                    <span class="token string">"gender"</span><span class="token operator">:</span> <span class="token number">30</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token string">"_index"</span><span class="token operator">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span>
                <span class="token string">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span>
                <span class="token string">"_id"</span><span class="token operator">:</span> <span class="token string">"-7D414IBzFC3z-tJ2Fqf"</span><span class="token punctuation">,</span>
                <span class="token string">"_score"</span><span class="token operator">:</span> <span class="token number">1.8449266</span><span class="token punctuation">,</span>
                <span class="token string">"_source"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"schoolId"</span><span class="token operator">:</span> <span class="token string">"2000014485"</span><span class="token punctuation">,</span>
                    <span class="token string">"teacherUid"</span><span class="token operator">:</span> <span class="token string">"100000094198"</span><span class="token punctuation">,</span>
                    <span class="token string">"uname"</span><span class="token operator">:</span> <span class="token string">"forbidden city"</span><span class="token punctuation">,</span>
                    <span class="token string">"unamePing"</span><span class="token operator">:</span> <span class="token string">"forbiddencity"</span><span class="token punctuation">,</span>
                    <span class="token string">"gender"</span><span class="token operator">:</span> <span class="token number">30</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token string">"_index"</span><span class="token operator">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span>
                <span class="token string">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span>
                <span class="token string">"_id"</span><span class="token operator">:</span> <span class="token string">"_rAv2IIBzFC3z-tJrFrx"</span><span class="token punctuation">,</span>
                <span class="token string">"_score"</span><span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
                <span class="token string">"_source"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"schoolId"</span><span class="token operator">:</span> <span class="token string">"2000014485"</span><span class="token punctuation">,</span>
                    <span class="token string">"teacherUid"</span><span class="token operator">:</span> <span class="token string">"100000094199"</span><span class="token punctuation">,</span>
                    <span class="token string">"uname"</span><span class="token operator">:</span> <span class="token string">"a sijiali b"</span><span class="token punctuation">,</span>
                    <span class="token string">"unamePing"</span><span class="token operator">:</span> <span class="token string">"sijiali"</span><span class="token punctuation">,</span>
                    <span class="token string">"gender"</span><span class="token operator">:</span> <span class="token number">30</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token string">"_index"</span><span class="token operator">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span>
                <span class="token string">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span>
                <span class="token string">"_id"</span><span class="token operator">:</span> <span class="token string">"_bAC2IIBzFC3z-tJB1qB"</span><span class="token punctuation">,</span>
                <span class="token string">"_score"</span><span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
                <span class="token string">"_source"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"schoolId"</span><span class="token operator">:</span> <span class="token string">"2000014485"</span><span class="token punctuation">,</span>
                    <span class="token string">"teacherUid"</span><span class="token operator">:</span> <span class="token string">"100000094199"</span><span class="token punctuation">,</span>
                    <span class="token string">"uname"</span><span class="token operator">:</span> <span class="token string">"sijiali"</span><span class="token punctuation">,</span>
                    <span class="token string">"unamePing"</span><span class="token operator">:</span> <span class="token string">"sijiali"</span><span class="token punctuation">,</span>
                    <span class="token string">"gender"</span><span class="token operator">:</span> <span class="token number">30</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token string">"_index"</span><span class="token operator">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span>
                <span class="token string">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span>
                <span class="token string">"_id"</span><span class="token operator">:</span> <span class="token string">"_7A12IIBzFC3z-tJBlrv"</span><span class="token punctuation">,</span>
                <span class="token string">"_score"</span><span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
                <span class="token string">"_source"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"schoolId"</span><span class="token operator">:</span> <span class="token string">"2000014485"</span><span class="token punctuation">,</span>
                    <span class="token string">"teacherUid"</span><span class="token operator">:</span> <span class="token string">"100000094119"</span><span class="token punctuation">,</span>
                    <span class="token string">"uname"</span><span class="token operator">:</span> <span class="token string">"a sijiali 9"</span><span class="token punctuation">,</span>
                    <span class="token string">"unamePing"</span><span class="token operator">:</span> <span class="token string">"sijiali"</span><span class="token punctuation">,</span>
                    <span class="token string">"gender"</span><span class="token operator">:</span> <span class="token number">30</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token string">"_index"</span><span class="token operator">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span>
                <span class="token string">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span>
                <span class="token string">"_id"</span><span class="token operator">:</span> <span class="token string">"ALA32IIBzFC3z-tJa1vV"</span><span class="token punctuation">,</span>
                <span class="token string">"_score"</span><span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
                <span class="token string">"_source"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"schoolId"</span><span class="token operator">:</span> <span class="token string">"2000014485"</span><span class="token punctuation">,</span>
                    <span class="token string">"teacherUid"</span><span class="token operator">:</span> <span class="token string">"100000094119"</span><span class="token punctuation">,</span>
                    <span class="token string">"uname"</span><span class="token operator">:</span> <span class="token string">"a sijiali 99"</span><span class="token punctuation">,</span>
                    <span class="token string">"unamePing"</span><span class="token operator">:</span> <span class="token string">"sijiali"</span><span class="token punctuation">,</span>
                    <span class="token string">"gender"</span><span class="token operator">:</span> <span class="token number">30</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="golandESapi_906"></a>goland接入ES的api</h3> 
<p><strong>配置</strong></p> 
<pre><code class="prism language-yaml"><span class="token key atrule">elastic</span><span class="token punctuation">:</span>
  <span class="token key atrule">zlwenxue-cli</span><span class="token punctuation">:</span>
    <span class="token key atrule">service</span><span class="token punctuation">:</span> zlwenxue<span class="token punctuation">-</span>cli
    <span class="token key atrule">addr</span><span class="token punctuation">:</span> <span class="token string">"http://127.0.0.1:9200/"</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> <span class="token string">"liuqinhua"</span> <span class="token comment">#电脑的账号密码</span>
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token string">"123456"</span>
    <span class="token key atrule">gzip</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
</code></pre> 
<p><strong>代码</strong></p> 
<pre><code class="prism language-go"><span class="token keyword">package</span> es

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"errors"</span>
	<span class="token string">"github.com/gin-gonic/gin"</span>
	<span class="token string">"github.com/olivere/elastic"</span>
	<span class="token string">"reflect"</span>
	<span class="token string">"zlwenxue-cli/components"</span>
	<span class="token string">"zlwenxue-cli/helpers"</span>
<span class="token punctuation">)</span>

<span class="token comment">/**
 * @Author: liuqinhua
 * @Date: 2022/8/29 11:03 AM
 */</span>
<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	SchoolId   <span class="token builtin">string</span> <span class="token string">`json:"schoolId"`</span>
	TeacherUid <span class="token builtin">string</span> <span class="token string">`json:"teacherUid"`</span>
	Uname      <span class="token builtin">string</span> <span class="token string">`json:"uname"`</span>
	UnamePing  <span class="token builtin">string</span> <span class="token string">`json:"unamePing"`</span>
	Gender     <span class="token builtin">int</span>    <span class="token string">`json:"gender"`</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">AddUserEs</span><span class="token punctuation">(</span>ctx <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> record <span class="token operator">*</span>User<span class="token punctuation">)</span> <span class="token punctuation">(</span>id <span class="token builtin">string</span><span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> record <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">,</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"插入的数据为空"</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	responseBody<span class="token punctuation">,</span> err <span class="token operator">:=</span> helpers<span class="token punctuation">.</span>ElasticClient<span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">BodyJson</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">,</span> components<span class="token punctuation">.</span>ErrorEsInsert<span class="token punctuation">.</span><span class="token function">Wrap</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> responseBody<span class="token punctuation">.</span>Id<span class="token punctuation">,</span> err
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">BoolQueryUser</span><span class="token punctuation">(</span>ctx <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> schoolId<span class="token punctuation">,</span> uname<span class="token punctuation">,</span> unameping <span class="token builtin">string</span><span class="token punctuation">,</span> gender <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>userList <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>User<span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	boolquery <span class="token operator">:=</span> <span class="token operator">&amp;</span>elastic<span class="token punctuation">.</span>BoolQuery<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>schoolId<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
		boolquery<span class="token punctuation">.</span><span class="token function">Filter</span><span class="token punctuation">(</span>elastic<span class="token punctuation">.</span><span class="token function">NewTermQuery</span><span class="token punctuation">(</span><span class="token string">"schoolId"</span><span class="token punctuation">,</span> schoolId<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> gender <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
		boolquery<span class="token punctuation">.</span><span class="token function">Filter</span><span class="token punctuation">(</span>elastic<span class="token punctuation">.</span><span class="token function">NewTermQuery</span><span class="token punctuation">(</span><span class="token string">"gender"</span><span class="token punctuation">,</span> gender<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>unameping<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">//should下面也可以完全匹配</span>
		boolquery<span class="token punctuation">.</span><span class="token function">Should</span><span class="token punctuation">(</span>elastic<span class="token punctuation">.</span><span class="token function">NewTermQuery</span><span class="token punctuation">(</span><span class="token string">"unamePing"</span><span class="token punctuation">,</span> unameping<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>uname<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
		boolquery<span class="token punctuation">.</span><span class="token function">Should</span><span class="token punctuation">(</span>elastic<span class="token punctuation">.</span><span class="token function">NewMatchQuery</span><span class="token punctuation">(</span><span class="token string">"uname"</span><span class="token punctuation">,</span> uname<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	searchByMatch<span class="token punctuation">,</span> err <span class="token operator">:=</span> helpers<span class="token punctuation">.</span>ElasticClient<span class="token punctuation">.</span><span class="token function">Search</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span>boolquery<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">From</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> userList<span class="token punctuation">,</span> components<span class="token punctuation">.</span>ErrorEsInsert<span class="token punctuation">.</span><span class="token function">Wrap</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">var</span> resultType User
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> item <span class="token operator">:=</span> <span class="token keyword">range</span> searchByMatch<span class="token punctuation">.</span><span class="token function">Each</span><span class="token punctuation">(</span>reflect<span class="token punctuation">.</span><span class="token function">TypeOf</span><span class="token punctuation">(</span>resultType<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		answerHistory <span class="token operator">:=</span> item<span class="token punctuation">.</span><span class="token punctuation">(</span>User<span class="token punctuation">)</span>
		userList <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>userList<span class="token punctuation">,</span> <span class="token operator">&amp;</span>answerHistory<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span>
<span class="token punctuation">}</span>

</code></pre> 
<p><strong>测试</strong></p> 
<pre><code class="prism language-go"><span class="token keyword">package</span> es

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"github.com/gin-gonic/gin"</span>
	<span class="token string">"net/http/httptest"</span>
	<span class="token string">"testing"</span>
	<span class="token string">"zlwenxue-cli/test"</span>
<span class="token punctuation">)</span>

<span class="token comment">/**
 * @Author: liuqinhua
 * @Date: 2022/8/29 11:04 AM
 */</span>

<span class="token keyword">func</span> <span class="token function">TestUserEs</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	test<span class="token punctuation">.</span><span class="token function">Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	ctx<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> gin<span class="token punctuation">.</span><span class="token function">CreateTestContext</span><span class="token punctuation">(</span>httptest<span class="token punctuation">.</span><span class="token function">NewRecorder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token comment">//answerHistoryEs := createQueryAnswerHistoryEs()</span>

	user1 <span class="token operator">:=</span> <span class="token operator">&amp;</span>User<span class="token punctuation">{<!-- --></span>
		SchoolId<span class="token punctuation">:</span>   <span class="token string">"111111"</span><span class="token punctuation">,</span>
		TeacherUid<span class="token punctuation">:</span> <span class="token string">"123456123"</span><span class="token punctuation">,</span>
		UnamePing<span class="token punctuation">:</span>  <span class="token string">"goland test2"</span><span class="token punctuation">,</span>
		Uname<span class="token punctuation">:</span>      <span class="token string">"goland nihao test clients 111"</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>

	id<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">AddUserEs</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> user1<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"%+v"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"========="</span><span class="token punctuation">)</span>
	list<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">BoolQueryUser</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">"goland"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> V <span class="token operator">:=</span> <span class="token keyword">range</span> list <span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%+v"</span><span class="token punctuation">,</span> V<span class="token punctuation">)</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>结果</p> 
<p><img src="https://images2.imgbox.com/b9/05/TOPKliYR_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="match_1044"></a>match最小匹配度</h3> 
<p>match的字段下加上minimum_should_match可以加百分数也可以加数字<br> 表示分词后必须命中的最小词数或者百分比<br> <a href="https://blog.csdn.net/u012463871/article/details/115560983">参考</a></p> 
<p>book索引下的所有文档</p> 
<pre><code class="prism language-go"><span class="token punctuation">{<!-- --></span>
    <span class="token string">"took"</span><span class="token punctuation">:</span> <span class="token number">809</span><span class="token punctuation">,</span>
    <span class="token string">"timed_out"</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token string">"_shards"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"total"</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token string">"successful"</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token string">"skipped"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token string">"failed"</span><span class="token punctuation">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">"hits"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"total"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"value"</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
            <span class="token string">"relation"</span><span class="token punctuation">:</span> <span class="token string">"eq"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">"max_score"</span><span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
        <span class="token string">"hits"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token string">"_index"</span><span class="token punctuation">:</span> <span class="token string">"book"</span><span class="token punctuation">,</span>
                <span class="token string">"_type"</span><span class="token punctuation">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span>
                <span class="token string">"_id"</span><span class="token punctuation">:</span> <span class="token string">"BrCJ2YIBzFC3z-tJA1vB"</span><span class="token punctuation">,</span>
                <span class="token string">"_score"</span><span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
                <span class="token string">"_source"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"bookId"</span><span class="token punctuation">:</span> <span class="token string">"2000014485"</span><span class="token punctuation">,</span>
                    <span class="token string">"title"</span><span class="token punctuation">:</span> <span class="token string">"标题1"</span><span class="token punctuation">,</span>
                    <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token string">"duanluo"</span><span class="token punctuation">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>
                        <span class="token string">"zhaiyao"</span><span class="token punctuation">:</span> <span class="token string">"摘要1"</span><span class="token punctuation">,</span>
                        <span class="token string">"内容"</span><span class="token punctuation">:</span> <span class="token string">"啊啊啊不不不"</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token string">"_index"</span><span class="token punctuation">:</span> <span class="token string">"book"</span><span class="token punctuation">,</span>
                <span class="token string">"_type"</span><span class="token punctuation">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span>
                <span class="token string">"_id"</span><span class="token punctuation">:</span> <span class="token string">"CLCu2YIBzFC3z-tJvVsG"</span><span class="token punctuation">,</span>
                <span class="token string">"_score"</span><span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
                <span class="token string">"_source"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"bookId"</span><span class="token punctuation">:</span> <span class="token string">"2000014485"</span><span class="token punctuation">,</span>
                    <span class="token string">"title"</span><span class="token punctuation">:</span> <span class="token string">"标题2"</span><span class="token punctuation">,</span>
                    <span class="token string">"alltext"</span><span class="token punctuation">:</span> <span class="token string">"{\"duanluo\": \"2\",\"zhaiyao\": \"摘要2\",\"内容\": \"啊啊啊不不不2222\"}"</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token string">"_index"</span><span class="token punctuation">:</span> <span class="token string">"book"</span><span class="token punctuation">,</span>
                <span class="token string">"_type"</span><span class="token punctuation">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span>
                <span class="token string">"_id"</span><span class="token punctuation">:</span> <span class="token string">"SM2e7IIBO-2eYCM19Rdj"</span><span class="token punctuation">,</span>
                <span class="token string">"_score"</span><span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
                <span class="token string">"_source"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"bookId"</span><span class="token punctuation">:</span> <span class="token string">"2000014486"</span><span class="token punctuation">,</span>
                    <span class="token string">"title"</span><span class="token punctuation">:</span> <span class="token string">"李小龙（英文名：Bruce Lee，1940年11月27日－1973年7月20日），本名李振藩，出生于美国加利福尼亚州旧金山"</span><span class="token punctuation">,</span>
                    <span class="token string">"alltext"</span><span class="token punctuation">:</span> <span class="token string">"1962年李小龙开办“振藩国术馆”，1967年自创截拳道，1973年7月20日，李小龙在香港逝世，年仅32岁。1979年美国洛杉矶市政府将补拍版《死亡游戏》的开映日6月8日定为“李小龙日”（7月8日为错误翻译）。1993年美国发行李小龙逝世20周年纪念钞票，好莱坞星光大道铺上李小龙纪念星徽；同年，获香港电影金像奖大会颁发“终身成就奖”。1998年11月，获中国武术协会颁发“武术电影巨星奖”。"</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token string">"_index"</span><span class="token punctuation">:</span> <span class="token string">"book"</span><span class="token punctuation">,</span>
                <span class="token string">"_type"</span><span class="token punctuation">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span>
                <span class="token string">"_id"</span><span class="token punctuation">:</span> <span class="token string">"Sc2f7IIBO-2eYCM1bxfY"</span><span class="token punctuation">,</span>
                <span class="token string">"_score"</span><span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
                <span class="token string">"_source"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"bookId"</span><span class="token punctuation">:</span> <span class="token string">"2000014486"</span><span class="token punctuation">,</span>
                    <span class="token string">"title"</span><span class="token punctuation">:</span> <span class="token string">"周星驰（Stephen Chow），1962年6月22日出生于香港，祖籍浙江省宁波市，中国香港影视男演员、导演、编剧、制作人、商人，毕业于无线电视艺员训练班"</span><span class="token punctuation">,</span>
                    <span class="token string">"alltext"</span><span class="token punctuation">:</span> <span class="token string">"1980年成为丽的电视台的特约演员，从而进入演艺圈。1981年出演个人首部电视剧《IQ成熟时》。1988年将演艺事业的重心转向大银幕，并于同年出演电影处女作《捕风汉子》。1990年凭借喜剧片《一本漫画闯天涯》确立其无厘头的表演风格；同年，因其主演的喜剧动作片《赌圣》打破香港地区票房纪录而获得关注。1991年主演喜剧片《逃学威龙》，并再次打破香港地区票房纪录 [1]  。1995年凭借喜剧爱情片《大话西游》奠定其在华语影坛的地位。1999年自导自演的喜剧片《喜剧之王》获得香港电影年度票房冠军 [2]  。"</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token string">"_index"</span><span class="token punctuation">:</span> <span class="token string">"book"</span><span class="token punctuation">,</span>
                <span class="token string">"_type"</span><span class="token punctuation">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span>
                <span class="token string">"_id"</span><span class="token punctuation">:</span> <span class="token string">"Ss2g7IIBO-2eYCM1NBeJ"</span><span class="token punctuation">,</span>
                <span class="token string">"_score"</span><span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
                <span class="token string">"_source"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"bookId"</span><span class="token punctuation">:</span> <span class="token string">"2000014486"</span><span class="token punctuation">,</span>
                    <span class="token string">"title"</span><span class="token punctuation">:</span> <span class="token string">"黄家驹（1962年6月10日—1993年6月30日），出生于中国香港，祖籍广东省台山市"</span><span class="token punctuation">,</span>
                    <span class="token string">"alltext"</span><span class="token punctuation">:</span> <span class="token string">"中国香港男歌手、原创音乐人、吉他手，摇滚乐队Beyond的主唱及创队成员。1983年组建Beyond乐队，担任主唱，"</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>查询语句</p> 
<pre><code class="prism language-go"><span class="token punctuation">{<!-- --></span>
    <span class="token string">"query"</span><span class="token punctuation">:</span><span class="token punctuation">{<!-- --></span>
        <span class="token string">"bool"</span><span class="token punctuation">:</span><span class="token punctuation">{<!-- --></span>
            <span class="token string">"should"</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token comment">// must相当于mysql的and,should相当于or</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"match"</span><span class="token punctuation">:</span><span class="token punctuation">{<!-- --></span>
                     <span class="token string">"title"</span> <span class="token punctuation">:</span><span class="token punctuation">{<!-- --></span><span class="token comment">//title是字段</span>
                         <span class="token string">"query"</span><span class="token punctuation">:</span><span class="token string">"出生于相关"</span><span class="token punctuation">,</span><span class="token comment">//全文查询内容</span>
                         <span class="token string">"minimum_should_match"</span><span class="token punctuation">:</span><span class="token string">"60%"</span><span class="token comment">//是指最少匹配百分比。是指将 query 分词后的词的数量 A，要求///匹配中的词的数量b，b/a 即为正数的百分比。</span>
                        <span class="token comment">// "minimum_should_match":"3"//是指将 query 分词后的词的数量 A，要求从 A 中最少匹配中的///词的数量 B。这里匹配中的词是：出，生，于。</span>
                     <span class="token punctuation">}</span>
                      <span class="token comment">//"gender":26</span>
                      
                  <span class="token punctuation">}</span>
                  
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
            
        <span class="token punctuation">}</span>
        
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
查询结果


<span class="token punctuation">{<!-- --></span>
    <span class="token string">"took"</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    <span class="token string">"timed_out"</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token string">"_shards"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"total"</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token string">"successful"</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token string">"skipped"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token string">"failed"</span><span class="token punctuation">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">"hits"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"total"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"value"</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
            <span class="token string">"relation"</span><span class="token punctuation">:</span> <span class="token string">"eq"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">"max_score"</span><span class="token punctuation">:</span> <span class="token number">1.5160279</span><span class="token punctuation">,</span>
        <span class="token string">"hits"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token string">"_index"</span><span class="token punctuation">:</span> <span class="token string">"book"</span><span class="token punctuation">,</span>
                <span class="token string">"_type"</span><span class="token punctuation">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span>
                <span class="token string">"_id"</span><span class="token punctuation">:</span> <span class="token string">"Ss2g7IIBO-2eYCM1NBeJ"</span><span class="token punctuation">,</span>
                <span class="token string">"_score"</span><span class="token punctuation">:</span> <span class="token number">1.5160279</span><span class="token punctuation">,</span>
                <span class="token string">"_source"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"bookId"</span><span class="token punctuation">:</span> <span class="token string">"2000014486"</span><span class="token punctuation">,</span>
                    <span class="token string">"title"</span><span class="token punctuation">:</span> <span class="token string">"黄家驹（1962年6月10日—1993年6月30日），出生于中国香港，祖籍广东省台山市"</span><span class="token punctuation">,</span>
                    <span class="token string">"alltext"</span><span class="token punctuation">:</span> <span class="token string">"中国香港男歌手、原创音乐人、吉他手，摇滚乐队Beyond的主唱及创队成员。1983年组建Beyond乐队，担任主唱，"</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token string">"_index"</span><span class="token punctuation">:</span> <span class="token string">"book"</span><span class="token punctuation">,</span>
                <span class="token string">"_type"</span><span class="token punctuation">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span>
                <span class="token string">"_id"</span><span class="token punctuation">:</span> <span class="token string">"SM2e7IIBO-2eYCM19Rdj"</span><span class="token punctuation">,</span>
                <span class="token string">"_score"</span><span class="token punctuation">:</span> <span class="token number">1.3371259</span><span class="token punctuation">,</span>
                <span class="token string">"_source"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"bookId"</span><span class="token punctuation">:</span> <span class="token string">"2000014486"</span><span class="token punctuation">,</span>
                    <span class="token string">"title"</span><span class="token punctuation">:</span> <span class="token string">"李小龙（英文名：Bruce Lee，1940年11月27日－1973年7月20日），本名李振藩，出生于美国加利福尼亚州旧金山"</span><span class="token punctuation">,</span>
                    <span class="token string">"alltext"</span><span class="token punctuation">:</span> <span class="token string">"1962年李小龙开办“振藩国术馆”，1967年自创截拳道，1973年7月20日，李小龙在香港逝世，年仅32岁。1979年美国洛杉矶市政府将补拍版《死亡游戏》的开映日6月8日定为“李小龙日”（7月8日为错误翻译）。1993年美国发行李小龙逝世20周年纪念钞票，好莱坞星光大道铺上李小龙纪念星徽；同年，获香港电影金像奖大会颁发“终身成就奖”。1998年11月，获中国武术协会颁发“武术电影巨星奖”。"</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token string">"_index"</span><span class="token punctuation">:</span> <span class="token string">"book"</span><span class="token punctuation">,</span>
                <span class="token string">"_type"</span><span class="token punctuation">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span>
                <span class="token string">"_id"</span><span class="token punctuation">:</span> <span class="token string">"Sc2f7IIBO-2eYCM1bxfY"</span><span class="token punctuation">,</span>
                <span class="token string">"_score"</span><span class="token punctuation">:</span> <span class="token number">1.3117697</span><span class="token punctuation">,</span>
                <span class="token string">"_source"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"bookId"</span><span class="token punctuation">:</span> <span class="token string">"2000014486"</span><span class="token punctuation">,</span>
                    <span class="token string">"title"</span><span class="token punctuation">:</span> <span class="token string">"周星驰（Stephen Chow），1962年6月22日出生于香港，祖籍浙江省宁波市，中国香港影视男演员、导演、编剧、制作人、商人，毕业于无线电视艺员训练班"</span><span class="token punctuation">,</span>
                    <span class="token string">"alltext"</span><span class="token punctuation">:</span> <span class="token string">"1980年成为丽的电视台的特约演员，从而进入演艺圈。1981年出演个人首部电视剧《IQ成熟时》。1988年将演艺事业的重心转向大银幕，并于同年出演电影处女作《捕风汉子》。1990年凭借喜剧片《一本漫画闯天涯》确立其无厘头的表演风格；同年，因其主演的喜剧动作片《赌圣》打破香港地区票房纪录而获得关注。1991年主演喜剧片《逃学威龙》，并再次打破香港地区票房纪录 [1]  。1995年凭借喜剧爱情片《大话西游》奠定其在华语影坛的地位。1999年自导自演的喜剧片《喜剧之王》获得香港电影年度票房冠军 [2]  。"</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>goland里面api的接口演示<br> <img src="https://images2.imgbox.com/84/95/ZOpqYOY6_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="boost_1222"></a>boost控制权重</h3> 
<p>boost控制权重实现搜索结果排名<br> <a href="https://blog.csdn.net/u010134642/article/details/125463326">参考</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/460b66f616f68d815e830126eb96bab7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Hashmap 的源码解析以及put流程</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5aff3c6ca38196828e9f05169681c8b8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">ubuntu 防火墙命令整理</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>