<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Cortex_m3的启动过程 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Cortex_m3的启动过程" />
<meta property="og:description" content="一．arm的启动过程
arm的启动代码一般是用汇编写的，在堆栈建立以后才可以运行C代码，因为C函数调用需要把参数，函数返回地址入栈，堆栈没有建立不能运行C代码。
应用程序启动过程
应用程序启动过程：
1.映像入口地址，一般为0X00000000地址，也可以指定为其他的地址，硬件复位起来，从地址0x00000000处取指，地址0x00000000处放的复位服务函数的地址，就会进入复位服务函数。在复位函数里做一些系统的初始化，然后调用系统函数_main();
2．_main 直接跳转到 __scatterload，__scatterload 执行代码和数据复制以及 ZI 数据的清零。根据分散加载文件，拷贝RW数据到RAM,在RAM空间里建立ZI的数据空间，建立运行时的映像存储器映射，然后跳转到 __rt_entry（运行时的入口）则负责初始化 C 库。还设置应用程序的栈和堆，初始化库函数及其静态数据。
3．这时应用程序的堆栈建立了，跳转到main()函数，运行用户代码。
二. 存储器映射的建立
1．编译链接生成的ELF文件
ELF文件格式
链接器根据输入节的属性在一个区内对它们进行排序。 具有相同属性的输入节在区内形成相邻块。链接生成的ELF文件里的数据节。
RO:包括代码和只读数据(.init .text .rodata)
RW:读写数据（.data）
ZI:未初始化的数据，在装载区不分配空间，执行区才分配空间。(.bss)
2. 映像的加载区和执行区
加载区: 根据映像加载到内存时所在的地址（即映像开始执行之前的位置）。
执行区: 映像执行时所在的地址。
根区： 加载区和执行区的地址相同。
加载区和执行区
一般下载到FLASH里的2进制文件就放在加载区，上图中的0X0000-0X4000空间。应用程序启动时，__scatterload函数根据分散加载文件把RW数据节拷贝到RAM空间，然后在RAM空间分配ZI数据节的空间。因为对RAM空间里数据的读写比FLASH快。一般把RW的数据拷贝到RAM。RO节的数据不做处理。这样运行时的存储器空间就建立起来了。
二．堆栈的设置
__user_initial_stackheap() 可用 C 或 ARM 汇编语言来编写。它必须返回以下参数：
• r0 中的堆基址；
• r1 中的栈基址；
• r2 中的堆限制（双区模型）；
• r3 中的栈限制（双区模型）。
堆栈的模式有2种：单区模式，双区模式。
1.单区模型
默认情况下为单区模型，应用程序的堆和栈在同一存储器区中互相朝向对方增长，其中栈从地址 0x40000 向下增长，堆从地址 0x20000 向上增长。将相应的值加载到寄存器 r0 和 r1，然后返回。r2 和 r3 保持不变，因为在单区模型中不使用堆限制和栈限制。
EXPORT __user_initial_stackheap" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/4b2bac875de9f81fd003806a41bb6a1b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2015-06-25T16:01:57+08:00" />
<meta property="article:modified_time" content="2015-06-25T16:01:57+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Cortex_m3的启动过程</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> 一．arm的启动过程</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> arm的启动代码一般是用汇编写的，在堆栈建立以后才可以运行C代码，因为C函数调用需要把参数，函数返回地址入栈，堆栈没有建立不能运行C代码。</p> 
<p align="center" style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> </p> 
<p align="center" style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> <img src="https://images2.imgbox.com/00/86/E0dzJKFB_o.png" alt="" style="border:none; max-width:100%"></p> 
<p align="center" style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px">  </p> 
<p align="center" style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> 应用程序启动过程</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> 应用程序启动过程：</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> 1.映像入口地址，一般为0X00000000地址，也可以指定为其他的地址，硬件复位起来，从地址0x00000000处取指，地址0x00000000处放的复位服务函数的地址，就会进入复位服务函数。在复位函数里做一些系统的初始化，然后调用系统函数_main();</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> 2．_main 直接跳转到 __scatterload，__scatterload 执行代码和数据复制以及 ZI 数据的清零。根据分散加载文件，拷贝RW数据到RAM,在RAM空间里建立ZI的数据空间，建立运行时的映像存储器映射，然后跳转到 __rt_entry（运行时的入口）则负责初始化 C 库。还设置应用程序的栈和堆，初始化库函数及其静态数据。</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> 3．这时应用程序的堆栈建立了，跳转到main()函数，运行用户代码。</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px">  </p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> 二.  存储器映射的建立</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> 1．编译链接生成的ELF文件</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> </p> 
<p align="center" style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> <img src="https://images2.imgbox.com/63/75/dNjDTSG0_o.png" alt="" style="border:none; max-width:100%"></p> 
<p align="center" style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> ELF文件格式</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> 链接器根据输入节的属性在一个区内对它们进行排序。 具有相同属性的输入节在区内形成相邻块。链接生成的ELF文件里的数据节。</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> RO:包括代码和只读数据(.init  .text  .rodata)</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> RW:读写数据（.data）</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> ZI:未初始化的数据，在装载区不分配空间，执行区才分配空间。(.bss)</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px">  </p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> 2. 映像的加载区和执行区</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> 加载区: 根据映像加载到内存时所在的地址（即映像开始执行之前的位置）。</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> 执行区: 映像执行时所在的地址。</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> 根区：  加载区和执行区的地址相同。</p> 
<p align="center" style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> <img src="https://images2.imgbox.com/40/ee/ZJCynPKp_o.png" alt="" style="border:none; max-width:100%"></p> 
<p align="center" style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> 加载区和执行区</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> 一般下载到FLASH里的2进制文件就放在加载区，上图中的0X0000-0X4000空间。应用程序启动时，__scatterload函数根据分散加载文件把RW数据节拷贝到RAM空间，然后在RAM空间分配ZI数据节的空间。因为对RAM空间里数据的读写比FLASH快。一般把RW的数据拷贝到RAM。RO节的数据不做处理。这样运行时的存储器空间就建立起来了。</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px">  </p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> 二．堆栈的设置</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> __user_initial_stackheap() 可用 C 或 ARM 汇编语言来编写。它必须返回以下参数：</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> • r0 中的堆基址；</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> • r1 中的栈基址；</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> • r2 中的堆限制（双区模型）；</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> • r3 中的栈限制（双区模型）。</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> 堆栈的模式有2种：单区模式，双区模式。</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> 1.单区模型</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> 默认情况下为单区模型，应用程序的堆和栈在同一存储器区中互相朝向对方增长，其中栈从地址 0x40000 向下增长，堆从地址 0x20000 向上增长。将相应的值加载到寄存器 r0 和 r1，然后返回。r2 和 r3 保持不变，因为在单区模型中不使用堆限制和栈限制。</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> </p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px">  <img src="https://images2.imgbox.com/3e/3b/vTiu5596_o.png" alt="" style="border:none; max-width:100%"></p> 
<p align="left" style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> EXPORT __user_initial_stackheap</p> 
<p align="left" style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> __user_initial_stackheap</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> LDR r0, =0x20000 ;</p> 
<p align="left" style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> LDR r1, =0x40000 ;</p> 
<p align="left" style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> ; r2 not used (HL)</p> 
<p align="left" style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> ; r3 not used (SL)</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> MOV pc, lr</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px">  </p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> 2.双区模型</p> 
<p align="left" style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> 使用双区模型必须使用汇编命令 IMPORT 引入符号 __use_two_region_memory。将堆和栈分别放置在存储器不同的区中，__user_initial_stackheap() 建立的专用堆限制来检查堆。需要设置堆栈的长度。</p> 
<p align="left" style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> </p> 
<p align="left" style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> 汇编代码的实现，。栈从 0x40000 向0x20000 的限制向下增长。为使用该栈限制，所有使用此实现的模块必须进行编译以便进行软件栈检查。堆从 0x28000000 到 0x28080000 向上增长。</p> 
<p align="left" style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> <img src="https://images2.imgbox.com/d1/54/DpmDz7z4_o.png" alt="" style="border:none; max-width:100%"></p> 
<p align="left" style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> IMPORT __use_two_region_memory</p> 
<p align="left" style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> EXPORT __user_initial_stackheap</p> 
<p align="left" style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> __user_initial_stackheap</p> 
<p align="left" style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> LDR r0, =0x28000000 ;HB</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> LDR r1, =0x40000 ;SB</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> LDR r2, =0x28080000 ;HL</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> LDR r3, =0x20000 ;SL</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> MOV pc, lr</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> <br> </p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> ***************************************************************************</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">在开发STM32的时候，无论你试试用库开发还是使用</span><span id="13_nwp" style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px; width:auto; height:auto; float:none"><a target="_blank" id="13_nwl" href="http://cpro.baidu.com/cpro/ui/uijs.php?adclass=0&amp;app_id=0&amp;c=news&amp;cf=1001&amp;ch=0&amp;di=128&amp;fv=11&amp;is_app=0&amp;jk=b91203fc72c6982d&amp;k=%BC%C4%B4%E6%C6%F7&amp;k0=%BC%C4%B4%E6%C6%F7&amp;kdi0=0&amp;luki=5&amp;n=10&amp;p=baidu&amp;q=98059059_cpr&amp;rb=0&amp;rs=1&amp;seller_id=1&amp;sid=2d98c672fc0312b9&amp;ssp2=1&amp;stid=0&amp;t=tpclicked3_hc&amp;tu=u1831118&amp;u=http%3A%2F%2Fwww%2E51hei%2Ecom%2Fbbs%2Fdpj%2D26674%2D1%2Ehtml&amp;urlid=0" rel="nofollow noopener noreferrer" style="word-wrap:break-word; color:rgb(51,102,153); text-decoration:none"><span style="word-wrap:break-word; color:rgb(0,0,255); width:auto; height:auto">寄存器</span></a></span><span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">来开发</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">首先最重要的你必须的理解STM32的启动流程，启动流程封装在启动文件里面。</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">而这个启动文件就是</span><span style="color:#FF0000; word-wrap:break-word; font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"><span style="word-wrap:break-word; font-size:18px">Bootloader</span></span><span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">。</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="word-wrap:break-word; font-weight:700; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">Cortex M3的内核有三种启动方式，其分别是：<br style="word-wrap:break-word"> A.通过boot引脚设置可以将中断向量表定位于SRAM区，即起始地址为0x2000000，同时复位后PC指针位于0x2000000处；<br style="word-wrap:break-word"> B.通过boot引脚设置可以将中断向量表定位于FLASH区，即起始地址为0x8000000，同时复位后PC指针位于0x8000000处；<br style="word-wrap:break-word"> C.通过boot引脚设置可以将中断向量表定位于内置Bootloader区，</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">Cortex-M3内核规定，起始地址必须存放堆顶指针，而第二个地址则必须存放复位中断入口向量地址，这样在Cortex-M3内核复位后，会自动从起始地址的下一个32位空间取出复位中断入口向量，跳转执行复位中断服务程序。Cortex-M3内核是固定了中断向量表的位置而起始地址是可变化的.</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">以下是 STM32 2.02固件库提供的启动文件“</span><span id="12_nwp" style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px; width:auto; height:auto; float:none"><a target="_blank" id="12_nwl" href="http://cpro.baidu.com/cpro/ui/uijs.php?adclass=0&amp;app_id=0&amp;c=news&amp;cf=1001&amp;ch=0&amp;di=128&amp;fv=11&amp;is_app=0&amp;jk=b91203fc72c6982d&amp;k=stm32&amp;k0=stm32&amp;kdi0=0&amp;luki=10&amp;n=10&amp;p=baidu&amp;q=98059059_cpr&amp;rb=0&amp;rs=1&amp;seller_id=1&amp;sid=2d98c672fc0312b9&amp;ssp2=1&amp;stid=0&amp;t=tpclicked3_hc&amp;tu=u1831118&amp;u=http%3A%2F%2Fwww%2E51hei%2Ecom%2Fbbs%2Fdpj%2D26674%2D1%2Ehtml&amp;urlid=0" rel="nofollow noopener noreferrer" style="word-wrap:break-word; color:rgb(51,102,153); text-decoration:none"><span style="word-wrap:break-word; color:rgb(0,0,255); width:auto; height:auto">stm32</span></a></span><span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">f10x_vector.s”其解析如下：</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="font-family:Times New Roman; word-wrap:break-word; color:rgb(68,68,68); font-size:14px; line-height:21px"><span style="word-wrap:break-word; font-weight:700"><span style="word-wrap:break-word; font-size:12px">；文件“stm32f10x_vector.s”，其中注释为行号<br style="word-wrap:break-word"> DATA_IN_ExtSRAM EQU 0 ；1<br style="word-wrap:break-word"> Stack_Size EQU 0x00000400 ；2<br style="word-wrap:break-word"> AREA STACK, NOINIT, READWRITE, ALIGN = 3 ；3<br style="word-wrap:break-word"> Stack_Mem SPACE Stack_Size ；4<br style="word-wrap:break-word"> __initial_sp ；5<br style="word-wrap:break-word"> Heap_Size EQU 0x00000400 ；6<br style="word-wrap:break-word"> AREA HEAP, NOINIT, READWRITE, ALIGN = 3 ；7<br style="word-wrap:break-word"> __heap_base ；8<br style="word-wrap:break-word"> Heap_Mem SPACE Heap_Size ；9<br style="word-wrap:break-word"> __heap_limit ；10<br style="word-wrap:break-word"> THUMB ；11<br style="word-wrap:break-word"> PRESERVE8 ；12<br style="word-wrap:break-word"> IMPORT NMIException ；13<br style="word-wrap:break-word"> IMPORT HardFaultException ；14<br style="word-wrap:break-word"> IMPORT MemManageException ；15<br style="word-wrap:break-word"> IMPORT BusFaultException ；16<br style="word-wrap:break-word"> IMPORT UsageFaultException ；17<br style="word-wrap:break-word"> IMPORT SVCHandler ；18<br style="word-wrap:break-word"> IMPORT DebugMonitor ；19<br style="word-wrap:break-word"> IMPORT PendSVC ；20<br style="word-wrap:break-word"> IMPORT SysTickHandler ；21<br style="word-wrap:break-word"> IMPORT WWDG_IRQHandler ；22<br style="word-wrap:break-word"> IMPORT PVD_IRQHandler ；23<br style="word-wrap:break-word"> IMPORT TAMPER_IRQHandler ；24<br style="word-wrap:break-word"> IMPORT RTC_IRQHandler ；25<br style="word-wrap:break-word"> IMPORT FLASH_IRQHandler ；26<br style="word-wrap:break-word"> IMPORT RCC_IRQHandler ；27<br style="word-wrap:break-word"> IMPORT EXTI0_IRQHandler ；28<br style="word-wrap:break-word"> IMPORT EXTI1_IRQHandler ；29<br style="word-wrap:break-word"> IMPORT EXTI2_IRQHandler ；30<br style="word-wrap:break-word"> IMPORT EXTI3_IRQHandler ；31<br style="word-wrap:break-word"> IMPORT EXTI4_IRQHandler ；32<br style="word-wrap:break-word"> IMPORT DMA1_Channel1_IRQHandler ；33<br style="word-wrap:break-word"> IMPORT DMA1_Channel2_IRQHandler ；34<br style="word-wrap:break-word"> IMPORT DMA1_Channel3_IRQHandler ；35<br style="word-wrap:break-word"> IMPORT DMA1_Channel4_IRQHandler ；36<br style="word-wrap:break-word"> IMPORT DMA1_Channel5_IRQHandler ；37<br style="word-wrap:break-word"> IMPORT DMA1_Channel6_IRQHandler ；38<br style="word-wrap:break-word"> IMPORT DMA1_Channel7_IRQHandler ；39<br style="word-wrap:break-word"> IMPORT ADC1_2_IRQHandler ；40<br style="word-wrap:break-word"> IMPORT USB_HP_CAN_TX_IRQHandler ；41<br style="word-wrap:break-word"> IMPORT USB_LP_CAN_RX0_IRQHandler ；42<br style="word-wrap:break-word"> IMPORT CAN_RX1_IRQHandler ；43<br style="word-wrap:break-word"> IMPORT CAN_SCE_IRQHandler ；44<br style="word-wrap:break-word"> IMPORT EXTI9_5_IRQHandler ；45<br style="word-wrap:break-word"> IMPORT TIM1_BRK_IRQHandler ；46<br style="word-wrap:break-word"> IMPORT TIM1_UP_IRQHandler ；47<br style="word-wrap:break-word"> IMPORT TIM1_TRG_COM_IRQHandler ；48<br style="word-wrap:break-word"> IMPORT TIM1_CC_IRQHandler ；49<br style="word-wrap:break-word"> IMPORT TIM2_IRQHandler ；50<br style="word-wrap:break-word"> IMPORT TIM3_IRQHandler ；51<br style="word-wrap:break-word"> IMPORT TIM4_IRQHandler ；52<br style="word-wrap:break-word"> IMPORT I2C1_EV_IRQHandler ；53<br style="word-wrap:break-word"> IMPORT I2C1_ER_IRQHandler ；54<br style="word-wrap:break-word"> IMPORT I2C2_EV_IRQHandler ；55<br style="word-wrap:break-word"> IMPORT I2C2_ER_IRQHandler ；56<br style="word-wrap:break-word"> IMPORT SPI1_IRQHandler ；57<br style="word-wrap:break-word"> IMPORT SPI2_IRQHandler ；58<br style="word-wrap:break-word"> IMPORT USART1_IRQHandler ；59<br style="word-wrap:break-word"> IMPORT USART2_IRQHandler ；60<br style="word-wrap:break-word"> IMPORT USART3_IRQHandler ；61<br style="word-wrap:break-word"> IMPORT EXTI15_10_IRQHandler ；62<br style="word-wrap:break-word"> IMPORT RTCAlarm_IRQHandler ；63<br style="word-wrap:break-word"> IMPORT USBWakeUp_IRQHandler ；64<br style="word-wrap:break-word"> IMPORT TIM8_BRK_IRQHandler ；65<br style="word-wrap:break-word"> IMPORT TIM8_UP_IRQHandler ；66<br style="word-wrap:break-word"> IMPORT TIM8_TRG_COM_IRQHandler ；67<br style="word-wrap:break-word"> IMPORT TIM8_CC_IRQHandler ；68<br style="word-wrap:break-word"> IMPORT ADC3_IRQHandler ；69<br style="word-wrap:break-word"> IMPORT FSMC_IRQHandler ；70<br style="word-wrap:break-word"> IMPORT SDIO_IRQHandler ；71<br style="word-wrap:break-word"> IMPORT TIM5_IRQHandler ；72<br style="word-wrap:break-word"> IMPORT SPI3_IRQHandler ；73<br style="word-wrap:break-word"> IMPORT UART4_IRQHandler ；74<br style="word-wrap:break-word"> IMPORT UART5_IRQHandler ；75<br style="word-wrap:break-word"> IMPORT TIM6_IRQHandler ；76<br style="word-wrap:break-word"> IMPORT TIM7_IRQHandler ；77<br style="word-wrap:break-word"> IMPORT DMA2_Channel1_IRQHandler ；78<br style="word-wrap:break-word"> IMPORT DMA2_Channel2_IRQHandler ；79<br style="word-wrap:break-word"> IMPORT DMA2_Channel3_IRQHandler ；80<br style="word-wrap:break-word"> IMPORT DMA2_Channel4_5_IRQHandler ；81<br style="word-wrap:break-word"> AREA RESET, DATA, READONLY ；82<br style="word-wrap:break-word"> EXPORT __Vectors ；83<br style="word-wrap:break-word"> __Vectors ；84<br style="word-wrap:break-word"> DCD __initial_sp ；85<br style="word-wrap:break-word"> DCD Reset_Handler ；86<br style="word-wrap:break-word"> DCD NMIException ；87<br style="word-wrap:break-word"> DCD HardFaultException ；88<br style="word-wrap:break-word"> DCD MemManageException ；89<br style="word-wrap:break-word"> DCD BusFaultException ；90<br style="word-wrap:break-word"> DCD UsageFaultException ；91<br style="word-wrap:break-word"> DCD 0 ；92<br style="word-wrap:break-word"> DCD 0 ；93<br style="word-wrap:break-word"> DCD 0 ；94<br style="word-wrap:break-word"> DCD 0 ；95<br style="word-wrap:break-word"> DCD SVCHandler ；96<br style="word-wrap:break-word"> DCD DebugMonitor ；97<br style="word-wrap:break-word"> DCD 0 ；98<br style="word-wrap:break-word"> DCD PendSVC ；99<br style="word-wrap:break-word"> DCD SysTickHandler ；100<br style="word-wrap:break-word"> DCD WWDG_IRQHandler ；101<br style="word-wrap:break-word"> DCD PVD_IRQHandler ；102<br style="word-wrap:break-word"> DCD TAMPER_IRQHandler ；103<br style="word-wrap:break-word"> DCD RTC_IRQHandler ；104<br style="word-wrap:break-word"> DCD FLASH_IRQHandler ；105<br style="word-wrap:break-word"> DCD RCC_IRQHandler ；106<br style="word-wrap:break-word"> DCD EXTI0_IRQHandler ；107<br style="word-wrap:break-word"> DCD EXTI1_IRQHandler ；108<br style="word-wrap:break-word"> DCD EXTI2_IRQHandler ；109<br style="word-wrap:break-word"> DCD EXTI3_IRQHandler ；110<br style="word-wrap:break-word"> DCD EXTI4_IRQHandler ；111<br style="word-wrap:break-word"> DCD DMA1_Channel1_IRQHandler ；112<br style="word-wrap:break-word"> DCD DMA1_Channel2_IRQHandler ；113<br style="word-wrap:break-word"> DCD DMA1_Channel3_IRQHandler ；114<br style="word-wrap:break-word"> DCD DMA1_Channel4_IRQHandler ；115<br style="word-wrap:break-word"> DCD DMA1_Channel5_IRQHandler ；116<br style="word-wrap:break-word"> DCD DMA1_Channel6_IRQHandler ；117<br style="word-wrap:break-word"> DCD DMA1_Channel7_IRQHandler ；118<br style="word-wrap:break-word"> DCD ADC1_2_IRQHandler ；119<br style="word-wrap:break-word"> DCD USB_HP_CAN_TX_IRQHandler ；120<br style="word-wrap:break-word"> DCD USB_LP_CAN_RX0_IRQHandler ；121<br style="word-wrap:break-word"> DCD CAN_RX1_IRQHandler ；122<br style="word-wrap:break-word"> DCD CAN_SCE_IRQHandler ；123<br style="word-wrap:break-word"> DCD EXTI9_5_IRQHandler ；124<br style="word-wrap:break-word"> DCD TIM1_BRK_IRQHandler ；125<br style="word-wrap:break-word"> DCD TIM1_UP_IRQHandler ；126<br style="word-wrap:break-word"> DCD TIM1_TRG_COM_IRQHandler ；127<br style="word-wrap:break-word"> DCD TIM1_CC_IRQHandler ；128<br style="word-wrap:break-word"> DCD TIM2_IRQHandler ；129<br style="word-wrap:break-word"> DCD TIM3_IRQHandler ；130<br style="word-wrap:break-word"> DCD TIM4_IRQHandler ；131<br style="word-wrap:break-word"> DCD I2C1_EV_IRQHandler ；132<br style="word-wrap:break-word"> DCD I2C1_ER_IRQHandler ；133<br style="word-wrap:break-word"> DCD I2C2_EV_IRQHandler ；134<br style="word-wrap:break-word"> DCD I2C2_ER_IRQHandler ；135<br style="word-wrap:break-word"> DCD SPI1_IRQHandler ；136<br style="word-wrap:break-word"> DCD SPI2_IRQHandler ；137<br style="word-wrap:break-word"> DCD USART1_IRQHandler ；138<br style="word-wrap:break-word"> DCD USART2_IRQHandler ；139<br style="word-wrap:break-word"> DCD USART3_IRQHandler ；140<br style="word-wrap:break-word"> DCD EXTI15_10_IRQHandler ；141<br style="word-wrap:break-word"> DCD RTCAlarm_IRQHandler ；142<br style="word-wrap:break-word"> DCD USBWakeUp_IRQHandler ；143<br style="word-wrap:break-word"> DCD TIM8_BRK_IRQHandler ；144<br style="word-wrap:break-word"> DCD TIM8_UP_IRQHandler ；145<br style="word-wrap:break-word"> DCD TIM8_TRG_COM_IRQHandler ；146<br style="word-wrap:break-word"> DCD TIM8_CC_IRQHandler ；147<br style="word-wrap:break-word"> DCD ADC3_IRQHandler ；148<br style="word-wrap:break-word"> DCD FSMC_IRQHandler ；149<br style="word-wrap:break-word"> DCD SDIO_IRQHandler ；150<br style="word-wrap:break-word"> DCD TIM5_IRQHandler ；151<br style="word-wrap:break-word"> DCD SPI3_IRQHandler ；152<br style="word-wrap:break-word"> DCD UART4_IRQHandler ；153<br style="word-wrap:break-word"> DCD UART5_IRQHandler ；154<br style="word-wrap:break-word"> DCD TIM6_IRQHandler ；155<br style="word-wrap:break-word"> DCD TIM7_IRQHandler ；156<br style="word-wrap:break-word"> DCD DMA2_Channel1_IRQHandler ；157<br style="word-wrap:break-word"> DCD DMA2_Channel2_IRQHandler ；158<br style="word-wrap:break-word"> DCD DMA2_Channel3_IRQHandler ；159<br style="word-wrap:break-word"> DCD DMA2_Channel4_5_IRQHandler ；160<br style="word-wrap:break-word"> AREA |.text|, CODE, READONLY ；161<br style="word-wrap:break-word"> Reset_Handler PROC ；162<br style="word-wrap:break-word"> EXPORT Reset_Handler ；163<br style="word-wrap:break-word"> IF DATA_IN_ExtSRAM == 1 ；164<br style="word-wrap:break-word"> LDR R0,= 0x00000114 ；165<br style="word-wrap:break-word"> LDR R1,= 0x40021014 ；166<br style="word-wrap:break-word"> STR R0,[R1] ；167<br style="word-wrap:break-word"> LDR R0,= 0x000001E0 ；168<br style="word-wrap:break-word"> LDR R1,= 0x40021018 ；169<br style="word-wrap:break-word"> STR R0,[R1] ；170<br style="word-wrap:break-word"> LDR R0,= 0x44BB44BB ；171<br style="word-wrap:break-word"> LDR R1,= 0x40011400 ；172<br style="word-wrap:break-word"> STR R0,[R1] ；173<br style="word-wrap:break-word"> LDR R0,= 0xBBBBBBBB ；174<br style="word-wrap:break-word"> LDR R1,= 0x40011404 ；175<br style="word-wrap:break-word"> STR R0,[R1] ；176<br style="word-wrap:break-word"> LDR R0,= 0xB44444BB ；177<br style="word-wrap:break-word"> LDR R1,= 0x40011800 ；178<br style="word-wrap:break-word"> STR R0,[R1] ；179<br style="word-wrap:break-word"> LDR R0,= 0xBBBBBBBB ；180<br style="word-wrap:break-word"> LDR R1,= 0x40011804 ；181<br style="word-wrap:break-word"> STR R0,[R1] ；182<br style="word-wrap:break-word"> LDR R0,= 0x44BBBBBB ；183<br style="word-wrap:break-word"> LDR R1,= 0x40011C00 ；184<br style="word-wrap:break-word"> STR R0,[R1] ；185<br style="word-wrap:break-word"> LDR R0,= 0xBBBB4444 ；186<br style="word-wrap:break-word"> LDR R1,= 0x40011C04 ；187<br style="word-wrap:break-word"> STR R0,[R1] ；188<br style="word-wrap:break-word"> LDR R0,= 0x44BBBBBB ；189<br style="word-wrap:break-word"> LDR R1,= 0x40012000 ；190<br style="word-wrap:break-word"> STR R0,[R1] ；191<br style="word-wrap:break-word"> LDR R0,= 0x44444B44 ；192<br style="word-wrap:break-word"> LDR R1,= 0x40012004 ；193<br style="word-wrap:break-word"> STR R0,[R1] ；194<br style="word-wrap:break-word"> LDR R0,= 0x00001011 ；195<br style="word-wrap:break-word"> LDR R1,= 0xA0000010 ；196<br style="word-wrap:break-word"> STR R0,[R1] ；197<br style="word-wrap:break-word"> LDR R0,= 0x00000200 ；198<br style="word-wrap:break-word"> LDR R1,= 0xA0000014 ；199<br style="word-wrap:break-word"> STR R0,[R1] ；200<br style="word-wrap:break-word"> ENDIF ；201<br style="word-wrap:break-word"> IMPORT __main ；202<br style="word-wrap:break-word"> LDR R0, =__main ；203<br style="word-wrap:break-word"> BX R0 ；204<br style="word-wrap:break-word"> ENDP ；205<br style="word-wrap:break-word"> ALIGN ；206<br style="word-wrap:break-word"> IF :DEF:__MICROLIB ；207<br style="word-wrap:break-word"> EXPORT __initial_sp ；208<br style="word-wrap:break-word"> EXPORT __heap_base ；209<br style="word-wrap:break-word"> EXPORT __heap_limit ；210<br style="word-wrap:break-word"> ELSE ；211<br style="word-wrap:break-word"> IMPORT __use_two_region_memory ；212<br style="word-wrap:break-word"> EXPORT __user_initial_stackheap ；213<br style="word-wrap:break-word"> __user_initial_stackheap ；214<br style="word-wrap:break-word"> LDR R0, = Heap_Mem ；215<br style="word-wrap:break-word"> LDR R1, = (Stack_Mem + Stack_Size) ；216<br style="word-wrap:break-word"> LDR R2, = (Heap_Mem + Heap_Size) ；217<br style="word-wrap:break-word"> LDR R3, = Stack_Mem ；218<br style="word-wrap:break-word"> BX LR ；219<br style="word-wrap:break-word"> ALIGN ；220<br style="word-wrap:break-word"> ENDIF ；221<br style="word-wrap:break-word"> END ；222<br style="word-wrap:break-word"> ENDIF ；223<br style="word-wrap:break-word"> END ；224</span></span></span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="word-wrap:break-word; font-weight:700; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">STM32启动代码一共224行，使用了汇编语言编写。</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="font-family:黑体; word-wrap:break-word; color:rgb(68,68,68); font-size:14px; line-height:21px"><span style="color:#FE3AF7; word-wrap:break-word"><span style="word-wrap:break-word; font-size:20px">以下是分析代码：</span></span></span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">第1行：定义是否使用外部SRAM，为1则使用，为0则表示不使用。此语行若用C语言表达则等价于：</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">#define DATA_IN_ExtSRAM 0</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">第2行：定义栈空间大小为0x00000400个字节，即1Kbyte。此语行亦等价于：</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">#define Stack_Size 0x00000400</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">第3行：伪指令AREA，表示</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">第4行：开辟一段大小为Stack_Size的内存空间作为栈。</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">第5行：标号__initial_sp，表示栈空间顶地址。</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">第6行：定义堆空间大小为0x00000400个字节，也为1Kbyte。</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">第7行：伪指令AREA，表示</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">第8行：标号__heap_base，表示堆空间起始地址。</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">第9行：开辟一段大小为Heap_Size的内存空间作为堆。</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">第10行：标号__heap_limit，表示堆空间结束地址。</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">第11行：告诉编译器使用THUMB指令集。</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">第12行：告诉</span><span id="11_nwp" style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px; width:auto; height:auto; float:none"><a target="_blank" id="11_nwl" href="http://cpro.baidu.com/cpro/ui/uijs.php?adclass=0&amp;app_id=0&amp;c=news&amp;cf=1001&amp;ch=0&amp;di=128&amp;fv=11&amp;is_app=0&amp;jk=b91203fc72c6982d&amp;k=%B1%E0%D2%EB%C6%F7&amp;k0=%B1%E0%D2%EB%C6%F7&amp;kdi0=0&amp;luki=6&amp;n=10&amp;p=baidu&amp;q=98059059_cpr&amp;rb=0&amp;rs=1&amp;seller_id=1&amp;sid=2d98c672fc0312b9&amp;ssp2=1&amp;stid=0&amp;t=tpclicked3_hc&amp;tu=u1831118&amp;u=http%3A%2F%2Fwww%2E51hei%2Ecom%2Fbbs%2Fdpj%2D26674%2D1%2Ehtml&amp;urlid=0" rel="nofollow noopener noreferrer" style="word-wrap:break-word; color:rgb(51,102,153); text-decoration:none"><span style="word-wrap:break-word; color:rgb(0,0,255); width:auto; height:auto">编译器</span></a></span><span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">以8字节对齐。</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">第13—81行：IMPORT指令，指示后续符号是在外部文件定义的（类似C语言中的全局变量</span><span id="10_nwp" style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px; width:auto; height:auto; float:none"><a target="_blank" id="10_nwl" href="http://cpro.baidu.com/cpro/ui/uijs.php?adclass=0&amp;app_id=0&amp;c=news&amp;cf=1001&amp;ch=0&amp;di=128&amp;fv=11&amp;is_app=0&amp;jk=b91203fc72c6982d&amp;k=%C9%F9%C3%F7&amp;k0=%C9%F9%C3%F7&amp;kdi0=0&amp;luki=2&amp;n=10&amp;p=baidu&amp;q=98059059_cpr&amp;rb=0&amp;rs=1&amp;seller_id=1&amp;sid=2d98c672fc0312b9&amp;ssp2=1&amp;stid=0&amp;t=tpclicked3_hc&amp;tu=u1831118&amp;u=http%3A%2F%2Fwww%2E51hei%2Ecom%2Fbbs%2Fdpj%2D26674%2D1%2Ehtml&amp;urlid=0" rel="nofollow noopener noreferrer" style="word-wrap:break-word; color:rgb(51,102,153); text-decoration:none"><span style="word-wrap:break-word; color:rgb(0,0,255); width:auto; height:auto">声明</span></a></span><span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">），而下文可能会使用到这些符号。</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">第82行：定义只读数据段，实际上是在CODE区（假设STM32从FLASH启动，则此中断向量表起始地址即为0x8000000）</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">第83行：将标号__Vectors声明为</span><span id="9_nwp" style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px; width:auto; height:auto; float:none"><a target="_blank" id="9_nwl" href="http://cpro.baidu.com/cpro/ui/uijs.php?adclass=0&amp;app_id=0&amp;c=news&amp;cf=1001&amp;ch=0&amp;di=128&amp;fv=11&amp;is_app=0&amp;jk=b91203fc72c6982d&amp;k=%C8%AB%BE%D6&amp;k0=%C8%AB%BE%D6&amp;kdi0=0&amp;luki=4&amp;n=10&amp;p=baidu&amp;q=98059059_cpr&amp;rb=0&amp;rs=1&amp;seller_id=1&amp;sid=2d98c672fc0312b9&amp;ssp2=1&amp;stid=0&amp;t=tpclicked3_hc&amp;tu=u1831118&amp;u=http%3A%2F%2Fwww%2E51hei%2Ecom%2Fbbs%2Fdpj%2D26674%2D1%2Ehtml&amp;urlid=0" rel="nofollow noopener noreferrer" style="word-wrap:break-word; color:rgb(51,102,153); text-decoration:none"><span style="word-wrap:break-word; color:rgb(0,0,255); width:auto; height:auto">全局</span></a></span><span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">标号，这样外部文件就可以使用这个标号。</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">第84行：标号__Vectors，表示中断向量表入口地址。</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">第85—160行：建立中断向量表。</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">第161行：</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">第162行：复位中断服务程序，PROC…ENDP结构表示程序的开始和结束。</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">第163行：声明复位中断向量Reset_Handler为全局属性，这样外部文件就可以调用此复位中断服务。</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">第164行：IF…ENDIF为预编译结构，判断是否使用外部SRAM，在第1行中已定义为“不使用”。</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">第165—201行：此部分代码的作用是设置FSMC总线以支持SRAM，因不使用外部SRAM因此此部分代码不会被编译。</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">第202行：声明__main标号。</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">第203—204行：跳转__main地址执行。</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">第207行：IF…ELSE…ENDIF结构，判断是否使用DEF:__MICROLIB（此处为不使用）。</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">第208—210行：若使用DEF:__MICROLIB，则将__initial_sp，__heap_base，__heap_limit亦即栈顶地址，堆始末地址赋予全局属性，使外部程序可以使用。</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">第212行：定义</span><span id="8_nwp" style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px; width:auto; height:auto; float:none"><a target="_blank" id="8_nwl" href="http://cpro.baidu.com/cpro/ui/uijs.php?adclass=0&amp;app_id=0&amp;c=news&amp;cf=1001&amp;ch=0&amp;di=128&amp;fv=11&amp;is_app=0&amp;jk=b91203fc72c6982d&amp;k=%C8%AB%BE%D6&amp;k0=%C8%AB%BE%D6&amp;kdi0=0&amp;luki=4&amp;n=10&amp;p=baidu&amp;q=98059059_cpr&amp;rb=0&amp;rs=1&amp;seller_id=1&amp;sid=2d98c672fc0312b9&amp;ssp2=1&amp;stid=0&amp;t=tpclicked3_hc&amp;tu=u1831118&amp;u=http%3A%2F%2Fwww%2E51hei%2Ecom%2Fbbs%2Fdpj%2D26674%2D1%2Ehtml&amp;urlid=0" rel="nofollow noopener noreferrer" style="word-wrap:break-word; color:rgb(51,102,153); text-decoration:none"><span style="word-wrap:break-word; color:rgb(0,0,255); width:auto; height:auto">全局</span></a></span><span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">标号__use_two_region_memory。</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">第213行：</span><span id="7_nwp" style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px; width:auto; height:auto; float:none"><a target="_blank" id="7_nwl" href="http://cpro.baidu.com/cpro/ui/uijs.php?adclass=0&amp;app_id=0&amp;c=news&amp;cf=1001&amp;ch=0&amp;di=128&amp;fv=11&amp;is_app=0&amp;jk=b91203fc72c6982d&amp;k=%C9%F9%C3%F7&amp;k0=%C9%F9%C3%F7&amp;kdi0=0&amp;luki=2&amp;n=10&amp;p=baidu&amp;q=98059059_cpr&amp;rb=0&amp;rs=1&amp;seller_id=1&amp;sid=2d98c672fc0312b9&amp;ssp2=1&amp;stid=0&amp;t=tpclicked3_hc&amp;tu=u1831118&amp;u=http%3A%2F%2Fwww%2E51hei%2Ecom%2Fbbs%2Fdpj%2D26674%2D1%2Ehtml&amp;urlid=0" rel="nofollow noopener noreferrer" style="word-wrap:break-word; color:rgb(51,102,153); text-decoration:none"><span style="word-wrap:break-word; color:rgb(0,0,255); width:auto; height:auto">声明</span></a></span><span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">全局标号__user_initial_stackheap，这样外程序也可调用此标号。</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">第214行：标号__user_initial_stackheap，表示用户堆栈初始化程序入口。</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">第215—218行：分别保存栈顶指针和栈大小，堆始地址和堆大小至R0，R1，R2，R3</span><span id="6_nwp" style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px; width:auto; height:auto; float:none"><a target="_blank" id="6_nwl" href="http://cpro.baidu.com/cpro/ui/uijs.php?adclass=0&amp;app_id=0&amp;c=news&amp;cf=1001&amp;ch=0&amp;di=128&amp;fv=11&amp;is_app=0&amp;jk=b91203fc72c6982d&amp;k=%BC%C4%B4%E6%C6%F7&amp;k0=%BC%C4%B4%E6%C6%F7&amp;kdi0=0&amp;luki=5&amp;n=10&amp;p=baidu&amp;q=98059059_cpr&amp;rb=0&amp;rs=1&amp;seller_id=1&amp;sid=2d98c672fc0312b9&amp;ssp2=1&amp;stid=0&amp;t=tpclicked3_hc&amp;tu=u1831118&amp;u=http%3A%2F%2Fwww%2E51hei%2Ecom%2Fbbs%2Fdpj%2D26674%2D1%2Ehtml&amp;urlid=0" rel="nofollow noopener noreferrer" style="word-wrap:break-word; color:rgb(51,102,153); text-decoration:none"><span style="word-wrap:break-word; color:rgb(0,0,255); width:auto; height:auto">寄存器</span></a></span><span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">。</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">第224行：程序完毕。</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">以上是对启动代码的完整解析</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:#FF0000; word-wrap:break-word; font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"><span style="word-wrap:break-word; font-weight:700"><span style="word-wrap:break-word; font-size:20px">关于启动代码的相关解释：</span></span></span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">1、AREA指令：伪指令，用于定义代码段或数据段，后跟属性标号。其中比较重要的一个标号为“READONLY”或者“READWRITE”，其中“READONLY”表示该段为只读属性，联系到STM32的内部存储介质，可知具有只读属性的段保存于FLASH区，即0x8000000地址后。而“READONLY”表示该段为“可读写”属性，可知“可读写”段保存于SRAM区，即0x2000000地址后。由此可以从第3、7行代码知道，堆栈段位于SRAM空间。从第82行可知，中断向量表放置与FLASH区，而这也是整片启动代码中最先被放进FLASH区的数据。因此可以得到一条重要的信息：0x8000000地址存放的是栈顶地址__initial_sp，0x8000004地址存放的是复位中断向量Reset_Handler（STM32使用32位总线，因此</span><span id="5_nwp" style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px; width:auto; height:auto; float:none"><a target="_blank" id="5_nwl" href="http://cpro.baidu.com/cpro/ui/uijs.php?adclass=0&amp;app_id=0&amp;c=news&amp;cf=1001&amp;ch=0&amp;di=128&amp;fv=11&amp;is_app=0&amp;jk=b91203fc72c6982d&amp;k=%B4%E6%B4%A2&amp;k0=%B4%E6%B4%A2&amp;kdi0=0&amp;luki=1&amp;n=10&amp;p=baidu&amp;q=98059059_cpr&amp;rb=0&amp;rs=1&amp;seller_id=1&amp;sid=2d98c672fc0312b9&amp;ssp2=1&amp;stid=0&amp;t=tpclicked3_hc&amp;tu=u1831118&amp;u=http%3A%2F%2Fwww%2E51hei%2Ecom%2Fbbs%2Fdpj%2D26674%2D1%2Ehtml&amp;urlid=0" rel="nofollow noopener noreferrer" style="word-wrap:break-word; color:rgb(51,102,153); text-decoration:none"><span style="word-wrap:break-word; color:rgb(0,0,255); width:auto; height:auto">存储</span></a></span><span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">空间为4字节对齐）。</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">2、DCD指令：作用是开辟一段空间，其意义等价于C语言中的地址符“&amp;”。因此从第84行开始建立的中断向量表则类似于使用C语言定义了一个指针数组，其每一个成员都是一个函数指针，分别指向各个中断服务函数。</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">3、标号：前文多处使用了“标号”一词。标号主要用于表示一片内存空间的某个位置，等价于C语言中的“地址”概念。地址仅仅表示</span><span id="3_nwp" style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px; width:auto; height:auto; float:none"><a target="_blank" id="3_nwl" href="http://cpro.baidu.com/cpro/ui/uijs.php?adclass=0&amp;app_id=0&amp;c=news&amp;cf=1001&amp;ch=0&amp;di=128&amp;fv=11&amp;is_app=0&amp;jk=b91203fc72c6982d&amp;k=%B4%E6%B4%A2&amp;k0=%B4%E6%B4%A2&amp;kdi0=0&amp;luki=1&amp;n=10&amp;p=baidu&amp;q=98059059_cpr&amp;rb=0&amp;rs=1&amp;seller_id=1&amp;sid=2d98c672fc0312b9&amp;ssp2=1&amp;stid=0&amp;t=tpclicked3_hc&amp;tu=u1831118&amp;u=http%3A%2F%2Fwww%2E51hei%2Ecom%2Fbbs%2Fdpj%2D26674%2D1%2Ehtml&amp;urlid=0" rel="nofollow noopener noreferrer" style="word-wrap:break-word; color:rgb(51,102,153); text-decoration:none"><span style="word-wrap:break-word; color:rgb(0,0,255); width:auto; height:auto">存储</span></a></span><span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">空间的一个位置，从C语言的角度来看，变量的地址，数组的地址或是</span><span id="4_nwp" style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px; width:auto; height:auto; float:none"><a target="_blank" id="4_nwl" href="http://cpro.baidu.com/cpro/ui/uijs.php?adclass=0&amp;app_id=0&amp;c=news&amp;cf=1001&amp;ch=0&amp;di=128&amp;fv=11&amp;is_app=0&amp;jk=b91203fc72c6982d&amp;k=%BA%AF%CA%FD&amp;k0=%BA%AF%CA%FD&amp;kdi0=0&amp;luki=8&amp;n=10&amp;p=baidu&amp;q=98059059_cpr&amp;rb=0&amp;rs=1&amp;seller_id=1&amp;sid=2d98c672fc0312b9&amp;ssp2=1&amp;stid=0&amp;t=tpclicked3_hc&amp;tu=u1831118&amp;u=http%3A%2F%2Fwww%2E51hei%2Ecom%2Fbbs%2Fdpj%2D26674%2D1%2Ehtml&amp;urlid=0" rel="nofollow noopener noreferrer" style="word-wrap:break-word; color:rgb(51,102,153); text-decoration:none"><span style="word-wrap:break-word; color:rgb(0,0,255); width:auto; height:auto">函数</span></a></span><span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">的入口地址在本质上并无区别。</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">4、第202行中的__main标号并不表示C程序中的main函数入口地址，因此第204行也并不是跳转至main函数开始执行C程序。__main标号表示C/C++标准实时库函数里的一个初始化子程序__main的入口地址。该程序的一个主要作用是初始化堆栈（对于程序清单一来说则是跳转__user_initial_stackheap标号进行初始化堆栈的），并初始化映像文件，最后跳转C程序中的main函数。这就解释了为何所有的C程序必须有一个main函数作为程序的起点——因为这是由C/C++标准实时库所规定的——并且不能更改，因为C/C++标准实时库并不对外界开发源代码。因此，实际上在用户可见的前提下，程序在第204行后就跳转至.c文件中的main函数，开始执行C程序了。</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">5.PROC 为子程序开始，ENDP 为子程序结束</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">6.对于main函数的理解</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">事实上，_main和main是两个完全不同的函数！_main代码是</span><span id="1_nwp" style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px; width:auto; height:auto; float:none"><a target="_blank" id="1_nwl" href="http://cpro.baidu.com/cpro/ui/uijs.php?adclass=0&amp;app_id=0&amp;c=news&amp;cf=1001&amp;ch=0&amp;di=128&amp;fv=11&amp;is_app=0&amp;jk=b91203fc72c6982d&amp;k=%B1%E0%D2%EB%C6%F7&amp;k0=%B1%E0%D2%EB%C6%F7&amp;kdi0=0&amp;luki=6&amp;n=10&amp;p=baidu&amp;q=98059059_cpr&amp;rb=0&amp;rs=1&amp;seller_id=1&amp;sid=2d98c672fc0312b9&amp;ssp2=1&amp;stid=0&amp;t=tpclicked3_hc&amp;tu=u1831118&amp;u=http%3A%2F%2Fwww%2E51hei%2Ecom%2Fbbs%2Fdpj%2D26674%2D1%2Ehtml&amp;urlid=0" rel="nofollow noopener noreferrer" style="word-wrap:break-word; color:rgb(51,102,153); text-decoration:none"><span style="word-wrap:break-word; color:rgb(0,0,255); width:auto; height:auto">编译器</span></a></span><span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">自动创建的，因此无法找到_main代码。MDK文档中有一句说明：it isautomatically craated by the linker when it sees a definition ofmain() .大体意思可以理解为：当编译器发现定义了main</span><span id="2_nwp" style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px; width:auto; height:auto; float:none"><a target="_blank" id="2_nwl" href="http://cpro.baidu.com/cpro/ui/uijs.php?adclass=0&amp;app_id=0&amp;c=news&amp;cf=1001&amp;ch=0&amp;di=128&amp;fv=11&amp;is_app=0&amp;jk=b91203fc72c6982d&amp;k=%BA%AF%CA%FD&amp;k0=%BA%AF%CA%FD&amp;kdi0=0&amp;luki=8&amp;n=10&amp;p=baidu&amp;q=98059059_cpr&amp;rb=0&amp;rs=1&amp;seller_id=1&amp;sid=2d98c672fc0312b9&amp;ssp2=1&amp;stid=0&amp;t=tpclicked3_hc&amp;tu=u1831118&amp;u=http%3A%2F%2Fwww%2E51hei%2Ecom%2Fbbs%2Fdpj%2D26674%2D1%2Ehtml&amp;urlid=0" rel="nofollow noopener noreferrer" style="word-wrap:break-word; color:rgb(51,102,153); text-decoration:none"><span style="word-wrap:break-word; color:rgb(0,0,255); width:auto; height:auto">函数</span></a></span><span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">，那么就会自动创建_main</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">_main 和main的关系</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">_main 主要做两件事：其一，C所需的资源；其二，调用main函数。这就不难理解为什么在启动代码调用的是_main，最后却能转到main函数中去执行的原因了。</span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:#FF0000; word-wrap:break-word; font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"><span style="word-wrap:break-word; font-size:24px"><span style="word-wrap:break-word"><span style="word-wrap:break-word; font-weight:700"><span style="word-wrap:break-word; font-size:22px">下面总结一下启动过程：</span></span></span></span></span><br style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px"> <span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">首先对栈和堆的大小进行定义，并在代码区的起始处建立中断向量表，其第一个表项是栈顶地址，第二个表项是复位中断服务入口地址。然后在复位中断服务程序中跳转¬¬C/C++标准实时库的__main</span><span id="0_nwp" style="word-wrap:break-word; color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px; width:auto; height:auto; float:none"><a target="_blank" id="0_nwl" href="http://cpro.baidu.com/cpro/ui/uijs.php?adclass=0&amp;app_id=0&amp;c=news&amp;cf=1001&amp;ch=0&amp;di=128&amp;fv=11&amp;is_app=0&amp;jk=b91203fc72c6982d&amp;k=%BA%AF%CA%FD&amp;k0=%BA%AF%CA%FD&amp;kdi0=0&amp;luki=8&amp;n=10&amp;p=baidu&amp;q=98059059_cpr&amp;rb=0&amp;rs=1&amp;seller_id=1&amp;sid=2d98c672fc0312b9&amp;ssp2=1&amp;stid=0&amp;t=tpclicked3_hc&amp;tu=u1831118&amp;u=http%3A%2F%2Fwww%2E51hei%2Ecom%2Fbbs%2Fdpj%2D26674%2D1%2Ehtml&amp;urlid=0" rel="nofollow noopener noreferrer" style="word-wrap:break-word; color:rgb(51,102,153); text-decoration:none"><span style="word-wrap:break-word; color:rgb(0,0,255); width:auto; height:auto">函数</span></a></span><span style="color:rgb(68,68,68); font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:21px">，完成用户堆栈等的初始化后，跳转.c文件中的main函数开始执行C程序。假设STM32被设置为从内部FLASH启动（这也是最常见的一种情况），中断向量表起始地位为0x8000000，则栈顶地址存放于0x8000000处，而复位中断服务入口地址存放于0x8000004处。当STM32遇到复位信号后，则从0x80000004处取出复位中断服务入口地址，继而执行复位中断服务程序，然后跳转__main函数，最后进入mian函数，来到C的世界！！</span><br> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4de2656ab9b15eb590d000e05268181f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">mysql下sql语句 update 字段=字段&#43;字符串 拼接</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/330ff2b3c0f161578d9bda5e96da6654/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">向右滑动返回上一级界面</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>