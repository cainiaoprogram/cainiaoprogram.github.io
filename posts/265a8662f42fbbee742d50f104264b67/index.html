<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>[深度学习]-基于tensorflow的CNN和RNN-LSTM文本情感分析对比 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="[深度学习]-基于tensorflow的CNN和RNN-LSTM文本情感分析对比" />
<meta property="og:description" content="基于tensorflow的CNN和LSTM文本情感分析对比 1. 背景介绍2. 数据集介绍2.0 wordsList.npy2.1 wordVectors.npy2.2 idsMatrix.npy2.2.0 文本预处理2.2.0 为什么把词转化为词向量 2.3 Helper Functions 3. RNN网络训练4. CNN网络训练5. CNN与RNN训练结果对比6. 循环神经网络系列参考文献 1. 背景介绍 如今科技日益发展、网络技术不断深入到大众生活中，贴吧、网站、电子邮件，用户评论等使得人们有更多的便捷方式在网络中发表自己的意见和看法。这些数量庞大的文本中的情感信息有着极大的研究价值和实用价值。而如何能够从众多文本信息和数据中准确而高效地分析出文本中所蕴含的情感，并判断情感极性，对情感做出分类，是目前自然语言处理中的一个热门研究课题。关于文本情感分析，在此之前国内外专家和学者们都已经做了大量的研究，其中运用深度学习来对文本进行情感分析是常用的文本情感分析方法。神经网络模型通过学习和训练后，能有效地模拟人脑的学习方式，对大量的输入文本信息进行高效的分析，并对文本中的情感进行判断，非常适合用于文本情感分析的研究中。
2. 数据集介绍 Google 已经帮助我们在大规模数据集上训练出来了 Word2Vec 模型，它包括 1000 亿个不同的词，在这个模型中，谷歌能创建300万个词向量，每个向量维度为 300。在理想情况下，我们将使用这些向量来构建模型，但是因为这个单词向量矩阵太大了**（3.6G**），因此在此次研究中我们将使用一个更加易于管理的矩阵，该矩阵由 GloVe 进行训练得到。矩阵将包含 400000 个词向量，每个向量的维数为 50。
我们将导入两个不同的数据结构，一个是包含 400000 个单词的 Python 列表（wordsList.npy），一个是包含所有单词向量值的 400000*50 维的嵌入矩阵 （wordVectors.npy）。
数据和代码可以从下面连接中下载
https://github.com/adeshpande3/LSTM-Sentiment-Analysis
如果上面数据集无法下载，可以通过下面我的百度网盘下载
链接：https://pan.baidu.com/s/1O-tGXFt4z9-CbzzJ0CTRkA
提取码：lj20
2.0 wordsList.npy 一个是包含 400000 个单词的 Python 列表，它里面每个单词对应的位置就是 wordVectors里相应词向量的位置
例子：如果我们要查找baseball这个词的相应词向量
import numpy as np import tensorflow as tf import os as os import matplotlib." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/265a8662f42fbbee742d50f104264b67/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-05-03T17:01:03+08:00" />
<meta property="article:modified_time" content="2020-05-03T17:01:03+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">[深度学习]-基于tensorflow的CNN和RNN-LSTM文本情感分析对比</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>基于tensorflow的CNN和LSTM文本情感分析对比</h4> 
 <ul><li><ul><li><a href="#1__1" rel="nofollow">1. 背景介绍</a></li><li><a href="#2__4" rel="nofollow">2. 数据集介绍</a></li><li><ul><li><a href="#20_wordsListnpy_16" rel="nofollow">2.0 wordsList.npy</a></li><li><a href="#21_wordVectorsnpy_59" rel="nofollow">2.1 wordVectors.npy</a></li><li><a href="#22__idsMatrixnpy_99" rel="nofollow">2.2 idsMatrix.npy</a></li><li><ul><li><a href="#220__161" rel="nofollow">2.2.0 文本预处理</a></li><li><a href="#220__168" rel="nofollow">2.2.0 为什么把词转化为词向量</a></li></ul> 
    </li><li><a href="#23_Helper_Functions_180" rel="nofollow">2.3 Helper Functions</a></li></ul> 
   </li><li><a href="#3_RNN_215" rel="nofollow">3. RNN网络训练</a></li><li><a href="#4_CNN_303" rel="nofollow">4. CNN网络训练</a></li><li><a href="#5_CNNRNN_305" rel="nofollow">5. CNN与RNN训练结果对比</a></li><li><a href="#6__308" rel="nofollow">6. 循环神经网络系列</a></li><li><a href="#_317" rel="nofollow">参考文献</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="1__1"></a>1. 背景介绍</h3> 
<p>如今科技日益发展、网络技术不断深入到大众生活中，贴吧、网站、电子邮件，用户评论等使得人们有更多的便捷方式在网络中发表自己的意见和看法。这些数量庞大的文本中的情感信息有着极大的研究价值和实用价值。而如何能够从众多文本信息和数据中准确而高效地分析出文本中所蕴含的情感，并判断情感极性，对情感做出分类，是目前自然语言处理中的一个热门研究课题。关于文本情感分析，在此之前国内外专家和学者们都已经做了大量的研究，其中运用深度学习来对文本进行情感分析是常用的文本情感分析方法。神经网络模型通过学习和训练后，能有效地模拟人脑的学习方式，对大量的输入文本信息进行高效的分析，并对文本中的情感进行判断，非常适合用于文本情感分析的研究中。</p> 
<h3><a id="2__4"></a>2. 数据集介绍</h3> 
<p>Google 已经帮助我们在大规模数据集上训练出来了 <strong>Word2Vec</strong> 模型，它包括 1000 亿个不同的词，在这个模型中，谷歌能创建300万个词向量，每个向量维度为 <strong>300</strong>。在理想情况下，我们将使用这些向量来构建模型，但是因为这个单词向量矩阵太大了**（3.6G**），因此在此次研究中我们将使用一个更加易于管理的矩阵，<mark>该矩阵由 <strong>GloVe</strong> 进行训练得到。矩阵将包含 400000 个词向量，每个向量的维数为 50</mark>。</p> 
<p>我们将导入两个不同的数据结构，一个是包含 400000 个单词的 Python 列表（wordsList.npy），一个是包含所有单词向量值的 400000*50 维的嵌入矩阵 （wordVectors.npy）。</p> 
<p><strong>数据和代码可以从下面连接中下载</strong><br> https://github.com/adeshpande3/LSTM-Sentiment-Analysis<br> <img src="https://images2.imgbox.com/fb/78/DQsVuL8G_o.png" alt="在这里插入图片描述"><br> <mark>如果上面数据集无法下载，可以通过下面我的百度网盘下载</mark><br> 链接：https://pan.baidu.com/s/1O-tGXFt4z9-CbzzJ0CTRkA<br> 提取码：lj20</p> 
<h4><a id="20_wordsListnpy_16"></a>2.0 wordsList.npy</h4> 
<p>一个是包含 <strong>400000</strong> 个单词的 Python 列表，它里面每个单词对应的位置就是 wordVectors里相应词向量的位置<br> 例子：如果我们要查找baseball这个词的相应词向量</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf
<span class="token keyword">import</span> os <span class="token keyword">as</span> os
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">from</span> os <span class="token keyword">import</span> listdir
wordsList <span class="token operator">=</span> np<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">'./training_data/wordsList.npy'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Loaded the word list!'</span><span class="token punctuation">)</span>

wordsList <span class="token operator">=</span> wordsList<span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># Originally loaded as numpy array</span>
wordsList <span class="token operator">=</span> <span class="token punctuation">[</span>word<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'UTF-8'</span><span class="token punctuation">)</span> <span class="token keyword">for</span> word <span class="token keyword">in</span> wordsList<span class="token punctuation">]</span>  <span class="token comment"># Encode words as UTF-8</span>
wordVectors <span class="token operator">=</span> np<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">'./training_data/wordVectors.npy'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Loaded the word vectors!'</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>wordsList<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># print(wordsList)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>wordVectors<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>

baseballIndex <span class="token operator">=</span> wordsList<span class="token punctuation">.</span>index<span class="token punctuation">(</span><span class="token string">'baseball'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>baseballIndex<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>wordVectors<span class="token punctuation">[</span>baseballIndex<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p>执行结果</p> 
<pre><code class="prism language-python">Loaded the word <span class="token builtin">list</span>!
Loaded the word vectors!
<span class="token number">400000</span>
<span class="token punctuation">(</span><span class="token number">400000</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>
<span class="token number">1444</span>
<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1.9327</span>    <span class="token number">1.0421</span>   <span class="token operator">-</span><span class="token number">0.78515</span>   <span class="token number">0.91033</span>   <span class="token number">0.22711</span>  <span class="token operator">-</span><span class="token number">0.62158</span>  <span class="token operator">-</span><span class="token number">1.6493</span>
  <span class="token number">0.07686</span>  <span class="token operator">-</span><span class="token number">0.5868</span>    <span class="token number">0.058831</span>  <span class="token number">0.35628</span>   <span class="token number">0.68916</span>  <span class="token operator">-</span><span class="token number">0.50598</span>   <span class="token number">0.70473</span>
  <span class="token number">1.2664</span>   <span class="token operator">-</span><span class="token number">0.40031</span>  <span class="token operator">-</span><span class="token number">0.020687</span>  <span class="token number">0.80863</span>  <span class="token operator">-</span><span class="token number">0.90566</span>  <span class="token operator">-</span><span class="token number">0.074054</span> <span class="token operator">-</span><span class="token number">0.87675</span>
 <span class="token operator">-</span><span class="token number">0.6291</span>   <span class="token operator">-</span><span class="token number">0.12685</span>   <span class="token number">0.11524</span>  <span class="token operator">-</span><span class="token number">0.55685</span>  <span class="token operator">-</span><span class="token number">1.6826</span>   <span class="token operator">-</span><span class="token number">0.26291</span>   <span class="token number">0.22632</span>
  <span class="token number">0.713</span>    <span class="token operator">-</span><span class="token number">1.0828</span>    <span class="token number">2.1231</span>    <span class="token number">0.49869</span>   <span class="token number">0.066711</span> <span class="token operator">-</span><span class="token number">0.48226</span>  <span class="token operator">-</span><span class="token number">0.17897</span>
  <span class="token number">0.47699</span>   <span class="token number">0.16384</span>   <span class="token number">0.16537</span>  <span class="token operator">-</span><span class="token number">0.11506</span>  <span class="token operator">-</span><span class="token number">0.15962</span>  <span class="token operator">-</span><span class="token number">0.94926</span>  <span class="token operator">-</span><span class="token number">0.42833</span>
 <span class="token operator">-</span><span class="token number">0.59457</span>   <span class="token number">1.3566</span>   <span class="token operator">-</span><span class="token number">0.27506</span>   <span class="token number">0.19918</span>  <span class="token operator">-</span><span class="token number">0.36008</span>   <span class="token number">0.55667</span>  <span class="token operator">-</span><span class="token number">0.70315</span>
  <span class="token number">0.17157</span> <span class="token punctuation">]</span>
</code></pre> 
<h4><a id="21_wordVectorsnpy_59"></a>2.1 wordVectors.npy</h4> 
<p>一个是包含所有单词向量值的 <strong>400000*5</strong>0 维的嵌入矩阵<br> 假如我们有这么一句话“<strong>I thought the movie was incredible and inspiring</strong>” ，一个10个词，那么它们在wordVectors中的词向量是什么？<br> 代码实现去查找它们相应的词向量</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf
<span class="token keyword">import</span> os <span class="token keyword">as</span> os
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">from</span> os <span class="token keyword">import</span> listdir
wordsList <span class="token operator">=</span> np<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">'./training_data/wordsList.npy'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Loaded the word list!'</span><span class="token punctuation">)</span>

wordsList <span class="token operator">=</span> wordsList<span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># Originally loaded as numpy array</span>
wordsList <span class="token operator">=</span> <span class="token punctuation">[</span>word<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'UTF-8'</span><span class="token punctuation">)</span> <span class="token keyword">for</span> word <span class="token keyword">in</span> wordsList<span class="token punctuation">]</span>  <span class="token comment"># Encode words as UTF-8</span>
wordVectors <span class="token operator">=</span> np<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">'./training_data/wordVectors.npy'</span><span class="token punctuation">)</span>
maxSeqLength <span class="token operator">=</span> <span class="token number">10</span>  <span class="token comment"># Maximum length of sentence</span>
numDimensions <span class="token operator">=</span> <span class="token number">300</span>  <span class="token comment"># Dimensions for each word vector</span>
firstSentence <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>maxSeqLength<span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'int32'</span><span class="token punctuation">)</span>
firstSentence<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> wordsList<span class="token punctuation">.</span>index<span class="token punctuation">(</span><span class="token string">"i"</span><span class="token punctuation">)</span>
firstSentence<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> wordsList<span class="token punctuation">.</span>index<span class="token punctuation">(</span><span class="token string">"thought"</span><span class="token punctuation">)</span>
firstSentence<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> wordsList<span class="token punctuation">.</span>index<span class="token punctuation">(</span><span class="token string">"the"</span><span class="token punctuation">)</span>
firstSentence<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> wordsList<span class="token punctuation">.</span>index<span class="token punctuation">(</span><span class="token string">"movie"</span><span class="token punctuation">)</span>
firstSentence<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> wordsList<span class="token punctuation">.</span>index<span class="token punctuation">(</span><span class="token string">"was"</span><span class="token punctuation">)</span>
firstSentence<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> wordsList<span class="token punctuation">.</span>index<span class="token punctuation">(</span><span class="token string">"incredible"</span><span class="token punctuation">)</span>
firstSentence<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> wordsList<span class="token punctuation">.</span>index<span class="token punctuation">(</span><span class="token string">"and"</span><span class="token punctuation">)</span>
firstSentence<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> wordsList<span class="token punctuation">.</span>index<span class="token punctuation">(</span><span class="token string">"inspiring"</span><span class="token punctuation">)</span>
<span class="token comment"># firstSentence[8] and firstSentence[9] are going to be 0</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>firstSentence<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>firstSentence<span class="token punctuation">)</span>  <span class="token comment"># Shows the row index for each word</span>
<span class="token keyword">with</span> tf<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sess<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>embedding_lookup<span class="token punctuation">(</span>wordVectors<span class="token punctuation">,</span> firstSentence<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
</code></pre> 
<p>执行结果</p> 
<pre><code class="prism language-python"><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span>    <span class="token number">41</span>    <span class="token number">804</span> <span class="token number">201534</span>   <span class="token number">1005</span>     <span class="token number">15</span>   <span class="token number">7446</span>      <span class="token number">5</span>  <span class="token number">13767</span>      <span class="token number">0</span>      <span class="token number">0</span><span class="token punctuation">]</span>
<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="22__idsMatrixnpy_99"></a>2.2 idsMatrix.npy</h4> 
<p><strong>IMDB</strong>（Internet Movie Database互联网电影数据库）数据集，我们在这个数据集上做的训练和测试。<mark>这个数据集包含 25000 条电影数据，其中 12500 条正向数据在positiveReviews目录下，12500 条负向数据在negativeReviews目录下。我们将25000个文本中的23000个文本评论作为训练集，将剩下的2000个文本评论作为测试集</mark>。</p> 
<p>下面代码是把positiveReviews和negativeReviews目录下电影评论数据转化为Numpy的数据集<br> <strong>25000 x 250</strong>, 一共25000条电影评论，最长的评论有250单词</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf
<span class="token keyword">import</span> os <span class="token keyword">as</span> os
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">from</span> os <span class="token keyword">import</span> listdir

file_path <span class="token operator">=</span> <span class="token string">'D:/BaiduNetdiskDownload/'</span>
positiveReviews_path <span class="token operator">=</span> file_path<span class="token operator">+</span><span class="token string">'positiveReviews/'</span>
negativeReviews_path <span class="token operator">=</span> file_path <span class="token operator">+</span><span class="token string">'negativeReviews/'</span>
positiveFiles <span class="token operator">=</span> <span class="token punctuation">[</span>positiveReviews_path <span class="token operator">+</span> f <span class="token keyword">for</span> f <span class="token keyword">in</span> listdir<span class="token punctuation">(</span>positiveReviews_path<span class="token punctuation">)</span> <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isfile<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>positiveReviews_path<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
negativeFiles <span class="token operator">=</span> <span class="token punctuation">[</span>negativeReviews_path <span class="token operator">+</span> f <span class="token keyword">for</span> f <span class="token keyword">in</span> listdir<span class="token punctuation">(</span>negativeReviews_path<span class="token punctuation">)</span> <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isfile<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>negativeReviews_path<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

wordsList <span class="token operator">=</span> np<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">'./training_data/wordsList.npy'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Loaded the word list!'</span><span class="token punctuation">)</span>

wordsList <span class="token operator">=</span> wordsList<span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># Originally loaded as numpy array</span>
wordsList <span class="token operator">=</span> <span class="token punctuation">[</span>word<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'UTF-8'</span><span class="token punctuation">)</span> <span class="token keyword">for</span> word <span class="token keyword">in</span> wordsList<span class="token punctuation">]</span>  <span class="token comment"># Encode words as UTF-8</span>

maxSeqLength <span class="token operator">=</span> <span class="token number">250</span>

ids <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">25000</span><span class="token punctuation">,</span> maxSeqLength<span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'int32'</span><span class="token punctuation">)</span>
fileCounter <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">for</span> pf <span class="token keyword">in</span> positiveFiles<span class="token punctuation">:</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>pf<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        indexCounter <span class="token operator">=</span> <span class="token number">0</span>
        line<span class="token operator">=</span>f<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span>
        cleanedLine <span class="token operator">=</span> cleanSentences<span class="token punctuation">(</span>line<span class="token punctuation">)</span>
        split <span class="token operator">=</span> cleanedLine<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> word <span class="token keyword">in</span> split<span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                ids<span class="token punctuation">[</span>fileCounter<span class="token punctuation">]</span><span class="token punctuation">[</span>indexCounter<span class="token punctuation">]</span> <span class="token operator">=</span> wordsList<span class="token punctuation">.</span>index<span class="token punctuation">(</span>word<span class="token punctuation">)</span>
            <span class="token keyword">except</span> ValueError<span class="token punctuation">:</span>
                ids<span class="token punctuation">[</span>fileCounter<span class="token punctuation">]</span><span class="token punctuation">[</span>indexCounter<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">399999</span> <span class="token comment">#Vector for unkown words</span>
            indexCounter <span class="token operator">=</span> indexCounter <span class="token operator">+</span> <span class="token number">1</span>
            <span class="token keyword">if</span> indexCounter <span class="token operator">&gt;=</span> maxSeqLength<span class="token punctuation">:</span>
                <span class="token keyword">break</span>
    fileCounter <span class="token operator">=</span> fileCounter <span class="token operator">+</span> <span class="token number">1</span>
<span class="token keyword">for</span> nf <span class="token keyword">in</span> negativeFiles<span class="token punctuation">:</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>nf<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        indexCounter <span class="token operator">=</span> <span class="token number">0</span>
        line<span class="token operator">=</span>f<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span>
        cleanedLine <span class="token operator">=</span> cleanSentences<span class="token punctuation">(</span>line<span class="token punctuation">)</span>
        split <span class="token operator">=</span> cleanedLine<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> word <span class="token keyword">in</span> split<span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                ids<span class="token punctuation">[</span>fileCounter<span class="token punctuation">]</span><span class="token punctuation">[</span>indexCounter<span class="token punctuation">]</span> <span class="token operator">=</span> wordsList<span class="token punctuation">.</span>index<span class="token punctuation">(</span>word<span class="token punctuation">)</span>
            <span class="token keyword">except</span> ValueError<span class="token punctuation">:</span>
                ids<span class="token punctuation">[</span>fileCounter<span class="token punctuation">]</span><span class="token punctuation">[</span>indexCounter<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">399999</span> <span class="token comment">#Vector for unkown words</span>
            indexCounter <span class="token operator">=</span> indexCounter <span class="token operator">+</span> <span class="token number">1</span>
            <span class="token keyword">if</span> indexCounter <span class="token operator">&gt;=</span> maxSeqLength<span class="token punctuation">:</span>
                <span class="token keyword">break</span>
        fileCounter <span class="token operator">=</span> fileCounter <span class="token operator">+</span> <span class="token number">1</span>

np<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">'idsMatrix'</span><span class="token punctuation">,</span> ids<span class="token punctuation">)</span>
</code></pre> 
<h5><a id="220__161"></a>2.2.0 文本预处理</h5> 
<p>文本预处理<br> <img src="https://images2.imgbox.com/8d/94/CrliOAjX_o.png" alt="在这里插入图片描述"><br> 输入文本，在将输入文本转化成向量之前，我们需要将标点符号、括号、问号等删去，只留下字母、数字和字符, 同时将大写字母转化为小写。</p> 
<p>效果如下图<br> <img src="https://images2.imgbox.com/cc/98/Q0CXeEwD_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="220__168"></a>2.2.0 为什么把词转化为词向量</h5> 
<p>我们希望创建这种词向量的方式是可以表示单词及其在上下文中意义的。例如，我们希望单词 “love” 和 “adore” 这两个词在向量空间中是有一定的相关性的，因为他们的意思相似，而且都在类似的上下文中使用，因此他们的空间相距距离会相对较小。而“love”、“adore”这两个单词与单词“baseball”的意思有很大的不同，词性也不相同，那么“love”、“adore”这两个单词的向量与单词“baseball”的向量相距距离就会相对较大。单词的向量表示也被称之为词嵌入。</p> 
<p><img src="https://images2.imgbox.com/63/1c/5S684ckm_o.png" alt="在这里插入图片描述"><br> 为了得到这些词嵌入，我们采用一个很著名的模型 “Word2Vec”。“Word2Vec”是近几年很火的算法，它通过神经网络机器学习算法来训练N-gram 语言模型，并在训练过程中求出word所对应的vector的方法。它是将词表征为实数值向量的一种高效的算法模型，其利用深度学习的思想，可以通过训练，把对文本内容的处理简化为 K 维向量空间中的向量运算，而向量空间上的相似度可以用来表示文本语义上的相似。在这个模型中，每个词的词向量是根据上下文的语境来进行推断的，如果两个词在上下文的语境中可以被互换，那么这就表示这两个词的意思相似，词性相似，那么他们的词向量中相距距离就非常近。在自然语言中，上下文的语境对分析词语的意义是非常重要的。</p> 
<p>简单来说，Word2Vec这个模型的作用就是从一大堆句子（以 Wikipedia 为例）中为每个独一无二的单词进行建模，并且输出一个唯一的向量，Word2Vec 模型的输出被称为一个嵌入矩阵。该嵌入矩阵将包含训练语料库中每个不同单词的向量。 传统上，嵌入矩阵可以包含超过300万个单词向量。</p> 
<p>Word2Vec模型是通过对数据集中的每个句子进行训练，在其上滑动一个固定大小的窗口，并试图预测窗口的中心词，给出其他词。使用损失函数和优化程序，该模型为每个唯一字生成向量。这个训练过程的细节可能会变得有点复杂，所以我们现在要跳过细节，但这里主要的一点是，任何深度学习方法对于NLP任务的输入可能都会有单词向量作为输入。</p> 
<p>Google 已经帮助我们在大规模数据集上训练出来了 Word2Vec 模型，它包括 1000 亿个不同的词，在这个模型中，谷歌能创建300万个词向量，每个向量维度为 300。在理想情况下，我们将使用这些向量来构建模型，但是因为这个单词向量矩阵太大了（3.6G），因此在此次研究中我们将使用一个更加易于管理的矩阵，该矩阵由 GloVe 进行训练得到。矩阵将包含 400000 个词向量，每个向量的维数为 50</p> 
<h4><a id="23_Helper_Functions_180"></a>2.3 Helper Functions</h4> 
<pre><code class="prism language-python"><span class="token keyword">from</span> random <span class="token keyword">import</span> randint
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

maxSeqLength <span class="token operator">=</span> <span class="token number">250</span>
batchSize <span class="token operator">=</span> <span class="token number">24</span>
ids <span class="token operator">=</span> np<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">'./training_data/idsMatrix.npy'</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">getTrainBatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    labels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    arr <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span>batchSize<span class="token punctuation">,</span> maxSeqLength<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>batchSize<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            num <span class="token operator">=</span> randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">11499</span><span class="token punctuation">)</span>
            labels<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            num <span class="token operator">=</span> randint<span class="token punctuation">(</span><span class="token number">13499</span><span class="token punctuation">,</span><span class="token number">24999</span><span class="token punctuation">)</span>
            labels<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> ids<span class="token punctuation">[</span>num<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>num<span class="token punctuation">]</span>
    <span class="token keyword">return</span> arr<span class="token punctuation">,</span> labels

<span class="token keyword">def</span> <span class="token function">getTestBatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    labels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    arr <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span>batchSize<span class="token punctuation">,</span> maxSeqLength<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>batchSize<span class="token punctuation">)</span><span class="token punctuation">:</span>
        num <span class="token operator">=</span> randint<span class="token punctuation">(</span><span class="token number">11499</span><span class="token punctuation">,</span><span class="token number">13499</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>num <span class="token operator">&lt;=</span> <span class="token number">12499</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            labels<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            labels<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> ids<span class="token punctuation">[</span>num<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>num<span class="token punctuation">]</span>
    <span class="token keyword">return</span> arr<span class="token punctuation">,</span> labels
</code></pre> 
<h3><a id="3_RNN_215"></a>3. RNN网络训练</h3> 
<pre><code class="prism language-python"><span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> datetime
<span class="token keyword">from</span> random <span class="token keyword">import</span> randint

maxSeqLength <span class="token operator">=</span> <span class="token number">250</span>
batchSize <span class="token operator">=</span> <span class="token number">24</span>
lstmUnits <span class="token operator">=</span> <span class="token number">64</span>
numClasses <span class="token operator">=</span> <span class="token number">2</span>
iterations <span class="token operator">=</span> <span class="token number">100000</span>
numDimensions <span class="token operator">=</span> <span class="token number">50</span> <span class="token comment">#Dimensions for each word vector</span>

maxSeqLength <span class="token operator">=</span> <span class="token number">250</span>
batchSize <span class="token operator">=</span> <span class="token number">24</span>
ids <span class="token operator">=</span> np<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">'./training_data/idsMatrix.npy'</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">getTrainBatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    labels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    arr <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span>batchSize<span class="token punctuation">,</span> maxSeqLength<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>batchSize<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            num <span class="token operator">=</span> randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">11499</span><span class="token punctuation">)</span>
            labels<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            num <span class="token operator">=</span> randint<span class="token punctuation">(</span><span class="token number">13499</span><span class="token punctuation">,</span><span class="token number">24999</span><span class="token punctuation">)</span>
            labels<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> ids<span class="token punctuation">[</span>num<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>num<span class="token punctuation">]</span>
    <span class="token keyword">return</span> arr<span class="token punctuation">,</span> labels


wordVectors <span class="token operator">=</span> np<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">'./training_data/wordVectors.npy'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Loaded the word vectors!'</span><span class="token punctuation">)</span>

tf<span class="token punctuation">.</span>reset_default_graph<span class="token punctuation">(</span><span class="token punctuation">)</span>

labels <span class="token operator">=</span> tf<span class="token punctuation">.</span>placeholder<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">,</span> <span class="token punctuation">[</span>batchSize<span class="token punctuation">,</span> numClasses<span class="token punctuation">]</span><span class="token punctuation">)</span>
input_data <span class="token operator">=</span> tf<span class="token punctuation">.</span>placeholder<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>int32<span class="token punctuation">,</span> <span class="token punctuation">[</span>batchSize<span class="token punctuation">,</span> maxSeqLength<span class="token punctuation">]</span><span class="token punctuation">)</span>

data <span class="token operator">=</span> tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span>batchSize<span class="token punctuation">,</span> maxSeqLength<span class="token punctuation">,</span> numDimensions<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>dtype<span class="token operator">=</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
data <span class="token operator">=</span> tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>embedding_lookup<span class="token punctuation">(</span>wordVectors<span class="token punctuation">,</span> input_data<span class="token punctuation">)</span>

lstmCell <span class="token operator">=</span> tf<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>rnn<span class="token punctuation">.</span>BasicLSTMCell<span class="token punctuation">(</span>lstmUnits<span class="token punctuation">)</span>
lstmCell <span class="token operator">=</span> tf<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>rnn<span class="token punctuation">.</span>DropoutWrapper<span class="token punctuation">(</span>cell<span class="token operator">=</span>lstmCell<span class="token punctuation">,</span> output_keep_prob<span class="token operator">=</span><span class="token number">0.75</span><span class="token punctuation">)</span>
value<span class="token punctuation">,</span> _ <span class="token operator">=</span> tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>dynamic_rnn<span class="token punctuation">(</span>lstmCell<span class="token punctuation">,</span> data<span class="token punctuation">,</span> dtype<span class="token operator">=</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>

weight <span class="token operator">=</span> tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>truncated_normal<span class="token punctuation">(</span><span class="token punctuation">[</span>lstmUnits<span class="token punctuation">,</span> numClasses<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
bias <span class="token operator">=</span> tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">,</span> shape<span class="token operator">=</span><span class="token punctuation">[</span>numClasses<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
value <span class="token operator">=</span> tf<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
last <span class="token operator">=</span> tf<span class="token punctuation">.</span>gather<span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span>get_shape<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
prediction <span class="token operator">=</span> <span class="token punctuation">(</span>tf<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>last<span class="token punctuation">,</span> weight<span class="token punctuation">)</span> <span class="token operator">+</span> bias<span class="token punctuation">)</span>

correctPred <span class="token operator">=</span> tf<span class="token punctuation">.</span>equal<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>prediction<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> tf<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>labels<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
accuracy <span class="token operator">=</span> tf<span class="token punctuation">.</span>reduce_mean<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>cast<span class="token punctuation">(</span>correctPred<span class="token punctuation">,</span> tf<span class="token punctuation">.</span>float32<span class="token punctuation">)</span><span class="token punctuation">)</span>

loss <span class="token operator">=</span> tf<span class="token punctuation">.</span>reduce_mean<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>softmax_cross_entropy_with_logits<span class="token punctuation">(</span>logits<span class="token operator">=</span>prediction<span class="token punctuation">,</span> labels<span class="token operator">=</span>labels<span class="token punctuation">)</span><span class="token punctuation">)</span>
optimizer <span class="token operator">=</span> tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>AdamOptimizer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>minimize<span class="token punctuation">(</span>loss<span class="token punctuation">)</span>

tf<span class="token punctuation">.</span>summary<span class="token punctuation">.</span>scalar<span class="token punctuation">(</span><span class="token string">'Loss'</span><span class="token punctuation">,</span> loss<span class="token punctuation">)</span>
tf<span class="token punctuation">.</span>summary<span class="token punctuation">.</span>scalar<span class="token punctuation">(</span><span class="token string">'Accuracy'</span><span class="token punctuation">,</span> accuracy<span class="token punctuation">)</span>
merged <span class="token operator">=</span> tf<span class="token punctuation">.</span>summary<span class="token punctuation">.</span>merge_all<span class="token punctuation">(</span><span class="token punctuation">)</span>
logdir <span class="token operator">=</span> <span class="token string">"tensorboard/"</span> <span class="token operator">+</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">"%Y%m%d-%H%M%S"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"/"</span>


sess <span class="token operator">=</span> tf<span class="token punctuation">.</span>InteractiveSession<span class="token punctuation">(</span><span class="token punctuation">)</span>
saver <span class="token operator">=</span> tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>Saver<span class="token punctuation">(</span><span class="token punctuation">)</span>
sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>global_variables_initializer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

writer <span class="token operator">=</span> tf<span class="token punctuation">.</span>summary<span class="token punctuation">.</span>FileWriter<span class="token punctuation">(</span>logdir<span class="token punctuation">,</span> sess<span class="token punctuation">.</span>graph<span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>iterations<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#Next Batch of reviews</span>
    nextBatch<span class="token punctuation">,</span> nextBatchLabels <span class="token operator">=</span> getTrainBatch<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>optimizer<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>input_data<span class="token punctuation">:</span> nextBatch<span class="token punctuation">,</span> labels<span class="token punctuation">:</span> nextBatchLabels<span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">#Write summary to Tensorboard</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">50</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        summary <span class="token operator">=</span> sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>merged<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>input_data<span class="token punctuation">:</span> nextBatch<span class="token punctuation">,</span> labels<span class="token punctuation">:</span> nextBatchLabels<span class="token punctuation">}</span><span class="token punctuation">)</span>
        writer<span class="token punctuation">.</span>add_summary<span class="token punctuation">(</span>summary<span class="token punctuation">,</span> i<span class="token punctuation">)</span>

    <span class="token comment">#Save the network every 10,000 training iterations</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">10000</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">and</span> i <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        save_path <span class="token operator">=</span> saver<span class="token punctuation">.</span>save<span class="token punctuation">(</span>sess<span class="token punctuation">,</span> <span class="token string">"models/pretrained_lstm.ckpt"</span><span class="token punctuation">,</span> global_step<span class="token operator">=</span>i<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"saved to %s"</span> <span class="token operator">%</span> save_path<span class="token punctuation">)</span>
writer<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="4_CNN_303"></a>4. CNN网络训练</h3> 
<p><a href="https://blog.csdn.net/keeppractice/article/details/107398282">情感分析之卷积神经网络-TextCNN,包含代码</a></p> 
<h3><a id="5_CNNRNN_305"></a>5. CNN与RNN训练结果对比</h3> 
<h3><a id="6__308"></a>6. 循环神经网络系列</h3> 
<p><a href="https://editor.csdn.net/md/?articleId=107373069" rel="nofollow">1. 循环神经网络系列之RNN与LSTM介绍</a><br> <a href="https://blog.csdn.net/keeppractice/article/details/106177554">2. 循环神经网络系列之word2vector总结与理解</a><br> <a href="https://blog.csdn.net/keeppractice/article/details/107723526">3. 循环神经网络系列之Imdb影评的数据集介绍与下载</a><br> <a href="https://blog.csdn.net/keeppractice/article/details/106145451">4. 循环神经网络系列之文本情感分析包含（数据预处理-训练-预测）</a><br> 5. 循环神经网络系列之基于tensorflow的CNN和RNN-LSTM文本情感分析对比<br> <a href="https://blog.csdn.net/keeppractice/article/details/107398282">6. 情感分析之卷积神经网络-TextCNN,包含代码</a></p> 
<h3><a id="_317"></a>参考文献</h3> 
<p>https://blog.csdn.net/qq_33547191/article/details/86075275<br> https://www.oreilly.com/content/perform-sentiment-analysis-with-lstms-using-tensorflow/</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/34c1460d6456f5fdc29d7bc7b4c3a120/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">CNN&#43;SVM模型实现图形多分类任务（SVM替换softmax分类器）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d17df76a1458cd4703b8abd238c64da0/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">多目标优化 MOP （六）：遗传算法 Two_Arch2  2015</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>