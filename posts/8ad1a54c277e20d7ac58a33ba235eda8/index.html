<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>[Sencha Touch/ExtJS] (函数节流)阻止用户快速频繁点击，导致多次触发点击事件 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="[Sencha Touch/ExtJS] (函数节流)阻止用户快速频繁点击，导致多次触发点击事件" />
<meta property="og:description" content="原文链接：http://blog.csdn.net/lovelyelfpop/article/details/72730455
一、前言 以下场景往往由于事件频繁被触发，因而频繁执行DOM操作、资源加载等重行为，导致UI停顿甚至浏览器崩溃。
window对象的resize、scroll事件
拖拽时的mousemove事件
射击游戏中的mousedown、keydown事件
文字输入、自动完成的keyup事件
实际上对于window的resize事件，实际需求大多为停止改变大小n毫秒后执行后续处理；而其他事件大多的需求是以一定的频率执行后续处理。针对这两种需求就出现了debounce和throttle两种解决办法。
函数去抖(debounce) 如果用手指一直按住一个弹簧，它将不会弹起直到你松手为止。
也就是说当调用动作n毫秒后，才会执行该动作，若在这n毫秒内又调用此动作则将重新计算执行时间。
函数节流(throttle) 如果将水龙头拧紧直到水是以水滴的形式流出，那你会发现每隔一段时间，就会有一滴水流出。
也就是会说预先设定一个执行周期，当调用动作的时刻大于等于执行周期则执行该动作，然后进入下一个新周期。
二、Sencha Touch/ExtJS 中防止频繁触发点击事件 比如我们想要这样的效果：
用户在500ms内，如果多次点击按钮或列表项，那么点击事件只触发一次(即第一次点击时触发)。
我们可以拦截点击事件的触发(fireEvent)，这就需要用到sencha中的before和after来实现”拦截器”了。
下面代码有两个实现，一种用Mixin实现，另一种用Plugin实现。其中前者用在类中(即define的时候)，后者用在类的实例(Ext.Create/Ext.widget/Ext.factory等)中。
支持Ext.Button和Ext.DataView、Ext.List。
支持自定义节流的时间间隔，单位ms，默认500ms。
Mixin: //ExtJS 6 Ext.define(&#34;UX.mixin.Throttle&#34;, { extend: &#34;Ext.Mixin&#34;, //如果是Sencha Touch, 这里换成&#34;Ext.mixin.Mixin&#34; mixinConfig: { id: &#39;throttle&#39;, before: { onTap: &#39;onBeforeTapThrottle&#39;, onItemTap: &#39;onBeforeItemTapThrottle&#39; }, after: { onTap: &#39;onAfterTapThrottle&#39;, onItemTap: &#39;onAfterItemTapThrottle&#39; } }, throttleDuration: 500, onBeforeTapThrottle: function() { //console.log(&#39;before tap&#39;); if (this._justTapped &amp;&amp; new Date().getTime() - this._justTapped &lt;= this.throttleDuration) { //console." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/8ad1a54c277e20d7ac58a33ba235eda8/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-05-25T16:05:32+08:00" />
<meta property="article:modified_time" content="2017-05-25T16:05:32+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">[Sencha Touch/ExtJS] (函数节流)阻止用户快速频繁点击，导致多次触发点击事件</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><strong>原文链接：<a href="http://blog.csdn.net/lovelyelfpop/article/details/72730455" target="_blank" rel="noopener noreferrer">http://blog.csdn.net/lovelyelfpop/article/details/72730455</a></strong></p> 
<h2 id="一前言">一、前言</h2> 
<p>以下场景往往由于事件频繁被触发，因而频繁执行DOM操作、资源加载等重行为，导致UI停顿甚至浏览器崩溃。</p> 
<ul><li><p>window对象的<code>resize</code>、<code>scroll</code>事件</p></li><li><p>拖拽时的<code>mousemove</code>事件</p></li><li><p>射击游戏中的<code>mousedown</code>、<code>keydown</code>事件</p></li><li><p>文字输入、自动完成的<code>keyup</code>事件</p></li></ul> 
<p>实际上对于window的<code>resize</code>事件，实际需求大多为停止改变大小n毫秒后执行后续处理；而其他事件大多的需求是以一定的频率执行后续处理。针对这两种需求就出现了debounce和throttle两种解决办法。</p> 
<h3 id="函数去抖debounce">函数去抖(debounce)</h3> 
<p>如果用手指一直按住一个弹簧，它将不会弹起直到你松手为止。</p> 
<p>也就是说当调用动作n毫秒后，才会执行该动作，若在这n毫秒内又调用此动作则将重新计算执行时间。</p> 
<h3 id="函数节流throttle">函数节流(throttle)</h3> 
<p>如果将水龙头拧紧直到水是以水滴的形式流出，那你会发现每隔一段时间，就会有一滴水流出。</p> 
<p>也就是会说预先设定一个执行周期，当调用动作的时刻大于等于执行周期则执行该动作，然后进入下一个新周期。</p> 
<h2 id="二sencha-touchextjs-中防止频繁触发点击事件">二、Sencha Touch/ExtJS 中防止频繁触发点击事件</h2> 
<p>比如我们想要这样的效果：</p> 
<p>用户在<code>500ms</code>内，如果多次点击按钮或列表项，那么点击事件只触发一次(即第一次点击时触发)。</p> 
<p>我们可以拦截点击事件的触发(<code>fireEvent</code>)，这就需要用到sencha中的<code>before</code>和<code>after</code>来实现”拦截器”了。</p> 
<p>下面代码有两个实现，一种用<code>Mixin</code>实现，另一种用<code>Plugin</code>实现。其中前者用在类中(即<code>define</code>的时候)，后者用在类的实例(<code>Ext.Create</code>/<code>Ext.widget</code>/<code>Ext.factory</code>等)中。</p> 
<p>支持<code>Ext.Button</code>和<code>Ext.DataView</code>、<code>Ext.List</code>。</p> 
<p>支持自定义节流的时间间隔，单位<code>ms</code>，默认<code>500ms</code>。</p> 
<h3 id="mixin">Mixin:</h3> 
<pre class="prettyprint"><code class=" hljs javascript"><span class="hljs-comment">//ExtJS 6</span>
Ext.define(<span class="hljs-string">"UX.mixin.Throttle"</span>, {
    extend: <span class="hljs-string">"Ext.Mixin"</span>, <span class="hljs-comment">//如果是Sencha Touch, 这里换成"Ext.mixin.Mixin"</span>

    mixinConfig: {
        id: <span class="hljs-string">'throttle'</span>,
        before: {
            onTap: <span class="hljs-string">'onBeforeTapThrottle'</span>,
            onItemTap: <span class="hljs-string">'onBeforeItemTapThrottle'</span>
        },
        after: {
            onTap: <span class="hljs-string">'onAfterTapThrottle'</span>,
            onItemTap: <span class="hljs-string">'onAfterItemTapThrottle'</span>
        }
    },

    throttleDuration: <span class="hljs-number">500</span>,

    onBeforeTapThrottle: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {<!-- --></span>
        <span class="hljs-comment">//console.log('before tap');</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._justTapped &amp;&amp; <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime() - <span class="hljs-keyword">this</span>._justTapped &lt;= <span class="hljs-keyword">this</span>.throttleDuration) {
            <span class="hljs-comment">//console.log('throttle');</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    },
    onAfterTapThrottle: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {<!-- --></span>
        <span class="hljs-comment">//console.log('after tap');</span>
        <span class="hljs-keyword">this</span>._justTapped = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime();
    },

    onBeforeItemTapThrottle: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {<!-- --></span>
        <span class="hljs-comment">//console.log('before itemtap');</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._itemJustTapped &amp;&amp; <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime() - <span class="hljs-keyword">this</span>._itemJustTapped &lt;= <span class="hljs-keyword">this</span>.throttleDuration) {
            <span class="hljs-comment">//console.log('throttle');</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    },
    onAfterItemTapThrottle: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {<!-- --></span>
        <span class="hljs-comment">//console.log('after itemtap');</span>
        <span class="hljs-keyword">this</span>._itemJustTapped = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime();
    }
});

<span class="hljs-comment">//Sencha Touch</span>
Ext.define(<span class="hljs-string">"UX.mixin.Throttle"</span>, {
    extend: <span class="hljs-string">"Ext.mixin.Mixin"</span>, 

    mixinConfig: {
        id: <span class="hljs-string">'throttle'</span>,
        beforeHooks: {
            onBeforeTapThrottle: <span class="hljs-string">'onTap'</span>,
            onBeforeItemTapThrottle: <span class="hljs-string">'onItemTap'</span>
        },
        afterHooks: {
            onAfterTapThrottle: <span class="hljs-string">'onTap'</span>,
            onAfterItemTapThrottle: <span class="hljs-string">'onItemTap'</span>
        }
    },

    throttleDuration: <span class="hljs-number">500</span>,

    onBeforeTapThrottle: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {<!-- --></span>
        <span class="hljs-comment">//console.log('before tap');</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._justTapped &amp;&amp; <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime() - <span class="hljs-keyword">this</span>._justTapped &lt;= <span class="hljs-keyword">this</span>.throttleDuration) {
            <span class="hljs-comment">//console.log('throttle');</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    },
    onAfterTapThrottle: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {<!-- --></span>
        <span class="hljs-comment">//console.log('after tap');</span>
        <span class="hljs-keyword">this</span>._justTapped = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime();
    },

    onBeforeItemTapThrottle: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {<!-- --></span>
        <span class="hljs-comment">//console.log('before itemtap');</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._itemJustTapped &amp;&amp; <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime() - <span class="hljs-keyword">this</span>._itemJustTapped &lt;= <span class="hljs-keyword">this</span>.throttleDuration) {
            console.log(<span class="hljs-string">'throttle'</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    },
    onAfterItemTapThrottle: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {<!-- --></span>
        <span class="hljs-comment">//console.log('after itemtap');</span>
        <span class="hljs-keyword">this</span>._itemJustTapped = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime();
    }
});</code></pre> 
<p>用法如下：</p> 
<pre class="prettyprint"><code class=" hljs cs"><span class="hljs-comment">//requires: 'UX.mixin.Throttle'</span>

<span class="hljs-comment">//自定义list类</span>
Ext.define(<span class="hljs-string">'MyApp.view.MyList'</span>, {
    extend: <span class="hljs-string">'Ext.List'</span>,

    mixins: [<span class="hljs-string">'UX.mixin.Throttle'</span>],

    throttleDuration: <span class="hljs-number">1000</span> <span class="hljs-comment">//节流的时间间隔, 单位ms, 默认500ms</span>
});

<span class="hljs-comment">//自定义button类</span>
Ext.define(<span class="hljs-string">'MyApp.view.MyButton'</span>, {
    extend: <span class="hljs-string">'Ext.Button'</span>,

    mixins: [<span class="hljs-string">'UX.mixin.Throttle'</span>],

    throttleDuration: <span class="hljs-number">1000</span> <span class="hljs-comment">//节流的时间间隔, 单位ms, 默认500ms</span>
});</code></pre> 
<h3 id="plugin">Plugin:</h3> 
<pre class="prettyprint"><code class=" hljs javascript">Ext.define(<span class="hljs-string">'UX.plugin.Throttle'</span>, {
    extend: <span class="hljs-string">'UX.mixin.Throttle'</span>,
    alias: <span class="hljs-string">'plugin.throttle'</span>,
    pluginId: <span class="hljs-string">'throttle'</span>,
    isPlugin: <span class="hljs-literal">true</span>,

    init: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(cmp)</span> {<!-- --></span>
        <span class="hljs-keyword">if</span> (cmp <span class="hljs-keyword">instanceof</span> Ext.DataView) {
            cmp.onBefore({
                itemtap: <span class="hljs-string">'onBeforeItemTapThrottle'</span>,
                scope: <span class="hljs-keyword">this</span>
            });
            cmp.onAfter({
                itemtap: <span class="hljs-string">'onAfterItemTapThrottle'</span>,
                scope: <span class="hljs-keyword">this</span>
            });
        } <span class="hljs-keyword">else</span> {
            cmp.onBefore({
                tap: <span class="hljs-string">'onBeforeTapThrottle'</span>,
                scope: <span class="hljs-keyword">this</span>
            });
            cmp.onAfter({
                tap: <span class="hljs-string">'onAfterTapThrottle'</span>,
                scope: <span class="hljs-keyword">this</span>
            });
        }
    }
});
</code></pre> 
<p>用法如下：</p> 
<pre class="prettyprint"><code class=" hljs javascript"><span class="hljs-comment">//requires: 'UX.plugin.Throttle'</span>
{
    xtype: <span class="hljs-string">'button'</span>,
    text: <span class="hljs-string">'扫一扫'</span>,
    handler: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {<!-- --></span>
        <span class="hljs-comment">//点击事件的逻辑</span>
    },
    plugins: [<span class="hljs-string">'throttle'</span>]
}, {
    xtype: <span class="hljs-string">'button'</span>,
    text: <span class="hljs-string">'完成'</span>,
    handler: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {<!-- --></span>
        <span class="hljs-comment">//点击事件的逻辑</span>
    },
    plugins: [{
        type: <span class="hljs-string">'throttle'</span>,
        throttleDuration: <span class="hljs-number">1000</span> <span class="hljs-comment">//节流的时间间隔, 单位ms, 默认500ms</span>
    }]
}, {
    xtype: <span class="hljs-string">'list'</span>,
    plugins: [<span class="hljs-string">'throttle'</span>]
}</code></pre> 
<h3 id="测试结果">测试结果</h3> 
<p>连续快速2次点击，控制台输出如下：</p> 
<p><code>dataview</code>/<code>list</code> 测试结果</p> 
<pre class="prettyprint"><code class=" hljs livecodeserver"><span class="hljs-keyword">before</span> itemtap
itemtap
<span class="hljs-keyword">after</span> itemtap

<span class="hljs-keyword">before</span> itemtap
throttle
<span class="hljs-keyword">after</span> itemtap</code></pre> 
<p><code>button</code> 测试结果</p> 
<pre class="prettyprint"><code class=" hljs livecodeserver"><span class="hljs-keyword">before</span> tap
tap
<span class="hljs-keyword">after</span> tap

<span class="hljs-keyword">before</span> tap
throttle
<span class="hljs-keyword">after</span> tap</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2a830051bc23b1752712473eb392e9ac/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">解决&lt;input type=“file” multiple&gt; 多文件上传问题（可以多次选取文件，也可以一次选取多个文件），而且点击的是一个同一个div</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/97c4a3b1e610b6dfb2b0c51e6d1117cd/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Jetson TX1开发笔记(六)：V4L2&#43;OpenCV3.1以MJPG格式读取USB摄像头图像并实时显示</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>