<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SQL Server 数据库文件路径迁移步骤 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="SQL Server 数据库文件路径迁移步骤" />
<meta property="og:description" content="一、使用背景 实际项目中，经常由于数据库服务器磁盘空间不足，导致现场数据无法及时入库，引发系统无法访问的问题，这种情况一般是清理服务的磁盘空间，主要有，删除不必要的日志、备份文件或不必要的软件等；但是，对于数据库服务器而言，除了必要的软件外，一般不在安装其他软件，保存的基本上为现场数据文件，所以，针对这种情况，一般我们只能做数据迁移，迁移至空间更大的磁盘或者其他服务器中。这里以SQL Server数据为例，简要说明涉及到的步骤。
二、实现步骤 1.更改数据库实例（含数据文件和日志文件）的保存路径 使用SQL Server自带的连接工具，SQL Server Management Studio，连接后，在连接名处，右击，选择“属性”，在属性框，定位至“数据库设置”选项卡，在“数据库默认位置”设置新的路径，如下图：
点击“确定”，保存修改，此时，会及时生效，不需要重启服务；
2.更改用户数据库（含数据库文件和日志文件）的保存路径 a）新建查询语句，分别输入以下命令，查询用户数据库存储位置 select database_id,name,physical_name AS CurrentLocation,state_desc,size from sys.master_files where database_id=db_id(N&#39;prd_poms&#39;);
其中，prd_poms表示用户自己定义的数据库名称，该语句用于查询，prd_poms数据库的数据文件和日志文件的名称，以及对应的路径，便于后续步骤使用。
查询结果可能如下图：
b）更改用户数据库的保存路径 输入以下语句：
alter database prd_poms modify file ( name = prd_poms, filename = &#39;D:\Program Files\Microsoft SQL Server\MSSQL11.MSSQLSERVER\MSSQL\DATA\prd_poms.mdf&#39;);
alter database prd_poms modify file ( name = prd_poms_log, filename = &#39;D:\Program Files\Microsoft SQL Server\MSSQL11.MSSQLSERVER\MSSQL\DATA\prd_poms_log.ldf&#39;);
上述语句中，粗体红色的部分为数据库的名称，与步骤a）中的数据库名称一致，斜体红色部分对应步骤a）中查询的结果，分别表是文件名称，而红色斜体黄色背景部分为，文件更改后最终需要保存的路径。
c）执行后，在文件正确的情况下，会提示修改成功。 注：由于SQL Server数据库还有系统数据库，因此，还需要对系统数据库按照上述步骤做同样的修改，这里不再累述。
3.修改完成后，需要重启数据库服务，才能使设置生效。 a）暂定数据库服务，打开SQL Server 配置管理器（数据库自带工具），找到SQL Server服务，停止服务，如下图：
或者直接在系统的“服务”中，找到SQL Server服务，停止服务也OK。
b）停止数据库服务后，要确保新的路径已经存在，否则会导致数据库无法启动，以及其他异常。所以，没有的路径，请新建路径。再将原来数据库文件（含数据和日志文件）均复制到新的目录中。注：数据库服务必须要停止，否则无法复制相关文件。
3.重启数据库服务，使所有配置生效
三、出现的问题 若出现无法启动的情况，且从系统的“事件查看器”中，发现原因为：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/002181f10156c6277d763953d544b5a1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-07-03T10:18:59+08:00" />
<meta property="article:modified_time" content="2019-07-03T10:18:59+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SQL Server 数据库文件路径迁移步骤</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2 style="margin-left:0cm;">一、使用背景</h2> 
<p style="margin-left:0cm;">    实际项目中，经常由于数据库服务器磁盘空间不足，导致现场数据无法及时入库，引发系统无法访问的问题，这种情况一般是清理服务的磁盘空间，主要有，删除不必要的日志、备份文件或不必要的软件等；但是，对于数据库服务器而言，除了必要的软件外，一般不在安装其他软件，保存的基本上为现场数据文件，所以，针对这种情况，一般我们只能做数据迁移，迁移至空间更大的磁盘或者其他服务器中。这里以SQL Server数据为例，简要说明涉及到的步骤。</p> 
<h2 style="margin-left:0cm;">二、实现步骤</h2> 
<h3>1.更改数据库实例（含数据文件和日志文件）的保存路径</h3> 
<p style="margin-left:0cm;">使用SQL Server自带的连接工具，SQL Server Management Studio，连接后，在连接名处，右击，选择“属性”，在属性框，定位至“数据库设置”选项卡，在“数据库默认位置”设置新的路径，如下图：</p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="637" src="https://images2.imgbox.com/6a/43/Ua5Q3V5i_o.jpg" width="937"></p> 
<p style="margin-left:0cm;">点击“确定”，保存修改，此时，会及时生效，不需要重启服务；</p> 
<h3>2.更改用户数据库（含数据库文件和日志文件）的保存路径</h3> 
<h4 style="margin-left:0cm;">a）新建查询语句，分别输入以下命令，查询用户数据库存储位置</h4> 
<p style="margin-left:0cm;">select database_id,name,physical_name AS CurrentLocation,state_desc,size from sys.master_files </p> 
<p style="margin-left:0cm;">where database_id=db_id(N'<strong><span style="color:#ff0000;">prd_poms</span></strong>');</p> 
<p style="margin-left:0cm;">其中，prd_poms表示用户自己定义的数据库名称，该语句用于查询，prd_poms数据库的数据文件和日志文件的名称，以及对应的路径，便于后续步骤使用。</p> 
<p style="margin-left:0cm;">查询结果可能如下图：</p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="227" src="https://images2.imgbox.com/4b/0f/05Fkbeag_o.png" width="840"></p> 
<h4 style="margin-left:0cm;">b）更改用户数据库的保存路径</h4> 
<p style="margin-left:0cm;">输入以下语句：</p> 
<p style="margin-left:0cm;">alter database <strong><span style="color:#ff0000;">prd_poms</span></strong> modify file ( name = <em><span style="color:#ff0000;">prd_poms</span></em>, filename = '<em><span style="color:#ff0000;">D:\Program Files\Microsoft SQL Server\MSSQL11.MSSQLSERVER\MSSQL\DATA\prd_poms.mdf</span></em>');</p> 
<p style="margin-left:0cm;">alter database<strong> <span style="color:#ff0000;">prd_poms</span></strong> modify file ( name = <em><span style="color:#ff0000;">prd_poms_log</span></em>, filename = '<em><span style="color:#ff0000;">D:\Program Files\Microsoft SQL Server\MSSQL11.MSSQLSERVER\MSSQL\DATA\prd_poms_log.ldf</span></em>');</p> 
<p style="margin-left:0cm;">上述语句中，<strong><span style="color:#ff0000;">粗体红色</span></strong>的部分为数据库的名称，与步骤a）中的数据库名称一致，<em><span style="color:#ff0000;">斜体红色</span></em>部分对应步骤a）中查询的结果，分别表是文件名称，而<em><span style="color:#ff0000;">红色斜体黄色背景</span></em>部分为，文件更改后最终需要保存的路径。</p> 
<h4 style="margin-left:0cm;">c）执行后，在文件正确的情况下，会提示修改成功。</h4> 
<p style="margin-left:0cm;">注：<strong>由于</strong><strong>SQL Server</strong><strong>数据库还有系统数据库，因此，还需要对系统数据库按照上述步骤做同样的修改，这里不再累述</strong>。</p> 
<h3 style="margin-left:0cm;">3.修改完成后，<strong><span style="color:#ff0000;">需要重启数据库服务，才能使设置生效</span></strong>。</h3> 
<p>      a）暂定数据库服务，打开SQL Server 配置管理器（数据库自带工具），找到SQL Server服务，停止服务，如下图：</p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="369" src="https://images2.imgbox.com/f0/b2/PKt2SYBo_o.png" width="947"></p> 
<p style="margin-left:0cm;">或者直接在系统的“服务”中，找到SQL Server服务，停止服务也OK。</p> 
<p style="margin-left:0cm;">    b）停止数据库服务后，要确保新的路径已经存在，否则会导致数据库无法启动，以及其他异常。所以，没有的路径，请新建路径。再将原来数据库文件（含数据和日志文件）均复制到新的目录中。注：<strong><span style="color:#ff0000;">数据库服务必须要停止，否则无法复制相关文件。</span></strong></p> 
<p style="margin-left:0cm;">   3.重启数据库服务，使所有配置生效</p> 
<p style="margin-left:0cm;"> </p> 
<h2 style="margin-left:0cm;">三、出现的问题</h2> 
<p style="margin-left:0cm;">若出现无法启动的情况，且从系统的“事件查看器”中，发现原因为：</p> 
<p style="margin-left:0cm;">                   “FCB::Open failed: 无法打开文件号 1 的文件”之类报错信息，解决方式如下：</p> 
<p style="margin-left:0cm;">                   找到SQL Server服务，右击，选择“属性”，如图：</p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="368" src="https://images2.imgbox.com/68/f2/npYYd0gJ_o.png" width="943"></p> 
<p style="margin-left:0cm;">在弹框的“登录”选项卡中，选择“本地账户”登录，保存，如下图</p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="496" src="https://images2.imgbox.com/7b/98/xnfdfTWx_o.png" width="424"></p> 
<p style="margin-left:0cm;">再次启动SQL Server服务，即可成功。</p> 
<h2 style="margin-left:0cm;">四、全部sql</h2> 
<p style="margin-left:0cm;">下面写上一些sql语句：</p> 
<p style="margin-left:0cm;">查询系统数据库数据和日志文件存储路径：</p> 
<p style="margin-left:0cm;"><span style="color:#0000ff;">select</span><span style="color:#000000;"> database_id</span><span style="color:#808080;">,</span><span style="color:#0000ff;">name</span><span style="color:#808080;">,</span><span style="color:#000000;">physical_name </span><span style="color:#0000ff;">AS</span><span style="color:#000000;"> CurrentLocation</span><span style="color:#808080;">,</span><span style="color:#000000;">state_desc</span><span style="color:#808080;">,</span><span style="color:#000000;">size </span><span style="color:#0000ff;">from</span> <span style="color:#00ff00;">sys</span><span style="color:#808080;">.</span><span style="color:#00ff00;">master_files</span> </p> 
<p style="margin-left:0cm;"><span style="color:#0000ff;">where</span><span style="color:#000000;"> database_id</span><span style="color:#808080;">=</span><span style="color:#ff00ff;">db_id</span><span style="color:#808080;">(</span><span style="color:#ff0000;">N'master'</span><span style="color:#808080;">);</span></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><span style="color:#0000ff;">select</span><span style="color:#000000;"> database_id</span><span style="color:#808080;">,</span><span style="color:#0000ff;">name</span><span style="color:#808080;">,</span><span style="color:#000000;">physical_name </span><span style="color:#0000ff;">AS</span><span style="color:#000000;"> CurrentLocation</span><span style="color:#808080;">,</span><span style="color:#000000;">state_desc</span><span style="color:#808080;">,</span><span style="color:#000000;">size </span><span style="color:#0000ff;">from</span> <span style="color:#00ff00;">sys</span><span style="color:#808080;">.</span><span style="color:#00ff00;">master_files</span> </p> 
<p style="margin-left:0cm;"><span style="color:#0000ff;">where</span><span style="color:#000000;"> database_id</span><span style="color:#808080;">=</span><span style="color:#ff00ff;">db_id</span><span style="color:#808080;">(</span><span style="color:#ff0000;">N'model'</span><span style="color:#808080;">);</span></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><span style="color:#0000ff;">select</span><span style="color:#000000;"> database_id</span><span style="color:#808080;">,</span><span style="color:#0000ff;">name</span><span style="color:#808080;">,</span><span style="color:#000000;">physical_name </span><span style="color:#0000ff;">AS</span><span style="color:#000000;"> CurrentLocation</span><span style="color:#808080;">,</span><span style="color:#000000;">state_desc</span><span style="color:#808080;">,</span><span style="color:#000000;">size </span><span style="color:#0000ff;">from</span> <span style="color:#00ff00;">sys</span><span style="color:#808080;">.</span><span style="color:#00ff00;">master_files</span> </p> 
<p style="margin-left:0cm;"><span style="color:#0000ff;">where</span><span style="color:#000000;"> database_id</span><span style="color:#808080;">=</span><span style="color:#ff00ff;">db_id</span><span style="color:#808080;">(</span><span style="color:#ff0000;">N'msdb'</span><span style="color:#808080;">);</span></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><span style="color:#0000ff;">select</span><span style="color:#000000;"> database_id</span><span style="color:#808080;">,</span><span style="color:#0000ff;">name</span><span style="color:#808080;">,</span><span style="color:#000000;">physical_name </span><span style="color:#0000ff;">AS</span><span style="color:#000000;"> CurrentLocation</span><span style="color:#808080;">,</span><span style="color:#000000;">state_desc</span><span style="color:#808080;">,</span><span style="color:#000000;">size </span><span style="color:#0000ff;">from</span> <span style="color:#00ff00;">sys</span><span style="color:#808080;">.</span><span style="color:#00ff00;">master_files</span> </p> 
<p style="margin-left:0cm;"><span style="color:#0000ff;">where</span><span style="color:#000000;"> database_id</span><span style="color:#808080;">=</span><span style="color:#ff00ff;">db_id</span><span style="color:#808080;">(</span><span style="color:#ff0000;">N'tempdb'</span><span style="color:#808080;">);</span></p> 
<p style="margin-left:0cm;">更改系统数据库和日志文件存储路径：</p> 
<p>alter database master modify file ( name = master, filename = 'F:\Program Files\Microsoft SQL Server\MSSQL10.MSSQLSERVER\MSSQL\DATA\master.mdf');<br> alter database master modify file ( name = mastlog, filename = 'F:\Program Files\Microsoft SQL Server\MSSQL10.MSSQLSERVER\MSSQL\DATA\mastlog.ldf');</p> 
<p>alter database model modify file ( name = modeldev, filename = 'F:\Program Files\Microsoft SQL Server\MSSQL10.MSSQLSERVER\MSSQL\DATA\model.mdf');<br> alter database model modify file ( name = modellog, filename = 'F:\Program Files\Microsoft SQL Server\MSSQL10.MSSQLSERVER\MSSQL\DATA\modellog.ldf');</p> 
<p>alter database msdb modify file ( name = MSDBData, filename = 'F:\Program Files\Microsoft SQL Server\MSSQL10.MSSQLSERVER\MSSQL\DATA\MSDBData.mdf');<br> alter database msdb modify file ( name = MSDBLog, filename = 'F:\Program Files\Microsoft SQL Server\MSSQL10.MSSQLSERVER\MSSQL\DATA\MSDBLog.ldf');</p> 
<p>alter database tempdb modify file ( name = tempdev, filename = 'F:\Program Files\Microsoft SQL Server\MSSQL10.MSSQLSERVER\MSSQL\DATA\tempdb.mdf');<br> alter database tempdb modify file ( name = templog, filename = 'F:\Program Files\Microsoft SQL Server\MSSQL10.MSSQLSERVER\MSSQL\DATA\templog.ldf');</p> 
<p> </p> 
<p>查询用户数据库数据和日志文件存储路径</p> 
<p>select database_id,name,physical_name AS CurrentLocation,state_desc,size from sys.master_files  <br> where database_id=db_id(N'prd_acs');</p> 
<p><br>  </p> 
<p>更改用户数据库和日志文件存储路径：</p> 
<p>alter database prd_acs modify file ( name = prd_acs, filename = 'F:\Program Files\Microsoft SQL Server\MSSQL10.MSSQLSERVER\MSSQL\DATA\prd_acs.mdf');<br> alter database prd_acs modify file ( name = prd_acs_log, filename = 'F:\Program Files\Microsoft SQL Server\MSSQL10.MSSQLSERVER\MSSQL\DATA\prd_acs_1.ldf');</p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p style="margin-left:0cm;"> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b200c7199338e2ed0444cc7c85d6dc9e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">UIWebView获得内容的高  高度自适应 宽度自适应</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/91fc9a0e78350c65087d22053dac1a3a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">linux系统中socket错误码：EINTR和EAGAIN的处理</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>