<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>HTML5&#43;Canvas&#43;jQuery调用手机拍照功能实现图片上传（一） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="HTML5&#43;Canvas&#43;jQuery调用手机拍照功能实现图片上传（一）" />
<meta property="og:description" content="因为最近一段时间，一直在弄微信项目，其中涉及到了证件上传的功能，刚开始的时候一点头绪都没有，上网查了很多资料，QQ群里面也问了不少人，很多人说如果是app程序，可以申请系统权限，然后再去调用系统底层的东西，但是微信是在浏览器里面操作的，我们自定义的页面也是通过微信内置浏览器打开的，而且微信浏览器在内部进行了很多特殊处理，屏蔽了很多东西，所以要在页面调用拍照功能或者是打开手机系统的图库目录是不可能的，当然，这些都只是大伙儿理论上的猜测而已，而在我查了两天的资料之后，发现这个问题原来是可以解决的，而且实现的过程居然也很简单。只是用到了HTML5的file文件上传功能，再配合canvas即可。下面附上源代码：
&lt;span style=&#34;font-family:KaiTi_GB2312;font-size:14px;&#34;&gt;&lt;!DOCTYPE html&gt; &lt;html lang=&#34;zh-CN&#34;&gt; &lt;meta name=&#34;viewport&#34; content=&#34;height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no&#34;&gt; &lt;meta name=&#34;format-detection&#34; content=&#34;telephone=yes&#34;&gt; &lt;head&gt; &lt;meta charset=&#34;UTF-8&#34;&gt; &lt;title&gt;上传证件&lt;/title&gt; &lt;style&gt; body { margin: 20px 20%; color:#777; text-align: center; } #result{ margin-top: 20px; } &lt;/style&gt; &lt;/head&gt; &lt;body&gt; &lt;h1 class=&#34;text-center&#34;&gt;上传证件...&lt;/h1&gt; &lt;hr/&gt; &lt;input type=&#34;file&#34;/&gt; &lt;div id=&#34;result&#34; align=&#34;center&#34;&gt;&lt;/div&gt; &lt;hr/&gt; &lt;!-- 引入jQuery --&gt; &lt;script type=&#34;text/javascript&#34; src=&#34;../js/jQuery/jquery-1.9.1.min.js&#34;&gt;&lt;/script&gt; &lt;script type=&#34;text/javascript&#34; src=&#34;../js/LocalResizeIMG.js&#34;&gt;&lt;/script&gt; &lt;!-- mobileBUGFix.js 兼容修复移动设备 --&gt; &lt;script src=&#34;../js/mobileBUGFix.mini.js&#34; type=&#34;text/javascript&#34;&gt;&lt;/script&gt; &lt;script type=&#34;text/javascript&#34;&gt; $(&#34;input:file&#34;).localResizeIMG({ width: 500, quality: 0." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/fcd88628b340e3010f535e03d4022771/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2014-10-29T15:02:26+08:00" />
<meta property="article:modified_time" content="2014-10-29T15:02:26+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">HTML5&#43;Canvas&#43;jQuery调用手机拍照功能实现图片上传（一）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><span style="font-family:KaiTi_GB2312; white-space:pre"></span><span style="font-family:KaiTi_GB2312; font-size:18px">因为最近一段时间，一直在弄微信项目，其中涉及到了证件上传的功能，刚开始的时候一点头绪都没有，上网查了很多资料，QQ群里面也问了不少人，很多人说如果是app程序，可以申请系统权限，然后再去调用系统底层的东西，但是微信是在浏览器里面操作的，我们自定义的页面也是通过微信内置浏览器打开的，而且微信浏览器在内部进行了很多特殊处理，屏蔽了很多东西，所以要在页面调用拍照功能或者是打开手机系统的图库目录是不可能的，当然，这些都只是大伙儿理论上的猜测而已，而在我查了两天的资料之后，发现这个问题原来是可以解决的，而且实现的过程居然也很简单。只是用到了HTML5的file文件上传功能，再配合canvas即可。下面附上源代码：</span></p> 
<p><span style="font-family:KaiTi_GB2312; font-size:18px"><br> </span></p> 
<p></p> 
<pre><code class="language-java">&lt;span style="font-family:KaiTi_GB2312;font-size:14px;"&gt;&lt;!DOCTYPE html&gt;
&lt;html lang="zh-CN"&gt;
&lt;meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"&gt;
&lt;meta name="format-detection" content="telephone=yes"&gt;
&lt;head&gt;
	&lt;meta charset="UTF-8"&gt;
	&lt;title&gt;上传证件&lt;/title&gt;
	&lt;style&gt;
	    body {
	        margin: 20px 20%;
	        color:#777;
	        text-align: center;
	    }
	    #result{
	    	margin-top: 20px;
	    }
	&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
	&lt;h1 class="text-center"&gt;上传证件...&lt;/h1&gt;
	&lt;hr/&gt;
		&lt;input type="file"/&gt;
		&lt;div id="result" align="center"&gt;&lt;/div&gt;
	&lt;hr/&gt;
	
	&lt;!--   引入jQuery  --&gt;
	&lt;script type="text/javascript" src="../js/jQuery/jquery-1.9.1.min.js"&gt;&lt;/script&gt;
	&lt;script type="text/javascript" src="../js/LocalResizeIMG.js"&gt;&lt;/script&gt;
	
	&lt;!--   mobileBUGFix.js 兼容修复移动设备       --&gt;
	&lt;script src="../js/mobileBUGFix.mini.js" type="text/javascript"&gt;&lt;/script&gt;
	&lt;script type="text/javascript"&gt;
		$("input:file").localResizeIMG({
			width: 500,
			quality: 0.8,
			success: function (result) {
				var img = new Image();
				img.src = result.base64;
				console.log(result.clearBase64);
				//$("body").append(img);
				$("#result").empty();
				$("#result").append(img); //呈现图像(拍照結果)
				$.ajax({
					url: "upLoadImageServlet",
					type: "POST",
					data:{formFile:result.clearBase64},
					dataType: "HTML",
					timeout: 1000,
					error: function(){
						alert("Error loading PHP document");
					},
					 success: function(result){
					 	//alert(result);
						//console.log(result);
						alert("Uploads success~")
					}
				}); 
			}
		});
	&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;&lt;/span&gt;</code></pre> 
<p></p> 
<p><br> </p> 
<p><span style="font-family:KaiTi_GB2312"><span style="color:rgb(68,68,68); font-size:14px; line-height:28px; text-indent:28px">   </span><span style="font-size:18px"><span style="line-height:28px; text-indent:28px"><span style="color:#3333ff">上面实现的流程导致是这样的，首先在前端把图片进行压缩，因为手机的不同，可能有的手机拍照给力，像素高，拍出来的图片的大小就相对大一些，所以这里通过一个插件进行了压缩，然后转换成为Base64的编码，再把Base64的编码使用AJAX来POST到服务器，然后在Java或者PHP后台进行Base64解码，解出来的路径即为上传图片的路径地址，然后再进行存储，写到文件或者数据库里面。</span></span><br> </span></span></p> 
<p><span style="font-family:KaiTi_GB2312"><span style="font-size:18px"><span style="line-height:28px; text-indent:28px"><span style="color:#3333ff"><br> </span></span></span></span></p> 
<p style="text-indent:28px"><span style="font-family:KaiTi_GB2312; font-size:18px; color:#ff0000"><span style="line-height:28px">此外，这里需要说明一个问题：很多人都说到了微信内置浏览器，之前我也一直认为微信内置浏览器就是微信自己开发的一套浏览器，然后对很多东西进行了限制。其实不是这样的，微信本身并没有再重新开发一套浏览器，而是调用的系统自身的浏览器，是根据手机的不同系统而变化的。<span style="line-height:22.100000381469727px">微信内置浏览器调用的是手机系统默认浏览器，ios和Android系统默认浏览器都是webkit内核，只是对HTML5和CSS3的支持程度可能不同。因为浏览器只是系统的一部分，因此系统默认浏览器不会单独升级，对HTM5、CSS3的支持程度与系统版本有很大关系。<span style="line-height:22.100000381469727px">安卓版微信直接调用系统浏览器内核, iOS则是调用safari,大家可以看到下面1和3的效果是一模一样的，1是微信浏览器打开的，3则是魅族MX 3自带的系统浏览器打开的效果。</span></span></span></span></p> 
<p style="text-indent:28px"><span style="font-family:KaiTi_GB2312; font-size:18px; color:#444444"><span style="line-height:28px"><span style="color:rgb(34,34,34); line-height:22.100000381469727px"><span style="color:rgb(34,34,34); line-height:22.100000381469727px"><br> </span></span></span></span></p> 
<span style="font-family:KaiTi_GB2312; font-size:18px">上面我的我都测试过了，可以正常运行。下面附上几张照片：</span> 
<p><span style="font-family:KaiTi_GB2312"><br> </span></p> 
<p><span style="font-family:KaiTi_GB2312; font-size:24px; color:#ff0000">1、这是在微信里面打开的效果</span></p> 
<p><span style="font-family:KaiTi_GB2312; font-size:24px"><br> </span></p> 
<p style="text-align:center"><span style="font-family:KaiTi_GB2312"><img src="https://images2.imgbox.com/8c/6f/RBDYJtDl_o.jpg" alt=""><img src="https://images2.imgbox.com/fb/fd/xBSOChSz_o.jpg" alt=""><br> </span></p> 
<p><span style="font-family:KaiTi_GB2312"><br> </span></p> 
<p><span style="font-family:KaiTi_GB2312; font-size:24px; color:#ff0000">2、这是在手机UC浏览器打开的效果：</span></p> 
<p><span style="font-family:KaiTi_GB2312; font-size:24px"><br> </span></p> 
<p style="text-align:center"><span style="font-family:KaiTi_GB2312"><img src="https://images2.imgbox.com/8a/fb/vbqC0HlN_o.jpg" alt=""><br> </span></p> 
<p style="text-align:center"><span style="font-family:KaiTi_GB2312"><img src="https://images2.imgbox.com/05/ff/LjIinBiO_o.jpg" alt=""><br> </span></p> 
<p><span style="font-family:KaiTi_GB2312; font-size:24px"><br> </span></p> 
<p><span style="font-family:KaiTi_GB2312; font-size:24px; color:#ff0000">3、这个是在系统自带浏览器里面打开的效果（ps:我的手机是魅族MX 3），但是这个不是打开系统图库目录，而是直接定位到了系统的文件夹根目录。</span></p> 
<p><span style="font-family:KaiTi_GB2312; font-size:24px"><br> </span></p> 
<p style="text-align:center"><span style="font-family:KaiTi_GB2312"><img src="https://images2.imgbox.com/38/54/S9rmQnBX_o.jpg" alt=""><img src="https://images2.imgbox.com/76/7c/kii6gO2H_o.jpg" alt=""></span></p> 
<p style="text-align:center"></p> 
<p style="text-align:center"></p> 
<p style="text-indent:28px"><span style="font-family:KaiTi_GB2312; font-size:18px; color:rgb(255,0,0)"><span style="line-height:28px"><span style="line-height:22.1000003814697px"><br> </span></span></span></p> 
<p style="text-indent:28px"><span style="font-size:18px"><span style="line-height:28px"><span style="line-height:22.1000003814697px"><span style="font-family:SimHei">下一篇会讲到在Java后台进行图片上传操作：</span><br> </span></span></span></p> 
<p style="text-indent:28px"><span style="font-size:18px"><span style="line-height:28px"><span style="line-height:22.1000003814697px"><span style="font-family:SimHei"><br> </span></span></span></span></p> 
<p style="text-indent:28px"><a target="_blank" href="http://blog.csdn.net/hu1991die/article/details/41084153" rel="noopener noreferrer"><span style="font-size:18px">HTML5+Canvas+jQuery调用手机拍照功能实现图片上传（二）</span></a><br> </p> 
<p><br> </p> 
<p><span style="font-family:KaiTi_GB2312; font-size:14px">原文地址：http://cong5.net/html5-canvas-uploads-images.html</span></p> 
<p><span style="color:rgb(68,68,68); line-height:28px; text-indent:28px"><span style="font-family:KaiTi_GB2312; font-size:18px">插件地址：https://github.com/think2011/LocalResizeIMG</span></span><br> </p> 
<p><span style="font-family:KaiTi_GB2312; font-size:24px">源代码下载地址：http://download.csdn.net/detail/hu1991die</span></p> 
<p><span style="font-family:KaiTi_GB2312; font-size:24px"><br> </span></p> 
<p><span style="font-family:KaiTi_GB2312"><span style="font-size:14px">QQ群号：325862559  注：这是我自己建的一个java技术群，欢迎进群讨论一些技术问题，大家互相学习，共同进步！！！</span></span></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/04e7a3926a99312123c45f46798469e3/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">强大的分布式消息中间件——kafka</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/54e17cdf77ebaea0cf21f9bcf7944af2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">开发库 整理</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>