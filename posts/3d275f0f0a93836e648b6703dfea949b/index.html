<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Stable Diffusion&#43;ControlNet&#43;Lora 指导AI&#43;艺术设计的WebUI全流程使用教程 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Stable Diffusion&#43;ControlNet&#43;Lora 指导AI&#43;艺术设计的WebUI全流程使用教程" />
<meta property="og:description" content="目录 一. 背景知识1.1 Stable Diffusion背景知识1.1.1 安装stable-diffusion-webui 1.2 ControlNet 背景知识 二. 使用方法2.1 环境配置2.2 运行WebUI 三. 背景知识3.1 Stable Diffusion参数详解3.2 ControlNet 参数详解 四. 定制化技巧4.1 参数技巧 五. 参考来源 设计师们往往对于新出的绘画工具上手比较艰难，本文针对目前比较火热的Stable Diffusion&#43;ControlNet指导AI艺术设计的工具使用进行全面讲解。很多人会有预感，未来要么设计师被图形学程序员取代，要么会使用AI工具的设计师取代传统设计师，2023年开始，AI辅助设计甚至主导设计已经成了司空见惯的现象。 软硬件环境：
OS: Ubuntu 20.04(Stable Diffusion开发需要Linux 环境，纯使用Web工具也可在WIndows下运行)
CPU: AMD5800 8core 16Thread
GPU: NVIDIA RTX 3090 * 2
RAM: 16GB * 4
Pytorch-gpu=1.13
CUDA=11.7
一. 背景知识 1.1 Stable Diffusion背景知识 1.1.1 安装stable-diffusion-webui 由于笔者的系统为Linux ,因此需要按照官网(https://github.com/AUTOMATIC1111/stable-diffusion-webui)的操作进行以下配置：
# Debian-based: sudo apt install wget git python3 python3-venv bash &lt;(wget -qO- https://raw." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/3d275f0f0a93836e648b6703dfea949b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-09T15:23:56+08:00" />
<meta property="article:modified_time" content="2023-07-09T15:23:56+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Stable Diffusion&#43;ControlNet&#43;Lora 指导AI&#43;艺术设计的WebUI全流程使用教程</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#__11" rel="nofollow">一. 背景知识</a></li><li><ul><li><a href="#11_Stable_Diffusion_12" rel="nofollow">1.1 Stable Diffusion背景知识</a></li><li><ul><li><a href="#111_stablediffusionwebui_13" rel="nofollow">1.1.1 安装stable-diffusion-webui</a></li></ul> 
   </li><li><a href="#12_ControlNet__51" rel="nofollow">1.2 ControlNet 背景知识</a></li></ul> 
  </li><li><a href="#__53" rel="nofollow">二. 使用方法</a></li><li><ul><li><a href="#21__55" rel="nofollow">2.1 环境配置</a></li><li><a href="#22_WebUI_79" rel="nofollow">2.2 运行WebUI</a></li></ul> 
  </li><li><a href="#__89" rel="nofollow">三. 背景知识</a></li><li><ul><li><a href="#31_Stable_Diffusion_90" rel="nofollow">3.1 Stable Diffusion参数详解</a></li><li><a href="#32_ControlNet__114" rel="nofollow">3.2 ControlNet 参数详解</a></li></ul> 
  </li><li><a href="#__126" rel="nofollow">四. 定制化技巧</a></li><li><ul><li><a href="#41__127" rel="nofollow">4.1 参数技巧</a></li></ul> 
  </li><li><a href="#__147" rel="nofollow">五. 参考来源</a></li></ul> 
</div> 
<br> 设计师们往往对于新出的绘画工具上手比较艰难，本文针对目前比较火热的Stable Diffusion+ControlNet指导AI艺术设计的工具使用进行全面讲解。很多人会有预感，未来要么设计师被图形学程序员取代，要么会使用AI工具的设计师取代传统设计师，2023年开始，AI辅助设计甚至主导设计已经成了司空见惯的现象。 
<p></p> 
<p>软硬件环境：<br> OS: Ubuntu 20.04(Stable Diffusion开发需要Linux 环境，纯使用Web工具也可在WIndows下运行)<br> CPU: AMD5800 8core 16Thread<br> GPU: NVIDIA RTX 3090 * 2<br> RAM: 16GB * 4<br> Pytorch-gpu=1.13<br> CUDA=11.7</p> 
<h2><a id="__11"></a>一. 背景知识</h2> 
<h3><a id="11_Stable_Diffusion_12"></a>1.1 Stable Diffusion背景知识</h3> 
<h4><a id="111_stablediffusionwebui_13"></a>1.1.1 安装stable-diffusion-webui</h4> 
<p>由于笔者的系统为Linux ,因此需要按照官网(<a href="https://github.com/AUTOMATIC1111/stable-diffusion-webui">https://github.com/AUTOMATIC1111/stable-diffusion-webui</a>)的操作进行以下配置：</p> 
<pre><code class="prism language-bash"><span class="token comment"># Debian-based:</span>
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> <span class="token function">wget</span> <span class="token function">git</span> python3 python3-venv
<span class="token function">bash</span> <span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token function">wget</span> -qO- https://raw.githubusercontent.com/AUTOMATIC1111/stable-diffusion-webui/master/webui.sh<span class="token punctuation">)</span>
</code></pre> 
<p>下载好stable-dffusion-webui后，还需要单独安装<code>gfpgan</code> 包(<a href="https://gitcode.net/mirrors/TencentARC/GFPGAN?utm_source=csdn_github_accelerator" rel="nofollow">https://gitcode.net/mirrors/TencentARC/GFPGAN?utm_source=csdn_github_accelerator</a>)，安装方式如下：</p> 
<pre><code class="prism language-bash"><span class="token function">git</span> clone https://github.com/TencentARC/GFPGAN.git
<span class="token builtin class-name">cd</span> GFPGAN
<span class="token comment"># Install basicsr - https://github.com/xinntao/BasicSR</span>
<span class="token comment"># We use BasicSR for both training and inference</span>
pip <span class="token function">install</span> basicsr

<span class="token comment"># Install facexlib - https://github.com/xinntao/facexlib</span>
<span class="token comment"># We use face detection and face restoration helper in the facexlib package</span>
pip <span class="token function">install</span> facexlib

pip <span class="token function">install</span> <span class="token parameter variable">-r</span> requirements.txt
python setup.py develop

<span class="token comment"># If you want to enhance the background (non-face) regions with Real-ESRGAN,</span>
<span class="token comment"># you also need to install the realesrgan package</span>
pip <span class="token function">install</span> realesrgan
</code></pre> 
<p>安装好后将<code>GFPGAN</code> 目录放在<code>stable-diffusion-webui</code> 目录下，同时改名为<code>gfpgan</code> ，注意，这里如果不修改名字这个包将不可用。<br> <img src="https://images2.imgbox.com/0c/16/NNfElWQa_o.png" alt="在这里插入图片描述"><br> 然后运行以下命令并等待自动安装好其他环境依赖包：</p> 
<pre><code class="prism language-bash">./webui.sh 
</code></pre> 
<p>这里安装requirements.rxt中的内容可能需要等待一段时间：<br> <img src="https://images2.imgbox.com/04/42/BOQRzrim_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="12_ControlNet__51"></a>1.2 ControlNet 背景知识</h3> 
<h2><a id="__53"></a>二. 使用方法</h2> 
<p>目前开放AI+艺术设计工具的方式多为Web交互界面，接入互联网后调用AI公司内部的云GPU服务器，服务器计算后返回结果给用户。其大多有次数或功能限制，或者收费较高。本部分讲述如何利用本地GPU工作机进行Web交互式AI绘图。</p> 
<h3><a id="21__55"></a>2.1 环境配置</h3> 
<p>下载以下四个源代码/模型文件：</p> 
<ol><li> <p>主要使用的SD的Web版本(第三方，非官方)：</p> <p><a href="https://github.com/AUTOMATIC1111/stable-diffusion-webui">stable-diffusion-webui</a></p> </li><li> <p>下载SD官方的v1.5模型：<br> <a href="https://huggingface.co/runwayml/stable-diffusion-v1-5" rel="nofollow">runwayml/stable-diffusion-v1-5</a></p> </li><li> <p>下载ControlNet的Web版本(第三方，非官方):<br> <a href="https://github.com/Mikubill/sd-webui-controlnet">Mikubill/sd-webui-controlnet</a></p> </li><li> <p>下载ControlNet官方发布的模型：<br> <a href="https://huggingface.co/lllyasviel/ControlNet/tree/main/models" rel="nofollow">lllyasviel/ControlNet/tree/main/models</a></p> </li></ol> 
<p>下载好后首先进入<code>stable-diffusion-webui</code> 中，注意将 <code>Mikubill/sd-webui-controlnet</code> 的源代码放在 <code>extensions</code> 目录下面:</p> 
<p><img src="https://images2.imgbox.com/b3/4d/GhooqBjZ_o.png" alt="在这里插入图片描述"><br> 将下载好的ControlNet源代码目录中的<code>models</code> 复制到<code>extensions</code> 下面：</p> 
<p><img src="https://images2.imgbox.com/31/fa/zxrzM4Js_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="22_WebUI_79"></a>2.2 运行WebUI</h3> 
<p>在命令行中执行脚本(注意不要使用sudo命令，否则会不成功):</p> 
<pre><code class="prism language-bash">./webui.sh 
</code></pre> 
<p>接下来脚本自动进行环境安装和模型加载。加载完毕后会返回一个本地Web网址，访问这个网址可以进行本地浏览器界面交互：<br> <img src="https://images2.imgbox.com/2c/7d/pUhMYW5F_o.png" alt="在这里插入图片描述"><br> 复制url，打开浏览器，即可得到带有ControlNet功能的SD的WebUI交互界面，可以利用界面上面的组件进行本地的快速交互设计开发。<br> <img src="https://images2.imgbox.com/d9/90/Awc49zX1_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="__89"></a>三. 背景知识</h2> 
<h3><a id="31_Stable_Diffusion_90"></a>3.1 Stable Diffusion参数详解</h3> 
<p>Sampling method: 采样方法</p> 
<p>Sampling steps:采样迭代步数</p> 
<p>Restore faces: 面容修复</p> 
<p>Tiling: 生成平铺纹理</p> 
<p>Highres.fix: 高分辨率修复</p> 
<p>Firstpass width: 一开始的低分辨率的宽</p> 
<p>Firstpass height: 一开始的低分辨率的高</p> 
<p>CFG scale: 数值越小，AI多样性越多，越大限制越多</p> 
<p>Seed: 种子数</p> 
<p>Variation seed: 在原来种子数的基础之上的子种子数</p> 
<p>Denoising strength：跟原来图片的差距大小</p> 
<h3><a id="32_ControlNet__114"></a>3.2 ControlNet 参数详解</h3> 
<ol><li> <p>2D重绘<br> Canny Edge<br> HED Boundary<br> M-LSD Lines<br> Faske Scribbles</p> </li><li> <p>专业领域<br> Depth Map<br> Normal Map<br> Semantic Segmentation<br> Human Pose</p> </li></ol> 
<h2><a id="__126"></a>四. 定制化技巧</h2> 
<h3><a id="41__127"></a>4.1 参数技巧</h3> 
<p>深度真人LoRa模型训练建议：<br> 使用和LoRa一样的底模(大模型); 最好使用和LoRa作者相同的参数;正确设置loRa的权重(0.8~0.9, &lt;1);提示词中要加入触发词;LoRa不是越多越好。<br> 1、训练总数：建议50张图数据集深度训练15000次左右，更大数据集可用Dadaptation优化器测试最佳总步数。<br> 2、训练轮次：建议10/5次预设，每个图建议单轮训练20~30次。<br> 3、训练分辨率：建议768x1024,根据电脑显存调整。<br> 4、训练源模型：建议chilloutmix_NiPnjnedFp32Fix, 1.5模型。<br> 5、Text Encoder learning rate （文本编码器学习率）：主要影响鲁棒性、泛化性和拟合度，过低不利于更换特征。<br> 6、Unet learning rate （Unet学习率）：主要影响模型像与不像，影响lost率和拟合度，不拟合加大，过拟合减小。<br> 7、文本编码器学习率和Unet学习率的关系：没有必然的1/5~1/10倍率关系、庞大数据集下Unet甚至可以低过Text。<br> 8、Network Rank （Dimension”网络大小）：强化训练细节，建议128〜192，128以上增加提升相对不明显。<br> 9、Network Alpha （网络Alpha）：建议96以上，弱化训练细节，有正则化效果，可与Dim同步增加。<br> 10、让AI训练AI：首发训练采用Dadaptation,所有学习率均设为1。<br> 1k手动训练方法：建议用AadmW优化器，可以通过调整学习率获得很像与易用性的平衡。<br> 12、lost率控制：不是越低越好，越低模型越拟合，但模型也越难更换特征，甚至会影响动作和表情。<br> 13、Lion优化器：不建议用在深度训练中，太快拟合虽然能很像，但是造成泛用性差。<br> 14、本地深度训练方法：可以用远程操作软件监控，训练过程中发现学习率不合适远程修改。</p> 
<h2><a id="__147"></a>五. 参考来源</h2> 
<p><a href="https://www.bilibili.com/video/BV1Ba4y1M7LD/?spm_id_from=333.788.recommend_more_video.1&amp;vd_source=e24b14ce4b59bf091787522615c9fd6b" rel="nofollow">如何训练一个非常像的真人Lora模型（深度探讨）<br> </a><br> <a href="https://www.bilibili.com/video/BV1rL411Q7eE/?-Arouter=story&amp;buvid=XUC4807CBDD64E0EB49FA60A5288547501C2B&amp;is_story_h5=false&amp;mid=lVWRBJAbDhpk8zArpYwJaQ==&amp;p=1&amp;plat_id=163&amp;share_from=ugc&amp;share_medium=android&amp;share_plat=android&amp;share_session_id=b0efa117-1efb-41f9-9344-21431f8d40a9&amp;share_source=WEIXIN&amp;share_tag=s_i&amp;timestamp=1681175847&amp;unique_k=ytMeeVx&amp;up_id=667024747&amp;vd_source=e24b14ce4b59bf091787522615c9fd6b" rel="nofollow">[2023最新]LORA安装和训练指南</a></p> 
<p><a href="https://www.bilibili.com/video/BV1vk4y1v7oV/?-Arouter=story&amp;buvid=XUC4807CBDD64E0EB49FA60A5288547501C2B&amp;is_story_h5=false&amp;mid=lVWRBJAbDhpk8zArpYwJaQ==&amp;p=1&amp;plat_id=163&amp;share_from=ugc&amp;share_medium=android&amp;share_plat=android&amp;share_session_id=4f58f73a-cf17-4634-911a-a5e69586509f&amp;share_source=WEIXIN&amp;share_tag=s_i&amp;timestamp=1681176162&amp;unique_k=biFzRK9&amp;up_id=26629280&amp;vd_source=e24b14ce4b59bf091787522615c9fd6b" rel="nofollow">还搞不定lora训练集吗？干货分享+打标讲解</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/df600193f8a4d04f5800b6768121d40e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">基于微信小程序的科创微应用平台小程序</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/17648462ad0cc7197cdec4e2d9d80db7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Zotero使用</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>