<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>vue3中使用nextTick和forceUpdate&#43;vue3 ts使用EventBus - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="vue3中使用nextTick和forceUpdate&#43;vue3 ts使用EventBus" />
<meta property="og:description" content="一、 vue中使用forceUpdate 作用：在Vue官方文档中指出，$forceUpdate具有强制刷新的作用，迫使vue实例重新（rander）渲染虚拟dom，注意它仅仅影响实例本身和插入插槽内容的子组件，而不是所有子组件。
在vue2中使用
this.$forceUpdate() vue3中使用
import { getCurrentInstance } from &#39;vue&#39; // 先引入 setup(){ // 解构赋值 设置别名that，也可不写:that，直接ctx let { ctx: that } = getCurrentInstance() that.$forceUpdate() } 这样使用的时候会报错 Property ‘ctx’ does not exist on type ‘ComponentInternalInstance | null’.
类型检测
const { ctx: that } = getCurrentInstance() as any 二、vue中使用$nextTick 作用：vue中的nextTick()是在下次 DOM 更新循环结束之后执行延迟回调，在修改数据之后使用$nextTick()，则可以在回调中获取更新后的 DOM。
在vue2中使用
this.visible = false // 直接使用 this.$nextTick(() =&gt; { // 要执行的方法 this.visible = true }) 在vue3中使用" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/0236fac51ec8a0fb2969b285b94c4768/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-06T09:30:44+08:00" />
<meta property="article:modified_time" content="2023-03-06T09:30:44+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">vue3中使用nextTick和forceUpdate&#43;vue3 ts使用EventBus</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="kdocs-document"> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">一、 vue中使用</span><a class="kdocs-link" style="color:#0A6CFF;" href="https://so.csdn.net/so/search?q=forceUpdate&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer"><span class="kdocs-bold" style="font-weight:bold;">forceUpdate</span></a></h4> 
 <p style="text-align:null;">作用：在Vue官方文档中指出，$forceUpdate具有强制刷新的作用，迫使vue实例重新（rander）渲染<a class="kdocs-link" style="color:#0A6CFF;" href="https://so.csdn.net/so/search?q=%E8%99%9A%E6%8B%9Fdom&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">虚拟dom</a>，注意它仅仅影响实例本身和插入插槽内容的子组件，而不是所有子组件。</p> 
 <p style="text-align:null;">在<a class="kdocs-link" style="color:#0A6CFF;" href="https://so.csdn.net/so/search?q=vue2&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">vue2</a>中使用</p> 
 <pre class="kdocs-typescript"><code class="language-typescript">this.$forceUpdate()</code></pre> 
 <p style="">vue3中使用</p> 
 <pre class="kdocs-typescript"><code class="language-typescript">import { getCurrentInstance } from 'vue' // 先引入
setup(){
// 解构赋值 设置别名that，也可不写:that，直接ctx
      let { ctx: that } = getCurrentInstance()
    that.$forceUpdate()
}</code></pre> 
 <p style="">这样使用的时候会报错 Property ‘ctx’ does not exist on type ‘ComponentInternalInstance | null’.</p> 
 <p style=""><span class="kdocs-bold" style="font-weight:bold;">类型检测</span></p> 
 <pre class="kdocs-typescript"><code class="language-typescript">const { ctx: that } = getCurrentInstance() as any</code></pre> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">二、vue中使用$nextTick</span></h4> 
 <p style="text-align:null;">作用：vue中的nextTick()是在下次 DOM 更新循环结束之后执行延迟回调，在修改数据之后使用$nextTick()，则可以在回调中获取更新后的 DOM。</p> 
 <p style="text-align:null;">在vue2中使用</p> 
 <pre class="kdocs-typescript"><code class="language-typescript">this.visible = false
// 直接使用
this.$nextTick(() =&gt; {
   // 要执行的方法
    this.visible = true
})</code></pre> 
 <p style="">在vue3中使用</p> 
 <pre class="kdocs-typescript"><code class="language-typescript">import { nextTick } from 'vue' // 先引入
setup () {
    const visible = ref&lt;boolean&gt;(false)
    // 使用
    nextTick(()=&gt;{
        visible.value = true
    })
    return {
        visible
    }
}</code></pre> 
 <h2 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">vue3利用ts使用EventBus</span></h2> 
 <pre class="kdocs-typescript"><code class="language-typescript">/**
 * 简易的发布订阅模式
 * 主要用于跨组件通信
 */
class EventBus {
  static list: { [key: string]: Array&lt;Function&gt; } = {};

  // 订阅
  static listen(name: EventTypeName, fn: Function) {
    this.list[name] = this.list[name] || [];
    this.list[name].push(fn);
  }

  // 发布
  static notify(name: EventTypeName, data?: any) {
    if (this.list[name]) {
      this.list[name].forEach((fn: Function) =&gt; {
        fn(data);
      });
    }
  }

  // 取消订阅
  static unListen(name: EventTypeName) {
    if (this.list[name]) {
      // delete this.list[name];
      Reflect.deleteProperty(this.list, name);
    }
  }

   // 只使用一次
    // static once(name: EventTypeName, fn: Function) {
    //  const _this = this
    //  const wrapper = function () {
    //    fn.apply(this, [arguments])
     //   _this.unListen(name, wrapper)
     // }
     // this.notify(eventName, wrapper)
   // }
}
export default EventBus;

/**
 * 用于规范统一命名，减少名称不一致导致的错误
 */
export enum EventTypeName {
  // 打开报告
  OPEN_REPORT,
  // 打开
  OPEN,
}

</code></pre> 
 <pre class="kdocs-typescript"><code class="language-typescript">  EventBus.listen(EventTypeName.OPEN_REPORT, (data: any) =&gt; {
    console.log('data :&gt;&gt; ', data);
    let lti48Obj: any = {
      1: "inspection", // 检验
      2: "microorganism", //微生物
      99: "check", // 检查
    };
    state.reportId = data.reportId; // 报告id
    state.defaultValue = lti48Obj[data.lti48];
  });
EventBus.notify(EventTypeName.OPEN_REPORT, row)
或者
EventBus.listen(EventTypeName.OPEN_REPORT, (data: Function) =&gt; {
  data(row)
});
EventBus.notify(EventTypeName.OPEN_REPORT, (data: any) =&gt; {
    let lti48Obj: any = {
      1: "inspection", // 检验
      2: "microorganism", //微生物
      99: "check", // 检查
    };
    state.reportId = data.reportId
    state.defaultValue = lti48Obj[data.lti48]
  });

//销毁EventBus
 onUnmounted(() =&gt; {
   EventBus.unListen(EventTypeName.OPEN_REPORT);
 });
</code></pre> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/bd6cf329a4ca7f6087a5efe51cb0e078/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">《解构领域驱动设计》- 领域驱动设计统一过程</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3b7a921f0b6139ec42ada489d5edd9a8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">zookeeper集群启停及状态查看脚本（linux）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>