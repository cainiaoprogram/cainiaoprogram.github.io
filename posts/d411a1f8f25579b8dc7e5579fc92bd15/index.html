<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>OpenCV调用工业相机 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="OpenCV调用工业相机" />
<meta property="og:description" content="OpenCV调用工业相机 python调用海康工业相机并用opencv显示（整体实现）
python调用Gige网口工业相机 opencv
文章目录 OpenCV调用工业相机前言一、MVS 3.4.1下载二、安装1. 傻瓜式安装，只需记得安装路径即可（环境变量可加可不加）2. 用Pycharm打开3. 创建GigeOpencv.py文件3. 创建AllOpencv.py文件 三、总文件 前言 OpenCV可以简单的调用USB相机，只需通过cap = cv2.VideoCapture(0)即可。
可一旦调用Gige等网口连接的工业相机时，使用cap = cv2.VideoCapture(0)或是cap = cv2.VideoCapture(1)、cap = cv2.VideoCapture(2)等等都无法调用。
通过查阅众多文章后，本人根据自身使用要求整理了一份程序
一、MVS 3.4.1下载 不能使用百度上所能搜到的3.1.0版本，Python编程时缺少参数
直接上链接：MVS3.4.1-for-windows
MVS-2.1.2-for-Linux
二、安装 1. 傻瓜式安装，只需记得安装路径即可（环境变量可加可不加） 2. 用Pycharm打开 若没正确安装
C:\Program Files (x86)\Common Files\MVS\Runtime\Win64_x64里的MvCameraControl.dll可能会缺失
出现该问题就把MvCameraControl.dll复制到上述的Python文件夹
3. 创建GigeOpencv.py文件 import sys import threading import msvcrt import cv2 import numpy as np import time from ctypes import * from MvCameraControl_class import * # from tfoddetect import * g_bExit = False def main(): deviceList = MV_CC_DEVICE_INFO_LIST() # 选择计算机所使用的相机类型，选越多越慢 # tlayerType = MV_GIGE_DEVICE | MV_USB_DEVICE | MV_UNKNOW_DEVICE | MV_1394_DEVICE | MV_CAMERALINK_DEVICE tlayerType = MV_GIGE_DEVICE | MV_USB_DEVICE # ch:枚举设备 | en:Enum device ret = MvCamera." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/d411a1f8f25579b8dc7e5579fc92bd15/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-08T16:50:31+08:00" />
<meta property="article:modified_time" content="2023-02-08T16:50:31+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">OpenCV调用工业相机</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="OpenCV_0"></a>OpenCV调用工业相机</h2> 
<p><a href="https://blog.csdn.net/qq_39570716/article/details/114066097?spm=1001.2014.3001.5501">python调用海康工业相机并用opencv显示（整体实现）</a></p> 
<p><a href="https://blog.csdn.net/mcuwangzai/article/details/122333013">python调用Gige网口工业相机 opencv</a></p> 
<hr> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#OpenCV_0" rel="nofollow">OpenCV调用工业相机</a></li><li><a href="#_10" rel="nofollow">前言</a></li><li><a href="#MVS_341_18" rel="nofollow">一、MVS 3.4.1下载</a></li><li><a href="#_26" rel="nofollow">二、安装</a></li><li><ul><li><a href="#1__27" rel="nofollow">1. 傻瓜式安装，只需记得安装路径即可（环境变量可加可不加）</a></li><li><a href="#2_Pycharm_30" rel="nofollow">2. 用Pycharm打开</a></li><li><a href="#3_GigeOpencvpy_38" rel="nofollow">3. 创建GigeOpencv.py文件</a></li><li><a href="#3_AllOpencvpy_204" rel="nofollow">3. 创建AllOpencv.py文件</a></li></ul> 
  </li><li><a href="#_858" rel="nofollow">三、总文件</a></li></ul> 
</div> 
<p></p> 
<h2><a id="_10"></a>前言</h2> 
<p>OpenCV可以简单的调用USB相机，只需通过cap = cv2.VideoCapture(0)即可。<br> 可一旦调用Gige等网口连接的工业相机时，使用cap = cv2.VideoCapture(0)或是cap = cv2.VideoCapture(1)、cap = cv2.VideoCapture(2)等等都无法调用。<br> 通过查阅众多文章后，本人根据自身使用要求整理了一份程序</p> 
<h2><a id="MVS_341_18"></a>一、MVS 3.4.1下载</h2> 
<p>不能使用百度上所能搜到的3.1.0版本，Python编程时缺少参数</p> 
<p>直接上链接：<a href="https://www.hikrobotics.com/cn2/source/support/software/MVS_STD_3.4.1_220407.zip" rel="nofollow">MVS3.4.1-for-windows</a><br> <a href="https://www.hikrobotics.com/cn2/source/support/software/MVS_STD_GML_V2.1.2_221208.zip" rel="nofollow">MVS-2.1.2-for-Linux</a></p> 
<h2><a id="_26"></a>二、安装</h2> 
<h3><a id="1__27"></a>1. 傻瓜式安装，只需记得安装路径即可（环境变量可加可不加）</h3> 
<p><img src="https://images2.imgbox.com/fc/d3/KjdQu0Os_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2_Pycharm_30"></a>2. 用Pycharm打开</h3> 
<p><img src="https://images2.imgbox.com/7a/5a/zQ3rzMME_o.png" alt="在这里插入图片描述"><br> 若没正确安装<br> C:\Program Files (x86)\Common Files\MVS\Runtime\Win64_x64里的MvCameraControl.dll可能会缺失<br> 出现该问题就把MvCameraControl.dll复制到上述的Python文件夹</p> 
<p><img src="https://images2.imgbox.com/39/e7/tujUQVBN_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3_GigeOpencvpy_38"></a>3. 创建GigeOpencv.py文件</h3> 
<p><img src="https://images2.imgbox.com/10/33/pmxKMxyk_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> sys
<span class="token keyword">import</span> threading
<span class="token keyword">import</span> msvcrt
<span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> time

<span class="token keyword">from</span> ctypes <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> MvCameraControl_class <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token comment"># from tfoddetect import *</span>

g_bExit <span class="token operator">=</span> <span class="token boolean">False</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    deviceList <span class="token operator">=</span> MV_CC_DEVICE_INFO_LIST<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 选择计算机所使用的相机类型，选越多越慢</span>
    <span class="token comment"># tlayerType = MV_GIGE_DEVICE | MV_USB_DEVICE | MV_UNKNOW_DEVICE | MV_1394_DEVICE | MV_CAMERALINK_DEVICE</span>
    tlayerType <span class="token operator">=</span> MV_GIGE_DEVICE <span class="token operator">|</span> MV_USB_DEVICE

    <span class="token comment"># ch:枚举设备 | en:Enum device</span>
    ret <span class="token operator">=</span> MvCamera<span class="token punctuation">.</span>MV_CC_EnumDevices<span class="token punctuation">(</span>tlayerType<span class="token punctuation">,</span> deviceList<span class="token punctuation">)</span>
    <span class="token keyword">if</span> ret <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"enum devices fail! ret[0x%x]"</span> <span class="token operator">%</span> ret<span class="token punctuation">)</span>
        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> deviceList<span class="token punctuation">.</span>nDeviceNum <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"find no device!"</span><span class="token punctuation">)</span>
        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Find %d devices!"</span> <span class="token operator">%</span> deviceList<span class="token punctuation">.</span>nDeviceNum<span class="token punctuation">)</span>


    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> deviceList<span class="token punctuation">.</span>nDeviceNum<span class="token punctuation">)</span><span class="token punctuation">:</span>
        mvcc_dev_info <span class="token operator">=</span> cast<span class="token punctuation">(</span>deviceList<span class="token punctuation">.</span>pDeviceInfo<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> POINTER<span class="token punctuation">(</span>MV_CC_DEVICE_INFO<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>contents
        <span class="token keyword">if</span> mvcc_dev_info<span class="token punctuation">.</span>nTLayerType <span class="token operator">==</span> MV_GIGE_DEVICE<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\ngige device: [%d]"</span> <span class="token operator">%</span> i<span class="token punctuation">)</span>
            strModeName <span class="token operator">=</span> <span class="token string">""</span>
            <span class="token keyword">for</span> per <span class="token keyword">in</span> mvcc_dev_info<span class="token punctuation">.</span>SpecialInfo<span class="token punctuation">.</span>stGigEInfo<span class="token punctuation">.</span>chModelName<span class="token punctuation">:</span>
                strModeName <span class="token operator">=</span> strModeName <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>per<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"device model name: %s"</span> <span class="token operator">%</span> strModeName<span class="token punctuation">)</span>

            <span class="token comment"># 取得相机IP地址</span>
            nip1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>mvcc_dev_info<span class="token punctuation">.</span>SpecialInfo<span class="token punctuation">.</span>stGigEInfo<span class="token punctuation">.</span>nCurrentIp <span class="token operator">&amp;</span> <span class="token number">0xff000000</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">24</span><span class="token punctuation">)</span>
            nip2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>mvcc_dev_info<span class="token punctuation">.</span>SpecialInfo<span class="token punctuation">.</span>stGigEInfo<span class="token punctuation">.</span>nCurrentIp <span class="token operator">&amp;</span> <span class="token number">0x00ff0000</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">16</span><span class="token punctuation">)</span>
            nip3 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>mvcc_dev_info<span class="token punctuation">.</span>SpecialInfo<span class="token punctuation">.</span>stGigEInfo<span class="token punctuation">.</span>nCurrentIp <span class="token operator">&amp;</span> <span class="token number">0x0000ff00</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">8</span><span class="token punctuation">)</span>
            nip4 <span class="token operator">=</span> <span class="token punctuation">(</span>mvcc_dev_info<span class="token punctuation">.</span>SpecialInfo<span class="token punctuation">.</span>stGigEInfo<span class="token punctuation">.</span>nCurrentIp <span class="token operator">&amp;</span> <span class="token number">0x000000ff</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"current ip: %d.%d.%d.%d\n"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>nip1<span class="token punctuation">,</span> nip2<span class="token punctuation">,</span> nip3<span class="token punctuation">,</span> nip4<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># nConnectionNum = input("please input the number of the device to connect:")</span>
    <span class="token comment"># 根据需求直接指定要打开的相机</span>
    nConnectionNum <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">if</span> <span class="token builtin">int</span><span class="token punctuation">(</span>nConnectionNum<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> deviceList<span class="token punctuation">.</span>nDeviceNum<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"intput error!"</span><span class="token punctuation">)</span>
        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># ch:创建相机实例 | en:Creat Camera Object</span>
    cam <span class="token operator">=</span> MvCamera<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># ch:选择设备并创建句柄 | en:Select device and create handle</span>
    stDeviceList <span class="token operator">=</span> cast<span class="token punctuation">(</span>deviceList<span class="token punctuation">.</span>pDeviceInfo<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>nConnectionNum<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> POINTER<span class="token punctuation">(</span>MV_CC_DEVICE_INFO<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>contents
    ret <span class="token operator">=</span> cam<span class="token punctuation">.</span>MV_CC_CreateHandle<span class="token punctuation">(</span>stDeviceList<span class="token punctuation">)</span>
    <span class="token keyword">if</span> ret <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"create handle fail! ret[0x%x]"</span> <span class="token operator">%</span> ret<span class="token punctuation">)</span>
        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># ch:打开设备 | en:Open device</span>
    ret <span class="token operator">=</span> cam<span class="token punctuation">.</span>MV_CC_OpenDevice<span class="token punctuation">(</span>MV_ACCESS_Exclusive<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> ret <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"open device fail! ret[0x%x]"</span> <span class="token operator">%</span> ret<span class="token punctuation">)</span>
        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># ch:探测网络最佳包大小(只对GigE相机有效) | en:Detection network optimal package size(It only works for the GigE camera)</span>
    <span class="token keyword">if</span> stDeviceList<span class="token punctuation">.</span>nTLayerType <span class="token operator">==</span> MV_GIGE_DEVICE<span class="token punctuation">:</span>
        nPacketSize <span class="token operator">=</span> cam<span class="token punctuation">.</span>MV_CC_GetOptimalPacketSize<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token builtin">int</span><span class="token punctuation">(</span>nPacketSize<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
            ret <span class="token operator">=</span> cam<span class="token punctuation">.</span>MV_CC_SetIntValue<span class="token punctuation">(</span><span class="token string">"GevSCPSPacketSize"</span><span class="token punctuation">,</span> nPacketSize<span class="token punctuation">)</span>
            <span class="token keyword">if</span> ret <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Warning: Set Packet Size fail! ret[0x%x]"</span> <span class="token operator">%</span> ret<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Warning: Get Packet Size fail! ret[0x%x]"</span> <span class="token operator">%</span> nPacketSize<span class="token punctuation">)</span>
    stBool <span class="token operator">=</span> c_bool<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    ret <span class="token operator">=</span> cam<span class="token punctuation">.</span>MV_CC_GetBoolValue<span class="token punctuation">(</span><span class="token string">"AcquisitionFrameRateEnable"</span><span class="token punctuation">,</span> stBool<span class="token punctuation">)</span>
    <span class="token keyword">if</span> ret <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"get AcquisitionFrameRateEnable fail! ret[0x%x]"</span> <span class="token operator">%</span> ret<span class="token punctuation">)</span>
        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># ch:设置触发模式为off | en:Set trigger mode as off</span>
    ret <span class="token operator">=</span> cam<span class="token punctuation">.</span>MV_CC_SetEnumValue<span class="token punctuation">(</span><span class="token string">"TriggerMode"</span><span class="token punctuation">,</span> MV_TRIGGER_MODE_OFF<span class="token punctuation">)</span>
    <span class="token keyword">if</span> ret <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"set trigger mode fail! ret[0x%x]"</span> <span class="token operator">%</span> ret<span class="token punctuation">)</span>
        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># ch:开始取流 | en:Start grab image</span>
    ret <span class="token operator">=</span> cam<span class="token punctuation">.</span>MV_CC_StartGrabbing<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> ret <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"start grabbing fail! ret[0x%x]"</span> <span class="token operator">%</span> ret<span class="token punctuation">)</span>
        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 常规化窗口大小以及实时显示</span>
    <span class="token comment"># cv2.namedWindow('1', cv2.WINDOW_NORMAL)</span>
    <span class="token keyword">while</span> cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'q'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        src <span class="token operator">=</span> GetImage<span class="token punctuation">(</span>cam<span class="token punctuation">)</span>

        <span class="token comment"># src即为图片，可通过numpy变换数组</span>
        <span class="token comment"># 此处可根据需要载入tensorflow模型检测</span>
        <span class="token comment"># tfod(src)</span>
        cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">,</span> src<span class="token punctuation">)</span>


    <span class="token comment"># 只保存图片就直接频闭上段</span>
    <span class="token comment"># src = GetImage(cam)</span>
    cv2<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span><span class="token string">'1.png'</span><span class="token punctuation">,</span> src<span class="token punctuation">)</span>
    cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># ch:停止取流 | en:Stop grab image</span>
    ret <span class="token operator">=</span> cam<span class="token punctuation">.</span>MV_CC_StopGrabbing<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> ret <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"stop grabbing fail! ret[0x%x]"</span> <span class="token operator">%</span> ret<span class="token punctuation">)</span>
        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># ch:关闭设备 | Close device</span>
    ret <span class="token operator">=</span> cam<span class="token punctuation">.</span>MV_CC_CloseDevice<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> ret <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"close deivce fail! ret[0x%x]"</span> <span class="token operator">%</span> ret<span class="token punctuation">)</span>
        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># ch:销毁句柄 | Destroy handle</span>
    ret <span class="token operator">=</span> cam<span class="token punctuation">.</span>MV_CC_DestroyHandle<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> ret <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"destroy handle fail! ret[0x%x]"</span> <span class="token operator">%</span> ret<span class="token punctuation">)</span>
        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
    cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">GetImage</span><span class="token punctuation">(</span>cam<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sec <span class="token operator">=</span> <span class="token number">0</span>
    data_buf <span class="token operator">=</span> <span class="token boolean">None</span>
    stOutFrame <span class="token operator">=</span> MV_FRAME_OUT<span class="token punctuation">(</span><span class="token punctuation">)</span>
    memset<span class="token punctuation">(</span>byref<span class="token punctuation">(</span>stOutFrame<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> sizeof<span class="token punctuation">(</span>stOutFrame<span class="token punctuation">)</span><span class="token punctuation">)</span>
    ret <span class="token operator">=</span> cam<span class="token punctuation">.</span>MV_CC_GetImageBuffer<span class="token punctuation">(</span>stOutFrame<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token boolean">None</span> <span class="token operator">!=</span> stOutFrame<span class="token punctuation">.</span>pBufAddr <span class="token keyword">and</span> <span class="token number">0</span> <span class="token operator">==</span> ret<span class="token punctuation">:</span>
        <span class="token keyword">if</span> data_buf <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            data_buf <span class="token operator">=</span> <span class="token punctuation">(</span>c_ubyte <span class="token operator">*</span> stOutFrame<span class="token punctuation">.</span>stFrameInfo<span class="token punctuation">.</span>nFrameLen<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        cdll<span class="token punctuation">.</span>msvcrt<span class="token punctuation">.</span>memcpy<span class="token punctuation">(</span>byref<span class="token punctuation">(</span>data_buf<span class="token punctuation">)</span><span class="token punctuation">,</span> stOutFrame<span class="token punctuation">.</span>pBufAddr<span class="token punctuation">,</span> stOutFrame<span class="token punctuation">.</span>stFrameInfo<span class="token punctuation">.</span>nFrameLen<span class="token punctuation">)</span>
        temp <span class="token operator">=</span> np<span class="token punctuation">.</span>asarray<span class="token punctuation">(</span>data_buf<span class="token punctuation">)</span>

        <span class="token comment"># print("get one frame: Width[%d], Height[%d], nFrameNum[%d]" % (</span>
        <span class="token comment">#     stOutFrame.stFrameInfo.nWidth, stOutFrame.stFrameInfo.nHeight, stOutFrame.stFrameInfo.nFrameNum))</span>
        <span class="token comment"># print(temp.shape)</span>
        <span class="token comment"># 可以用上述print来获取数据总大小 如 6291456 = 2048 * 3072 * 1   即得channel为1</span>
        <span class="token comment"># 也可以打开MVS来查看相机分辨率</span>
        <span class="token comment"># 改成使用相机的宽和高以及通道</span>
        temp <span class="token operator">=</span> temp<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2048</span><span class="token punctuation">,</span> <span class="token number">3072</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        temp <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>temp<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BayerBG2BGR<span class="token punctuation">)</span>
        nRet <span class="token operator">=</span> cam<span class="token punctuation">.</span>MV_CC_FreeImageBuffer<span class="token punctuation">(</span>stOutFrame<span class="token punctuation">)</span>
        <span class="token keyword">return</span> temp
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"no data[0x%x]"</span> <span class="token operator">%</span> ret<span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>该段代码是自动打开0号相机，若提示错误检查MvCameraControl.dll是否导入<br> 注意最后的temp.reshape操作，需要完全安装相机配置来更改<br> 此代码仅仅针对Gige工业相机</p> 
<h3><a id="3_AllOpencvpy_204"></a>3. 创建AllOpencv.py文件</h3> 
<p>此代码所有相机可检测，不过搜索时间会很久</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> os
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> os <span class="token keyword">import</span> getcwd
<span class="token keyword">import</span> cv2
<span class="token keyword">import</span> msvcrt
<span class="token keyword">from</span> ctypes <span class="token keyword">import</span> <span class="token operator">*</span>

sys<span class="token punctuation">.</span>path<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"../MvImport"</span><span class="token punctuation">)</span>
<span class="token keyword">from</span> MvCameraControl_class <span class="token keyword">import</span> <span class="token operator">*</span>


<span class="token comment"># 枚举设备</span>
<span class="token keyword">def</span> <span class="token function">enum_devices</span><span class="token punctuation">(</span>device<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> device_way<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    device = 0  枚举网口、USB口、未知设备、cameralink 设备
    device = 1 枚举GenTL设备
    """</span>
    <span class="token keyword">if</span> device_way <span class="token operator">==</span> <span class="token boolean">False</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> device <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            tlayerType <span class="token operator">=</span> MV_GIGE_DEVICE <span class="token operator">|</span> MV_USB_DEVICE <span class="token operator">|</span> MV_UNKNOW_DEVICE <span class="token operator">|</span> MV_1394_DEVICE <span class="token operator">|</span> MV_CAMERALINK_DEVICE
            deviceList <span class="token operator">=</span> MV_CC_DEVICE_INFO_LIST<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment"># 枚举设备, 若是查找unknown设备会很久</span>
            ret <span class="token operator">=</span> MvCamera<span class="token punctuation">.</span>MV_CC_EnumDevices<span class="token punctuation">(</span>tlayerType<span class="token punctuation">,</span> deviceList<span class="token punctuation">)</span>
            <span class="token keyword">if</span> ret <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"enum devices fail! ret[0x%x]"</span> <span class="token operator">%</span> ret<span class="token punctuation">)</span>
                sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> deviceList<span class="token punctuation">.</span>nDeviceNum <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"find no device!"</span><span class="token punctuation">)</span>
                sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Find %d devices!"</span> <span class="token operator">%</span> deviceList<span class="token punctuation">.</span>nDeviceNum<span class="token punctuation">)</span>
            <span class="token keyword">return</span> deviceList
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">pass</span>
    <span class="token keyword">elif</span> device_way <span class="token operator">==</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>


<span class="token comment"># 判断不同类型设备</span>
<span class="token keyword">def</span> <span class="token function">identify_different_devices</span><span class="token punctuation">(</span>deviceList<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 判断不同类型设备，并输出相关信息</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> deviceList<span class="token punctuation">.</span>nDeviceNum<span class="token punctuation">)</span><span class="token punctuation">:</span>
        mvcc_dev_info <span class="token operator">=</span> cast<span class="token punctuation">(</span>deviceList<span class="token punctuation">.</span>pDeviceInfo<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> POINTER<span class="token punctuation">(</span>MV_CC_DEVICE_INFO<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>contents
        <span class="token comment"># 判断是否为网口相机</span>
        <span class="token keyword">if</span> mvcc_dev_info<span class="token punctuation">.</span>nTLayerType <span class="token operator">==</span> MV_GIGE_DEVICE<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n网口设备序号: [%d]"</span> <span class="token operator">%</span> i<span class="token punctuation">)</span>
            <span class="token comment"># 获取设备名</span>
            strModeName <span class="token operator">=</span> <span class="token string">""</span>
            <span class="token keyword">for</span> per <span class="token keyword">in</span> mvcc_dev_info<span class="token punctuation">.</span>SpecialInfo<span class="token punctuation">.</span>stGigEInfo<span class="token punctuation">.</span>chModelName<span class="token punctuation">:</span>
                strModeName <span class="token operator">=</span> strModeName <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>per<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"当前设备型号名: %s"</span> <span class="token operator">%</span> strModeName<span class="token punctuation">)</span>
            <span class="token comment"># 获取当前设备 IP 地址</span>
            nip1_1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>mvcc_dev_info<span class="token punctuation">.</span>SpecialInfo<span class="token punctuation">.</span>stGigEInfo<span class="token punctuation">.</span>nCurrentIp <span class="token operator">&amp;</span> <span class="token number">0xff000000</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">24</span><span class="token punctuation">)</span>
            nip1_2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>mvcc_dev_info<span class="token punctuation">.</span>SpecialInfo<span class="token punctuation">.</span>stGigEInfo<span class="token punctuation">.</span>nCurrentIp <span class="token operator">&amp;</span> <span class="token number">0x00ff0000</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">16</span><span class="token punctuation">)</span>
            nip1_3 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>mvcc_dev_info<span class="token punctuation">.</span>SpecialInfo<span class="token punctuation">.</span>stGigEInfo<span class="token punctuation">.</span>nCurrentIp <span class="token operator">&amp;</span> <span class="token number">0x0000ff00</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">8</span><span class="token punctuation">)</span>
            nip1_4 <span class="token operator">=</span> <span class="token punctuation">(</span>mvcc_dev_info<span class="token punctuation">.</span>SpecialInfo<span class="token punctuation">.</span>stGigEInfo<span class="token punctuation">.</span>nCurrentIp <span class="token operator">&amp;</span> <span class="token number">0x000000ff</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"当前 ip 地址: %d.%d.%d.%d"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>nip1_1<span class="token punctuation">,</span> nip1_2<span class="token punctuation">,</span> nip1_3<span class="token punctuation">,</span> nip1_4<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment"># 获取当前子网掩码</span>
            nip2_1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>mvcc_dev_info<span class="token punctuation">.</span>SpecialInfo<span class="token punctuation">.</span>stGigEInfo<span class="token punctuation">.</span>nCurrentSubNetMask <span class="token operator">&amp;</span> <span class="token number">0xff000000</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">24</span><span class="token punctuation">)</span>
            nip2_2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>mvcc_dev_info<span class="token punctuation">.</span>SpecialInfo<span class="token punctuation">.</span>stGigEInfo<span class="token punctuation">.</span>nCurrentSubNetMask <span class="token operator">&amp;</span> <span class="token number">0x00ff0000</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">16</span><span class="token punctuation">)</span>
            nip2_3 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>mvcc_dev_info<span class="token punctuation">.</span>SpecialInfo<span class="token punctuation">.</span>stGigEInfo<span class="token punctuation">.</span>nCurrentSubNetMask <span class="token operator">&amp;</span> <span class="token number">0x0000ff00</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">8</span><span class="token punctuation">)</span>
            nip2_4 <span class="token operator">=</span> <span class="token punctuation">(</span>mvcc_dev_info<span class="token punctuation">.</span>SpecialInfo<span class="token punctuation">.</span>stGigEInfo<span class="token punctuation">.</span>nCurrentSubNetMask <span class="token operator">&amp;</span> <span class="token number">0x000000ff</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"当前子网掩码 : %d.%d.%d.%d"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>nip2_1<span class="token punctuation">,</span> nip2_2<span class="token punctuation">,</span> nip2_3<span class="token punctuation">,</span> nip2_4<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment"># 获取当前网关</span>
            nip3_1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>mvcc_dev_info<span class="token punctuation">.</span>SpecialInfo<span class="token punctuation">.</span>stGigEInfo<span class="token punctuation">.</span>nDefultGateWay <span class="token operator">&amp;</span> <span class="token number">0xff000000</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">24</span><span class="token punctuation">)</span>
            nip3_2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>mvcc_dev_info<span class="token punctuation">.</span>SpecialInfo<span class="token punctuation">.</span>stGigEInfo<span class="token punctuation">.</span>nDefultGateWay <span class="token operator">&amp;</span> <span class="token number">0x00ff0000</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">16</span><span class="token punctuation">)</span>
            nip3_3 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>mvcc_dev_info<span class="token punctuation">.</span>SpecialInfo<span class="token punctuation">.</span>stGigEInfo<span class="token punctuation">.</span>nDefultGateWay <span class="token operator">&amp;</span> <span class="token number">0x0000ff00</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">8</span><span class="token punctuation">)</span>
            nip3_4 <span class="token operator">=</span> <span class="token punctuation">(</span>mvcc_dev_info<span class="token punctuation">.</span>SpecialInfo<span class="token punctuation">.</span>stGigEInfo<span class="token punctuation">.</span>nDefultGateWay <span class="token operator">&amp;</span> <span class="token number">0x000000ff</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"当前网关 : %d.%d.%d.%d"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>nip3_1<span class="token punctuation">,</span> nip3_2<span class="token punctuation">,</span> nip3_3<span class="token punctuation">,</span> nip3_4<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment"># 获取网口 IP 地址</span>
            nip4_1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>mvcc_dev_info<span class="token punctuation">.</span>SpecialInfo<span class="token punctuation">.</span>stGigEInfo<span class="token punctuation">.</span>nNetExport <span class="token operator">&amp;</span> <span class="token number">0xff000000</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">24</span><span class="token punctuation">)</span>
            nip4_2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>mvcc_dev_info<span class="token punctuation">.</span>SpecialInfo<span class="token punctuation">.</span>stGigEInfo<span class="token punctuation">.</span>nNetExport <span class="token operator">&amp;</span> <span class="token number">0x00ff0000</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">16</span><span class="token punctuation">)</span>
            nip4_3 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>mvcc_dev_info<span class="token punctuation">.</span>SpecialInfo<span class="token punctuation">.</span>stGigEInfo<span class="token punctuation">.</span>nNetExport <span class="token operator">&amp;</span> <span class="token number">0x0000ff00</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">8</span><span class="token punctuation">)</span>
            nip4_4 <span class="token operator">=</span> <span class="token punctuation">(</span>mvcc_dev_info<span class="token punctuation">.</span>SpecialInfo<span class="token punctuation">.</span>stGigEInfo<span class="token punctuation">.</span>nNetExport <span class="token operator">&amp;</span> <span class="token number">0x000000ff</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"当前连接的网口 IP 地址 : %d.%d.%d.%d"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>nip4_1<span class="token punctuation">,</span> nip4_2<span class="token punctuation">,</span> nip4_3<span class="token punctuation">,</span> nip4_4<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment"># 获取制造商名称</span>
            strmanufacturerName <span class="token operator">=</span> <span class="token string">""</span>
            <span class="token keyword">for</span> per <span class="token keyword">in</span> mvcc_dev_info<span class="token punctuation">.</span>SpecialInfo<span class="token punctuation">.</span>stGigEInfo<span class="token punctuation">.</span>chManufacturerName<span class="token punctuation">:</span>
                strmanufacturerName <span class="token operator">=</span> strmanufacturerName <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>per<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"制造商名称 : %s"</span> <span class="token operator">%</span> strmanufacturerName<span class="token punctuation">)</span>
            <span class="token comment"># 获取设备版本</span>
            stdeviceversion <span class="token operator">=</span> <span class="token string">""</span>
            <span class="token keyword">for</span> per <span class="token keyword">in</span> mvcc_dev_info<span class="token punctuation">.</span>SpecialInfo<span class="token punctuation">.</span>stGigEInfo<span class="token punctuation">.</span>chDeviceVersion<span class="token punctuation">:</span>
                stdeviceversion <span class="token operator">=</span> stdeviceversion <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>per<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"设备当前使用固件版本 : %s"</span> <span class="token operator">%</span> stdeviceversion<span class="token punctuation">)</span>
            <span class="token comment"># 获取制造商的具体信息</span>
            stManufacturerSpecificInfo <span class="token operator">=</span> <span class="token string">""</span>
            <span class="token keyword">for</span> per <span class="token keyword">in</span> mvcc_dev_info<span class="token punctuation">.</span>SpecialInfo<span class="token punctuation">.</span>stGigEInfo<span class="token punctuation">.</span>chManufacturerSpecificInfo<span class="token punctuation">:</span>
                stManufacturerSpecificInfo <span class="token operator">=</span> stManufacturerSpecificInfo <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>per<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"设备制造商的具体信息 : %s"</span> <span class="token operator">%</span> stManufacturerSpecificInfo<span class="token punctuation">)</span>
            <span class="token comment"># 获取设备序列号</span>
            stSerialNumber <span class="token operator">=</span> <span class="token string">""</span>
            <span class="token keyword">for</span> per <span class="token keyword">in</span> mvcc_dev_info<span class="token punctuation">.</span>SpecialInfo<span class="token punctuation">.</span>stGigEInfo<span class="token punctuation">.</span>chSerialNumber<span class="token punctuation">:</span>
                stSerialNumber <span class="token operator">=</span> stSerialNumber <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>per<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"设备序列号 : %s"</span> <span class="token operator">%</span> stSerialNumber<span class="token punctuation">)</span>
            <span class="token comment"># 获取用户自定义名称</span>
            stUserDefinedName <span class="token operator">=</span> <span class="token string">""</span>
            <span class="token keyword">for</span> per <span class="token keyword">in</span> mvcc_dev_info<span class="token punctuation">.</span>SpecialInfo<span class="token punctuation">.</span>stGigEInfo<span class="token punctuation">.</span>chUserDefinedName<span class="token punctuation">:</span>
                stUserDefinedName <span class="token operator">=</span> stUserDefinedName <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>per<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"用户自定义名称 : %s"</span> <span class="token operator">%</span> stUserDefinedName<span class="token punctuation">)</span>

        <span class="token comment"># 判断是否为 USB 接口相机</span>
        <span class="token keyword">elif</span> mvcc_dev_info<span class="token punctuation">.</span>nTLayerType <span class="token operator">==</span> MV_USB_DEVICE<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nU3V 设备序号e: [%d]"</span> <span class="token operator">%</span> i<span class="token punctuation">)</span>
            strModeName <span class="token operator">=</span> <span class="token string">""</span>
            <span class="token keyword">for</span> per <span class="token keyword">in</span> mvcc_dev_info<span class="token punctuation">.</span>SpecialInfo<span class="token punctuation">.</span>stUsb3VInfo<span class="token punctuation">.</span>chModelName<span class="token punctuation">:</span>
                <span class="token keyword">if</span> per <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                    <span class="token keyword">break</span>
                strModeName <span class="token operator">=</span> strModeName <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>per<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"当前设备型号名 : %s"</span> <span class="token operator">%</span> strModeName<span class="token punctuation">)</span>
            strSerialNumber <span class="token operator">=</span> <span class="token string">""</span>
            <span class="token keyword">for</span> per <span class="token keyword">in</span> mvcc_dev_info<span class="token punctuation">.</span>SpecialInfo<span class="token punctuation">.</span>stUsb3VInfo<span class="token punctuation">.</span>chSerialNumber<span class="token punctuation">:</span>
                <span class="token keyword">if</span> per <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                    <span class="token keyword">break</span>
                strSerialNumber <span class="token operator">=</span> strSerialNumber <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>per<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"当前设备序列号 : %s"</span> <span class="token operator">%</span> strSerialNumber<span class="token punctuation">)</span>
            <span class="token comment"># 获取制造商名称</span>
            strmanufacturerName <span class="token operator">=</span> <span class="token string">""</span>
            <span class="token keyword">for</span> per <span class="token keyword">in</span> mvcc_dev_info<span class="token punctuation">.</span>SpecialInfo<span class="token punctuation">.</span>stUsb3VInfo<span class="token punctuation">.</span>chVendorName<span class="token punctuation">:</span>
                strmanufacturerName <span class="token operator">=</span> strmanufacturerName <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>per<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"制造商名称 : %s"</span> <span class="token operator">%</span> strmanufacturerName<span class="token punctuation">)</span>
            <span class="token comment"># 获取设备版本</span>
            stdeviceversion <span class="token operator">=</span> <span class="token string">""</span>
            <span class="token keyword">for</span> per <span class="token keyword">in</span> mvcc_dev_info<span class="token punctuation">.</span>SpecialInfo<span class="token punctuation">.</span>stUsb3VInfo<span class="token punctuation">.</span>chDeviceVersion<span class="token punctuation">:</span>
                stdeviceversion <span class="token operator">=</span> stdeviceversion <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>per<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"设备当前使用固件版本 : %s"</span> <span class="token operator">%</span> stdeviceversion<span class="token punctuation">)</span>
            <span class="token comment"># 获取设备序列号</span>
            stSerialNumber <span class="token operator">=</span> <span class="token string">""</span>
            <span class="token keyword">for</span> per <span class="token keyword">in</span> mvcc_dev_info<span class="token punctuation">.</span>SpecialInfo<span class="token punctuation">.</span>stUsb3VInfo<span class="token punctuation">.</span>chSerialNumber<span class="token punctuation">:</span>
                stSerialNumber <span class="token operator">=</span> stSerialNumber <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>per<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"设备序列号 : %s"</span> <span class="token operator">%</span> stSerialNumber<span class="token punctuation">)</span>
            <span class="token comment"># 获取用户自定义名称</span>
            stUserDefinedName <span class="token operator">=</span> <span class="token string">""</span>
            <span class="token keyword">for</span> per <span class="token keyword">in</span> mvcc_dev_info<span class="token punctuation">.</span>SpecialInfo<span class="token punctuation">.</span>stUsb3VInfo<span class="token punctuation">.</span>chUserDefinedName<span class="token punctuation">:</span>
                stUserDefinedName <span class="token operator">=</span> stUserDefinedName <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>per<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"用户自定义名称 : %s"</span> <span class="token operator">%</span> stUserDefinedName<span class="token punctuation">)</span>
            <span class="token comment"># 获取设备 GUID</span>
            stDeviceGUID <span class="token operator">=</span> <span class="token string">""</span>
            <span class="token keyword">for</span> per <span class="token keyword">in</span> mvcc_dev_info<span class="token punctuation">.</span>SpecialInfo<span class="token punctuation">.</span>stUsb3VInfo<span class="token punctuation">.</span>chDeviceGUID<span class="token punctuation">:</span>
                stDeviceGUID <span class="token operator">=</span> stDeviceGUID <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>per<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"设备GUID号 : %s"</span> <span class="token operator">%</span> stDeviceGUID<span class="token punctuation">)</span>
            <span class="token comment"># 获取设备的家族名称</span>
            stFamilyName <span class="token operator">=</span> <span class="token string">""</span>
            <span class="token keyword">for</span> per <span class="token keyword">in</span> mvcc_dev_info<span class="token punctuation">.</span>SpecialInfo<span class="token punctuation">.</span>stUsb3VInfo<span class="token punctuation">.</span>chFamilyName<span class="token punctuation">:</span>
                stFamilyName <span class="token operator">=</span> stFamilyName <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>per<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"设备的家族名称 : %s"</span> <span class="token operator">%</span> stFamilyName<span class="token punctuation">)</span>

        <span class="token comment"># 判断是否为 1394-a/b 设备</span>
        <span class="token keyword">elif</span> mvcc_dev_info<span class="token punctuation">.</span>nTLayerType <span class="token operator">==</span> MV_1394_DEVICE<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n1394-a/b device: [%d]"</span> <span class="token operator">%</span> i<span class="token punctuation">)</span>

        <span class="token comment"># 判断是否为 cameralink 设备</span>
        <span class="token keyword">elif</span> mvcc_dev_info<span class="token punctuation">.</span>nTLayerType <span class="token operator">==</span> MV_CAMERALINK_DEVICE<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\ncameralink device: [%d]"</span> <span class="token operator">%</span> i<span class="token punctuation">)</span>
            <span class="token comment"># 获取当前设备名</span>
            strModeName <span class="token operator">=</span> <span class="token string">""</span>
            <span class="token keyword">for</span> per <span class="token keyword">in</span> mvcc_dev_info<span class="token punctuation">.</span>SpecialInfo<span class="token punctuation">.</span>stCamLInfo<span class="token punctuation">.</span>chModelName<span class="token punctuation">:</span>
                <span class="token keyword">if</span> per <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                    <span class="token keyword">break</span>
                strModeName <span class="token operator">=</span> strModeName <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>per<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"当前设备型号名 : %s"</span> <span class="token operator">%</span> strModeName<span class="token punctuation">)</span>
            <span class="token comment"># 获取当前设备序列号</span>
            strSerialNumber <span class="token operator">=</span> <span class="token string">""</span>
            <span class="token keyword">for</span> per <span class="token keyword">in</span> mvcc_dev_info<span class="token punctuation">.</span>SpecialInfo<span class="token punctuation">.</span>stCamLInfo<span class="token punctuation">.</span>chSerialNumber<span class="token punctuation">:</span>
                <span class="token keyword">if</span> per <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                    <span class="token keyword">break</span>
                strSerialNumber <span class="token operator">=</span> strSerialNumber <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>per<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"当前设备序列号 : %s"</span> <span class="token operator">%</span> strSerialNumber<span class="token punctuation">)</span>
            <span class="token comment"># 获取制造商名称</span>
            strmanufacturerName <span class="token operator">=</span> <span class="token string">""</span>
            <span class="token keyword">for</span> per <span class="token keyword">in</span> mvcc_dev_info<span class="token punctuation">.</span>SpecialInfo<span class="token punctuation">.</span>stCamLInfo<span class="token punctuation">.</span>chVendorName<span class="token punctuation">:</span>
                strmanufacturerName <span class="token operator">=</span> strmanufacturerName <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>per<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"制造商名称 : %s"</span> <span class="token operator">%</span> strmanufacturerName<span class="token punctuation">)</span>
            <span class="token comment"># 获取设备版本</span>
            stdeviceversion <span class="token operator">=</span> <span class="token string">""</span>
            <span class="token keyword">for</span> per <span class="token keyword">in</span> mvcc_dev_info<span class="token punctuation">.</span>SpecialInfo<span class="token punctuation">.</span>stCamLInfo<span class="token punctuation">.</span>chDeviceVersion<span class="token punctuation">:</span>
                stdeviceversion <span class="token operator">=</span> stdeviceversion <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>per<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"设备当前使用固件版本 : %s"</span> <span class="token operator">%</span> stdeviceversion<span class="token punctuation">)</span>


<span class="token comment"># 输入需要连接的相机的序号</span>
<span class="token keyword">def</span> <span class="token function">input_num_camera</span><span class="token punctuation">(</span>deviceList<span class="token punctuation">)</span><span class="token punctuation">:</span>
    nConnectionNum <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"please input the number of the device to connect:"</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token builtin">int</span><span class="token punctuation">(</span>nConnectionNum<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> deviceList<span class="token punctuation">.</span>nDeviceNum<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"intput error!"</span><span class="token punctuation">)</span>
        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> nConnectionNum


<span class="token comment"># 创建相机实例并创建句柄,(设置日志路径)</span>
<span class="token keyword">def</span> <span class="token function">creat_camera</span><span class="token punctuation">(</span>deviceList<span class="token punctuation">,</span> nConnectionNum<span class="token punctuation">,</span> log<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> log_path<span class="token operator">=</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    :param deviceList:        设备列表
    :param nConnectionNum:    需要连接的设备序号
    :param log:               是否创建日志
    :param log_path:          日志保存路径
    :return:                  相机实例和设备列表
    """</span>
    <span class="token comment"># 创建相机实例</span>
    cam <span class="token operator">=</span> MvCamera<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 选择设备并创建句柄</span>
    stDeviceList <span class="token operator">=</span> cast<span class="token punctuation">(</span>deviceList<span class="token punctuation">.</span>pDeviceInfo<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>nConnectionNum<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> POINTER<span class="token punctuation">(</span>MV_CC_DEVICE_INFO<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>contents
    <span class="token keyword">if</span> log <span class="token operator">==</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        ret <span class="token operator">=</span> cam<span class="token punctuation">.</span>MV_CC_SetSDKLogPath<span class="token punctuation">(</span>log_path<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>log_path<span class="token punctuation">)</span>
        <span class="token keyword">if</span> ret <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"set Log path  fail! ret[0x%x]"</span> <span class="token operator">%</span> ret<span class="token punctuation">)</span>
            sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># 创建句柄,生成日志</span>
        ret <span class="token operator">=</span> cam<span class="token punctuation">.</span>MV_CC_CreateHandle<span class="token punctuation">(</span>stDeviceList<span class="token punctuation">)</span>
        <span class="token keyword">if</span> ret <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"create handle fail! ret[0x%x]"</span> <span class="token operator">%</span> ret<span class="token punctuation">)</span>
            sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> log <span class="token operator">==</span> <span class="token boolean">False</span><span class="token punctuation">:</span>
        <span class="token comment"># 创建句柄,不生成日志</span>
        ret <span class="token operator">=</span> cam<span class="token punctuation">.</span>MV_CC_CreateHandleWithoutLog<span class="token punctuation">(</span>stDeviceList<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">1111</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> ret <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"create handle fail! ret[0x%x]"</span> <span class="token operator">%</span> ret<span class="token punctuation">)</span>
            sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> cam<span class="token punctuation">,</span> stDeviceList


<span class="token comment"># 打开设备</span>
<span class="token keyword">def</span> <span class="token function">open_device</span><span class="token punctuation">(</span>cam<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># ch:打开设备 | en:Open device</span>
    ret <span class="token operator">=</span> cam<span class="token punctuation">.</span>MV_CC_OpenDevice<span class="token punctuation">(</span>MV_ACCESS_Exclusive<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> ret <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"open device fail! ret[0x%x]"</span> <span class="token operator">%</span> ret<span class="token punctuation">)</span>
        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token comment"># 获取各种类型节点参数</span>
<span class="token keyword">def</span> <span class="token function">get_Value</span><span class="token punctuation">(</span>cam<span class="token punctuation">,</span> param_type<span class="token operator">=</span><span class="token string">"int_value"</span><span class="token punctuation">,</span> node_name<span class="token operator">=</span><span class="token string">"PayloadSize"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    :param cam:            相机实例
    :param_type:           获取节点值得类型
    :param node_name:      节点名 可选 int 、float 、enum 、bool 、string 型节点
    :return:               节点值
    """</span>
    <span class="token keyword">if</span> param_type <span class="token operator">==</span> <span class="token string">"int_value"</span><span class="token punctuation">:</span>
        stParam <span class="token operator">=</span> MVCC_INTVALUE_EX<span class="token punctuation">(</span><span class="token punctuation">)</span>
        memset<span class="token punctuation">(</span>byref<span class="token punctuation">(</span>stParam<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> sizeof<span class="token punctuation">(</span>MVCC_INTVALUE_EX<span class="token punctuation">)</span><span class="token punctuation">)</span>
        ret <span class="token operator">=</span> cam<span class="token punctuation">.</span>MV_CC_GetIntValueEx<span class="token punctuation">(</span>node_name<span class="token punctuation">,</span> stParam<span class="token punctuation">)</span>
        <span class="token keyword">if</span> ret <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"获取 int 型数据 %s 失败 ! 报错码 ret[0x%x]"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>node_name<span class="token punctuation">,</span> ret<span class="token punctuation">)</span><span class="token punctuation">)</span>
            sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
        int_value <span class="token operator">=</span> stParam<span class="token punctuation">.</span>nCurValue
        <span class="token keyword">return</span> int_value

    <span class="token keyword">elif</span> param_type <span class="token operator">==</span> <span class="token string">"float_value"</span><span class="token punctuation">:</span>
        stFloatValue <span class="token operator">=</span> MVCC_FLOATVALUE<span class="token punctuation">(</span><span class="token punctuation">)</span>
        memset<span class="token punctuation">(</span>byref<span class="token punctuation">(</span>stFloatValue<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> sizeof<span class="token punctuation">(</span>MVCC_FLOATVALUE<span class="token punctuation">)</span><span class="token punctuation">)</span>
        ret <span class="token operator">=</span> cam<span class="token punctuation">.</span>MV_CC_GetFloatValue<span class="token punctuation">(</span>node_name<span class="token punctuation">,</span> stFloatValue<span class="token punctuation">)</span>
        <span class="token keyword">if</span> ret <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"获取 float 型数据 %s 失败 ! 报错码 ret[0x%x]"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>node_name<span class="token punctuation">,</span> ret<span class="token punctuation">)</span><span class="token punctuation">)</span>
            sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
        float_value <span class="token operator">=</span> stFloatValue<span class="token punctuation">.</span>fCurValue
        <span class="token keyword">return</span> float_value

    <span class="token keyword">elif</span> param_type <span class="token operator">==</span> <span class="token string">"enum_value"</span><span class="token punctuation">:</span>
        stEnumValue <span class="token operator">=</span> MVCC_ENUMVALUE<span class="token punctuation">(</span><span class="token punctuation">)</span>
        memset<span class="token punctuation">(</span>byref<span class="token punctuation">(</span>stEnumValue<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> sizeof<span class="token punctuation">(</span>MVCC_ENUMVALUE<span class="token punctuation">)</span><span class="token punctuation">)</span>
        ret <span class="token operator">=</span> cam<span class="token punctuation">.</span>MV_CC_GetEnumValue<span class="token punctuation">(</span>node_name<span class="token punctuation">,</span> stEnumValue<span class="token punctuation">)</span>
        <span class="token keyword">if</span> ret <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"获取 enum 型数据 %s 失败 ! 报错码 ret[0x%x]"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>node_name<span class="token punctuation">,</span> ret<span class="token punctuation">)</span><span class="token punctuation">)</span>
            sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
        enum_value <span class="token operator">=</span> stEnumValue<span class="token punctuation">.</span>nCurValue
        <span class="token keyword">return</span> enum_value

    <span class="token keyword">elif</span> param_type <span class="token operator">==</span> <span class="token string">"bool_value"</span><span class="token punctuation">:</span>
        stBool <span class="token operator">=</span> c_bool<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>
        ret <span class="token operator">=</span> cam<span class="token punctuation">.</span>MV_CC_GetBoolValue<span class="token punctuation">(</span>node_name<span class="token punctuation">,</span> stBool<span class="token punctuation">)</span>
        <span class="token keyword">if</span> ret <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"获取 bool 型数据 %s 失败 ! 报错码 ret[0x%x]"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>node_name<span class="token punctuation">,</span> ret<span class="token punctuation">)</span><span class="token punctuation">)</span>
            sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> stBool<span class="token punctuation">.</span>value

    <span class="token keyword">elif</span> param_type <span class="token operator">==</span> <span class="token string">"string_value"</span><span class="token punctuation">:</span>
        stStringValue <span class="token operator">=</span> MVCC_STRINGVALUE<span class="token punctuation">(</span><span class="token punctuation">)</span>
        memset<span class="token punctuation">(</span>byref<span class="token punctuation">(</span>stStringValue<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> sizeof<span class="token punctuation">(</span>MVCC_STRINGVALUE<span class="token punctuation">)</span><span class="token punctuation">)</span>
        ret <span class="token operator">=</span> cam<span class="token punctuation">.</span>MV_CC_GetStringValue<span class="token punctuation">(</span>node_name<span class="token punctuation">,</span> stStringValue<span class="token punctuation">)</span>
        <span class="token keyword">if</span> ret <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"获取 string 型数据 %s 失败 ! 报错码 ret[0x%x]"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>node_name<span class="token punctuation">,</span> ret<span class="token punctuation">)</span><span class="token punctuation">)</span>
            sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
        string_value <span class="token operator">=</span> stStringValue<span class="token punctuation">.</span>chCurValue
        <span class="token keyword">return</span> string_value


<span class="token comment"># 设置各种类型节点参数</span>
<span class="token keyword">def</span> <span class="token function">set_Value</span><span class="token punctuation">(</span>cam<span class="token punctuation">,</span> param_type<span class="token operator">=</span><span class="token string">"int_value"</span><span class="token punctuation">,</span> node_name<span class="token operator">=</span><span class="token string">"PayloadSize"</span><span class="token punctuation">,</span> node_value<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    :param cam:               相机实例
    :param param_type:        需要设置的节点值得类型
        int:
        float:
        enum:     参考于客户端中该选项的 Enum Entry Value 值即可
        bool:     对应 0 为关，1 为开
        string:   输入值为数字或者英文字符，不能为汉字
    :param node_name:         需要设置的节点名
    :param node_value:        设置给节点的值
    :return:
    """</span>
    <span class="token keyword">if</span> param_type <span class="token operator">==</span> <span class="token string">"int_value"</span><span class="token punctuation">:</span>
        stParam <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>node_value<span class="token punctuation">)</span>
        ret <span class="token operator">=</span> cam<span class="token punctuation">.</span>MV_CC_SetIntValueEx<span class="token punctuation">(</span>node_name<span class="token punctuation">,</span> stParam<span class="token punctuation">)</span>
        <span class="token keyword">if</span> ret <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"设置 int 型数据节点 %s 失败 ! 报错码 ret[0x%x]"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>node_name<span class="token punctuation">,</span> ret<span class="token punctuation">)</span><span class="token punctuation">)</span>
            sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"设置 int 型数据节点 %s 成功 ！设置值为 %s !"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>node_name<span class="token punctuation">,</span> node_value<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">elif</span> param_type <span class="token operator">==</span> <span class="token string">"float_value"</span><span class="token punctuation">:</span>
        stFloatValue <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>node_value<span class="token punctuation">)</span>
        ret <span class="token operator">=</span> cam<span class="token punctuation">.</span>MV_CC_SetFloatValue<span class="token punctuation">(</span>node_name<span class="token punctuation">,</span> stFloatValue<span class="token punctuation">)</span>
        <span class="token keyword">if</span> ret <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"设置 float 型数据节点 %s 失败 ! 报错码 ret[0x%x]"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>node_name<span class="token punctuation">,</span> ret<span class="token punctuation">)</span><span class="token punctuation">)</span>
            sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"设置 float 型数据节点 %s 成功 ！设置值为 %s !"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>node_name<span class="token punctuation">,</span> node_value<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">elif</span> param_type <span class="token operator">==</span> <span class="token string">"enum_value"</span><span class="token punctuation">:</span>
        stEnumValue <span class="token operator">=</span> node_value
        ret <span class="token operator">=</span> cam<span class="token punctuation">.</span>MV_CC_SetEnumValue<span class="token punctuation">(</span>node_name<span class="token punctuation">,</span> stEnumValue<span class="token punctuation">)</span>
        <span class="token keyword">if</span> ret <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"设置 enum 型数据节点 %s 失败 ! 报错码 ret[0x%x]"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>node_name<span class="token punctuation">,</span> ret<span class="token punctuation">)</span><span class="token punctuation">)</span>
            sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"设置 enum 型数据节点 %s 成功 ！设置值为 %s !"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>node_name<span class="token punctuation">,</span> node_value<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">elif</span> param_type <span class="token operator">==</span> <span class="token string">"bool_value"</span><span class="token punctuation">:</span>
        ret <span class="token operator">=</span> cam<span class="token punctuation">.</span>MV_CC_SetBoolValue<span class="token punctuation">(</span>node_name<span class="token punctuation">,</span> node_value<span class="token punctuation">)</span>
        <span class="token keyword">if</span> ret <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"设置 bool 型数据节点 %s 失败 ！ 报错码 ret[0x%x]"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>node_name<span class="token punctuation">,</span> ret<span class="token punctuation">)</span><span class="token punctuation">)</span>
            sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"设置 bool 型数据节点 %s 成功 ！设置值为 %s !"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>node_name<span class="token punctuation">,</span> node_value<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">elif</span> param_type <span class="token operator">==</span> <span class="token string">"string_value"</span><span class="token punctuation">:</span>
        stStringValue <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>node_value<span class="token punctuation">)</span>
        ret <span class="token operator">=</span> cam<span class="token punctuation">.</span>MV_CC_SetStringValue<span class="token punctuation">(</span>node_name<span class="token punctuation">,</span> stStringValue<span class="token punctuation">)</span>
        <span class="token keyword">if</span> ret <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"设置 string 型数据节点 %s 失败 ! 报错码 ret[0x%x]"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>node_name<span class="token punctuation">,</span> ret<span class="token punctuation">)</span><span class="token punctuation">)</span>
            sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"设置 string 型数据节点 %s 成功 ！设置值为 %s !"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>node_name<span class="token punctuation">,</span> node_value<span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token comment"># 寄存器读写</span>
<span class="token keyword">def</span> <span class="token function">read_or_write_memory</span><span class="token punctuation">(</span>cam<span class="token punctuation">,</span> way<span class="token operator">=</span><span class="token string">"read"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> way <span class="token operator">==</span> <span class="token string">"read"</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
        cam<span class="token punctuation">.</span>MV_CC_ReadMemory<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> way <span class="token operator">==</span> <span class="token string">"write"</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
        cam<span class="token punctuation">.</span>MV_CC_WriteMemory<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token comment"># 判断相机是否处于连接状态(返回值如何获取)=================================</span>
<span class="token keyword">def</span> <span class="token function">decide_divice_on_line</span><span class="token punctuation">(</span>cam<span class="token punctuation">)</span><span class="token punctuation">:</span>
    value <span class="token operator">=</span> cam<span class="token punctuation">.</span>MV_CC_IsDeviceConnected<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> value <span class="token operator">==</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"该设备在线 ！"</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"该设备已掉线 ！"</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span>


<span class="token comment"># 设置 SDK 内部图像缓存节点个数</span>
<span class="token keyword">def</span> <span class="token function">set_image_Node_num</span><span class="token punctuation">(</span>cam<span class="token punctuation">,</span> Num<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    ret <span class="token operator">=</span> cam<span class="token punctuation">.</span>MV_CC_SetImageNodeNum<span class="token punctuation">(</span>nNum<span class="token operator">=</span>Num<span class="token punctuation">)</span>
    <span class="token keyword">if</span> ret <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"设置 SDK 内部图像缓存节点个数失败 ,报错码 ret[0x%x]"</span> <span class="token operator">%</span> ret<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"设置 SDK 内部图像缓存节点个数为 %d  ，设置成功!"</span> <span class="token operator">%</span> Num<span class="token punctuation">)</span>


<span class="token comment"># 设置取流策略</span>
<span class="token keyword">def</span> <span class="token function">set_grab_strategy</span><span class="token punctuation">(</span>cam<span class="token punctuation">,</span> grabstrategy<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> outputqueuesize<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    • OneByOne: 从旧到新一帧一帧的从输出缓存列表中获取图像，打开设备后默认为该策略
    • LatestImagesOnly: 仅从输出缓存列表中获取最新的一帧图像，同时清空输出缓存列表
    • LatestImages: 从输出缓存列表中获取最新的OutputQueueSize帧图像，其中OutputQueueSize范围为1 - ImageNodeNum，可用MV_CC_SetOutputQueueSize()接口设置，ImageNodeNum默认为1，可用MV_CC_SetImageNodeNum()接口设置OutputQueueSize设置成1等同于LatestImagesOnly策略，OutputQueueSize设置成ImageNodeNum等同于OneByOne策略
    • UpcomingImage: 在调用取流接口时忽略输出缓存列表中所有图像，并等待设备即将生成的一帧图像。该策略只支持GigE设备，不支持U3V设备
    """</span>
    <span class="token keyword">if</span> grabstrategy <span class="token operator">!=</span> <span class="token number">2</span><span class="token punctuation">:</span>
        ret <span class="token operator">=</span> cam<span class="token punctuation">.</span>MV_CC_SetGrabStrategy<span class="token punctuation">(</span>enGrabStrategy<span class="token operator">=</span>grabstrategy<span class="token punctuation">)</span>
        <span class="token keyword">if</span> ret <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"设置取流策略失败 ,报错码 ret[0x%x]"</span> <span class="token operator">%</span> ret<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"设置 取流策略为 %d  ，设置成功!"</span> <span class="token operator">%</span> grabstrategy<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        ret <span class="token operator">=</span> cam<span class="token punctuation">.</span>MV_CC_SetGrabStrategy<span class="token punctuation">(</span>enGrabStrategy<span class="token operator">=</span>grabstrategy<span class="token punctuation">)</span>
        <span class="token keyword">if</span> ret <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"设置取流策略失败 ,报错码 ret[0x%x]"</span> <span class="token operator">%</span> ret<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"设置 取流策略为 %d  ，设置成功!"</span> <span class="token operator">%</span> grabstrategy<span class="token punctuation">)</span>

        ret <span class="token operator">=</span> cam<span class="token punctuation">.</span>MV_CC_SetOutputQueueSize<span class="token punctuation">(</span>nOutputQueueSize<span class="token operator">=</span>outputqueuesize<span class="token punctuation">)</span>
        <span class="token keyword">if</span> ret <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"设置使出缓存个数失败 ,报错码 ret[0x%x]"</span> <span class="token operator">%</span> ret<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"设置 输出缓存个数为 %d  ，设置成功!"</span> <span class="token operator">%</span> outputqueuesize<span class="token punctuation">)</span>


<span class="token comment"># 显示图像</span>
<span class="token keyword">def</span> <span class="token function">image_show</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># image = cv2.resize(image, (600, 400), interpolation=cv2.INTER_AREA)</span>
    name <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
    cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>name<span class="token punctuation">,</span> image<span class="token punctuation">)</span>
    cv2<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span><span class="token string">"name.png"</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span>

<span class="token comment"># 需要显示的图像数据转换</span>
<span class="token keyword">def</span> <span class="token function">image_control</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> stFrameInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> stFrameInfo<span class="token punctuation">.</span>enPixelType <span class="token operator">==</span> <span class="token number">17301505</span><span class="token punctuation">:</span>
        image <span class="token operator">=</span> data<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span>stFrameInfo<span class="token punctuation">.</span>nHeight<span class="token punctuation">,</span> stFrameInfo<span class="token punctuation">.</span>nWidth<span class="token punctuation">)</span><span class="token punctuation">)</span>
        image_show<span class="token punctuation">(</span>image<span class="token operator">=</span>image<span class="token punctuation">,</span> name<span class="token operator">=</span>stFrameInfo<span class="token punctuation">.</span>nHeight<span class="token punctuation">)</span>
    <span class="token keyword">elif</span> stFrameInfo<span class="token punctuation">.</span>enPixelType <span class="token operator">==</span> <span class="token number">17301514</span><span class="token punctuation">:</span>
        data <span class="token operator">=</span> data<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>stFrameInfo<span class="token punctuation">.</span>nHeight<span class="token punctuation">,</span> stFrameInfo<span class="token punctuation">.</span>nWidth<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
        image <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>data<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BAYER_GB2RGB<span class="token punctuation">)</span>
        image_show<span class="token punctuation">(</span>image<span class="token operator">=</span>image<span class="token punctuation">,</span> name<span class="token operator">=</span>stFrameInfo<span class="token punctuation">.</span>nHeight<span class="token punctuation">)</span>
    <span class="token keyword">elif</span> stFrameInfo<span class="token punctuation">.</span>enPixelType <span class="token operator">==</span> <span class="token number">35127316</span><span class="token punctuation">:</span>
        data <span class="token operator">=</span> data<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>stFrameInfo<span class="token punctuation">.</span>nHeight<span class="token punctuation">,</span> stFrameInfo<span class="token punctuation">.</span>nWidth<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
        image <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>data<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_RGB2BGR<span class="token punctuation">)</span>
        image_show<span class="token punctuation">(</span>image<span class="token operator">=</span>image<span class="token punctuation">,</span> name<span class="token operator">=</span>stFrameInfo<span class="token punctuation">.</span>nHeight<span class="token punctuation">)</span>
    <span class="token keyword">elif</span> stFrameInfo<span class="token punctuation">.</span>enPixelType <span class="token operator">==</span> <span class="token number">34603039</span><span class="token punctuation">:</span>
        data <span class="token operator">=</span> data<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>stFrameInfo<span class="token punctuation">.</span>nHeight<span class="token punctuation">,</span> stFrameInfo<span class="token punctuation">.</span>nWidth<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
        image <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>data<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_YUV2BGR_Y422<span class="token punctuation">)</span>
        image_show<span class="token punctuation">(</span>image<span class="token operator">=</span>image<span class="token punctuation">,</span> name<span class="token operator">=</span>stFrameInfo<span class="token punctuation">.</span>nHeight<span class="token punctuation">)</span>


<span class="token comment"># 主动图像采集</span>
<span class="token keyword">def</span> <span class="token function">access_get_image</span><span class="token punctuation">(</span>cam<span class="token punctuation">,</span> active_way<span class="token operator">=</span><span class="token string">"getImagebuffer"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    :param cam:     相机实例
    :active_way:主动取流方式的不同方法 分别是（getImagebuffer）（getoneframetimeout）
    :return:
    """</span>
    <span class="token keyword">if</span> active_way <span class="token operator">==</span> <span class="token string">"getImagebuffer"</span><span class="token punctuation">:</span>
        stOutFrame <span class="token operator">=</span> MV_FRAME_OUT<span class="token punctuation">(</span><span class="token punctuation">)</span>
        memset<span class="token punctuation">(</span>byref<span class="token punctuation">(</span>stOutFrame<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> sizeof<span class="token punctuation">(</span>stOutFrame<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">while</span> cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'q'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            ret <span class="token operator">=</span> cam<span class="token punctuation">.</span>MV_CC_GetImageBuffer<span class="token punctuation">(</span>stOutFrame<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token boolean">None</span> <span class="token operator">!=</span> stOutFrame<span class="token punctuation">.</span>pBufAddr <span class="token keyword">and</span> <span class="token number">0</span> <span class="token operator">==</span> ret <span class="token keyword">and</span> stOutFrame<span class="token punctuation">.</span>stFrameInfo<span class="token punctuation">.</span>enPixelType <span class="token operator">==</span> <span class="token number">17301505</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"get one frame: Width[%d], Height[%d], nFrameNum[%d]"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>
                stOutFrame<span class="token punctuation">.</span>stFrameInfo<span class="token punctuation">.</span>nWidth<span class="token punctuation">,</span> stOutFrame<span class="token punctuation">.</span>stFrameInfo<span class="token punctuation">.</span>nHeight<span class="token punctuation">,</span> stOutFrame<span class="token punctuation">.</span>stFrameInfo<span class="token punctuation">.</span>nFrameNum<span class="token punctuation">)</span><span class="token punctuation">)</span>
                pData <span class="token operator">=</span> <span class="token punctuation">(</span>c_ubyte <span class="token operator">*</span> stOutFrame<span class="token punctuation">.</span>stFrameInfo<span class="token punctuation">.</span>nWidth <span class="token operator">*</span> stOutFrame<span class="token punctuation">.</span>stFrameInfo<span class="token punctuation">.</span>nHeight<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                cdll<span class="token punctuation">.</span>msvcrt<span class="token punctuation">.</span>memcpy<span class="token punctuation">(</span>byref<span class="token punctuation">(</span>pData<span class="token punctuation">)</span><span class="token punctuation">,</span> stOutFrame<span class="token punctuation">.</span>pBufAddr<span class="token punctuation">,</span>
                                   stOutFrame<span class="token punctuation">.</span>stFrameInfo<span class="token punctuation">.</span>nWidth <span class="token operator">*</span> stOutFrame<span class="token punctuation">.</span>stFrameInfo<span class="token punctuation">.</span>nHeight<span class="token punctuation">)</span>
                data <span class="token operator">=</span> np<span class="token punctuation">.</span>frombuffer<span class="token punctuation">(</span>pData<span class="token punctuation">,</span> count<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">(</span>stOutFrame<span class="token punctuation">.</span>stFrameInfo<span class="token punctuation">.</span>nWidth <span class="token operator">*</span> stOutFrame<span class="token punctuation">.</span>stFrameInfo<span class="token punctuation">.</span>nHeight<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                     dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>
                image_control<span class="token punctuation">(</span>data<span class="token operator">=</span>data<span class="token punctuation">,</span> stFrameInfo<span class="token operator">=</span>stOutFrame<span class="token punctuation">.</span>stFrameInfo<span class="token punctuation">)</span>
            <span class="token keyword">elif</span> <span class="token boolean">None</span> <span class="token operator">!=</span> stOutFrame<span class="token punctuation">.</span>pBufAddr <span class="token keyword">and</span> <span class="token number">0</span> <span class="token operator">==</span> ret <span class="token keyword">and</span> stOutFrame<span class="token punctuation">.</span>stFrameInfo<span class="token punctuation">.</span>enPixelType <span class="token operator">==</span> <span class="token number">17301514</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"get one frame: Width[%d], Height[%d], nFrameNum[%d]"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>
                stOutFrame<span class="token punctuation">.</span>stFrameInfo<span class="token punctuation">.</span>nWidth<span class="token punctuation">,</span> stOutFrame<span class="token punctuation">.</span>stFrameInfo<span class="token punctuation">.</span>nHeight<span class="token punctuation">,</span> stOutFrame<span class="token punctuation">.</span>stFrameInfo<span class="token punctuation">.</span>nFrameNum<span class="token punctuation">)</span><span class="token punctuation">)</span>
                pData <span class="token operator">=</span> <span class="token punctuation">(</span>c_ubyte <span class="token operator">*</span> stOutFrame<span class="token punctuation">.</span>stFrameInfo<span class="token punctuation">.</span>nWidth <span class="token operator">*</span> stOutFrame<span class="token punctuation">.</span>stFrameInfo<span class="token punctuation">.</span>nHeight<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                cdll<span class="token punctuation">.</span>msvcrt<span class="token punctuation">.</span>memcpy<span class="token punctuation">(</span>byref<span class="token punctuation">(</span>pData<span class="token punctuation">)</span><span class="token punctuation">,</span> stOutFrame<span class="token punctuation">.</span>pBufAddr<span class="token punctuation">,</span>
                                   stOutFrame<span class="token punctuation">.</span>stFrameInfo<span class="token punctuation">.</span>nWidth <span class="token operator">*</span> stOutFrame<span class="token punctuation">.</span>stFrameInfo<span class="token punctuation">.</span>nHeight<span class="token punctuation">)</span>
                data <span class="token operator">=</span> np<span class="token punctuation">.</span>frombuffer<span class="token punctuation">(</span>pData<span class="token punctuation">,</span> count<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">(</span>stOutFrame<span class="token punctuation">.</span>stFrameInfo<span class="token punctuation">.</span>nWidth <span class="token operator">*</span> stOutFrame<span class="token punctuation">.</span>stFrameInfo<span class="token punctuation">.</span>nHeight<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                     dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>
                image_control<span class="token punctuation">(</span>data<span class="token operator">=</span>data<span class="token punctuation">,</span> stFrameInfo<span class="token operator">=</span>stOutFrame<span class="token punctuation">.</span>stFrameInfo<span class="token punctuation">)</span>
            <span class="token keyword">elif</span> <span class="token boolean">None</span> <span class="token operator">!=</span> stOutFrame<span class="token punctuation">.</span>pBufAddr <span class="token keyword">and</span> <span class="token number">0</span> <span class="token operator">==</span> ret <span class="token keyword">and</span> stOutFrame<span class="token punctuation">.</span>stFrameInfo<span class="token punctuation">.</span>enPixelType <span class="token operator">==</span> <span class="token number">35127316</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"get one frame: Width[%d], Height[%d], nFrameNum[%d]"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>
                stOutFrame<span class="token punctuation">.</span>stFrameInfo<span class="token punctuation">.</span>nWidth<span class="token punctuation">,</span> stOutFrame<span class="token punctuation">.</span>stFrameInfo<span class="token punctuation">.</span>nHeight<span class="token punctuation">,</span> stOutFrame<span class="token punctuation">.</span>stFrameInfo<span class="token punctuation">.</span>nFrameNum<span class="token punctuation">)</span><span class="token punctuation">)</span>
                pData <span class="token operator">=</span> <span class="token punctuation">(</span>c_ubyte <span class="token operator">*</span> stOutFrame<span class="token punctuation">.</span>stFrameInfo<span class="token punctuation">.</span>nWidth <span class="token operator">*</span> stOutFrame<span class="token punctuation">.</span>stFrameInfo<span class="token punctuation">.</span>nHeight <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                cdll<span class="token punctuation">.</span>msvcrt<span class="token punctuation">.</span>memcpy<span class="token punctuation">(</span>byref<span class="token punctuation">(</span>pData<span class="token punctuation">)</span><span class="token punctuation">,</span> stOutFrame<span class="token punctuation">.</span>pBufAddr<span class="token punctuation">,</span>
                                   stOutFrame<span class="token punctuation">.</span>stFrameInfo<span class="token punctuation">.</span>nWidth <span class="token operator">*</span> stOutFrame<span class="token punctuation">.</span>stFrameInfo<span class="token punctuation">.</span>nHeight <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span>
                data <span class="token operator">=</span> np<span class="token punctuation">.</span>frombuffer<span class="token punctuation">(</span>pData<span class="token punctuation">,</span>
                                     count<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">(</span>stOutFrame<span class="token punctuation">.</span>stFrameInfo<span class="token punctuation">.</span>nWidth <span class="token operator">*</span> stOutFrame<span class="token punctuation">.</span>stFrameInfo<span class="token punctuation">.</span>nHeight <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                     dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>
                image_control<span class="token punctuation">(</span>data<span class="token operator">=</span>data<span class="token punctuation">,</span> stFrameInfo<span class="token operator">=</span>stOutFrame<span class="token punctuation">.</span>stFrameInfo<span class="token punctuation">)</span>
            <span class="token keyword">elif</span> <span class="token boolean">None</span> <span class="token operator">!=</span> stOutFrame<span class="token punctuation">.</span>pBufAddr <span class="token keyword">and</span> <span class="token number">0</span> <span class="token operator">==</span> ret <span class="token keyword">and</span> stOutFrame<span class="token punctuation">.</span>stFrameInfo<span class="token punctuation">.</span>enPixelType <span class="token operator">==</span> <span class="token number">34603039</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"get one frame: Width[%d], Height[%d], nFrameNum[%d]"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>
                stOutFrame<span class="token punctuation">.</span>stFrameInfo<span class="token punctuation">.</span>nWidth<span class="token punctuation">,</span> stOutFrame<span class="token punctuation">.</span>stFrameInfo<span class="token punctuation">.</span>nHeight<span class="token punctuation">,</span> stOutFrame<span class="token punctuation">.</span>stFrameInfo<span class="token punctuation">.</span>nFrameNum<span class="token punctuation">)</span><span class="token punctuation">)</span>
                pData <span class="token operator">=</span> <span class="token punctuation">(</span>c_ubyte <span class="token operator">*</span> stOutFrame<span class="token punctuation">.</span>stFrameInfo<span class="token punctuation">.</span>nWidth <span class="token operator">*</span> stOutFrame<span class="token punctuation">.</span>stFrameInfo<span class="token punctuation">.</span>nHeight <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                cdll<span class="token punctuation">.</span>msvcrt<span class="token punctuation">.</span>memcpy<span class="token punctuation">(</span>byref<span class="token punctuation">(</span>pData<span class="token punctuation">)</span><span class="token punctuation">,</span> stOutFrame<span class="token punctuation">.</span>pBufAddr<span class="token punctuation">,</span>
                                   stOutFrame<span class="token punctuation">.</span>stFrameInfo<span class="token punctuation">.</span>nWidth <span class="token operator">*</span> stOutFrame<span class="token punctuation">.</span>stFrameInfo<span class="token punctuation">.</span>nHeight <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span>
                data <span class="token operator">=</span> np<span class="token punctuation">.</span>frombuffer<span class="token punctuation">(</span>pData<span class="token punctuation">,</span>
                                     count<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">(</span>stOutFrame<span class="token punctuation">.</span>stFrameInfo<span class="token punctuation">.</span>nWidth <span class="token operator">*</span> stOutFrame<span class="token punctuation">.</span>stFrameInfo<span class="token punctuation">.</span>nHeight <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                     dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>
                image_control<span class="token punctuation">(</span>data<span class="token operator">=</span>data<span class="token punctuation">,</span> stFrameInfo<span class="token operator">=</span>stOutFrame<span class="token punctuation">.</span>stFrameInfo<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"no data[0x%x]"</span> <span class="token operator">%</span> ret<span class="token punctuation">)</span>
            nRet <span class="token operator">=</span> cam<span class="token punctuation">.</span>MV_CC_FreeImageBuffer<span class="token punctuation">(</span>stOutFrame<span class="token punctuation">)</span>

    <span class="token keyword">elif</span> active_way <span class="token operator">==</span> <span class="token string">"getoneframetimeout"</span><span class="token punctuation">:</span>
        stParam <span class="token operator">=</span> MVCC_INTVALUE_EX<span class="token punctuation">(</span><span class="token punctuation">)</span>
        memset<span class="token punctuation">(</span>byref<span class="token punctuation">(</span>stParam<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> sizeof<span class="token punctuation">(</span>MVCC_INTVALUE_EX<span class="token punctuation">)</span><span class="token punctuation">)</span>
        ret <span class="token operator">=</span> cam<span class="token punctuation">.</span>MV_CC_GetIntValueEx<span class="token punctuation">(</span><span class="token string">"PayloadSize"</span><span class="token punctuation">,</span> stParam<span class="token punctuation">)</span>
        <span class="token keyword">if</span> ret <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"get payload size fail! ret[0x%x]"</span> <span class="token operator">%</span> ret<span class="token punctuation">)</span>
            sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
        nDataSize <span class="token operator">=</span> stParam<span class="token punctuation">.</span>nCurValue
        pData <span class="token operator">=</span> <span class="token punctuation">(</span>c_ubyte <span class="token operator">*</span> nDataSize<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        stFrameInfo <span class="token operator">=</span> MV_FRAME_OUT_INFO_EX<span class="token punctuation">(</span><span class="token punctuation">)</span>
        memset<span class="token punctuation">(</span>byref<span class="token punctuation">(</span>stFrameInfo<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> sizeof<span class="token punctuation">(</span>stFrameInfo<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">while</span> cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'q'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            ret <span class="token operator">=</span> cam<span class="token punctuation">.</span>MV_CC_GetOneFrameTimeout<span class="token punctuation">(</span>pData<span class="token punctuation">,</span> nDataSize<span class="token punctuation">,</span> stFrameInfo<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> ret <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"get one frame: Width[%d], Height[%d], nFrameNum[%d] "</span> <span class="token operator">%</span> <span class="token punctuation">(</span>
                stFrameInfo<span class="token punctuation">.</span>nWidth<span class="token punctuation">,</span> stFrameInfo<span class="token punctuation">.</span>nHeight<span class="token punctuation">,</span> stFrameInfo<span class="token punctuation">.</span>nFrameNum<span class="token punctuation">)</span><span class="token punctuation">)</span>
                image <span class="token operator">=</span> np<span class="token punctuation">.</span>asarray<span class="token punctuation">(</span>pData<span class="token punctuation">)</span>
                image_control<span class="token punctuation">(</span>data<span class="token operator">=</span>image<span class="token punctuation">,</span> stFrameInfo<span class="token operator">=</span>stFrameInfo<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"no data[0x%x]"</span> <span class="token operator">%</span> ret<span class="token punctuation">)</span>


<span class="token comment"># 回调取图采集</span>
winfun_ctype <span class="token operator">=</span> WINFUNCTYPE
stFrameInfo <span class="token operator">=</span> POINTER<span class="token punctuation">(</span>MV_FRAME_OUT_INFO_EX<span class="token punctuation">)</span>
pData <span class="token operator">=</span> POINTER<span class="token punctuation">(</span>c_ubyte<span class="token punctuation">)</span>
FrameInfoCallBack <span class="token operator">=</span> winfun_ctype<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> pData<span class="token punctuation">,</span> stFrameInfo<span class="token punctuation">,</span> c_void_p<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">image_callback</span><span class="token punctuation">(</span>pData<span class="token punctuation">,</span> pFrameInfo<span class="token punctuation">,</span> pUser<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> img_buff
    img_buff <span class="token operator">=</span> <span class="token boolean">None</span>
    stFrameInfo <span class="token operator">=</span> cast<span class="token punctuation">(</span>pFrameInfo<span class="token punctuation">,</span> POINTER<span class="token punctuation">(</span>MV_FRAME_OUT_INFO_EX<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>contents
    <span class="token keyword">if</span> stFrameInfo<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"get one frame: Width[%d], Height[%d], nFrameNum[%d]"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>
        stFrameInfo<span class="token punctuation">.</span>nWidth<span class="token punctuation">,</span> stFrameInfo<span class="token punctuation">.</span>nHeight<span class="token punctuation">,</span> stFrameInfo<span class="token punctuation">.</span>nFrameNum<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> img_buff <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">and</span> stFrameInfo<span class="token punctuation">.</span>enPixelType <span class="token operator">==</span> <span class="token number">17301505</span><span class="token punctuation">:</span>
        img_buff <span class="token operator">=</span> <span class="token punctuation">(</span>c_ubyte <span class="token operator">*</span> stFrameInfo<span class="token punctuation">.</span>nWidth <span class="token operator">*</span> stFrameInfo<span class="token punctuation">.</span>nHeight<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        cdll<span class="token punctuation">.</span>msvcrt<span class="token punctuation">.</span>memcpy<span class="token punctuation">(</span>byref<span class="token punctuation">(</span>img_buff<span class="token punctuation">)</span><span class="token punctuation">,</span> pData<span class="token punctuation">,</span> stFrameInfo<span class="token punctuation">.</span>nWidth <span class="token operator">*</span> stFrameInfo<span class="token punctuation">.</span>nHeight<span class="token punctuation">)</span>
        data <span class="token operator">=</span> np<span class="token punctuation">.</span>frombuffer<span class="token punctuation">(</span>img_buff<span class="token punctuation">,</span> count<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">(</span>stFrameInfo<span class="token punctuation">.</span>nWidth <span class="token operator">*</span> stFrameInfo<span class="token punctuation">.</span>nHeight<span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>
        image_control<span class="token punctuation">(</span>data<span class="token operator">=</span>data<span class="token punctuation">,</span> stFrameInfo<span class="token operator">=</span>stFrameInfo<span class="token punctuation">)</span>
        <span class="token keyword">del</span> img_buff
    <span class="token keyword">elif</span> img_buff <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">and</span> stFrameInfo<span class="token punctuation">.</span>enPixelType <span class="token operator">==</span> <span class="token number">17301514</span><span class="token punctuation">:</span>
        img_buff <span class="token operator">=</span> <span class="token punctuation">(</span>c_ubyte <span class="token operator">*</span> stFrameInfo<span class="token punctuation">.</span>nWidth <span class="token operator">*</span> stFrameInfo<span class="token punctuation">.</span>nHeight<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        cdll<span class="token punctuation">.</span>msvcrt<span class="token punctuation">.</span>memcpy<span class="token punctuation">(</span>byref<span class="token punctuation">(</span>img_buff<span class="token punctuation">)</span><span class="token punctuation">,</span> pData<span class="token punctuation">,</span> stFrameInfo<span class="token punctuation">.</span>nWidth <span class="token operator">*</span> stFrameInfo<span class="token punctuation">.</span>nHeight<span class="token punctuation">)</span>
        data <span class="token operator">=</span> np<span class="token punctuation">.</span>frombuffer<span class="token punctuation">(</span>img_buff<span class="token punctuation">,</span> count<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">(</span>stFrameInfo<span class="token punctuation">.</span>nWidth <span class="token operator">*</span> stFrameInfo<span class="token punctuation">.</span>nHeight<span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>
        image_control<span class="token punctuation">(</span>data<span class="token operator">=</span>data<span class="token punctuation">,</span> stFrameInfo<span class="token operator">=</span>stFrameInfo<span class="token punctuation">)</span>
        <span class="token keyword">del</span> img_buff
    <span class="token keyword">elif</span> img_buff <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">and</span> stFrameInfo<span class="token punctuation">.</span>enPixelType <span class="token operator">==</span> <span class="token number">35127316</span><span class="token punctuation">:</span>
        img_buff <span class="token operator">=</span> <span class="token punctuation">(</span>c_ubyte <span class="token operator">*</span> stFrameInfo<span class="token punctuation">.</span>nWidth <span class="token operator">*</span> stFrameInfo<span class="token punctuation">.</span>nHeight <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        cdll<span class="token punctuation">.</span>msvcrt<span class="token punctuation">.</span>memcpy<span class="token punctuation">(</span>byref<span class="token punctuation">(</span>img_buff<span class="token punctuation">)</span><span class="token punctuation">,</span> pData<span class="token punctuation">,</span> stFrameInfo<span class="token punctuation">.</span>nWidth <span class="token operator">*</span> stFrameInfo<span class="token punctuation">.</span>nHeight <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span>
        data <span class="token operator">=</span> np<span class="token punctuation">.</span>frombuffer<span class="token punctuation">(</span>img_buff<span class="token punctuation">,</span> count<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">(</span>stFrameInfo<span class="token punctuation">.</span>nWidth <span class="token operator">*</span> stFrameInfo<span class="token punctuation">.</span>nHeight <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>
        image_control<span class="token punctuation">(</span>data<span class="token operator">=</span>data<span class="token punctuation">,</span> stFrameInfo<span class="token operator">=</span>stFrameInfo<span class="token punctuation">)</span>
        <span class="token keyword">del</span> img_buff
    <span class="token keyword">elif</span> img_buff <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">and</span> stFrameInfo<span class="token punctuation">.</span>enPixelType <span class="token operator">==</span> <span class="token number">34603039</span><span class="token punctuation">:</span>
        img_buff <span class="token operator">=</span> <span class="token punctuation">(</span>c_ubyte <span class="token operator">*</span> stFrameInfo<span class="token punctuation">.</span>nWidth <span class="token operator">*</span> stFrameInfo<span class="token punctuation">.</span>nHeight <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        cdll<span class="token punctuation">.</span>msvcrt<span class="token punctuation">.</span>memcpy<span class="token punctuation">(</span>byref<span class="token punctuation">(</span>img_buff<span class="token punctuation">)</span><span class="token punctuation">,</span> pData<span class="token punctuation">,</span> stFrameInfo<span class="token punctuation">.</span>nWidth <span class="token operator">*</span> stFrameInfo<span class="token punctuation">.</span>nHeight <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span>
        data <span class="token operator">=</span> np<span class="token punctuation">.</span>frombuffer<span class="token punctuation">(</span>img_buff<span class="token punctuation">,</span> count<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">(</span>stFrameInfo<span class="token punctuation">.</span>nWidth <span class="token operator">*</span> stFrameInfo<span class="token punctuation">.</span>nHeight <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>
        image_control<span class="token punctuation">(</span>data<span class="token operator">=</span>data<span class="token punctuation">,</span> stFrameInfo<span class="token operator">=</span>stFrameInfo<span class="token punctuation">)</span>
        <span class="token keyword">del</span> img_buff


CALL_BACK_FUN <span class="token operator">=</span> FrameInfoCallBack<span class="token punctuation">(</span>image_callback<span class="token punctuation">)</span>

<span class="token comment"># 事件回调</span>
stEventInfo <span class="token operator">=</span> POINTER<span class="token punctuation">(</span>MV_EVENT_OUT_INFO<span class="token punctuation">)</span>
pData <span class="token operator">=</span> POINTER<span class="token punctuation">(</span>c_ubyte<span class="token punctuation">)</span>
EventInfoCallBack <span class="token operator">=</span> winfun_ctype<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> stEventInfo<span class="token punctuation">,</span> c_void_p<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">event_callback</span><span class="token punctuation">(</span>pEventInfo<span class="token punctuation">,</span> pUser<span class="token punctuation">)</span><span class="token punctuation">:</span>
    stPEventInfo <span class="token operator">=</span> cast<span class="token punctuation">(</span>pEventInfo<span class="token punctuation">,</span> POINTER<span class="token punctuation">(</span>MV_EVENT_OUT_INFO<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>contents
    nBlockId <span class="token operator">=</span> stPEventInfo<span class="token punctuation">.</span>nBlockIdHigh
    nBlockId <span class="token operator">=</span> <span class="token punctuation">(</span>nBlockId <span class="token operator">&lt;&lt;</span> <span class="token number">32</span><span class="token punctuation">)</span> <span class="token operator">+</span> stPEventInfo<span class="token punctuation">.</span>nBlockIdLow
    nTimestamp <span class="token operator">=</span> stPEventInfo<span class="token punctuation">.</span>nTimestampHigh
    nTimestamp <span class="token operator">=</span> <span class="token punctuation">(</span>nTimestamp <span class="token operator">&lt;&lt;</span> <span class="token number">32</span><span class="token punctuation">)</span> <span class="token operator">+</span> stPEventInfo<span class="token punctuation">.</span>nTimestampLow
    <span class="token keyword">if</span> stPEventInfo<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"EventName[%s], EventId[%u], BlockId[%d], Timestamp[%d]"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>
        stPEventInfo<span class="token punctuation">.</span>EventName<span class="token punctuation">,</span> stPEventInfo<span class="token punctuation">.</span>nEventID<span class="token punctuation">,</span> nBlockId<span class="token punctuation">,</span> nTimestamp<span class="token punctuation">)</span><span class="token punctuation">)</span>


CALL_BACK_FUN_2 <span class="token operator">=</span> EventInfoCallBack<span class="token punctuation">(</span>event_callback<span class="token punctuation">)</span>


<span class="token comment"># 注册回调取图</span>
<span class="token keyword">def</span> <span class="token function">call_back_get_image</span><span class="token punctuation">(</span>cam<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># ch:注册抓图回调 | en:Register image callback</span>
    ret <span class="token operator">=</span> cam<span class="token punctuation">.</span>MV_CC_RegisterImageCallBackEx<span class="token punctuation">(</span>CALL_BACK_FUN<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> ret <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"register image callback fail! ret[0x%x]"</span> <span class="token operator">%</span> ret<span class="token punctuation">)</span>
        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token comment"># 关闭设备与销毁句柄</span>
<span class="token keyword">def</span> <span class="token function">close_and_destroy_device</span><span class="token punctuation">(</span>cam<span class="token punctuation">,</span> data_buf<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 停止取流</span>
    ret <span class="token operator">=</span> cam<span class="token punctuation">.</span>MV_CC_StopGrabbing<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> ret <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"stop grabbing fail! ret[0x%x]"</span> <span class="token operator">%</span> ret<span class="token punctuation">)</span>
        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 关闭设备</span>
    ret <span class="token operator">=</span> cam<span class="token punctuation">.</span>MV_CC_CloseDevice<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> ret <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"close deivce fail! ret[0x%x]"</span> <span class="token operator">%</span> ret<span class="token punctuation">)</span>
        <span class="token keyword">del</span> data_buf
        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 销毁句柄</span>
    ret <span class="token operator">=</span> cam<span class="token punctuation">.</span>MV_CC_DestroyHandle<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> ret <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"destroy handle fail! ret[0x%x]"</span> <span class="token operator">%</span> ret<span class="token punctuation">)</span>
        <span class="token keyword">del</span> data_buf
        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">del</span> data_buf


<span class="token comment"># 开启取流并获取数据包大小</span>
<span class="token keyword">def</span> <span class="token function">start_grab_and_get_data_size</span><span class="token punctuation">(</span>cam<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ret <span class="token operator">=</span> cam<span class="token punctuation">.</span>MV_CC_StartGrabbing<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> ret <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"开始取流失败! ret[0x%x]"</span> <span class="token operator">%</span> ret<span class="token punctuation">)</span>
        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 枚举设备</span>
    deviceList <span class="token operator">=</span> enum_devices<span class="token punctuation">(</span>device<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> device_way<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    <span class="token comment"># 判断不同类型设备</span>
    identify_different_devices<span class="token punctuation">(</span>deviceList<span class="token punctuation">)</span>
    <span class="token comment"># 输入需要被连接的设备</span>
    nConnectionNum <span class="token operator">=</span> input_num_camera<span class="token punctuation">(</span>deviceList<span class="token punctuation">)</span>
    <span class="token comment"># 创建相机实例并创建句柄,(设置日志路径)</span>
    cam<span class="token punctuation">,</span> stDeviceList <span class="token operator">=</span> creat_camera<span class="token punctuation">(</span>deviceList<span class="token punctuation">,</span> nConnectionNum<span class="token punctuation">,</span> log<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    <span class="token comment"># decide_divice_on_line(cam)  ==============</span>
    <span class="token comment"># 打开设备</span>
    open_device<span class="token punctuation">(</span>cam<span class="token punctuation">)</span>
    <span class="token comment"># # 设置缓存节点个数</span>
    <span class="token comment"># set_image_Node_num(cam, Num=10)</span>
    <span class="token comment"># # 设置取流策略</span>
    <span class="token comment"># set_grab_strategy(cam, grabstrategy=2, outputqueuesize=10)</span>
    <span class="token comment"># 设置设备的一些参数</span>
    <span class="token comment"># set_Value(cam, param_type="bool_value", node_name="TriggerCacheEnable", node_value=1)</span>
    <span class="token comment"># 获取设备的一些参数</span>
    <span class="token comment"># get_value = get_Value(cam , param_type = "int_value" , node_name = "PayloadSize")</span>

    stdcall <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"回调方式取流显示请输入 0    主动取流方式显示请输入 1:"</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token builtin">int</span><span class="token punctuation">(</span>stdcall<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token comment"># 回调方式抓取图像</span>
        call_back_get_image<span class="token punctuation">(</span>cam<span class="token punctuation">)</span>
        <span class="token comment"># 开启设备取流</span>
        start_grab_and_get_data_size<span class="token punctuation">(</span>cam<span class="token punctuation">)</span>
        <span class="token comment"># 当使用 回调取流时，需要在此处添加</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"press a key to stop grabbing."</span><span class="token punctuation">)</span>
        msvcrt<span class="token punctuation">.</span>getch<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># 关闭设备与销毁句柄</span>
        close_and_destroy_device<span class="token punctuation">(</span>cam<span class="token punctuation">)</span>
    <span class="token keyword">elif</span> <span class="token builtin">int</span><span class="token punctuation">(</span>stdcall<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token comment"># 开启设备取流</span>
        start_grab_and_get_data_size<span class="token punctuation">(</span>cam<span class="token punctuation">)</span>
        <span class="token comment"># 主动取流方式抓取图像</span>
        access_get_image<span class="token punctuation">(</span>cam<span class="token punctuation">,</span> active_way<span class="token operator">=</span><span class="token string">"getImagebuffer"</span><span class="token punctuation">)</span>
        <span class="token comment"># 关闭设备与销毁句柄</span>
        close_and_destroy_device<span class="token punctuation">(</span>cam<span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>都是按Q退出程序</p> 
<h2><a id="_858"></a>三、总文件</h2> 
<p>后面可根据需要添加其他程序<br> 例如tensorflow目标检测等<br> <img src="https://images2.imgbox.com/4b/c9/MErKOxeR_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9ca611994941f99db26fb270ad1ca82b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">STM32笔记_10(ADC—电压采集)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b744b5fd8da22fd07beaadda2fac127e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">window 安装debian的Linux系统&#43;一些环境初始化</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>