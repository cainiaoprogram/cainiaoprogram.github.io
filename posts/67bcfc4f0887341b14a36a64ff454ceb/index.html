<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Python模块selenium实例：电影分类排名数据生成json，sqlite和excel（openpyxl）文件（二） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Python模块selenium实例：电影分类排名数据生成json，sqlite和excel（openpyxl）文件（二）" />
<meta property="og:description" content="前面一篇文章已经生成了每个类别的电影评分前100位的json文件共21个。如下图：
现在我想把所有的电影按照评分做成一个总表。为此需要逐个打开每个文件，这里要用到os模块的listdir方法，如下建立一个遍历文件的获取文件名的函数：
from os import listdir def movie_files(folder): &#34;&#34;&#34;gather list of image files&#34;&#34;&#34; movie_files = [] for f in listdir(folder): if f.endswith(&#34;json&#34;): movie_files.append(f) return movie_files 函数中folder参数为文件所在目录，通过for循环遍历文件夹，如果文件以json结尾的则把文件名添加到列表，最后返回列表。
我们有了文件的名字列表后，现在需要逐个打开然后把数据添加到新的列表，函数如下：
def grand_data(folder,movieFiles): &#34;&#34;&#34;Granded the data from the genre movies&#34;&#34;&#34; movieDataScore = [] movieDatas = [] for file in movieFiles: with open(folder&#43;file, &#39;r&#39;,encoding=&#39;utf-8&#39;) as f: movies = json.load(f) for m in movies: movieDataScore.append(m[&#39;IMDb Score&#39;]) movieDatas.append(m) # Sorted the IMDb score list and remove duplicates new_movieDataScore = sorted(list(set(movieDataScore)),reverse=True) return movieDatas,new_movieDataScore 需要注意的是，我们建立了两个列表，一个把所有类别的电影数据放进去，另外一个要把电影评分放进去，同时通过set去重后再转为列表进行排序，函数最后返回两个列表。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/67bcfc4f0887341b14a36a64ff454ceb/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-05-04T16:46:40+08:00" />
<meta property="article:modified_time" content="2022-05-04T16:46:40+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Python模块selenium实例：电影分类排名数据生成json，sqlite和excel（openpyxl）文件（二）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>前面一篇文章已经生成了每个类别的电影评分前100位的json文件共21个。如下图：<br> <img src="https://images2.imgbox.com/18/9d/Yokdz2yJ_o.png" alt="在这里插入图片描述"><br> 现在我想把所有的电影按照评分做成一个总表。为此需要逐个打开每个文件，这里要用到os模块的listdir方法，如下建立一个遍历文件的获取文件名的函数：</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> os <span class="token keyword">import</span> listdir


<span class="token keyword">def</span> <span class="token function">movie_files</span><span class="token punctuation">(</span>folder<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""gather list of image files"""</span>

    movie_files <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> f <span class="token keyword">in</span> listdir<span class="token punctuation">(</span>folder<span class="token punctuation">)</span><span class="token punctuation">:</span>       
        <span class="token keyword">if</span> f<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">"json"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            movie_files<span class="token punctuation">.</span>append<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    <span class="token keyword">return</span> movie_files
</code></pre> 
<p>函数中folder参数为文件所在目录，通过for循环遍历文件夹，如果文件以json结尾的则把文件名添加到列表，最后返回列表。<br> 我们有了文件的名字列表后，现在需要逐个打开然后把数据添加到新的列表，函数如下：</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">grand_data</span><span class="token punctuation">(</span>folder<span class="token punctuation">,</span>movieFiles<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Granded the data from the genre movies"""</span>

    movieDataScore <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    movieDatas <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> <span class="token builtin">file</span> <span class="token keyword">in</span> movieFiles<span class="token punctuation">:</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>folder<span class="token operator">+</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            movies <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>  
            <span class="token keyword">for</span> m <span class="token keyword">in</span> movies<span class="token punctuation">:</span>
                movieDataScore<span class="token punctuation">.</span>append<span class="token punctuation">(</span>m<span class="token punctuation">[</span><span class="token string">'IMDb Score'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
                movieDatas<span class="token punctuation">.</span>append<span class="token punctuation">(</span>m<span class="token punctuation">)</span>

    <span class="token comment"># Sorted the IMDb score list and remove duplicates </span>
    new_movieDataScore <span class="token operator">=</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">set</span><span class="token punctuation">(</span>movieDataScore<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> movieDatas<span class="token punctuation">,</span>new_movieDataScore
</code></pre> 
<p>需要注意的是，我们建立了两个列表，一个把所有类别的电影数据放进去，另外一个要把电影评分放进去，同时通过set去重后再转为列表进行排序，函数最后返回两个列表。</p> 
<p>数据有了就要重新对数据进行排列和清洗，有些电影是在不同的类别里都有出现的，所有要去掉重复的，同时按分数排序，函数如下：</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">movie_datas</span><span class="token punctuation">(</span>movieDatas<span class="token punctuation">,</span>new_movieDataScore<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Sorted the dict according to IMDb score"""</span>

    final_movieDatas <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    cnt <span class="token operator">=</span> <span class="token number">0</span>
    movieNames <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">while</span> cnt <span class="token operator">&lt;</span> <span class="token builtin">len</span><span class="token punctuation">(</span>movieDatas<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> n <span class="token keyword">in</span> new_movieDataScore<span class="token punctuation">:</span>
            <span class="token keyword">for</span> movie <span class="token keyword">in</span> movieDatas<span class="token punctuation">:</span>
                <span class="token keyword">if</span> n <span class="token operator">==</span> movie<span class="token punctuation">[</span><span class="token string">'IMDb Score'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>                    
                    <span class="token keyword">if</span> movie<span class="token punctuation">[</span><span class="token string">'Movie'</span><span class="token punctuation">]</span> <span class="token keyword">not</span> <span class="token keyword">in</span> movieNames<span class="token punctuation">:</span><span class="token comment"># fix duplicate data</span>
                        movieNames<span class="token punctuation">.</span>append<span class="token punctuation">(</span>movie<span class="token punctuation">[</span><span class="token string">'Movie'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                        final_movieDatas<span class="token punctuation">.</span>append<span class="token punctuation">(</span>movie<span class="token punctuation">)</span>
                    cnt <span class="token operator">+=</span> <span class="token number">1</span>
    <span class="token keyword">return</span> final_movieDatas
</code></pre> 
<p>通过while循环来对数据进行清洗，首先遍历通过分数列表依次找到从高到低分数，然后再遍历电影数据找到匹配分数的电影，同时通过条件句排除重复电影。最后返回最终列表。<br> 最后把数据写入json文件：</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">movie_json_data</span><span class="token punctuation">(</span>final_movieDatas<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Generate the json data"""</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'json_data/top_movies.json'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> json_file<span class="token punctuation">:</span>
            json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>final_movieDatas<span class="token punctuation">,</span> json_file<span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> ensure_ascii<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
</code></pre> 
<p>这样我们所有想要的数据都已保存成json文件，这就为我们之后创建sqlite和excel创造了便利。</p> 
<p>下面开始创建sqlite数据库，新建一个MoviesSqlite.py文件，首先我们还是要遍历文件夹获取所有的文件名，这里可以建立一个函数也可以引用上一个文件中的函数，这里就略过了，直接开始建立sqlite库。<br> 方法还是之前文章中介绍过的方法，需要注意的是我们需要每个类别对应建立一个表格，所以我们会把建表部分放入for循环中，整个函数如下：</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">sqlite_data</span><span class="token punctuation">(</span>folder<span class="token punctuation">,</span>movieFiles<span class="token punctuation">)</span><span class="token punctuation">:</span>

    conn <span class="token operator">=</span> sqlite3<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">'sqliteData/moviesSsqData.sqlite'</span><span class="token punctuation">)</span>    
    <span class="token keyword">for</span> movieFile <span class="token keyword">in</span> movieFiles<span class="token punctuation">:</span>
        filename <span class="token operator">=</span> movieFile<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">]</span>
        cur <span class="token operator">=</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># Make table using executescript()</span>
        cur<span class="token punctuation">.</span>executescript<span class="token punctuation">(</span><span class="token triple-quoted-string string">'''        
        DROP TABLE IF EXISTS  '''</span><span class="token operator">+</span> filename <span class="token operator">+</span> <span class="token triple-quoted-string string">''';'''</span><span class="token operator">+</span> <span class="token triple-quoted-string string">'''
        
        CREATE TABLE '''</span> <span class="token operator">+</span> filename <span class="token operator">+</span> <span class="token triple-quoted-string string">''' (
            id     INTEGER NOT NULL PRIMARY KEY 
                    AUTOINCREMENT UNIQUE,
            Rank            INTEGER,
            Movie           INTEGER,
            Year            INTEGER,
            Duration        INTEGER,
            MovieGenres     INTEGER,
            IMDbScore       INTEGER,
            Metascore       INTEGER,
            Plot            INTEGER,
            Director        INTEGER,
            Stars           INTEGER,
            Votes           INTEGER,
            Gross           INTEGER
        );
        '''</span><span class="token punctuation">)</span>

        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>folder<span class="token operator">+</span>movieFile<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            json_data <span class="token operator">=</span>  json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
        
        
        <span class="token keyword">for</span> entry <span class="token keyword">in</span> json_data<span class="token punctuation">:</span>
            Rank <span class="token operator">=</span> entry<span class="token punctuation">[</span><span class="token string">'Rank'</span><span class="token punctuation">]</span>         
            Movie <span class="token operator">=</span> entry<span class="token punctuation">[</span><span class="token string">'Movie'</span><span class="token punctuation">]</span>   
            Year  <span class="token operator">=</span> entry<span class="token punctuation">[</span><span class="token string">'Year'</span><span class="token punctuation">]</span>          
            Duration <span class="token operator">=</span> entry<span class="token punctuation">[</span><span class="token string">'Duration'</span><span class="token punctuation">]</span>       
            MovieGenres <span class="token operator">=</span> entry<span class="token punctuation">[</span><span class="token string">'Movie Genres'</span><span class="token punctuation">]</span>  
            IMDbScore <span class="token operator">=</span> entry<span class="token punctuation">[</span><span class="token string">'IMDb Score'</span><span class="token punctuation">]</span>  
            Metascore <span class="token operator">=</span> entry<span class="token punctuation">[</span><span class="token string">'Metascore'</span><span class="token punctuation">]</span> 
            Plot <span class="token operator">=</span> entry<span class="token punctuation">[</span><span class="token string">'Plot'</span><span class="token punctuation">]</span>   
            Director <span class="token operator">=</span> entry<span class="token punctuation">[</span><span class="token string">'Director'</span><span class="token punctuation">]</span>  
            Stars <span class="token operator">=</span> entry<span class="token punctuation">[</span><span class="token string">'Stars'</span><span class="token punctuation">]</span>
            Votes <span class="token operator">=</span> entry<span class="token punctuation">[</span><span class="token string">'Votes'</span><span class="token punctuation">]</span> 
            Gross <span class="token operator">=</span> entry<span class="token punctuation">[</span><span class="token string">'Gross'</span><span class="token punctuation">]</span>

            <span class="token comment"># Print data</span>
            cur<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token triple-quoted-string string">'''INSERT OR IGNORE INTO '''</span> <span class="token operator">+</span> filename <span class="token operator">+</span> <span class="token triple-quoted-string string">''' (Rank,Movie,Year,
            Duration,MovieGenres,IMDbScore,Metascore,Plot,
            Director,Stars,Votes,Gross)
                    VALUES ( ?,?,?,?,?,?,?,?,?,?,?,? )'''</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>
                    Rank<span class="token punctuation">,</span>Movie<span class="token punctuation">,</span>Year<span class="token punctuation">,</span>Duration<span class="token punctuation">,</span>MovieGenres<span class="token punctuation">,</span>IMDbScore
                    <span class="token punctuation">,</span>Metascore<span class="token punctuation">,</span>Plot<span class="token punctuation">,</span>Director<span class="token punctuation">,</span>Stars<span class="token punctuation">,</span>Votes<span class="token punctuation">,</span>Gross<span class="token punctuation">)</span><span class="token punctuation">)</span>
            conn<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>需要注意的点是我们通过’‘’<br> DROP TABLE IF EXISTS ‘’‘+ filename + ‘’’;‘’'这个参数传递的方式赋予sqlite表格名称。最后生成的数据库如下图所示：<br> <img src="https://images2.imgbox.com/ee/b4/QcN1ReyO_o.gif" alt="在这里插入图片描述"><br> 终于到了最后一部分，也是使用新的模块的一部分，在此我们用openpyxl模块来创建excel文件。</p> 
<p>首先的建立一个moviesExcel.py文件，同样我们需要遍历文件夹，这里不再赘述了，直接进入主题。<br> 我们不单单把数据写入excel，同时我还想设置下格式及样式，我们先导入相关模块：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> openpyxl
<span class="token keyword">from</span> openpyxl<span class="token punctuation">.</span>styles <span class="token keyword">import</span> PatternFill<span class="token punctuation">,</span> Alignment<span class="token punctuation">,</span> Font
</code></pre> 
<p>首先我们想写入数据，因为我们有不同类别及汇总，所以我们依然把创建表格部分放入for循环，函数如下：</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">excel_data</span><span class="token punctuation">(</span>folder<span class="token punctuation">,</span>savedir<span class="token punctuation">,</span>movieFiles<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Generate the excel"""</span>
    
    <span class="token comment"># Creat excel</span>
    movie_book <span class="token operator">=</span> openpyxl<span class="token punctuation">.</span>Workbook<span class="token punctuation">(</span><span class="token punctuation">)</span>
    cnt <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token keyword">for</span> movie <span class="token keyword">in</span> movieFiles<span class="token punctuation">:</span>
        mvName <span class="token operator">=</span> movie<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token comment">#Creat sheet according to movie's genre</span>
        <span class="token keyword">if</span> mvName <span class="token operator">!=</span> <span class="token string">"top_movies"</span><span class="token punctuation">:</span>
            sheet <span class="token operator">=</span> movie_book<span class="token punctuation">.</span>create_sheet<span class="token punctuation">(</span>index<span class="token operator">=</span>cnt<span class="token punctuation">,</span>title<span class="token operator">=</span>mvName<span class="token punctuation">)</span>
            cnt <span class="token operator">+=</span> <span class="token number">1</span>             
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            sheet <span class="token operator">=</span> movie_book<span class="token punctuation">.</span>create_sheet<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>title<span class="token operator">=</span><span class="token string">'top_movies'</span><span class="token punctuation">)</span>
        
        <span class="token comment"># Open the json data</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>folder<span class="token operator">+</span>movie<span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                json_data <span class="token operator">=</span>  json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
                        
        <span class="token comment"># Title data and the width of per colum</span>
        sheet<span class="token punctuation">[</span><span class="token string">'A1'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'Rank'</span>
        sheet<span class="token punctuation">.</span>column_dimensions<span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">7</span>
        sheet<span class="token punctuation">[</span><span class="token string">'B1'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'Movie'</span>
        sheet<span class="token punctuation">.</span>column_dimensions<span class="token punctuation">[</span><span class="token string">'B'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">30</span>
        sheet<span class="token punctuation">[</span><span class="token string">'C1'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'Year'</span>
        sheet<span class="token punctuation">.</span>column_dimensions<span class="token punctuation">[</span><span class="token string">'C'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">7</span>
        sheet<span class="token punctuation">[</span><span class="token string">'D1'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'Duration'</span>
        sheet<span class="token punctuation">.</span>column_dimensions<span class="token punctuation">[</span><span class="token string">'D'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">15</span>
        sheet<span class="token punctuation">[</span><span class="token string">'E1'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'Movie Genres'</span>
        sheet<span class="token punctuation">.</span>column_dimensions<span class="token punctuation">[</span><span class="token string">'E'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">15</span>
        sheet<span class="token punctuation">[</span><span class="token string">'F1'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'IMDb Score'</span>
        sheet<span class="token punctuation">.</span>column_dimensions<span class="token punctuation">[</span><span class="token string">'F'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">15</span>
        sheet<span class="token punctuation">[</span><span class="token string">'G1'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'Metascore'</span>
        sheet<span class="token punctuation">.</span>column_dimensions<span class="token punctuation">[</span><span class="token string">'G'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">15</span>
        sheet<span class="token punctuation">[</span><span class="token string">'H1'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'Plot'</span>
        sheet<span class="token punctuation">.</span>column_dimensions<span class="token punctuation">[</span><span class="token string">'H'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">100</span>
        sheet<span class="token punctuation">[</span><span class="token string">'I1'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'Director'</span>
        sheet<span class="token punctuation">.</span>column_dimensions<span class="token punctuation">[</span><span class="token string">'I'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">20</span> 
        sheet<span class="token punctuation">[</span><span class="token string">'J1'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'Stars'</span>
        sheet<span class="token punctuation">.</span>column_dimensions<span class="token punctuation">[</span><span class="token string">'J'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">30</span>
        sheet<span class="token punctuation">[</span><span class="token string">'K1'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'Votes'</span>
        sheet<span class="token punctuation">.</span>column_dimensions<span class="token punctuation">[</span><span class="token string">'K'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">12</span>
        sheet<span class="token punctuation">[</span><span class="token string">'L1'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'Gross'</span>
        sheet<span class="token punctuation">.</span>column_dimensions<span class="token punctuation">[</span><span class="token string">'L'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">12</span>

        <span class="token comment"># Print Data </span>
        row <span class="token operator">=</span> <span class="token number">2</span>
        <span class="token keyword">for</span> entry <span class="token keyword">in</span> json_data<span class="token punctuation">:</span>
            sheet<span class="token punctuation">.</span>row_dimensions<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">35</span>
            sheet<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>column<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> row<span class="token operator">=</span>row<span class="token punctuation">,</span> value<span class="token operator">=</span>entry<span class="token punctuation">[</span><span class="token string">'Rank'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

            <span class="token comment"># Add hyperlink to movie's name        </span>
            sheet<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>column<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> row<span class="token operator">=</span>row<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token operator">=</span><span class="token string">'=HYPERLINK("{}","{}")'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">'https://www.douban.com/search?q={}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>entry<span class="token punctuation">[</span><span class="token string">'Movie'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>entry<span class="token punctuation">[</span><span class="token string">'Movie'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>   
            sheet<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>column<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> row<span class="token operator">=</span>row<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">.</span>font <span class="token operator">=</span> Font<span class="token punctuation">(</span><span class="token string">u'single'</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span>color<span class="token operator">=</span><span class="token string">'003366FF'</span><span class="token punctuation">)</span>
            
            sheet<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>column<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> row<span class="token operator">=</span>row<span class="token punctuation">,</span> value<span class="token operator">=</span>entry<span class="token punctuation">[</span><span class="token string">'Year'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            sheet<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>column<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> row<span class="token operator">=</span>row<span class="token punctuation">,</span> value<span class="token operator">=</span>entry<span class="token punctuation">[</span><span class="token string">'Duration'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
            sheet<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>column<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> row<span class="token operator">=</span>row<span class="token punctuation">,</span> value<span class="token operator">=</span>entry<span class="token punctuation">[</span><span class="token string">'Movie Genres'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            sheet<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>column<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span> row<span class="token operator">=</span>row<span class="token punctuation">,</span> value<span class="token operator">=</span>entry<span class="token punctuation">[</span><span class="token string">'IMDb Score'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            sheet<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>column<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> row<span class="token operator">=</span>row<span class="token punctuation">,</span> value<span class="token operator">=</span>entry<span class="token punctuation">[</span><span class="token string">'Metascore'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
            sheet<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>column<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span> row<span class="token operator">=</span>row<span class="token punctuation">,</span> value<span class="token operator">=</span>entry<span class="token punctuation">[</span><span class="token string">'Plot'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            sheet<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>column<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> row<span class="token operator">=</span>row<span class="token punctuation">,</span> value<span class="token operator">=</span>entry<span class="token punctuation">[</span><span class="token string">'Director'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            sheet<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>column<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> row<span class="token operator">=</span>row<span class="token punctuation">,</span> value<span class="token operator">=</span>entry<span class="token punctuation">[</span><span class="token string">'Stars'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        
            sheet<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>column<span class="token operator">=</span><span class="token number">11</span><span class="token punctuation">,</span> row<span class="token operator">=</span>row<span class="token punctuation">,</span> value<span class="token operator">=</span>entry<span class="token punctuation">[</span><span class="token string">'Votes'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  
            sheet<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>column<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">,</span> row<span class="token operator">=</span>row<span class="token punctuation">,</span> value<span class="token operator">=</span>entry<span class="token punctuation">[</span><span class="token string">'Gross'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
            row <span class="token operator">+=</span> <span class="token number">1</span>

    movie_book<span class="token punctuation">.</span>save<span class="token punctuation">(</span>savedir<span class="token operator">+</span><span class="token string">'moviesExcelData.xlsx'</span><span class="token punctuation">)</span>
</code></pre> 
<p>展开解释下，开始部分通过条件句把汇总表格放到第一个。然后我们建立表头， sheet[ ]通过指定单元格写入内容，同时我们通过sheet.column_dimensions[].width调整相应的单元格的宽度。接下来通过一个循环写入数据，第一行是我们的表头，所以我们第二行开始写入，因此row默认值设为2，写入数据前同样通过sheet.row_dimensions[row].height方法指定单元的高度。在这里我们通过sheet.cell(column=1, row=row, value=value)方法写入数据，column为列，row为行，value为写入内容。</p> 
<p>大家应该也注意到了，电影名部分我们通过=HYPERLINK指定单元格为超链接，这样我们点击电影名它会跳转到相关网页，这里用的豆瓣，直接传递电影名显示搜索结果，要注意搜出来的电影有可能会有出入，大家可以通过时长或者内容对一下，有些豆瓣可能都木有相关信息的。同时我们把电影名单元格字体颜色通过font指定为浅蓝色提示其为超链接。</p> 
<p>这样我们的excel建立好了，但是呢并不好看，我决定再调整下格式，函数如下：</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">excel_style</span><span class="token punctuation">(</span>sheet<span class="token punctuation">,</span>rows<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Setting the format of the excel"""</span>

    sheet<span class="token punctuation">.</span>freeze_panes <span class="token operator">=</span> <span class="token string">'C2'</span><span class="token comment"># freeze the panes (C2 represent that freeze row1 and columnA&amp;coulumnB)</span>
    bgcolor <span class="token operator">=</span> PatternFill<span class="token punctuation">(</span><span class="token string">'solid'</span><span class="token punctuation">,</span> fgColor<span class="token operator">=</span><span class="token string">'00808080'</span><span class="token punctuation">)</span><span class="token comment"># Backgraound color </span>
    font <span class="token operator">=</span> Font<span class="token punctuation">(</span><span class="token string">u'微软雅黑'</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">11</span><span class="token punctuation">,</span> bold<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> italic<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> strike<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'00333333'</span><span class="token punctuation">)</span>
    <span class="token comment"># ord = 65</span>
    <span class="token keyword">for</span> col <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
       sheet<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>column<span class="token operator">=</span>col<span class="token punctuation">,</span> row<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> value<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fill <span class="token operator">=</span> bgcolor
       sheet<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>column<span class="token operator">=</span>col<span class="token punctuation">,</span> row<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> value<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>font <span class="token operator">=</span>font

    bgcolor_text1 <span class="token operator">=</span> PatternFill<span class="token punctuation">(</span><span class="token string">'solid'</span><span class="token punctuation">,</span>fgColor<span class="token operator">=</span><span class="token string">'00C0C0C0'</span><span class="token punctuation">)</span>
    bgcolor_text2<span class="token operator">=</span> PatternFill<span class="token punctuation">(</span> <span class="token string">'solid'</span><span class="token punctuation">,</span>fgColor<span class="token operator">=</span><span class="token string">'00969696'</span><span class="token punctuation">)</span>	
    font_text <span class="token operator">=</span> Font<span class="token punctuation">(</span><span class="token string">u'微软雅黑'</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span>color<span class="token operator">=</span><span class="token string">'00333333'</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> r <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>rows<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> col <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> r <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                sheet<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>column<span class="token operator">=</span>col<span class="token punctuation">,</span> row<span class="token operator">=</span>r<span class="token punctuation">,</span> value<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fill <span class="token operator">=</span> bgcolor_text1
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                sheet<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>column<span class="token operator">=</span>col<span class="token punctuation">,</span> row<span class="token operator">=</span>r<span class="token punctuation">,</span> value<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fill <span class="token operator">=</span> bgcolor_text2
            sheet<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>column<span class="token operator">=</span>col<span class="token punctuation">,</span> row<span class="token operator">=</span>r<span class="token punctuation">,</span> value<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>font <span class="token operator">=</span> font_text
            <span class="token comment"># Word wrap and Location</span>
            sheet<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>column<span class="token operator">=</span>col<span class="token punctuation">,</span> row<span class="token operator">=</span>r<span class="token punctuation">,</span> value<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>alignment <span class="token operator">=</span> Alignment<span class="token punctuation">(</span>horizontal<span class="token operator">=</span><span class="token string">'left'</span><span class="token punctuation">,</span>vertical<span class="token operator">=</span><span class="token string">'center'</span><span class="token punctuation">,</span>wrapText<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> 
<p>关键部分我做了英文注释，但是还是稍微解释下，通过sheet.freeze_panes冻结窗口，这里指定C2指的是A和B列及第1行被冻结。然后设置背景色和字体格式，<br> 通过 PatternFill设置背景色的参数，第一个参数为填充样式。然后通过.fill赋予单元格。字体类似首先通过FONT设置参数，.font赋予单元格。第一个循环是第一行表头赋予一个较深的背景色，然后第二个循环会有两个背景色相互交替，从而使表格更容易查看。（这里的字体样式和背景色都是按个人喜好来设置的，大家可以随意设置自己中意的样式。）<br> .alignment = Alignment(horizontal=‘left’,vertical=‘center’,wrapText=True) 设置的是单元格内文本的位置，我设置的是靠左（horizontal），上下居中（vertical）及自动换行（wrapText=True）。<br> 创建表格的函数中每个表格都需要样式，所以把样式函数放进创建函数内（第一个for循环内）执行：</p> 
<pre><code class="prism language-python">		<span class="token comment"># Format        </span>
        rows <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>json_data<span class="token punctuation">)</span>
        excel_style<span class="token punctuation">(</span>sheet<span class="token punctuation">,</span>rows<span class="token punctuation">)</span>
</code></pre> 
<p>生成的excel表格如下：</p> 
<p><img src="https://images2.imgbox.com/c1/7a/Z0Goa6bd_o.gif" alt="在这里插入图片描述"></p> 
<p>至此我们的这个练习实列就完成了，希望能给大家些微的思路和帮助，共同学习进步，谢谢！</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d063ff971ca49bacd5e76ce2e659b639/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">linux初探——linux怎么将一个文件移动到另一个目录下</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/72342e3a7fae03fe735bbe90cb55a263/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">SpingMVC的工作流程(详细版)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>