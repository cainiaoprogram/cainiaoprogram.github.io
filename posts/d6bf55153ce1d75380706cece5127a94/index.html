<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【SpringBoot集成SpringSecurity】 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【SpringBoot集成SpringSecurity】" />
<meta property="og:description" content="本笔记内容为狂神说SpringBoot集成SpringSecurity部分
目录
一、介绍
二、环境搭建 1、新建一个初始的springboot项目web模块，thymeleaf模块
2、导入提供的静态资源 3、controller跳转
三、认识SpringSecurity
四、认证和授权
1、导入 Spring Security 依赖
2、编写配置类
3、测试
五、注销及权限控制
1、开启自动配置的注销的功能
2、添加注销按钮
3、导入thymeleaf依赖
4、修改前端页面
5、关闭csrf功能
6、设置角色功能块的认证
7、测试
六、记住我
开启记住我功能
七、定制登录页
1、配置跳转指定登录页
2、修改登录页
3、验证处理
4、在登录页增加记住我的多选框
5、后端验证处理
6、测试
一、介绍 Spring 是一个非常流行和成功的 Java 应用开发框架。Spring Security 基于 Spring 框架，提供了一套 Web 应用安全性的完整解决方案。一般来说，Web 应用的安全性包括用户认证（Authentication）和用户授权（Authorization）两个部分。用户认证指的是验证某个用户是否为系统中的合法主体，也就是说用户能否访问该系统。用户认证一般要求用户提供用户名和密码。系统通过校验用户名和密码来完成认证过程。用户授权指的是验证某个用户是否有权限执行某个操作。在一个系统中，不同用户所具有的权限是不同的。比如对一个文件来说，有的用户只能进行读取，而有的用户可以进行修改。一般来说，系统会为不同的用户分配不同的角色，而每个角色则对应一系列的权限。
对于上面提到的两种应用情景，Spring Security 框架都有很好的支持。在用户认证方面，Spring Security 框架支持主流的认证方式，包括 HTTP 基本认证、HTTP 表单验证、HTTP 摘要认证、OpenID 和 LDAP 等。在用户授权方面，Spring Security 提供了基于角色的访问控制和访问控制列表（Access Control List，ACL），可以对应用中的领域对象进行细粒度的控制。
参考官网：https://spring.io/projects/spring-security
二、环境搭建 1、新建一个初始的springboot项目web模块，thymeleaf模块 2、导入提供的静态资源 3、controller跳转 @Controller public class RouterController { @RequestMapping({&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/d6bf55153ce1d75380706cece5127a94/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-04T22:11:31+08:00" />
<meta property="article:modified_time" content="2023-01-04T22:11:31+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【SpringBoot集成SpringSecurity】</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>本笔记内容为狂神说SpringBoot集成SpringSecurity部分</p> 
<p id="main-toc"><strong>目录</strong></p> 
<p id="%C2%A0%E4%B8%80%E3%80%81%E4%BB%8B%E7%BB%8D-toc" style="margin-left:0px;"><a href="#%C2%A0%E4%B8%80%E3%80%81%E4%BB%8B%E7%BB%8D" rel="nofollow">一、介绍</a></p> 
<p id="%E4%BA%8C%E3%80%81%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%C2%A0-toc" style="margin-left:0px;"><a href="#%E4%BA%8C%E3%80%81%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%C2%A0" rel="nofollow">二、环境搭建 </a></p> 
<p id="1%E3%80%81%E6%96%B0%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%88%9D%E5%A7%8B%E7%9A%84springboot%E9%A1%B9%E7%9B%AEweb%E6%A8%A1%E5%9D%97%EF%BC%8Cthymeleaf%E6%A8%A1%E5%9D%97-toc" style="margin-left:80px;"><a href="#1%E3%80%81%E6%96%B0%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%88%9D%E5%A7%8B%E7%9A%84springboot%E9%A1%B9%E7%9B%AEweb%E6%A8%A1%E5%9D%97%EF%BC%8Cthymeleaf%E6%A8%A1%E5%9D%97" rel="nofollow">1、新建一个初始的springboot项目web模块，thymeleaf模块</a></p> 
<p id="2%E3%80%81%E5%AF%BC%E5%85%A5%E6%8F%90%E4%BE%9B%E7%9A%84%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%C2%A0-toc" style="margin-left:80px;"><a href="#2%E3%80%81%E5%AF%BC%E5%85%A5%E6%8F%90%E4%BE%9B%E7%9A%84%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%C2%A0" rel="nofollow">2、导入提供的静态资源 </a></p> 
<p id="3%E3%80%81controller%E8%B7%B3%E8%BD%AC-toc" style="margin-left:80px;"><a href="#3%E3%80%81controller%E8%B7%B3%E8%BD%AC" rel="nofollow">3、controller跳转</a></p> 
<p id="%E4%B8%89%E3%80%81%E8%AE%A4%E8%AF%86SpringSecurity-toc" style="margin-left:0px;"><a href="#%E4%B8%89%E3%80%81%E8%AE%A4%E8%AF%86SpringSecurity" rel="nofollow">三、认识SpringSecurity</a></p> 
<p id="%E5%9B%9B%E3%80%81%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83-toc" style="margin-left:0px;"><a href="#%E5%9B%9B%E3%80%81%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83" rel="nofollow">四、认证和授权</a></p> 
<p id="1%E3%80%81%E5%AF%BC%E5%85%A5%20Spring%20Security%20%E4%BE%9D%E8%B5%96-toc" style="margin-left:80px;"><a href="#1%E3%80%81%E5%AF%BC%E5%85%A5%20Spring%20Security%20%E4%BE%9D%E8%B5%96" rel="nofollow">1、导入 Spring Security 依赖</a></p> 
<p id="%C2%A02%E3%80%81%E7%BC%96%E5%86%99%E9%85%8D%E7%BD%AE%E7%B1%BB-toc" style="margin-left:80px;"><a href="#%C2%A02%E3%80%81%E7%BC%96%E5%86%99%E9%85%8D%E7%BD%AE%E7%B1%BB" rel="nofollow">2、编写配置类</a></p> 
<p id="%C2%A03%E3%80%81%E6%B5%8B%E8%AF%95-toc" style="margin-left:80px;"><a href="#%C2%A03%E3%80%81%E6%B5%8B%E8%AF%95" rel="nofollow">3、测试</a></p> 
<p id="%E4%BA%94%E3%80%81%E6%B3%A8%E9%94%80%E5%8F%8A%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6-toc" style="margin-left:0px;"><a href="#%E4%BA%94%E3%80%81%E6%B3%A8%E9%94%80%E5%8F%8A%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6" rel="nofollow">五、注销及权限控制</a></p> 
<p id="1%E3%80%81%E5%BC%80%E5%90%AF%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E7%9A%84%E6%B3%A8%E9%94%80%E7%9A%84%E5%8A%9F%E8%83%BD-toc" style="margin-left:80px;"><a href="#1%E3%80%81%E5%BC%80%E5%90%AF%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E7%9A%84%E6%B3%A8%E9%94%80%E7%9A%84%E5%8A%9F%E8%83%BD" rel="nofollow">1、开启自动配置的注销的功能</a></p> 
<p id="%C2%A02%E3%80%81%E6%B7%BB%E5%8A%A0%E6%B3%A8%E9%94%80%E6%8C%89%E9%92%AE-toc" style="margin-left:80px;"><a href="#%C2%A02%E3%80%81%E6%B7%BB%E5%8A%A0%E6%B3%A8%E9%94%80%E6%8C%89%E9%92%AE" rel="nofollow">2、添加注销按钮</a></p> 
<p id="3%E3%80%81%E5%AF%BC%E5%85%A5thymeleaf%E4%BE%9D%E8%B5%96-toc" style="margin-left:80px;"><a href="#3%E3%80%81%E5%AF%BC%E5%85%A5thymeleaf%E4%BE%9D%E8%B5%96" rel="nofollow">3、导入thymeleaf依赖</a></p> 
<p id="4%E3%80%81%E4%BF%AE%E6%94%B9%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2-toc" style="margin-left:80px;"><a href="#4%E3%80%81%E4%BF%AE%E6%94%B9%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2" rel="nofollow">4、修改前端页面</a></p> 
<p id="5%E3%80%81%E5%85%B3%E9%97%ADcsrf%E5%8A%9F%E8%83%BD-toc" style="margin-left:80px;"><a href="#5%E3%80%81%E5%85%B3%E9%97%ADcsrf%E5%8A%9F%E8%83%BD" rel="nofollow">5、关闭csrf功能</a></p> 
<p id="6%E3%80%81%E8%AE%BE%E7%BD%AE%E8%A7%92%E8%89%B2%E5%8A%9F%E8%83%BD%E5%9D%97%E7%9A%84%E8%AE%A4%E8%AF%81-toc" style="margin-left:80px;"><a href="#6%E3%80%81%E8%AE%BE%E7%BD%AE%E8%A7%92%E8%89%B2%E5%8A%9F%E8%83%BD%E5%9D%97%E7%9A%84%E8%AE%A4%E8%AF%81" rel="nofollow">6、设置角色功能块的认证</a></p> 
<p id="7%E3%80%81%E6%B5%8B%E8%AF%95-toc" style="margin-left:80px;"><a href="#7%E3%80%81%E6%B5%8B%E8%AF%95" rel="nofollow">7、测试</a></p> 
<p id="%C2%A0%E5%85%AD%E3%80%81%E8%AE%B0%E4%BD%8F%E6%88%91-toc" style="margin-left:0px;"><a href="#%C2%A0%E5%85%AD%E3%80%81%E8%AE%B0%E4%BD%8F%E6%88%91" rel="nofollow"> 六、记住我</a></p> 
<p id="%E5%BC%80%E5%90%AF%E8%AE%B0%E4%BD%8F%E6%88%91%E5%8A%9F%E8%83%BD-toc" style="margin-left:80px;"><a href="#%E5%BC%80%E5%90%AF%E8%AE%B0%E4%BD%8F%E6%88%91%E5%8A%9F%E8%83%BD" rel="nofollow">开启记住我功能</a></p> 
<p id="%E4%B8%83%E3%80%81%E5%AE%9A%E5%88%B6%E7%99%BB%E5%BD%95%E9%A1%B5-toc" style="margin-left:0px;"><a href="#%E4%B8%83%E3%80%81%E5%AE%9A%E5%88%B6%E7%99%BB%E5%BD%95%E9%A1%B5" rel="nofollow">七、定制登录页</a></p> 
<p id="1%E3%80%81%E9%85%8D%E7%BD%AE%E8%B7%B3%E8%BD%AC%E6%8C%87%E5%AE%9A%E7%99%BB%E5%BD%95%E9%A1%B5-toc" style="margin-left:80px;"><a href="#1%E3%80%81%E9%85%8D%E7%BD%AE%E8%B7%B3%E8%BD%AC%E6%8C%87%E5%AE%9A%E7%99%BB%E5%BD%95%E9%A1%B5" rel="nofollow">1、配置跳转指定登录页</a></p> 
<p id="2%E3%80%81%E4%BF%AE%E6%94%B9%E7%99%BB%E5%BD%95%E9%A1%B5-toc" style="margin-left:80px;"><a href="#2%E3%80%81%E4%BF%AE%E6%94%B9%E7%99%BB%E5%BD%95%E9%A1%B5" rel="nofollow">2、修改登录页</a></p> 
<p id="3%E3%80%81%E9%AA%8C%E8%AF%81%E5%A4%84%E7%90%86-toc" style="margin-left:80px;"><a href="#3%E3%80%81%E9%AA%8C%E8%AF%81%E5%A4%84%E7%90%86" rel="nofollow">3、验证处理</a></p> 
<p id="4%E3%80%81%E5%9C%A8%E7%99%BB%E5%BD%95%E9%A1%B5%E5%A2%9E%E5%8A%A0%E8%AE%B0%E4%BD%8F%E6%88%91%E7%9A%84%E5%A4%9A%E9%80%89%E6%A1%86-toc" style="margin-left:80px;"><a href="#4%E3%80%81%E5%9C%A8%E7%99%BB%E5%BD%95%E9%A1%B5%E5%A2%9E%E5%8A%A0%E8%AE%B0%E4%BD%8F%E6%88%91%E7%9A%84%E5%A4%9A%E9%80%89%E6%A1%86" rel="nofollow">4、在登录页增加记住我的多选框</a></p> 
<p id="5%E3%80%81%E5%90%8E%E7%AB%AF%E9%AA%8C%E8%AF%81%E5%A4%84%E7%90%86-toc" style="margin-left:80px;"><a href="#5%E3%80%81%E5%90%8E%E7%AB%AF%E9%AA%8C%E8%AF%81%E5%A4%84%E7%90%86" rel="nofollow">5、后端验证处理</a></p> 
<p id="6%E3%80%81%E6%B5%8B%E8%AF%95-toc" style="margin-left:80px;"><a href="#6%E3%80%81%E6%B5%8B%E8%AF%95" rel="nofollow">6、测试</a></p> 
<hr id="hr-toc"> 
<p></p> 
<p></p> 
<h2 id="%C2%A0%E4%B8%80%E3%80%81%E4%BB%8B%E7%BB%8D">一、介绍</h2> 
<hr> 
<p style="text-align:justify;">    Spring 是一个非常流行和成功的 Java 应用开发框架。Spring Security 基于 Spring 框架，提供了一套 Web 应用安全性的完整解决方案。一般来说，Web 应用的安全性包括用户认证（Authentication）和用户授权（Authorization）两个部分。用户认证指的是验证某个用户是否为系统中的合法主体，也就是说用户能否访问该系统。用户认证一般要求用户提供用户名和密码。系统通过校验用户名和密码来完成认证过程。用户授权指的是验证某个用户是否有权限执行某个操作。在一个系统中，不同用户所具有的权限是不同的。比如对一个文件来说，有的用户只能进行读取，而有的用户可以进行修改。一般来说，系统会为不同的用户分配不同的角色，而每个角色则对应一系列的权限。</p> 
<p style="text-align:justify;">    对于上面提到的两种应用情景，Spring Security 框架都有很好的支持。在用户认证方面，Spring Security 框架支持主流的认证方式，包括 HTTP 基本认证、HTTP 表单验证、HTTP 摘要认证、OpenID 和 LDAP 等。在用户授权方面，Spring Security 提供了基于角色的访问控制和访问控制列表（Access Control List，ACL），可以对应用中的领域对象进行细粒度的控制。</p> 
<p style="text-align:justify;">参考官网：<a class="link-info" href="https://spring.io/projects/spring-security" rel="nofollow" title="https://spring.io/projects/spring-security">https://spring.io/projects/spring-security</a></p> 
<h2 id="%E4%BA%8C%E3%80%81%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%C2%A0">二、环境搭建 </h2> 
<hr> 
<h4 id="1%E3%80%81%E6%96%B0%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%88%9D%E5%A7%8B%E7%9A%84springboot%E9%A1%B9%E7%9B%AEweb%E6%A8%A1%E5%9D%97%EF%BC%8Cthymeleaf%E6%A8%A1%E5%9D%97">1、新建一个初始的springboot项目web模块，thymeleaf模块</h4> 
<h4 id="2%E3%80%81%E5%AF%BC%E5%85%A5%E6%8F%90%E4%BE%9B%E7%9A%84%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%C2%A0">2、导入提供的静态资源 </h4> 
<h4 id="3%E3%80%81controller%E8%B7%B3%E8%BD%AC">3、controller跳转</h4> 
<pre><code class="language-java">@Controller
public class RouterController {
    @RequestMapping({"/index","/"})
    public String index(){
        return "index";
    }
    @RequestMapping("/toLogin")
    public String toLogin(){
        return "views/login";
    }
    @RequestMapping("/level1/{id}")
    public String level1(@PathVariable("id") Integer id){
        return "views/level1/"+id;
    }
    @RequestMapping("/level2/{id}")
    public String level2(@PathVariable("id") Integer id){
        return "views/level2/"+id;
    }
    @RequestMapping("/level3/{id}")
    public String level3(@PathVariable("id") Integer id){
        return "views/level3/"+id;
    }
}</code></pre> 
<h2 id="%E4%B8%89%E3%80%81%E8%AE%A4%E8%AF%86SpringSecurity">三、认识SpringSecurity</h2> 
<hr> 
<p>Spring Security 是针对Spring项目的安全框架，也是Spring Boot底层安全模块默认的技术选型，他可以实现强大的Web安全控制，对于安全控制，我们仅需要引入 spring-boot-starter-security 模块，进行少量的配置，即可实现强大的安全管理！</p> 
<p>记住几个类：</p> 
<ul><li> <p>WebSecurityConfigurerAdapter：自定义Security策略</p> </li><li> <p>AuthenticationManagerBuilder：自定义认证策略</p> </li><li> <p>@EnableWebSecurity：开启WebSecurity模式</p> </li></ul> 
<p>Spring Security的两个主要目标是 “认证” 和 “授权”（访问控制）。</p> 
<p><strong>“认证”（Authentication）</strong></p> 
<p>身份验证是关于验证您的凭据，如用户名/用户ID和密码，以验证您的身份。</p> 
<p>身份验证通常通过用户名和密码完成，有时与身份验证因素结合使用。</p> 
<p><strong>“授权” （Authorization）</strong></p> 
<p>授权发生在系统成功验证您的身份后，最终会授予您访问资源（如信息，文件，数据库，资金，位置，几乎任何内容）的完全权限。</p> 
<p>这个概念是通用的，而不是只在Spring Security 中存在。</p> 
<h2 id="%E5%9B%9B%E3%80%81%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83">四、认证和授权</h2> 
<hr> 
<p>使用 Spring Security 来增加认证和授权的功能</p> 
<h4 id="1%E3%80%81%E5%AF%BC%E5%85%A5%20Spring%20Security%20%E4%BE%9D%E8%B5%96">1、导入 Spring Security 依赖</h4> 
<pre><code class="language-XML">&lt;dependency&gt;
   &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
   &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre> 
<h4 id="%C2%A02%E3%80%81%E7%BC%96%E5%86%99%E9%85%8D%E7%BD%AE%E7%B1%BB">2、编写配置类</h4> 
<p>在config包下创建SecurityConfig类(自己命名)</p> 
<pre><code class="language-java">// 开启WebSecurity模式
@EnableWebSecurity
public class SecurityConfig extends WebSecurityConfigurerAdapter {
    @Override
    //授权
    /*2.7不用继承WebSecurityConfigurerAdapter了
    把方法换成public SecurityFilterChain filterChain(HttpSecurity http)就行*/
    protected void configure(HttpSecurity http) throws Exception {
        // 定制请求的授权规则
        // 首页所有人可以访问
        http.authorizeRequests().antMatchers("/").permitAll()
                .antMatchers("/level1/**").hasRole("vip1")
                .antMatchers("/level2/**").hasRole("vip2")
                .antMatchers("/level3/**").hasRole("vip3");

        // 开启自动配置的登录功能
        // /login 请求来到登录页
        // /login?error 重定向到这里表示登录失败
        http.formLogin();

        
    }

    //定义认证规则
    //认证, springboot 2.1.X可以直接使用~
    // 密码编码: PasswordEncoder
    // 在Spring Secutiry 5.0+新增了很多的加密方法
    @Override
    protected void configure(AuthenticationManagerBuilder auth) throws Exception {
        //一般在数据库读
        //在内存中定义，也可以在jdbc中去拿jdbcAuthentication....
        //Spring security 5.0中新增了多种加密方式，也改变了密码的格式。
        //要想我们的项目还能够正常登陆，需要修改一下configure中的代码。我们要将前端传过来的密码进行某种方式加密
        //spring security 官方推荐的是使用bcrypt加密方式。
        auth.inMemoryAuthentication().passwordEncoder(new BCryptPasswordEncoder())
                .withUser("kuangshen").password(new BCryptPasswordEncoder().encode("123456")).roles("vip2","vip3")
                .and()
                .withUser("root").password(new BCryptPasswordEncoder().encode("123456")).roles("vip1","vip2","vip3")
                .and()
                .withUser("guest").password(new BCryptPasswordEncoder().encode("123456")).roles("vip1","vip2");
    }

}</code></pre> 
<p><strong>PS:</strong>登录时前端传过来的密码是通过加密的方式传过来的，使用我们在定义认证规则的时候也要对密码进行加密，否则会报错。</p> 
<p><img alt="" height="182" src="https://images2.imgbox.com/63/e7/u0P18jhF_o.png" width="500"></p> 
<h4 id="%C2%A03%E3%80%81%E6%B5%8B%E8%AF%95">3、测试</h4> 
<p><img alt="" height="573" src="https://images2.imgbox.com/af/38/ipfZfhX2_o.png" width="1200"></p> 
<p><img alt="" height="542" src="https://images2.imgbox.com/bb/1f/S2zc4FYo_o.png" width="1200"></p> 
<p>发现不同角色只能访问自己认证下的规则。</p> 
<h2 id="%E4%BA%94%E3%80%81%E6%B3%A8%E9%94%80%E5%8F%8A%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6">五、注销及权限控制</h2> 
<hr> 
<h4 id="1%E3%80%81%E5%BC%80%E5%90%AF%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E7%9A%84%E6%B3%A8%E9%94%80%E7%9A%84%E5%8A%9F%E8%83%BD">1、开启自动配置的注销的功能</h4> 
<p>在配置类的configure方法加上</p> 
<pre><code class="language-java">//定制请求的授权规则
@Override
protected void configure(HttpSecurity http) throws Exception {
   //....
   //开启自动配置的注销的功能
   // /logout 注销请求
   //http.logout();

    //注销成功后跳转到首页
    http.logout().logoutSuccessUrl("/");
}</code></pre> 
<h4 id="%C2%A02%E3%80%81%E6%B7%BB%E5%8A%A0%E6%B3%A8%E9%94%80%E6%8C%89%E9%92%AE">2、添加注销按钮</h4> 
<p>在前端页面添加注销按钮，到index.html 导航栏中</p> 
<pre><code class="language-html">&lt;a class="item" th:href="@{/logout}"&gt;
   &lt;i class="address card icon"&gt;&lt;/i&gt; 注销
&lt;/a&gt;</code></pre> 
<p>测试注销功能，成功！</p> 
<h4 id="3%E3%80%81%E5%AF%BC%E5%85%A5thymeleaf%E4%BE%9D%E8%B5%96">3、导入thymeleaf依赖</h4> 
<p>我们需要登录后根据用户权限显示用户能访问的功能即可，需要结合thymeleaf中的一些功能。</p> 
<p>sec：authorize="isAuthenticated()":是否认证登录！来显示不同的页面。</p> 
<pre><code class="language-XML">&lt;!-- thymeleaf-extras-springsecurity5 --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.thymeleaf.extras&lt;/groupId&gt;
            &lt;artifactId&gt;thymeleaf-extras-springsecurity5&lt;/artifactId&gt;
            &lt;version&gt;3.0.4.RELEASE&lt;/version&gt;
        &lt;/dependency&gt;</code></pre> 
<h4 id="4%E3%80%81%E4%BF%AE%E6%94%B9%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2">4、修改前端页面</h4> 
<p><strong>导入命名空间</strong></p> 
<p><img alt="" height="260" src="https://images2.imgbox.com/64/c9/JjF9WGIk_o.png" width="1190"></p> 
<pre><code class="language-html">xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5"</code></pre> 
<p><strong>修改导航栏，增加认证判断</strong></p> 
<pre><code class="language-html">&lt;!--登录注销--&gt;
&lt;div class="right menu"&gt;

   &lt;!--如果未登录--&gt;
   &lt;div sec:authorize="!isAuthenticated()"&gt;
       &lt;a class="item" th:href="@{/login}"&gt;
           &lt;i class="address card icon"&gt;&lt;/i&gt; 登录
       &lt;/a&gt;
   &lt;/div&gt;

   &lt;!--如果已登录--&gt;
   &lt;div sec:authorize="isAuthenticated()"&gt;
       &lt;a class="item"&gt;
           &lt;i class="address card icon"&gt;&lt;/i&gt;
          用户名：&lt;span sec:authentication="principal.username"&gt;&lt;/span&gt;
          角色：&lt;span sec:authentication="principal.authorities"&gt;&lt;/span&gt;
       &lt;/a&gt;
   &lt;/div&gt;

   &lt;div sec:authorize="isAuthenticated()"&gt;
       &lt;a class="item" th:href="@{/logout}"&gt;
           &lt;i class="address card icon"&gt;&lt;/i&gt; 注销
       &lt;/a&gt;
   &lt;/div&gt;
&lt;/div&gt;</code></pre> 
<p>这里我们测试就会发现他会根据不同情况显示对应的按钮。</p> 
<h4 id="5%E3%80%81%E5%85%B3%E9%97%ADcsrf%E5%8A%9F%E8%83%BD">5、关闭csrf功能</h4> 
<p>如果注销的时候会报错404，因为它默认防止csrf跨站请求伪造，因为会产生安全问题，我们可以将请求改为post表单提交，或者在spring security中关闭csrf功能；(最新版的security就不用设置)</p> 
<pre><code class="language-java">//关闭csrf功能:跨站请求伪造,默认只能通过post方式提交logout   请求报错403禁用CSRF http.csrf().disable().cors();
        http.csrf().disable();</code></pre> 
<h4 id="6%E3%80%81%E8%AE%BE%E7%BD%AE%E8%A7%92%E8%89%B2%E5%8A%9F%E8%83%BD%E5%9D%97%E7%9A%84%E8%AE%A4%E8%AF%81">6、设置角色功能块的认证</h4> 
<pre><code class="language-html">&lt;!-- sec:authorize="hasRole('vip1')" --&gt;
&lt;div class="column" sec:authorize="hasRole('vip1')"&gt;
   &lt;div class="ui raised segment"&gt;
       &lt;div class="ui"&gt;
           &lt;div class="content"&gt;
               &lt;h5 class="content"&gt;Level 1&lt;/h5&gt;
               &lt;hr&gt;
               &lt;div&gt;&lt;a th:href="@{/level1/1}"&gt;&lt;i class="bullhorn icon"&gt;&lt;/i&gt; Level-1-1&lt;/a&gt;&lt;/div&gt;
               &lt;div&gt;&lt;a th:href="@{/level1/2}"&gt;&lt;i class="bullhorn icon"&gt;&lt;/i&gt; Level-1-2&lt;/a&gt;&lt;/div&gt;
               &lt;div&gt;&lt;a th:href="@{/level1/3}"&gt;&lt;i class="bullhorn icon"&gt;&lt;/i&gt; Level-1-3&lt;/a&gt;&lt;/div&gt;
           &lt;/div&gt;
       &lt;/div&gt;
   &lt;/div&gt;
&lt;/div&gt;

&lt;div class="column" sec:authorize="hasRole('vip2')"&gt;
   &lt;div class="ui raised segment"&gt;
       &lt;div class="ui"&gt;
           &lt;div class="content"&gt;
               &lt;h5 class="content"&gt;Level 2&lt;/h5&gt;
               &lt;hr&gt;
               &lt;div&gt;&lt;a th:href="@{/level2/1}"&gt;&lt;i class="bullhorn icon"&gt;&lt;/i&gt; Level-2-1&lt;/a&gt;&lt;/div&gt;
               &lt;div&gt;&lt;a th:href="@{/level2/2}"&gt;&lt;i class="bullhorn icon"&gt;&lt;/i&gt; Level-2-2&lt;/a&gt;&lt;/div&gt;
               &lt;div&gt;&lt;a th:href="@{/level2/3}"&gt;&lt;i class="bullhorn icon"&gt;&lt;/i&gt; Level-2-3&lt;/a&gt;&lt;/div&gt;
           &lt;/div&gt;
       &lt;/div&gt;
   &lt;/div&gt;
&lt;/div&gt;

&lt;div class="column" sec:authorize="hasRole('vip3')"&gt;
   &lt;div class="ui raised segment"&gt;
       &lt;div class="ui"&gt;
           &lt;div class="content"&gt;
               &lt;h5 class="content"&gt;Level 3&lt;/h5&gt;
               &lt;hr&gt;
               &lt;div&gt;&lt;a th:href="@{/level3/1}"&gt;&lt;i class="bullhorn icon"&gt;&lt;/i&gt; Level-3-1&lt;/a&gt;&lt;/div&gt;
               &lt;div&gt;&lt;a th:href="@{/level3/2}"&gt;&lt;i class="bullhorn icon"&gt;&lt;/i&gt; Level-3-2&lt;/a&gt;&lt;/div&gt;
               &lt;div&gt;&lt;a th:href="@{/level3/3}"&gt;&lt;i class="bullhorn icon"&gt;&lt;/i&gt; Level-3-3&lt;/a&gt;&lt;/div&gt;
           &lt;/div&gt;
       &lt;/div&gt;
   &lt;/div&gt;
&lt;/div&gt;</code></pre> 
<h4 id="7%E3%80%81%E6%B5%8B%E8%AF%95">7、测试</h4> 
<p>发现不用权限的用户登录进去会看到不同的功能</p> 
<p><img alt="" height="327" src="https://images2.imgbox.com/2e/c0/pqUFdmZc_o.png" width="1200"></p> 
<p><img alt="" height="378" src="https://images2.imgbox.com/cf/29/B57qpOBh_o.png" width="1200"></p> 
<h2 id="%C2%A0%E5%85%AD%E3%80%81%E8%AE%B0%E4%BD%8F%E6%88%91"> 六、记住我</h2> 
<hr> 
<h4 id="%E5%BC%80%E5%90%AF%E8%AE%B0%E4%BD%8F%E6%88%91%E5%8A%9F%E8%83%BD">开启记住我功能</h4> 
<pre><code class="language-java">//定制请求的授权规则
@Override
protected void configure(HttpSecurity http) throws Exception {
//。。。。。。。。。。。
  //记住我功能 cookie默认保存2周 定制记住我的参数！
  http.rememberMe();
}</code></pre> 
<p>登录页面就会显示记住我按钮了。</p> 
<p>登录成功后，将cookie发送给浏览器保存，以后登录带上这个cookie，只要通过检查就可以免登录了。如果点击注销，spring security 帮我们自动删除了这个 cookie。</p> 
<h2 id="%E4%B8%83%E3%80%81%E5%AE%9A%E5%88%B6%E7%99%BB%E5%BD%95%E9%A1%B5">七、定制登录页</h2> 
<hr> 
<h4 id="1%E3%80%81%E9%85%8D%E7%BD%AE%E8%B7%B3%E8%BD%AC%E6%8C%87%E5%AE%9A%E7%99%BB%E5%BD%95%E9%A1%B5">1、配置跳转指定登录页</h4> 
<p>在刚才的登录页配置后加上指定的 loginpage</p> 
<pre><code class="language-java"> http.formLogin().loginPage("/toLogin");
</code></pre> 
<h4 id="2%E3%80%81%E4%BF%AE%E6%94%B9%E7%99%BB%E5%BD%95%E9%A1%B5">2、修改登录页</h4> 
<p>login.html 配置提交请求及方式，方式必须为post</p> 
<pre><code class="language-html">&lt;form th:action="@{/login}" method="post"&gt;
   &lt;div class="field"&gt;
       &lt;label&gt;Username&lt;/label&gt;
       &lt;div class="ui left icon input"&gt;
           &lt;input type="text" placeholder="Username" name="username"&gt;
           &lt;i class="user icon"&gt;&lt;/i&gt;
       &lt;/div&gt;
   &lt;/div&gt;
   &lt;div class="field"&gt;
       &lt;label&gt;Password&lt;/label&gt;
       &lt;div class="ui left icon input"&gt;
           &lt;input type="password" name="password"&gt;
           &lt;i class="lock icon"&gt;&lt;/i&gt;
       &lt;/div&gt;
   &lt;/div&gt;
   &lt;input type="submit" class="ui blue submit button"/&gt;
&lt;/form&gt;</code></pre> 
<h4 id="3%E3%80%81%E9%AA%8C%E8%AF%81%E5%A4%84%E7%90%86">3、验证处理</h4> 
<p>配置接收登录的用户名和密码的参数</p> 
<pre><code class="language-java">//这里loginPage("/login")其实就是登录提交的请求路径，要么 loginPage("/login")可以不写，要写了就要和前端的登录提交路径一致
        http.formLogin().loginPage("/toLogin").usernameParameter("user").passwordParameter("pwd").successForwardUrl("/login");
</code></pre> 
<h4 id="4%E3%80%81%E5%9C%A8%E7%99%BB%E5%BD%95%E9%A1%B5%E5%A2%9E%E5%8A%A0%E8%AE%B0%E4%BD%8F%E6%88%91%E7%9A%84%E5%A4%9A%E9%80%89%E6%A1%86">4、在登录页增加记住我的多选框</h4> 
<pre><code class="language-html">&lt;input type="checkbox" name="remember"&gt; 记住我</code></pre> 
<h4 id="5%E3%80%81%E5%90%8E%E7%AB%AF%E9%AA%8C%E8%AF%81%E5%A4%84%E7%90%86">5、后端验证处理</h4> 
<pre><code class="language-java">//定制记住我的参数！
http.rememberMe().rememberMeParameter("remember");</code></pre> 
<h4 id="6%E3%80%81%E6%B5%8B%E8%AF%95">6、测试</h4> 
<p><img alt="" height="300" src="https://images2.imgbox.com/35/3c/5azZJkb5_o.png" width="500"></p> 
<p>发现登录页已成功更换，并且记住我等功能正常使用。</p> 
<p>结束！ </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8ca8e6b7f9dd7b6eb3fbd25e608b18ae/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Python 列表list详解（超详细）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/541d1678ccb69e83728a4478d7f8d3b4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">多卡训练中的BN(BatchNorm)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>