<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>微信小程序使用高德地图实现检索定位附近周边的POI功能示例 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="微信小程序使用高德地图实现检索定位附近周边的POI功能示例" />
<meta property="og:description" content="1、效果图 2、 实现过程 1、登录高德地图开发者平台 高德开放平台 | 高德地图API，申请接口Key 2、在高德开发平台下载微信小程序SDK，https://lbs.amap.com/api/wx/download 解压下载的文件得到 amap-wx.js ，在创建的项目中，新建一个名为 libs 目录，将 amap-wx.js 文件拷贝到 libs 的本地目录下。
3、微信小程序后台添加安全域名（这个必须设置，不然无法使用定位功能） 登录微信公众平台，在 &#34;设置&#34; → &#34;开发设置&#34; 中设置 request 合法域名，将 https://restapi.amap.com 中添加进去，如下图所示：
4、具体代码 &lt;template&gt; &lt;view class=&#34;content&#34;&gt; &lt;!-- &lt;view class=&#34;btns&#34;&gt; &lt;view @click=&#34;back&#34;&gt;取 消&lt;/view&gt; &lt;view @click=&#34;getCurrentLocation&#34;&gt;获取当前地址&lt;/view&gt; &lt;/view&gt; --&gt; &lt;view class=&#34;inputCon&#34;&gt; &lt;view class=&#34;searchView&#34;&gt; &lt;text class=&#34;iconfont icon-sousuo&#34; @click=&#34;searchFn&#34;&gt;&lt;/text&gt; &lt;input type=&#34;text&#34; placeholder=&#34;搜索地点&#34; v-model=&#34;searchWords&#34; confirm-type=&#34;search&#34; @confirm=&#34;searchFn&#34; /&gt; &lt;text @click=&#34;cancel&#34;&gt;取消&lt;/text&gt; &lt;/view&gt; &lt;/view&gt; &lt;!-- 地图部分 --&gt; &lt;view class=&#34;content-map&#34;&gt; &lt;map style=&#34;width: 100%;height: 100%;&#34; v-if=&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/9f65b735d65ba8dd71ec71112dd2d3cf/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-22T16:34:22+08:00" />
<meta property="article:modified_time" content="2023-08-22T16:34:22+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">微信小程序使用高德地图实现检索定位附近周边的POI功能示例</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2 id="1%E3%80%81%E6%95%88%E6%9E%9C%E5%9B%BE">1、效果图</h2> 
<p>     <img alt="" height="680" src="https://images2.imgbox.com/88/c7/HF5tWjPG_o.png" width="304"><img alt="" height="615" src="https://images2.imgbox.com/ae/a0/KlAGVuBD_o.png" width="275"></p> 
<h2 id="2%E3%80%81%20%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B">2、 实现过程</h2> 
<h3 id="%C2%A01%E3%80%81%E7%99%BB%E5%BD%95%E9%AB%98%E5%BE%B7%E5%9C%B0%E5%9B%BE%E5%BC%80%E5%8F%91%E8%80%85%E5%B9%B3%E5%8F%B0%C2%A0%E9%AB%98%E5%BE%B7%E5%BC%80%E6%94%BE%E5%B9%B3%E5%8F%B0%20%7C%20%E9%AB%98%E5%BE%B7%E5%9C%B0%E5%9B%BEAPI%EF%BC%8C%E7%94%B3%E8%AF%B7%E6%8E%A5%E5%8F%A3Key%E2%80%8B%E7%BC%96%E8%BE%91"> <strong>1、登录高德地图开发者平台 <a href="https://lbs.amap.com/" rel="nofollow" title="高德开放平台 | 高德地图API">高德开放平台 | 高德地图API</a>，申请接口Key</strong><img alt="" src="https://images2.imgbox.com/84/73/uhEGkdvI_o.png"></h3> 
<h3 id="%C2%A0"> </h3> 
<h3 id="2%E3%80%81%E5%9C%A8%E9%AB%98%E5%BE%B7%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0%E4%B8%8B%E8%BD%BD%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8FSDK%EF%BC%8Chttps%3A%2F%2Flbs.amap.com%2Fapi%2Fwx%2Fdownload">2、在高德开发平台下载微信小程序SDK，https://lbs.amap.com/api/wx/download</h3> 
<p> 解压下载的文件得到 amap-wx.js ，在创建的项目中，新建一个名为 libs 目录，将 amap-wx.js 文件拷贝到 libs 的本地目录下。</p> 
<h3 id="3%E3%80%81%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%90%8E%E5%8F%B0%E6%B7%BB%E5%8A%A0%E5%AE%89%E5%85%A8%E5%9F%9F%E5%90%8D%EF%BC%88%E8%BF%99%E4%B8%AA%E5%BF%85%E9%A1%BB%E8%AE%BE%E7%BD%AE%EF%BC%8C%E4%B8%8D%E7%84%B6%E6%97%A0%E6%B3%95%E4%BD%BF%E7%94%A8%E5%AE%9A%E4%BD%8D%E5%8A%9F%E8%83%BD%EF%BC%89">3、微信小程序后台添加安全域名（这个必须设置，不然无法使用定位功能）</h3> 
<p>登录<a href="https://mp.weixin.qq.com/" rel="nofollow" title="微信公众平台">微信公众平台</a>，在 "设置" → "开发设置" 中设置 request 合法域名，将 <strong>https://restapi.amap.com</strong> 中添加进去，如下图所示：</p> 
<p><img alt="" height="483" src="https://images2.imgbox.com/3a/8a/dDWnkTm4_o.png" width="1200"></p> 
<p> </p> 
<h3 id="%C2%A0%C2%A0">  4、具体代码</h3> 
<pre><code class="language-javascript">&lt;template&gt;
	&lt;view class="content"&gt;
		&lt;!-- 	&lt;view class="btns"&gt;
			&lt;view @click="back"&gt;取 消&lt;/view&gt;
			&lt;view @click="getCurrentLocation"&gt;获取当前地址&lt;/view&gt;
		&lt;/view&gt; --&gt;
		&lt;view class="inputCon"&gt;
			&lt;view class="searchView"&gt;
				&lt;text class="iconfont icon-sousuo"  @click="searchFn"&gt;&lt;/text&gt;
				&lt;input type="text" placeholder="搜索地点" v-model="searchWords" confirm-type="search" @confirm="searchFn" /&gt;
				&lt;text @click="cancel"&gt;取消&lt;/text&gt;
			&lt;/view&gt;
		&lt;/view&gt;
		&lt;!-- 地图部分 --&gt;
		&lt;view class="content-map"&gt;
			&lt;map style="width: 100%;height: 100%;" v-if="mapFlafg" :latitude="latitude" :longitude="longitude" :markers="markers"
				@tap="tap"  :scale="16"  :title="title"/&gt;
		&lt;/view&gt;
		&lt;!-- &lt;view id="container"&gt;&lt;/view&gt; --&gt;
		&lt;!--  搜索框 --&gt;

		&lt;!--  地点列表部分 --&gt;
		&lt;view class="list"&gt;
			&lt;view class="item" v-for="(add,index) in dataTips" :key="add.id" @click="select(add,index)"
				:class="selectIndex==index?'active':''"&gt;
				&lt;view class="name"&gt;{<!-- -->{add.name}}&lt;/view&gt;
				&lt;view class="address"&gt;{<!-- -->{add.district || ''}}{<!-- -->{add.address || ''}}&lt;/view&gt;
			&lt;/view&gt;
		&lt;/view&gt;
	&lt;/view&gt;
&lt;/template&gt;

&lt;script&gt;
	// 引入高德地图api提供的微信小程序的接口
	import amapFile from '@/packageB/pages/map/amap-wx.130.js';
	// 创建地图
	var myAmapFun = new amapFile.AMapWX({
		key: ''
	}); //key值要申请为 去高德地图申请微信小程序的key
	// var myAmapFun = new amapFile.AMapWX({key: ''}); //key我的
	export default {
		data() {
			return {
				mapFlafg:false,
				selectIndex: undefined,
				selectAddr: {},
				searchWords: "",
				id: 1, // 使用 marker点击事件 需要填写id
				title: 'map',
				latitude: 39.91667, // 纬度
				longitude: 116.41667, // 经度

				markers: [{
					latitude: 39.91667, // 纬度
					longitude: 116.41667, // 经度
					width: 30,
					height: 30,
					iconPath: ''
					// iconPath: '../../static/ditu.png'
				}],
				dataTips: []
			}
		},
		onLoad() {
			var self = this;
			uni.getLocation({
				type: 'gcj02',
				success: function(res) {
					console.log(res, '当前地址定位');
					if (res.errMsg == "getLocation:ok") {
						console.log(self.mark, 'onload里面看看');
						self.longitude = res.longitude;
						self.latitude = res.latitude;
						self.$set(self.markers[0],"longitude",res.longitude);
						self.$set(self.markers[0],"latitude",res.latitude);
						self.mapFlafg=true;
						console.log(self.markers,"markers")
						// self.markers[0].longitude = res.longitude;
						// self.markers[0].latitude = res.latitude;
					}
				},
				complete: () =&gt; {
					// 获取当前位置的地点列表
					myAmapFun.getPoiAround({
						location: self.longitude + ',' + self.latitude,
						success: (data) =&gt; {
							console.log("获取当前的列表", data);
							this.dataTips = data.poisData;
						},
						fail: (info) =&gt; {
							console.log(info, '点击地图错误信息1')
						}
					})
				}
			});
			
		},
		methods: {
			cancel() {
				if (this.searchWords) {
					this.searchWords = "";
					myAmapFun.getPoiAround({
						location: this.markers[0].longitude + ',' + this.markers[0].latitude,
						success: (data) =&gt; {
							console.log("获取当前的列表", data);
							this.$nextTick(() =&gt; {
								this.dataTips = data.poisData;
							})
						},
						fail: (info) =&gt; {
							console.log(info)
						}
					})
				}
			},
			reserGeo() {
				myAmapFun.getRegeo({
					success: (data) =&gt; {
						console.log("getRegeo", data);
					},
					fail: (info) =&gt; {
						console.log(info)
					}
				})
			},
			// 根据地址列表中选择某一个地点
			select(add, index) {
				if (!add) {
					return;
				}
				this.selectIndex = index;
				var location = add.location.split(",");
				console.log(location, add, '列表地点的经纬度');
				this.selectAddr = {
					address: add.pname ? (add.pname + add.cityname + add.adname) : (add.district + add
						.address),
					detailAddress: add.address,
					latitude: location[1],
					longitude: location[0]
				};
				this.markers[0].latitude = +location[1];
				this.markers[0].longitude = +location[0];
				uni.setStorageSync("address", this.selectAddr.address);
				// 选择地点后，将选取的地点传递到前一个页面中
				var pages = getCurrentPages(); // 获取所有的页面栈
				var prevPage = pages[pages.length - 2]; // 找到上一个页面，注意是页面，如果是页面中有组件，则需要通过页面接受到数据后，再次往组件中传递
				prevPage.$vm.userAddress.locationAddress = this.selectAddr.address; //在上一个页面中就可以用userAddress进行接收
				prevPage.$vm.userAddress.detail = this.selectAddr.detailAddress; //在上一个页面中就可以用userAddress进行接收
				prevPage.$vm.selectAddr = this.selectAddr;
				prevPage.$vm.address = {
					province: add.pname,
					city: add.cityname,
					district: add.adname,
				}
				uni.navigateBack({
					delta: 1
				});

			},
			// 在地图上点击进行选点，这个选点在地图缩放比例较大时无效，因为精读的问题。
			tap(e) {
				console.log(e, '点击了地图');
				var location = e.detail.longitude + ',' + e.detail.latitude
				myAmapFun.getRegeo({
					location: location,
					success: (data) =&gt; {
						console.log("获取指定定位信息", data);
						this.selectAddr = {
							address: data[0].regeocodeData.formatted_address,
							latitude: e.detail.latitude,
							longitude: e.detail.longitude
						};
						this.markers[0].latitude = data[0].latitude;
						this.markers[0].longitude = data[0].longitude;
						myAmapFun.getPoiAround({
							location: data[0].longitude + ',' + data[0].latitude,
							success: (data) =&gt; {
								console.log("获取当前的列表", data);
								this.dataTips = data.poisData;
							},
							fail: (info) =&gt; {
								console.log(info, '点击地图错误信息1')
							}
						})
					},
					fail: (info) =&gt; {
						console.log(info, '点击地图错误信息2');
					}
				})
			},
			// 根据内容进行检索
			searchFn() {
				console.log("根据地址检索", this.searchWords);
				myAmapFun.getInputtips({
					keywords: this.searchWords,
					location: '',
					success: (data) =&gt; {
						console.log(111, data);
						if (data &amp;&amp; data.tips) {
							this.dataTips = data.tips;
						}
					},
					fail: data =&gt; {
						console.log(222, data);
					}
				})
			},
			// getCurrentLocation() {
			// 	let that = this
			// 	uni.getLocation({
			// 		type: 'wgs84',
			// 		success: function(res) {
			// 			console.log(res, '当前地址定位');
			// 			if (res.errMsg == "getLocation:ok") {
			// 				console.log(that.mark, 'onload里面看看');
			// 				this.longitude = res.longitude;
			// 				this.latitude = res.latitude;
			// 				this.markers[0].longitude = res.longitude;
			// 				this.markers[0].latitude = res.latitude;
			// 			}
			// 		}
			// 	});
			// },
		}
	}
&lt;/script&gt;

&lt;style lang="scss" scoped&gt;
	.btns {

		position: fixed;
		top: 0;
		left: 0;
		height: 260upx;
		width: 100%;
		background: linear-gradient(to bottom, rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0));
		display: flex;
		align-items: center;
		justify-content: space-between;
		z-index: 10 !important;

		view {
			border-radius: 10%;
			margin: 100upx 24upx 0;
			font-size: 30upx;

			&amp;:first-child {
				color: #fff;
			}

			&amp;:last-child {
				width: 100upx;
				height: 60upx;
				line-height: 60upx;
				text-align: center;
				border-radius: 10upx;
				background: #20c295;
				color: #fff;
			}
		}
	}

	.content {
		// position: relative;
		height: 100vh;
		display: flex;
		flex-direction: column;

		.content-map {
			width: 100%;
			height: 50vh;
		}

		.list {
			// flex: 0 1 calc(50vh - 10upx);
			border-radius: 30rpx;
			background-color: #fff;
			// position: absolute;
			// bottom:-660rpx;
			height: calc(50vh - 10upx);
			overflow-y: auto;
			width: 100%;
			margin: 0upx auto 0;
			padding-bottom: 20upx;

			.item {
				border-bottom: 2upx solid #f3f3f3;
				padding: 0 30rpx;

				&amp;:last-child {
					border: none;
				}

				.address {
					font-size: 22upx;
					color: #666;
					margin: 10upx 0;
				}

				.name {
					font-size: 30upx;
					color: #333;
					margin-top: 10upx;
				}

				&amp;.active {
					.name {
						font-weight: bold;
						color: #E13500;
					}

					.address {
						color: #E13500;
					}
				}
			}
		}

		.inputCon {
			flex: 0 1 108rpx;
			width: 100%;
			background: #fff;
			// top: -60upx;
			// position: relative;
			z-index: 20;
			// height: 100upx;
			display: flex;
			align-items: center;
			justify-content: center;

			.searchView {
				width: 702upx;
				height: 60upx;
				display: flex;
				align-items: center;
				line-height: 60upx;
				border-radius: 40upx;
				padding: 0 30upx;
				box-sizing: border-box;
				background: #f3f3f3;
				font-size: 26upx;

				.iconfont {
					color: #666;
					margin-right: 20upx;
				}

				input {
					flex: 1;
				}

				view {
					flex-shrink: 0;
				}
			}
		}

	}
&lt;/style&gt;</code></pre> 
<h3><img alt="" height="412" src="https://images2.imgbox.com/d8/54/5gqeqB1e_o.png" width="617"></h3> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c2c65716b98ee7939cf8062480fdadfe/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">python小脚本——批量将PDF文件转换成图片</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/196f0defe0e8a57c69ecc106a57e7b39/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">论文及代码详解——Restormer</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>