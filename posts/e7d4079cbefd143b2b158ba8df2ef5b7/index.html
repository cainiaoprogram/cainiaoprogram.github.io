<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Zabbix监控系统及安装部署 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Zabbix监控系统及安装部署" />
<meta property="og:description" content="Zabbix监控系统系统及安装部署 一、Zabbix的概念二、zabbix 监控原理三、zabbix的综合对比四、Zabbix 6.0 新特性Ⅰ、Zabbix server高可用防止硬件故障或计划维护期的停机：Ⅱ、Zabbix 6.0 LTS新增Kubernetes监控功能，可以在Kubernetes系统从多个维度采集指标： 五、Zabbix 6.0 功能组件六、Zabbix 6.0 部署Ⅰ、部署 zabbix 服务端Ⅱ、部署 Nginx &#43; PHP 环境并测试Ⅲ、部署数据库（要求 MySQL 5.7 或 Mariadb 10.5 及以上版本）Ⅳ、编译安装 zabbix Server 服务端Ⅴ、部署 Web 前端，进行访问Ⅵ、安装 zabbix 客户端，实现 zabbix 服务端自我监控Ⅶ、解决 zabbix-server Web页面中文乱码问题 七、添加zabbix客户机Ⅰ、在 Web 页面中添加 agent 主机 八 、自定义监控内容在 Web 页面创建自定义监控项模板Ⅰ、创建模板Ⅱ、创建监控项Ⅲ、创建触发器Ⅳ、创建图形Ⅴ、将主机与模板关联起来Ⅶ、设置邮件报警 九、zabbix 自动注册Ⅰ、zabbix 自动发现 作为一个运维，需要会使用监控系统查看服务器系统性能、应用服务状态和网站流量指标等，利用监控系统的数据去了解网站上线发布的结果和健康状态。 利用一个优秀的监控软件，我们可以:
●1、通过一个友好的界面进行浏览整个网站所有的服务器状态
●2、可以在 Web 前端方便的查看监控数据
●3、可以回溯寻找事故发生时系统的问题和报警情况
一、Zabbix的概念 Zabbix是什么？
zabbix 是一个基于 Web 界面的提供分布式系统监视以及网络监视功能的企业级的开源解决方案。zabbix 能监视各种网络参数，保证服务器系统的安全运营；并提供灵活的通知机制以让系统管理员快速定位/解决存在的各种问题。zabbix 由 2 部分构成，zabbix server 与可选组件 zabbix agent。通过 C/S 模式采集数据，通过 B/S 模式在 Web 端展示和配置。zabbix server 可以通过 zabbix agent，SNMP协议，端口监视等方法提供对远程服务器/网络状态的监视，数据收集等功能，它可以运行在 Linux 等平台上。zabbix agent 需要安装在被监视的目标服务器上，它主要完成对硬件信息或与操作系统有关的内存，CPU 等信息的收集。 二、zabbix 监控原理 zabbix agent 安装在被监控的主机上，zabbix agent 负责定期收集客户端本地各项数据，并发送至 zabbix server 端zabbix server 收到数据后， 将数据存储到数据库中，用户基于 Zabbix Web 可以看到数据在前端展现图像。当 zabbix 监控某个具体的项目， 该项目会设置一个触发器阈值， 当被监控的指标超过该触发器设定的阈值，会进行一些必要的动作，动作包括：发送信息（邮件、微信、短信）、发送命令（shell 命令、reboot、restart、 install 等）。 三、zabbix的综合对比 监控系统发行时间开发语言性能社区支持容器支持企业使用部署难度Prometheus2016go支持万为单位相对不如zabbix，但人数与日俱增不仅支持swarm原生集群，还支持Kubernetes容器集群的监控，是目前容器监控最好的解决方案基本上使用Kubernetes与容器的企业，prometheus是最好的选择只有一个核心server组件，一条命令便可以启动Zabbix2012c&#43;php上限约10000节点应用广泛，支持较成熟，遇到的问题都能搜到zabbix出现的比较早，当时容器还没有诞生，自然对容器的支持也比较差（在6." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/e7d4079cbefd143b2b158ba8df2ef5b7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-07T16:11:54+08:00" />
<meta property="article:modified_time" content="2023-07-07T16:11:54+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Zabbix监控系统及安装部署</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>Zabbix监控系统系统及安装部署</h4> 
 <ul><li><a href="#Zabbix_9" rel="nofollow">一、Zabbix的概念</a></li><li><a href="#zabbix__19" rel="nofollow">二、zabbix 监控原理</a></li><li><a href="#zabbix_26" rel="nofollow">三、zabbix的综合对比</a></li><li><a href="#Zabbix_60__33" rel="nofollow">四、Zabbix 6.0 新特性</a></li><li><ul><li><a href="#Zabbix_server_34" rel="nofollow">Ⅰ、Zabbix server高可用防止硬件故障或计划维护期的停机：</a></li><li><a href="#Zabbix_60_LTSKubernetesKubernetes_41" rel="nofollow">Ⅱ、Zabbix 6.0 LTS新增Kubernetes监控功能，可以在Kubernetes系统从多个维度采集指标：</a></li></ul> 
  </li><li><a href="#Zabbix_60__48" rel="nofollow">五、Zabbix 6.0 功能组件</a></li><li><a href="#Zabbix_60__85" rel="nofollow">六、Zabbix 6.0 部署</a></li><li><ul><li><a href="#_zabbix__90" rel="nofollow">Ⅰ、部署 zabbix 服务端</a></li><li><a href="#_Nginx__PHP__101" rel="nofollow">Ⅱ、部署 Nginx + PHP 环境并测试</a></li><li><a href="#_MySQL_57__Mariadb_105__248" rel="nofollow">Ⅲ、部署数据库（要求 MySQL 5.7 或 Mariadb 10.5 及以上版本）</a></li><li><a href="#_zabbix_Server__320" rel="nofollow">Ⅳ、编译安装 zabbix Server 服务端</a></li><li><a href="#_Web__405" rel="nofollow">Ⅴ、部署 Web 前端，进行访问</a></li><li><a href="#_zabbix__zabbix__431" rel="nofollow">Ⅵ、安装 zabbix 客户端，实现 zabbix 服务端自我监控</a></li><li><a href="#_zabbixserver_Web_448" rel="nofollow">Ⅶ、解决 zabbix-server Web页面中文乱码问题</a></li></ul> 
  </li><li><a href="#zabbix_461" rel="nofollow">七、添加zabbix客户机</a></li><li><ul><li><a href="#_Web__agent__542" rel="nofollow">Ⅰ、在 Web 页面中添加 agent 主机</a></li></ul> 
  </li><li><a href="#__556" rel="nofollow">八 、自定义监控内容</a></li><li><ul><li><a href="#_Web__586" rel="nofollow">在 Web 页面创建自定义监控项模板</a></li><li><ul><li><a href="#_588" rel="nofollow">Ⅰ、创建模板</a></li><li><a href="#_599" rel="nofollow">Ⅱ、创建监控项</a></li><li><a href="#_611" rel="nofollow">Ⅲ、创建触发器</a></li><li><a href="#_623" rel="nofollow">Ⅳ、创建图形</a></li><li><a href="#_634" rel="nofollow">Ⅴ、将主机与模板关联起来</a></li><li><a href="#_646" rel="nofollow">Ⅶ、设置邮件报警</a></li></ul> 
  </li></ul> 
  </li><li><a href="#zabbix__686" rel="nofollow">九、zabbix 自动注册</a></li><li><ul><li><a href="#zabbix__688" rel="nofollow">Ⅰ、zabbix 自动发现</a></li></ul> 
 </li></ul> 
</div> 
<br> 
<strong>作为一个运维，需要会使用监控系统查看服务器系统性能、应用服务状态和网站流量指标等，利用监控系统的数据去了解网站上线发布的结果和健康状态。</strong> 
<p></p> 
<p><mark>利用一个优秀的监控软件，我们可以:</mark><br> ●1、通过一个友好的界面进行浏览整个网站所有的服务器状态<br> ●2、可以在 Web 前端方便的查看监控数据<br> ●3、可以回溯寻找事故发生时系统的问题和报警情况</p> 
<h2><a id="Zabbix_9"></a>一、Zabbix的概念</h2> 
<p>Zabbix是什么？</p> 
<ul><li>zabbix 是一个基于 Web 界面的提供分布式系统监视以及网络监视功能的企业级的开源解决方案。</li><li>zabbix 能监视各种网络参数，保证服务器系统的安全运营；并提供灵活的通知机制以让系统管理员快速定位/解决存在的各种问题。</li><li>zabbix 由 2 部分构成，zabbix server 与可选组件 zabbix agent。通过 C/S 模式采集数据，通过 B/S 模式在 Web 端展示和配置。</li><li>zabbix server 可以通过 zabbix agent，SNMP协议，端口监视等方法提供对远程服务器/网络状态的监视，数据收集等功能，它可以运行在 Linux 等平台上。</li><li>zabbix agent 需要安装在被监视的目标服务器上，它主要完成对硬件信息或与操作系统有关的内存，CPU 等信息的收集。</li></ul> 
<h2><a id="zabbix__19"></a>二、zabbix 监控原理</h2> 
<ul><li>zabbix agent 安装在被监控的主机上，zabbix agent 负责定期收集客户端本地各项数据，并发送至 zabbix server 端</li><li>zabbix server 收到数据后， 将数据存储到数据库中，用户基于 Zabbix Web 可以看到数据在前端展现图像。</li><li>当 zabbix 监控某个具体的项目， 该项目会设置一个触发器阈值， 当被监控的指标超过该触发器设定的阈值，会进行一些必要的动作，动作包括：发送信息（邮件、微信、短信）、发送命令（shell 命令、reboot、restart、 install 等）。</li></ul> 
<p><img src="https://images2.imgbox.com/b5/08/j1SE4Jx1_o.jpg" alt="在这里插入图片描述"></p> 
<h2><a id="zabbix_26"></a>三、zabbix的综合对比</h2> 
<table><thead><tr><th>监控系统</th><th>发行时间</th><th>开发语言</th><th>性能</th><th>社区支持</th><th>容器支持</th><th>企业使用</th><th>部署难度</th></tr></thead><tbody><tr><td>Prometheus</td><td>2016</td><td>go</td><td>支持万为单位</td><td>相对不如zabbix，但人数与日俱增</td><td>不仅支持swarm原生集群，还支持Kubernetes容器集群的监控，是目前容器监控最好的解决方案</td><td>基本上使用Kubernetes与容器的企业，prometheus是最好的选择</td><td>只有一个核心server组件，一条命令便可以启动</td></tr><tr><td>Zabbix</td><td>2012</td><td>c+php</td><td>上限约10000节点</td><td>应用广泛，支持较成熟，遇到的问题都能搜到</td><td>zabbix出现的比较早，当时容器还没有诞生，自然对容器的支持也比较差（在6.0版本也开始支持容器的集群监控）</td><td>在传统监控系统中，尤其是在服务器相关监控方面，占据绝对优势</td><td>多种系统，多种监控信息采集方式</td></tr></tbody></table> 
<h2><a id="Zabbix_60__33"></a>四、Zabbix 6.0 新特性</h2> 
<h3><a id="Zabbix_server_34"></a>Ⅰ、Zabbix server高可用防止硬件故障或计划维护期的停机：</h3> 
<ul><li>原生选择加入HA群集配置</li><li>定义一个或多个备用节点</li><li>实时监控Zabbix server群集节点的状态</li><li>不需要外部工具即可将Zabbix server配置为HA群集模式</li></ul> 
<h3><a id="Zabbix_60_LTSKubernetesKubernetes_41"></a>Ⅱ、Zabbix 6.0 LTS新增Kubernetes监控功能，可以在Kubernetes系统从多个维度采集指标：</h3> 
<ul><li>Kubernetes节点和pods的自动发现和监控</li><li>无代理方式采集Kubernetes pods和节点的信息</li><li>获取Kubernetes节点主机高水平信息</li></ul> 
<h2><a id="Zabbix_60__48"></a>五、Zabbix 6.0 功能组件</h2> 
<p><img src="https://images2.imgbox.com/80/81/apcd81R3_o.jpg" alt="在这里插入图片描述"><br> <strong>①<mark>Zabbix Server</mark></strong></p> 
<ul><li>zabbix 服务端守护进程，是 Zabbix 软件的核心组件，Zabbix Agent 向其报告可用性、系统完整性信息和统计信息。</li><li>Zabbix Server 也是存储所有配置信息、统计信息和操作信息的核心存储库。</li><li>Zabbix Server 也是 Zabbix 监控系统的告警中心。在监控的系统中出现任何异常，将发出通知给管理员。</li></ul> 
<p><strong>②数据库</strong></p> 
<ul><li> <p>所有配置信息以及 Zabbix 采集到的数据都被持久存储在数据库中。</p> </li><li> <p>可以支持 MySQL、PostgreSQL、Oracle、DB2、TimescaleDB 等多种数据库。</p> </li></ul> 
<p><strong>③Web 界面</strong></p> 
<ul><li>Web 界面是 Zabbix Server 的一部分，用于实现展示和配置的界面。通常（但不一定）和 Zabbix server 运行在同一台物理机器上。</li><li>基于 Apache/Nginx + PHP 实现，早期只支持 LAMP 架构，从 Zabbix5.0 开始支持 LNMP 。</li></ul> 
<p><strong>④Zabbix Agent</strong></p> 
<ul><li>客户端守护进程，部署在被监控目标上，用于主动监控本地资源和应用程序，并将收集的数据发送给 Zabbix Server。（从 Zabbix5.0 开始支技 Zabbix Agent2 ）</li></ul> 
<p><strong>⑤Zabbix Proxy</strong></p> 
<ul><li>zabbix 分布式代理守护进程，可以代替 Zabbix Server 采集性能和可用性数据。Zabbix Proxy 在 Zabbix 的部署是可选部分。</li><li>Zabbix Proxy 的部署可以很好的分担单个 Zabbix Server 的负载。<br> （通常监控大于 500 台主机时使用，需要进行分布式监控架构部署。）</li></ul> 
<p><strong>⑥Java Gateway</strong></p> 
<ul><li>Zabbix 要监控 Tomcat 服务或其它 JAVA 程序（比例 Elasticsearch、ZooKeeper），需要使用 Java Gateway 做为代理，才能从 JAVA 程序中获取数据。</li></ul> 
<h2><a id="Zabbix_60__85"></a>六、Zabbix 6.0 部署</h2> 
<p><mark>系统：CentOS 7 不支持 yum 方式安装 Zabbix 6.0 服务端<br> 安装方式：Zabbix 服务端采用编译安装的方式，zabbix 客户端采用 yum 安装的方式</mark></p> 
<h3><a id="_zabbix__90"></a>Ⅰ、部署 zabbix 服务端</h3> 
<pre><code>//关闭 selinux 与防火墙
systemctl disable --now firewalld
setenforce 0
hostnamectl set-hostname zbx-server
</code></pre> 
<p><img src="https://images2.imgbox.com/b0/3b/YpZ2qqV9_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_Nginx__PHP__101"></a>Ⅱ、部署 Nginx + PHP 环境并测试</h3> 
<p><strong>安装nginx</strong></p> 
<pre><code>cat &gt; /etc/yum.repos.d/nginx.repo &lt;&lt; 'EOF'
[nginx]
name=nginx repo
baseurl=http://nginx.org/packages/centos/$releasever/$basearch/
gpgcheck=1
enabled=1
gpgkey=https://nginx.org/keys/nginx_signing.key
module_hotfixes=true
EOF


yum install -y nginx
</code></pre> 
<p><strong>安装php</strong></p> 
<pre><code>在这里插入代码片curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo
yum install -y epel-release
rpm -Uvh https://mirror.webtatic.com/yum/el7/webtatic-release.rpm
yum -y install php72w php72w-cli php72w-common php72w-devel php72w-embedded php72w-gd php72w-mbstring php72w-pdo php72w-xml php72w-fpm php72w-mysqlnd php72w-opcache php72w-ldap php72w-bcmath
</code></pre> 
<p><strong>修改nginx配置</strong></p> 
<pre><code>vim /etc/nginx/conf.d/zbx.conf
server {
  listen 80;
  server_name zbx.csgo.com;

   location / {
    root /var/www/zbx;
    index index.php;
  }
  
  location ~ \.php$ {
    fastcgi_pass 127.0.0.1:9000;
    fastcgi_index index.php;
    fastcgi_param SCRIPT_FILENAME /var/www/zbx$fastcgi_script_name;
    include fastcgi_params;
  }
}
</code></pre> 
<p><img src="https://images2.imgbox.com/80/64/KHJKsAka_o.png" alt="在这里插入图片描述"></p> 
<p><strong>修改php配置文件</strong></p> 
<pre><code>vim /etc/php-fpm.d/www.conf
user = nginx
group = nginx


vim /etc/php.ini
max_execution_time = 300		# 368行
max_input_time = 600			# 378行
post_max_size = 90M				# 656行
date.timezone = Asia/Shanghai	# 877行
</code></pre> 
<p><img src="https://images2.imgbox.com/90/82/sXxzJAwQ_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/5f/28/OhU6P5yl_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/66/16/FTq8JAWZ_o.png" alt="在这里插入图片描述"></p> 
<p><strong>创建目录和测试文件</strong></p> 
<pre><code>mkdir -p /var/www/zbx

vim /var/www/zbx/index.php
&lt;?php
phpinfo();
?&gt;
</code></pre> 
<p><img src="https://images2.imgbox.com/8a/01/FoSewyFT_o.png" alt="在这里插入图片描述"></p> 
<pre><code>vim /etc/hosts
</code></pre> 
<p><img src="https://images2.imgbox.com/5a/4f/mLTWDdod_o.png" alt="在这里插入图片描述"></p> 
<p><strong>启动服务</strong></p> 
<pre><code>systemctl enable --now nginx php-fpm
</code></pre> 
<p><img src="https://images2.imgbox.com/6f/37/HqV6hoBY_o.png" alt="在这里插入图片描述"></p> 
<p><strong>测试访问（hosts解析）</strong></p> 
<pre><code>修改 C:\Windows\System32\drivers\etc\hosts
192.168.24.73 zbx.csgo.com
</code></pre> 
<p><img src="https://images2.imgbox.com/c6/ab/Wtbxv8GB_o.png" alt="在这里插入图片描述"></p> 
<p><strong>浏览器访问：http://zbx.csgo.com/index.php</strong></p> 
<p><img src="https://images2.imgbox.com/5d/6d/ER90T2KG_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_MySQL_57__Mariadb_105__248"></a>Ⅲ、部署数据库（要求 MySQL 5.7 或 Mariadb 10.5 及以上版本）</h3> 
<p><strong>配置 Mariadb yum源</strong></p> 
<pre><code>cat &gt; /etc/yum.repos.d/mariadb.repo &lt;&lt; EOF
[mariadb]
name = MariaDB
baseurl = http://mirrors.aliyun.com/mariadb/yum/10.5/centos7-amd64/
gpgkey = http://mirrors.aliyun.com/mariadb/yum/RPM-GPG-KEY-MariaDB
gpgcheck = 1
enabled=1
EOF

yum install -y mariadb-server mariadb

systemctl enable --now mariadb
</code></pre> 
<p><img src="https://images2.imgbox.com/be/28/P6gD8oId_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/03/fd/scrxQHfv_o.png" alt="在这里插入图片描述"></p> 
<p><strong>初始化数据库</strong></p> 
<pre><code>mysql_secure_installation
分别输入 回车 -&gt; n -&gt; Y (设置root密码，如abc123) -&gt; 后面一路 Y

mysql -u root -pabc123
</code></pre> 
<p><img src="https://images2.imgbox.com/82/66/Rdzhtvr2_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/50/06/MwfbQlBN_o.png" alt="在这里插入图片描述"></p> 
<p><strong>创建数据库并指定字符集，创建 zabbix 数据库用户并授权</strong><img src="https://images2.imgbox.com/10/45/9LJ2AHxb_o.png" alt="在这里插入图片描述"></p> 
<pre><code>CREATE DATABASE zabbix character set utf8 collate utf8_bin;

GRANT all ON zabbix.* TO 'zabbix'@'localhost' IDENTIFIED BY 'zabbix';
GRANT all ON zabbix.* TO 'zabbix'@'%' IDENTIFIED BY 'zabbix';
flush privileges;
</code></pre> 
<p><img src="https://images2.imgbox.com/39/c9/m4jfcWco_o.png" alt="在这里插入图片描述"></p> 
<p><strong>向数据库导入 zabbix 数据</strong></p> 
<pre><code>上传源码包 zabbix-6.0.13.tar.gz 到 /opt 目录
cd /opt
tar xf zabbix-6.0.13.tar.gz

ls /opt/zabbix-6.0.13/database/mysql
data.sql  double.sql  history_pk_prepare.sql  images.sql  Makefile.am  Makefile.in  schema.sql
</code></pre> 
<p><img src="https://images2.imgbox.com/ec/9c/ef3thBGa_o.png" alt="在这里插入图片描述"><br> <strong>按照顺利导入数据库</strong></p> 
<pre><code>cd /opt/zabbix-6.0.13/database/mysql
mysql -uroot -pabc123 zabbix &lt; schema.sql
mysql -uroot -pabc123 zabbix &lt; images.sql
mysql -uroot -pabc123 zabbix &lt; data.sql
mysql -uroot -pabc123 zabbix &lt; double.sql
mysql -uroot -pabc123 zabbix &lt; history_pk_prepare.sql
</code></pre> 
<p><img src="https://images2.imgbox.com/8f/eb/JvMBmalX_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/69/0f/QClOrIUQ_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_zabbix_Server__320"></a>Ⅳ、编译安装 zabbix Server 服务端</h3> 
<p><strong>安装依赖包，创建 zabbix 用户</strong></p> 
<pre><code>yum install -y mysql-devel pcre-devel openssl-devel zlib-devel libxml2-devel net-snmp-devel net-snmp libssh2-devel OpenIPMI-devel libevent-devel openldap-devel libcurl-devel fping gcc gcc-c++ make

useradd -s /sbin/nologin -M zabbix
</code></pre> 
<p><strong>编译安装</strong></p> 
<pre><code>cd /opt/zabbix-6.0.13/

./configure \
--sysconfdir=/etc/zabbix/ \
--enable-server \
--with-mysql \
--with-net-snmp \
--with-libxml2 \
--with-ssh2 \
--with-openipmi \
--with-zlib \
--with-libpthread \
--with-libevent \
--with-openssl \
--with-ldap \
--with-libcurl \
--with-libpcre

make install
</code></pre> 
<p><img src="https://images2.imgbox.com/d3/78/h3655zPb_o.png" alt="在这里插入图片描述"></p> 
<p><strong>检查版本</strong></p> 
<pre><code>zabbix_server --version
zabbix_server (Zabbix) 6.0.13
</code></pre> 
<p><img src="https://images2.imgbox.com/4f/e6/bn1xiZQX_o.png" alt="在这里插入图片描述"></p> 
<p><strong>修改 zabbix server 配置文件，修改数据库的密码</strong></p> 
<pre><code>在这里插入代码片vim /etc/zabbix/zabbix_server.conf 
......
LogFile=/var/log/zabbix_server.log		# 38行，指定 zabbix 日志路径
DBPassword=zabbix				  	    # 123行，指定 zabbix 数据库的密码
</code></pre> 
<p><img src="https://images2.imgbox.com/4f/1b/5Pzbxo4v_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/e2/40/CfIyCIGo_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/82/a7/sazYjepw_o.png" alt="在这里插入图片描述"></p> 
<p><strong>准备 systemctl 服务管理文件</strong></p> 
<pre><code>vim /usr/lib/systemd/system/zabbix-server.service
[Unit]
Description=Zabbix Server with MySQL DB
After=syslog.target network.target mysqld.service

[Service]
Type=simple
ExecStart=/usr/local/sbin/zabbix_server -f
User=zabbix

[Install]
WantedBy=multi-user.target


systemctl daemon-relead
systemctl enable --now zabbix-server

netstat -lntp | grep 10051			#zabbix_server 默认监听 10051 端口
</code></pre> 
<p><img src="https://images2.imgbox.com/fe/07/yvT0pV4x_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/cb/ec/UHZsUKet_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/71/02/xa3vdJf7_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_Web__405"></a>Ⅴ、部署 Web 前端，进行访问</h3> 
<pre><code>cp -r /opt/zabbix-6.0.13/ui/* /var/www/zbx

chown -R nginx.nginx /var/www/zbx
</code></pre> 
<p><img src="https://images2.imgbox.com/29/83/zeyUZV7j_o.png" alt="在这里插入图片描述"></p> 
<pre><code>浏览器访问：http://zbx.csgo.com/ 
【Default language】选择 Chinese(zh_CN)，点击下一步
【密码】输入 zabbix，点击下一步
【Zabbix主机名称】输入 Zabbix-监控；【默认时区】选择 Asia/Shanghai，点击下一步

安装完成后，默认的登录账号和密码为：Admin/zabbix
</code></pre> 
<p><img src="https://images2.imgbox.com/c3/d3/8pKLpZtz_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/0a/f4/zRdBasHC_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/8a/c9/fu3fo1T5_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/53/db/JVsPZ5da_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/7e/0a/iLUa3ofj_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/4e/28/VHRtqurI_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/09/d2/XPTi9ulZ_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_zabbix__zabbix__431"></a>Ⅵ、安装 zabbix 客户端，实现 zabbix 服务端自我监控</h3> 
<pre><code>rpm -ivh https://repo.zabbix.com/zabbix/6.0/rhel/7/x86_64/zabbix-release-6.0-4.el7.noarch.rpm
sed -i 's#https://repo.zabbix.com#https://mirrors.aliyun.com/zabbix#' /etc/yum.repos.d/zabbix.repo
</code></pre> 
<pre><code>#zabbix 5.0 版本开始采用 golang 语言开发的新版本客户端 agent2
yum install -y zabbix-agent2

systemctl enable --now zabbix-agent2

netstat -lntp | grep 10050			#客户端 zabbix_agent2 默认监听 10050 端口
</code></pre> 
<p><img src="https://images2.imgbox.com/1b/39/Zc7x2VmE_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_zabbixserver_Web_448"></a>Ⅶ、解决 zabbix-server Web页面中文乱码问题</h3> 
<pre><code>yum install -y wqy-microhei-fonts

\cp -f /usr/share/fonts/wqy-microhei/wqy-microhei.ttc /var/www/zbx/assets/fonts/DejaVuSans.ttf
</code></pre> 
<p><img src="https://images2.imgbox.com/3b/2e/Oc4Hofkv_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/44/fb/YwGesBTn_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/2e/8a/Tnw8DyLB_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="zabbix_461"></a>七、添加zabbix客户机</h2> 
<pre><code>systemctl disable --now firewalld
setenforce 0
hostnamectl set-hostname zbx-agent01


//服务端和客户端都配置时间同步
yum install -y ntpdate
ntpdate -u ntp.aliyun.com


//服务端和客户端都设置 hosts 解析
cat &gt; /etc/hosts &lt;&lt; EOF
192.168.24.73 zbx-server
192.168.24.72 zbx-agent01
EOF


//设置 zabbix 的下载源，安装 zabbix-agent2
rpm -ivh https://repo.zabbix.com/zabbix/6.0/rhel/7/x86_64/zabbix-release-6.0-4.el7.noarch.rpm
sed -i 's#https://repo.zabbix.com#https://mirrors.aliyun.com/zabbix#' /etc/yum.repos.d/zabbix.repo

yum install -y zabbix-agent2


//修改 agent2 配置文件
vim /etc/zabbix/zabbix_agent2.conf
......
Server=192.168.24.73			#80行，指定 zabbix 服务端的 IP 地址
ServerActive=192.168.24.73		#133行，指定 zabbix 服务端的 IP 地址
Hostname=zbx-agent01			#144行，指定当前 zabbix 客户端的主机名


//启动 zabbix-agent2
systemctl start zabbix-agent2
systemctl enable zabbix-agent2

netstat -natp | grep zabbix
tcp6       0      0 :::10050                :::*                    LISTEN      43654/zabbix_agent2 


//在服务端验证 zabbix-agent2 的连通性
yum install -y zabbix-get				#安装 zabbix 主动获取数据的命令

zabbix_get -s '192.168.24.72' -p 10050 -k 'agent.ping'
1

zabbix_get -s '192.168.24.72' -p 10050 -k 'system.hostname'
zbx-agent01

//在 Web 页面中添加 agent 主机
点击左边菜单栏【配置】中的【主机】，点击【创建主机】
【主机名称】输入 zbx-agent01
【可见的名称】输入 zbx-agent01-192.168.24.72
【模板】搜索 Linux ，选择 Linux by Zabbix agent
【群组】选择 Linux servers
【Interfaces】点击添加 客户端，【IP地址】输入 192.168.24.72


#监控模板下载地址
https://share.zabbix.com/
https://monitoringartist.github.io/zabbix-searcher/
https://git.zabbix.com/projects/ZBX/repos/zabbix/browse/templates
</code></pre> 
<p><strong>常用的键值：</strong></p> 
<pre><code>agent.ping												#服务端与客户端是否连通，返回1表示可达，返回非表示不可达
system.hostname											#系统主机名
agent.hostname											#客户端主机名
net.if.in[if,&lt;mode&gt;]									#网络接口进入的流量统计，if表示网卡名称，带&lt;&gt;的参数表示可以省略
net.if.out[if,&lt;mode&gt;]									#网络接口流出的流量统计
proc.num[&lt;name&gt;,&lt;user&gt;,&lt;state&gt;,&lt;cmdline&gt;,&lt;zone&gt;]		#进程数
net.tcp.port[&lt;ip&gt;,port]									#检查是否能建立tcp连接到指定端口，返回0表示不能连接，返回1表示可以连接
</code></pre> 
<p><img src="https://images2.imgbox.com/ff/a9/CwJy8NX0_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/da/d1/YICzxJSE_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/32/21/X8enpU2b_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_Web__agent__542"></a>Ⅰ、在 Web 页面中添加 agent 主机</h3> 
<pre><code>点击左边菜单栏【配置】中的【主机】，点击【创建主机】
【主机名称】输入 zbx-agent01
【可见的名称】输入 zbx-agent01-192.168.24.72
【模板】搜索 Linux ，选择 Linux by Zabbix agent
【群组】选择 Linux servers
【Interfaces】点击添加 客户端，【IP地址】输入 192.168.24.72
</code></pre> 
<p><img src="https://images2.imgbox.com/51/dd/wsXPzQWT_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/10/04/gQhOdHyb_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/c5/20/jp5IK71u_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="__556"></a>八 、自定义监控内容</h2> 
<ul><li>案列：自定义监控客户端服务器登录的人数</li><li>需求：限制登录人数不超过 3 个，超过 3 个就发出报警信息</li></ul> 
<pre><code>//在客户端创建自定义 key
1.明确需要执行的 linux 命令
who | wc -l

2.创建 zabbix 的监控项配置文件，用于自定义 key
vim /etc/zabbix/zabbix_agent2.conf
#可以将自定义的监控项配置文件创建在 zabbix_agent2.d 目录中
281 Include=/etc/zabbix/zabbix_agent2.d/*.conf
#自定义监控项的格式如下
321 #	Format: UserParameter=&lt;key&gt;,&lt;shell command&gt;

cd /etc/zabbix/zabbix_agent2.d/

vim UserParameter_login.conf
UserParameter=login.user,who|wc -l

systemctl restart zabbix-agent2

3.在服务端验证新建的监控项
zabbix_get -s '192.168.24.72' -p 10050 -k 'login.user'
</code></pre> 
<p><img src="https://images2.imgbox.com/d8/4e/QyCT2QyV_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/40/bf/Fnlag8mV_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/a6/80/GlpokEx8_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_Web__586"></a>在 Web 页面创建自定义监控项模板</h3> 
<h4><a id="_588"></a>Ⅰ、创建模板</h4> 
<pre><code>点击左边菜单栏【配置】中的【模板】，点击【创建模板】
【模板名称】设置成 Template Login User
【可见的名称】设置成 Template Login User
【群组】选择 Template
【描述】可自定义
点击 【添加】，此时就可在【名称】中搜索到 Template Login User 了
</code></pre> 
<p><img src="https://images2.imgbox.com/e6/26/yTrw7Ckq_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_599"></a>Ⅱ、创建监控项</h4> 
<pre><code>在这里插入代码片点击 Template Login User 模板进入
点击上方菜单栏【监控项】，点击【创建监控项】
【名称】设置成 Number of login users
【键值】设置成 login.user			#键值必须要与自定义的监控项配置文件中设置的保持一致
【更新间隔】设置成 10s
【历史数据保留时长】Storage period	30d		#保留时间可自定义设置
点击 【添加】
</code></pre> 
<p><img src="https://images2.imgbox.com/3b/f2/Q9b0GTNU_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_611"></a>Ⅲ、创建触发器</h4> 
<p>（当监控项获取到监控的值后和触发器预设的值进行对比，判断是否报警）</p> 
<pre><code>点击上方菜单栏【触发器】，点击【创建触发器】
【名称】设置成 Number of login users is greater than 3
【严重性】设置成 一般严重		#根据严重程度可自定义设置
【表达式】点击添加，【监控项】点击选择 Number of login users，【功能】选择 last()，【结果】选择 &gt; 3，点击 【插入】
点击 【添加】
</code></pre> 
<p><img src="https://images2.imgbox.com/34/98/JGFFEbfk_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_623"></a>Ⅳ、创建图形</h4> 
<pre><code>在这里插入代码片点击上方菜单栏【图形】，点击【创建图形】
【名称】设置成 Number of login users
【宽】、【高】可直接采用默认值
【监控项】点击添加勾选相关监控项 Number of login users，【功能】选择 最大，其它可保持默认值
点击 【添加】
</code></pre> 
<p><img src="https://images2.imgbox.com/eb/4b/NHMDDlH4_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_634"></a>Ⅴ、将主机与模板关联起来</h4> 
<p>一个主机可以关联多个模板</p> 
<pre><code>在这里插入代码片点击左边菜单栏【配置】中的【主机】，点击你要关联的主机
【模板】搜索 login，选择 Template Login User，点击【更新】

此时就点击【监测】中的【主机】，点击你关联主机的【图形】，即可查看到相关的监控项指标
</code></pre> 
<p><img src="https://images2.imgbox.com/82/f0/etkKv70J_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_646"></a>Ⅶ、设置邮件报警</h4> 
<pre><code>点击左边菜单栏【管理】中的【报警媒介类型】，点击【创建媒体类型】
【名称】设置成 qq_Email
【SMTP服务器】设置成 smtp.qq.com
【SMTP服务器端口】设置成 25
【SMTP HELO】设置成 qq.com
【SMTP电邮】设置成 自己的邮箱地址，例如 qwe4546456@qq.com
【认证】选择 用户名和密码
【用户名称】设置成 自己的邮箱地址，例如 qwe4546456@qq.com
【密码】可登录QQ邮箱页面，点击【设置】--&gt;【账户】中的【生成授权码】，通过短信获取授权码
【描述】可自定义
点击上方菜单栏【Message templates】，点击【添加】，【Message type】选择 问题，点击【更新】
点击 【添加】，并测试功能

点击左边菜单栏【User settings】--&gt;【Profile】--&gt;【报警媒介】，点击【添加】
【类型】选择 qq_Email
【收件人】设置成 qwe4546456@wo.cn
【当启用时】设置成 1-7,00:00-24:00
【如果存在严重性则使用】勾选需要的严重性
点击 【添加】
再点击 【更新】

点击左边菜单栏【配置】-&gt;【动作】-&gt;【Trigger actions】
选择相对应的动作名称点击进入，点击 【添加】
【类型】选择 触发器，【操作者】选择 等于，【触发器】点击选择 Nunber of login users is greater than 3
点击【添加】
勾选 【已启动】
点击 【更新】
</code></pre> 
<p><img src="https://images2.imgbox.com/e3/75/XJFGKpsk_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/ae/f8/0L0Lj96l_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/46/df/NSU45wNi_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/4c/4d/MwMuged8_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/9f/a0/AbvilrPF_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/1f/2c/WMLwXDM1_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/16/b6/XiyA7tPI_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="zabbix__686"></a>九、zabbix 自动注册</h2> 
<h3><a id="zabbix__688"></a>Ⅰ、zabbix 自动发现</h3> 
<p><mark>zabbix server 主动的去发现所有的客户端，然后将客户端的信息登记在服务端上。<br> 缺点是如果定义的网段中的主机数量多，zabbix server 登记耗时较久，且压力会较大。</mark></p> 
<pre><code>systemctl disable --now firewalld
setenforce 0
hostnamectl set-hostname zbx-agent02
</code></pre> 
<p><strong>1、确保客户端 zbx-agent02上的 zabbix-agent2 服务状态正常</strong></p> 
<pre><code>yum install -y ntpdate
ntpdate -u ntp.aliyun.com
</code></pre> 
<p><strong>设置zabbix的下载源，安装zabbix-agent2</strong></p> 
<pre><code>rpm -ivh https://repo.zabbix.com/zabbix/6.0/rhel/7/x86_64/zabbix-release-6.0-4.el7.noarch.rpm
sed -i 's#https://repo.zabbix.com#https://mirrors.aliyun.com/zabbix#' /etc/yum.repos.d/zabbix.repo
</code></pre> 
<pre><code>yum install -y zabbix-agent2
</code></pre> 
<p><strong>修改agent2 配置文件</strong></p> 
<pre><code>vim /etc/zabbix/zabbix_agent2.conf
......
Server=192.168.102.10			#80行，指定 zabbix 服务端的 IP 地址
ServerActive=192.168.102.10		#133行，指定 zabbix 服务端的 IP 地址
Hostname=zbx-agent02			#144行，指定当前 zabbix 客户端的主机名
</code></pre> 
<p><strong>启动 zabbix-agent2</strong></p> 
<pre><code>systemctl start zabbix-agent2
systemctl enable zabbix-agent2
</code></pre> 
<p><strong>查看服务的端口有没有启动成功</strong></p> 
<pre><code>netstat -natp | grep zabbix
</code></pre> 
<p><strong>查看服务正不正常</strong></p> 
<pre><code>systemctl is-active zabbix-agent2.service 
</code></pre> 
<p><strong>2、服务端和客户端都设置 hosts 解析</strong></p> 
<pre><code>cat &gt; /etc/hosts &lt;&lt; EOF
192.168.102.10 zbx-server
192.168.102.30 zbx-agent01
192.168.102.20 zbx-agent02
EOF
</code></pre> 
<p><strong>3、在 Web 页面删除原有的客户端主机</strong></p> 
<pre><code>点击左边菜单栏【配置】中的【主机】，勾选原有的客户端主机，点击 删除
</code></pre> 
<p><strong>4、在 Web 页面配置自动发现</strong></p> 
<pre><code>点击左边菜单栏【配置】中的【自动发现】，点击【创建发现规则】
【名称】设置成 mynetwork
【IP范围】设置成 192.168.102.1-254
【更新间隔】设置成 30s
【检查】点击【添加】，【检查类型】选择 Zabbix 客户端，【端口范围】设置成 10050，【键值】设置成 system.uname
【设备唯一性准则】选择 IP地址
【主机名称】选择 DNS名称
【可见的名称】选择 主机名称
勾选 【已启用】，点击 【添加】

点击左边菜单栏【配置】中的【动作】，上方菜单选择 【发现动作】
勾选 【Auto discovery. Linux servers.】，点击 【启用】

点击左边菜单栏【配置】中的【主机】刷新，等待一段时间后即可刷新出自动发现的客户端主机
</code></pre> 
<p><strong>可以服务端查看 zabbix 日志</strong></p> 
<pre><code>tail -f /var/log/zabbix_server.log
</code></pre> 
<p><strong>2、zabbix 自动注册（对于 agent2 是主动模式）</strong><br> <mark>zabbix agent2 会主动上报自己的信息，发给 zabbix server。<br> 缺点是可能因为配置文件配置错误或者网络不通等原因导致 zabbix agent2 可能找不到 zabbix server。</mark></p> 
<p><strong>环境准备</strong></p> 
<pre><code>点击左边菜单栏【配置】中的【发现动作】，勾选发现规则，点击 禁用
</code></pre> 
<p><img src="https://images2.imgbox.com/88/4a/PdpnLkbu_o.png" alt="在这里插入图片描述"></p> 
<pre><code>点击左边菜单栏【配置】中的【主机】，勾选原有的客户端主机，点击 删除
</code></pre> 
<p><img src="https://images2.imgbox.com/59/38/Q70ODGkP_o.png" alt="在这里插入图片描述"></p> 
<p><strong>2、服务端和客户端都设置 hosts 解析</strong></p> 
<pre><code>cat &gt; /etc/hosts &lt;&lt; EOF
192.168.102.10 zbx-server
192.168.102.30 zbx-agent01
192.168.102.20 zbx-agent02
EOF
</code></pre> 
<p><strong>3、修改 所有的服务端和客户端的zabbix-agent2 配置文件</strong></p> 
<pre><code>vim /etc/zabbix/zabbix_agent2.conf
......
HostnameItem=system.hostname		#152行，取消注释

egrep -v "^#|^$" /etc/zabbix/zabbix_agent2.conf 
PidFile=/var/run/zabbix/zabbix_agent2.pid
LogFile=/var/log/zabbix/zabbix_agent2.log
LogFileSize=0
Server=192.168.102.10
ServerActive=192.168.102.10
Hostname=zbx-agent01
HostnameItem=system.hostname
Include=/etc/zabbix/zabbix_agent2.d/*.conf
ControlSocket=/tmp/agent.sock
</code></pre> 
<pre><code>systemctl restart zabbix-agent2
</code></pre> 
<p><strong>4、在 Web 页面配置自动注册</strong></p> 
<pre><code>点击左边菜单栏【配置】中的【动作】，上方菜单选择 【自动注册动作】，点击【创建动作】
【名称】设置成 Auto registration
点击 【添加】，【类型】选择 主机名称，【操作者】选择 包含，【值】设置成 zbx-agent
点击上方菜单栏【操作】，点击【添加】，【操作类型】选择 添加主机，点击 【Add】
再点击【添加】，【操作类型】选择 添加到主机群组，【主机群组】选择 Linux servers，点击 【Add】
再点击【添加】，【操作类型】选择 与模板关联，【模板】搜索 Linux，选择 Linux by Zabbix agent，点击 【Add】
点击下方的【添加】
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/40a843b44caae4525ad6e6819a78a938/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Fuzz_AFL学习</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/49e9acfa548b45406078e3f4684974bb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">入职第一天：先用Git管好你的代码！</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>