<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Go -- log日志库 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Go -- log日志库" />
<meta property="og:description" content="一、标准库log介绍1、使用Logger2、配置logger2.1、标准logger的配置 二、自定义日志库1、需要满足的需求2、了解下runtime包3、自定义日志库 一、标准库log介绍 Go语言内置的log包实现了简单的日志服务。 1、使用Logger log包定义了Logger类型，该类型提供了一些格式化输出的方法。log包也提供了一个预定义的“标准”logger，可以通过调用函数Print系列(Print|Printf|Println）、Fatal系列（Fatal|Fatalf|Fatalln）、和Panic系列（Panic|Panicf|Panicln）来使用，比自行创建一个logger对象更容易使用。 logger会打印每条日志信息的日期、时间，默认输出到系统的标准错误。Fatal系列函数会在写入日志信息后调用os.Exit(1)。Panic系列函数会在写入日志信息后panic。
示例： // 直接调用print来输出日志到终端 func main() { log.Println(&#34;这是一条很普通的日志。&#34;) v := &#34;很普通的&#34; log.Printf(&#34;这是一条%s日志。\n&#34;, v) log.Fatalln(&#34;这是一条会触发fatal的日志。&#34;) log.Panicln(&#34;这是一条会触发panic的日志。&#34;) } 2、配置logger 2.1、标准logger的配置 默认情况下的logger只会提供日志的时间信息，但是很多情况下我们希望得到更多信息，比如记录该日志的文件名和行号等。log标准库中为我们提供了定制这些设置的方法。log标准库中的Flags函数会返回标准logger的输出配置，而SetFlags函数用来设置标准logger的输出配置。 二、自定义日志库 1、需要满足的需求 1、支持网不同地方输出日志2、日志要支持开关控制3、完整的日志要包含时间、行号、文件名、日志级别、日志信息4、日志文件要能切割5、日志级别 DebugTraceInfoWarningErrorFatal 2、了解下runtime包 runtime.Caller() 方法，会返回函数调用的信息，在()内传入int类型数据，代表调用的层数（0代表第一层被调用，1代表第二层，一次类推）。runtime.Caller()返回如下四个参数: pc: 记录了调用的函数消息，如函数名等file: 调用的文件名line: 行数OK: 返回的bool值 // 获取代码行号 func getinfo(n int) { /* runtime.Caller()返回四个参数: pc: 记录了调用的函数消息，如函数名等 file: 调用的文件名 line: 行数 OK: 返回的bool值 */ pc, file, line, ok := runtime.Caller(n) if !ok { fmt.Printf(&#34;runtime.Caller() failed\n&#34;) return } fmt.Println(pc) // 用于调用函数消息 funcName := runtime." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/95f67b472f9f5453826694566e64cbd7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-10-28T22:48:13+08:00" />
<meta property="article:modified_time" content="2021-10-28T22:48:13+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Go -- log日志库</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4> </h4> 
 <ul><li><a href="#log_1" rel="nofollow">一、标准库log介绍</a></li><li><ul><li><a href="#1Logger_3" rel="nofollow">1、使用Logger</a></li><li><a href="#2logger_21" rel="nofollow">2、配置logger</a></li><li><ul><li><a href="#21logger_22" rel="nofollow">2.1、标准logger的配置</a></li></ul> 
  </li></ul> 
  </li><li><a href="#_30" rel="nofollow">二、自定义日志库</a></li><li><ul><li><a href="#1_31" rel="nofollow">1、需要满足的需求</a></li><li><a href="#2runtime_44" rel="nofollow">2、了解下runtime包</a></li><li><a href="#3_80" rel="nofollow">3、自定义日志库</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="log_1"></a>一、标准库log介绍</h2> 
<ul><li>Go语言内置的log包实现了简单的日志服务。</li></ul> 
<h3><a id="1Logger_3"></a>1、使用Logger</h3> 
<ul><li>log包定义了Logger类型，该类型提供了一些格式化输出的方法。</li><li>log包也提供了一个预定义的“标准”logger，可以通过调用函数Print系列(Print|Printf|Println）、Fatal系列（Fatal|Fatalf|Fatalln）、和Panic系列（Panic|Panicf|Panicln）来使用，比自行创建一个logger对象更容易使用。 
  <ul><li>logger会打印每条日志信息的日期、时间，默认输出到系统的标准错误。</li><li>Fatal系列函数会在写入日志信息后调用os.Exit(1)。</li><li>Panic系列函数会在写入日志信息后panic。<br> 示例：</li></ul> </li></ul> 
<pre><code class="prism language-c"><span class="token comment">// 直接调用print来输出日志到终端</span>
func <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"这是一条很普通的日志。"</span><span class="token punctuation">)</span>
	v <span class="token operator">:</span><span class="token operator">=</span> <span class="token string">"很普通的"</span>
	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"这是一条%s日志。\n"</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Fatalln</span><span class="token punctuation">(</span><span class="token string">"这是一条会触发fatal的日志。"</span><span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Panicln</span><span class="token punctuation">(</span><span class="token string">"这是一条会触发panic的日志。"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="2logger_21"></a>2、配置logger</h3> 
<h4><a id="21logger_22"></a>2.1、标准logger的配置</h4> 
<ul><li>默认情况下的logger只会提供日志的时间信息，但是很多情况下我们希望得到更多信息，比如记录该日志的文件名和行号等。log标准库中为我们提供了定制这些设置的方法。</li><li>log标准库中的Flags函数会返回标准logger的输出配置，而SetFlags函数用来设置标准logger的输出配置。</li></ul> 
<h2><a id="_30"></a>二、自定义日志库</h2> 
<h3><a id="1_31"></a>1、需要满足的需求</h3> 
<ul><li>1、支持网不同地方输出日志</li><li>2、日志要支持开关控制</li><li>3、完整的日志要包含时间、行号、文件名、日志级别、日志信息</li><li>4、日志文件要能切割</li><li>5、日志级别 
  <ul><li>Debug</li><li>Trace</li><li>Info</li><li>Warning</li><li>Error</li><li>Fatal</li></ul> </li></ul> 
<h3><a id="2runtime_44"></a>2、了解下runtime包</h3> 
<ul><li>runtime.Caller() 方法，会返回函数调用的信息，在()内传入int类型数据，代表调用的层数（0代表第一层被调用，1代表第二层，一次类推）。runtime.Caller()返回如下四个参数: 
  <ul><li>pc: 记录了调用的函数消息，如函数名等</li><li>file: 调用的文件名</li><li>line: 行数</li><li>OK: 返回的bool值</li></ul> </li></ul> 
<pre><code class="prism language-c"><span class="token comment">// 获取代码行号</span>
func <span class="token function">getinfo</span><span class="token punctuation">(</span>n <span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">/*
		runtime.Caller()返回四个参数:
		pc: 记录了调用的函数消息，如函数名等
		file: 调用的文件名
		line: 行数
		OK: 返回的bool值
	*/</span>
	pc<span class="token punctuation">,</span> file<span class="token punctuation">,</span> line<span class="token punctuation">,</span> ok <span class="token operator">:</span><span class="token operator">=</span> runtime<span class="token punctuation">.</span><span class="token function">Caller</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
	<span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"runtime.Caller() failed\n"</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>pc<span class="token punctuation">)</span>  <span class="token comment">// 用于调用函数消息</span>
	funcName <span class="token operator">:</span><span class="token operator">=</span> runtime<span class="token punctuation">.</span><span class="token function">FuncForPC</span><span class="token punctuation">(</span>pc<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 利用 runtime.FuncForPC()方法，参数pc序号，可以调出函数名</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>funcName<span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>   <span class="token comment">// 打印出执行的文件的绝对路径</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">Base</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// path.Base()方法可以获取传入的绝对路径的最后一个文件名称</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span>   <span class="token comment">// 打印出执行的行号</span>
<span class="token punctuation">}</span>

func <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token function">getinfo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre> 
<h3><a id="3_80"></a>3、自定义日志库</h3> 
<p>1、在 E:\GoProject\src\gitee.com 项目目录下，新建 mylogger 包目录，存放日志库代码</p> 
<ul><li>在mylogger包目录下console.go文件中，放将日志输出到终端的代码</li></ul> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">E<span class="token operator">:</span>\GoProject\src\gitee<span class="token punctuation">.</span>com\mylogger\console<span class="token punctuation">.</span>go</span></span>

package mylogger

<span class="token function">import</span> <span class="token punctuation">(</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"strings"</span>
	<span class="token string">"time"</span>
<span class="token punctuation">)</span>

<span class="token comment">// 终端输出的日志内容</span>

<span class="token comment">// Logger 日志结构体</span>
type ConsoleLogger <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	Level LogLevel
<span class="token punctuation">}</span>

<span class="token comment">// 构造函数</span>
func <span class="token function">NewLog</span><span class="token punctuation">(</span>levelStr string<span class="token punctuation">)</span> ConsoleLogger <span class="token punctuation">{<!-- --></span>
	level<span class="token punctuation">,</span> err <span class="token operator">:</span><span class="token operator">=</span> <span class="token function">parseLogLevel</span><span class="token punctuation">(</span>levelStr<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> nil <span class="token punctuation">{<!-- --></span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> ConsoleLogger<span class="token punctuation">{<!-- --></span>
		Level<span class="token operator">:</span> level<span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 定义日志等级比较</span>
<span class="token function">func</span> <span class="token punctuation">(</span>c ConsoleLogger<span class="token punctuation">)</span> <span class="token function">enable</span><span class="token punctuation">(</span>level LogLevel<span class="token punctuation">)</span> bool <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> c<span class="token punctuation">.</span>Level <span class="token operator">&lt;=</span> level
<span class="token punctuation">}</span>

<span class="token comment">// 定义一个日志打印方法</span>
<span class="token function">func</span> <span class="token punctuation">(</span>c ConsoleLogger<span class="token punctuation">)</span> <span class="token function">outLog</span><span class="token punctuation">(</span>lv LogLevel<span class="token punctuation">,</span> format string<span class="token punctuation">,</span> a <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>interface<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	level <span class="token operator">:</span><span class="token operator">=</span> <span class="token function">parseLogLevelStr</span><span class="token punctuation">(</span>lv<span class="token punctuation">)</span>
	<span class="token keyword">if</span> c<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span>lv<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		msg <span class="token operator">:</span><span class="token operator">=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span>format<span class="token punctuation">,</span> a<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token comment">// 支持格式化操作，a...表示对接收的接口进行展开</span>
		level <span class="token operator">=</span> strings<span class="token punctuation">.</span><span class="token function">ToUpper</span><span class="token punctuation">(</span>level<span class="token punctuation">)</span>
		fileName<span class="token punctuation">,</span> funcName<span class="token punctuation">,</span> linenu <span class="token operator">:</span><span class="token operator">=</span> <span class="token function">getinfo</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"[%s] [%s] [FileName:%s lineNum:%d:%s] %s\n"</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"2006-01-02 15:04:05"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> level<span class="token punctuation">,</span> fileName<span class="token punctuation">,</span> linenu<span class="token punctuation">,</span> funcName<span class="token punctuation">,</span> msg<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Debug日志</span>
<span class="token function">func</span> <span class="token punctuation">(</span>c ConsoleLogger<span class="token punctuation">)</span> <span class="token function">Debug</span><span class="token punctuation">(</span>msg string<span class="token punctuation">,</span> a <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>interface<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	c<span class="token punctuation">.</span><span class="token function">outLog</span><span class="token punctuation">(</span>DEBUG<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> a<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// Info日志</span>
<span class="token function">func</span> <span class="token punctuation">(</span>c ConsoleLogger<span class="token punctuation">)</span> <span class="token function">Info</span><span class="token punctuation">(</span>msg string<span class="token punctuation">,</span> a <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>interface<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	c<span class="token punctuation">.</span><span class="token function">outLog</span><span class="token punctuation">(</span>INFO<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> a<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// Warning日志</span>
<span class="token function">func</span> <span class="token punctuation">(</span>c ConsoleLogger<span class="token punctuation">)</span> <span class="token function">Warning</span><span class="token punctuation">(</span>msg string<span class="token punctuation">,</span> a <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>interface<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	c<span class="token punctuation">.</span><span class="token function">outLog</span><span class="token punctuation">(</span>WARNING<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> a<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// Error日志</span>
<span class="token function">func</span> <span class="token punctuation">(</span>c ConsoleLogger<span class="token punctuation">)</span> <span class="token function">Error</span><span class="token punctuation">(</span>msg string<span class="token punctuation">,</span> a <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>interface<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	c<span class="token punctuation">.</span><span class="token function">outLog</span><span class="token punctuation">(</span>ERROR<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> a<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// Fatal日志</span>
<span class="token function">func</span> <span class="token punctuation">(</span>c ConsoleLogger<span class="token punctuation">)</span> <span class="token function">Fatal</span><span class="token punctuation">(</span>msg string<span class="token punctuation">,</span> a <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>interface<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	c<span class="token punctuation">.</span><span class="token function">outLog</span><span class="token punctuation">(</span>FATAL<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> a<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre> 
<ul><li>在mylogger包目录下logfile.go文件中，放将日志输出到文件的代码</li></ul> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">E<span class="token operator">:</span>\GoProject\src\gitee<span class="token punctuation">.</span>com\mylogger\logfile<span class="token punctuation">.</span>go</span></span>

package mylogger

<span class="token comment">// 向文件中写日志的相关操作</span>

<span class="token function">import</span> <span class="token punctuation">(</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"os"</span>
	<span class="token string">"path"</span>
	<span class="token string">"strings"</span>
	<span class="token string">"time"</span>
<span class="token punctuation">)</span>

<span class="token comment">// Logger 日志结构体</span>
type FileLogger <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	Level       LogLevel
	logPath     string <span class="token comment">// 日志文件目录</span>
	fileName    string <span class="token comment">// 日志文件名称</span>
	maxFileSize int64  <span class="token comment">// 日志文件大小</span>
	fileObj     <span class="token operator">*</span>os<span class="token punctuation">.</span>File
	errFileObj  <span class="token operator">*</span>os<span class="token punctuation">.</span>File
<span class="token punctuation">}</span>

<span class="token comment">// 构造函数</span>
func <span class="token function">NewFileLog</span><span class="token punctuation">(</span>levelStr<span class="token punctuation">,</span> fp<span class="token punctuation">,</span> fn string<span class="token punctuation">,</span> maxSize int64<span class="token punctuation">)</span> <span class="token operator">*</span>FileLogger <span class="token punctuation">{<!-- --></span>
	level<span class="token punctuation">,</span> err <span class="token operator">:</span><span class="token operator">=</span> <span class="token function">parseLogLevel</span><span class="token punctuation">(</span>levelStr<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> nil <span class="token punctuation">{<!-- --></span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	f1 <span class="token operator">:</span><span class="token operator">=</span> <span class="token operator">&amp;</span>FileLogger<span class="token punctuation">{<!-- --></span>
		Level<span class="token operator">:</span>       level<span class="token punctuation">,</span>
		logPath<span class="token operator">:</span>     fp<span class="token punctuation">,</span>
		fileName<span class="token operator">:</span>    fn<span class="token punctuation">,</span>
		maxFileSize<span class="token operator">:</span> maxSize<span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
	err <span class="token operator">=</span> f1<span class="token punctuation">.</span><span class="token function">initFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> nil <span class="token punctuation">{<!-- --></span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> f1
<span class="token punctuation">}</span>

<span class="token comment">// 定义文件初始化方法，打开文件</span>
<span class="token function">func</span> <span class="token punctuation">(</span>f <span class="token operator">*</span>FileLogger<span class="token punctuation">)</span> <span class="token function">initFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> error <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 打开文件</span>
	fullPath <span class="token operator">:</span><span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>logPath<span class="token punctuation">,</span> f<span class="token punctuation">.</span>fileName<span class="token punctuation">)</span>
	fileObj<span class="token punctuation">,</span> err <span class="token operator">:</span><span class="token operator">=</span> os<span class="token punctuation">.</span><span class="token function">OpenFile</span><span class="token punctuation">(</span>fullPath<span class="token punctuation">,</span> os<span class="token punctuation">.</span>O_CREATE<span class="token operator">|</span>os<span class="token punctuation">.</span>O_APPEND<span class="token operator">|</span>os<span class="token punctuation">.</span>O_WRONLY<span class="token punctuation">,</span> <span class="token number">0644</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> nil <span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"open logFile failed,Err:%v"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
		<span class="token keyword">return</span> err
	<span class="token punctuation">}</span>
	<span class="token comment">// 打开错误日志文件</span>
	errFileObj<span class="token punctuation">,</span> err <span class="token operator">:</span><span class="token operator">=</span> os<span class="token punctuation">.</span><span class="token function">OpenFile</span><span class="token punctuation">(</span><span class="token string">"error-"</span><span class="token operator">+</span>fullPath<span class="token punctuation">,</span> os<span class="token punctuation">.</span>O_CREATE<span class="token operator">|</span>os<span class="token punctuation">.</span>O_APPEND<span class="token operator">|</span>os<span class="token punctuation">.</span>O_WRONLY<span class="token punctuation">,</span> <span class="token number">0644</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> nil <span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"open errorLogFile failed,Err:%v"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
		<span class="token keyword">return</span> err
	<span class="token punctuation">}</span>
	<span class="token comment">// 将文件句柄赋值给结构体中的元素</span>
	f<span class="token punctuation">.</span>fileObj <span class="token operator">=</span> fileObj
	f<span class="token punctuation">.</span>errFileObj <span class="token operator">=</span> errFileObj
	<span class="token keyword">return</span> nil
<span class="token punctuation">}</span>

<span class="token comment">// 关闭文件方法</span>
<span class="token function">func</span> <span class="token punctuation">(</span>f <span class="token operator">*</span>FileLogger<span class="token punctuation">)</span> <span class="token function">closeFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	f<span class="token punctuation">.</span>fileObj<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	f<span class="token punctuation">.</span>errFileObj<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 定义日志等级比较</span>
<span class="token function">func</span> <span class="token punctuation">(</span>f <span class="token operator">*</span>FileLogger<span class="token punctuation">)</span> <span class="token function">enable</span><span class="token punctuation">(</span>level LogLevel<span class="token punctuation">)</span> bool <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> f<span class="token punctuation">.</span>Level <span class="token operator">&lt;=</span> level
<span class="token punctuation">}</span>

<span class="token comment">// 定义检查日志大小进行切割的方法</span>
<span class="token function">func</span> <span class="token punctuation">(</span>f <span class="token operator">*</span>FileLogger<span class="token punctuation">)</span> <span class="token function">checkLogSize</span><span class="token punctuation">(</span>file <span class="token operator">*</span>os<span class="token punctuation">.</span>File<span class="token punctuation">)</span> bool <span class="token punctuation">{<!-- --></span> <span class="token comment">// 利用os.Open()方法打开的文件句柄类型都是 *os.File 这种指针类型</span>
	fileInfo<span class="token punctuation">,</span> err <span class="token operator">:</span><span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">Stat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> nil <span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"get file info failed,err:%v\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
		<span class="token keyword">return</span> false
		<span class="token comment">// panic(err)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> fileInfo<span class="token punctuation">.</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> f<span class="token punctuation">.</span>maxFileSize <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> true
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> false
<span class="token punctuation">}</span>

<span class="token function">func</span> <span class="token punctuation">(</span>f <span class="token operator">*</span>FileLogger<span class="token punctuation">)</span> <span class="token function">cutFile</span><span class="token punctuation">(</span>file <span class="token operator">*</span>os<span class="token punctuation">.</span>File<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>os<span class="token punctuation">.</span>File<span class="token punctuation">,</span> error<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 获取当前文件名</span>
	fileInfo<span class="token punctuation">,</span> err <span class="token operator">:</span><span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">Stat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> nil <span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"get file info failed,err:%v\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
		<span class="token keyword">return</span> nil<span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>
	append <span class="token operator">:</span><span class="token operator">=</span> <span class="token string">"_"</span> <span class="token operator">+</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"2006-01-02-15-04-05"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">".log"</span> <span class="token comment">// 时间戳后缀</span>
	fileName <span class="token operator">:</span><span class="token operator">=</span> fileInfo<span class="token punctuation">.</span><span class="token function">Name</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	newFileName <span class="token operator">:</span><span class="token operator">=</span> fileName <span class="token operator">+</span> append
	oldPath <span class="token operator">:</span><span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>logPath<span class="token punctuation">,</span> fileName<span class="token punctuation">)</span> <span class="token comment">// 日志文件的全路径</span>
	newPath <span class="token operator">:</span><span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>logPath<span class="token punctuation">,</span> newFileName<span class="token punctuation">)</span>
	<span class="token comment">// 关闭当前文件句柄</span>
	file<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// 进行更名备份</span>
	os<span class="token punctuation">.</span><span class="token function">Rename</span><span class="token punctuation">(</span>oldPath<span class="token punctuation">,</span> newPath<span class="token punctuation">)</span>
	<span class="token comment">// 再打开一个文件</span>
	fileObj<span class="token punctuation">,</span> err <span class="token operator">:</span><span class="token operator">=</span> os<span class="token punctuation">.</span><span class="token function">OpenFile</span><span class="token punctuation">(</span>oldPath<span class="token punctuation">,</span> os<span class="token punctuation">.</span>O_CREATE<span class="token operator">|</span>os<span class="token punctuation">.</span>O_APPEND<span class="token operator">|</span>os<span class="token punctuation">.</span>O_WRONLY<span class="token punctuation">,</span> <span class="token number">0644</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> nil <span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"open logFile failed,Err:%v\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
		<span class="token keyword">return</span> nil<span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> fileObj<span class="token punctuation">,</span> nil
<span class="token punctuation">}</span>

<span class="token comment">// 定义一个日志输出的方法</span>
<span class="token function">func</span> <span class="token punctuation">(</span>f <span class="token operator">*</span>FileLogger<span class="token punctuation">)</span> <span class="token function">outLog</span><span class="token punctuation">(</span>lv LogLevel<span class="token punctuation">,</span> format string<span class="token punctuation">,</span> a <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>interface<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	level <span class="token operator">:</span><span class="token operator">=</span> <span class="token function">parseLogLevelStr</span><span class="token punctuation">(</span>lv<span class="token punctuation">)</span>
	<span class="token keyword">if</span> f<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span>lv<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		msg <span class="token operator">:</span><span class="token operator">=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span>format<span class="token punctuation">,</span> a<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token comment">// 支持格式化操作，a...表示对接收的接口进行展开</span>
		level <span class="token operator">=</span> strings<span class="token punctuation">.</span><span class="token function">ToUpper</span><span class="token punctuation">(</span>level<span class="token punctuation">)</span>
		fileName<span class="token punctuation">,</span> funcName<span class="token punctuation">,</span> linenu <span class="token operator">:</span><span class="token operator">=</span> <span class="token function">getinfo</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
		<span class="token comment">// 判断日志是否需要切割</span>
		<span class="token keyword">if</span> f<span class="token punctuation">.</span><span class="token function">checkLogSize</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>fileObj<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			fileobj<span class="token punctuation">,</span> err <span class="token operator">:</span><span class="token operator">=</span> f<span class="token punctuation">.</span><span class="token function">cutFile</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>fileObj<span class="token punctuation">)</span>
			<span class="token keyword">if</span> err <span class="token operator">!=</span> nil <span class="token punctuation">{<!-- --></span>
				fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"log cut failed,err:%v\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
			f<span class="token punctuation">.</span>fileObj <span class="token operator">=</span> fileobj
		<span class="token punctuation">}</span>
		<span class="token comment">// 将日志记录在日志文件中</span>
		fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>fileObj<span class="token punctuation">,</span> <span class="token string">"[%s] [%s] [FileName:%s lineNum:%d:%s] %s\n"</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"2006-01-02 15:04:05"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> level<span class="token punctuation">,</span> fileName<span class="token punctuation">,</span> linenu<span class="token punctuation">,</span> funcName<span class="token punctuation">,</span> msg<span class="token punctuation">)</span>
		<span class="token keyword">if</span> lv <span class="token operator">&gt;=</span> ERROR <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 判断错误日志是否需要切割</span>
			<span class="token keyword">if</span> f<span class="token punctuation">.</span><span class="token function">checkLogSize</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>errFileObj<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				fileobj<span class="token punctuation">,</span> err <span class="token operator">:</span><span class="token operator">=</span> f<span class="token punctuation">.</span><span class="token function">cutFile</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>errFileObj<span class="token punctuation">)</span>
				<span class="token keyword">if</span> err <span class="token operator">!=</span> nil <span class="token punctuation">{<!-- --></span>
					fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"log cut failed,err:%v\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
				<span class="token punctuation">}</span>
				f<span class="token punctuation">.</span>errFileObj <span class="token operator">=</span> fileobj
			<span class="token punctuation">}</span>
			<span class="token comment">// 将日志等级大于ERROR的在错误日志中再记录一遍</span>
			fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>errFileObj<span class="token punctuation">,</span> <span class="token string">"[%s] [%s] [FileName:%s lineNum:%d:%s] %s\n"</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"2006-01-02 15:04:05"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> level<span class="token punctuation">,</span> fileName<span class="token punctuation">,</span> linenu<span class="token punctuation">,</span> funcName<span class="token punctuation">,</span> msg<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Debug日志</span>
<span class="token function">func</span> <span class="token punctuation">(</span>f <span class="token operator">*</span>FileLogger<span class="token punctuation">)</span> <span class="token function">Debug</span><span class="token punctuation">(</span>msg string<span class="token punctuation">,</span> a <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>interface<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	f<span class="token punctuation">.</span><span class="token function">outLog</span><span class="token punctuation">(</span>DEBUG<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> a<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// Info日志</span>
<span class="token function">func</span> <span class="token punctuation">(</span>f <span class="token operator">*</span>FileLogger<span class="token punctuation">)</span> <span class="token function">Info</span><span class="token punctuation">(</span>msg string<span class="token punctuation">,</span> a <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>interface<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	f<span class="token punctuation">.</span><span class="token function">outLog</span><span class="token punctuation">(</span>INFO<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> a<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// Warning日志</span>
<span class="token function">func</span> <span class="token punctuation">(</span>f <span class="token operator">*</span>FileLogger<span class="token punctuation">)</span> <span class="token function">Warning</span><span class="token punctuation">(</span>msg string<span class="token punctuation">,</span> a <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>interface<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	f<span class="token punctuation">.</span><span class="token function">outLog</span><span class="token punctuation">(</span>WARNING<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> a<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// Error日志</span>
<span class="token function">func</span> <span class="token punctuation">(</span>f <span class="token operator">*</span>FileLogger<span class="token punctuation">)</span> <span class="token function">Error</span><span class="token punctuation">(</span>msg string<span class="token punctuation">,</span> a <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>interface<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	f<span class="token punctuation">.</span><span class="token function">outLog</span><span class="token punctuation">(</span>ERROR<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> a<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// Fatal日志</span>
<span class="token function">func</span> <span class="token punctuation">(</span>f <span class="token operator">*</span>FileLogger<span class="token punctuation">)</span> <span class="token function">Fatal</span><span class="token punctuation">(</span>msg string<span class="token punctuation">,</span> a <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>interface<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	f<span class="token punctuation">.</span><span class="token function">outLog</span><span class="token punctuation">(</span>FATAL<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> a<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre> 
<ul><li>在mylogger包目录下创建mylogger.go文件，放包内共用的代码</li></ul> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">E<span class="token operator">:</span>\GoProject\src\gitee<span class="token punctuation">.</span>com\mylogger\mylogger<span class="token punctuation">.</span>go</span></span>

package mylogger

<span class="token function">import</span> <span class="token punctuation">(</span>
	<span class="token string">"errors"</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"path"</span>
	<span class="token string">"runtime"</span>
	<span class="token string">"strings"</span>
<span class="token punctuation">)</span>

<span class="token comment">// 设置日志级别</span>
type LogLevel uint16

<span class="token keyword">const</span> <span class="token punctuation">(</span>
	UNKNOWN LogLevel <span class="token operator">=</span> iota
	DEBUG
	TRACE
	INFO
	WARNING
	ERROR
	FATAL
<span class="token punctuation">)</span>

<span class="token comment">// 解析日志等级，将字符串解析成int</span>
func <span class="token function">parseLogLevel</span><span class="token punctuation">(</span>s string<span class="token punctuation">)</span> <span class="token punctuation">(</span>LogLevel<span class="token punctuation">,</span> error<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	s <span class="token operator">=</span> strings<span class="token punctuation">.</span><span class="token function">ToLower</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token comment">// 将字符串全部转为小写</span>
	<span class="token keyword">switch</span> s <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">case</span> <span class="token string">"debug"</span><span class="token operator">:</span>
		<span class="token keyword">return</span> DEBUG<span class="token punctuation">,</span> nil
	<span class="token keyword">case</span> <span class="token string">"trace"</span><span class="token operator">:</span>
		<span class="token keyword">return</span> TRACE<span class="token punctuation">,</span> nil
	<span class="token keyword">case</span> <span class="token string">"info"</span><span class="token operator">:</span>
		<span class="token keyword">return</span> INFO<span class="token punctuation">,</span> nil
	<span class="token keyword">case</span> <span class="token string">"warning"</span><span class="token operator">:</span>
		<span class="token keyword">return</span> WARNING<span class="token punctuation">,</span> nil
	<span class="token keyword">case</span> <span class="token string">"error"</span><span class="token operator">:</span>
		<span class="token keyword">return</span> ERROR<span class="token punctuation">,</span> nil
	<span class="token keyword">case</span> <span class="token string">"fatal"</span><span class="token operator">:</span>
		<span class="token keyword">return</span> FATAL<span class="token punctuation">,</span> nil
	<span class="token keyword">default</span><span class="token operator">:</span>
		err <span class="token operator">:</span><span class="token operator">=</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"无效日志等级"</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> UNKNOWN<span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 将日志等级解析成字符串</span>
func <span class="token function">parseLogLevelStr</span><span class="token punctuation">(</span>lv LogLevel<span class="token punctuation">)</span> <span class="token punctuation">(</span>s string<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	s <span class="token operator">=</span> strings<span class="token punctuation">.</span><span class="token function">ToLower</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token comment">// 将字符串全部转为小写</span>
	<span class="token keyword">switch</span> lv <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">case</span> DEBUG<span class="token operator">:</span>
		<span class="token keyword">return</span> <span class="token string">"DEBUG"</span>
	<span class="token keyword">case</span> TRACE<span class="token operator">:</span>
		<span class="token keyword">return</span> <span class="token string">"TRACE"</span>
	<span class="token keyword">case</span> INFO<span class="token operator">:</span>
		<span class="token keyword">return</span> <span class="token string">"INFO"</span>
	<span class="token keyword">case</span> WARNING<span class="token operator">:</span>
		<span class="token keyword">return</span> <span class="token string">"WARNING"</span>
	<span class="token keyword">case</span> ERROR<span class="token operator">:</span>
		<span class="token keyword">return</span> <span class="token string">"ERROR"</span>
	<span class="token keyword">case</span> FATAL<span class="token operator">:</span>
		<span class="token keyword">return</span> <span class="token string">"FATAL"</span>
	<span class="token keyword">default</span><span class="token operator">:</span>
		<span class="token keyword">return</span> <span class="token string">"DEBUG"</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 获取代码行号</span>
func <span class="token function">getinfo</span><span class="token punctuation">(</span>n <span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>fileName<span class="token punctuation">,</span> funcName string<span class="token punctuation">,</span> line <span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">/*
		runtime.Caller()返回四个参数:
		pc: 记录了调用的函数消息，如函数名等
		file: 调用的文件名
		line: 行数
		OK: 返回的bool值
	*/</span>
	pc<span class="token punctuation">,</span> file<span class="token punctuation">,</span> line<span class="token punctuation">,</span> ok <span class="token operator">:</span><span class="token operator">=</span> runtime<span class="token punctuation">.</span><span class="token function">Caller</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
	<span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"runtime.Caller() failed\n"</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	fileName <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">Base</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>
	funcName <span class="token operator">=</span> runtime<span class="token punctuation">.</span><span class="token function">FuncForPC</span><span class="token punctuation">(</span>pc<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Name</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> fileName<span class="token punctuation">,</span> funcName<span class="token punctuation">,</span> line
<span class="token punctuation">}</span>
</code></pre> 
<p>2、调用日志库代码测试</p> 
<ul><li>需要注意，导入mylogger包，是从$GOPATH路径开始的（即从src目录开始的相对路径）</li></ul> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">E<span class="token operator">:</span>\GoProject\src\gitee<span class="token punctuation">.</span>com\LTP\logging</span></span>

package main

<span class="token function">import</span> <span class="token punctuation">(</span>
	<span class="token string">"time"</span>

	mylogger <span class="token string">"gitee.com/mylogger"</span>
<span class="token punctuation">)</span>


func <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	id <span class="token operator">:</span><span class="token operator">=</span> <span class="token number">10</span>
	name <span class="token operator">:</span><span class="token operator">=</span> <span class="token string">"小明"</span>
	flogger <span class="token operator">:</span><span class="token operator">=</span> mylogger<span class="token punctuation">.</span><span class="token function">NewFileLog</span><span class="token punctuation">(</span><span class="token string">"info"</span><span class="token punctuation">,</span> <span class="token string">"./"</span><span class="token punctuation">,</span> <span class="token string">"app.log"</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> <span class="token punctuation">{<!-- --></span>
		flogger<span class="token punctuation">.</span><span class="token function">Warning</span><span class="token punctuation">(</span><span class="token string">"这是个Warning日志"</span><span class="token punctuation">)</span>
		flogger<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">"这是个Error日志,id:%d name:%s"</span><span class="token punctuation">,</span> id<span class="token punctuation">,</span> name<span class="token punctuation">)</span>
		time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0f61e79878e67b297a1c80693d57018e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">IP地址，开放端口，http与https的区别</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9f6a9d4fb702fa759d3ed195fc994931/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">MySQL—事务并发问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>