<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>利用rsync断点续传scp中断的文件传输 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="利用rsync断点续传scp中断的文件传输" />
<meta property="og:description" content="服务器经常需要备份，但是长时间的下载，难免会出现下载中断的情况。
一直使用scp下载备份好的文件，以前数据量少的时候，直接重新下载就可以了。随着网站上数据越来越多，下载的时间越来越长，完全重新开始变得不现实了。有时候下载到90%以上的时候，失败了，完全重传是没有必要的。
我们只需要下载缺失的部分就好了，幸运的是rsync支持这种需求。
具体的做法是将如下的选项组合传递给rsync，-checksum（文件分块计算校验和，只传输校验和不一致的部分），-in-place（将文件原地替换，因为rsync通常会写一个临时文件，然后移动）和-no-whole-file（告诉rsync不要复制整个文件，而是使用deltas（部分传输））。
例如：
$ rsync -Pa --checksum --inplace --no-whole-file --progress remote.server:file local.file
下面是一个真实的例子：
1
2
3
4
5
$ rsync -Pa --checksum --inplace --no-whole-file --progress -e &#39;ssh -p 22&#39; user@www.mobibrw.com:~/backup/wordpress.20181203.tar.gz wordpress.20181203.tar.gz
receiving incremental file list
sent 19 bytes received 76 bytes 0.22 bytes/sec
total size is 8379088896 speedup is 88200935.75
整个过程非常的快，比完全重传快多了。
scp命令拷贝文件非常好用，但在拷贝大文件时存在一个问题就是连接经常会断开，此时再使用scp进行拷贝会重新拷贝文件，为了解决这个问题。我们可以使用rsync命令来进行断点续传。命令如下：
1
$ rsync -P --rsh=ssh xxx.zip 192.168.0.1:~/
为了使用方便可以设置alias:
1
$ alias rscp=&#34;rsync -P --rsh=ssh&#34;
参考链接" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/7a6c46f429175538a5869223d9622fab/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-22T16:55:28+08:00" />
<meta property="article:modified_time" content="2023-05-22T16:55:28+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">利用rsync断点续传scp中断的文件传输</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>服务器经常需要备份，但是长时间的下载，难免会出现下载中断的情况。</p> 
<p>一直使用<code>scp</code>下载备份好的文件，以前数据量少的时候，直接重新下载就可以了。随着网站上数据越来越多，下载的时间越来越长，完全重新开始变得不现实了。有时候下载到<code>90%</code>以上的时候，失败了，完全重传是没有必要的。</p> 
<p>我们只需要下载缺失的部分就好了，幸运的是<code>rsync</code>支持这种需求。</p> 
<p>具体的做法是将如下的选项组合传递给<code>rsync</code>，<code>-checksum</code>（文件分块计算校验和，只传输校验和不一致的部分），<code>-in-place</code>（将文件原地替换，因为<code>rsync</code>通常会写一个临时文件，然后移动）和<code>-no-whole-file</code>（告诉<code>rsync</code>不要复制整个文件，而是使用<code>deltas</code>（部分传输））。</p> 
<p>例如：</p> 
<table><tbody><tr><td> <p>$ rsync -Pa --checksum --inplace --no-whole-file --progress remote.server:file local.file</p> </td></tr></tbody></table> 
<p></p> 
<p>下面是一个真实的例子：</p> 
<p></p> 
<table><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> </td><td> <p>$ rsync -Pa --checksum --inplace --no-whole-file --progress -e 'ssh -p 22' user@www.mobibrw.com:~/backup/wordpress.20181203.tar.gz wordpress.20181203.tar.gz</p> <p></p> <p>receiving incremental file list</p> <p>sent 19 bytes  received 76 bytes  0.22 bytes/sec</p> <p>total size is 8379088896  speedup is 88200935.75</p> </td></tr></tbody></table> 
<p></p> 
<p>整个过程非常的快，比完全重传快多了。</p> 
<p><code>scp</code>命令拷贝文件非常好用，但在拷贝大文件时存在一个问题就是连接经常会断开，此时再使用<code>scp</code>进行拷贝会重新拷贝文件，为了解决这个问题。我们可以使用<code>rsync</code>命令来进行断点续传。命令如下：</p> 
<p></p> 
<table><tbody><tr><td> <p>1</p> </td><td> <p>$ rsync -P --rsh=ssh xxx.zip 192.168.0.1:~/</p> </td></tr></tbody></table> 
<p>为了使用方便可以设置<code>alias</code>:</p> 
<p></p> 
<table><tbody><tr><td> <p>1</p> </td><td> <p>$ alias rscp="rsync -P --rsh=ssh"</p> </td></tr></tbody></table> 
<p></p> 
<p><strong>参考链接</strong></p> 
<hr> 
<ul><li><a href="http://www.voidcn.com/article/p-oghzcxzz-bnz.html" rel="nofollow" title="scp实现断点续传">scp实现断点续传</a></li><li><a href="http://blog.51cto.com/phpervip/1942906" rel="nofollow" title="SCP无法续传, 用rsync 实现Linux远程拷贝（限速和断点续传）">SCP无法续传, 用rsync 实现Linux远程拷贝（限速和断点续传）</a></li><li><a href="https://blog.christophersmart.com/2014/01/15/force-rsync-to-use-delta-transfer-to-fix-corrupt-remote-file/" rel="nofollow" title="Force rsync to use delta transfer to fix corrupt remote file">Force rsync to use delta transfer to fix corrupt remote file</a></li><li><a href="https://www.computerhope.com/unix/rsync.htm" rel="nofollow" title="Linux rsync command">Linux rsync command</a></li><li><a href="https://blog.csdn.net/donglynn/article/details/53997163" title="Rsync使用非ssh默认端口从远程服务器同步文件到本地">Rsync使用非ssh默认端口从远程服务器同步文件到本地</a></li><li><a href="https://www.mobibrw.com/2018/14505" rel="nofollow" title="深海游弋的鱼 – 默默的点滴">深海游弋的鱼 – 默默的点滴</a></li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/64133c1dd913637d879cf63e689efad6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">vue3 封装组件 ——懒加载</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c40c8e677364f7812904e21e69f6cbc1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Gitlab的使用教程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>