<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android Glide简单使用 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Android Glide简单使用" />
<meta property="og:description" content="Glide是谷歌为我们推荐的一个图片加载库。为什么要选择使用Glide呢？
1、代码有人维护，不至于出现问题，项目组都搞不定的时候问题无法解决。（ImageLoader已没人维护了）2、代码简洁，可读性很好。（Fresco是一个非常优秀的库，但是配置稍显麻烦，同时代码风格读起来有些生疏）3、功能强大（400多k的包，包含很多功能，例如：像加载Gif图片就是Picasso做不到的） 下面我们就来介绍下Glide的用法：
Glide的基本使用 导入库 compile &#39;com.github.bumptech.glide:glide:3.7.0&#39; 添加代码混淆（可加可不加） -keep public class * implements com.bumptech.glide.module.GlideModule -keep public enum com.bumptech.glide.load.resource.bitmap.ImageHeaderParser$** { **[] $VALUES; public *; } # for DexGuard only -keepresourcexmlelements manifest/application/meta-data@value=GlideModule 这个别忘了，不要粗心哦，很容易忘得，最简单的问题，往往需要最简单的搞定啦。
&lt;uses-permission android:name=&#34;android.permission.READ_EXTERNAL_STORAGE&#34; /&gt; &lt;uses-permission android:name=&#34;android.permission.INTERNET&#34; /&gt; 简单使用例子 // For a simple view: @Override public void onCreate(Bundle savedInstanceState) { ... ImageView imageView = (ImageView) findViewById(R.id.my_image_view); Glide.with(this).load(&#34;http://goo.gl/gEgYUd&#34;).into(imageView); } // For a simple image list: @Override public View getView(int position, View recycled, ViewGroup container) { final ImageView myImageView; if (recycled == null) { myImageView = (ImageView) inflater." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/1eb5d45439785a5060e3ec6d68d9f124/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-16T10:40:17+08:00" />
<meta property="article:modified_time" content="2023-05-16T10:40:17+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android Glide简单使用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><a href="https://github.com/bumptech/glide">Glide</a>是谷歌为我们推荐的一个图片加载库。为什么要选择使用Glide呢？</p> 
<ul><li>1、代码有人维护，不至于出现问题，项目组都搞不定的时候问题无法解决。（ImageLoader已没人维护了）</li><li>2、代码简洁，可读性很好。（Fresco是一个非常优秀的库，但是配置稍显麻烦，同时代码风格读起来有些生疏）</li><li>3、功能强大（400多k的包，包含很多功能，例如：像加载Gif图片就是Picasso做不到的）</li></ul> 
<p>下面我们就来介绍下Glide的用法：</p> 
<h2><a id="Glide_8"></a>Glide的基本使用</h2> 
<h3><a id="_9"></a>导入库</h3> 
<pre><code class="prism language-groovy">compile <span class="token string">'com.github.bumptech.glide:glide:3.7.0'</span>
</code></pre> 
<h3><a id="_15"></a>添加代码混淆（可加可不加）</h3> 
<pre><code>-keep public class * implements com.bumptech.glide.module.GlideModule
-keep public enum com.bumptech.glide.load.resource.bitmap.ImageHeaderParser$** {
    **[] $VALUES;
    public *;
}

# for DexGuard only
-keepresourcexmlelements manifest/application/meta-data@value=GlideModule
</code></pre> 
<p>这个别忘了，不要粗心哦，很容易忘得，最简单的问题，往往需要最简单的搞定啦。</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.permission.READ_EXTERNAL_STORAGE<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.permission.INTERNET<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> 
<h3><a id="_35"></a>简单使用例子</h3> 
<pre><code class="prism language-java"><span class="token comment">// For a simple view:</span>
<span class="token annotation punctuation">@Override</span> 
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token class-name">ImageView</span> imageView <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ImageView</span><span class="token punctuation">)</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>my_image_view<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Glide</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">"http://goo.gl/gEgYUd"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span>imageView<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// For a simple image list:</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">View</span> <span class="token function">getView</span><span class="token punctuation">(</span><span class="token keyword">int</span> position<span class="token punctuation">,</span> <span class="token class-name">View</span> recycled<span class="token punctuation">,</span> <span class="token class-name">ViewGroup</span> container<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">final</span> <span class="token class-name">ImageView</span> myImageView<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>recycled <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        myImageView <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ImageView</span><span class="token punctuation">)</span> inflater<span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>my_image_view<span class="token punctuation">,</span> container<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        myImageView <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ImageView</span><span class="token punctuation">)</span> recycled<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">String</span> url <span class="token operator">=</span> myUrls<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Glide</span>
        <span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span>myFragment<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">centerCrop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">placeholder</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>loading_spinner<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">crossFade</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span>myImageView<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> myImageView<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="Glide_71"></a>Glide使用详解</h2> 
<h3><a id="_72"></a>加载网络图片</h3> 
<pre><code class="prism language-java"><span class="token class-name">Glide</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>internetUrl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span>targetImageView<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="_78"></a>从文件加载图片</h3> 
<pre><code class="prism language-java"><span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token class-name">Environment</span><span class="token punctuation">.</span><span class="token function">getExternalStoragePublicDirectory</span><span class="token punctuation">(</span><span class="token class-name">Environment</span><span class="token punctuation">.</span>DIRECTORY_PICTURES<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"Test.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Glide</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span>imageViewFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="id_85"></a>从资源id加载图片</h3> 
<pre><code class="prism language-java"><span class="token keyword">int</span> resourceId <span class="token operator">=</span> <span class="token class-name">R</span><span class="token punctuation">.</span>mipmap<span class="token punctuation">.</span>ic_launcher<span class="token punctuation">;</span>
<span class="token class-name">Glide</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>resourceId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span>imageViewResource<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="uri_92"></a>从uri加载图片</h3> 
<pre><code class="prism language-java"><span class="token class-name">Glide</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span>imageViewUri<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="mp4MP4_98"></a>播放本地mp4,只能是本地(获取MP4视频的缩略图）</h3> 
<pre><code class="prism language-java"><span class="token class-name">String</span> filePath <span class="token operator">=</span> <span class="token string">"/storage/emulated/0/Pictures/example_video.mp4"</span><span class="token punctuation">;</span>
<span class="token class-name">Glide</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token class-name">Uri</span><span class="token punctuation">.</span><span class="token function">fromFile</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span>imageViewGifAsBitmap<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="Gif_105"></a>加载Gif图片</h3> 
<pre><code class="prism language-java"><span class="token class-name">String</span> gifUrl <span class="token operator">=</span> <span class="token string">"xxxxx"</span><span class="token punctuation">;</span>
<span class="token class-name">Glide</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>gifUrl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span>imageViewGif<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="bitMapGifasBitmap_112"></a>用bitMap播放Gif.asBitmap()</h3> 
<pre><code class="prism language-java"><span class="token class-name">Glide</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>gifUrl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">asBitmap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span>imageViewGifAsBitmap<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="GifasGif_118"></a>强制转化为Gif.asGif()</h3> 
<pre><code class="prism language-java"><span class="token class-name">Glide</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>gifUrl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">asGif</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>full_cake<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span>imageViewGif<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="placeholder_124"></a>设置默认占位图.placeholder()</h3> 
<h3><a id="error_125"></a>设置加载失败的图片.error()</h3> 
<pre><code class="prism language-java"><span class="token class-name">Glide</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>gifUrl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">placeholder</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>cupcake<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>full_cake<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span>imageViewGif<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="fallback_131"></a>.fallback()</h3> 
<p>除了上面两种‘异常情况’，还有一种情形就是打开手机的通讯录的时候，可以看到你给有些喜欢的人设置了照片，然而有些可怜的人并没给有，总不能在那里留下一片空白吧，这个时候相当于传递了Null,传递null时，这个callback方法就会被调用。</p> 
<pre><code class="prism language-java"><span class="token class-name">Glide</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token comment">//加载空指针的时候</span>
    <span class="token punctuation">.</span><span class="token function">fallback</span><span class="token punctuation">(</span> <span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>wuyanzu<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span> imageViewNoFade <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="_142"></a>设置加载动画</h3> 
<p>其实这个是默认的，但是你还是可以写出来,渐显动画</p> 
<p>1、<code>.crossFade()</code> ：Glide提供淡如淡出</p> 
<pre><code class="prism language-java"><span class="token class-name">Glide</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">placeholder</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>mipmap<span class="token punctuation">.</span>ic_launcher<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>mipmap<span class="token punctuation">.</span>future_studio_launcher<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">crossFade</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span>imageViewFade<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这里还有一个<code>.fadeFade(int duration)</code>，设置动画时间。如果你不想要动画可以加上<code>.dontAnimate()</code></p> 
<p>2、<code>.animate(android.R.anim.slide_in_left)</code>：Android系统提供，从左到右滑出加载动画</p> 
<h3><a id="resizeint_int__155"></a>调整图片大小.resize(int ,int )</h3> 
<p>单位是像素，裁剪你的图片大小。其实Glide已经会自动根据你<code>ImageView</code>裁剪照片来放在缓存中了。但是不想适应<code>ImageView</code>大小的时候，可以调用这个方法<code>.override()</code>为<code>ImageView</code>指定大小。</p> 
<pre><code class="prism language-java"><span class="token class-name">Glide</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">override</span><span class="token punctuation">(</span><span class="token number">600</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span>imageViewResize<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="fitCenterCenterCrop_163"></a>裁剪图片.fitCenter()和.CenterCrop()</h3> 
<p>Glide清楚在合适的<code>ImageView</code>中加载合适的Image.当需要裁剪大小时，有个<code>.centerCrop</code>方法，这个方法的裁剪会让你的<code>ImageView</code>周围不会留白，还有一个<code>.fitCenter()</code>方法，表示让你的Image完全显示，尺寸不对时，周围会留白。</p> 
<h3><a id="thumbnail_167"></a>设置缩略图.thumbnail()</h3> 
<p><code>.thumbnail()</code>方法的目的就是让用户先看到一个低解析度的图，点开后，再加载一个高解析度的图。</p> 
<pre><code class="prism language-java"><span class="token comment">//表示为原图的十分之一</span>
<span class="token class-name">Glide</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thumbnail</span><span class="token punctuation">(</span><span class="token number">0.1f</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span> imageView2 <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>一种更高级的缩略图加载方式：</strong></p> 
<p>当缩略图也需要通过网络加载全部解析度的时候。</p> 
<pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">loadImageThumbnailRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">DrawableRequestBuilder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> thumbnailRequest <span class="token operator">=</span> <span class="token class-name">Glide</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>eatFoodyImages<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Glide</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token class-name">UsageExampleGifAndVideos</span><span class="token punctuation">.</span>gifUrl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thumbnail</span><span class="token punctuation">(</span>thumbnailRequest<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span>imageView3<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="bitmapTransform_187"></a>设置图片显示效果（圆角、圆形、高斯模糊、蒙板、裁剪等等）.bitmapTransform（）</h3> 
<pre><code class="prism language-java"><span class="token class-name">Glide</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>mipmap<span class="token punctuation">.</span>ic_image_sample<span class="token punctuation">)</span>
    <span class="token comment">//模糊</span>
    <span class="token punctuation">.</span><span class="token function">bitmapTransform</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BlurTransformation</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">//圆角</span>
    <span class="token punctuation">.</span><span class="token function">bitmapTransform</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RoundedCornersTransformation</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token class-name">RoundedCornersTransformation<span class="token punctuation">.</span>CornerType</span><span class="token punctuation">.</span>ALL<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">//遮盖</span>
    <span class="token punctuation">.</span><span class="token function">bitmapTransform</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MaskTransformation</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">.</span>mipmap<span class="token punctuation">.</span>ic_launcher<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">//灰度</span>
    <span class="token punctuation">.</span><span class="token function">bitmapTransform</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GrayscaleTransformation</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">//圆形</span>
    <span class="token punctuation">.</span><span class="token function">bitmapTransform</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CropCircleTransformation</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span>mResultIv<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>除此之外还有实现诸如马赛克、明暗度等更多滤镜处理：</p> 
<ul><li>ToonFilterTransformation</li><li>SepiaFilterTransformation</li><li>ContrastFilterTransformation</li><li>InvertFilterTransformation</li><li>PixelationFilterTransformation</li><li>SketchFilterTransformation</li><li>SwirlFilterTransformation</li><li>BrightnessFilterTransformation</li><li>KuwaharaFilterTransformation</li><li>VignetteFilterTransformation</li></ul> 
<h3><a id="Glide_217"></a>Glide的缓存</h3> 
<p>用过手机的都知道，当划上划下一个<code>ListView</code>的时候，第二次都比第一次快，就是因为为<code>GlideView</code>对资源进行了缓存，而且封装的很好，甚至不需要自己去设定缓存大小，Glide会智能地自己给我们根据设备设置缓存大小。</p> 
<p>缓存是为了减少或者杜绝多的网络请求。为了避免缓存，Glide用了内存缓存和‘外存缓存机制’,并且 提供了相应的方法，完全封装，不需要处理细节。Glide会自动缓存到内存，除非调用<code>.skipMemoryCache( true )</code>。尽管调用了这个，Glide还是会缓存到外存，还有一种情形，就是有一张图片，但是这张图变化非常快，这个时候可能并不想缓存到外存中，就使用<code>.diskCacheStrategy( DiskCacheStrategy.NONE )</code>。如果你两种都不需要，可以两个方法组合着一起使用。</p> 
<p><strong>自定义外存缓存机制</strong></p> 
<p>Glide默认会缓存Image的很多个版本，比如原图，如果你的<code>imageView</code>大小的缓存。<code>.diskCacheStrategy()</code>有以下几种缓存策略：</p> 
<ul><li><code>DiskCacheStrategy.NONE</code> 什么都不缓存</li><li><code>DiskCacheStrategy.SOURCE</code> 只缓存最高解析图的image</li><li><code>DiskCacheStrategy.RESULT</code> 缓存最后一次那个image,比如有可能你对image做了转化</li><li><code>DiskCacheStrategy.ALL</code> image的所有版本都会缓存</li></ul> 
<pre><code class="prism language-java"><span class="token class-name">Glide</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">diskCacheStrategy</span><span class="token punctuation">(</span><span class="token class-name">DiskCacheStrategy</span><span class="token punctuation">.</span>SOURCE<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span>imageViewFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>修改缓存大小、位置、加载图片质量</strong></p> 
<p>和指定<code>HttpClent</code>为<code>OkHttp</code>一样，只不过我们需要配置一些信息在<code>applyOptions()</code>函数里面</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GlideConfigModule</span> <span class="token keyword">implements</span> <span class="token class-name">GlideModule</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">applyOptions</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">GlideBuilder</span> builder<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 指定位置在packageName/cache/glide_cache,大小为MAX_CACHE_DISK_SIZE的磁盘缓存</span>
        builder<span class="token punctuation">.</span><span class="token function">setDiskCache</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InternalCacheDiskCacheFactory</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token string">"glide_cache"</span><span class="token punctuation">,</span> <span class="token class-name">ConfigConstants</span><span class="token punctuation">.</span>MAX_CACHE_DISK_SIZE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//指定内存缓存大小</span>
        builder<span class="token punctuation">.</span><span class="token function">setMemoryCache</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LruResourceCache</span><span class="token punctuation">(</span><span class="token class-name">ConfigConstants</span><span class="token punctuation">.</span>MAX_CACHE_MEMORY_SIZE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//全部的内存缓存用来作为图片缓存</span>
        builder<span class="token punctuation">.</span><span class="token function">setBitmapPool</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LruBitmapPool</span><span class="token punctuation">(</span><span class="token class-name">ConfigConstants</span><span class="token punctuation">.</span>MAX_CACHE_MEMORY_SIZE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        builder<span class="token punctuation">.</span><span class="token function">setDecodeFormat</span><span class="token punctuation">(</span><span class="token class-name">DecodeFormat</span><span class="token punctuation">.</span>PREFER_ARGB_8888<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//和Picasso配置一样</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">registerComponents</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">Glide</span> glide<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta-data</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.imageloadpk.adapter.config.GlideConfigModule<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>GlideModule<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre> 
<p>一般的图片加载框架设置了磁盘缓存和内存缓存就行了，但是Glide还设置了一个图片缓存。<br> 图片缓存 &lt;= 内存缓存</p> 
<pre><code class="prism language-java">builder<span class="token punctuation">.</span><span class="token function">setDiskCache</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InternalCacheDiskCacheFactory</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token string">"glide_cache"</span><span class="token punctuation">,</span> <span class="token class-name">ConfigConstants</span><span class="token punctuation">.</span>MAX_CACHE_DISK_SIZE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//指定内存缓存大小</span>
        builder<span class="token punctuation">.</span><span class="token function">setMemoryCache</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LruResourceCache</span><span class="token punctuation">(</span><span class="token class-name">ConfigConstants</span><span class="token punctuation">.</span>MAX_CACHE_MEMORY_SIZE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//全部的内存缓存用来作为图片缓存</span>
        builder<span class="token punctuation">.</span><span class="token function">setBitmapPool</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LruBitmapPool</span><span class="token punctuation">(</span><span class="token class-name">ConfigConstants</span><span class="token punctuation">.</span>MAX_CACHE_MEMORY_SIZE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这里Glide不仅可以缓存图片，还可以缓存其他文件譬如视频之类，也就是说可以把他作为我们的缓存工具来使用，当然缓存方式还是使用LRU。这样我们就不必再去重新集成<code>LruCache</code>和<code>DiskLruCache</code>，再去申请空间，配置。直接可以复用Glide的。</p> 
<p><strong>使用缓存也加载动画</strong></p> 
<p>但是，动画默认是在图片没有缓存的情况下才加载，想想也是合理的，如果图片已近下载到本地加载速度将会非常快，这个时候使用动画过渡反而碍事。要让从缓存中图片呈现也加载动画不能通过这种方式实现，可以用监听器来做。</p> 
<pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token class-name">RequestListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">GlideBitmapDrawable</span><span class="token punctuation">&gt;</span></span> mAnimationRequestListener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RequestListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">GlideBitmapDrawable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onException</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">,</span> <span class="token class-name">String</span> model<span class="token punctuation">,</span> <span class="token class-name">Target</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GlideBitmapDrawable</span><span class="token punctuation">&gt;</span></span> target<span class="token punctuation">,</span> <span class="token keyword">boolean</span> isFirstResource<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onResourceReady</span><span class="token punctuation">(</span><span class="token class-name">GlideBitmapDrawable</span> resource<span class="token punctuation">,</span> <span class="token class-name">String</span> model<span class="token punctuation">,</span> <span class="token class-name">Target</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GlideBitmapDrawable</span><span class="token punctuation">&gt;</span></span> target<span class="token punctuation">,</span> <span class="token keyword">boolean</span> isFromMemoryCache<span class="token punctuation">,</span> <span class="token keyword">boolean</span> isFirstResource<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">dissProgress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>isFromMemoryCache<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//如果是从缓存加载，设置动画效果</span>
                mIvShow<span class="token punctuation">.</span><span class="token function">setAnimation</span><span class="token punctuation">(</span><span class="token class-name">AnimationUtils</span><span class="token punctuation">.</span><span class="token function">loadAnimation</span><span class="token punctuation">(</span>mContext<span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">.</span>anim<span class="token punctuation">.</span>scale<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//返回true表示拦截不再传递，false表示事件会传递下去</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="priority_301"></a>请求优先级.priority()</h3> 
<p>加载图片肯定也是有先后顺序，Glide提供了<code>.priority()</code>这个方法，它接收以下几个参数：</p> 
<ul><li><code>Priority.LOW</code></li><li><code>Priority.NORMAL</code></li><li><code>Priority.HIGH</code></li><li><code>Priority.IMMEDIATE</code></li></ul> 
<p>但是Glide并不一定会按照你的顺序来，只是尽量按照你的顺序来。（比如给一张很大的图片最高的优先权，但是它并不一定比低优先级的图先加载出来，这个时候只有使用缩略图了）</p> 
<pre><code class="prism language-java"><span class="token class-name">Glide</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span>mContext<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token class-name">Url</span><span class="token punctuation">.</span>IMAGE_URL_TROCHILIDAE<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">priority</span><span class="token punctuation">(</span><span class="token class-name">Priority</span><span class="token punctuation">.</span>HIGH<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span>mIvTonyRight<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="callback_316"></a>利用callback在非标准情况下加载图片</h3> 
<p>上面所有的情况都是加载图片到<code>ImageView</code>中，但是并不是所有的情况都是这样。譬如加载的控件类型不是<code>ImageView</code>，是个自定义的布局。或者加载为<code>Background</code>的形式。<br> 可以使用<code>SimpleTarget</code>类型，这里指定他的大小为500*100，加载为背景图片</p> 
<pre><code class="prism language-java"><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SimpleTarget</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Drawable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onResourceReady</span><span class="token punctuation">(</span><span class="token class-name">Drawable</span> resource<span class="token punctuation">,</span> <span class="token class-name">GlideAnimation</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">Drawable</span><span class="token punctuation">&gt;</span></span> glideAnimation<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        mBtnClear<span class="token punctuation">.</span><span class="token function">setBackground</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>同理下载图片原理是一样</p> 
<pre><code class="prism language-java"><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SimpleTarget</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Bitmap</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onResourceReady</span><span class="token punctuation">(</span><span class="token class-name">Bitmap</span> resource<span class="token punctuation">,</span> <span class="token class-name">GlideAnimation</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">Bitmap</span><span class="token punctuation">&gt;</span></span> glideAnimation<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//toSave</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"onResourceReady: save successful"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>Glide中的回调：Targets</strong></p> 
<p>从上面的介绍，已经可以看出Glide内部封装了所有的细节，什么网络请求，什么缓存机制，当所有都就绪过后，自动切换回UI线程，更新<code>ImageView</code>。Targets就是Glide中的回调，当异步线程中所有的工作做完过后返回结果。说白了就是，当请求图片完成后，需要回调的方法。</p> 
<p><strong>SimpleTarget</strong></p> 
<pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token class-name">SimpleTarget</span> target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleTarget</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Bitmap</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onResourceReady</span><span class="token punctuation">(</span><span class="token class-name">Bitmap</span> bitmap<span class="token punctuation">,</span> <span class="token class-name">GlideAnimation</span> glideAnimation<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// do something with the bitmap</span>
        <span class="token comment">// for demonstration purposes, let's just set it to an ImageView</span>
        imageView1<span class="token punctuation">.</span><span class="token function">setImageBitmap</span><span class="token punctuation">(</span> bitmap <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">loadImageSimpleTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">Glide</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span> context <span class="token punctuation">)</span> <span class="token operator">*</span><span class="token comment">// could be an issue!*</span>
            <span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span> eatFoodyImages<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">asBitmap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//强制Glide返回一个Bitmap</span>
            <span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span> target <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>注意事项：</strong></p> 
<p>1、上面这段代码不要写成匿名内部类的机制，原因就是java的自动垃圾回收机制可能在图片还没有加载好的时候就已经把你的Target回收了。</p> 
<p>2、注意<code>.with()</code>里面的参数，Glide的请求是和传进去的<code>Context</code>共存亡的，如果传一个<code>Activity</code>进去，当<code>Activity GC</code>过后，你的请求也就GC了，但是如果这样传：<code>.with(context.getApplicationContext() )</code>.当你的<code>Activity GC</code>过后，请求还是会继续，回调还是会继续。</p> 
<p><strong>有size的Target</strong></p> 
<p>如果传给<code>into().</code>的是一个<code>ImageView</code>,但是图片的size比<code>ImageView</code>的Size大，Glide为了节省时间，会加载小的那个size的Image。但是这对Target并不适用，以为这里并不知道size。但是如果知道image应该多大，可以传递给Target.就像下面这样：</p> 
<pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token class-name">SimpleTarget</span> target2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleTarget</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Bitmap</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span> <span class="token number">250</span><span class="token punctuation">,</span> <span class="token number">250</span> <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onResourceReady</span><span class="token punctuation">(</span><span class="token class-name">Bitmap</span> bitmap<span class="token punctuation">,</span> <span class="token class-name">GlideAnimation</span> glideAnimation<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        imageView2<span class="token punctuation">.</span><span class="token function">setImageBitmap</span><span class="token punctuation">(</span> bitmap <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">loadImageSimpleTargetApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">Glide</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">getApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">*</span><span class="token comment">// safer!*</span>
         <span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span> eatFoodyImages<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
         <span class="token punctuation">.</span><span class="token function">asBitmap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
         <span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span> target2 <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>ViewTarget</strong></p> 
<p>适用于想Glide加载到自定义<code>View</code>中去，</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FutureStudioView</span> <span class="token keyword">extends</span> <span class="token class-name">FrameLayout</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">ImageView</span> iv<span class="token punctuation">;</span>
    <span class="token class-name">TextView</span> tv<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">nitialize</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">inflate</span><span class="token punctuation">(</span> context<span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>custom_view_futurestudio<span class="token punctuation">,</span> <span class="token keyword">this</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
        iv <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ImageView</span><span class="token punctuation">)</span> <span class="token function">findViewById</span><span class="token punctuation">(</span> <span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>custom_view_image <span class="token punctuation">)</span><span class="token punctuation">;</span>
        tv <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">TextView</span><span class="token punctuation">)</span> <span class="token function">findViewById</span><span class="token punctuation">(</span> <span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>custom_view_text <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">FutureStudioView</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">AttributeSet</span> attrs<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">(</span> context<span class="token punctuation">,</span> attrs <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">initialize</span><span class="token punctuation">(</span> context <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">FutureStudioView</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span><span class="token class-name">AttributeSet</span> attrs<span class="token punctuation">,</span><span class="token keyword">int</span> defStyleAttr<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">(</span> context<span class="token punctuation">,</span> attrs<span class="token punctuation">,</span> defStyleAttr <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">initialize</span><span class="token punctuation">(</span> context <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setImage</span><span class="token punctuation">(</span><span class="token class-name">Drawable</span> drawable<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        iv <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ImageView</span><span class="token punctuation">)</span> <span class="token function">findViewById</span><span class="token punctuation">(</span> <span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>custom_view_image <span class="token punctuation">)</span><span class="token punctuation">;</span>
        iv<span class="token punctuation">.</span><span class="token function">setImageDrawable</span><span class="token punctuation">(</span> drawable <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>还有<code>notificationTarget</code>和<code>AppWidget</code>作为扩展自行研究喽。</p> 
<h3><a id="listener_425"></a>监听器配置.listener()</h3> 
<pre><code class="prism language-java"><span class="token class-name">Glide</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">listener</span><span class="token punctuation">(</span>mRequestListener<span class="token punctuation">)</span><span class="token comment">//配置监听器</span>
    <span class="token punctuation">.</span><span class="token function">placeholder</span><span class="token punctuation">(</span><span class="token class-name">Drawables</span><span class="token punctuation">.</span>sPlaceholderDrawable<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">Drawables</span><span class="token punctuation">.</span>sErrorDrawable<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span>mImageView<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">private</span> <span class="token class-name">RequestListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">GlideDrawable</span><span class="token punctuation">&gt;</span></span> mRequestListener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RequestListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">GlideDrawable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onException</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">,</span> <span class="token class-name">String</span> model<span class="token punctuation">,</span> <span class="token class-name">Target</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GlideDrawable</span><span class="token punctuation">&gt;</span></span> target<span class="token punctuation">,</span> <span class="token keyword">boolean</span> isFirstResource<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//显示错误信息</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"onException: "</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//打印请求URL</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"onException: "</span> <span class="token operator">+</span> model<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//打印请求是否还在进行</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"onException: "</span> <span class="token operator">+</span> target<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isRunning</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onResourceReady</span><span class="token punctuation">(</span><span class="token class-name">GlideDrawable</span> resource<span class="token punctuation">,</span> <span class="token class-name">String</span> model<span class="token punctuation">,</span> <span class="token class-name">Target</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GlideDrawable</span><span class="token punctuation">&gt;</span></span> target<span class="token punctuation">,</span> <span class="token keyword">boolean</span> isFromMemoryCache<span class="token punctuation">,</span> <span class="token keyword">boolean</span> isFirstResource<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>这里的<code>onException</code>捕获异常，如果返回<code>true</code>表示我们自己处理掉了异常，<code>false</code>表示交给Glide去处理，因为我们定义了<code>.error()</code>那么就显示<code>error</code>里面的内容。</p> 
<p>这里<code>onResourceReady</code>表示是否准备资源显示，返回<code>true</code>表示用户自己已经设置好资源，包括截取操作，动画操作之类的，准备好显示。<code>false</code>表示交给Glide</p> 
<p>如此修改后，就能够看到图片加载日志了，方便我们调试</p> 
<h3><a id="HttpClient_459"></a>替换掉自带的HttpClient</h3> 
<p><strong>只需两步</strong><br> <strong>Step1：</strong></p> 
<p>导入需要替换的<code>HttpClient</code>，可以选择Volley也可以选择OkHttp，我们使用Okhttp，在Module的<code>build.gradle</code>文件中配置</p> 
<pre><code class="prism language-groovy">dependencies <span class="token punctuation">{<!-- --></span>
    compile <span class="token string">'com.github.bumptech.glide:okhttp3-integration:1.4.0@aar'</span>
    compile <span class="token string">'com.squareup.okhttp3:okhttp:3.3.1'</span>

    or

    compile <span class="token string">'com.github.bumptech.glide:volley-integration:1.4.0@aar'</span>
    compile <span class="token string">'com.mcxiaoke.volley:library:1.0.8'</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>这个版本具体选择多少，可以在<a href="https://github.com/bumptech/glide/wiki/Integration-Libraries">https://github.com/bumptech/glide/wiki/Integration-Libraries</a>这里查询到</p> 
<p><strong>Step2：</strong></p> 
<p>在<code>AndroidMainfest.xml</code>文件中写入</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta-data</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.bumptech.glide.integration.okhttp3.OkHttpGlideModule<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>GlideModule<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre> 
<p>你可能会有和我一样的疑问，Glide可以通过在配置清单里面配置<br> 能不能写几个meta-data标签，一个标签里面配置一点参数<br> 经过测试，发现这样做也是可以的。但是如果是同一种配置信息，比如你集成了OkHttp，又写一个标签集成Volley，最后一个会把前面的覆盖掉。</p> 
<h3><a id="_492"></a>注意事项</h3> 
<p>1、前面我们已经学习到<code>asGif（）</code>可以加载gif图，<code>asBitmap()</code>可以加载静态gif图即gif图的第一帧，如果非gif图用<code>asGif（）</code>方法加载呢？这时候会报错。。Glide默认可以自动识别图片格式，加载gif图，所以在不确定图片格式的情况下，不要直接写asGif哦。</p> 
<p>2、<code>You cannot start a load for a destroyed activity</code>这样的异常如何处理？<br> 记住不要再非主线程里面使用Glide加载图片，如果真的使用了，请把<code>context</code>参数换成<code>getApplicationContext</code>。希望可以帮你避免这个问题。</p> 
<p>3、为什么有的图片第一次加载的时候只显示占位图，第二次才显示正常的图片呢？<br> .如果你刚好使用了这个圆形<code>Imageview</code>库或者其他的一些自定义的圆形<code>Imageview</code>，而你又刚好设置了占位的话，那么，你就会遇到第一个问题。如何解决呢？</p> 
<p>方案一: 不设置占位；<br> 方案二：使用Glide的Transformation API自定义圆形<code>Bitmap</code>的转换。这里是一个已有的例子；<br> 方案三：使用下面的代码加载图片：</p> 
<pre><code class="prism language-java"><span class="token class-name">Glide</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span>mContext<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span> 
    <span class="token punctuation">.</span><span class="token function">placeholder</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>loading_spinner<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SimpleTarget</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Bitmap</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>width<span class="token punctuation">,</span> height<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token annotation punctuation">@Override</span> 
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onResourceReady</span><span class="token punctuation">(</span><span class="token class-name">Bitmap</span> bitmap<span class="token punctuation">,</span> <span class="token class-name">GlideAnimation</span> anim<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// setImageBitmap(bitmap) on CircleImageView </span>
        <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>4、图片大小拉伸问题<br> 有时候你会发现网络加载完了之后会有拉伸现象，而你的控件大小明明是自适应的呀，这是为什么呢，请你检查下你是否设置了占位图，有的话请去掉就ok了。</p> 
<p>简单总结一下，我这里讲了Glide比较全面的用法，有如何加载图片，Glide的缓冲设置，Glide设置圆角，Glide设置图片的background，Glide加载GIF图片等，大家使用的话一般了解加载图片和圆角图片就可以了。这里在列举一下。</p> 
<pre><code class="prism language-java"><span class="token comment">//圆形裁剪</span>
<span class="token class-name">Glide</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">"http://inthecheesefactory.com/uploads/source/nestedfragment/fragments.png"</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">bitmapTransform</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CropCircleTransformation</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span>iv_0<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//圆角处理</span>
<span class="token class-name">Glide</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">"http://inthecheesefactory.com/uploads/source/nestedfragment/fragments.png"</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">bitmapTransform</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RoundedCornersTransformation</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token class-name">RoundedCornersTransformation<span class="token punctuation">.</span>CornerType</span><span class="token punctuation">.</span>ALL<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span>iv_0<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>android Glide简单使用就讲完了。</p> 
<p>就这么简单。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/15bc54f5e13aa6245597db1b7dd8535f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">基于STM32F1系列与阿里云的物联网节点</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/96980e87e601ed404be43f9b9c7887f8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【数字IC基础】跨时钟域（CDC，Clock Domain Crossing）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>