<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android源码编译流程及所需的编译环境 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Android源码编译流程及所需的编译环境" />
<meta property="og:description" content="编译过程： 下载源码-&gt;搭建编译环境-&gt;编译源码-&gt;解决编译报错-&gt;生成编译固件包
编译环境 本文使用的是下载好的Android8.1源码，搭建好的虚拟机Ubuntu14.0/Ubuntu16.0（建议分配300G及以上的内存）
下载git
sudo apt-get install git 配置自己的user.name及user.email
git config --global user.email “fys@163.com” git config --global user.name “fys” 下载jdk1.8
sudo add-apt-repository ppa:openjdk-r/ppa sudo apt-get update sudo apt-get install openjdk-8-jdk 开始编译 进入android源码目录初始化编译环境 source build/envsetup.sh 初始化完成之后执行lunch选择编译目标 lunch 输入想要编译的目标号即可
这里如果是自己兴趣开发使用，随便玩玩一般选择1或2即可
开发人员需要自行选择自己项目具体的编译目标
make开启编译 通过make指令进行代码编译,该指令通过-j参数来设置参与编译的线程数量,以提高编译速度
make -j4 &gt;build.log &gt;build.log 代表输出编译日志可以在源码根目录直接查到，编译过程中的报错可以在log中查找
解决编译报错 编译报错一般会在命令行最后提示如下：
[0;31m#### failed to build some targets (11:11 (mm:ss)) ####[00m 报错1：/bin/bash: m4: command not found 解决方法：
sudo apt-get install m4 报错2： /bin/bash: xmllint: command not found 解决方法：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/37fd61aacc704557a3b28b717c4ae773/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-16T20:59:59+08:00" />
<meta property="article:modified_time" content="2023-03-16T20:59:59+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android源码编译流程及所需的编译环境</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="kdocs-document"> 
 <h2 style=""><span class="kdocs-bold" style="font-weight:bold;">编译过程：</span></h2> 
 <p style=""><span class="kdocs-fontSize" style="font-size:13pt;">下载源码-&gt;搭建编译环境-&gt;编译源码-&gt;解决编译报错-&gt;生成编译固件包</span></p> 
 <ol start="1"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;"><h3><span class="kdocs-bold" style="font-weight:bold;">编译环境</span></h3></li></ol> 
 <p style="">本文使用的是下载好的Android8.1源码，搭建好的虚拟机Ubuntu14.0/Ubuntu16.0（建议分配300G及以上的内存）</p> 
 <p style="">下载git</p> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">sudo apt-get install git</code></pre> 
 <p style="">配置自己的user.name及user.email</p> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">git config --global user.email “fys@163.com” 
git config --global user.name “fys”</code></pre> 
 <p style="">下载jdk1.8</p> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">sudo add-apt-repository ppa:openjdk-r/ppa
sudo apt-get update
sudo apt-get install openjdk-8-jdk   </code></pre> 
 <ol start="2"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;"><h3>开始编译</h3></li></ol> 
 <ol start="1"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;"><h4><span class="kdocs-bold" style="font-weight:bold;">进入android源码目录初始化编译环境</span></h4></li></ol> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">source build/envsetup.sh</code></pre> 
 <ol start="2"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;"><h4><span class="kdocs-bold" style="font-weight:bold;">初始化完成之后执行lunch选择编译目标</span></h4></li></ol> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">lunch </code></pre> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:377px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:124.933685%;height:0;"> 
    <img src="https://images2.imgbox.com/4e/24/eqGvgGkr_o.png" style="margin-left:;display:block;width:377px;margin-top:-124.933685%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">输入想要编译的目标号即可</p> 
 <p style="">这里如果是自己兴趣开发使用，随便玩玩一般选择1或2即可</p> 
 <p style="">开发人员需要自行选择自己项目具体的编译目标</p> 
 <ol start="3"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;"><h4><span class="kdocs-bold" style="font-weight:bold;">make开启编译</span></h4></li></ol> 
 <p style="">通过make指令进行代码编译,该指令通过<span class="kdocs-fontSize" style="font-size:9pt;">-j</span>参数来设置参与编译的线程数量,以提高编译速度</p> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">make -j4 &gt;build.log</code></pre> 
 <p style="">&gt;build.log 代表输出编译日志可以在源码根目录直接查到，编译过程中的报错可以在log中查找</p> 
 <p style=""></p> 
 <ol start="4"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;"><h4><span class="kdocs-bold" style="font-weight:bold;">解决编译报错</span></h4></li></ol> 
 <p style="">编译报错一般会在命令行最后提示如下：</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:782px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:21.483376%;height:0;"> 
    <img src="https://images2.imgbox.com/53/f4/4whxThwi_o.png" style="margin-left:;display:block;width:782px;margin-top:-21.483376%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <blockquote class="kdocs-blockquote" style="">
   [0;31m#### failed to build some targets (11:11 (mm:ss)) ####[00m 
 </blockquote> 
 <h5 style="">报错1：/bin/bash: m4: command not found</h5> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:963px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:40.3946%;height:0;"> 
    <img src="https://images2.imgbox.com/00/33/kBiqq2S8_o.png" style="margin-left:;display:block;width:963px;margin-top:-40.3946%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">解决方法：</p> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">sudo apt-get install m4</code></pre> 
 <h5 style="">报错2： /bin/bash: xmllint: command not found</h5> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:730px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:36.301373%;height:0;"> 
    <img src="https://images2.imgbox.com/16/61/Da0zmV19_o.png" style="margin-left:;display:block;width:730px;margin-top:-36.301373%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">解决方法：</p> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">sudo apt-get install libxml2-utils</code></pre> 
 <h5 style="">报错3：SSL error when connecting to the Jack server. Try ‘jack-diagnose‘</h5> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:1175px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:19.148935%;height:0;"> 
    <img src="https://images2.imgbox.com/34/66/JegfbmlV_o.png" style="margin-left:;display:block;width:1175px;margin-top:-19.148935%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">解决方法：</p> 
 <ol start="1"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;"><p>从 /etc/java-8-openjdk/security/java.security中删除TLSv1, TLSv1.1 </p></li></ol> 
 <p style="">一般要重写java.security文件，这个文件赋予最高权限也无法修改保存</p> 
 <p style="">这里给出的解决方法是在java.security文件中删除TLSv1, TLSv1.1之后另保存为，取代原先的文件</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:861px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:67.479675%;height:0;"> 
    <img src="https://images2.imgbox.com/74/20/z6WeUHqB_o.png" style="margin-left:;display:block;width:861px;margin-top:-67.479675%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""></p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:651px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:81.2596%;height:0;"> 
    <img src="https://images2.imgbox.com/3b/30/wvDD363x_o.png" style="margin-left:;display:block;width:651px;margin-top:-81.2596%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">2、删除完成之后回到源码根目录下执行：</p> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">./prebuilts/sdk/tools/jack-admin kill-server
./prebuilts/sdk/tools/jack-admin start-server</code></pre> 
 <h5 style="">报错4：Out of memory error (version 1.3-rc7 'Douarn' (445000 d7be3910514558d6715ce455ce0861ae2f56925a by <a class="kdocs-link" style="color:#0A6CFF;" href="mailto:android-jack-team@google.com" rel="nofollow noopener noreferrer" target="_blank">android-jack-team@google.com</a>)).</h5> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:1363px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:20.616287%;height:0;"> 
    <img src="https://images2.imgbox.com/ae/94/DJvdoyA0_o.png" style="margin-left:;display:block;width:1363px;margin-top:-20.616287%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">解决方法：</p> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">export JACK_SERVER_VM_ARGUMENTS="-Dfile.encoding=UTF-8 -XX:+TieredCompilation -Xmx4g"
./prebuilts/sdk/tools/jack-admin kill-server
./prebuilts/sdk/tools/jack-admin start-server</code></pre> 
 <h5 style="">报错5：/bin/bash: prebuilts/misc/linux-x86/bison/bison: No such file or directory</h5> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:1022px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:22.798433%;height:0;"> 
    <img src="https://images2.imgbox.com/b8/94/owINmPt6_o.png" style="margin-left:;display:block;width:1022px;margin-top:-22.798433%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">解决方法：</p> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">sudo apt-get install g++-multilib
sudo apt-get install gcc-multilib
sudo apt-get install lib32ncurses5-dev
sudo apt-get install lib32readline-gplv2-dev
sudo apt-get install lib32z1-dev</code></pre> 
 <h3 style="">编译成功</h3> 
 <p style="">terminal上编译显示如图即表示编译完成</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:722px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:60.94183%;height:0;"> 
    <img src="https://images2.imgbox.com/1b/0b/ianUMRxL_o.png" style="margin-left:;display:block;width:722px;margin-top:-60.94183%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">查看log，显示如下即表示编译成功</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:850px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:29.882353%;height:0;"> 
    <img src="https://images2.imgbox.com/0f/d2/FJN5YIR6_o.png" style="margin-left:;display:block;width:850px;margin-top:-29.882353%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""></p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cb2b9d0001590e27634b46778ce2ab34/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【已解决】Android Studio模拟器没有网络【can‘t provider internet / no internet】 问题--20230316</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9448f93f637b40891c7f992d043513f0/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">最新版mysql-8.0.32-winx64安装及配置</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>