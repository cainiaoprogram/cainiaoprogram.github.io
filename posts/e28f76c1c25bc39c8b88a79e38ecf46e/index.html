<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>微信支付-Native支付（网页二维码扫码微信支付）简单示例 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="微信支付-Native支付（网页二维码扫码微信支付）简单示例" />
<meta property="og:description" content="目录
概述
界面展示 &amp; 前端代码（Vue）
后端实现（SpringBoot）
Maven依赖 下单接口（主要功能代码）
支付成功回调接口
测试（后端线上环境）
概述 本篇博文主要演示和说明网页扫码实现微信支付的功能。
Native支付？
Native支付是指商户系统按微信支付协议生成支付二维码，用户再用微信“扫一扫”完成支付的模式。
使用前提？
已注册成为微信商户，在微信商户平台开通&#34;Native支付&#34;，获取API证书和API密匙等参数，如果对于注册微信商户有所疑惑，请看博文：http://t.csdn.cn/BCecm，博文有讲解从零到商户的注册过程要求说明。
主要流程概述
Native支付的流程很简单，主要为：
1.前端传入金额等参数。
2.后端拿着参数向微信服务器创建预支付订单，取回一个支付地址，传回前端。
3.前端拿着支付地址生成二维码，微信扫码完成支付。
界面展示 &amp; 前端代码（Vue） 关于支付地址转为二维码
在此使用的是QRCode，使用方式很简单，导入，声明二维码放置节点元素，实例化QRCode生成二维码。具体使用方式看示例代码，或文档地址：
github地址
中文使用说明地址
js文件地址
输入金额，点击&#34;捐助&#34;，调用后端接口获取支付地址，生成支付二维码。
&lt;template&gt; &lt;div id=&#34;container&#34;&gt; &lt;!-- 图片 --&gt; &lt;div id=&#34;imgJuan&#34;&gt;&lt;/div&gt; &lt;!-- 表单 --&gt; &lt;div id=&#34;input_box&#34;&gt;&lt;input type=&#34;text&#34; id=&#34;my_input&#34; v-model=&#34;total&#34; :placeholder=&#34;iptText&#34;&gt;&lt;button @click=&#34;payHandle&#34;&gt;捐助&lt;/button&gt;&lt;/div&gt; &lt;!-- 占位 --&gt; &lt;div style=&#34;height: 10px;&#34;&gt;&lt;/div&gt; &lt;!-- 二维码 --&gt; &lt;div id=&#34;qrcode&#34; ref=&#34;qrCodeBox&#34; v-show=&#34;showFlag&#34;&gt;&lt;/div&gt; &lt;/div&gt; &lt;/template&gt; &lt;script setup&gt; import { ref, onMounted, getCurrentInstance } from &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/e28f76c1c25bc39c8b88a79e38ecf46e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-09T18:42:46+08:00" />
<meta property="article:modified_time" content="2023-09-09T18:42:46+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">微信支付-Native支付（网页二维码扫码微信支付）简单示例</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="%E6%A6%82%E8%BF%B0-toc" style="margin-left:0px;"><a href="#%E6%A6%82%E8%BF%B0" rel="nofollow">概述</a></p> 
<p id="%C2%A0%E7%95%8C%E9%9D%A2%E5%B1%95%E7%A4%BA%20%26%20%E5%89%8D%E7%AB%AF%E4%BB%A3%E7%A0%81%EF%BC%88Vue%EF%BC%89-toc" style="margin-left:0px;"><a href="#%C2%A0%E7%95%8C%E9%9D%A2%E5%B1%95%E7%A4%BA%20%26%20%E5%89%8D%E7%AB%AF%E4%BB%A3%E7%A0%81%EF%BC%88Vue%EF%BC%89" rel="nofollow"> 界面展示 &amp; 前端代码（Vue）</a></p> 
<p id="%E5%90%8E%E7%AB%AF%E5%AE%9E%E7%8E%B0%EF%BC%88SpringBoot%EF%BC%89-toc" style="margin-left:0px;"><a href="#%E5%90%8E%E7%AB%AF%E5%AE%9E%E7%8E%B0%EF%BC%88SpringBoot%EF%BC%89" rel="nofollow">后端实现（SpringBoot）</a></p> 
<p id="%C2%A0Maven%E4%BE%9D%E8%B5%96%C2%A0-toc" style="margin-left:40px;"><a href="#%C2%A0Maven%E4%BE%9D%E8%B5%96%C2%A0" rel="nofollow"> Maven依赖 </a></p> 
<p id="%C2%A0%E4%B8%8B%E5%8D%95%E6%8E%A5%E5%8F%A3%EF%BC%88%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD%E4%BB%A3%E7%A0%81%EF%BC%89-toc" style="margin-left:40px;"><a href="#%C2%A0%E4%B8%8B%E5%8D%95%E6%8E%A5%E5%8F%A3%EF%BC%88%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD%E4%BB%A3%E7%A0%81%EF%BC%89" rel="nofollow"> 下单接口（主要功能代码）</a></p> 
<p id="%E6%94%AF%E4%BB%98%E6%88%90%E5%8A%9F%E5%9B%9E%E8%B0%83%E6%8E%A5%E5%8F%A3-toc" style="margin-left:40px;"><a href="#%E6%94%AF%E4%BB%98%E6%88%90%E5%8A%9F%E5%9B%9E%E8%B0%83%E6%8E%A5%E5%8F%A3" rel="nofollow">支付成功回调接口</a></p> 
<p id="%E6%B5%8B%E8%AF%95%EF%BC%88%E5%90%8E%E7%AB%AF%E7%BA%BF%E4%B8%8A%E7%8E%AF%E5%A2%83%EF%BC%89-toc" style="margin-left:0px;"><a href="#%E6%B5%8B%E8%AF%95%EF%BC%88%E5%90%8E%E7%AB%AF%E7%BA%BF%E4%B8%8A%E7%8E%AF%E5%A2%83%EF%BC%89" rel="nofollow">测试（后端线上环境）</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2 id="%E6%A6%82%E8%BF%B0">概述</h2> 
<p>本篇博文主要演示和说明网页扫码实现微信支付的功能。</p> 
<blockquote> 
 <p><span style="color:#fe2c24;"><strong>Native支付？</strong></span></p> 
 <p><strong>Native支付是指商户系统按微信支付协议生成支付二维码，用户再用微信“扫一扫”完成支付的模式。</strong></p> 
</blockquote> 
<blockquote> 
 <p><span style="color:#fe2c24;"><strong>使用前提？</strong></span></p> 
 <p><strong>已注册成为微信商户，在微信商户平台开通"Native支付"，获取API证书和API密匙等参数，如果对于注册微信商户有所疑惑，请看博文：<a href="http://t.csdn.cn/BCecm" rel="nofollow" title="http://t.csdn.cn/BCecm">http://t.csdn.cn/BCecm</a>，博文有讲解从零到商户的注册过程要求说明。</strong></p> 
</blockquote> 
<blockquote> 
 <p><strong><span style="color:#fe2c24;">主要流程概述</span></strong></p> 
 <p><strong>Native支付的流程很简单，主要为：</strong></p> 
 <p><strong><span style="background-color:#fbd4d0;">1.</span>前端传入金额等参数。</strong></p> 
 <p><strong><span style="background-color:#f9eda6;">2.</span>后端拿着参数向微信服务器创建预支付订单，取回一个支付地址，传回前端。</strong></p> 
 <p><strong><span style="background-color:#d4e9d5;">3.</span>前端拿着支付地址生成二维码，微信扫码完成支付。</strong></p> 
</blockquote> 
<h2 id="%C2%A0%E7%95%8C%E9%9D%A2%E5%B1%95%E7%A4%BA%20%26%20%E5%89%8D%E7%AB%AF%E4%BB%A3%E7%A0%81%EF%BC%88Vue%EF%BC%89"> 界面展示 &amp; 前端代码（Vue）</h2> 
<blockquote> 
 <p><strong>关于支付地址转为二维码</strong></p> 
 <p>在此使用的是<strong>QRCode</strong>，使用方式很简单，导入，声明二维码放置节点元素，实例化QRCode生成二维码。具体使用方式看示例代码，或文档地址：</p> 
 <p><a class="link-info" href="https://github.com/davidshimjs/qrcodejs" title="github地址">github地址</a></p> 
 <p><a class="link-info" href="http://code.ciaoca.com/javascript/qrcode/" rel="nofollow" title="中文使用说明地址">中文使用说明地址</a></p> 
 <p><a class="link-info" href="https://cdn.jsdelivr.net/npm/qrcodejs2@0.0.2/qrcode.min.js" rel="nofollow" title="js文件地址">js文件地址</a></p> 
</blockquote> 
<p><img alt="" height="265" src="https://images2.imgbox.com/0e/5f/Y4jk2TQW_o.png" width="464"></p> 
<p><strong>输入金额，点击"捐助"，调用后端接口获取支付地址，生成支付二维码。</strong></p> 
<p><img alt="" height="430" src="https://images2.imgbox.com/13/e8/LRtes8L8_o.png" width="444"></p> 
<pre><code class="language-html">

&lt;template&gt;
  &lt;div id="container"&gt;
    &lt;!-- 图片 --&gt;
    &lt;div id="imgJuan"&gt;&lt;/div&gt;
    &lt;!-- 表单 --&gt;
    &lt;div id="input_box"&gt;&lt;input type="text" id="my_input" v-model="total" :placeholder="iptText"&gt;&lt;button @click="payHandle"&gt;捐助&lt;/button&gt;&lt;/div&gt;
    &lt;!-- 占位 --&gt;
    &lt;div style="height: 10px;"&gt;&lt;/div&gt;
    &lt;!-- 二维码 --&gt;
    &lt;div id="qrcode" ref="qrCodeBox" v-show="showFlag"&gt;&lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref, onMounted, getCurrentInstance } from "vue"
import axios from "axios";

// 获取二维码盒子节点（如下两种方式均可）
// 方式一、获取当前组件实例，通过实例获取节点
const { proxy } = getCurrentInstance()
// 方式二、通过ref获取节点
const qrCodeBox = ref(null);

// 支付二维码显示控制
let showFlag = ref(false);

// 输入框内容
const iptText = "请输入捐助金额（元）"

// 输入金额
let total = ref('');

// 触发下单支付
async function payHandle(){
  // 将金额单位转为分
  let total_F = parseFloat(total.value) * 100

  // 发送请求，获取支付地址
  const res = await axios.get(`http://后端接口地址/pay/nativePay?total=${total_F}`);
  console.log(res.data);
  // 将支付地址转为二维码，显示（QRCode参数为（二维码展示的盒子节点元素，显示的内容））
  // 这是vue项目，我将QRCode.min.js文件下载并在index.html引入了，因此在此文件看不到引入  
  const qrObj = new QRCode(qrCodeBox.value, res.data);
  showFlag.value = true;
}

&lt;/script&gt;

&lt;style scoped&gt;
#container {
  border: solid red 1px;
  border-radius: 10px;
  /* width: fit-content; */
  width: 600px;
  margin: 0 auto;
  overflow: hidden;
}

#qrcode{
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 10px 0px;
}

button {
  border: none;
  background-color: #ce5944;
  color: white;
  font-weight: 600;
  height: 37px;
  width: 90px;
  position: relative;
  top: 1px;
  margin-left: 5px;
  border-radius: 5px;
  cursor: pointer;
}

button:hover{
  background-color: #d14e37;

}

#imgJuan {
  /* border: solid red 1px; */
  height: 300px;
  width: 100%;
  background: url("/juan.jpg") no-repeat center center;
  background-size: cover;
  border-radius: 5px;
}

#input_box {
  width: fit-content;
  margin: 0 auto;
  margin-top: 20px;
}

#my_input {
  border-radius: 3px;
  border: solid 1px #1c591f;
  height: 32px;
  width: 268px;
  padding-left: 5px;
}
&lt;/style&gt;
</code></pre> 
<p></p> 
<h2 id="%E5%90%8E%E7%AB%AF%E5%AE%9E%E7%8E%B0%EF%BC%88SpringBoot%EF%BC%89">后端实现（SpringBoot）</h2> 
<p><strong>说明：在此，后端仅编写展示两个接口："<span style="color:#ff9900;">下单接口</span>","<span style="color:#ff9900;">支付回调接口</span>"</strong></p> 
<p> 接口皆是根据官方SDK API文档实现，如果想要获取更多接口信息，例如"查单接口"，请查看官网文档示例地址：<a class="link-info" href="https://pay.weixin.qq.com/docs/merchant/products/native-payment/apilist.html" rel="nofollow" title="微信Native支付及接口描述">微信Native支付及接口描述</a> &amp; <a class="link-info" href="https://github.com/wechatpay-apiv3/wechatpay-java" title="JavaSDK示例（githup地址）">JavaSDK示例（githup地址）</a></p> 
<h3 id="%C2%A0Maven%E4%BE%9D%E8%B5%96%C2%A0"> Maven依赖 </h3> 
<pre><code class="language-XML">&lt;dependency&gt;
	&lt;groupId&gt;com.github.wechatpay-apiv3&lt;/groupId&gt;
	&lt;artifactId&gt;wechatpay-java&lt;/artifactId&gt;
	&lt;version&gt;0.2.11&lt;/version&gt;
&lt;/dependency&gt;
</code></pre> 
<blockquote> 
 <p> 使用官方提供的Java SDK，文档地址：<a class="link-info" href="https://pay.weixin.qq.com/docs/merchant/sdk-tools/sdk-tool.html" rel="nofollow" title="微信支付 Java SDK">微信支付 Java SDK</a></p> 
</blockquote> 
<h3 id="%C2%A0%E4%B8%8B%E5%8D%95%E6%8E%A5%E5%8F%A3%EF%BC%88%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD%E4%BB%A3%E7%A0%81%EF%BC%89"> 下单接口（主要功能代码）</h3> 
<pre><code class="language-java">/**
     * Native支付下单，获取支付地址
     * @param total 金额
     * @return 支付地址，前端用于生成支付二维码
     */
    public String nativePay(Integer total){
        // 使用自动更新平台证书的RSA配置
        Config config =
                new RSAAutoCertificateConfig.Builder()
                        .merchantId(merchantId) // 商户号
                        .privateKeyFromPath(NativeUtil.getResourcesPath() + "apiclient_key.pem")  // API证书地址（此处的路径自己调试一下，能找到就行）
                        .merchantSerialNumber(merchantSerialNumber) // API证书序列号
                        .apiV3Key(apiV3Key) // API密匙
                        .build();
        // 构建service
        NativePayService service = new NativePayService.Builder().config(config).build();
        // request.setXxx(val)设置所需参数，具体参数可见Request定义
        PrepayRequest request = new PrepayRequest();
        Amount amount = new Amount();
        amount.setTotal(total); // 金额
        request.setAmount(amount);  
        request.setAppid(appId); // 应用ID
        request.setMchid(merchantId);  // 商户号
        request.setDescription("Native测试商品标题");  // 商品描述
        request.setNotifyUrl("http://后端地址/pay/notifyNative");  // 支付成功的回调地址
        // 生成模拟系统内部订单号（yyyyMMddHHmmssSSS）
        request.setOutTradeNo(DateUtil.format(new Date(), DatePattern.PURE_DATETIME_MS_PATTERN));  // 自己后端的唯一订单号，此处使用时间模拟
        // 调用下单方法，得到应答
        try {
            // 发送请求
            PrepayResponse response = service.prepay(request);
            // 使用微信扫描 code_url 对应的二维码，即可体验Native支付
            System.out.println(response.getCodeUrl());
            // 将支付地址返回
            return response.getCodeUrl();
        }catch (Exception e){
            System.out.println(e.getMessage());
            return e.getMessage();
        }
    }</code></pre> 
<h3 id="%E6%94%AF%E4%BB%98%E6%88%90%E5%8A%9F%E5%9B%9E%E8%B0%83%E6%8E%A5%E5%8F%A3">支付成功回调接口</h3> 
<blockquote> 
 <p><span style="color:#fe2c24;"><strong>回调地址？</strong></span></p> 
 <p><strong>回调地址为：当前端生成的二维码被微信扫描并成功支付之后，微信服务器会将支付的信息发送到这个地址上。如有疑惑，文档地址：<a class="link-info" href="https://pay.weixin.qq.com/docs/merchant/apis/native-payment/payment-notice.html" rel="nofollow" title="支付通知">支付通知</a></strong></p> 
</blockquote> 
<pre><code class="language-java">/**
     * 成功支付的回调
     * @param request ·
     * @param response ·
     * @throws IOException ·
     */
    public void notifyNative(HttpServletRequest request, HttpServletResponse response) throws IOException {

        // 获取请求体原内容（此时获取的数据是加密的）
        BufferedReader reader = request.getReader();
        StringBuilder requestBody = new StringBuilder();
        String line;
        while ((line = reader.readLine()) != null) {
            requestBody.append(line);
        }

        // 获取请求携带的数据，构造参数
        RequestParam requestParam = new RequestParam.Builder()
                .serialNumber(request.getHeader("Wechatpay-Serial")) // 微信支付平台证书的序列号
                .nonce(request.getHeader("Wechatpay-Nonce")) // 签名中的随机数
                .signature(request.getHeader("Wechatpay-Signature"))  // 应答的微信支付签名
                .timestamp(request.getHeader("Wechatpay-Timestamp")) // 签名中的时间戳
                .body(requestBody.toString()) // 请求体内容（原始内容，不要解析）
                .build();

        // 初始化RSAAutoCertificateConfig
        NotificationConfig config = new RSAAutoCertificateConfig.Builder()
                .merchantId(merchantId) // 商户号
                // API证书路径，路径自己调试，能找到就行（NativeUtil为自定义工具类）
                .privateKeyFromPath(NativeUtil.getResourcesPath() + "apiclient_key.pem") 
                .merchantSerialNumber(merchantSerialNumber) // 证书序列号
                .apiV3Key(apiV3Key) // APIV3密匙
                .build();

        // 初始化 NotificationParser
        NotificationParser parser = new NotificationParser(config);
        // 解析为Transaction对象（解密数据）
        Transaction transaction = parser.parse(requestParam, Transaction.class);
        // 获取支付单号
        log.info("支付成功，回调信息：{}", transaction);
        // 打印其中的"微信支付单号"字段，可用于查单操作
        log.info("微信支付单号：{}", transaction.getTransactionId());
    }</code></pre> 
<h2 id="%E6%B5%8B%E8%AF%95%EF%BC%88%E5%90%8E%E7%AB%AF%E7%BA%BF%E4%B8%8A%E7%8E%AF%E5%A2%83%EF%BC%89">测试（后端线上环境）</h2> 
<blockquote> 
 <p><span style="color:#fe2c24;"><strong>测试内容</strong></span></p> 
 <p><strong>1.前端输入金额，点击【捐助】按钮，查看是否显示支付二维码。</strong></p> 
 <p><strong>2.微信扫码支付，查看回到接口是是否被调用，查看控制台输出。</strong></p> 
</blockquote> 
<p><strong><span style="background-color:#d4e9d5;"> 访问  </span></strong></p> 
<p><img alt="" height="289" src="https://images2.imgbox.com/86/b3/99f6vVoh_o.png" width="510"></p> 
<p><strong><span style="background-color:#d4e9d5;"> 输入金额，点击【捐助】</span></strong></p> 
<p><img alt="" height="426" src="https://images2.imgbox.com/9b/e4/5GJ3FIXI_o.png" width="421"></p> 
<p><strong><span style="background-color:#d4e9d5;"> 微信扫码支付 </span></strong></p> 
<p> <img alt="" height="207" src="https://images2.imgbox.com/24/97/NCGMCb6M_o.png" width="291"></p> 
<p><strong><span style="background-color:#d4e9d5;"> 查看控制台 </span></strong></p> 
<p><img alt="" height="272" src="https://images2.imgbox.com/9b/e9/WFGixb1l_o.png" width="1200"></p> 
<p><strong> 至此，测试完毕。</strong> </p> 
<h2>最后</h2> 
<p>此博文仅展示了从二维码到支付成功的过程，至于后续处理，如成功支付之后"如何通知前端页面做修改"，这类后续处理需要读者根据自己实际情况进行处理，例如使用轮询还是WebSocket这类方式检查支付状态，都是没问题的。</p> 
<p>最后，如文章有不足之处请指出，感谢访问。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/92595e9f746ed349d066119749d3bbd7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">videojs 实现视频流切换和分屏播放</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d39c2a0cc25c7b2f1c1dcf705840d5b5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【车载以太网测试从入门到精通】——物理层测试</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>