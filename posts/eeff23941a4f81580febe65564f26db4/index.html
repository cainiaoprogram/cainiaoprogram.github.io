<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Windows下如何编译FFmpeg - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Windows下如何编译FFmpeg" />
<meta property="og:description" content="ffmpeg一般在linux环境中使用，但是我们目前很多的开发工具是windows，为了方便在windows下调试和使用ffmpeg，我们需要再windows下面编译和使用ffpeg，本文只讲述windows下如何编译ffmpeg的内容。
windows下编译ffmpeg有很多的方法，本文主要用MSYS2的方式来编译。其本质就是模拟一个linux的命令环境，用来编译ffmpeg
一、需要的软件下载 在windows下编译ffmpeg，需要下载几个软件，我们将其下载在一个不带有中文名称的文件夹中。
1、下载MSYS2 官网下载地址：https://www.msys2.org/
2、下载FFmpeg源码 从ffmpeg官网上下载的源码好像不是最新的，后面编译的时候会报错，所以我们直接从github上下载5.1.2版本
3、下载x264源码 官网下载地址：https://www.videolan.org/developers/x264.html
4、下载SDL源码（可选，在编译FFplay.exe时需要） 官网下载地址：https://www.libsdl.org/
这里下载了2.26.3版本
将下载的软件解压放在一个没有中文名称和空格的文件夹中，以下是我的地址路径
二、安装MSYS2及编译工具链 1、点击msys2-x86_64-20230718.exe并完成安装，完成后的工具如下： 2、修改C:\msys64\msys2_shell.cmd文件，将 rem set MSYS2_PATH_TYPE=inherit 修改成 set MSYS2_PATH_TYPE=inherit 3、启动MSYS2 MINGW64，依次输入以下命令行开始安装mingw64编译链和基本依赖 更新环境 pacman -Sy 如果出现 clang32: signature from “Christoph Reiter (MSYS2 development key) reiter.christoph@gmail.com” is invalid
解决方法是输入以下命令，
rm -r /etc/pacman.d/gnupg/ pacman-key --init pacman-key --populate msys2 curl -O http://repo.msys2.org/msys/x86_64/msys2-keyring-r21.b39fb11-1-any.pkg.tar.xz curl -O http://repo.msys2.org/msys/x86_64/msys2-keyring-r21.b39fb11-1-any.pkg.tar.xz.sig pacman -U --config &lt;(echo) msys2-keyring-r21.b39fb11-1-any.pkg.tar.xz pacman -Syu 最终结果：
安装基本依赖库 pacman -S mingw-w64-x86_64-toolchain # mingw64编译工具链，win下的gcc，用于编译64位的库 pacman -S mingw-w64-i686-toolchain # 用于编译32位的库 pacman -S base-devel # 一些基本的编译工具 pacman -S yasm nasm gcc # 汇编器 pacman -S mingw64/mingw-w64-x86_64-SDL2　#SDL2 是ffmpeg依赖的，因为没有它ffpaly不能用 安装完毕后，可以输入gcc -v查看 gcc 版本：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/eeff23941a4f81580febe65564f26db4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-27T11:01:30+08:00" />
<meta property="article:modified_time" content="2023-10-27T11:01:30+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Windows下如何编译FFmpeg</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>  ffmpeg一般在linux环境中使用，但是我们目前很多的开发工具是windows，为了方便在windows下调试和使用ffmpeg，我们需要再windows下面编译和使用ffpeg，本文只讲述windows下如何编译ffmpeg的内容。<br>   windows下编译ffmpeg有很多的方法，本文主要用MSYS2的方式来编译。其本质就是模拟一个linux的命令环境，用来编译ffmpeg</p> 
<h2><a id="_3"></a>一、需要的软件下载</h2> 
<p>  在windows下编译ffmpeg，需要下载几个软件，我们将其下载在一个不带有中文名称的文件夹中。</p> 
<h3><a id="1MSYS2_5"></a>1、下载MSYS2</h3> 
<p>官网下载地址：<a href="https://www.msys2.org/" rel="nofollow">https://www.msys2.org/</a><br> <img src="https://images2.imgbox.com/56/e0/Oia69VVN_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2FFmpeg_10"></a>2、下载FFmpeg源码</h3> 
<p>从<a href="https://ffmpeg.org/" rel="nofollow">ffmpeg官网</a>上下载的源码好像不是最新的，后面编译的时候会报错，所以我们直接从<a href="https://github.com/FFmpeg/FFmpeg/tree/n5.1.2">github</a>上下载5.1.2版本</p> 
<p><img src="https://images2.imgbox.com/fe/93/Tieh9kgr_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3x264_16"></a>3、下载x264源码</h3> 
<p>官网下载地址：<a href="https://www.videolan.org/developers/x264.html" rel="nofollow">https://www.videolan.org/developers/x264.html</a><br> <img src="https://images2.imgbox.com/1e/bd/kovvmRPJ_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="4SDLFFplayexe_20"></a>4、下载SDL源码（可选，在编译FFplay.exe时需要）</h3> 
<p>官网下载地址：<a href="https://www.libsdl.org/" rel="nofollow">https://www.libsdl.org/</a><br> <img src="https://images2.imgbox.com/30/43/34TuoKJM_o.png" alt="在这里插入图片描述"><br> 这里下载了2.26.3版本<br> <img src="https://images2.imgbox.com/29/02/pzWC5YiJ_o.png" alt="在这里插入图片描述"></p> 
<p>将下载的软件解压放在一个没有中文名称和空格的文件夹中，以下是我的地址路径</p> 
<p><img src="https://images2.imgbox.com/01/90/0FrwQjXq_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="MSYS2_33"></a>二、安装MSYS2及编译工具链</h2> 
<h3><a id="1msys2x86_6420230718exe_34"></a>1、点击msys2-x86_64-20230718.exe并完成安装，完成后的工具如下：</h3> 
<p><img src="https://images2.imgbox.com/ac/39/aKPjOvv9_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2Cmsys64msys2_shellcmd_rem_set_MSYS2_PATH_TYPEinherit__set_MSYS2_PATH_TYPEinherit_36"></a>2、修改C:\msys64\msys2_shell.cmd文件，将 rem set MSYS2_PATH_TYPE=inherit 修改成 set MSYS2_PATH_TYPE=inherit</h3> 
<p><img src="https://images2.imgbox.com/87/9f/NOLXFxsS_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3MSYS2_MINGW64mingw64_39"></a>3、启动MSYS2 MINGW64，依次输入以下命令行开始安装mingw64编译链和基本依赖</h3> 
<ul><li>更新环境</li></ul> 
<pre><code class="prism language-shell">pacman <span class="token parameter variable">-Sy</span>
</code></pre> 
<p>如果出现 <font color="red">clang32: signature from “Christoph Reiter (MSYS2 development key) <a href="mailto:reiter.christoph@gmail.com" rel="nofollow">reiter.christoph@gmail.com</a>” is invalid</font><br> 解决方法是输入以下命令，</p> 
<pre><code class="prism language-shell"> <span class="token function">rm</span> <span class="token parameter variable">-r</span> /etc/pacman.d/gnupg/
 pacman-key <span class="token parameter variable">--init</span>
 pacman-key <span class="token parameter variable">--populate</span> msys2
 <span class="token function">curl</span> <span class="token parameter variable">-O</span> http://repo.msys2.org/msys/x86_64/msys2-keyring-r21.b39fb11-1-any.pkg.tar.xz
 <span class="token function">curl</span> <span class="token parameter variable">-O</span> http://repo.msys2.org/msys/x86_64/msys2-keyring-r21.b39fb11-1-any.pkg.tar.xz.sig
 pacman <span class="token parameter variable">-U</span> <span class="token parameter variable">--config</span> <span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token builtin class-name">echo</span><span class="token punctuation">)</span> msys2-keyring-r21.b39fb11-1-any.pkg.tar.xz
 pacman <span class="token parameter variable">-Syu</span>
</code></pre> 
<p>最终结果：<br> <img src="https://images2.imgbox.com/52/0d/AqiORHIQ_o.png" alt="在这里插入图片描述"></p> 
<ul><li>安装基本依赖库</li></ul> 
<pre><code class="prism language-shell">pacman <span class="token parameter variable">-S</span> mingw-w64-x86_64-toolchain  <span class="token comment"># mingw64编译工具链，win下的gcc，用于编译64位的库</span>
pacman <span class="token parameter variable">-S</span> mingw-w64-i686-toolchain <span class="token comment"># 用于编译32位的库</span>
pacman <span class="token parameter variable">-S</span> base-devel    <span class="token comment"># 一些基本的编译工具</span>
pacman <span class="token parameter variable">-S</span> yasm nasm  gcc   <span class="token comment"># 汇编器</span>
pacman <span class="token parameter variable">-S</span> mingw64/mingw-w64-x86_64-SDL2　　<span class="token comment">#SDL2 是ffmpeg依赖的，因为没有它ffpaly不能用</span>
</code></pre> 
<p>安装完毕后，可以输入gcc -v查看 gcc 版本：<br> <img src="https://images2.imgbox.com/06/7d/LSYBUjzQ_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3_69"></a>3、添加环境变量</h3> 
<p>最后需要添加环境变量。右击此电脑 -&gt; 属性 -&gt; 高级系统设置 -&gt; 环境变量 -&gt; 选择 Path （用户变量和系统变量都要）-&gt; 编辑 -&gt; 新建，添加编译工具链的路径：<br> <img src="https://images2.imgbox.com/b0/42/sJZSGv74_o.png" alt="在这里插入图片描述"><br> 注意如果 MSYS2 没有安装在 C 盘，或者使用的不是 MINGW64 的shell，那么这里需要改成对应的路径。添加环境变量这一步，是为了以后使用其他编辑器或者IDE时，能够找到 MINGW64 的编译工具链。在 MSYS2 中编译 ffmpeg 本身是不需要添加 Windows 的环境变量的。</p> 
<h2><a id="_74"></a>三、编译和安装</h2> 
<h3><a id="1FFmpegn512installx264install_75"></a>1、新建FFmpeg-n5.1.2-install和x264-install两个文件夹，用来存放编译后安装的文件</h3> 
<h3><a id="2SDLsdl2config_76"></a>2、打开SDL源码中的sdl2-config文件</h3> 
<p><img src="https://images2.imgbox.com/54/12/e2qYrhqE_o.png" alt="在这里插入图片描述"><br> 修改其中的prefix路径，具体路径根据你文件所在位置确定，不能直接复制文件资源管理器中的路径，需要修改为以下格式</p> 
<pre><code>prefix=/d/worksoft/audioAndVideo/SDL2-2.26.3/x86_64-w64-mingw32
</code></pre> 
<p><img src="https://images2.imgbox.com/a8/03/UY8Fzs1C_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3FFmpegconfigure_83"></a>3、打开FFmpeg源码目录中的configure文件</h3> 
<p><img src="https://images2.imgbox.com/7b/7d/mJPEe5P6_o.png" alt="在这里插入图片描述"></p> 
<p>修改SDL2_CONFIG路径，规则同上</p> 
<pre><code>SDL2_CONFIG="/d/worksoft/audioAndVideo/SDL2-2.26.3/x86_64-w64-mingw32/bin/sdl2-config"
</code></pre> 
<p><img src="https://images2.imgbox.com/55/94/y1IuSQ0f_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="4x264_92"></a>4、编译x264</h3> 
<p>在放置文件的目录下新建build_x264.sh文件，内容如下：</p> 
<pre><code class="prism language-shell"><span class="token shebang important">#!/bin/sh</span>
<span class="token comment">#进入执行脚本所在目录</span>
<span class="token assign-left variable">basepath</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">cd</span> `dirname $0`<span class="token punctuation">;</span><span class="token builtin class-name">pwd</span><span class="token variable">)</span></span>
<span class="token builtin class-name">echo</span> <span class="token variable">${basepath}</span>
 
<span class="token comment">#进入h264源码目录</span>
<span class="token builtin class-name">cd</span> <span class="token variable">${basepath}</span>/x264-master   <span class="token comment"># 根据路径名称自行修改</span>
<span class="token builtin class-name">pwd</span>
<span class="token comment">#配置编译参数</span>
./configure <span class="token parameter variable">--prefix</span><span class="token operator">=</span><span class="token variable">${basepath}</span>/x264-install --enable-shared
<span class="token comment">#开始8线程编译</span>
<span class="token function">make</span> <span class="token parameter variable">-j8</span>
<span class="token comment">#将编译后的文件拷贝到--prefix参数配置目录</span>
<span class="token function">make</span> <span class="token function">install</span>
</code></pre> 
<p>在MSYS2 MINGW64中执行如下命令，等待x264编译完成</p> 
<pre><code class="prism language-shell"><span class="token builtin class-name">cd</span> /d/worksoft/audioAndVideo
./build_x264.sh
</code></pre> 
<p>编译完成后，在x264-install目录下就可以看到编译后的文件<br> <img src="https://images2.imgbox.com/31/a0/46wFUl1J_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="5ffmpeg_118"></a>5、编译ffmpeg</h3> 
<p>在在放置文件的目录下新建build_ffmpeg.sh文件，内容如下：</p> 
<pre><code class="prism language-shell"><span class="token shebang important">#!/bin/sh</span>
<span class="token comment">#进入执行脚本所在目录</span>
<span class="token assign-left variable">basepath</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">cd</span> `dirname $0`<span class="token punctuation">;</span><span class="token builtin class-name">pwd</span><span class="token variable">)</span></span>
<span class="token builtin class-name">echo</span> <span class="token variable">${basepath}</span>

<span class="token comment">#进入ffmpeg源码目录</span>
<span class="token builtin class-name">cd</span> <span class="token variable">${basepath}</span>/FFmpeg-n5.1.2  <span class="token comment"># 根据路径名称自行修改</span>
<span class="token builtin class-name">pwd</span>
<span class="token comment">#指定PKG_CONFIG_PATH变量，告知编译器x264库的路径</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">PKG_CONFIG_PATH</span><span class="token operator">=</span><span class="token variable">${PKG_CONFIG_PATH}</span><span class="token builtin class-name">:</span><span class="token variable">${basepath}</span>/x264-install/lib/pkgconfig
<span class="token builtin class-name">echo</span> <span class="token variable">${PKG_CONFIG_PATH}</span>
<span class="token comment">#配置编译参数</span>
./configure <span class="token parameter variable">--prefix</span><span class="token operator">=</span><span class="token variable">${basepath}</span>/FFmpeg-n5.1.2-install <span class="token punctuation">\</span>
--enable-gpl <span class="token punctuation">\</span>
--enable-debug <span class="token punctuation">\</span>
--enable-libx264 <span class="token punctuation">\</span>
--disable-static <span class="token punctuation">\</span>
--enable-shared <span class="token punctuation">\</span>
--enable-sdl2 <span class="token punctuation">\</span>
--enable-ffplay <span class="token punctuation">\</span>
--enable-ffprobe <span class="token punctuation">\</span>
--enable-ffmpeg <span class="token punctuation">\</span>
--disable-vulkan <span class="token punctuation">\</span>
--disable-doc  <span class="token punctuation">\</span>
--disable-htmlpages  <span class="token punctuation">\</span>
--disable-manpages  <span class="token punctuation">\</span>
--disable-podpages  <span class="token punctuation">\</span>
--disable-txtpages <span class="token punctuation">\</span>
--extra-cflags<span class="token operator">=</span>-l<span class="token variable">${basepath}</span>/x264-install/include <span class="token punctuation">\</span>
--extra-ldflags<span class="token operator">=</span>-L<span class="token variable">${basepath}</span>/x264-install/lib
 
 
<span class="token comment">#开始8线程编译</span>
<span class="token function">make</span> <span class="token parameter variable">-j8</span>
<span class="token comment">#将编译后的文件拷贝到--prefix参数配置目录</span>
<span class="token function">make</span> <span class="token function">install</span>
</code></pre> 
<p>在MSYS2 MINGW64中执行如下命令，等待编译完成</p> 
<pre><code class="prism language-shell">./build_ffmpeg.sh
</code></pre> 
<ul><li>如果出现如下错误：<br> <img src="https://images2.imgbox.com/68/f8/QXdIKirv_o.png" alt="在这里插入图片描述"><br> 解决方案：<br> 修改FFmpeg-n5.1.2\libavcodec\x86\mathops.h文件的三个函数，修改对应的函数的内容如下：</li></ul> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MULL</span> <span class="token expression">MULL</span></span>
<span class="token keyword">static</span> av_always_inline av_const <span class="token keyword">int</span> <span class="token function">MULL</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> shift<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> rt<span class="token punctuation">,</span> dummy<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">__builtin_constant_p</span><span class="token punctuation">(</span>shift<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token function">__asm__</span> <span class="token punctuation">(</span>
        <span class="token string">"imull %3               \n\t"</span>
        <span class="token string">"shrdl %4, %%edx, %%eax \n\t"</span>
        <span class="token operator">:</span><span class="token string">"=a"</span><span class="token punctuation">(</span>rt<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"=d"</span><span class="token punctuation">(</span>dummy<span class="token punctuation">)</span>
        <span class="token operator">:</span><span class="token string">"a"</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"rm"</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"i"</span><span class="token punctuation">(</span>shift <span class="token operator">&amp;</span> <span class="token number">0x1F</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token function">__asm__</span> <span class="token punctuation">(</span>
            <span class="token string">"imull %3               \n\t"</span>
            <span class="token string">"shrdl %4, %%edx, %%eax \n\t"</span>
            <span class="token operator">:</span><span class="token string">"=a"</span><span class="token punctuation">(</span>rt<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"=d"</span><span class="token punctuation">(</span>dummy<span class="token punctuation">)</span>
            <span class="token operator">:</span><span class="token string">"a"</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"rm"</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span><span class="token punctuation">)</span>shift<span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> rt<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">NEG_SSR32</span> <span class="token expression">NEG_SSR32</span></span>
<span class="token keyword">static</span> <span class="token keyword">inline</span>  <span class="token class-name">int32_t</span> <span class="token function">NEG_SSR32</span><span class="token punctuation">(</span> <span class="token class-name">int32_t</span> a<span class="token punctuation">,</span> <span class="token class-name">int8_t</span> s<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">__builtin_constant_p</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token function">__asm__</span> <span class="token punctuation">(</span><span class="token string">"sarl %1, %0\n\t"</span>
         <span class="token operator">:</span> <span class="token string">"+r"</span> <span class="token punctuation">(</span>a<span class="token punctuation">)</span>
         <span class="token operator">:</span> <span class="token string">"i"</span> <span class="token punctuation">(</span><span class="token operator">-</span>s <span class="token operator">&amp;</span> <span class="token number">0x1F</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token function">__asm__</span> <span class="token punctuation">(</span><span class="token string">"sarl %1, %0\n\t"</span>
               <span class="token operator">:</span> <span class="token string">"+r"</span> <span class="token punctuation">(</span>a<span class="token punctuation">)</span>
               <span class="token operator">:</span> <span class="token string">"c"</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token operator">-</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> a<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">NEG_USR32</span> <span class="token expression">NEG_USR32</span></span>
<span class="token keyword">static</span> <span class="token keyword">inline</span> <span class="token class-name">uint32_t</span> <span class="token function">NEG_USR32</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span> a<span class="token punctuation">,</span> <span class="token class-name">int8_t</span> s<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">__builtin_constant_p</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token function">__asm__</span> <span class="token punctuation">(</span><span class="token string">"shrl %1, %0\n\t"</span>
         <span class="token operator">:</span> <span class="token string">"+r"</span> <span class="token punctuation">(</span>a<span class="token punctuation">)</span>
         <span class="token operator">:</span> <span class="token string">"i"</span> <span class="token punctuation">(</span><span class="token operator">-</span>s <span class="token operator">&amp;</span> <span class="token number">0x1F</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token function">__asm__</span> <span class="token punctuation">(</span><span class="token string">"shrl %1, %0\n\t"</span>
               <span class="token operator">:</span> <span class="token string">"+r"</span> <span class="token punctuation">(</span>a<span class="token punctuation">)</span>
               <span class="token operator">:</span> <span class="token string">"c"</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token operator">-</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> a<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>然后重新编译<br> 编译完成后的结果如下：<br> <img src="https://images2.imgbox.com/96/e7/wncO9d9n_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="6x264installbinlibx264164dllFFmpegn512installbin_221"></a>6、复制一份x264-install\bin下面的libx264-164.dll到FFmpeg-n5.1.2-install\bin下面，否则打开的时候会报找不到</h3> 
<h2><a id="ffmpegHello_World_223"></a>四、ffmpeg的Hello World程序</h2> 
<p>在 ffmpeg 安装路径下，打开 share\ffmpeg\examples ，可以看到 ffmpeg 的示例程序，它们也可以在 ffmpeg 的在线 API 文档 中查看到。</p> 
<p>其中的 avio_reading.c 相当于 ffmpeg 的 Hello World，它会读取一个媒体文件的元数据信息并打印显示。<br> 另外建一个文件夹test_hello_world，将avio_reading.c复制过去，然后用在 MYSY2 中打开这个目录，使用 gcc 命令编译。<br> 命令如下：</p> 
<pre><code class="prism language-shell"><span class="token builtin class-name">cd</span> /d/worksoft/audioAndVideo/FFmpeg-n5.1.2-install/share/ffmpeg/examples
<span class="token function">mkdir</span> test_hello_world
<span class="token function">cp</span> avio_reading.c test_hello_world/

<span class="token builtin class-name">cd</span> test_hello_world
gcc avio_reading.c <span class="token parameter variable">-o</span> <span class="token builtin class-name">test</span> <span class="token punctuation">\</span>
-I<span class="token string">"D:/worksoft/audioAndVideo/FFmpeg-n5.1.2-install/include/"</span> <span class="token punctuation">\</span>
-L<span class="token string">"D:/worksoft/audioAndVideo/FFmpeg-n5.1.2-install/bin/"</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-lavcodec</span> <span class="token parameter variable">-lavformat</span> <span class="token parameter variable">-lavutil</span>

</code></pre> 
<p><img src="https://images2.imgbox.com/bc/b3/NpafFqOP_o.png" alt="在这里插入图片描述"></p> 
<p>编译完毕后，将在当前文件夹下生成可执行文件test.exe。<br> <img src="https://images2.imgbox.com/1b/1a/rvjJOpY1_o.png" alt="在这里插入图片描述"></p> 
<p>在 shell 中运行程序之前，需要将两个库的安装目录添加到环境变量 PATH （这是MSYS2 的环境变量，不是 Windows 系统的）。</p> 
<pre><code class="prism language-shell"><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span>:/d/worksoft/audioAndVideo/x264_install/bin:/d/worksoft/audioAndVideo/FFmpeg-n5.1.2-install/bin

</code></pre> 
<p>如果不执行export命令的话，那么运行test.exe时就无法链接到动态库，更令人困扰的是不会弹出任何提示，所以一定记得添加。当然如果你觉得每次打开都要运行太麻烦，也可以将这条命令添加到 你的安装位置/msys64/etc/profile 文件的末尾，这个文件和 Linux 下的/etc/profile文件作用是类似的。</p> 
<p>找一个视频文件，运行测试效果如下：<br> <img src="https://images2.imgbox.com/1e/91/gUveq6nY_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_258"></a>五、踩过的坑</h2> 
<h3><a id="1MSYS2sed_i_smirrormsys2orgmirrorsustceducnmsys2g_etcpacmandmirrorlistpacman_Syffmpeg_259"></a>1、安装MSYS2的时候，如果执行了sed -i “s#mirror.msys2.org/#mirrors.ustc.edu.cn/msys2/#g” /etc/pacman.d/mirrorlist*，在执行pacman -Sy时会报错，还了各个ffmpeg版本无法解决</h3> 
<h3><a id="2ffmpeggithub_261"></a>2、从ffmpeg官网下载的文件源码内容和github上的不一样</h3> 
<h3><a id="3ffmpeg_263"></a>3、在编译ffmpeg的时候，如果不加</h3> 
<p>–disable-doc <br> –disable-htmlpages <br> –disable-manpages <br> –disable-podpages <br> –disable-txtpages <br> 这几个，会在make install的时候报错，导致无法安装完成</p> 
<p><em><strong>后记</strong></em><br>   个人总结，欢迎转载、评论、批评指正</p> 
<hr> 
<p>参考资料：<br> <a href="https://blog.csdn.net/qq_36751491/article/details/129128533">Windows下FFmpeg库编译安装指南</a><br> <a href="https://blog.csdn.net/Dr_Myst/article/details/128257703">ffmpeg库编译安装及入门指南（Windows篇）- 2022年底钜献</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/03aa5491ea02670edb6309e1cd2977eb/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">工业自动化产品抗干扰笔记</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6f0682671f928cc5e57e2fc40351e3f9/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">解决SpringBoot3整合Druid的兼容性问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>