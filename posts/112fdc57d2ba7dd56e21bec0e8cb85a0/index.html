<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>AI上推荐 之 基于内容的推荐(ContentBasedRecommend) - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="AI上推荐 之 基于内容的推荐(ContentBasedRecommend)" />
<meta property="og:description" content="1. 前言 随着信息技术和互联网的发展， 我们已经步入了一个信息过载的时代，这个时代，无论是信息消费者还是信息生产者都遇到了很大的挑战：
信息消费者：如何从大量的信息中找到自己感兴趣的信息？信息生产者：如何让自己生产的信息脱颖而出， 受到广大用户的关注？ 为了解决这个矛盾， 推荐系统应时而生， 并飞速前进，在用户和信息之间架起了一道桥梁，一方面帮助用户发现对自己有价值的信息， 一方面让信息能够展现在对它感兴趣的用户前面。 推荐系统近几年有了深度学习的助推发展之势迅猛， 从前深度学习的传统推荐模型(协同过滤，矩阵分解，LR, FM, FFM, GBDT)到深度学习的浪潮之巅(DNN, Deep Crossing, DIN, DIEN, Wide&amp;Deep, Deep&amp;Cross, DeepFM, AFM, NFM, PNN, FNN, DRN), 现在正无时无刻不影响着大众的生活。
推荐系统通过分析用户的历史行为给用户的兴趣建模， 从而主动给用户推荐给能够满足他们兴趣和需求的信息， 能够真正的“懂你”。 想上网购物的时候， 推荐系统在帮我们挑选商品， 想看资讯的时候， 推荐系统为我们准备了感兴趣的新闻， 想学习充电的时候， 推荐系统为我们提供最合适的课程， 想消遣放松的时候， 推荐系统为我们奉上欲罢不能的短视频…, 所以当我们淹没在信息的海洋时， 推荐系统正在拨开一层层波浪， 为我们追寻多姿多彩的生活！
这篇文章又回到了传统的推荐方式协同过滤的时代了， 因为最近刚好学习到基于内容的推荐和基于回归模型的推荐， 之前在刚开始学习协同过滤的时候， 其实也了解过这两种推荐方式， 但当时并不是太了解具体是怎么做的， 这次又重温了一下， 知道了里面的一些实施细节， 所以借机会整理一下。
今天首先是看一下基于内容的推荐方式， 这种推荐方式是非常直接的， 它是以物品的内容描述信息为依据做出的推荐， 本质上是基于对物品和用户自身的特征或者属性直接分析和计算。 再白话一点， 就是事先先给出物品的画像和用户的画像， 这样， 我们就能根据用户喜欢什么直接给用户推荐物品， 这也是一种非常简单和快捷的方式，例如，假设已知电影A是一部喜剧，而恰巧我们得知某个用户喜欢看喜剧电影，那么我们基于这样的已知信息，就可以将电影A推荐给该用户。 (PS：之前从福哥的口中了解到，虽然现在深度学习模型很火， 但大多数还停留在理论的研究阶段，真正能够应用到实践中的并不是太多，因为模型本身的部署比较复杂，且对于数据， 设备等要求也非常高， 对于中小规模的公司来讲，早期的一些简单的推荐方法可以作为初版推荐系统的不二之选， 所以有时候还是有必要学习一下那些简单推荐方式的思想的， 而基于内容的推荐的思想就挺简单的哈哈)。
之前学习的时候， 也是停留在理论阶段， 也知道先构建物品画像(给物品打标签)和用户画像(给用户打标签）,然后实施推荐。 但是并没有理解到一些细节，比如如何给物品打标签， 如何给用户打标签？ 如何解决物品冷启动问题？ 等， 所以这次想通过之前用到过的比较简单的movielens数据集， 来走一波基于内容的推荐流程， 这里面会涉及到tf-idf技术， word2vec技术， doc2vec技术等， 所以通过这次的学习， 收获还是蛮大的， 把之前的知识也串联了一下。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/112fdc57d2ba7dd56e21bec0e8cb85a0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-12-17T15:38:28+08:00" />
<meta property="article:modified_time" content="2020-12-17T15:38:28+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">AI上推荐 之 基于内容的推荐(ContentBasedRecommend)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="1__0"></a>1. 前言</h3> 
<p>随着信息技术和互联网的发展， 我们已经步入了一个信息过载的时代，这个时代，无论是信息消费者还是信息生产者都遇到了很大的挑战：</p> 
<ul><li>信息消费者：如何从大量的信息中找到自己感兴趣的信息？</li><li>信息生产者：如何让自己生产的信息脱颖而出， 受到广大用户的关注？</li></ul> 
<p>为了解决这个矛盾， 推荐系统应时而生， 并飞速前进，在用户和信息之间架起了一道桥梁，一方面帮助用户发现对自己有价值的信息， 一方面让信息能够展现在对它感兴趣的用户前面。 推荐系统近几年有了深度学习的助推发展之势迅猛， 从前深度学习的传统推荐模型(协同过滤，矩阵分解，LR, FM, FFM, GBDT)到深度学习的浪潮之巅(DNN, Deep Crossing, DIN, DIEN, Wide&amp;Deep, Deep&amp;Cross, DeepFM, AFM, NFM, PNN, FNN, DRN), 现在正无时无刻不影响着大众的生活。</p> 
<p>推荐系统<strong>通过分析用户的历史行为给用户的兴趣建模， 从而主动给用户推荐给能够满足他们兴趣和需求的信息， 能够真正的“懂你”</strong>。 想上网购物的时候， 推荐系统在帮我们挑选商品， 想看资讯的时候， 推荐系统为我们准备了感兴趣的新闻， 想学习充电的时候， 推荐系统为我们提供最合适的课程， 想消遣放松的时候， 推荐系统为我们奉上欲罢不能的短视频…, 所以当我们淹没在信息的海洋时， 推荐系统正在拨开一层层波浪， 为我们追寻多姿多彩的生活！</p> 
<p>这篇文章又回到了传统的推荐方式协同过滤的时代了， 因为最近刚好学习到基于内容的推荐和基于回归模型的推荐， 之前在刚开始学习协同过滤的时候， 其实也了解过这两种推荐方式， 但当时并不是太了解具体是怎么做的， 这次又重温了一下， 知道了里面的一些实施细节， 所以借机会整理一下。</p> 
<p>今天首先是看一下基于内容的推荐方式， 这种推荐方式是非常直接的， 它是以物品的内容描述信息为依据做出的推荐， 本质上<strong>是基于对物品和用户自身的特征或者属性直接分析和计算</strong>。 再白话一点， 就是事先先给出物品的画像和用户的画像， 这样， 我们就能根据用户喜欢什么直接给用户推荐物品， 这也是一种非常简单和快捷的方式，例如，假设已知电影A是一部喜剧，而恰巧我们得知某个用户喜欢看喜剧电影，那么我们基于这样的已知信息，就可以将电影A推荐给该用户。 (PS：之前从福哥的口中了解到，虽然现在深度学习模型很火， 但大多数还停留在理论的研究阶段，真正能够应用到实践中的并不是太多，因为模型本身的部署比较复杂，且对于数据， 设备等要求也非常高， 对于中小规模的公司来讲，早期的一些简单的推荐方法可以作为初版推荐系统的不二之选， 所以有时候还是有必要学习一下那些简单推荐方式的思想的， 而基于内容的推荐的思想就挺简单的哈哈)。</p> 
<p>之前学习的时候， 也是停留在理论阶段， 也知道先构建物品画像(给物品打标签)和用户画像(给用户打标签）,然后实施推荐。 但是并没有理解到一些细节，比如如何给物品打标签， 如何给用户打标签？ 如何解决物品冷启动问题？ 等， 所以这次想通过之前用到过的比较简单的movielens数据集， 来走一波基于内容的推荐流程， 这里面会涉及到<strong>tf-idf技术， word2vec技术， doc2vec技术</strong>等， 所以通过这次的学习， 收获还是蛮大的， 把之前的知识也串联了一下。</p> 
<p>关于movidlens数据集和任务， 这是一个基于用户对看过的一些电影的 评分情况给用户实施电影推荐的一个任务， 详细的可以参考之前的文章或者资料，这里就不过多描述了。因为之前也用协同过滤， 矩阵分解等完成过这个任务， 这里主要是基于内容的走一下这个推荐流程：</p> 
<ol><li>建立物品画像 
  <ol><li>基于用户给电影打的tag和电影的分类值，得到每一部电影的总标签</li><li>求每一部电影标签的tf-idf值</li><li>根据tf-idf的结果， 为每一部电影选择top-n（tf-idf值较大)的关键词作为整部电影的关键词</li><li>最后得到了 电影id— 关键词 — 关键词权重</li></ol> </li><li>建立倒排索引 
  <ol><li>这个是为了能够根据关键词找到对应的电影， 好方便得到用户画像之后(用户喜欢啥样的电影)对用户进行一些推荐</li></ol> </li><li>建立用户画像 
  <ol><li>看用户看过哪些电影， 基于前面的物品画像找到电影对应的关键词</li><li>把用户看过的所有关键词放到一起， 统计词频， 每个词出现了几次</li><li>出现次数最多的关键词作为用户的兴趣词， 这个就是用户的画像</li></ol> </li><li>根据用户的兴趣词， 基于倒排表找到电影， 就可以对用户实施推荐了。</li></ol> 
<p>上面就是基于内容推荐的整个流程， 这篇文章会走一遍这个流程， 但是再走之前，需要介绍到一些技术， 首先是tf-idf技术， 这是一种在自然语言处理领域中应用比较广泛的一种算法。<strong>可用来提取目标文档中，并得到关键词用于计算对于目标文档的权重，并将这些权重组合到一起得到特征向量</strong>。这里会再次介绍一下Tf-idf的原理。 然后走一遍基于内容推荐的整体流程， 最后，针对物品的冷启动问题， 再介绍两种比较经典的技术， 一个叫做Word2Vec, 另一个叫做Doc2Vec， 这里也会整理他们的细节部分， 并实现这个模型完成影片的推荐， 重点是看看这俩模型是如何使用的。</p> 
<p>这篇文章会很长， 这里给出目录大纲， 各取所需即可 😉</p> 
<ul><li>基于内容的推荐算法简介</li><li>基于TF-IDF的特征提取技术</li><li>基于内容的推荐流程(物品画像 -&gt; 倒排索引 -&gt; 用户画像 -&gt; 产生推荐)</li><li>物品的冷启动处理(Word2Vec, Doc2Vec)</li></ul> 
<p>Ok, let’s go!</p> 
<h3><a id="2__38"></a>2. 基于内容的推荐算法简介</h3> 
<h4><a id="21__39"></a>2.1 简介</h4> 
<p>基于内容的推荐方法是非常直接的，它以物品的内容描述信息为依据来做出的推荐，本质上是基于对物品和用户自身的特征或属性的直接分析和计算。</p> 
<p>例如，假设已知电影A是一部喜剧，而恰巧我们得知某个用户喜欢看喜剧电影，那么我们基于这样的已知信息，就可以将电影A推荐给该用户。</p> 
<h4><a id="22__44"></a>2.2 实现步骤</h4> 
<p>画像构建：画像就是刻画物品或用户的特征。本质上就是给用户或物品贴标签。</p> 
<ul><li>物品画像：主要包括物品的分类信息， 标题， 电影/音乐主演， 歌手等等。 例如给电影《战狼2》贴标签， “动作”、“吴京”、“吴刚”、“张翰”、“大陆电影”、“国产”、“爱国”、"军事"等等一系列标签。 物品的标签来源主要包括两个方面： 
  <ol><li>PGC(应用生成内容): 物品自带的属性，比如电影的标题， 导演，演员，类型， 或者服务提供方设定的属性， 比如短视频话题，微博话题</li><li>UGC(用户生成内容): 用户在享受服务过程中提供的物品属性， 如用户评论内容， 微博话题等。</li></ol> </li><li>用户画像：主要包括用户的喜好，行为偏好， 基本的人口学属性， 活跃程度， 风控维度等。例如已知用户的观影历史是："《战狼1》"、"《战狼2》"、"《建党伟业》"、"《建军大业》"、"《建国大业》"、"《红海行动》"、"《速度与激情1-8》"等，我们是不是就可以分析出该用户的一些兴趣特征如：“爱国”、“战争”、“赛车”、“动作”、“军事”、“吴京”、"韩三平"等标签。</li></ul> 
<h4><a id="23__51"></a>2.3 基于内容推荐的算法流程</h4> 
<ul><li>根据PGC/UGC内容构建物品画像</li><li>根据用户行为记录生成用户画像</li><li>根据用户画像从物品中寻找最匹配的TOP-N物品进行推荐</li></ul> 
<p>物品冷启动处理：</p> 
<ul><li>根据PGC内容构建物品画像</li><li>利用物品画像计算物品间两两相似情况</li><li>为每个物品产生TOP-N最相似的物品进行相关推荐：如与该商品相似的商品有哪些？与该文章相似文章有哪些？</li></ul> 
<p>后面会拿movieLens数据集走一遍这个流程， 但是在走之前， 先介绍一个技术叫做tf-idf。</p> 
<h3><a id="3_TFIDF_63"></a>3. 基于TF-IDF的特征提取技术</h3> 
<p>上面提到，物品画像的特征标签主要都是指的如电影的导演、演员、图书的作者、出版社等结构化的数据，也就是他们的特征提取，尤其是特征向量的计算是比较简单的，如直接给作品的分类定义0或者1的状态。</p> 
<p>但另外一些特征，比如电影的内容简介、电影的影评、图书的摘要等文本数据，这些被称为非结构化数据，首先他们本应该也属于物品的一个特征标签，但是这样的特征标签进行量化时，也就是计算它的特征向量时是很难去定义的。</p> 
<p>因此这时就需要借助一些自然语言处理、信息检索等技术，将如用户的文本评论或其他文本内容信息的非结构化数据进行量化处理，从而实现更加完善的物品画像/用户画像。</p> 
<p>TF-IDF算法便是其中一种在自然语言处理领域中应用比较广泛的一种算法。可用来提取目标文档中，并得到关键词用于计算对于目标文档的权重，并将这些权重组合到一起得到特征向量。</p> 
<h4><a id="31__72"></a>3.1 算法原理</h4> 
<p>TF-IDF自然语言处理领域中计算文档中词或短语的权值的方法，是词频（Term Frequency，TF）和逆转文档频率（Inverse Document Frequency，IDF）的乘积。</p> 
<ul><li>TF指的是某一个给定的词语在该文件中出现的次数。这个数字通常会被正规化，以防止它偏向长的文件（同一个词语在长文件里可能会比短文件有更高的词频，而不管该词语重要与否）。 
  <blockquote> 
   <p>假设文档集中包含的文档数是<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            N 
           
          
         
           N 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.10903em;">N</span></span></span></span></span>, 文档集中包含关键词<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             k 
            
           
             i 
            
           
          
         
           k_i 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.84444em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.03148em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>的文档数为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             n 
            
           
             i 
            
           
          
         
           n_i 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.58056em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathdefault">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>, <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             f 
            
            
            
              i 
             
            
              j 
             
            
           
          
         
           f_{ij} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.980548em; vertical-align: -0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.10764em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right: 0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span></span></span></span></span>表示关键词<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             k 
            
           
             i 
            
           
          
         
           k_i 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.84444em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.03148em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>在文档<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             d 
            
           
             j 
            
           
          
         
           d_j 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.980548em; vertical-align: -0.286108em;"></span><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span></span></span></span></span>中出现的次数， <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             f 
            
            
            
              d 
             
            
              j 
             
            
           
          
         
           f_{dj} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.980548em; vertical-align: -0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: -0.10764em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight" style="margin-right: 0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span></span></span></span></span>表示文档<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             d 
            
           
             j 
            
           
          
         
           d_j 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.980548em; vertical-align: -0.286108em;"></span><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span></span></span></span></span>中出现的词语总数， <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             k 
            
           
             i 
            
           
          
         
           k_i 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.84444em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.03148em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>在文档<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             d 
            
           
             j 
            
           
          
         
           d_j 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.980548em; vertical-align: -0.286108em;"></span><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span></span></span></span></span>中的词频<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            T 
           
           
           
             F 
            
            
            
              i 
             
            
              j 
             
            
           
          
         
           TF_{ij} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.969438em; vertical-align: -0.286108em;"></span><span class="mord mathdefault" style="margin-right: 0.13889em;">T</span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.13889em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right: 0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span></span></span></span></span>定义为：<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            T 
           
           
           
             F 
            
            
            
              i 
             
            
              j 
             
            
           
          
            = 
           
           
            
            
              f 
             
             
             
               i 
              
             
               j 
              
             
            
            
            
              f 
             
             
             
               d 
              
             
               j 
              
             
            
           
          
         
           TF_{ij}=\frac {f_{ij}}{f_{dj}} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.969438em; vertical-align: -0.286108em;"></span><span class="mord mathdefault" style="margin-right: 0.13889em;">T</span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.13889em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right: 0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.54151em; vertical-align: -0.54808em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.993428em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3448em;"><span class="" style="top: -2.34877em; margin-left: -0.10764em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight" style="margin-right: 0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.290114em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.50732em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.328086em;"><span class="" style="top: -2.357em; margin-left: -0.10764em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right: 0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.281886em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.54808em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span>。</p> 
  </blockquote> </li><li>IDF是一个词语普遍重要性的度量，表示某一个词语在整个文档集中出现的频率。某一特定词语的IDF，可以由总文件数目除以包含该词语之文件的数目，再将得到的商取对数得到。 
  <blockquote> 
   <p>由它计算的结果取对数得到关键词<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             k 
            
           
             i 
            
           
          
         
           k_i 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.84444em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.03148em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>的拟文档频率<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            I 
           
          
            D 
           
           
           
             F 
            
           
             i 
            
           
          
         
           IDF_i 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord mathdefault" style="margin-right: 0.07847em;">I</span><span class="mord mathdefault" style="margin-right: 0.02778em;">D</span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.13889em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>：<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            I 
           
          
            D 
           
           
           
             F 
            
           
             i 
            
           
          
            = 
           
          
            l 
           
          
            o 
           
          
            g 
           
           
           
             N 
            
            
            
              n 
             
            
              i 
             
            
           
          
         
           IDF_i=log\frac {N}{n_i} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord mathdefault" style="margin-right: 0.07847em;">I</span><span class="mord mathdefault" style="margin-right: 0.02778em;">D</span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.13889em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.31743em; vertical-align: -0.4451em;"></span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right: 0.03588em;">g</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.872331em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.328086em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.10903em;">N</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.4451em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span>, 注意这个地方是N在分子上， 相当于频率取了个倒数， 这样我们依然是希望<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            I 
           
          
            D 
           
           
           
             F 
            
           
             i 
            
           
          
         
           IDF_i 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord mathdefault" style="margin-right: 0.07847em;">I</span><span class="mord mathdefault" style="margin-right: 0.02778em;">D</span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.13889em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>越大越好</p> 
  </blockquote> </li></ul> 
<p>TF-IDF算法基于一个这样的假设：若<strong>一个词语在目标文档中出现的频率高而在其他文档中出现的频率低，那么这个词语就可以用来区分出目标文档</strong>。这个假设需要掌握的有两点：</p> 
<ul><li>在本文档出现的频率高</li><li>在其他文档中出现的频率低</li></ul> 
<p>因此，TF-IDF算法的计算可以分为词频（Term Frequency，TF）和逆转文档频率（Inverse Document Frequency，IDF）两部分，由TF和IDF的乘积来设置文档词语的权重 <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           w 
          
          
          
            i 
           
          
            j 
           
          
         
        
          = 
         
        
          T 
         
         
         
           F 
          
          
          
            i 
           
          
            j 
           
          
         
        
          ⋅ 
         
        
          I 
         
        
          D 
         
         
         
           F 
          
         
           i 
          
         
        
          = 
         
         
          
          
            f 
           
           
           
             i 
            
           
             j 
            
           
          
          
          
            f 
           
           
           
             d 
            
           
             j 
            
           
          
         
        
          ⋅ 
         
        
          l 
         
        
          o 
         
        
          g 
         
         
         
           N 
          
          
          
            n 
           
          
            i 
           
          
         
        
       
         w_{ij}=TF_{ij}·IDF_{i}=\frac {f_{ij}}{f_{dj}}·log\frac {N}{n_i} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.716668em; vertical-align: -0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.02691em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right: 0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.969438em; vertical-align: -0.286108em;"></span><span class="mord mathdefault" style="margin-right: 0.13889em;">T</span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.13889em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right: 0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.07847em;">I</span><span class="mord mathdefault" style="margin-right: 0.02778em;">D</span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.13889em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.34355em; vertical-align: -0.972108em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.37144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right: 0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: -0.10764em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight" style="margin-right: 0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right: 0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.10764em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right: 0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.972108em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right: 0.03588em;">g</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.36033em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.10903em;">N</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.836em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span></p> 
<p>TF-IDF与词语在文档中的出现次数成正比，与该词在整个文档集中的出现次数成反比。</p> 
<p><strong>用途：在目标文档中，提取关键词(特征标签)的方法就是将该文档所有词语的TF-IDF计算出来并进行对比，取其中TF-IDF值最大的k个数组成目标文档的特征向量用以表示文档。</strong></p> 
<p>注意：文档中存在的停用词（Stop Words），如“是”、“的”之类的，对于文档的中心思想表达没有意义的词，在分词时需要先过滤掉再计算其他词语的TF-IDF值。</p> 
<p>这样说起来可能比较抽象，下面看一个具体的例子：</p> 
<h4><a id="32_TFIDF_95"></a>3.2 TF-IDF算法举例</h4> 
<p>对于计算影评的TF-IDF， 以电影“加勒比海盗：黑珍珠号的诅咒”为例，假设它总共有1000篇影评，其中一篇影评的总词语数为200，其中出现最频繁的词语为“海盗”、“船长”、“自由”，分别是20、15、10次，并且这3个词在所有影评中被提及的次数分别为1000、500、100，就这3个词语作为关键词的顺序计算如下。</p> 
<ol><li>将影评中出现的停用词过滤掉， 计算其他词语的词频。 以出现的最多的三个词为例进行计算： 
  <ul><li>”海盗“出现的词频20/200 = 0.1</li><li>"船长“出现的词频15/200 = 0.075</li><li>"自由"出现的词频10/200 = 0.05</li></ul> </li><li>计算词语的拟文档频率： 
  <ul><li>"海盗“的IDF为: log(1000/1000) = 0</li><li>"船长"的IDF为： log(1000/500) = 0.3</li><li>"自由"的IDF为： log(1000/100) = 1</li></ul> </li><li>由1和2计算的结果求出词语的TF-IDF结果， "海盗"为0， "船长"为0.0225， "自由"为0.05</li></ol> 
<p>通过对比可得， 该篇影评的关键词排序应为：“自由”, “船长”，“海盗”。 把这些词语的TF-IDF值作为它们的权重按照对应的顺序依次排列(0.05, 0.0225, 0)， 就得到这篇影评的特征向量， 我们就用这个向量来代表这篇影评， 向量中每一个维度的分量大小对应这个属性的重要性。</p> 
<p>将总的影评集中所有的影评向量与特定的系数相乘求和， 得到这部电影的综合影评向量， 与电影的基本属性结合构建视频的物品画像， 同理构建用户画像， 可采用多种方法计算物品画像和用户画像之间的相似度， 为用户做出推荐。</p> 
<p>具体实现的时候， 可以调用具体的tfidf模型实现， 下面就具体看看基于内容的推荐了。</p> 
<h3><a id="4_MovieLens_113"></a>4. 从MovieLens数据集中走一遍基于内容的推荐</h3> 
<p>这里采用的数据集是MovieLens数据集， 具体的可以从下面给出的GitHub中得到。这里先说一下下面要干的事情， 这里要完成一个基于内容的推荐算法， 根据最前面给出的步骤流程， 需要先给每个电影打上标签，构建出画像。 然后再根据用户观看的电影， 给用户构建画像，最后实施推荐。 主要就是这三大块。 下面是主要的细节。</p> 
<h4><a id="41__115"></a>4.1 物品画像</h4> 
<p>构造物品画像， 这里要分为三部分， 对于每一部分， 可以通过代码来看一下：</p> 
<ol><li> <p>首先， 需要构造一个电影数据集， <code>【movieId, title, genres, tags】</code>的DataFrame， 这里需要用到数据集中的<code>all_tags.csv</code>文件和<code>movies.csv</code>文件，前者里面是用户基于看过的电影，给电影打的标签， 后者是电影及其主题信息， 我们给电影打标签的时候，是要结合这两部分。具体代码如下：</p> <pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">get_movie_dataset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 加载基于所有电影的标签</span>
    <span class="token comment"># all-tag.csv</span>
    _tags <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">"ml-latest-small/all-tags.csv"</span><span class="token punctuation">,</span> usecols<span class="token operator">=</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>dropna<span class="token punctuation">(</span><span class="token punctuation">)</span>
    tags <span class="token operator">=</span> _tags<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">"movidId"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>agg<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 加载电影列表数据</span>
    movies <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">"ml-latest-small/movies.csv"</span><span class="token punctuation">,</span> index_col<span class="token operator">=</span><span class="token string">"movieId"</span><span class="token punctuation">)</span>
    <span class="token comment"># 将电影的类别词分开</span>
    movies<span class="token punctuation">[</span><span class="token string">'genres'</span><span class="token punctuation">]</span> <span class="token operator">=</span> movies<span class="token punctuation">[</span><span class="token string">'genres'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"|"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 为每部电影匹配对应的标签数据， 如果没有将会是NAN</span>
    movies_index <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span>movies<span class="token punctuation">.</span>index<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token builtin">set</span><span class="token punctuation">(</span>tags<span class="token punctuation">.</span>index<span class="token punctuation">)</span>
    new_tags <span class="token operator">=</span> tags<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token builtin">list</span><span class="token punctuation">(</span>movies_index<span class="token punctuation">)</span><span class="token punctuation">]</span>
    ret <span class="token operator">=</span> movies<span class="token punctuation">.</span>join<span class="token punctuation">(</span>new_tags<span class="token punctuation">)</span>
    
    <span class="token comment"># 构建电影数据集， 包含电影ID， 电影名称， 类别和标签四个字段</span>
    <span class="token comment"># 如果电影没有标签数据， 就替换为空列表</span>
    <span class="token comment"># map(fun, 可迭代对象)</span>
    df <span class="token operator">=</span> <span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">+</span>x<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">if</span> x<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token keyword">is</span> <span class="token operator">not</span> np<span class="token punctuation">.</span>nan <span class="token keyword">else</span> <span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ret<span class="token punctuation">.</span>itertuples<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    movies_dataset <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>df<span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'movieId'</span><span class="token punctuation">,</span> <span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">'genres'</span><span class="token punctuation">,</span> <span class="token string">'tags'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    
    movies_dataset<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token string">"movieId"</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> movies_dataset

movies_dataset <span class="token operator">=</span> get_movie_dataset<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <p>这里的map函数用的比较巧妙，我们可以看一下movies_dataset:<br> <img src="https://images2.imgbox.com/6e/6f/sW9AlhNz_o.png" alt="在这里插入图片描述"></p> </li><li> <p>然后， 基于TF-IDF提取每个电影里面的Top-N关键词， 构建电影画像，这里重点看一下tf-idf模型的使用。 思路是这样， 在上面movies_dataset的基础上， 要取出tags那一列，然后建立一个词典， 并且统计出每个单词的词频。 这个可以通过<code>Dictionary</code>函数实现。 然后就是构建TF-IDF模型， 对每个tag计算tf-idf值。计算完了之后， 选出tf-idf值比较大的前N个关键词作为该电影的电影画像。代码如下：</p> <pre><code class="prism language-python"><span class="token keyword">from</span> gensim<span class="token punctuation">.</span>models <span class="token keyword">import</span> TfidfModel
<span class="token keyword">from</span> pprint <span class="token keyword">import</span> pprint
<span class="token keyword">from</span> gensim<span class="token punctuation">.</span>corpora <span class="token keyword">import</span> Dictionary

<span class="token keyword">def</span> <span class="token function">create_movie_profile</span><span class="token punctuation">(</span>movie_dataset<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    使用tfidf，分析提取topn关键词
    :param movie_dataset:
    :return:
    '''</span>
    dataset <span class="token operator">=</span> movie_dataset<span class="token punctuation">[</span><span class="token string">"tags"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values

    <span class="token keyword">from</span> gensim<span class="token punctuation">.</span>corpora <span class="token keyword">import</span> Dictionary
    <span class="token comment"># 根据数据集建立词袋，并统计词频，将所有词放入一个词典，使用索引进行获取</span>
    dct <span class="token operator">=</span> Dictionary<span class="token punctuation">(</span>dataset<span class="token punctuation">)</span>
    <span class="token comment"># 根据将每条数据，返回对应的词索引和词频</span>
    corpus <span class="token operator">=</span> <span class="token punctuation">[</span>dct<span class="token punctuation">.</span>doc2bow<span class="token punctuation">(</span>line<span class="token punctuation">)</span> <span class="token keyword">for</span> line <span class="token keyword">in</span> dataset<span class="token punctuation">]</span>
    <span class="token comment"># 训练TF-IDF模型，即计算TF-IDF值</span>
    model <span class="token operator">=</span> TfidfModel<span class="token punctuation">(</span>corpus<span class="token punctuation">)</span>

    _movie_profile <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> data <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>movie_dataset<span class="token punctuation">.</span>itertuples<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        mid <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        title <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        genres <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
        vector <span class="token operator">=</span> model<span class="token punctuation">[</span>corpus<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span>
        movie_tags <span class="token operator">=</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>vector<span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">30</span><span class="token punctuation">]</span>
        topN_tags_weights <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token punctuation">(</span>dct<span class="token punctuation">[</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> movie_tags<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># 将类别词的添加进去，并设置权重值为1.0</span>
        <span class="token keyword">for</span> g <span class="token keyword">in</span> genres<span class="token punctuation">:</span>
            topN_tags_weights<span class="token punctuation">[</span>g<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1.0</span>
        topN_tags <span class="token operator">=</span> <span class="token punctuation">[</span>i<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> topN_tags_weights<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        _movie_profile<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>mid<span class="token punctuation">,</span> title<span class="token punctuation">,</span> topN_tags<span class="token punctuation">,</span> topN_tags_weights<span class="token punctuation">)</span><span class="token punctuation">)</span>

    movie_profile <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>_movie_profile<span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"movieId"</span><span class="token punctuation">,</span> <span class="token string">"title"</span><span class="token punctuation">,</span> <span class="token string">"profile"</span><span class="token punctuation">,</span> <span class="token string">"weights"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    movie_profile<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token string">"movieId"</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> movie_profile

movie_profile <span class="token operator">=</span> create_movie_profile<span class="token punctuation">(</span>movie_dataset<span class="token punctuation">)</span>
</code></pre> <p>这里的movie_profile长下面这样：<br> <img src="https://images2.imgbox.com/7e/a5/2fscQQRb_o.png" alt="在这里插入图片描述"><br> 这里就建好了物品画像了， 但是我们还需要建立一个倒排索引</p> </li><li> <p>为了根据指定的关键词迅速匹配到对应的电影， 需要对物品画像的标签词， 建立倒排索引。这里建立倒排索引的目的是为用户产生推荐用的， 因为后面建立用户画像的时候， 会根据用户观看过的历史记录得到用户感兴趣的电影的标签，我们要基于这个标签对用户产生新的推荐。所以这里需要先建立一个倒排表， 即能够根据标签，去提取他们对应的电影ID， 代码：</p> <pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">create_inverted_table</span><span class="token punctuation">(</span>movie_profile<span class="token punctuation">)</span><span class="token punctuation">:</span>
    inverted_table <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
    <span class="token keyword">for</span> mid<span class="token punctuation">,</span> weights <span class="token keyword">in</span> movie_profile<span class="token punctuation">[</span><span class="token string">'weights'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>iteritems<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> tag<span class="token punctuation">,</span> weight <span class="token keyword">in</span> weights<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># 到inverted_table dict 用tag作为key去取值， 如果取不到就返回[]</span>
            _ <span class="token operator">=</span> inverted_table<span class="token punctuation">.</span>get<span class="token punctuation">(</span>tag<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            _<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>mid<span class="token punctuation">,</span> weight<span class="token punctuation">)</span><span class="token punctuation">)</span>
            inverted_table<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>tag<span class="token punctuation">,</span> _<span class="token punctuation">)</span>
    <span class="token keyword">return</span> inverted_table

inverted_table <span class="token operator">=</span> create_inverted_table<span class="token punctuation">(</span>movie_profile<span class="token punctuation">)</span>
</code></pre> <p>这里的操作还是挺秒的感觉， 得到的inverted_table是个字典的形式， 张下面这样：<br><br> <img src="https://images2.imgbox.com/57/28/i0hcqun0_o.png" alt="在这里插入图片描述"></p> </li></ol> 
<p>这里，物品画像就基本完事了， 对于每部电影， 我们已经得到了对应的tags， 且基于tags， 我们也能得到每个电影。 下面构建用户画像。</p> 
<h4><a id="42__215"></a>4.2 用户画像</h4> 
<p>用户画像构建步骤：</p> 
<ul><li>根据用户的评分历史，结合物品画像，将有观影记录的电影的画像标签作为初始标签反打到用户身上</li><li>通过对用户观影标签的次数进行统计，计算用户的每个初始标签的权重值，排序后选取TOP-N作为用户最终的画像标签</li></ul> 
<p>这个就是根据用户观看过的电影， 找到他们对应的标签，统计一下标签的频率， 得到最终的标签作为用户的画像， 即该用户习惯看什么类型的电影。这里就用到了<code>rating.csv</code>， 这里面是用户对于电影的评分记录。</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> collections
<span class="token keyword">from</span> functools <span class="token keyword">import</span> <span class="token builtin">reduce</span>

<span class="token keyword">def</span> <span class="token function">create_user_profile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    watch_record <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">"datasets/ml-latest-small/ratings.csv"</span><span class="token punctuation">,</span> usecols<span class="token operator">=</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">"userId"</span><span class="token punctuation">:</span>np<span class="token punctuation">.</span>int32<span class="token punctuation">,</span> <span class="token string">"movieId"</span><span class="token punctuation">:</span> np<span class="token punctuation">.</span>int32<span class="token punctuation">}</span><span class="token punctuation">)</span>

    watch_record <span class="token operator">=</span> watch_record<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">"userId"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>agg<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">)</span>
    <span class="token comment"># print(watch_record)</span>

    movie_dataset <span class="token operator">=</span> get_movie_dataset<span class="token punctuation">(</span><span class="token punctuation">)</span>
    movie_profile <span class="token operator">=</span> create_movie_profile<span class="token punctuation">(</span>movie_dataset<span class="token punctuation">)</span>

    user_profile <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
    <span class="token keyword">for</span> uid<span class="token punctuation">,</span> mids <span class="token keyword">in</span> watch_record<span class="token punctuation">.</span>itertuples<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        record_movie_prifole <span class="token operator">=</span> movie_profile<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token builtin">list</span><span class="token punctuation">(</span>mids<span class="token punctuation">)</span><span class="token punctuation">]</span>
        counter <span class="token operator">=</span> collections<span class="token punctuation">.</span>Counter<span class="token punctuation">(</span><span class="token builtin">reduce</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token builtin">list</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">list</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span> record_movie_prifole<span class="token punctuation">[</span><span class="token string">"profile"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># 兴趣词</span>
        interest_words <span class="token operator">=</span> counter<span class="token punctuation">.</span>most_common<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>
        maxcount <span class="token operator">=</span> interest_words<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        interest_words <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span><span class="token builtin">round</span><span class="token punctuation">(</span>c<span class="token operator">/</span>maxcount<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> w<span class="token punctuation">,</span>c <span class="token keyword">in</span> interest_words<span class="token punctuation">]</span>
        user_profile<span class="token punctuation">[</span>uid<span class="token punctuation">]</span> <span class="token operator">=</span> interest_words

    <span class="token keyword">return</span> user_profile

user_profile <span class="token operator">=</span> create_user_profile<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>这里简单的看下用户画像的结果：</p> 
<p><img src="https://images2.imgbox.com/c1/e8/kqquRuFq_o.png" alt="在这里插入图片描述"><br> 构建用户画像，我们就拿到了每个用户感兴趣的一些话题或者词语， 这样，我们就可以根据倒排表实施推荐了。</p> 
<h4><a id="43_TopN_254"></a>4.3 基于内容产生TopN推荐</h4> 
<p>通过上面的内容， 我们已经得到了物品画像，即每个电影打上了标签， 是什么样的风格， 也得到了用户画像， 即每个用户喜欢什么样风格的电影， 接下来， 我们就可以基于电影的内容对用户实施推荐了。</p> 
<p>基本思路就是， 遍历用户画像， 拿到他的兴趣词，根据这个兴趣词， 去倒排表中拿到符合这些兴趣词的电影及对应的权重，由于不同兴趣词想对应的电影权重不同， 最终我们把拿到的每部电影的权重进行汇总加和得到最终的电影权重， 并基于这个最终权重， 对用户实施推荐。代码如下：</p> 
<pre><code class="prism language-python"><span class="token comment"># 为用户产生推荐结果</span>
<span class="token keyword">for</span> uid<span class="token punctuation">,</span> interest_words <span class="token keyword">in</span> user_profile<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    result_table <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>   <span class="token comment"># 电影id: [0.2, 0.5]</span>
    <span class="token keyword">for</span> interest_word<span class="token punctuation">,</span> interest_weight <span class="token keyword">in</span> interest_words<span class="token punctuation">:</span>
        related_movies <span class="token operator">=</span> inverted_table<span class="token punctuation">[</span>interest_word<span class="token punctuation">]</span>
        <span class="token keyword">for</span> mid<span class="token punctuation">,</span> relate_weight <span class="token keyword">in</span> related_movies<span class="token punctuation">:</span>
            _ <span class="token operator">=</span> result_table<span class="token punctuation">.</span>get<span class="token punctuation">(</span>mid<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            _<span class="token punctuation">.</span>append<span class="token punctuation">(</span>interest_weight<span class="token punctuation">)</span>    <span class="token comment">#只考虑用户的兴趣程度</span>
            <span class="token comment"># _.append(related_weight)   # 只考虑兴趣词与电影的关联程度</span>
            <span class="token comment"># _.append(interest_weight * related_weight)     # 二者都考虑</span>
            result_table<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>mid<span class="token punctuation">,</span> _<span class="token punctuation">)</span>
    
    rs_result <span class="token operator">=</span> <span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> result_table<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
    rs_result <span class="token operator">=</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>rs_result<span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">100</span><span class="token punctuation">]</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span>
    pprint<span class="token punctuation">(</span>rs_result<span class="token punctuation">)</span>
    <span class="token keyword">break</span>
</code></pre> 
<p>看下最终结果：<br> <img src="https://images2.imgbox.com/57/e2/yZTqavEr_o.png" alt="在这里插入图片描述"></p> 
<p>这样， 我们就完成了整个推荐的过程了，关于详细的代码， 可以去我下面的GitHub链接。<br> 是不是思路比较简单？ 但是实施起来，也是有很多的小细节， 且与协同过滤又有很大的不同了， 这个方法感觉也可以用到粗排的阶段。算是提供一种思路吧。</p> 
<p>下面还想介绍两种技术， 这个可以用在物品冷启动问题里面， 也就是对于一个新物品到来的时候， 这时候用户都没有看过，用户是无法打标签的， 这时候的物品可能只有系统给出的一些标签，比如主题，演员啊啥的。 这时候要把这个新的物品推荐给用户的时候， 我们需要通过两种技术：</p> 
<ul><li>Word2Vec: 这个可以根据得到电影标签的词向量， 根据这个词向量， 就能够得到tag之间的相似性， 这样就能够根据用户看过的某个电影， 得到这个电影的标签， 然后根据这些标签得到与其近似的标签， 然后得到这些近似标签下的电影对该用户产生推荐</li><li>Doc2Vec：这个可以根据电影的所有标签， 训练一个模型来得到最终电影的影片向量， 根据这个， 就能够直接计算用户看过的某个电影与其他电影的相似性， 然后根据这个相似性给用户推荐最相似的几篇文章。这个也是基于内容计算物品embedding的一种方式， 之前设计新闻推荐比赛的教程里面，有个自带的embedding，或许就是通过这种方式计算的。</li></ul> 
<p>下面我们具体来看一下这两个技术吧。</p> 
<h3><a id="5__291"></a>5. 物品的冷启动处理</h3> 
<h4><a id="51_Word2Vec_292"></a>5.1 Word2Vec</h4> 
<p>关于这个技术， 在学习NLP的时候写过的文章里面都整理过了， 这里再来简单的走一遍这个技术， 然后掉包来实现一下。</p> 
<p>利用Word2Vec可以计算电影所有标签词之间的关系程度， 可用于计算电影之间的相似度。</p> 
<h5><a id="511_297"></a>5.1.1原理简介</h5> 
<p>word2vec是google在2013年开源的一个NLP(Natural Language Processing自然语言处理) 工具，它的特点是将所有的词向量化，这样词与词之间就可以定量的去度量他们之间的关系，挖掘词之间的联系。</p> 
<p>one-hot vector VS. word vector</p> 
<ul><li>用向量来表示词并不是word2vec的首创</li><li>最早的词向量是很冗长的，它使用是词向量维度大小为整个词汇表的大小，对于每个具体的词汇表中的词，将对应的位置置为1。</li><li>比如下面5个词组成词汇表，词"Queen"的序号为2， 那么它的词向量就是(0,1,0,0,0)同样的道理，词"Woman"的词向量就是(0,0,0,1,0)。<br> <img src="https://images2.imgbox.com/55/a9/lue0Dz4r_o.png" alt="在这里插入图片描述"></li></ul> 
<p>one hot vector的问题</p> 
<ul><li>如果词汇表非常大，如达到万级别，这样每个词都用万维的向量来表示浪费内存。这样的向量除了一个位置是1，其余位置全部为0，表达效率低(稀疏)，需要降低词向量的维度</li><li>难以发现词之间的关系，以及难以捕捉句法（结构）和语义（意思）之间的关系</li><li>Dristributed representation可以解决One hot representation的问题，它的思路是通过训练，将每个词都映射到一个较短的词向量上来。所有的这些词向量就构成了向量空间，进而可以用普通的统计学的方法来研究词与词之间的关系。这个较短的词向量维度一般需要我们在训练时指定。</li><li>比如下图我们将词汇表里的词用"Royalty(王位)",“Masculinity(男性气质)”, "Femininity(女性气质)"和"Age"4个维度来表示，King这个词对应的词向量可能是(0.99,0.99,0.05,0.7)。当然在实际情况中，我们并不一定能对词向量的每个维度做一个很好的解释。<br> <img src="https://images2.imgbox.com/33/f3/GiaqUCWO_o.png" alt="在这里插入图片描述"><br> 有了用Dristributed representation表示的较短的词向量，就可以较容易的分析词之间的关系，比如将词的维度降维到2维，用下图的词向量表示我们的词时，发现：<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
          
          
            K 
           
          
            i 
           
          
            n 
           
          
            g 
           
          
         
           ⃗ 
          
         
        
          − 
         
         
          
          
            M 
           
          
            a 
           
          
            n 
           
          
         
           ⃗ 
          
         
        
          + 
         
         
          
          
            W 
           
          
            o 
           
          
            m 
           
          
            a 
           
          
            n 
           
          
         
           ⃗ 
          
         
        
          = 
         
         
          
          
            Q 
           
          
            u 
           
          
            e 
           
          
            e 
           
          
            n 
           
          
         
           ⃗ 
          
         
        
       
         \vec{King} - \vec{Man} + \vec{Woman} = \vec{Queen} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.16077em; vertical-align: -0.19444em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.96633em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.07153em;">K</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right: 0.03588em;">g</span></span></span><span class="" style="top: -3.25233em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.2355em;"><span class="overlay" style="height: 0.714em; width: 0.471em;"> 
             <svg width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"> 
              <path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path> 
             </svg></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.04966em; vertical-align: -0.08333em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.96633em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.10903em;">M</span><span class="mord mathdefault">a</span><span class="mord mathdefault">n</span></span></span><span class="" style="top: -3.25233em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.2355em;"><span class="overlay" style="height: 0.714em; width: 0.471em;"> 
             <svg width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"> 
              <path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path> 
             </svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.96633em; vertical-align: 0em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.96633em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.13889em;">W</span><span class="mord mathdefault">o</span><span class="mord mathdefault">m</span><span class="mord mathdefault">a</span><span class="mord mathdefault">n</span></span></span><span class="" style="top: -3.25233em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.2355em;"><span class="overlay" style="height: 0.714em; width: 0.471em;"> 
             <svg width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"> 
              <path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path> 
             </svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.16077em; vertical-align: -0.19444em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.96633em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault">Q</span><span class="mord mathdefault">u</span><span class="mord mathdefault">e</span><span class="mord mathdefault">e</span><span class="mord mathdefault">n</span></span></span><span class="" style="top: -3.25233em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.2355em;"><span class="overlay" style="height: 0.714em; width: 0.471em;"> 
             <svg width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"> 
              <path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path> 
             </svg></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em;"><span class=""></span></span></span></span></span></span></span></span></span><br> <img src="https://images2.imgbox.com/14/e4/5QRL9Lce_o.png" alt="在这里插入图片描述"></li></ul> 
<h5><a id="512__CBOWSkipGram_316"></a>5.1.2 两个实现模型 CBOW和Skip-Gram</h5> 
<p>拥有差不多上下文的两个单词的意思往往是相近的， 所以这俩模型都是基于一个中心词和上下文词构成关系。</p> 
<p>CBOW把一个词从词窗剔除。在CBOW下给定n词围绕着词w，word2vec预测一个句子中其中一个缺漏的词c，即以概率<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         p 
        
       
         ( 
        
       
         c 
        
       
         ∣ 
        
       
         w 
        
       
         ) 
        
       
      
        p(c|w) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord mathdefault">c</span><span class="mord">∣</span><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span><span class="mclose">)</span></span></span></span></span>来表示。相反地，Skip-gram给定词窗中的文本，预测当前的词<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         p 
        
       
         ( 
        
       
         w 
        
       
         ∣ 
        
       
         c 
        
       
         ) 
        
       
      
        p(w|c) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span><span class="mord">∣</span><span class="mord mathdefault">c</span><span class="mclose">)</span></span></span></span></span>。<br> <img src="https://images2.imgbox.com/6f/d2/NbLMz4GA_o.png" alt="在这里插入图片描述"></p> 
<ul><li> <p>功能：通过上下文预测当前词出现的概率</p> </li><li> <p>原理分析</p> <p>假设文本如下：“the florid prose of <strong>the</strong> nineteenth century.”</p> <p>想象有个滑动窗口，中间的词是关键词，两边为相等长度的文本来帮助分析。文本的长度为7，就得到了7个one-hot向量，作为神经网络的输入向量，训练目标是：最大化在给定前后文本情况下输出正确关键词的概率，比如给定(“prose”,“of”,“nineteenth”,“century”)的情况下，要最大化输出"the"的概率，用公式表示就是</p> <p>P(“the”|(“prose”,“of”,“nineteenth”,“century”))</p> </li><li> <p>特性</p> 
  <ul><li>hidden layer只是将权重求和，传递到下一层，是线性的</li></ul> </li></ul> 
<p>Skip-gram和CBOW相反，则我们要求的概率就变为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         P 
        
       
         ( 
        
       
         C 
        
       
         o 
        
       
         n 
        
       
         t 
        
       
         e 
        
       
         x 
        
       
         t 
        
       
         ( 
        
       
         w 
        
       
         ) 
        
       
         ∣ 
        
       
         w 
        
       
         ) 
        
       
      
        P(Context(w)|w) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault" style="margin-right: 0.13889em;">P</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right: 0.07153em;">C</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault">x</span><span class="mord mathdefault">t</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span><span class="mclose">)</span><span class="mord">∣</span><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span><span class="mclose">)</span></span></span></span></span>， 是根据中心词预测上下文词, 具体的细节和公式推导可以参考NLP那里的几篇文章。<br> <img src="https://images2.imgbox.com/8e/33/5Q7Qb0I4_o.png" alt="在这里插入图片描述"><br> word2vec算法可以计算出每个词语的一个词向量，我们可以用它来表示该词的语义层面的含义。 下面就是通过电影的每个标签， 来计算他们之间的相关关系。看一下Word2Vec的具体使用过程。</p> 
<p>思路是这样：得到电影标签的词向量， 根据这个词向量， 就能够得到tag之间的相似性， 这样就能够根据用户看过的某个电影， 得到这个电影的标签， 然后根据这些标签得到与其近似的标签， 然后得到这些近似标签下的电影对该用户产生推荐， 我们依然是直接用<code>gensim.models</code>里面的Word2Vec模型。使用很简单：</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> gensim<span class="token punctuation">.</span>models <span class="token keyword">import</span> Word2Vec
<span class="token comment"># 由于前面我们已经得到了每部影片的tags，物品画像里面。 所以这里我们就可以直接建立word2vec模型， 来进行标签的词向量计算</span>
sentences <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>movie_profile<span class="token punctuation">[</span><span class="token string">"profile"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values<span class="token punctuation">)</span>   <span class="token comment"># 二维列表  每个元素是字符串</span>
<span class="token comment"># 这里可以直接建立模型</span>
model <span class="token operator">=</span> Word2Vec<span class="token punctuation">(</span>sentences<span class="token punctuation">,</span> window<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> min_count<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">iter</span><span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token comment"># 建立完了之后， 对于某个电影的某个tag， 我们就可以得到与其相似的N个词</span>
words <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"words: "</span><span class="token punctuation">)</span>
ret <span class="token operator">=</span> model<span class="token punctuation">.</span>wv<span class="token punctuation">.</span>most_similar<span class="token punctuation">(</span>positive<span class="token operator">=</span><span class="token punctuation">[</span>words<span class="token punctuation">]</span><span class="token punctuation">,</span> topn<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>   <span class="token comment"># 找到最相似的n 个词</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span>
</code></pre> 
<p>看下结果， 给定某个关键词， 就可以返回与其相似的N个关键词过来：</p> 
<p><img src="https://images2.imgbox.com/50/d9/I8QhfuF0_o.png" alt="在这里插入图片描述"><br> 在使用gensim训练word2vec的时候，有几个比较重要的参数：</p> 
<ul><li><code>size:</code> 表示词向量的维度。</li><li><code>window</code>：决定了目标词会与多远距离的上下文产生关系。</li><li><code>sg</code>: 如果是0，则是CBOW模型，是1则是Skip-Gram模型。</li><li><code>workers:</code> 表示训练时候的线程数量</li><li><code>min_count:</code> 设置最小的词频</li><li><code>iter:</code> 训练时遍历整个数据集的次数</li></ul> 
<p>注意训练的时候输入的语料库一定要是字符组成的二维数组，如：[[‘北’, ‘京’, ‘你’, ‘好’], [‘上’, ‘海’, ‘你’, ‘好’]]。使用模型的时候有一些默认值，可以通过在Jupyter里面通过Word2Vec??查看。在之前设计推荐系统竞赛内容的时候， 也用到过这个模型，那个地方是基于用户点击的文章历史序列， 来求的每篇文章之间的序列上的一个关联， 得到的一个embedding向量， 更像是item2vec。 和这里的使用情况还不太一样， 感兴趣的可以看一下<a href="http://datawhale.club/t/topic/201" rel="nofollow">新闻推荐之特征工程</a>。</p> 
<h4><a id="52_Doc2Vec_365"></a>5.2 Doc2Vec</h4> 
<p>Doc2Vec是建立在Word2Vec上的，用于直接计算以文档为单位的文档向量，doc2vec的目标是创建文档的向量化表示，而不管其长度如何。 但与单词不同的是，文档并没有单词之间的逻辑结构，因此必须找到另一种方法。</p> 
<p>采用了Word2Vec的两个模型， 但是添加了另一个向量ID。</p> 
<ol><li> <p>段落向量的分布式记忆的版本(PV-DM)<br> <img src="https://images2.imgbox.com/0a/ce/Ci2Io2QQ_o.png" alt="在这里插入图片描述"><br> 这个是CBOW模型的一个小扩展。 它不是仅是使用一些单词来预测下一个单词,还添加了另一个特征向量，即文档Id。因此，当训练单词向量W时，也训练文档向量D，并且在训练结束时，它包含了文档的向量化表示。</p> </li><li> <p>段落向量的分布式词袋版本（PV-DBOW）</p> <p><img src="https://images2.imgbox.com/01/10/y5ISUCF3_o.png" alt="在这里插入图片描述"><br> 这种就类似于skip-gram模型了。</p> </li></ol> 
<p>doc2vec模型的使用方式：对于训练，它需要一组文档。 为每个单词生成词向量W，并为每个文档生成文档向量D. 该模型还训练softmax隐藏层的权重。 在推理阶段，可以呈现新文档，并且固定所有权重以计算文档向量。</p> 
<p>这里我们将一部电影的所有标签词，作为整个文档，这样可以计算出每部电影的向量，通过计算向量之间的距离，来判断用于计算电影之间的相似程度。这里直接调包来实现这个模型。</p> 
<p>根据这个， 就能够直接计算用户看过的某个电影与其他电影的相似性， 然后根据这个相似性给用户推荐最相似的几篇文章。这个也就是基于内容计算影片embedding的一种方式。</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> gensim<span class="token punctuation">.</span>models<span class="token punctuation">.</span>doc2vec <span class="token keyword">import</span> Doc2Vec<span class="token punctuation">,</span> TaggedDocument
<span class="token keyword">from</span> gensim<span class="token punctuation">.</span>test<span class="token punctuation">.</span>utils <span class="token keyword">import</span> get_tmpfile

<span class="token comment"># 建立文档， words就是影片的tags， tags就是影片的id</span>
documents <span class="token operator">=</span> <span class="token punctuation">[</span>TaggedDocument<span class="token punctuation">(</span>words<span class="token punctuation">,</span> <span class="token punctuation">[</span>movie_id<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> movie_id<span class="token punctuation">,</span> words <span class="token keyword">in</span> movie_profile<span class="token punctuation">[</span><span class="token string">"profile"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>iteritems<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

<span class="token comment"># 训练Doc2Vec模型</span>
model <span class="token operator">=</span> Doc2Vec<span class="token punctuation">(</span>documents<span class="token punctuation">,</span> vector_size<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> window<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> min_count<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> wordkers<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> epochs<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>

<span class="token comment"># 获取某个电影的tages</span>
words <span class="token operator">=</span> movie_profile<span class="token punctuation">[</span><span class="token string">"profile"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>words<span class="token punctuation">)</span>
<span class="token comment"># 拿到该影片的Doc2vec向量</span>
inferred_vector <span class="token operator">=</span> model<span class="token punctuation">.</span>infer_vector<span class="token punctuation">(</span>words<span class="token punctuation">)</span>
sims <span class="token operator">=</span> model<span class="token punctuation">.</span>docvecs<span class="token punctuation">.</span>most_similar<span class="token punctuation">(</span><span class="token punctuation">[</span>inferred_vector<span class="token punctuation">]</span><span class="token punctuation">,</span> topn<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sims<span class="token punctuation">)</span>
</code></pre> 
<p>看下结果：<br> <img src="https://images2.imgbox.com/3c/d6/2f5Co6d3_o.png" alt="在这里插入图片描述"><br> 给定一篇文档， 就会返回与其相似的N篇文档。</p> 
<p>D2V主要参数解释：</p> 
<blockquote> 
 <p>model_dm = Doc2Vec(x_train,min_count=1, window = 3, size = size, sample=1e-3, negative=5, workers=4)</p> 
 <ul><li>min_count：忽略所有单词中单词频率小于这个值的单词。</li><li>window：窗口的尺寸。（句子中当前和预测单词之间的最大距离）</li><li>size:特征向量的维度</li><li>sample：高频词汇的随机降采样的配置阈值，默认为1e-3，范围是(0,1e-5)。</li><li>negative: 如果&gt;0,则会采用negativesampling，用于设置多少个noise words（一般是5-20）。默认值是5。</li><li>workers：用于控制训练的并行数。</li></ul> 
</blockquote> 
<p>这就是所有的基于内容推荐的内容了。</p> 
<h3><a id="6__417"></a>6. 小总</h3> 
<p>这里简单的小总一下， 这篇文章主要是围绕着基于内容推荐的思路进行展开的， 这个思路其实很简单，就是刻画出物品的特点和用户的兴趣点来， 根据用户的兴趣点去推荐相应的物品就行。 具体实施的时候有很多细节， 这里拿了一个MovieLens数据集走了一遍这个流程， 并借着这个机会又温习了一下TF-IDF技术， Word2Vec技术和Doc2Vec技术。</p> 
<p><strong>参考</strong>：</p> 
<ul><li><a href="https://www.bilibili.com/video/BV1qK4y1479r?p=43" rel="nofollow">B站上的一个推荐系统视频（讲的挺不错的）</a></li><li><a href="http://datawhale.club/t/topic/201" rel="nofollow">天池新闻推荐赛</a></li><li><a href="https://blog.csdn.net/qq_16633405/article/details/80480300">Word2Vec&amp;Doc2Vec总结</a></li></ul> 
<p>整理这篇文章的同时， 也刚建立了一个GitHub项目， 准备后面把各种主流的推荐模型复现一遍，并用通俗易懂的语言进行注释和逻辑整理， 今天的基于内容推荐的数据集和代码已经上传， 感兴趣的可以看一下 😉</p> 
<p>筋斗云：<a href="https://github.com/zhongqiangwu960812/AI-RecommenderSystem">https://github.com/zhongqiangwu960812/AI-RecommenderSystem</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ad31f0b00a6cebe0fce6767f35e2ac35/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">python read函数返回值_python read()方法定义及使用（实例解析）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/411c4958be342b6ea12fb19f7aa9bbc8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">安装linux 系统出现An Unknown Error Has Occurred报错原因和解决方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>