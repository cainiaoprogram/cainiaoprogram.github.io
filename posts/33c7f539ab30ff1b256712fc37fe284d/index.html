<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ROS2（三）使用colcon编译package - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ROS2（三）使用colcon编译package" />
<meta property="og:description" content="官方指导文档为：
https://docs.ros.org/en/humble/Tutorials/Beginner-Client-Libraries/Colcon-Tutorial.html
1. 安装colcon 在安装ros2时，如果按照官方指导操作应该是已经安装了colcon，可以使用命令colcon -h，测试是否已经有colcon，如果没有安装，则执行以下命令进行安装：
sudo apt install python3-colcon-common-extensions colcon是一个ROS构建的集成工具，包括：catkin_make\catkin_make_isolated\catkin_tools和ament_tools；colcon支持多种构建方式，推荐的构建方式是ament_cmake和ament_python，也支持纯cmake包；
2. 创建工作空间 ROS的工作空间是有固定的结构的。一般情况在/home目录下创建工作空间文件夹，例如：ros2_ws，则ros2_ws就是工作空间根目录。
mkdir -p ~/ros2_ws/src cd ~/ros2_ws 工作空间目录下一定要有一个src文件夹，里面放置ROS package的源代码。
3. 编译工作空间 在工作空间根目录下进行编译，使用如下命令：
colcon build 只创建一个空的src文件夹，也可以构建，会自动生成其他文件夹：
├── build
├── install
├── log
└── src
4.设置环境变量 当colcon编译成功后，会自动生成对应install文件夹，其中包含setup.sh文件，在使用编译的库或者程序前，都需要将其路径加入到环境变量中，在install文件夹下运行如下命令。
source setup.bash 这样就可以把编译的库添加到系统环境中。
如果不需要编译某个package时，只需要在其对应的文件夹下创建一个名称为COLCON_IGNORE的空文件，则该文件则不会被编译。
5.package.xml 下面是默认的package.xml内容：
&lt;?xml version=&#34;1.0&#34;?&gt; &lt;?xml-model href=&#34;http://download.ros.org/schema/package_format3.xsd&#34; schematypens=&#34;http://www.w3.org/2001/XMLSchema&#34;?&gt; &lt;package format=&#34;3&#34;&gt; &lt;name&gt;my_package&lt;/name&gt; &lt;version&gt;0.0.0&lt;/version&gt; &lt;description&gt;TODO: Package description&lt;/description&gt; &lt;maintainer email=&#34;user@todo.todo&#34;&gt;user&lt;/maintainer&gt; &lt;license&gt;TODO: License declaration&lt;/license&gt; &lt;buildtool_depend&gt;ament_cmake&lt;/buildtool_depend&gt; &lt;test_depend&gt;ament_lint_auto&lt;/test_depend&gt; &lt;test_depend&gt;ament_lint_common&lt;/test_depend&gt; &lt;export&gt; &lt;build_type&gt;ament_cmake&lt;/build_type&gt; &lt;/export&gt; &lt;/package&gt; name：包的名称
version：包的版本" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/33c7f539ab30ff1b256712fc37fe284d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-23T10:25:48+08:00" />
<meta property="article:modified_time" content="2023-04-23T10:25:48+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ROS2（三）使用colcon编译package</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>官方指导文档为：</p> 
<p><a href="https://docs.ros.org/en/humble/Tutorials/Beginner-Client-Libraries/Colcon-Tutorial.html" rel="nofollow" title="https://docs.ros.org/en/humble/Tutorials/Beginner-Client-Libraries/Colcon-Tutorial.html">https://docs.ros.org/en/humble/Tutorials/Beginner-Client-Libraries/Colcon-Tutorial.html</a></p> 
<h2>1. 安装colcon</h2> 
<p>在安装ros2时，如果按照官方指导操作应该是已经安装了colcon，可以使用命令<strong><span style="color:#fe2c24;">colcon -h</span></strong>，测试是否已经有colcon，如果没有安装，则执行以下命令进行安装：</p> 
<pre><code>sudo apt install python3-colcon-common-extensions</code></pre> 
<p><strong><span style="color:#fe2c24;">colcon</span></strong>是一个ROS构建的集成工具，包括：<strong><span style="color:#fe2c24;">catkin_make\catkin_make_isolated\catkin_tools</span></strong>和<strong><span style="color:#fe2c24;">ament_tools</span></strong>；colcon支持多种构建方式，<strong>推荐的构建方式是<span style="color:#fe2c24;">ament_cmake</span>和<span style="color:#fe2c24;">ament_python</span></strong>，也支持纯cmake包；</p> 
<h2>2. 创建工作空间</h2> 
<p>ROS的工作空间是有固定的结构的。一般情况在<span style="color:#fe2c24;">/home</span>目录下创建工作空间文件夹，例如：<span style="color:#fe2c24;">ros2_ws</span>，<strong>则ros2_ws就是工作空间根目录</strong>。</p> 
<pre><code>mkdir -p ~/ros2_ws/src
cd ~/ros2_ws</code></pre> 
<p>工作空间目录下一定要有一个<span style="color:#fe2c24;">src文件夹</span>，里面放置ROS package的源代码。</p> 
<h2>3. 编译工作空间</h2> 
<p>在工作空间根目录下进行编译，使用如下命令：</p> 
<pre><code>colcon build</code></pre> 
<p>只创建一个空的src文件夹，也可以构建，会自动生成其他文件夹：</p> 
<blockquote> 
 <p>├── build<br> ├── install<br> ├── log<br> └── src</p> 
</blockquote> 
<h2> 4.设置环境变量</h2> 
<p>当colcon编译成功后，会自动生成对应install文件夹，其中包含setup.sh文件，在使用编译的库或者程序前，都需要将其路径加入到环境变量中，在install文件夹下运行如下命令。</p> 
<pre><code>source setup.bash</code></pre> 
<p>这样就可以把编译的库添加到系统环境中。</p> 
<p>如果不需要编译某个package时，只需要在其对应的文件夹下创建一个名称为COLCON_IGNORE的空文件，则该文件则不会被编译。</p> 
<h2>5.package.xml</h2> 
<p>下面是默认的package.xml内容：</p> 
<pre><code class="hljs">&lt;?xml version="1.0"?&gt;
&lt;?xml-model
   href="http://download.ros.org/schema/package_format3.xsd"
   schematypens="http://www.w3.org/2001/XMLSchema"?&gt;
&lt;package format="3"&gt;
 &lt;name&gt;my_package&lt;/name&gt;
 &lt;version&gt;0.0.0&lt;/version&gt;
 &lt;description&gt;TODO: Package description&lt;/description&gt;
 &lt;maintainer email="user@todo.todo"&gt;user&lt;/maintainer&gt;
 &lt;license&gt;TODO: License declaration&lt;/license&gt;

 &lt;buildtool_depend&gt;ament_cmake&lt;/buildtool_depend&gt;

 &lt;test_depend&gt;ament_lint_auto&lt;/test_depend&gt;
 &lt;test_depend&gt;ament_lint_common&lt;/test_depend&gt;

 &lt;export&gt;
   &lt;build_type&gt;ament_cmake&lt;/build_type&gt;
 &lt;/export&gt;
&lt;/package&gt;</code></pre> 
<p>name：包的名称</p> 
<p>version：包的版本</p> 
<p>description：包的描述</p> 
<p>maintainer：填写email和拥有者</p> 
<h3>5.1.增加依赖项</h3> 
<p>可以在<span style="color:#fe2c24;">&lt;buildtool_depend&gt;ament_cmake&lt;/buildtool_depend&gt;</span>下面增加依赖项；</p> 
<p>例如：</p> 
<p><span style="color:#fe2c24;">&lt;depend&gt;rclcpp&lt;/depend&gt;<br> &lt;depend&gt;std_msgs&lt;/depend&gt;</span></p> 
<p>表示包的构建和运行需要rclcpp和std_msgs。</p> 
<h2>6.CMakeLists.txt</h2> 
<p>与package对应的，在CMakeLists.txt中增加：</p> 
<p><span style="color:#fe2c24;">find_package(rclcpp REQUIRED)<br> find_package(std_msgs REQUIRED)</span></p> 
<p>增加可执行文件说明，例如需要编译的可执行文件为talker，则在CMakeLists.txt中增加：</p> 
<p><span style="color:#fe2c24;">add_executable(talker src/publisher_member_function.cpp)<br> ament_target_dependencies(talker rclcpp std_msgs)</span></p> 
<p>再再CMakeLists.txt中增加install(TARGETS...)操作，以便ros2 run可以发现并执行目标软件，增加如：</p> 
<p><span style="color:#fe2c24;">install(TARGETS<br>   talker<br>   DESTINATION lib/${PROJECT_NAME})</span></p> 
<p>则实例的CMakeLists.txt为：</p> 
<pre><code class="hljs">cmake_minimum_required(VERSION 3.5)
project(cpp_pubsub)

# Default to C++14
if(NOT CMAKE_CXX_STANDARD)
  set(CMAKE_CXX_STANDARD 14)
endif()

if(CMAKE_COMPILER_IS_GNUCXX OR CMAKE_CXX_COMPILER_ID MATCHES "Clang")
  add_compile_options(-Wall -Wextra -Wpedantic)
endif()

find_package(ament_cmake REQUIRED)
find_package(rclcpp REQUIRED)
find_package(std_msgs REQUIRED)

add_executable(talker src/publisher_member_function.cpp)
ament_target_dependencies(talker rclcpp std_msgs)

install(TARGETS
  talker
  DESTINATION lib/${PROJECT_NAME})

ament_package()</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/26d6cb2841656fe43fe9815868a90b68/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Java中如何为HTTP请求设置代理？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f8c00396d03914433854f77877f4fead/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Python [ ]、[:]和[::]的用法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>