<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>C#内存泄漏原因整理 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="C#内存泄漏原因整理" />
<meta property="og:description" content="一直以为C#不存在内存泄漏的问题，直到遇到一个程序运行一段时间后出现卡顿情况，才发现程序出现了内存泄漏问题。在网上看到了几篇文章，整理下C#内存泄露可能的原因，提醒自己以后开发时注意下，后续遇到其他情况再补充完善。
1.非托管资源（内存、控件等）
因为非托管资源所占的内存不能自动回收，所以使用后必须手动回收，否则程序运行多次很容易造成内存泄露。
// 完成托管平台到win32平台的转换 IntPtr lpInBuffer = Marshal.AllocHGlobal(size); Marshal.StructureToPtr(param, lpInBuffer, false); …… // 释放win32平台的内存资源 Marshal.FreeHGlobal(lpInBuffer); 在使用的函数开头写下using 就可以不用担心内存泄漏问题，简化复杂管理问题，异常，多return，continue，break，goto之类的跳转等。
using var xxx = new XXX();
如可以在 using 语句中声明对象：
using (Font font1 = new Font(&#34;Arial&#34;, 10.0f)) { // use font1 } 2.静态变量
静态变量中的成员所占的内存，如果不手动处理是不会释放内存的，单态模式的对象也是静态的，所以需要特别注意。因为静态对象中的成员所占的内存不会释放，如果此成员是以个对象，同时此对象中的成员所占的内存也不会释放，以此类推，如果此对象很复杂，而且是静态的就很容易造成内存泄露。
3.Dispose方法没被调用，或Dispose方法没有处理对象的释放。这样也会造成内存泄露
4.当一个查询语句查询出来的数据量很大，达到几百万条数据时存放到datatable 或dataset中也会造成内存溢出，这是可以采用分页查询等其他方法来解决。
5.未退订的事件
参考网页：
.NET资源泄露与处理方案
浅谈.net 内存泄露和内存溢出
8 Ways You can Cause Memory Leaks in .NET" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/c1d221ac3129bed0c478ff30209bbbf7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-06T10:41:44+08:00" />
<meta property="article:modified_time" content="2023-02-06T10:41:44+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">C#内存泄漏原因整理</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="kdocs-document"> 
 <p style="">一直以为C#不存在内存泄漏的问题，直到遇到一个程序运行一段时间后出现卡顿情况，才发现程序出现了内存泄漏问题。在网上看到了几篇文章，整理下C#内存泄露可能的原因，提醒自己以后开发时注意下，后续遇到其他情况再补充完善。</p> 
 <p style="text-align:left;">1.非托管资源（内存、控件等）</p> 
 <p style="text-align:left;">因为非托管资源所占的内存不能自动回收，所以使用后必须手动回收，否则程序运行多次很容易造成内存泄露。</p> 
 <pre class="kdocs-csharp"><code class="language-csharp">// 完成托管平台到win32平台的转换
IntPtr lpInBuffer = Marshal.AllocHGlobal(size);
Marshal.StructureToPtr(param, lpInBuffer, false);
……
// 释放win32平台的内存资源
Marshal.FreeHGlobal(lpInBuffer);</code></pre> 
 <p style="">在使用的函数开头写下using 就可以不用担心内存泄漏问题，简化复杂管理问题，异常，多return，continue，break，goto之类的跳转等。</p> 
 <p style="">using var xxx = new XXX();</p> 
 <p style="">如可以在 using 语句中声明对象：</p> 
 <pre class="kdocs-csharp"><code class="language-csharp">using (Font font1 = new Font("Arial", 10.0f))
{
   // use font1
}</code></pre> 
 <p style="">2.静态变量</p> 
 <p style="">静态变量中的成员所占的内存，如果不手动处理是不会释放内存的，单态模式的对象也是静态的，所以需要特别注意。因为静态对象中的成员所占的内存不会释放，如果此成员是以个对象，同时此对象中的成员所占的内存也不会释放，以此类推，如果此对象很复杂，而且是静态的就很容易造成内存泄露。</p> 
 <p style="">3.Dispose方法没被调用，或Dispose方法没有处理对象的释放。这样也会造成内存泄露</p> 
 <p style="">4.当一个查询语句查询出来的数据量很大，达到几百万条数据时存放到datatable 或dataset中也会造成内存溢出，这是可以采用分页查询等其他方法来解决。</p> 
 <p style="">5.未退订的事件</p> 
 <p style=""></p> 
 <p style="">参考网页：</p> 
 <p style="text-align:left;"><a class="kdocs-link" style="color:#0A6CFF;" href="https://www.cnblogs.com/yokeqi/p/11920706.html" rel="nofollow noopener noreferrer" target="_blank"><span class="kdocs-bold" style="font-weight:bold;">.NET资源泄露与处理方案</span></a></p> 
 <p style="text-align:left;"><a class="kdocs-link" style="color:#0A6CFF;" href="https://blog.csdn.net/fhzh520/article/details/7872305" target="_blank" rel="noopener noreferrer"><span class="kdocs-bold" style="font-weight:bold;">浅谈.net 内存泄露和内存溢出</span></a></p> 
 <p style="text-align:left;"><a class="kdocs-link" style="color:#0A6CFF;" href="https://michaelscodingspot.com/ways-to-cause-memory-leaks-in-dotnet/" rel="nofollow noopener noreferrer" target="_blank">8 Ways You can Cause Memory Leaks in .NET</a></p> 
 <p style=""></p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b890d6b4cfb96948d462cfd7cb1db4f5/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">文献阅读（10）：深度神经网络 FPGA 设计</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2b0dbfe6bb09df444b75ae8136a85abb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">快速安装部署hadoop-3.3.1-单机版</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>