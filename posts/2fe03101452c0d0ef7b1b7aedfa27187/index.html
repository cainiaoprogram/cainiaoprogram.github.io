<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>java将数据库数据导出为Excel文件 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="java将数据库数据导出为Excel文件" />
<meta property="og:description" content="一、开发环境 ssm框架；MySQL；JDK1.7；Tomcat7.0 Apache POI组件操作（自导jar包），官网下载地址：点击打开链接 二、具体内容 2.1、数据库数据 2.2、UserVOMapper.xml 核心代码 &lt;select id=&#34;queryExportUser&#34; resultMap=&#34;BaseResultMap&#34;&gt; select * from user u &lt;/select&gt; 2.3、UserVOMapper.java 核心代码 List&lt;UserVO&gt; queryExportUser(); 2.4、service层代码（最重要） package com.gusy.muban.service; import java.util.List; import org.apache.poi.ss.usermodel.Cell; import org.apache.poi.ss.usermodel.CellStyle; import org.apache.poi.ss.usermodel.HorizontalAlignment; import org.apache.poi.ss.usermodel.Row; import org.apache.poi.ss.usermodel.Sheet; import org.apache.poi.ss.usermodel.Workbook; import org.apache.poi.xssf.streaming.SXSSFWorkbook; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.stereotype.Service; import com.gusy.muban.dao.UserVOMapper; import com.gusy.muban.model.UserVO; /** * @author gusy */ @Service public class UserService { @Autowired private UserVOMapper mapper; /** * 导出excel * @throws Exception */ public Workbook queryExportUser() throws Exception{ List&lt;UserVO&gt; list=mapper." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/2fe03101452c0d0ef7b1b7aedfa27187/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-05-02T16:09:27+08:00" />
<meta property="article:modified_time" content="2017-05-02T16:09:27+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">java将数据库数据导出为Excel文件</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h4>一、开发环境<span style="white-space:pre"> </span></h4> 
<div> 
 <span style="font-size:14px"><span style="white-space:pre"></span>ssm框架；MySQL；JDK1.7；Tomcat7.0</span> 
</div> 
<div> 
 <span style="font-size:14px"><span style="white-space:pre"><a target="_blank" href="http://blog.csdn.net/lee0723/article/details/39617895" style="color:rgb(0,0,0); text-decoration:none; font-family:'Microsoft YaHei'; line-height:30px" rel="noopener noreferrer"><span style="white-space:pre"></span>Apache POI组件操作</a>（</span>自导jar包<span style="white-space:pre">），官网下载地址：<a target="_blank" href="https://www.apache.org/dyn/closer.lua/poi/release/bin/poi-bin-3.16-20170419.tar.gz" rel="nofollow noopener noreferrer">点击打开链接</a></span></span> 
</div> 
<div style="text-align:left"> 
 <span style="font-size:14px"><img src="https://images2.imgbox.com/76/cd/TXRe2GVW_o.png" align="middle" alt=""><br> </span> 
</div> 
<h4><span style="font-size:14px"><strong>二、具体内容</strong></span></h4> 
<h5><span style="font-size:14px"><strong>2.1、数据库数据</strong></span></h5> 
<div> 
 <span style="font-size:14px"><strong><span style="white-space:pre"><img src="https://images2.imgbox.com/af/c4/j7nXjmGT_o.png" alt=""></span></strong></span> 
</div> 
<div> 
 <span style="font-size:14px"><strong><span style="white-space:pre"><img src="" alt=""></span></strong></span> 
</div> 
<h5><span style="font-size:14px"><strong><span style="white-space:pre">2</span>.2、UserVOMapper.xml 核心代码</strong></span></h5> 
<div> 
 <span style="font-size:14px"><strong><img src="" alt=""></strong></span> 
 <pre><code class="language-java">  &lt;select id="queryExportUser" resultMap="BaseResultMap"&gt;
  	select * from user u
  &lt;/select&gt;</code></pre> 
</div> 
<h5><span style="font-size:14px"><strong>2.3、<span style="font-size:14px">UserVOMapper.java 核心</span>代码</strong></span><span style="font-size:14px; white-space:pre"></span></h5> 
<div> 
 <span style="font-size:14px"><strong><span style="white-space:pre"></span></strong></span> 
 <pre><code class="language-java">List&lt;UserVO&gt; queryExportUser();</code></pre> 
</div> 
<h5><span style="font-size:14px"><strong>2.4、service层代码（最重要）</strong></span></h5> 
<div> 
 <span style="font-size:14px"><strong></strong></span> 
 <pre><code class="language-java">package com.gusy.muban.service;
import java.util.List;
import org.apache.poi.ss.usermodel.Cell;
import org.apache.poi.ss.usermodel.CellStyle;
import org.apache.poi.ss.usermodel.HorizontalAlignment;
import org.apache.poi.ss.usermodel.Row;
import org.apache.poi.ss.usermodel.Sheet;
import org.apache.poi.ss.usermodel.Workbook;
import org.apache.poi.xssf.streaming.SXSSFWorkbook;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import com.gusy.muban.dao.UserVOMapper;
import com.gusy.muban.model.UserVO;

/**  
* @author gusy  
*/
@Service
public class UserService {
	@Autowired
	private UserVOMapper mapper;
	
	/**
	 * 导出excel
	 * @throws Exception 
	 */
	public Workbook queryExportUser() throws Exception{
		List&lt;UserVO&gt; list=mapper.queryExportUser();   //读取数据库数据
		String[] excelHeader={"账号ID","账号","用户名","密码"};  //设置Excel头部
		Workbook wb = new SXSSFWorkbook(1000);
		
		Sheet sheet = wb.createSheet("Sheet1");//创建工作表
		Row row = sheet.createRow(0);  //创建行，从0开始
		CellStyle style = wb.createCellStyle();
		style.setAlignment(HorizontalAlignment.CENTER);  //对齐方式
		
		//导入头部
		for (int i = 0; i &lt; excelHeader.length; i++) {
			Cell cell = row.createCell(i);
			cell.setCellValue(excelHeader[i]);
			cell.setCellStyle(style);
			sheet.setColumnWidth(1, (short) 6000);  //设置列宽
		}
		UserVO user=null;
		//导入数据
		for(int i=0 ; i&lt;list.size();i++){
			row = sheet.createRow(i + 1);  
			user=list.get(i);
			row.createCell(0).setCellValue(user.getId());   //设置单元格内容
			row.createCell(1).setCellValue(user.getAccount());
			row.createCell(2).setCellValue(user.getName());
			row.createCell(3).setCellValue(user.getPassword());
		}
		return wb;
	}
}
</code></pre> 
 <h5><span style="font-size:14px"><strong>2.5 controller层代码</strong></span></h5> 
</div> 
<div> 
 <span style="font-size:14px"><strong></strong></span> 
 <pre><code class="language-java">package com.gusy.muban.controller;

import java.io.IOException;
import java.io.OutputStream;
import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.UUID;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.apache.log4j.Logger;
import org.apache.poi.ss.usermodel.Workbook;
import org.aspectj.apache.bcel.classfile.Constant;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.ResponseBody;

import com.gusy.common.utils.FileUtil;
import com.gusy.common.utils.ResultVO;
import com.gusy.muban.service.UserService;



/**  
* @author gusy 
*/
@Controller
@RequestMapping("/user")
public class UserController {
	
	private static Logger logger=Logger.getLogger(UserController.class);
	
	@Autowired
	private UserService userService;
	
	/**
	 * 导出excel
	 * @param response
	 * @param request
	 */
	@RequestMapping("/queryExportUser")
	public void queryExportUser(HttpServletResponse response,HttpServletRequest request){
		OutputStream ouputStream = null;
		try {
			Workbook wb = userService.queryExportUser();
			FileUtil.setResponse(request,response,"用户表_"+UUID.randomUUID()+".xlsx");		
			ouputStream = response.getOutputStream();
			wb.write(ouputStream);
			ouputStream.flush();
		} catch (Exception e) {
			logger.error("[queryExportUser]异常", e);
		} finally {
			if (ouputStream != null) {
				try {
					ouputStream.close();
				} catch (IOException e) {
					logger.error("[queryExportUser]输出流关闭异常", e);
				}
			}
		}
	}
}</code></pre> 
 <h4><span style="font-size:14px"><strong>2.6 网页代码</strong></span></h4> 
 <div> 
  <span style="font-size:14px"><strong></strong></span> 
  <pre><code class="language-html">&lt;%@ page language="java" import="java.util.*" pageEncoding="utf-8"%&gt;
&lt;%
	String path = request.getContextPath();
	pageContext.setAttribute("path", path);
	String basePath = request.getScheme() + "://" + request.getServerName() + ":" + request.getServerPort()
			+ path + "/";
%&gt;

&lt;!doctype html&gt;
&lt;html&gt;

&lt;head&gt;
&lt;meta charset="utf-8"&gt;
&lt;title&gt;主页&lt;/title&gt;
&lt;meta name="renderer" content="webkit"&gt;
&lt;meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"&gt;
&lt;meta name="viewport"
	content="width=device-width, initial-scale=1, maximum-scale=1"&gt;
&lt;link rel="stylesheet" href="${path }/common/layui/css/layui.css"
	media="all"&gt;
&lt;script src="${path }/common/layui/layui.js"&gt;&lt;/script&gt;
&lt;style type="text/css"&gt;
.main {
	text-align: center;
	margin: 200px 0;
}
&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;

	&lt;div class="main"&gt;
		&lt;a href="#"&gt;
			&lt;button
				class="layui-btn layui-btn-big layui-btn-normal layui-btn-radius" οnclick="exportUser()"&gt;导出&lt;/button&gt;
		&lt;/a&gt;
	&lt;/div&gt;

&lt;/body&gt;
&lt;script type="text/javascript"&gt;
	function exportUser(){
		var url="/muban/user/queryExportUser.do"
		window.location.href = url;
	}
&lt;/script&gt;
&lt;/html&gt;</code></pre> 
 </div> 
 <h4><span style="font-size:14px"><strong>三、运行结果</strong></span></h4> 
</div> 
<div> 
 <div style="text-align:center"> 
  <img src="https://images2.imgbox.com/49/04/9Ch1njRH_o.png" align="middle" alt="" style="font-weight:bold; font-size:14px"> 
 </div> 
 <div style="text-align:center"> 
  <img src="https://images2.imgbox.com/68/35/SNY5XVYt_o.png" alt=""> 
  <br> 
 </div> 
 <span style="font-size:14px"><strong>补充：Fileutil setResponse方法代码</strong></span> 
</div> 
<div> 
 <span style="font-size:14px"><strong></strong></span> 
 <pre><code class="language-java">	/**
	 * 设置excel文件响应（解决火狐中文名问题）
	 * @param request 请求对象
	 * @param response 响应对象
	 * @param filename 文件名
	 * @throws Exception
	 */
	public static void setResponse(HttpServletRequest request,HttpServletResponse response,String filename) throws Exception{
		String userAgent = request.getHeader("User-Agent");		
		if(userAgent.toLowerCase().contains("firefox")){
			filename = new String(filename.getBytes("UTF-8"), "ISO-8859-1");
		}else{
			filename = URLEncoder.encode(filename, "UTF-8");
		}
		response.setContentType(request.getServletContext().getMimeType(filename)); 		
		response.setHeader("Content-disposition", String.format("attachment; filename=\"%s\"", filename));	
	}</code></pre> 
 <br> 
</div> 
<div> 
 <span style="font-size:14px"><strong>over!</strong></span> 
</div> 
<div> 
 <span style="font-size:14px"><strong><br> </strong></span> 
</div> 
<div> 
 <span style="font-size:14px"><br> </span> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/db12810d8c70e366dc88227279b89c4b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">设置html网页只能在微信中打开，并禁用分享功能</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4edd503caff3d00c596d344b5ffb9abb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">No signing certificate &#34;ios Development&#34; found : No &#34;ios Development&#34; signing certificate matching</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>