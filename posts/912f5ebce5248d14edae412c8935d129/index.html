<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Python基础之爬取豆瓣图书信息 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Python基础之爬取豆瓣图书信息" />
<meta property="og:description" content="概述 所谓爬虫，就是帮助我们从互联网上获取相关数据并提取有用的信息。在大数据时代，爬虫是数据采集非常重要的一种手段，比人工进行查询，采集数据更加方便，更加快捷。刚开始学爬虫时，一般从静态，结构比较规范的网页入手，然后逐步深入。今天以爬取豆瓣最受关注图书为例，简述 python教程在爬虫方面的初步应用，仅供学习分享使用，如有不足之处，还请指正。
涉及知识点 如果要实现爬虫，需要掌握的Pyhton相关知识点如下所示：
requests模块：requests是python实现的最简单易用的HTTP库，建议爬虫使用requests。关于requests模块的相关内容，可参考及简书上的BeautifulSoup模块：Beautiful Soup 是一个可以从HTML或XML文件中提取数据的Python库。它能够通过你喜欢的转换器实现惯用的文档导航，查找，修改文档的方式。关于BeautifulSoup的更多内容，可参考。json模块：JSON(JavaScript Object Notation) 是一种轻量级的数据交换格式，易于人阅读和编写。使用 JSON 函数需要导入 json 库。关于json的更多内容，可参考。re模块：re模块提供了与 Perl 语言类似的正则表达式匹配操作。关于re模块的更多内容，可参考。 目标页面 本例中爬取的信息为豆瓣最受关注图书榜信息，共10本当前最受欢迎图书。
爬取页面URL【Uniform Resource Locator,统一资源定位器】：https://book.douban.com/chart?subcat=F
爬取页面截图，如下所示：
爬取数据步骤 1. 分析页面 通过浏览器提供的开发人员工具（快捷键：F12），可以方便的对页面元素进行定位，经过定位分析，本次所要获取的内容，包括在UL【class=chart-dashed-list】标签内容，每一本书，都对应一个LI元素，是本次爬取的目标，如下所示：
每一本书，对应一个Li【class=media clearfix】元素，书名为对应a【class=fleft】元素，描述为P【class=subject-abstract color-gray】标签元素内容，具体到每一本书的的详细内容，如下所示：
2. 下载数据 如果要分析数据，首先要进行下载，获取要爬取的数据信息，在Python中爬取数据，主要用requests模块，如下所示：
1 def get_data(url): 2 &#34;&#34;&#34; 3 获取数据 4 :param url: 请求网址 5 :return:返回请求的页面内容 6 &#34;&#34;&#34; 7 # 请求头，模拟浏览器，否则请求会返回418 8 header = { 9 &#39;User-Agent&#39;: &#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) &#39; 10 &#39;Chrome/70." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/912f5ebce5248d14edae412c8935d129/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-08-31T13:16:00+08:00" />
<meta property="article:modified_time" content="2021-08-31T13:16:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Python基础之爬取豆瓣图书信息</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3>概述</h3> 
<p>所谓爬虫，就是帮助我们从互联网上获取相关数据并提取有用的信息。在大数据时代，爬虫是数据采集非常重要的一种手段，比人工进行查询，采集数据更加方便，更加快捷。刚开始学爬虫时，一般从静态，结构比较规范的网页入手，然后逐步深入。今天以爬取豆瓣最受关注图书为例，简述<a href="https://www.xin3721.com/eschool/pythonxin3721/" rel="nofollow"> <span style="color:#494949;">python教程</span></a>在爬虫方面的初步应用，仅供学习分享使用，如有不足之处，还请指正。</p> 
<h3>涉及知识点</h3> 
<p>如果要实现爬虫，需要掌握的Pyhton相关知识点如下所示：</p> 
<ul><li>requests模块：requests是python实现的最简单易用的HTTP库，建议爬虫使用requests。关于requests模块的相关内容，可参考及简书上的</li><li>BeautifulSoup模块：Beautiful Soup 是一个可以从HTML或XML文件中提取数据的Python库。它能够通过你喜欢的转换器实现惯用的文档导航，查找，修改文档的方式。关于BeautifulSoup的更多内容，可参考。</li><li>json模块：JSON(JavaScript Object Notation) 是一种轻量级的数据交换格式，易于人阅读和编写。使用 JSON 函数需要导入 json 库。关于json的更多内容，可参考。</li><li>re模块：re模块提供了与 Perl 语言类似的正则表达式匹配操作。关于re模块的更多内容，可参考。</li></ul> 
<h3>目标页面</h3> 
<p>本例中爬取的信息为豆瓣最受关注图书榜信息，共10本当前最受欢迎图书。</p> 
<p>爬取页面URL【Uniform Resource Locator,统一资源定位器】：https://book.douban.com/chart?subcat=F</p> 
<p>爬取页面截图，如下所示：</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/c0/82/2S40OeCW_o.png"></p> 
<h3>爬取数据步骤</h3> 
<h4>1. 分析页面</h4> 
<p>通过浏览器提供的开发人员工具（快捷键：F12），可以方便的对页面元素进行定位，经过定位分析，本次所要获取的内容，包括在UL【class=chart-dashed-list】标签内容，每一本书，都对应一个LI元素，是本次爬取的目标，如下所示：</p> 
<p style="text-align:center;"><img alt="" height="603" src="https://images2.imgbox.com/67/2c/ROMjlEwF_o.png" width="720"></p> 
<p></p> 
<p> 每一本书，对应一个Li【class=media clearfix】元素，书名为对应a【class=fleft】元素，描述为P【class=subject-abstract color-gray】标签元素内容，具体到每一本书的的详细内容，如下所示：</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/05/66/aVcNNGUm_o.png"></p> 
<p></p> 
<h4>2. 下载数据</h4> 
<p>如果要分析数据，首先要进行下载，获取要爬取的数据信息，在Python中爬取数据，主要用requests模块，如下所示：</p> 
<p style="text-align:center;"><img alt="复制代码" src="https://images2.imgbox.com/0d/df/vHELJy0X_o.png"></p> 
<pre> 1 def get_data(url):
 2     """
 3     获取数据
 4     :param url: 请求网址
 5     :return:返回请求的页面内容
 6     """
 7     # 请求头，模拟浏览器，否则请求会返回418
 8     header = {
 9         'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) '
10                       'Chrome/70.0.3538.102 Safari/537.36 Edge/18.18363'}
11     resp = requests.get(url=url, headers=header)  # 发送请求
12     if resp.status_code == 200:
13         # 如果返回成功，则返回内容
14         return resp.text
15     else:
16         # 否则，打印错误状态码，并返回空
17         print('返回状态码：', resp.status_code)
18         return ''</pre> 
<p style="text-align:center;"><img alt="复制代码" src="https://images2.imgbox.com/86/67/2XOcJ4Ki_o.png"></p> 
<p>注意：在刚开始写爬虫时，通常会遇到“HTTP Error 418”，请求网站的服务器端会进行检测此次访问是不是人为通过浏览器访问，如果不是，则返回418错误码。检测请求头是常见的反爬虫策略，所为为了模拟浏览器访问，需要构造请求Header，然后即可正常访问。</p> 
<p>正常浏览器访问成功的状态码为200，及请求标头中User-Agent。如下所示：</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/13/67/4d5MbMkq_o.png"></p> 
<p></p> 
<h4>3. 解析数据</h4> 
<p>当获取到数据后，需要进行数据分析，才能得到想要的内容。requests模块获取到的内容为Html源码字符串，可以通过BeautifulSoup装载成对象，然后进行数据获取，如下所示：</p> 
<p style="text-align:center;"><img alt="复制代码" src="https://images2.imgbox.com/63/5e/5sZnw3l8_o.png"></p> 
<pre> 1 def parse_data(html: str = None):
 2     """
 3     解析数据
 4     :param html:
 5     :return:返回书籍信息列表
 6     """
 7     bs = BeautifulSoup(html, features='html.parser')  # 转换页面内容为BeautifulSoup对象
 8     ul = bs.find(name='ul', attrs={'class': 'chart-dashed-list'})  # 获取列表的父级内容
 9     lis = ul.find_all('li', attrs={'class': re.compile('^media clearfix')})  # 获取图书列表
10     books = []  # 定义图书列表
11     for li in lis:
12         # 循环遍历列表
13         strong_num = li.find(name='strong', attrs={'class': 'fleft green-num-box'})  # 获取书籍排名标签
14         book_num = strong_num.text  # 编号
15         h2_a = li.find(name='a', attrs={'class': 'fleft'})  # 获取书名标签
16         book_name = h2_a.text  # 获取书名
17         p_info = li.find(name='p', attrs={'class': "subject-abstract color-gray"})  # 书籍说明段落标签
18 
19         book_info_str = p_info.text.strip()  # 获取书籍说明，并 去前后空格
20         # book_info_list = book_info_str.split('/', -1) # 分隔符
21         books.append(
22             {'book_num': book_num, 'book_name': book_name, 'book_info': book_info_str})  # 将内容添加到列表
23 
24     return books</pre> 
<p style="text-align:center;"><img alt="复制代码" src="https://images2.imgbox.com/14/2b/89HyEOCj_o.png"></p> 
<h4>4. 保存数据</h4> 
<p>解析到目标数据后，需要进行数据持久化，以便后续进一步分析。持久化通常可以保存到数据库中，本例为了简单，保存到本地json文件中，如下所示：</p> 
<p style="text-align:center;"><img alt="复制代码" src="https://images2.imgbox.com/bc/0c/grPNTDCR_o.png"></p> 
<pre>1 def save_data(res_list):
2     """
3     保存数据
4     :param res_list: 保存的内容文件
5     :return:
6     """
7     with open('books.json', 'w', encoding='utf-8') as f:
8         res_list_json = json.dumps(res_list, ensure_ascii=False)
9         f.write(res_list_json)</pre> 
<p style="text-align:center;"><img alt="复制代码" src="https://images2.imgbox.com/77/94/0OC1aBlm_o.png"></p> 
<p>本例完整代码，如下所示：</p> 
<p style="text-align:center;"><img alt="" id="code_img_opened_0da53cf3-f363-465d-91f8-ef46a9d132d7" src="https://images2.imgbox.com/d0/89/GBTVIAvG_o.png"></p> 
<p style="text-align:center;"><img alt="复制代码" src="https://images2.imgbox.com/cc/a0/4Jx29NbK_o.png"></p> 
<pre> 1 import json  # json 包，用于读取解析，生成json格式的文件内容
 2 import requests  # 请求包  用于发起网络请求
 3 from bs4 import BeautifulSoup  # 解析页面内容帮助包
 4 import re  # 正则表达式
 5 
 6 
 7 def get_data(url):
 8     """
 9     获取数据
10     :param url: 请求网址
11     :return:返回请求的页面内容
12     """
13     # 请求头，模拟浏览器，否则请求会返回418
14     header = {
15         'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) '
16                       'Chrome/70.0.3538.102 Safari/537.36 Edge/18.18363'}
17     resp = requests.get(url=url, headers=header)  # 发送请求
18     if resp.status_code == 200:
19         # 如果返回成功，则返回内容
20         return resp.text
21     else:
22         # 否则，打印错误状态码，并返回空
23         print('返回状态码：', resp.status_code)
24         return ''
25 
26 
27 def parse_data(html: str = None):
28     """
29     解析数据
30     :param html:
31     :return:返回书籍信息列表
32     """
33     bs = BeautifulSoup(html, features='html.parser')  # 转换页面内容为BeautifulSoup对象
34     ul = bs.find(name='ul', attrs={'class': 'chart-dashed-list'})  # 获取列表的父级内容
35     lis = ul.find_all('li', attrs={'class': re.compile('^media clearfix')})  # 获取图书列表
36     books = []  # 定义图书列表
37     for li in lis:
38         # 循环遍历列表
39         strong_num = li.find(name='strong', attrs={'class': 'fleft green-num-box'})  # 获取书籍排名标签
40         book_num = strong_num.text  # 编号
41         h2_a = li.find(name='a', attrs={'class': 'fleft'})  # 获取书名标签
42         book_name = h2_a.text  # 获取书名
43         p_info = li.find(name='p', attrs={'class': "subject-abstract color-gray"})  # 书籍说明段落标签
44 
45         book_info_str = p_info.text.strip()  # 获取书籍说明，并 去前后空格
46         # book_info_list = book_info_str.split('/', -1) # 分隔符
47         books.append(
48             {'book_num': book_num, 'book_name': book_name, 'book_info': book_info_str})  # 将内容添加到列表
49 
50     return books
51 
52 
53 def save_data(res_list):
54     """
55     保存数据
56     :param res_list: 保存的内容文件
57     :return:
58     """
59     with open('books.json', 'w', encoding='utf-8') as f:
60         res_list_json = json.dumps(res_list, ensure_ascii=False)
61         f.write(res_list_json)
62 
63 
64 #  开始执行，调用函数
65 url = 'https://book.douban.com/chart?subcat=F'
66 html = get_data(url=url)  # 获取数据
67 books = parse_data(html)  # 解析数据
68 save_data(books)  # 保存数据
69 print('done')</pre> 
<p style="text-align:center;"><img alt="复制代码" src="https://images2.imgbox.com/84/ad/ilHKR7o4_o.png"></p> 
<p>本例爬取内容，保存到books.json文件中，如下所示：</p> 
<p style="text-align:center;"><img alt="" id="code_img_opened_6bc633f3-88b7-42ef-b859-0e6c0663a697" src="https://images2.imgbox.com/3a/c0/W25Yy2b8_o.png"></p> 
<p style="text-align:center;"><img alt="复制代码" src="https://images2.imgbox.com/f5/cc/0NeRENyu_o.png"></p> 
<pre> 1 [
 2   {
 3     "book_num": "1",
 4     "book_name": "心灵侦探城塚翡翠",
 5     "book_info": "相泽沙呼 / 2021-4 / 人民文学出版社 / 79.00元 / 精装"
 6   },
 7   {
 8     "book_num": "2",
 9     "book_name": "平原上的摩西",
10     "book_info": "双雪涛 / 2021-4 / 北京日报出版社 / 59 / 精装"
11   },
12   {
13     "book_num": "3",
14     "book_name": "眩晕",
15     "book_info": "[德国] 温弗里德·塞巴尔德 / 2021-4 / 广西师范大学出版社 / 52.00元 / 精装"
16   },
17   {
18     "book_num": "4",
19     "book_name": "一把刀，千个字",
20     "book_info": "王安忆 / 2021-4 / 人民文学出版社 / 精装"
21   },
22   {
23     "book_num": "5",
24     "book_name": "字母表谜案",
25     "book_info": "大山诚一郎 / 2021-5 / 河南文艺出版社 / 42.00 / 平装"
26   },
27   {
28     "book_num": "6",
29     "book_name": "星之继承者",
30     "book_info": "[英] 詹姆斯·P.霍根 / 2021-4 / 新星出版社 / 58.00元 / 精装"
31   },
32   {
33     "book_num": "7",
34     "book_name": "美丽黑暗",
35     "book_info": "[法] 法比安·韦尔曼  编 / [法] 凯拉斯科多  绘 / 2021-4 / 后浪丨中国纺织出版社 / 88.00元 / 精装"
36   },
37   {
38     "book_num": "8",
39     "book_name": "心",
40     "book_info": "[日] 夏目漱石 / 2021-3-30 / 江苏凤凰文艺出版社 / 45.00元 / 精装"
41   },
42   {
43     "book_num": "9",
44     "book_name": "奇迹唱片行",
45     "book_info": "[英] 蕾秋·乔伊斯 / 2021-6-11 / 北京联合出版公司 / 48 / 平装"
46   },
47   {
48     "book_num": "10",
49     "book_name": "派对恐惧症",
50     "book_info": "［美］卡门•玛丽亚•马查多 / 2021-5 / 世纪文景/上海人民出版社 / 59.00元 / 精装"
51   }
52 ]</pre> 
<p style="text-align:center;"><img alt="复制代码" src="https://images2.imgbox.com/e1/f9/r7tnyLb3_o.png"></p> 
<h3>备注</h3> 
<p>望岳</p> 
<p>唐·杜甫</p> 
<p>岱宗夫如何？齐鲁青未了。<br> 造化钟神秀，阴阳割昏晓。<br> 荡胸生曾云，决眦入归鸟。( 曾 同：层)<br> 会当凌绝顶，一览众山小。 </p> 
<p id="PSignature"></p> 
<p>作者：<a href="http://www.cnblogs.com/hsiang/" rel="nofollow">Alan.hsiang</a><br>  </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8276d7d33f4b484fba724d11b8061742/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">RoBERTa 详解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/64b96b4b94d38986e407fd28df7cc059/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Ubuntu20.04安装Navigation功能包</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>