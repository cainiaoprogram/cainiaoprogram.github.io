<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>使用DataGridView疑难问题解答 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="使用DataGridView疑难问题解答" />
<meta property="og:description" content="1. 如何使指定的单元格不可编辑?
ReadOnly属性决定了单元格中的数据是否可以编辑，可以设置单元格的ReadOnly 属性，也可以设置DataGridViewRow.ReadOnly 或DataGridViewColumn.ReadOnly使得一行或一列所包含的单元格都是只读的。 默认情况下，如果一行或一列是只读的，那么其包含的单元格也会使只读的。
不过你仍可以操作一个只读的单元格，比如选中它，将其设置为当前单元格，但用户不能修改单元格的内容。注意，即使单元格通过ReadOnly属性设置为只读，仍然可以通过编程的方式修改它，另外ReadOnly也不会影响用户是否可以删除行。
2. 如何让一个单元格不可用(disable)?
单元格可以设置为只读而不可编辑，但DataGridView却没提供使单元格不可用的支持。一般意义上，不可用意味着用户不能进行操作，通常会带有外观的暗示，如灰色。没有一种简单的方法来创建那种不可操作的单元格，但提供一个暗示性的外观告诉用户某单元格不可用还是可行的。内置的单元格类型没有进行不可用设置的属性，下面的例子扩展了DataGridViewButtonCell ，参照常见控件的Enabled属性，为其添加了Enabled属性，如果该属性设置为false，那么其外观状态将类似于普通按钮的不可用状态。
public class DataGridViewDisableButtonColumn : DataGridViewButtonColumn
{
public DataGridViewDisableButtonColumn()
{
this.CellTemplate = new DataGridViewDisableButtonCell();
}
}
public class DataGridViewDisableButtonCell : DataGridViewButtonCell
{
private bool enabledValue;
public bool Enabled
{
get {
return enabledValue;
}
set {
enabledValue = value;
}
}
// Override the Clone method so that the Enabled property is copied.
public override object Clone()
{
DataGridViewDisableButtonCell cell =" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/3934b64351b905c17fda9b270ff054da/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-07-21T17:52:26+08:00" />
<meta property="article:modified_time" content="2021-07-21T17:52:26+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">使用DataGridView疑难问题解答</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>1.    如何使指定的单元格不可编辑?<br> ReadOnly属性决定了单元格中的数据是否可以编辑，可以设置单元格的ReadOnly 属性，也可以设置DataGridViewRow.ReadOnly 或DataGridViewColumn.ReadOnly使得一行或一列所包含的单元格都是只读的。 默认情况下，如果一行或一列是只读的，那么其包含的单元格也会使只读的。</p> 
<p></p> 
<p>不过你仍可以操作一个只读的单元格，比如选中它，将其设置为当前单元格，但用户不能修改单元格的内容。注意，即使单元格通过ReadOnly属性设置为只读，仍然可以通过编程的方式修改它，另外ReadOnly也不会影响用户是否可以删除行。</p> 
<p>2.    如何让一个单元格不可用(disable)?<br> 单元格可以设置为只读而不可编辑，但DataGridView却没提供使单元格不可用的支持。一般意义上，不可用意味着用户不能进行操作，通常会带有外观的暗示，如灰色。没有一种简单的方法来创建那种不可操作的单元格，但提供一个暗示性的外观告诉用户某单元格不可用还是可行的。内置的单元格类型没有进行不可用设置的属性，下面的例子扩展了DataGridViewButtonCell ，参照常见控件的Enabled属性，为其添加了Enabled属性，如果该属性设置为false，那么其外观状态将类似于普通按钮的不可用状态。</p> 
<p>public class DataGridViewDisableButtonColumn : DataGridViewButtonColumn</p> 
<p>{<!-- --></p> 
<p>    public DataGridViewDisableButtonColumn()</p> 
<p>    {<!-- --></p> 
<p>        this.CellTemplate = new DataGridViewDisableButtonCell();</p> 
<p>    }</p> 
<p>}</p> 
<p></p> 
<p>public class DataGridViewDisableButtonCell : DataGridViewButtonCell</p> 
<p>{<!-- --></p> 
<p>    private bool enabledValue;</p> 
<p>    public bool Enabled</p> 
<p>    {<!-- --></p> 
<p>        get {<!-- --></p> 
<p>            return enabledValue;</p> 
<p>        }</p> 
<p>        set {<!-- --></p> 
<p>            enabledValue = value;</p> 
<p>        }</p> 
<p>    }</p> 
<p></p> 
<p>    // Override the Clone method so that the Enabled property is copied.</p> 
<p>    public override object Clone()</p> 
<p>{<!-- --></p> 
<p>DataGridViewDisableButtonCell cell =</p> 
<p>            (DataGridViewDisableButtonCell)base.Clone();</p> 
<p>        cell.Enabled = this.Enabled;</p> 
<p>        return cell;</p> 
<p>    }</p> 
<p></p> 
<p>    // By default, enable the button cell.</p> 
<p>    public DataGridViewDisableButtonCell()</p> 
<p>    {<!-- --></p> 
<p>        this.enabledValue = true;</p> 
<p>    }</p> 
<p></p> 
<p>    protected override void Paint(Graphics graphics,</p> 
<p>        Rectangle clipBounds, Rectangle cellBounds, int rowIndex,</p> 
<p>        DataGridViewElementStates elementState, object value,</p> 
<p>        object formattedValue, string errorText,</p> 
<p>        DataGridViewCellStyle cellStyle,</p> 
<p>        DataGridViewAdvancedBorderStyle advancedBorderStyle,</p> 
<p>        DataGridViewPaintParts paintParts)</p> 
<p>    {<!-- --></p> 
<p>        // The button cell is disabled, so paint the border, </p> 
<p>        // background, and disabled button for the cell.</p> 
<p>        if (!this.enabledValue)</p> 
<p>        {<!-- --></p> 
<p>            // Draw the cell background, if specified.</p> 
<p>            if ((paintParts &amp; DataGridViewPaintParts.Background) ==</p> 
<p>                DataGridViewPaintParts.Background)</p> 
<p>            {<!-- --></p> 
<p>SolidBrush cellBackground =</p> 
<p>                    new SolidBrush(cellStyle.BackColor);</p> 
<p>                graphics.FillRectangle(cellBackground, cellBounds);</p> 
<p>                cellBackground.Dispose();</p> 
<p>            }</p> 
<p></p> 
<p>            // Draw the cell borders, if specified.</p> 
<p>            if ((paintParts &amp; DataGridViewPaintParts.Border) ==</p> 
<p>                DataGridViewPaintParts.Border)</p> 
<p>            {<!-- --></p> 
<p>                PaintBorder(graphics, clipBounds, cellBounds, cellStyle,</p> 
<p>                    advancedBorderStyle);</p> 
<p>            }</p> 
<p></p> 
<p>            // Calculate the area in which to draw the button.</p> 
<p>            Rectangle buttonArea = cellBounds;</p> 
<p>            Rectangle buttonAdjustment =</p> 
<p>                this.BorderWidths(advancedBorderStyle);</p> 
<p>            buttonArea.X += buttonAdjustment.X;</p> 
<p>            buttonArea.Y += buttonAdjustment.Y;</p> 
<p>            buttonArea.Height -= buttonAdjustment.Height;</p> 
<p>            buttonArea.Width -= buttonAdjustment.Width;</p> 
<p></p> 
<p>            // Draw the disabled button.               </p> 
<p>            ButtonRenderer.DrawButton(graphics, buttonArea,</p> 
<p>                PushButtonState.Disabled);</p> 
<p></p> 
<p>            // Draw the disabled button text.</p> 
<p>            if (this.FormattedValue is String)</p> 
<p>            {<!-- --></p> 
<p>                TextRenderer.DrawText(graphics,</p> 
<p>                    (string)this.FormattedValue,</p> 
<p>                    this.DataGridView.Font,</p> 
<p>                    buttonArea, SystemColors.GrayText);</p> 
<p>            }</p> 
<p>        }</p> 
<p>        else</p> 
<p>        {<!-- --></p> 
<p>            // The button cell is enabled, so let the base class</p> 
<p>            // handle the painting.</p> 
<p>            base.Paint(graphics, clipBounds, cellBounds, rowIndex,</p> 
<p>                elementState, value, formattedValue, errorText,</p> 
<p>                cellStyle, advancedBorderStyle, paintParts);</p> 
<p>        }</p> 
<p>    }</p> 
<p>}</p> 
<p>3.    如何避免用户将焦点设置到指定的单元格？<br> 默认情况下DataGridView的操作（navigation）模型在限制用户将焦点置于指定的单元格方面没有提供任何支持。你可以实现自己的操作逻辑，这需要重写合适的键盘、导航、鼠标方法，如DataGridView.OnKeyDown， DataGridView.ProcessDataGridViewKey， DataGridView.SetCurrentCellAddressCore，  DataGridView.SetSelectedCellCore， DataGridView.OnMouseDown。</p> 
<p>4.    如何使所有单元格总是显示控件(不论它是否处于编辑状态)？<br> DataGridView 控件只支持在单元格处于编辑状态时显示真实的控件(如TextBox)。DataGridView 没有被设计为显示多控件或为每行重复显示控件。DataGridView 在单元格不被编辑时为其绘制对应控件的外观，该外观可能是你想要的。例如，DataGridViewButtonCell 类型的单元格，不管它是否处于编辑状态，总是表现为一个按钮。</p> 
<p>5.    Why does the cell text show up with “square” characters where they should be new lines(TODO,未能实现该效果)?<br> By default, text in a DataGridViewTextBoxCell does not wrap. This can be controlled via the WrapMode property on the cell style (e.g. DataGridView.DefaultCellStyle.WrapMode). Because text doesn’t wrap, new line characters in the text do not apply and so they are displayed as a “non-printable” character. This is similar to setting a TextBox’s Text property to the same text when the TextBox’s MultiLine property is false.</p> 
<p>6.    如何在单元格内同时显示图标和文本？<br> DataGridView控件没有对在同一单元格内同时显示图标和文本提供支持。但通过实现自定义的绘制事件，如CellPaint 事件，你可以轻松实现这个效果。</p> 
<p></p> 
<p>下面这段代码扩展了DataGridViewTextBoxColumn 和DataGridViewTextBoxCell类，将一个图片显示在文本旁边。这个示例使用了DataGridViewCellStyle.Padding 属性来调整文本的位置，重写了Paint 方法来绘制图片。该示例可以得到简化，方法是处理CellPainting 事件，在这里实现类似的功能。</p> 
<p></p> 
<p>    public class TextAndImageColumn:DataGridViewTextBoxColumn</p> 
<p>    {<!-- --></p> 
<p>        private Image imageValue;</p> 
<p>        private Size imageSize;</p> 
<p></p> 
<p>        public TextAndImageColumn()</p> 
<p>        {<!-- --></p> 
<p>            this.CellTemplate = new TextAndImageCell();</p> 
<p>        }</p> 
<p></p> 
<p>        public override object Clone()</p> 
<p>        {<!-- --></p> 
<p>            TextAndImageColumn c = base.Clone() as TextAndImageColumn;</p> 
<p>            c.imageValue = this.imageValue;</p> 
<p>            c.imageSize = this.imageSize;</p> 
<p>            return c;</p> 
<p>        }</p> 
<p></p> 
<p>        public Image Image</p> 
<p>        {<!-- --></p> 
<p>            get { return this.imageValue; }</p> 
<p>            set</p> 
<p>            {<!-- --></p> 
<p>                if (this.Image != value) {<!-- --></p> 
<p>                    this.imageValue = value;</p> 
<p>                    this.imageSize = value.Size;</p> 
<p></p> 
<p>                    if (this.InheritedStyle != null) {<!-- --></p> 
<p>                        Padding inheritedPadding = this.InheritedStyle.Padding;</p> 
<p>                        this.DefaultCellStyle.Padding = new Padding(imageSize.Width,<br>                     inheritedPadding.Top, inheritedPadding.Right, <br>                     inheritedPadding.Bottom);</p> 
<p>                    }</p> 
<p>                }</p> 
<p>            }</p> 
<p>        }</p> 
<p>        private TextAndImageCell TextAndImageCellTemplate</p> 
<p>        {<!-- --></p> 
<p>            get { return this.CellTemplate as TextAndImageCell; }</p> 
<p>        }</p> 
<p>        internal Size ImageSize</p> 
<p>        {<!-- --></p> 
<p>            get { return imageSize; }</p> 
<p>        }</p> 
<p>    }</p> 
<p></p> 
<p>    public class TextAndImageCell : DataGridViewTextBoxCell</p> 
<p>    {<!-- --></p> 
<p>        private Image imageValue;</p> 
<p>        private Size imageSize;</p> 
<p>       </p> 
<p>        public override object Clone()</p> 
<p>        {<!-- --></p> 
<p>            TextAndImageCell c = base.Clone() as TextAndImageCell;</p> 
<p>            c.imageValue= this.imageValue;</p> 
<p>            c.imageSize = this.imageSize;</p> 
<p>            return c;</p> 
<p>        }</p> 
<p></p> 
<p>        public Image Image</p> 
<p>        {<!-- --></p> 
<p>            get {<!-- --></p> 
<p>                if (this.OwningColumn == null || <br>            this.OwningTextAndImageColumn == null) {<!-- --></p> 
<p></p> 
<p>                    return imageValue;</p> 
<p>                }</p> 
<p>                else if (this.imageValue != null) {<!-- --></p> 
<p>                    return this.imageValue;</p> 
<p>                }</p> 
<p>                else {<!-- --></p> 
<p>                    return this.OwningTextAndImageColumn.Image;</p> 
<p>                }</p> 
<p>            }</p> 
<p>            set {<!-- --></p> 
<p>                if (this.imageValue != value) {<!-- --></p> 
<p>                    this.imageValue = value;</p> 
<p>                    this.imageSize = value.Size;</p> 
<p></p> 
<p>                    Padding inheritedPadding = this.InheritedStyle.Padding;</p> 
<p>                    this.Style.Padding = new Padding(imageSize.Width, <br>                    inheritedPadding.Top, inheritedPadding.Right, <br>                    inheritedPadding.Bottom);</p> 
<p>                }</p> 
<p>            }</p> 
<p>        }</p> 
<p>        protected override void Paint(Graphics graphics, Rectangle clipBounds,<br>        Rectangle cellBounds, int rowIndex, DataGridViewElementStates cellState,<br>        object value, object formattedValue, string errorText, <br>        DataGridViewCellStyle cellStyle, <br>        DataGridViewAdvancedBorderStyle advancedBorderStyle,<br>        DataGridViewPaintParts paintParts)</p> 
<p>        {<!-- --></p> 
<p>            // Paint the base content</p> 
<p>            base.Paint(graphics, clipBounds, cellBounds, rowIndex, cellState, <br>               value, formattedValue, errorText, cellStyle,<br>               advancedBorderStyle, paintParts);</p> 
<p></p> 
<p>            if (this.Image != null) {<!-- --></p> 
<p>                // Draw the image clipped to the cell.</p> 
<p>                System.Drawing.Drawing2D.GraphicsContainer container = <br>                graphics.BeginContainer();</p> 
<p>               </p> 
<p>                graphics.SetClip(cellBounds);</p> 
<p>                graphics.DrawImageUnscaled(this.Image, cellBounds.Location);</p> 
<p></p> 
<p>                graphics.EndContainer(container);</p> 
<p>            }</p> 
<p>        }</p> 
<p></p> 
<p>        private TextAndImageColumn OwningTextAndImageColumn</p> 
<p>        {<!-- --></p> 
<p>            get { return this.OwningColumn as TextAndImageColumn; }</p> 
<p>        }</p> 
<p>    }</p> 
<p>7.    如何隐藏一列？<br> 有时希望仅显示DataGridView的部分列，将其它列隐藏。比如DataGridView含有一列包含员工薪水信息，你可能希望仅将这些信息显示给具有一定信用级别的人，其他人则隐藏。</p> 
<p></p> 
<p>通过编程方式隐藏</p> 
<p>DataGridViewColumn类的Visible 属性决定了是否显示该列。</p> 
<p></p> 
<p>通过设计器隐藏</p> 
<p>1)       右击DataGridView控件，选择Edit Columns；</p> 
<p>2)       在列列表中选择一列；</p> 
<p>3)       在列属性网格中，将Visible属性设置为false。</p> 
<p>8.    如何避免用户对列排序？<br> 对于DataGridView 控件，默认情况下，TextBox类型的列会自动排序，而其它类型的列则不会自动排序。这种自动排序有时会把数据变得比较乱，这时你会想更改这些默认设置。</p> 
<p></p> 
<p>DataGridViewColumn的属性SortMode决定了列的排序方式，将其设置为DataGridViewColumnSortMode.NotSortable就可以避免默认的排序行为。</p> 
<p>9.    如何针对多个列排序?<br> 默认情况下DataGridView不支持针对多列排序。下面针对是否将数据绑定到DataGridView来分别演示如何为其添加多列排序功能。</p> 
<p>9.1 将数据绑定到DataGridView时</p> 
<p>DataGridView进行数据绑定的时候，数据源(如DataView)可对多个列排序。DataGridView会保留这种排序，但只有第一个排序列会显示排序符号(向上或向下的箭头)，此外SortedColumn属性也只会返回第一个排序列。</p> 
<p></p> 
<p>一些数据源内置了对多列排序的支持。如果你的数据源实现了IBindingListView接口，提供了对Sort属性的支持，那么该数据源就支持多列排序。为了明确指出DataGridView对多列排序，手动为已排序列设置正确的SortGlyphDirection属性，指示该列已经排序。</p> 
<p></p> 
<p>下面这个示例使用DataTable作为数据源，使用其DefaultView的 Sort 属性对第二列和第三列排序；该示例同时演示了如何设置列的SortGlyphDirection属性。该示例假定在你的窗体上有一个DataGridView控件和一个BindingSource组件：</p> 
<p></p> 
<p>DataTable dt = new DataTable();</p> 
<p>dt.Columns.Add("C1", typeof(int));</p> 
<p>dt.Columns.Add("C2", typeof(string));</p> 
<p>dt.Columns.Add("C3", typeof(string));</p> 
<p>dt.Rows.Add(1, "1", "Test1");</p> 
<p>dt.Rows.Add(2, "2", "Test2");</p> 
<p>dt.Rows.Add(2, "2", "Test1");</p> 
<p>dt.Rows.Add(3, "3", "Test3");</p> 
<p>dt.Rows.Add(4, "4", "Test4");</p> 
<p>dt.Rows.Add(4, "4", "Test3");</p> 
<p>DataView view = dt.DefaultView;</p> 
<p>view.Sort = "C2 ASC, C3 ASC";</p> 
<p>bindingSource.DataSource = view;</p> 
<p>DataGridViewTextBoxColumn col0 = new DataGridViewTextBoxColumn();</p> 
<p>col0.DataPropertyName = "C1";</p> 
<p>dataGridView1.Columns.Add(col0);</p> 
<p>col0.SortMode = DataGridViewColumnSortMode.Programmatic;</p> 
<p>col0.HeaderCell.SortGlyphDirection = SortOrder.None;</p> 
<p>DataGridViewTextBoxColumn col1 = new DataGridViewTextBoxColumn();</p> 
<p>col1.DataPropertyName = "C2";</p> 
<p>dataGridView1.Columns.Add(col1);</p> 
<p>col1.SortMode = DataGridViewColumnSortMode.Programmatic;</p> 
<p>col1.HeaderCell.SortGlyphDirection = SortOrder.Ascending;</p> 
<p>DataGridViewTextBoxColumn col2 = new DataGridViewTextBoxColumn();</p> 
<p>col2.DataPropertyName = "C3";</p> 
<p>dataGridView1.Columns.Add(col2);</p> 
<p>col2.SortMode = DataGridViewColumnSortMode.Programmatic;</p> 
<p>col2.HeaderCell.SortGlyphDirection = SortOrder.Ascending;</p> 
<p></p> 
<p>9.2 Unbound DataGridView</p> 
<p>To provide support for sorting on multiple columns you can handle the SortCompare event or call the Sort(IComparer) overload of the Sort method for greater sorting flexibility.</p> 
<p></p> 
<p>9.2.1 Custom Sorting Using the SortCompare Event</p> 
<p>The following code example demonstrates custom sorting using a SortCompare event handler. The selected DataGridViewColumn is sorted and, if there are duplicate values in the column, the ID column is used to determine the final order.</p> 
<p>using System;</p> 
<p>using System.Collections.Generic;</p> 
<p>using System.ComponentModel;</p> 
<p>using System.Data;</p> 
<p>using System.Drawing;</p> 
<p>using System.Windows.Forms;</p> 
<p></p> 
<p>class Form1 : Form</p> 
<p>{<!-- --></p> 
<p>    private DataGridView dataGridView1 = new DataGridView();</p> 
<p></p> 
<p>    // Establish the main entry point for the application.</p> 
<p>    [STAThreadAttribute()]</p> 
<p>    static void Main()</p> 
<p>    {<!-- --></p> 
<p>        Application.EnableVisualStyles();</p> 
<p>        Application.Run(new Form1());</p> 
<p>    }</p> 
<p></p> 
<p>    public Form1()</p> 
<p>    {<!-- --></p> 
<p>        // Initialize the form.</p> 
<p>        // This code can be replaced with designer generated code.</p> 
<p>        dataGridView1.AllowUserToAddRows = false;</p> 
<p>        dataGridView1.Dock = DockStyle.Fill;</p> 
<p>        dataGridView1.SortCompare += new DataGridViewSortCompareEventHandler(</p> 
<p>            this.dataGridView1_SortCompare);</p> 
<p>        Controls.Add(this.dataGridView1);</p> 
<p>        this.Text = "DataGridView.SortCompare demo";</p> 
<p></p> 
<p>        PopulateDataGridView();</p> 
<p>    }</p> 
<p></p> 
<p>    // Replace this with your own population code.</p> 
<p>    public void PopulateDataGridView()</p> 
<p>    {<!-- --></p> 
<p>        // Add columns to the DataGridView.</p> 
<p>        dataGridView1.ColumnCount = 3;</p> 
<p></p> 
<p>        // Set the properties of the DataGridView columns.</p> 
<p>        dataGridView1.Columns[0].Name = "ID";</p> 
<p>        dataGridView1.Columns[1].Name = "Name";</p> 
<p>        dataGridView1.Columns[2].Name = "City";</p> 
<p>        dataGridView1.Columns["ID"].HeaderText = "ID";</p> 
<p>        dataGridView1.Columns["Name"].HeaderText = "Name";</p> 
<p>        dataGridView1.Columns["City"].HeaderText = "City";</p> 
<p></p> 
<p>        // Add rows of data to the DataGridView.</p> 
<p>        dataGridView1.Rows.Add(new string[] { "1", "Parker", "Seattle" });</p> 
<p>        dataGridView1.Rows.Add(new string[] { "2", "Parker", "New York" });</p> 
<p>        dataGridView1.Rows.Add(new string[] { "3", "Watson", "Seattle" });</p> 
<p>        dataGridView1.Rows.Add(new string[] { "4", "Jameson", "New Jersey" });</p> 
<p>        dataGridView1.Rows.Add(new string[] { "5", "Brock", "New York" });</p> 
<p>        dataGridView1.Rows.Add(new string[] { "6", "Conner", "Portland" });</p> 
<p></p> 
<p>        // Autosize the columns.</p> 
<p>        dataGridView1.AutoResizeColumns();</p> 
<p>    }</p> 
<p></p> 
<p>    private void dataGridView1_SortCompare(object sender,</p> 
<p>        DataGridViewSortCompareEventArgs e)</p> 
<p>    {<!-- --></p> 
<p>        // Try to sort based on the cells in the current column.</p> 
<p>        e.SortResult = System.String.Compare(</p> 
<p>            e.CellValue1.ToString(), e.CellValue2.ToString());</p> 
<p></p> 
<p>        // If the cells are equal, sort based on the ID column.</p> 
<p>        if (e.SortResult == 0 &amp;&amp; e.Column.Name != "ID")</p> 
<p>        {<!-- --></p> 
<p>            e.SortResult = System.String.Compare(</p> 
<p>                dataGridView1.Rows[e.RowIndex1].Cells["ID"].Value.ToString(),</p> 
<p>                dataGridView1.Rows[e.RowIndex2].Cells["ID"].Value.ToString());</p> 
<p>        }</p> 
<p>        e.Handled = true;</p> 
<p>    }</p> 
<p>}</p> 
<p></p> 
<p>9.2.2 Custom Sorting Using the IComparer Interface</p> 
<p>The following code example demonstrates custom sorting using the Sort(IComparer) overload of the Sort method, which takes an implementation of the IComparer interface to perform a multiple-column sort.</p> 
<p>using System;</p> 
<p>using System.Drawing;</p> 
<p>using System.Windows.Forms;</p> 
<p></p> 
<p>class Form1 : Form</p> 
<p>{<!-- --></p> 
<p>    private DataGridView DataGridView1 = new DataGridView();</p> 
<p>    private FlowLayoutPanel FlowLayoutPanel1 = new FlowLayoutPanel();</p> 
<p>    private Button Button1 = new Button();</p> 
<p>    private RadioButton RadioButton1 = new RadioButton();</p> 
<p>    private RadioButton RadioButton2 = new RadioButton();</p> 
<p></p> 
<p>    // Establish the main entry point for the application.</p> 
<p>    [STAThreadAttribute()]</p> 
<p>    public static void Main()</p> 
<p>    {<!-- --></p> 
<p>        Application.Run(new Form1());</p> 
<p>    }</p> 
<p></p> 
<p>    public Form1()</p> 
<p>    {<!-- --></p> 
<p>        // Initialize the form.</p> 
<p>        // This code can be replaced with designer generated code.</p> 
<p>        AutoSize = true;</p> 
<p>        Text = "DataGridView IComparer sort demo";</p> 
<p></p> 
<p>        FlowLayoutPanel1.FlowDirection = FlowDirection.TopDown;</p> 
<p>        FlowLayoutPanel1.Location = new System.Drawing.Point(304, 0);</p> 
<p>        FlowLayoutPanel1.AutoSize = true;</p> 
<p></p> 
<p>        FlowLayoutPanel1.Controls.Add(RadioButton1);</p> 
<p>        FlowLayoutPanel1.Controls.Add(RadioButton2);</p> 
<p>        FlowLayoutPanel1.Controls.Add(Button1);</p> 
<p></p> 
<p>        Button1.Text = "Sort";</p> 
<p>        RadioButton1.Text = "Ascending";</p> 
<p>        RadioButton2.Text = "Descending";</p> 
<p>        RadioButton1.Checked = true;</p> 
<p></p> 
<p>        Controls.Add(FlowLayoutPanel1);</p> 
<p>        Controls.Add(DataGridView1);</p> 
<p>    }</p> 
<p></p> 
<p>    protected override void OnLoad(EventArgs e)</p> 
<p>    {<!-- --></p> 
<p>        PopulateDataGridView();</p> 
<p>        Button1.Click += new EventHandler(Button1_Click);</p> 
<p></p> 
<p>        base.OnLoad(e);</p> 
<p>    }</p> 
<p></p> 
<p>    // Replace this with your own code to populate the DataGridView.</p> 
<p>    private void PopulateDataGridView()</p> 
<p>{<!-- --></p> 
<p>    DataGridView1.Size = new Size(300, 300);</p> 
<p></p> 
<p>        // Add columns to the DataGridView.</p> 
<p>        DataGridView1.ColumnCount = 2;</p> 
<p></p> 
<p>        // Set the properties of the DataGridView columns.</p> 
<p>        DataGridView1.Columns[0].Name = "First";</p> 
<p>        DataGridView1.Columns[1].Name = "Last";</p> 
<p>        DataGridView1.Columns["First"].HeaderText = "First Name";</p> 
<p>        DataGridView1.Columns["Last"].HeaderText = "Last Name";</p> 
<p>        DataGridView1.Columns["First"].SortMode =</p> 
<p>            DataGridViewColumnSortMode.Programmatic;</p> 
<p>        DataGridView1.Columns["Last"].SortMode =</p> 
<p>            DataGridViewColumnSortMode.Programmatic;</p> 
<p></p> 
<p>        // Add rows of data to the DataGridView.</p> 
<p>        DataGridView1.Rows.Add(new string[] { "Peter", "Parker" });</p> 
<p>        DataGridView1.Rows.Add(new string[] { "James", "Jameson" });</p> 
<p>        DataGridView1.Rows.Add(new string[] { "May", "Parker" });</p> 
<p>        DataGridView1.Rows.Add(new string[] { "Mary", "Watson" });</p> 
<p>        DataGridView1.Rows.Add(new string[] { "Eddie", "Brock" });</p> 
<p>    }</p> 
<p></p> 
<p>    private void Button1_Click(object sender, EventArgs e)</p> 
<p>    {<!-- --></p> 
<p>        if (RadioButton1.Checked == true)</p> 
<p>        {<!-- --></p> 
<p>            DataGridView1.Sort(new RowComparer(SortOrder.Ascending));</p> 
<p>        }</p> 
<p>        else if (RadioButton2.Checked == true)</p> 
<p>        {<!-- --></p> 
<p>            DataGridView1.Sort(new RowComparer(SortOrder.Descending));</p> 
<p>        }</p> 
<p>    }</p> 
<p></p> 
<p>    private class RowComparer : System.Collections.IComparer</p> 
<p>    {<!-- --></p> 
<p>        private static int sortOrderModifier = 1;</p> 
<p></p> 
<p>        public RowComparer(SortOrder sortOrder)</p> 
<p>        {<!-- --></p> 
<p>            if (sortOrder == SortOrder.Descending)</p> 
<p>            {<!-- --></p> 
<p>                sortOrderModifier = -1;</p> 
<p>            }</p> 
<p>            else if (sortOrder == SortOrder.Ascending)</p> 
<p>            {<!-- --></p> 
<p>                sortOrderModifier = 1;</p> 
<p>            }</p> 
<p>        }</p> 
<p></p> 
<p>        public int Compare(object x, object y)</p> 
<p>        {<!-- --></p> 
<p>            DataGridViewRow DataGridViewRow1 = (DataGridViewRow)x;</p> 
<p>            DataGridViewRow DataGridViewRow2 = (DataGridViewRow)y;</p> 
<p></p> 
<p>            // Try to sort based on the Last Name column.</p> 
<p>            int CompareResult = System.String.Compare(</p> 
<p>                DataGridViewRow1.Cells[1].Value.ToString(),</p> 
<p>                DataGridViewRow2.Cells[1].Value.ToString());</p> 
<p></p> 
<p>            // If the Last Names are equal, sort based on the First Name.</p> 
<p>            if (CompareResult == 0)</p> 
<p>            {<!-- --></p> 
<p>CompareResult = System.String.Compare(</p> 
<p>                    DataGridViewRow1.Cells[0].Value.ToString(),</p> 
<p>                    DataGridViewRow2.Cells[0].Value.ToString());</p> 
<p>            }</p> 
<p>            return CompareResult * sortOrderModifier;</p> 
<p>       }</p> 
<p>    }</p> 
<p>}</p> 
<p>10. 如何为编辑控件添加事件处理函数？<br> 有时候你需要处理单元格包含的编辑控件的特定事件。你需要处理DataGridView.EditingControlShowing 事件，它的第二个参数的Control属性能让你访问该单元格包含的编辑控件。如果你要处理的事件不属于它的基类Control，还需要将该控件转换为特定的控件(一般为ComboBox控件或TextBox控件)。</p> 
<p></p> 
<p>注意：如果类型相同，DataGridView会重用该编辑控件，因此，你应该确保不会添加已存在的事件处理函数，否则会调用相同的函数多次(可以在添加前先将其移除，请参考我的示例代码)。</p> 
<p>11. 应在何时移除编辑控件的事件处理函数？<br> 如果你只是想临时为编辑控件添加事件处理函数(可能是针对特定列的特定单元格)，你可以在CellEndEdit事件中移除该处理函数。你也可以在添加之前移除任何已存在的事件处理函数。</p> 
<p></p> 
<p>12. 如何处理ComboBox列中控件的SelectIndexChanged事件?<br> 有时知道用户何时选择了ComboBox编辑控件的项(item)会比较有用。对于窗体上的ComboBox 控件，你通常会处理它的SelectedIndexChanged事件，对于DataGridViewComboBox，通过处理DataGridView.EditingControlShowing事件你可以完成相同的事情。下面这段示例代码演示了这一点。注意：它同时也演示了如何避免添加多个相同的事件处理函数(即在添加前先移除已存在的事件处理函数，可以参考问题11)。</p> 
<p></p> 
<p>private void dataGridView1_EditingControlShowing(object sender,</p> 
<p>                    DataGridViewEditingControlShowingEventArgs e)</p> 
<p>{<!-- --><br>     ComboBox cb = e.Control as ComboBox;</p> 
<p>    if (cb != null)</p> 
<p>    {<!-- --></p> 
<p>        // first remove event handler to keep from attaching multiple:</p> 
<p>        cb.SelectedIndexChanged -= new<br>        EventHandler(cb_SelectedIndexChanged);</p> 
<p></p> 
<p>        // now attach the event handler</p> 
<p>        cb.SelectedIndexChanged += new <br>        EventHandler(cb_SelectedIndexChanged);</p> 
<p>    }</p> 
<p>}</p> 
<p></p> 
<p>void cb_SelectedIndexChanged(object sender, EventArgs e)</p> 
<p>{<!-- --><br>     MessageBox.Show("Selected index changed");<br> }</p> 
<p></p> 
<p>13. 如何通过拖放调整行的顺序？<br> 通过拖放调整行的顺序不是DataGridView的内置功能，但使用标准的拖放处理代码，你可以很容易的实现这个功能。下面这个代码片断演示了这个过程，假定你的窗体上有一个name为dataGridView1的DataGridView，它的AllowDrop属性为true，还要为它添加必要的事件处理方法。(我试运行了这段代码，如果通过数据绑定为DataGridView添加数据，那么下面的代码将不会生效，因为它只能为非绑定方式添加的行排序，如果要以绑定方式添加数据，请参看我的示例程序)</p> 
<p></p> 
<p>private Rectangle dragBoxFromMouseDown;</p> 
<p>private int rowIndexFromMouseDown;</p> 
<p>private int rowIndexOfItemUnderMouseToDrop;</p> 
<p>private void dataGridView1_MouseMove(object sender, MouseEventArgs e)</p> 
<p>{<!-- --><br>     if ((e.Button &amp; MouseButtons.Left) == MouseButtons.Left)</p> 
<p>    {<!-- --></p> 
<p>        // If the mouse moves outside the rectangle, start the drag.</p> 
<p>        if (dragBoxFromMouseDown != Rectangle.Empty &amp;&amp;</p> 
<p>            !dragBoxFromMouseDown.Contains(e.X, e.Y))</p> 
<p>        {<!-- --></p> 
<p></p> 
<p>            // Proceed with the drag and drop, passing in the list item.                   </p> 
<p>            DragDropEffects dropEffect = dataGridView1.DoDragDrop(<br>            dataGridView1.Rows[rowIndexFromMouseDown],<br>            DragDropEffects.Move);</p> 
<p>        }</p> 
<p>    }</p> 
<p>}</p> 
<p></p> 
<p>private void dataGridView1_MouseDown(object sender, MouseEventArgs e)</p> 
<p>{<!-- --><br>     // Get the index of the item the mouse is below.</p> 
<p>    rowIndexFromMouseDown = dataGridView1.HitTest(e.X, e.Y).RowIndex;</p> 
<p></p> 
<p>    if (rowIndexFromMouseDown != -1)</p> 
<p>    {<!-- --></p> 
<p>        // Remember the point where the mouse down occurred. <br>     // The DragSize indicates the size that the mouse can move <br>     // before a drag event should be started.               </p> 
<p>        Size dragSize = SystemInformation.DragSize;</p> 
<p></p> 
<p>        // Create a rectangle using the DragSize, with the mouse position being</p> 
<p>        // at the center of the rectangle.</p> 
<p>        dragBoxFromMouseDown = new Rectangle(new Point(e.X - (dragSize.Width / 2),</p> 
<p>                                                       e.Y - (dragSize.Height / 2)),<br>                            dragSize);</p> 
<p>    }</p> 
<p>    else</p> 
<p>        // Reset the rectangle if the mouse is not over an item in the ListBox.</p> 
<p>        dragBoxFromMouseDown = Rectangle.Empty;</p> 
<p>}</p> 
<p></p> 
<p>private void dataGridView1_DragOver(object sender, DragEventArgs e)</p> 
<p>{<!-- --><br>     e.Effect = DragDropEffects.Move;</p> 
<p>}</p> 
<p></p> 
<p>private void dataGridView1_DragDrop(object sender, DragEventArgs e)</p> 
<p>{<!-- --><br>     // The mouse locations are relative to the screen, so they must be</p> 
<p>    // converted to client coordinates.</p> 
<p>    Point clientPoint = dataGridView1.PointToClient(new Point(e.X, e.Y));</p> 
<p></p> 
<p>    // Get the row index of the item the mouse is below.</p> 
<p>    rowIndexOfItemUnderMouseToDrop =</p> 
<p>        dataGridView1.HitTest(clientPoint.X, clientPoint.Y).RowIndex;</p> 
<p></p> 
<p>    // If the drag operation was a move then remove and insert the row.</p> 
<p>    if (e.Effect== DragDropEffects.Move)</p> 
<p>    {<!-- --></p> 
<p>        DataGridViewRow rowToMove = e.Data.GetData(<br>            typeof(DataGridViewRow)) as DataGridViewRow;</p> 
<p>        dataGridView1.Rows.RemoveAt(rowIndexFromMouseDown);</p> 
<p>        dataGridView1.Rows.Insert(rowIndexOfItemUnderMouseToDrop, rowToMove);</p> 
<p></p> 
<p>    }</p> 
<p>}</p> 
<p>14. 如何调整最后一列的宽度使其占据网格的剩余客户区？<br> 以默认方式填充DataGridView时，可能会发生因列的宽度不够，而暴露出控件的灰色背景的情况，很不美观。将最后一列的AutoSizeMode属性设置为Fill会使该列调整大小来填充网格的剩余客户区(client area)。作为一个可选的方式，你可以设置最后一列MinimumWidth属性，以保持该列的宽度不至于太小。</p> 
<p>15. 如何让TextBox类型的单元格支持换行?<br> 默认情况下，DataGridViewTextBoxCell不支持换行，这个可以由DataGridViewCellStyle的WrapMode属性来控制。 (如DataGridView.DefaultCellStyle.WrapMode)。将WrapMode 属性DataGridViewTriState枚举的三个取值之一。</p> 
<p></p> 
<p>下面的代码示例使用DataGridView.DefaultCellStyle属性设置整个控件所包含的单元格的WrapMode属性(即设置所有单元格的换行模式)。</p> 
<p>this.dataGridView1.DefaultCellStyle.WrapMode = DataGridViewTriState.True;</p> 
<p>16. 如何使Image列不显示任何图像(字段值为null时)?<br> 默认情况下Image类型的列和单元格将null值转换为标准的“X”图像( )，将Image列的NullValue属性设置为null可使该列不显示任何图像。下面这行代码演示了如何设置Image列的NullValue属性。</p> 
<p></p> 
<p>this.dataGridViewImageColumn1.DefaultCellStyle.NullValue = null;</p> 
<p></p> 
<p>17. 如何能够在ComboBox类型的单元格中输入数据?<br> 默认情况下，DataGridViewComboBoxCell不接受用户的输入值。但有时确实有向ComboxBox输入数据的需要。实现这个功能，你需要做两件事。一是将ComboBox编辑控件的DropDownStyle属性设置为DropDown，使用户可以进行输入(否则只能进行选择)；二是确保用户输入的值能够添加到ComboBox的Items集合。这是因为ComboBoxCell的值必须在Items集合中，否则会触发DataError事件(参看3.5.1节)，而适合添加新值到Items集合的地方是CellValidating事件处理函数:</p> 
<p></p> 
<p>private void dataGridView1_CellValidating(object sender,<br>         DataGridViewCellValidatingEventArgs e)</p> 
<p>{<!-- --></p> 
<p>    if (e.ColumnIndex == comboBoxColumn.DisplayIndex)</p> 
<p>    {<!-- --></p> 
<p>        if (!this.comboBoxColumn.Items.Contains(e.FormattedValue))</p> 
<p>        {<!-- --></p> 
<p>            this.comboBoxColumn.Items.Add(e.FormattedValue);</p> 
<p>        }</p> 
<p>    }</p> 
<p>}</p> 
<p></p> 
<p>private void dataGridView1_EditingControlShowing(object sender,<br>        DataGridViewEditingControlShowingEventArgs e)</p> 
<p>{<!-- --></p> 
<p>    if (this.dataGridView1.CurrentCellAddress.X == comboBoxColumn.DisplayIndex)</p> 
<p>    {<!-- --></p> 
<p>        ComboBox cb = e.Control as ComboBox;</p> 
<p>        if (cb != null)</p> 
<p>        {<!-- --></p> 
<p>            cb.DropDownStyle = ComboBoxStyle.DropDown;</p> 
<p>         }</p> 
<p>    }</p> 
<p>}</p> 
<p>18. How do I have a combo box column display a sub set of data based upon the value of a different combo box column(TODO)?<br> Sometimes data that you want to display in the DataGridView has a relationship between two tables such as a category and subcategory. You want to let the user select the category and then choose between a subcategory based upon the category. This is possible with the DataGridView by using two combo box columns. To enable this, two versions of the filtered list (subcategory) needs to be created. One list has no filter applied while the other one will be filtered only when the user is editing a subcategory cell. Two lists are required due to the requirement described in 3.5.1 section that a combo box cells value must be in the items collection or else a DataError event is raised. In this case, since all combo box cells in the column use the same datasource if you filter the datasource for one row then a combo box cell in another row might not have its value visible in the datasource, thus causing a DataError event.</p> 
<p></p> 
<p>The below example uses the Northwind database to display related data from the Territory and Region tables (a territory is in a specific region.) Using the category and subcategory concept, the Region is the category and the Territory is the subcategory.</p> 
<p></p> 
<p>private void Form1_Load(object sender, EventArgs e)</p> 
<p>{<!-- --></p> 
<p>    this.territoriesTableAdapter.Fill(this.northwindDataSet.Territories);</p> 
<p>    this.regionTableAdapter.Fill(this.northwindDataSet.Region);</p> 
<p></p> 
<p>    // Setup BindingSource for filtered view.</p> 
<p>    filteredTerritoriesBS = new BindingSource();</p> 
<p>    DataView dv = new DataView(northwindDataSet.Tables["Territories"]);</p> 
<p>    filteredTerritoriesBS.DataSource = dv;</p> 
<p></p> 
<p>}</p> 
<p></p> 
<p>private void dataGridView1_CellBeginEdit(object sender,<br>         DataGridViewCellCancelEventArgs e)</p> 
<p>{<!-- --></p> 
<p>    if (e.ColumnIndex == territoryComboBoxColumn.Index)</p> 
<p>    {<!-- --></p> 
<p>        // Set the combobox cell datasource to the filtered BindingSource</p> 
<p>        DataGridViewComboBoxCell dgcb = (DataGridViewComboBoxCell)dataGridView1<br>                        [e.ColumnIndex, e.RowIndex];</p> 
<p>        dgcb.DataSource = filteredTerritoriesBS;</p> 
<p></p> 
<p>        // Filter the BindingSource based upon the region selected</p> 
<p>        this.filteredTerritoriesBS.Filter = "RegionID = " +</p> 
<p>            this.dataGridView1[e.ColumnIndex - 1, e.RowIndex].Value.ToString();</p> 
<p>    }</p> 
<p>}</p> 
<p></p> 
<p>private void dataGridView1_CellEndEdit(object sender, DataGridViewCellEventArgs e)</p> 
<p>{<!-- --></p> 
<p>    if (e.ColumnIndex == this.territoryComboBoxColumn.Index)</p> 
<p>    {<!-- --></p> 
<p>        // Reset combobox cell to the unfiltered BindingSource</p> 
<p>        DataGridViewComboBoxCell dgcb = (DataGridViewComboBoxCell)dataGridView1<br>                        [e.ColumnIndex, e.RowIndex];</p> 
<p>        dgcb.DataSource = territoriesBindingSource; //unfiltered</p> 
<p></p> 
<p>        this.filteredTerritoriesBS.RemoveFilter();</p> 
<p>    }</p> 
<p>}</p> 
<p>19. 如何在用户编辑控件的时候(而不是在验证时)就显示错误图标?<br> 在使用错误文本和图标时，有时你希望为用户提供一个即时反馈，以提示当前的输入不正确。默认情况下，即使设置了ErrorText属性，如果单元格仍处于编辑模式下，那么错误图标也不会显示，比如TextBox和ComboBox。</p> 
<p></p> 
<p>下面的示例演示了如何在CellValidating事件中填充(padding)一个单元格为错误图标提供空间。因为默认情况下填充行为会影响错误图标的位置，该示例(TODO)。The below sample demonstrates how you can set a cell’s padding in the CellValidating event to provide spacing for the error icon. Since padding by default affects the location of the error icon the sample uses the CellPainting to move the position of the icon for painting. Lastly, the sample uses the tooltip control to display a custom tooltip when the mouse is over the cell to indicate what the problem is. This sample could also be written as a custom cell that overrides GetErrorIconBounds method to provide a location for the error icon that was independent of the padding.  </p> 
<p></p> 
<p>private ToolTip errorTooltip;</p> 
<p>private Point cellInError = new Point(-2, -2);</p> 
<p>public Form1()</p> 
<p>{<!-- --></p> 
<p>    InitializeComponent();</p> 
<p>    dataGridView1.ColumnCount = 3;</p> 
<p>    dataGridView1.RowCount = 10;</p> 
<p>}</p> 
<p></p> 
<p>private void dataGridView1_CellValidating(object sender, DataGridViewCellValidatingEventArgs e)</p> 
<p>{<!-- --></p> 
<p>    if (dataGridView1.IsCurrentCellDirty)</p> 
<p>    {<!-- --></p> 
<p>        if (e.FormattedValue.ToString() == "BAD")</p> 
<p>        {<!-- --></p> 
<p>            DataGridViewCell cell = dataGridView1[e.ColumnIndex, e.RowIndex];</p> 
<p>            cell.ErrorText = "Invalid data entered in cell";</p> 
<p></p> 
<p>            // increase padding for icon. This moves the editing control</p> 
<p>            if (cell.Tag == null)</p> 
<p>            {<!-- --></p> 
<p>                cell.Tag = cell.Style.Padding;</p> 
<p>                cell.Style.Padding = new Padding(0, 0, 18, 0);</p> 
<p>                cellInError = new Point(e.ColumnIndex, e.RowIndex);</p> 
<p>            }</p> 
<p>            if (errorTooltip == null)</p> 
<p>            {<!-- --></p> 
<p>                errorTooltip = new ToolTip();</p> 
<p>                errorTooltip.InitialDelay = 0;</p> 
<p>                errorTooltip.ReshowDelay = 0;</p> 
<p>                errorTooltip.Active = false;</p> 
<p>            }</p> 
<p></p> 
<p>            e.Cancel = true;</p> 
<p>        }</p> 
<p>    }</p> 
<p>}</p> 
<p></p> 
<p>private void dataGridView1_CellPainting(object sender, DataGridViewCellPaintingEventArgs e)</p> 
<p>{<!-- --></p> 
<p>    if (dataGridView1.IsCurrentCellDirty &amp;&amp; !String.IsNullOrEmpty(e.ErrorText))</p> 
<p>    {<!-- --></p> 
<p>        // paint everything except error icon</p> 
<p>        e.Paint(e.ClipBounds, DataGridViewPaintParts.All &amp; <br>            ~(DataGridViewPaintParts.ErrorIcon));</p> 
<p></p> 
<p>        // now move error icon over to fill in the padding space</p> 
<p>        GraphicsContainer container = e.Graphics.BeginContainer();</p> 
<p>        e.Graphics.TranslateTransform(18, 0);</p> 
<p>        e.Paint(this.ClientRectangle, DataGridViewPaintParts.ErrorIcon);</p> 
<p>        e.Graphics.EndContainer(container);</p> 
<p></p> 
<p>        e.Handled = true;</p> 
<p>    }</p> 
<p>}</p> 
<p></p> 
<p>private void dataGridView1_CellEndEdit(object sender, DataGridViewCellEventArgs e)</p> 
<p>{<!-- --></p> 
<p>    if (dataGridView1[e.ColumnIndex, e.RowIndex].ErrorText != String.Empty)</p> 
<p>    {<!-- --></p> 
<p>        DataGridViewCell cell = dataGridView1[e.ColumnIndex, e.RowIndex];</p> 
<p>        cell.ErrorText = String.Empty;</p> 
<p>        cellInError = new Point(-2,-2);</p> 
<p></p> 
<p>        // restore padding for cell. This moves the editing control</p> 
<p>        cell.Style.Padding = (Padding)cell.Tag;</p> 
<p></p> 
<p>        // hide and dispose tooltip</p> 
<p>        if (errorTooltip != null)</p> 
<p>       {<!-- --></p> 
<p>            errorTooltip.Hide(dataGridView1);</p> 
<p>            errorTooltip.Dispose();</p> 
<p>            errorTooltip = null;</p> 
<p>        }</p> 
<p>    }</p> 
<p>}</p> 
<p></p> 
<p>// show and hide the tooltip for error</p> 
<p>private void dataGridView1_CellMouseMove(object sender, <br>            DataGridViewCellMouseEventArgs e)</p> 
<p>{<!-- --></p> 
<p>    if (cellInError.X == e.ColumnIndex &amp;&amp;</p> 
<p>        cellInError.Y == e.RowIndex)</p> 
<p>{<!-- --></p> 
<p>DataGridViewCell cell = dataGridView1[e.ColumnIndex, e.RowIndex];</p> 
<p></p> 
<p>        if (cell.ErrorText != String.Empty)</p> 
<p>        {<!-- --></p> 
<p>            if (!errorTooltip.Active)</p> 
<p>            {<!-- --></p> 
<p>                errorTooltip.Show(cell.ErrorText, dataGridView1, 1000);</p> 
<p>            }</p> 
<p>            errorTooltip.Active = true;</p> 
<p>        }</p> 
<p>    }</p> 
<p>}</p> 
<p></p> 
<p>private void dataGridView1_CellMouseLeave(object sender, DataGridViewCellEventArgs e)</p> 
<p>{<!-- --></p> 
<p>    if (cellInError.X == e.ColumnIndex &amp;&amp;</p> 
<p>        cellInError.Y == e.RowIndex)</p> 
<p>    {<!-- --></p> 
<p>        if (errorTooltip.Active)</p> 
<p>        {<!-- --></p> 
<p>            errorTooltip.Hide(dataGridView1);</p> 
<p>            errorTooltip.Active = false;</p> 
<p>        }</p> 
<p>    }</p> 
<p>}</p> 
<p>20. 如何同时显示绑定数据和非绑定数据？<br> The data you display in the DataGridView control will normally come from a data source of some kind, but you might want to display a column of data that does not come from the data source. This kind of column is called an unbound column. Unbound columns can take many forms.    As discussed in the data section above, you can use virtual mode to display additional data along with bound data.</p> 
<p></p> 
<p>The following code example demonstrates how to create an unbound column of check box cells to enable the user to select database records to process. The grid is put into virtual mode and responds to the necessary events. The selected records are kept by ID in a dictionary to allow the user to sort the content but not lose the checked rows.</p> 
<p></p> 
<p>private System.Collections.Generic.Dictionary&lt;int, bool&gt; checkState;</p> 
<p>private void Form1_Load(object sender, EventArgs e)</p> 
<p>{<!-- --></p> 
<p>    dataGridView1.AutoGenerateColumns = false;</p> 
<p>    dataGridView1.DataSource = customerOrdersBindingSource;</p> 
<p></p> 
<p>    // The check box column will be virtual.</p> 
<p>    dataGridView1.VirtualMode = true;</p> 
<p>    dataGridView1.Columns.Insert(0, new DataGridViewCheckBoxColumn());</p> 
<p></p> 
<p>    // Initialize the dictionary that contains the boolean check state.</p> 
<p>    checkState = new Dictionary&lt;int, bool&gt;();</p> 
<p>}</p> 
<p>private void dataGridView1_CellValueChanged(object sender, DataGridViewCellEventArgs e)</p> 
<p>{<!-- --></p> 
<p>    // Update the status bar when the cell value changes.</p> 
<p>    if (e.ColumnIndex == 0 &amp;&amp; e.RowIndex != -1)</p> 
<p>    {<!-- --></p> 
<p>        // Get the orderID from the OrderID column.</p> 
<p>        int orderID = (int)dataGridView1.Rows[e.RowIndex].Cells["OrderID"].Value;</p> 
<p>        checkState[orderID] = (bool)dataGridView1.Rows[e.RowIndex].Cells[0].Value;</p> 
<p></p> 
<p>}</p> 
<p></p> 
<p>private void dataGridView1_CellValueNeeded(object sender, DataGridViewCellValueEventArgs e)</p> 
<p>{<!-- --></p> 
<p>    // Handle the notification that the value for a cell in the virtual column</p> 
<p>    // is needed. Get the value from the dictionary if the key exists.</p> 
<p></p> 
<p>    if (e.ColumnIndex == 0)</p> 
<p>    {<!-- --></p> 
<p>        int orderID = (int)dataGridView1.Rows[e.RowIndex].Cells["OrderID"].Value;</p> 
<p>        if (checkState.ContainsKey(orderID))</p> 
<p>        {<!-- --></p> 
<p>            e.Value = checkState[orderID];</p> 
<p>        }</p> 
<p>        else</p> 
<p>            e.Value = false;</p> 
<p>    }</p> 
<p></p> 
<p>}</p> 
<p></p> 
<p>private void dataGridView1_CellValuePushed(object sender, DataGridViewCellValueEventArgs e)</p> 
<p>{<!-- --></p> 
<p>    // Handle the notification that the value for a cell in the virtual column</p> 
<p>    // needs to be pushed back to the dictionary.</p> 
<p></p> 
<p>    if (e.ColumnIndex == 0)</p> 
<p>    {<!-- --></p> 
<p>        // Get the orderID from the OrderID column.</p> 
<p>        int orderID = (int)dataGridView1.Rows[e.RowIndex].Cells["OrderID"].Value;</p> 
<p></p> 
<p>        // Add or update the checked value to the dictionary depending on if the</p> 
<p>        // key (orderID) already exists.</p> 
<p>        if (!checkState.ContainsKey(orderID))</p> 
<p>        {<!-- --></p> 
<p>            checkState.Add(orderID, (bool)e.Value);</p> 
<p>        }</p> 
<p>        else</p> 
<p>            checkState[orderID] = (bool)e.Value;</p> 
<p>    }</p> 
<p>}</p> 
<p>21. How do I show data that comes from two tables(TODO)?<br> The DataGridView does not provide any new features apart from virtual mode to enable this. What you can do is use the JoinView class described in the following article http://support.microsoft.com/default.aspx?scid=kb;en-us;325682. Using this class you can join two or more DataTables together. This JoinView can then be databound to the DataGridView.</p> 
<p>22. 如何显示主从表？<br> 使用DataGridView时最常见的情况之一就是主从表单，这时要显示具有主从关系的两个数据表。在主表中选择一行记录，从表中也会随之变化，显示相应的记录。</p> 
<p></p> 
<p>通过DataGridView控件和BindingSource 组件的交互作用来实现主从表单是非常简单的。下面的示例演示的是SQL Server的范例数据库Northwind 中的两个表：Customers 和Orders。在主DataGridView中选择一个顾客，那么该顾客的所有订单会显示在从DataGridView 中。</p> 
<p></p> 
<p></p> 
<p>using System;</p> 
<p>using System.Data;</p> 
<p>using System.Data.SqlClient;</p> 
<p>using System.Windows.Forms;</p> 
<p></p> 
<p>public class Form1 : System.Windows.Forms.Form</p> 
<p>{<!-- --></p> 
<p>    private DataGridView masterDataGridView = new DataGridView();</p> 
<p>    private BindingSource masterBindingSource = new BindingSource();</p> 
<p>    private DataGridView detailsDataGridView = new DataGridView();</p> 
<p>    private BindingSource detailsBindingSource = new BindingSource();</p> 
<p></p> 
<p>    [STAThreadAttribute()]</p> 
<p>    public static void Main()</p> 
<p>    {<!-- --></p> 
<p>        Application.Run(new Form1());</p> 
<p>    }</p> 
<p></p> 
<p>    // Initializes the form.</p> 
<p>    public Form1()</p> 
<p>    {<!-- --></p> 
<p>        masterDataGridView.Dock = DockStyle.Fill;</p> 
<p>        detailsDataGridView.Dock = DockStyle.Fill;</p> 
<p></p> 
<p>        SplitContainer splitContainer1 = new SplitContainer();</p> 
<p>        splitContainer1.Dock = DockStyle.Fill;</p> 
<p>        splitContainer1.Orientation = Orientation.Horizontal;</p> 
<p>        splitContainer1.Panel1.Controls.Add(masterDataGridView);</p> 
<p>        splitContainer1.Panel2.Controls.Add(detailsDataGridView);</p> 
<p></p> 
<p>        this.Controls.Add(splitContainer1);</p> 
<p>        this.Load += new System.EventHandler(Form1_Load);</p> 
<p>        this.Text = "DataGridView master/detail demo";</p> 
<p>    }</p> 
<p></p> 
<p>    private void Form1_Load(object sender, System.EventArgs e)</p> 
<p>    {<!-- --></p> 
<p>        // Bind the DataGridView controls to the BindingSource</p> 
<p>        // components and load the data from the database.</p> 
<p>        masterDataGridView.DataSource = masterBindingSource;</p> 
<p>        detailsDataGridView.DataSource = detailsBindingSource;</p> 
<p>        GetData();</p> 
<p></p> 
<p>        // Resize the master DataGridView columns to fit the newly loaded data.</p> 
<p>        masterDataGridView.AutoResizeColumns();</p> 
<p></p> 
<p>        // Configure the details DataGridView so that its columns automatically</p> 
<p>        // adjust their widths when the data changes.</p> 
<p>        detailsDataGridView.AutoSizeColumnsMode =</p> 
<p>            DataGridViewAutoSizeColumnsMode.AllCells;</p> 
<p>    }</p> 
<p></p> 
<p>    private void GetData()</p> 
<p>    {<!-- --></p> 
<p>        try</p> 
<p>        {<!-- --></p> 
<p>            // Specify a connection string. Replace the given value with a</p> 
<p>            // valid connection string for a Northwind SQL Server sample</p> 
<p>            // database accessible to your system.</p> 
<p>            String connectionString =</p> 
<p>                "Integrated Security=SSPI;Persist Security Info=False;" +</p> 
<p>                "Initial Catalog=Northwind;Data Source=localhost";</p> 
<p>            SqlConnection connection = new SqlConnection(connectionString);</p> 
<p></p> 
<p>            // Create a DataSet.</p> 
<p>            DataSet data = new DataSet();</p> 
<p>            data.Locale = System.Globalization.CultureInfo.InvariantCulture;</p> 
<p></p> 
<p>            // Add data from the Customers table to the DataSet.</p> 
<p>            SqlDataAdapter masterDataAdapter = new</p> 
<p>                SqlDataAdapter("select * from Customers", connection);</p> 
<p>            masterDataAdapter.Fill(data, "Customers");</p> 
<p></p> 
<p>            // Add data from the Orders table to the DataSet.</p> 
<p>            SqlDataAdapter detailsDataAdapter = new</p> 
<p>                SqlDataAdapter("select * from Orders", connection);</p> 
<p>            detailsDataAdapter.Fill(data, "Orders");</p> 
<p></p> 
<p>            // Establish a relationship between the two tables.</p> 
<p>            DataRelation relation = new DataRelation("CustomersOrders",</p> 
<p>                data.Tables["Customers"].Columns["CustomerID"],</p> 
<p>                data.Tables["Orders"].Columns["CustomerID"]);</p> 
<p>            data.Relations.Add(relation);</p> 
<p></p> 
<p>            // Bind the master data connector to the Customers table.</p> 
<p>            masterBindingSource.DataSource = data;</p> 
<p>            masterBindingSource.DataMember = "Customers";</p> 
<p></p> 
<p>            // Bind the details data connector to the master data connector,</p> 
<p>            // using the DataRelation name to filter the information in the</p> 
<p>            // details table based on the current row in the master table.</p> 
<p>            detailsBindingSource.DataSource = masterBindingSource;</p> 
<p>            detailsBindingSource.DataMember = "CustomersOrders";</p> 
<p>        }</p> 
<p>        catch (SqlException)</p> 
<p>        {<!-- --></p> 
<p>MessageBox.Show("To run this example, replace the value of the " +</p> 
<p>                "connectionString variable with a connection string that is " +</p> 
<p>                "valid for your system.");</p> 
<p>        }</p> 
<p>    }</p> 
<p>}</p> 
<p>23. 如何在同一DataGridView中显示主从表？<br> DataGridView 不支持在同一DataGridView 中显示主从表。Windows Forms的先前版本中的DataGrid控件或许是你需要的一个解决方案。</p> 
<p>24. 如何避免用户对列排序?<br> 对于DataGridView 控件，默认情况下，TextBox类型的列会自动排序，而其它类型的列则不会自动排序。这种自动排序有时会把数据变得比较乱，这时你会想更改这些默认设置。</p> 
<p></p> 
<p>DataGridViewColumn的属性SortMode决定了列的排序方式，将其设置为DataGridViewColumnSortMode.NotSortable就可以避免默认的排序行为。</p> 
<p>25. 如何在点击工具栏按钮的时候将数据提交到数据库？<br> 默认情况下，操作工具栏或菜单不会导致对控件的验证。但对于绑定控件来说，提交数据前进行验证是必要的。而一旦窗体和其中的所有控件得到验证，当前编辑过的数据就需要提交。最后，数据适配器(如SqlDataAdapter)需要将数据的修改写入数据库。要达到这个效果，将下面三行代码加到相应的事件处理函数(指工具栏按钮或菜单项的事件)内：</p> 
<p></p> 
<p>this.Validate();</p> 
<p>this.customersBindingSource.EndEdit();            this.customersTableAdapter.Update(this.northwindDataSet.Customers);</p> 
<p>26. 如何在用户删除记录时显示确认对话框？<br> 当用户选择DataGridView的一行，按下Delete键时就会触发UserDeletingRow 事件。你可以提示用户是否确定要删除该行记录，建议仅在用户要删除已存在的记录(而不是用户添加的新行)时才进行这种提示。将下面这些代码添加到UserDeletingRow事件的处理方法中就可以实现这种功能：</p> 
<p></p> 
<p>if (!e.Row.IsNewRow)</p> 
<p>{<!-- --></p> 
<p>    DialogResult response = MessageBox.Show("Are you sure?", "Delete row?",<br>             MessageBoxButtons.YesNo, <br>             MessageBoxIcon.Question, <br>             MessageBoxDefaultButton.Button2);</p> 
<p>    if (response == DialogResult.No)</p> 
<p>        e.Cancel = true;</p> 
<p>}<br> ————————————————<br> 版权声明：本文为CSDN博主「yudehui」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。<br> 原文链接：https://blog.csdn.net/yudehui/article/details/6290622</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8343f3ac25c3cfd9975d6d2a1998fc82/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">windows环境下apache服务器能够正常启动，但是无法访问到的问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/334378e5481c6b7c40f76304a2ca9220/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">计算机非线性发展,构造一些变系数非线性发展方程的精确解</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>