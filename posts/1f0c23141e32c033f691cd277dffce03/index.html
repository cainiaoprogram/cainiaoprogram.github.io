<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>05. 基础篇 - 多表查询 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="05. 基础篇 - 多表查询" />
<meta property="og:description" content="多表关系 一对多（多对一） 多对多 一对一 多表查询概述 内连接 -- 查询每一个员工的姓名，及关联部门名称(隐式内连接) -- 表结构：name，dept -- 连接条件：emp.dept_id = dept_id select emp.name ,dept.name from emp, dept where emp.dept_id = dept_id; -- 查询每一个员工的姓名，及关联部门名称(显式内连接) -- 表结构：name，dept -- 连接条件：emp.dept_id = dept_id select e.name ,d.name from emp e inner join dept d on e.dept_id = d.id; 外连接 -- 查询emp表的所有数据，和对应的部门信息（左外连接） -- 表结构：emp dept -- 连接条件：emp.dept_id = dept.id select e.* ,d.name from emp e left outer join dept d on e.dept_id = d." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/1f0c23141e32c033f691cd277dffce03/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-02-24T17:32:49+08:00" />
<meta property="article:modified_time" content="2022-02-24T17:32:49+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">05. 基础篇 - 多表查询</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>多表关系</h2> 
<p><img alt="" height="246" src="https://images2.imgbox.com/b8/b2/jKUJgL8v_o.png" width="840"></p> 
<h3>一对多（多对一）</h3> 
<p><img alt="" height="315" src="https://images2.imgbox.com/cc/d5/gg0cJnXT_o.png" width="820"></p> 
<h3>多对多</h3> 
<p><img alt="" height="355" src="https://images2.imgbox.com/8a/4c/UAmrEGJM_o.png" width="834"></p> 
<h3>一对一</h3> 
<p><img alt="" height="333" src="https://images2.imgbox.com/a5/23/SILcQxoE_o.png" width="858"></p> 
<h2>多表查询概述</h2> 
<p><img alt="" height="344" src="https://images2.imgbox.com/53/8b/9CTjMgab_o.png" width="815"></p> 
<p><img alt="" height="354" src="https://images2.imgbox.com/d0/08/9LjKAHsE_o.png" width="822"></p> 
<p></p> 
<h2>内连接</h2> 
<p><img alt="" height="355" src="https://images2.imgbox.com/59/de/rDcLoVPX_o.png" width="818"></p> 
<pre><code class="language-sql">-- 查询每一个员工的姓名，及关联部门名称(隐式内连接)
-- 表结构：name，dept
-- 连接条件：emp.dept_id = dept_id
select emp.name ,dept.name from emp, dept
                where emp.dept_id = dept_id;

-- 查询每一个员工的姓名，及关联部门名称(显式内连接)
-- 表结构：name，dept
-- 连接条件：emp.dept_id = dept_id
select e.name ,d.name from emp e inner join dept d on
                e.dept_id = d.id;</code></pre> 
<h2>外连接</h2> 
<p><img alt="" height="354" src="https://images2.imgbox.com/1a/52/81kHb8xw_o.png" width="825"></p> 
<pre><code class="language-sql">-- 查询emp表的所有数据，和对应的部门信息（左外连接）
-- 表结构：emp dept
-- 连接条件：emp.dept_id = dept.id
select e.* ,d.name from emp e left outer join dept d on e.dept_id = d.id;

-- 查询emp表的所有数据，和对应的部门信息（右外连接）
-- 表结构：emp dept
-- 连接条件：emp.dept_id = dept.id
select d.* ,e.* from emp e right outer join dept d on d.id = e.dept_id;</code></pre> 
<h2>自连接</h2> 
<p><img alt="" height="132" src="https://images2.imgbox.com/58/10/wbZKZX4B_o.png" width="843"></p> 
<p><img alt="" height="363" src="https://images2.imgbox.com/4e/2d/0ARc6NRS_o.png" width="934"></p> 
<pre><code class="language-sql">-- 查询员工及其所属领导的名字
-- 表结构：emp.a emp.b
-- 连接条件：emp.managerid = emp.id
select a.name '员工' ,b.name '领导' from emp a ,emp b where a.managerid = b.id;

-- 查询所有员工emp及其领导的名字emp如果员工没有领导，也需要查询出来
-- 表结构：emp.a emp.b
-- 连接条件：emp.managerid = emp.id
select a.name '员工',b.name '领导' from emp a left join emp b on a.managerid = b.id;
</code></pre> 
<h2>联合查询</h2> 
<p><img alt="" height="298" src="https://images2.imgbox.com/37/d4/BZPiPJws_o.png" width="830"><img alt="" height="306" src="https://images2.imgbox.com/dc/1b/lUfWy6Yr_o.png" width="866"></p> 
<pre><code class="language-sql">-- 将薪资低于5000的员工和年龄大于50的员工全部查询出来(不去重)
select *from emp where salary &lt; 5000
union all
select *from emp where age &gt; 50;

-- 将薪资低于5000的员工和年龄大于50的员工全部查询出来(去重)
select *from emp where salary &lt; 5000
union
select *from emp where age &gt; 50;</code></pre> 
<h2>子查询</h2> 
<p><img alt="" height="373" src="https://images2.imgbox.com/8d/b1/6OUjRSWZ_o.png" width="822"></p> 
<h3>标量子查询</h3> 
<p><img alt="" height="131" src="https://images2.imgbox.com/57/21/nN67AiZM_o.png" width="827"></p> 
<pre><code class="language-sql">-- 查询 “销售部” 的所有员工信息
select * from emp where dept_id = (select id from dept where name = '销售部');

-- 查询在 “方东白” 入职之后的员工信息
select *from emp where entrydate &gt; (select entrydate from emp where name = '方东白');
</code></pre> 
<h3>列子查询</h3> 
<p><img alt="" height="326" src="https://images2.imgbox.com/75/6a/Ld6lBjHn_o.png" width="816"></p> 
<pre><code class="language-sql">-- 查询销售部和市场部的所有员工信息
select *from emp where dept_id in ( select id from dept where name = '销售部' or name = '市场部');


-- 查询比财务部所有人工资都高的员工信息
select * from emp where salary &gt; all ( select salary from emp where dept_id = (select id from dept where name = '财务部'));


-- 查询比研发部其中任意一人工资高的员工信息
select * from emp where salary &gt; some ( select salary from emp where dept_id = (select id from dept where name = '研发部'));
</code></pre> 
<h3>行子查询</h3> 
<p><img alt="" height="122" src="https://images2.imgbox.com/1e/c8/AsWH2ynv_o.png" width="810"></p> 
<pre><code class="language-sql">-- 查询与 "张无忌" 的薪资及直属领导相同的员工信息 ;
select *from emp where 
(salary ,managerid) = (select salary ,managerid from emp where name = '张无忌');
</code></pre> 
<h3>表子查询</h3> 
<p><img alt="" height="128" src="https://images2.imgbox.com/bc/b7/ej9Q7nsL_o.png" width="837"></p> 
<pre><code class="language-sql">-- 查询与 "鹿杖客" , "宋远桥" 的职位和薪资相同的员工信息
select *from emp where (job ,salary) in
(select job ,salary from emp where name = '鹿杖客' or name = '宋远桥');


-- 查询入职日期是 "2006-01-01" 之后的员工信息 , 及其部门信息
select e.* ,d.name from (select * from emp where entrydate &gt; '2006-01-01') e
left join dept d on e.dept_id = d.id;</code></pre> 
<h2>多表查询案例</h2> 
<p><img alt="" height="372" src="https://images2.imgbox.com/04/24/D2hjjnk9_o.png" width="834"></p> 
<pre><code class="language-sql">-- 1. 查询员工的姓名、年龄、职位、部门信息 （隐式内连接）
-- 表: emp , dept
-- 连接条件: emp.dept_id = dept.id
select e.name, e.age, e.job, d.name
from emp e,
     dept d
where e.dept_id = d.id;


-- 2. 查询年龄小于30岁的员工的姓名、年龄、职位、部门信息（显式内连接）
-- 表: emp , dept
-- 连接条件: emp.dept_id = dept.id
select e.name, e.age, e.job, d.name
from emp e
         inner join dept d on e.dept_id = d.id and e.age &lt; 30;


-- 3. 查询拥有员工的部门ID、部门名称
-- 表: emp , dept
-- 连接条件: emp.dept_id = dept.id
select distinct d.id, d.name
from emp e,
     dept d
where e.dept_id = d.id;


-- 4. 查询所有年龄大于40岁的员工, 及其归属的部门名称; 如果员工没有分配部门, 也需要展示出来
-- 表: emp , dept
-- 连接条件: emp.dept_id = dept.id
-- 外连接
select e.*, d.name
from emp e
         left join dept d on e.dept_id = d.id
where (e.age &gt; 40);


-- 5. 查询所有员工的工资等级
-- 表: emp , salgrade
-- 连接条件 : emp.salary &gt;= salgrade.losal and emp.salary &lt;= salgrade.hisal
select e.*, s.grade
from emp e,
     salgrade s
where e.salary between s.losal and s.hisal;


-- 6. 查询 "研发部" 所有员工的信息及 工资等级
-- 表: emp , salgrade , dept
-- 连接条件 : emp.salary between salgrade.losal and salgrade.hisal , emp.dept_id = dept.id
-- 查询条件 : dept.name = '研发部'
select e.*, s.grade
from emp e,
     dept d,
     salgrade s
where (e.dept_id = d.id)
  and (e.salary between s.losal and s.hisal)
  and d.name = '研发部';


-- 7. 查询 "研发部" 员工的平均工资
-- 表: emp , dept
-- 连接条件 :  emp.dept_id = dept.id
select avg(e.salary)
from emp e,
     dept d
where e.dept_id = d.id
  and d.name = '研发部';


-- 8. 查询工资比 "灭绝" 高的员工信息。
select *
from emp
where salary &gt; (select salary from emp where emp.name = '灭绝');


-- 9. 查询比平均薪资高的员工信息
select *
from emp
where salary &gt; (select avg(salary) from emp);


-- 10. 查询低于本部门平均工资的员工信息
select *
from emp e2
where e2.salary &lt; (select avg(e1.salary) from emp e1 where e1.dept_id = e2.dept_id);


-- 11. 查询所有的部门信息, 并统计部门的员工人数
select d.id, d.name, (select count(*) from emp e where e.dept_id = d.id) '部门人数'
from dept d;


-- 12. 查询所有学生的选课情况, 展示出学生名称, 学号, 课程名称
-- 表: student , course , student_course
-- 连接条件: student.id = student_course.studentid , course.id = student_course.courseid
select s.name, s.no, c.name
from student s,
     student_course sc,
     course c
where s.id = sc.studentid
  and sc.courseid = c.id;

</code></pre> 
<h2>总结</h2> 
<p><img alt="" height="395" src="https://images2.imgbox.com/6a/cf/U8mVQfmZ_o.png" width="820"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/18c00c35f56b295eefdca7f909ebbad5/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">关于 FullNat 模式的 Toa 实现原理【转】</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f99c846fc637a44fe4a89b84ff6e4605/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">关于IDEA中log爆红问题的解决（插件的安装【自动&amp;手动】）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>