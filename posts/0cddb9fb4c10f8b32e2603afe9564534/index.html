<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android学习之仿QQ聊天界面的实现 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Android学习之仿QQ聊天界面的实现" />
<meta property="og:description" content="前言：
好几天没动手了，感觉有点手懒了，干我们这行真的一点不能懈怠啊！
回来写了个仿扣扣聊天界面的实现，动态添加聊天内容等！
分析：
主体：RecylerView&#43;LinearLayout
效果：
简单的模仿一下扣扣。
下面介绍一下怎么实现的
demo结构：
看起来没那么复杂哈。
主页面布局
&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt; &lt;LinearLayout xmlns:android=&#34;http://schemas.android.com/apk/res/android&#34; xmlns:tools=&#34;http://schemas.android.com/tools&#34; android:layout_width=&#34;match_parent&#34; android:layout_height=&#34;match_parent&#34; android:background=&#34;#EEEEEE&#34; android:orientation=&#34;vertical&#34; tools:context=&#34;.activity.MainActivity&#34;&gt; &lt;android.support.v7.widget.RecyclerView android:id=&#34;@&#43;id/recylerView&#34; android:layout_width=&#34;match_parent&#34; android:layout_height=&#34;0dp&#34; android:layout_weight=&#34;1&#34; /&gt; &lt;LinearLayout android:layout_width=&#34;match_parent&#34; android:layout_height=&#34;48dp&#34; android:background=&#34;#EEEEEE&#34; android:orientation=&#34;horizontal&#34; android:padding=&#34;4dp&#34;&gt; &lt;EditText android:id=&#34;@&#43;id/et&#34; android:layout_width=&#34;0dp&#34; android:layout_height=&#34;match_parent&#34; android:layout_margin=&#34;4dp&#34; android:layout_weight=&#34;5&#34; android:paddingLeft=&#34;4dp&#34; android:textSize=&#34;14sp&#34; android:background=&#34;@drawable/bg_et&#34; /&gt; &lt;TextView android:id=&#34;@&#43;id/tvSend&#34; android:layout_width=&#34;0dp&#34; android:layout_height=&#34;wrap_content&#34; android:layout_margin=&#34;4dp&#34; android:layout_weight=&#34;1&#34; android:background=&#34;@drawable/bg_send&#34; android:gravity=&#34;center&#34; android:padding=&#34;6dp&#34; android:text=&#34;发送&#34; android:textColor=&#34;#FFFFFF&#34; android:textSize=&#34;10sp&#34; /&gt; &lt;/LinearLayout&gt; &lt;/LinearLayout&gt; 就是一个RecylerView&#43;LinearLayout 适配器主要实现
@Override public ChatAdapter.BaseAdapter onCreateViewHolder(ViewGroup parent, int viewType) { switch (viewType) { case ItemModel." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/0cddb9fb4c10f8b32e2603afe9564534/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2016-05-03T21:41:15+08:00" />
<meta property="article:modified_time" content="2016-05-03T21:41:15+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android学习之仿QQ聊天界面的实现</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>前言：</p> 
<p>好几天没动手了，感觉有点手懒了，干我们这行真的一点不能懈怠啊！</p> 
<p>回来写了个仿扣扣聊天界面的实现，动态添加聊天内容等！</p> 
<p>分析：</p> 
<p>主体：RecylerView+LinearLayout</p> 
<p>效果：</p> 
<p><img src="https://images2.imgbox.com/90/be/E3RVjLAw_o.png" alt="这里写图片描述" title=""></p> 
<p>简单的模仿一下扣扣。</p> 
<p>下面介绍一下怎么实现的</p> 
<p>demo结构：</p> 
<p><img src="https://images2.imgbox.com/28/99/f89ifICz_o.png" alt="这里写图片描述" title=""></p> 
<p>看起来没那么复杂哈。</p> 
<p>主页面布局</p> 
<pre class="prettyprint"><code class=" hljs xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">LinearLayout</span> <span class="hljs-attribute">xmlns:android</span>=<span class="hljs-value">"http://schemas.android.com/apk/res/android"</span>
    <span class="hljs-attribute">xmlns:tools</span>=<span class="hljs-value">"http://schemas.android.com/tools"</span>
    <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
    <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"match_parent"</span>
    <span class="hljs-attribute">android:background</span>=<span class="hljs-value">"#EEEEEE"</span>
    <span class="hljs-attribute">android:orientation</span>=<span class="hljs-value">"vertical"</span>
    <span class="hljs-attribute">tools:context</span>=<span class="hljs-value">".activity.MainActivity"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">android.support.v7.widget.RecyclerView
</span>        <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/recylerView"</span>
        <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
        <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"0dp"</span>
        <span class="hljs-attribute">android:layout_weight</span>=<span class="hljs-value">"1"</span> /&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">LinearLayout
</span>        <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
        <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"48dp"</span>
        <span class="hljs-attribute">android:background</span>=<span class="hljs-value">"#EEEEEE"</span>
        <span class="hljs-attribute">android:orientation</span>=<span class="hljs-value">"horizontal"</span>
        <span class="hljs-attribute">android:padding</span>=<span class="hljs-value">"4dp"</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">EditText
</span>            <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/et"</span>
            <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"0dp"</span>
            <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"match_parent"</span>
            <span class="hljs-attribute">android:layout_margin</span>=<span class="hljs-value">"4dp"</span>
            <span class="hljs-attribute">android:layout_weight</span>=<span class="hljs-value">"5"</span>
            <span class="hljs-attribute">android:paddingLeft</span>=<span class="hljs-value">"4dp"</span>
            <span class="hljs-attribute">android:textSize</span>=<span class="hljs-value">"14sp"</span>
            <span class="hljs-attribute">android:background</span>=<span class="hljs-value">"@drawable/bg_et"</span> /&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">TextView
</span>            <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/tvSend"</span>
            <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"0dp"</span>
            <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span>
            <span class="hljs-attribute">android:layout_margin</span>=<span class="hljs-value">"4dp"</span>
            <span class="hljs-attribute">android:layout_weight</span>=<span class="hljs-value">"1"</span>
            <span class="hljs-attribute">android:background</span>=<span class="hljs-value">"@drawable/bg_send"</span>
            <span class="hljs-attribute">android:gravity</span>=<span class="hljs-value">"center"</span>
            <span class="hljs-attribute">android:padding</span>=<span class="hljs-value">"6dp"</span>
            <span class="hljs-attribute">android:text</span>=<span class="hljs-value">"发送"</span>
            <span class="hljs-attribute">android:textColor</span>=<span class="hljs-value">"#FFFFFF"</span>
            <span class="hljs-attribute">android:textSize</span>=<span class="hljs-value">"10sp"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">LinearLayout</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">LinearLayout</span>&gt;</span>
</code></pre> 
<p>就是一个RecylerView+LinearLayout <br> 适配器主要实现</p> 
<pre class="prettyprint"><code class=" hljs cs"> @Override
    <span class="hljs-keyword">public</span> ChatAdapter.BaseAdapter <span class="hljs-title">onCreateViewHolder</span>(ViewGroup parent, <span class="hljs-keyword">int</span> viewType) {
        <span class="hljs-keyword">switch</span> (viewType) {
            <span class="hljs-keyword">case</span> ItemModel.CHAT_A:
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ChatAViewHolder(LayoutInflater.<span class="hljs-keyword">from</span>(parent.getContext()).inflate(R.layout.chat_a, parent, <span class="hljs-keyword">false</span>));
            <span class="hljs-keyword">case</span> ItemModel.CHAT_B:
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ChatBViewHolder(LayoutInflater.<span class="hljs-keyword">from</span>(parent.getContext()).inflate(R.layout.chat_b, parent, <span class="hljs-keyword">false</span>));
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
    }

    @Override
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onBindViewHolder</span>(ChatAdapter.BaseAdapter holder, <span class="hljs-keyword">int</span> position) {
        holder.setData(dataList.<span class="hljs-keyword">get</span>(position).<span class="hljs-keyword">object</span>);
    }

    @Override
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getItemViewType</span>(<span class="hljs-keyword">int</span> position) {
        <span class="hljs-keyword">return</span> dataList.<span class="hljs-keyword">get</span>(position).type;
    }

    @Override
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getItemCount</span>() {
        <span class="hljs-keyword">return</span> dataList != <span class="hljs-keyword">null</span> ? dataList.size() : <span class="hljs-number">0</span>;
    }</code></pre> 
<p>根据传递的不同viewType，创建两个viewHolder，对应两个不同布局。</p> 
<p>看看数据是怎么传递的</p> 
<pre class="prettyprint"><code class=" hljs avrasm">package <span class="hljs-keyword">com</span><span class="hljs-preprocessor">.example</span><span class="hljs-preprocessor">.wangchang</span><span class="hljs-preprocessor">.testchat</span><span class="hljs-comment">;</span>


import <span class="hljs-keyword">com</span><span class="hljs-preprocessor">.example</span><span class="hljs-preprocessor">.wangchang</span><span class="hljs-preprocessor">.testchat</span><span class="hljs-preprocessor">.model</span><span class="hljs-preprocessor">.ChatModel</span><span class="hljs-comment">;</span>
import <span class="hljs-keyword">com</span><span class="hljs-preprocessor">.example</span><span class="hljs-preprocessor">.wangchang</span><span class="hljs-preprocessor">.testchat</span><span class="hljs-preprocessor">.model</span><span class="hljs-preprocessor">.ItemModel</span><span class="hljs-comment">;</span>

import java<span class="hljs-preprocessor">.util</span><span class="hljs-preprocessor">.ArrayList</span><span class="hljs-comment">;</span>

<span class="hljs-comment">/**
 * Created by：Administrator on 2015/12/21 16:43
 */</span>
public class TestData {

    public static ArrayList&lt;ItemModel&gt; getTestAdData() {
        ArrayList&lt;ItemModel&gt; models = new ArrayList&lt;&gt;()<span class="hljs-comment">;</span>
        ChatModel model = new ChatModel()<span class="hljs-comment">;</span>
        model<span class="hljs-preprocessor">.setContent</span>(<span class="hljs-string">"你好？我们交个朋友吧！"</span>)<span class="hljs-comment">;</span>
        model<span class="hljs-preprocessor">.setIcon</span>(<span class="hljs-string">"https://img-my.csdn.net/uploads/201508/05/1438760758_3497.jpg"</span>)<span class="hljs-comment">;</span>
        models<span class="hljs-preprocessor">.add</span>(new ItemModel(ItemModel<span class="hljs-preprocessor">.CHAT</span>_A, model))<span class="hljs-comment">;</span>
        ChatModel model2 = new ChatModel()<span class="hljs-comment">;</span>
        model2<span class="hljs-preprocessor">.setContent</span>(<span class="hljs-string">"我是隔壁小王，你是谁？"</span>)<span class="hljs-comment">;</span>
        model2<span class="hljs-preprocessor">.setIcon</span>(<span class="hljs-string">"https://img-my.csdn.net/uploads/201508/05/1438760758_6667.jpg"</span>)<span class="hljs-comment">;</span>
        models<span class="hljs-preprocessor">.add</span>(new ItemModel(ItemModel<span class="hljs-preprocessor">.CHAT</span>_B, model2))<span class="hljs-comment">;</span>
        ChatModel model3 = new ChatModel()<span class="hljs-comment">;</span>
        model3<span class="hljs-preprocessor">.setContent</span>(<span class="hljs-string">"what？你真不知道我是谁吗？哭~"</span>)<span class="hljs-comment">;</span>
        model3<span class="hljs-preprocessor">.setIcon</span>(<span class="hljs-string">"https://img-my.csdn.net/uploads/201508/05/1438760758_3497.jpg"</span>)<span class="hljs-comment">;</span>
        models<span class="hljs-preprocessor">.add</span>(new ItemModel(ItemModel<span class="hljs-preprocessor">.CHAT</span>_A, model3))<span class="hljs-comment">;</span>
        ChatModel model4 = new ChatModel()<span class="hljs-comment">;</span>
        model4<span class="hljs-preprocessor">.setContent</span>(<span class="hljs-string">"大哥，别哭，我真不知道"</span>)<span class="hljs-comment">;</span>
        model4<span class="hljs-preprocessor">.setIcon</span>(<span class="hljs-string">"https://img-my.csdn.net/uploads/201508/05/1438760758_6667.jpg"</span>)<span class="hljs-comment">;</span>
        models<span class="hljs-preprocessor">.add</span>(new ItemModel(ItemModel<span class="hljs-preprocessor">.CHAT</span>_B, model4))<span class="hljs-comment">;</span>
        ChatModel model5 = new ChatModel()<span class="hljs-comment">;</span>
        model5<span class="hljs-preprocessor">.setContent</span>(<span class="hljs-string">"卧槽，你不知道你来撩妹？"</span>)<span class="hljs-comment">;</span>
        model5<span class="hljs-preprocessor">.setIcon</span>(<span class="hljs-string">"https://img-my.csdn.net/uploads/201508/05/1438760758_3497.jpg"</span>)<span class="hljs-comment">;</span>
        models<span class="hljs-preprocessor">.add</span>(new ItemModel(ItemModel<span class="hljs-preprocessor">.CHAT</span>_A, model5))<span class="hljs-comment">;</span>
        ChatModel model6 = new ChatModel()<span class="hljs-comment">;</span>
        model6<span class="hljs-preprocessor">.setContent</span>(<span class="hljs-string">"你是妹子，卧槽，我怎么没看出来？"</span>)<span class="hljs-comment">;</span>
        model6<span class="hljs-preprocessor">.setIcon</span>(<span class="hljs-string">"https://img-my.csdn.net/uploads/201508/05/1438760758_6667.jpg"</span>)<span class="hljs-comment">;</span>
        models<span class="hljs-preprocessor">.add</span>(new ItemModel(ItemModel<span class="hljs-preprocessor">.CHAT</span>_B, model6))<span class="hljs-comment">;</span>
        return models<span class="hljs-comment">;</span>
    }

}
</code></pre> 
<p>这里很好理解，创建两个model，itemModel对应不同的数据类型，ChatModel是聊天内容实体类。</p> 
<pre class="prettyprint"><code class=" hljs java">
<span class="hljs-javadoc">/**
 * Created by WangChang on 2016/4/28.
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ItemModel</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span> {<!-- --></span>

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> CHAT_A = <span class="hljs-number">1001</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> CHAT_B = <span class="hljs-number">1002</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> type;
    <span class="hljs-keyword">public</span> Object object;

    <span class="hljs-keyword">public</span> <span class="hljs-title">ItemModel</span>(<span class="hljs-keyword">int</span> type, Object object) {
        <span class="hljs-keyword">this</span>.type = type;
        <span class="hljs-keyword">this</span>.object = object;
    }
}
</code></pre> 
<p>圆形头像的实现，借助了CircleImageView ，其实Glide就可以实现各种圆角的图片的实现。</p> 
<pre class="prettyprint"><code class=" hljs java"><span class="hljs-keyword">package</span> com.example.wangchang.testchat.widget;

<span class="hljs-keyword">import</span> android.content.Context;
<span class="hljs-keyword">import</span> android.content.res.TypedArray;
<span class="hljs-keyword">import</span> android.graphics.Bitmap;
<span class="hljs-keyword">import</span> android.graphics.BitmapShader;
<span class="hljs-keyword">import</span> android.graphics.Canvas;
<span class="hljs-keyword">import</span> android.graphics.Color;
<span class="hljs-keyword">import</span> android.graphics.ColorFilter;
<span class="hljs-keyword">import</span> android.graphics.Matrix;
<span class="hljs-keyword">import</span> android.graphics.Paint;
<span class="hljs-keyword">import</span> android.graphics.RectF;
<span class="hljs-keyword">import</span> android.graphics.Shader;
<span class="hljs-keyword">import</span> android.graphics.drawable.BitmapDrawable;
<span class="hljs-keyword">import</span> android.graphics.drawable.ColorDrawable;
<span class="hljs-keyword">import</span> android.graphics.drawable.Drawable;
<span class="hljs-keyword">import</span> android.net.Uri;
<span class="hljs-keyword">import</span> android.support.annotation.ColorRes;
<span class="hljs-keyword">import</span> android.support.annotation.DrawableRes;
<span class="hljs-keyword">import</span> android.util.AttributeSet;
<span class="hljs-keyword">import</span> android.widget.ImageView;

<span class="hljs-keyword">import</span> com.example.wangchang.testchat.R;


<span class="hljs-javadoc">/**
 * 圆形图片
 * Created by liyingfeng on 2015/9/14.
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CircleImageView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ImageView</span> {<!-- --></span>

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ScaleType SCALE_TYPE = ScaleType.CENTER_CROP;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Bitmap.Config BITMAP_CONFIG = Bitmap.Config.ARGB_8888;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> COLORDRAWABLE_DIMENSION = <span class="hljs-number">2</span>;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> DEFAULT_BORDER_WIDTH = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> DEFAULT_BORDER_COLOR = Color.BLACK;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">boolean</span> DEFAULT_BORDER_OVERLAY = <span class="hljs-keyword">false</span>;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> RectF mDrawableRect = <span class="hljs-keyword">new</span> RectF();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> RectF mBorderRect = <span class="hljs-keyword">new</span> RectF();

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Matrix mShaderMatrix = <span class="hljs-keyword">new</span> Matrix();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Paint mBitmapPaint = <span class="hljs-keyword">new</span> Paint();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Paint mBorderPaint = <span class="hljs-keyword">new</span> Paint();

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> mBorderColor = DEFAULT_BORDER_COLOR;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> mBorderWidth = DEFAULT_BORDER_WIDTH;

    <span class="hljs-keyword">private</span> Bitmap mBitmap;
    <span class="hljs-keyword">private</span> BitmapShader mBitmapShader;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> mBitmapWidth;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> mBitmapHeight;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">float</span> mDrawableRadius;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">float</span> mBorderRadius;

    <span class="hljs-keyword">private</span> ColorFilter mColorFilter;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> mReady;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> mSetupPending;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> mBorderOverlay;

    <span class="hljs-keyword">public</span> <span class="hljs-title">CircleImageView</span>(Context context) {
        <span class="hljs-keyword">super</span>(context);

        init();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title">CircleImageView</span>(Context context, AttributeSet attrs) {
        <span class="hljs-keyword">this</span>(context, attrs, <span class="hljs-number">0</span>);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title">CircleImageView</span>(Context context, AttributeSet attrs, <span class="hljs-keyword">int</span> defStyle) {
        <span class="hljs-keyword">super</span>(context, attrs, defStyle);

        TypedArray a = context.obtainStyledAttributes(attrs, R.styleable.CircleImageView, defStyle, <span class="hljs-number">0</span>);
        mBorderWidth = a.getDimensionPixelSize(R.styleable.CircleImageView_border_width, DEFAULT_BORDER_WIDTH);
        mBorderColor = a.getColor(R.styleable.CircleImageView_border_color, DEFAULT_BORDER_COLOR);
        mBorderOverlay = a.getBoolean(R.styleable.CircleImageView_border_overlay, DEFAULT_BORDER_OVERLAY);

        a.recycle();

        init();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span>() {
        <span class="hljs-keyword">super</span>.setScaleType(SCALE_TYPE);
        mReady = <span class="hljs-keyword">true</span>;

        <span class="hljs-keyword">if</span> (mSetupPending) {
            setup();
            mSetupPending = <span class="hljs-keyword">false</span>;
        }
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> ScaleType <span class="hljs-title">getScaleType</span>() {
        <span class="hljs-keyword">return</span> SCALE_TYPE;
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setScaleType</span>(ScaleType scaleType) {
        <span class="hljs-keyword">if</span> (scaleType != SCALE_TYPE) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(String.format(<span class="hljs-string">"ScaleType %s not supported."</span>, scaleType));
        }
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setAdjustViewBounds</span>(<span class="hljs-keyword">boolean</span> adjustViewBounds) {
        <span class="hljs-keyword">if</span> (adjustViewBounds) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(<span class="hljs-string">"adjustViewBounds not supported."</span>);
        }
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onDraw</span>(Canvas canvas) {
        <span class="hljs-keyword">if</span> (getDrawable() == <span class="hljs-keyword">null</span>) {
            <span class="hljs-keyword">return</span>;
        }

        canvas.drawCircle(getWidth() / <span class="hljs-number">2</span>, getHeight() / <span class="hljs-number">2</span>, mDrawableRadius, mBitmapPaint);
        <span class="hljs-keyword">if</span> (mBorderWidth != <span class="hljs-number">0</span>) {
            canvas.drawCircle(getWidth() / <span class="hljs-number">2</span>, getHeight() / <span class="hljs-number">2</span>, mBorderRadius, mBorderPaint);
        }
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onSizeChanged</span>(<span class="hljs-keyword">int</span> w, <span class="hljs-keyword">int</span> h, <span class="hljs-keyword">int</span> oldw, <span class="hljs-keyword">int</span> oldh) {
        <span class="hljs-keyword">super</span>.onSizeChanged(w, h, oldw, oldh);
        setup();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getBorderColor</span>() {
        <span class="hljs-keyword">return</span> mBorderColor;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setBorderColor</span>(<span class="hljs-keyword">int</span> borderColor) {
        <span class="hljs-keyword">if</span> (borderColor == mBorderColor) {
            <span class="hljs-keyword">return</span>;
        }

        mBorderColor = borderColor;
        mBorderPaint.setColor(mBorderColor);
        invalidate();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setBorderColorResource</span>(@ColorRes <span class="hljs-keyword">int</span> borderColorRes) {
        setBorderColor(getContext().getResources().getColor(borderColorRes));
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getBorderWidth</span>() {
        <span class="hljs-keyword">return</span> mBorderWidth;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setBorderWidth</span>(<span class="hljs-keyword">int</span> borderWidth) {
        <span class="hljs-keyword">if</span> (borderWidth == mBorderWidth) {
            <span class="hljs-keyword">return</span>;
        }

        mBorderWidth = borderWidth;
        setup();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isBorderOverlay</span>() {
        <span class="hljs-keyword">return</span> mBorderOverlay;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setBorderOverlay</span>(<span class="hljs-keyword">boolean</span> borderOverlay) {
        <span class="hljs-keyword">if</span> (borderOverlay == mBorderOverlay) {
            <span class="hljs-keyword">return</span>;
        }

        mBorderOverlay = borderOverlay;
        setup();
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setImageBitmap</span>(Bitmap bm) {
        <span class="hljs-keyword">super</span>.setImageBitmap(bm);
        mBitmap = bm;
        setup();
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setImageDrawable</span>(Drawable drawable) {
        <span class="hljs-keyword">super</span>.setImageDrawable(drawable);
        mBitmap = getBitmapFromDrawable(drawable);
        setup();
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setImageResource</span>(@DrawableRes <span class="hljs-keyword">int</span> resId) {
        <span class="hljs-keyword">super</span>.setImageResource(resId);
        mBitmap = getBitmapFromDrawable(getDrawable());
        setup();
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setImageURI</span>(Uri uri) {
        <span class="hljs-keyword">super</span>.setImageURI(uri);
        mBitmap = getBitmapFromDrawable(getDrawable());
        setup();
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setColorFilter</span>(ColorFilter cf) {
        <span class="hljs-keyword">if</span> (cf == mColorFilter) {
            <span class="hljs-keyword">return</span>;
        }

        mColorFilter = cf;
        mBitmapPaint.setColorFilter(mColorFilter);
        invalidate();
    }

    <span class="hljs-keyword">private</span> Bitmap <span class="hljs-title">getBitmapFromDrawable</span>(Drawable drawable) {
        <span class="hljs-keyword">if</span> (drawable == <span class="hljs-keyword">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
        }

        <span class="hljs-keyword">if</span> (drawable <span class="hljs-keyword">instanceof</span> BitmapDrawable) {
            <span class="hljs-keyword">return</span> ((BitmapDrawable) drawable).getBitmap();
        }

        <span class="hljs-keyword">try</span> {
            Bitmap bitmap;

            <span class="hljs-keyword">if</span> (drawable <span class="hljs-keyword">instanceof</span> ColorDrawable) {
                bitmap = Bitmap.createBitmap(COLORDRAWABLE_DIMENSION, COLORDRAWABLE_DIMENSION, BITMAP_CONFIG);
            } <span class="hljs-keyword">else</span> {
                bitmap = Bitmap.createBitmap(drawable.getIntrinsicWidth(), drawable.getIntrinsicHeight(), BITMAP_CONFIG);
            }

            Canvas canvas = <span class="hljs-keyword">new</span> Canvas(bitmap);
            drawable.setBounds(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, canvas.getWidth(), canvas.getHeight());
            drawable.draw(canvas);
            <span class="hljs-keyword">return</span> bitmap;
        } <span class="hljs-keyword">catch</span> (OutOfMemoryError e) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setup</span>() {
        <span class="hljs-keyword">if</span> (!mReady) {
            mSetupPending = <span class="hljs-keyword">true</span>;
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-keyword">if</span> (mBitmap == <span class="hljs-keyword">null</span>) {
            <span class="hljs-keyword">return</span>;
        }

        mBitmapShader = <span class="hljs-keyword">new</span> BitmapShader(mBitmap, Shader.TileMode.CLAMP, Shader.TileMode.CLAMP);

        mBitmapPaint.setAntiAlias(<span class="hljs-keyword">true</span>);
        mBitmapPaint.setShader(mBitmapShader);

        mBorderPaint.setStyle(Paint.Style.STROKE);
        mBorderPaint.setAntiAlias(<span class="hljs-keyword">true</span>);
        mBorderPaint.setColor(mBorderColor);
        mBorderPaint.setStrokeWidth(mBorderWidth);

        mBitmapHeight = mBitmap.getHeight();
        mBitmapWidth = mBitmap.getWidth();

        mBorderRect.set(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, getWidth(), getHeight());
        mBorderRadius = Math.min((mBorderRect.height() - mBorderWidth) / <span class="hljs-number">2</span>, (mBorderRect.width() - mBorderWidth) / <span class="hljs-number">2</span>);

        mDrawableRect.set(mBorderRect);
        <span class="hljs-keyword">if</span> (!mBorderOverlay) {
            mDrawableRect.inset(mBorderWidth, mBorderWidth);
        }
        mDrawableRadius = Math.min(mDrawableRect.height() / <span class="hljs-number">2</span>, mDrawableRect.width() / <span class="hljs-number">2</span>);

        updateShaderMatrix();
        invalidate();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">updateShaderMatrix</span>() {
        <span class="hljs-keyword">float</span> scale;
        <span class="hljs-keyword">float</span> dx = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">float</span> dy = <span class="hljs-number">0</span>;

        mShaderMatrix.set(<span class="hljs-keyword">null</span>);

        <span class="hljs-keyword">if</span> (mBitmapWidth * mDrawableRect.height() &gt; mDrawableRect.width() * mBitmapHeight) {
            scale = mDrawableRect.height() / (<span class="hljs-keyword">float</span>) mBitmapHeight;
            dx = (mDrawableRect.width() - mBitmapWidth * scale) * <span class="hljs-number">0.5</span>f;
        } <span class="hljs-keyword">else</span> {
            scale = mDrawableRect.width() / (<span class="hljs-keyword">float</span>) mBitmapWidth;
            dy = (mDrawableRect.height() - mBitmapHeight * scale) * <span class="hljs-number">0.5</span>f;
        }

        mShaderMatrix.setScale(scale, scale);
        mShaderMatrix.postTranslate((<span class="hljs-keyword">int</span>) (dx + <span class="hljs-number">0.5</span>f) + mDrawableRect.left, (<span class="hljs-keyword">int</span>) (dy + <span class="hljs-number">0.5</span>f) + mDrawableRect.top);

        mBitmapShader.setLocalMatrix(mShaderMatrix);
    }
}</code></pre> 
<p>布局我就不贴了</p> 
<p>最终效果：</p> 
<p><img src="https://images2.imgbox.com/be/8c/qWXKkIr7_o.png" alt="这里写图片描述" title=""></p> 
<p>感兴趣的朋友可以下载源码：</p> 
<p><a href="http://pan.baidu.com/s/1i56OMxf" rel="nofollow">http://pan.baidu.com/s/1i56OMxf</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/bc011a437131bad0d84642c27c281898/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">两种方法证明积分中值定理_20160405</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0173e6b6e0b4276a94e0f6650a8c7fce/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">malloc函数，free函数，calloc函数和realloc函数详解</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>