<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>qt模块feature QT_FEATURE_* qt_lib_*.pri QT_CONFG qtConfig - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="qt模块feature QT_FEATURE_* qt_lib_*.pri QT_CONFG qtConfig" />
<meta property="og:description" content="qt为方便对功能和代码进行删减和系统兼容，将代码拆分成很多模块且对每个模块梳理出feature，为了简化程序的使用和其他目的，一个模块编译成一个单独的dll，qt还对每个模块的头文件分成public部分和private部分。在编译模块前，通过修改模块对应源码文件夹下的confiure.json控制feature开关来删减系统不支持或者不必要的feature，对应feature的condition是可配置的，感兴趣的可以查看qt的编译脚本文件（shell脚本/dos脚本）。
widgets/configure.json 在配置好模块的configure.json后，运行configure启动编译脚本（shell脚本/dos脚本），过程中会自动为模块生成对应头文件，比如widgets 模块，会生成qtwidgets-config.h和qtwidgets-config-p.h，每一个属性在.h中都有一个宏，作为代码的宏开关，值一般为1或-1，用于控制模块源码的逻辑，其内容如下：
qtwidgets-config.h 在qt 的源文件qglobal.h中有这样两个方便使用feature对应宏开关的宏定义QT_CONFIG和QT_REQUIRE_CONFIG：
//QtInstallDir\Qt5.12.0\5.12.0\msvc2015_64\include\QtCore\qglobal.h #define QT_CONFIG(feature) (1/QT_FEATURE_##feature == 1) #define QT_REQUIRE_CONFIG(feature) Q_STATIC_ASSERT_X(QT_FEATURE_##feature == 1, &#34;Required feature &#34; #feature &#34; for file &#34; __FILE__ &#34; not available.&#34;) qmainwindow.h qt模块编译好后会产生对应qt_lib_*.pri和qt_lib_*_private.pri脚本（qmake language脚本）文件，方便qmake生成makefile时查询模块是否支持对应的feature。下面是qt_lib_core.pri文件内容:
#D:\Qt\Qt5.12.0\5.12.0\msvc2015_64\mkspecs\modules\qt_lib_core.pri QT.core.VERSION = 5.12.0 QT.core.name = QtCore QT.core.module = Qt5Core QT.core.libs = $$QT_MODULE_LIB_BASE QT.core.includes = $$QT_MODULE_INCLUDE_BASE $$QT_MODULE_INCLUDE_BASE/QtCore QT.core.frameworks = QT.core.bins = $$QT_MODULE_BIN_BASE QT.core.depends = QT.core.uses = libatomic QT.core.module_config = v2 QT.core.CONFIG = moc resources QT.core.DEFINES = QT_CORE_LIB QT." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/cee8ccb968298d6dfbc62f852825fabc/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-12-06T16:52:49+08:00" />
<meta property="article:modified_time" content="2022-12-06T16:52:49+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">qt模块feature QT_FEATURE_* qt_lib_*.pri QT_CONFG qtConfig</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>qt为方便对功能和代码进行删减和系统兼容，将代码拆分成很多模块且对每个模块梳理出feature，为了简化程序的使用和其他目的，一个模块编译成一个单独的dll，qt还对每个模块的头文件分成public部分和private部分。在编译模块前，通过修改模块对应源码文件夹下的confiure.json控制feature开关来删减系统不支持或者不必要的feature，对应feature的condition是可配置的，感兴趣的可以查看qt的编译脚本文件（shell脚本/dos脚本）。</p> 
<figure class="image"> 
 <img alt="" height="479" src="https://images2.imgbox.com/a4/d2/9O6Se9SR_o.png" width="1104"> 
 <figcaption>
   widgets/configure.json 
 </figcaption> 
</figure> 
<p>在配置好模块的configure.json后，运行configure启动编译脚本（shell脚本/dos脚本），过程中会自动为模块生成对应头文件，比如widgets 模块，会生成qtwidgets-config.h和qtwidgets-config-p.h，每一个属性在.h中都有一个宏，作为代码的宏开关，值一般为1或-1，用于控制模块源码的逻辑，其内容如下：</p> 
<figure class="image"> 
 <img alt="" src="https://images2.imgbox.com/37/61/hzg9IZbF_o.png"> 
 <figcaption>
   qtwidgets-config.h 
 </figcaption> 
</figure> 
<p><br> 在qt 的源文件qglobal.h中有这样两个方便使用feature对应宏开关的宏定义<strong>QT_CONFIG</strong>和<strong>QT_REQUIRE_CONFIG</strong>：</p> 
<pre><code>//QtInstallDir\Qt5.12.0\5.12.0\msvc2015_64\include\QtCore\qglobal.h
#define QT_CONFIG(feature) (1/QT_FEATURE_##feature == 1)
#define QT_REQUIRE_CONFIG(feature) Q_STATIC_ASSERT_X(QT_FEATURE_##feature == 1, "Required feature " #feature " for file " __FILE__ " not available.")
</code></pre> 
<figure class="image"> 
 <img alt="" src="https://images2.imgbox.com/e5/1e/JACtRwEU_o.png"> 
 <figcaption>
   qmainwindow.h 
 </figcaption> 
</figure> 
<p>qt模块编译好后会产生对应qt_lib_*.pri和qt_lib_*_private.pri脚本（qmake language脚本）文件，方便qmake生成makefile时查询模块是否支持对应的feature。下面是qt_lib_core.pri文件内容:</p> 
<pre><code>#D:\Qt\Qt5.12.0\5.12.0\msvc2015_64\mkspecs\modules\qt_lib_core.pri
QT.core.VERSION = 5.12.0
QT.core.name = QtCore
QT.core.module = Qt5Core
QT.core.libs = $$QT_MODULE_LIB_BASE
QT.core.includes = $$QT_MODULE_INCLUDE_BASE $$QT_MODULE_INCLUDE_BASE/QtCore
QT.core.frameworks =
QT.core.bins = $$QT_MODULE_BIN_BASE
QT.core.depends =
QT.core.uses = libatomic
QT.core.module_config = v2
QT.core.CONFIG = moc resources
QT.core.DEFINES = QT_CORE_LIB
QT.core.enabled_features = properties animation textcodec big_codecs codecs commandlineparser cxx11_future textdate datestring filesystemiterator filesystemwatcher gestures itemmodel proxymodel identityproxymodel library mimetype processenvironment process statemachine qeventtransition regularexpression settings sharedmemory sortfilterproxymodel std-atomic64 stringlistmodel systemsemaphore temporaryfile timezone topleveldomain translation xmlstream xmlstreamreader xmlstreamwriter
QT.core.disabled_features =
QT_CONFIG += properties animation textcodec big_codecs codecs textdate datestring doubleconversion filesystemiterator filesystemwatcher gestures itemmodel proxymodel identityproxymodel library mimetype process statemachine regularexpression settings sharedmemory sortfilterproxymodel stringlistmodel systemsemaphore temporaryfile translation xmlstream xmlstreamreader xmlstreamwriter
QT_MODULES += core</code></pre> 
<p>里面的QT.core.enabled_features项描述了core模块所支持的特性，所有的features是在编译模块源码之前，事先配置<strong>对应模块（module）源码文件夹</strong>下的configure.json文件内容的执行结果。qt_lib_*.pri只是提供一个方便脚本（qmake language脚本）快速查询的结果的功能。对比可以发现，qt_lib_*.pri中的enable_features项与qt*-config.h中的项基本一一对应。<br> 脚本查询的入口参考：<a href="https://blog.csdn.net/qiushangren/article/details/127894228" title="qtConfig(inputdialog)">qtConfig(inputdialog)</a> </p> 
<p>qtConfig()查询的是模块中的enabled_features值，这个脚本中的QT_CONFIG暂时没有发现有什么用。</p> 
<p><a href="https://blog.csdn.net/danshiming/article/details/123565335" title="QT_CONFIG宏用法及支持的参数_荆楚闲人的博客-CSDN博客_qtconfig">QT_CONFIG宏用法及支持的参数_荆楚闲人的博客-CSDN博客_qtconfig</a></p> 
<p> <a href="https://blog.csdn.net/qiushangren/article/details/127043446" title="qt 私有头文件 private_丘上人的博客-CSDN博客">qt 私有头文件 private_丘上人的博客-CSDN博客</a> </p> 
<p><a href="https://blog.csdn.net/qiushangren/article/details/127123766" title="qmake language qt 工程文件 配置文件 .pro .prl .prf .pri 词法 语法 for循环 判断语句 函数定义_丘上人的博客-CSDN博客">qmake language qt 工程文件 配置文件 .pro .prl .prf .pri 词法 语法 for循环 判断语句 函数定义_丘上人的博客-CSDN博客</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c140cbda58fc29c3fc9032d2b507e3dd/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">eCognition使用ESP插件得到最优分割尺度</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/261237d3343611239ff94132875a7f01/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">JS 判断一个字符串是否为日期格式（兼容IOS）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>