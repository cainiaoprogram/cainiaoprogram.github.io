<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>BGP基本配置 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="BGP基本配置" />
<meta property="og:description" content="【1】BGP邻居关系建立，与路由条目宣告是分开的配置的 （1）直连的EBGP邻居关系建立 [r1]bgp 1 //启动BGP协议，启动时需要键入AS号；没有多进程概念 [r1-bgp]router-id 1.1.1.1 //建议配置RID；若不配置将自动生成—规则同OSPF相同 [r1-bgp]peer 12.1.1.2 as-number 2 //对端IP地址，及对端所在的AS编号 （2）IBGP邻居关系建立 在一个AS内部，拓扑正常较为负载；建议使用环回接口地址作为源、目标ip地址；存在备份链路，同时可以多条物理链路传递；
[r2]bgp 2 [r2-bgp]peer 3.3.3.3 as-number 2 //对端环回接口ip地址，及对端所在AS号 切记：一旦使用环回接口建立BGP的邻居关系；必须将源地址也修改为环回接口 [r2-bgp]peer 3.3.3.3 connect-interface LoopBack 0 （3）EBGP邻居间存在多条物理链路时，也建议使用环回接口地址来建立 [1]、IP可达，建议静态路由
[2]、正常环回做为源、目ip地址建立邻居关系
[3]、默认IBGP邻居间数据包的TTL值为255，EBGP邻居间TTL为1；故一旦使用环回建立ebgp邻居关系，必须修改TTL值，否则无法建立
[r4-bgp]peer 5.5.5.5 ebgp-max-hop 2 当建邻配置完成后，邻居间通过三次握手，建立TCP的会话
[r2]display tcp status //查看TCP会话表 当TCP会话建立后，邻居间BGP协议将正常收发一次open报文，建立BGP邻居关系；生成邻居表：
[r2]display bgp peer //查看BGP邻居表
BGP local router ID : 2.2.2.2
Local AS number : 2
Total number of peers : 1 Peers in established state : 1" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/815fe7ecea58da820aea76b3d9f54c51/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-18T09:31:47+08:00" />
<meta property="article:modified_time" content="2023-10-18T09:31:47+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">BGP基本配置</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><img alt="" height="321" src="https://images2.imgbox.com/6a/9b/yAYQusyP_o.png" width="1091"></p> 
<h2>【1】BGP邻居关系建立，与路由条目宣告是分开的配置的</h2> 
<h3>（1）直连的EBGP邻居关系建立</h3> 
<pre><code>[r1]bgp 1  //启动BGP协议，启动时需要键入AS号；没有多进程概念

[r1-bgp]router-id 1.1.1.1  //建议配置RID；若不配置将自动生成—规则同OSPF相同

[r1-bgp]peer  12.1.1.2 as-number 2  //对端IP地址，及对端所在的AS编号</code></pre> 
<h3>（2）IBGP邻居关系建立</h3> 
<blockquote> 
 <p>在一个AS内部，拓扑正常较为负载；建议使用环回接口地址作为源、目标ip地址；存在备份链路，同时可以多条物理链路传递；</p> 
</blockquote> 
<pre><code>[r2]bgp 2

[r2-bgp]peer  3.3.3.3 as-number 2  //对端环回接口ip地址，及对端所在AS号

切记：一旦使用环回接口建立BGP的邻居关系；必须将源地址也修改为环回接口

[r2-bgp]peer  3.3.3.3 connect-interface LoopBack 0</code></pre> 
<p></p> 
<h3>（3）EBGP邻居间存在多条物理链路时，也建议使用环回接口地址来建立</h3> 
<blockquote> 
 <p>[1]、IP可达，建议静态路由</p> 
 <p>[2]、正常环回做为源、目ip地址建立邻居关系</p> 
 <p>[3]、默认IBGP邻居间数据包的TTL值为255，EBGP邻居间TTL为1；故一旦使用环回建立ebgp邻居关系，必须修改TTL值，否则无法建立</p> 
</blockquote> 
<pre><code>[r4-bgp]peer  5.5.5.5 ebgp-max-hop 2</code></pre> 
<p>当建邻配置完成后，邻居间通过三次握手，建立TCP的会话</p> 
<pre><code>[r2]display tcp status //查看TCP会话表</code></pre> 
<p>当TCP会话建立后，邻居间BGP协议将正常收发一次open报文，建立BGP邻居关系；生成邻居表：</p> 
<blockquote> 
 <p>[r2]display  bgp peer  //查看BGP邻居表</p> 
 <p> BGP local router ID : 2.2.2.2</p> 
 <p> Local AS number : 2</p> 
 <p>Total number of peers : 1                Peers in established state : 1</p> 
 <p>  Peer            V  AS  MsgRcvd  MsgSent  OutQ  Up/Down  State PrefRcv</p> 
 <p></p> 
 <p>  12.1.1.1         4    1        8        8     0    00:06:36  Established  0</p> 
</blockquote> 
<p>表格最后的数值，标识本地从该邻居处学习到的路由条目的数量；</p> 
<p></p> 
<h2>【2】BGP的宣告</h2> 
<blockquote> 
 <p>运行BGP协议的路由可以宣告本地路由表中通过任何协议获取到的路由条目—静态、IGP、直连； 而本地通过BGP协议学习到的路由，只要在本地依然优秀，将继续将本地的其他BGP邻居传输；</p> 
 <p><span style="color:#fe2c24;">注意：宣告时，宣告的条目必须同本地路由表中的记录完全一致</span></p> 
</blockquote> 
<pre><code>[r1]bgp 1

[r1-bgp]network 1.1.1.0 24</code></pre> 
<p><strong>一旦进行宣告配置，条目将加载于本地的BGP表中；装载本地发出及接收到的所有路由信息</strong></p> 
<pre><code>[r1]display  bgp routing-table  //查看BGP表</code></pre> 
<blockquote> 
 <p> BGP Local router ID is 1.1.1.1</p> 
 <p> Status codes: * - valid, &gt; - best, d - damped,</p> 
 <p>               h - history,  i - internal, s - suppressed, S - Stale</p> 
 <p>               Origin : i - IGP, e - EGP, ? - incomplete</p> 
 <p> Total Number of Routes: 1</p> 
 <p>      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn</p> 
 <p> *&gt;   1.1.1.0/24            0.0.0.0          0                       0        i</p> 
</blockquote> 
<h3>BGP表中状态符号</h3> 
<p>1、* 可用    </p> 
<p>2、 <strong>&gt;  </strong>优秀    </p> 
<p>3、*&gt;同时存在，可以加表（路由表）也可以传递（传递给本地的其他BGP邻居）</p> 
<p>4、状态处若出现 i 代表该条目是本地通过IBGP邻居学习到的</p> 
<p><strong>优秀的条件</strong>：1、同步问题（默认不关注） 2、下一跳可达</p> 
<p>基于AS-BY-AS规则，条目在一个AS内部传递时将不修改条目属性；导致通过IBGP邻居学习到的BGP路由可能出现下一跳不可达；导致条目不优；</p> 
<pre><code>[r2-bgp]peer  3.3.3.3 next-hop-local  
//将BGP路由传递给本地的邻居3.3.3.3时修改下一跳地址为本地与3.3.3.3建立邻居关系的源ip地址</code></pre> 
<p>当路由条目传递给本地的EBGP邻居时，属性将自动发生变化，包括下一跳地址；</p> 
<p>备注：在BGP协议中，若通过本地传递过来的路由条目，与本地路由表中已经存在且用于建立BGP邻居关系的路由相同时，该条目将不能优秀； </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/47adacca9902e5922e18382c033b98e3/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">u盘被写保护怎么解除步骤</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/24b2ce44cab7b2eb36aa4e6a90c84d8c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">介绍OpenVINO 2023.1: 在边缘端赋能生成式AI</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>