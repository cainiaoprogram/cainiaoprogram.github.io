<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>关于数据表空间问题总结 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="关于数据表空间问题总结" />
<meta property="og:description" content="oracle经常需要查数据库表空间大小，使用率，加表空间等，这里总结我经常使用的语句。
一、数据表空间相关：
查询所有表空间的使用情况：
SELECT d.tablespace_name &#34;Name&#34;, d.status &#34;Status&#34;, TO_CHAR (NVL (a.BYTES / 1024 / 1024, 0), &#39;99,999,990.90&#39;) &#34;Size (M)&#34;, TO_CHAR (NVL (a.BYTES - NVL (f.BYTES, 0), 0) / 1024 / 1024, &#39;99999999.99&#39; ) USE, TO_CHAR (NVL ((a.BYTES - NVL (f.BYTES, 0)) / a.BYTES * 100, 0), &#39;990.00&#39; ) &#34;Used %&#34; FROM SYS.dba_tablespaces d, (SELECT tablespace_name, SUM (BYTES) BYTES FROM dba_data_files GROUP BY tablespace_name) a, (SELECT tablespace_name, SUM (BYTES) BYTES FROM dba_free_space GROUP BY tablespace_name) f WHERE d." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/15632917688321d437b62cb19191b014/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-07-07T23:08:21+08:00" />
<meta property="article:modified_time" content="2022-07-07T23:08:21+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">关于数据表空间问题总结</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>oracle经常需要查数据库表空间大小，使用率，加表空间等，这里总结我经常使用的语句。<br> 一、数据表空间相关：<br> 查询所有表空间的使用情况：</p> 
<pre><code class="prism language-bash">SELECT d.tablespace_name <span class="token string">"Name"</span>, d.status <span class="token string">"Status"</span>, 
       TO_CHAR <span class="token punctuation">(</span>NVL <span class="token punctuation">(</span>a.BYTES / <span class="token number">1024</span> / <span class="token number">1024</span>, <span class="token number">0</span><span class="token punctuation">)</span>, <span class="token string">'99,999,990.90'</span><span class="token punctuation">)</span> <span class="token string">"Size (M)"</span>,
          TO_CHAR <span class="token punctuation">(</span>NVL <span class="token punctuation">(</span>a.BYTES - NVL <span class="token punctuation">(</span>f.BYTES, <span class="token number">0</span><span class="token punctuation">)</span>, <span class="token number">0</span><span class="token punctuation">)</span> / <span class="token number">1024</span> / <span class="token number">1024</span>,
                   <span class="token string">'99999999.99'</span>
                  <span class="token punctuation">)</span> USE,
       TO_CHAR <span class="token punctuation">(</span>NVL <span class="token variable"><span class="token punctuation">((</span>a.BYTES <span class="token operator">-</span> NVL <span class="token punctuation">(</span>f.BYTES<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">))</span></span> / a.BYTES * <span class="token number">100</span>, <span class="token number">0</span><span class="token punctuation">)</span>,
                <span class="token string">'990.00'</span>
               <span class="token punctuation">)</span> <span class="token string">"Used %"</span>
  FROM SYS.dba_tablespaces d,
       <span class="token punctuation">(</span>SELECT   tablespace_name, SUM <span class="token punctuation">(</span>BYTES<span class="token punctuation">)</span> BYTES
            FROM dba_data_files
        GROUP BY tablespace_name<span class="token punctuation">)</span> a,
       <span class="token punctuation">(</span>SELECT   tablespace_name, SUM <span class="token punctuation">(</span>BYTES<span class="token punctuation">)</span> BYTES
            FROM dba_free_space
        GROUP BY tablespace_name<span class="token punctuation">)</span> f
 WHERE d.tablespace_name <span class="token operator">=</span> a.tablespace_name<span class="token punctuation">(</span>+<span class="token punctuation">)</span>
   AND d.tablespace_name <span class="token operator">=</span> f.tablespace_name<span class="token punctuation">(</span>+<span class="token punctuation">)</span>
   AND NOT <span class="token punctuation">(</span>d.extent_management LIKE <span class="token string">'LOCAL'</span> AND d.CONTENTS LIKE <span class="token string">'TEMPORARY'</span><span class="token punctuation">)</span>
UNION ALL
SELECT d.tablespace_name <span class="token string">"Name"</span>, d.status <span class="token string">"Status"</span>, 
       TO_CHAR <span class="token punctuation">(</span>NVL <span class="token punctuation">(</span>a.BYTES / <span class="token number">1024</span> / <span class="token number">1024</span>, <span class="token number">0</span><span class="token punctuation">)</span>, <span class="token string">'99,999,990.90'</span><span class="token punctuation">)</span> <span class="token string">"Size (M)"</span>,
          TO_CHAR <span class="token punctuation">(</span>NVL <span class="token punctuation">(</span>t.BYTES, <span class="token number">0</span><span class="token punctuation">)</span> / <span class="token number">1024</span> / <span class="token number">1024</span>, <span class="token string">'99999999.99'</span><span class="token punctuation">)</span> USE,
       TO_CHAR <span class="token punctuation">(</span>NVL <span class="token punctuation">(</span>t.BYTES / a.BYTES * <span class="token number">100</span>, <span class="token number">0</span><span class="token punctuation">)</span>, <span class="token string">'990.00'</span><span class="token punctuation">)</span> <span class="token string">"Used %"</span>
  FROM SYS.dba_tablespaces d,
       <span class="token punctuation">(</span>SELECT   tablespace_name, SUM <span class="token punctuation">(</span>BYTES<span class="token punctuation">)</span> BYTES
            FROM dba_temp_files
        GROUP BY tablespace_name<span class="token punctuation">)</span> a,
       <span class="token punctuation">(</span>SELECT   tablespace_name, SUM <span class="token punctuation">(</span>bytes_cached<span class="token punctuation">)</span> BYTES
            FROM <span class="token function">v</span><span class="token variable">$temp_extent_pool</span>
        GROUP BY tablespace_name<span class="token punctuation">)</span> t
 WHERE d.tablespace_name <span class="token operator">=</span> a.tablespace_name<span class="token punctuation">(</span>+<span class="token punctuation">)</span>
   AND d.tablespace_name <span class="token operator">=</span> t.tablespace_name<span class="token punctuation">(</span>+<span class="token punctuation">)</span>
   AND d.extent_management LIKE <span class="token string">'LOCAL'</span>
   AND d.CONTENTS LIKE <span class="token string">'TEMPORARY'</span><span class="token punctuation">;</span>
</code></pre> 
<ol><li>查询表空间剩余字节大小–注意替换数据表空间或临时表空间（大写）名称或查询时直接输入</li></ol> 
<pre><code class="prism language-bash">SELECT TABLESPACE_NAME, SUM<span class="token punctuation">(</span>BYTES<span class="token punctuation">)</span>/1024/1024 AS <span class="token string">"FREE SPACE(M)"</span>
  FROM DBA_FREE_SPACE
 WHERE TABLESPACE_NAME <span class="token operator">=</span> <span class="token string">'&amp;tablespace_name'</span>
 GROUP BY TABLESPACE_NAME<span class="token punctuation">;</span>
</code></pre> 
<p>注：如果是临时表空间，请查询DBA_TEMP_FREE_SPACE</p> 
<pre><code class="prism language-bash">SELECT TABLESPACE_NAME, FREE_SPACE/1024/1024 AS <span class="token string">"FREE SPACE(M)"</span>
  FROM DBA_TEMP_FREE_SPACE
 WHERE TABLESPACE_NAME <span class="token operator">=</span> <span class="token string">'&amp;tablespace_name'</span><span class="token punctuation">;</span>
</code></pre> 
<ol start="2"><li>查询表空间所有数据文件路径</li></ol> 
<pre><code class="prism language-bash">SELECT TABLESPACE_NAME, FILE_ID, FILE_NAME, BYTES/1024/1024 AS <span class="token string">"BYTES(M)"</span>
  FROM DBA_DATA_FILES
 WHERE TABLESPACE_NAME <span class="token operator">=</span> <span class="token string">'&amp;tablespace_name'</span><span class="token punctuation">;</span>
</code></pre> 
<p>注：如果是临时表空间，请查询DBA_TEMP_FILES</p> 
<pre><code class="prism language-bash">SELECT TABLESPACE_NAME, FILE_ID, FILE_NAME, BYTES/1024/1024 AS <span class="token string">"SPACE(M)"</span>
  FROM DBA_TEMP_FILES
 WHERE TABLESPACE_NAME <span class="token operator">=</span> <span class="token string">'&amp;tablespace_name'</span><span class="token punctuation">;</span>
</code></pre> 
<p>3、查看表空间是否具有自动扩展的能力（没有包含临时表空间）</p> 
<pre><code class="prism language-bash">SELECT T.TABLESPACE_NAME,D.FILE_NAME,     
D.AUTOEXTENSIBLE,D.BYTES,D.MAXBYTES,D.STATUS     
FROM DBA_TABLESPACES T,DBA_DATA_FILES D     
WHERE T.TABLESPACE_NAME <span class="token operator">=</span>D.TABLESPACE_NAME     
 ORDER BY TABLESPACE_NAME,FILE_NAME<span class="token punctuation">;</span> 
</code></pre> 
<p>4、查询所有临时表空间是否自增长，next_extent有没有值，如果有就是可以自动扩展</p> 
<pre><code class="prism language-bash">SELECT * FROM dba_tablespaces t where t.CONTENTS<span class="token operator">=</span><span class="token string">'TEMPORARY'</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> file_name,bytes/1024/1024 <span class="token string">"MB"</span>,autoextensible,tablespace_name from dba_temp_files<span class="token punctuation">;</span>
</code></pre> 
<p>5、查看某用户的默认数据表空间：</p> 
<pre><code class="prism language-bash"><span class="token keyword">select</span> * from dba_users where username <span class="token operator">=</span> <span class="token string">'大写'</span>
</code></pre> 
<p>二、数据表空间：<br> 1、查看所有表名称、路径、是否自动增长：<br> 语句一：</p> 
<pre><code class="prism language-bash">SQL<span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> line <span class="token number">200</span><span class="token punctuation">;</span>
col file_name <span class="token function">format</span> a40<span class="token punctuation">;</span>
col tablespace_name <span class="token function">format</span> a35<span class="token punctuation">;</span>
<span class="token keyword">select</span> file_name,autoextensible,maxbytes,increment_by from dba_data_files<span class="token punctuation">;</span>
</code></pre> 
<p>语句二：</p> 
<pre><code class="prism language-bash"><span class="token keyword">select</span> * from dba_data_files<span class="token punctuation">;</span>
</code></pre> 
<p>语句三：</p> 
<pre><code class="prism language-bash">SELECT T.TABLESPACE_NAME,D.FILE_NAME,     
D.AUTOEXTENSIBLE,D.BYTES,D.MAXBYTES,D.STATUS     
FROM DBA_TABLESPACES T,DBA_DATA_FILES D     
WHERE T.TABLESPACE_NAME <span class="token operator">=</span>D.TABLESPACE_NAME     
 ORDER BY TABLESPACE_NAME,FILE_NAME<span class="token punctuation">;</span>  
</code></pre> 
<p>2、修改数据表文件无限增长</p> 
<pre><code class="prism language-bash">alter database datafile <span class="token string">'/u01/oracle/oradata/srmcps/srmcps_data.dbf'</span> autoextend on next 64m maxsize unlimited<span class="token punctuation">;</span>
</code></pre> 
<p>3、增加表空间</p> 
<pre><code class="prism language-bash">ALTER TABLESPACE srmhdl_data ADD DATAFILE <span class="token string">'/home/oracle/oracle/oradata/srmsdpx/srmhdl_data02.dfg'</span> size 64m autoextend on next 64m maxsize unlimited<span class="token punctuation">;</span>
</code></pre> 
<p>4、表空间数据文件位置、大小、使用率<br> 语句一：</p> 
<pre><code class="prism language-bash">SELECT tablespace_name,
       <span class="token number">100</span> * <span class="token punctuation">(</span>sum_max - sum_alloc + nvl<span class="token punctuation">(</span>sum_free, <span class="token number">0</span><span class="token punctuation">))</span> / sum_max AS capa_per,
       <span class="token punctuation">(</span>sum_max - sum_alloc + nvl<span class="token punctuation">(</span>sum_free, <span class="token number">0</span><span class="token punctuation">))</span> / <span class="token number">1024</span> / <span class="token number">1024</span> AS capa_free,
       <span class="token punctuation">(</span>sum_alloc - nvl<span class="token punctuation">(</span>sum_free, <span class="token number">0</span><span class="token punctuation">))</span> / <span class="token number">1024</span> / <span class="token number">1024</span> as capa_used,
       sum_max / <span class="token number">1024</span> / <span class="token number">1024</span> as capa_max,
       <span class="token number">100</span> * nvl<span class="token punctuation">(</span>sum_free, <span class="token number">0</span><span class="token punctuation">)</span> / sum_alloc As per,
       nvl<span class="token punctuation">(</span>sum_free, <span class="token number">0</span><span class="token punctuation">)</span> / <span class="token number">1024</span> / <span class="token number">1024</span> as free,
       <span class="token punctuation">(</span>sum_alloc - nvl<span class="token punctuation">(</span>sum_free, <span class="token number">0</span><span class="token punctuation">))</span> / <span class="token number">1024</span> / <span class="token number">1024</span> as used,
       sum_alloc / <span class="token number">1024</span> / <span class="token number">1024</span> as max
  FROM <span class="token punctuation">(</span>SELECT tablespace_name,
               sum<span class="token punctuation">(</span>bytes<span class="token punctuation">)</span> AS sum_alloc,
               sum<span class="token punctuation">(</span>decode<span class="token punctuation">(</span>maxbytes, <span class="token number">0</span>, bytes, maxbytes<span class="token punctuation">))</span> AS sum_max
          FROM dba_data_files
         GROUP BY tablespace_name<span class="token punctuation">)</span>,
       <span class="token punctuation">(</span>SELECT tablespace_name AS fs_ts_name, sum<span class="token punctuation">(</span>bytes<span class="token punctuation">)</span> AS sum_free
          FROM dba_free_space
         GROUP BY tablespace_name<span class="token punctuation">)</span>
 WHERE tablespace_name <span class="token operator">=</span> fs_ts_name<span class="token punctuation">(</span>+<span class="token punctuation">)</span>
 order by <span class="token number">2</span>, <span class="token number">3</span><span class="token punctuation">;</span>
</code></pre> 
<p>语句二（列出当前环境所有数据表空间的使用情况）：</p> 
<pre><code class="prism language-bash"><span class="token keyword">select</span>
b.file_name <span class="token string">"物理文件名"</span>,
b.tablespace_name <span class="token string">"表空间"</span>,
b.bytes/1024/1024 <span class="token string">"大小M"</span>,
<span class="token punctuation">(</span>b.bytes-sum<span class="token punctuation">(</span>nvl<span class="token punctuation">(</span>a.bytes,0<span class="token punctuation">))</span><span class="token punctuation">)</span>/1024/1024 <span class="token string">"已使用M"</span>,
substr<span class="token variable"><span class="token punctuation">((</span>b.bytes<span class="token operator">-</span>sum<span class="token punctuation">(</span>nvl<span class="token punctuation">(</span>a.bytes<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">))</span></span><span class="token punctuation">)</span>/<span class="token punctuation">(</span>b.bytes<span class="token punctuation">)</span>*100,1,5<span class="token punctuation">)</span> <span class="token string">"利用率"</span>
from dba_free_space a,dba_data_files b
where a.file_id<span class="token operator">=</span>b.file_id
group by b.tablespace_name,b.file_name,b.bytes
order by b.tablespace_name<span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-bash">SELECT SUM<span class="token punctuation">(</span>bytes<span class="token punctuation">)</span> / <span class="token punctuation">(</span><span class="token number">1024</span> * <span class="token number">1024</span><span class="token punctuation">)</span> AS free_space, tablespace_name 
FROM dba_free_space 
GROUP BY tablespace_name<span class="token punctuation">;</span> 
SELECT a.tablespace_name, 
a.bytes total, 
b.bytes used, 
c.bytes free, 
<span class="token punctuation">(</span>b.bytes * <span class="token number">100</span><span class="token punctuation">)</span> / a.bytes <span class="token string">"% USED "</span>, 
<span class="token punctuation">(</span>c.bytes * <span class="token number">100</span><span class="token punctuation">)</span> / a.bytes <span class="token string">"% FREE "</span> 
FROM sys.sm<span class="token variable">$ts_avail</span> a, sys.sm<span class="token variable">$ts_used</span> b, sys.sm<span class="token variable">$ts_free</span> c 
WHERE a.tablespace_name <span class="token operator">=</span> b.tablespace_name 
AND a.tablespace_name <span class="token operator">=</span> c.tablespace_name<span class="token punctuation">;</span>
</code></pre> 
<p>语句三：</p> 
<pre><code class="prism language-bash">SELECT UPPER<span class="token punctuation">(</span>F.TABLESPACE_NAME<span class="token punctuation">)</span> <span class="token string">"表空间名"</span>,
D.TOT_GROOTTE_MB <span class="token string">"表空间大小(M)"</span>,
D.TOT_GROOTTE_MB - F.TOTAL_BYTES <span class="token string">"已使用空间(M)"</span>,
TO_CHAR<span class="token punctuation">(</span>ROUND<span class="token punctuation">((</span>D.TOT_GROOTTE_MB - F.TOTAL_BYTES<span class="token punctuation">)</span> / D.TOT_GROOTTE_MB * <span class="token number">100,2</span><span class="token punctuation">)</span>,<span class="token string">'990.99'</span><span class="token punctuation">)</span> <span class="token string">"使用比"</span>,
F.TOTAL_BYTES <span class="token string">"空闲空间(M)"</span>,
F.MAX_BYTES <span class="token string">"最大块(M)"</span>
FROM <span class="token punctuation">(</span>SELECT TABLESPACE_NAME, 
ROUND<span class="token punctuation">(</span>SUM<span class="token punctuation">(</span>BYTES<span class="token punctuation">)</span> / <span class="token punctuation">(</span><span class="token number">1024</span> * <span class="token number">1024</span><span class="token punctuation">)</span>, <span class="token number">2</span><span class="token punctuation">)</span> TOTAL_BYTES,     
ROUND<span class="token punctuation">(</span>MAX<span class="token punctuation">(</span>BYTES<span class="token punctuation">)</span> / <span class="token punctuation">(</span><span class="token number">1024</span> * <span class="token number">1024</span><span class="token punctuation">)</span>, <span class="token number">2</span><span class="token punctuation">)</span> MAX_BYTES     
FROM SYS.DBA_FREE_SPACE     
GROUP BY TABLESPACE_NAME<span class="token punctuation">)</span> F,     
<span class="token punctuation">(</span>SELECT DD.TABLESPACE_NAME,     
ROUND<span class="token punctuation">(</span>SUM<span class="token punctuation">(</span>DD.BYTES<span class="token punctuation">)</span> / <span class="token punctuation">(</span><span class="token number">1024</span> * <span class="token number">1024</span><span class="token punctuation">)</span>, <span class="token number">2</span><span class="token punctuation">)</span> TOT_GROOTTE_MB     
FROM SYS.DBA_DATA_FILES DD     
GROUP BY DD.TABLESPACE_NAME<span class="token punctuation">)</span> D     
WHERE D.TABLESPACE_NAME <span class="token operator">=</span> F.TABLESPACE_NAME     
ORDER BY <span class="token number">4</span> DESC<span class="token punctuation">;</span>
</code></pre> 
<p>语句四，架构推荐（列出数据表空间的使用率与空闲表空间）：</p> 
<pre><code class="prism language-bash">SELECT UPPER<span class="token punctuation">(</span>F.TABLESPACE_NAME<span class="token punctuation">)</span> <span class="token string">"表空间名"</span>,
D.TOT_GROOTTE_MB <span class="token string">"表空间大小(G)"</span>,
D.TOT_GROOTTE_MB - F.TOTAL_BYTES <span class="token string">"已使用空间(G)"</span>,
TO_CHAR<span class="token punctuation">(</span>ROUND<span class="token punctuation">((</span>D.TOT_GROOTTE_MB - F.TOTAL_BYTES<span class="token punctuation">)</span> / D.TOT_GROOTTE_MB * <span class="token number">100,2</span><span class="token punctuation">)</span>,<span class="token string">'990.99'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">'%'</span> <span class="token string">"使用比"</span>,
F.TOTAL_BYTES <span class="token string">"空闲空间(G)"</span>,
F.MAX_BYTES <span class="token string">"最大块(G)"</span>
FROM <span class="token punctuation">(</span>SELECT TABLESPACE_NAME,
ROUND<span class="token punctuation">(</span>SUM<span class="token punctuation">(</span>BYTES<span class="token punctuation">)</span> / <span class="token punctuation">(</span><span class="token number">1024</span> * <span class="token number">1024</span>*1024<span class="token punctuation">)</span>, <span class="token number">2</span><span class="token punctuation">)</span> TOTAL_BYTES,
ROUND<span class="token punctuation">(</span>MAX<span class="token punctuation">(</span>BYTES<span class="token punctuation">)</span> / <span class="token punctuation">(</span><span class="token number">1024</span> * <span class="token number">1024</span>*1024<span class="token punctuation">)</span>, <span class="token number">2</span><span class="token punctuation">)</span> MAX_BYTES
FROM SYS.DBA_FREE_SPACE   where tablespace_name<span class="token operator">&lt;&gt;</span> <span class="token string">'USERS'</span>
GROUP BY TABLESPACE_NAME<span class="token punctuation">)</span> F,
<span class="token punctuation">(</span>SELECT DD.TABLESPACE_NAME,
ROUND<span class="token punctuation">(</span>SUM<span class="token punctuation">(</span>DD.BYTES<span class="token punctuation">)</span> / <span class="token punctuation">(</span><span class="token number">1024</span> * <span class="token number">1024</span>*1024<span class="token punctuation">)</span>, <span class="token number">2</span><span class="token punctuation">)</span> TOT_GROOTTE_MB
FROM SYS.DBA_DATA_FILES    DD  where dd.tablespace_name<span class="token operator">&lt;&gt;</span> <span class="token string">'USERS'</span>
GROUP BY DD.TABLESPACE_NAME<span class="token punctuation">)</span> D
WHERE D.TABLESPACE_NAME <span class="token operator">=</span> F.TABLESPACE_NAME
ORDER BY <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre> 
<p>查看当前表空间使用总量：</p> 
<pre><code class="prism language-bash"><span class="token keyword">select</span> tablespace_name, sum<span class="token punctuation">(</span>bytes<span class="token punctuation">)</span> / <span class="token number">1024</span> / <span class="token number">1024</span> as MB
　　from dba_data_files
　　group by tablespace_name<span class="token punctuation">;</span>
</code></pre> 
<p>–查询表空间的free space</p> 
<pre><code class="prism language-bash"><span class="token keyword">select</span> tablespace_name,
　　count<span class="token punctuation">(</span>*<span class="token punctuation">)</span> as extends,
　　round<span class="token punctuation">(</span>sum<span class="token punctuation">(</span>bytes<span class="token punctuation">)</span> / <span class="token number">1024</span> / <span class="token number">1024</span>, <span class="token number">2</span><span class="token punctuation">)</span> as MB,
　　sum<span class="token punctuation">(</span>blocks<span class="token punctuation">)</span> as blocks
　　from dba_free_space
　　group by tablespace_name<span class="token punctuation">;</span>
</code></pre> 
<p>查看某用户表空间名称：</p> 
<pre><code class="prism language-bash"><span class="token keyword">select</span> username,default_tablespace from dba_users  where <span class="token assign-left variable">username</span><span class="token operator">=</span><span class="token string">'SCOTT'</span><span class="token punctuation">;</span>--用户名需要大写
<span class="token keyword">select</span> username,default_tablespace from dba_users  where <span class="token assign-left variable">username</span><span class="token operator">=</span><span class="token string">'DBYW'</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> username,temporary_tablespace from dba_users  where <span class="token assign-left variable">username</span><span class="token operator">=</span><span class="token string">'DBYW'</span><span class="token punctuation">;</span>
</code></pre> 
<p>–查看数据表空间的使用情况（推荐）</p> 
<pre><code class="prism language-bash">Select d.tablespace_name,space <span class="token string">"sum_space(m)"</span>,blocks sum_blocks,
space-nvl<span class="token punctuation">(</span>free_space,0<span class="token punctuation">)</span> <span class="token string">"used_space"</span>,round<span class="token punctuation">((</span><span class="token number">1</span>-nvl<span class="token punctuation">(</span>free_space,0<span class="token punctuation">)</span>/space<span class="token punctuation">)</span>*100,2<span class="token punctuation">)</span> <span class="token string">"used_rate(%)"</span>,
Free_space <span class="token string">"free_space(M)"</span>
From <span class="token punctuation">(</span>select tablespace_name,round<span class="token punctuation">(</span>sum<span class="token punctuation">(</span>bytes<span class="token punctuation">)</span>/<span class="token punctuation">(</span><span class="token number">1024</span>*1024<span class="token punctuation">)</span>,2<span class="token punctuation">)</span> space,sum<span class="token punctuation">(</span>blocks<span class="token punctuation">)</span> blocks
From dba_data_files
Group by tablespace_name<span class="token punctuation">)</span> d,
<span class="token punctuation">(</span>select tablespace_name,round<span class="token punctuation">(</span>sum<span class="token punctuation">(</span>bytes<span class="token punctuation">)</span>/<span class="token punctuation">(</span><span class="token number">1024</span>*1024<span class="token punctuation">)</span>,2<span class="token punctuation">)</span> free_space
From dba_free_space
Group by tablespace_name<span class="token punctuation">)</span> f
Where d.tablespace_name<span class="token operator">=</span>f.tablespace_name<span class="token punctuation">(</span>+<span class="token punctuation">)</span>
Union all
Select d.tablespace_name,space <span class="token string">"sum_space(M)"</span>,blocks sum_blocks,used_space <span class="token string">"used_space(M)"</span>,round<span class="token punctuation">(</span>nvl<span class="token punctuation">(</span>used_space,0<span class="token punctuation">)</span>/space*100,2<span class="token punctuation">)</span> <span class="token string">"used_rate(%)"</span>,
Nvl<span class="token punctuation">(</span>free_space,0<span class="token punctuation">)</span> <span class="token string">"free_space(m)"</span>
From
<span class="token punctuation">(</span>select tablespace_name,round<span class="token punctuation">(</span>sum<span class="token punctuation">(</span>bytes<span class="token punctuation">)</span>/<span class="token punctuation">(</span><span class="token number">1024</span>*1024<span class="token punctuation">)</span>,2<span class="token punctuation">)</span> space,
Sum<span class="token punctuation">(</span>blocks<span class="token punctuation">)</span> blocks
From dba_temp_files
Group by tablespace_name<span class="token punctuation">)</span> d,
<span class="token punctuation">(</span>select tablespace_name,round<span class="token punctuation">(</span>sum<span class="token punctuation">(</span>bytes_used<span class="token punctuation">)</span>/<span class="token punctuation">(</span><span class="token number">1024</span>*1024<span class="token punctuation">)</span>,2<span class="token punctuation">)</span> used_space,round<span class="token punctuation">(</span>sum<span class="token punctuation">(</span>bytes_free<span class="token punctuation">)</span>/<span class="token punctuation">(</span><span class="token number">1024</span>*1024<span class="token punctuation">)</span>,2<span class="token punctuation">)</span> free_space
From <span class="token function">v</span><span class="token variable">$temp_space_header</span>
Group by tablespace_name<span class="token punctuation">)</span> f
Where d.tablespace_name<span class="token operator">=</span>f.tablespace_name<span class="token punctuation">(</span>+<span class="token punctuation">)</span>
order by tablespace_name<span class="token punctuation">;</span>
</code></pre> 
<p>–查看表空间的真实使用情况（推荐）</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">set</span> linesize <span class="token number">500</span> pagesize <span class="token number">500</span>
col tablespace_name <span class="token function">format</span> a25
col TP_REAL_GB <span class="token function">format</span> a15
col TP_REAL_FREE_GB <span class="token function">format</span> a20
<span class="token keyword">select</span> all_tp.TP_NAME <span class="token string">"TABLESPACE_NAME"</span>,
       to_char<span class="token punctuation">(</span>trunc<span class="token punctuation">(</span>all_tp.TP_ALL_SIZE_KB / <span class="token number">1024</span> / <span class="token number">1024</span>, <span class="token number">2</span><span class="token punctuation">)</span>,
               <span class="token string">'FM9999990.0099'</span><span class="token punctuation">)</span> <span class="token string">"TP_REAL_GB"</span>,
       to_char<span class="token punctuation">(</span>trunc<span class="token punctuation">(</span>free_tp.TP_FREE_SIZE_KB / <span class="token number">1024</span> / <span class="token number">1024</span>, <span class="token number">2</span><span class="token punctuation">)</span>,
               <span class="token string">'FM9999990.0099'</span><span class="token punctuation">)</span> <span class="token string">"TP_REAL_FREE_GB"</span>,
       <span class="token punctuation">(</span>to_char<span class="token punctuation">(</span>trunc<span class="token punctuation">(</span>all_tp.TP_ALL_SIZE_KB / <span class="token number">1024</span> / <span class="token number">1024</span>, <span class="token number">2</span><span class="token punctuation">)</span>,
                <span class="token string">'FM9999990.0099'</span><span class="token punctuation">)</span> -
       to_char<span class="token punctuation">(</span>trunc<span class="token punctuation">(</span>free_tp.TP_FREE_SIZE_KB / <span class="token number">1024</span> / <span class="token number">1024</span>, <span class="token number">2</span><span class="token punctuation">)</span>,
                <span class="token string">'FM9999990.0099'</span><span class="token punctuation">))</span> <span class="token string">"TP_REAL_USED_GB"</span>,
       to_char<span class="token punctuation">(</span>trunc<span class="token punctuation">(</span>free_tp.TP_FREE_SIZE_KB * <span class="token number">100</span> / all_tp.TP_ALL_SIZE_KB,
                     <span class="token number">2</span><span class="token punctuation">)</span>,
               <span class="token string">'FM9999990.0099'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">'%'</span> <span class="token string">"TP_FREE_RATING"</span>
  from <span class="token punctuation">(</span> --表空间总大小
        <span class="token keyword">select</span> sum<span class="token punctuation">(</span>TP_SIZE_KB<span class="token punctuation">)</span> TP_ALL_SIZE_KB, TP_NAME
          from <span class="token punctuation">(</span> --自动扩展总大小<span class="token punctuation">(</span>maxbytes/bytes取两者最大值<span class="token punctuation">)</span>
                 <span class="token keyword">select</span> decode<span class="token punctuation">(</span>sign<span class="token punctuation">(</span>ddf.maxbytes - ddf.bytes<span class="token punctuation">)</span>,
                                <span class="token number">1</span>,
                                ddf.maxbytes,
                                ddf.bytes<span class="token punctuation">)</span> / <span class="token number">1024</span> TP_SIZE_KB,
                         ddf.tablespace_name TP_NAME
                   from DBA_DATA_FILES ddf
                  where ddf.autoextensible <span class="token operator">=</span> <span class="token string">'YES'</span>
                 union all
                 --非自动总扩展大小
                 <span class="token keyword">select</span> BYTES / <span class="token number">1024</span> TP_SIZE_KB, ddf.tablespace_name TP_NAME
                   from DBA_DATA_FILES ddf
                  where ddf.autoextensible <span class="token operator">=</span> <span class="token string">'NO'</span><span class="token punctuation">)</span> TP_ALL_SIZE
         group by TP_NAME<span class="token punctuation">)</span> all_tp,
       <span class="token punctuation">(</span> --表空间空闲的总大小
        <span class="token keyword">select</span> sum<span class="token punctuation">(</span>TPF_SIZE_KB<span class="token punctuation">)</span> TP_FREE_SIZE_KB, TP_NAME
          from <span class="token punctuation">(</span> --数据文件已经分配，空闲空间
                 <span class="token keyword">select</span> dfs.bytes / <span class="token number">1024</span> TPF_SIZE_KB,
                         dfs.tablespace_name TP_NAME
                   from DBA_FREE_SPACE dfs
                 union all
                 --数据文件自动扩展<span class="token punctuation">(</span>若maxbytes大于bytes，取差值；若maxbytes小于等于bytes，取0<span class="token punctuation">)</span>
                 <span class="token keyword">select</span> decode<span class="token punctuation">(</span>sign<span class="token punctuation">(</span>ddf.maxbytes - ddf.bytes<span class="token punctuation">)</span>,
                               <span class="token number">1</span>,
                               ddf.maxbytes - ddf.bytes,
                               <span class="token number">0</span><span class="token punctuation">)</span> / <span class="token number">1024</span> TPF_SIZE_KB,
                        ddf.tablespace_name TP_NAME
                   from DBA_DATA_FILES ddf
                  where ddf.autoextensible <span class="token operator">=</span> <span class="token string">'YES'</span><span class="token punctuation">)</span> TP_FREE_SIZE
         group by TP_NAME<span class="token punctuation">)</span> free_tp
 where all_tp.TP_NAME <span class="token operator">=</span> free_tp.TP_NAME<span class="token punctuation">(</span>+<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
中文 
 <span class="token keyword">select</span> all_tp.TP_NAME <span class="token string">"表空间名"</span>,
       to_char<span class="token punctuation">(</span>trunc<span class="token punctuation">(</span>all_tp.TP_ALL_SIZE_KB / <span class="token number">1024</span> / <span class="token number">1024</span>, <span class="token number">2</span><span class="token punctuation">)</span>,
               <span class="token string">'FM9999990.0099'</span><span class="token punctuation">)</span> <span class="token string">"表空间实际大小"</span>,
       to_char<span class="token punctuation">(</span>trunc<span class="token punctuation">(</span>free_tp.TP_FREE_SIZE_KB / <span class="token number">1024</span> / <span class="token number">1024</span>, <span class="token number">2</span><span class="token punctuation">)</span>,
               <span class="token string">'FM9999990.0099'</span><span class="token punctuation">)</span> <span class="token string">"表空间实际剩余大小"</span>,
       <span class="token punctuation">(</span>to_char<span class="token punctuation">(</span>trunc<span class="token punctuation">(</span>all_tp.TP_ALL_SIZE_KB / <span class="token number">1024</span> / <span class="token number">1024</span>, <span class="token number">2</span><span class="token punctuation">)</span>,
                <span class="token string">'FM9999990.0099'</span><span class="token punctuation">)</span> -
       to_char<span class="token punctuation">(</span>trunc<span class="token punctuation">(</span>free_tp.TP_FREE_SIZE_KB / <span class="token number">1024</span> / <span class="token number">1024</span>, <span class="token number">2</span><span class="token punctuation">)</span>,
                <span class="token string">'FM9999990.0099'</span><span class="token punctuation">))</span> <span class="token string">"表空间实际使用大小"</span>,
       to_char<span class="token punctuation">(</span>trunc<span class="token punctuation">(</span>free_tp.TP_FREE_SIZE_KB * <span class="token number">100</span> / all_tp.TP_ALL_SIZE_KB,
                     <span class="token number">2</span><span class="token punctuation">)</span>,
               <span class="token string">'FM9999990.0099'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">'%'</span> <span class="token string">"表空间剩余比率"</span>
  from <span class="token punctuation">(</span> --表空间总大小
        <span class="token keyword">select</span> sum<span class="token punctuation">(</span>TP_SIZE_KB<span class="token punctuation">)</span> TP_ALL_SIZE_KB, TP_NAME
          from <span class="token punctuation">(</span> --自动扩展总大小<span class="token punctuation">(</span>maxbytes/bytes取两者最大值<span class="token punctuation">)</span>
                 <span class="token keyword">select</span> decode<span class="token punctuation">(</span>sign<span class="token punctuation">(</span>ddf.maxbytes - ddf.bytes<span class="token punctuation">)</span>,
                                <span class="token number">1</span>,
                                ddf.maxbytes,
                                ddf.bytes<span class="token punctuation">)</span> / <span class="token number">1024</span> TP_SIZE_KB,
                         ddf.tablespace_name TP_NAME
                   from DBA_DATA_FILES ddf
                  where ddf.autoextensible <span class="token operator">=</span> <span class="token string">'YES'</span>
                 union all
                 --非自动总扩展大小
                 <span class="token keyword">select</span> BYTES / <span class="token number">1024</span> TP_SIZE_KB, ddf.tablespace_name TP_NAME
                   from DBA_DATA_FILES ddf
                  where ddf.autoextensible <span class="token operator">=</span> <span class="token string">'NO'</span><span class="token punctuation">)</span> TP_ALL_SIZE
         group by TP_NAME<span class="token punctuation">)</span> all_tp,
       <span class="token punctuation">(</span> --表空间空闲的总大小
        <span class="token keyword">select</span> sum<span class="token punctuation">(</span>TPF_SIZE_KB<span class="token punctuation">)</span> TP_FREE_SIZE_KB, TP_NAME
          from <span class="token punctuation">(</span> --数据文件已经分配，空闲空间
                 <span class="token keyword">select</span> dfs.bytes / <span class="token number">1024</span> TPF_SIZE_KB,
                         dfs.tablespace_name TP_NAME
                   from DBA_FREE_SPACE dfs
                 union all
                 --数据文件自动扩展<span class="token punctuation">(</span>若maxbytes大于bytes，取差值；若maxbytes小于等于bytes，取0<span class="token punctuation">)</span>
                 <span class="token keyword">select</span> decode<span class="token punctuation">(</span>sign<span class="token punctuation">(</span>ddf.maxbytes - ddf.bytes<span class="token punctuation">)</span>,
                               <span class="token number">1</span>,
                               ddf.maxbytes - ddf.bytes,
                               <span class="token number">0</span><span class="token punctuation">)</span> / <span class="token number">1024</span> TPF_SIZE_KB,
                        ddf.tablespace_name TP_NAME
                   from DBA_DATA_FILES ddf
                  where ddf.autoextensible <span class="token operator">=</span> <span class="token string">'YES'</span><span class="token punctuation">)</span> TP_FREE_SIZE
         group by TP_NAME<span class="token punctuation">)</span> free_tp
 where all_tp.TP_NAME <span class="token operator">=</span> free_tp.TP_NAME<span class="token punctuation">(</span>+<span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre> 
<p>–查看表空间使用情况（推荐）</p> 
<pre><code class="prism language-bash">ora-00972:identifier is too long问题处理
<span class="token builtin class-name">export</span> <span class="token assign-left variable">NLS_LANG</span><span class="token operator">=</span><span class="token string">'american_america.AL32UTF8'</span>

<span class="token builtin class-name">set</span> line <span class="token number">2500</span><span class="token punctuation">;</span>
SELECT UPPER<span class="token punctuation">(</span>F.TABLESPACE_NAME<span class="token punctuation">)</span> <span class="token string">"表空间名"</span>,
 　　D.TOT_GROOTTE_MB <span class="token string">"表空间大小(G)"</span>,
 　　D.TOT_GROOTTE_MB - F.TOTAL_BYTES <span class="token string">"已使用空间(G)"</span>,
 　　TO_CHAR<span class="token punctuation">(</span>ROUND<span class="token punctuation">((</span>D.TOT_GROOTTE_MB - F.TOTAL_BYTES<span class="token punctuation">)</span> / D.TOT_GROOTTE_MB * <span class="token number">100,2</span><span class="token punctuation">)</span>,<span class="token string">'990.99'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">'%'</span> <span class="token string">"使用比"</span>,
 　　F.TOTAL_BYTES <span class="token string">"空闲空间(G)"</span>,
 　　F.MAX_BYTES <span class="token string">"最大块(G)"</span>
 　　FROM <span class="token punctuation">(</span>SELECT TABLESPACE_NAME,
 　　ROUND<span class="token punctuation">(</span>SUM<span class="token punctuation">(</span>BYTES<span class="token punctuation">)</span> / <span class="token punctuation">(</span><span class="token number">1024</span> * <span class="token number">1024</span>*1024<span class="token punctuation">)</span>, <span class="token number">2</span><span class="token punctuation">)</span> TOTAL_BYTES,
 　　ROUND<span class="token punctuation">(</span>MAX<span class="token punctuation">(</span>BYTES<span class="token punctuation">)</span> / <span class="token punctuation">(</span><span class="token number">1024</span> * <span class="token number">1024</span>*1024<span class="token punctuation">)</span>, <span class="token number">2</span><span class="token punctuation">)</span> MAX_BYTES
 　　FROM SYS.DBA_FREE_SPACE   where tablespace_name<span class="token operator">&lt;&gt;</span> <span class="token string">'USERS'</span>
 　　GROUP BY TABLESPACE_NAME<span class="token punctuation">)</span> F,
 　　<span class="token punctuation">(</span>SELECT DD.TABLESPACE_NAME,
 　　 ROUND<span class="token punctuation">(</span>SUM<span class="token punctuation">(</span>DD.BYTES<span class="token punctuation">)</span> / <span class="token punctuation">(</span><span class="token number">1024</span> * <span class="token number">1024</span>*1024<span class="token punctuation">)</span>, <span class="token number">2</span><span class="token punctuation">)</span> TOT_GROOTTE_MB
 　　FROM SYS.DBA_DATA_FILES    DD  where dd.tablespace_name<span class="token operator">&lt;&gt;</span> <span class="token string">'USERS'</span>
 　　GROUP BY DD.TABLESPACE_NAME<span class="token punctuation">)</span> D
 　　WHERE D.TABLESPACE_NAME <span class="token operator">=</span> F.TABLESPACE_NAME
 ORDER BY <span class="token number">1</span><span class="token punctuation">;</span>
 
 SELECT a.tablespace_name <span class="token string">"表空间名"</span>, total / <span class="token number">1024</span> / <span class="token number">1024</span> <span class="token string">"表空间大小单位M"</span>, <span class="token function">free</span> / <span class="token number">1024</span> / <span class="token number">1024</span> <span class="token string">"表空间剩余大小单位M"</span>,  <span class="token punctuation">(</span>total - <span class="token function">free</span><span class="token punctuation">)</span> / <span class="token number">1024</span> / <span class="token number">1024</span> <span class="token string">"表空间使用大小单位M"</span>, 
  Round<span class="token punctuation">((</span>total - <span class="token function">free</span><span class="token punctuation">)</span> / total, <span class="token number">4</span> <span class="token punctuation">)</span> * <span class="token number">100</span> <span class="token string">"使用率   [[%]]"</span> 
FROM 
  <span class="token punctuation">(</span>SELECT tablespace_name, Sum<span class="token punctuation">(</span>bytes<span class="token punctuation">)</span> <span class="token function">free</span> FROM DBA_FREE_SPACE GROUP BY tablespace_name<span class="token punctuation">)</span> a, 
  <span class="token punctuation">(</span>SELECT tablespace_name, Sum<span class="token punctuation">(</span>bytes<span class="token punctuation">)</span> total FROM DBA_DATA_FILES GROUP BY tablespace_name<span class="token punctuation">)</span> b 
WHERE a.tablespace_name <span class="token operator">=</span> b.tablespace_name<span class="token punctuation">;</span>


SELECT a.tablespace_name <span class="token string">"表空间名"</span>, 
total <span class="token string">"表空间大小"</span>, 
<span class="token function">free</span> <span class="token string">"表空间剩余大小"</span>, 
<span class="token punctuation">(</span>total - <span class="token function">free</span><span class="token punctuation">)</span> <span class="token string">"表空间使用大小"</span>, 
total / <span class="token punctuation">(</span><span class="token number">1024</span> * <span class="token number">1024</span> * <span class="token number">1024</span><span class="token punctuation">)</span> <span class="token string">"表空间大小(G)"</span>, 
<span class="token function">free</span> / <span class="token punctuation">(</span><span class="token number">1024</span> * <span class="token number">1024</span> * <span class="token number">1024</span><span class="token punctuation">)</span> <span class="token string">"表空间剩余大小(G)"</span>, 
<span class="token punctuation">(</span>total - <span class="token function">free</span><span class="token punctuation">)</span> / <span class="token punctuation">(</span><span class="token number">1024</span> * <span class="token number">1024</span> * <span class="token number">1024</span><span class="token punctuation">)</span> <span class="token string">"表空间使用大小(G)"</span>, 
round<span class="token punctuation">((</span>total - <span class="token function">free</span><span class="token punctuation">)</span> / total, <span class="token number">4</span><span class="token punctuation">)</span> * <span class="token number">100</span> <span class="token string">"使用率 %"</span> 
FROM <span class="token punctuation">(</span>SELECT tablespace_name, SUM<span class="token punctuation">(</span>bytes<span class="token punctuation">)</span> <span class="token function">free</span> 
FROM dba_free_space 
GROUP BY tablespace_name<span class="token punctuation">)</span> a, 
<span class="token punctuation">(</span>SELECT tablespace_name, SUM<span class="token punctuation">(</span>bytes<span class="token punctuation">)</span> total 
FROM dba_data_files 
GROUP BY tablespace_name<span class="token punctuation">)</span> b 
WHERE a.tablespace_name <span class="token operator">=</span> b.tablespace_name
</code></pre> 
<p>增加表空间大小的四种方法<br> Meathod1：给表空间增加数据文件</p> 
<pre><code class="prism language-bash">ALTER TABLESPACE app_data ADD DATAFILE  
<span class="token string">'D:\ORACLE\PRODUCT\10.2.0\ORADATA\EDWTEST\APP03.DBF'</span> SIZE 50M<span class="token punctuation">;</span>
</code></pre> 
<p>Meathod2：新增数据文件，并且允许数据文件自动增</p> 
<pre><code class="prism language-bash">ALTER TABLESPACE srmhdl_data ADD DATAFILE <span class="token string">'/u01/oracle/oradata/srmhdl/srmhdl_data02.dfg'</span> size 64m autoextend on next 64m maxsize unlimited<span class="token punctuation">;</span>
</code></pre> 
<p>如果有多个可以使用如下命令：</p> 
<pre><code class="prism language-bash">alter tablespace venn <span class="token function">add</span> datafile <span class="token string">'/u01/oracle/oradata/srmhdl/srmhdl_data02.dfg'</span>
size 10M
autoextend on next 100M
maxsize 500M,
<span class="token string">'/u01/oracle/oradata/srmhdl/srmhdl_data03.dfg'</span>
size 10M
autoextend on next 100M
maxsize 500M <span class="token punctuation">;</span>
</code></pre> 
<p>Meathod3：允许已存在的数据文件自动增长</p> 
<pre><code class="prism language-bash">ALTER DATABASE DATAFILE <span class="token string">'D:\ORACLE\PRODUCT\10.2.0\ORADATA\EDWTEST\APP03.DBF'</span>  
AUTOEXTEND ON NEXT 5M MAXSIZE 100M<span class="token punctuation">;</span>  
</code></pre> 
<p>Meathod4：手工改变已存在数据文件的大小</p> 
<pre><code class="prism language-bash">ALTER DATABASE DATAFILE <span class="token string">'D:\ORACLE\PRODUCT\10.2.0\ORADATA\EDWTEST\APP02.DBF'</span>  
RESIZE 100M<span class="token punctuation">;</span>  
</code></pre> 
<p>归档空间大小增长：</p> 
<pre><code class="prism language-bash"><span class="token keyword">select</span> * from <span class="token function">v</span><span class="token variable">$recovery_file_dest</span><span class="token punctuation">;</span>
</code></pre> 
<p>删除临时表空间(彻底删除)：</p> 
<pre><code class="prism language-bash">SQL<span class="token operator">&gt;</span> drop tablespace orcl_data including contents and datafiles cascade constraints<span class="token punctuation">;</span>
</code></pre> 
<p>统计表占用空间大小参数:</p> 
<pre><code class="prism language-bash">expdp srmhdl/srm999db@srmhdl <span class="token assign-left variable">schemas</span><span class="token operator">=</span>srmhdl <span class="token assign-left variable">directory</span><span class="token operator">=</span>dir_dump <span class="token assign-left variable">estimate_only</span><span class="token operator">=</span>y <span class="token assign-left variable">estimate</span><span class="token operator">=</span>statistics
</code></pre> 
<p>查询除系统用户外的用户数据库表空间的占用情况：</p> 
<pre><code class="prism language-bash"><span class="token keyword">select</span> *
from <span class="token punctuation">(</span>select owner <span class="token operator">||</span> <span class="token string">'.'</span> <span class="token operator">||</span> tablespace_name name, sum<span class="token punctuation">(</span>b<span class="token punctuation">)</span> g
from <span class="token punctuation">(</span>select owner,
t.segment_name,
t.partition_name,
round<span class="token punctuation">(</span>bytes / <span class="token number">1024</span> / <span class="token number">1024</span> / <span class="token number">1024</span>, <span class="token number">2</span><span class="token punctuation">)</span> b,
tablespace_name
from dba_segments t<span class="token punctuation">)</span>
where owner not <span class="token keyword">in</span>
<span class="token punctuation">(</span><span class="token string">'SYS'</span>, <span class="token string">'OUTLN'</span>, <span class="token string">'SYSTEM'</span>, <span class="token string">'TSMSYS'</span>, <span class="token string">'DBSNMP'</span>, <span class="token string">'WMSYS'</span><span class="token punctuation">)</span>
group by owner <span class="token operator">||</span> <span class="token string">'.'</span> <span class="token operator">||</span> tablespace_name<span class="token punctuation">)</span>
order by name
</code></pre> 
<p>查询除系统用户外的用户数据表空间占用情况</p> 
<pre><code class="prism language-bash"><span class="token keyword">select</span> *
from <span class="token punctuation">(</span>select owner <span class="token operator">||</span> <span class="token string">'.'</span> <span class="token operator">||</span> tablespace_name name, sum<span class="token punctuation">(</span>b<span class="token punctuation">)</span> g
from <span class="token punctuation">(</span>select owner,
t.segment_name,
t.partition_name,
round<span class="token punctuation">(</span>bytes / <span class="token number">1024</span> / <span class="token number">1024</span> / <span class="token number">1024</span>, <span class="token number">2</span><span class="token punctuation">)</span> b,
tablespace_name
from dba_segments t<span class="token punctuation">)</span>
where owner not <span class="token keyword">in</span>
<span class="token punctuation">(</span><span class="token string">'SYS'</span>, <span class="token string">'OUTLN'</span>, <span class="token string">'SYSTEM'</span>, <span class="token string">'TSMSYS'</span>, <span class="token string">'DBSNMP'</span>, <span class="token string">'WMSYS'</span><span class="token punctuation">)</span>
group by owner <span class="token operator">||</span> <span class="token string">'.'</span> <span class="token operator">||</span> tablespace_name<span class="token punctuation">)</span>
order by name
</code></pre> 
<p>查看表数据量大小统计：</p> 
<pre><code class="prism language-bash">Select owner, segment_name,sum<span class="token punctuation">(</span>bytes<span class="token punctuation">)</span> / <span class="token number">1024</span> / <span class="token number">1024</span> / <span class="token number">1024</span> as GB from dba_segments where <span class="token assign-left variable">owner</span><span class="token operator">=</span><span class="token string">'大写'</span> and segment_name like <span class="token string">'TEMP%'</span> Group by owner,segment_name
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5961a6a4174a2d0cf08d8c83125fcdd2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Shell脚本语言-数组</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c603450a9f7bd45664105fac59b724f2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Sublime text 3手把手使用教程（附带配置完成安装包）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>