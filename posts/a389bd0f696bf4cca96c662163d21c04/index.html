<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>图像透视变换应用 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="图像透视变换应用" />
<meta property="og:description" content="简介 透视变换是将成像投影到一个新的视平面，也称作投影映射。投影变换是三维空间上的非线性变换，可看做是仿射变换的更一般形式，简单讲即通过一个3x3的变换矩阵将原图投影到一个新的视平面(Viewing Plane)，在视觉上的直观表现就是产生或消除了远近感。
OpenCV透视变换的透视变换 1、warpPerspective 利用透视矩阵对图像进行透视变换。
说明
OpenCV提供了warpPerspective( )函数来实现图片的透视变换，只需要输入梯形四个顶点的坐标和目标画布四个角的坐标，即可自动完成转换。核心代码只有两行：首先读取两个坐标数组，计算变换矩阵；然后根据变换矩阵对原图进行透视变换，并输出到目标画布。
函数warpPerspective使用指定的矩阵转换源图像：
dst ( x , y ) = src ( M 11 x &#43; M 12 y &#43; M 13 M 31 x &#43; M 32 y &#43; M 33 , M 21 x &#43; M 22 y &#43; M 23 M 31 x &#43; M 32 y &#43; M 33 ) \texttt{dst} (x,y) = \texttt{src} \left ( \frac{M_{11} x &#43; M_{12} y &#43; M_{13}}{M_{31} x &#43; M_{32} y &#43; M_{33}} , \frac{M_{21} x &#43; M_{22} y &#43; M_{23}}{M_{31} x &#43; M_{32} y &#43; M_{33}} \right ) dst(x,y)=src(M31​x&#43;M32​y&#43;M33​M11​x&#43;M12​y&#43;M13​​,M31​x&#43;M32​y&#43;M33​M21​x&#43;M22​y&#43;M23​​)" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/a389bd0f696bf4cca96c662163d21c04/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-11-26T23:27:21+08:00" />
<meta property="article:modified_time" content="2019-11-26T23:27:21+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">图像透视变换应用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h4><a id="font_colorab0_0"></a><font color="#ab0">简介</font></h4> 
<p>透视变换是将成像投影到一个新的视平面，也称作<font color="red">投影映射</font>。投影变换是三维空间上的非线性变换，可看做是仿射变换的更一般形式，简单讲即通过一个3x3的变换矩阵将原图投影到一个新的视平面(Viewing Plane)，在视觉上的直观表现就是产生或消除了远近感。</p> 
<p><img src="https://images2.imgbox.com/d5/af/IXBvzZLw_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="font_colorab0OpenCV_5"></a><font color="#ab0">OpenCV透视变换的透视变换</font></h4> 
<h6><a id="font_color34f_1warpPerspective_6"></a><font color="#34f"> 1、warpPerspective</font></h6> 
<p><strong>利用透视矩阵对图像进行透视变换</strong>。</p> 
<ul><li> <p>说明<br> OpenCV提供了warpPerspective( )函数来实现图片的透视变换，只需要输入梯形四个顶点的坐标和目标画布四个角的坐标，即可自动完成转换。核心代码只有两行：首先读取两个坐标数组，计算变换矩阵；然后根据变换矩阵对原图进行透视变换，并输出到目标画布。</p> 
  <blockquote> 
   <p>函数warpPerspective使用指定的矩阵转换源图像：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
         
          
           
           
             dst 
            
           
             ( 
            
           
             x 
            
           
             , 
            
           
             y 
            
           
             ) 
            
           
             = 
            
           
             src 
            
            
            
              ( 
             
             
              
               
               
                 M 
                
               
                 11 
                
               
              
                x 
               
              
                + 
               
               
               
                 M 
                
               
                 12 
                
               
              
                y 
               
              
                + 
               
               
               
                 M 
                
               
                 13 
                
               
              
              
               
               
                 M 
                
               
                 31 
                
               
              
                x 
               
              
                + 
               
               
               
                 M 
                
               
                 32 
                
               
              
                y 
               
              
                + 
               
               
               
                 M 
                
               
                 33 
                
               
              
             
            
              , 
             
             
              
               
               
                 M 
                
               
                 21 
                
               
              
                x 
               
              
                + 
               
               
               
                 M 
                
               
                 22 
                
               
              
                y 
               
              
                + 
               
               
               
                 M 
                
               
                 23 
                
               
              
              
               
               
                 M 
                
               
                 31 
                
               
              
                x 
               
              
                + 
               
               
               
                 M 
                
               
                 32 
                
               
              
                y 
               
              
                + 
               
               
               
                 M 
                
               
                 33 
                
               
              
             
            
              ) 
             
            
           
          
            \texttt{dst} (x,y) = \texttt{src} \left ( \frac{M_{11} x + M_{12} y + M_{13}}{M_{31} x + M_{32} y + M_{33}} , \frac{M_{21} x + M_{22} y + M_{23}}{M_{31} x + M_{32} y + M_{33}} \right ) 
           
          
        </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord text"><span class="mord texttt">dst</span></span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.40003em; vertical-align: -0.95003em;"></span><span class="mord text"><span class="mord texttt">src</span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.36033em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right: 0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.10903em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.10903em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.10903em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right: 0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.10903em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.10903em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.10903em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.88044em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.36033em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right: 0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.10903em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.10903em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.10903em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right: 0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.10903em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.10903em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.10903em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.88044em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size3">)</span></span></span></span></span></span></span></span><br> 当设置标志WARP_INVERSE_MAP时。否则，首先使用invert反转转换，然后将其放在上面的公式中，而不是M中。</p> 
  </blockquote> </li><li> <p>声明</p> <pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token function">warpPerspective</span><span class="token punctuation">(</span>
		InputArray src<span class="token punctuation">,</span>
		OutputArray dst<span class="token punctuation">,</span>
		InputArray M<span class="token punctuation">,</span>
		Size dsize<span class="token punctuation">,</span>
		<span class="token keyword">int</span> flags<span class="token operator">=</span>INTER_LINEAR<span class="token punctuation">,</span>
		<span class="token keyword">int</span> borderMode<span class="token operator">=</span> BORDER_CONSTANT<span class="token punctuation">,</span>
		<span class="token keyword">const</span> Scalar <span class="token operator">&amp;</span>borderValue<span class="token operator">=</span><span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">)</span>		
</code></pre> </li><li> <p>参数</p> 
  <table><thead><tr><th align="left">src</th><th align="left">输入图像</th></tr></thead><tbody><tr><td align="left">dst</td><td align="left">输出图像，其大小为dsize，并且类型与src相同。</td></tr><tr><td align="left">M</td><td align="left">3×3的转换矩阵。</td></tr><tr><td align="left">dsize</td><td align="left">输出图像的尺寸大小。</td></tr><tr><td align="left">flags</td><td align="left">插值方法(INTER_LINEAR或INTER_NEAREST)与可选标志WARP_INVERSE_MAP的组合，设置M为逆变换（<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
          
           
            
            
              dst 
             
            
              → 
             
            
              src 
             
            
           
             \texttt{dst}\rightarrow\texttt{src} 
            
           
         </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.61111em; vertical-align: 0em;"></span><span class="mord text"><span class="mord texttt">dst</span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord text"><span class="mord texttt">src</span></span></span></span></span></span>）。</td></tr><tr><td align="left">borderMode</td><td align="left">边界补偿方式,BORDER_CONSTANT 或者BORDER_REPLICATE</td></tr><tr><td align="left">borderValue</td><td align="left">边界补偿大小，常值，默认为0。</td></tr></tbody></table></li></ul> 
<p>关于变换矩阵M，OpenCV提供两种方法计算：</p> 
<h6><a id="font_coloradf_11findHomography_40"></a><font color="#adf"> 1.1、findHomography–计算透视矩阵</font></h6> 
<p><strong>通过输入和输出图像中两组点计算透视矩阵</strong>。</p> 
<ul><li> <p>说明<br> 查找两个平面之间的透视转换。<br> 通过变换前、后两个平面的点寻找出一个单应性变换矩阵H:<br> <img src="https://images2.imgbox.com/3d/d5/nl172qdA_o.png" alt="在这里插入图片描述"><br> 使得反投影误差：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             ∑ 
            
           
             i 
            
           
           
            
            
              ( 
             
             
             
               x 
              
             
               i 
              
             
               ′ 
              
             
            
              − 
             
             
              
               
               
                 h 
                
               
                 11 
                
               
               
               
                 x 
                
               
                 i 
                
               
              
                + 
               
               
               
                 h 
                
               
                 12 
                
               
               
               
                 y 
                
               
                 i 
                
               
              
                + 
               
               
               
                 h 
                
               
                 13 
                
               
              
              
               
               
                 h 
                
               
                 31 
                
               
               
               
                 x 
                
               
                 i 
                
               
              
                + 
               
               
               
                 h 
                
               
                 32 
                
               
               
               
                 y 
                
               
                 i 
                
               
              
                + 
               
               
               
                 h 
                
               
                 33 
                
               
              
             
            
              ) 
             
            
           
             2 
            
           
          
            + 
           
           
            
            
              ( 
             
             
             
               y 
              
             
               i 
              
             
               ′ 
              
             
            
              − 
             
             
              
               
               
                 h 
                
               
                 21 
                
               
               
               
                 x 
                
               
                 i 
                
               
              
                + 
               
               
               
                 h 
                
               
                 22 
                
               
               
               
                 y 
                
               
                 i 
                
               
              
                + 
               
               
               
                 h 
                
               
                 23 
                
               
              
              
               
               
                 h 
                
               
                 31 
                
               
               
               
                 x 
                
               
                 i 
                
               
              
                + 
               
               
               
                 h 
                
               
                 32 
                
               
               
               
                 y 
                
               
                 i 
                
               
              
                + 
               
               
               
                 h 
                
               
                 33 
                
               
              
             
            
              ) 
             
            
           
             2 
            
           
          
         
           \sum _i \left ( x'_i- \frac{h_{11} x_i + h_{12} y_i + h_{13}}{h_{31} x_i + h_{32} y_i + h_{33}} \right )^2+ \left ( y'_i- \frac{h_{21} x_i + h_{22} y_i + h_{23}}{h_{31} x_i + h_{32} y_i + h_{33}} \right )^2 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 2.93168em; vertical-align: -1.27767em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05001em;"><span class="" style="top: -1.87233em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.27767em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.801892em;"><span class="" style="top: -2.453em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.37144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.88044em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size3">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 1.65401em;"><span class="" style="top: -3.9029em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 2.60404em; vertical-align: -0.95003em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.801892em;"><span class="" style="top: -2.453em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.37144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.88044em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size3">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 1.65401em;"><span class="" style="top: -3.9029em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></span>被最小化。</p> 
  <blockquote> 
   <p>如果参数方法设置为默认值0，则该函数使用所有点对通过简单的最小二乘方案计算初始单应性估计。<br><br> 但是，如果不是所有的点对（<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            s 
           
          
            r 
           
          
            c 
           
          
            P 
           
          
            o 
           
          
            i 
           
          
            n 
           
          
            t 
           
           
           
             s 
            
           
             i 
            
           
          
         
           srcPoints_i 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">c</span><span class="mord mathdefault" style="margin-right: 0.13889em;">P</span><span class="mord mathdefault">o</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault">t</span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>, <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            d 
           
          
            s 
           
          
            t 
           
          
            P 
           
          
            o 
           
          
            i 
           
          
            n 
           
          
            t 
           
           
           
             s 
            
           
             i 
            
           
          
         
           dstPoints_i 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.84444em; vertical-align: -0.15em;"></span><span class="mord mathdefault">d</span><span class="mord mathdefault">s</span><span class="mord mathdefault">t</span><span class="mord mathdefault" style="margin-right: 0.13889em;">P</span><span class="mord mathdefault">o</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault">t</span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>)都适合严格的透视图转换(也就是说，存在一些异常值)，那么这个初始估计就会很差。在这种情况下，您可以使用三种健壮方法中的一种。RANSAC方法,LMeDS和 RHO尝试许多不同的随机对应点对的子集(四双,共线双被丢弃),估计单应性矩阵使用这个子集和一个简单的最小二乘算法,然后计算计算单应性的质量/善良的数量(这是内围层RANSAC或至少值重新投影误差LMeDS)。然后使用最佳子集生成单应矩阵的初始估计inliers/outliers的掩码。<br><br> 无论采用何种方法，无论是否健壮，都可以使用Levenberg-Marquardt方法进一步精简计算出的单应性矩阵（仅在稳健方法中使用inliers），以进一步降低重投影误差。<br><br> RANSAC和RHO的方法几乎可以处理任何异常值比率，但是需要一个阈值来区分异常值和异常值。LMeDS方法不需要任何阈值，但是只有在有超过50％的内部值时，它才能正确运行。最后，如果没有异常值并且噪声很小，请使用默认方法（method= 0）。</p> 
  </blockquote> </li><li> <p>声明</p> <pre><code class="prism language-cpp">Mat <span class="token function">findHomography</span><span class="token punctuation">(</span> 
     InputArray srcPoints<span class="token punctuation">,</span> 
     InputArray dstPoints<span class="token punctuation">,</span>
     <span class="token keyword">int</span> method <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> 
     <span class="token keyword">double</span> ransacReprojThreshold <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span>
     OutputArray mask<span class="token operator">=</span><span class="token function">noArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
     <span class="token keyword">const</span> <span class="token keyword">int</span> maxIters <span class="token operator">=</span> <span class="token number">2000</span><span class="token punctuation">,</span>
     <span class="token keyword">const</span> <span class="token keyword">double</span> confidence <span class="token operator">=</span> <span class="token number">0.995</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

Mat <span class="token function">findHomography</span><span class="token punctuation">(</span>
    InputArray srcPoints<span class="token punctuation">,</span> 
    InputArray dstPoints<span class="token punctuation">,</span>
    OutputArray mask<span class="token punctuation">,</span> 
    <span class="token keyword">int</span> method <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> 
    <span class="token keyword">double</span> ransacReprojThreshold <span class="token operator">=</span><span class="token number">3</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> </li><li> <p>参数</p> 
  <table><thead><tr><th align="left">srcPoint</th><th align="left">原始平面中点的坐标，其类型为CV_32FC2或vector 的矩阵。</th></tr></thead><tbody><tr><td align="left">dstPoint</td><td align="left">目标平面中点的坐标，类型为CV_32FC2的矩阵或vector 。</td></tr><tr><td align="left">method</td><td align="left">用于计算单应矩阵的方法。</td></tr><tr><td align="left">ransacReprojThreshold</td><td align="left"></td></tr><tr><td align="left">mask</td><td align="left">通过可靠的方法(RANSAC或LMEDS）设置的可选输出掩码。请注意，输入掩码值将被忽略。</td></tr><tr><td align="left">maxIters</td><td align="left">RANSAC的最大迭代次数。</td></tr><tr><td align="left">confidence</td><td align="left">置信度，介于0和1之间。</td></tr></tbody></table> 
  <blockquote> 
   <h6><a id="method_84"></a>method取值</h6> 
   <ul><li>0: 使用所有点的常规方法，即最小二乘法</li><li>RANSAC: 基于RANSAC的鲁棒方法</li><li>LMEDS: 最小中值稳健方法</li><li>RHO: 基于PROSAC稳健的方法</li></ul> 
  </blockquote> </li></ul> 
<h6><a id="font_coloradf_12getPerspectiveTransform_90"></a><font color="#adf"> 1.2、getPerspectiveTransform–根据四对对应点计算透视变换</font></h6> 
<p><strong>通过原图和变换后图像的4个对应点(即对应的四边形)计算出透视变换矩阵。</strong></p> 
<ul><li> <p>说明<br> The function calculates the 3×3 matrix of a perspective transform so that:<br> <img src="https://images2.imgbox.com/4d/fa/ozy2Dnwv_o.png" alt="在这里插入图片描述"></p> </li><li> <p>声明</p> <pre><code class="prism language-cpp">Mat cv<span class="token operator">::</span>getPerspectiveTransform	<span class="token punctuation">(</span>	    
        InputArray 	src<span class="token punctuation">,</span>
		InputArray 	dst<span class="token punctuation">,</span>
		<span class="token keyword">int</span> solveMethod <span class="token operator">=</span> DECOMP_LU 
<span class="token punctuation">)</span>	

Mat cv<span class="token operator">::</span>getPerspectiveTransform	<span class="token punctuation">(</span>	
		<span class="token keyword">const</span> Point2f 	src<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
		<span class="token keyword">const</span> Point2f 	dst<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
		<span class="token keyword">int</span> 	solveMethod <span class="token operator">=</span> DECOMP_LU 
<span class="token punctuation">)</span>			
</code></pre> </li><li> <p>参数</p> 
  <table><thead><tr><th>src</th><th align="left">源图像中四边形顶点的坐标。</th></tr></thead><tbody><tr><td>dst</td><td align="left">目标图像中相应四边形顶点的坐标。</td></tr><tr><td>solveMethod</td><td align="left">传递给cv :: solve（DecompTypes）的方法。</td></tr></tbody></table></li></ul> 
<h6><a id="font_color34f_2perspectiveTransform_119"></a><font color="#34f"> 2、perspectiveTransform–点的透视变换</font></h6> 
<p><strong>利用透视矩阵对点进行透视变换。</strong></p> 
<ul><li> <p>说明<br> 执行向量的透视矩阵转换。</p> <p>函数cv :: perspectiveTransform通过将src的每个元素视为2D或3D向量来对其进行转换，其方式如下：<br> <img src="https://images2.imgbox.com/30/97/Yh0RUlaL_o.png" alt="在这里插入图片描述"><br> 这里显示了3D矢量变换。在2D矢量变换的情况下，将省略z分量。</p> 
  <blockquote> 
   <p>该函数转换2D或3D向量的稀疏集合。如果要使用透视变换来变换图像，请使用warpPerspective。如果存在反问题，也就是说，您想从几对对应点中计算出最可能的透视变换，则可以使用getPerspectiveTransform或findHomography。</p> 
  </blockquote> </li><li> <p>声明</p> <pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token function">perspectiveTransform</span><span class="token punctuation">(</span>	   
    InputArray src<span class="token punctuation">,</span>
    OutputArray dst<span class="token punctuation">,</span>
    InputArray m 
<span class="token punctuation">)</span>	
</code></pre> </li><li> <p>参数</p> 
  <table><thead><tr><th align="left">src</th><th align="left">输入两通道或三通道浮点数组；每个元素都是要转换的2D / 3D向量。</th></tr></thead><tbody><tr><td align="left">dst</td><td align="left">与src具有相同大小和类型的输出数组。</td></tr><tr><td align="left">m</td><td align="left">3x3或4x4浮点转换矩阵。</td></tr></tbody></table></li></ul> 
<h4><a id="font_colorab0_145"></a><font color="#ab0">应用</font></h4> 
<p><font color="#55f">❶简单变换</font></p> 
<pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token function">onMouse</span><span class="token punctuation">(</span><span class="token keyword">int</span> event<span class="token punctuation">,</span> <span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">,</span> <span class="token keyword">int</span> flags<span class="token punctuation">,</span> <span class="token keyword">void</span><span class="token operator">*</span> utsc<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token operator">==</span>EVENT_LBUTTONUP<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token comment">//画出源图像中需要透视到四边形中的4个待转换点</span>
		<span class="token function">circle</span><span class="token punctuation">(</span>src2<span class="token punctuation">,</span> <span class="token function">Point</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"wait"</span><span class="token punctuation">,</span> src2<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//记录原图中待转换的点坐标</span>
		srcTri<span class="token punctuation">[</span>clickTimes<span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">=</span> x<span class="token punctuation">;</span>
		srcTri<span class="token punctuation">[</span>clickTimes<span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">=</span> y<span class="token punctuation">;</span>
		clickTimes<span class="token operator">++</span><span class="token punctuation">;</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"The"</span> <span class="token operator">&lt;&lt;</span> clickTimes <span class="token operator">&lt;&lt;</span> <span class="token string">" point: [ "</span> <span class="token operator">&lt;&lt;</span> srcTri<span class="token punctuation">[</span>clickTimes <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">&lt;&lt;</span> <span class="token string">","</span> <span class="token operator">&lt;&lt;</span> srcTri<span class="token punctuation">[</span>clickTimes <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">&lt;&lt;</span> <span class="token string">"]"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>clickTimes <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

		<span class="token comment">//将原图像中的四个点转换到目的图形的对应四个点上</span>
		<span class="token comment">//第一个点——左上角</span>
		dstTri<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		dstTri<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token comment">//第二个点——右上角</span>
		dstTri<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">480</span><span class="token punctuation">;</span>
		dstTri<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token comment">//第三个点——右下角</span>
		dstTri<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">480</span><span class="token punctuation">;</span>
		dstTri<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">600</span><span class="token punctuation">;</span>
		<span class="token comment">//第四个点——左下角</span>
		dstTri<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		dstTri<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">600</span><span class="token punctuation">;</span>

		<span class="token comment">//通过原图像和目标图像中4个对应点求出透视矩阵</span>
		Mat m <span class="token operator">=</span> <span class="token function">findHomography</span><span class="token punctuation">(</span>srcTri<span class="token punctuation">,</span> dstTri<span class="token punctuation">,</span> RANSAC<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">warpPerspective</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> dst<span class="token punctuation">,</span> m<span class="token punctuation">,</span> <span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">480</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"dst"</span><span class="token punctuation">,</span> dst<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	src <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"D:/test/m.png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	src2 <span class="token operator">=</span> src<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"src"</span><span class="token punctuation">,</span> WINDOW_AUTOSIZE<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"src"</span><span class="token punctuation">,</span> src2<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">setMouseCallback</span><span class="token punctuation">(</span><span class="token string">"src"</span><span class="token punctuation">,</span> onMouse<span class="token punctuation">)</span><span class="token punctuation">;</span>


	<span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


</code></pre> 
<p><img src="https://images2.imgbox.com/65/20/wsgkazM6_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/0d/8b/m4H5FN4j_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/b3/68/qZEn9mnk_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/de/19/fw9UEjxa_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>注意：需要注意透视变换中点与点的对应顺序，应该<mark>顺时针</mark>方向进行点的转换。</p> 
</blockquote> 
<p><font color="#55f">❷复杂的透视变换</font><br> 可以结合第一个应用的方式，使用点击事件进行获取需要在目标图片上转换的具体坐标。</p> 
<pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token function">warpPerspectiveTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//1 读取广告图</span>
	Mat src <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"D:/test/src.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"src"</span><span class="token punctuation">,</span> src<span class="token punctuation">)</span><span class="token punctuation">;</span>
   
    <span class="token comment">//2 读取广告牌背景图</span>
	Mat bg <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"D:/test/bg.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Mat bg_temp <span class="token operator">=</span> bg<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"bg"</span><span class="token punctuation">,</span> bg<span class="token punctuation">)</span><span class="token punctuation">;</span>

	
	<span class="token comment">//3 透视变换4对坐标确定</span>
	vector<span class="token operator">&lt;</span>Point2f<span class="token operator">&gt;</span> <span class="token function">srcTri</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">dstTri</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//3.1 源图的四个坐标</span>
	srcTri<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	srcTri<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	srcTri<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">=</span> src<span class="token punctuation">.</span>cols<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	srcTri<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	srcTri<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">=</span> src<span class="token punctuation">.</span>cols<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	srcTri<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">=</span> src<span class="token punctuation">.</span>rows<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	srcTri<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	srcTri<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">=</span> src<span class="token punctuation">.</span>rows<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>

	<span class="token comment">//3.2 目标图片的四个坐标</span>
	<span class="token comment">//用画图工具测试的4个点的像素坐标</span>
	dstTri<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">218</span><span class="token punctuation">;</span>
	dstTri<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">31</span><span class="token punctuation">;</span>
	dstTri<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">392</span><span class="token punctuation">;</span>
	dstTri<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">182</span><span class="token punctuation">;</span>
	dstTri<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">399</span><span class="token punctuation">;</span>
	dstTri<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">258</span><span class="token punctuation">;</span>
	dstTri<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">218</span><span class="token punctuation">;</span>
	dstTri<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">194</span><span class="token punctuation">;</span>
	

	<span class="token comment">//4 求出透视变换的矩阵</span>
	<span class="token comment">//Mat m=getPerspectiveTransform(srcTri, dstTri);</span>
	Mat m <span class="token operator">=</span> <span class="token function">findHomography</span><span class="token punctuation">(</span>srcTri<span class="token punctuation">,</span> dstTri<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//5 进行透视变换</span>
	<span class="token function">warpPerspective</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> bg_temp<span class="token punctuation">,</span> m<span class="token punctuation">,</span> bg<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"bg_temp"</span><span class="token punctuation">,</span> bg_temp<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//fillConvexPoly(InputOutputArray img, const Point * pts, int npts,</span>
	<span class="token comment">//	const Scalar &amp; color, int lineType = LINE_8,</span>
	<span class="token comment">//	int shift = 0);</span>
	Point pt<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		pt<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> dstTri<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//6 在目标图像中去除多边形区域，并合并</span>
	<span class="token function">fillConvexPoly</span><span class="token punctuation">(</span>bg<span class="token punctuation">,</span> pt<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span><span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Mat dst<span class="token punctuation">;</span>
	<span class="token function">add</span><span class="token punctuation">(</span>bg<span class="token punctuation">,</span>bg_temp <span class="token punctuation">,</span> dst<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"dst"</span><span class="token punctuation">,</span> dst<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/01/96/aM5ROeH2_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/ce/3f/tL1558iN_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/b3/0a/oOpedu3c_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/c5/2c/RlOSD5gK_o.png" alt="在这里插入图片描述"><br> <font color="#55f">❸自动检测源映射坐标</font><br> 上面都是手动或者自己输入的变换源坐标，下面让计算机自己检测需要的4个坐标。<br> 步骤：</p> 
<ol><li>图片预处理<br> 1.1 灰度<br> 1.2 二值化分割<br> 1.3 去噪声<br> 1.4 闭操作</li><li>寻找轮廓</li><li>霍夫直线检测</li><li>定位边沿轮廓直线</li><li>直线方程</li><li>直线交点</li><li>透视矩阵</li><li>透视变换</li></ol> 
<pre><code class="prism language-cpp"><span class="token keyword">void</span>  <span class="token function">warpPerspectiveTest2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
   Mat src <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"D:/test/kak.png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"src"</span><span class="token punctuation">,</span> src<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">//1. 图片预处理</span>
   <span class="token comment">//1.1 灰度化</span>
   Mat gray_src<span class="token punctuation">;</span>
   <span class="token function">cvtColor</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> gray_src<span class="token punctuation">,</span> COLOR_BGR2GRAY<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">//1.2 去噪声</span>
   <span class="token function">blur</span><span class="token punctuation">(</span>gray_src<span class="token punctuation">,</span> gray_src<span class="token punctuation">,</span> <span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment">//1.3 二值化</span>
   Mat binary_src<span class="token punctuation">;</span>
   <span class="token function">threshold</span><span class="token punctuation">(</span>gray_src<span class="token punctuation">,</span> binary_src<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> THRESH_BINARY_INV<span class="token operator">|</span>THRESH_OTSU<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"binary_src"</span><span class="token punctuation">,</span> binary_src<span class="token punctuation">)</span><span class="token punctuation">;</span>


   <span class="token comment">//1.4 闭操作</span>
   Mat closed_src<span class="token punctuation">;</span>
   Mat kernel <span class="token operator">=</span> <span class="token function">getStructuringElement</span><span class="token punctuation">(</span>MORPH_RECT<span class="token punctuation">,</span> <span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">morphologyEx</span><span class="token punctuation">(</span>binary_src<span class="token punctuation">,</span> closed_src<span class="token punctuation">,</span> MORPH_CLOSE<span class="token punctuation">,</span>kernel <span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"closed_src"</span><span class="token punctuation">,</span> closed_src<span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment">//2. 寻找轮廓</span>
   vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span>Point<span class="token operator">&gt;&gt;</span> contours<span class="token punctuation">;</span>
   Mat draw <span class="token operator">=</span> Mat<span class="token operator">::</span><span class="token function">zeros</span><span class="token punctuation">(</span>src<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> src<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">//注意寻找轮廓的方法，只寻找最外围的轮廓</span>
   <span class="token function">findContours</span><span class="token punctuation">(</span>closed_src<span class="token punctuation">,</span> contours<span class="token punctuation">,</span> RETR_EXTERNAL<span class="token punctuation">,</span> CHAIN_APPROX_SIMPLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">//2.1 遍历每一个轮廓</span>
   <span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> contours<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
   <span class="token punctuation">{<!-- --></span>
   	Rect rect <span class="token operator">=</span> <span class="token function">boundingRect</span><span class="token punctuation">(</span>contours<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   	<span class="token keyword">if</span> <span class="token punctuation">(</span>rect<span class="token punctuation">.</span>width <span class="token operator">&lt;</span> src<span class="token punctuation">.</span>cols <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> rect<span class="token punctuation">.</span>height <span class="token operator">&lt;</span> src<span class="token punctuation">.</span>rows <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>
   		<span class="token keyword">continue</span><span class="token punctuation">;</span>
   	<span class="token comment">//2.2 画出筛选后的轮廓</span>
   	<span class="token function">drawContours</span><span class="token punctuation">(</span>draw<span class="token punctuation">,</span> contours<span class="token punctuation">,</span> i<span class="token punctuation">,</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"draw"</span><span class="token punctuation">,</span> draw<span class="token punctuation">)</span><span class="token punctuation">;</span>
   
   <span class="token comment">//3. 霍夫直线检测--为了匹配四个边</span>
   vector<span class="token operator">&lt;</span>Vec4i<span class="token operator">&gt;</span> lines<span class="token punctuation">;</span>
   <span class="token function">cvtColor</span><span class="token punctuation">(</span>draw<span class="token punctuation">,</span> draw<span class="token punctuation">,</span> COLOR_BGR2GRAY<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">//Each line is represented by a 4-element vector，(x1, y1, x2, y2), where (x1,y1)and(x2, y2)are the ending points of each detected</span>
   <span class="token comment">//3.1 找出所有的直线</span>
   <span class="token function">HoughLinesP</span><span class="token punctuation">(</span>draw<span class="token punctuation">,</span> lines<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> CV_PI <span class="token operator">/</span> <span class="token number">180</span><span class="token punctuation">,</span> src<span class="token punctuation">.</span>rows <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> src<span class="token punctuation">.</span>rows <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   Mat draw2 <span class="token operator">=</span> Mat<span class="token operator">::</span><span class="token function">zeros</span><span class="token punctuation">(</span>src<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> src<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> lines<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
   	Vec4i ln <span class="token operator">=</span> lines<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
   	<span class="token comment">//3.2 画出所有的直线</span>
   	<span class="token function">line</span><span class="token punctuation">(</span>draw2<span class="token punctuation">,</span> <span class="token function">Point</span><span class="token punctuation">(</span>ln<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> ln<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Point</span><span class="token punctuation">(</span>ln<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> ln<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   cout <span class="token operator">&lt;&lt;</span> <span class="token string">"lines.size="</span> <span class="token operator">&lt;&lt;</span> lines<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
   <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"draw2"</span><span class="token punctuation">,</span> draw2<span class="token punctuation">)</span><span class="token punctuation">;</span>
   
   <span class="token comment">//4. 定位边沿轮廓直线</span>
   Vec4i topLine<span class="token punctuation">,</span> bottomLine<span class="token punctuation">,</span> leftLine<span class="token punctuation">,</span> rightLine<span class="token punctuation">;</span>
   <span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> lines<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
   <span class="token punctuation">{<!-- --></span>
   	Vec4i ln <span class="token operator">=</span> lines<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
   	<span class="token comment">//4.1找最左侧的直线，确定左侧直线的两个点的横坐标在图像中心的左侧区域</span>
   	<span class="token keyword">if</span> <span class="token punctuation">(</span>ln<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> src<span class="token punctuation">.</span>cols <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> ln<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> src<span class="token punctuation">.</span>cols <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
   		leftLine <span class="token operator">=</span> ln<span class="token punctuation">;</span>
   	<span class="token punctuation">}</span>
   	<span class="token comment">//4.2找顶部的直线，确定顶部直线的两个点的纵坐标在图像中心的上方区域内</span>
   	<span class="token keyword">if</span> <span class="token punctuation">(</span>ln<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> src<span class="token punctuation">.</span>rows <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> ln<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> src<span class="token punctuation">.</span>rows <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
   		topLine <span class="token operator">=</span> ln<span class="token punctuation">;</span>
   	<span class="token punctuation">}</span>
   	<span class="token comment">//4.3找最右侧的直线，确定右侧直线的两个点的横坐标在图像中心的右侧区域</span>
   	<span class="token keyword">if</span> <span class="token punctuation">(</span>ln<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> src<span class="token punctuation">.</span>cols <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> ln<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> src<span class="token punctuation">.</span>cols <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
   		rightLine <span class="token operator">=</span> ln<span class="token punctuation">;</span>
   	<span class="token punctuation">}</span>
   	<span class="token comment">//4.4找底部的直线，确定底部直线的两个点的纵坐标在图像中心的下方区域内</span>
   	<span class="token keyword">if</span> <span class="token punctuation">(</span>ln<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> src<span class="token punctuation">.</span>rows <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> ln<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> src<span class="token punctuation">.</span>rows <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
   		bottomLine <span class="token operator">=</span> ln<span class="token punctuation">;</span>
   	<span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   cout <span class="token operator">&lt;&lt;</span> <span class="token string">"leftLine:p1(x,y)="</span> <span class="token operator">&lt;&lt;</span> leftLine<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token string">","</span> <span class="token operator">&lt;&lt;</span> leftLine<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"  "</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"p2(x,y)="</span> <span class="token operator">&lt;&lt;</span> leftLine<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token string">","</span> <span class="token operator">&lt;&lt;</span> leftLine<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
   cout <span class="token operator">&lt;&lt;</span> <span class="token string">"topLine:p1(x,y)="</span> <span class="token operator">&lt;&lt;</span> topLine<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token string">","</span> <span class="token operator">&lt;&lt;</span> topLine<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"  "</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"p2(x,y)="</span> <span class="token operator">&lt;&lt;</span> topLine<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token string">","</span> <span class="token operator">&lt;&lt;</span> topLine<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
   cout <span class="token operator">&lt;&lt;</span> <span class="token string">"rightLine:p1(x,y)="</span> <span class="token operator">&lt;&lt;</span> rightLine<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token string">","</span> <span class="token operator">&lt;&lt;</span> rightLine<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"  "</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"p2(x,y)="</span> <span class="token operator">&lt;&lt;</span> rightLine<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token string">","</span> <span class="token operator">&lt;&lt;</span> rightLine<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
   cout <span class="token operator">&lt;&lt;</span> <span class="token string">"bottomLine:p1(x,y)="</span> <span class="token operator">&lt;&lt;</span> bottomLine<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token string">","</span> <span class="token operator">&lt;&lt;</span> bottomLine<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"  "</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"p2(x,y)="</span> <span class="token operator">&lt;&lt;</span> bottomLine<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token string">","</span> <span class="token operator">&lt;&lt;</span> bottomLine<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
   
   <span class="token comment">//5. 直线方程</span>
   <span class="token comment">//5.1求出左侧直线的方程 y=kx+b:  k=(y2-y1)/(x2-x1)  b=y-kx </span>
   <span class="token keyword">double</span> kl <span class="token operator">=</span> <span class="token keyword">double</span><span class="token punctuation">(</span>leftLine<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">-</span> leftLine<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword">double</span><span class="token punctuation">(</span>leftLine<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">-</span> leftLine<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">double</span> bl <span class="token operator">=</span> <span class="token keyword">double</span><span class="token punctuation">(</span>leftLine<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> kl <span class="token operator">*</span> leftLine<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">//5.2求出顶侧直线的方程 </span>
   <span class="token keyword">double</span> kt <span class="token operator">=</span> <span class="token keyword">double</span><span class="token punctuation">(</span>topLine<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">-</span> topLine<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword">double</span><span class="token punctuation">(</span>topLine<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">-</span> topLine<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">double</span> bt <span class="token operator">=</span> <span class="token keyword">double</span><span class="token punctuation">(</span>topLine<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> kt <span class="token operator">*</span> topLine<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">//5.3求出右侧直线的方程 </span>
   <span class="token keyword">double</span> kr <span class="token operator">=</span> <span class="token keyword">double</span><span class="token punctuation">(</span>rightLine<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">-</span> rightLine<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword">double</span><span class="token punctuation">(</span>rightLine<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">-</span> rightLine<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">double</span> br <span class="token operator">=</span> <span class="token keyword">double</span><span class="token punctuation">(</span>rightLine<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> kr <span class="token operator">*</span> rightLine<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">//5.4求出底部直线的方程  </span>
   <span class="token keyword">double</span> kb <span class="token operator">=</span> <span class="token keyword">double</span><span class="token punctuation">(</span>bottomLine<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">-</span> bottomLine<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword">double</span><span class="token punctuation">(</span>bottomLine<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">-</span> bottomLine<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">double</span> bb <span class="token operator">=</span> <span class="token keyword">double</span><span class="token punctuation">(</span>bottomLine<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> kb <span class="token operator">*</span> bottomLine<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment">//6. 直线交点</span>
   Point p1<span class="token punctuation">,</span> p2<span class="token punctuation">,</span> p3<span class="token punctuation">,</span> p4<span class="token punctuation">;</span>
   <span class="token comment">//6.1左侧直线和顶部直线的交点: x=(b2-b1)/(k1-k2)  y=k1*x+b1</span>
   p1<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>bt <span class="token operator">-</span> bl<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>kl <span class="token operator">-</span> kt<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   p1<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">(</span>kl <span class="token operator">*</span> p1<span class="token punctuation">.</span>x <span class="token operator">+</span> bl<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">//6.2顶部直线和右侧直线的交点</span>
   p2<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>br <span class="token operator">-</span> bt<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>kt <span class="token operator">-</span> kr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   p2<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">(</span>kt <span class="token operator">*</span> p2<span class="token punctuation">.</span>x <span class="token operator">+</span> bt<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">//6.3右侧直线和底部直线的交点</span>
   p3<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>bb <span class="token operator">-</span> br<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>kr <span class="token operator">-</span> kb<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   p3<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">(</span>kr <span class="token operator">*</span> p3<span class="token punctuation">.</span>x <span class="token operator">+</span> br<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">//6.4底部直线和左侧直线的交点</span>
   p4<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>bl <span class="token operator">-</span> bb<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>kb <span class="token operator">-</span> kl<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   p4<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">(</span>kb <span class="token operator">*</span> p4<span class="token punctuation">.</span>x <span class="token operator">+</span> bb<span class="token punctuation">)</span><span class="token punctuation">;</span>
   cout <span class="token operator">&lt;&lt;</span> <span class="token string">"左上角：["</span> <span class="token operator">&lt;&lt;</span> p1<span class="token punctuation">.</span>x <span class="token operator">&lt;&lt;</span> <span class="token string">","</span> <span class="token operator">&lt;&lt;</span> p1<span class="token punctuation">.</span>y <span class="token operator">&lt;&lt;</span><span class="token string">"]"</span><span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
   cout <span class="token operator">&lt;&lt;</span> <span class="token string">"右上角：["</span> <span class="token operator">&lt;&lt;</span> p2<span class="token punctuation">.</span>x <span class="token operator">&lt;&lt;</span> <span class="token string">","</span> <span class="token operator">&lt;&lt;</span> p2<span class="token punctuation">.</span>y <span class="token operator">&lt;&lt;</span><span class="token string">"]"</span><span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
   cout <span class="token operator">&lt;&lt;</span> <span class="token string">"右下角：["</span> <span class="token operator">&lt;&lt;</span> p3<span class="token punctuation">.</span>x <span class="token operator">&lt;&lt;</span> <span class="token string">","</span> <span class="token operator">&lt;&lt;</span> p3<span class="token punctuation">.</span>y <span class="token operator">&lt;&lt;</span><span class="token string">"]"</span><span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
   cout <span class="token operator">&lt;&lt;</span> <span class="token string">"左下角：["</span> <span class="token operator">&lt;&lt;</span> p4<span class="token punctuation">.</span>x <span class="token operator">&lt;&lt;</span> <span class="token string">","</span> <span class="token operator">&lt;&lt;</span> p4<span class="token punctuation">.</span>y <span class="token operator">&lt;&lt;</span><span class="token string">"]"</span><span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
   <span class="token comment">//6.5画出交点</span>
   <span class="token function">circle</span><span class="token punctuation">(</span>draw2<span class="token punctuation">,</span> p1<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">circle</span><span class="token punctuation">(</span>draw2<span class="token punctuation">,</span> p2<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">circle</span><span class="token punctuation">(</span>draw2<span class="token punctuation">,</span> p3<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">circle</span><span class="token punctuation">(</span>draw2<span class="token punctuation">,</span> p4<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"draw2-point"</span><span class="token punctuation">,</span> draw2<span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment">//7. 透视矩阵  </span>
   <span class="token comment">//将检测出来的4个点变换到新的对应的4个点坐标</span>
   <span class="token comment">//7.1源图像的四个待映射的点</span>
   vector<span class="token operator">&lt;</span>Point2f<span class="token operator">&gt;</span> <span class="token function">srcTri</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   srcTri<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> p1<span class="token punctuation">;</span>
   srcTri<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> p2<span class="token punctuation">;</span>
   srcTri<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> p3<span class="token punctuation">;</span>
   srcTri<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> p4<span class="token punctuation">;</span>
   <span class="token comment">//7.2目标图像中相对应的点</span>
   vector<span class="token operator">&lt;</span>Point2f<span class="token operator">&gt;</span> <span class="token function">dstTri</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   dstTri<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">Point</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   dstTri<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">Point</span><span class="token punctuation">(</span>src<span class="token punctuation">.</span>cols<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   dstTri<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">Point</span><span class="token punctuation">(</span>src<span class="token punctuation">.</span>cols<span class="token punctuation">,</span> src<span class="token punctuation">.</span>rows<span class="token punctuation">)</span><span class="token punctuation">;</span>
   dstTri<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">Point</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> src<span class="token punctuation">.</span>rows<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">//7.3获取透视变换的矩阵</span>
   Mat m_FindH<span class="token operator">=</span><span class="token function">findHomography</span><span class="token punctuation">(</span>srcTri<span class="token punctuation">,</span> dstTri<span class="token punctuation">)</span><span class="token punctuation">;</span>
   Mat m_getPT<span class="token operator">=</span><span class="token function">getPerspectiveTransform</span><span class="token punctuation">(</span>srcTri<span class="token punctuation">,</span> dstTri<span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment">//8 透视变换</span>
   Mat dst_findH <span class="token operator">=</span> Mat<span class="token operator">::</span><span class="token function">zeros</span><span class="token punctuation">(</span>src<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> src<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   Mat dst_getPT <span class="token operator">=</span> Mat<span class="token operator">::</span><span class="token function">zeros</span><span class="token punctuation">(</span>src<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> src<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">warpPerspective</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> dst_findH<span class="token punctuation">,</span> m_FindH<span class="token punctuation">,</span> src<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">warpPerspective</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> dst_getPT<span class="token punctuation">,</span> m_FindH<span class="token punctuation">,</span> src<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"dst_findH"</span><span class="token punctuation">,</span> dst_findH<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"dst_getPT"</span><span class="token punctuation">,</span> dst_getPT<span class="token punctuation">)</span><span class="token punctuation">;</span>
   
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/12/53/7BwTNJTp_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/98/68/PdKSz9GL_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/be/e3/VowdExgg_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/12/c0/nv8rAhjh_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/34/33/PJx7qeJZ_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/79/ed/vmaqnu9D_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/35/58/R5vvxIX9_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/f7/74/TneNKs0x_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/fc/68/1OOrBT2e_o.png" alt="在这里插入图片描述"></p> 
<p>学习：<br> <a href="https://blog.csdn.net/rrrfff/article/details/77340641">【OpenCV3.3】通过透视变换矫正变形图像</a></p> 
<p><a href="https://blog.csdn.net/liuphahaha/article/details/50719275">Opencv日常之Homography</a></p> 
<p><a href="https://blog.csdn.net/xiaowei_cqu/article/details/26478135">【OpenCV】透视变换 Perspective Transformation（续）</a></p> 
<p><a href="https://blog.csdn.net/xiaowei_cqu/article/details/26471527">【图像处理】透视变换 Perspective Transformation</a></p> 
<p><a href="https://blog.csdn.net/cuixing001/article/details/80261189">图像透视变换原理及实现</a></p> 
<p><a href="https://blog.csdn.net/ViatorSun/article/details/88963665">详解 OpenCV 透视变换原理 及 实例</a></p> 
<p><a href="https://blog.csdn.net/xiaowei_cqu/article/details/26471527">【图像处理】透视变换 Perspective Transformation</a></p> 
<p><a href="https://blog.csdn.net/qq_24946843/article/details/82772654">opencv学习笔记五十：透视变换综合实例</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3bd6fc83b619a986a36f72434667633e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">CS224n_2019_Assignment1: Exploring Word Vectors Coding Solution</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e2b214340d1eada6f69c77c31666f3a9/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【沃趣科技】MySQL高可用工具Orchestrator系列四：拓扑恢复</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>