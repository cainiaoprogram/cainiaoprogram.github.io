<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android自定义示波器如何绘制高采样率图片 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Android自定义示波器如何绘制高采样率图片" />
<meta property="og:description" content="Android自定义示波器如何绘制高采样率图片 Android中自定义示波器通过展示高采样率的数据（数据来源串口）
前言 特以此博客记录高采样率波形绘制中遇到的坑，首先Android帧率以及刷新率相关的概念可以自行百度，博主遇到的情况是串口采样率255的情况下，在使用串口数据会出现波形图绘制卡顿，有严重延时，开始一直怀疑是示波器的问题换了N种实现方式还是卡顿，直到最后才找到原因，是串口数据读取的性能瓶颈，读取串口缓冲区数据频率过快会造成比较严重的数据延时
自定义的示波器 /** *该示波器满足的需求为X轴向绘制1000点 *Y轴向绘制1500点 *同时绘制五路波形数据 *具体绘制点数可以根据自己需求配置TOTLE_X 与TOTLE_Y轴字段 */ public class LineChartSurfaceFourView extends SurfaceView implements SurfaceHolder.Callback { private static final String TAG = &#34;LineChartSurfaceView&#34;; private static final float TOTLE_X = 1000;//X轴描点数 private static final float TOTLE_Y = 1500;//Y轴描点数 private float totalWidth = 800;//默认宽度 private float totalHeight = 190;//默认高度 private float xValue = totalWidth / TOTLE_X;//X缩放比 private float yValue;//Y缩放比 private float density = getResources().getDisplayMetrics().density;//屏幕分辨率 private int mSpaceHeight = 10;//间隔线高度 private int oneHeight;//单个示波器高度 private boolean isCreate = false;//view是否创建 private static DataFilter dataFilter1 = new DataFilter();//滤波器，不需要滤波器可以直接去掉 private static DataFilter dataFilter2 = new DataFilter();//滤波器 private static DataFilter dataFilter3 = new DataFilter();//滤波器 private static DataFilter dataFilter4 = new DataFilter();//滤波器 private static DataFilter dataFilter5 = new DataFilter();//滤波器 /** * 曲线画笔 */ private Paint linePaint; /** * 矩形画笔 */ private Paint rectPaint; /** * 路径数据 */ private List&lt;PointF&gt; line1Data = Collections." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/cb8b8cc641800ffaa0e9a5753346ed6f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-11-29T17:45:22+08:00" />
<meta property="article:modified_time" content="2018-11-29T17:45:22+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android自定义示波器如何绘制高采样率图片</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="Android_0"></a>Android自定义示波器如何绘制高采样率图片</h2> 
<p>Android中自定义示波器通过展示高采样率的数据（数据来源串口）</p> 
<h3><a id="_4"></a>前言</h3> 
<p>特以此博客记录高采样率波形绘制中遇到的坑，首先Android帧率以及刷新率相关的概念可以自行百度，博主遇到的情况是串口采样率255的情况下，在使用串口数据会出现波形图绘制卡顿，有严重延时，开始一直怀疑是示波器的问题换了N种实现方式还是卡顿，直到最后才找到原因，是串口数据读取的性能瓶颈，读取串口缓冲区数据频率过快会造成比较严重的数据延时</p> 
<h3><a id="_8"></a>自定义的示波器</h3> 
<pre><code class="prism language-javascript"><span class="token comment">/**
 *该示波器满足的需求为X轴向绘制1000点
 *Y轴向绘制1500点
 *同时绘制五路波形数据
 *具体绘制点数可以根据自己需求配置TOTLE_X 与TOTLE_Y轴字段
 */</span>
 <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LineChartSurfaceFourView</span> <span class="token keyword">extends</span> <span class="token class-name">SurfaceView</span> <span class="token keyword">implements</span> <span class="token class-name">SurfaceHolder<span class="token punctuation">.</span>Callback</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> final String <span class="token constant">TAG</span> <span class="token operator">=</span> <span class="token string">"LineChartSurfaceView"</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> final float <span class="token constant">TOTLE_X</span> <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span><span class="token comment">//X轴描点数</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> final float <span class="token constant">TOTLE_Y</span> <span class="token operator">=</span> <span class="token number">1500</span><span class="token punctuation">;</span><span class="token comment">//Y轴描点数</span>

    <span class="token keyword">private</span> float totalWidth <span class="token operator">=</span> <span class="token number">800</span><span class="token punctuation">;</span><span class="token comment">//默认宽度</span>
    <span class="token keyword">private</span> float totalHeight <span class="token operator">=</span> <span class="token number">190</span><span class="token punctuation">;</span><span class="token comment">//默认高度</span>
    <span class="token keyword">private</span> float xValue <span class="token operator">=</span> totalWidth <span class="token operator">/</span> <span class="token constant">TOTLE_X</span><span class="token punctuation">;</span><span class="token comment">//X缩放比</span>
    <span class="token keyword">private</span> float yValue<span class="token punctuation">;</span><span class="token comment">//Y缩放比</span>
    <span class="token keyword">private</span> float density <span class="token operator">=</span> <span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDisplayMetrics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>density<span class="token punctuation">;</span><span class="token comment">//屏幕分辨率</span>
    <span class="token keyword">private</span> int mSpaceHeight <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token comment">//间隔线高度</span>
    <span class="token keyword">private</span> int oneHeight<span class="token punctuation">;</span><span class="token comment">//单个示波器高度</span>
    <span class="token keyword">private</span> boolean isCreate <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token comment">//view是否创建</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> DataFilter dataFilter1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//滤波器，不需要滤波器可以直接去掉</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> DataFilter dataFilter2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//滤波器</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> DataFilter dataFilter3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//滤波器</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> DataFilter dataFilter4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//滤波器</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> DataFilter dataFilter5 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//滤波器</span>
    <span class="token comment">/**
     * 曲线画笔
     */</span>
    <span class="token keyword">private</span> Paint linePaint<span class="token punctuation">;</span>
    <span class="token comment">/**
     * 矩形画笔
     */</span>
    <span class="token keyword">private</span> Paint rectPaint<span class="token punctuation">;</span>
    <span class="token comment">/**
     * 路径数据
     */</span>
    <span class="token keyword">private</span> List<span class="token operator">&lt;</span>PointF<span class="token operator">&gt;</span> line1Data <span class="token operator">=</span> Collections<span class="token punctuation">.</span><span class="token function">synchronizedList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//示波器1数据源</span>
    <span class="token keyword">private</span> List<span class="token operator">&lt;</span>PointF<span class="token operator">&gt;</span> line2Data <span class="token operator">=</span> Collections<span class="token punctuation">.</span><span class="token function">synchronizedList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//示波器2数据源</span>
    <span class="token keyword">private</span> List<span class="token operator">&lt;</span>PointF<span class="token operator">&gt;</span> line3Data <span class="token operator">=</span> Collections<span class="token punctuation">.</span><span class="token function">synchronizedList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//示波器3数据源</span>
    <span class="token keyword">private</span> List<span class="token operator">&lt;</span>PointF<span class="token operator">&gt;</span> line4Data <span class="token operator">=</span> Collections<span class="token punctuation">.</span><span class="token function">synchronizedList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//示波器4数据源</span>
    <span class="token keyword">private</span> List<span class="token operator">&lt;</span>PointF<span class="token operator">&gt;</span> line5Data <span class="token operator">=</span> Collections<span class="token punctuation">.</span><span class="token function">synchronizedList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//示波器5数据源</span>

    <span class="token comment">/**
     * 构造函数
     *
     * @param context 上下文对象
     */</span>
    <span class="token keyword">public</span> <span class="token function">LineChartSurfaceFourView</span><span class="token punctuation">(</span><span class="token parameter">Context context</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Instantiates a new Line chart surface four view.
     *
     * @param context the context
     * @param attrs   the attrs
     */</span>
    <span class="token keyword">public</span> <span class="token function">LineChartSurfaceFourView</span><span class="token punctuation">(</span><span class="token parameter">Context context<span class="token punctuation">,</span> AttributeSet attrs</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">initView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataFilter1<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataFilter2<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataFilter3<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataFilter4<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataFilter5<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> Rect rect1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Rect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//矩形绘制数据</span>
    <span class="token keyword">private</span> Rect rect2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Rect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//矩形绘制数据</span>
    <span class="token keyword">private</span> Rect rect3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Rect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//矩形绘制数据</span>
    <span class="token keyword">private</span> Rect rect4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Rect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//矩形绘制数据</span>
    <span class="token keyword">private</span> Rect rect5 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Rect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//矩形绘制数据</span>


    <span class="token comment">/**
     * 自定义初始化View
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initView</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 曲线画笔</span>
        linePaint <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Paint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        linePaint<span class="token punctuation">.</span><span class="token function">setStrokeWidth</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        linePaint<span class="token punctuation">.</span><span class="token function">setStyle</span><span class="token punctuation">(</span>Style<span class="token punctuation">.</span><span class="token constant">STROKE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        linePaint<span class="token punctuation">.</span><span class="token function">setAntiAlias</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rectPaint <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Paint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rectPaint<span class="token punctuation">.</span><span class="token function">setStrokeWidth</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rectPaint<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getColor</span><span class="token punctuation">(</span><span class="token constant">R</span><span class="token punctuation">.</span>color<span class="token punctuation">.</span>common_black<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rectPaint<span class="token punctuation">.</span><span class="token function">setStyle</span><span class="token punctuation">(</span>Style<span class="token punctuation">.</span><span class="token constant">STROKE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rectPaint<span class="token punctuation">.</span><span class="token function">setAntiAlias</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">getHolder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addCallback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * The Surface Create callback.
     */</span>
    SurfaceCreateCallback mCallback<span class="token punctuation">;</span>

    <span class="token comment">/**
     * Sets callback.
     *
     * @param callback the callback
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCallback</span><span class="token punctuation">(</span><span class="token parameter">SurfaceCreateCallback callback</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        mCallback <span class="token operator">=</span> callback<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 绘制曲线数据
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">drawLineData</span><span class="token punctuation">(</span><span class="token parameter">Canvas canvas</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        Path path <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>int i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> line1Data<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            PointF startPoint <span class="token operator">=</span> line1Data<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                path<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>startPoint<span class="token punctuation">.</span>x<span class="token punctuation">,</span> startPoint<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                path<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>startPoint<span class="token punctuation">.</span>x<span class="token punctuation">,</span> startPoint<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>int i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> line2Data<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            PointF startPoint <span class="token operator">=</span> line2Data<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                path<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>startPoint<span class="token punctuation">.</span>x<span class="token punctuation">,</span> startPoint<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                path<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>startPoint<span class="token punctuation">.</span>x<span class="token punctuation">,</span> startPoint<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>int i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> line3Data<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            PointF startPoint <span class="token operator">=</span> line3Data<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                path<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>startPoint<span class="token punctuation">.</span>x<span class="token punctuation">,</span> startPoint<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                path<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>startPoint<span class="token punctuation">.</span>x<span class="token punctuation">,</span> startPoint<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>int i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> line4Data<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            PointF startPoint <span class="token operator">=</span> line4Data<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                path<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>startPoint<span class="token punctuation">.</span>x<span class="token punctuation">,</span> startPoint<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                path<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>startPoint<span class="token punctuation">.</span>x<span class="token punctuation">,</span> startPoint<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>int i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> line5Data<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            PointF startPoint <span class="token operator">=</span> line5Data<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                path<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>startPoint<span class="token punctuation">.</span>x<span class="token punctuation">,</span> startPoint<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                path<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>startPoint<span class="token punctuation">.</span>x<span class="token punctuation">,</span> startPoint<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        canvas<span class="token punctuation">.</span><span class="token function">drawPath</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> linePaint<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    @Override
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onDraw</span><span class="token punctuation">(</span><span class="token parameter">Canvas canvas</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onDraw</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 计算矩形框位置
     * Calc rect.
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">calcRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        rect1<span class="token punctuation">.</span>top <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        rect1<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        rect1<span class="token punctuation">.</span>right <span class="token operator">=</span> <span class="token punctuation">(</span>int<span class="token punctuation">)</span> totalWidth<span class="token punctuation">;</span>
        rect1<span class="token punctuation">.</span>bottom <span class="token operator">=</span> oneHeight<span class="token punctuation">;</span>

        rect2<span class="token punctuation">.</span>top <span class="token operator">=</span> oneHeight <span class="token operator">+</span> mSpaceHeight<span class="token punctuation">;</span>
        rect2<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        rect2<span class="token punctuation">.</span>right <span class="token operator">=</span> <span class="token punctuation">(</span>int<span class="token punctuation">)</span> totalWidth<span class="token punctuation">;</span>
        rect2<span class="token punctuation">.</span>bottom <span class="token operator">=</span> oneHeight <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> mSpaceHeight<span class="token punctuation">;</span>

        rect3<span class="token punctuation">.</span>top <span class="token operator">=</span> <span class="token punctuation">(</span>oneHeight <span class="token operator">+</span> mSpaceHeight<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
        rect3<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        rect3<span class="token punctuation">.</span>right <span class="token operator">=</span> <span class="token punctuation">(</span>int<span class="token punctuation">)</span> totalWidth<span class="token punctuation">;</span>
        rect3<span class="token punctuation">.</span>bottom <span class="token operator">=</span> <span class="token punctuation">(</span>oneHeight <span class="token operator">+</span> mSpaceHeight<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> oneHeight<span class="token punctuation">;</span>

        rect4<span class="token punctuation">.</span>top <span class="token operator">=</span> <span class="token punctuation">(</span>oneHeight <span class="token operator">+</span> mSpaceHeight<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">;</span>
        rect4<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        rect4<span class="token punctuation">.</span>right <span class="token operator">=</span> <span class="token punctuation">(</span>int<span class="token punctuation">)</span> totalWidth<span class="token punctuation">;</span>
        rect4<span class="token punctuation">.</span>bottom <span class="token operator">=</span> <span class="token punctuation">(</span>oneHeight <span class="token operator">+</span> mSpaceHeight<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">3</span> <span class="token operator">+</span> oneHeight<span class="token punctuation">;</span>

        rect5<span class="token punctuation">.</span>top <span class="token operator">=</span> <span class="token punctuation">(</span>oneHeight <span class="token operator">+</span> mSpaceHeight<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">;</span>
        rect5<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        rect5<span class="token punctuation">.</span>right <span class="token operator">=</span> <span class="token punctuation">(</span>int<span class="token punctuation">)</span> totalWidth<span class="token punctuation">;</span>
        rect5<span class="token punctuation">.</span>bottom <span class="token operator">=</span> <span class="token punctuation">(</span>oneHeight <span class="token operator">+</span> mSpaceHeight<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">4</span> <span class="token operator">+</span> oneHeight<span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Draw rect.
     * 调用该函数可以实现边框，canvas的调用函数就能实现比如填充颜色绘制等，具体自行发挥
     * @param canvas the canvas
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">drawRect</span><span class="token punctuation">(</span><span class="token parameter">Canvas canvas</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        canvas<span class="token punctuation">.</span><span class="token function">drawRect</span><span class="token punctuation">(</span>rect1<span class="token punctuation">,</span> rectPaint<span class="token punctuation">)</span><span class="token punctuation">;</span>
        canvas<span class="token punctuation">.</span><span class="token function">drawRect</span><span class="token punctuation">(</span>rect2<span class="token punctuation">,</span> rectPaint<span class="token punctuation">)</span><span class="token punctuation">;</span>
        canvas<span class="token punctuation">.</span><span class="token function">drawRect</span><span class="token punctuation">(</span>rect3<span class="token punctuation">,</span> rectPaint<span class="token punctuation">)</span><span class="token punctuation">;</span>
        canvas<span class="token punctuation">.</span><span class="token function">drawRect</span><span class="token punctuation">(</span>rect4<span class="token punctuation">,</span> rectPaint<span class="token punctuation">)</span><span class="token punctuation">;</span>
        canvas<span class="token punctuation">.</span><span class="token function">drawRect</span><span class="token punctuation">(</span>rect5<span class="token punctuation">,</span> rectPaint<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 提供给外部调用的单点更新数据
     *
     * @param data the data
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateUi</span><span class="token punctuation">(</span><span class="token parameter">PulseData data</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isCreate<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>line1Data<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token constant">TOTLE_X</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            line1Data<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            line2Data<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            line3Data<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            line4Data<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            line5Data<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            float y1 <span class="token operator">=</span> <span class="token punctuation">(</span>rect1<span class="token punctuation">.</span>top <span class="token operator">+</span> oneHeight <span class="token operator">-</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>dataFilter1<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>CunShang<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">TOTLE_Y</span><span class="token punctuation">)</span> <span class="token operator">*</span> yValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
            float y2 <span class="token operator">=</span> <span class="token punctuation">(</span>rect2<span class="token punctuation">.</span>top <span class="token operator">+</span> oneHeight <span class="token operator">-</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>dataFilter2<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>Cun<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">TOTLE_Y</span><span class="token punctuation">)</span> <span class="token operator">*</span> yValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
            float y3 <span class="token operator">=</span> <span class="token punctuation">(</span>rect3<span class="token punctuation">.</span>top <span class="token operator">+</span> oneHeight <span class="token operator">-</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>dataFilter3<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>Guan<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">TOTLE_Y</span><span class="token punctuation">)</span> <span class="token operator">*</span> yValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
            float y4 <span class="token operator">=</span> <span class="token punctuation">(</span>rect4<span class="token punctuation">.</span>top <span class="token operator">+</span> oneHeight <span class="token operator">-</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>dataFilter4<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>Chi<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">TOTLE_Y</span><span class="token punctuation">)</span> <span class="token operator">*</span> yValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
            float y5 <span class="token operator">=</span> <span class="token punctuation">(</span>rect5<span class="token punctuation">.</span>top <span class="token operator">+</span> oneHeight <span class="token operator">-</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>dataFilter5<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>ChiXia<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">TOTLE_Y</span><span class="token punctuation">)</span> <span class="token operator">*</span> yValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
            line1Data<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PointF</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> y1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            line2Data<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PointF</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> y2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            line3Data<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PointF</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> y3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            line4Data<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PointF</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> y4<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            line5Data<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PointF</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> y5<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            float y1 <span class="token operator">=</span> <span class="token punctuation">(</span>rect1<span class="token punctuation">.</span>top <span class="token operator">+</span> oneHeight <span class="token operator">-</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>dataFilter1<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>CunShang<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">TOTLE_Y</span><span class="token punctuation">)</span> <span class="token operator">*</span> yValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
            float y2 <span class="token operator">=</span> <span class="token punctuation">(</span>rect2<span class="token punctuation">.</span>top <span class="token operator">+</span> oneHeight <span class="token operator">-</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>dataFilter2<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>Cun<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">TOTLE_Y</span><span class="token punctuation">)</span> <span class="token operator">*</span> yValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
            float y3 <span class="token operator">=</span> <span class="token punctuation">(</span>rect3<span class="token punctuation">.</span>top <span class="token operator">+</span> oneHeight <span class="token operator">-</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>dataFilter3<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>Guan<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">TOTLE_Y</span><span class="token punctuation">)</span> <span class="token operator">*</span> yValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
            float y4 <span class="token operator">=</span> <span class="token punctuation">(</span>rect4<span class="token punctuation">.</span>top <span class="token operator">+</span> oneHeight <span class="token operator">-</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>dataFilter4<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>Chi<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">TOTLE_Y</span><span class="token punctuation">)</span> <span class="token operator">*</span> yValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
            float y5 <span class="token operator">=</span> <span class="token punctuation">(</span>rect5<span class="token punctuation">.</span>top <span class="token operator">+</span> oneHeight <span class="token operator">-</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>dataFilter5<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>ChiXia<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">TOTLE_Y</span><span class="token punctuation">)</span> <span class="token operator">*</span> yValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
            float x1 <span class="token operator">=</span> line1Data<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> xValue<span class="token punctuation">;</span>
            line1Data<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PointF</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            line2Data<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PointF</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            line3Data<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PointF</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            line4Data<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PointF</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y4<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            line5Data<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PointF</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y5<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">reDraw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 提供给外部调用的多点更新数据
     *
     * @param datas the datas
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateUi</span><span class="token punctuation">(</span><span class="token parameter">List<span class="token operator">&lt;</span>PulseData<span class="token operator">&gt;</span> datas</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isCreate<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>line1Data<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token constant">TOTLE_X</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            line1Data<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            line2Data<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            line3Data<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            line4Data<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            line5Data<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">updateUi</span><span class="token punctuation">(</span>datas<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span>int i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> datas<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                PulseData data <span class="token operator">=</span> datas<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                float y1 <span class="token operator">=</span> <span class="token punctuation">(</span>rect1<span class="token punctuation">.</span>top <span class="token operator">+</span> oneHeight <span class="token operator">-</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>dataFilter1<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>CunShang<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">TOTLE_Y</span><span class="token punctuation">)</span> <span class="token operator">*</span> yValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
                float y2 <span class="token operator">=</span> <span class="token punctuation">(</span>rect2<span class="token punctuation">.</span>top <span class="token operator">+</span> oneHeight <span class="token operator">-</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>dataFilter2<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>Cun<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">TOTLE_Y</span><span class="token punctuation">)</span> <span class="token operator">*</span> yValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
                float y3 <span class="token operator">=</span> <span class="token punctuation">(</span>rect3<span class="token punctuation">.</span>top <span class="token operator">+</span> oneHeight <span class="token operator">-</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>dataFilter3<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>Guan<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">TOTLE_Y</span><span class="token punctuation">)</span> <span class="token operator">*</span> yValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
                float y4 <span class="token operator">=</span> <span class="token punctuation">(</span>rect4<span class="token punctuation">.</span>top <span class="token operator">+</span> oneHeight <span class="token operator">-</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>dataFilter4<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>Chi<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">TOTLE_Y</span><span class="token punctuation">)</span> <span class="token operator">*</span> yValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
                float y5 <span class="token operator">=</span> <span class="token punctuation">(</span>rect5<span class="token punctuation">.</span>top <span class="token operator">+</span> oneHeight <span class="token operator">-</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>dataFilter5<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>ChiXia<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">TOTLE_Y</span><span class="token punctuation">)</span> <span class="token operator">*</span> yValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
                float x1 <span class="token operator">=</span> line1Data<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> xValue<span class="token punctuation">;</span>
                line1Data<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PointF</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                line2Data<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PointF</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                line3Data<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PointF</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                line4Data<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PointF</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y4<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                line5Data<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PointF</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y5<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token function">reDraw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * 重绘画布
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">reDraw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        Canvas canvas <span class="token operator">=</span> <span class="token function">getHolder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lockCanvas</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>canvas <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                canvas<span class="token punctuation">.</span><span class="token function">drawColor</span><span class="token punctuation">(</span>Color<span class="token punctuation">.</span><span class="token function">parseColor</span><span class="token punctuation">(</span><span class="token string">"#F2F2F2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">drawLineData</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>Exception e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">getHolder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unlockCanvasAndPost</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>Exception e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * 清空绘制曲线
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">cleanDrawLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        line1Data<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        line2Data<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        line3Data<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        line4Data<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        line5Data<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">postInvalidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * view的大小测量
     */</span>
    @Override
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onMeasure</span><span class="token punctuation">(</span><span class="token parameter">int widthMeasureSpec<span class="token punctuation">,</span> int heightMeasureSpec</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">setMeasuredDimension</span><span class="token punctuation">(</span><span class="token function">measureWidth</span><span class="token punctuation">(</span>widthMeasureSpec<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">measureHeight</span><span class="token punctuation">(</span>heightMeasureSpec<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * view的高度测量
     */</span>
    <span class="token keyword">private</span> int <span class="token function">measureHeight</span><span class="token punctuation">(</span><span class="token parameter">int measureSpec</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        int result<span class="token punctuation">;</span>
        int mode <span class="token operator">=</span> MeasureSpec<span class="token punctuation">.</span><span class="token function">getMode</span><span class="token punctuation">(</span>measureSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
        int size <span class="token operator">=</span> MeasureSpec<span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span>measureSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>mode <span class="token operator">==</span> MeasureSpec<span class="token punctuation">.</span><span class="token constant">EXACTLY</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            result <span class="token operator">=</span> size<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            result <span class="token operator">=</span> <span class="token number">75</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mode <span class="token operator">==</span> MeasureSpec<span class="token punctuation">.</span><span class="token constant">AT_MOST</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                result <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        totalHeight <span class="token operator">=</span> result<span class="token punctuation">;</span>
        int totalSpaceHeight <span class="token operator">=</span> mSpaceHeight <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">;</span>
        oneHeight <span class="token operator">=</span> <span class="token punctuation">(</span>int<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>totalHeight <span class="token operator">-</span> totalSpaceHeight<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        yValue <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>float<span class="token punctuation">)</span> oneHeight<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token constant">TOTLE_Y</span><span class="token punctuation">;</span>
        <span class="token function">calcRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> size<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * view的宽度测量
     */</span>
    <span class="token keyword">private</span> int <span class="token function">measureWidth</span><span class="token punctuation">(</span><span class="token parameter">int measureSpec</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        int result<span class="token punctuation">;</span>
        int mode <span class="token operator">=</span> MeasureSpec<span class="token punctuation">.</span><span class="token function">getMode</span><span class="token punctuation">(</span>measureSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
        int size <span class="token operator">=</span> MeasureSpec<span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span>measureSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>mode <span class="token operator">==</span> MeasureSpec<span class="token punctuation">.</span><span class="token constant">EXACTLY</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            result <span class="token operator">=</span> size<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            result <span class="token operator">=</span> <span class="token number">75</span><span class="token punctuation">;</span><span class="token comment">//根据自己的需要更改</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mode <span class="token operator">==</span> MeasureSpec<span class="token punctuation">.</span><span class="token constant">AT_MOST</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                result <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        totalWidth <span class="token operator">=</span> result<span class="token punctuation">;</span>
        xValue <span class="token operator">=</span> totalWidth <span class="token operator">/</span> <span class="token constant">TOTLE_X</span><span class="token punctuation">;</span>
        Log<span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token string">"wl"</span><span class="token punctuation">,</span> <span class="token string">"总高:"</span> <span class="token operator">+</span> totalHeight <span class="token operator">+</span> <span class="token string">"xValue:"</span> <span class="token operator">+</span> xValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    @Override
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">surfaceCreated</span><span class="token punctuation">(</span><span class="token parameter">SurfaceHolder holder</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        Canvas canvas <span class="token operator">=</span> holder<span class="token punctuation">.</span><span class="token function">lockCanvas</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        canvas<span class="token punctuation">.</span><span class="token function">drawColor</span><span class="token punctuation">(</span>Color<span class="token punctuation">.</span><span class="token function">parseColor</span><span class="token punctuation">(</span><span class="token string">"#F2F2F2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        holder<span class="token punctuation">.</span><span class="token function">unlockCanvasAndPost</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mCallback <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            mCallback<span class="token punctuation">.</span><span class="token function">surfaceCreated</span><span class="token punctuation">(</span>holder<span class="token punctuation">)</span><span class="token punctuation">;</span>
        isCreate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    @Override
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">surfaceChanged</span><span class="token punctuation">(</span><span class="token parameter">SurfaceHolder holder<span class="token punctuation">,</span> int format<span class="token punctuation">,</span> int width<span class="token punctuation">,</span> int height</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    <span class="token punctuation">}</span>

    @Override
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">surfaceDestroyed</span><span class="token punctuation">(</span><span class="token parameter">SurfaceHolder holder</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        isCreate <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * The interface Surface create callback.
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SurfaceCreateCallback</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">/**
         * Surface created.
         *
         * @param holder the holder
         */</span>
        <span class="token keyword">void</span> <span class="token function">surfaceCreated</span><span class="token punctuation">(</span>SurfaceHolder holder<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>代码实际比较简单，博主拿手机测试实际1S绘制数据完全能达到1000点。<br> 关于结合串口后卡顿的问题，涉及项目底层通讯的原因无法贴出代码，但是问题点就是拿到串口inputstream后，一般是开线程去循环读取，如果单次读取buff比较小，而下位机抛数据速度比你读取速度快的话，就会造成数据延时，具体的表现就是绘制数据比实际数据会延时几秒，对于这个问题，博主是采取单次加大读取数据，加大读取间隔，目前通过该方式，在下位机1S255次数据返回的情况下，示波器没有延时，更高采样率没有试验，具体可以根据自己需求去探索</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/bc9f58813d3981f7a013ac57d4928b8d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">LTE学习笔记 —— 测量</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/cfc76338694c3055c9ccbca97d61b2af/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">60. 第k个排列(python)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>