<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>docker安裝gocd-server，并配置gitlab授权登录 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="docker安裝gocd-server，并配置gitlab授权登录" />
<meta property="og:description" content="gocd的地址：Installing GoCD server on Windows | GoCD User Documentation
gocd文档：GitHub - gocd/docker-gocd-server: Docker server image for GoCD
一、docker拉取gocd镜像
#拉取server镜像 docker pull gocd/gocd-server:v21.1.0 docker pull gocd/gocd-server:v23.5.0 #拉取agent镜像 docker pull gocd/gocd-agent-alpine-3.12 docker pull gocd/gocd-agent-alpine-3.12 二、创建gocd-server容器，在创建gocd-server的时候还需要安装两个插件，一个是通过将镜像保存到外部的插件，另外一个是使用gitlab登录的插件，这两个插件包是：
docker-registry-artifact-plugin-1.3.0-138.jar
gitlab-oauth-authorization-plugin-2.1.0-205.jar
下面有下载地址，下载完之后，通过挂载的方式挂载到docker，使用dockers -v
##先下载jar包 https://github.com/gocd/docker-registry-artifact-plugin/releases/download/v1.3.0-138-exp/docker-registry-artifact-plugin-1.3.0-138.jar https://github.com/gocd-contrib/gitlab-oauth-authorization-plugin/releases/download/v2.1.0-205/gitlab-oauth-authorization-plugin-2.1.0-205.jar ##然后创建目录,这个目录自己随便建 mkdir /root/devops/gocd/plugins ##给这个目录授权，因为gocd在启动的时候会在这个目录里面创建其他目录 chmod 777 /root/devops/gocd/plugins ##然后在/root/devops/gocd/plugins下创建一个external目录 mkdir external ##把前面的两个jar包放到eternal目录下 ##然后把创建的目录指定到/godata/plugins这个目录是放插件的地方 docker run -p 8153:8153 --name gocd-server -v /root/devops/gocd/plugins:/godata/plugins -e GOCD_SERVER_PORT=8153 -d gocd/gocd-server:v21.1.0 三、访问gocd-server，地址：http://ip:8153/
四、开始设置gitlab登录
第一步点击“Authorization Configurations”
第二步点击“Add”" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/b9b5c7f58d49330125577e07273aa5de/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-07T20:12:05+08:00" />
<meta property="article:modified_time" content="2024-01-07T20:12:05+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">docker安裝gocd-server，并配置gitlab授权登录</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="u8c128937">gocd的地址：<a href="https://docs.gocd.org/current/installation/install/server/windows.html" rel="nofollow" title="Installing GoCD server on Windows | GoCD User Documentation">Installing GoCD server on Windows | GoCD User Documentation</a></p> 
<p id="ue7e24718">gocd文档：<a href="https://github.com/gocd/docker-gocd-server" title="GitHub - gocd/docker-gocd-server: Docker server image for GoCD">GitHub - gocd/docker-gocd-server: Docker server image for GoCD</a></p> 
<p id="u66cbf04e">一、docker拉取gocd镜像</p> 
<pre><code class="language-java">#拉取server镜像
docker pull gocd/gocd-server:v21.1.0

docker pull gocd/gocd-server:v23.5.0
#拉取agent镜像
docker pull gocd/gocd-agent-alpine-3.12

docker pull gocd/gocd-agent-alpine-3.12</code></pre> 
<p id="u4b3b1437">二、创建gocd-server容器，在创建gocd-server的时候还需要安装两个插件，一个是通过将镜像保存到外部的插件，另外一个是使用gitlab登录的插件，这两个插件包是：</p> 
<p id="u32bf05fe">docker-registry-artifact-plugin-1.3.0-138.jar</p> 
<p id="u108980b7">gitlab-oauth-authorization-plugin-2.1.0-205.jar</p> 
<p id="ub91438ee">下面有下载地址，下载完之后，通过挂载的方式挂载到docker，使用dockers -v</p> 
<pre><code class="language-java">##先下载jar包
https://github.com/gocd/docker-registry-artifact-plugin/releases/download/v1.3.0-138-exp/docker-registry-artifact-plugin-1.3.0-138.jar
https://github.com/gocd-contrib/gitlab-oauth-authorization-plugin/releases/download/v2.1.0-205/gitlab-oauth-authorization-plugin-2.1.0-205.jar
##然后创建目录,这个目录自己随便建
mkdir /root/devops/gocd/plugins
##给这个目录授权，因为gocd在启动的时候会在这个目录里面创建其他目录
chmod 777 /root/devops/gocd/plugins
##然后在/root/devops/gocd/plugins下创建一个external目录
mkdir external
##把前面的两个jar包放到eternal目录下

##然后把创建的目录指定到/godata/plugins这个目录是放插件的地方
docker run -p 8153:8153 --name gocd-server -v /root/devops/gocd/plugins:/godata/plugins -e GOCD_SERVER_PORT=8153 -d gocd/gocd-server:v21.1.0</code></pre> 
<p id="udc158e45">三、访问gocd-server，地址：<a href="http://120.25.126.16:8153/" rel="nofollow" title="http://ip:8153/">http://ip:8153/</a></p> 
<p id="ua7b4919c"></p> 
<p class="img-center"><img alt="" height="922" id="u19edcef2" src="https://images2.imgbox.com/4b/93/99JJ8gWP_o.png" width="1200"></p> 
<p id="uaab01d81">四、开始设置gitlab登录</p> 
<p id="u89e4da01">第一步点击“Authorization Configurations”</p> 
<p id="u5db64cec"></p> 
<p class="img-center"><img alt="" height="912" id="ua84e11cb" src="https://images2.imgbox.com/e8/60/S9uoHYvD_o.png" width="1200"></p> 
<p id="u47be8f2e">第二步点击“Add”</p> 
<p id="u624cb42c"></p> 
<p class="img-center"><img alt="" height="916" id="ub3b82ede" src="https://images2.imgbox.com/bf/4a/Y6BSTpO3_o.png" width="1200"></p> 
<p id="u2fe350c9">第三步Plugin选择“GitLab OAuth authorization plugin”</p> 
<p id="ue5d9381d">Id:这里可以随便写，我这里填了“gocd-gitlab”</p> 
<p id="ua8013a0c"></p> 
<p class="img-center"><img alt="" height="922" id="ub8873373" src="https://images2.imgbox.com/88/27/n85zgEHn_o.png" width="1200"></p> 
<p id="u6cca12e6">然后“Authenticate with”选择“GitLab Enterprise”。但是下面这几个填写什么呢？</p> 
<p id="u752a4672">GitLab Enterprise Base Url:</p> 
<p id="u2d278df1">Application ID:</p> 
<p id="ue2268af6">Client Secret:</p> 
<p id="ub45565d7">Personal Access Token:</p> 
<p id="u2b7b373c"></p> 
<p class="img-center"><img alt="" height="922" id="u6d721511" src="https://images2.imgbox.com/68/29/0bN2lpf2_o.png" width="1200"></p> 
<p id="u37a2d419">第四步：来到gitlab这边<img alt="" height="786" src="https://images2.imgbox.com/a1/f7/dY4fBW3r_o.png" width="1200"></p> 
<p id="uc728b1d6"></p> 
<p id="ue27b92a5">点击头像，选择“Preferences”</p> 
<p id="ub456467d"></p> 
<p class="img-center"><img alt="" height="916" id="uccf395d1" src="https://images2.imgbox.com/26/86/RQFMdGDZ_o.png" width="1200"></p> 
<p id="uc63a6d58">在进去之后，点击左边“Applications”,然后右边选择“Add new application”</p> 
<p id="u75715b2e"></p> 
<p class="img-center"><img alt="" height="916" id="u9e4ad754" src="https://images2.imgbox.com/fd/f5/Z9GEB2MX_o.png" width="1200"></p> 
<p id="u38e1495f">进来之后就是这个页面，Name是可以随便填写的，Redirect URL到底填写什么呢？这里先直接填写gocd的首页地址，比如http://ip:8153。后面再修改。</p> 
<p id="ue6d4a304"></p> 
<p class="img-center"><img alt="" height="916" id="ucb32fc4c" src="https://images2.imgbox.com/ed/6e/8upF44x1_o.png" width="1200"></p> 
<p id="u3dee0fa0">下面这个Scopes怎么选呢，可以参考这个<a href="https://docs.gitlab.com/ee/integration/oauth_provider.html" rel="nofollow" title="https://docs.gitlab.com/ee/integration/oauth_provider.html">https://docs.gitlab.com/ee/integration/oauth_provider.html</a></p> 
<p id="ua4ce8d5c"></p> 
<p class="img-center"><img alt="" height="916" id="uc9217d86" src="https://images2.imgbox.com/a2/49/ieRorV2s_o.png" width="1200"></p> 
<p id="udcb32290">点击“save”之后，就有了ApplicationID和Secret，保存好，后面要用。</p> 
<p id="uc044faa7"></p> 
<p class="img-center"><img alt="" height="916" id="uab5eb268" src="https://images2.imgbox.com/b9/ff/aMBd4fy0_o.png" width="1200"></p> 
<p id="u7a3e4ffb">后面还要创建一个access token，点击左边的“Access Tokens”,再点击右边“Add new token”</p> 
<p id="ud98a5662"></p> 
<p class="img-center"><img alt="" height="916" id="uc610fbb9" src="https://images2.imgbox.com/df/f6/6VBQ6ZwF_o.png" width="1200"></p> 
<p id="u46f88e56">token name可以随便填，expiration date只能选一年，scopes选下图打勾的几个就可以了。</p> 
<p id="u1713732d"></p> 
<p class="img-center"><img alt="" height="916" id="uedff2d6f" src="https://images2.imgbox.com/99/1c/caoC3nFx_o.png" width="1200"></p> 
<p id="ua748250d">点击保存之后，会生产一个token,这个一定要保存好。gocd要用到。</p> 
<p id="u072a156c">上面的做完之后，要回到gocd的配置页面，开始配置这几个选项</p> 
<p id="u4fea8ea9">GitLab Enterprise Base Url:就填写gitlab的首页地址，比如http://ip:80就可以了</p> 
<p id="ua3d89d78">Application ID:有了</p> 
<p id="uacdda311">Client Secret:有了</p> 
<p id="u391d6482">Personal Access Token:有了</p> 
<p id="u84af4900"></p> 
<p class="img-center"><img alt="" height="916" id="KJpPM" src="https://images2.imgbox.com/33/4e/3hdu2iQj_o.png" width="1200"></p> 
<p id="ud5a018b4">配置好之后，再次进入gocd，已经有gitlab图标了，点击gitlab的图标。</p> 
<p id="u9678e791"></p> 
<p class="img-center"><img alt="" height="922" id="uf66122ec" src="https://images2.imgbox.com/19/6f/fBu0FkYJ_o.png" width="1200"></p> 
<p id="u456a7fd4">欧尼，报错了。The redirect URI included is not valid.怎么解决呢？</p> 
<p id="u2e7e9fd6"></p> 
<p class="img-center"><img alt="" height="922" id="u722f07ba" src="https://images2.imgbox.com/89/b5/8Zn8Be43_o.png" width="1200"></p> 
<p id="u275f8aec">把上面这个地址复制出来，然后粘贴到别的地方，找到redirect_uri这个地方。把这个url复制粘贴到gitlab的Application中的Redirect URL这里。</p> 
<p id="u0a607f4d"></p> 
<p class="img-center"><img alt="" height="1039" id="uda46e4ce" src="https://images2.imgbox.com/28/1d/pkhRH29O_o.png" width="1200"></p> 
<p id="u31545e37"></p> 
<p class="img-center"><img alt="" height="290" id="ube15ce2c" src="https://images2.imgbox.com/d1/20/b2SJKKhl_o.png" width="1200"></p> 
<p id="uc0da0f4d"></p> 
<p class="img-center"><img alt="" height="916" id="uac2ac300" src="https://images2.imgbox.com/3e/8d/uFkCQsNN_o.png" width="1200"></p> 
<p id="ubf715508">终于可以了。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/139aa15a6e3ac9704789278000167da1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">第三十八周周报：文献阅读 &#43;BILSTM&#43;GRU&#43;Seq2seq</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a492bb5aad919f836f2d31e5dc22e7a4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">深度学习：解决CNN的困境——胶囊网络</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>