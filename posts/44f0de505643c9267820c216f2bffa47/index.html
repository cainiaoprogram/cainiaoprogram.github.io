<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>[yocto]使用devtool工具创建配方文件 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="[yocto]使用devtool工具创建配方文件" />
<meta property="og:description" content="1. devtool创建新的工作环境 在使用devtool之前需要先搭建poky环境，并且需要引用poky的构建环境；见之前的文章
基于poky项目创建自己的层并且在层中增加自己的配方文件
创建工作环境
使用devtool创建workspace需要指定路径，否则默认在当前目录下创建新层 devtool create-workspace meta-devtool ~/test/poky$ bitbake-layers show-layers NOTE: Starting bitbake server... layer path priority ======================================================================================================== core /xxx/test/poky/meta 5 yocto /xxx/test/poky/meta-poky 5 yoctobsp /xxx/test/poky/meta-yocto-bsp 5 meta-test /xxx/test/poky/meta-test 6 workspacelayer /xxx/test/poky/meta-devtool 99 新增的层名字为workspacelayer，路径为/xxx/test/poky/meta-devtool 2. 生成配方文件 a.源保存在网络外部镜像中
devtool add recipe fetchuri 本例源来自网络外部；源被下载到工作目录下的sources目录，生成一个bbappend配方文件继承externalsrc类来指向源；
command
devtool add hello https://ftp.gnu.org/gnu/hello/hello-2.12.tar.gz ~/test/poky/meta-devtool$ tree -L 1 . ├── appends ├── conf ├── README ├── recipes └── sources hello_2.12.1-6fe9.bbappend
inherit externalsrc EXTERNALSRC = &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/44f0de505643c9267820c216f2bffa47/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-16T16:30:49+08:00" />
<meta property="article:modified_time" content="2023-05-16T16:30:49+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">[yocto]使用devtool工具创建配方文件</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="1_devtool_0"></a>1. devtool创建新的工作环境</h3> 
<p>在使用<code>devtool</code>之前需要先搭建<code>poky</code>环境，并且需要引用<code>poky</code>的构建环境；见之前的文章<br> <a href="https://blog.csdn.net/buffoonnnn/article/details/129081317">基于poky项目创建自己的层并且在层中增加自己的配方文件</a></p> 
<p>创建工作环境</p> 
<ul><li>使用<code>devtool</code>创建<code>workspace</code>需要指定路径，否则默认在当前目录下创建新层</li></ul> 
<pre><code class="prism language-c">devtool create<span class="token operator">-</span>workspace meta<span class="token operator">-</span>devtool
</code></pre> 
<pre><code class="prism language-c"><span class="token operator">~</span><span class="token operator">/</span>test<span class="token operator">/</span>poky$ bitbake<span class="token operator">-</span>layers show<span class="token operator">-</span>layers
NOTE<span class="token operator">:</span> Starting bitbake server<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
layer                 path                                                                    priority
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
core                 <span class="token operator">/</span>xxx<span class="token operator">/</span>test<span class="token operator">/</span>poky<span class="token operator">/</span>meta                                   <span class="token number">5</span>
yocto                <span class="token operator">/</span>xxx<span class="token operator">/</span>test<span class="token operator">/</span>poky<span class="token operator">/</span>meta<span class="token operator">-</span>poky                              <span class="token number">5</span>
yoctobsp             <span class="token operator">/</span>xxx<span class="token operator">/</span>test<span class="token operator">/</span>poky<span class="token operator">/</span>meta<span class="token operator">-</span>yocto<span class="token operator">-</span>bsp                         <span class="token number">5</span>
meta<span class="token operator">-</span>test            <span class="token operator">/</span>xxx<span class="token operator">/</span>test<span class="token operator">/</span>poky<span class="token operator">/</span>meta<span class="token operator">-</span>test                              <span class="token number">6</span>
workspacelayer       <span class="token operator">/</span>xxx<span class="token operator">/</span>test<span class="token operator">/</span>poky<span class="token operator">/</span>meta<span class="token operator">-</span>devtool                           <span class="token number">99</span>
</code></pre> 
<ul><li>新增的层名字为<code>workspacelayer</code>，路径为<code>/xxx/test/poky/meta-devtool</code></li></ul> 
<h3><a id="2__22"></a>2. 生成配方文件</h3> 
<ul><li> <p>a.源保存在网络外部镜像中</p> <pre><code class="prism language-c">devtool add recipe fetchuri
</code></pre> 
  <ul><li> <p>本例源来自网络外部；源被下载到工作目录下的<code>sources</code>目录，生成一个<code>bbappend</code>配方文件继承<code>externalsrc</code>类来指向源；</p> </li><li> <p>command</p> <pre><code class="prism language-c">devtool add hello https<span class="token operator">:</span><span class="token comment">//ftp.gnu.org/gnu/hello/hello-2.12.tar.gz</span>
</code></pre> <pre><code class="prism language-c"><span class="token operator">~</span><span class="token operator">/</span>test<span class="token operator">/</span>poky<span class="token operator">/</span>meta<span class="token operator">-</span>devtool$ tree <span class="token operator">-</span>L <span class="token number">1</span>
<span class="token punctuation">.</span>
├── appends
├── conf
├── README
├── recipes
└── sources
</code></pre> </li><li> <p>hello_2.12.1-6fe9.bbappend</p> <pre><code class="prism language-c">inherit externalsrc
EXTERNALSRC <span class="token operator">=</span> <span class="token string">"/xxx/test/poky/meta-devtool/sources/hello"</span>

<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">initial</span><span class="token expression">_rev<span class="token operator">:</span> <span class="token number">645</span>b54bc75f055185b26d766a7d713871eec4152</span></span>
</code></pre> </li></ul> </li><li> <p>b.源保存在本地，但不保存当前工作区中</p> <pre><code class="prism language-c">devtool add recipe srctree
</code></pre> 
  <ul><li> <p>本例源来自于本地的<code>meta-test/recipes-test/hello/hello-1.0</code>，所以生成的配方文件<code>SRC_URI</code>为空，且在<code>append</code>文件中追加了源的本地路径</p> </li><li> <p>command</p> <pre><code class="prism language-c">devtool add hello meta<span class="token operator">-</span>test<span class="token operator">/</span>recipes<span class="token operator">-</span>test<span class="token operator">/</span>hello<span class="token operator">/</span>hello<span class="token operator">-</span><span class="token number">1.0</span><span class="token operator">/</span>
</code></pre> <pre><code class="prism language-c"><span class="token punctuation">.</span>
├── appends
│   └── hello<span class="token punctuation">.</span>bbappend
├── conf
│   └── layer<span class="token punctuation">.</span>conf
├── README
└── recipes
    └── hello
        └── hello<span class="token punctuation">.</span>bb

<span class="token number">4</span> directories<span class="token punctuation">,</span> <span class="token number">4</span> files
</code></pre> </li><li> <p>hello.bb</p> <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Recipe created by recipetool</span></span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">This is the basis of a recipe and may need further editing in order to be fully functional<span class="token punctuation">.</span></span></span>
# <span class="token punctuation">(</span>Feel free to remove these comments when editing<span class="token punctuation">.</span><span class="token punctuation">)</span>

<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Unable to find any files that looked like license statements<span class="token punctuation">.</span> Check the accompanying</span></span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">documentation</span> <span class="token expression">and source headers and set LICENSE and LIC_FILES_CHKSUM accordingly<span class="token punctuation">.</span></span></span>
#
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">NOTE<span class="token operator">:</span> LICENSE is being set to </span><span class="token string">"CLOSED"</span> <span class="token expression">to allow you to at least start building <span class="token operator">-</span> <span class="token keyword">if</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">this</span> <span class="token expression">is not accurate with respect to the licensing of the software being <span class="token function">built</span> <span class="token punctuation">(</span>it</span></span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">will</span> <span class="token expression">not be in most cases<span class="token punctuation">)</span> you must specify the correct value before using this</span></span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">recipe</span> <span class="token expression"><span class="token keyword">for</span> anything other than initial testing<span class="token operator">/</span>development<span class="token operator">!</span></span></span>
LICENSE <span class="token operator">=</span> <span class="token string">"CLOSED"</span>
LIC_FILES_CHKSUM <span class="token operator">=</span> <span class="token string">""</span>

<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">No information <span class="token keyword">for</span> SRC_URI <span class="token function">yet</span> <span class="token punctuation">(</span>only an external source tree was specified<span class="token punctuation">)</span></span></span>
SRC_URI <span class="token operator">=</span> <span class="token string">""</span>

<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">NOTE<span class="token operator">:</span> no Makefile found<span class="token punctuation">,</span> unable to determine what needs to be done</span></span>

<span class="token function">do_configure</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Specify any needed configure commands here</span></span>
	<span class="token operator">:</span>
<span class="token punctuation">}</span>

<span class="token function">do_compile</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Specify compilation commands here</span></span>
	<span class="token operator">:</span>
<span class="token punctuation">}</span>

<span class="token function">do_install</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Specify install commands here</span></span>
	<span class="token operator">:</span>
<span class="token punctuation">}</span>
</code></pre> </li><li> <p>hello.bbappend</p> <pre><code class="prism language-c">inherit externalsrc
EXTERNALSRC <span class="token operator">=</span> <span class="token string">"/xxx/test/poky/meta-test/recipes-test/hello/hello-1.0"</span>
EXTERNALSRC_BUILD <span class="token operator">=</span> <span class="token string">"/xxx/test/poky/meta-test/recipes-test/hello/hello-1.0"</span>
</code></pre> </li></ul> </li><li> <p>c. 源保存在网络外部镜像中，但<code>fetch</code>获取保存在工作区外</p> <pre><code class="prism language-c">devtool add recipe srctree fetchuri
</code></pre> 
  <ul><li>本例中源被网络下载并且保存到 <code>../meta-test/recipes-test/mysource</code></li><li>command<pre><code class="prism language-c">devtool add hello <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>meta<span class="token operator">-</span>test<span class="token operator">/</span>recipes<span class="token operator">-</span>test<span class="token operator">/</span>mysource https<span class="token operator">:</span><span class="token comment">//ftp.gnu.org/gnu/hello/hello-2.12.tar.gz</span>
</code></pre> <pre><code class="prism language-c"><span class="token punctuation">.</span>
├── appends
│   └── hello_2<span class="token punctuation">.</span><span class="token number">12.1</span><span class="token operator">-</span><span class="token number">6f</span>e9<span class="token punctuation">.</span>bbappend
├── conf
│   └── layer<span class="token punctuation">.</span>conf
├── README
└── recipes
    └── hello
        └── hello_2<span class="token punctuation">.</span><span class="token number">12.1</span><span class="token operator">-</span><span class="token number">6f</span>e9<span class="token punctuation">.</span>bb
</code></pre> </li><li>hello.bbappend<pre><code class="prism language-c">inherit externalsrc
EXTERNALSRC <span class="token operator">=</span> <span class="token string">"/home/wjzhang/poky/test/111/poky/meta-test/recipes-test/mysource"</span>

<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">initial</span><span class="token expression">_rev<span class="token operator">:</span> <span class="token number">7</span>b0ae8a9f30fd8f0c2b1f5e9de66317cd78964e5</span></span>
</code></pre> </li></ul> </li></ul> 
<h3><a id="3__146"></a>3 编辑修改配方文件</h3> 
<pre><code class="prism language-c">devtool edit<span class="token operator">-</span>recipe recipe
</code></pre> 
<ul><li>以修改<code>hello</code>的配方文件为例<pre><code class="prism language-c">devtool edit<span class="token operator">-</span>recipe hello
</code></pre> </li></ul> 
<h3><a id="4__155"></a>4 编译目标</h3> 
<pre><code class="prism language-c">devtool build recipe
</code></pre> 
<p>构建包含所有来自workspace层的菜谱的镜像</p> 
<pre><code class="prism language-c">devtool build<span class="token operator">-</span>image <span class="token operator">&lt;</span>image<span class="token operator">-</span>name<span class="token operator">&gt;</span>
</code></pre> 
<h3><a id="5__164"></a>5 部署包到目标系统</h3> 
<p>可以将构建完成的包部署到目标系统上，目标系统可以是<strong>实际硬件或者QEMU</strong>；唯一要求是目标系统必须是运行着<code>SSH</code>的服务器</p> 
<pre><code class="prism language-c">devtool deploy<span class="token operator">-</span>target recipe target
</code></pre> 
<p>从目标系统移除包</p> 
<pre><code class="prism language-c">devtool undeploy<span class="token operator">-</span>target recipe target
</code></pre> 
<h3><a id="6__173"></a>6 完成配方上的工作</h3> 
<pre><code class="prism language-c">devtool finish recipe layer
</code></pre> 
<p>命令创建和本地git仓库中的提交相对应的补丁，将新配方移到更永久的层，然后重置配方，使配方正常构建而不是从工作区构建</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c529c5dc5fc1a44dae052e7eff551297/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">MobaXterm连接Ubuntu系统</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/02120fffbcfefde76be4e6640e69048a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">java.lang.IllegalStateException: Current request is not of type已解决、有效</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>